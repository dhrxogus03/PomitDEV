define("DS/TagNavigator/TaggerTrackerApi",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/Usage/TrackerAPI","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s){"use strict";return t.singleton(i,a,{tracker:null,messageBus:null,_trackersCache:{},getTrackerCache:function(){return this._trackersCache},clearTrackerCache:function(e){e?this._trackersCache[e]=[]:this._trackersCache={}},setTrackerCache:function(e){let t=e.eventCategory+"_"+e.eventAction;this._trackersCache[t]||(this._trackersCache[t]=[]),this._trackersCache[t].push(e)},set:function(){this.messageBus=s.subscribe({channel:"TaggerTrackerApi",topic:"hit",callback:this._track.bind(this)})},_track:function(t){if(e.is(t)){var i={eventCategory:e.is(t.category)?t.category:"6WTagger",eventAction:e.is(t.action)?t.action:"actions",appID:"X3DTAGS_AP",persDim:e.is(t.persDim)?t.persDim:{},persVal:e.is(t.persVal)?t.persVal:{}};this.setTrackerCache(i),n.trackPageEvent(i)}}})}),define("DS/TagNavigator/Logger",[],function(){"use strict";return new function(e){var t,i,a,n,s,o;function r(e){return function(){if(i)if(a.console){if(window.update_tn_snackbar&&window.update_tn_snackbar.apply(null,[arguments,1]),"function"==typeof a.console[e])return a.console[e].apply(a.console,Array.prototype.slice.call(arguments));if("function"!=typeof a.console[e]&&"object"==typeof a.console[e]&&"debug"!==e)return a.console[e](Array.prototype.slice.call(arguments))}else if(a.opera&&"function"==typeof a.opera.postError)return a.opera.postError.apply(null,Array.prototype.slice.call(arguments))}}for("boolean"!=typeof e&&(e=!1),i=e,a=window||global||{},this.disable=function(){return i=!1,this},this.enable=function(){return i=!0,this},n=0,s=(o=["log","info","warn","error","debug","group","groupEnd"]).length;n<s;n++)this[t=o[n]]=r(t)}(-1!==location.search.indexOf("TNLogs"))}),define("DS/TagNavigator/simplified/model/TagValueWrapper",[],function(){"use strict";return{getWrapper:function(e){return{pred:e.pred,count:0,type:e.type,uri:e.uri,icon:e.icon,displayValue:e.displayValue,embeddedPred:e.embeddedPred,embeddedTags:e.embeddedTags,getUri:function(){return e.getUri()},getDisplayValue:function(){return e.getDisplayValue()},getCount:function(){return this.count},setEmbeddedSixW:function(e){this.embeddedPred=e},setEmbeddedTagValues:function(e){this.embeddedTags=e}}},getWrapperFromTagInfo:function(e){return{pred:e.sixw,count:e.count,type:e.type,uri:e.object,icon:e.icon,displayValue:e.dispValue||e.object,getCount:function(){return this.count}}}}}),define("DS/TagNavigator/NotificationManager",["UWA/Class","UWA/Class/Events"],function(e,t){"use strict";return e.singleton(t,{init:function(){this._notificationsQueue={}},push:function(e){return e.type&&(this._notificationsQueue[e.type]||(this._notificationsQueue[e.type]=[]),this._notificationsQueue[e.type].push(e)),this},dispatch:function(e){var t,i,a,n,s,o=[],r={},l=this;return n=Object.keys(this._notificationsQueue),e&&n.forEach(function(e){if(t=l._notificationsQueue[e],(a=t[0]).mergeWidth){for(i=1;i<t.length;i++)a.mergeWidth(t[i]);l._notificationsQueue[e]=[a]}}),n.forEach(function(e){for(t=l._notificationsQueue[e],i=0;i<t.length;i++)s=t[i].message.format(t[i].data),t[i].message=s,t[i].data=t[i].data||{className:"error"},t[i].data.className=t[i].data.className||"error",r[s]||(o.push(t[i]),r[s]=!0);l.dispatchEvent("notify",o),r={},o=[]}),this._notificationsQueue={},this}})}),define("DS/TagNavigator/simplified/model/CriteriaModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","UWA/Class/Collection"],function(e,t,i,a){"use strict";var n=t.extend(i,{idAttribute:"criteriaId",defaults:{criteriaId:"",title:"",level:0,expandStatus:!1,count:0,iconClass:"",isOther:!1,isComposite:!1,isContainer:!1,rootIconClass:""},setup:function(){this._parent()},getCount:function(){return this.isComposite()?this.get("count")+this.get("subCategories").reduce(function(e,t){return e+t.get("count")},0):this.get("count")},getAllSubCategories:function(){return this.get("subCategories")?this.get("subCategories").toArray():[]},getSubCategory:function(e){return this.get("subCategories").get(e)},addSubCategory:function(e){this.get("subCategories").add(e)},setAsComposite:function(){var e=this.get("subCategories");return e||(e=new a([],{model:n}),this.set("subCategories",e),this.set("isComposite",!0)),e},isComposite:function(){return this.get("isComposite")},setAsContainer:function(){this.set("subCategories",new a([],{model:n})),this.set("isContainer",!0)},isContainer:function(){return this.get("isContainer")},updateCount:function(e){this.set("count",this.get("count")+e)},getSelectedSubCategories:function(e){this.get("subCategories")&&this.get("subCategories").forEach(function(t){if(!0===t.get("selected"))e.push(t);else if(t.isContainer())return t.getSelectedSubCategories(e)})},getRefineStructure:function(e){var t=[];if(this.isComposite())t.push(this._getCompositeRefineStructure());else if(this.isContainer())if(e){var i=this.get("predicate");t.push({predicate:i?i.getFullPredicateID():"ds6w:what/ds6w:type",object:[],dispValue:this.get("title"),type:i?i.getType():"string",isComposite:!0});for(var a=this.get("subCategories"),n=0;n<a.length;n++){a.at(n).getRefineStructure(e).forEach(function(e){UWA.is(e.object,"array")?t[0].object=t[0].object.concat(e.object):t[0].object.push(e.object)})}}else this.get("subCategories").forEach(function(i){t=t.concat(i.getRefineStructure(e))});else{i=this.get("predicate");t.push({predicate:i.getFullPredicateID(),object:this.get("criteriaId"),dispValue:this.get("title"),type:i.getType()})}return t},_getCompositeRefineStructure:function(){var e=this.get("predicate"),t={predicate:e.getFullPredicateID(),object:[this.get("criteriaId")],dispValue:this.get("title"),type:e.getType(),isComposite:!0};return this.get("subCategories").forEach(function(e){t.object.push(e.get("criteriaId"))}),t}});return n}),define("DS/TagNavigator/simplified/views/SimplifiedTaggerRootWArea",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/SimplifiedTaggerRootWArea.html","DS/Handlebars/Handlebars","DS/UIKIT/Scroller"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"nav",className:"root-w-nav-container",template:a.compile(i),domEvents:{"click a":"clickRootW"},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){var e=this.template();this.container.setContent(e),this.taggerView=this.getOption("taggerView");var t=this.taggerView.getActiveRootW();t&&this.enableAllWSelection(t),this.scrollerForWArea=new n({element:this.container});return this.enableGradient(),this.container.addEventListener("mouseenter",this.disableGradient.bind(this)),this.container.addEventListener("mouseleave",this.enableGradient.bind(this)),this},enableAllWSelection:function(e){var t=this;e.forEach(function(e){var i=e.replace("ds6w:","");t.getElement("#root-w-"+i).addClassName("active")}),this.taggerView._simplifiedSelectedRootWs=e,this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length&&this.container.addClassName("all-w-active")},clickRootW:function(e){var t=this,i=e.target.getClosest("a"),a=i.getAttribute("predicate");i.hasClassName("active")?1==this.taggerView._simplifiedSelectedRootWs.length?this.enableAllWSelection(this.taggerView.getRootWs()):this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length?(this.taggerView._simplifiedSelectedRootWs.filter(function(e){if(e!=a){var i=e.replace("ds6w:","");t.getElement("#root-w-"+i).removeClassName("active")}}),this.taggerView._simplifiedSelectedRootWs=[a]):(i.removeClassName("active"),this.taggerView._simplifiedSelectedRootWs=this.taggerView._simplifiedSelectedRootWs.filter(function(e){return e!=a})):(i.addClassName("active"),this.taggerView._simplifiedSelectedRootWs.push(a)),this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length?this.container.addClassName("all-w-active"):this.container.removeClassName("all-w-active"),this.dispatchEvent("onRootWSelection",a.replace("ds6w:",""))},disableGradient:function(){this.container.addClassName("no-after"),this.container.addClassName("no-before")},enableGradient:function(){document.body.clientWidth>639&&document.body.clientWidth<1e3?(this.container.removeClassName("no-after"),this.container.removeClassName("no-before")):this.disableGradient()},addOpacity:function(){this.container.toggleClassName("add-opacity",!0)},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/TagWidget/TagsModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","UWA/Class/Collection"],function(e,t,i,a){"use strict";var n=t.extend(i,{defaults:{object:"",displayName:"",count:0,explicit:!1,icon:"",type:"",isGrouped:!1,isExcluded:!1,color:"",isSelected:!1,isPreciseCount:!1,isUnderCreation:!1,isDeletable:!1,expanded:!1,parent:void 0,hide:!1,isCommunityTag:!1,isOntologyTag:!1,updatedCount:0,isSwymCommunityInFocus:function(){}},setup:function(){this.set("childCollection",new a([],{model:n})),this.set("parentCollection",new a([],{model:n})),this._parent()},addToChildCollection:function(e){this.get("childCollection").add(e,{sort:!1})},addToParentCollection:function(e){this.get("parentCollection").add(e,{sort:!1})},updateParentCount:function(e){if(this.get("showCustomCountOnHierarchy")&&this.get("hasOwnCount"))return void this.set("count",this.get("hasOwnCount"));let t=e.get("updatedCount")>0?e.get("updatedCount"):e.get("count"),i=this.get("updatedCount");this.set("updatedCount",i+t),i=this.get("updatedCount"),this.set("count",i),this.updateAllParents(e)},updateAllParents:function(e){this.getParentModel()&&this.getParentModel().updateParentCount(e)},updateExpansionStatus:function(e){this.set("expanded",e)},updateColorization:function(e,t){if(this.set("isPartial",t),this.set("isColorized",e),!t){let t=this.getChildCollection();t&&t.forEach(t=>{t.updateColorization(e)})}},setExpandStatus:function(e){this.set("expanded",e)},getTagValue:function(){let e={uri:this.get("object"),displayName:this.get("displayName"),predicate:this.get("predicate"),type:this.get("tagType")};if(this.get("parent")){let t=this.getParentModel();e.parent={uri:t.get("object")}}return e},getRefineData:function(){return{object:this.get("object"),dispValue:this.get("displayName"),predicate:this.get("predicate"),type:this.get("type")}},getChildCollection:function(){let e=this.get("childCollection");return!(!e||!e.length)&&e},getParentModel:function(){let e=this.get("parentCollection");return!(!e||!e.length)&&e.first()}});return n}),define("DS/TagNavigator/simplified/model/OntologyConcept",["UWA/Core","UWA/Class/Debug","UWA/Class/Model","UWA/Class/Collection"],function(e,t,i,a){"use strict";var n=i.extend(t,{setup:function(e){this.set("narrower",new a([],{model:n})),this.set("broader",new a([],{model:n}));let t=e.id.split(":");t.length>0&&this.set("ontology",t[0]+":")},getLabel:function(){return this.get("label")},getURI:function(){return this.id},getOntology:function(){return this.get("ontology")},setAsRootWConcept:function(){this.set("isRootWConcept",!0)},setAsRootConcept:function(){this.set("isRootConcept",!0)},IsARootConcept:function(){return this.get("isRootConcept")},getURIPath:function(){let e=[],t=this;for(;t;)e.push(t.getURI()),t=t.getBroaderConcept();return e.reverse()},getRootConcept:function(){let e,t;for(;Array.isArray(e=this.getBroaderConcept())&&e.length>0;)t=e,e[0].getRootConcept();if(t)return t[0].getURI()},getRootW:function(){return this.get("rootW")},getBroaderConcepts:function(){return this.get("broader")},_addBroaderConcept:function(e){this.get("broader").add(e)},addNarrowerConcept:function(e){this.get("narrower").add(e),e._addBroaderConcept(this)},getNarrowerConcepts:function(){return this.get("narrower").toArray()},setAsTaggable:function(){this.set("taggable",!0)},canBeTagged:function(){return this.get("taggable")},setAsDeprecated:function(){this.set("deprecated",!0)},isDeprecated:function(){return this.get("deprecated")}});return n}),define("DS/TagNavigator/simplified/model/TagValueModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model"],function(e,t,i){"use strict";return i.extend(t,{defaults:{tagValue:void 0,title:void 0,count:void 0,iconClass:void 0,imageURL:void 0},setup:function(e){var t=e.tagValue;this.set("title",t.getDisplayValue()),this.set("count",e.proxy.getNbSubjectsForTagValue(t));var i=t.icon;i&&(i.match(/fonticon-*/)?this.set("iconClass",i):this.set("imageURL",i))},getPredicate:function(){return this.get("tagValue").pred},setIcon:function(e){let t=this.get("iconClass");this.set("oldIcon",t),this.set("iconClass",e)}})}),define("DS/TagNavigator/simplified/actions/ActionUtils",["UWA/Core"],function(e){"use strict";return{ACTION_SELECT:"select",ACTION_GROUP:"group",ACTION_EXCLUDE:"exclude",ACTION_EDITTAGREL:"editTagsSelect",ACTION_SELECTINAPP:"selectInApp",ACTION_ADDREMOVE_TAGS:"addRemoveTags",ACTION_ADDREMOVE_COMPANY_TAGS:"addRemoveCompanyTags",ACTION_COLORIZE:"colorize",getAvailableActions:function(){return[{id:this.ACTION_COLORIZE},{id:this.ACTION_EXCLUDE},{id:this.ACTION_GROUP},{id:this.ACTION_SELECTINAPP},{id:this.ACTION_SELECT},{id:this.ACTION_EDITTAGREL},{id:this.ACTION_ADDREMOVE_TAGS},{id:this.ACTION_ADDREMOVE_COMPANY_TAGS}]},onTagMultiSelection:function(e,t,i,a){if(-1!==e.id.indexOf("atv"))return!1;if(e.hasClassName("picked")&&!UWA.is(a,"boolean"))e.removeClassName("picked"),t.splice(t.indexOf(e.id),1);else{var n=e.getParent();if(e.getParents(".date").length){var s=n.getElement(".picked");s&&(s.removeClassName("picked"),t.splice(t.indexOf(s.id),1))}e.addClassName("picked");for(var o=0;o<t.length;++o)i&&t[o]&&t[o].object===i.object&&t[o].excluded&&!UWA.is(a)&&e.removeClassName("picked");UWA.is(a,"boolean")?a?(e.addClassName("excluded"),i.excluded=!0,t.push(i)):(e.removeClassName("excluded"),i.excluded=!1,t.push(i)):UWA.is(i,"object")?t.push(i):t.push(e.id)}return!1},getChildTag:function(e,t){var i=e.getChildren().filter(function(e){return e.hasClassName("childrenTags")})[0].getElement(".tags-list"),a=i.getChildren().filter(function(e){return e.hasClassName("treeTags")});if(a.length>0){var n=a.filter(function(e){return e.getElement(".tag").getElement(".tag-label").getText()===t});if(n&&n.length>0)return n[0]}return i.getChildren().filter(function(e){return e.hasClassName("tag")}).filter(function(e){return e.getElement(".tag-label").getText()==t})[0]}}}),define("DS/TagNavigator/simplified/actions/AbstractAction",["UWA/Core","UWA/Class/Model","UWA/Class/Debug"],function(e,t,i){"use strict";return t.extend(i,{defaults:{actionClass:"selected",selectionCount:0},setup:function(e){this._parent(e)},onPredicateSelection:function(e){},onTagSelection:function(e){},getSelectionCount:function(){return this._selection.reduce(function(e,t){return UWA.is(t,"object")&&t.doNotCount?e:++e},0)},getTaggerView:function(){var e=this.get("taggerView");if(e)return e()},getNavImpl:function(){return this.getTaggerView().getObservedNavigator()},getPredicateElement:function(e,t){var i=this.getTaggerView();return t?i.maximizeTaggerView.container.getElement(".tnw.predicate[predicate='"+e+"']"):i.container.getElement(".tags-container").getElement("li[predicate='"+e+"']")}})}),define("DS/TagNavigator/ColorManager",["UWA/Core"],function(e){"use strict";function t(){this.colors=["#FEE000","#009DDB","#FF8A2E","#9B2C98","#00AA86","#F564A3","#8DDEE4","#CC092F","#E2D5CC","#6FBC4B","#70036B","#002596","#C6C68B","#7F7F7F","#4EA8B7","#007A4C","#4D62BA","#127277","#6D2815","#000000","#ADADAD"],this.activePredicate=null,this.counter={},this.colorMap={},this.computedColorMap={},this.colorByTv={},this.shading={},this.forbiddenColors={},this.coloredTreeTagList=[],this.adminColorMap={},this.assignedColors={},this.unassignedColors={},this.computedPartialColorMap={},this.partialColorize={},this.inColorization=null,this.copyOfComputedMap={},this.copyOfPartialColorize={}}return t.prototype={isColorized:function(e){return this.activePredicate===e},toggleColorize:function(e){this.activePredicate=this.activePredicate===e?void 0:e,this.partialColorize&&!this.activePredicate&&(this.removeColorByTv(),this.partialColorize={},this.computedPartialColorMap={}),this.activePredicate||(this.assignedColors={})},colorizePredicate:function(e){this.activePredicate=e,this.partialColorize={},this.partialColorize[e]={},this.computedPartialColorMap[e].tagColors.forEach(t=>{this.partialColorize[e][t.object]=!0}),this._resetCounter(e),this.inColorization=void 0,this.copyOfComputedMap={},this.copyOfPartialColorize={}},_resetCounter:function(e){for(let t in this.counter)t!==e&&delete this.counter[t]},inColorizePredicate:function(e){this.inColorization=e},isInColorization:function(e){return this.inColorization==e},getInColorizePredicate:function(){return this.inColorization},getComputedMap:function(e){return this.computedPartialColorMap[e]?this.computedPartialColorMap[e]:this.computedColorMap[e]},clearComputedColorMap:function(e){if(!this.adminColorMap[e]&&(delete this.computedColorMap[e],delete this.counter[e],delete this.colorByTv[e],delete this.forbiddenColors[e],this.colorMap[e])){var t={};t[e]=this.colorMap[e],this.setColorMap(t)}},clearComputedPartialColorMap:function(e){this.computedPartialColorMap={}},_prioritizeColorsForPredicate:function(t,i){if(t){if(i){for(var a in this.adminColorMap=this.adminColorMap||{},t)t[a].length>0?this.adminColorMap[a]?delete t[a]:this.colorMap[a]&&(delete this.colorMap[a],delete this.counter[a],delete this.forbiddenColors[a]):delete t[a];this.adminColorMap=e.merge(this.adminColorMap,t)}else{for(var a in this.colorMap=this.colorMap||{},this.adminColorMap)t[a]&&delete t[a];this.colorMap=e.merge(t,this.colorMap)}var n,s,o;for(o in t)for(i||(delete this.counter[o],delete this.forbiddenColors[o]),delete this.colorByTv[o],this.computedColorMap[o]={},this.computedColorMap[o].tagColors=[],this.colorByTv[o]={},n=0;n<t[o].length;n++)(s=t[o][n]).predicate=o,this.computedColorMap[o].tagColors.push(s),this.colorByTv[o][s.object]=s.color,i||-1===this.colors.indexOf(s.color)||(this.forbiddenColors[o]=this.forbiddenColors[o]||[],this.forbiddenColors[o].push(this.colors.indexOf(s.color)))}},updateAdminColors:function(e){if(UWA.is(e,"array"))for(var t of e)this.setAdminColorMap(t)},setAdminColorMap:function(e){e&&this._prioritizeColorsForPredicate(e,!0)},setColorMap:function(e){e&&this._prioritizeColorsForPredicate(e,!1)},getColor:function(e,t){if(this.adminColorMap[t])e=this.colors.length-1;else{for(;this.forbiddenColors[t]&&-1!==this.forbiddenColors[t].indexOf(e);)e=this.counter[t]++;e=e<this.colors.length?e:this.colors.length-1}return this.colors[e]||null},getColorIndex:function(e){return this.counter[e]=this.counter[e]||0,this.counter[e]},getShading:function(e){return this.shading[e]=this.shading[e]||[],this.shading[e]},getCurrentColor:function(e){return this.getColor(this.getColorIndex(e),e)},getUnassignedColor:function(e){if(this.unassignedColors[e]&&this.unassignedColors[e].length)return this.unassignedColors[e][0];{let e=this.colors.length-1;return this.colors[e]||null}},_addToMap:function(e,t,i){var a,n,s;if(UWA.is(e.id,"function"))s=e.id(),a=JSON.parse(e.getSelectedTagId()),n=e.getPredicateView()._predicate.getFullPredicateID();else if(e.uri){let t=e;n=t.predicate||t.pred.getFullPredicateID(),s=t.uri,a={dispValue:t.displayName||t.getDisplayValue(),object:t.uri,predicate:n,type:t.type}}a.color=t;let o=i?this.computedPartialColorMap:this.computedColorMap;if(o[n]||(o[n]={},o[n].tagColors=[]),o[n].tagColors.length){let e=0;o[n].tagColors.forEach(t=>{t.object==a.object&&e++}),0==e&&o[n].tagColors.push(a)}else o[n].tagColors.push(a);this.colorByTv[n]||(this.colorByTv[n]={}),this.colorByTv[n][s]=t},_removeFromMap:function(e,t){var i,a;if(UWA.is(e.id,"function")?(a=e.id(),i=e.getPredicateView()._predicate.getFullPredicateID()):e.uri&&(a=e.uri,i=e.predicate||e.pred.getFullPredicateID()),this.computedPartialColorMap[i]){let e=this.computedPartialColorMap[i].tagColors;this.computedPartialColorMap[i].tagColors.forEach((i,a)=>{i.color==t&&e.splice(a,1)})}this._checkAlreadyDefinedColor(a,i)||delete this.colorByTv[i][a]},_addToTempTreeMap:function(e,t){var i,a,n;if(UWA.is(e.getSelectedTagId,"function"))i=JSON.parse(e.getSelectedTagId()),a=e.getPredicateView()._predicate.getFullPredicateID(),n=e.id();else{let t=e;i={predicate:a=t.predicate||t.pred.getFullPredicateID(),object:t.uri,dispValue:t.displayName||t.getDisplayValue(),type:t.type},n=t.uri}i.color=t,this.coloredTreeTagList.push(i),this.colorByTv[a][n]=t},_clearTempTreeMap:function(){this.coloredTreeTagList=[],this.shading={}},_checkDisplayValue:function(t,i){var a,n;if(UWA.is(t.getSelectedTagId,"function"))a=JSON.parse(t.getSelectedTagId()),n=t.getPredicateView()._predicate.getFullPredicateID();else{let e=t;a={predicate:n=e.predicate||e.pred.getFullPredicateID(),object:e.uri,dispValue:e.displayName||e.getDisplayValue(),type:e.type}}let s,o=-1,r=0;var{object:l,dispValue:c}=a;let d;if(e.is(l,"string")?d=((e,t)=>e===t.object):e.is(l,"array")&&(d=((e,t)=>-1!==e.indexOf(t.object))),this.computedColorMap.hasOwnProperty(n)&&i){let t=this;this.computedColorMap[n].tagColors.forEach((i,a)=>{if(e.is(l,"array")&&-1!==l.indexOf(i.object)||e.is(l,"string")&&l===i.object)if(t.computedPartialColorMap.hasOwnProperty(n)){let e=!1;t.computedPartialColorMap[n].tagColors.forEach((t,a)=>{t.object==i.object&&(e=!0)}),e||t.computedPartialColorMap[n].tagColors.push(i)}else t.computedPartialColorMap[n]={},t.computedPartialColorMap[n].tagColors=[],t.computedPartialColorMap[n].tagColors.push(i)})}if(this.computedColorMap[n]){for(var g of(s=this.computedColorMap[n]).tagColors){if(d&&d(l,g)){o=r;break}++r}-1==o||s.tagColors[o].dispValue||(s.tagColors[o].dispValue=c)}},resetColorForTagValue:function(e){var t,i,a;UWA.is(e.id,"function")?(a=e.id(),i=e.getPredicateView()._predicate.getFullPredicateID()):e.uri&&(a=e.uri,i=e.predicate||e.pred.getFullPredicateID()),t=this.colorByTv[i]?this.colorByTv[i][a]:null,this.computedPartialColorMap[i]||(this.computedPartialColorMap[i]=UWA.clone(this.computedColorMap[i])),this.partialColorize&&this.partialColorize[i]&&this.partialColorize[i][a]&&delete this.partialColorize[i][a];let n=this.computedPartialColorMap[i].tagColors;for(let e=0;e<n.length;e++)n[e].object==a&&n.splice(e,1);if(!this._checkAlreadyDefinedColor(a,i)){let e=this.assignedColors[i].findIndex(e=>e==t);e>=0&&(this.assignedColors[i].splice(e,1),this.unassignedColors[i].unshift(t))}return null===t&&void 0===t||this._removeFromMap(e,t),t},getNewColorForTagValue:function(t,i,a){var n,s,o,r,l=null;if(UWA.is(t.id,"function")?(s=t.id(),n=t.getPredicateView()._predicate.getFullPredicateID(),o=Object.getPrototypeOf(t.getMotherView())===Object.getPrototypeOf(t),r=t.type()):t.uri&&(s=t.uri,n=t.predicate||t.pred.getFullPredicateID(),o=t.parent,r=Array.isArray(t.uri)?"tree":t.type),!(!this.computedColorMap[n]||this.computedColorMap[n]&&this.computedPartialColorMap[n])||i||!this.partialColorize||!this.partialColorize[n]||this.partialColorize[n][s]){if(l=this.colorByTv[n]?this.colorByTv[n][s]:null)this._checkDisplayValue(t,i);else{o&&"tree"===r||i||(l=this.getCurrentColor(n)),this.assignedColors[n]||(this.unassignedColors[n]=e.clone(this.colors),this.assignedColors[n]=[]),i&&(a&&a.onCancel&&a.color?(l=a.color,--this.counter[n]):l=this.getUnassignedColor(n)),l&&(this._addToMap(t,l,i),(!a||a&&!a.onCancel)&&this.counter[n]++);let s=this.unassignedColors[n].findIndex(e=>e==l);this.unassignedColors[n].splice(s,1),this.assignedColors[n].push(l)}return i&&(this.partialColorize=this.partialColorize||{},this.partialColorize[n]=this.partialColorize[n]||{},this.partialColorize[n][s]||(this.partialColorize[n][s]=!0)),l}},resetColorForPersonTagValue:function(e){var t,i=e.pred.getFullPredicateID();t=this.colorByTv[i]?this.colorByTv[i][e.uri]:null,this.computedPartialColorMap[i]||(this.computedPartialColorMap[i]=UWA.clone(this.computedColorMap[i])),this.partialColorize&&this.partialColorize[i]&&this.partialColorize[i][e.uri]&&delete this.partialColorize[i][e.uri];let a=this.computedPartialColorMap[i].tagColors;for(let t=0;t<a.length;t++)a[t].object==e.uri&&a.splice(t,1);if(!this._checkAlreadyDefinedColor(e.uri,i,!0)){let e=this.assignedColors[i].findIndex(e=>e==t);e>=0&&(this.assignedColors[i].splice(e,1),this.unassignedColors[i].unshift(t))}return null===t&&void 0===t||this._removeFromMap(e,t),t},getColorForTagValue:function(t,i,a){var n,s,o=null;if(UWA.is(t.id,"function")?(n=t.id(),s=t.getPredicateView()._predicate.getFullPredicateID(),t.type()):t.uri&&(n=t.uri,s=t.predicate||t.pred.getFullPredicateID(),t.type),!(!this.computedColorMap[s]||this.computedColorMap[s]&&this.computedPartialColorMap[s])||i||!this.partialColorize||!this.partialColorize[s]||this.partialColorize[s][t.uri]){if(o=this.colorByTv[s]?this.colorByTv[s][n]:null){let e=n;if(this.computedColorMap.hasOwnProperty(s)&&i){let t=this;this.computedColorMap[s].tagColors.forEach((i,a)=>{if(e==i.object)if(t.computedPartialColorMap.hasOwnProperty(s)){let e=!1;t.computedPartialColorMap[s].tagColors.forEach((t,a)=>{t.object==i.object&&(e=!0)}),e||t.computedPartialColorMap[s].tagColors.push(i)}else t.computedPartialColorMap[s]={},t.computedPartialColorMap[s].tagColors=[],t.computedPartialColorMap[s].tagColors.push(i)})}}else{this.assignedColors[s]||(this.unassignedColors[s]=e.clone(this.colors),this.assignedColors[s]=[]),o=a&&a.onCancel&&a.color?a.color:this.getUnassignedColor(s);let n=this.unassignedColors[s].findIndex(e=>e==o);this.unassignedColors[s].splice(n,1),this.assignedColors[s].unshift(o),o&&(this._addToMap(t,o,i),this.counter[s]++)}return i&&(this.partialColorize=this.partialColorize||{},this.partialColorize[s]=this.partialColorize[s]||{},this.partialColorize[s][n]||(this.partialColorize[s][n]=!0)),o}},addToColoredTreeTagList:function(e){var i,a,n,s,o,r;if(UWA.is(e.id,"function")?(e.id(),n=e.getPredicateView()._predicate.getFullPredicateID(),s=Object.getPrototypeOf(e.getMotherView())===Object.getPrototypeOf(e),o=e.type()):e.uri&&(e.uri,n=e.predicate||e.pred.getFullPredicateID(),s=e.parent,o=Array.isArray(e.uri)?"tree":e.type),s&&"tree"===o){UWA.is(e.id,"function")?r=e.getMotherView().id():e.uri&&(r=e.parent.uri),i=this.colorByTv[n][r];var l=this.getShading(n);void 0===l[i]&&(l[i]=0),l[i]=l[i]+.2,l[i]>.8&&(l[i]=.8),i&&"#e2e4e3"!==(a=t.shadeColor(i,l[i]))&&this._addToTempTreeMap(e,a)}return a},getColoredTreeTagList:function(){return this.coloredTreeTagList},removeFromColoredTreeTagList:function(e){var t,i;if(UWA.is(e.id,"function")?(t=e.id(),e.getPredicateView()._predicate.getFullPredicateID(),Object.getPrototypeOf(e.getMotherView())===Object.getPrototypeOf(e),i=e.type()):e.uri&&(t=e.uri,e.predicate||e.pred.getFullPredicateID(),e.parent,i=Array.isArray(e.uri)?"tree":e.type),"tree"===i){let e;this.coloredTreeTagList.length&&(this.coloredTreeTagList.forEach((i,a)=>{i.object===t&&(e=a)}),delete this.coloredTreeTagList[e])}},_checkAlreadyDefinedColor:function(e,t){let i=!1;return this.adminColorMap[t]&&this.adminColorMap[t].forEach(t=>{t.object==e&&(i=!0)}),this.colorMap[t]&&this.colorMap[t].forEach(t=>{t.object==e&&(i=!0)}),i},checkForMapObject:function(e,t){let i=this;!this.computedPartialColorMap[e]&&this.computedColorMap[e]&&this.computedColorMap[e].tagColors.forEach(a=>{let n=t.uri?t.uri:t.id();a.object==n&&(i.computedPartialColorMap[e]={tagColors:[]},i.computedPartialColorMap[e].tagColors.push(a))})},copyInPartialMap:function(e){!this.copyOfComputedMap[e]&&this.computedPartialColorMap[e]?this.copyOfComputedMap[e]=UWA.clone(this.computedPartialColorMap[e]):!this.copyOfComputedMap[e]&&this.computedColorMap[e]&&(this.copyOfComputedMap[e]=UWA.clone(this.computedColorMap[e]))},copyOfPartialColorizeMap:function(e){if(this.colorByTv[e]&&!this.copyOfPartialColorize[e]){(this.computedPartialColorMap[e]?this.computedPartialColorMap[e]:this.computedColorMap[e]).tagColors.forEach(t=>{this.copyOfPartialColorize[e]||(this.copyOfPartialColorize[e]={}),this.copyOfPartialColorize[e][t.object]=!0})}},reassignComputedMap:function(){let e=this.copyOfComputedMap&&Object.keys(this.copyOfComputedMap)[0];if(e)return this.computedPartialColorMap[e]=UWA.clone(this.copyOfComputedMap[e]),this.computedColorMap[e]=UWA.clone(this.copyOfComputedMap[e]),this.copyOfPartialColorize[e]&&(this.partialColorize[e]=UWA.clone(this.copyOfPartialColorize[e])),this.copyOfPartialColorize={},this.copyOfComputedMap={},this.computedPartialColorMap[e].tagColors;this.computedPartialColorMap={},this.copyOfPartialColorize={},this.copyOfComputedMap={},this.assignedColors={},this.unassignedColors={}},removeColorByTv:function(){let e=this;for(let t in this.computedPartialColorMap)this.computedPartialColorMap[t].tagColors.forEach(i=>{e._checkAlreadyDefinedColor(i.object,t)||e.colorByTv[t]&&delete e.colorByTv[t][i.object]})},setColorByTV:function(e,t,i){this.colorByTv[e][t]=i}},t.shadeColor=function(e,t){var i=parseInt(e.slice(1),16),a=t<0?0:255,n=t<0?-1*t:t,s=i>>16,o=i>>8&255,r=255&i;return"#"+(16777216+65536*(Math.round((a-s)*n)+s)+256*(Math.round((a-o)*n)+o)+(Math.round((a-r)*n)+r)).toString(16).slice(1)},t}),define("DS/TagNavigator/Parameter",["UWA/Class/Model","UWA/Core"],function(e,t){"use strict";return e.extend({defaults:{value:"",type:"",interface:"",unit:"",boolVal:[],stringVal:"",intType:[]},setup:function(){this.set({stringVal:"",boolVal:[],intType:[]})}})}),define("DS/TagNavigator/simplified/activeTags/ActiveTagsViewModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug"],function(e,t,i){"use strict";return t.extend(i,{defaults:{mode:"readOnly",filter:{},emptyFilter:{}},setup:function(e){this._parent(e)}})}),define("DS/TagNavigator/simplified/model/PersonInfo",["UWA/Core","UWA/Class/Debug","UWA/Class/Model"],function(e,t,i){"use strict";return i.extend(t,{defaults:{title:"",imageURL:void 0,country:void 0,countryCode:void 0,city:void 0,color:"",nbMatches:void 0},idAttribute:"title",setup:function(){this.set({imageURL:[],country:[],countryCode:[],city:[],isReady:!1},{silent:!0})},setArrayProperty:function(e,t,i){var a=UWA.clone(this.get(e))||[];return i>-1?a.length>i&&(a[i]=t):a.push(t),this.set(e,a)},incrementNbMatches:function(){var e=this.get("nbMatches")||0;this.set("nbMatches",++e)}})}),define("DS/TagNavigator/simplified/model/FedSearchResultModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug"],function(e,t,i){"use strict";return t.extend(i,{setup:function(){this._parent()}})}),define("DS/TagNavigator/simplified/model/DateRangeModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model"],function(e,t,i){"use strict";return i.extend(t,{defaults:{id:"",title:"",count:0,iconClass:"fonticon fonticon-3ds-when",tagValues:[],object:[],from:void 0,to:void 0},getCount:function(){return this.get("count")}})}),define("DS/TagNavigator/Notification",["UWA/Class"],function(e){"use strict";return e.extend({type:"Notification",init:function(e,t){this.message=e,this.data=t}})}),define("DS/TagNavigator/BroadcastchannelSearchManager",["UWA/Class","UWA/Core","UWA/Class/Events","DS/TagNavigator/Logger"],function(e,t,i,a){"use strict";return e.extend(i,{init:function(){this.EmbeddedTaggerView=null,this._BroadcastChannel=null,this._parent()},setup:function(e){a.log("DS/TagNavigator/BroadcastchannelSearchManager setup: ",e),this.EmbeddedTaggerView=null,this.EmbeddedTaggerView=e&&e.EmbeddedTaggerView,this._BroadcastChannel&&this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=new BroadcastChannel(e.broadcastId),this._parent(e)},getBroadcastchannel:function(){return this._BroadcastChannel},postMessage:function(e,i){let n,s=this;if(t.is(s._BroadcastChannel)&&t.is(s.EmbeddedTaggerView)){if(t.is(i))n=i;else{n={type:"refresh_view",message:(new XMLSerializer).serializeToString(s.EmbeddedTaggerView.container)}}s._BroadcastChannel.postMessage(n),a.log("DS/TagNavigator/BroadcastchannelSearchManager postMessage from: "+e,n)}},listenBroadcast:function(){let e=this;t.is(e._BroadcastChannel)&&t.is(e.EmbeddedTaggerView)&&(e._BroadcastChannel.onmessage=(i=>{if(a.log("DS/TagNavigator/BroadcastchannelSearchManager onmessage: ",i.data),t.is(i)&&t.is(i.data)){const{type:a="",message:n="",item:s="",value:o="",viewid:r=""}=i.data;if("clickOnW"===a)e.EmbeddedTaggerView.onToggleGrouping({id:r});else if("clearRefine"===a)e.EmbeddedTaggerView.embeddedActiveCriteria&&e.EmbeddedTaggerView.embeddedActiveCriteria.clearRefine();else if("clickOnActivecriteria"===a){let i=n.option,a=n.name,s=n.id,o=e.EmbeddedTaggerView.embeddedActiveCriteria.advActiveTags;if(t.is(o)&&t.is(o._listOfActiveTag,"array")){let e,n=o._listOfActiveTag.length;for(let i=0;i<n;i++)e=o._listOfActiveTag[i],t.is(e)&&t.is(e.id)&&e.id===s&&(i=n);t.is(e)&&("remove"===a?(i=e.condition,e.dispatchEvent("removeActiveTag",{option:i})):"exclude"===a?(e.condition.condition?e.condition.condition.excluded=!0:e.condition.excluded=!0,i=e.condition,e.container.removeClassName("canBeExcluded"),"date"==e.condition.type&&(e.condition.display&&e.condition.displayValue||(i.tagInfo=e.condition.object)),e.dispatchEvent("excludeTag",{option:i})):"unexclude"===a&&(e.container.addClassName("canBeExcluded"),e.condition.condition?e.condition.condition.excluded=!1:e.condition.excluded=!1,i=e.condition,e.container.removeClassName("canBeExcluded"),"date"==e.condition.type&&(e.condition.display&&e.condition.displayValue||(i.tagInfo=e.condition.object)),e.dispatchEvent("excludeTag",{option:i})))}}else if("dropDownMenu"===a){let t=e.EmbeddedTaggerView.rootViews.length,i=0;for(;i<t;i++){let a=e.EmbeddedTaggerView.rootViews[i];if(a.rootw===r){let n=a.buildMenuItemsStructure();(a._hasSubMenus()||!a._hasSubMenus()&&a.menuItems.length>7)&&n.unshift({name:"search-field",id:"search-field"});let s=JSON.stringify(n);e._BroadcastChannel.postMessage({type:"dropDownMenu",viewid:r,message:s}),i=t}}}else if("onClickdropDownMenu"===a){let t=JSON.parse(s);t.className="";let i=e.EmbeddedTaggerView.rootViews.length,a=0;for(;a<i;a++){let n=e.EmbeddedTaggerView.rootViews[a];if(n.rootw===r){let e=[],s=function(t){e=e.concat(t),t.forEach((e,t)=>{e.getOption("subMenuItems")&&s(e.getOption("subMenuItems"))})};s(n.menuItems);let o=e.find(e=>e.getOption("identifier")==t.name);o&&o._toggleTagSelection(),a=i}}}else if("onsearchInputkeyup"===a){let t=e.EmbeddedTaggerView.rootViews.length,i=0;for(;i<t;i++){let a=e.EmbeddedTaggerView.rootViews[i];if(a.rootw===r){let n=[],s=a.getFilteredTagsItems(a.menuItems,o,n),l={type:"onsearchInputkeyupFilter",value:o,viewid:r,message:JSON.stringify(s)};e._BroadcastChannel.postMessage(l),i=t}}}}}))},destroy:function(){this.EmbeddedTaggerView=null,this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=null,this._parent()}})}),define("DS/TagNavigator/TaggerNLS",["DS/TagNavigator/Logger","i18n!DS/TagNavigator/assets/nls/TagNavigator"],function(e,t){"use strict";var i={},a=null,n=null;return i.getLang=function(){return a||"en"},i.setCurrentLanguage=function(t){return null===a&&(t?(e.info("TagNavigator - Setting language to "+t),a=t):(a="en",e.warn("TagNavigator - Language = "+t+" is not supported... Using default language (English)"))),a},i.getText=function(e){return t[e]?t[e].escapeHTML().replace(/'/g,"&#39;").replace(/&#x2F;/g,"/"):e},i.getFormattedText=function(e,i){if(t[e]){if(i){var a=t[e].escapeHTML().replace(/'/g,"&#39;").replace(/&#x2F;/g,"/");for(var n in i)a=a.replace("{"+n+"}",i[n]);return a}return t[e].escapeHTML().replace(/'/g,"&#39;").replace(/&#x2F;/g,"/")}return e},i.getNLSMonthArray=function(){return n||(n=[i.getText("january"),i.getText("february"),i.getText("march"),i.getText("april"),i.getText("may"),i.getText("june"),i.getText("july"),i.getText("august"),i.getText("september"),i.getText("october"),i.getText("november"),i.getText("december")]),n},i.convertToUnity=function(e,t){return t||this.preciseCount_global?e:e<1e3?e:e>999&&e<1e6?Math.floor(e/1e3)+"k":e>999999&&e<1e9?Math.floor(e/1e6)+"M":e>999999999?e.toString().substring(0,3)+"...":void 0},i}),define("DS/TagNavigator/simplified/views/PreferredContentView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","UWA/Class/Promise","DS/MessageBus/MessageBus"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"preferred-content",domEvents:{"click .rootw-arrow-container":"toggleRootWArea"},taggerView:null,_availability:void 0,_simplifiedRootViews:{},_simplifiedRootViewsPromises:{},_rootWViewContainers:{},init:function(e){this._availability=!1,this.taggerView=e.taggerView,this.taggerView.getRootWs().forEach(function(e){this._simplifiedRootViews[e]=void 0,this._simplifiedRootViewsPromises[e]=void 0}.bind(this)),this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._emptyView=!1,this._contentDiv=e.createElement("div",{id:"preferred-view-container"}).inject(this.container),this.taggerView.getRootWs().forEach(function(t){var a=t.split(":")[1];this._rootWViewContainers[t]=e.createElement("div",{id:"preferred-content-"+a,class:"root-container",html:{tag:"div",class:"item-circle",html:{tag:"span",class:"fonticon fonticon-3ds-"+a}}}).inject(this._contentDiv).hide(),e.createElement("div",{id:t,class:"rootw-expander",html:{tag:"div",class:"rootw-arrow-container",html:[{tag:"div",class:"arrow",html:[{class:"fonticon fonticon-chevron-down",tag:"span"},{class:"fonticon fonticon-chevron-right",tag:"span"}]},{tag:"div",class:"rootw-label",text:i.getText(a)}]}}).inject(this._rootWViewContainers[t])}.bind(this)),this},setAvailability:function(e){this._availability=e,this._availability||this._destroyViews()},isVisible:function(){return this._emptyView?this.hide():this.show(),this._emptyView},isAvailable:function(){return this._availability},redraw:function(e,t){if(!this._availability)throw new Error("THIS REDRAW IS NOT NEEDED !");var i=this;return new a(function(n){var s=t.length>1,o=void 0,r=[];i.taggerView.getRootWs().forEach(function(e){o=i._rootWViewContainers[e],s?o.addClassName("root-border"):o.removeClassName("root-border"),t.indexOf(e)>=0?r.push(i.getOrInitRootView(e)):o.hide()}),a.all(r).then(function(t){var s=[];t.forEach(function(t){t.activate(),s.push(t.redraw({onSearch:e.onSearch}))}),a.all(s).then(function(t){t.forEach(function(t){if(t.hideBorder){var a=i._rootWViewContainers[t.viewId].getElement("li.predicate").getAttribute("predicate");i.taggerView.getExpandStatus(a)?i._rootWViewContainers[t.viewId].removeClassName("hide-left-border"):i._rootWViewContainers[t.viewId].addClassName("hide-left-border")}t.isEmpty||t.hasNoResults?i._rootWViewContainers[t.viewId].hide():i._rootWViewContainers[t.viewId].show(),i.setExpandStatus(i._rootWViewContainers[t.viewId],t.viewId,e&&e.onSearch,e&&e.searchString)}),n()})})})},setExpandStatus:function(e,t,i,a){var n=this.taggerView.cacheForSimplified,s=e.getElement(".root-container-inner"),o=n.getExpandCollapseStatusRootW("preferred",t);if(s){var r=s.getElement("ul.predicates")?s.getElement("ul.predicates").getElements("li.predicate").length:0,l=s.getElement("ul.predicates")?s.getElement("ul.predicates").getElements("li.predicate.searchexcluded").length:0;if("ds6w:who"==t)if(1==s.getElement("ul.predicates").getElements("li.predicate").length)var c=s.getElement("ul.predicates").getElement("li.predicate").getAttribute("predicate");e.getElement(".rootw-arrow-container").show(),i&&a&&(r!=l||"person"==c)?(s.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"100%",visibility:"visible"}),e.removeClassName("hide-left-border"),e.getElement(".rootw-arrow-container").addClassName("expanded"),n.setExpandCollapseRootWStatus("preferred",t,!0)):o?(s.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"}),e.getElement(".rootw-arrow-container").addClassName("expanded"),e.removeClassName("hide-left-border")):(s.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}),e.addClassName("hide-left-border"),e.getElement(".rootw-arrow-container").removeClassName("expanded"))}},getRootView:function(e){return this._simplifiedRootViews[e]},isEmpty:function(){var e=[];for(var t in this._rootWViewContainers)this._rootWViewContainers[t].isHidden()&&e.push(t);return e.length==Object.keys(this._rootWViewContainers).length},onViewUpdate:function(e){this._availability?(e.isEmpty||e.hasNoResults?this._rootWViewContainers[e.viewId].hide():this._rootWViewContainers[e.viewId].show(),this.taggerView.onPreferredViewUpdate()):console.log("onViewUpdate event received, but section is not active, ignoring the event..")},getOrInitRootView:function(e){var t=this,i=this._simplifiedRootViewsPromises[e];return i||(i=new a(function(i){var a=t._simplifiedRootViews[e];if(a)i(a);else{var n;switch(e){case"ds6w:where":n="DS/TagNavigator/simplified/views/RootWhereView";break;case"ds6w:what":n="DS/TagNavigator/simplified/views/RootWhatView";break;case"ds6w:when":n="DS/TagNavigator/simplified/views/RootWhenView";break;case"ds6w:who":n="DS/TagNavigator/simplified/views/RootWhoView";break;case"ds6w:how":n="DS/TagNavigator/simplified/views/RootHowView";break;case"ds6w:why":n="DS/TagNavigator/simplified/views/RootWhyView"}require([n],function(n){!function(n){a=new n({taggerView:t.taggerView}).render(),t._simplifiedRootViews[e]=a,a.addEvent("onViewUpdate",t.onViewUpdate.bind(t)),a.inject(t._rootWViewContainers[e].getElement(".rootw-expander")),i(a)}(n)})}}),this._simplifiedRootViewsPromises[e]=i),i},_destroyViews:function(){for(var e in this._simplifiedRootViews){var t=this._simplifiedRootViews[e];t&&(t.destroy(),this._simplifiedRootViews[e]=t=null,this._simplifiedRootViewsPromises[e]=null)}},toggleRootWArea:function(t){var i,a,s,o,r,l=t.target.getClosest(".rootw-arrow-container"),c=l.getClosest(".rootw-expander").id,d=this.taggerView.cacheForSimplified,g=d.getExpandCollapseStatusRootW("preferred",c);if(l){l.toggleClassName("expanded");var h=l.getClosest(".root-border");for(g?h&&h.addClassName("hide-left-border"):h&&h.removeClassName("hide-left-border"),s=0,o=(i=l.getParent().getChildren()).length;s<o;++s)(a=e.extendElement(i[s])).match(".root-container-inner")&&(r=e.extendElement(a.getChildren()[0]),new e.Fx(a,{duration:300,transition:"quadInOut",events:{onComplete:function(){g?a.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}):a.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"100%",visibility:"visible"})},onStart:function(){a.setStyle("position","relative"),a.setStyle("overflow","hidden")}}}).start({height:g?[r.getSize().height,0]:[0,r.getSize().height]}));d.setExpandCollapseRootWStatus("preferred",c,!g),n.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickOnRootW-Preferred",persDim:{pd1:c,pd2:g?"collapsed":"expanded"}}})}},destroy:function(){for(var e in this._destroyViews(),this._rootWViewContainers){var t=this._rootWViewContainers[e];t&&(t.destroy(),t=null)}this._parent()}})}),define("DS/TagNavigator/userTags/advocacy/AdvocacyMenu",["UWA/Core","UWA/Class","UWA/Utils","DS/TagNavigator/TaggerNLS"],function(e,t,i,a){}),define("DS/TagNavigator/simplified/views/ShowResultsView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS"],function(e,t,i){"use strict";return t.extend({tagName:"div",className:"show-results-cont",domEvents:{click:"closeTagger"},render:function(){return e.createElement("div",{class:"show-results"}).inject(this.container),this},closeTagger:function(e){this.dispatchEvent("showResultClick")},destroy:function(){this._parent()}})}),define("DS/TagNavigator/PredError",["DS/TagNavigator/Notification","DS/TagNavigator/TaggerNLS"],function(e,t){"use strict";return e.extend({type:"PredError",init:function(e){this._parent(t.getText("predError")+t.getText("errorContactAdmin"),e)},mergeWidth:function(e){this.data=[this.data,e.data].join(", ")}})}),define("DS/TagNavigator/TaggerSettings",["UWA/Core","UWA/Class","UWA/Class/Options","DS/TagNavigator/Logger","text!DS/TagNavigator/assets/TaggerSettings.json","text!DS/TagNavigator/assets/TaggerSettings_Public.json"],function(e,t,i,a,n,s){"use strict";return t.singleton(i,{_authorized_json_settings:{authorized_beta_users:!0,controlledVocabularies:!0,editTagsPredicateOperators:!0,allowedMaximizeTaggerApps:!0},init:function(){var e,t;try{e=JSON.parse(n)}catch(e){console.error("text_TaggerSettings="+n),console.error("FAILED to parse TaggerSettings.json, message="+e.message)}UWA.is(e,"object")||(console.error("TaggerSettings.json is not in JSON object format !"),e={});try{t=JSON.parse(s)}catch(e){console.error("TaggerSettings_Public="+s),console.error("FAILED to parse TaggerSettings_Public.json, message="+e.message)}UWA.is(t,"object")||(console.error("TaggerSettings_Public.json is not in JSON object format !"),t={}),a.log("OOTB Settings = "+JSON.stringify(e)),a.log("publicSettings = "+JSON.stringify(t)),UWA.extend(e,t,!1),a.log("settings after merge = "+JSON.stringify(e)),this.setOptions(e)},urlSettings:function(e){if(UWA.is(e,"object"))for(var t in e){var i=e[t];if(UWA.is(i,"string"))if("false"==i.toLowerCase())i=!1;else if("true"==i.toLowerCase())i=!0;else if(this._authorized_json_settings[t]){var a=decodeURIComponent(i);try{i=JSON.parse(a)}catch(e){}}this.setOption(t,i)}},isAuthorizedBetaUser:function(e){var t=!1;if(e){var i=this.getOption("authorized_beta_users");UWA.is(i,"array")&&(t=-1!==i.indexOf(e.toUpperCase()))}return t},getAgentAsMobile:function(){return this.getOption("mobileUserAgent")},enableMobileTypeCode:function(){return this.getOption("enableMobileTypeCode")},isFromToDateAvailable:function(){return this.getOption("fromToDate")},searchOnType:function(){return this.getOption("searchOnUserType")},showDateTiles:function(){return this.getOption("showSelectedDates")}})}),define("DS/TagNavigator/TaggerUtils",["UWA/Core","UWA/Class","UWA/Promise","DS/TagNavigator/Logger","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/simplified/model/FedSearchResultModel","DS/TagNavigator/TaggerSettings","DS/WAFData/WAFData","DS/SNInfraUX/TaggerConfigAccess"],function(e,t,i,a,n,s,o,r,l){"use strict";var c=t.singleton({_user_granted_roles_promise:void 0,_service_url_promises:{},defaultUserImage:n.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png",USER_GROUP_SERVICE_ID:"usersgroup",communityInfoCache:{},_companyTagsConfigPromise:{},COMPANY_TAGS_ICON:{icon:"fonticon-building-office",isFontIcon:!0},COMMUNITY_TAGS_ICON:{icon:"fonticon-users-alt",isFontIcon:!0},_controlledVocabModePromise:{},getPlatformId:function(e){var t,i=e.getCStorages(),a=e.getTagsServers(),n={};if(a)for(t in a)n[a[t].getTenantName()]=t;else if(i)for(t in i)n[i[t].getTenantName()]=t;return!e.hasPlatformData()&&a&&Object.keys(n).length>1?this.selectedTenant=this.tenantDropdown.value:1===Object.keys(n).length&&(this.selectedTenant=n[Object.keys(n)[0]]),this.selectedTenant},checkForCommunityTags(e,t){let i=function(e){if(!e.source){let i=function(){let e;return t.eachTagValue(function(t){e=t&&t.uri?t.uri:null},{allTagsOfType:["ds6w:community"]}),e}();i&&(e.source="3DSwym",e.communityName=i)}return e.currentUser=t.getNavImpl().getUserInfo(),e};return 1===e.length?[i(e[0])]:e},_getCsrfTokenPromise:function(e){let t=this;return new Promise(function(i,a){let n={platformId:e,serviceId:"3DSwym"};c.getServiceURL(n).then(function(e){let n=e+"/api/index/tk",s={method:"GET",type:"json",onComplete:function(e){let a=e.result.ServerToken;UWA.is(a,"string")&&(t._csrfToken=a,i(t._csrfToken))},onFailure:function(e,t){a(e,t)}};r.authenticatedRequest(n,s)})})},getCommunityInfo:function(e){var t=this;if(e&&e.platformId&&e.communityId&&"string"==typeof e.platformId&&"string"==typeof e.communityId){let i="getCommunityInfo__"+e.communityId+"__"+e.platformId,n=this.communityInfoCache[i],s="3DSwym";return n||(this.communityInfoCache[i]=n=new Promise(function(i){c.getServiceURL({serviceId:s,platformId:e.platformId}).then(function(n){n?t._getCsrfTokenPromise(e.platformId).then(t=>{if(t){var s={method:"POST",headers:{"X-DS-SWYM-CSRFTOKEN":t,"content-type":"application/json;charset=UTF-8"},url:n+"/api/community/get",data:JSON.stringify({params:{id:e.communityId}}),onComplete:function(e){try{i(JSON.parse(e))}catch(e){i({})}},onFailure:function(e){a.error("Failed to fetch community details: ",e),i({})}};r.authenticatedRequest(s.url,s)}}):(a.log("FAILED to retrive 3Dswym service URL"),i({}))})})),n}},getGrantedRoles:function(){return UWA.is(this._user_granted_roles_promise)||(this._user_granted_roles_promise=new i(function(e){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(t){t.getGrantedRoles(function(t){a.info("i3DXCompassPlatformServices.getGrantedRoles returned roles info as:"+(t&&UWA.is(t,"array")?JSON.stringify(t):t)),e(t)})})})),this._user_granted_roles_promise},getServiceURL:function(e){if(UWA.is(e,"object")&&e.serviceId&&e.platformId){let t=e.serviceId+"__"+e.platformId,n=this._service_url_promises[t];return n||(this._service_url_promises[t]=n=new i(function(t){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(i){i.getServiceUrl({serviceName:e.serviceId,platformId:e.platformId,onComplete:function(i){a.log(e.serviceId+" url from i3DXCompassPlatformServices: "+i),t(i)},onFailure:function(){a.error("FAILED to retrieve "+e.serviceId+" url for tenant: "+e.platformId),t()}})})})),n}},buildFedSearchModel:function(e){var t=void 0;if(e&&UWA.is(e.attributes,"array")){var i={};e.attributes.forEach(function(e){i[e.name]=e.value}),t=new s(i)}return t},getDeviceAgent:function(){var e=navigator.userAgent,t=e.indexOf("iPad")>0,i=e.indexOf("iPhone")>0||e.indexOf("iPod")>0,a=e.indexOf("Android")>0,n=o.getAgentAsMobile();return t||i||a||n},getPredicateRangeValues:function(e){e&&e.platformId&&e.lang&&require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(t){var i={tenantId:e.platformId,lang:e.lang,onComplete:function(t){if(t)try{a.info("Vocabulary suggestions successfully retrieved from FedDictionaryAccess.getRangeValues, responseData="+JSON.stringify(t)),e.onComplete&&e.onComplete(e.platformId,e.predicates,t)}catch(e){a.info("FAILED to parse FedDictionaryAccess.getRangeValues response")}},onFailure:function(){if(a.info("Failed to retrieve Vocabulary suggestions from FedDictionaryAccess.getRangeValues(..)"),e.onComplete)return e.onComplete(e.platformId,e.predicates)}};t.getRangeValues(e.predicates,i)})},getUserTagsByDBCall:function(t){if(t&&t.platformId&&t.subject_uri)return new Promise(function(i,n){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(s){s.getServiceUrl({serviceName:"6WTags",platformId:t.platformId,onComplete:function(s){a.log("6WTags url from compass: "+s),function(a){let s={method:"GET",type:"text",timeout:1e4,headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(e){i(UWA.is(e,"object")?e:JSON.parse(e))},onFailure:function(){n("FAILED to retrieve user tags for "+t.subject_uri)},onTimeout:function(){n("TIMEOUT during retrieve user tags for "+t.subject_uri)}},o={SecurityContext:"preferred",tenant:t.platformId,subject:t.subject_uri};r.authenticatedRequest(a+"/resources/6w/tags?"+e.Utils.toQueryString(o),s)}(s)},onFailure:function(){a.error("FAILED to retrieve 6WTags url for tenant: "+t.platformId),onFailure("FAILED to retrieve 3DSearch url for tenant"+t.platformId)}})})})},getEnterpriseOntologyConfig:function(e){let t=this._companyTagsConfigPromise[e];return t||(this._companyTagsConfigPromise[e]=t=new Promise(function(t){let i={applicativeId:o.getOption("applicativeId")?[decodeURIComponent(o.getOption("applicativeId"))]:void 0,advocacyCommunityId:o.getOption("advocacyCommunityId"),ideationUserGroup:o.getOption("ideationUserGroup"),companyIcon:o.getOption("companyIcon")?JSON.parse(decodeURIComponent(o.getOption("companyIcon"))):void 0,companyTagPrefix:o.getOption("companyTagPrefix")};i.companyIcon&&!i.companyIcon.isFontIcon&&(i.companyIcon.icon=decodeURIComponent(i.companyIcon.icon)),i.companyTagPrefix&&(i.companyTagPrefix=decodeURIComponent(i.companyTagPrefix)),i.advocacyCommunityId&&(i.advocacyCommunityId=decodeURIComponent(i.advocacyCommunityId)),l.getEnterpriseOntology({tenantID:e}).then(function(e){if(UWA.is(e,"object")){a.log("TaggerConfigAccess.getEnterpriseOntology response"+JSON.stringify(e)),UWA.is(e.dataset,"array")&&e.dataset.length>0?i.applicativeId=i.applicativeId||[e.dataset[0].applicativeId]:a.error("TaggerConfigAccess.getEnterpriseOntology ontologyResponse.dataset is invalid"),i.advocacyCommunityId=i.advocacyCommunityId||e.advocacyCommunityId,i.ideationUserGroup=i.ideationUserGroup||e.expertUserGrp;let t=e.iconURL;if(UWA.is(t,"string")&&!i.companyIcon)if(t.match(/fonticon-*/))a.log("TaggerConfigAccess.getEnterpriseOntology ontologyResponse.iconInfo a fonticon"),i.companyIcon={icon:t,isFontIcon:!0};else try{new URL(t),i.companyIcon={icon:t,isFontIcon:!1}}catch(e){a.warn("TaggerConfigAccess.getEnterpriseOntology ontologyResponse.iconInfo is NOT a valid URL"),i.companyIcon=this.COMPANY_TAGS_ICON}i.companyIcon&&(c.COMPANY_TAGS_ICON=i.companyIcon),i.companyTagPrefix=i.companyTagPrefix||e.tagPrefix}else a.error("TaggerConfigAccess.getEnterpriseOntology response is not in good format");t(i)}.bind(this),function(){a.error("Error while calling TaggerConfigAccess.getEnterpriseOntology"),i.applicativeId=[i.applicativeId],t(i)})}.bind(this))),t},build3DSwymContentURL:function(e){return new Promise(function(t,i){e&&e.platformId&&e.contentId&&e.contentType&&c.getServiceURL({serviceId:"3DSwym",platformId:e.platformId}).then(function(n){if(n){let i={protocol:"3DXContent",version:"2.0",source:"X3DTAGS_AP",widgetId:"",data:{items:[{envId:e.platformId,objectId:e.contentId,serviceId:"3DSwym",objectType:e.contentType}]}},s=n+"/#content:X3DContentId="+encodeURIComponent(JSON.stringify(i));a.log("3DSwym content URL="+s),t(s)}else a.error("FAILED to build 3DSwym content URL"),i()})})},getControlledVocabularyMode:function(e){let t=e&&e.platformId;return this._controlledVocabModePromise[t]||(this._controlledVocabModePromise[t]=new Promise(function(e){let i={},n=l.getControlledVocabularyMode({tenantID:t});n?n.then(function(t){a.log(`Retrieving the SCC config for controlled vocabulary mode from Admin: ${JSON.stringify(t)}`),t&&(i.mode=t.controlledVocabMode||!1),e(i)}.bind(this),function(){a.log("No admin config for controlled vocab"),e(i)}.bind(this)):(a.log("No admin config for controlled vocab"),e(i))}.bind(this))),this._controlledVocabModePromise[t]},getCompanyTagIcon:function(){return c.COMPANY_TAGS_ICON},getCommunityTagIcon:function(){return"fonticon-users-alt"},getUserTagIcon:function(){return"fonticon-tag"},isTaggerTestPage:function(){if(window.location.pathname.includes("/TagNavigator.tst/TaggerTestPage")||1==o.getOption("6WTaggerTests"))return!0}});return c}),define("DS/TagNavigator/UserSettings",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","DS/i3DXCompass/Data","DS/i3DXCompass/EventManager","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,s,o,r,l){"use strict";var c=t.singleton({compassDataInitPromise:void 0,compassGetUserPromise:void 0,getPrefPromise:void 0,_userCategoryPromise:{},TAGGER_SETTINGS:"taggerSettings",isODTMode:!1,_companyTagsAuthorizationPromise:{},USER_GROUP_SERVICE_ID:"usersgroup",init:function(t){this.isODTMode=UWA.is(t,"string")&&-1!==t.indexOf("/VocabularyStub"),this.userSettings={},this.compassDataInitPromise=new i(function(e){s.addEvent("onInitialized",function(){e()})}),e.is(n,"object")&&!e.is(n.getPreferencesUrl,"string")&&e.is(window.COMPASS_CONFIG,"object")&&n.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,passportUrl:"",proxyTicketUrl:""})},getUserCategory:function(e){let t="getUserCategory__"+e,a=this,n=this._userCategoryPromise[t];return n||(n=this._userCategoryPromise[t]=new i(t=>{let n={category:"basic",showAdvocacyView:!1},s={platformId:e};try{l.getEnterpriseOntologyConfig(s.platformId).then(function(o){let r=[],l=-1,c=-1;o.advocacyCommunityId&&(l=r.length,s={platformId:e,communityId:o.advocacyCommunityId},r.push(a.getCommunityUserAccess(s))),o.ideationUserGroup&&(c=r.length,r.push(a.isUserAuthorizedForCompanyTags(e))),i.all(r).then(e=>{-1!=l&&(n.category=e[l],n.showAdvocacyView="advocate"===e[l]),-1!=c&&!0===e[c]&&(n.category="expert"),t(n)})})}catch(e){o.error(e),t(n)}})),n},getCommunityUserAccess:function(e){return new i(t=>{l.getCommunityInfo(e).then(e=>{let i="basic";try{e.result._acl.Dsi_Ideation_Ideation.insert.access&&(i="advocate")}catch(e){o.error("Failed to retrieve Community User Acccess")}t(i)})})},isUserAuthorizedForCompanyTags:function(e){let t=this._companyTagsAuthorizationPromise[e];return t||(this._companyTagsAuthorizationPromise[e]=t=new i(function(t){r.getOption("isUserGroupCheckNeeded")?l.getEnterpriseOntologyConfig(e).then(function(i){let n=i.ideationUserGroup;n?l.getServiceURL({serviceId:c.USER_GROUP_SERVICE_ID,platformId:e}).then(function(e){if(e){var i={method:"GET",headers:{"Content-Type":"application/json"},url:e+"/3drdfpersist/resources/v1/usersgroup?pattern="+n,onComplete:function(e){try{let i=JSON.parse(e);i&&Array.isArray(i.groups)&&(i.groups.length>0?(o.log("response from /3drdfpersist/resources/v1/usersgroup="+JSON.stringify(i)),t(!0)):(o.log("empty response from from /3drdfpersist/resources/v1/usersgroup"),t(!1)))}catch(e){o.log("FAILED to parse response from /3drdfpersist/resources/v1/usersgroup"),t(!1)}},onFailure:function(){o.log("FAILED isUserAuthorizedForCompanyTags"),t(!1)}};a.authenticatedRequest(i.url,i)}else o.log("FAILED to retrive usergroup service URL"),t(!1)}):t(!1)}.bind(this)):t(!0)}.bind(this))),t},getUserId:function(){var e=this;return new i(function(t){e.getUserInfo().then(function(e){t(e.id)})})},getUserInfo:function(){if(!this.compassGetUserPromise){var e=this;this.compassGetUserPromise=new i(function(t){var i={id:r.getOption("odtUser")||"odtuser",firstname:"Mr.",lastname:"Mogambo"};!0===r.getOption("offline6W")?(o.warn("UserSettings#getUserId: user id set to offline6W"),t("offline6W")):e.isODTMode?t(i):require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e){e.getUser({onComplete:function(e){o.log("i3DXCompassPlatformServices#getUser SUCCEEDED, "+e),t(e)},onFailure:function(){o.error("i3DXCompassPlatformServices#getUser FAILED"),t(i)}})})})}return this.compassGetUserPromise},retrieveTaggerPreferences:function(){if(!this.getPrefPromise){var t=this;this.getPrefPromise=new i(function(i){r.getOption("offline6W")?(o.warn("UserSettings#retrieveTaggerPreferences: Tagger running in offline mode; no preferences retrieved, forcing simplified mode."),t.userSettings={simplified:!0},i()):t.compassDataInitPromise.then(function(){e.is(n.getPreferencesUrl)||(o.error("INVALID CompassData.getPreferencesUrl, FAILED to retrieve Tagger Preferences"),i());var a=!1,s=r.getOption("simplifiedTagger"),l=r.getOption("legacy6W")||sessionStorage.getItem("legacy6W");if(s?r.getOption("WebInWin")||r.getOption("addinmode")?t.userSettings={simplified:!0}:a=!0:t.userSettings=l?{simplified:!1}:{simplified:!0},a){var c={url:n.getPreferencesUrl,urlParams:{name:"simplified"},onComplete:function(e){t.userSettings={},t.userSettings.simplified=UWA.is(e,"boolean")?e:"true"===e,t.isODTMode&&(t.userSettings.simplified=!0),i()},onFailure:function(e){o.error(UWA.is(e,"object")?JSON.stringify(e):"FAILED to retrieve Tagger Preferences"),t.userSettings={},t.userSettings.simplified=!1,i()}};n.request(c)}else i()})})}return this.getPrefPromise},getPreference:function(e){if(!this.userSettings)throw new Error("getPreference is attempted before the preferences retrieved");return this.userSettings[e]},setPreference:function(t){if(!this.userSettings)throw new Error("setPreference is attempted before the preferences retrieved");if(e.is(n.setPreferencesUrl)&&UWA.is(t.name,"string")&&UWA.is(t.value)){this.userSettings[t.name]=t.value;var i={name:t.name,value:t.value,onComplete:t.onComplete?t.onComplete:function(){o.log("Tagger settings successfully stored")},onFailure:t.onFailure?t.onFailure:function(){o.log("FAILED to store the Tagger settings")}};n.setPreference(i)}}});return c}),define("DS/TagNavigator/Predicate",["UWA/Core","DS/TagNavigator/Logger","UWA/Class/Promise","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerUtils","DS/TagNavigator/UserSettings"],function(e,t,i,a,n,s,o){"use strict";var r,l,c,d,g={},h={},u={},p=a.getOption("companyPredicate_Concepts_Mapping");function f(e){var t,i,a,n,s,o,h,u,m,v,T,C;e&&(t=e.sixw,i=e.displayName,s=e.options||{},a=e.type,n=e.server,o=e.markPendingForNls,h=e.isCompanyTagPredicate||!1,u=h&&e.isManual,m=h&&e.isAutomatic,v=e.isCommunityTagPredicate||!1,T="boolean"!=typeof e.displayStatus||e.displayStatus,C=e.icon);var w,b,y,S,I,E=[],x=null,_=a,A=void 0,N=!1,V=s,P=!0,D=void 0;if(void 0===(t?t.length:void 0)&&d(),0===t.length){if(l)return l;l=this}else{if("string"==typeof t&&(t=t.split("/").filter(function(e){return e.length>0})),b=t.slice(0,t.length-1),"string"==typeof(w=t[t.length-1])&&-1===w.indexOf("/")||d(w),-1!==b.indexOf(w)&&d(w),y=f.getPredicate(w)){if((I=y.getFullPredicateID().split("/")).join("/")===t.join("/"))return y;if("void"===I[0])y.set6WRootFather(t[0]);else{if("void"===t[0])return y;if(p[t])return y;d(w)}}(x=new f({sixw:b,type:a,server:n}))===l?!1===c.test(w)&&d(w):x.getFullPredicateID()+"/"+w!==t.join("/")&&d(w),x.addChild(this),y?y.setFather(x):g[w]=this,i&&w.split(":").pop()!==i?r[w]=i:f.addElementsToTranslate(w,n,o)}return this.addChild=function(e){return E.push(e),this},this.removeChild=function(e){var t=E.indexOf(e);return-1!==t&&E.splice(t,1),this},this.id=function(){return w},this.getType=function(){return _},this.setType=function(e){_="dateTime"===e?"date":e||"string"},this.getUnit=function(){return A},this.setUnit=function(e){UWA.is(e,"string")&&e.length>0&&(A=e)},this.setIsEnum=function(e){N=e},this.isEnum=function(){return N},this.setSuggestSupport=function(e){D=e},this.isSuggestSupported=function(){return D},this.isTypeValidBool=function(){return!0===P},this.setTypeValidBool=function(e){P=e},this.getElemOptions=function(){return V},this.setElemOptions=function(e){V=e},this.warnSelect=function(){return V&&V.onCriterionSelectEvent||!1},this.getFullPredicateID=function(e){var t;return"void"===(t=null!==x?x.getFullPredicateID():null)&&e&&(t=""),t&&0!==t.length?t+"/"+w:w},this.displayName=function(){return r[w]?r[w]:w},this.setDisplayName=function(e){return r[w]=e,e},this.countDescendants=function(){return E.length?E.length+E.map(function(e){return e.countDescendants()}).reduce(function(e,t){return e+t}):0},this.getChildren=function(e){var t,i,a;for(e||(e=function(){return!0}),a=[],S=0,i=E.length;S<i;S++)e((t=E[S]).id())&&a.push(t);return a},this.getFather=function(){return x},this.setFather=function(e){"void"===this.get6WRootFather().getFullPredicateID()&&(x=e)},this.get6WRootFather=function(){var e=this;if(this===l)return null;for(;!e.is6WRoot();)e=e.getFather();return e},this.isAKindOf=function(e){return!this.is6WRoot()&&this.get6WRootFather().id()===e},this.set6WRootFather=function(e){var t,i,a;if((t=f.getPredicate(e))&&t.is6WRoot()&&"void"===this.get6WRootFather().getFullPredicateID()){for(i=this,a=this;!i.is6WRoot();)i!==this&&(a=a.getFather()),i=i.getFather();i.removeChild(a),t.addChild(a)}},this.is6WRoot=function(){return x===l},this.isGod=function(){return this===l},this.isCompanyPredicate=function(){return!!h&&(u?{isManual:u}:{isAutomatic:m})},this.isManualCompanyPredicate=function(){return u},this.isAutoCompanyPredicate=function(){return m},this.isCommunityPredicate=function(){return v},this.getDisplayStatus=function(){return T},this.setDisplayStatus=function(e){T=e},this.getIcon=function(){return C},this.setIcon=function(e){C=e},this}d=function(e){throw t.error("Fail to create a predicate with invalid arg. Id is :'"+e+"'"),new Error("Invalid input arg")},r={"ds6w:who":"Who","ds6w:when":"When","ds6w:what":"What","ds6w:where":"Where","ds6w:why":"Why","ds6w:how":"How"},f.getElementsNLS=function(){if(!0===a.getOption("offline6W"))return t.warn("Predicate: Offline mode: No NLS translation is to be done."),h={},u={},[];if(0!==Object.keys(h).length){var e,n,s="";for(var o in e=function(e,i){if(e.vocabularyElementNLSInfo){var a,n,s,o,l,c;if((o=e.vocabularyElementNLSInfo).length&&o[0])for(n=0,s=o.length;n<s;n++)if((a=o[n]).uri&&a.nlsName){r[a.uri]=a.nlsName;var d=f.getPredicate(a.uri);l="dateTime"===a.dataType?"date":a.dataType,d&&a.dataType&&(c=d.getType())&&l!==c&&(t.warn("WARNING: predicate type inconsistant with the dictionary for:"+a.uri),t.warn("predDataType="+c+", dictionaryDataType="+l)),d&&l&&d.setType(l)}i("ElementsNLS OK")}else u={},i("ElementsNLS FAILED");return u={},!0},h){for(var l in s=[],h[o].map)s.push(l);s=s.join(","),n=new i(function(t){h[o].server.getElementsNLS(s,e,t)}),u[o]=n}h={}}var c=[];for(var o in u)c.push(u[o]);return c},f.getElementsToTranslate=function(){return h},f.getPendingPromisesForElementsToTranslate=function(){return u};var m=[];f.addElementsToTranslate=function(t,i,a){if(void 0===r[t])if(i){m.push(t);var n={};m.forEach(function(e){n[e]=!0,r[e]=null});var s=i.getTenantName();h[s]||(h[s]={}),h[s].server=h[s].server||i,h[s].map=e.merge(h[s].map?h[s].map:{},n),m=[]}else a&&m.push(t)},c=new RegExp("^(ds6w:who|ds6w:when|ds6w:what|ds6w:where|ds6w:why|ds6w:how|void)$"),l=null,f.getRoots=function(e){return e||(e=function(){return!0}),l?l.getChildren(e):[]},f.getClassDispValue=function(e){return r[e]||null},f.getPredicate=function(e){return g[e]},f.count=function(){return l?l.countDescendants():0},f.ROOT_WHO="ds6w:who",f.COMMUNITY_TAGS="communityTags",f.COMMUNITY_TAGS_V2="CommunityTag",f.COMMUNITY_TAGS_PREDICATES={},f.COMPANY_TAG="CompanyTag",f.COMPANY_TAGS_PREDICATES={},f.COMPANY_TAG_AUTO="CompanyTagAuto",f.AUTO_COMPANY_TAGS_PREDICATES={};var v=!1;return f.ensureDefaultPredicates=function(){if(v)return;v=!0;let e,t,i,o=a.getOption("simplifiedRootW"),r=n.getText("communityTags");o.forEach(function(t){f.COMMUNITY_TAGS_PREDICATES[t]=e=new f({sixw:t+"/swym:"+t.replace("ds6w:","")+f.COMMUNITY_TAGS_V2,type:"string",icon:s.COMMUNITY_TAGS_ICON,isCommunityTagPredicate:!0}),e.setDisplayName(r)}),r=n.getText("companyTagsManual"),o.forEach(function(e){f.COMPANY_TAGS_PREDICATES[e]=t=new f({sixw:e+"/"+e+f.COMPANY_TAG,type:"string",isCompanyTagPredicate:!0,isManual:!0,displayStatus:!1,icon:s.COMPANY_TAGS_ICON}),t.setDisplayName(r)}),r=n.getText("companyTags"),o.forEach(function(e){f.AUTO_COMPANY_TAGS_PREDICATES[e]=i=new f({sixw:e+"/"+e+f.COMPANY_TAG_AUTO,type:"string",isCompanyTagPredicate:!0,isAutomatic:!0,displayStatus:!0,icon:s.COMPANY_TAGS_ICON}),i.setDisplayName(r)})},f.getCommunityTagPredicate=function(e){return f.ensureDefaultPredicates(),f.COMMUNITY_TAGS_PREDICATES[e]},f.getCompanyTagPredicate=function(e){return f.ensureDefaultPredicates(),f.COMPANY_TAGS_PREDICATES[e]},f.getAutoCompanyTagPredicate=function(e){return f.ensureDefaultPredicates(),f.AUTO_COMPANY_TAGS_PREDICATES[e]},f.updateCompanyTagPredicatesData=function(e){return new i(function(t){f.ensureDefaultPredicates(),s.getEnterpriseOntologyConfig(e).then(function(i){i&&o.isUserAuthorizedForCompanyTags(e).then(function(e){let s=i.companyTagPrefix,o=i.companyIcon;a.getOption("simplifiedRootW").forEach(function(t){let a=f.getCompanyTagPredicate(t);a&&(a.setDisplayStatus(e&&i.applicativeId&&i.applicativeId[0]),s&&(r[a.id()]=n.getText("companyTagsManualCustom").format(s)),o&&a.setIcon(o));let l=f.getAutoCompanyTagPredicate(t);l&&(s&&(r[l.id()]=n.getText("companyTagsCustom").format(s)),o&&l.setIcon(o))}),t()})})})},f.updateRootWPredicates=function(e){},f}),define("DS/TagNavigator/AdvancedSearchCriteria",["UWA/Core","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerSettings"],function(e,t,i,a){"use strict";return function(){var i={},n={};function s(i,a){var n=0,s=e.createElement();if(a||s.grab(e.createElement("li",{class:"predicate expanded selected ds6w_",html:{tag:"div",class:"predicate-header",html:{tag:"div",class:"predicate-label",text:i.title}}})),"string"===i.type||"boolean"===i.type)s.grab(e.createElement("li",{class:"parameter selected tag",title:i.value[0],html:{tag:"div",class:"parameter tag-label",id:i.cid,html:[{text:i.value[0]},{tag:"span",class:a?"tag-del fonticon fonticon-cancel":""}]}}));else for(n=0;n<i.value.length;n++)s.grab(e.createElement("li",{class:"param-range-label",text:t.getText("paramIntType"+i.value[n].rangeVal)})),!isNaN(i.value[n].fromVal)&&isFinite(i.value[n].fromVal)&&null!=i.value[n].fromVal&&s.grab(e.createElement("li",{class:"parameter selected tag",title:i.value[n].fromVal,html:{tag:"div",id:i.cid,class:"tag-label from",rangeVal:i.value[n].rangeVal,fromto:"from",text:t.getText("from")+":"+i.value[n].fromVal}})),!isNaN(i.value[n].toVal)&&isFinite(i.value[n].toVal)&&null!=i.value[n].toVal&&s.grab(e.createElement("li",{class:"parameter selected tag",title:i.value[n].toVal,html:{tag:"div",id:i.cid,class:"tag-label to",rangeVal:i.value[n].rangeVal,fromto:"to",text:t.getText("from")+":"+i.value[n].toVal}}));return s.getHTML()}function o(e){e=e.split("/");var t=n[e.join("/")]||e[e.length-1].split(":")[1],i='<li class="predicate expanded selected" id="atv'+c(e.join("/"))+'">';return i+='<div class="predicate-header" title="'+t+'"><div class="predicate-label">',i+='<span class="fonticon fonticon-search"></span>'+t+"</div></div></li>"}function r(i,n,s,o){var r,l=0,c=e.createElement();let d;if(o){let e=o.split("/"),t=e[0].contains("ds6w:")?e[0].contains("sixw:")?e[0].replace("sixw:",""):e[0]:"";d=a.getOption("simplifiedRootW").includes(t)?t.replace("ds6w:",""):""}for(l=0;l<i.length;l++)r=e.createElement("li",{class:"tag selected",id:i[l].tagId+"atv",html:[{tag:"div",class:"tag-label",html:[{tag:"span",class:n?"root-icon fonticon "+(d?"fonticon-3ds-"+d:"fonticon-search"):""},{class:"title",text:i[l].isARange?i[l].text.replace(/(from|to)/,function(e,i){return t.getText(i)}):i[l].text}]},{tag:"span",class:n?"tag-del fonticon fonticon-cancel":""}]}),n||r.setAttributes({title:i[l].isARange?i[l].text.replace(/(from:\s|to:\s)/,""):i[l].text}),n&&r.setAttributes({"context-id":s,"proxy-name":"searchCriteria","predicate-name":o.split("/").pop()}),c.grab(r);return c.getHTML()}function l(e,t){if(e&&"string"==typeof e)return!(0===e.length||t&&t instanceof RegExp&&!t.test(e));if(e instanceof Array){for(var i=0;i<e.length;i++)if(!e[i]||"string"!=typeof e[i]||0===e[i].length||t&&t instanceof RegExp&&!t.test(e[i]))return!1;return!0}return!1}function c(e){var t,a,n;if(t=0,0!==e.length)for(a=0,n=e.length;a<n;a++)t=(t<<5)-t+e[a].charCodeAt(0),t&=t;return i[t="id_"+t]=e,t}function d(e,t){return c(JSON.stringify({predicate:t,object:e.object,dispValue:e.displayValue,type:e.type,isSimplifiedCriteria:e.isSimplifiedCriteria}))}this.setActiveCriteria=function(e,i){var a,s,o,r,c={},g=i.isSimplified;if(c={localfilters:{search:{},plmparam:{}}},!l([i.widgetId,i.proxyId]))return c;if(e.search)for(a in e.search){s=e.search[a],c.localfilters.search[a]=[];for(var h=0;h<s.length;h++)if(s[h].object.from||s[h].object.to){var u=s[h].object;if(g){var p={type:s[h].type,object:u};if(s[h].isSimplifiedCriteria)p.isSimplifiedCriteria=!0,c.localfilters.search[a].push({text:s[h].displayValue,tagId:d(p,a)});else if(u.from&&!u.to||u.to&&!u.from){var f=u.from?"from":"to";c.localfilters.search[a].push({text:t.getText(f)+": "+s[h].object[f],tagId:d(p,a)})}else u.from&&u.to&&c.localfilters.search[a].push({text:u.from+" - "+u.to,tagId:d(p,a)})}else c.localfilters.search[a]=Object.keys(s[h].object).map(function(e){if(s[h].object[e]){var t={type:s[h].type||"date",displayValue:e+": "+s[h].object[e],object:{}};return t.object[e]=s[h].object[e],{text:t.displayValue,tagId:d(t,a),isARange:!0}}}).filter(function(e){return void 0!==e})}else c.localfilters.search[a]=s.map(function(e){return{text:e.displayValue,tagId:d(e,a)}})}if(e.plmparam)for(h=0;h<e.plmparam.length;h++)c.localfilters.plmparam=e.plmparam.map(function(e){return o=e.get("type"),r="string"===o?[e.get("stringVal")]:"boolean"===o?e.get("boolVal").length>0?["1"===e.get("boolVal")[0]?t.getText("yes"):t.getText("no")]:[]:e.get("intType").map(function(e){return{fromVal:e.fromVal,toVal:e.toVal,rangeVal:e.rangeVal}}).filter(function(e){return!isNaN(e.fromVal)&&isFinite(e.fromVal)&&null!==e.fromVal||!isNaN(e.toVal)&&isFinite(e.toVal)&&null!==e.toVal}),{title:e.get("value"),type:o,cid:e.cid,value:r}}).filter(function(e){return e.value.length>0&&""!==e.value[0]});return i.predicatesNLS&&(n=i.predicatesNLS),c},this.criteriaToHTML=function(e,t){var i,a,n,c,d=[];if(!e)return"";if(d.push(l([t.widgetId,t.proxyId])&&t.widgetId in e&&t.proxyId in e[t.widgetId]&&e[t.widgetId][t.proxyId].localfilters&&e[t.widgetId][t.proxyId].localfilters.search&&function(e){if(0===Object.keys(e).length)return!1;for(var t in e)if(e[t].length>0)return!0;return!1}(e[t.widgetId][t.proxyId].localfilters.search)),d.push(l([t.widgetId,t.proxyId])&&t.widgetId in e&&t.proxyId in e[t.widgetId]&&e[t.widgetId][t.proxyId].localfilters&&e[t.widgetId][t.proxyId].localfilters.plmparam&&e[t.widgetId][t.proxyId].localfilters.plmparam.length>0),!d[0]&&!d[1])return"";if(i='<div id="searchCriteria-_-'+t.contextId+'" class="appCriteria">',d[0]){for(a in t.isSimplified&&(i+="<ul class=active-predicate-list>"),e[t.widgetId][t.proxyId].localfilters.search)(n=e[t.widgetId][t.proxyId].localfilters.search[a]).length>0&&(t.isSimplified||(i+="<ul class=active-predicate-list>"),i+=t.isSimplified?r(n,t.isSimplified,t.contextId,a):o(a)+r(n,t.isSimplified),t.isSimplified||(i+="</ul>"));t.isSimplified&&(i+="</ul>")}if(d[1])for(c=0;c<e[t.widgetId][t.proxyId].localfilters.plmparam.length;c++)i+="<ul class=freeinput-predicate-list>",i+=s(e[t.widgetId][t.proxyId].localfilters.plmparam[c]),i+="</ul>";return i+="</div>"},this.getCriterionFromDOMId=function(e){var t,a;return t=e.replace("atv",""),i.hasOwnProperty(t)?(a=i[t],JSON.parse(a)):void 0}}}),define("DS/TagNavigator/simplified/views/EmptyView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS"],function(e,t,i){"use strict";return t.extend({tagName:"div",className:"no-tags",render:function(){return this.container.setText(i.getText("noTags")),this},setMessageText:function(e){this.container.empty(),this.container.setText(e)},setNoTagsContent:function(t){this.container.empty(),this.noTagsDiv=e.createElement("div",{class:"noTags"}).inject(this.container);e.createElement("span",{class:"noTags-icon fonticon fonticon-tag"}).inject(this.noTagsDiv),e.createElement("div",{class:"no-result",text:i.getText("noRslt").replace(/&#x27;/g,"'")}).inject(this.noTagsDiv),e.createElement("div",{class:"noTags-mesg",text:i.getText("noResultMessage").replace(/&#x27;/g,"'")}).inject(this.noTagsDiv)},isVisible:function(){return!this.container.isHidden()},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/AllContentView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/views/EmptyView","DS/Controls/Expander","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s){"use strict";return t.extend({tagName:"div",className:"all-content",_emptyView:void 0,_rootWViewContainers:{},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},domEvents:{"click .rootw-arrow-container":"toggleAllRootWArea"},render:function(){this._emptyView=(new a).render(),this._contentDiv=e.createElement("div",{id:"all-tags"});var t=e.createElement("div",{class:"wrapper"});return this._emptyView.inject(t),this._contentDiv.inject(t),this.taggerView=this.getOption("taggerView"),this.taggerView.getRootWs().forEach(function(t){var a=t.split(":")[1];this._rootWViewContainers[t]=e.createElement("div",{id:"all-content-"+a,class:"all-content-w",html:{tag:"div",class:"item-circle",html:{tag:"span",class:"fonticon fonticon-3ds-"+a}}}).inject(this._contentDiv),e.createElement("div",{id:t,class:"rootw-expander",html:[{tag:"div",class:"rootw-arrow-container",html:[{tag:"div",class:"arrow",html:[{class:"fonticon fonticon-chevron-down",tag:"span"},{class:"fonticon fonticon-chevron-right",tag:"span"}]},{tag:"div",class:"rootw-label",text:i.getText(a)}]},{tag:"div",class:"content"}]}).inject(this._rootWViewContainers[t])}.bind(this)),this.allTagsExp=new n({domId:"tn-all-tags",header:i.getText("allContentDiv"),body:t,style:"simple",touchMode:!0,expandedFlag:!1}).inject(this.container),this},expand:function(e){var t=!!this.taggerView.observedNavImpl.getFocusedProxy()&&this.taggerView.observedNavImpl.getFocusedProxy().showAllBool;this.allTagsExp.expandedFlag=t||e},collapse:function(e){var t=!!this.taggerView.observedNavImpl.getFocusedProxy()&&this.taggerView.observedNavImpl.getFocusedProxy().showAllBool;this.allTagsExp.expandedFlag=!e&&!!t},isEmpty(){return this._emptyView.isVisible()},showHideHeader:function(e){e?this.container.removeClassName("hide-header"):this.container.addClassName("hide-header")},getAllViewStatus:function(){return{toShow:this.allTagsExp.expandedFlag,headerVisible:!this.container.hasClassName("hide-header")}},redraw:function(t,a){this._emptyView&&this._emptyView.hide();var n="",s=void 0;if(t.excludePreferred){var o=this.taggerView.hasFocusedProxy();o?(s=o.hasRelevantPredicates(),e.is(s,"array")&&0==s.length&&(s=void 0),s||(s=[]),s=s.concat(o.getHiddenPredicates())):(s=this.taggerView.observedNavImpl.hasPreferredPredicates())&&(s=s.concat(this.taggerView.observedNavImpl.hasHiddenPredicates()||[]))}for(var r in this._rootWViewContainers){if(a.includes(r)){r.replace("ds6w:",""),n=this.taggerView.availableTagsToHtml(r,void 0,void 0,!0,s);this._rootWViewContainers[r].getElement(".rootw-expander .content").setHTML(n),this._rootWViewContainers[r].show()}else this._rootWViewContainers[r].hide();this.setExpandStatus(this._rootWViewContainers[r],r,t&&t.onSearch,t&&t.searchString)}a.length<=1?this._contentDiv.removeClassName("root-border"):this._contentDiv.addClassName("root-border");var l=a.map(function(e){return function(e){var t={isEmpty:!1},i=e.getElements(".predicate:not(.searchexcluded)");if(i.length>0)i.forEach(function(e){e.show()});else{var a=e.getElements(".predicate.searchexcluded").length,n=e.getElements(".predicate").length;0===n?(t.isEmpty=!0,t.hasNoResults=!0):a==n&&0!=n&&(t.hasNoResults=!0)}return(t.isEmpty||t.hasNoResults)&&e.hide(),t}(this._rootWViewContainers[e])}.bind(this)),c=l.every(function(e){return e.isEmpty}),d=l.every(function(e){return e.hasNoResults});(c||d)&&(this._emptyView.show(),c?this._emptyView.setMessageText(i.getText("noTags")):this._emptyView.setMessageText(i.getText("noRslt")))},setExpandStatus:function(e,t,i,a){var n=this.taggerView.cacheForSimplified,s=n.getExpandCollapseStatusRootW("all",t);if(e.getElement("ul.predicates")){var o=e.getElement("ul.predicates")?e.getElement("ul.predicates").getElements("li.predicate").length:0,r=e.getElement("ul.predicates")?e.getElement("ul.predicates").getElements("li.predicate.searchexcluded").length:0;if(o>=1)e.getElement(".rootw-arrow-container").show(),i&&a&&o!=r?(e.getElement(".content").setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"}),e.removeClassName("hide-left-border"),e.getElement(".rootw-arrow-container").addClassName("expanded"),n.setExpandCollapseRootWStatus("all",t,!0)):s?(e.getElement(".content").setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"}),e.getElement(".rootw-arrow-container").addClassName("expanded"),e.removeClassName("hide-left-border")):(e.getElement(".content").setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}),e.addClassName("hide-left-border"),e.getElement(".rootw-arrow-container").removeClassName("expanded"));else{if(1==e.getElements("li.predicate").length){var l=e.getElement("li.predicate").getAttribute("predicate");this.taggerView.getExpandStatus(l)?e.removeClassName("hide-left-border"):e.addClassName("hide-left-border")}e.getElement(".content").setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"})}}},toggleAllRootWArea:function(t){var i,a,n,o,r,l=t.target.getClosest(".rootw-arrow-container"),c=l.getClosest(".rootw-expander").id,d=this.taggerView.cacheForSimplified,g=d.getExpandCollapseStatusRootW("all",c);if(l){l.toggleClassName("expanded");var h=l.getClosest(".all-content-w");for(g?h&&h.addClassName("hide-left-border"):h&&h.removeClassName("hide-left-border"),n=0,o=(i=l.getParent().getChildren()).length;n<o;++n)(a=e.extendElement(i[n])).match(".content")&&(r=e.extendElement(a.getChildren()[0]),new e.Fx(a,{duration:300,transition:"quadInOut",events:{onComplete:function(){g?a.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}):a.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"})},onStart:function(){a.setStyle("position","relative"),a.setStyle("overflow","hidden")}}}).start({height:g?[r.getSize().height,0]:[0,r.getSize().height]}));d.setExpandCollapseRootWStatus("all",c,!g)}s.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickOnRootW-All",persDim:{pd1:c,pd2:g?"collapsed":"expanded"}}})},destroy:function(){this._parent()}})}),define("DS/TagNavigator/TagsServer",["UWA/Core","DS/WAFData/WAFData","UWA/Utils","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,s,o,r,l){"use strict";var c,d,g={};c="/resources/6w",d="/resources/6WVocab/access";var h=0,u=0;function p(g,f,m){var v,T,C,w,b,y,S,I,E,x,_=this;g=i.composeUrl(i.parseUrl(g)),v=f&&"string"==typeof f?{tenant:f}:{},T=m&&"string"==typeof m&&m.length>0?m||"":null;try{S=p.validateBaseUrl(g),y="file:"===(window?window.location.protocol:null),!1,i.matchUrl(window.location,g)||"passport"}catch(e){throw e}E=function(t){return t=t||{},e.Utils.toQueryString(e.merge(e.merge({},t),v))},w=function(){var e;return e={type:"text",timeout:15e3,headers:{Accept:"application/json","Content-Type":"application/json"}},"firefox"===i.Client.Engine.name&&(e.timestamp=Date.now()),e},C=function(){return{tenantId:_.getTenantName(),lang:s.getLang()}},I=function(e,i){if(y)return setTimeout(i.onComplete,1e3),this;try{t.authenticatedRequest(e,i)}catch(e){i.onFailure(e)}return this},b=function(e,t){var i;if("boolean"==typeof t&&(t=!1),!e||""===e)return!t;try{i=JSON.parse(e)}catch(e){return!1}return!i.error},x=function(e){return e.map(function(e){return e.uri}).join("")},this.getElementsNLS=function(e,t,i){if(-1!==(g=_.getUrlPart("baseUrl")).indexOf("/VocabularyStub")){var a,n;(a=w()).onComplete=function(e){return b(e)?(r.info("Elements NLS successfully retrieved from '"+g+"'"),t&&e?t(JSON.parse(e),i):void t({},i)):a.onFailure(e)},a.onFailure=a.onTimeout=function(e){r.info("Failed to retrieve Elements NLS from '"+g+"'"),t({},i)},a.headers["Accept-Language"]=s.getLang(),a.method="POST",a.data=e,a.headers["Content-Type"]="text/uri-list",n=g+d+"/ElementsNLSNames?"+E({});var l=o.getOption("scenario");n=UWA.is(l,"string")?g+d+"/ElementsNLSNames/"+ ++h+"/response":g+d+"/ElementsNLSNames",a.method="GET",I(n,a)}else require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(a){var n;(n=C()).onComplete=function(e){if(r.info("Elements NLS successfully retrieved from RDF API FedDictionaryAccess.getResourcesInfo(..)"),r.log("FedDictionaryAccess.getResourcesInfo(..)===>responseData=",JSON.stringify(e)),t&&e)return t(e,i);t({},i)},n.onFailure=function(e){if(r.info("Failed to retrieve Elements NLS from from RDF API FedDictionaryAccess.getResourcesInfo(..)"),UWA.is(e,"object")&&UWA.is(e.vocabularyElementNLSInfo,"array")&&t)return t(e,i);t({},i)},r.log("TagsServer.getElementsNLS, param =",e),a.getResourcesInfo(e,n)});return _},this.getTenantName=function(){return f},this.getTenantDisplayName=function(){return T||this.getTenantName()},this.getUrlPart=function(e){return S[e]||null},this.putTag=function(e,t,i,l,d){if(-1!==g.indexOf("/VocabularyStub")&&o.getOption("testUserTags")){(f=w()).onComplete=function(e){if(p&&r.info("Tag {"+[x(p.subject),p.predicate,p.object.literal].join("/")+"} successfully created '"+g+"'"),i)return i("DSDEV007",e,{request:"create"})},f.onFailure=f.onTimeOut=function(e){if(l)return l(p?p.subject:e,{request:"create"})};let t=[];for(let i of e.tag[0].subject){let a=[];for(let t of e.tag)t.predicate&&t.object.literal?a.push({predicate:t.predicate,object:{literal:t.object.literal,literalType:"xsd:string"},id:"51B6CACE4E0946F4B306205B4ECB1"+Math.floor(1e3*Math.random()+1)}):f.onFailure();a.length&&t.push({subject:{uri:i.uri},results:1,tag:a})}let a='{"results":"'+t.length+'","success":true,"data":'+JSON.stringify(t)+"}";return console.log(a),f.onComplete(a),this}var h,u=!UWA.is(d,"boolean")||d,p=u?e.tag[0]:void 0,f=w(),m=this;return g=this.getUrlPart("baseUrl"),f.onComplete=function(e){return b(e)?(p&&r.info("Tag {"+[x(p.subject),p.predicate,p.object.literal].join("/")+"} successfully created on server '"+g+"'"),i?i(m.getTenantName(),e,{request:"create"}):void 0):f.onFailure(e)},f.onFailure=f.onTimeOut=function(e,t){if(p&&r.error("Failed to create tag {"+[x(p.subject),p.predicate,p.object.literal].join("/")+"} on server '"+g+"'. Reason is '"+(e?e.message:void 0)+"'"),u&&(a.push(new n(s.getText("tagCreationFail").format(p.object.literal)+s.getText("errorContactAdmin"))),a.dispatch()),l)return l(p?p.subject:e,{request:"create"},t)},f.method="PUT",f.data=JSON.stringify(e),h=g+c+"/tags?"+E({SecurityContext:"preferred"}),I(h,f),this},this.deleteTag=function(e,t,i,o,l){var d,h=!UWA.is(l,"boolean")||l,u=w(),p=h?e.tag[0]:void 0;return g=this.getUrlPart("baseUrl"),u.onComplete=function(t){return b(t)?(p&&r.info("Tag {"+[x(p.subject),p.predicate,p.object.literal].join("/")+"} successfully deleted on server '"+g+"'"),h&&(a.push(new n(s.getText("tagDeletionSuccess"),{className:"success"})),a.dispatch()),i?i(p?p.subject:t,e,{request:"delete"}):void 0):u.onFailure(t)},u.onFailure=function(e){if(p&&r.error("Failed to delete tag {"+[x(p.subject),p.predicate,p.object.literal].join("/")+"} on server '"+g+"'. Reason is '"+(e?e.message:void 0)+"'"),h&&(a.push(new n(s.getText("tagDeletionFail").format(p.object.literal)+s.getText("errorContactAdmin"))),a.dispatch()),o)return o(p?p.subject:e,{request:"delete"})},u.method="DELETE",u.data=JSON.stringify(e),d=g+c+"/tags?"+E(t?{SecurityContext:"preferred"}:{}),I(d,u),this},this.getPredicateValue=function(e,t,i){if(-1!==(g=this.getUrlPart("baseUrl")).indexOf("/VocabularyStubCustom")){var a,n=w();n.onComplete=function(e){if(r.info("Success retrieving PredicateValue in ODT"),t)return t(JSON.parse(e),i)},n.headers["Accept-Language"]=s.getLang(),n.method="GET";var l=o.getOption("scenario");return UWA.is(l,"string")&&(a=g+d+"/PredicateValue/"+ ++u+"/response"),void I(a,n)}return-1!==this.getUrlPart("baseUrl").indexOf("/VocabularyStub")?t({},i):(require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(a){var n=C();n.onComplete=function(e){if(r.info("Success retrieving PredicateValue"),t)return t(UWA.is(e,"string")?JSON.parse(e):e,i)},n.onFailure=function(e){return i()},a.getNlsOfPropertiesValues(JSON.stringify(e),n)}),this)},this.getExplicitTag=function(e,t,i){var a,n=w();return g=this.getUrlPart("baseUrl"),n.onComplete=function(e){return b(e,!0)?(r.info("Tags successfully retrieved from server of tenant:'"+f+"'"),t?t(e,v.tenant,i):void 0):n.onFailure(e)},n.onFailure=function(e){return r.info("Failed to get explicit tags from server of tenant:'"+f+"'. Reason is '"+(e?e.message:void 0)+"'"),t(null,null,i)},n.method="POST",a=g+c+"/tags?"+E({}),n.data=JSON.stringify(e),I(a,n),this},this.getVocabularySuggestions=function(e,t,i){if(r.log("Inside TagsServer.getVocabularySuggestions for predicate "+t),-1!==this.getUrlPart("baseUrl").indexOf("/VocabularyStub")){var a=w();return a.onComplete=function(a){if(r.info("Success retrieving PredicateValue in ODT"),i)return i(e,t,"string"==typeof a?JSON.parse(a):a)},a.headers["Accept-Language"]=s.getLang(),a.method="GET",t=UWA.is(t,"array")?t.join("_").replaceAll("ds6w:",""):t.replace("ds6w:",""),void I(g+d+"/PredicateRangeValues_"+t+"?uri="+t+"&tenant="+e,a)}return l.getPredicateRangeValues({platformId:e,predicates:t,lang:s.getLang(),onComplete:i}),this},this.getUsersInfo=function(i,a,n,s){var l;if(UWA.is(a,"array")&&(l=a.length)>0){var c=this.getTenantName(),d=[];r.log("Inside TagsServer.getUsersInfo, getting the users information for tenant: "+c+", number of users: "+l),require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(l){var g=function(a,n,s){return new Promise(function(o,r){var l={label:"6WTagger-"+i+"-"+(new Date).getTime(),query:'[ds6w:type]:("pno:Person")',with_nls:!1,with_synthesis:!1,with_indexing_date:!1,select_file:["thumbnail_2d"],source:["swym"],select_predicate:["ds6w:label","ds6w:country","ds6w:city"],tenant:c,nresults:2*s<=500?2*s:500,start:0};l.specific_source_parameter={swym:{additional_query:" AND personOrGroup:("+n+") AND ut_state:1",agoraMode:!0}};var d={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:e.Json.encode(l),url:a+"/search",onComplete:function(e){o(JSON.parse(e).results)},onFailure:function(e){o(e)}};t.authenticatedRequest(d.url,d)})};l.getServiceUrl({serviceName:"3DSearch",platformId:c,onComplete:function(e){r.log("fed search url from compass: "+e);var t=o.getOption("FS_QUERY_LENGTH_LIMIT"),i="",s=!0,l=0;a.forEach(function(a){a&&(a=a.replace(/"/g,'\\"')),l++,s?(i='("'+a+'")',s=!1):i+=' BOR ("'+a+'")',i.length>=t&&(r.log("FS_QUERY_LENGTH_LIMIT reached, launching the query"),d.push(g(e,i,l)),i="",s=!0,l=0)}),d.push(g(e,i,l)),n(d)},onFailure:function(){r.error("FAILED to retrieve 3DSearch url for tenant: "+c),s("FAILED to retrieve 3DSearch url for tenant"+c)}})})}}}return p.validateBaseUrl=function(e){var t=i.parseUrl(e);return t.baseUrl=t.protocol+"://"+t.authority+t.path,t},p.isAlreadyInTagsServerList=function(e){return g[e]},p.setInTagsServerList=function(e){g[e]=!0},p}),define("DS/TagNavigator/simplified/utils/OntologyUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient","DS/TagNavigator/simplified/model/OntologyConcept","DS/TagNavigator/TaggerUtils","DS/TagNavigator/UserSettings"],function(e,t,i,a,n,s,o,r,l,c,d){"use strict";var g=t.singleton({init:function(){let e={},t=s.getOption("rootWConcepts"),h=s.getOption("concepts_rootW_Mapping"),u=new a([],{model:l}),p={},f=new Map,m=new Map,v=!s.getOption("disableOntologyModelCahe");this.getEnterpriseOntologyTreeModel=function(e,t){let i=p[e];return i||(i=p[e]={}),i[t]},this.setEnterpriseOntologyTreeModel=function(e,t,i){v&&(this.getEnterpriseOntologyTreeModel(e,t)||(p[e][t]=i))},this.getEnterpriseOntologyConcepts=function(e){return new i(function(t){c.getEnterpriseOntologyConfig(e.tenant).then(function(i){g.getOntologyConceptsFromApplicativeId({tenant:e.tenant,applicativeId:i.applicativeId&&Array.isArray(i.applicativeId)?i.applicativeId[0]:void 0}).then(function(e){t(e)})})})},this.getEnterpriseOntologySuggestions=function(e){return new i(function(t){d.isUserAuthorizedForCompanyTags(e.tenant).then(function(i){let a=[];i?g.getEnterpriseOntologyConcepts(e).then(function(){u.filter(function(e){if(e.IsARootConcept())return!0}).forEach(function(e){var t={isEnterpriseOntologySuggestion:!0};t.sixw=e.getBroaderConcepts().at(0).getRootW(),t.object=e.id,t.label=e.getLabel(),t.isDeprecated=e.isDeprecated(),a.push(t)}),t({id:e.id,suggestions:a})}):t({id:e.id,suggestions:a})})})},this.hasConcepts=function(){return u.length>0},this.getConcept=function(e){return u.get(e)},this.isConceptAvailable=function(e){if("string"==typeof e&&e)return m.has(e.toLowerCase())};let T=function(e,t){let i;(i=t||new l({id:e.shortURI,uri:e.uri})).set("label",e.label);let a=e.types;return Array.isArray(a)||(a=[]),i.set("types",a),-1!==a.indexOf("owl:DeprecatedClass")&&(o.warn("Concept '"+i.id+"' is deprecated"),i.setAsDeprecated()),f.set(e.label,!0),m.set(e.label.toLowerCase(),!0),i},C=function(e,t){let i=t?e:u.get(e.shortURI);if(t||-1!==i.get("types").indexOf("ds6wclassifier:Tag")){i.setAsTaggable();const e=i.getNarrowerConcepts();e&&e.length&&e.forEach(e=>{C(e,!0)})}},w=function(e,i,a){try{i=UWA.is(i,"string")?JSON.parse(i):i,o.log(`Concepts info from applicativeId ${e} = ${JSON.stringify(i)}`);let a=performance.now();i.forEach(function(e){!function(e){let i=u.get(e.shortURI);if(i?i=T(e,i):(i=T(e),u.add(i)),UWA.is(e.broader,"array")){let a=e.broader[0].shortURI;1==e.broader.length&&"ds6wclassifier:Root"===a?(i.setAsRootWConcept(),i.set("rootW",h[i.id.toLowerCase()])):e.broader.forEach(function(e){a=e.shortURI;let n=u.get(a);n||(n=T(e),u.add(n)),n.addNarrowerConcept(i),-1!=t.indexOf(n.id.toLowerCase())&&i.setAsRootConcept()})}}(e)}),a=performance.now()-a,o.log("perfo_updateConceptCollection",a);let n=performance.now();i.forEach(function(e){C(e)}),n=performance.now()-n,o.log("perfo_setChildrenHierarchyAsTaggable",n)}catch(e){o.log("FAILED to parse /3drdfpersist/resources/v1/ontologies/ response")}return i};this.retrieveConcepts=function(e,t){var i={method:"GET",headers:{Accept:"application/json"},url:e.url+"/3drdfklet/resources/v2/ontologies/concepts?recurse=all&applicativeId="+e.applicativeId,onComplete:function(i){t(w(e.applicativeId,i))},onFailure:function(){o.log(`FAILED to retrieve concents in applicativeId=${e.applicativeId}`),t([])}};n.authenticatedRequest(i.url,i)},this.getOntologyConceptsFromApplicativeId=function(t){var a=e[t.tenant+"_"+t.applicativeId];return a||(o.log("Creating a new promise to retrive concepts for applicativeId="+t.applicativeId+", and tenant="+t.tenant),a=new i(function(e){let i=s.getOption("conceptsInfo");if(i)e(w(t.applicativeId,i));else{let i=function(t){t&&o.log(t),e([])};c.getServiceURL({serviceId:"3dregistry",platformId:t.tenant}).then(function(a){a?(o.log("3dregistry URL from TaggerUtils.getServiceURL="+a),r.getServicesByPlatform({platforms:[t.tenant],services:["ontology"],config:{url:a}}).then(function(a){o.log("i3DXCompassRegistryClient.getServicesByPlatform returns: "+JSON.stringify(a)),Array.isArray(a)&&a.length>0&&Array.isArray(a[0].services)&&a[0].services.length>0&&a[0].services[0].url?(t.url=a[0].services[0].url,g.retrieveConcepts(t,e)):(e([]),i("FAILED to retrieve ontology service URL from i3DXCompassRegistryClient.getServicesByPlatform"))},function(){i("FAILED to retrieve ontology service URL from i3DXCompassRegistryClient.getServicesByPlatform")})):i("FAILED to retrieve 3dregistry service URL from TaggerUtils.getServiceURL")})}}),e[t.tenant+"_"+t.applicativeId]=a),a}}});return g.init()}),define("DS/TagNavigator/TagValue",["UWA/Core","UWA/Class/Promise","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/simplified/utils/OntologyUtils"],function(e,t,i,a,n,s,o,r,l){"use strict";var c=/\w+:\w+\.\w+/,d={},g={},h={},u={};function p(e){if(e.isOntologyTag)return e._hasUpdatedDisplayValue?e.displayValue:u[e.ontologyURI];var t=h[e.embeddedPred?e.embeddedPred.id():e.pred.id()];return t?t[e.originalDisplayValue?e.originalDisplayValue:e.displayValue]:void 0}function f(e,t,i){if(this.pred=e,this.count=t.count||0,this.type=t.type,this.uri=t.uri,this.isComposite=t.isComposite,this.explicit="boolean"==typeof t.explicit?t.explicit:this.pred.is6WRoot(),this.displayValue=t.displayValue,this.icon=t.icon,this.embeddedPred=void 0,this.embeddedTags=void 0,this.explicit||(this.explicit=this.pred.isManualCompanyPredicate()||this.pred.isCommunityPredicate()),t.hasDisplayValue)this.explicit&&f._treatStandardUserTags.call(this,i?i.getTenantName():void 0);else if(this.explicit)f._treatStandardUserTags.call(this,i?i.getTenantName():void 0);else{var a="ds6w:type"===this.pred.id(),n=c.test(this.displayValue);if(a||n&&!this.explicit){let e=p(this);if(!e&&i){var s=f.getPredicateNlsValueMap(i,this.pred.id());n?(this.originalDisplayValue=this.displayValue.substr(this.displayValue.indexOf(".")+1,this.displayValue.length),s[this.originalDisplayValue]=!0):a&&(s[this.displayValue]=!0)}else this.displayValue=e||this.displayName}}this.parent=t.parent,this.fullid=t.fullid}f.prototype={incrementCount:function(e){},decrementCount:function(e){},getUri:function(){return this.uri},getDisplayValue:function(){return p(this)||i.getClassDispValue(this.displayValue)||this.displayValue},getCount:function(){return this.count},isExplicit:function(){return this.isExplicit},getParent:function(){return this.parent},toString:function(){return this.fullid},setEmbeddedSixW:function(e){this.embeddedPred=e,f.tagvalues[this.fullid]=this,this.parent&&this.parent.setEmbeddedSixW(e)},setEmbeddedTagValues:function(e){this.embeddedTags=e,f.tagvalues[this.fullid]=this,this.parent&&this.parent.addEmbeddedTagValues(e)},addEmbeddedTagValues:function(e){this.embeddedTags||(this.embeddedTags=[]),this.embeddedTags=this.embeddedTags.concat(e),f.tagvalues[this.fullid]=this},clearEmbeddedTagValues:function(){this.embeddedTags=void 0}},f.tagvalues={},f.getTagValue=function(e,t,n,l,c,d,g,h){var u,p,m,v,T,C;m={},!g&&("object"!=typeof e||Array.isArray(e)||e instanceof i)?(m.uri=n,m.displayValue=t,m.explicit=c,m.type=l?l.split("-")[0]:l,p=e):(v=e,m.uri=v.object,m.displayValue=v.dispValue,m.explicit=v.explicit,m.type=v.type?v.type.split("-")[0]:v.type,m.icon=v.icon,p=v.sixw||v.predicate);let w="string"==typeof m.uri,b=Array.isArray(m.uri);if(m.type&&m.type.startsWith("xsd:")&&(m.type=m.type.substr(4,m.type.length)),!(p instanceof i)&&("string"==typeof p||Array.isArray(p))){var y={sixw:p,type:m.type,server:d};try{p=new i(y)}catch(e){o.push(new r("Fail to create a predicate with invalid arg. Id is :'"+y.sixw+"'")),o.dispatch()}}p instanceof i&&(w||b)&&0!==m.uri.length||function(){throw s.error("Fail to create a tagvalue with unvalid arg"),new Error("Invalid input arg")}(),"string"!==m.type&&"integer"!==m.type&&"float"!==m.type&&"double"!==m.type&&"date"!==m.type&&"tree"!==m.type&&"boolean"!==m.type&&"daterange"!==m.type&&(m.type="string"),p.isCompanyPredicate()&&w&&(m.uri=m.uri.split(f.BELCHAR),m.field="explicit",m.explicit=!0,b=Array.isArray(m.uri)),m.hasDisplayValue="string"==typeof m.displayValue&&m.displayValue.length>0||Array.isArray(m.displayValue)&&b&&m.displayValue.length===m.uri.length,m.hasDisplayValue||(m.displayValue=m.uri);var S=m.fullid=p.getFullPredicateID()+m.type+m.uri+typeof m.uri;if(u=f.tagvalues[S],b&&h&&(u=h.get(S)),!u){let e="date"===m.type;if(e&&(2!==(T=m.uri.split("/")).length||isNaN(T[1])||(m.displayValue=T[0]+"/"+a.getNLSMonthArray()[parseInt(T[1],10)-1])),("tree"===m.type||b||e)&&(e?(T=m.uri.split("/"),C=m.displayValue.split("/")):(b?T=m.uri.slice(0):"tree"===m.type&&(T=m.uri.split("/")),C=Array.isArray(m.displayValue)?m.displayValue.slice(0):"tree"===m.type?m.displayValue.split("/"):[m.displayValue]),m.displayValue=C[C.length-1],T.length>1))if(T.splice(T.length-1,1),C.splice(C.length-1,1),b){let e=!0;1==T.length&&-1!=T[0].indexOf(f.SIXW_ROOT_ONTOLOGY)&&(e=!1),e&&(m.parent=f.getTagValue(p,C,T,m.type,m.explicit,d,void 0,h))}else m.parent=f.getTagValue(p,C.join("/"),T.join("/"),m.type,null,d,void 0,h);u=new f(p,m,d)}return u},f.removeAll=function(){f.tagvalues={}},f.createTypeCategory=function(e){var t=f.getTagValue(e);f.tagvalues[t.fullid]=t},f.count=function(){return Object.keys(f.tagvalues).length},f.getTagValueNls=function(e,t){var i=h[e];if(i)return i[t]},f.getPredicateNlsValueMap=function(e,t){var i=e.getTenantName(),a=d[i];a||(a={server:e,toTranslate:{}},d[i]=a);var n=a.toTranslate[t];return n||(n={},a.toTranslate[t]=n),n},f.getOntologyNlsValueMap=function(e){var t=g[e];return t||(t={toTranslate:{}},g[e]=t),t.toTranslate},f.getTvToTranslate=function(){return d},f.getOntologyTvToTranslate=function(){return g},f.translateOntologyTagValues=function(){if(!0===n.getOption("offline6W"))return s.warn("TagValue: No ontology tag value to be translated."),g={},[];var e=[];for(var a in g){let n=new t(function(e,t){let n=g[a].toTranslate;l.getEnterpriseOntologyConcepts({tenant:a}).then(function(){for(let e in n){let t=l.getConcept(e);t?u[e]=t.getLabel():s.warn("FAILED to translate "+e)}i.updateCompanyTagPredicatesData(a).then(function(){e()})})});e.push(n)}return g={},e},f.getPredicateValue=function(){if(!0===n.getOption("offline6W"))return s.warn("TagValue: No tag value to be translated."),d={},[];var e=function(e,t){var i,a;for(i in e)for(a in e[i])h[i]||(h[i]={}),h[i][a]||(h[i][a]=e[i][a]);t("PredicateValue OK")},i=[];for(var a in d){var o={};for(var r in d[a].toTranslate)o[r]=Object.keys(d[a].toTranslate[r]);var l=new t(function(t,i){d[a].server.getPredicateValue(o,e,t)});i.push(l)}return d={},i};var m=function(e,t){this.ontologyURI=e[e.length-1];for(let i=1;i<e.length;i++){let a=e[i];if(!u[a]){let e=l.getConcept(a);if(e)u[a]=e.getLabel();else if(t){f.getOntologyNlsValueMap(t)[a]=!0}}}this.displayValue=u[this.ontologyURI]||this.ontologyURI,this.isOntologyTag=!0};return f._treatStandardUserTags=function(e){if("string"==typeof this.uri&&0==this.uri.indexOf(f.SIXW_ROOT_ONTOLOGY)){let t=this.uri.split(f.BELCHAR);2==t.length&&0==t[1].indexOf(f.COMMUNITY_TAG)?(this.isCommunityTag=!0,this.displayValue=t[1].split(f.COMMUNITY_TAG)[1],this.pred.is6WRoot()&&(this.isCommunityTagV1=!0)):m.call(this,this.uri.split(f.BELCHAR),e)}else Array.isArray(this.uri)&&this.uri.length>1&&0==this.uri[0].indexOf(f.SIXW_ROOT_ONTOLOGY)&&(2==this.uri.length&&0==this.uri[1].indexOf(f.COMMUNITY_TAG)?(this.isCommunityTag=!0,this.displayValue=this.uri[1].replace(f.COMMUNITY_TAG,""),this.pred.is6WRoot()&&(this.isCommunityTagV1=!0)):2==this.uri[1].split(":").length&&m.call(this,this.uri,e))},f.isSwymCommunityInFocus=function(e){let t=e.observedNavImpl.getProxiesInEdition();if(t.length>0){let e=[];return t.forEach(function(t){t.eachTagValue(function(t){e.push(t)},{allTagsOfType:["ds6w:type"]})}),e.some(function(e){return"swym:Community"==e.uri})}},f.isDeprecatedOntologyConcept=function(e){let t=l.getConcept(e.ontologyURI);return t&&t.isDeprecated()},f.updateDisplayValue=function(e){if(e&&e.pred.isManualCompanyPredicate()){let t=[e],i=e.parent,n=-1;for(;i&&-1==n;)t.push(i),f.isDeprecatedOntologyConcept(i)&&(n=t.length-1),i=i.parent;if(-1!=n)for(let i=n;i>=0;i--){let n=t[i].displayValue;t[i].displayValue=n+a.getText("deprecated"),e._hasUpdatedDisplayValue=!0}else f.isDeprecatedOntologyConcept(e)&&(e.displayValue=e.displayValue+a.getText("deprecated"),e._hasUpdatedDisplayValue=!0)}},f.EXPLICIT_TAG="explicit",f.IMPLICIT_TAG="implicit",f.SIXW_ROOT_ONTOLOGY="ds6wclassifier:",f.BELCHAR="_BELCHAR_",f.COMMUNITY_TAG="_#ct#_",f}),define("DS/TagNavigator/simplified/utils/CriteriaUtils",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/simplified/model/CriteriaModel","text!DS/TagNavigator/assets/CriteriaInfo.json","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/model/TagValueWrapper","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/actions/ActionUtils","text!DS/TagNavigator/assets/CriteriaInfo_custom.json"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u){"use strict";var p=t.singleton({_rootCriteriaStatus:{},_focusedCriteriaPath:void 0,ALL_MODEL_ID:"#all",OTHER_MODEL_ID:"#others",TYPE_CATEGORIZATION:"type_categorization",TYPE_CATEGORIZATION_PREDICATE:"ds6w:what/type_categorization",TYPE_CATEGORY_PREDICATE:"ds6w:what/ds6w:typeCategory",TYPE_CATEGORIZATION_ORIGINAL_PREDICATES:[],ICONS_PATH:"TagNavigator/assets/icons/type_icon/",NEW_TYPE_CATEGORY_ICONS:void 0,init:function(){this._criteriaJSONInfo=JSON.parse(s),c.getOption("custoTypeCategorization")&&this._mergeCriteriaInfoWithCustomTag(),this.TYPE_CATEGORIZATION_ORIGINAL_PREDICATES=this._criteriaJSONInfo.predicate_Mapping.active_predicates||[],new g({sixw:this.TYPE_CATEGORIZATION_PREDICATE,type:"string",displayName:o.getText("typeCategorizationInfo")}),this._focusedCriteriaPath=[],c.getOption("disableDummyTypeCategoryTagValuesCreation")||this._createTypeCategoryTagValues(),this.NEW_TYPE_CATEGORY_ICONS=this.newTypeCategoryIcons()},_mergeCriteriaInfoWithCustomTag:function(t){let i;try{i=t?JSON.parse(t):JSON.parse(u),l.log("custom criteria info: ",JSON.stringify(i));e.merge(this._criteriaJSONInfo.predicate_Mapping["ds6w:type"],i["ds6w:type"]);l.log("custom criteria info after merging:",JSON.stringify(this._criteriaJSONInfo))}catch(e){l.log("Error thrown Invalid JSON _mergeCriteriaInfoWithCustomTag function ")}},getTypeCategoryPromise:function(){return new Promise(function(e,t){let i=[];var n=JSON.parse(s),r=n.category_resources,l=function(e){let t={},i=e.parent,a=r[i];return i&&a&&(a.imageUrl?t.imageUrl=a.imageUrl:a.iconClass?t.iconClass=a.iconClass:t=l(a)),t};Object.keys(r).forEach((e,t)=>{let i=r[e];if(i.id=e,i.label=o.getText(e),i.imageUrl=r[e].image?a.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+r[e].image:void 0,delete i.image,!UWACore.is(i.imageUrl)&&!UWACore.is(i.iconClass)){let e=l(i);e.imageUrl?i.imageUrl=e.imageUrl:i.iconClass=e.iconClass}i.subCategories=[]}),Object.keys(r).forEach((e,t)=>{let a=r[e];if(UWACore.is(a.parent)){r[a.parent].subCategories.push(e)}else i.push(e)});var c=function(e,t){let i={label:t.label,id:t.uri,imageUrl:t.imageUrl,iconClass:t.iconClass,subCategories:[],predicate:{}};return i.predicate[e]=[],i.predicate[e][0]={uri:t.uri},i},d=n.predicate_Mapping;let g=d.active_predicates;for(var h=0;h<g.length;h++)if(d[g[h]]){let e=d[g[h]];Object.keys(e).forEach(t=>{let n={label:void 0,uri:t},s=e[t].category;e[t].image?n.imageUrl=a.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+e[t].image:e[t].iconClass?n.iconClass=e[t].iconClass:UWACore.is(s,"string")?r[s].imageUrl?n.imageUrl=r[s].imageUrl:n.iconClass=r[s].iconClass:UWACore.is(s,"array")?s.forEach((e,t)=>{n[e]=n,r[e].imageUrl?n[e].imageUrl=r[e].imageUrl:n[e].iconClass=r[e].iconClass}):n.iconClass="fonticon-pencil",UWACore.is(s,"string")?r[s].subCategories.push(c(g[h],n)):UWACore.is(s,"array")?s.forEach((e,t)=>{r[e].subCategories.push(c(g[t],n[e]))}):i.push(c(g[h],n))})}var u=function(e){return 0===e.subCategories.length?e:(e.subCategories.forEach((e,t,i)=>{UWACore.is(e,"string")&&(i[t]=u(r[e]))}),e)};i.forEach((e,t,i)=>{UWACore.is(e,"string")&&(i[t]=u(r[e]))}),e(i)})},_createTypeCategoryTagValues:function(){var e=this._criteriaJSONInfo.category_resources;e&&Object.keys(e).forEach(function(t){for(var i,a=t,n=[a];i=e[a];)i.parent&&n.push(i.parent),a=i.parent;n=n.reverse(),r.createTypeCategory({sixw:this.TYPE_CATEGORY_PREDICATE,type:"string",field:"implicit",object:n,dispValue:n.map(function(e){return o.getText(e)})})}.bind(this))},getTypeCategorizationPredicates:function(){return this.TYPE_CATEGORIZATION_ORIGINAL_PREDICATES},getCriteriaStatus:function(e){var t=this._rootCriteriaStatus[e];return t||(t={},this._rootCriteriaStatus[e]=t),t},getFocusedCriteriaPath:function(){return this._focusedCriteriaPath},setFocusedCriteriaPath:function(e){this._focusedCriteriaPath=e},getExpandStatus:function(e){var t=this.getCriteriaStatus(e),i=t.expandStatus;return UWA.is(i)||(i=t.expandStatus=!1),i},setExpandStatus:function(e,t){if(!UWA.is(t,"boolean"))throw new Error("invalid status:"+t);this.getCriteriaStatus(e).expandStatus=t},getCriteriaInfo:function(e,t,a,s){var r,g=new i([],{model:n});if(s&&(r=s.toLowerCase()),e){var h=this._criteriaJSONInfo.predicate_Mapping,u=this._criteriaJSONInfo.category_resources,f={},m=this,v=function(e,t,i){let a=e;Array.isArray(e)&&(a=e[e.length-1]);var s=new n({criteriaId:a,title:o.getText(e),iconClass:t.iconClass,level:i||"level0",expandStatus:m.getExpandStatus(a)}),r=t.image;return r?s.set("imageURL",p.getImagePath(r)):t.iconClass?s.set("iconClass",t.iconClass):s.set("iconClass",C(t.parent)),s.setAsContainer(),s},T=function(e){if(e){var t=f[e];if(!t){let n=e;Array.isArray(e)&&(e.length<3?n=e[e.length-1]:l.log("Inside getParentCategoryModel, received categoryId as array of size motre than 2, categoryId="+e));var i=u[n];if(i)if(!i.parent)(t=g.get(e))||(t=v(e,i),g.add(t),f[e]=t);else{t=v(e,i,"level1"),f[e]=t;var a=T(i.parent);a&&a.addSubCategory(t)}else l.log("Invalid categoryID at getParentCategoryModel:-",e)}return t}},C=function(e){for(var t;u[e]&&(t=u[e].parent);)e=t;return u[e]?u[e].iconClass:void 0},w=function(e,i){e.count=i;var a=e.getUri(),s=e.pred;if("ds6w:typeCategory"==s.id())if(UWA.is(a,"array")&&a.length>0)if(1==a.length){if(!(c=f[a])){var r=u[a[0]];if(r){var c=v(a[0],r);f[a]=c}g.add(c)}}else{var d;let t=UWA.clone(a);try{t.pop(),d=T(t)}catch(e){l.error("Error during building category hierarchy for: "+a[a.length-2])}if(d){d.isContainer()||d.setAsContainer();let t=a[a.length-1];var m=d.getSubCategory(t);if(!m){var w,b;d.addSubCategory(m=new n({criteriaId:a,parentCriteriaId:d.id,level:"level1",predicate:s})),f[a]=m;let t=a[a.length-1],i=u[t];i||(t=d.id[d.id.length-1],i=u[t]),i&&(w=i.iconClass,b=i.image),b?m.set("imageURL",p.getImagePath(b)):w?m.set("iconClass",w):(l.error("FAILED to compute root category icon for:"+a[0]),m.set("hasNoIcon",!0));let r=a[a.length-1];u[r]?m.set("title",o.getText(r)):m.set("title",e.getDisplayValue())}m.updateCount(e.getCount())}}else l.error("ds6w:typeCategory tag value is not an array or empty array: "+a);else{var y="ds6w:docExtension"==s.id(),S=h[s.id()][y?a.toUpperCase():a];if(S){if(t&&S.exclude_for_type_categorization)return;var I=S.category;if(UWA.is(I,"string")&&(I=[I]),y&&0==I.length&&(I=["category-Document-Other"]),I)I.forEach(function(t){var i=T(t);if(i){var o=i.getSubCategory(a);o||i.addSubCategory(o=new n({criteriaId:a,title:e.getDisplayValue(),parentCriteriaId:i.id,level:"level1",isOther:S.isOther,predicate:s}));var r=S.image;if(r)o.set("imageURL",p.getImagePath(r));else{var c=S.iconClass;if(c)o.set("iconClass",c);else{if(u[t]){let e=u[t].image,i=u[t].iconClass;e?o.set("imageURL",p.getImagePath(e)):i?o.set("iconClass",i):o.set("iconClass",C(t))}}}o.updateCount(e.getCount())}else l.log("Invalid applicableCategory at Treat Tag Value:-",t)}.bind(this));else{var E=new n({criteriaId:a,title:e.getDisplayValue(),level:"level0",count:e.getCount(),predicate:s});S.iconClass?E.set("iconClass",S.iconClass):S.image&&E.set("imageURL",p.getImagePath(S.image)),g.add(E)}}}}.bind(this),b=h.active_predicates;if(UWA.is(a,"array")&&a.length>0)b=a;else if(t){if(!c.getOption("typeCategoryFromSynthesis")){var y=b.indexOf("ds6w:typeCategory");-1!=y&&y<=b.length&&b.splice(y,1)}}else b=["ds6w:type"];e.eachTagValue(function(e,t){r?r&&-1!==e.getDisplayValue().toLowerCase().indexOf(r)&&w(d.getWrapper(e),t):w(d.getWrapper(e),t)},{allTagsOfType:b})}return g},removeDuplicates:function(e){var t=new i([],{model:n});return e.forEach(function(e){if(e.isContainer())t.add(e);else{var i=t.find(function(t){return t.get("title")===e.get("title")});i?i.setAsComposite().add(e):t.add(e);var a=e.get("subCategories");a&&a.length&&p.removeDuplicates(a)}}),t},getAllCriteriaModel:function(e,t){var a=new n({criteriaId:p.ALL_MODEL_ID,parentCriteriaId:e.id,title:o.getText("all"),iconClass:e.get("iconClass"),level:"level1",subCategories:new i([],{model:n})});return t.forEach(function(e){a.addSubCategory(e),a.updateCount(e.getCount())}),a},getOtherCriteriaModel:function(e,t){var a,s=0;return t.forEach(function(t){!0===t.get("isOther")&&(++s,a||(a=new n({criteriaId:p.OTHER_MODEL_ID,rootCriteriaId:e.id,title:o.getText("others"),iconClass:e.get("iconClass"),level:"level1",subCategories:new i([],{model:n})})),a.addSubCategory(t),a.updateCount(1))}),{nbOthers:s,model:a}},buildCondition:function(e,t,i){var a={id:p.TYPE_CATEGORIZATION_PREDICATE,operator:i||"OR",isComplex:!0,condition:{type:"string",object:e instanceof n?e.id:e.object,operator:"OR",value:[],display:e instanceof n?e.get("title"):e.dispValue,predicates:[]}};t&&(a.condition.excluded=t);var s=p.ALL_MODEL_ID===e.id,l=e instanceof n&&e.isContainer();if(s||l){Array.isArray(e.id)?a.condition.object=e.id[e.id.length-1]:a.condition.object=s?e.get("parentCriteriaId"):e.id,a.condition.display=o.getText(a.condition.object);for(var c=e.get("subCategories"),d=0;d<c.length;d++){var g=c.at(d);(h=g.getRefineStructure()).isComposite&&(a.condition.hasComposites||(a.condition.hasComposites=[]),a.condition.hasComposites.push(d)),h.forEach(function(e){a.condition.value.push(e.object),a.condition.predicates.push({predicate:e.predicate,type:e.type,dispValue:g.get("title"),isComposite:e.isComposite})})}}else if(e instanceof n){var h=e.getRefineStructure();e.isComposite()&&(a.isComposite=!0,a.condition.object=h[0].object),a.condition.predicates.push({predicate:h[0].predicate,type:h[0].type,dispValue:h[0].dispValue}),a.condition.value.push(h[0].object)}else if(e instanceof r){a.condition.object=e.getUri(),a.condition.display=e.getDisplayValue();var u=e.pred;e.isComposite&&(a.isComposite=!0,a.condition.object=e.getUri()),a.condition.value.push(e.getUri()),a.condition.predicates.push({predicate:u.getFullPredicateID(),type:u.getType(),dispValue:e.getDisplayValue()})}else e.isComposite&&(a.isComposite=!0,a.condition.object=e.object),a.condition.value.push(e.object),a.condition.predicates.push({predicate:e.predicate,type:e.type,dispValue:e.dispValue});return a},isSupportedAction:function(e,t){var i=!1;switch(t){case h.ACTION_SELECT:case h.ACTION_EXCLUDE:case h.ACTION_EDITTAGREL:e.hasAdvancedFocsuedProxy(void 0,p.TYPE_CATEGORIZATION)?l.log(t+" action is not supported yet.."):i=!0}return i},getSelectionIndex:function(e,t){return e.findIndex(function(e){if(UWA.is(e,"object")){if(!t.isComposite)return t.object===e.object&&t.predicate===e.predicate;if(e.isComposite&&t.object.length==e.object.length){var i=0;return t.object.forEach(function(t,a){t==e.object[a]&&i++}),i==t.object.length}}})},getImagePath:function(e){return a.getWebappsBaseUrl()+p.ICONS_PATH+e},getCategorizationInfo:function(e){var t=[];if(e&&e.id&&e.predicate){var i=this._criteriaJSONInfo.predicate_Mapping[e.predicate];if(i){var a=i[e.id];if(a&&a.category){var n=a.category;if(n){t.push(n);for(var s,o=this._criteriaJSONInfo.category_resources;s=o[n];)s.parent&&t.push(s.parent),n=s.parent}}}}return t},getCategorizedPredicates:function(){return this.TYPE_CATEGORIZATION_ORIGINAL_PREDICATES},newTypeCategoryIcons:function(){return!(!window.location.pathname.includes("/v3")&&1!=c.getOption("newTypeCategoryIcons"))}});return p}),define("DS/TagNavigator/ActiveTagView",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"li",className:"tag selected",setup:function(e){e.id&&this.container.setAttribute("id",e.id),this._parent(e)},render:function(){var t=this.getOption("isSimplified"),a=this.getOption("text"),n=this.getOption("icon"),s=this.getOption("isExcluded"),o=this.getOption("isPinned"),r=this.getOption("isGrouped"),l=this.getOption("hasActions"),c=this.getOption("disabled"),d=this.getOption("onePerLine"),g=this.getOption("attribute"),h=this.getOption("hasExcludeSupport");if(this.condition=this.getOption("condition"),this.renderTo=this.getOption("renderTo"),l&&this.container.addClassName("tag-with-actions"),c&&this.container.addClassName("disable"),o&&this.container.addClassName("pinned"),r&&this.container.addClassName("grouped"),h&&!s&&this.container.addClassName("canBeExcluded"),d&&this.container.setStyles({display:"flex",margin:"0px 0 10px 0"}),g&&g.length>0){var u=this;g.forEach(function(e){u.container.setAttributes(e)})}var p=e.createElement("div",{class:"tag-elem"}).inject(this.container),f=e.createElement("div",{class:"tag-label"}).inject(p);n&&e.createElement("span",{class:"root-icon fonticon "+n}).inject(f);var m=e.createElement("div",{class:"title",text:a}).inject(f);return n||m.setStyles({"padding-left":"5px"}),this.updateExclude(s),o&&e.createElement("span",{class:"fonticon fonticon-pin pinned"}).inject(p.getElement(".tag-label")),l?e.createElement("span",{class:"tag-dropdown fonticon fonticon-down-open"}).inject(p):t&&e.createElement("span",{class:"tag-del fonticon fonticon-cancel"}).inject(p),this.getOption("withoutTitle")||this.container.setAttributes({title:a}),this.tooltip=new i({position:"bottom",target:f,body:a,className:"tagger-filter-tooltip"}),this},updateExclude:function(t){t?(t&&this.container.addClassName("isExcluded"),e.createElement("span",{class:"fonticon fonticon-block excluded"}).inject(this.getElement(".tag-label"))):(this.container.hasClassName("isExcluded")&&this.container.removeClassName("isExcluded"),this.container.getElement(".excluded")&&this.container.getElement(".excluded").destroy())},destroy:function(){this._parent()}})}),define("DS/TagNavigator/userTags/utils/UserTagsUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TagsServer","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/utils/OntologyUtils"],function(e,t,i,a,n,s,o,r,l,c,d,g,h){"use strict";var u={},p={},f=[],m={},v={};let T,C,w,b={},y={},S={},I={"pid:":"3DSpace","swym:":"3DSwym","driveid:":"3DDrive"},E={},x=function(e,t){var i;if(UWA.is(e,"object")){let a=E[e.sixw];if(t&&a||!t&&-1!=f.indexOf(e.sixw))if(i={object:e.object,object_db:e.object},UWA.is(e.object,"array")&&e.object.length>1)if(0==e.object[0].indexOf(r.SIXW_ROOT_ONTOLOGY))if(2==e.object.length&&0==e.object[1].indexOf(r.COMMUNITY_TAG)){i.isCommunityTag=!0;let t=e.object[1].replace(r.COMMUNITY_TAG,"");i.dispValue=[e.object[0],t],i.label=t,i.object_db=i.object.join(r.BELCHAR)}else 2==e.object[1].split(":").length&&(i.isOntologyTag=!0);else i.unsupported=!0;else if(UWA.is(e.object,"string"))if(0==e.object.indexOf(r.SIXW_ROOT_ONTOLOGY)){let t=e.object.split(r.COMMUNITY_TAG);2==t.length&&(i.isCommunityTag=!0,i.dispValue=t[1].replace(r.COMMUNITY_TAG,""),i.label=i.dispValue)}else t&&a&&(i.isCommunityTag=!0,i.dispValue=e.object.replace(r.COMMUNITY_TAG,""),i.label=i.dispValue)}return i},_=function(t,i,n){if(t&&(t.communityName||t.communityId)&&t.platformId){s.log("Inside fed search suggestions, with tenant:"+t.platformId||NaN+t.communityName);o.getServiceUrl({serviceName:"3DSearch",platformId:t.platformId,onComplete:function(o){s.log("fed search url from compass: "+o),function(o){var r={label:t.appName+"-"+t.currentUser+"-"+(new Date).getTime(),query:"",with_nls:!1,with_synthesis:!0,with_indexing_date:!1,source:["swym"],tenant:t.platformId,start:0,nresults:1};t.query?(s.log("query param is provided, using it for fedsearch request, query="+t.query),r.query=t.query):t.communityId?(s.log("communityId is provided, using ity for fedsearch request, communityId="+t.communityId),r.query='[ds6w:containerUid]: ("'+t.communityId+'")'):(s.log("communityId is NOT provided, using communityName for fedsearch request, communityName="+t.communityName),r.query='[ds6w:community]: ("'+t.communityName+'")');var l={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:e.Json.encode(r),url:o+"/search",onComplete:function(e){var t;try{t=JSON.parse(e)}catch(e){t=e}return i(t)},onFailure:function(e){var t;try{t=JSON.parse(e)}catch(e){t=e}return n(t)}};a.authenticatedRequest(l.url,l)}(o)},onFailure:function(){s.error("FAILED to retrieve 3DSearch url for tenant: "+t.platformId),n("FAILED to retrieve 3DSearch url for tenant"+t.platformId)}})}},A=function(e){if(e.mode=e.mode||n.getOption("communityTagsFetchMode"),"database"==e.mode)return new i(function(t,i){l.getUserTagsByDBCall({platformId:e.platformId,subject_uri:e.communityId}).then(function(e){let i=[];if(UWA.is(e.data,"array")&&1==e.data.length&&UWA.is(e.data[0].tag,"array")){let t,a=e.data[0].tag.map(function(e){return{sixw:e.predicate,object:e.object.literal,type:e.object.literalType.split(":")[1]}});s.log("Number of existing tags found from DB query="+a.length),i=a.filter(function(e){if((t=x(e))&&t.isCommunityTag)return e.dispValue=t.dispValue,e.label=t.label,e.object_db=e.object,e.sixw_db=e.sixw,e.sixw=g.getCommunityTagPredicate(e.sixw).getFullPredicateID(),!0})}t({communityTags:i})},function(e){i(e)})});{let t=(e.communityId||e.communityName)+"_"+e.platformId,a=u[t];return a||(u[t]=a=new i(function(t,i){let a={platformId:e.platformId,appName:e.appName,currentUser:e.currentUser};e.communityId?(a.communityId=e.communityId,a.query='[ds6w:resourceUid]: ("'+e.communityId+'")'):e.communityName&&(a.communityName=e.communityName,a.query='[ds6w:type]:"swym:community" AND [ds6w:label]: ("'+e.communityName+'")'),_(a,function(e){var i=[];e&&e.facets&&UWA.is(e.facets,"array")&&e.facets.forEach(function(e){if(e.field==r.EXPLICIT_TAG){var t=x(e,!0);if(t&&t.isCommunityTag){let a={sixw:e.sixw,object:e.object,object_db:t.object_db,field:e.field,type:e.type,count:e.count,dispValue:t.dispValue,label:t.label};a.sixw_db=E[a.sixw],i.push(a)}}}),t({communityTags:i})},function(e){i("FAILED to retrive community tags")})})),a}},N=function(e,t,a,n,o){return s.log((o?"CREATE ":"DELETE ")+n.length+" tags"),new i(function(i,s){let r=new d(e,t,t),l={tag:n.map(function(e){return{subject:[{uri:a}],predicate:e.sixw_db?e.sixw_db:e.sixw,object:{literal:e.object}}})},c=function(){i()},g=function(){s("FAILED to "+(o?"CREATE tags":"DELETE tags"))};o?r.putTag(l,!0,c,g,!1):r.deleteTag(l,!0,c,g,!1)})},V=function(e,t){return t||(t="asc"),e.sort(function(e,t){return e.label.toUpperCase().localeCompare(t.label.toUpperCase())}),"desc"==t?e.reverse():e},P=function(e){var t={};let i;return e.forEach(function(e){i=e.sixw_db?e.sixw_db:e.sixw;var a=t[i];a||(t[i]=a=[]),a.push(UWA.clone(e))}),t},D=function(e,t){return t||(t="asc"),e.sort(function(e,t){return t.count-e.count}),"desc"==t?e.reverse():e},O=function(e,t){let i=(t=t||{}).text||"";return i&&(i=i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase()),e.filter(function(e){return!t.text||e.label.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().indexOf(i)>-1})};var M=t.singleton({OPERATION_ADD:"create",OPERATION_DELETE:"delete",OPERATION_STATUS:"status",OPERATION_STATUS_SUCCESS:"success",OPERATION_STATUS_FAILURE:"failure",OPERATION_STATUS_PARTIAL:"partial",init:function(){f=n.getOption("simplifiedRootW"),m=n.getOption("rootW_Concepts_Mapping"),b=n.getOption("concepts_rootW_Mapping"),T=n.getOption("enableBelchar"),C=new RegExp(r.BELCHAR,"gi"),y=n.getOption("rootW_companyPredicate_Mapping"),S=n.getOption("companyPredicate_Concepts_Mapping"),w=n.getOption("persistTagWithFullLineage"),g.ensureDefaultPredicates(),Object.keys(g.COMPANY_TAGS_PREDICATES).forEach(function(e){E[g.getCommunityTagPredicate(e).getFullPredicateID()]=e})},getUserTagInfo:function(e){let t=x(e);if(t&&t.sixw)t.sixw=e.sixw,t.sixw_db=E[e.sixw];else if(t=x(e,!0))t.sixw=e.sixw,t.sixw_db=E[e.sixw];else if(t={object:e.object,object_db:e.object,sixw:e.sixw,sixw_db:e.sixw},UWA.is(t.object,"string")&&-1!==t.object.indexOf(r.BELCHAR)&&(t.object=t.object.split(r.BELCHAR)),Array.isArray(t.object)&&t.object.length>1&&0==t.object[0].indexOf(r.SIXW_ROOT_ONTOLOGY)){let i=h.getConcept(e.object[e.object.length-1]);i&&(t.dispValue=i.getLabel()),t.label=t.dispValue,t.object_db=t.object.join(r.BELCHAR),t.object=t.object[t.object.length-1],t.isEnterpriseOntologySuggestion=!0}return t},getVocabularySuggestions:function(e){if(UWA.is(e,"object")&&(e.tagsServer||e.platformId)){var t=e.tagsServer?e.tagsServer.getTenantName():e.platformId,a=v[t];return a||(v[t]=a=new i(function(i){l.getControlledVocabularyMode({platformId:t}).then(function(a){l.getEnterpriseOntologyConfig(t).then(function(n){if(a&&!a.mode||a&&a.mode&&(!n.applicativeId||!n.applicativeId[0])){var o=function(e,t,a){UWA.is(a,"object")||(a={});var n=[];f.forEach(function(e){var t={};t[e]=UWA.is(a[e],"object")?a[e]:{literalInfo:[],individualInfo:[]},n.push(t)}),i(n)};e.tagsServer?e.tagsServer.getVocabularySuggestions(t,e.rootWs||f,o):l.getPredicateRangeValues({platformId:t,predicates:e.rootWs||f,lang:e.lang||c.getLang(),onComplete:o})}else s.error("Suggestions not allowed by controlled vocab settings"),i([])}.bind(this))}.bind(this))})),a}},getRootWSequence:function(){return UWA.clone(f)},getSourceFromSubjectURI:function(e){var t=Object.keys(I).filter(function(t){return 0==e.indexOf(t)});if(Array.isArray(t)&&t.length>0)return I[t[0]]},getUserTagsByFedSearch:function(e){if(UWA.is(e,"object")&&(e.communityName||e.communityId)&&e.platformId){var t=(e.communityName||e.communityId)+"_"+e.platformId,a=p[t];return a||(p[t]=a=new i(function(t){l.getControlledVocabularyMode(e).then(function(i){if(i&&!i.mode){e.communityId?e.query='[ds6w:containerUid]: ("'+e.communityId+'")':e.query='[ds6w:community]: ("'+e.communityName+'")',_(e,function(i){if(i&&i.facets&&UWA.is(i.facets,"array")){var a=[];i.facets.forEach(function(e){if(e.field==r.EXPLICIT_TAG){let t={};t.sixw=e.sixw,t.object=e.object,t.count=e.count;let i=x(e);i&&(i.unsupported?s.warn("Unsupported user tag:"+JSON.stringify(e)):(t.label=i.label?i.label:e.object,t.dispValue=i.dispValue?i.dispValue:e.object,t.object_db=i.object_db,a.push(t)))}})}var n={id:e.id,suggestions:a};t(n)},function(){var i={id:e.id,suggestions:[]};s.error("FAILED to suggestions from fed search call"),t(i)})}else{let i={id:e.id,suggestions:[]};s.error("Suggestions not allowed by controlled vocab settings"),t(i)}})})),a}},getCommunityTags:function(e){if(e&&(e.communityId||e.communityName)&&e.platformId)return new i(function(t){e.mode=e.mode?e.mode:"index",A(e).then(function(i){let a,n=e.sort||"";if("rootW-alpha"==n){var s=P(i.communityTags);a=[],f.forEach(function(e){let t=s[e];t&&(a=a.concat(V(t)))})}else a="alpha"==n?UWA.clone(V(i.communityTags)):UWA.clone(i.communityTags);t({communityTags:a})},function(e){t({communityTags:[],error:e})})})},filterCommunityTags:function(e){var t=this;return new i(function(i,a){UWA.is(e,"object")&&e.platformId&&e.communityId&&e.summary?UWA.is(e.summary,"array")?(e.mode&&"database"==e.mode&&(s.warn("UserTagsUtils#filterCommunityTags: database mode not allowed...."),a("database mode not allowed....")),t.getCommunityTags(e).then(function(t){var a={};let n,s,o;t.communityTags.forEach(function(e){n=e.sixw;var t=a[n];t||(a[n]=t={}),t[e.object]=e});var r=e.summary.filter(function(e){let t=x(e,!0);if(t&&(e.object_db=t.object_db),(s=a[e.sixw])&&(o=s[e.object]))return e.dispValue=o.dispValue,e.label=o.label,e.isCommunityTag=!0,e.sixw_db=E[e.sixw],!0;var i=x(e,!0);return i&&i.isCommunityTag?(e.dispValue=i.dispValue,e.label=i.label,e.isCommunityTag=!1,e.sixw_db=E[e.sixw],!0):void 0}),l=e.sort||"";if("rootW-count"==l){var c=P(r);r=[],f.forEach(function(e){let t=c[e];t&&(r=r.concat(D(t)))})}else"count"==l&&(r=D(r));i({communityTags:r})},function(){a([])})):(s.log("UserTagsUtils#filterCommunityTags: INVALID options.summary"),a([])):(s.log("UserTagsUtils#filterCommunityTags: INVALID inputs"),a([]))})},getOrderedCommunityTags:function(e){var t=this;return new i(function(i,a){if(UWA.is(e,"object")&&e.platformId&&e.communityId&&e.summary)if(UWA.is(e.summary,"array")){e.mode&&"database"==e.mode&&(s.warn("UserTagsUtils#getOrderedCommunityTags: database mode not allowed...."),a("database mode not allowed...."));let n={appName:e.appName,communityId:e.communityId,currentUser:e.currentUser,sort:"rootW-alpha",platformId:e.platformId};t.getCommunityTags(n).then(function(n){n.communityTags.forEach(function(e){delete e.count});const o=n.communityTags.filter(t=>!e.summary.some(e=>Array.isArray(t.object)&&Array.isArray(e.object)&&e.object.join()===t.object.join()));s.log(o),o&&e.summary.push(...o),t.filterCommunityTags(e).then(function(e){s.log(e),i({communityTags:e.communityTags})},function(){a([])})},function(){a([])})}else s.log("UserTagsUtils#getOrderedCommunityTags: INVALID options.summary"),a([]);else s.log("UserTagsUtils#getOrderedCommunityTags: INVALID inputs"),a([])})},buildCommunityTagInfo:function(e){let t=e.getAttributeValue("predicate"),i=e.getLabel();return{sixw:t,object:m[t]+r.BELCHAR+r.COMMUNITY_TAG+i,dispValue:i,label:i}},buildSuggestedTagInfo:function(e){let t=[],i="",a=e.getParent();for(;a;)t.push(e.getAttributeValue("object")),(!a||a&&!a.getParent())&&(i=e.getAttributeValue("predicate")),e=a,a=a.getParent();return{sixw:i,object:t.reverse().join(r.BELCHAR)}},buildOntologyTagInfo:function(e,t){let i=e.getAttributeValue("predicate");e.getAttributeValue("isEnterpriseConcept")&&(i=y[i],s.log("Using predicate "+i+"for enterprise ontology tag"));let a,n=e.getLabel(),o=[],l=e;for(;l;)(a=l.getAttributeValue("object"))&&o.push(a),l=l.getParent();return o.push(S[i]),o=o.reverse(),s.log("URI path for ontology concept="+o),{sixw:w?g.getPredicate(i).getFullPredicateID():i,object:t?o.join(r.BELCHAR):o,dispValue:n,label:n}},getSelectedCommunityTags:function(e){var t=[];if(e){let i=e.__private_getImpl();UWA.is(i._autoComplete.selectedItems,"array")&&i._autoComplete.selectedItems.forEach(function(e){t.push(M.buildCommunityTagInfo(e))})}return s.log("selected community Tags="+JSON.stringify(t)),t},getSuggestionsFor3DSwymContent:function(e){if(e&&e.platformId&&(e.communityId||e.communityName))return new i(function(t){var a=[];let n,o,l;e.vocabSuggestions="boolean"!=typeof e.vocabSuggestions||e.vocabSuggestions,e.vocabSuggestions&&(a.push(this.getVocabularySuggestions({platformId:e.platformId,rootWs:e.rootWs})),n=a.length-1),e.communityTags="boolean"!=typeof e.communityTags||e.communityTags,e.communityTags&&(a.push(this.getCommunityTags({platformId:e.platformId,communityId:e.communityId,communityName:e.communityName,appName:e.appName,currentUser:e.currentUser,sort:e.sort||"rootW-alpha"})),o=a.length-1),e.existingUserTags="boolean"!=typeof e.existingUserTags||e.existingUserTags,e.existingUserTags&&(a.push(this.getUserTagsByFedSearch({platformId:e.platformId,communityId:e.communityId,communityName:e.communityName,appName:e.appName,currentUser:e.currentUser})),l=a.length-1);i.all(a).then(function(i){let a,c,d,g=o>=0?i[o].communityTags:[],h=l>=0?i[l].suggestions:[],u=n>=0?function(e){let t,i,a={};return e.forEach(function(e){t=Object.keys(e)[0];let n=a[t];n||(a[t]=n=[]),i=e[t].literalInfo,UWA.is(i,"array")&&i.length>0&&i.forEach(function(e){let i=e.type.split("#");n.push({sixw:t,object:e.value,object_db:e.value,dispValue:e.value,label:e.value,field:r.EXPLICIT_TAG,type:i.length>1?i[i.length-1]:"string"})})}),a}(i[n]):function(){let e={};return f.forEach(function(t){e[t]=[]}),e}();g.forEach(function(e){a=e.sixw_db?e.sixw_db:e.sixw,(d=u[a])&&(e.isCommunityTag=!0,d.push(e))});var p={};for(c in u)u[c].forEach(function(e){p[c+e.label]=!0});let m,v;for(c in h&&h.forEach(function(e){(v=x(e))&&!v.isCommunityTag&&(m=e.sixw+e.label,p[m]?s.log("Existing user tag is ignored as it is already a standatd tag:"+JSON.stringify(e)):u[e.sixw].push(e))}),e.sort=e.sort||"rootW-alpha",u)u[c]=O(u[c],{text:e.text});let T,C=e.sort||"";"rootW-alpha"==C?(T=[],f.forEach(function(e){let t=u[e];t&&(T=T.concat(UWA.clone(V(t))))})):(T=[],f.forEach(function(e){let t=u[e];t&&(T=T.concat(UWA.clone(t)))}),"alpha"==C&&(T=V(T))),t({id:e.id,suggestions:T})})}.bind(this))},isARootWTag:function(e){return-1!=f.indexOf(e)},getTextForDefaultSuggestions:function(e){if("string"==typeof e){s.log("UserTagsUtils#getTextForDefaultSuggestions, input text = "+e);let t=e.trim();return t=T?t:t.replace(C,""),s.log("UserTagsUtils#getTextForDefaultSuggestions, output text = "+t),t}},getDefaultSuggestions:function(e){if("string"==typeof e.text){let t=M.getTextForDefaultSuggestions(e.text);return f.map(function(i){let a={sixw:i,dispValue:e.text,label:e.text,type:"string"};return a.object_db=t,a.sixw_db=i,a})}},getFilterDescription:function(e){if("string"==typeof e){s.log("UserTagsUtils#getFilterDescription, input filter = "+e);let t=e.split(r.BELCHAR),i=t.length>1?t:t[0];return s.log("UserTagsUtils#getFilterDescription, output filter = "+i),i}return e},getFilterPredicate:function(e,t){let i=M.getFilterDescription(e);if("string"==typeof i)return t;if(Array.isArray(i)){let e=g.COMMUNITY_TAGS_PREDICATES[t];if(e)return e.getFullPredicateID()}},isAValidTag:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){let i,a,n={};e.forEach(function(e){i=e.predicate.split("/")[0],(a=n[i])||(n[i]=a=[]),Array.isArray(e.tag)?a.push(e.tag.join(r.BELCHAR)):UWA.is(e.tag,"string")&&a.push(e.tag)}),t.forEach(function(e){e.isValid=!1,(a=n[e.predicate])&&-1!=a.indexOf(e.tag)&&(e.isValid=!0)})}},updateCommunityTags:function(e){if(e&&e.communityId&&e.platformId)return new i(function(t,a){e.communityTags||(e.communityTags=[]),function(e){return new i(function(t,a){A({platformId:e.platformId,communityId:e.communityId,mode:"database"}).then(function(n){let r=n.communityTags,l=[],c=[];if(0==e.communityTags.length)l=r;else if(0==r.length)c=e.communityTags;else{let t={},i={},a={};r.forEach(function(e){t[e.object]=!0,i[e.object]=e}),e.communityTags.forEach(function(e){t[e.object]=!0,a[e.object]=e}),Object.keys(t).forEach(function(e){i[e]&&a[e]?s.log("UserTagsUtils#updateCommunityTags: no action needed for "+e):i[e]&&!a[e]?(l.push(i[e]),s.log("UserTagsUtils#updateCommunityTags: tag to delete "+e)):!i[e]&&a[e]&&(c.push(a[e]),s.log("UserTagsUtils#updateCommunityTags: tag to create "+e))})}o.getServiceUrl({serviceName:"6WTags",platformId:e.platformId,onComplete:function(n){s.log("6WTags url from compass: "+n);let o=[];c.length>0&&o.push(N(n,e.platformId,e.communityId,c,!0)),l.length>0&&o.push(N(n,e.platformId,e.communityId,l,!1)),i.all(o).then(function(){t()},function(e){a(e)})},onFailure:function(){s.error("FAILED to retrieve 6WTags url for tenant: "+e.platformId),onFailure("FAILED to retrieve 3DSearch url for tenant"+e.platformId)}})},function(e){a(e)})})}(e).then(function(){s.log("updateCommunityTags OK"),t()},function(e){s.log("updateCommunityTags FAILED"),a(e)})})},translateStandardUserTag:function(e){if("string"==typeof e&&0==e.indexOf(r.SIXW_ROOT_ONTOLOGY)){let t=e.split(r.BELCHAR);if(b[t[0]]&&2==(t=e.split(r.COMMUNITY_TAG)).length)return t[1].replace(r.COMMUNITY_TAG,"")}return e},computeSuccessResponse:function(e){return{status:M.OPERATION_STATUS_SUCCESS,tags:this.getSuccessResponse(e)}},computeFailureResponse:function(e){return{status:M.OPERATION_STATUS_FAILURE,error:e.msg}},getSuccessResponse:function(e){return e.map(function(e){return{sixw:e.predicate,object:e.object.literal,type:e.object.literalType}})},getResponseDetails:function(e){let t;if(UWA.is(e,"object")){let i=Object.keys(e);UWA.is(i,"array")&&i.length>0&&((t={}).onlyCreate=1==i.length&&i[0]==M.OPERATION_ADD,t.onlyDelete=1==i.length&&i[0]==M.OPERATION_DELETE,t.bothOperations=2==i.length,t.createStatus=e[M.OPERATION_ADD]?e[M.OPERATION_ADD][M.OPERATION_STATUS]:void 0,t.deleteStatus=e[M.OPERATION_DELETE]?e[M.OPERATION_DELETE][M.OPERATION_STATUS]:void 0)}return t}});return M}),define("DS/TagNavigator/simplified/activeTags/ActiveTagsUtils",["UWA/Core","DS/TagNavigator/TaggerNLS"],function(e,t){"use strict";var i={predicateViews:[],advanceFilter:null,computeFilters:function(e){let t,i=e.computeFilterObj(null,null,void 0,!0,!1);return i&&i.allfilters&&i.allfilters.condition&&i.allfilters.condition.length?t=i:i.allfiters&&i.allfiters.condition&&0!=i.allfiters.condition.length||(t=void 0),t},computeReqObj:function(e){return e.display=e.displayValue,e},computeTagsArray:function(e){let t=[];return Array.isArray(e)&&e.length&&e.forEach((e,a)=>{Object.keys(e).forEach(a=>{let n={};UWA.is(e[a],"array")?e[a].forEach((e,s)=>{let o=i.computeReqObj(e),r=!!o.excluded;n={object:o,predicate:a,isExcluded:r},t.push(n)}):"object"==typeof e[a]&&e[a].condition&&e[a].condition.forEach((i,n)=>{i.predicates.forEach((n,s)=>{let o,r;e[a].isComplex&&(r=a),(i.hasOwnProperty("excluded")||e[a].hasOwnProperty("excluded"))&&(o=!!i.excluded);let l={object:i,predicate:n.predicate,operator:e[a].operator,displayPredicate:r,isExcluded:o};t.push(l)})})})}),t},getTags:function(e,t,i){let a=[];return UWA.is(e,"array")?e.forEach((e,n)=>{let s=this.computeReqObj(e);i?s.excluded&&a.push({condition:s}):t&&s.excluded||a.push({condition:s})}):"object"==typeof e&&e.condition&&e.condition.forEach((e,n)=>{i?e.excluded&&a.push({condition:e}):t&&e.excluded||a.push({condition:e})}),a},_computeDateNls:function(e){let i,a;return e.from&&(i=e.from.split("/").reverse().join("/")),e.to&&(a=e.to.split("/").reverse().join("/")),i&&!a?t.getText("from")+": "+i:!i&&a?t.getText("to")+": "+a:i&&a?i+" - "+a:void 0},hasOverloadedOperator:function(e,t){let i=!1;return Array.isArray(e)&&e.length&&e.forEach((e,a)=>{Object.keys(e).forEach(a=>{if("object"==typeof e[a]){let n=UWA.clone(e[a]);n.id=a,t.operatorIsOverloaded(n)&&(i=!0)}})}),i},getActualPredicates:function(e){let t=new Set;return e.isComplex&&e.condition.forEach(e=>{e.predicates.forEach(e=>{t.add(e.predicate)})}),t},checkNewfilter:function(t,i,a){let n=this,s=[],o=[];return i?(UWA.is(t,"array")?t.forEach(t=>{var r=!1;switch(t.type){case"boolean":case"string":var l={value:t.object,nls:t.displayValue||t.nls||t.object},c=-1;i.length>0&&(c=i.findIndex(function(e){return e.object===l.value}));let g=n.computeReqObj(t);a&&!g.excluded&&(-1===c?s.push({condition:g}):o.push({condition:g}));break;default:if(t.isSimplifiedCriteria){i.length>0&&i.forEach(function(e){e.isSimplifiedCriteria&&e.object.from===t.object.from&&e.object.to===t.object.to&&(r=!0)});let e=n.computeReqObj(t);a&&!e.excluded&&(r?o.push({condition:e}):s.push({condition:e}))}else{var d=i.filter(function(e){return!e.isSimplifiedCriteria});if(d.length>0)e.extend(d[0],t.object);else{let e=n.computeReqObj(t);a&&!e.excluded&&s.push({condition:e})}}}}):UWA.is(t,"object")&&t.condition.forEach(e=>{let t,n=e.isComplex;var r=function(t,i){return i?e.condition.object.length==t.object.length&&e.condition.object.every(function(e){return-1!==t.object.indexOf(e)}):e.condition.object.length<=t.object.length?e.condition.object.every(function(e){return-1!==t.object.indexOf(e)}):t.object.every(function(t){return-1!==e.condition.object.indexOf(t)})};t=i.condition.findIndex(function(t){return n?e.isComposite?r(t):UWA.is(e.condition.object,"array")&&UWA.is(t.object,"array")?(isHierarchicalTag=!0,r(t,!0)):JSON.stringify(e.condition.object)===JSON.stringify(t.object):e.isComposite?r(t):UWA.is(e.object,"array")&&UWA.is(t.object,"array")?JSON.stringify(e.object)===JSON.stringify(t.object):e.object===t.object}),a&&!e.excluded&&(-1==t?s.push({condition:e}):o.push({condition:e}))}),{newAddedFilters:s,oldFilters:o}):(o=this.getTags(t,a),{newAddedFilters:s,oldFilters:o})}};return i}),define("DS/TagNavigator/ActiveCriteria",["UWA/Core","UWA/Class","UWA/Promise","UWA/Class/Events","UWA/Class/View","DS/UIKIT/Tooltip","DS/TagNavigator/TaggerNLS","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/Predicate","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s,o,r,l,c,d,g){"use strict";var h,u,p,f=a.extend(function(e,t,a){var n=i.deferred();return this.setActiveCriteria=function(i,n){(n=n||{}).contextId=t,n.widgetId=n.widgetId||a,m.setActiveCriteria(i,e,n)},this.redrawCriteria=function(i){(i=i||{}).contextId=t,i.widgetId=i.widgetId||a;try{return m.redrawCriteria(e,i,"NGFilter"===e)}catch(e){throw e}},this.getDisplayStatus=function(){return m.getDisplayStatus(t)},this.getInitPromise=function(){return n.promise},this._getInitDeferredPromise=function(){return n},this}),m=t.singleton({init:function(t){h=h||{},u=u||{},t=t||{};var i=[],a=[],n=!1;this.setAsSimplified=function(){n=!0},this.addOpacity=function(){e.extendElement(document.getElementById("active-tags")).toggleClassName("add-opacity",!0)},this.setupActiveCriteria=function(t){var i,a;if(!e.is(t,"object"))return console.error("Invalid input arg"),null;if(!T(t.id))return console.error("Id is not a valid string"),null;if(!T(t.container))return console.error("Invalid container id"),null;if(!T(t.contextId)){if(!T(t.widgetId))return console.error("contextId and widgetId are not valid strings"),null;e.is(p,"function")?t.contextId=p(t.widgetId):(console.warn("Sorry, I don't have the function to recover contextId from widgetId yet. Opening tagger may resolve this issue"),t.contextId="orphan_-_"+t.widgetId)}return T(t.module,/^DS(\/\w+)+$/gi)?(e.is(t.widgetId2contextId,"function")&&(p=t.widgetId2contextId,function(){var t,i,a,n,s=Object.keys(h).filter(function(e){return"orphan"===e.split("_-_")[0]});for(t=0;t<s;t++)if(i=s[t].split("_-_").shift().join("_-_"),T(a=p(i)))for(n in h[s[t]])h[a][n]=e.clone(h[s[t]][n]),delete h[s[t]][n]}()),i=new f(t.id,t.contextId,t.widgetId),require([t.module],function(s){var o,r,l,c=new s;c&&"function"==typeof c.setActiveCriteria&&"function"==typeof c.criteriaToHTML||console.error("class provided is not valid"),h[t.contextId]=h[t.contextId]||{},a=e.extendElement(document.getElementById(t.container)),o=h[t.contextId][t.id]&&h[t.contextId][t.id].view||[],r=h[t.contextId][t.id]&&h[t.contextId][t.id].container||[],l=h[t.contextId][t.id]&&h[t.contextId][t.id].proxy||[],o.push(a?v(a,n):null),r.push(a||t.container),l.push(i),h[t.contextId][t.id]={container:r,view:o,setActiveCriteria:c.setActiveCriteria,criteriaToHTML:c.criteriaToHTML,getCriterionFromDOMId:"function"==typeof c.getCriterionFromDOMId?c.getCriterionFromDOMId:void 0,proxy:l},i._getInitDeferredPromise().resolve()}),i):(console.error(t.module+" : is not a valid module path"),null)},this.setActiveCriteria=function(e,t,i){var a;T(i.contextId)&&h.hasOwnProperty(i.contextId)&&T(t)&&h[i.contextId].hasOwnProperty(t)&&(i.isSimplified=n,a=h[i.contextId][t].setActiveCriteria(e,i),u[i.contextId]=u[i.contextId]||{},u[i.contextId][t]=u[i.contextId][t]||{},a.allproxies&&(u[i.contextId][t].allproxies=a.allproxies),a.localfilters&&T([i.widgetId,i.proxyId])&&(u[i.contextId][t][i.widgetId]=u[i.contextId][t][i.widgetId]||{},u[i.contextId][t][i.widgetId][i.proxyId]=u[i.contextId][t][i.widgetId][i.proxyId]||{},u[i.contextId][t][i.widgetId][i.proxyId].localfilters=a.localfilters),a.groupings&&T([i.widgetId,i.proxyId])&&(u[i.contextId][t][i.widgetId]=u[i.contextId][t][i.widgetId]||{},u[i.contextId][t][i.widgetId][i.proxyId]=u[i.contextId][t][i.widgetId][i.proxyId]||{},u[i.contextId][t][i.widgetId][i.proxyId].groupings=a.groupings),a.allgroupings&&(u[i.contextId][t].allgroupings=a.allgroupings))},this.redrawCriteria=function(r,g,p){var f,m,C,w;if(g.getProxyFilters=function(e,t){if(t&&T([t.widgetId,t.proxyId]))return e&&e[t.widgetId]&&e[t.widgetId][t.proxyId]?e[t.widgetId][t.proxyId].localfilters:void 0},g.isSimplified=n,n&&(g.withoutPredHeader=!0,g.withRootIcon=!0),T(g.contextId)&&h.hasOwnProperty(g.contextId))if(T(r)&&h[g.contextId].hasOwnProperty(r)){if(w=!0,f=n?"":function(e,t,i){var a="";return a+='<div class="section-header" data-rec-id="active-tags-header">',a+='<span class="section-header-left active-tags-close fonticon fonticon-trash" id="trash-_-'+t+'" data-rec-id="active-tags-close"></span>',a+='<div class="header-title" id="'+(e=e||"")+'">',a+='<div class="arrow"><span class="fonticon fonticon-down-dir"></span><span class="fonticon fonticon-right-dir"></span></div>',a+=(i||o.getText("activeFilters"))+"</div></div>"}("activeFilters",g.contextId,g.headerTitle),f+='<div id="active-tags-list" class="expandable" style="overflow:inherit;height: auto;"><div class="innerForTransition">',f+=`<div class="active-tags-title">${o.getText("activeTagsHeader")}</div>`,h[g.contextId]&&u[g.contextId]&&(h[g.contextId].NGFilter&&u[g.contextId].NGFilter&&(C=h[g.contextId].NGFilter.criteriaToHTML(u[g.contextId].NGFilter,UWA.clone(g)),w=w&&!T(C),f+=C),h[g.contextId].searchCriteria&&u[g.contextId].searchCriteria&&(C=h[g.contextId].searchCriteria.criteriaToHTML(u[g.contextId].searchCriteria,UWA.clone(g)),w=w&&!T(C),f+=C),h[g.contextId].taggerCriteria&&u[g.contextId].taggerCriteria)){var b=UWA.clone(g);if(p){var y=u[g.contextId].taggerCriteria;if(UWA.is(y,"object")){var S=y[g.widgetId];if(UWA.is(S,"object")){var I=Object.keys(S);if(1===I.length){var E=t[I[0]];E&&E.isActive()&&E.getNavImpl().getFocusedProxy()===E&&(b.proxyId=I[0])}}}}C=h[g.contextId].taggerCriteria.criteriaToHTML(u[g.contextId].taggerCriteria,b),w=w&&!T(C),f+=C}if(f+=`<div class="active-tags-close" id= trash-_-${g.contextId}><span class="fonticon fonticon-trash"></span><span class="clear-label">${o.getText("clearActiveTags")}</span></div>`,f+="</div></div>",n&&g.isEmbedded){return{isEmpty:w,generatedHtml:f}}i.forEach(function(e){e.destroy()}),i=[],a.length>0&&(a.forEach(function(e){e.destroy(),e=null}),a=[]);var x=function(e){e.getElements("li.tag").forEach(function(e){var t=e.getAttribute("predicate-name");if(t){t.contains("sixw:")&&(t=t.replace("sixw:",""));var i,n=d.getPredicate(t);n?i=n.displayName():c.warn("predivcate NOT found on the active Tag for predicateId ="+t);var o=i?i+": "+e.getElement(".title").getText():e.getElement(".title").getText();a.push(new s({position:"bottom",target:e.getElement(".tag-label .title"),body:o,className:"title-tooltip"}))}else c.warn("predicateId not found on the active Tag")})};for(m in h[g.contextId])h[g.contextId][m].container.forEach(function(t,a){if(t instanceof HTMLElement||(t=e.extendElement(document.getElementById(t))||t,h[g.contextId][m].view[a]=t instanceof HTMLElement?v(t,n):void 0,h[g.contextId][m].container[a]=t),t instanceof HTMLElement)if(w)try{t.empty(!0),t.setContent(""),t.setStyle("display","none")}catch(e){throw e}else try{if(n)require(["DS/Controls/Expander"],function(i){t.empty(!0);var a=e.createElement("div",{id:"trash-_-"+g.contextId,class:"active-tags-close"}),n=e.createElement("span",{class:"fonticon fonticon-trash"}).inject(a);new s({position:"bottom",target:n,body:o.getText("clearActiveTags"),className:"tagger-filter-tooltip"}),new i({domId:"tn-active-tags",header:g.headerTitle?g.headerTitle:o.getText("activeTagsHeader"),body:e.createElement("div",{html:f}),style:"styled",customHeader:a,expandedFlag:!0,touchMode:!0}).inject(t),x(t);let r=t.getElement(".appCriteria").parentElement;r&&r.classList.value.includes("NGFilter")?r.style.width="100%":r.removeAttribute("style");let l=document.getElementsByClassName("column left shown maximized"),c=t.getClosest(".activeCriteriaScrollerHeight");if(c)if(l.length>0){let e=t.getClosest("#active-tags-cont").clientHeight;c.style.height=e+"px"}else c.style.removeProperty("height")});else{t.hasClassName("expanded-section")||t.addClassName("expanded-section"),t.empty(!0),t.setContent(f);var r=t.getElement(".active-tags-close");r&&i.push(new s({position:"bottom",target:r,body:l.getOption("allowUserPreferredTags")?o.getText("clearNonPinnedActiveTags"):o.getText("clearActiveTags"),className:"tagger-clearAllTags-tooltip"}))}t.setStyle("display","block")}catch(e){throw e}})}else;else;},this._embeddedTaggerCreateActiveCriteriaView=function(e,t){return v(e,t)},this.getDisplayStatus=function(t){return!(!e.is(h[t],"object")||0===Object.keys(h[t]).length)&&Object.keys(h[t]).some(function(e){return 0!==h[t][e].container.length&&h[t][e].container.some(function(e){return e instanceof HTMLElement&&"none"!==e.getStyle("display")})})},this._getActiveTagTooltips=function(){return a}}});function v(e,t){var i;return t?e.hasClassName("simplifiedActiveCriteria")||e.addClassName("simplifiedActiveCriteria"):(e.hasClassName("section")||e.addClassName("section"),e.hasClassName("active-tags")||e.addClassName("active-tags")),new(n.extend({container:e,domEvents:{"click .tag":"clickCriteriaEvent","click .tag[grouped]":"removeActiveGrouping","click .local-tag":"clickCriteriaEvent","click .tag-with-actions":"clickGlobalCriteriaEvent","click .tag-dropdown":"clickGlobalCriteriaEvent","click .active-tags-close":"clickTrashEvent"},clickGlobalCriteriaEvent:function(t){i&&i.destroy();var a=t.target.parentElement;if("SPAN"===a.nodeName&&(a=a.parentElement),!(-1!==t.target.getClosest(".tag").className.indexOf("disable"))){var n,s,l,c;n=t.target.getClosest(".appCriteria").id.split("-_-"),s=t.target.getClosest(".tag").id,l=-1!==t.target.getClosest(".tag").className.indexOf("pinned");var d=-1!==t.target.getClosest(".tag").className.indexOf("canBePinned"),u=-1!==t.target.getClosest(".tag").className.indexOf("isExcluded"),p=-1!==t.target.getClosest(".tag").className.indexOf("canBeExcluded");c=[{text:o.getText("removeTag"),name:"remove",fonticon:"trash"}],l?c.unshift({text:o.getText("unPinTag"),name:"unpin",fonticon:"pin-off"}):d&&c.unshift({text:o.getText("pinTag"),name:"pin",fonticon:"pin"}),u?c.unshift({text:o.getText("unexludeTag"),name:"unexclude",fonticon:"block"}):p&&c.unshift({text:o.getText("excludeTag"),name:"exclude",fonticon:"block"});var f=r.extend({getDisplayContext:function(){var e={},t=(this.options,document.documentElement);return e.viewportWidth=t.clientWidth||window.innerWidth,e.viewportHeight=t.clientHeight||window.innerHeight,e.scrollTop=window.pageYOffset||document.body.scrollTop||t.scrollTop,e}});(i=new f({target:a,items:c,renderTo:t.target.getClosest("#active-tags"),events:{onClick:function(e,i){"remove"===i.name?(g.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"onClick-RemoveTag",persDim:{pd1:"Remove Tag from menu"}}}),h.hasOwnProperty(n[1])&&h[n[1]].hasOwnProperty(n[0])&&h[n[1]][n[0]].proxy.forEach(function(e){h[n[1]][n[0]].getCriterionFromDOMId&&(s=h[n[1]][n[0]].getCriterionFromDOMId(s)),e.dispatchEvent("onCriteriaRemove",[s,t])})):"pin"===i.name?h.hasOwnProperty(n[1])&&h[n[1]].hasOwnProperty(n[0])&&h[n[1]][n[0]].proxy.forEach(function(e){h[n[1]][n[0]].getCriterionFromDOMId&&(s=h[n[1]][n[0]].getCriterionFromDOMId(s)),e.dispatchEvent("onCriteriaPin",[s,t])}):"unpin"===i.name?h.hasOwnProperty(n[1])&&h[n[1]].hasOwnProperty(n[0])&&h[n[1]][n[0]].proxy.forEach(function(e){h[n[1]][n[0]].getCriterionFromDOMId&&(s=h[n[1]][n[0]].getCriterionFromDOMId(s)),e.dispatchEvent("onCriteriaUnpin",[s,t])}):"exclude"===i.name?h.hasOwnProperty(n[1])&&h[n[1]].hasOwnProperty(n[0])&&h[n[1]][n[0]].proxy.forEach(function(e){h[n[1]][n[0]].getCriterionFromDOMId&&(s=h[n[1]][n[0]].getCriterionFromDOMId(s)),e.dispatchEvent("onCriteriaExclude",[s,t])}):"unexclude"===i.name&&h.hasOwnProperty(n[1])&&h[n[1]].hasOwnProperty(n[0])&&h[n[1]][n[0]].proxy.forEach(function(e){h[n[1]][n[0]].getCriterionFromDOMId&&(s=h[n[1]][n[0]].getCriterionFromDOMId(s)),e.dispatchEvent("onCriteriaUnexclude",[s,t])})},onHide:function(){let t=document.getElementsByClassName("column left shown maximized"),i=e.getClosest(".activeCriteriaScrollerHeight");if(t.length>0){let t=e.getClosest("#active-tags-cont").clientHeight;i.style.height=t+"px"}else i.style.removeProperty("height")},onShow:function(){let t=document.getElementsByClassName("column left shown maximized"),i=e.getClosest(".activeCriteriaScrollerHeight");if(t.length>0){let t=e.getClosest("#active-tags-cont").clientHeight;i.style.height=t<200?"200px":t+"px"}else i.style.removeProperty("height")}}})).show()}t.stopPropagation(),t.preventDefault()},clickCriteriaEvent:function(e){var t,i,a=e.target.getClosest(".tag");if(!(a.hasAttribute("grouped")||e.target.getClosest(".tag-with-actions")instanceof HTMLElement))return a.getAttribute("proxy-name")?((t=[]).push(a.getAttribute("proxy-name")),t.push(a.getAttribute("context-id"))):t=e.target.getClosest(".appCriteria").id.split("-_-"),g.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickCriteriaEvent",persDim:{pd1:"Remove a tag from active criteria"}}}),i=a.id,h.hasOwnProperty(t[1])&&h[t[1]].hasOwnProperty(t[0])&&h[t[1]][t[0]].proxy.forEach(function(a){h[t[1]][t[0]].getCriterionFromDOMId&&(i=h[t[1]][t[0]].getCriterionFromDOMId(i)),a.dispatchEvent("onCriteriaClick",[i,e])}),!1},clickTrashEvent:function(e){var t,i,a=[];if(t=e.target.getClosest(".active-tags-close").id.split("-_-")[1],h.hasOwnProperty(t))for(i in h[t])h[t][i].container.forEach(function(n){-1===a.indexOf(n.id)&&(h[t][i].proxy.forEach(function(t){t.dispatchEvent("onTrashClick",e)}),a.push(n.id))})},removeActiveGrouping:function(e){c.log("inside removeActiveGrouping");var t=e.target.getClosest(".appCriteria").id.split("-_-"),i=e.target.getClosest(".tag"),a={predicate:i.getAttribute("predicate")};i.hasAttribute("is_predicate")?a.isPredicate=!0:a.text=i.getElement(".tag-label .title").getText(),h.hasOwnProperty(t[1])&&h[t[1]].hasOwnProperty(t[0])&&h[t[1]][t[0]].proxy.forEach(function(e){e.dispatchEvent("onGroupingClick",a)})}}))}function T(e,t){if(e&&"string"==typeof e)return!(0===e.length||t&&t instanceof RegExp&&!t.test(e));if(e instanceof Array){for(var i=0;i<e.length;i++)if(!e[i]||"string"!=typeof e[i]||0===e[i].length||t&&t instanceof RegExp&&!t.test(e[i]))return!1;return!0}return!1}return m}),define("DS/TagNavigator/Filter",["UWA/Core","DS/TagNavigator/TagValue","DS/TagNavigator/Logger"],function(e,t,i){"use strict";var a,n=[].slice;return a=function(e){var t,i,s,o,r;if(s=(o=2<=arguments.length?n.call(arguments,1):[])[0],r=2<=o.length?n.call(o,1):[],!(i=e?e[s]:void 0))return!1;if(r?r.length:null){if(t=(t=[i]).concat(r),!a.apply(null,t))return!1;if(Object.keys(i).length>0)return!0}return delete e[s]},function n(){var s,o,r,l,c,d,g;d={},g={},r=function(e,t,i){return a(d,e,t,i)},s=function(t,i,a,n,s,o){var r,l;if(!(t&&i&&a&&n))throw new Error("Unexpected Error");r=(r=(l={})[t]={})[i=i+"-"+(s?"composite":typeof a)]={};var c=s?a.join("#"):a;return r[c]={disp:n,uri:a},UWA.is(o,"boolean")&&(r[c].excluded=o),e.extend(d,l,!0),!!(d[t]&&d[t][i]&&d[t][i][a])};var h=function(e){var t,i,a,n,s;if(t=e.pred.getFullPredicateID(),i=e.type+"-"+(e.isComposite?"composite":typeof e.uri),a=e.isComposite?e.uri.join("#"):e.uri,!(s=(n=d[t])&&n[i]?n[i][a]:null)&&"date"==e.type){var o=n?n[i]:null;if(o)for(var r=Object.keys(o),l=0;l<r.length;l++)if(-1!=r[l].indexOf(e.uri)||-1!=e.uri.indexOf(r[l])){s=o[r[l]];break}}return s};return l=function(e,t,a){if(!(e&&t&&a))throw new Error("Unexpected Error");i.log("Inside deleteAttribute, attribute="+e+", type="+t+", value="+(UWA.is(a,"object")?JSON.stringify(a):a));var n,s=!1;n=g[e="sixw:"+e];var o=UWA.is(a,"object")&&a.isSimplifiedCriteria;if(i.log("_sattribute BEFORE deleteAttribute = "+JSON.stringify(g)),n&&n[t])switch(t){case"string":case"boolean":var r=n[t].findIndex(function(e){return e.value===a});-1!==r&&n[t].splice(r,1),s=0===n[t].length;break;default:if(o){var l=n[t].findIndex(function(e){if(e.isSimplifiedCriteria&&e.from===a.from&&e.to===a.to)return!0});-1!==l&&n[t].splice(l,1),s=0===n[t].length}else{var c=n[t].findIndex(function(e){return!e.isSimplifiedCriteria});if(1===c)throw new Error("ERROR: criteria to remove does not exist");var d=n[t][c];a.from&&delete d.from,a.to&&delete d.to,d.excluded&&delete d.excluded,0===Object.keys(d).length&&n[t].splice(c,1),s=0===n[t].length}}return s&&delete g[e],i.log("_sattribute after deleteAttribute = "+JSON.stringify(g)),s},o=function(t,a,n,s){if(!(t&&a&&n))throw new Error("Unexpected Error");i.log("Inside addAttribute, attribute="+t+", type="+a+", value="+(UWA.is(n,"object")?JSON.stringify(n):n)+", nls="+s);var o=!1;s=s||n;var r=UWA.is(n,"object")&&n.isSimplifiedCriteria;i.log("_sattribute BEFORE addAttribute = "+JSON.stringify(g)),t.contains("sixw:")||(t="sixw:"+t),g[t]||(g[t]={});var l=g[t][a];switch(l||(l=g[t][a]=[]),a){case"boolean":case"string":var c={value:n,nls:s||n},d=-1;l.length>0&&(d=l.findIndex(function(e){return e.value===c.value})),-1===d&&l.push(c);break;default:if(r)l.length>0&&(o=l.every(function(e){if(e.isSimplifiedCriteria&&e.from===n.from&&e.to===n.to)return!0})),o||l.push(n);else{var h=l.filter(function(e){return!e.isSimplifiedCriteria});h.length>0?e.extend(h[0],n):l.push(n)}}return i.log("_sattribute after addAttribute = "+JSON.stringify(g)),!0},c=function(){var t,i,a,n,s;for(t={},s=function(){return!0},i=0,a=(n=["filterPredicates","filterTypes","filterValues"]).length;i<a;i++)t[n[i]]=s;return function(i,a,n){var s,o,r,l,c,g,h;for(l in o=e.clone(t),e.extend(o,a),d)if(o.filterPredicates(l))for(c in g=d[l])if(o.filterTypes(c)||o.isPartOfCompositeFilter&&o.isPartOfCompositeFilter(c))for(h in r=g[c])s=r[h].disp,o.filterValues(r[h].uri,r[h].excluded)&&(n?i(r[h]):i(l,r[h].uri,s,c));return this}}(),{each:function(e,i){return c(function(i,a,n,s){return e(t.getTagValue(i,n,a,s))},i),this},isEmpty:function(){return 0===Object.keys(d).length&&0===Object.keys(g).length},count:function(){return Object.keys(d).length+Object.keys(g).length},isSelected:function(e,t){var i,a,n,s;return i=e.pred.getFullPredicateID(),a=e.type+"-"+(e.isComposite?"composite":typeof e.uri),n=e.isComposite?e.uri.join("#"):e.uri,!!((s=d[i])&&s[a]&&s[a][n])||!(!s||-1===Object.keys(s).findIndex(function(i){if(-1!==i.indexOf("composite")){var a=s[i];if(-1!==Object.keys(a).findIndex(function(i){return UWA.is(e.uri,"array")?t?e.uri.every(function(e){return-1!==a[i].uri.indexOf(e)}):e.uri.length<=a[i].uri.length?e.uri.every(function(e){return-1!==a[i].uri.indexOf(e)}):a[i].uri.every(function(t){return-1!==e.uri.indexOf(t)}):-1!==a[i].uri.indexOf(e.uri)}))return!0}}))},isSelectedDate:function(e){var t,i,a;e.parent?e.parent.parent?t=!0:i=!0:a=!0;var n=this.getSelectedTagValues(e.pred.getFullPredicateID());if(n.length>0){var s=n.findIndex(function(n){return t?n.uri==e.uri:i||a?-1!=n.uri.indexOf(e.uri):void 0});if(-1!=s)return n[s]}},isSelectedAttribute:function(e,t){if(UWA.is(e,"string")&&UWA.is(t,"object")){var i=g[e];if(UWA.is(i,"object")&&(i=i[t.type],UWA.is(i,"array")&&i.length>0&&UWA.is(t.object,"object")))return-1!==i.findIndex(function(e){var i=!1;switch(t.type){case"date":case"integer":case"double":case"float":i=e.from===t.object.from&&e.to===t.object.to}return i})}},getSelectedAttributes:function(e){if(!e)return null;var t,i,a,n,s;for(a in t=(s={})[e]=[],i=g[e])if("string"!=a||"boolean"!=a)for(var o=0;o<i[a].length;o++)n={object:{from:i[a][o].from,to:i[a][o].to},type:a},t.push(n);return s},excludeAttribute:function(e,t,i,a){if(!e)return null;var n,s;for(s in n=g[e])if("string"!=s||"boolean"!=s)for(var o=0;o<n[s].length;o++){let e=n[s][o].nls?n[s][o].nls:void 0;(e&&e==t||i&&n[s][o].from&&i.from&&n[s][o].to&&i.to&&n[s][o].to==i.to&&n[s][o].from==i.from||i&&n[s][o].from&&i.from&&n[s][o].from==i.from||i&&n[s][o].to&&i.to&&n[s][o].to==i.to)&&(a?n[s][o].excluded=!0:n[s][o].excluded&&delete n[s][o].excluded)}},getSelectedTagValues:function(e){var t,i,a=[];return t={filterPredicates:function(t){return t===e}},i=function(e){a.push(e)},this.each(i,t),a},clear:function(){return d={},g={},this},computeDates:function(e,i){var a,n;return n={disptext:(a=t.getTagValue({object:i.uri,sixw:e,type:"date"})).displayValue},a.parent&&(n.parent={disptext:a.parent.displayValue,object:a.parent.uri,type:"date"},i.excluded&&(n.parent.excluded=i.excluded),a.parent.parent&&(n.parent.parent={disptext:a.parent.parent.displayValue,object:a.parent.parent.uri,type:"date"},i.excluded&&(n.parent.parent.excluded=i.excluded))),n},computeFilterObj:function(t,i,a,n,s){var o,r,l,c,h,u,p,f,m,v,T,C,w,b,y,S,I,E;if(o=(c={}).allfilters={},i=i||{},!1!==a)for(h in d)for(f in p=o[h]=[],m=d[h])for(v in l=m[f]){r=l[v].disp;var x=-1!==f.indexOf("composite");x&&!s?l[v].uri.forEach(function(e){u={disptext:r,object:e,type:f.split("-")[0],field:["implicit"]},l[v].excluded&&(u.excluded=!0),p.push(u)}):("date-string"==f&&a&&(E=this.computeDates(h,l[v])),u={disptext:E?E.disptext:r,object:l[v].uri,type:f.split("-")[0],field:x?["implicit"]:i[h+f.split("-")[0]+v+f.split("-")[1]]?Object.keys(i[h+f.split("-")[0]+v+f.split("-")[1]]):[],parent:E?E.parent:void 0},x&&s&&(u.isComposite=!0),l[v].excluded&&(u.excluded=!0),p.push(u),E=null)}if(!a||s)for(b in g)for(S in y=g[b],w=o[b=b.replace("sixw:void/","sixw:")]=[],y){if(!e.is(y[S],"array"))throw new Error("ERROR: INVALID data in filter..");if("string"===S||"boolean"===S)for(var _=y[S],A=0;A<_.length;A++)I={object:_[A].value,type:S,displayValue:_[A].nls},y[S][A].hasOwnProperty("excluded")&&(I.excluded=y[S][A].excluded),w.push(I);else for(var N=0;N<y[S].length;N++)I={type:S,object:{from:y[S][N].from,to:y[S][N].to},displayValue:y[S][N].nls,isSimplifiedCriteria:y[S][N].isSimplifiedCriteria},y[S][N].hasOwnProperty("excluded")&&(I.excluded=y[S][N].excluded),w.push(I)}if(t){for(h in c.allfilters)if(t.allfilters[h])for(T=0,C=c.allfilters[h].length;T<C;T++)"date"===c.allfilters[h][T].type?c.allfilters[h][T].object.length>t.allfilters[h][T].object.length&&(t.allfilters[h]=c.allfilters[h]):t.allfilters[h].push(c.allfilters[h][T]);else t.allfilters[h]=c.allfilters[h];return t}return c},removeFreeInput:function(e,t,i,a,n){return l(e,t,i)},createFreeInput:function(e,t,i,a,n){return o(e,t,i,a)},toggle:function(e,t){var i,a,n,o,l,g,u;a=e.pred.getFullPredicateID(),n=e.type,l="date"===n,o=e.uri,i=!1,g=!1;var p=!1;return c(function(t,i,a,n){if(g)throw new Error("Unexpected error");if(l){var s=h(e);s&&!0===s.excluded&&(p=!0)}return g=r(t,n,e.isComposite||u?i.join("#"):i)},{filterPredicates:function(e){return e===a},filterTypes:function(t){return t===n+"-"+(e.isComposite?"composite":typeof o)},isPartOfCompositeFilter:function(e){var t=d[a];if(t){var i=t[e],n=Object.keys(i).findIndex(function(e){return-1!==i[e].uri.indexOf(o)});if(-1!==n)return u=i[Object.keys(i)[n]],!0}},filterValues:function(e,a){return u?(i=!0,!0):(n=Array.isArray(e)?e.equals(o):e===o,l&&0===e.indexOf(o)&&(n=!0),n&&UWA.is(t,"boolean")&&(n=!!t&&!!a),i=i||n,n||l);var n}}),i&&l&&e.parent?(o=e.parent.uri,i=!1):!i&&g&&l&&!e.parent&&(i=!0),p&&(t=!0),!i&&s(a,n,o,e.displayValue,e.isComposite,t)},handleExclude:function(e,t){var i=h(e);if(i)if(t){if(i.excluded)throw new Error("Tag is already excluded !");i.excluded=!0}else{if(!i.hasOwnProperty("excluded"))throw new Error("Tag is NOT already excluded !");delete i.excluded}},isExcluded:function(e){var t=h(e);return!(!t||!t.hasOwnProperty("excluded"))&&t.excluded},_setAttributes:function(e,t){d=e,g=t},cloneFilter:function(){var e=new n;return e._setAttributes(UWA.clone(d),UWA.clone(g)),e}}}}),define("DS/TagNavigator/userTags/UserTagsModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","DS/TagNavigator/TaggerSettings"],function(e,t,i,a){"use strict";return t.extend(i,{defaults:{readOnly:!1,touchMode:!0,allowFreeTags:!0,showVocabularySuggestions:!0,showCommunitySuggestions:!1,showCompanySuggestions:!1},setup:function(e){this._parent(e),this.set("rootWs",a.getOption("simplifiedRootW"))}})}),define("DS/TagNavigator/simplified/activeTags/AdvActiveTagView",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TaggerNLS","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s,o){"use strict";return n.extend({domEvents:{click:"retrieveTag"},setup:function(e){this._parent(e)},render:function(){var t=this.getOption("isSimplified"),a=this.getOption("text"),n=this.getOption("icon"),s=this.getOption("isExcluded"),o=this.getOption("isPinned"),r=this.getOption("hasActions"),l=this.getOption("disabled"),c=this.getOption("attribute"),d=this.getOption("hasExcludeSupport");if(this.condition=this.getOption("condition"),this.renderTo=this.getOption("renderTo"),r&&this.container.addClassName("tag-with-actions"),l&&this.container.addClassName("disable"),o&&this.container.addClassName("pinned"),d&&!s&&this.container.addClassName("canBeExcluded"),c&&c.length>0){var g=this;c.forEach(function(e){g.container.setAttributes(e)})}var h=e.createElement("div",{class:"tag-elem"}).inject(this.container),u=e.createElement("div",{class:"tag-label"}).inject(h);n&&e.createElement("span",{class:"root-icon fonticon "+n}).inject(u),this.updateExclude(s);var p=e.createElement("div",{class:"title",html:a}).inject(u);if(n||p.setStyles({"padding-left":"5px"}),o&&e.createElement("span",{class:"fonticon fonticon-pin pinned"}).inject(h.getElement(".tag-label")),r){let t=e.createElement("span",{class:"tag-dropdown fonticon fonticon-down-open"});t.inject(h),t.setAttributes({title:""})}else t&&e.createElement("span",{class:"tag-del fonticon fonticon-cancel"}).inject(h);let f=a,m=this.getOption("predDispName");return m&&(f=m+": "+f),this.tooltip=new i({position:"bottom",target:u,body:f,className:"tagger-filter-tooltip"}),this},updateExclude:function(t){t?(this.container.addClassName("isExcluded"),e.createElement("span",{class:"fonticon fonticon-block excluded"}).inject(this.getElement(".tag-label"))):(this.container.hasClassName("isExcluded")&&this.container.removeClassName("isExcluded"),this.container.getElement(".excluded")&&this.container.getElement(".excluded").destroy())},retrieveTag:function(e){if(e.target.getClosest(".tag-with-actions")instanceof HTMLElement)return void this.clickOnTagActions(e);e.preventDefault();let t=this.condition,i=this.container;this.dispatchEvent("removeActiveTag",{option:t,target:i})},clickOnTagActions:function(e){let t=this;this.dropdownMenu&&this.dropdownMenu.destroy();let n=this.container,r=-1!==this.container.className.indexOf("isExcluded"),l=-1!==this.container.className.indexOf("canBeExcluded"),c=[{text:s.getText("removeTag"),name:"remove",fonticon:"trash"}];r?c.unshift({text:s.getText("unexludeTag"),name:"unexclude",fonticon:"block"}):l&&c.unshift({text:s.getText("excludeTag"),name:"exclude",fonticon:"block"});let d=a.extend({getDisplayContext:function(){let e={},t=document.documentElement;return e.viewportWidth=t.clientWidth||window.innerWidth,e.viewportHeight=t.clientHeight||window.innerHeight,e.scrollTop=window.pageYOffset||document.body.scrollTop||t.scrollTop,e}});this.dropdownMenu=new d({target:n,items:c,renderTo:t.renderTo?document.querySelector("#tagnavigator"):document.querySelector("body"),events:{onClick:function(e,i){let a=t.container;if("remove"===i.name){o.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"onClick-RemoveTag",persDim:{pd1:"Remove Tag from menu"}}});let e=t.condition;t.dispatchEvent("removeActiveTag",{option:e,target:a})}else if("exclude"===i.name){t.condition.condition?t.condition.condition.excluded=!0:t.condition.excluded=!0;let e=t.condition;t.container.removeClassName("canBeExcluded"),"date"==t.condition.type&&(t.condition.display&&t.condition.displayValue||(e.tagInfo=t.condition.object)),t.dispatchEvent("excludeTag",{option:e,target:a})}else if("unexclude"===i.name){t.container.addClassName("canBeExcluded"),t.condition.condition?t.condition.condition.excluded=!1:t.condition.excluded=!1;let e=t.condition;"date"==t.condition.type&&(t.condition.display&&t.condition.displayValue||(e.tagInfo=t.condition.object)),t.dispatchEvent("unexcludeTag",{option:e,target:a})}},onHide:function(){t.tooltip=new i({position:"bottom",target:t.container.getElement(".tag-label"),body:t.condition.tagName,className:"tagger-filter-tooltip"})},onShow:function(){t.tooltip&&t.tooltip.elements&&t.tooltip.destroy()}}}),this.dropdownMenu.show(),e.preventDefault(),e.stopPropagation()},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/ContextMenu",["UWA/Core","UWA/Class","DS/TagNavigator/TaggerNLS","DS/UIKIT/DropdownMenu"],function(e,t,i,a){"use strict";return t.extend({init:function(e){let t=this;this.createDropdown=function(e){this.target=e.target,this.view=e.view,this.dropdown=new a({className:"tn-ctx-menu",target:e.target,bound:!1,removeOnHide:!0,scrollMode:!1,contextual:!0,items:e.items,events:{onClick:function(e,i){t.onClickEvent(i.id)}.bind(t),onClickOutside:function(){t.dropdown.destroy()}.bind(t)}}).show(!1,e.evtObj)},this.onClickEvent=function(e){if("remove"===e&&console.log("Remove clicked!!!"),"exclude"===e||"include"===e){let t,i="exclude"==e;this.target.hasClassName("tag")&&(t=this.target.id),this.view.excludeTag(i,t),this.dropdown.destroy()}}}})}),define("DS/TagNavigator/simplified/model/PersonModel",["UWA/Core","UWA/Class/Model","UWA/Class/Debug","DS/TagNavigator/TaggerUtils"],function(e,t,i,a){"use strict";return t.extend(i,{defaults:{title:"",personInfo:null,tagValues:[],count:"",activePredicates:[],isExcluded:!1},setup:function(){this._parent()},getImage:function(){var e=this.get("personInfo");if(e&&1===e.get("nbMatches")){var t=e.get("imageURL");return 1===t.length?t[0]:a.defaultUserImage}return a.defaultUserImage},getCountry:function(){var e=this.get("personInfo");return e?e.get("country"):[]},getCountryCode:function(){var e=this.get("personInfo");return e?e.get("countryCode"):[]},getCity:function(){var e=this.get("personInfo");return e?e.get("city"):[]},isReady:function(){var e=this.get("personInfo");return!e||e.get("isReady")},getNbMatches:function(){var e=this.get("personInfo");if(e)return e.get("nbMatches")},getCount:function(){var e=this.getUniqueTagValuesPerPredicate(),t=[];for(var i in e){var a=e[i];t.push(a[0].count);for(var n=1;n<a.length;n++)t[t.length-1]+=a[n].count}return 1==t.length||t.every(function(e){return e==t[0]})?{exactCount:!0,count:t[0]}:t.reduce(function(e,t){return t>e?t:e},0)},getUniqueTagValuesPerPredicate:function(){var e=this.get("tagValues"),t={};return UWA.is(e,"array")&&e.forEach(function(e){var i=e.pred.id(),a=t[i];a?a.push(e):t[i]=a=[e]}),t},getApplicablePredicatesAsString:function(){var e=this.get("tagValues"),t="";return e.forEach(function(e,i){t+=(i>0?", ":"")+e.pred.id()}),t},getApplicablePredicates:function(){var e=this.get("tagValues"),t=[];return e.forEach(function(e,i){t.push(e.pred)}),t},getTagValueIds:function(){var e=this.get("tagValues"),t=[];return e.forEach(function(e){t.push(e.getUri())}),t},getRefineStructure:function(e){return{predicate:e||this.getApplicablePredicates()[0].getFullPredicateID(),object:this.getTagValueIds()[0],dispValue:this.get("title"),type:this.get("type")||"string"}}})}),define("DS/TagNavigator/simplified/utils/PersonUtils",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/TagNavigator/Logger","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerUtils","DS/TagNavigator/simplified/model/PersonModel","DS/TagNavigator/simplified/model/TagValueWrapper","DS/TagNavigator/simplified/model/PersonInfo","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TagNavigator/TagsServer"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u){"use strict";var p=t.singleton({PERSON_REFINE:"person_data",PERSON_PREDICATE:"person",PERSON_REFINE_PREDICATE:"ds6w:who/person",init:function(e){this.personPredicate=new c({sixw:this.PERSON_REFINE_PREDICATE,type:"string",displayName:d.getText("personTitle")})},userInfoCache:{},userInfoCache_ext:{},_expansionStatus:{},userInfoFetchingProgressCache:{},getUserInfoFromCache:function(e,t,i){if(e){var a=i?this.userInfoCache_ext[e]:this.userInfoCache[e];if(a)return a.get(t)}},getExpandStatus:function(e){return this._expansionStatus[e]},setExpandStatus:function(e,t){if(!UWA.is(t,"boolean"))throw new Error("invalid status:"+t);this._expansionStatus[e]=t},getUsersInfo:function(e,t,n){if(e){var s;if(UWA.is(t,"array")?s={allTagsOfType:t}:UWA.is(t,"string")&&(s={allTagsInheritingFromType:t}),s){var c={};e.eachTagValue(function(e,t){var i=e.getDisplayValue(),a=r.getWrapper(e,t);a.count=t,c[i]?c[i].tagValues.push(a):c[i]={tagValues:[a]}},s);var d,h=[],u=e.getTagsServerForUserInfo();u&&(d=u.getTenantName(),this.userInfoCache[d]||(this.userInfoCache[d]=new i([],{model:l})));var p=[];for(var f in c){var m=new o;if(h.push(m),c[f]&&(m.set("title",f),m.set("tagValues",c[f]&&c[f].tagValues?c[f].tagValues:[]),m.set("count",c[f].tagValues[0].count),m.set("expandStatus",this.getExpandStatus(f))),d){var v=this.getUserInfoFromCache(d,f);v||(v=new l({title:f}),this.userInfoCache[d].add(v),p.push(f)),m.set("personInfo",v)}}return g.getOption("offline6W")?a.warn("PersonUtils: Offline mode: Tagger won't fetch user data"):u&&p.length>0&&this._retriveUsersInfo(u,p,e.getUserInfo(),n),h}}},getUsersInfoFromSummary:function(e,t,n){var s=[],c=t.platformID;if(UWA.is(e,"array")&&c.length>0){var d=this,g={};e.forEach(function(e){var t=r.getWrapperFromTagInfo(e),i=t.displayValue;g[i]?g[i].tagValues.push(t):g[i]={tagValues:[t]}}),this.userInfoCache_ext[c]||(this.userInfoCache_ext[c]=new i([],{model:l}));var p=[];for(var f in g){var m=new o;s.push(m),g[f]&&(m.set("title",f),m.set("tagValues",g[f].tagValues),m.set("count",g[f].tagValues[0].count));var v=this.getUserInfoFromCache(c,f,!0);v||(v=new l({title:f}),this.userInfoCache_ext[c].add(v),p.push(f)),m.set("personInfo",v)}p.length>0?h.getServiceUrl({serviceName:"3DSearch",platformId:c,onComplete:function(e){d._retriveUsersInfo(new u(e,c,c),p,t.userId,function(){n(s)},!0)},onFailure:function(){a.error("FAILED to retrieve 3DSearch url for tenant: "+c),n(s)}}):n(s)}return s},_retriveUsersInfo:function(e,t,i,n,o){var r=this,l=[],c=e.getTenantName(),d=function(){t.forEach(function(e){a.log("computation is done for "+e);var t=r.getUserInfoFromCache(c,e,o);t&&t.set("isReady",!0)})},g=function(e){var t;UWA.is(e,"array")&&e.forEach(function(e){var i=s.buildFedSearchModel(e);if(i){t=i.get("ds6w:label");var n=r.getUserInfoFromCache(c,t,o);if(n){n.incrementNbMatches();var d=i.get("preview_url"),g=i.get("ds6w:country"),h=i.get("ds6w:city");d&&n.setArrayProperty("imageURL",d),g&&n.setArrayProperty("country",g),g&&n.setArrayProperty("countryCode",g),h&&n.setArrayProperty("city",h),l.push(n)}else a.warn("user info received for '"+i.get("ds6w:label")+"' is not in the tag value data")}})};e.getUsersInfo(i,t,function(t){t.forEach(function(e){e.then(g)}),Promise.all(t).then(function(){var t=function(){d(),UWA.is(n,"function")&&n(l)};r.translatePersonDetails(e,l).then(t,t)})},function(){d(),a.warn("FAILED to retrieve user info")})},translatePersonDetails:function(e,t){return new Promise(function(s,o){a.log("PersonUtils: handling the modle updates"),e&&UWA.is(t,"array")||o();var r=new i([],{model:l}),c=n.getPredicateNlsValueMap(e,"ds6w:country");if(t.forEach(function(e){e.get("country").forEach(function(t,i){if(t){var s=t.split("."),o=n.getTagValueNls(s[0],s[1]);o?e.setArrayProperty("country",o,i):(a.log("PersonUtils: add "+s[1]+" for translation"),r.add(e),c[s[1]]=!0)}})}),r.length>0){if(a.log("PersonUtils: number of modelsWithPendingNls = "+r.length),0!==Object.keys(n.getTvToTranslate()).length){a.log("TagValue.getTvToTranslate() OK");var d=n.getPredicateValue();a.log("nb promises to treat="+d.length),Promise.all(d).then(function(){a.log("update nls after all promises resolved"),r.forEach(function(e){var t=e.get("country");t.forEach(function(i,s){if(i){var o=i.split(".");if(o.length>1){var r=n.getTagValueNls(o[0],o[1]);r?(a.log(o[1]+" Nls="+r),e.setArrayProperty("country",r,s)):a.warn("NO NLS FOUND!!, title="+e.get("title")+", country="+t)}}})}),s()})}}else s()})},buildCondition:function(e,t,i,a){var n={id:p.PERSON_REFINE_PREDICATE,operator:a||"OR",isComplex:!0,condition:{type:"string",object:e instanceof o?e.get("title"):e.object,operator:"OR",value:[],display:e instanceof o?e.get("title"):e.dispValue,predicates:[]}};if(i&&(n.condition.excluded=i,n.condition.operator="AND"),e instanceof o)for(var s=e.get("tagValues"),r=0;r<s.length;r++){var l=s[r],c=l.pred,d=c.getFullPredicateID();t&&-1===t.indexOf(d)||(n.condition.predicates.push({predicate:d,type:c.getType()}),n.condition.value.push(l.getUri()))}return n},getExistingCondition:function(e,t){var i=e.getLocalFilter().computeFilterObj(!0),a=i.allfilters.condition.findIndex(function(e){return p.PERSON_REFINE_PREDICATE===Object.keys(e)[0]}),n=-1!==a?i.allfilters.condition[a]:void 0,s=void 0;return n&&(s=-1!==(a=n[Object.keys(n)[0]].condition.findIndex(function(e){return e.object===t}))?n[Object.keys(n)[0]].condition[a]:void 0),s},getActivePredicates:function(e,t){var i=[],a=this.getExistingCondition(e,t);return a&&a.predicates.map(function(e){i.push(e.predicate)}),i}});return p}),define("DS/TagNavigator/embeddedTagger/EmbeddedMenuItem",["UWA/Core","UWA/Utils","UWA/Class/View","DS/Handlebars/Handlebars","text!DS/TagNavigator/embeddedTagger/templates/EmbeddedMenuItemTemplate.html","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerUtils","DS/TagNavigator/simplified/model/CriteriaModel","DS/TagNavigator/simplified/model/PersonModel","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a,n,s,o,r,l,c,d,g){"use strict";return i.extend({tagName:"div",className:"tag-elem",template:a.compile(n),init:function(e){this.navImpl=e.navImpl,this.isPreciseCount=e.isPreciseCount,this._parent(e),this._catView=s.getOption("embeddedCategories"),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this._parent(e)},render:function(e,t){var i=this.template();return this.container.setContent(i),this.addContent(e,t),this._toggleTagSelection=this.onTagSelection.bind(this),this.container.addEvent("click",this._toggleTagSelection),this},addContent:function(){if(this.model instanceof d){this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.getImage()}),this.container.getElement(".tag-image").setStyles({width:"32px",height:"32px"}),this.container.getElement(".image-div").setStyle("display","inline-block");var e=this.model.getCount();this.hideTagsCount?this.container.getElement(".tag-count").setText(""):e.exactCount?this.container.getElement(".tag-count").setText(r.convertToUnity(e.count,this.isPreciseCount)):this.container.getElement(".tag-count").setText(r.getText("atleast")+" "+r.convertToUnity(e,this.isPreciseCount)),this.container.getElement(".tag-label").setStyle("margin-left","5px"),!!this.navImpl.getFocusedProxy()&&this.navImpl.getFocusedProxy().getLocalFilter().isSelected(g.buildCondition(this.model))&&this.container.addClassName("selected")}else if(this.model instanceof c&&(this.container.getElement(".tag-icon").addClassName("tn-"+this.model.get("level")),this.model.get("imageURL")?(this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".tag-image").setStyles({"border-radius":"0"}),this.container.getElement(".image-div").setStyle("display","inline-block"),this.container.getElement(".image-div").addClassName("tn-"+this.model.get("level"))):this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass")),this.getOption("selected")&&this.container.addClassName("selected"),this.container.getElement(".tag-count").setText(r.convertToUnity(this.model.get("count"),this.isPreciseCount)),this.model.get("rootIconClass"))){var i=this.model.get("rootIconClass").replace("fonticon-","");this.getElement(".tag-icon").addClassName("tn-"+i),this.getElement(".image-div").addClassName("tn-"+i)}this.container.getElement(".tag-label").setText(this.model.get("title")),this.setOption("identifier",t.getUUID().substr(0,6))},isSeparator:function(){return!1},setTitle:function(){this.container.getElement(".tag-label").setText(this.model.get("title"))},onTagSelection:function(e){this.container.toggleClassName("selected"),this.dispatchEvent("toggleSelection",{model:this.model})},updateCount:function(e){this.container.getElement(".tag-count").setText(r.convertToUnity(e,this.isPreciseCount))},destroy:function(){var e=this.getOption("subMenuItems");UWA.is(e,"array")&&e.forEach(function(e){e.destroy()}),this.container.removeEvent("click",this._toggleTagSelection),this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/actions/Select",["UWA/Core","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/simplified/utils/CriteriaUtils"],function(e,t,i,a,n){"use strict";return t.extend({setup:function(){this._parent(),this.set({actionClass:"selected"}),this._selection=this.get("selection")},onPredicateSelection:function(e){TNLog.log("No action on predicate selection during SELECT")},onTagSelection:function(e,t,a){return i.onTagMultiSelection(e,this._selection,t,a),this.get("isInteractive")&&(e.hasClassName("selected")&&!UWA.is(a,"boolean")&&(e.removeClassName("selected"),e.removeClassName("picked")),this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount())),!1},onPersonSelection:function(e){var t,i=e.view,n=e.refineData,s=e.isExcluded;if(e.hasOwnProperty("selectedPredicates")&&e.selectedPredicates){if(-1!==(r=this._selection.findIndex(function(t){if(UWA.is(t,"object")&&e.isComplex&&t.isComplex&&t.id==a.PERSON_REFINE_PREDICATE)return t.condition.object===i.model.get("title")}))&&this._selection.splice(r,1),e.selectedPredicates.length>0){var o=a.buildCondition(i.model,e.selectedPredicates);this._selection.push(o)}else o=a.buildCondition(i.model,e.selectedPredicates);t=o}else if(i.isSelected()&&!UWA.is(s,"boolean"))i.setAsUnselected(),i.updateExcludeIcon(!1),this.updateSelectedTags(e,n),t=n;else if(i.container.hasClassName("picked")&&!UWA.is(s,"boolean")){var r;if(i.container.removeClassName("picked"),-1!==(r=this._selection.findIndex(function(t){if(UWA.is(t,"object"))return e.isComplex?n.id==t.id&&n.condition&&t.condition&&n.condition.object===t.condition.object:n.object===t.object&&n.predicate===t.predicate&&n.excluded===t.excluded})))this._selection.splice(r,1),i.setAsUnselected();else{if(n.excluded)throw new Error("the tag is not already selected");i.setAsSelected();for(var l=0;l<this._selection.length;++l)this._selection[l].object===n.object&&(this._selection[l]=n)}t=n}else i.container.addClassName("picked"),i.setAsSelected(),UWA.is(s,"boolean")&&(s?(i.container.addClassName("excluded"),n.excluded=!0):(i.container.removeClassName("excluded"),n.excluded=!1)),this.updateSelectedTags(e,n),t=n;return this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount()),t},updateSelectedTags:function(e,t){let i=e.view;var a=this._selection.findIndex(function(i){if(UWA.is(i,"object"))return e.isComplex?t.condition&&i.condition&&t.condition.object===i.condition.object&&i.excluded&&!UWA.is(t.excluded,"boolean")?t.object===i.object&&t.predicate===i.predicate:t.id==i.id&&t.condition&&i.condition&&t.condition.object===i.condition.object&&t.excluded===i.excluded:i.excluded&&!UWA.is(t.excluded,"boolean")?t.object===i.object&&t.predicate===i.predicate:t.object===i.object&&t.predicate===i.predicate&&t.excluded===i.excluded});if(-1!==a)this._selection.splice(a,1),i.setAsUnselected();else if(0!=this._selection.length){var n,s=[];for(const e of this._selection)(e.id||e.dispValue)&&("ds6w:who/person"===e.id?s.push(e.condition.display):s.push(e.dispValue));if(n="ds6w:who/person"===t.id?t.condition.display:t.dispValue,s.includes(n))for(var o=0;o<this._selection.length;++o)this._selection[o].object&&t.object&&this._selection[o].object===t.object?this._selection[o]=t:this._selection[o].condition&&this._selection[o].condition.object&&t.condition&&t.condition.object&&this._selection[o].condition.object===t.condition.object&&(this._selection[o]=t);else this._selection.push(t)}else this._selection.push(t)},onDateSelection:function(e){this._selection.push(e.freeInputData),this.set("selectionCount",this.getSelectionCount()),console.log("The selection dates: "+JSON.stringify(this._selection))},removeDate:function(e){var t=this._selection.findIndex(function(t){if(t.type&&"date"==t.type&&t.to==e.to&&t.from==e.from)return t});this._selection.splice(t,1),this.set("selectionCount",this.getSelectionCount())}})}),define("DS/TagNavigator/simplified/views/CriteriaView",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","text!DS/TagNavigator/assets/templates/CriteriaViewTemplate.html","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/TaggerUtils","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s,o,r,l,c){"use strict";var d=t.extend({tagName:"li",className:"category with-expander",template:i.compile(a),subCriteriaViews:void 0,subCriteriaViewParentElem:void 0,parentView:void 0,updateCountCB:void 0,domEvents:{click:"onCriteriaClick","click .expand-icon-container":"onExpandClick",mouseover:"onHoverAdd",mouseout:"onHoverRemove","mouseover .expand-icon-container":"onHoverRemove"},init:function(e){this.subCriteriaViews=[],this.subCriteriaViewParentElem=null,this.parentView=null,this._parent(e),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this._parent(e)},render:function(){var e=this.template();return this.container.setContent(e),this.addContent(),this.updateCountCB=this.updateCount.bind(this),this.model.addEvent("onChange:count",this.updateCountCB),this},addContent:function(){if(n.NEW_TYPE_CATEGORY_ICONS){var t=this.container.getElement(".cat-icon"),i=this.container.getElement(".cat-lower-div");this.container.addClassName("category-v3"),t.addClassName("category-v3"),i.addClassName("category-v3")}if(this.container.getElement("li .cat-title").setText(this.model.get("title")),this.hideTagsCount){e.createElement("div",{id:"tn-noCount",class:"fonticon fonticon-menu-dot"}).inject(this.container.getElement("li .cat-count"))}else this.container.getElement("li .cat-count").setText(s.convertToUnity(this.model.getCount()));var a=this.model.get("level");this.container.addClassName(a);var r=this.model.get("iconClass");this.container.addClassName(r?r.replace("fonticon-",""):""),"level0"!==a&&this.model.isContainer()&&this.container.addClassName(Array.isArray(this.model.id)?this.model.id[this.model.id.length-1]:this.model.id);var l=this.container.getElement(".cat-lower-div");l.addClassName("tn-"+a);var c=this.container.getElement(".cat-icon");c.addClassName("tn-"+a);var d=this.model.get("rootIconClass");("level0"!=a||d&&"level0"===a)&&(c.addClassName("tn-"+d),l.addClassName("tn-"+d)),r?(c.addClassName(r),"level0"==a&&(c.addClassName(r.replace("fonticon","tn")),l.addClassName(r.replace("fonticon","tn")))):(c.removeClassName("fonticon"),e.createElement("img",{src:this.model.get("imageURL"),class:"type-icon"}).inject(c));let g=this.getOption("navImpl"),h=n.buildCondition(this.model),u=this;g.getTagPinnedFromCurrentContext().forEach(function(e){let t=JSON.parse(e.predicate);Array.isArray(t.object)&&h.condition.value.toString()===t.object.toString()&&u.container.addClassName("disabled-tag")}),this._tooltip=new o({position:"bottom",target:this.container.getElement(".cat-title"),body:this.model.get("title"),className:"title-tooltip"})},updateCount:function(){this.container.getElement("li .cat-count").setText(s.convertToUnity(this.model.getCount()))},getParentView:function(){return this.parentView},setParentView:function(t){if(this.parentView=t,this.model.get("hasNoIcon")){var i=this.container.getElement(".cat-icon");let t=this.parentView.model.get("iconClass");if(t)i.addClassName(t);else{let t=this.parentView.model.get("imageURL");t&&(i.removeClassName("fonticon"),e.createElement("img",{src:t,class:"type-icon"}).inject(i))}}},findViewById:function(e,t){var i=this.subCriteriaViews.filter(function(i){if(i.model.id==e)return i;if(t){var a=i.findViewById(e,t);if(UWA.is(a,"array"))return a[0]}});if(i.length>0)return i[0]},addSubCriteriaViews:function(t,i,a){if(this.addEvent("onCriteriaToggle",a.onCriteriaToggle),a.focusedAdvProxy)a.isRootSelected?this.setAsSelected():a.focusedAdvProxy.getLocalFilter().isSelected(n.buildCondition(this.model))&&this.setAsSelected();else{var s=this.model.isContainer();a.navImpl.isSelected(JSON.stringify(this.model.getRefineStructure(!0)[0]),s)&&this.setAsSelected()}if(this.model.isContainer()){this.addEvent("onCriteriaExpand",a.onCriteriaExpand),this.subCriteriaViewParentElem=e.createElement("li",{class:"sub-category "+t+("level0"==this.model.get("level")?"":" "+(Array.isArray(this.model.id)?this.model.id[this.model.id.length-1]:this.model.id))}).inject(i);var o=n.removeDuplicates(this.model.get("subCategories")),r=[],l=[];o.sortBy("title").forEach(function(e){e.isContainer()?r.push(e):l.push(e)}),this.model.set("count",o.length),this.model.set("subCategories",o),a.isMobileDevice&&o.length>1&&this.subCriteriaViews.push(new d({model:n.getAllCriteriaModel(this.model,o),taggerView:this.getOption("taggerView"),navImpl:this.getOption("navImpl")}).render().inject(this.subCriteriaViewParentElem));for(var c=r.concat(l),g=0,h=0;h<c.length;h++){c[h].set("rootIconClass",t);var u=new d({model:c[h],taggerView:this.getOption("taggerView"),navImpl:this.getOption("navImpl"),hideTagsCount:this.hideTagsCount}).render().inject(this.subCriteriaViewParentElem);u.setParentView(this),this.subCriteriaViews.push(u),u.model.get("selected")&&g++,u.addSubCriteriaViews(t,this.subCriteriaViewParentElem,a)}g==c.length&&this.setAsSelected()}else this.setAsLeaf(),this.container.addClassName(t);return this},onExpandClick:function(e){this.dispatchEvent("onCriteriaExpand",this)},onCriteriaClick:function(e){var t=this.getOption("taggerView");if(!(this.getOption("navImpl")||t.getObservedNavigator()).hasProxiesInEdition()){r.getDeviceAgent()&&c.enableMobileTypeCode();if(e.target.hasClassName("fonticon-expand-down"))return;if(t){var i=t.actionManager.getCurrentAction();if(i&&!n.isSupportedAction(t,i.id))return}this.container.toggleClassName("cat-selected")}this.dispatchEvent("onCriteriaToggle",[e,this])},onHoverAdd:function(e){this.container.addClassName("set-opacity")},onHoverRemove:function(e){this.container.removeClassName("set-opacity")},setAsUnselected:function(){this.container.removeClassName("cat-selected"),this.model.isContainer()&&(this.container.addClassName("with-expander"),this.container.getElement(".expand-icon-container").show())},setDisabledState:function(e){e?this.container.addClassName("disabled-tag"):this.container.removeClassName("disabled-tag")},setAsSelected:function(){this.container.addClassName("cat-selected"),this.model.set("selected",!0),this.model.isContainer()&&(this.container.removeClassName("with-expander"),this.container.getElement(".expand-icon-container").hide())},isSelectedForAction:function(e){return this.container.hasClassName(e)},setAsSelectedForAction:function(e){this.container.addClassName(e)},setAsUnselectedForAction:function(e){this.container.removeClassName(e)},getSelectedSubCategoriesForAction:function(e,t){this.subCriteriaViews.forEach(function(i){if(i.isSelectedForAction(e))t.push(i);else if(i.model.isContainer())return i.getSelectedSubCategoriesForAction(e,t)})},setAsLeaf:function(){this.container.removeClassName("with-expander")},setAsContainer:function(){this.container.addClassName("with-expander")},setAsExapnded:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","grid")},setAsCollapsed:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","none")},hideSubCriteria:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.hide()},showSubCriteria:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","grid")},showAllSubCriteria:function(){this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.setStyle("display","grid"),this.subCriteriaViews.forEach(function(e){e.show(),e.setAsCollapsed()})},showDefaultSubCriteria:function(){this.showSubCriteria(),this.subCriteriaViews.forEach(function(e){n.OTHER_MODEL_ID===e.model.id?e.show():n.ALL_MODEL_ID===e.model.id?e.show():!0===e.model.get("isOther")?e.hide():(e.show(),e.setAsCollapsed())})},searchSubCriteria:function(e,t){var i=0;return this.subCriteriaViews.forEach(function(t){n.OTHER_MODEL_ID===t.model.id?t.hide():n.ALL_MODEL_ID===t.model.id?t.hide():t.model.isContainer()?t.searchSubCriteria(e)>0?(i++,t.setAsExapnded()):(t.setAsCollapsed(),t.hideSubCriteria()):-1===t.model.get("title").toLowerCase().indexOf(e)?t.hide():(i++,t.show())}),this.hide(),i>0?(this.setAsExapnded(),this.showSubCriteria()):this.hideSubCriteria(),i>0},destroy:function(){this.stopListening(),this.model.removeEvent("onChange:count",this.updateCountCB),this.model=null,this.subCriteriaViewParentElem&&this.subCriteriaViewParentElem.destroy(),this.subCriteriaViews.forEach(function(e){e.destroy(),e=null}),this.subCriteriaViews=[],this._tooltip.destroy(),this._tooltip=null,this._parent()}});return d}),define("DS/TagNavigator/embeddedTagger/EmbeddedSeparatorMenuItem",["UWA/Core","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem"],function(e,t){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this},addContent:function(){},isSeparator:function(){return!0},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/utils/DateUtils",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/model/DateRangeModel"],function(e,t,i,a,n,s){"use strict";return t.singleton({init:function(){this.addLastYear=!0,this.defaultRanges=this.getDefaultRangs()},getDefaultRangs:function(){var e=new Date,t=this.getFormattedDate(e,!0),a=e.getMonth();this.year=e.getFullYear();var s=this.getWeekDays(e),o=new Date(this.year,a,1),r=new Date(this.year,a+1,0),l=new Date(this.year,0,1),c=new Date(this.year,11,31),d=t.split("/"),g=[];g.push({id:"today",title:n.getText("today"),object:[t],from:t,to:t,from_time:new Date(t+" 00:00:00").getTime(),to_time:new Date(t+" 23:59:59").getTime(),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-day.png"});var h={id:"thisWeek",title:n.getText("this_week"),object:this.getFormattedWeekDays(s),from:this.getFormattedDate(s[0],!0),to:this.getFormattedDate(s[6],!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-week.png"};h.from_time=new Date(h.from+" 00:00:00").getTime(),h.to_time=new Date(h.to+" 23:59:59").getTime(),g.push(h);var u={id:"thisMonth",title:n.getText("this_month"),object:[d[0]+"/"+d[1]],from:this.getFormattedDate(o,!0),to:this.getFormattedDate(r,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-range.png"};u.from_time=new Date(u.from+" 00:00:00").getTime(),u.to_time=new Date(u.to+" 23:59:59").getTime(),g.push(u);var p={id:"thisYear",title:n.getText("this_year"),object:[d[0]],from:this.getFormattedDate(l,!0),to:this.getFormattedDate(c,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/calendar.png"};if(p.from_time=new Date(p.from+" 00:00:00").getTime(),p.to_time=new Date(p.to+" 23:59:59").getTime(),g.push(p),this.addLastYear){var f=this.year-1,m=new Date(f,0,1),v=new Date(f,11,31),T={id:"lastYear",title:n.getText("last_year"),object:[f+""],from:this.getFormattedDate(m,!0),to:this.getFormattedDate(v,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/last-year.png"};T.from_time=new Date(T.from+" 00:00:00").getTime(),T.to_time=new Date(T.to+" 23:59:59").getTime(),g.push(T)}return g},_getOlderRange:function(){if(!this._olderRange){var e=new Date(this.addLastYear?this.year-2:this.year-1,11,31);this._olderRange={id:"older",title:n.getText("older"),object:void 0,from:void 0,to:this.getFormattedDate(e,!0),imageURL:i.getWebappsBaseUrl()+"TagNavigator/assets/icons/calendar.png"},this._olderRange.to_time=new Date(this._olderRange.to+" 23:59:59").getTime()}return UWA.clone(this._olderRange)},getFormattedDate:function(e,t){if(e)return t?e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2):("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()},getFormattedWeekDays:function(e){return e.map(function(e){return this.getFormattedDate(e)}.bind(this))},getWeekDays:function(e){for(var t=[],i=new Date(e),a=1;a<=7;a++){var n=e.getDate()-e.getDay()+a,s=new Date(i.setDate(n));t.push(s)}return t},buildCondition:function(e,t){if(a.getPredicate(t)){var i={predicate:a.getPredicate(t),value:{nls:e.get("title"),isSimplifiedCriteria:!0},type:"date"};return e.get("from")&&(i.value.from=e.get("from")),e.get("to")&&(i.value.to=e.get("to")),i}return!1},getRangeDetails:function(e,t){var i,a=e.getRangeDefine(t);return a||(a=UWA.clone(this.defaultRanges),(e.hasFreeInputSupport(t)||e.hasFreeInputOnly(t))&&a.push(this._getOlderRange())),a.forEach(function(e){e.tagValues=[],e.count=0}),e.eachTagValue(function(e,t){if(3==e.uri.split("/").length){var n=new Date(e.uri+" 00:00:00").getTime();a.forEach(function(a){i=!1,a.from_time&&a.to_time?n>=a.from_time&&n<=a.to_time&&(a.tagValues.push(e),i=!0):a.from_time&&!a.to_time?n>=a.from_time&&(a.tagValues.push(e),i=!0):!a.from_time&&a.to_time&&n<=a.to_time&&(a.tagValues.push(e),i=!0),i&&t>0&&(a.count+=t)})}},{allTagsOfType:[t]}),a.map(function(e){return new s(e)})}})}),define("DS/TagNavigator/simplified/views/CriteriaListView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/views/CriteriaView","DS/TagNavigator/simplified/views/EmptyView","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/actions/ActionUtils"],function(e,t,i,a,n,s,o,r,l,c){"use strict";return t.extend({tagName:"div",className:"type-categories",_rootCategoryViews:void 0,_focusedCriteriaPath:void 0,init:function(e){this._parent(e),this._rootCategoryViews=[],this._focusedCriteriaPath=void 0,this.hideTagsCount=!1},setup:function(e){this._parent(e)},render:function(){return this.taggerView=this.getOption("taggerView"),this.navImpl=this.getOption("navImpl")||this.taggerView.getObservedNavigator(),this.hasAdvancedFocsuedProxy=this.getOption("hasAdvancedFocsuedProxy"),this._emptyView=(new o).render().inject(this.container),this._addCriteriaDetailsHeader(),this._typesRootUL=e.createElement("ul",{class:"root-category"}).inject(this.container),this.taggerView&&this.taggerView.addEvent("TopBarSearch",this.onSearchInput.bind(this)),this.searchDiv=e.createElement("ul",{class:"search-categories"}).inject(this.container),this.taggerView&&!this.taggerView.isMaximized&&this.taggerView.buildTypeToggleElem({viewMode:"category",text:i.getText("showAll")}).inject(this.container).show(),this._parent()},_destroyRoots:function(){this._rootCategoryViews.forEach(function(e){e.destroy(),e=null}),this._rootCategoryViews=[]},redraw:function(e){var t=this.taggerView,a=this.navImpl,o=r.getDeviceAgent()&&l.enableMobileTypeCode(),c=t?t.searchedString:"";e&&(this.hideTagsCount=e.hideTagsCount),this._destroyRoots(),this._emptyView&&this._emptyView.hide(),this._focusedCriteriaPath=n.getFocusedCriteriaPath();var d=this.hasAdvancedFocsuedProxy(a,n.TYPE_CATEGORIZATION),g=n.getCriteriaInfo(a,d,this.getOption("predicates"),c);if(g&&g.length>0){var h=[],u=[];g.sortBy("title").forEach(function(e){e.isContainer()?h.push(e):u.push(e)});for(var p=h.concat(u),f=0;f<p.length;f++){var m=p[f],v=new s({model:m,taggerView:this.taggerView,navImpl:this.navImpl,hideTagsCount:this.hideTagsCount}).render().inject(this._typesRootUL);this._rootCategoryViews.push(v);var T=m.get("iconClass").replace("fonticon-",""),C=!!d&&d.getLocalFilter().isSelected(n.buildCondition(m));v.addSubCriteriaViews(T,this._typesRootUL,{focusedAdvProxy:d,navImpl:a,isRootSelected:C,onCriteriaToggle:this.onCriteriaClick.bind(this),onCriteriaExpand:this.onExpandClick.bind(this),isMobileDevice:o})}if(this._focusedCriteriaPath.length>0){this.otherCriteriaHeader.getElement(".cat-title").innerHTML="";var w=this._focusedCriteriaPath[0],b=this._rootCategoryViews.findIndex(function(e){return e.model.id==w});if(-1!=b){for(var y=this._rootCategoryViews[b],S=0;S<this._focusedCriteriaPath.length;S++){var I=this._focusedCriteriaPath[S],E=null;if(0!=S){var x=y.findViewById(I,!0);if(!x)break;E=x.getParentView()}this.showCriteriaDetails(I,E,!1)}this._focusedCriteriaPath.forEach(function(e,t){}.bind(this))}else this._focusedCriteriaPath=[],n.setFocusedCriteriaPath(this._focusedCriteriaPath)}}else this._emptyView.show(),this._emptyView.setMessageText(i.getText("noTags")),this.otherCriteriaHeader&&this.otherCriteriaHeader.hide();return this._redrawStatus=!1,c&&this.showOnlyLeaf(),this},_addCriteriaDetailsHeader:function(){var t=this;this.otherCriteriaHeader=e.createElement("div",{id:"otherCriteriaHeader"}).inject(this.container),e.createElement("div",{id:"back-title",html:"<div class='back-title' style='border-right: 1px solid #B6B4BA; padding-right: 10px; margin-right: 10px;'><span class='fonticon fonticon-chevron-left'></span>"+i.getText("back")+"</div>",events:{click:function(){t.hideCriteriaDetails()}}}).inject(this.otherCriteriaHeader),e.createElement("div",{class:"cat-title"}).inject(this.otherCriteriaHeader),this.otherCriteriaHeader.hide()},showOnlyLeaf:function(e){var t=this;this.getElement("#otherCriteriaHeader").hide(),(e||this._rootCategoryViews).forEach(function(e){e.model.isContainer()?(e.hide(),t.showOnlyLeaf(e.subCriteriaViews)):(e.container.inject(t.searchDiv),t.searchDiv.show())})},hideCriteriaDetails:function(){if(this._focusedCriteriaPath.length<1)throw new Error("INVALID expand status for criteria");var e=this._focusedCriteriaPath.pop();n.setFocusedCriteriaPath(this._focusedCriteriaPath);var t=[];if(0==this._focusedCriteriaPath.length)this.otherCriteriaHeader.hide(),t=this._rootCategoryViews;else{this.otherCriteriaHeader.getElement(".cat-title").innerHTML=this._focusedCriteriaPath.map(function(e){return Array.isArray(e)?i.getText(e[e.length-1]):i.getText(e)}).join(" - ");var a=this._focusedCriteriaPath[0];t=this._rootCategoryViews.filter(function(e){return e.model.id==a})[0].findViewById(e,!0).getParentView().subCriteriaViews}t.forEach(function(t){t.show(),t.parentView?t.container.getParent().setStyle("display","grid"):t.container.getParent().removeClassName("adjust-css"),t.model.id===e&&t.setAsCollapsed()}.bind(this))},showCriteriaDetails:function(e,t,a){var s=!t;(s?this._rootCategoryViews:t.subCriteriaViews).forEach(function(t){t.model.id===e?(t.hide(),s?t.container.getParent().hasClassName("adjust-css")||t.container.getParent().addClassName("adjust-css"):t.container.getParent().setStyle("display","block"),t.showAllSubCriteria(),this.otherCriteriaHeader.show(),this.otherCriteriaHeader.setStyle("display","flex"),a&&(this._focusedCriteriaPath.push(t.model.id),n.setFocusedCriteriaPath(this._focusedCriteriaPath)),this.otherCriteriaHeader.getElement(".cat-title").innerHTML=this._focusedCriteriaPath.map(function(e){return Array.isArray(e)?i.getText(e[e.length-1]):i.getText(e)}).join(" - ")):(t.hide(),t.hideSubCriteria())}.bind(this))},onExpandClick:function(e){var t=e.model.id,i=e.getParentView();this.showCriteriaDetails(t,i,!0)},onCriteriaClick:function(e,t){var i=t.model,s=this.navImpl;if(s)if(s.hasProxiesInEdition())console.warn("no refine possible when focused on subjects");else{var o,r=!1,l=n.ALL_MODEL_ID===i.id,d=this.taggerView?this.taggerView.actionManager.getCurrentAction():void 0;if(e.ctrlKey&&d)return void a.log("no treatment when pressing CTRL key during action mode");if(i.isContainer()||l)if(o=this.hasAdvancedFocsuedProxy(s,n.TYPE_CATEGORIZATION)){for(var g=i.get("subCategories"),h=o.getLocalFilter(),u=0;u<g.length;u++){var p=n.buildCondition(g.at(u));h.isSelected(p)&&h.toggle(p)}var f=n.buildCondition(i);s.toggleComplexTagSelection(f)}else if(e.ctrlKey||d&&(d.id==c.ACTION_SELECT||d.id==c.ACTION_EDITTAGREL))d||(d=this.taggerView.startSelectAction()),d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!0});else if(d&&d.id==c.ACTION_EXCLUDE)d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!0});else{if(s.getFocusedProxy()||s.dispatchEvent("onBeforeGlobalFilterChange"),!i.get("selected")){var m=[];i.getSelectedSubCategories(m),m.forEach(function(e){s.toggleTagSelection(JSON.stringify(e.getRefineStructure(!0)[0]),!1)})}s.toggleTagSelection(JSON.stringify(i.getRefineStructure(!0)[0]),!1),s.onRefine(),r=!0}else if(o=this.hasAdvancedFocsuedProxy(s,n.TYPE_CATEGORIZATION))(f=n.buildCondition(i)).treatEmbeddingFilter=!0,s.toggleComplexTagSelection(f);else e.ctrlKey||d&&(d.id==c.ACTION_SELECT||d.id==c.ACTION_EDITTAGREL)?(d||(d=this.taggerView.startSelectAction()),d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!1})):d&&d.id==c.ACTION_EXCLUDE?d.onCriteriaSelection({view:t,isComplex:!1,isContainer:!1}):(s.toggleTagSelection(JSON.stringify(i.getRefineStructure(!0)[0])),r=!0);r&&(this.taggerView&&this.taggerView.setSpinner(),this.getOption("tvView")&&this.getOption("tvView").setSpinner())}},clearAllFilters:function(){let e=this;this.navImpl&&!this.navImpl.getFocusedProxy()&&this.navImpl.dispatchEvent("onBeforeGlobalFilterChange");let t=function(t){if(t.get("selected")){let i=JSON.stringify(t.getRefineStructure(!0)[0]);return e.navImpl.toggleTagSelection(i,!1),!0}};this._rootCategoryViews.filter(e=>{!function(e){let i=e.model;if(!t(i)){let e=[];i.getSelectedSubCategories(e),e&&e.length&&e.forEach(e=>{t(e)})}}(e)}),this.navImpl.onRefine()},destroy:function(){this.taggerView&&this.taggerView.removeEvent("TopBarSearch"),this._destroyRoots(),this._parent()},onSearchInput:function(e){if(this.searchString=e,this.searchString){var t=0,a=this.searchString.toLowerCase();this._rootCategoryViews.forEach(function(e){this._focusedCriteriaPath&&this._focusedCriteriaPath.length&&e.model.id!==this._focusedCriteriaPath[0]||e.searchSubCriteria(a,e.model.id===this._focusedCriteriaPath[0])&&t++}.bind(this)),0===t||0===t&&!viewAllIsActive?(this._emptyView.show(),this._emptyView.setMessageText(i.getText("noRslt"))):this._emptyView.hide()}else{var n;this._rootCategoryViews.forEach(function(e){n=e.model.id===this._focusedCriteriaPath[0],this._focusedCriteriaPath&&this._focusedCriteriaPath.length&&!n||(n||e.show(),n?e.showAllSubCriteria():(e.showDefaultSubCriteria(),!0!==e.model.get("expandStatus")&&e.setAsCollapsed()))}.bind(this)),this._emptyView.hide()}},getNbOfMatchingTags:function(){return!!this._emptyView.container.isHidden()}})}),define("DS/TagNavigator/TagWidget/AbstractTagView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/views/ContextMenu","DS/MessageBus/MessageBus","DS/TagNavigator/simplified/actions/ActionUtils"],function(e,t,i,a,n,s){"use strict";return t.extend({setup:function(e){this._parent(e)},domEvents:{"click .tag-label":"toggleTagSelection","contextmenu .tag-label":"openContextMenu","click .tag-delete":"onTagDelete"},render:function(){this.navImpl=this.getOption("navImpl"),this.predicate=this.getOption("predicate");var e=this.getOption("tvView");return this.contextMenu=e?e.contextMenu:new a,this.childViews=[],this._selectionToReset=[],this.maxTagger=this.getOption("maxTagger"),this.maxTagger&&(this.domId=this.getDOMId()),this.model&&this.listenTo(this.model,{"onChange:hide":this.hideView,"onChange:isColorized":this.updateTagColor}),this},getDOMId:function(){let e={predicate:this.predicate.getFullPredicateID(),object:this.model.get("object"),dispValue:this.model.get("displayName"),type:this.model.get("type")},t=JSON.stringify(e);var i,a,n=0;for(i=0,a=t.length;i<a;i++)n=(n<<5)-n+t[i].charCodeAt(0),n&=n;return n="id_"+n},toggleTagSelection:function(e){this._toggleTagSelection(void 0,e),e.stopPropagation();let t={pd1:this.predicate.id(),pd2:"tag"};try{n.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagsWidget",action:"onTagWidgetRefine",persDim:t}})}catch(e){console.log("MessageBus publish did not work!!")}},_checkIfTagPinned:function(){let e=this;this.navImpl.getTagPinnedFromCurrentContext().forEach(function(t){let i=JSON.parse(t.predicate),a=e.model.get("object"),n=e.predicate.getFullPredicateID(),s=e.container.getElement(".tag-content");Array.isArray(i.object)?Array.isArray(a)?i.predicate===n&&i.object.toString()===a.toString()&&s.addClassName("disabled-tag"):i.predicate===n&&-1!==i.object.indexOf(a)&&s.addClassName("disabled-tag"):i.predicate===n&&a===i.object&&s.addClassName("disabled-tag")})},openContextMenu:function(e){let t=this.tvView,a=void 0,n=this.model.getTagValue();if(t&&(a=t.actionManager?t.actionManager.getCurrentAction():void 0),this.navImpl.hasExcludeSupport()){e.preventDefault(),this.contextMenu.dropdown&&this.contextMenu.dropdown.destroy();let t=[];this.model.get("isExcluded")?t.push({text:i.getText("unexludeTag"),fonticon:"block",id:"include"}):t.push({text:i.getText("excludeTag"),fonticon:"block",id:"exclude"}),a?a.id==s.ACTION_SELECT&&"date"!=n.type&&this.contextMenu.createDropdown({cont:this.container,target:this.container,view:this,items:t,evtObj:{pageX:e.x,pageY:e.y}}):"date"!=n.type&&this.contextMenu.createDropdown({cont:this.container,target:this.container,view:this,items:t,evtObj:{pageX:e.x,pageY:e.y}})}},excludeTag:function(e){let t={},i=this.model.getTagValue();t.dispValue=i.displayName,t.object=i.uri,t.type=i.type,t.predicate=i.predicate,UWA.is(e,"boolean")&&this.model.set("isExcluded",e);var a=this.container.getElement(".fonticon-block");e?a.removeClassName("hide"):a.addClassName("hide");var n=this.tvView,o=n?n.actionManager.getCurrentAction():void 0;o?o.id===s.ACTION_SELECT&&(a.addClassName("excludeWithAction"),this._toggleTagSelection(e)):this.navImpl.isSelected(JSON.stringify(t))?e?this.navImpl.excludeTag(t,e):this.navImpl.undoExcludeTag(t,e):this._toggleTagSelection(e)},hideView:function(){let e=this.model.get("hide");this.container.toggleClassName("hide",e)},getDisplayName:function(){return this.model.get("displayName")},isTagExcluded:function(){let e=this.model.getTagValue();return e.dispValue=e.displayName,e.object=e.uri,e=JSON.stringify(e),this.navImpl.isExcluded(e)},isTagGrouped:function(){let e,t=this.model.getTagValue(),i=this.predicate.id();return Array.isArray(t.uri)&&(e=t.uri),this.navImpl.isGroupedBy(i,t.displayName,e)},_toggleTagSelection:function(e,t){if(!this.navImpl.hasSubjectsInEdition()){let i=this.tvView,a=void 0,n=this.model.getRefineData();if(i){if(t&&t.ctrlKey&&t.altKey)return!1;let o=t&&t.ctrlKey;if((a=i.actionManager?i.actionManager.getCurrentAction():void 0)||o){if(o||a&&a.id==s.ACTION_SELECT){if(this.container.hasClassName("excluded")&&!UWA.is(e,"boolean"))this.container.getElement(".fonticon-block").addClassName("hide"),this.container.removeClassName("excluded"),this.container.removeClassName("picked"),this.model.set("isExcluded",!1);return a||(a=i.startSelectAction()),void a.onTagSelection(this.container,n,e)}if(a.id===s.ACTION_COLORIZE)return void this.actionOnColorize(a);if(a.id===s.ACTION_SELECTINAPP)return void a.onTagSelection(this.container,n);if(a.id===s.ACTION_EXCLUDE){let e=this.container.hasClassName("excluded");return this.container.toggleClassName("excluded",e),e&&this.container.getElement("span.excluded").addClassName("hide"),void a.onTagSelection(this.container,n)}if(a.id===s.ACTION_GROUP)return void a.onTagSelection(this.container,!0);if(a.id===s.ACTION_EDITTAGREL){let e=this.model.getRefineData();return i.getTagValueForTag(e),void a.onTagSelection(this.container,n)}}else i.setSpinner()}this.navImpl&&!this.navImpl.getFocusedProxy()&&this.navImpl.dispatchEvent("onBeforeGlobalFilterChange"),this.navImpl.toggleTagSelection(n,null,e)}},onTagDelete:function(){let e=this.model.get("object"),t=this.predicate;this.navImpl.deleteTagValue(e,t)},actionOnColorize:function(e){let t=this,i=this.navImpl.getCache(),a=this.predicate.getFullPredicateID(),n=this.model.getTagValue(),s=e.getSelectionCount(),o=!1;if(e.copiedColorMap||(i.colorManager.copyInPartialMap(a),i.colorManager.copyOfPartialColorizeMap(a),e.copiedColorMap=!0),this.container.hasClassName("colorize")){this.container.removeClassName("colorize"),this.container.removeClassName("picked-for-colorize");var r=e._selection.findIndex(function(e){return e===t.domId});-1!==r&&e._selection.splice(r,1),this.model.updateColorization(!1,!0),i.colorManager.resetColorForTagValue(n),o=!0}else i.colorManager.checkForMapObject(this.fullPredId,n[0]),this.container.addClassName("colorize"),this.container.addClassName("picked-for-colorize"),this.model.updateColorization(!0,!0);s=e.getSelectionCount(),e.get("isInteractive")&&e.set("selectionCount",s);let l={id:e.id,selectionCount:s,fullPredId:a,view:this,isRemoved:o};this.dispatchEvent("actionOnTag",l)},clearTagColor:function(){let e=this,t=this.tvView.actionManager?this.tvView.actionManager.getCurrentAction():void 0;if(t){this.container.removeClassName("colorize"),this.container.removeClassName("picked-for-colorize");var i=t._selection.findIndex(function(t){return t===e.domId});-1!==i&&t._selection.splice(i,1),this.container.getElement(".tag-color").addClassName("hide-color")}},destroy:function(){this._tooltip&&this._tooltip.elements&&this._tooltip.destroy(),this.model=null,this.stopListening(),this._parent()}})}),define("DS/TagNavigator/TagWidget/TagWidgetUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/TagNavigator/Logger","DS/i3DXCompass/i3DXCompass","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s){"use strict";return t.singleton({init:function(t){let i=this;this.draggable=!1,this.appData=null,("3DDashboard"===(t&&t.brand)&&!0!==s.getOption("offline6W")||s.getOption("odt6WTagsAsWidget")&&!0!==s.getOption("offline6W"))&&this.getAppData().then(function(t){t&&e.is(t,"object")&&(i.appData=t,i.draggable=!0)},function(e){a.log("Error while retrieving the app info"),i.draggable=!1})},getAppData:function(){return new i(function(e,t){if(s.getOption("odt6WTagsAsWidget")){(function(){let t={addin:[],checksum:"13339b86184926e24b507109c3b429711acf0794",icon:"https://ve4al114plp.dsone.3ds.com:443/3DSpace/widget/images/MyApps/X3DTAGS_AP_AppIcon.svg",id:"X3DTAGS_AP",isolationLevel:1,launchInfos:"https://ve4al114plp.dsone.3ds.com:444/3DDashboard/resources/en/1/webapps/TagNavigatorWidget/TagNavigator_widget.html",platforms:[],title:"X3DTAGS_AP",trust:!1,trusted:!0};t&&(a.log("Into getAppIfo: "+JSON.stringify(t)),e(t))})()}else n.getAppInfo({appId:s.getOption("tagAppId")||"X3DTAGS_AP",onComplete:function(t){t&&(a.log("Into getAppIfo: "+JSON.stringify(t)),e(t))},onFailure:t})})},isDraggable:function(){const e=navigator.userAgent;let t=!1;return!/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)&&/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)&&(t=!0),this.draggable&&!t},builAttrString:function(t){let i="";if(s.getOption("6WTagsAsWidget")&&e.is(this.appData,"object")){var a={tenantAware:!1,x3dPlatformId:this.appData.platformId,predicateId:t.predicateId,predicateLineage:t.fullPredicateId,type:t.type,contextId:t.contextId,sort:t.sort,currentViewMode:t.currentViewMode};i="data-id='"+this.appData.id+"' data-search='"+this.appData.title+"' data-quadrant='"+this.appData.quadrant+"' data-url='"+this.appData.launchInfos+"' data-title='"+this.appData.title+"' data-isolationlevel='"+this.appData.isolationLevel+"' data-data='"+JSON.stringify(a)+"' data-appid='"+this.appData.id+"' data-token='"+this.appData.checksum+"' data-apps='[]'"}return i},getTagInfo:function(e,t){let i=[],a=t.getCache().colorManager,n={};for(let s in e){e[s].forEach(e=>{let s=function(e){let i,o=e.getDisplayValue(),r=e.getUri(),l=UWA.clone(r),c=e.pred.getFullPredicateID();if("date"===e.type){let e,i=t.getListOfSelectedTagValues(c);if(i.length&&(e=i[0].uri),e){if(!(0===e.indexOf(r))&&0!==r.indexOf(e))return}}Array.isArray(r)?(l=l.join("_!tagHie!_"),i=n[l]):i="date"===e.type?n[r]:n[o];let d=a.isColorized(c)||a.isInColorization(c);if(i){i.isExistingTag=!0,i.count+=e.addCount?e.addCount:0;let t=!1;Array.isArray(r)?Array.isArray(JSON.stringify(i.object))&&(1===r.length&&JSON.stringify(i.object)===JSON.stringify(r)?t=!1:1===r.length&&i.object[0]===r[0]?t=!1:JSON.stringify(i.object)!==JSON.stringify(r)&&(t=!0)):Array.isArray(i.object)&&i.object[0]===r?t=!1:i.object!==r&&(t=!0),t&&(i.object=UWA.is(i.object,"array")?i.object:[i.object],i.object.push(r),i.isComposite=!0)}else i={uri:r,object:r,id:l,displayName:o,count:e.addCount?e.addCount:0,explicit:e.explicit,icon:e.icon,type:e.type,tagType:Array.isArray(r)?"tree":e.type,isGrouped:t.isGroupedBy(e.pred.id(),o,r),isExcluded:t.isExcluded(e),isSelected:t.isSelected(e),isPreciseCount:t.isPreciseCount(),predicate:e.pred.getFullPredicateID(),isColorized:d,isExpanded:t.getCache().isTagTreeExpanded(r),hasOwnCount:e.hasOwnCount,showCustomCountOnHierarchy:t.showCustomCountOnHierarchy()},e.explicit&&t.isTagInEdition(e)&&(i.isUnderCreation=!0),e.explicit&&!i.isUnderCreation&&t.hasProxiesInEdition()&&(i.isDeletable=!0,i.isSwymCommunityInFocus=e.isSwymCommunityInFocus,i.isCommunityTag=e.isCommunityTag,i.isOntologyTag=e.isOntologyTag),Array.isArray(r)?n[l]=i:n[o]=i;if(e.parent){let t=s(e.parent);i.parent=t}return i},o=s(e);o&&!o.isExistingTag&&i.push(o)})}return n=null,i}})}),define("DS/TagNavigator/simplified/model/CountryModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model","UWA/Class/Collection","DS/TagNavigator/simplified/model/PersonModel"],function(e,t,i,a,n){"use strict";return i.extend(t,{defaults:{id:"",title:"",count:0,iconClass:"fonticon fonticon-3ds-where",imageURL:"",persons:void 0},setup:function(){this.set("persons",new a([],{model:n}))},addPerson:function(e){var t=this.get("persons");if(0==t.length){var i=this,a=e.get("personInfo");a&&a.addEvent("onChange:country",function(e){i.set("title",e)})}t.add(e)},getPersons:function(){return this.get("persons").toArray()},getCount:function(){return this.get("persons").toArray().reduce(function(e,t){return e+t.get("count")},0)}})}),define("DS/TagNavigator/simplified/model/ContinentModel",["UWA/Core","UWA/Class/Debug","UWA/Class/Model","UWA/Class/Collection","DS/TagNavigator/simplified/model/CountryModel"],function(e,t,i,a,n){"use strict";return i.extend(t,{defaults:{id:"",title:"",iconClass:"fonticon fonticon-globe",imageURL:"",countries:void 0,tagsHierarchy:void 0},setup:function(){this.set("countries",new a([],{model:n})),this.set("tagsHierarchy",[this.id])},getCount:function(){return this.get("countries").reduce(function(e,t){return e+t.getCount()},0)},addCountry:function(e){this.get("countries").add(e),e.set("tagsHierarchy",[this.id,e.id])},getCountry:function(e){return this.get("countries").get(e)},getCountries:function(){return this.get("countries").toArray()}})}),define("DS/TagNavigator/simplified/utils/LocationUtils",["UWA/Core","UWA/Class","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/simplified/model/ContinentModel","DS/TagNavigator/simplified/model/CountryModel","text!DS/TagNavigator/assets/CountriesInfo.json"],function(e,t,i,a,n,s,o,r,l,c,d,g,h){"use strict";var u=t.singleton({COMPUTED_COUNTRY_INFO:"computedCountryInfo",COMPUTED_CITY_INFO:"computedCityInfo",DATA_LOCATION:"data_location",init:function(){new n({sixw:"ds6w:where/ds6w:location",type:"string",markPendingForNls:!0}),this.computedCountryInfo=new n({sixw:"ds6w:where/ds6w:location/"+this.COMPUTED_COUNTRY_INFO,type:"string",displayName:s.getText("computedCountryInfo")}),this.computedCityInfo=new n({sixw:"ds6w:where/ds6w:location/"+this.COMPUTED_CITY_INFO,type:"string",displayName:s.getText("computedCityInfo")}),this._countriesJSONInfo=JSON.parse(h),this._hierarchyView=o.getOption("geolocationHierarchy")},ensurePredicates:function(e){e&&(this.countryPredicate||(this.countryPredicate=this._buildPredicate("ds6w:country",e)),this.cityPredicate||(this.cityPredicate=this._buildPredicate("ds6w:city",e)))},buildCondition:function(e,t){var i={id:e instanceof r?e.pred.getFullPredicateID():e.predicate,operator:"OR",isComplex:!0,condition:{type:"string",object:e instanceof r?e.uri:e.object,operator:"OR",value:e instanceof r&&e.embeddedTags?e.embeddedTags.map(function(e){return e.get("title")}):[],display:e instanceof r?e.getDisplayValue():e.dispValue,predicates:[]}};return t&&(i.condition.excluded=t),i.condition.value.forEach(function(){i.condition.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})}),i},buildConditionFromModel:function(e){var t,i,a=e instanceof d,n=function(e){return e.get("persons").map(function(e){return e.get("title")})},s={id:this.computedCountryInfo.getFullPredicateID(),operator:"OR",isComplex:!0,condition:{type:"string",object:this._hierarchyView?e.get("tagsHierarchy"):e.get("title"),operator:"OR",value:a?(t=e,i=[],t.getCountries().forEach(function(e){i=i.concat(n(e))}),i):n(e),display:e.get("title"),predicates:[]}};return s.condition.value.forEach(function(){s.condition.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})}),s},_buildPredicate:function(e,t){var i=n.getPredicate(e);return i||(i=new n({sixw:"ds6w:where/ds6w:location/"+e,type:"string",server:t})),i},getCountryInfo:function(e){var t=e.split(".");return t=2==t.length?t[1]:t[0],this._countriesJSONInfo[t]},computeGeoLocations:function(e,t,n,r){var h=new i([],{model:d}),p=c.getUsersInfo(e,t),f=p.length,m=0;if(UWA.is(p,"array")){var v,T;if(r){var C=e.getFocusedProxy();C&&(v=C.getAdvancedOption(c.PERSON_REFINE)?c.PERSON_REFINE_PREDICATE:"ds6w:who/ds6w:responsible"),v&&(T=e.getListOfSelectedTagValues(v))}l.log("LocationUtils#computeGeoLocations: number of persons info found="+f);var w,b=o.getOption("countryFlag");if(p.forEach(function(e){var t,i,n=!0;if(r&&(t=e.get("title"),i=!0,UWA.is(T,"array")&&T.length>0&&(i=T.findIndex(function(e){return e.display===t})>=0),!i)&&(n=!1),n){e.isReady()||(w=e,++m);var o=e.getCountryCode();o?o.forEach(function(t,i){var n=u.getCountryInfo(t).continent,o=h.get(n);o||(o=new d({id:n,title:s.getText(n)}),h.add(o));var r=o.getCountry(t);if(!r){var l=e.getCountry();r=new g({id:t,title:l.length>i?l[i]:""}),b&&r.set("imageURL",a.getWebappsBaseUrl()+"CountryIcons/assets/icons/country/"+t.split(".")[1].toLowerCase()+".png"),o.addCountry(r)}r.addPerson(e)}):o.length>1&&l.warn("Person '"+e.get("title")+"' found in multiple countries, "+JSON.stringify(o))}}),w){var y=w.get("personInfo");y&&y.addEventOnce("onChange:isReady",function(){n&&n()})}}return{continents:h,total:f,pending:m}},getSourceIcon:function(e){var t;if(UWA.is(e)&&UWA.is(e,"array")&&e.length>0&&(e=e[0]),e)switch(e){case"3DSpace":t="fonticon fonticon-3dspace";break;case"3DSwym":case"ds6w:dataSource.3DSwym":t="fonticon fonticon-users-alt";break;case"ds6w:dataSource.3DSwymConv":t="fonticon fonticon-chat-alt";break;case"ds6w:dataSource.3DSwymPSpace":t="fonticon fonticon-user-feather";break;case"3DDrive":t="fonticon fonticon-component";break;case"OneDrive":t="fonticon fonticon-onedrive";break;case"GoogleDrive":t="fonticon fonticon-google-drive";break;case"DropBox":t="fonticon fonticon-dropbox";break;case"Box":t="fonticon-box-company";break;default:t="fonticon fonticon-component"}return t}});return u}),define("DS/TagNavigator/Parameters",["UWA/Class/Collection","UWA/Core","DS/TagNavigator/Parameter"],function(e,t,i){"use strict";return e.extend({model:i,isReadyForSearch:function(){var e,t=this.size(),i=!1;for(e=0;e<t&&!i;e++){var a=this._models[e]._attributes;if(null!==a){var n,s=a.intType.length;for(n=0;n<s&&!i;n++)i=null!==a.intType[n].toVal||null!==a.intType[n].fromVal;i=i||a.boolVal.length&&""!==a.boolVal[0]||a.stringVal.length}}return i},getFilters:function(){var e={plmparam:{}};return this._models.forEach(function(t){var i=t._attributes;if("string"===i.type)""!==i.stringVal&&(e.plmparam.string||(e.plmparam.string={}||e.plmparam.string),e.plmparam.string[i.value]={interface:i.interface,value:i.stringVal});else if("boolean"===i.type)i.boolVal.length&&""!==i.boolVal[0]&&(e.plmparam.boolean||(e.plmparam.boolean={}||e.plmparam.boolean),e.plmparam.boolean[i.value]={interface:i.interface,value:"1"===i.boolVal[0]});else{var a=i.unit||null;i.intType.forEach(function(t){if(null!==t.fromVal||null!==t.toVal){var n,s,o="nominal";switch((t.rangeContainer&&t.rangeContainer.hasChildNodes()?t.rangeContainer.getElement(".form-control"):null).value){case"2":o="min";break;case"3":o="max";break;case"4":o="range"}n="integer"===i.type?parseInt(t.fromVal,10):parseFloat(t.fromVal),s="integer"===i.type?parseInt(t.toVal,10):parseFloat(t.toVal),e.plmparam[i.type]||(e.plmparam[i.type]={}||e.plmparam[i.type]),e.plmparam[i.type][i.value]||(e.plmparam[i.type][i.value]={interface:i.interface},a&&(e.plmparam[i.type][i.value].unit=a)),e.plmparam[i.type][i.value][o]={},n===s?e.plmparam[i.type][i.value][o].equal=n:(isNaN(n)||(e.plmparam[i.type][i.value][o].from=n),isNaN(s)||(e.plmparam[i.type][i.value][o].to=s))}})}}),e},clearValues:function(){this._models.forEach(function(e){e.set({stringVal:"",boolVal:[],intType:[]})})},appendParameter:function(e){var t,i,a,n,s;return t=!0,i=e.get("value"),a=e.get("interface"),n=e.get("type"),s=e.get("unit"),this._models.forEach(function(e){t&&i&&i===e.get("value")&&a&&a===e.get("interface")&&n&&n===e.get("type")&&(s?s===e.get("unit")&&(t=!1):t=!1)}),t&&this.add(e),t}})}),define("DS/TagNavigator/Groupings",["UWA/Core","DS/TagNavigator/Logger"],function(e,t){"use strict";return function(){var e={groups:[]},t={},i={};return{computeGroupingInfo:function(a,n,s){this.predicateInfo||(this.predicateInfo={}),UWA.is(a,"array")&&(t={groups:[]},n&&(t.forcedUpdate=!0),i={},a.forEach(function(e){var a=e.predicate;i[a]={},i[a].predLevel=!!e.predLevel&&e.predLevel,e.object&&e.object.forEach(function(e){i[a][e.dispText]=e.object});let n={predicate:e.predicate,object:e.object,predLevel:e.predLevel};s&&(n.isLocal=s),t.groups.push(n)})),e.groups=UWA.clone(a)},isGroupedBy:function(e,t,a){if(i){var n=i[e];if(n){if(!t)return n.predLevel;if(!a)return n[t];var s=n[t];if(UWA.is(s,"array")&&UWA.is(a,"array")&&s.length==a.length){var o=0;return s.forEach(function(e,t){e==a[t]&&o++}),o==s.length}}}return!1},getGroupingInfo:function(){return t},getActiveGroupings:function(){return UWA.clone(e.groups)},hasActiveGroupings:function(){return e.groups.length>0},clear:function(){e.groups=[],i={},t.groups=[]}}}}),define("DS/TagNavigator/embeddedTagger/EmbeddedHierarchyMenuItems",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/simplified/model/TagValueModel","DS/TagNavigator/simplified/utils/LocationUtils","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s,o){"use strict";var r=a.extend({init:function(e){this._parent(e),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(e,t){return this.updateImageCB=this.updateImage.bind(this),this.model.addEvent("onChange:iconClass",this.updateImageCB),this.updateCountCB=this.updateCount.bind(this),this.model.addEvent("onChange:count",this.updateCountCB),this._parent(e,t),this},updateImage:function(){if(this.model.get("imageURL"))this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".image-div").setStyle("display","inline-block");else if(this.model.get("iconClass")){let e=this.model.get("oldIcon");e&&this.container.getElement(".tag-icon").removeClassName(e),this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass")).show()}else this.container.getElement(".tag-icon").setStyle("display","none")},updatePredicateIconForChild:function(){let e=this.model.get("parentIcon");if(e.isFontIcon)this.container.getElement(".pred-icon-cont .tag-icon").addClassName(e.icon);else{let t=e.icon;this.container.getElement(".pred-icon-cont .tag-icon").setStyle("display","none"),this.container.getElement(".pred-icon-cont .tag-image").setAttributes({src:t}),this.container.getElement(".pred-icon-cont .image-div").setStyle("display","inline-block")}},updateCount:function(){var e=this.model.get("count");this.hideTagsCount?this.container.getElement(".tag-count").setText(""):e&&this.container.getElement(".tag-count").setText(i.convertToUnity(e,this.isPreciseCount))},addContent:function(e,i){var a=this;this.container.getElement(".tag-label").setText(this.model.get("title")),this.updateImageCB(),this.updateCount(),this.setOption("identifier",t.getUUID().substr(0,6)),this.model.get("parentIcon")&&this.updatePredicateIconForChild();var o=a.getOption("eventsToListen");if(UWA.is(o,"object"))for(event in o)this.addEvent(event,o[event]);if(e){let t=function(e,a){e.forEach((e,n)=>{e.getOption("subMenuItems")?(t(e.getOption("subMenuItems"),a),e.render(a,i)):e.render(a,i)})},n=this.getOption("subMenuItems");n&&t(n,e),a.model.get("isEmbeddedWhy")&&(i?this.hidePredicateIcon(!1):this.hidePredicateIcon(!0))}else if(this.model instanceof n)this.navImpl.isSelected(this.model.get("tagValue"))&&this.container.addClassName("selected");else{this.model.get("is3DEXPERIENCE")&&this.navImpl.isGroupedBy("ds6w:dataSource")&&this.container.addClassName("selected");var l=this.navImpl.getFocusedProxy(),c={},d=function(e){var t=new r({model:new n({tagValue:e,proxy:l}),navImpl:a.navImpl,isPreciseCount:a.isPreciseCount,eventsToListen:o,hideTagsCount:a.hideTagsCount}).render(),i=e.getParent();if(i){var g=c[i.getDisplayValue()];g||(g=d(i),c[i.getDisplayValue()]=g),(h=g.getOption("subMenuItems"))||(h=[]),h.push(t),g.setOption("subMenuItems",h),t.model.set("iconClass",e.icon?e.icon:g.model.get("iconClass"))}else{var h;(h=a.getOption("subMenuItems"))||(h=[]),h.push(t),a.setOption("subMenuItems",h),a.model.get("is3DEXPERIENCE")&&t.model.set("iconClass",s.getSourceIcon(e.getUri())),c[e.getDisplayValue()]=t}if(a.model.get("isEmbeddedWhySection")){let i=e.pred.getFullPredicateID().split("/")[0].split(":")[1];t.model.setIcon("fonticon-3ds-"+i);let n={isFontIcon:!!a.model.get("iconClass"),icon:a.model.get("imageURL")?a.model.get("imageURL"):a.model.get("iconClass")};t.model.set("parentIcon",n),t.model.set("isEmbeddedWhy",!0),a.model.get("showPredicateIcon")&&(t.updatePredicateIconForChild(),t.hidePredicateIcon(!1))}return t};let e=this.getOption("tags");e&&UWA.is(e,"array")&&e.forEach(function(e){d(e)});var g=a.getOption("subMenuItems");UWA.is(g,"array")&&g.forEach(function(e){var t=a.getCount(e);t&&e.model.set("count",t)}),this.sort()}},hidePredicateIcon:function(e){this.container.getElement(".pred-icon-cont").toggleClassName("hide",e)},getCount:function(e){var t=this,i=e.getOption("subMenuItems");if(UWA.is(i,"array")){var a=i.reduce(function(e,i){return e+t.getCount(i)},0);return e.model.set("count",a),a}return e.model.get("count")},_sortItems:function(e,t){let i=t&&t.sortMode||"nbSort",a=t&&t.sortOrder||!1,n=t&&t.sortByW||!1;if("nbSort"==i){var s,o,r=function(e,t){s=e.model.get("count"),o=t.model.get("count"),s=s||0,o=o||0};return a?e.sort(function(e,t){return n&&e.model.get("iconClass")!==t.model.get("iconClass")?void 0:(r(e,t),s-o)}):e.sort(function(e,t){return n&&e.model.get("iconClass")!==t.model.get("iconClass")?void 0:(r(e,t),o-s)})}},sort:function(){var e=this.getOption("subMenuItems"),t=[],i={};if(e&&e.length>0){if(e.forEach(function(e){e.sort()&&t.push(e)}),this.model.get("sortByW")){let t=[];o.getOption("simplifiedRootW").forEach((i,a)=>{e.forEach(e=>{e.model.get("iconClass").contains(i.replace("ds6w:",""))&&t.push(e)})}),e=t,i.sortByW=!0}return e=this._sortItems(e,i),this.setOption("subMenuItems",e),!0}},destroy:function(){this.stopListening(),this.model=null,this._parent()}});return r}),define("DS/TagNavigator/simplified/views/WarningInfoView",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/WarningInfo.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"tn-info",template:a.compile(i),domEvents:{"click .tn-info-link":"cbHyperLinkClick"},render:function(){var e=this.template();return this.container.setContent(e),this.info=void 0,this.navImpl=this.getOption("navImpl"),this},setMessageText:function(t){if(this.info=void 0,this.container.removeClassName(this.icon),this.icon=void 0,this.container.getElement(".tn-info-icon").empty(),this.container.getElement(".tn-info-message-text").setText(""),this.container.getElement(".tn-info-link").setText(""),this.container.removeClassName("showWarning"),this.container.removeClassName("addHeight"),t){this.info=t;let i=t.type||"info";"info"===i?this.icon="info":"warning"===i?this.icon="attention":"error"===i&&(this.icon="error"),this.container.addClassName(this.icon);let a=this.container.getElement(".tn-info-icon");e.createElement("span",{class:"fonticon fonticon-"+this.icon}).inject(a);let n=t.hyperLink&&t.hyperLink.display?t.hyperLink.display:"inline";if(t.message){let e=t.hyperLink?t.hyperLink.link:"",i=t.hyperLink?t.hyperLink.text:"";if("embedded"===n){if(t.message.includes(i)){let a=t.message.split(i),n=a[0],s=a[1];this.container.getElement(".tn-info-message-text").innerHTML=n+(i?"<a class='tn-info-embedded-link'"+(e?" href="+e:"")+">"+i+"</a>":"")+s}}else this.container.getElement(".tn-info-message-text").setText(t.message),"newline"===n?this.container.getElement(".tn-info-message-text").removeClassName("inlineDisplay"):"embedded"===n&&this.container.getElement(".tn-info-message-text").addClassName("inlineDisplay"),i&&this.container.getElement(".tn-info-link").setText(i)}this.container.addClassName("showWarning"),this.container.addClassName("addHeight")}},cbHyperLinkClick:function(){this.info&&!this.info.hyperLink.link&&this.dispatchEvent("warningLinkClick")},displayMessage:function(e){this.info&&Object.keys(this.info).length&&e?(this.container.addClassName("showWarning"),this.container.addClassName("addHeight")):(this.container.removeClassName("showWarning"),this.container.removeClassName("addHeight"))},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/DateCalendarView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/Logger","DS/UIKIT/DatePicker","DS/TagNavigator/Predicate","DS/Controls/LineEditor","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s,o,r,l,c,d){"use strict";return t.extend({tagName:"div",className:"tn-calendar-div",domEvents:{"click .multi-select .tag-del":"removeFromSelection"},datePicker:void 0,fromDate:void 0,toDate:void 0,init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){this.taggerView=this.getOption("taggerView"),this.navImpl=this.getOption("navImpl"),this.inputTextDiv=e.createElement("div",{class:"fromToInput"}).inject(this.container);var t=e.createElement("div",{id:"from-input-container",class:"input-container"}).inject(this.inputTextDiv);e.createElement("label",{text:i.getText("from")+":",id:"from-label"}).inject(t);this.fromInput=new r({placeholder:i.getText("dateFormat"),touchMode:!0,sizeInCharNumber:10,maxLength:10}).inject(t),this.fromInput.domId="from-input",this.fromInput.getContent().addClassName("calendar-input"),this.fromInput.addEventListener("focus",this.handleFromFocusEvent.bind(this)),this.fromInput.addEventListener("change",this.fromClearEvent.bind(this)),this.fromInput.addEventListener("keydown",this.fromEnteredDate.bind(this));var a=e.createElement("div",{id:"to-input-container",class:"input-container"}).inject(this.inputTextDiv);e.createElement("label",{text:i.getText("to")+":",id:"to-label"}).inject(a);return this.toInput=new r({placeholder:i.getText("dateFormat"),touchMode:!0,sizeInCharNumber:10,maxLength:10,disabled:!0}).inject(a),this.toInput.domId="to-input",this.toInput.getContent().addClassName("calendar-input"),this.toInput.addEventListener("focus",this.handleToFocusEvent.bind(this)),this.toInput.addEventListener("keydown",this.toEnteredDate.bind(this)),d.showDateTiles()&&(this.multiSelectDiv=e.createElement("ul",{class:"multi-select"}).inject(this.container)),this.renderDateEvents(),this.activePredicate=this.getOption("predicateId"),this},getFromToDiv:function(){this.inputTextDiv.setStyle("margin-right","38px")},renderDateEvents:function(){var e=this,t={onSelect:function(t){var i=e.setFromToDate(this.getDate());if(e.setInputFieldsValue(e.fromDate,e.toDate),i){var a={};e.fromDate&&e.toDate?(a.fromDate=e._getFormattedDate(e.fromDate,!0),a.toDate=e._getFormattedDate(e.toDate,!0),a.nls=a.fromDate==a.toDate?e._getFormattedDate(e.fromDate):e._getFormattedDate(e.fromDate)+" - "+e._getFormattedDate(e.toDate)):(a.fromDate=e._getFormattedDate(e.fromDate,!0),a.nls=e._getFormattedDate(e.fromDate),e.container.getElement(".datepicker-calendar .datepicker-table").addEventListener("mouseover",e.hoverRangeSelection.bind(e))),e.launchRefine(a,!0)}},onDraw:function(){e.fromDate&&(e.hoverRangeSelection(),e.container.getElement(".datepicker-calendar .datepicker-table").addEventListener("mouseover",e.hoverRangeSelection.bind(e)),e.container.getElement(".datepicker-calendar .datepicker-table").addEventListener("mouseout",e.removeRangeSelection.bind(e)))}};this.datePicker=new s({showWeekNumber:!0,events:{onSelect:t.onSelect,onDraw:t.onDraw}}).inject(this.container),this.datePicker.hide()},handleFromFocusEvent:function(e){this.datePicker.isVisible()||this.datePicker.show()},handleToFocusEvent:function(e){this.datePicker.isVisible()||this.datePicker.show()},fromClearEvent:function(e){this.fromInput.value||(this.fromDate="",this.datePicker.setDate(null),this.toInput.disabled=!0)},fromEnteredDate:function(e){const t=e.target,i=t.value;t.addEventListener("input",e=>{""===e.target.value&&this.setValidFieldBorder("#from-input")});e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||[8,9,13,47].includes(e.keyCode)?9===e.keyCode&&this.isValidDate(i,"#from-input")&&(this.toInput.disabled=!1,this.toInput.focus(),e.preventDefault()):e.preventDefault()},toEnteredDate:function(e){const t=e.target,i=t.value;t.addEventListener("input",e=>{""===e.target.value&&this.setValidFieldBorder("#to-input")});e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||[8,9,13,47].includes(e.keyCode)?13===e.keyCode&&this.isValidDate(i,"#to-input")&&this.setEnteredFromToDate():e.preventDefault()},setEnteredFromToDate:function(){if(this.fromInput.value&&this.toInput.value){let e=this.isValidDate(this.fromInput.value,"#from-input")?this.fromInput.value.split("/"):"",t=this.isValidDate(this.toInput.value,"#to-input")?this.toInput.value.split("/"):"";if(e&&t&&""!==e&&""!==t){let i=`${e[2]}/${e[1]}/${e[0]}`,a=`${t[2]}/${t[1]}/${t[0]}`;this.checkTheDates(new Date(i),new Date(a))&&([i,a]=[a,i]),this.fromDate=new Date(i),this.toDate=new Date(a)}}if(!this.fromInput||!this.toInput)return!1;{const e={};e.fromDate=this._getFormattedDate(this.fromDate,!0),e.toDate=this._getFormattedDate(this.toDate,!0),e.fromDate===e.toDate?e.nls=this._getFormattedDate(this.fromDate):e.nls=`${this._getFormattedDate(this.fromDate)} - ${this._getFormattedDate(this.toDate)}`,this.launchRefine(e,!0)}},isValidDate(e,t){const i=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(!i.test(e))return this.setInvalidFieldBorder(t),!1;const[,a,n,s]=i.exec(e),o=parseInt(s,10),r=parseInt(n,10),l=parseInt(a,10);if(o<1e3||o>9999||r<1||r>12)return this.setInvalidFieldBorder(t),!1;const c=new Date(o,r,0).getDate();return l<1||l>c?(this.setInvalidFieldBorder(t),!1):(this.setValidFieldBorder(t),!0)},setInvalidFieldBorder(e){this.container.getElement(e+" input").addClassName("invalid-input")},setValidFieldBorder(e){this.container.getElement(e+" input").removeClassName("invalid-input")},setInputFieldsValue:function(e,t){e&&(this.fromInput.value=this._getFormattedDate(e),t||(this.fromInput.elements.container.removeAttribute("focused"),this.toInput.disabled=!1,this.toInput.elements.container.setAttributes({focused:!0}))),t&&(this.toInput.value=this._getFormattedDate(t)),e||t||(this.fromInput.value="",this.toInput.value="")},getDatePicker:function(){return this.datePicker},removeFromSelection:function(e){var t=this.taggerView.actionManager.getCurrentAction(),i=e.target.getClosest("li.tag"),a={from:i.getAttribute("from"),to:i.getAttribute("to")};t.removeDate(a),i.remove()},launchRefine:function(e,t){var i=this.getOption("taggerView"),a=this.getOption("navImpl");if(UWA.is(e,"object")){if(e.fromDate&&e.toDate){var n=[{predicate:o.getPredicate(this.activePredicate),value:{from:e.fromDate,to:e.toDate,nls:e.nls,isSimplifiedCriteria:!0},type:"date"}],s=this.taggerView?this.taggerView.actionManager.getCurrentAction():null;if(!s||s.id!==l.ACTION_SELECT&&s.id!==l.ACTION_EDITTAGREL)t?a.createFreeInputs(n):a.removeFreeInputs(n),i&&(i.setActiveCriteria(!0,!0),i.setSpinner());else if(s.onDateSelection({freeInputData:{predicate:o.getPredicate(this.activePredicate),value:{from:e.fromDate,to:e.toDate,nls:e.nls,isSimplifiedCriteria:!0},type:"date",isFreeInput:!0}}),this.clearDates(),this.setInputFieldsValue(),this.fromInput.elements.container.setAttributes({focused:!0}),this.toInput.elements.container.removeAttribute("focused"),d.showDateTiles())new c({isSimplified:!0,text:e.nls,attribute:[{from:e.fromDate,to:e.toDate}]}).render().container.inject(this.multiSelectDiv)}else{var r={predicate:o.getPredicate(this.activePredicate).getFullPredicateID(),object:e.fromDate?e.fromDate:e.toDate,dispValue:e.nls,type:"date"};a.toggleTagSelection(JSON.stringify(r),void 0,!0),i&&i.setSpinner()}this.fromDate=this.toDate=null}},redraw:function(){this.fromDate=this.toDate=this.hoveredDate=null,this.datePicker.hide(),this.clearDates(),this.setInputFieldsValue(),this.fromInput.elements.container.removeAttribute("focused"),this.toInput.elements.container.removeAttribute("focused")},_getFormattedDate:function(e,t){if(e)return t?e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2):("0"+e.getDate()).slice(-2)+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+e.getFullYear()},setFromToDate:function(e){var t=this.navImpl.getFocusedProxy();return t&&(t.hasFreeInputSupport(this.activePredicate)||t.hasFreeInputOnly(this.activePredicate))?this.fromDate?(this.checkTheDates(this.fromDate,e)?(this.toDate=this.fromDate,this.fromDate=e):this.toDate=e,!0):(this.fromDate=e,!1):(this.fromDate=e,!0)},checkTheDates:function(e,t){return e.getTime()>t.getTime()},clearDates:function(e){this.datePicker&&this.datePicker.setDate(null)},setActivePredicate:function(e){this.activePredicate=e},onPredicateChange:function(e){this.setActivePredicate(e),this.fromDate=this.toDate=this.hoveredDate=null},hoverRangeSelection:function(e){if(!e||"BUTTON"==e.target.nodeName){var t=this;if(!this.toDate){if(this.hoveredDate=e?e.target.dataset.year+"-"+("0"+(parseInt(e.target.dataset.month)+1)).slice(-2)+"-"+e.target.dataset.day:this.hoveredDate,this.fromDate){var i=this.fromDate.getFullYear()+"-"+("0"+(this.fromDate.getMonth()+1)).slice(-2)+"-"+this.fromDate.getDate(),a=function(e,i){var a,n,s,o=new Array,r={0:31,1:28,2:31,3:30,4:31,5:30,6:31,7:31,8:30,9:31,10:30,11:31};if(i){var l=t.container.getElement(".datepicker-calendar .datepicker-title select.datepicker-select-month").value,c=t.container.getElement(".datepicker-calendar .datepicker-title select.datepicker-select-year").value;if(s=parseInt(c)!=i.getFullYear()?c:i.getFullYear(),!(parseInt(s)%4&&parseInt(s)%100)&&parseInt(s)%400&&(r[1]=29),e<i)for(e.getMonth()==parseInt(l)?(a=new Date(e),n=e.getMonth()==i.getMonth()?new Date(i):new Date(s+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-"+r[l])):parseInt(l)==i.getMonth()&&(a=new Date(s+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-01"),n=new Date(i));a<=n;)o.push(new Date(a).getDate()),a.setDate(a.getDate()+1);else if(e>i)for(e.getMonth()==parseInt(l)?(a=new Date(e),n=e.getMonth()==i.getMonth()?new Date(i):new Date(s+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-01")):parseInt(l)==i.getMonth()&&(a=new Date(s+"-"+("0"+(parseInt(l)+1)).slice(-2)+"-"+r[l]),n=new Date(i));a>=n;)o.push(new Date(a).getDate()),a.setDate(a.getDate()-1)}return o}(new Date(i),t.hoveredDate?new Date(t.hoveredDate):null);a&&this.container.getElements(".datepicker-calendar tbody td").forEach(function(e,t){e.hasClassName("is-empty")||e.hasClassName("datepicker-week")||(a.includes(parseInt(e.innerText))&&!e.hasClassName("is-selected")?e.addClassName("in-range"):e.removeClassName("in-range"))})}this.hoveredDate&&(this.toInput.value=this._getFormattedDate(new Date(t.hoveredDate)))}}},removeRangeSelection:function(e){this.container.getElements(".datepicker-calendar tbody td").forEach(function(e,t){e.hasClassName("in-range")&&e.removeClassName("in-range")})},destroy:function(){this.stopListening(),this.datePicker.destroy(),this.fromInput.destroy(),this.toInput.destroy(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedPlaceholderMenuItem",["UWA/Core","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/simplified/utils/DateUtils"],function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this.container.setAttributes({id:this.model.id}),this},addContent:function(){this.container.getElement(".tag-icon").setStyle("display","none");var e=this.container.getElement(".tag-label");e.setText(this.model.get("title")),e.setStyles({"padding-left":"10px"})},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWView",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Event","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedPlaceholderMenuItem","DS/MessageBus/MessageBus","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/actions/ActionUtils"],function(e,t,i,a,n,s,o,r,l,c,d){"use strict";return t.extend({rootw:void 0,label:void 0,defaultValues:void 0,menuItem:[],domEvents:{"click .clear-refine-btn":"clearRefine","click .root-icon-div":"onGroupingChange","click .button-text":"onGroupingChange","click .active-tag-label":"clearRefine","click .emb-clear-input-field":"clearInput"},init:function(e){this.proxy=e.proxy,this.defaultValues=e.defaultValues,this.rootw=e.rootw,this._parent(e),this.container.addClassName("disableW"),this._groupingFormatV2=c.getOption("groupingFormatV2"),this._isReadyToUpdateGroupings=!0,this._updateGroupingsWhenReady=!1,this.disableUpdatePosition=!1},setup:function(e){this._parent(e),this.navImpl=this.proxy.getNavImpl()},render:function(){return this.getTabButton(),this.selectedItems=[],this.menuItems=[],this.container.id=this.rootw,this.isPreciseCount=this.navImpl.isPreciseCount(),this},getTabButton:function(){var t=this.icon;this.buttonContainer=e.createElement("div",{class:"tab-btn-cont"}).inject(this.container);var i=e.createElement("div",{class:"icon-cont-div"}).inject(this.buttonContainer),a=e.createElement("div",{class:"root-icon-div"}).inject(i);e.createElement("div",{class:"underline"}).inject(i),t=e.createElement("span",{class:"fonticon "+t+" root-icon"}).inject(a);this.activeIcon=e.createElement("span",{class:"fonticon fonticon-tag-active "}).inject(a);var s=e.createElement("div",{class:this.subLabel?"button-text":"button-text hide-sub-label"}).inject(this.buttonContainer),o=e.createElement("div",{class:"label-cont"}).inject(s);e.createElement("div",{class:"dropnbtn",text:this.label}).inject(o),e.createElement("div",{class:"sub-label",text:this.subLabel}).inject(s);this.subLabel&&(this.subLabelTooltip=new r({position:"bottom",target:this.getElement(".sub-label"),body:this.subLabel,className:"embedded-subLabel-tooltip"}));e.createElement("div",{class:"underline"}).inject(s);if("allw"!==this.rootw){var l=e.createElement("div",{class:"chevron-cont"}).inject(this.buttonContainer);let t=this.label+" "+n.getText("embMenu");var c=e.createElement("div",{class:"chevron-div",nls:t}).inject(l);this._menuTooltip=new r({position:"bottom",target:c,body:t,className:"embeddedW-predicate-tooltip"});e.createElement("span",{class:"fonticon fonticon-chevron-down"}).inject(c)}else if("allw"==this.rootw){var d=e.createElement("span",{class:"clear-refine-btn fonticon fonticon-trash"}).inject(o);this._removeTagTooltip=new r({position:"bottom",target:d,body:n.getText("embClearTags"),className:"embeddedW-clearTags-tooltip"})}},getActionOnClick:function(){return d.ACTION_GROUP},updateSubLabelCall:function(e){if(e&&e.subLabel){var t=this.getActionOnClick();t&&t==d.ACTION_GROUP&&(e.subLabel=n.getText("groupBy")+e.subLabel),this.getElement(".sub-label").setText(e.subLabel),this.getElement(".button-text").removeClassName("hide-sub-label"),this.subLabelTooltip&&this.subLabelTooltip.destroy(),this.subLabelTooltip=new r({position:"bottom",target:this.getElement(".sub-label"),body:e.subLabel,className:"embedded-subLabel-tooltip"})}},isReadyToUpdateGroupings:function(){return this._isReadyToUpdateGroupings},setUpdateGroupingsWhenReadyFlag:function(e){this._updateGroupingsWhenReady=e},onGroupingChange:function(e,t){t=t||{},("allw"!=this.rootw||this.proxy.hasActiveGroupings())&&(this.dispatchEvent("toggleGrouping",UWA.merge({id:this.rootw},t)),o.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedTagger",action:"onGroupingChange",persDim:{pd1:this.rootw}}}))},activateGroupingUX:function(){this.buttonContainer.addClassName("grouped")},deactivateGroupingUX:function(){this.buttonContainer.removeClassName("grouped"),this.buttonContainer.removeClassName("selected-tags")},isGroupedBy:function(e){var t=this.buttonContainer.hasClassName("grouped");return e?t&&this.navImpl.isGroupedBy(e):t},getManagedPredicate:function(){return this.predicate},updateGroupingUX:function(){this.navImpl.isGroupedBy(this.predicate)||"allw"==this.rootw&&!this.proxy.hasActiveGroupings()?this.activateGroupingUX():this.deactivateGroupingUX()},addSelectedTagClass:function(){this.buttonContainer.addClassName("selected-tags"),this.buttonContainer.addClassName("has-selected-tag")},clearRefine:function(e,t){t||(this.buttonContainer.removeClassName("selected-tags"),this.buttonContainer.removeClassName("has-selected-tag"),!1!==e&&this.selectedItems.forEach((e,t)=>{this.navImpl.toggleTagSelection(e)}),this.dispatchEvent("deactiveEmbeddedView")),o.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedView",action:"clearEmbeddedRefine",persDim:{pd1:this.rootw,pd2:"emabeddedView"}}})},searchTagsInMenu:function(e){var t;t=this.searchInput.value.toUpperCase();var a=this.searchField.getElement(".emb-clear-input-field"),r=this.searchField.getElement(".icon-cont");let l,c=[];if(this._removeItemFromMenu(this.menuItems),this.dropDownMenu.getItem("no-result-item")&&this.dropDownMenu.removeItem("no-result-item"),t?(a.addClassName("add-clear"),r.addClassName("hide-lens")):""==t&&(a.removeClassName("add-clear"),r.removeClassName("hide-lens")),l=this.getFilteredTagsItems(this.menuItems,t,c,e),!c.length){let e=new s({model:new i({id:"no-result-item",title:n.getText("noRslt")})}).render();e.setOption("identifier","no-result-item"),c.push(e)}this.dropDownMenu.addItem(l),this.dropDownMenu.getItem("no-result-item")&&this.dropDownMenu.disableItem("no-result-item"),this._treatMenuItemView(c),this.disableUpdatePosition||this.dropDownMenu.updatePosition(null),this.searchInput.focus(),o.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedTagger",action:"searchTags",persDim:{pd1:this.rootw}}})},sortMenuItems:function(e){e.sort(function(e,t){if(e.model&&t.model)return t.model.get("count")-e.model.get("count")||e.model.get("title").localeCompare(t.model.get("title"))})},_removeItemFromMenu:function(e){let t=this;for(let i=e.length-1;i>=0;i--){let a=e[i];a.getOption("subMenuItems")&&t._removeItemFromMenu(a.getOption("subMenuItems")),t.dropDownMenu.getItem(a.getOption("identifier")).items&&!t.dropDownMenu.getItem(a.getOption("identifier")).items.length&&a.getOption("subMenuItems")||t.dropDownMenu.removeItem(a.getOption("identifier"))}t.dropDownMenu.items.forEach((e,i)=>{"divider"==e.className&&t.dropDownMenu.removeItem(e.id)})},_getFilteredTags:function(e,t,i){let a=this;e.forEach((e,n)=>{t?e.getOption("subMenuItems")?a._getFilteredTags(e.getOption("subMenuItems"),t,i):e.model&&e.model.get("title").toUpperCase().indexOf(t)>-1&&!e.model.get("excludeFromSearch")?(e.render(!0,t),i.push(e)):e.isSeparator()&&(e.render(!0),i.push(e)):""==t&&(e.render(!0,t),i.push(e))}),i.every(e=>e.isSeparator())&&(i.length=0)},_getSearchField:function(t){var i=e.createElement("div",{id:"search-div"}).inject(this.dropDownMenu.getItem("search-field").elements.container);this.searchField=e.createElement("div",{class:"search-input-cont"}).inject(i),this.searchInput=e.createElement("input",{id:"search-input",type:"text",placeholder:n.getText("search"),class:"input-field"}).inject(this.searchField);var a=e.createElement("i",{class:"emb-clear-input-field fonticon fonticon-cancel-circled"}).inject(this.searchField);this._clearSearchTooltip=new r({position:"bottom",target:a,body:n.getText("embClearSearch"),className:"embeddedW-embClearSearch-tooltip"});var s=e.createElement("div",{class:"icon-cont",html:{tag:"span",class:"fonticon fonticon-search"}}).inject(this.searchField);this._searchIconTooltip=new r({position:"bottom",target:s,body:n.getText("embSearchTags"),className:"embeddedW-embSearchTags-tooltip"}),this.searchInput.addEventListener("compositionstart",e=>{this.disableUpdatePosition=!0}),this.searchInput.addEventListener("compositionend",e=>{this.disableUpdatePosition=!1}),this.searchInput.addEvent("input",this.searchTagsInMenu.bind(this)),a.addEventListener("click",this.clearInput.bind(this))},onTagClick:function(e){this.buttonContainer.removeClassName("shown"),this.dropDownMenu&&this.dropDownMenu.hide(),this.dispatchEvent("deactiveEmbeddedView"),o.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"EmbeddedTagger",action:"clickOnTagInMenu",persDim:{pd1:this.rootw}}})},buildMenuItemsStructure:function(e){var t,i=[],a=e||this.menuItems;if(a&&UWA.is(a,"array")){for(var n=0;n<a.length;n++){var s;if((t=a[n]).isSeparator&&t.isSeparator())s={className:"divider"};else{s={name:t.getOption("identifier")?t.getOption("identifier"):void 0,selectable:!t.model.get("isEmbeddedWhySection")&&!t.container.hasClassName("item-disabled"),selected:!!t.container.hasClassName("selected"),disabled:!!t.container.hasClassName("item-disabled"),template:t.container.outerHTML};var o=t.getOption("subMenuItems");o&&o.length>0&&(s.items=this.buildMenuItemsStructure(o))}i.push(s)}return i}},_hasSubMenus:function(){let e=this.menuItems;for(let t=0;t<e.length;t++)if(e[t].getOption("subMenuItems"))return!0},_treatMenuItemView:function(t){let i=this,a=!1;if(UWA.is(t,"array")){for(let e=0;e<t.length;e++){let i=t[e];if(!i.isSeparator||!i.isSeparator()){var n=i.getOption("subMenuItems");n&&n.length>0&&(a=!0),this._treatMenuItemView(n)}}if(a)for(let i=0;i<t.length;i++){let a=t[i];if(!a.getOption("subMenuItems")){var s=this.dropDownMenu.getItem(a.getOption("identifier"));let t=e.is(s,"object")&&s.elements.container.getElement(".tag-count");t&&t.addClassName("align-count")}}}this.dropDownMenu.menus.forEach(function(e){e.elements.container.addClassName("tn-embedded-menu tn-"+i.rootw.replace("ds6w:","")+"-menu")})},createDropdown:function(){var e=this,t=e.buildMenuItemsStructure(),i=l.extend({init:function(e){this._parent(e)},_onKeyDown:function(e){[13,27,37,38,39,40].includes(e.which)&&this._parent(e)},resize:function(){let e=document.activeElement;var t=navigator.userAgent.toLowerCase().indexOf("android")>-1;e&&"search-input"==e.id&&t||this._parent()},_onMouseover:function(e){var t,i,n,s=a.getElement(e),o=s.id;if(!s.hasClassName("item")){let e=s.getClosest("li.item");e&&(o=(s=e).id)}if(o=o||s.parentElement.id||s.parentElement.parentElement.id,i=this._getMenuFromParentItem(o),!(s.hasClassName("item-back")||i&&i._position&&i._position.contains("dropdown-menu-responsive-wrap")||(this.timeoutId&&clearTimeout(this.timeoutId),this.usingKeyboard))){if(!(n=this.template.getItem(s)))return;(n=this.getItem(n.id?n.id:n))&&this._handleItemSelection(n.elements.container)}this.options.responsiveMode&&(n=s.parentElement.classList.contains("next-icon")?s.parentElement.parentElement:s.parentElement,n=(i=this._getMenuFromItem(n.id))&&i.getItem(n.id),t=i&&i.getContent().hasClassName("responsive-menu"),n&&t&&(s.classList.contains("next-icon")||s.parentElement.classList.contains("next-icon"))&&!n.elements.container.classList.contains("selected")&&(n.elements.container.addClassName("js-not-selectable"),n.elements.container.removeClassName("js-selected")))}});(this._hasSubMenus()||!this._hasSubMenus()&&this.menuItems.length>7)&&t.unshift({name:"search-field",id:"search-field"}),this.dropDownMenu=new i({target:e.getElement(".chevron-cont"),className:"tn-embedded-menu tn-"+e.rootw.replace("ds6w:","")+"-menu",multiSelect:!0,closeOnClick:!1,items:t,position:"bottom right",removeOnHide:!0,zindex:e.proxy.embeddedZProperty(),events:{onShow:function(){e.buttonContainer.addClassName("shown"),e._treatMenuItemView(e.menuItems);for(var t=e.dropDownMenu.items,i=0;i<t.length;i++)t[i].elements.container.getElement(".tag-label")&&(t[i].elements.container.getElement(".tag-label").style.width="calc(100% - "+(38+t[i].elements.container.getElement(".tag-count").getDimensions().width)+"px)",t[i].elements.container.getElement(".tag-label").addClassName("add-ellipsis"));e._treatMenuItemView(e.menuItems)},onHide:function(){e.buttonContainer.removeClassName("shown")},onClick:function(t,i,a){if(!i.selectable)return;if(t.target.className.contains("fonticon-right-open"))return;let n=[],s=function(e){n=n.concat(e),e.forEach((e,t)=>{e.getOption("subMenuItems")&&s(e.getOption("subMenuItems"))})};s(e.menuItems);let o=n.find(e=>e.getOption("identifier")==i.name);o&&o._toggleTagSelection()}}}),this.dropDownMenu.getItem("search-field")&&this._getSearchField()},destroyDropDowmMenu:function(){this.dropDownMenu.items=[]},clearInput:function(e){this.searchInput.value="",this.searchTagsInMenu()},getFilteredTagsItems:function(e,t,a,o){let r;if(this._getFilteredTags(e,t,a),(!o||o&&!o.notToSort)&&this.sortMenuItems(a),!a.length){let e=new s({model:new i({id:"no-result-item",title:n.getText("noRslt")})}).render();e.setOption("identifier","no-result-item"),a.push(e)}return r=this.buildMenuItemsStructure(a)},destroy:function(){this.stopListening(),this.model=null,this._menuTooltip&&this._menuTooltip.destroy(),this._menuTooltip=void 0,this._removeTagTooltip&&this._removeTagTooltip.destroy(),this._removeTagTooltip=void 0,this._searchIconTooltip&&this._searchIconTooltip.destroy(),this._searchIconTooltip=void 0,this._clearSearchTooltip&&this._clearSearchTooltip.destroy(),this._clearSearchTooltip=void 0,this.subLabelTooltip&&this.subLabelTooltip.destroy(),this.subLabelTooltip=void 0,this.scroller&&this.scroller.destroy(),this.scroller=void 0,this._parent()}})}),define("DS/TagNavigator/simplified/views/ActionsView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/TagNavigator/Logger","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s,o,r){"use strict";return t.extend({tagName:"div",className:"tn-action-container",domEvents:{"click .action-icon":"onActionButtonClick"},updateModel:function(e){this.stopListening(this.model),this.model=null,e&&(this.model=e,this.listenTo(this.model,{"onChange:selectionCount":this._updateSelectedCount}))},onActionButtonClick:function(e){if(e.ctrlKey)return o.log("nothing happens when you click on the action button with CTRL key pressed"),!1;if(this.container.setStyle("height",50),e.target.hasClassName("fonticon-menu-dot"))this.onMenuClick(e);else if(e.target.hasClassName("fonticon-filter-select-on"))this.onSelectClick(e);else e.target.getClosest(".tn-action-container")},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.taggerView=this.getOption("taggerView"),this.hideMenuBtn=this.getOption("hideMenuBtn"),this.hideMenuBtn||(this.actionDiv=e.createElement("div",{class:"action-icon"}).inject(this.container).hide(),this.actionTooltip=new s({position:"left",target:this.actionDiv,body:i.getText("chooseAction"),className:"tn-action-tooltip"}),this.threeDotIcon=e.createElement("span",{class:"fonticon fonticon-menu-dot",id:"menu"}).inject(this.actionDiv).hide()),this.actionBox=e.createElement("div",{class:"action-box"}).inject(this.container).hide(),this.selectedCount=e.createElement("div",{class:"action-box-count",text:"0 "+i.getText("selected")}).inject(this.actionBox),this.primaryButton=new n({className:"action-button primary",disabled:!0}).inject(this.actionBox),this.cancelButton=new n({value:i.getText("cancel"),className:"action-button default cancel"}).inject(this.actionBox),this.primaryButton.addEvent("onClick",this.launchAction.bind(this)),this.cancelButton.addEvent("onClick",this.cancelAction.bind(this)),this},closeActionsDropdown:function(){this.actionDropdown&&(this.actionDropdown.destroy(),this.actionDropdown=null)},displayHideAvailableActions:function(){var e=this;if(this.actionDropdown)return this.closeActionsDropdown(),void this.dispatchEvent("removeOpacity");this.dispatchEvent("addOpacity"),this.taggerView.getAvailableActions().then(t=>{let i=t.availableActions;e.actionDropdown=new a({className:"actionItemMenu",target:this.threeDotIcon,renderTo:this.taggerView.taggerRoot,position:"top right",items:i,events:{onClick:function(t,i){e.actionSelected(i.id)},onClickOutside:function(t){e.onActionMenuHide()}}}),e.actionDropdown.show(),e.actionTooltip.hide()})},redraw:function(){this.taggerView.getAvailableActions().then(e=>{let t=e.availableActions;t.length>0?(this.show(),this.showActions=!0):(this.showActions=!1,this.hide()),e.showMenuIcon||1!==t.length?this.actionTooltip.setBody(i.getText("chooseAction")):this.actionTooltip.setBody(i.getText("select_tooltip"))})},onMenuClick:function(){this.displayHideAvailableActions()},onSelectClick:function(){this.dispatchEvent("addOpacity"),this.actionSelected("select")},onActionMenuHide:function(){this.dispatchEvent("removeOpacity"),this.closeActionsDropdown(),this.container.getElement(".action-icon").removeClassName("pressed")},_updateSelectedCount:function(e){this.selectedCount.setText(e.get("selectionCount")+" "+i.getText("selected")),e.get("selectionCount")>0?this.primaryButton.enable(!0):this.primaryButton.disable()},resetBox:function(){this.selectedCount.setText("0 "+i.getText("selected"))},enablePrimaryButton:function(){this.primaryButton.enable(!0)},actionSelected:function(e){if(this.container.setStyle("height",50),"addRemoveTags"!==e){if("addRemoveCompanyTags"===e)return this.dispatchEvent("addRemoveCompanyTags",e),this.dispatchEvent("removeOpacity"),void this.closeActionsDropdown();switch(this.actionDiv&&this.actionDiv.hide(),this.actionDiv&&this.selectedCount.show(),this.actionDropdown&&this.closeActionsDropdown(),e){case"group":this.primaryButton.setValue(i.getText("group"));break;case"exclude":this.primaryButton.setValue(i.getText("exclude"));break;case"select":this.primaryButton.setValue(i.getText("refine"));break;case"selectInApp":this.primaryButton.setValue(i.getText("selectInApp"));break;case"editTagsSelect":this.primaryButton.setValue(i.getText("apply")),this.selectedCount.hide(),e="editTagsSelect";break;case"colorize":this.primaryButton.setValue(i.getText("colorize"))}this.selectedCount.getText().startsWith("0")&&this.primaryButton.disable(),this.actionBox.show(),this.dispatchEvent("onActionSelection",{action:e,isInteractive:!0,stdView:!this.hideMenuBtn})}},launchAction:function(e){(this.actionBox.hide(),this.hideMenuBtn)||this.container.getElement(".action-icon").removeClassName("pressed");this.container.setStyle("height",0),this.dispatchEvent("onActionLaunched",{isInteractive:!0,stdView:!this.hideMenuBtn})},cancelAction:function(e,t){(this.closeActionsDropdown(),this.resetBox(),this.actionBox.hide(),this.hideMenuBtn)||this.container.getElement(".action-icon").removeClassName("pressed");this.container.setStyle("height",0),t={stdView:!this.hideMenuBtn},this.dispatchEvent("onActionCancelled",t)},abortAction:function(){this.closeActionsDropdown(),this.resetBox(),this.actionBox.hide(),this.container.getElement(".action-icon").removeClassName("pressed"),this.container.setStyle("height",0)},hideActionMenu:function(){this.actionDiv.hide()},showActionMenu:function(){},destroy:function(){this.stopListening(),this.actionTooltip&&this.actionTooltip.destroy(),this._parent()}})}),define("DS/TagNavigator/LoggerUX",["UWA/Core","UWA/Class","DS/TagNavigator/TaggerSettings"],function(e,t,i){"use strict";var a=t.singleton({start:function(){i.getOption("loggerUX")&&(i.getOption("TNLogs")||i.getOption("proxyLogs"))&&(window.update_tn_snackbar=function(){if(window.tn_snackbar){let t=arguments[0],i=arguments[1];e.createElement("DIV",{class:"tn-snackbar_elem"}).inject(window.tn_snackbar).innerText=(1==i?"[TNLogs]: ":"[ProxyLogs]: ")+(new Date).toString();for(let a=0;a<t.length;a++){let n=e.createElement("DIV",{class:"tn-snackbar_elem"});n.addClassName(1==i?"tnlogs":"proxylogs");try{n.innerText=UWA.is(t[a],"object")||UWA.is(t[a],"array")?JSON.stringify(t[a]):t[a]}catch(e){n.innerText="exception"}window.tn_snackbar.appendChild(n),window.tn_snackbar.scrollTop=window.tn_snackbar.scrollHeight-window.tn_snackbar.clientHeight}}else{let t=e.createElement("div",{id:"tn-snackbar-root"}).inject(document.body).show();window.tn_snackbar=e.createElement("div",{id:"tn-snackbar"}).inject(t),require(["DS/UIKIT/Input/Button","DS/UIKIT/Badge"],function(i,n){let s=e.createElement("div",{id:"tn-debug-controls"}).inject(t);new i({value:"Clear",class:"tn-snackbar-btn",id:"tn-debug-clear"}).inject(s).addEvent("onClick",function(){window.tn_snackbar.empty()}),new i({value:"Copy",class:"tn-snackbar-btn",id:"tn-debug-copy"}).inject(s).addEvent("onClick",function(){var e=window.tn_snackbar.getElements(".tn-snackbar_elem");let t="";e.forEach(function(e){t+=e.textContent+"\n"}),(e=>{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)})(t)}),a.contextElem=new n({content:"<<current context>>",className:"primary context_badge",icon:"tag"}).inject(s)})}})},updateContext:function(e){a.contextElem&&a.contextElem.elements.content.setText(e)}});return a}),define("DS/TagNavigator/simplified/utils/AdvancedFilterUtils",["UWA/Core","DS/TagNavigator/simplified/utils/LocationUtils","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a){"use strict";var n={OPERATOR_OR:"OR",OPERATOR_AND:"AND",OPERATOR_XOR:"XOR",EXCLUDE:"NONE",emptyFilter:{allfilters:{isSimplified:{version:2},operator:"AND",condition:[]}},operatorSupported:["OR","AND","XOR"],_predicateOperator:{},complexTagToComplexJSON:function(e,s){var o=e.predicate;let r=n.getDefaultPredicateOperator(o);return-1!==o.indexOf(t.COMPUTED_COUNTRY_INFO)||-1!==o.indexOf(t.COMPUTED_CITY_INFO)?t.buildCondition(e,s):-1!==o.indexOf(i.TYPE_CATEGORIZATION_PREDICATE)?i.buildCondition(e,s,r):-1!==o.indexOf(a.PERSON_REFINE_PREDICATE)?a.buildCondition(e,null,s,r):e},complexTagToLegacyJSON:function(e){if(UWA.is(e.condition,"object")&&e.id===i.TYPE_CATEGORIZATION_PREDICATE){var t=e.condition.predicates[0];return{predicate:t.predicate,object:e.isComposite?e.condition.value:e.condition.value[0],dispValue:t.dispValue,type:t.type,isComposite:e.isComposite}}},simpleTagToComplexJSON:function(e,t){var i={object:e.object,operator:n.OPERATOR_OR,value:[e.object],display:e.dispValue,type:e.type,predicates:[{type:e.type,predicate:e.predicate}],isComposite:e.isComposite};return e.isExplicit&&(i.field=["explicit"]),t&&(i.excluded=t),i},getDefaultPredicateOperator:function(e){let t=n._predicateOperator,i=e.split("/").pop();if(t&&0!==Object.keys(t).length&&t[i]&&t[i].operator)return t[i].operator},getIrrelevantPredicateOperator:function(e,t){let i,a=n._predicateOperator;if(t){for(let e of t)if(e=e.split("/").pop(),a&&0!==Object.keys(a).length&&a[e]&&a[e].irrelevantOperator)return a[e].irrelevantOperator}else i=e.split("/").pop();if(a&&0!==Object.keys(a).length&&a[i]&&a[i].irrelevantOperator)return a[i].irrelevantOperator},legacyTagToLegacyOrAdvancedJSON:function(e,a){var s=e.pred.id();let o=n.getDefaultPredicateOperator(s);if(s==t.COMPUTED_COUNTRY_INFO||s==t.COMPUTED_CITY_INFO)return t.buildCondition(e,a);if(-1!==i.getTypeCategorizationPredicates().indexOf(s))return i.buildCondition(e,a,o);var r={predicate:e.pred.getFullPredicateID(),object:e.uri,dispValue:e.getDisplayValue(),type:e.type};return e.isComposite&&(r.isComposite=!0),e.explicit&&(r.isExplicit=!0),e.operator&&(r.operator=e.operator),r},manageUniqueHierarchyPathSelection:function(e,t){var i=e.condition.map(function(e){return e.object}),a=t.condition.object;return i.map(function(e,t){return e.length!==a.length&&(n=a,(i=e).length<n.length?s=i.every(function(e,t){return n[t]===e}):o=n.every(function(e,t){return i[t]===e}),s||o)?t:-1;var i,n,s,o}).filter(function(e){return-1!=e})}};return n}),define("DS/TagNavigator/simplified/model/AdvancedFilter",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/TagNavigator/simplified/utils/AdvancedFilterUtils","DS/TagNavigator/TagValue","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/Filter","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,s,o,r,l){"use strict";var c=t.extend(i,{init:function(){var e=UWA.clone(a.emptyFilter),t=new o,i="AND";this.treatExistingEmbeddingFilter=function(e,t){var i=t,n=a.complexTagToLegacyJSON(e);if(n){var o=[],r=this;return this._getConditionsArray().forEach(function(e){e[Object.keys(e)[0]].condition.forEach(function(e){var t=e.value.findIndex(function(t,i){return n.isComposite?e.hasComposites&&-1!==e.hasComposites.indexOf(i)?-1!==e.hasComposites.findIndex(function(t){return n.object[0].length<=e.value[t].length?n.object[0].every(function(i){return-1!==e.value[t].indexOf(i)}):e.value[t].every(function(e){return-1!==n.object[0].indexOf(e)})}):UWA.is(e.object,"array")?n.object[0].length<=e.object.length?n.object[0].every(function(t){return-1!==e.object.indexOf(t)}):e.object.every(function(e){return-1!==n.object[0].indexOf(e)}):void 0:t===n.object}),a=!1;-1!==t&&(a=e.predicates[t].predicate===n.predicate);a&&!UWA.is(i,"boolean")&&(o.push(UWA.clone(e)),e.predicates.forEach(function(i,a){a!==t&&r.toggle(s.buildCondition({predicate:i.predicate,object:e.value[a],dispValue:i.dispValue,type:i.type,isComposite:i.isComposite}),!0,!0)}))})}),o.forEach(function(e){r.toggle({id:s.TYPE_CATEGORIZATION_PREDICATE,operator:e.operator,isComplex:!0,condition:e,isComposite:e.isComposite})}),o.length>0}},this.toggle=function(e,t){var i,s=e instanceof n,o=s?a.legacyTagToLegacyOrAdvancedJSON(e,t):e,r=!1,l={},c=o.id?o.id:o.predicate,d=this._getExistingFilter(o.id?o.id:o.predicate);if(!d)return(d=this._addNewFilter(o)).isComplex?(o.condition.isComposite=o.isComposite,d.condition.push(o.condition),l=UWA.clone(o.condition)):(d.condition.push(a.simpleTagToComplexJSON(o,t)),l=UWA.clone(a.simpleTagToComplexJSON(o,t))),{isSelected:r=!0,condition:l,id:c};if((s||o.treatEmbeddingFilter)&&this.treatExistingEmbeddingFilter(o,t)){r=this.isSelected(e);return i={condition:UWA.clone(o.condition),isSelected:r,id:c}}var g,h=d.isComplex;h&&o.isComplex&&o.predicate&&(o=a.complexTagToComplexJSON(o,t));var u=function(e,t){return t?o.condition.object.length==e.object.length&&o.condition.object.every(function(t){return-1!==e.object.indexOf(t)}):o.condition.object.length<=e.object.length?o.condition.object.every(function(t){return-1!==e.object.indexOf(t)}):e.object.every(function(e){return-1!==o.condition.object.indexOf(e)})},p=d.condition.findIndex(function(e){return h?o.isComposite?u(e):UWA.is(o.condition.object,"array")&&UWA.is(e.object,"array")?(g=!0,u(e,!0)):JSON.stringify(o.condition.object)===JSON.stringify(e.object):o.isComposite?u(e):UWA.is(o.object,"array")&&UWA.is(e.object,"array")?JSON.stringify(o.object)===JSON.stringify(e.object):o.object===e.object}),f=function(e,t){l=UWA.clone(d.condition[e]),d.condition.splice(e,1),t&&0===d.condition.length&&this._removeFilter(o.id?o.id:o.predicate),i={condition:l,isSelected:!1,id:c}};if(-1!==p)UWA.is(t,"boolean")?d.condition.forEach(function(e,i){e.object===(o.condition.object||o.object)&&(!UWA.is(t,"boolean")||!e.excluded&&e.excluded||(d.condition[i]=o.condition))}):f.call(this,p,!0);else{if(g)a.manageUniqueHierarchyPathSelection(d,o).forEach(function(e){f.call(this,e)}.bind(this));h?(o.condition.isComposite=e.isComposite,d.condition.push(o.condition),i={condition:UWA.clone(o.condition),isSelected:!0,id:c}):(d.condition.push(a.simpleTagToComplexJSON(o,t)),i={condition:UWA.clone(o.condition),isSelected:!0,id:c})}return i},this._getConditionIndex=function(e,t,i,a){var n=t.isComplex;return t.condition.findIndex(function(t){if(n){var s;if(!(s=UWA.is(i.condition.object,"array")&&UWA.is(t.object,"array")?JSON.stringify(i.condition.object)===JSON.stringify(t.object):i.condition.object===t.object))if(i.isComposite)s=i.condition.object.length<=t.object.length?i.condition.object.every(function(e){return-1!==t.object.indexOf(e)}):t.object.every(function(e){return-1!==i.condition.object.indexOf(e)});else if(a){var o=t.value.findIndex(function(e){return e===i.condition.object});if(-1!==o)s=t.predicates[o].predicate===e.pred.getFullPredicateID()}return s}return UWA.is(i.object,"array")&&UWA.is(t.object,"array")?JSON.stringify(i.object)===JSON.stringify(t.object):i.object===t.object})},this.isSelected=function(e){var t=e instanceof n,i=t?a.legacyTagToLegacyOrAdvancedJSON(e):e,s=!1,o=this._getExistingFilter(i.id?i.id:i.predicate);if(o){s=-1!==this._getConditionIndex(e,o,i,t)}return s},this.isExcluded=function(e){var t=e instanceof n,i=t?a.legacyTagToLegacyOrAdvancedJSON(e):e,s=this._getExistingFilter(i.id?i.id:i.predicate);if(s){let a=this._getConditionIndex(e,s,i,t);if(-1!==a)return s.condition[a].hasOwnProperty("excluded")&&s.condition[a].excluded}return!1},this.computeFilterObj=function(e,n,s,o,r){var l=UWA.clone(a.emptyFilter);if(l.allfilters.operator=i,!1!==s&&this._getConditionsArray().forEach(function(e){var t=UWA.clone(e);t[Object.keys(t)[0]].condition.forEach(function(e){if(e.isComposite){e.value=e.value[0].map(function(e){return e});var t=e.predicates[0];e.predicates=e.value.map(function(e){return t})}else if(e.hasComposites){var i=[],a=[];e.value.forEach(function(t,n){if(-1!==e.hasComposites.indexOf(n)){var s=e.predicates[n];t.forEach(function(e){i.push(e),a.push(s)})}else i.push(t),a.push(e.predicates[n])}),e.value=i,e.predicates=a}}),l.allfilters.condition.push(UWA.clone(t))}),!s){var c=t.computeFilterObj(null,null,!1,!0);if(c&&UWA.is(c.allfilters,"object"))for(var d in c.allfilters){var g={};g[d]=c.allfilters[d],l.allfilters.condition.push(g)}}return l},this.getSelectedTagValues=function(e){var t=[],i=this._getConditionsArray();for(let o=0;o<i.length;o++)if(i[o].hasOwnProperty(e)){var a=UWA.clone(i[o][e].condition);if(a)for(let n=0;n<a.length;n++){let s={object:a[n].object,display:a[n].display,type:a[n].type,predicate:e,isComposite:a[n].isComposite,isComplex:i[o][e].isComplex};t.push(s)}}else{var n=UWA.clone(this.getSelectedAttributes("sixw:"+e));if(n){var s=n["sixw:"+e];for(let e=0;e<s.length;e++)t.push(s[e])}}return t},this.removeFreeInput=function(e,i,a,n,s){return t.removeFreeInput(e,i,a,s)},this.createFreeInput=function(e,i,a,n){return t.createFreeInput(e,i,a,n)},this.getSelectedAttributes=function(e){return t.getSelectedAttributes(e)},this.isSelectedAttribute=function(e,i){return t.isSelectedAttribute(e,i)},this.isEmpty=function(){return 0===this._getConditionsArray().length&&t.isEmpty()},this.count=function(){return this._getConditionsArray().length+t.count()},this.clear=function(){e=null,e=UWA.clone(a.emptyFilter),t.clear()},this._getConditionsArray=function(){return e.allfilters.condition},this._getExistingFilter=function(e){var t=this._getConditionsArray(),i=t.findIndex(function(t){return Object.keys(t)[0]===e}),a=-1!==i?t[i]:void 0;return a?a[e]:void 0},this.operatorIsOverloaded=function(e){return!!this._checkDefaultOperator(e)||!!this._checkOperatorChangedFromUI(e)},this._checkOperatorChangedFromUI=function(e){return!!e.operator&&e.operator!=a.OPERATOR_OR},this._checkDefaultOperator=function(e){let t=function(e){let t=e.predicates;for(let e=0;e<t.length;e++){let i=a.getDefaultPredicateOperator(t[e].predicate);if(i)return i}return null},i=e.id?e.id:e.predicate,n=a.getDefaultPredicateOperator(i);if(n)return n;if(e.isComplex&&!n)if(Array.isArray(e.condition)){let i=e.condition;for(let e=0;e<i.length;e++){let a=t(i[e]);if(a)return a}}else if("object"==typeof e.condition){return t(e.condition)}},this._addNewFilter=function(e){let t=e.id?e.id:e.predicate,i=e.operator?e.operator:null,n=e.isComplex,s=this._checkDefaultOperator(e);var o={};return o[t]={operator:i||(s||a.OPERATOR_OR),condition:[]},n&&(o[t].isComplex=!0),this._getConditionsArray().push(o),o[t]},this._removeFilter=function(e){var t=this._getConditionsArray(),i=t.findIndex(function(t){return Object.keys(t)[0]===e});if(-1===i)throw new Error("FAILED to remove filter "+e);t.splice(i,1)},this.getNumberOfTags=function(){return this._getConditionsArray().reduce(function(e,t){return e+t[Object.keys(t)[0]].condition.length},0)},this.getNumberOfPredicates=function(){return this._getConditionsArray().length},this._setFilterObj=function(t){e=t},this._setAttributes=function(a,n,s){e=a,t=n.cloneFilter(),i=s},this.cloneFilter=function(){var a=new c;return a._setAttributes(UWA.clone(e),t,i.slice()),a},this.setGlobalOpertor=function(e){i=e},this.getGlobalOperator=function(){return i},this.changeLocalOperator=function(e,t){var i=this._getExistingFilter(e);i&&(i.operator=t,i.hasOwnProperty("excluded")&&delete i.excluded)},this.handleExclude=function(e,i){let s=e instanceof n?a.legacyTagToLegacyOrAdvancedJSON(e,i):e,o=s.id?s.id:s.predicate,l=s.tagName?s.tagName:s.condition?s.condition.display:s.dispValue;var c=this._getExistingFilter(o);if(c){var d=c.condition.findIndex(e=>e.display==l);i?(c.condition[d].excluded=!0,o==r.PERSON_REFINE_PREDICATE&&(c.condition[d].operator="AND")):(delete c.condition[d].excluded,o==r.PERSON_REFINE_PREDICATE&&(c.condition[d].operator="OR"))}else{let a;e.tagInfo&&(a=e.tagInfo),t.excludeAttribute(o,l,a,i)}},this.setAdminPredOperator=function(e){a._predicateOperator=UWA.clone(e)},this.setCondition=function(i){e.allfilters.condition=[],this.clear();let a=i.condition;0==a.length?e.allfilters.condition=a:a.forEach(i=>{let a=Object.keys(i)[0];i[a].hasOwnProperty("condition")?e.allfilters.condition.push(i):Array.isArray(i[a])&&i[a].forEach(e=>{let i;i=e.displayValue;let n=e.object.isSimplifiedCriteria?e.object.isSimplifiedCriteria:"";this.createFreeInput(a,e.type,e.object,i,n),e.hasOwnProperty("excluded")&&t.excludeAttribute(a,i,e.object,e.excluded)})})}}});return c}),define("DS/TagNavigator/TagWidget/freeInput/NumberRangeInputView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Text","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"tnw add-tag-cont fromto",_rangeInput:void 0,isFreeInput:function(){return!0},setup:function(e){this._parent(e),this._predicate=e.predicate,this._rangeInput={}},render:function(){return this._parent(),this.container.setHTML('<div class="tnw-fromto">                <span class="tnw-from add-tag-close">                  <span class="fonticon fonticon-cancel-circled"></span>                </span>              </div>              <div class="tnw-fromto">                <span class="tnw-to add-tag-close">                  <span class="fonticon fonticon-cancel-circled"></span>                </span>              </div>'),this.draw()},draw:function(){let e=this.getOption("navImpl"),t=this,n=this.getOption("type"),s=e.getCache(),o=e.getFocusedProxy(),r=s.getCriteriaToResetBeforeFilterChange(o?o.id():void 0),l=s.getCriteriaToRemoveBeforeFilterChange(o?o.id():void 0),c=["from","to"];var d=[],g=null,h="integer"===n?"int":"float";for(let s=0;s<c.length;s++){var u=c[s];t._rangeInput[u]=new i({placeholder:a.getText(u)+":"+a.getText("type"+h+("from"===u?"min":"max")),className:u});t._rangeInput[u].elements.input.addEvent("keyup",function(i){var a,s={};a=(a=i.target.value).replace(",",".");var o=i.target.hasClassName("from")?"from":"to",c=a.length<=0;if(c||(c="int"===h?!isNaN(parseInt(a))&&parseInt(a)+""===a:!isNaN(parseFloat(a))&&parseFloat(a)+""===a),UWA.is(i.target.type,"string")&&"text"==i.target.type&&UWA.is(i.target.parentNode)){if(!0!==c)return i.target.getClosest("div").addClassName("has-error")&&!1;i.target.getClosest("div").removeClassName("has-error")}if(13===i.keyCode){if(a){var u={predicate:t._predicate,type:n};s[o]=a,u.value=s,d.push(u),r[t._predicate.id()]["from"===o?"to":"from"]&&((g={predicate:t._predicate,type:n}).value={},g.value["from"===o?"to":"from"]=r[t._predicate.id()]["from"===o?"to":"from"].value),g&&d.push(g),e.createFreeInputs(d),t.dispatchEvent("criteriaSelected")}}else{var p;r[t._predicate.id()]=r[t._predicate.id()]||{},r[t._predicate.id()].type=n,a?r[t._predicate.id()][o]={value:a,type:n}:(p={predicate:t._predicate,type:n},r[t._predicate.id()][o]&&r[t._predicate.id()][o].value&&(p.value={},p.value[o]=r[t._predicate.id()][o].value,l.push(p)),delete r[t._predicate.id()][o]),1===Object.keys(r[t._predicate.id()]).length&&delete r[t._predicate.id()]}}),r[t._predicate.id()]&&r[t._predicate.id()][u]&&t._rangeInput[u].setValue(r[t._predicate.id()][u].value)}return this._rangeInput.from.inject(this.container.getElement(".tnw-from"),"before"),this._rangeInput.to.inject(this.container.getElement(".tnw-to"),"before"),this},destroy:function(){this._rangeInput.from&&(this._rangeInput.from.destroy(),this._rangeInput.from=void 0),this._rangeInput.to&&(this._rangeInput.to.destroy(),this._rangeInput.to=void 0),this._parent()}})}),define("DS/TagNavigator/TagWidget/DateTagView",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/TagView.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/TagWidget/AbstractTagView"],function(e,t,i,a,n,s,o){"use strict";var r=o.extend({tagName:"li",className:"tnw tag date",template:a.compile(i),setup:function(e){this._parent(e)},render:function(){this._parent();var e=this.template();return this.container.setContent(e),this.tvView=this.getOption("tvView"),this.hideTagsCount=this.getOption("hideTagsCount"),this.drawView(),this},drawView:function(){let t=this.container.getElement(".tag-label"),i=this.model.get("displayName"),a=this.model.get("count"),o=this.model.get("isPreciseCount"),r=this.model.get("isSelected"),l=this.isTagGrouped(),c=this.model.get("explicit"),d=(this.model.get("isUnderCreation"),this.model.get("icon")),g=this.isTagExcluded(),h=this.model.get("hide"),u=this.model.get("object"),p={};p.hideTagsCount=this.hideTagsCount;var f=["year","month","day"][u.split("/").length-1];if(this.container.toggleClassName("hide",h),this.tvView){this.model.get("isDeletable")&&(this.model.get("isSwymCommunityInFocus")(this.tvView)&&this.model.get("isCommunityTag")?this.model.set("isDeletable",!1):this.model.get("isOntologyTag")&&this.model.getChildCollection().length>0&&this.model.set("isDeletable",!1))}if(t.setText(i),this.isChildSelected=this.isDateSelected(u),r||this.isChildSelected?(this.container.addClassName(" expanded selected "+f),this.dispatchEvent("hasActiveTag"),this.loadChildTags(p)):(a=n.convertToUnity(a,o),this.hideTagsCount?this.container.getElement(".tag-count").setText(""):this.container.getElement(".tag-count").setText(a)),l&&this.container.addClassName("grouped-by"),c&&this.container.addClassName("explicit"),this.updateTagColor(),d&&d.match(/fonticon-*/))e.createElement("span",{className:"tag-icon fonticon "+d}).inject(t,"before");else if(d&&d.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/)&&-1!==["gif","tiff","jpg","jpeg","bmp","png","ico"].indexOf(d.split(".").pop())){e.createElement("span",{className:"tag-image",styles:{width:"20px",height:"20px"}}).inject(t,"before").setAttributes({src:d})}g&&this.container.getElement("span.excluded").toggleClassName("hide",!g),this._checkIfTagPinned(),this._tooltip=new s({position:"bottom",target:this.container.getElement(".tag-label"),body:i}),this._tooltipcount=new s({position:"bottom",target:this.container.getElement(".tag-count"),body:a});let m=this.tvView&&this.tvView.actionManager?this.tvView.actionManager.getCurrentAction():void 0;if(m){m._selection.forEach(e=>{e.object==this.model.getRefineData().object&&this.container.addClassName("picked")})}},loadChildTags:function(e){let t=this.navImpl,i=this.predicate,a=this.model.getChildCollection();if(a){let n=this.container.getElement("ul.tags-list-tree"),s=this;a.forEach((a,o)=>{let l=a.get("object"),c={model:a,navImpl:t,predicate:i};e&&(c.hideTagsCount=e.hideTagsCount),this.tvView&&(c.tvView=this.tvView),(!s.isChildSelected||s.isChildSelected&&s.isDateSelected(l))&&s.childViews.push(new r(c).render().inject(n))})}},isDateSelected:function(e){let t=this.model.get("predicate"),i=this.model.get("isSelected");if(!i){let a,n=this.navImpl.getListOfSelectedTagValues(t);if(n.length&&(a=n[0].uri),a&&""!==a&&!(i=0===a.indexOf(e))&&0!==e.indexOf(a))return""}return i},updateTagColor:function(){let e,t=this.navImpl.getCache().colorManager,i=this.model.get("isColorized"),a=this.model.get("object"),n=this.isDateSelected(a);if(i){let i,o=this.model.getTagValue();var s=["year","month","day"][a.split("/").length-1];n&&"day"!==s||(e=t.getNewColorForTagValue(o)||i)}this.container.getElement(".tag-color").toggleClassName("hide-color",!e),this.container.getElement(".tag-color").setStyle("background-color",e)},destroyChildViews:function(){this.childViews.length&&(this.childViews.forEach(e=>{e.removeColorOnDestroy(),e.destroy()}),this.childViews=[])},destroy:function(){this.childViews&&this.childViews.length&&this.childViews.forEach(e=>{e.destroy()}),this._tooltip&&this._tooltip.elements&&this._tooltip.destroy(),this.model=null,this.stopListening(),this._parent()}});return r}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootHowView",["UWA/Core","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"embedded-root-container embedded-how",init:function(e){this._parent(e)},render:function(){return this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedAllWView",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s,o,r){"use strict";return n.extend({tagName:"div",className:"embedded-root-container embedded-all",init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.label=this.defaultValues.label?this.defaultValues.label:"All",this.subLabel=this.defaultValues.subLabel?this.defaultValues.subLabel:"",this.icon="fonticon-list ",this._parent()},getActionOnClick:function(){return null},redrawTags:function(e){this.container.removeClassName("disableW"),this.proxy.hasActiveGroupings()?this.deactivateGroupingUX():this.activateGroupingUX(),this.subLabel&&this.buttonContainer.getElement(".button-text").removeClassName("hide-sub-label")},clearRefine:function(){this.navImpl.clearFilters();this._parent(!1,!1)}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedAdvancedActiveCriteria",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/activeTags/AdvActiveTagView","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils","DS/TagNavigator/Predicate"],function(e,t,i,a,n,s){"use strict";return t.extend({tagName:"ul",className:"advanced-active-tags active-predicate-list",init:function(t){this.proxy=t.proxy,e.is(this.proxy)&&e.is(this.proxy._embeddedTaggerViewOptions)&&e.is(this.proxy._embeddedTaggerViewOptions.is6WInWebInWinActive)&&!0===this.proxy._embeddedTaggerViewOptions.is6WInWebInWinActive&&(this._listOfActiveTag=[]),this._parent(t)},setup:function(e){this._parent(e)},render:function(){return this},redraw:function(e){this.container.innerHTML="",this.lastPredicate=void 0,this.objectPredicateTag=new Map,this.advancedFilter=this.proxy._selectedValues,this.filter=n.computeFilters(this.advancedFilter),this.modified=!1,this.addActiveTags()},addActiveTags:function(){let t=this,i=[];this.activeTags={},this.filter&&this.filter.allfilters&&(i=this.filter.allfilters.condition?this.filter.allfilters.condition:this.filter.allfilters),e.is(t._listOfActiveTag,"array")&&(t._listOfActiveTag=[]),(i.length||this.activeGroupings&&this.activeGroupings.length)&&(this.emptyView&&this.emptyView.hide(),this.modified||(this.modified=n.hasOverloadedOperator(i,this.advancedFilter)),this.addTag(i))},_getActiveTagsOption:function(e){let t;return e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName,t.predDispName=e.predDispName,t.icon=e.icon):t=UWA.clone(e),{id:t.tagName.replaceAll(" ","_")+"::"+t.id,text:t.tagName,isSimplified:!0,icon:"fonticon-3ds-"+t.icon,hasActions:this.proxy.hasExcludeSupport(),hasExcludeSupport:this.proxy.hasExcludeSupport(),isExcluded:t.excluded,condition:e,attribute:[{"predicate-name":t.predDispName}],advancedProxy:!0}},addTag:function(t){let a=this;t.forEach(t=>{let o=[],r=Object.keys(t)[0],l=r.split("/").pop(),c=l.contains("sixw:")?s.getPredicate(l.replace("sixw:","")).displayName():s.getPredicate(l).displayName(),d=this._getPredicateIcon(r);if((o=n.getTags(t[r]))&&o.length){let s=["string","boolean"];o.forEach((l,g)=>{let h,u;l.condition.display?h=l.condition.display:-1==s.indexOf(l.condition.type)&&(h=l.condition.display?l.condition.display:n._computeDateNls(UWA.clone(l.condition.object))),t[r].isComplex?u={condition:l.condition,id:r,predDispName:c,tagName:h,icon:d,isComplex:t[r].isComplex}:((u=l.condition).id=r,u.predDispName=c,u.tagName=h,u.icon=d);let p=this._getActiveTagsOption(u);c&&(p.predDispName=c);let f=t[r].operator,m=this.createTagView(p);this.activeTags[p.id]=m,0==g&&this.modified&&f&&"XOR"==f&&e.createElement("span",{class:"tag-label operator-text",text:i.getText("only")}).inject(m.container,"before"),g>=0&&g+1!=o.length&&this.modified&&f&&e.createElement("span",{class:"tag-label operator-text",text:i.getText(f)}).inject(this.container),e.is(a._listOfActiveTag,"array")&&e.is(m)&&a._listOfActiveTag.push(m)})}})},createTagView:function(e){let t=new a(e).render().inject(this.container);return t.addEvent("excludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("unexcludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("removeActiveTag",this.dispatchRemoveEvent.bind(this)),t},_getPredicateIcon:function(e){return e.contains("ds6w:what")?"what":e.contains("ds6w:where")?"where":e.contains("ds6w:when")?"when":e.contains("ds6w:who")?"who":e.contains("ds6w:why")?"why":e.contains("ds6w:how")?"how":void 0},dispatchRemoveEvent:function(e){let t,i=e.option;if(t={dispValue:i.display,type:i.type,predicate:i.id},i.id.contains("sixw:")){let e=UWA.clone(i.id.split("/").pop()),a=s.getPredicate(e);t.predicate=a,-1==["string","boolean"].indexOf(t.type)&&(i.object.from||i.object.to)?t.value={isSimplifiedCriteria:i.isSimplifiedCriteria,from:i.object.from,to:i.object.to}:t.value=i.object,this.proxy._navimpl.removeFreeInputs([t],!0)}else i.isComplex?t=e.option:t.object=i.object,this.proxy._navimpl.toggleTagSelection(t)},dispatchExcludeEvent:function(e){let t,i;e.option.isComplex?(t=e.option,i=e.option.condition.excluded):(t={dispValue:e.option.display,object:e.option.object,type:e.option.type,predicate:e.option.id},i=e.option.excluded,t.predicate.includes("sixw:ds6w:when")&&(t.isComplex=!0)),i?this.proxy._navimpl.excludeTag(t):this.proxy._navimpl.undoExcludeTag(t)},destroy:function(){e.is(that._listOfActiveTag,"array")&&this._listOfActiveTag.forEach(function(e){e.destroy()}),this.stopListening(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhoView",["UWA/Core","UWA/Class/Model","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/UserSettings","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/Predicate"],function(e,t,i,a,n,s,o,r,l){"use strict";return i.extend({tagName:"div",className:"embedded-root-container embedded-who",init:function(e){this._parent(e);var t=this;s.getUserInfo().then(function(e){t.me=e.firstname+" "+e.lastname}),this._mapOfMenuItems={},this.updateImageCB=this.updateImage.bind(this)},setup:function(e){this._parent(e)},render:function(){return this.predicate=o.PERSON_PREDICATE,this.label=this.defaultValues.label?this.defaultValues.label:"Who",this.icon="fonticon-3ds-who",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){var t=this;this.menuItems.forEach(function(e){e.destroy()}),this.menuItems=[],this._mapOfMenuItems={};var i=[];this.selectedItems=[];var n=[];t.hideTagsCount=!1,t.hideTagsCount=t.navImpl.getHideCountProperty(["ds6w:responsible","ds6w:lastModifiedBy"]);var s=o.getUsersInfo(this.navImpl,["ds6w:responsible","ds6w:lastModifiedBy"]),c=void 0;s.forEach((e,s)=>{var l=new r({model:e,navImpl:this.navImpl,isPreciseCount:this.isPreciseCount,hideTagsCount:t.hideTagsCount});l.addEvent("toggleSelection",this.onTagClick.bind(this)),t._mapOfMenuItems[e.get("title")]=e;var d=e.get("personInfo");d&&d.addEvent("onChange:imageURL",t.updateImageCB),t.me&&t.me===e.get("title")?(c=l,e.set("title",a.getText("me"))):i.push(l),l.render(),e.set("menu_identifier",l.getOption("identifier")),l.container.hasClassName("selected")&&(t.selectedItems.push(o.buildCondition(e)),n.push(e.get("title")))}),i.length||c?(this.container.removeClassName("disableW"),this.sortMenuItems(i),c&&i.unshift(c),this.menuItems=i,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown()):this.container.addClassName("disableW");var d=l.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=d),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")},sortMenuItems:function(e){var t,i;return e.sort(function(e,a){var n,s;return n=e.model,s=a.model,t=n.getCount(),i=s.getCount(),t=t.exactCount?t.count:t,(i=i.exactCount?i.count:i)-t||e.model.get("title").localeCompare(a.model.get("title"))}),e},updateImage:function(e){if(this.dropDownMenu){let t=this._mapOfMenuItems[e.get("title")];if(t){let e=t.get("menu_identifier");if(e){let i=this.dropDownMenu.getItem(e).elements.container.getElement(".tag-image");i&&i.setAttributes({src:t.getImage()})}}}},onTagClick:function(e){var t=e.model;if(t){var i=o.buildCondition(t);this.navImpl.toggleComplexTagSelection(i)}this._parent(e)},getGroupingData:function(){var e,t,i=[],a={predicate:this.predicate,object:i},n=this.navImpl.getFocusedProxy().getGroupingConfig();return this.menuItems.forEach(function(a){e=a.model;var s={dispText:(t=o.buildCondition(e)).condition.display,type:t.condition.type};this._groupingFormatV2?(s.object={operator:t.condition.operator,predicates:t.condition.predicates,value:t.condition.value},t.isComplex&&(s.isComplex=!0),s.identifier=t.condition.object):(s.object=t.condition.value,s.predicate=t.condition.predicates.map(function(e){return e.predicate})),n.withIconInfo&&(s.iconInfo={image:e.getImage()}),i.push(s)}.bind(this)),a}})}),define("DS/TagNavigator/simplified/activeTags/PredicateView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/Input/Select","DS/TagNavigator/simplified/activeTags/AdvActiveTagView","DS/TagNavigator/simplified/utils/AdvancedFilterUtils","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s,o,r,l){"use strict";return t.extend({tagName:"div",className:"predicate-tags tag-list-cont",setup:function(e){this._parent(e)},render:function(){let t=this;this.predicateInfo=this.getOption("predicateInfo"),this.mode=this.getOption("mode"),this.toShowHeader=this.getOption("toShowHeader"),this.predicate=Object.keys(this.predicateInfo)[0],this.filter=this.predicateInfo[this.predicate],this.exclude=this.getOption("exclude"),this.activeTags=0,this.activeTagView={},this.isAdvCriteria=this.getOption("isAdvCriteria"),this.predId=this.predicate.split("/").pop(),this.predDispName=this.predId.contains("sixw:")?o.getPredicate(this.predId.replace("sixw:","")).displayName():o.getPredicate(this.predId).displayName();let n=this._getPredicateIcon(this.predicate),c=this.predId;this.tagsListCont=e.createElement("div",{class:"active-tags-list-container",styles:{display:"block"}}).inject(this.container),this.predicateLabelCont=e.createElement("div",{class:"predicate-label-cont "+t.mode}).inject(this.tagsListCont).hide(),e.createElement("span",{class:"w-icon fonticon fonticon-3ds-"+n}).inject(this.predicateLabelCont),e.createElement("div",{class:"object-predicate-label",text:t.predDispName}).inject(this.predicateLabelCont),this.predContainer=e.createElement("div",{class:"predicate-container"}).inject(this.tagsListCont),this.predContainer.setAttributes({predicate:c}),this.predicateTagsList=e.createElement("ul",{class:"active-predicate-list "});let d,g,h=this.getPredicateOperator(),u=[];if(l.getOption("toShowXOR")){d=h||s.OPERATOR_OR,this.predicateInfo[this.predicate].isComplex&&(g=r.getActualPredicates(this.predicateInfo[this.predicate]));let t=s.getIrrelevantPredicateOperator(this.predicate,g);s.operatorSupported.forEach(a=>{(t&&t.length&&!t.includes(a)||!t)&&u.push({value:i.getText("local_"+a),selected:!!e.equals(d,a)})})}else{d=h?h===s.OPERATOR_XOR?s.OPERATOR_OR:h:s.OPERATOR_OR;let t=s.getIrrelevantPredicateOperator(pred);s.operatorSupported.forEach(a=>{(t&&t.length&&!t.includes(a)||!t)&&u.push({value:i.getText("local_"+a),selected:!!e.equals(d,a)})})}return e.is(d)&&!this.predicate.contains("sixw:")&&(this.select=new a({className:"combo-operator hide",showTooltips:!0,placeholder:!1,options:u,predicate:t.predicate,events:{onChange:function(){let e=this.getValue()[0],a=s.getDefaultPredicateOperator(t.predId);switch(e){case i.getText("local_OR"):e=s.OPERATOR_OR;break;case i.getText("local_AND"):e=s.OPERATOR_AND;break;case i.getText("local_XOR"):e=s.OPERATOR_XOR}t.changeLocalOperator({predicate:t.predicate,operator:e,informView:a!==e}),t.updateLocalOperatorText(e)}}}).inject(this.predContainer)),this.predicateTagsList.inject(this.predContainer),this.updatePredicateView(),this},updatePredicateView:function(e){this.mode=e?e.mode:this.mode,e&&e.predicateInfo&&(this.old_filter=UWA.clone(this.filter),this.filter=e.predicateInfo[this.predicate]),this.toShowHeader=e?e.toShowHeader:this.toShowHeader,(this.toShowHeader||"writeable"==this.mode)&&this.predicateLabelCont.show(),this.createTagView()},getPredicateOperator:function(){return"object"==typeof this.filter&&(this.filter&&this.filter.operator)},updateLocalOperatorText:function(t){"XOR"!=t?this.container.getElement(".operator-text-xor")&&this.container.getElement(".operator-text-xor").destroy():e.createElement("span",{class:"tag-label operator-text-xor",text:i.getText("only")}).inject(this.predicateTagsList,"top");let a=this.container.getElements(".operator-text");a.length&&a.forEach(e=>{e.setText(i.getText(t))}),this.filter.operator=t},createTagView:function(){let t,a=this,n="writeable"==this.mode||"readOnly"==this.mode&&this.toShowHeader;this.old_filter||this.destroyAllActiveTagViews();let s=this.filter,o=this.old_filter;if((t=r.checkNewfilter(s,o,n)).newAddedFilters.length||t.oldFilters.length?!t.newAddedFilters.length&&t.oldFilters.length?(this.destroyAllActiveTagViews(),t=t.oldFilters):t=t.newAddedFilters:this.destroyAllActiveTagViews(),Array.isArray(t)&&t.length){this.show();let n=["string","boolean"];t.forEach((t,s)=>{let o;t.condition.display?o=t.condition.display:-1==n.indexOf(t.condition.type)&&(o=t.condition.display?t.condition.display:r._computeDateNls(UWA.clone(t.condition.object)));let l={};this.predicateInfo[this.predicate].isComplex?l={condition:t.condition,id:this.predicate,tagName:o}:((l=t.condition).id=this.predicate,l.tagName=o);let c=a._getActiveTagsOption(l),d=a._createActiveTagView(c);this.activeTags++,"XOR"==a.getPredicateOperator()&&1==a.activeTags?e.createElement("span",{class:"tag-label operator-text-xor",text:i.getText("only")}).inject(a.predicateTagsList):(a.toShowHeader||"writeable"==a.mode)&&a.getPredicateOperator()&&a.activeTags>1&&e.createElement("span",{class:"tag-label operator-text",text:i.getText(a.getPredicateOperator())}).inject(a.predicateTagsList),d.container.inject(a.predicateTagsList),this.activeTagView[c.attribute[0].unique_id]=d})}if(this.select){let e=this.activeTags>1&&"writeable"==this.mode;this.select.elements.container.toggleClassName("hide",!e)}},_createActiveTagView:function(e){this.predDispName&&(e.predDispName=this.predDispName);let t=new n(e).render();return t.addEvent("removeActiveTag",this.dispatchRemoveEvent.bind(this)),t.addEvent("unexcludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("excludeTag",this.dispatchExcludeEvent.bind(this)),t},dispatchRemoveEvent:function(e){let t=e.option;this.destroyActiveTagView(t),"writeable"==this.mode&&this.updateView(),this.dispatchEvent("removeTag",t)},updateView:function(){1==this.activeTags?this.select&&!this.select.elements.container.isHidden()&&this.select.elements.container.toggleClassName("hide",!0):this.select&&this.select.elements.container.isHidden()&&this.select.elements.container.toggleClassName("hide",!1)},dispatchExcludeEvent:function(e){let t=e.option;if("writeable"==this.mode){(e.option.condition?e.option.condition.excluded:e.option.excluded)&&this.destroyActiveTagView(e.option)}this.dispatchEvent("excludeTag",t)},addTag:function(t){let a=this._getActiveTagsOption(t),n=this._createActiveTagView(a);this.activeTags++,this.updateView(),"XOR"==this.getPredicateOperator()&&1==this.activeTags?e.createElement("span",{class:"tag-label operator-text-xor",text:i.getText("only")}).inject(this.predicateTagsList):this.getPredicateOperator()&&this.activeTags>1&&e.createElement("span",{class:"tag-label operator-text",text:i.getText(this.getPredicateOperator())}).inject(this.predicateTagsList),n.container.inject(this.predicateTagsList),this.activeTagView[a.attribute[0].unique_id]=n,this.show()},_getActiveTagsOption:function(e){let t;e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e);let i="";"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+this.predicate:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+this.predicate);let a=this.predicate.split("/");return{text:t.tagName,isSimplified:!0,hasActions:this.exclude,hasExcludeSupport:this.exclude,isExcluded:t.excluded,condition:e,attribute:[{"predicate-name":a.pop(),unique_id:i}],advancedProxy:!0,renderTo:!0}},_getPredicateIcon:function(e){return e.contains("ds6w:what")?"what":e.contains("ds6w:where")?"where":e.contains("ds6w:when")?"when":e.contains("ds6w:who")?"who":e.contains("ds6w:why")?"why":e.contains("ds6w:how")?"how":void 0},_computeDateNls:function(e){let t=e.from.split("/").reverse().join("/"),a=e.to.split("/").reverse().join("/");return t&&!a?i.getText("from")+": "+t:!t&&a?i.getText("to")+": "+a:t&&a?t+" - "+a:void 0},changeLocalOperator:function(e){this.dispatchEvent("updatePredicateOperator",e)},destroyActiveTagView:function(e){let t,i="";if(e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e),"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+this.predicate:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+this.predicate),this.activeTagView[i]){let e=this.predicateTagsList.getElement("li.tag[unique_id='"+i+"'] + span.operator-text");return e?e.destroy():(e=this.predicateTagsList.getElements("span.tag-label").pop())&&e.destroy(),this.activeTagView[i].destroy(),delete this.activeTagView[i],this.activeTags--,this.activeTags||this.hide(),!0}return!1},destroyAllActiveTagViews:function(){this.hide(),this.activeTags=0,this.predicateTagsList.empty();for(let e in this.activeTagView)this.activeTagView[e].destroy();this.activeTagView={}},destroy:function(){this.stopListening(),this.destroyAllActiveTagViews(),this._parent()}})}),define("DS/TagNavigator/simplified/views/DropdownMenu6W",["UWA/Core","DS/UIKIT/DropdownMenu","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip"],function(e,t,i,a){"use strict";return t.extend({init:function(e){this._parent(e)},closeOnClick:!1,defaultOptions:{items:[{name:"allw"},{className:"divider"},{name:"ds6w:what"},{name:"ds6w:where"},{name:"ds6w:who"},{name:"ds6w:when"},{name:"ds6w:how"},{name:"ds6w:why"}]}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedWhenMenuItem",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/Controls/Label","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s){"use strict";return a.extend({_secondaryLabel:null,init:function(e){this._parent(e),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(){return this._parent(),this.container.setAttributes({id:this.model.id}),this},addContent:function(){this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".tag-image").setStyles({"border-radius":"0"}),this.container.getElement(".image-div").setStyle("display","inline-block");var e=this.container.getElement(".tag-label");e.setContent(this.model.get("title")),s.getOption("dateTagsWithGMT")&&(this._secondaryLabel=new n({value:i.getText("gmt"),emphasize:"secondary"}).inject(e),this._secondaryLabel.getContent().addClassName("tn-gmt"));var a=this.container.getElement(".tag-count");if(a){var o=this.model.get("count");this.hideTagsCount?a.setText(""):a.setText(i.convertToUnity(o,this.isPreciseCount)),0==o&&this.container.addClassName("item-disabled")}this.model.get("isSelected")&&this.container.addClassName("selected"),this.setOption("identifier",t.getUUID().substr(0,6))},destroy:function(){this.stopListening(),this.model=null,this._secondaryLabel&&this._secondaryLabel.destroy(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedTaggerActiveCriteria",["UWA/Core","UWA/Class/View","DS/TagNavigator/ActiveCriteria","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedAdvancedActiveCriteria"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"embedded-tagger-active-tags",init:function(e){this._activeCriteriaView=void 0,this.proxy=e.proxy,this._parent(e)},setup:function(e){this._parent(e)},render:function(){this.container.hide(),this._activeCriteriaView=i._embeddedTaggerCreateActiveCriteriaView(this.container,!0),this.selectedTagsDiv=e.createElement("div",{class:"selected-tag",text:a.getText("activeTagsHeader")+":"}),this.clearBtn=e.createElement("div",{class:"section-header-left clear-active-tags"});e.createElement("span",{class:"fonticon fonticon-trash",styles:{display:"inline-block"}}).inject(this.clearBtn),e.createElement("span",{class:"clear-label",text:a.getText("clearActiveTags")}).inject(this.clearBtn);return this.clearBtn.addEventListener("click",this.clearRefine.bind(this)),this.proxy.getAdvancedOption("editTagsRelationships")&&(this.advActiveTags=new n({proxy:this.proxy}).render(),this.selectedTagsDiv.inject(this.container),this.advActiveTags.inject(this.container),this.clearBtn.inject(this.container)),this},redraw:function(t){if(this.proxy.getAdvancedOption("editTagsRelationships"))this.advActiveTags.redraw(),0==this.container.getElements("li.tag.selected").length?this.container.hide():this.container.show();else{var i=this.proxy?this.proxy.getNavImpl():null;if(i&&i.activeCriteriaProxy){let a=i.activeCriteriaProxy.redrawCriteria(t);if(a.isEmpty)this.container.hide();else{let t=e.createElement("div",{class:"all-criteria-list"}),i=e.createElement("ul",{class:"active-predicate-list"}).inject(t);this.container.innerHTML=a.generatedHtml,i.empty(!0),this.selectedTagsDiv.inject(this.container.getElement("#active-tags-list"),"before"),0==this.container.getElements("li.tag.selected").length?this.container.hide():(this.container.getElements("li.tag.selected").forEach((e,t)=>{e.inject(i)}),t.inject(this.container.getElement("#active-tags-list .innerForTransition")),this.clearBtn.inject(this.container),this.container.show())}}}},clearRefine:function(){let e={clearGrouping:!1},t=this.proxy?this.proxy.getNavImpl():null;t&&(t.dispatchEvent("ON_TAGGERVIEW_MASKED"),t.clearFilters(e))},destroy:function(){this.advActiveTags.destroy(),this.stopListening(),this._parent()}})}),define("DS/TagNavigator/TagWidget/TagView",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/TagView.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/TagWidget/AbstractTagView"],function(e,t,i,a,n,s,o){"use strict";var r=o.extend({tagName:"li",className:"tnw tag",template:a.compile(i),setup:function(e){this._parent(e)},domEvents:{"click .arrow":"toggleTagExpand"},render:function(){this._parent();var e=this.template();return this.container.setContent(e),this.tvView=this.getOption("tvView"),this.hideTagsCount=this.getOption("hideTagsCount"),this.drawView(),this},drawView:function(){let t,i=this.container.getElement(".tag-label"),a=this.model.get("displayName"),o=this.model.get("count"),r=this.model.get("isPreciseCount"),l=this.model.get("isSelected"),c=this.isTagGrouped(),d=this.model.get("explicit"),g=this.model.get("isUnderCreation"),h=this.model.get("icon"),u=this.isTagExcluded(),p=this.model.get("expanded"),f=this.model.get("hide");if(this.container.toggleClassName("hide",f),this.getOption("maxTagger")){let e=this.model.get("isDeletable");e&&(this.model.get("isSwymCommunityInFocus")(this.tvView)&&this.model.get("isCommunityTag")?(this.model.set("isDeletable",!1),e=!1):this.model.get("isOntologyTag")&&this.model.getChildCollection().length>0&&(this.model.set("isDeletable",!1),e=!1)),this.container.toggleClassName("deletable",e),this.container.getElement(".tag-delete").toggleClassName("hide",!e);let t=this.tvView.getCacheSimplified().isTagTreeExpanded(this.domId);t&&this.container.addClassName("expanded"),this.model.set("expanded",t)}else p&&this.container.addClassName("expanded");if(this.container.setAttributes({title:a}),i.setText(a),o=n.convertToUnity(o,r),this.hideTagsCount?this.container.getElement(".tag-count").setText(""):this.container.getElement(".tag-count").setText(o),l&&(this.container.addClassName("selected"),this.dispatchEvent("hasActiveTag")),c&&this.container.addClassName("grouped-by"),d&&this.container.addClassName("explicit"),g&&(this.container.addClassName("creating"),(t=e.createElement("div",{class:"spinner spinner-sm spinning fade in",styles:{height:"12px",padding:"6px","-webkit-transform":"translate3d(0px, 0px, 0px)",display:"inline-block"},html:'<span class="spinner-bar"></span><span class="spinner-bar spinner-bar1"></span><span class="spinner-bar spinner-bar2"></span><span class="spinner-bar spinner-bar3"></span>'})).inject(this.getElement(".tag-label"),"after")),this.updateTagColor(),h&&h.match(/fonticon-*/))e.createElement("span",{class:"tag-icon fonticon "+h}).inject(i,"before");else if(h&&h.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/)&&-1!==["gif","tiff","jpg","jpeg","bmp","png","ico"].indexOf(h.split(".").pop())){let t=e.createElement("div",{class:"tag-image-cont"}).inject(i,"before");e.createElement("img",{class:"tag-image",styles:{width:"20px",height:"20px"}}).inject(t).setAttributes({src:h})}u&&(this.container.addClassName("excluded"),this.container.getElement("span.excluded").toggleClassName("hide",!u)),this._tooltip=new s({position:"bottom",target:this.container.getElement(".tag-label"),body:a}),this._tooltipcount=new s({position:"bottom",target:this.container.getElement(".tag-count"),body:o});let m=this.tvView&&this.tvView.actionManager?this.tvView.actionManager.getCurrentAction():void 0;if(m){m._selection.forEach(e=>{e.object==this.model.getRefineData().object&&this.container.addClassName("picked")})}this._checkIfTagPinned(),this.loadChildTags()},storeExpansionStatus:function(e){this.dispatchEvent("tagExpanded",e)},toggleTagExpand:function(e){let t=e.target.hasClassName("fonticon-chevron-right");this.model.setExpandStatus(t),this.container.toggleClassName("expanded",t);let i=this.model.get("id");if(t?this.loadChildTags():this.destroyChildViews(),this.model.get("isColorized")){let e=this.navImpl.getCache().colorManager,t=this.model.get("predicate"),i={}[t]={tagColors:e.getComputedMap(t).tagColors.concat(e.getColoredTreeTagList())};this.navImpl.colorize(i),e._clearTempTreeMap()}this.maxTagger&&(i=this.domId);let a={expand:t,id:i};this.dispatchEvent("tagExpanded",a),e.stopPropagation()},loadChildTags:function(){let e=this.navImpl,t=this.predicate,i=this.model.getChildCollection();if(i){let a=this.container.getElement("ul.tags-list-tree");this.container.addClassName("tree");let n=this;if(this.model.get("expanded")){let s={navImpl:e,predicate:t};this.maxTagger&&(s.maxTagger=this.maxTagger,s.tvView=this.getOption("tvView")),this.hideTagsCount&&(s.hideTagsCount=this.hideTagsCount),i.forEach((e,t)=>{s.model=e,n.childViews.push(new r(s).render().inject(a)),n.childViews[t].addEvent("tagExpanded",n.storeExpansionStatus.bind(n)),n.childViews[t].addEvent("actionOnTag",n.dispatchActionOnTag.bind(n))}),i.length>1&&(a.addClassName("add-border"),this.childViews[i.length-1].container.addClassName("no-add-border"))}}},destroyChildViews:function(){this.childViews.length&&(this.childViews.forEach(e=>{e.removeColorOnDestroy(),e.destroy()}),this.childViews=[])},updateTagColor:function(){let e,t=this,i=this.navImpl.getCache().colorManager,a=this.model.get("isColorized"),n=this.model.get("tagType"),s=this.model.get("isPartial");if(a){let a,o=this.model.getTagValue();if("tree"!==n||s)e=i.getNewColorForTagValue(o,s)||a;else{if(!this.model.get("parent"))i.addToColoredTreeTagList(o),e=i.getNewColorForTagValue(o)||a;else{this.model.getParentModel().get("expanded")&&(i.partialColorize&&i.partialColorize[o.predicate]||(a=i.addToColoredTreeTagList(o)),e=i.getNewColorForTagValue(o)||a)}}this.container.addClassName("colorize");let r=this.tvView&&this.tvView.actionManager?this.tvView.actionManager.getCurrentAction():void 0;if(r&&"colorize"===r.id){-1===r._selection.findIndex(function(e){return e===t.domId})&&r._selection.push(this.domId);let e=r.getSelectionCount();r.get("isInteractive")&&r.set("selectionCount",e)}}else this.container.removeClassName("colorize");this.container.getElement(".tag-color").toggleClassName("hide-color",!e),this.container.getElement(".tag-color").setStyle("background-color",e)},removeColorOnDestroy:function(){let e=this.model.getTagValue();this.navImpl.getCache().colorManager.removeFromColoredTreeTagList(e)},dispatchActionOnTag:function(e){this.dispatchEvent("actionOnTag",e)},toggleGrouping:function(){let e=this.container.hasClassName("grouped-by");this.container.toggleClassName("grouped-by",!e)},destroy:function(){this.childViews&&this.destroyChildViews(),this._tooltip&&this._tooltip.elements&&this._tooltip.destroy(),this._tooltipcount&&this._tooltipcount.elements&&this._tooltipcount.destroy(),this.model=null,this.stopListening(),this._parent()}});return r}),define("DS/TagNavigator/ActiveGroupView",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,s){"use strict";return n.extend({domEvents:{click:"removeGroup"},setup:function(e){this._parent(e)},render:function(){var t=this.getOption("isSimplified"),a=this.getOption("text"),n=this.getOption("icon"),s=this.getOption("isGrouped"),o=this.getOption("disabled"),r=this.getOption("attribute");if(this.condition=this.getOption("condition"),this.renderTo=this.getOption("renderTo"),o&&this.container.addClassName("disable"),s&&this.container.addClassName("grouped"),r&&r.length>0){var l=this;r.forEach(function(e){l.container.setAttributes(e)})}var c=e.createElement("div",{class:"tag-elem"}).inject(this.container),d=e.createElement("div",{class:"tag-label"}).inject(c);n&&e.createElement("span",{class:"root-icon fonticon "+n}).inject(d),s&&e.createElement("span",{class:"fonticon fonticon-group"}).inject(d);var g=e.createElement("div",{class:"title",text:a}).inject(d);return n||g.setStyles({"padding-left":"5px"}),t&&e.createElement("span",{class:"tag-del fonticon fonticon-cancel"}).inject(c),this.getOption("withoutTitle")||this.container.setAttributes({title:a}),this.tooltip=new i({position:"bottom",target:d,body:a,className:"tagger-filter-tooltip"}),this},removeGroup:function(e){e.preventDefault(),this.dispatchEvent("removeActiveGroup",this.condition)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhenView",["UWA/Core","UWA/Class/Model","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/Logger","DS/TagNavigator/embeddedTagger/EmbeddedWhenMenuItem","DS/TagNavigator/simplified/utils/DateUtils","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,s,o,r){"use strict";return i.extend({tagName:"div",className:"embedded-root-container embedded-when",init:function(e){this._parent(e),this.selectedItems=[]},setup:function(e){this._parent(e)},render:function(){this.getElement(".chevron-div");return this.predicate="ds6w:modified",this.label=this.defaultValues.label?this.defaultValues.label:"When",this.icon="fonticon-3ds-when",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){if(!o.getPredicate(this.predicate))return!1;{var t=this;t.hideTagsCount=!1;let e=[t.predicate];t.hideTagsCount=t.navImpl.getHideCountProperty(e),this.menuItems.forEach(function(e){e.destroy()}),this.selectedItems=[],this.menuItems=[];var i=s.getRangeDetails(this.proxy,this.predicate),a="sixw:"+(c=o.getPredicate(this.predicate)).getFullPredicateID();if(this.navImpl.getFocusedProxy())var r=this.navImpl.getSelectedAttributes(a);var l=[];i.forEach(function(e,i){t.checkForRanges(r,e,a),e.get("isSelected")&&l.push(e.get("title"));var s=new n({model:e,navImpl:t.navImpl,isPreciseCount:t.isPreciseCount,hideTagsCount:t.hideTagsCount}).render();s.container.hasClassName("item-disabled")||s.addEvent("toggleSelection",t.onTagClick.bind(t)),t.menuItems.push(s)}),this.menuItems.length?this.menuItems.filter(e=>e.container.hasClassName("item-disabled")).length==this.menuItems.length?this.container.addClassName("disableW"):this.container.removeClassName("disableW"):this.container.addClassName("disableW"),l.length&&this.container.removeClassName("disableW"),this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown();var c=o.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=c),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")}},checkForRanges:function(e,t,i){if(e&&e[i]){var a=e[i],n=this;a.forEach((e,i)=>{var a=e.object.from,s=e.object.to,o=t.get("from"),r=t.get("to");a==o&&s==r&&(t.set("isSelected",!0),n.selectedItems.push(t))})}},_updateFreeInput:function(e,t,i){var a=[s.buildCondition(e,this.predicate)];t?this.navImpl.createFreeInputs(a,i):this.navImpl.removeFreeInputs(a,i),this.navImpl.dispatchEvent("UPDATE_ACTIVECRITERIA",!0)},_getSelectedIndex:function(e){return this.selectedItems.findIndex(function(t){return t.id===e.id})},clearRefine:function(){for(var e=0;e<this.selectedItems.length;e++){this._updateFreeInput(this.selectedItems[e],!1,!0),e==this.selectedItems.length-1&&(this.selectedItems=[]);this._parent(!1)}},onTagClick:function(e){var t=e.model;if(t){var i=this._getSelectedIndex(t);-1!==i?(this._updateFreeInput(this.selectedItems[i]),this.selectedItems=[]):(this.selectedItems.length>0&&(this._updateFreeInput(this.selectedItems[0],!1,!1),this.selectedItems=[]),this._updateFreeInput(t,!0),this.selectedItems.push(t))}this.container.getElements(".tag-elem").forEach(function(e){this.selectedItems.length&&this.selectedItems[0].id===e.id?e.addClassName("selected"):e.removeClassName("selected")}.bind(this)),this._parent(e)},getGroupingData:function(){var e,t,i=[],a={predicate:this.predicate,object:i},n=this.navImpl.getFocusedProxy().getGroupingConfig();return this.menuItems.forEach(function(a){e=a.model;var o={dispText:(t=s.buildCondition(e,this.predicate)).value.nls,type:t.type},r={};t.value.from&&(r.from=t.value.from),t.value.to&&(r.to=t.value.to),this._groupingFormatV2?o.object=r:(o.object=[r],o.predicate=[t.predicate.getFullPredicateID()]),n.withIconInfo&&(o.iconInfo={image:e.get("imageURL")}),i.push(o)}.bind(this)),a}})}),define("DS/TagNavigator/simplified/views/Expander",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/Controls/Button"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"tn-expander",domEvents:{"click .arrow":"toggleArrows","click .header-title":"toggleArrows"},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){let t=this.getOption("label"),n=(this.getOption("deleteButton"),this.getOption("editBtn"));this.header=e.createElement("div",{class:"section-header"}).inject(this.container);var s=e.createElement("div",{class:"arrow"}).inject(this.header);return this.downArrow=e.createElement("span",{class:"fonticon fonticon-down-dir"}).inject(s),this.rightArrow=e.createElement("div",{class:"fonticon fonticon-right-dir"}).inject(s).hide(),e.createElement("div",{class:"header-title",text:t}).inject(this.header),n&&(this.editTagBtn=new a({label:i.getText("editTagPen"),icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS},touchMode:!1}).inject(this.header)),this.clearBtn=e.createElement("span",{class:"section-header-left active-tags-close disbale fonticon fonticon-trash"}).inject(this.header),this.body=e.createElement("div",{class:"section-body"}).inject(this.container),this},toggleArrows:function(){this.downArrow.isHidden()?(this.rightArrow.hide(),this.downArrow.show(),this.body.show()):this.rightArrow.isHidden()&&(this.downArrow.hide(),this.rightArrow.show(),this.body.hide())},toggleEditBtn:function(e){e?this.editTagBtn.show():(this.rightArrow.hide(),this.downArrow.show(),this.body.show(),this.editTagBtn.hide())},toggleClearButton:function(e){this.clearBtn.toggleClassName("disable",e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/TagWidget/GraphView",["UWA/Core","UWA/Class/View","UWA/Class/Collection","DS/W3DXComponents/Views/GraphView","DS/TagNavigator/TaggerNLS","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s){"use strict";return t.extend({tagName:"div",className:"tnw-graph-view",setup:function(e){this._parent(e)},render:function(){return this.predicate=this.getOption("predicate"),this.navImpl=this.getOption("navImpl"),this.predicateLineage=this.predicate.getFullPredicateID(),this},setTags:function(e,t){this.container.show();let i=e.first().get("type");this.tagCollection="date"===i?this.getSelectedDateTags(e):e;var a,s,o=t,r=!1,l=1,c=[],d=0,g=0,h=0,u=[],p=[],f=[],m=[],v=this.navImpl.getCache();function T(e,t){let i=e.get("displayName"),a=e.get("uri"),n=e.get("count"),s=e.get("isSelected"),o=e.get("tagType"),r=e.get("predicate");var l,c={name:i,id:a,category:i,y:n,selected:s,sliced:s,color:v.colorManager.getNewColorForTagValue({uri:a,displayName:i,predicate:r,type:o})};return t&&(l=new Date(a.split("/").join("-")),c.x=Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())),c}function C(e,t,i){return{name:e,category:t,y:i,selected:!1,sliced:!1}}if(m=this.tagCollection.slice(0),this.tagCollection.length&&"date"===this.tagCollection.first().get("type"))switch(r=!0,[0,"year","month","day"][this.tagCollection.first().get("object").split("/").length]){case"year":l=365;break;case"month":l=30;break;case"day":l=1}if(this.tagCollection.forEach(e=>{d+=e.get("count")}),this.tagCollection.forEach(e=>{e.get("hide")||(100*e.get("count")/d<.5?u.push(e):p.push(e))}),g=0,u.length>0&&void 0!==u)for(a=0;a<u.length;a++)g+=u[a].get("count");if(s=r&&"alphaSort"===o.sortMode&&this.isGraphBar,p.length>31)if("nbSort"===o.sortMode&&!1===o.order)for(f=p.splice(31,p.length),a=0;a<f.length;a++)h+=f[a].get("count");else for(f=p.splice(0,p.length-31),a=0;a<f.length;a++)h+=f[a].get("count");if(g<.75*d&&!this.isGraphBar&&u.length>0){if("alphaSort"===o.sortMode){for(a=0;a<p.length;a++)c.push(T(p[a],s));c.push(C(n.getText("otherUnderThreshold"),n.getText("otherUnderThreshold"),g)),f.length>0&&c.push(C(n.getText("other"),n.getText("other"),h))}else if(!0===o.order)for(c.push(C(n.getText("otherUnderThreshold"),n.getText("otherUnderThreshold"),g)),f.length>0&&c.push(C(n.getText("other"),n.getText("other"),h)),a=0;a<p.length;a++)c.push(T(p[a],s));else if(!1===o.order){for(a=0;a<p.length;a++)c.push(T(p[a],s));f.length>0&&c.push(C(n.getText("other"),n.getText("other"),h)),c.push(C(n.getText("otherUnderThreshold"),n.getText("otherUnderThreshold"),g))}}else m=m.filter(e=>{if(!e.get("hide"))return e}),this.tagCollection.length>31?"nbSort"===o.sortMode?!0===o.order?((f=m.splice(0,this.tagCollection.length-31)).forEach(e=>{h+=e.get("count")}),f.length>0&&c.push(C(n.getText("other"),n.getText("other"),h)),m.forEach(e=>{c.push(T(e,s))})):((f=m.splice(31,m.length-31)).forEach(e=>{h+=e.get("count")}),m.forEach(e=>{c.push(T(e,s))}),f.length>0&&c.push(C(n.getText("other"),n.getText("other"),h))):((f=m.splice(0,m.length-31)).forEach(e=>{h+=e.get("count")}),m.forEach(e=>{c.push(T(e,s))}),f.length>0&&c.push(C(n.getText("other"),n.getText("other"),h))):m.forEach(e=>{c.push(T(e,s))});let w={completeData:c,dateRange:s?24*l*3600*1e3:null,datetime:s,reversed:!o.order};this.redrawView(w)},redrawView:function(e){let t=this;var i=e.completeData.length;e.datetime&&(i=Math.abs(e.completeData[i-1].x-e.completeData[0].x)/e.dateRange);let n=60*i+80;n=n>310&&t.isGraphBar?n:null,this.graph=new a({type:t.isGraphBar?"column":"pie",width:n,series:[{type:t.isGraphBar?"column":"pie",pointRange:e.dateRange,data:e.completeData,borderWidth:t.isGraphBar?2:1,borderColor:t.isGraphBar?null:"white"}],expertOpts:{chart:{zoomType:"x"},title:{text:null},plotOptions:{pie:{borderWidth:1,borderColor:"#FFFFFF",point:{events:{legendItemClick:function(){t.toggleTagSelection(this.id)}}},dataLabels:{enabled:!1},showInLegend:!0},column:{states:{select:{color:null,borderWidth:2,borderColor:"#368ec4"}},colorByPoint:!0,showInLegend:!0},series:{allowPointSelect:!1,cursor:"pointer",point:{events:{click:function(e){t.toggleTagSelection(this.id)}}},turboThreshold:1e4}},legend:{enabled:!t.isGraphBar,maxHeight:"56",itemStyle:{width:"150px",textOverflow:"ellipsis",overflow:"hidden"},labelFormat:'{name} <span style="font-weight:normal">({percentage:.1f}%)</span>'},xAxis:{type:e.datetime?"datetime":"category",tickInterval:e.datetime?e.dateRange:null,minRange:e.datetime?e.dateRange:null,dateTimeLabelFormats:{day:"%d",month:"%B",year:"%Y"},labels:{rotation:-45,formatter:e.datetime?null:function(){var t=this.value;return t.length>10&&!e.datetime&&(t=t.substring(0,9).concat("...")),t},point:{events:{click:function(e){t.toggleTagSelection(this.id)}}}},reversed:!!e.datetime&&e.reversed,crosshair:!0},tooltip:{pointFormat:t.isGraphBar?"<b>{point.y}</b>":"<b>{point.y}</b> ({point.percentage:.1f}%)",formatter:null,positioner:t.isGraphBar?function(e,i,a){return{x:a.plotX+t.graph._highcharts.plotLeft-e/2,y:i>a.plotY?t.graph._highcharts.plotHeight+t.graph._highcharts.plotTop+10:a.plotY+t.graph._highcharts.plotTop-i-10}}:void 0}}}),this.graph.setContainer(t.container).render()},restoreGraph:function(){this.graph.reflow()},getSelectedDateTags:function(e){let t,i=this.navImpl.getListOfSelectedTagValues(this.predicateLineage);return i.length&&(t=i[0].uri),t?this.getTagsSelectedDate(e,t):e},getTagsSelectedDate:function(e,t){let i,a,n=[];return 1===(a=t.split("/").length)?n=(i=e.length>1?e.get(t):e.first()).getChildCollection():2===a?n=i=(i=e.length>1?e.get(t.split("/")[0]).getChildCollection():e.first().getChildCollection()).length>1?i.get(t).getChildCollection():i.first().getChildCollection():3===a&&(n=i=(i=e.length>1?e.get(t.split("/")[0]).getChildCollection():e.first().getChildCollection()).length>1?i.get(t.split("/").slice(0,-1).join("/")).getChildCollection():i.first().getChildCollection()),n},setGraphBar:function(e){this.isGraphBar=e},clearAllFilters:function(){let e=this,t=this.predicate.getType();this.getOption("taggerView")&&this.getOption("taggerView").setSpinner();let i=function(t,i){if(t.get("isSelected")||i){let i=t.getRefineData();e.navImpl.toggleTagSelection(i,!1)}};if("date"==t){let e=this.tagCollection.first().getParentModel();e.getParentModel()&&(e=e.getParentModel()),i(e,!0)}else this.tagCollection.filter(e=>{i(e)});this.navImpl.onRefine()},toggleTagSelection:function(e){let t=this.tagCollection.get(e);if(this.getOption("taggerView")&&this.getOption("taggerView").setSpinner(),t){let e=t.getRefineData();this.navImpl.toggleTagSelection(e)}let i={pd1:this.predicate.id(),pd2:this.isGraphBar?"graphBar":"graphPie"};try{s.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagsWidget",action:"onTagWidgetRefine",persDim:i}})}catch(e){console.log("MessageBus publish did not work!!")}},setSearchString:function(e){this.searchString=e},clearContent:function(){this.container.empty(),this.container.hide()},destroy:function(){this.graph&&this.graph.destroy(),this.stopListening(),this._parent()}})}),define("DS/TagNavigator/simplified/views/SearchFieldView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"tn-search-field",init:function(e){var t=this;let n,s,o;this._parent(e),this.render=function(){return this.container.setHTML('<div class="tn-input-group search-ctn">                           <input type="text" class="search-text-field form-control" placeholder="Search(default)">                              <span class="tn-input-group-addon fonticon fonticon-search"></span>                              <span class="tn-input-group-addon fonticon fonticon-clear clear-btn hide" ></span>                         </div>'),(n=this.container.getElement(".search-text-field")).setAttributes({placeholder:this.getOption("placeholder")}),n.addEventListener("keyup",function(e){let i=e.target.value;i?(s.addClassName("hide"),o.removeClassName("hide")):(s.removeClassName("hide"),o.addClassName("hide")),t.dispatchEvent("onSearch",{currentText:i})}),s=this.container.getElement(".fonticon-search"),o=this.container.getElement(".fonticon-clear"),new a({target:o,position:"bottom",body:i.getText("clearSearch")}),o.addEventListener("click",function(){n.value="",n.dispatchEvent(new KeyboardEvent("keyup")),n.focus()}),this}},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/activeTags/GroupedTags",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/ActiveGroupView","DS/TagNavigator/Predicate"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"grouped-tags-list",setup:function(e){this._parent(e)},render:function(){return this.activeGroupings=this.getOption("activeGroupings"),e.createElement("span",{class:"fonticon fonticon-group"}).inject(this.container),e.createElement("span",{class:"title",text:i.getText("groupedTags")}).inject(this.container),this.groupedTagsList=e.createElement("ul",{class:"active-predicate-list"}).inject(this.container),this.redraw(this.activeGroupings),this},redraw:function(e){let t=this.groupedTagsList,i=this;e&&e.length?(this.emptyContent(),this.show(),e.forEach(e=>{let a=e.predicate,s=a.split("/").pop(),o=s.contains("sixw:")?n.getPredicate(s.replace("sixw:","")).displayName():n.getPredicate(s).displayName();if(e.predLevel){let e={tagName:o,predicate:a,isPredicate:!0,predDispName:o,grouped:!0};i._createActiveTagView(e).container.inject(t)}else e.object.forEach(e=>{let n={tagName:e.dispText,predicate:a,predDispName:o,grouped:!0};i._createActiveTagView(n).container.inject(t)})})):this.hide()},_createActiveTagView:function(e){let t={text:e.tagName,isSimplified:!0,isGrouped:!0,condition:e,attribute:[{"predicate-name":e.predicate,is_predicate:e.isPredicate}]},i=new a(t).render();return i.addEvent("removeActiveGroup",this.dispatchRemoveGroup.bind(this)),i},dispatchRemoveGroup:function(e){this.dispatchEvent("removeGroup",e)},emptyContent:function(){this.groupedTagsList.empty()},destroy:function(){this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedWhatMenuItem",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,s,o){"use strict";var r=s.NEW_TYPE_CATEGORY_ICONS,l=a.extend({init:function(e){this._parent(e),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(e){return this._parent(e),this},addContent:function(e){r&&this.container.getElement(".tag-icon").addClassName("category-v3");var a=this;if(this.container.getElement(".tag-icon").addClassName("tn-"+this.model.get("level")),this.container.getElement(".tag-icon").addClassName("tn-"+this.model.get("rootIconClass")),this.model.get("imageURL")?(this.container.getElement(".tag-icon").setStyle("display","none"),this.container.getElement(".tag-image").setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".tag-image").setStyles({"border-radius":"0"}),this.container.getElement(".image-div").setStyle("display","inline-block"),this.container.getElement(".image-div").addClassName("tn-"+this.model.get("level")),r&&this.container.getElement(".image-div").addClassName("category-v3 ")):this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass")),this.getOption("rootClassId")){var n=this.getOption("rootClassId");this.getElement(".tag-icon").addClassName("tn-"+n),this.getElement(".image-div").addClassName("tn-"+n)}this.container.getElement(".tag-label").setText(this.model.get("title"));var o=!!this.navImpl.getFocusedProxy()&&this.navImpl.getFocusedProxy().getLocalFilter().isSelected(s.buildCondition(this.model));o&&this.container.addClassName("selected"),this.setOption("identifier",t.getUUID().substr(0,6));var c=a.getOption("eventsToListen");if(UWA.is(c,"object"))for(event in c)this.addEvent(event,c[event]);if(e){let t=function(e,i){e.forEach((e,a)=>{e.getOption("subMenuItems")?(t(e.getOption("subMenuItems"),i),e.render(i)):e.render(i)})},i=this.getOption("subMenuItems");i&&t(i,e)}else if(this.model.isContainer()){var d=[],g=s.removeDuplicates(this.model.get("subCategories")),h=g.sortBy("title");if(this.model.set("count",g.length),this.model.set("subCategories",g),o)this.model.set("excludeFromSearch",!0);else h.forEach(function(e){e=new l({model:e,navImpl:a.navImpl,rootClassId:a.getOption("rootClassId"),isPreciseCount:a.isPreciseCount,eventsToListen:a.getOption("eventsToListen"),hideTagsCount:a.hideTagsCount}).render();d.push(e)}),d.sort(function(e,t){return t.model.get("count")-e.model.get("count")||e.model.get("title").localeCompare(t.model.get("title"))}),this.setOption("subMenuItems",d)}a.hideTagsCount&&!this.model.isContainer()?this.container.getElement(".tag-count").setText(""):this.container.getElement(".tag-count").setText(i.convertToUnity(this.model.getCount(),this.isPreciseCount))},destroy:function(){this.stopListening(),this.model=null,this._parent()}});return l}),define("DS/TagNavigator/simplified/actions/Exclude",["UWA/Core","DS/TagNavigator/Logger","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a){"use strict";return i.extend({setup:function(){this._parent(),this.set({actionClass:"excluded"}),this._selection=this.get("selection")},onPredicateSelection:function(e){t.log("No action on predicate selection during EXCLUDE")},onTagSelection:function(e,t){var i=this.get("selectionCount"),a=e.hasClassName("selected");e.hasClassName(this.get("actionClass"))||a?(e.removeClassName(this.get("actionClass")),a?(e.removeClassName("selected"),t?this.addTagToExclude(t):this.addTagToExclude(e.id),i++):(t?this.removeTagToExclude(t):this.removeTagToExclude(e.id),i--)):(e.addClassName(this.get("actionClass")),t?this.addTagToExclude(t):this.addTagToExclude(e.id),i++),this.get("isInteractive")&&this.set("selectionCount",i)},onPersonSelection:function(e){var t=e.view,i=e.refineData,n=this.get("actionClass");if(e.isComplex)if(e.hasOwnProperty("selectedPredicates")){var s=this._selection.findIndex(function(i){if(UWA.is(i,"object")&&e.isComplex&&i.isComplex&&i.id==a.PERSON_REFINE_PREDICATE)return i.condition.object===t.model.get("title")});if(-1!==s&&this._selection.splice(s,1),e.selectedPredicates.length>0)var o=a.buildCondition(t.model,e.selectedPredicates,!0);else o=a.buildCondition(t.model,e.selectedPredicates,!0);this.addTagToExclude(o,!0)}else t.isSelectedForAction(n)?(t.setAsUnselectedForAction(n),this.removeTagToExclude(i,!0)):(t.setAsSelectedForAction(n),this.addTagToExclude(i,!0));else t.isSelectedForAction(n)?(t.setAsUnselectedForAction(n),this.removeTagToExclude(i,!0)):(t.setAsSelectedForAction(n),this.addTagToExclude(i,!0))},removeTagToExclude:function(e,i){var a=this._selection.findIndex(function(t){if(UWA.is(t,"object")){if(UWA.is(e,"object"))return t.object===e.object&&t.predicate===e.predicate}else if(UWA.is(e,"string"))return t===e});-1!==a?(t.log("Removing the tag from exclude selection"),this._selection.splice(a,1),i&&this.get("isInteractive")&&this.set("selectionCount",this._selection.length)):t.error("FAILED to remove the tag from exclude selection")},addTagToExclude:function(e,t){this._selection.push(e),t&&this.get("isInteractive")&&this.set("selectionCount",this._selection.length)}})}),define("DS/TagNavigator/CacheManager",["UWA/Class","DS/TagNavigator/ColorManager","DS/TagNavigator/TaggerSettings"],function(e,t,i){"use strict";return e.extend({init:function(e){this.activePredicates={},this.activeW={allw:!0},this.collapsedPredicates={},this.interactivePredicateStatus={},this.expandedTagTree={},this.searchId="filter-all",this.searchVisibility=!1,this.searchValue="",this.addTagVisible=!1,this.addTagValue="",this.openedToolBox={},this.predicatesSortingMode={},this.colorManager=new t,this.viewMode={},this.collapsedSection={},this.moreClicked=!1,this.more=!1,this.criteriaToResetMap={},this.criteriaToRemoveArray={},this.sort6W="sort-tag",this.cloudPredicate={},this.parameterClicked=!1,this.selectedTab="tags",this.expandRootW={},this._isMoreTagsButtonClicked=!1,this.storage=e&&e.storage?e.storage:null,this.storage&&(this.viewMode=this.storage.get("viewMode"),this.viewMode||(this.viewMode=i.getOption("defaultViewMode")),this.storage.set("viewMode",this.viewMode),this.sectionInfo=this.storage.get("sectionInfo"),this.sectionInfo||(this.sectionInfo={"tn-all-tags":{expanded:!1},"tn-add-tags":{expanded:!0}},this.storage.set("sectionInfo",this.sectionInfo)),this.addTagActiveW=this.storage.get("addTagActiveW"),this.addTagActiveW||(this.addTagActiveW="ds6w:where",this.storage.set("addTagActiveW",this.addTagActiveW)),this.rootWExpanderStatus=this.storage.get("rootWExpanderStatus"),this.rootWExpanderStatus||(this.rootWExpanderStatus={all:{},preferred:{}},i.getOption("simplifiedRootW").forEach(function(e){this.rootWExpanderStatus.all[e]=!0,this.rootWExpanderStatus.preferred[e]=!0}.bind(this))),this.expandedTagTree=this.storage.get("expandedTagTree"),this.expandedTagTree||(this.expandedTagTree={}),this.storage.set("expandedTagTree",this.expandedTagTree))},setSectionExpandStatus:function(e,t){this.sectionInfo[e].expanded=t,this.storage.set("sectionInfo",this.sectionInfo)},getSectionExpandStatus:function(e){return this.sectionInfo[e].expanded},setAddTagActiveW:function(e){this.storage.set("addTagActiveW",e),this.addTagActiveW=e},getAddTagActiveW:function(){return this.addTagActiveW},isActivePredicate:function(e){return this.activePredicates[e]||!1},setActivePredicate:function(e){this.activePredicates[e]=!0},clearActivePredicate:function(){this.activePredicates={}},isActiveW:function(e){return this.activeW[e]||!1},addActiveW:function(e){this.activeW[e]=!0},removeActiveW:function(e){delete this.activeW[e]},getActiveW:function(){return this.activeW},setActiveW:function(e){this.activeW={},this.activeW[e]=!0},getIsMoreTagsButtonClicked:function(){return this._isMoreTagsButtonClicked},setIsMoreTagsButtonClicked:function(e){"boolean"==typeof e&&(this._isMoreTagsButtonClicked=e)},toggleActiveW:function(e){this.activeW[e]?this.removeActiveW(e):this.addActiveW(e)},isPredicateCollapsed:function(e){return!1!==this.collapsedPredicates[e]},collapsePredicate:function(e){delete this.collapsedPredicates[e]},expandPredicate:function(e){this.collapsedPredicates[e]=!1},getInteractiveExpandCollapseStatus:function(e){return!1!==this.interactivePredicateStatus[e]},setAsInteractivelyCollapsed:function(e){this.interactivePredicateStatus[e]=!1},setAsInteractivelyExpanded:function(e){this.interactivePredicateStatus[e]=!0},setExpandCollapseRootWStatus:function(e,t,i){this.storage&&(this.rootWExpanderStatus[e][t]=i,this.storage.set("rootWExpanderStatus",this.rootWExpanderStatus))},getExpandCollapseStatusRootW:function(e,t){if(this.rootWExpanderStatus&&this.rootWExpanderStatus[e])return this.rootWExpanderStatus[e][t]},isTagTreeExpanded:function(e){let t;if(this.storage){t=this.storage.get("expandedTagTree")[e]||!1}else t=this.expandedTagTree[e]||!1;return t},collapseTagTree:function(e){delete this.expandedTagTree[e],this.storage&&this.storage.set("expandedTagTree",this.expandedTagTree)},expandTagTree:function(e){this.expandedTagTree[e]=!0,this.storage&&this.storage.set("expandedTagTree",this.expandedTagTree)},setSearchId:function(e){this.searchId=e},getSearchId:function(){return this.searchId},setSearchVisibility:function(e){this.searchVisibility=e},isSearchVisible:function(){return this.searchVisibility},setSearchValue:function(e){this.searchValue=e},getSearchValue:function(){return this.searchValue},toggleAddTagVisibility:function(){this.addTagVisible=!this.addTagVisible},isAddTagVisible:function(){return this.addTagVisible},setAddTagValue:function(e){this.addTagValue=e},getAddTagValue:function(){return this.addTagValue},toggleToolboxVisibility:function(e,t){this.openedToolBox[e]="boolean"==typeof t?t:!this.openedToolBox[e]},isToolboxVisible:function(e){return this.openedToolBox[e]||!1},changeSort:function(e,t){var i,a=this.predicatesSortingMode[t];a.sortMode===e?a.order=!a.order:(a.sortMode=e,i=a.order,a.order=a.secondaryorder,a.secondaryorder=i)},getCurrentSort:function(e){var t;return this.predicatesSortingMode[e]||(this.predicatesSortingMode[e]={}),(t=this.predicatesSortingMode[e]).sortMode||("ds6w:when"===e.split("/").shift()?(t.sortMode="alphaSort",t.order=!0,t.secondaryorder=!1):(t.sortMode="nbSort",t.order=!1,t.secondaryorder=!0)),t},setViewMode:function(e,t){this.viewMode[e]=t,this.storage&&this.storage.set("viewMode",this.viewMode)},getViewMode:function(e,t){var i=this.viewMode[e];return i||("ds6w:who"==t&&this.storage?(i="people",this.viewMode[e]="people",this.storage.set("viewMode",this.viewMode)):i="tag"),i},setViewModeForSearch:function(){var e;for(e in this.viewMode)"freeInput"===this.viewMode[e]&&(this.viewMode[e]="tag")},isSectionCollapsed:function(e){return this.collapsedSection[e]},toggleSection:function(e,t){void 0!==t?this.collapsedSection[e]=t:UWA.is(this.collapsedSection[e])&&!1!==this.collapsedSection[e]?this.collapsedSection[e]=!1:this.collapsedSection[e]=!0},isMoreClicked:function(){return this.moreClicked},setMoreClicked:function(e){this.moreClicked=e},getMore:function(){return this.more},setMore:function(e){this.more=e},getCriteriaToResetBeforeFilterChange:function(e){return e?this.criteriaToResetMap[e]?this.criteriaToResetMap[e]:(this.criteriaToResetMap[e]={},this.criteriaToResetMap[e]):{}},setCriteriaToResetBeforeFilterChange:function(e,t){UWA.is(e,"string")?this.criteriaToResetMap[e]=t:console.warn("setCriteriaToResetBeforeFilterChange called with invalid proxyId")},resetCriteriaToResetBeforeFilterChange:function(e){UWA.is(e,"string")?delete this.criteriaToResetMap[e]:console.warn("resetCriteriaToResetBeforeFilterChange called with invalid proxyId")},getCriteriaToRemoveBeforeFilterChange:function(e){return e?this.criteriaToRemoveArray[e]?this.criteriaToRemoveArray[e]:(this.criteriaToRemoveArray[e]=[],this.criteriaToRemoveArray[e]):[]},resetCriteriaToRemoveBeforeFilterChange:function(e){UWA.is(e,"string")?delete this.criteriaToRemoveArray[e]:console.warn("resetCriteriaToRemoveBeforeFilterChange called with invalid proxyId")},get6WSort:function(){return this.sort6W},set6WSort:function(e){this.sort6W=e},isCloud:function(e){return this.cloudPredicate[e]||!1},addCloud:function(e){this.cloudPredicate[e]=!0},removeCloud:function(e){delete this.cloudPredicate[e]},getParameterClicked:function(){return this.parameterClicked},setParameterClicked:function(e){this.parameterClicked=e}})}),define("DS/TagNavigator/simplified/views/PersonPredicateView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a){"use strict";return t.extend({tagName:"ul",className:"person-predicates",_tooltip:void 0,_predicateToggles:[],domEvents:{"click li.predicate-info input":"clickOnPredicate"},init:function(e){this._predicateToggles=[],this._parent(e),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this._parent(e)},render:function(){return this.addContent(),this},addContent:function(){var t=this.getOption("navImpl"),n=this.model.getUniqueTagValuesPerPredicate();if(t.hasProxiesInEdition())for(var s in n){var o=e.createElement("li",{class:"predicate-info"}).inject(this.container),r=e.createElement("div",{class:"pred-count"}),l=n[s][0],c=new i({type:"checkbox"}).setValue(l.pred.getFullPredicateID()).setLabel(l.pred.displayName()).setClassName("primary").inject(o);this._predicateToggles.push(c),this.hideTagsCount?r.setText("").inject(o):r.setText("("+n[s].length+")").inject(o)}else{var d=[];for(var s in n){var g=n[s];d.push(g[0]);for(var h=1;h<g.length;h++)g[0].count+=g[h].count}d=d.sort(function(e,t){return t.count-e.count});for(var u=0,p=this.getOption("hasAdvancedFocsuedProxy")(a.PERSON_REFINE),f=p?a.getActivePredicates(p,this.model.get("title")):[],m=0;m<d.length;m++){l=d[m],o=e.createElement("li",{class:"predicate-info"}).inject(this.container),r=e.createElement("div",{class:"pred-count"});!function(){return p?-1!==f.indexOf(l.pred.getFullPredicateID()):t.isSelected(JSON.stringify(this.model.getRefineStructure(l.pred.getFullPredicateID())))}.call(this)?this._predicateToggles.push(new i({type:"checkbox"}).setValue(l.pred.getFullPredicateID()).setLabel(l.pred.displayName()).setClassName("primary").inject(o)):(u++,this._predicateToggles.push(new i({type:"checkbox"}).setValue(l.pred.getFullPredicateID()).setLabel(l.pred.displayName()).setClassName("primary").check().inject(o))),u===d.length&&this.getOption("setAsSelected")(),this.hideTagsCount?r.setText("").inject(o):r.setText("("+l.count+")").inject(o)}}},clickOnPredicate:function(e){var t=e.target.value,i=[];this._predicateToggles.forEach(function(e){e.isChecked()&&i.push(e.getValue())}),this.dispatchEvent("onPredicateSelection",[{currentPredicate:t,activePredicates:i},e])},destroy:function(){this.stopListening(),this.model=null,this._predicateToggles=[],this._parent()}})}),define("DS/TagNavigator/TagWidget/TagListView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TagWidget/TagView","DS/TagNavigator/TagWidget/DateTagView","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,s){"use strict";return t.extend({tagName:"ul",className:"tnw tags-list",setup:function(e){this._parent(e)},render:function(){return this.tagsView={},this.tagsViewBackup=[],this.navImpl=this.getOption("navImpl"),this.hideTagsCount=!1,this.getOption("isHierarchy")&&this.container.addClassName("hierarchy"),this},setTags:function(e,t,i){this.tagCollection=e,this.predicateType=t,this.hideTagsCount=i.hideTagsCount,this.updateTags()},updateTags:function(){let t=this,n=this.getOption("predicate");this.destroyTagsiew(),t.tagsView={},this.container.show();let o=this.tagCollection,r=(this.getOption("redrawFromSearch"),!0),l=0,c=-1;if(this.getOption("tagsLimit")){o=this.tagCollection.filter(e=>!1===e.get("hide")),c=this.navImpl.getMoreLimitForPredicate(n.id());let e=o.length;c<e&&(o=o.slice(0,c),r=!1,l=e-c)}let d={navImpl:this.navImpl,predicate:n,tvView:this.getOption("tvView"),hideTagsCount:this.hideTagsCount};this.getOption("maxTagger")&&(d.maxTagger=this.getOption("maxTagger")),o.forEach((e,n)=>{d.model=e;let s=e.get("uri");"date"===t.predicateType?t.tagsView[s]=new a(d).render().inject(t.container):(t.tagsView[s]=new i(d).render().inject(t.container),t.tagsView[s].addEvent("tagExpanded",t.storeExpansionStatus.bind(t))),t.tagsView[s].addEvent("actionOnTag",t.actionPerformedOnTag.bind(t)),e.get("isColorized")&&t.tagsViewBackup.push(t.tagsView[s])});let g=e.createElement("li",{class:"tnw tag more",title:l+" "+s.getText("moreHidden"),html:"<div class='tnw tag-content'><div class='tnw tag-elem'><span class='tnw excluded fonticon fonticon-block hide'></span><div class='tnw tag-label-cont'><div class='tnw tag-label'><span class='fonticon fonticon-dot-3'></span><span class='fonticon fonticon-right-dir'></span></div></div><div class='tnw tag-tail'><div class='tnw tag-count'></div></div></div><div>",events:{click:function(e){t.navImpl.clickOnMoreButton(n.id()),t.updateTags()}.bind(t)}});this.getOption("tagsLimit")&&!r&&(g.inject(this.container),g.getElement(".tag-count").setText(l))},destroyTagsiew:function(){this.clearContent();for(let e in this.tagsView)this.tagsView[e].destroy()},storeExpansionStatus:function(e){this.dispatchEvent("tagExpanded",e)},clearAllFilters:function(){let e=this,t=this.getOption("predicate"),i=t.getFullPredicateID(),a=t.getType();this.navImpl&&!this.navImpl.getFocusedProxy()&&this.navImpl.dispatchEvent("onBeforeGlobalFilterChange");let n=function(t,i){if(t.get("isSelected")||i){let i=t.getRefineData();e.navImpl.toggleTagSelection(i,!1)}},s=function(e){n(e),e.getChildCollection().length&&e.getChildCollection().forEach(e=>{s(e)})};if("date"==a){let e=this.navImpl.getListOfSelectedTagValues(i)[0].uri,t=this.tagCollection.get(e.split("/")[0]);n(t,!0)}else this.tagCollection.filter(e=>{s(e)});this.navImpl.onRefine()},clearContent:function(){this.container.empty(),this.container.hide()},actionPerformedOnTag:function(e){e&&e.id===n.ACTION_COLORIZE&&(this.tagsViewBackup.push(e.view),0!==e.selectionCount&&1!==e.selectionCount||this.dispatchEvent("_actionOnTag",e))},clearTagColors:function(){let e=this.getOption("tvView"),t=e.actionManager?e.actionManager.getCurrentAction():void 0;for(let e in this.tagsView){let i=this.tagsView[e];i.container.hasClassName("colorize")&&i.actionOnColorize(t)}},resetColorizedTags:function(){this.tagsViewBackup.forEach(e=>{e.model.get("isColorized")&&e.model.set("isColorized",!1)}),this.updateTags()},updateColorizedTags:function(){let e=this.getOption("tvView"),t=e.actionManager?e.actionManager.getCurrentAction():void 0;for(let e in this.tagsView){let i=this.tagsView[e];if(i.model.get("isColorized")){this.tagsViewBackup.push(i);let e=i.getDOMId();i.container.addClassName("picked-for-colorize"),t._selection.push(e)}}let i=t.getSelectionCount();t.set("selectionCount",i)},updateGroupedTags:function(){for(let e in this.tagsView){this.tagsView[e].toggleGrouping()}},destroy:function(){this.destroyTagsiew(),this.stopListening(),this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedWhereMenuItem",["UWA/Core","UWA/Utils","DS/TagNavigator/TaggerNLS","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/model/ContinentModel"],function(e,t,i,a,n,s){"use strict";var o=a.extend({init:function(e){this._parent(e),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this.isPreciseCount=e.isPreciseCount,this._parent(e)},render:function(e){return this._parent(e),this},addContent:function(e){var a=this;if(this.model.get("imageURL")){this.container.getElement(".tag-icon").setStyle("display","none");var r=this.container.getElement(".tag-image");r.setAttributes({src:this.model.get("imageURL")}),this.container.getElement(".image-div").setStyle("display","inline-block"),n.getOption("countryFlag")&&(r.setStyles({width:"28px",height:"21px","border-radius":"0"}),this.container.getElement(".tag-label").setStyle("margin-left","5px"))}else this.container.getElement(".tag-icon").addClassName(this.model.get("iconClass"));this.container.getElement(".tag-label").setText(this.model.get("title")),a.hideTagsCount?this.container.getElement(".tag-count").setText(""):this.container.getElement(".tag-count").setText(i.convertToUnity(this.model.getCount(),this.isPreciseCount)),this.model.get("isSelected")&&this.container.addClassName("selected"),this.setOption("identifier",t.getUUID().substr(0,6));var l=a.getOption("eventsToListen");if(UWA.is(l,"object"))for(event in l)this.addEvent(event,l[event]);if(e){let t=function(e,i){e.forEach((e,a)=>{e.getOption("subMenuItems")?(t(e.getOption("subMenuItems"),i),e.render(i)):e.render(i)})},i=this.getOption("subMenuItems");i&&t(i,e)}else if(this.model instanceof s){var c=[];this.model.getCountries().forEach(function(e){var t=new o({model:e,navImpl:a.navImpl,isPreciseCount:a.isPreciseCount,eventsToListen:a.getOption("eventsToListen"),hideTagsCount:a.hideTagsCount}).render();c.push(t)}),this.setOption("subMenuItems",c)}},destroy:function(){this.stopListening(),this.model=null,this._parent()}});return o}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhatView",["UWA/Core","UWA/Class/Model","UWA/Class/Collection","DS/WebappsUtils/WebappsUtils","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerSettings","DS/TagNavigator/embeddedTagger/EmbeddedWhatMenuItem","DS/TagNavigator/embeddedTagger/EmbeddedMenuItem","DS/TagNavigator/simplified/model/CriteriaModel","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/UIKIT/DropdownMenu","text!DS/TagNavigator/assets/CriteriaInfo.json","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f){"use strict";var m=h.NEW_TYPE_CATEGORY_ICONS;return n.extend({tagName:"div",className:"embedded-root-container embedded-what",init:function(e){this._criteriaJSONInfo=JSON.parse(p),this._categoryView=l.getOption("embeddedCategories"),this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this.predicate=h.TYPE_CATEGORIZATION,this.label=this.defaultValues.label?this.defaultValues.label:"What",this.icon="fonticon-3ds-what",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){var t=this;this.menuItems.forEach(function(e){e.destroy()}),this.menuItems=[];var n,s=[],l=[];this.selectedItems=[],t.hideTagsCount=!1;let u=["ds6w:"+this.predicate];if(t.hideTagsCount=t.navImpl.getHideCountProperty(u),this._categoryView){var p=this._hasFocusedAdvProxy(this.navImpl,h.TYPE_CATEGORIZATION),f=h.getCriteriaInfo(this.navImpl,p);if(f&&f.length>0){for(var m=f.sortBy("count"),v=0;v<m.length;v++){var T=m[v],C=m[v].get("iconClass").replace("fonticon-",""),w=new c({model:T,navImpl:this.navImpl,rootClassId:C,isPreciseCount:this.isPreciseCount,eventsToListen:{toggleSelection:t.onTagClick.bind(t)},hideTagsCount:t.hideTagsCount}).render();s.push(w)}s.sort(function(e,t){return t.model.get("count")-e.model.get("count")||e.model.get("title").localeCompare(t.model.get("title"))})}s.length?(this.container.removeClassName("disableW"),this.sortMenuItems(s),this.menuItems=s,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown()):this.container.addClassName("disableW")}else{var b=new i([],{model:g}),y=this._criteriaJSONInfo.predicate_Mapping,S=this._criteriaJSONInfo.category_resources;this.proxy.eachTagValue(function(e,t){var i=e.getUri(),s=e.pred,r="ds6w:docExtension"==s.id(),l=y[s.id()][r?i.toUpperCase():i];if(l){var c=l.category,d=new g({title:e.getDisplayValue(),predicate:s,criteriaId:i,count:t});if(b.length?n=b.find(function(e){return e.get("title")===d.get("title")}):b.push(d),n)n.setAsComposite().add(d);else{if(l.iconClass)d.set("iconClass",l.iconClass);else if(l.image)d.set("imageURL",a.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+l.image);else{if(S[c])var h=S[c].parent?S[c].parent:S[c],u=S[h]?S[h].iconClass:h.iconClass;else u=l.iconClass;d.set("iconClass",u)}if(S[c]){h=S[c].parent?S[c].parent:S[c];u=S[h]?S[h].iconClass:h.iconClass,d.set("level","level1")}else u=l.iconClass,d.set("level","level0");d.set("rootIconClass",u),b.add(d)}}else o.log("Uncategorized item:"+i)}.bind(this),{allTagsOfType:y.active_predicates});var I=!!this.navImpl.getFocusedProxy()&&this.navImpl.getFocusedProxy().getLocalFilter();b.forEach(function(e,i){var a=!!I&&I.isSelected(h.buildCondition(e)),n=new d({model:e,navImpl:this.navImpl,selected:a,isPreciseCount:this.isPreciseCount}).render();if(n.addEvent("toggleSelection",t.onTagClick.bind(t)),s.push(n),a&&(this.selectedItems.push(h.buildCondition(e)),l.push(e.get("title"))),e.get("isComposite")){var o=e.getCount();n.updateCount(o)}},this),s.length||l.length?(this.container.removeClassName("disableW"),s.sort(function(e,t){return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))}),this.menuItems=s,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown()):this.container.addClassName("disableW")}if(r.getPredicate(this.predicate)){var E=r.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=E),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")}},sortMenuItems:function(e){return e.sort(function(e,t){if(!e.getOption("subMenuItems")&&!t.getOption("subMenuItems"))return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))}),e},onTagClick:function(e){this._parent(e);var t=e.model;if(t)if(t.isContainer()){for(var i=t.get("subCategories"),a=this._hasFocusedAdvProxy(this.navImpl,h.TYPE_CATEGORIZATION).getLocalFilter(),n=0;n<i.length;n++){var s=h.buildCondition(i.at(n));a&&a.isSelected(s)&&a.toggle(s)}var o=h.buildCondition(t);this.navImpl.toggleComplexTagSelection(o)}else{(o=h.buildCondition(t)).treatEmbeddingFilter=!0,this.navImpl.toggleComplexTagSelection(o)}},_hasFocusedAdvProxy:function(e,t){var i=e?e.getFocusedProxy():this.hasFocusedProxy();if(i&&t&&i.getAdvancedOption(t))return i},_getIconInfo:function(e){var t="tn-"+e.get("level"),i=e.get("imageURL"),a=m?" category-v3":"",n=e.get("rootIconClass").replace("fonticon-","tn-");if(i)return{image:i,classes:t+" "+n};var s=e.get("iconClass");return s?{classes:"fonticon "+s+" "+t+" "+n+a}:void 0},getGroupingData:function(){var e=[],t=this,i={predicate:this.predicate,object:e},a=this.navImpl.getFocusedProxy().getGroupingConfig();if(this._categoryView){var n=function(e){var i=e.model,s=h.buildCondition(i),o={dispText:s.condition.display,object:{operator:s.condition.operator,predicates:s.condition.predicates,value:s.condition.value},type:s.condition.type};s.isComplex&&(o.isComplex=!0),o.identifier=s.condition.object,a.withIconInfo&&(o.iconInfo=t._getIconInfo(i));var r=e.getOption("subMenuItems");return r&&(o.subGroups=r.map(function(e){return n(e)})),o};i.object=this.menuItems.map(function(e){return n(e)})}else{var s,o;this.menuItems.forEach(function(t){if(s=t.model,(o=h.buildCondition(s)).isComposite){o.condition.value=o.condition.value[0].map(function(e){return e});var i=o.condition.predicates[0];o.condition.predicates=o.condition.value.map(function(e){return i})}var n={dispText:o.condition.display,object:o.condition.value,type:o.condition.type,predicate:o.condition.predicates.map(function(e){return e.predicate})};if(a.withIconInfo){var r="tn-"+s.get("level"),l=s.get("imageURL"),c=s.get("rootIconClass").replace("fonticon-","tn-");if(l)n.iconInfo={image:l,classes:r+" "+c};else{var d=s.get("iconClass");d&&(n.iconInfo={classes:"fonticon "+d+" "+r+" "+c})}}e.push(n)})}return i}})}),define("DS/TagNavigator/userTags/advocacy/utils/AdvocacyUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","DS/TagNavigator/Logger","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,s,o){"use strict";return t.singleton({_urlAddIdea:"/api/idea/add",init:function(){},_getCommunityTitle:function(e,t){if(e&&t)return new i(function(i){s.getCommunityInfo({platformId:e,communityId:t}).then(e=>{i(e.result?e.result.title:void 0)})})},_getCommunityId:function(e){return new i(t=>{s.getEnterpriseOntologyConfig(e).then(e=>{e&&e.advocacyCommunityId?t(e.advocacyCommunityId):t()})})},_getCsrfTokenPromise:function(e){let t=this;return new i(function(i,n){let o={platformId:e,serviceId:"3DSwym"};s.getServiceURL(o).then(function(e){let s=e+"/api/index/tk",o={method:"GET",type:"json",onComplete:function(e){let a=e.result.ServerToken;UWA.is(a,"string")&&(t._csrfToken=a,i(t._csrfToken))},onFailure:function(e,t){n(e,t)}};a.authenticatedRequest(s,o)})})},_createIdea:function(e,t,n,o,r){let l=this;return new i(function(i,c){let d={};s.getServiceURL({serviceId:"3DSwym",platformId:e}).then(function(e){let s=e+l._urlAddIdea,g={"X-DS-SWYM-CSRFTOKEN":t,"content-type":"application/json;charset=UTF-8"},h={params:{community_id:n,title:o,message:r,published:1}},u={method:"POST",type:"json",timeout:12e4,headers:g,data:d=JSON.stringify(h),onComplete:i,onFailure:function(e,t){c(e,t)}};a.authenticatedRequest(s,u)})})}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhereView",["UWA/Core","UWA/Class/Model","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/embeddedTagger/EmbeddedSeparatorMenuItem","DS/TagNavigator/embeddedTagger/EmbeddedPlaceholderMenuItem","DS/TagNavigator/embeddedTagger/EmbeddedWhereMenuItem","DS/TagNavigator/embeddedTagger/EmbeddedHierarchyMenuItems","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/utils/LocationUtils","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/model/TagValueModel","DS/TagNavigator/simplified/model/ContinentModel"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p){"use strict";return i.extend({tagName:"div",className:"embedded-root-container embedded-where",init:function(e){this._parent(e),g.ensurePredicates(this.navImpl.getTagsServerForUserInfo()),this._hierarchyView=d.getOption("geolocationHierarchy"),this._3DEXPERIENCEAsContinent=d.getOption("3DEXPERIENCEAsContinent"),this._hasContinents=!1},setup:function(e){this._parent(e)},render:function(){return this.predicate=this.groupedPredicate=g.COMPUTED_COUNTRY_INFO,this.label=this.defaultValues.label?this.defaultValues.label:"Where",this.icon="fonticon-3ds-where",this.defaultValues.subLabel&&(this.subLabel=this.defaultValues.subLabel),this._parent()},redrawTags:function(e){this._isReadyToUpdateGroupings=!0;var i=this;if(this.menuItems.forEach(function(e){e.destroy()}),this.menuItems=[],this.proxy.getAdvancedOption(g.DATA_LOCATION)){this.selectedItems=[];var n=g.computeGeoLocations(this.navImpl,["ds6w:responsible"],function(e){c.log("EmbeddedWhere: redrawTags after computeGeoLocations"),i.redrawTags()},!0);if(this.container.addClassName("disableW"),this.navImpl.isGroupedBy(g.COMPUTED_COUNTRY_INFO)&&0!=n.pending&&(this._isReadyToUpdateGroupings=!1),this._hierarchyView){var r=i.navImpl.getTagsServerForUserInfo(),d=g.computedCountryInfo.getFullPredicateID(),u=[];let e=["ds6w: location"],h=!1;if(h=this.navImpl.getHideCountProperty(e),n.continents.forEach(function(e){var t,a,n=e.get("title");e.getCountries().forEach(function(i,s){t=l.getTagValue({count:i.getCount(),type:"string",object:[e.id,i.id],dispValue:[n,i.get("title")],sixw:d,icon:i.get("imageURL")},null,null,null,null,r),0==s&&t.parent.clearEmbeddedTagValues(),t.setEmbeddedSixW(g.countryPredicate),a=i.getPersons(),t.setEmbeddedTagValues(a)});var o=new s({model:e,navImpl:i.navImpl,isPreciseCount:i.isPreciseCount,eventsToListen:{toggleSelection:i.onTagClick.bind(i)},hideTagsCount:h}).render();u.push(o)}),u.sort(function(e,t){return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))}),this.menuItems=u,this._hasContinents=this.menuItems.length>0,this._3DEXPERIENCEAsContinent){let e=this.navImpl.getFocusedProxy(),n=["ds6w:dataSource"],s=!1;s=this.navImpl.getHideCountProperty(n);let r=e?e.getEachTagValueForPredicate("ds6w:dataSource"):[];var p=new o({model:new t({title:"3DEXPERIENCE",iconClass:"fonticon fonticon-3ds",is3DEXPERIENCE:!0}),navImpl:i.navImpl,isPreciseCount:i.isPreciseCount,eventsToListen:{toggleSelection:i.onTagClick.bind(i)},tags:r,hideTagsCount:s}).render(),f=p.getOption("subMenuItems");f&&f.length>0?(this._hasContinents&&this.menuItems.unshift(new a({}).render()),this.menuItems.unshift(p)):(p.destroy(),p=null)}this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown(),this.menuItems.length&&this.container.removeClassName("disableW"),this._updateGroupingsWhenReady&&(c.log("view is now ready for grouping update, sending the event..."),this.dispatchEvent("updateGroupings"))}else{var m=n.continents,v=[];m.forEach(function(e){v=v.concat(e.getCountries())});r=i.navImpl.getTagsServerForUserInfo(),d=g.computedCountryInfo.getFullPredicateID(),u=[];v.forEach(function(e){var t=l.getTagValue({count:0,type:"string",object:e.get("title"),sixw:d},null,null,null,null,r);t.setEmbeddedSixW(g.countryPredicate),t.setEmbeddedTagValues(e.getPersons()),i.navImpl.isSelected(t)&&e.set("isSelected",!0);var a=new s({model:e,navImpl:i.navImpl,isPreciseCount:i.isPreciseCount}).render();a.addEvent("toggleSelection",i.onTagClick.bind(i)),u.push(a),u.sort(function(e,t){return t.model.getCount()-e.model.getCount()||e.model.get("title").localeCompare(t.model.get("title"))})}),this.menuItems=u,this.dropDownMenu&&this.dropDownMenu.destroy(),this.createDropdown(),this.menuItems.length&&this.container.removeClassName("disableW")}}var T=h.getPredicate(this.predicate).displayName();this.defaultValues.subLabel||this.subLabel||(this.subLabel=T),this.updateSubLabelCall({subLabel:this.subLabel}),this.getElement(".button-text").removeClassName("hide-sub-label")},updateGroupingUX:function(){this.navImpl.isGroupedBy(g.COMPUTED_COUNTRY_INFO)||this.navImpl.isGroupedBy("ds6w:dataSource")?this.activateGroupingUX():this.deactivateGroupingUX()},onGroupingChange:function(e,t){UWA.is(t,"object")&&t.predicate?this.groupedPredicate=t.predicate:e&&!this.isGroupedBy()&&(this.groupedPredicate=g.COMPUTED_COUNTRY_INFO),this._parent(e,t)},_getTagIdForFilter:function(e){if(e instanceof u){var t=e.get("tagValue");return{predicate:t.pred.getFullPredicateID(),object:t.getUri(),dispValue:e.get("title"),type:"string"}}return{predicate:g.computedCountryInfo.getFullPredicateID(),object:this._hierarchyView?e.get("tagsHierarchy"):e.get("title"),dispValue:e.get("title"),type:"string"}},onTagClick:function(e){this._parent(e);var t=e.model;if(t)if(t.get("is3DEXPERIENCE"))this.groupedPredicate="ds6w:dataSource",this.onGroupingChange(void 0,{predicate:this.groupedPredicate});else{var i=this._getTagIdForFilter(t);this.navImpl.toggleTagSelection(i)}},_getIconInfo:function(e){var t=e.get("imageURL");return t?{image:t}:e.get("iconClass")?{classes:e.get("iconClass")}:void 0},_groupByGeolocation:function(e){var t=this,i=function(a){var n=a.model,s=g.buildConditionFromModel(n),o={dispText:s.condition.display,object:{operator:s.condition.operator,predicates:s.condition.predicates,value:s.condition.value},type:s.condition.type};s.isComplex&&(o.isComplex=!0),o.identifier=s.condition.object,e.withIconInfo&&(o.iconInfo=t._getIconInfo(n));var r=a.getOption("subMenuItems");return r&&(o.subGroups=r.map(function(e){return i(e)})),o},a=[];return this.menuItems.forEach(function(e){e.model&&!e.model.get("is3DEXPERIENCE")&&a.push(i(e))}),a},_groupByDataSource:function(e){var t=this;if(this.menuItems.length){var i=this.menuItems[0];if(i.model.get("is3DEXPERIENCE")){var a=i.getOption("subMenuItems")||[],n=h.getPredicate("ds6w:dataSource").getType(),s=function(i){var a=i.model,o={dispText:a.get("title"),object:a.get("tagValue").getUri(),type:n};if(e.withIconInfo){var r=t._getIconInfo(a);r&&(o.iconInfo=r)}var l=i.getOption("subMenuItems");return l&&(o.subGroups=l.map(function(e){return s(e)})),o};return a.map(function(e){return s(e)})}}},getGroupingData:function(){var e,t,i=[],a={predicate:this.groupedPredicate,object:i},n=this.navImpl.getFocusedProxy().getGroupingConfig();this._hierarchyView?(this._hasContinents||(this.groupedPredicate="ds6w:dataSource"),"ds6w:dataSource"==this.groupedPredicate?(a.predicate=this.groupedPredicate,a.object=this._groupByDataSource(n)):a.object=this._groupByGeolocation(n)):this.menuItems.forEach(function(a){e=a.model;var s={dispText:(t=g.buildConditionFromModel(e)).condition.display,object:t.condition.value,type:t.condition.type,predicate:t.condition.predicates.map(function(e){return e.predicate})};if(n.withIconInfo){var o=e.get("imageURL");s.iconInfo=o?{image:o}:{classes:e.get("iconClass")}}i.push(s)});return a}})}),define("DS/TagNavigator/simplified/views/RoundRootView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/MessageBus/MessageBus"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-w-nav",domEvents:{click:"clickRootW"},init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){this.container.setContent('<div class="root-icon-div"><span class="fonticon root-icon"></span></div><div class="root-w-text"><div class="dropnbtn w-label"></div></div>'),this.taggerView=this.getOption("taggerView"),this.rootw=this.getOption("rootw");var e=this.rootw.split(":")[1]?this.rootw.split(":")[1]:this.rootw;"allw"==e?(this.container.getElement(".root-icon").addClassName("fonticon-tag"),this.container.addClassName("all-w")):this.container.getElement(".root-icon").addClassName("fonticon-3ds-"+e);this.taggerView.getActiveRootW();return this.container.setAttribute("predicate",this.rootw),this.container.getElement(".w-label").setText(i.getText(e)),this},clickRootW:function(e){var t=this.container.getAttribute("predicate"),i=!1;this.container.hasClassName("active")?(this.container.removeClassName("active"),this.taggerView._simplifiedSelectedRootWs=this.taggerView._simplifiedSelectedRootWs.filter(function(e){return e!=t}),i=!1):(this.container.addClassName("active"),i=!0,"allw"!=t&&(this.taggerView._simplifiedSelectedRootWs.length==this.taggerView.getRootWs().length&&(this.taggerView._simplifiedSelectedRootWs=[]),this.taggerView._simplifiedSelectedRootWs.push(t))),this.dispatchEvent("onRootWClick",{activeW:t,isActive:i}),a.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"RootWFilter",persDim:{pd1:t,pd2:""+i}}})},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/actions/SelectInApp",["UWA/Core","DS/TagNavigator/Logger","DS/TagNavigator/simplified/actions/Select"],function(e,t,i){"use strict";return i.extend({setup:function(){this._parent(),this._selectedElems=[]},onTagSelection:function(e,t){this._selectedElems.push(e),this._parent(e,t)},onPersonSelection:function(e){this._selectedElems.push({elem:e.view,isPerson:!0}),this._parent(e)},removeTagHighlight:function(){this._selectedElems.forEach(function(e){e.isPerson?(e.elem.setAsUnselected(),e.elem.container.removeClassName("picked")):e.removeClassName("picked")}),this._selectedElems=[]}})}),define("DS/TagNavigator/TagWidget/PredicateHeaderView",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/PredicateHeaderView.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/MessageBus/MessageBus","DS/TagNavigator/simplified/actions/ActionUtils","css!DS/TagNavigator/TagNavigator.css"],function(e,t,i,a,n,s,o,r){"use strict";return t.extend({tagName:"div",className:"tnw predicate-header",template:a.compile(i),setup:function(e){this._parent(e)},domEvents:{"click .sort":"changeSort","click .bar":"changeToBarView","click .pie":"changeToPieView","click .tags-view":"changeToTagsListView","click .fonticon-palette":"colorizeTags","click .peopleView":"changeToPeopleView","click .categoryView":"changeToCategoryView","click .clear-filters":"clearFilters","click .fonticon-menu-dot":"toggleToolBoxVisibility","click a.clear-selection":"clearColorizeTags","click .action-icon.fonticon-palette":"colorizeTags","click .action-icon.groupBy":"groupPredicate","click .freeInput":"toggleFreeInput",click:"predicateHeaderClick"},render:function(){var e=this.template();if(this.container.setContent(e),this.predicate=this.getOption("predicate"),this.id=this.predicate.id(),this.sort=this.getOption("sort"),this.currentViewMode=this.getOption("currentViewMode"),this.maxTagger=this.getOption("maxTagger"),this.cache=this.getOption("cache"),this.colorManager=this.cache.colorManager,this.taggerCache=this.getOption("taggerCache")||null,this.predicateLineage=this.getOption("predicateLineage"),this.taggerView=this.getOption("taggerView"),this.container.getElement(".pred-label").setText(this.predicate.displayName()),this.container.getElement(".pred-label").setAttribute("name",this.predicate.displayName()),this.container.getElement(".clear-selection").setText(n.getText("clearSearch")),this.predicate.getIcon()){let e=this.predicate.getIcon(),t=this.container.getElement(".predicate-icon");t.toggleClassName("hide"),e.isFontIcon?(t.getElement("img").hide(),t.getElement("span").addClassName(e.icon)):(t.getElement("span").hide(),t.getElement("img").setAttribute("src",e.icon))}return this.addTooltips(),this},setPredicateExpandStatus:function(e){this.isPredicateCollapsed=e,this.container.toggleClassName("expanded",!e)},getPredicateExpandStatus:function(){return!this.isPredicateCollapsed},expandPredicate:function(e){(e=e||{}).expand=e&&e.expand||this.getPredicateExpandStatus(),this.togglePredicateExpand(e)},addTooltips:function(){let e=this.predicate.displayName(),t=function(t,i,a){new s({target:t,body:a?n.getFormattedText(i,{predName:e}):n.getText(i)})};this.container.getElements(".tool-icon").forEach(e=>{e.hasClassName("category-view")?t(e,"categoryView"):e.hasClassName("people-view")?t(e,"peopleView"):e.hasClassName("tags-view")?t(e,"tagsView"):e.hasClassName("nb-sort")?t(e,"occurenceOrder"):e.hasClassName("aplha-sort")?t(e,"alphabeticalOrder"):e.hasClassName("bar")?t(e,"barChart"):e.hasClassName("pie")?t(e,"pieChart"):e.hasClassName("fonticon-palette")?t(e,"colorize"):e.hasClassName("fonticon-trash")&&t(e,"clearActiveTags",!0)})},updateToolBar:function(e){e&&(this.hideToolBarElement=e.hideTagsCount);let t=e&&e.navImpl;this.currentViewMode=e&&e.currentViewMode?e.currentViewMode:this.currentViewMode,this.sort=e&&e.currentSort?e.currentSort:this.sort;let i=this.sort.order;this.maxTagger&&(this.container.getElement(".fonticon-menu-dot").removeClassName("hide"),this.container.getElement(".predicate-count").removeClassName("hide"),this.cache.isToolboxVisible(this.id)?this.container.getElement(".toolbox").addClassName("expanded"):this.container.getElement(".toolbox").removeClassName("expanded"));let a=this.container.getElement(".tool-icon.nb-sort"),n=this.container.getElement(".tool-icon.alpha-sort");if(a.removeClassName("selected"),n.removeClassName("selected"),e.hideTagsCount&&"nbSort"===this.sort.sortMode&&(this.sort=UWA.clone(this.sort),this.sort.sortMode="alphaSort",this.sort.order=!0,i=this.sort.order),"nbSort"==this.sort.sortMode?(a.addClassName("selected"),i?(a.addClassName("fonticon-sort-num-asc"),a.removeClassName("fonticon-sort-num-desc")):(a.addClassName("fonticon-sort-num-desc"),a.removeClassName("fonticon-sort-num-asc"))):(n.addClassName("selected"),i?(n.addClassName("fonticon-sort-alpha-asc"),n.removeClassName("fonticon-sort-alpha-desc")):(n.removeClassName("fonticon-sort-alpha-asc"),n.addClassName("fonticon-sort-alpha-desc"))),this.isPeoplePredicate(e)?this.container.getElement(".tool-icon.peopleView").removeClassName("hide"):this.getOption("typePredicate")&&this.container.getElement(".tool-icon.categoryView").removeClassName("hide"),this.container.getElement(".tool-icon").hasClassName("selected"),"tag"==this.currentViewMode?this.container.getElement(".tool-icon.tags-view").addClassName("selected"):"graphBar"==this.currentViewMode?this.container.getElement(".tool-icon.bar").addClassName("selected"):"graphPie"==this.currentViewMode?this.container.getElement(".tool-icon.pie").addClassName("selected"):"people"==this.currentViewMode?this.container.getElement(".tool-icon.peopleView").addClassName("selected"):"category"==this.currentViewMode?(this.container.getElement(".tool-icon.categoryView").addClassName("selected"),this.toggleDisableInToolbar()):"freeInput"==this.currentViewMode&&this.maxTagger&&(this.container.getElement(".tool-icon.freeInput").show(),this.container.getElement(".tool-icon.freeInput").addClassName("selected")),"person"===this.id&&(this.container.getElement(".tool-icon.peopleView").addClassName("hide"),this.container.getElement(".tool-icon.categoryView").addClassName("hide"),this.container.getElement(".tool-icon.tags-view").addClassName("hide"),this.container.getElement(".tool-icon.bar").addClassName("hide"),this.container.getElement(".tool-icon.pie").addClassName("hide")),this.maxTagger&&"people"!=this.currentViewMode&&"category"!=this.currentViewMode){let e=!(!t||null===t.getFocusedProxy())&&t.hasFreeInputSupport(this.id);this.container.getElement(".tool-icon.freeInput").toggleClassName("hide",!e)}t&&(this.hasGroupingSupport=t.hasGroupingSupport(this.id,!0),this.isColorizePossible=t.isColorizePossible()&&"person"!==this.id,this.isFreeInputOnly=!(!t||null===t.getFocusedProxy())&&t.hasFreeInputOnly(this.id),t.hasProxiesInEdition()&&this.container.getElement(".tool-icon.freeInput").hide()),this.predicate&&t&&("date"==this.predicate.getType()||"daterange"==this.predicate.getType())&&t.getFocusedProxy()&&(t.hasFreeInputSupport(this.id)||t.hasFreeInputOnly(this.id))&&t.hasDateRangeType(this.id)&&(this.isFreeInputOnly=!0),e.dateRange||this.isFreeInputOnly?(this.dateRange=e.dateRange,this.container.getElement(".predicate-count").hide(),this.container.getElement(".predicate-count").setAttribute("title",""),this.container.getElement(".toolbox").addClassName("hide")):(this.container.getElement(".toolbox").removeClassName("hide"),this.dateRange=!1),e&&(this.hideToolBarElement?(this.barGraphElementInToolBox=this.container.getElement(".fonticon-chart-bar"),this.pieChartElementInToolBox=this.container.getElement(".fonticon-chart-pie"),this.sortCountElement=this.container.getElement(".fonticon-sort-num-desc")||this.container.getElement(".fonticon-sort-num-asc"),this.barGraphElementInToolBox.hide(),this.pieChartElementInToolBox.hide(),this.sortCountElement.hide()):this.barGraphElementInToolBox&&this.pieChartElementInToolBox&&this.sortCountElement&&(this.barGraphElementInToolBox.show(),this.pieChartElementInToolBox.show(),this.sortCountElement.show())),this.updateColorizeOptions()},toggleToolBoxVisibility:function(e){return e&&e.stopPropagation(),this.getElement(".toolbox").toggleClassName("expanded",!this.cache.isToolboxVisible(this.id)),this.dispatchEvent("cacheToolboxVisibility"),this.updateColorizeOptions(),!1},toggleToolBox:function(){this.dateRange||this.isFreeInputOnly?this.container.getElement(".toolbox").addClassName("hide"):this.isPredicateCollapsed?this.container.getElement(".toolbox").addClassName("hide"):(this.container.getElement(".toolbox").removeClassName("hide"),this.getElement(".toolbox").toggleClassName("expanded",this.cache.isToolboxVisible(this.id)))},predicateHeaderClick:function(e){e&&e.stopPropagation();var t=this.taggerView&&this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0;if(t&&t.id==r.ACTION_GROUP&&e.target.hasClassName("pred-label")){if(this.hasGroupingSupport)return void this.dispatchEvent("groupingPredicate",{labelSelection:!0});this.togglePredicateExpand()}else this.togglePredicateExpand({isInteractive:!0})},togglePredicateExpand:function(e){let t=this.container,i=e&&e.hasOwnProperty("expand")?e.expand:!t.hasClassName("expanded"),a=e&&e.isInteractive;t.toggleClassName("expanded",i),this.isPredicateCollapsed=!i,i&&this.toggleToolBox(),this.dispatchEvent("togglePredExpand",{expand:i,interactiveExpand:a})},showDeleteButton:function(){this.container.getElement(".fonticon-trash").toggleClassName("hide",!0)},clearFilters:function(e){return e&&e.stopPropagation(),this.container.getElement(".fonticon-trash").addClassName("hide"),this.dispatchEvent("clearAllFilters"),!1},changeSort:function(e){e&&e.stopPropagation();var t=e.target.hasClassName("nb-sort");let i="";(function(e){let t,i=this.sort;e==i.sortMode?i.order=!i.order:(i.sortMode=e,t=i.order,i.order=i.secondaryorder,i.secondaryorder=t)}).bind(this);return i=t?"nbSort":"alphaSort",this.dispatchEvent("sortChanged",i),!1},_changeView:function(e,t){let i=e.hasClassName("selected");this.currentViewMode=i?"tag":t,this.container.getElement(".view.selected").removeClassName("selected"),i?this.container.getElement(".tool-icon.tags-view").addClassName("selected"):e.addClassName("selected",!0),this.dispatchEvent("viewChanged",this.currentViewMode)},changeToBarView:function(e){e&&e.stopPropagation();let t=e.target;return this._changeView(t,"graphBar"),!1},changeToPieView:function(e){e&&e.stopPropagation();let t=e.target;return this._changeView(t,"graphPie"),!1},changeToTagsListView:function(e){e&&e.stopPropagation();let t=this.container.getElement(".tool-icon.tags-view");return this._changeView(t,"tag"),"ds6w:type"===this.id&&this.toggleDisableInToolbar(),!1},changeToPeopleView:function(e){e&&e.stopPropagation();let t=e.target;return this._changeView(t,"people"),!1},changeToCategoryView:function(e){e&&e.stopPropagation();let t=this.container.getElement(".categoryView");return this._changeView(t,"category"),this.toggleDisableInToolbar(),this.container.getElement(".predicate-count").hide(),!1},colorizeTags:function(e){e&&e.stopPropagation();let t,i=e.target;return i.hasClassName("action-icon")?(i.addClassName("hide"),t=!0):t=e.target.hasClassName("selected"),i.toggleClassName("selected",!t),this.dispatchEvent("toggleColorize",t),!1},clearColorizeTags:function(e){return e&&e.stopPropagation(),e.target.addClassName("hide"),this.dispatchEvent("clearColorizeSelections"),!1},toggleFreeInput:function(e){e&&e.stopPropagation();let t=this.container.getElement(".freeInput");return t&&(t.hasClassName("selected")?this._changeView(t,"tag"):(this._changeView(t,"freeInput"),this.container.getElement(".predicate-count").hide(),this.container.getElement(".predicate-count").setAttribute("title",""))),!1},toggleDisableInToolbar:function(){if("ds6w:type"==this.id){let e="category"==this.currentViewMode;this.container.getElement(".alpha-sort").toggleClassName("option-disabled",e),this.container.getElement(".nb-sort").toggleClassName("option-disabled",e),this.container.getElement(".bar").toggleClassName("option-disabled",e),this.container.getElement(".pie").toggleClassName("option-disabled",e)}},updateColorizeOptions:function(){this.container.getElement(".tool-icon.fonticon-palette").toggleClassName("hide",!this.isColorizePossible);let e=this.colorManager.isColorized(this.predicateLineage)||this.colorManager.isInColorization(this.predicateLineage);this.container.getElement(".tool-icon.fonticon-palette").toggleClassName("selected",e),e&&this.maxTagger?this.cache.isToolboxVisible(this.id)?this.container.getElement(".action-icon.fonticon-palette").addClassName("hide"):this.container.getElement(".action-icon.fonticon-palette").removeClassName("hide"):this.container.getElement(".action-icon.fonticon-palette").hasClassName("hide")||this.container.getElement(".action-icon.fonticon-palette").addClassName("hide"),this.inAction&&this.updateColorizeActionOptions(this.inAction)},updateColorizeActionOptions:function(e){this.inAction=e,this.inAction?(this.container.getElement(".tool-icon.fonticon-palette").toggleClassName("hide",e),this.container.getElement(".action-icon.fonticon-palette").addClassName("hide")):(this.container.getElement(".clear-selection").addClassName("hide"),this.updateColorizeOptions())},updateClearText:function(e){e?this.container.getElement(".clear-selection").removeClassName("hide"):this.container.getElement(".clear-selection").addClassName("hide")},isPeoplePredicate:function(e){let t=!1;if("ds6w:who"!==this.id&&"ds6w:who"==this.predicate.get6WRootFather().id()&&e&&!e.isHierarchy){let e=!!this.predicate.COMMUNITY_TAGS_PREDICATES&&this.predicate.COMMUNITY_TAGS_PREDICATES["ds6w:who"].id(),i=!!this.predicate.COMPANY_TAGS_PREDICATES&&this.predicate.COMPANY_TAGS_PREDICATES["ds6w:who"].id();this.id!=e&&this.id!=i&&(t=!0)}return t},setPredicateCount:function(e){this.container.getElement(".predicate-count").show(),this.container.getElement(".predicate-count").setText(e),this.container.getElement(".predicate-count").setAttribute("title",e)},updateGroupingIcon:function(){let e=this.container.hasClassName("grouped-by");this.container.toggleClassName("grouped-by",!e),this.container.getElement(".action-icon.groupBy").toggleClassName("hide",e)},groupPredicate:function(e){e&&e.stopPropagation(),this.dispatchEvent("groupingPredicate")},destroy:function(){this.stopListening(),this._parent()}})}),define("DS/TagNavigator/userTags/UserTagsViewImpl",["UWA/Core","UWA/Utils","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/userTags/UserTagsModel","DS/TagNavigator/Logger","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TagNavigator/TagsServer","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerUtils","DS/TagNavigator/userTags/utils/UserTagsUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TagNavigator/simplified/utils/OntologyUtils","DS/Controls/Label","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/Handlebars/Handlebars","DS/Controls/Editor","DS/Utilities/Dom","text!DS/TagNavigator/assets/templates/UserTagsView.html","DS/Usage/TrackerAPI"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f,m,v,T,C,w,b,y){"use strict";return i.extend({tagName:"div",className:"user-tags-view",template:T.compile(b),init:function(e){e=e||{},this._clientId=e.clientId||t.getUUID(),this._validateModelProperties(e),this._parent(e),this.setPopupWidth=e.onSuggestDisplayed,this.initialTags=[],this.modifiedTags=[],this.promisesInTransit=0,this.addRemoveTooltip,this.resetTooltip,this.listenTo(this.model,{"onChange:showSubjectContent":this._setSubjectContent,"onChange:showDetailNote":this._redrawAdvocacyDetailNote,"onChange:subjects":this._redraw,"onChange:platformId":this._updateTenant,"onChange:readOnly":this._updateReadOnlyMode,"onChange:showVocabularySuggestions":this._redraw,"onChange:rootWs":this._updateAllowedRootWs,"onChange:allowFreeTags":this._updateFreeTagsMode,"onChange:explicitSuggestions":this._redraw,"onChange:applicativeSuggestions":this._updateApplicativeSuggestions}),this._displaySuggestionWithType=d.getOption("displaySuggestionWithType");let i=this.model.get("platformId");i?this._updateTenant(this.model,i):this.controlledVocab=!1},_validateModelProperties:function(e){if(!(e.model instanceof n))throw new Error("INVALID model for UserTagsView");if(!UWA.is(e.onCommit,"function"))throw new Error("MANDATORY properties not provided for UserTagsView")},render:function(){var t=this.template();this.container.setContent(t);var i=this.getOption("labelInfo");if(UWA.is(i,"object")&&i.title){var a=e.createElement("label",{text:i.title}).inject(this.container.getElement(".tn-utv-suggestions"));i.required&&e.createElement("span",{class:"label-field-required",text:" *"}).inject(a)}return this._initializeAutoComplete(),this._redrawAddedRemovedTooltip(),this._redraw(this.model),this.commitData={},this},_initializeAutoComplete:function(){let e=this;this.treeDocument=new r({shouldBeSelected:function(e){let t=!0;return e.getAttributeValue("isEnterpriseConcept")&&(t=e.getAttributeValue("shouldBeSelected")),t}});var t=this.getOption("suggestsInfo");let i=this.model.get("readOnly");this._autoComplete=new o({touchMode:this.model.get("touchMode"),disabled:!!UWA.is(i,"boolean")&&i,allowFreeInputFlag:!1,selectedItems:[],displayCustomNodeInDropDown:!1,multiSearchMode:!0,placeholder:t?t.placeHolder:a.getText("userTagPlaceholder"),elementsTree:this.treeDocument,customFilterMessage:t?t.filterMessage:a.getText("typeName"),filterCB:function(t){if(t&&(t=t.trim()),s.log("inside filterCB, text="+t),e.treeDocument.prepareUpdate(),e._removeTempModels(),e._allowTemporarySuggestions()&&t){let i=e.container.getElement(".tn-utv-suggestions-error"),n=t.contains("<")&&t.contains(">");if(n){if(n&&i){let e=a.getText("utvError");i.getElement(".error-message").innerHTML=e.replace("&lt;","'<em style='color:red'>&lt;</em>'").replace("&gt;","'<em style='color:red'>&gt;</em>'"),i.style.display="flex"}}else e._addTempModels(t),e._addRemoveErrorMessage()}e.treeDocument.pushUpdate(),e.treeDocument.setFilterModel({label:{filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:t}},filterOptions:{ensureVisible:!0}}})}}),this._autoComplete.inject(this.container.getElement(".tn-utv-suggestions")),this._autoComplete.addEventListener("change",e._onChangeInAutoComplete.bind(e)),this._autoComplete.addEventListener("show",e._onShowAutoCompletePopup.bind(e))},_redraw:function(e){let t=this.model.get("subjects");this._redrawSubjectSummary(),Array.isArray(t)&&t.length&&t.forEach(e=>{if(!UWA.is(e,"object")||!UWA.is(e.uri,"string"))throw new Error("MANDATORY properties not provided for UserTagsView subjects");e.service||(e.service="6WTags")}),this._updateSubjects(),this._setSuggestions(),d.getOption("disable_FUN136500")||(this._redrawAddedRemovedTooltip(),this._redrawAdvocacyDetailNote())},_setSubjectContent:function(e,t){this.showSubjectContent="boolean"!=typeof t||t,this._redrawSubjectSummary()},_redrawResetLink:function(){this.model.get("showResetLink")&&(this.resetButton=this.container.getElement(".tn-utv-reset"),this.resetButton.innerText=a.getText("resetTagButton"),this.resetButton.onclick=this.restore.bind(this),this.resetTooltip||(this.resetTooltip=new m({target:this.resetButton,body:"Undo Modifications",className:"tn-sugg-add-remove-reset-tooltip",animate:!0,position:"bottom"})))},_redrawAddedRemovedTooltip:function(){if(!d.getOption("disable_FUN136500")&&this.model.get("showSummaryTooltip")){this.bottomContainer=this.container.getElement(".tn-utv-suggestions-summary"),this.addRemoveTextElement=this.container.getElement(".tn-utv-add-remove-text");let e="",t="",i=this._updateAddRemoveTagsStatus();if(i&&this.addRemoveTextElement){this.addRemoveTooltip||(this.addRemoveTooltip=new m({target:this.addRemoveTextElement,body:"",className:"tn-sugg-add-remove-tooltip",animate:!0,position:"bottom",delay:{hide:1}}));let n=i.tagsToCreate,s=i.tagsToDelete;n.length&&(e=n.length+" "+a.getText("added")),s.length&&(e+=n.length?" - "+s.length+" "+a.getText("removed"):s.length+" "+a.getText("removed")),this.addRemoveTextElement.innerText=e,t=this._getTooltipContents(n,s),this.addRemoveTooltip.setBody(t),this.model.get("showResetLink")&&this._redrawResetLink(),i&&(n.length||s.length)?(this.addRemoveTextElement.show(),this.resetButton&&this.resetButton.show(),this.bottomContainer.style.display="flex",this.addRemoveTooltip.getContent().style.display="block"):(this.addRemoveTooltip.getContent().style.display="none",this.bottomContainer.style.display="none",this.resetButton&&this.resetButton.hide(),this.addRemoveTextElement.hide())}}},_getTooltipContents:function(e,t){let i="";return e.length&&(i+='<div class = "tn-utv-tooltip-header"><b>'+a.getText("addedTags")+"</b></div>",e.forEach(e=>{i+=this._getTagLabelWithIcons(e)})),!i.length||(i+='<div style="margin:10px; width:100%"></div>'),t.length&&(i+='<div class = "tn-utv-tooltip-header"><b>'+a.getText("removedTags")+"</b></div>",t.forEach(e=>{i+=this._getTagLabelWithIcons(e)})),i},_getTagLabelWithIcons:function(t){let i="",a="",n=t.getAttributeValue("predicate"),s=e.createElement("div",{class:"tn-tooltip-container"});if(n){var o=n.split(":")[1];a=e.createElement("span",{class:"fonticon fonticon-3ds-"+o+" tn-utv-rootw-icon"})}(i+=a.outerHTML+t.getLabel(),t.getAttributeValue("isCommunityTag"))&&(i+=" "+e.createElement("span",{class:"tn-community-icon fonticon fonticon fonticon-users-alt"}).outerHTML);t.getAttributeValue("isEnterpriseConcept")&&(i+=(g.COMPANY_TAGS_ICON.icon?w.generateIcon({iconPath:g.COMPANY_TAGS_ICON.icon,iconSize:{height:"12px",width:"12px"},className:"tn-utv-tooltip-enterprise-icon tn-custom-chip-icon tn-enterprise-icon-url"}):e.createElement("span",{class:"tn-enterprise-icon fonticon fonticon fonticon-3ds"})).outerHTML);return(i=s.addContent(i)).outerHTML},mask:function(){v.mask(this.container)},unmask:function(){v.unmask(this.container)},isDirty:function(){return this._isDirty},_maskContent:function(){this.promisesInTransit++,v.mask(this.container)},_unmaskContent:function(){!(this.promisesInTransit>0)||this.promisesInTransit--,this.promisesInTransit<=0&&v.unmask(this.container)},_redrawAdvocacyDetailNote:function(){this.model.get("showDetailNote")?(this.advocacyUserEditor||(this.advocacyUserEditor=new C({placeholder:"Please provide details for your request",value:"",nbRows:7}).inject(this.container.getElement(".tn-utv-sugg-details"))),this.advocacyUserNote||(this.advocacyUserNote=this.container.getElement(".tn-utv-sugg-note")),this.advocacyUserEditor.show(),this.advocacyUserNote.innerText="This request will be posted as an Idea in <community name> community",this.advocacyUserNote.show()):(this.advocacyUserEditor&&this.advocacyUserEditor.hide(),this.advocacyUserNote&&this.advocacyUserNote.hide())},_redrawSubjectSummary:function(){if(!d.getOption("disable_FUN136500")){this.subjectSummaryTitle=this.container.getElement(".tn-utv-section-title");let e,t="",i=!1;this.model.get("showSubjectContent")&&(this.subjectSummary||(this.subjectSummary=new f({value:"",icon:"newspaper"}).inject(this.container.getElement(".tn-utv-section-body")),this.subjectSummary.getContent().addClassName("tn-sugg-subj-summ")),e=this.model.get("subjects"),Array.isArray(e)&&e.length<2?(e.forEach(e=>{e.label&&(t+=e.label,i=!0)}),this.subjectSummary.value=t):this.subjectSummary.value=""),i&&1===e.length?(this.subjectSummary.show(),this.subjectSummaryTitle&&this.subjectSummaryTitle.show()):(this.subjectSummary&&this.subjectSummary.hide(),this.subjectSummaryTitle&&this.subjectSummaryTitle.hide())}},_addRemoveErrorMessage:function(){let e=this.container.getElement(".tn-utv-suggestions-error");if(e)if(this._autoComplete.selectedItems.length){let t=this._autoComplete.selectedItems;for(let i=0;i<t.length;i++){if(t[i].getLabel().contains("<")&&t[i].getLabel().contains(">")){let t=a.getText("utvError");e.getElement(".error-message").innerHTML=t.replace("&lt;","'<em style='color:red'>&lt;</em>'").replace("&gt;","'<em style='color:red'>&gt;</em>'"),e.style.display="flex";break}e.hide()}}else e.hide()},_setSuggestions:function(){this._maskContent();let e=[],t=-1,i=-1,a=-1;var n=this.model.get("showOntologySuggestions"),s=d.getOption("explicitCommunitySugestions")&&this.model.get("showCommunitySuggestions"),o=!UWA.is(this.model.get("showVocabularySuggestions"),"boolean")||this.model.get("showVocabularySuggestions"),r=this.model.get("explicitSuggestions");n&&(t=e.length,e.push(this._getSuggestionsFromEnterpriseOntology())),s&&(i=e.length,e.push(this._getCommunityTagsSuggestions())),this._updateVocabSuggestions(o),r&&(a=e.length,e.push(this._getProxySpecificSuggestions())),Promise.all(e).then(function(e){let o=[];if(n&&e[t]&&UWA.is(e[t].suggestions,"array")&&(o=o.concat(e[t].suggestions)),s&&e[i]&&e[i].id&&UWA.is(e[i].suggestions,"array")&&(o=o.concat(e[i].suggestions)),r&&e[a]){let t=e[a];o=o.concat(t)}let l=this.model.get("applicativeSuggestions");l&&l.length&&(o=o.concat(l)),this._updateApplicativeSuggestions(this.model,{allSuggestions:o})}.bind(this))},_getSuggestionsFromEnterpriseOntology:function(){let e=this.model.get("supportedSourcesForEnterpriseOntology");(!e||Array.isArray(e)&&e.length<1)&&(e=d.getOption("supportedSourcesForEnterpriseOntology"));let t=this.model.get("subjects");if(Array.isArray(t)&&t.length){if(t.every(function(t){let i=!1;return i=UWA.is(t.source,"string")?-1!=e.indexOf(t.source):-1!=e.indexOf(h.getSourceFromSubjectURI(t.uri))})){let e=this.model.get("platformId");return p.getEnterpriseOntologySuggestions({tenant:e})}}},_getCommunityTagsSuggestions:function(){let e,t=this.model.get("subjects");if(d.getOption("explicitCommunitySugestions")&&Array.isArray(t)&&1==t.length){let i=t[0],a={appName:"6WTagger",currentUser:i.currentUser,platformId:this.model.get("platformId"),vocabSuggestions:!1,communityTags:d.getOption("suggestCommunityTags")};if(i.source&&"3dswym"===i.source.toLowerCase())return i.containerId?(e=i.containerId+"_"+this.model.get("platformId"),a.communityId=i.containerId):(e=i.communityName+"_"+this.model.get("platformId"),a.communityName=i.communityName),a.id=e,h.getSuggestionsFor3DSwymContent(a)}},_getProxySpecificSuggestions:function(){let e=this.model.get("explicitSuggestions");if(this.model.set("sortAlphabetically","boolean"!=typeof e.sortAlphabetically||e.sortAlphabetically),this.model.set("sortByW","boolean"!=typeof e.sortByW||e.sortByW),e=e.suggestions)return new Promise(t=>{t(UWA.clone(e))})},_onChangeInAutoComplete:function(e){if(!this._allowTemporarySuggestions()){var t=[];UWA.is(this._autoComplete.selectedItems,"array")&&(t=this._autoComplete.selectedItems.filter(function(e){return e.getAttributeValue("isValid")})),t.length!==this._autoComplete.selectedItems.length&&setTimeout(function(){this._autoComplete.selectedItems=t}.bind(this),100)}this._updateAddRemoveTagsStatus(),this._redrawAddedRemovedTooltip(),this._addRootIcon(),this._addRemoveErrorMessage();let i=this.getOption("onSelectionChange");i&&i(this._autoComplete.selectedItems.length,this._isDirty,this._toBeAddedRemoved)},_onShowAutoCompletePopup:function(e){var t=document.querySelector(".wux-controls-autoComplete-popup .wux-controls-autoComplete-dataGridViewContainer");this.setPopupWidth&&(t.style.width=this._autoComplete.getContent().getDimensions().width+"px",this.setPopupWidth(t))},_getExistingSubjectTags:function(){return this._existingUserTags},_addNarrowerConcepts:function(e){let t=e.getAttributeValue("object"),i=p.getConcept(t);if(i){e.setAttribute("shouldBeSelected",!!i.canBeTagged());let t=i.getNarrowerConcepts();if(UWA.is(t,"array")){let i=e.getAttributeValue("predicate");t.forEach(function(t){if(!t.isDeprecated()){let a={label:t.getLabel(),grid:{object:t.id,isValid:!0,predicate:i,isApplicative:!0,isConcept:!0,isEnterpriseConcept:e.getAttributeValue("isEnterpriseConcept"),shouldBeSelected:!!t.canBeTagged()}},n=new l(a);p.setEnterpriseOntologyTreeModel(this._clientId,a.grid.object,n),e.addChild(n),this._addNarrowerConcepts(n)}}.bind(this))}}else s.error("concept Model not found for "+t)},_addTypeInformation:function(e){let t;e.grid.isCommunityTag?t=" (isCommunityTag)":e.grid.isEnterpriseConcept&&(t=" (isEnterpriseConcept)"),t&&(e.label=e.label+t)},_updateVocabSuggestions:function(e){let t=e;this.treeDocument&&(this.treeDocument.prepareUpdate(),this.treeDocument.getChildren().length&&this.treeDocument.getChildren().forEach(e=>{e.getAttributeValue("isVocabSuggestion")&&(t?e.show():e.hide())}),this.treeDocument.pushUpdate())},_updateApplicativeSuggestions:function(e,t){s.log("applicative suggestions="+JSON.stringify(t)),this.treeDocument.prepareUpdate(),this._removeApplicativeModels(!1);var i=[],a=[];UWA.is(t,"object")?(t&&t.allSuggestions&&(a=t.allSuggestions),t.options&&(this._sortAlphabetically="boolean"!=typeof t.options.sortAlphabetically||t.options.sortAlphabetically,this._sortByW="boolean"!=typeof t.options.sortByW||t.options.sortByW)):UWA.is(t,"array")&&(a=t,this._sortAlphabetically=!0,this._sortByW=!0),a&&a.length&&(i=this._processAllSuggestionsToTreeModel(a,"isApplicative")),i.length?this._mergeSuggestions(i,"isApplicative",!1):this._unmaskContent(),this.treeDocument.pushUpdate(),this.dispatchEvent("userTagsApplicativeSuggestion_update_ended")},_getSuggestionLabel:function(e){let t="";return t=e.label?e.label:e.dispValue?e.dispValue:e.object,Array.isArray(t)&&(t=t[t.length-1]),t},_processAllSuggestionsToTreeModel:function(e,t){var i=[],a=this._getExistingSubjectTags();return e.forEach(function(e){if(e.sixw&&e.object){let n=(e.sixw_db?e.sixw_db:e.sixw)+e.object;if(a[n])s.log("applicative suggestion is an existing subject tag: predicate="+e.sixw+", title="+e.object);else{let a,n=e.isEnterpriseOntologySuggestion;n&&(a=p.getEnterpriseOntologyTreeModel(this._clientId,e.object));let o=!0;if(!a&&(n&&e.isDeprecated&&(o=!1),o)){let i={label:this._getSuggestionLabel(e),grid:{object:e.object,isValid:!0,predicate:e.sixw_db||e.sixw,isApplicative:"isApplicative"===t,isExisting:"isExisting"===t},icons:[{iconName:"6w-"+(e.sixw_db?e.sixw_db.split(":")[1]:e.sixw.split(":")[1]),fontIconFamily:WUXManagedFontIcons.font3DS}]};i.grid.isConcept=n,i.grid.isEnterpriseConcept=n,i.grid.isRootEnterpriseConcept=n,i.grid.isExplicitTagSuggestion=e.isExplicitTagSuggestion,n&&(i.grid.isRootConcept=!0),i.grid.isCommunityTag=e.isCommunityTag,this._displaySuggestionWithType&&this._addTypeInformation(i),i.grid.isCommunityTag?i.icons.push({iconName:"topbar-users",fontIconFamily:WUXManagedFontIcons.font3DS}):i.grid.isEnterpriseConcept&&(g.COMPANY_TAGS_ICON.isFontIcon?i.icons.push({iconName:g.COMPANY_TAGS_ICON.icon.replace("fonticon-",""),fontIconFamily:WUXManagedFontIcons.font3DS}):i.icons.push({iconPath:g.COMPANY_TAGS_ICON.icon,iconSize:{width:22,height:22}})),a=new l(i),n&&(p.setEnterpriseOntologyTreeModel(this._clientId,i.grid.object,a),this._addNarrowerConcepts(a)),e.isExplicitTagSuggestion&&this._setExplicitTagSuggestionsChildren(a,e,e.sixw),a.onSelect(function(){s.log(this.getLabel()+" is selected -> applicative suggestion")})}a&&i.push(a)}}else s.log("invalid applicative suggestion ignored")}.bind(this)),i},_setExplicitTagSuggestionsChildren:function(e,t,i){let a=t.children;Array.isArray(a)&&a.forEach(t=>{let a={label:t.label?t.label:t.object,grid:{object:t.object,isValid:!0,predicate:i,isApplicative:!0,isExplicitTagSuggestion:!0}},n=new l(a);e.addChild(n),this._setExplicitTagSuggestionsChildren(n,t,i)})},_allowTemporarySuggestions:function(){var e=!0,t=this.model.get("allowFreeTags");return UWA.is(t,"boolean")&&(e=t),e=!(this.controlledVocab||!e)},_isASelectedTempModel:function(e,t){if(this._autoComplete.selectedItems)return-1!=this._autoComplete.selectedItems.findIndex(function(i){if(i.getAttributeValue("isTemporary")&&i.getLabel()===e&&i.getAttributeValue("predicate")==t)return!0})},_addTempModels:function(e){var t=this,i=h.getTextForDefaultSuggestions(e);if(p.hasConcepts()){let e=this.model.get("subjects");if(Array.isArray(e)){let t=d.getOption("supportedSourcesForEnterpriseOntology");if(e.some(function(e){return-1!=t.indexOf(h.getSourceFromSubjectURI(e.uri))})&&p.isConceptAvailable(i))return}}var a=this.model.get("rootWs").slice();this.treeDocument.getRoots().filter(function(e){var t=e.getLabel();if(UWA.is(t,"string")&&t===i)return e}).forEach(function(e){var t=a.indexOf(e.getAttributeValue("predicate"));t>-1&&a.splice(t,1)}),t.treeDocument.prepareUpdate(),a.forEach(function(a){if(!t._isASelectedTempModel(e,a)){var n=new l({label:i,grid:{object:i,isValid:!0,predicate:a,isTemporary:!0},icons:[{iconName:"6w-"+a.split(":")[1],fontIconFamily:WUXManagedFontIcons.font3DS}]});n.onSelect(function(){s.log(this.getLabel()+" is selected")}),t.treeDocument.addRoot(n)}}),t.treeDocument.pushUpdate()},_removeTempModels:function(e){var t=this;e&&this.treeDocument.prepareUpdate();var i=this.treeDocument.getRoots(),a=[];i.forEach(function(e){e.getAttributeValue("isTemporary")&&(e.isSelected()||a.push(e))}),a.forEach(function(e){t.treeDocument.removeRoot(e),s.log("Removing "+e.getLabel())}),e&&this.treeDocument.pushUpdate()},_removeVocabModels:function(e){var t=this;e&&this.treeDocument.prepareUpdate();var i=this.treeDocument.getRoots(),a=[];i.forEach(function(e){e.getAttributeValue("isVocabSuggestion")&&a.push(e)}),a.forEach(function(e){t.treeDocument.removeRoot(e),s.log("Removing "+e.getLabel())}),e&&this.treeDocument.pushUpdate()},_removeApplicativeModels:function(e){var t=this;e&&this.treeDocument.prepareUpdate();var i=this.treeDocument.getRoots(),a=[];i.forEach(function(e){e.getAttributeValue("isApplicative")&&!e.getAttributeValue("isEnterpriseConcept")&&a.push(e)}),a.forEach(function(e){t.treeDocument.removeRoot(e),s.log("Removing "+e.getLabel())}),e&&this.treeDocument.pushUpdate()},_addRootIcon:function(){var e=this._autoComplete._selectionChips.elements.container.getElementsByClassName("wux-chip-cell-container");if(e.length==this._autoComplete.selectedItems.length)for(var t=0;t<e.length;t++){let a=this._autoComplete.selectedItems[t];if(a&&a.getAttributeValue("isEnterpriseConcept")&&!a.getAttributeValue("isRootEnterpriseConcept")&&!e[t].getElement("span.tn-rootw-icon")){let a=this._autoComplete.selectedItems[t].getAttributeValue("predicate");if(a){var i=a.split(":")[1];w.generateIcon({iconName:"6w-"+i,fontIconFamily:WUXManagedFontIcons.Font3DS,className:"tn-rootw-icon"}).inject(e[t].getElement(".wux-chip-cell-label"),"before")}}if(this._autoComplete.selectedItems[t].getAttributeValue("isCommunityTag")){if(!e[t].getElement("span.tn-community-icon"))w.generateIcon({iconName:"topbar-users",fontIconFamily:WUXManagedFontIcons.Font3DS,className:"tn-custom-chip-icon tn-community-icon"}).inject(e[t].getElement(".wux-chip-cell-label"),"after")}else if(this._autoComplete.selectedItems[t].getAttributeValue("isEnterpriseConcept")&&!e[t].getElement("span.tn-enterprise-icon")){let i;(i=g.COMPANY_TAGS_ICON.isFontIcon?w.generateIcon({iconName:g.COMPANY_TAGS_ICON.icon.replace("fonticon-",""),fontIconFamily:WUXManagedFontIcons.Font3DS,className:"tn-custom-chip-icon tn-enterprise-icon"}):w.generateIcon({iconPath:g.COMPANY_TAGS_ICON.icon,iconSize:{height:"20px",width:"20px"},className:"tn-custom-chip-icon tn-enterprise-icon-url"}))&&i.inject(e[t].getElement(".wux-chip-cell-label"),"after")}}},_checkAppliedUserTags:function(){let e,t=[],i=this._autoComplete.selectedItems;i.forEach(i=>{i.getAttributeValue("isDefault")&&t.push(e),e++}),t.forEach(e=>{delete i[e]}),this._autoComplete.selectedItems=i},_updateSubjects:function(){let e=this.model.get("subjects");var t=this,i=e||[];this.showAppliedUserTags=!0;let a=[],n=[];this.cleanTreeDocument(),i.length>1&&(this._manageDirtyState()&&(i=[i[0]],s.warn("with manageDirtyState as true, we only consider the first subject from the list")),this.showAppliedUserTags=!1),i.forEach(function(e){if(e.service||(e.service="6WTags"),t._existingUserTags=[],UWA.is(e.tags,"array")){t.treeDocument.prepareUpdate();let i=[],s=e.uri.includes(":community:");e.tags.forEach(function(e){if(!t._isCommunityTag(e)||!s){let t={};t=h.getUserTagInfo(e),i.push(t)}}),i.forEach(function(e){e.isEnterpriseOntologySuggestion?n.push(e):a.push(e)}),t._nonCompanySuggTreeModels=t._processAllSuggestionsToTreeModel(a,"isExisting"),t._setModelAsSelectedItems(t.showAppliedUserTags,t._nonCompanySuggTreeModels),t._existingCompanyTagsInfo=n,t._mergeSuggestions(t._nonCompanySuggTreeModels,"isExisting"),t.treeDocument.pushUpdate()}})},_isCommunityTag:function(e){let t=!1;return Array.isArray(e.object)&&e.object[0].startsWith("ds6wclassifier:")&&!e.sixw.includes("CompanyTag")&&(t=!0),t},_setModelAsSelectedItems:function(e,t){if(e){let e=[];e=t,this._existingUserTags=e}else this._autoComplete.selectedItems=[],this._existingUserTags=[],this._existingCompanyTagsInfo=[],this._nonCompanySuggTreeModels=[]},_updateAllowedRootWs:function(e,t){var i=d.getOption("simplifiedRootW");UWA.is(t,"array")?t.length>0&&this.model.set("rootWs",t.filter(function(e){return-1!==i.indexOf(e)})):this.model.set("rootWs",i)},_updateTenant:function(e,t){var i=this;this.cs=void 0,this.ts=void 0,UWA.is(t,"string")?(u.getServiceUrl({serviceName:"6WTags",platformId:t,onComplete:function(e){g.isTaggerTestPage()&&(e=window.location.protocol+"//"+window.location.host+"/VocabularyStub"),i.ts=new c(e,t,t),i._retrieveVocabularySuggestions(i.ts)},onFailure:function(){s.error("FAILED to retrieve 6WTags url for tenant: "+t)}}),u.getServiceUrl({serviceName:"3DSpace",platformId:t,onComplete:function(e){g.isTaggerTestPage()&&(e=window.location.protocol+"//"+window.location.host+"/VocabularyStub"),i.cs=new c(e,t,t)},onFailure:function(){s.error("FAILED to retrieve 3DSpace url for tenant: "+t)}})):s.error("invalid platformId:"+t),g.getControlledVocabularyMode({platformId:t}).then(function(e){this.controlledVocab=e.mode,this._activateAddRemoveSection()}.bind(this))},_retrieveVocabularySuggestions:function(e){if(this.model.get("showVocabularySuggestions")){var t=this,i=[];h.getVocabularySuggestions({tagsServer:e||this.cs||this.ts}).then(function(e){s.log("suggestions="+JSON.stringify(e)),t.vocabularySuggestions=e,t._removeVocabModels(),e.forEach(function(e){var t=Object.keys(e)[0];e[t].literalInfo.forEach(function(e){var a=new l({label:e.value,grid:{object:e.value,isValid:!0,predicate:t,isVocabSuggestion:!0},icons:[{iconName:"6w-"+t.split(":")[1],fontIconFamily:WUXManagedFontIcons.font3DS}]});a.onSelect(function(){}),i.push(a)})}),i.length?t._mergeSuggestions(i,"isVocabSuggestion",!0):t._unmaskContent(),t._updateVocabSuggestions(t.model.get("showVocabularySuggestions"))})}else s.log("vocab suggestions are disabled")},_joinWithoutDupes:function(e,t){const i=new Set(t.map(e=>this._getKeyFromModel2(e)));return[...e.filter(e=>!i.has(this._getKeyFromModel2(e))),...t]},_mergeSuggestions:function(e,t){var i,a=this.treeDocument.getRoots();let n=d.getOption("simplifiedRootW");if(a.length>0){let n;i=n="isExisting"==t&&this._existingUserTags.length>0?this._joinWithoutDupes(a,this._existingUserTags):this._joinWithoutDupes(e,a)}else i=e;this._sortSuggestions(i,n),this._selectExistingCompanyTagsFromTreeDoc(),this._activateAddRemoveSection(),this.dispatchEvent("utSugg_ended"),this._unmaskContent()},_activateAddRemoveSection:function(){UWA.is(!0!==this.model.get("readOnly"))&&(this.treeDocument.getRoots().length||this._allowTemporarySuggestions()?this._autoComplete.disabled=!1:this._autoComplete.disabled=!0)},_sortSuggestions:function(e,t){let i=[],a=[];if("boolean"!=typeof this.model.get("sortAlphabetically")||this.model.get("sortAlphabetically")?e&&e.length&&(a=e.sort(function(e,t){return e.getLabel().toUpperCase().localeCompare(t.getLabel().toUpperCase())})):a=e,"boolean"!=typeof this.model.get("sortByW")||this.model.get("sortByW")){let e={};t.forEach(t=>{e[t]=[]}),a.forEach(t=>{e[t.getAttributeValue("predicate")].push(t)}),Object.keys(e).forEach(t=>{i=i.concat(e[t])})}else i=a;i.forEach((e,t)=>{this.treeDocument.addRoot(e),e.getAttributeValue("isExisting")&&e.select()})},_selectExistingCompanyTagsFromTreeDoc:function(){if(Array.isArray(this._existingCompanyTagsInfo)){let e=this._existingCompanyTagsInfo.filter(function(e){return e.isEnterpriseOntologySuggestion}),t=[];e.forEach(function(e){let i=p.getEnterpriseOntologyTreeModel(this._clientId,e.object);i?t.push(i):s.error("Failed to find tree model for concept "+e.object)}.bind(this)),this._setModelAsSelectedItems(this.showAppliedUserTags,this._nonCompanySuggTreeModels.concat(t)),t.forEach(function(e){e.select()})}},_updateReadOnlyMode:function(e,t){this._autoComplete.disabled=t,t?this.container.addClassName("disabledState"):this.container.removeClassName("disabledState")},_updateFreeTagsMode:function(e,t){this._activateAddRemoveSection()},_getKeyFromModel:function(e){let t=e.getAttributeValue("predicate"),i=e.getAttributeValue("object");if(Array.isArray(i))i.forEach(e=>{t+=e});else{if("string"!=typeof i)throw new Error("TagNavigator:UserTagsView: Incorrect object type for treeNodeModel");t+=i}return t},_getKeyFromModel2:function(e){let t=this._getKeyFromModel(e),i=e.getParent();for(;i&&!i._isTrueRoot();)t=t+"&&"+this._getKeyFromModel(i),i=i.getParent();return t},_computeCommitResponse:function(e,t,i){var a=this;e&&UWA.is(e,"array")&&e.forEach(function(e){let n=!0,s=e.subject?e.subject.uri:void 0;if(i==h.OPERATION_DELETE&&s&&t&&Array.isArray(t.data)){let i=t.data.findIndex(function(e){if(e&&e.subject&&e.subject.uri===s&&UWA.is(e.error,"object"))return!0});-1!==i&&(n=!1,e.error=t.data[i].error)}n&&e.tag?a.commitData[e.subject.uri]=h.computeSuccessResponse(e.tag):e.error&&(a.commitData[e.subject.uri]=h.computeFailureResponse(e.error))})},_computeCallStatus:function(){var e=[];for(var t in this.commitData)t!=h.OPERATION_STATUS&&(this.commitData[t].status==h.OPERATION_STATUS_SUCCESS?e.push(!0):e.push(!1));let i=e.every(function(e,t,i){return 0===i.indexOf(e)});this.commitData.status=i?1==e[0]?h.OPERATION_STATUS_SUCCESS:h.OPERATION_STATUS_FAILURE:h.OPERATION_STATUS_PARTIAL},_trackCommit:function(e){let t=h.getResponseDetails(e);if(t){let e=this.getOption("trackers");var i={eventCategory:"UserTagsView",eventAction:"commitTags",appID:UWA.is(e,"object")&&e.appID?e.appID:"X3DTAGS_AP",tenant:this.model.get("platformId")?this.model.get("platformId"):void 0};let a={};a.pd1=UWA.is(e,"object")&&e.appName?e.appName:"unknown",t.onlyCreate?a.pd2="onlyCreate-"+t.createStatus:t.onlyDelete?a.pd2="onlyDelete-"+t.deleteStatus:t.bothOperations&&(a.pd2="bothOperations-"+t.createStatus+"-"+t.deleteStatus),i.persDim=a,y.trackPageEvent(i)}},_buildAndDispatchResponseOnCommit:function(e){var t=this,i={};e.forEach(function(e){var a=e.data,n=e.request;t._computeCommitResponse(a,e.response,n),t._computeCallStatus(),n==h.OPERATION_ADD?i[n]=UWA.clone(t.commitData):n==h.OPERATION_DELETE&&(i[n]=UWA.clone(t.commitData))}),this.commitData={},this._trackCommit(i),this.getOption("onCommit")(i)},_buildTagInfoToPersist:function(e,t){let i=e.getAttributeValue("object");var a={subject:t,predicate:e.getAttributeValue("predicate"),object:{}};if(e.getAttributeValue("isCommunityTag"))a.object.literal=h.buildCommunityTagInfo(e).object,s.log("literal for community tag="+a.object.literal);else if(e.getAttributeValue("isConcept")){let t=h.buildOntologyTagInfo(e,!0);a.object.literal=t.object,a.predicate=t.sixw}else if(e.getAttributeValue("isExplicitTagSuggestion")){let t=h.buildSuggestedTagInfo(e,!0);a.object.literal=t.object,a.predicate=t.sixw,s.log("SuggestedTagInfo: ",t)}else a.object.literal=i;return s.log("Tag information to persist: ",a),a},commit:function(e){var t=this.model.get("subjects"),i=this.model.get("persistTags");if("boolean"!=typeof i&&(i=!0),!t||t.length<1)return s.log("no subjects set, no action on commit"),!1;var a=this._toBeAddedRemoved;if(!(this._isDirty&&UWA.is(a,"object")&&(a.tagsToCreate.length>0||a.tagsToDelete.length>0)))return s.log("no tag selected/modified, no action on commit."),!1;s.log("modifications found, handling the commit action.");var n,o,r,l,c=this,d=[],g=[],h=[],u=0;for(n=0,o=t.length;n<o;n++)"3DSpace"==t[n].service?g.push({uri:t[n].uri}):h.push({uri:t[n].uri});r=function(e,t,i){let a;try{a=JSON.parse(e)}catch(e){s.log("FAILED to parse response. request="+(i?i.request:"")),a={}}let n={};if(i&&"create"===i.request)n=t&&"string"==typeof t?JSON.parse(t).data:{};else if(i&&"delete"===i.request&&t&&"object"==typeof t){let e={};e.subject=t.tag[0].subject[0],e.tag=[],t.tag.forEach(t=>{e.tag.push({predicate:t.predicate,object:t.object})}),e.results=e.tag.length,n=[e]}d.push({data:n,response:a,request:i.request}),0==--u&&c._buildAndDispatchResponseOnCommit(d)},l=function(e,t,i){let a;try{a={data:JSON.parse(i).data,request:t.request}}catch(e){a={data:{},request:t.request}}d.push(a),0==--u&&c._buildAndDispatchResponseOnCommit(d)};let p=function(e,t,i){let a={};i?e.create=a:e.delete=a,a.status="success",t.data.forEach(function(e){e.subject.forEach(function(t){let i=a[t.uri];i||(a[t.uri]=i={},i.status="success");let n=i.tags;n||(i.tags=n=[]),n.push({sixw:e.predicate,object:e.object.literal,type:"xsd:string"})})})};var f=function(t,i){if(h.length>0){var a={tag:t.map(function(e){return this._buildTagInfoToPersist(e,h)}.bind(this))};++u,i?this.ts.putTag(a,e,r,l,!1):this.ts.deleteTag(a,e,r,l,!1)}if(g.length>0){var n={tag:t.map(function(e){return this._buildTagInfoToPersist(e,g)}.bind(this))};++u,i?this.cs.putTag(n,e,r,l,!1):this.cs.deleteTag(n,e,r,l,!1)}};let m=a,v=m.tagsToCreate,T=m.tagsToDelete;return i?(v.length>0&&f.call(this,v,!0),T.length>0&&f.call(this,T,!1)):function(e,t){let i,a=this,n=h.length>0?h:g.length>0?g:null,o={};if(Array.isArray(e)&&e.length>0&&(i={data:e.map(function(e){return a._buildTagInfoToPersist(e,n)}.bind(this))},p(o,i,!0)),Array.isArray(t)&&t.length>0){let e={data:t.map(function(e){return a._buildTagInfoToPersist(e,n)}.bind(this))};p(o,e)}s.log("Inside informProxyForTagsUpdation, onCommit="+JSON.stringify(o)),this.getOption("onCommit")(o)}.call(this,v,T),!0},_updateAddRemoveTagsStatus:function(){let e=this._existingUserTags,t=this._autoComplete.selectedItems;if(this._toBeAddedRemoved={tagsToCreate:[],tagsToDelete:[]},UWA.is(e,"array")&&UWA.is(t,"array"))for(let i=0;i<e.length||i<t.length;i++)-1===t.indexOf(e[i])&&void 0!==e[i]&&this._toBeAddedRemoved.tagsToDelete.push(e[i]),-1===e.indexOf(t[i])&&void 0!==t[i]&&this._toBeAddedRemoved.tagsToCreate.push(t[i]);return this._isDirty=!(!this._toBeAddedRemoved.tagsToDelete.length&&!this._toBeAddedRemoved.tagsToCreate.length),this.setOption("manageDirtyState",this._isDirty),this._toBeAddedRemoved},restore:function(){this.treeDocument&&(this.treeDocument.prepareUpdate(),this._autoComplete.selectedItems=[],this._setModelAsSelectedItems(!0,this._existingUserTags),this._autoComplete.selectedItems=this._existingUserTags,this.treeDocument.pushUpdate())},cleanTreeDocument:function(){let e=this.model.get("subjects")||[];this.treeDocument.prepareUpdate();let t=[];this.treeDocument.getRoots().forEach(i=>{i.getAttributeValue("isExisting")&&t.push(i),i.getAttributeValue("isVocabSuggestion")?i.hide():!i.getAttributeValue("isTemporary")&&e.length>1&&t.push(i)}),t.forEach(e=>{try{this.treeDocument.removeRoot(e)}catch(t){console.log("Item to remove not found: ",e.options)}}),this.treeDocument.pushUpdate()},clear:function(){this._autoComplete.selectedItems=[],this.addRemoveTextElement&&this.addRemoveTextElement.hide()},_manageDirtyState:function(){return this.getOption("manageDirtyState")},destroy:function(){this.stopListening(),this._autoComplete.destroy(),this.treeDocument.destroy(),this.model.clear(),this._parent()}})}),define("DS/TagNavigator/userTags/UserTagsView",["UWA/Core","UWA/Class","DS/TagNavigator/userTags/UserTagsViewImpl"],function(e,t,i){"use strict";return t.extend({init:function(e){e=e||{},this._parent(e);let t=new i(e);this.render=function(){return t.render(),this},this.inject=function(e){return t.inject(e),this},this.commit=function(e){return t.commit()},this.restore=function(){return t.restore()},this.clear=function(){return t.clear()},this.isDirty=function(){return t.isDirty()},this.mask=function(){return t.mask()},this.unmask=function(){return t.unmask()},this.destroy=function(){return t.destroy()},this.__private_getImpl=function(){return t},this.__private_addEvent=function(e,i){return t.addEvent(e,i)}}})}),define("DS/TagNavigator/simplified/views/UserTagsSimplifiedView",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/Controls/ComboBox","DS/TagNavigator/userTags/UserTagsView","DS/TagNavigator/userTags/UserTagsModel","DS/TagNavigator/userTags/utils/UserTagsUtils","DS/Controls/Button","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,s,o,r,l,c,d,g,h){"use strict";return t.extend({tagName:"div",className:"edit-tags-view expandable",init:function(e){this._parent(e)},render:function(){this.taggerView=this.getOption("taggerView"),this.dropdownCont=e.createElement("div",{class:"dropdown-container"}).inject(this.container),e.createElement("label",{text:a.getText("platformName")}).inject(this.dropdownCont);var t=this.taggerView.getObservedNavigator().getTenantList();if(this.tenantDropdown={},t){var i=[];Object.keys(t).forEach(function(e){i.push({label:t[e].getTenantDisplayName(),value:t[e].getTenantName()})}),this.tenantDropdown=new s({elementsList:i,enableSearchFlag:!1,reachablePlaceholderFlag:!0,touchMode:!0,selectedIndex:0}).inject(this.dropdownCont),this.tenantDropdown.addEventListener("change",this.onTenantChange.bind(this))}this.dropdownCont.hide(),this.userTagModel=new r,this.userTagView=new o({model:this.userTagModel,onCommit:this.actionOnCommit.bind(this),onSelectionChange:this.onSelectionChangeInView.bind(this),trackers:{appName:"6WTagger",appID:"X3DTAGS_AP"},clientId:"6WTagger-Add-RemoveTags"}).render().inject(this.container);let n=e.createElement("div",{class:"add-tag-btn"}).inject(this.container);return this.addTag=new c({label:a.getText("addTagButton"),emphasize:"primary",touchMode:!0,className:"tn-utv-add-buton"}).inject(n),this.addTag.getContent().addEventListener("buttonclick",this.onAddTag.bind(this)),this.addTag.disabled=!0,this.resetTag=new c({label:a.getText("resetTagButton"),touchMode:!0}).inject(n),this.resetTag.domId="tn-utv-reset-buton",this.resetTag.getContent().addEventListener("buttonclick",this.onResetTag.bind(this)),this.resetTag.disabled=!0,this},onSelectionChangeInView:function(e,t){let i=this.userTagModel.get("subjects"),a=!t||0===e&&Array.isArray(i)&&i.length>1;this.addTag.disabled=a,this.resetTag.disabled=a},actionOnCommit:function(e){for(var t in i.unmask(this.container),e)"success"==e[t].status||"partial"==e[t].status?this.actionOnSuccess(e[t],t):"failure"==e[t].status&&(n.log("Error while creating tag(s):"+JSON.stringify(e[t])),this.userTagView.restore());this.handleNotificationsForUserTagCommit(e)},handleNotificationsForUserTagCommit:function(e){let t=l.getResponseDetails(e);if(t){let e=t.createStatus==l.OPERATION_STATUS_SUCCESS||t.createStatus==l.OPERATION_STATUS_PARTIAL,i=t.deleteStatus==l.OPERATION_STATUS_SUCCESS||t.deleteStatus==l.OPERATION_STATUS_PARTIAL;t.onlyCreate?e?d.push(new g(a.getText("tagCreationSuccess"),{className:"success",hideDelay:2e3})):d.push(new g(a.getText("tagCreationFailure")+a.getText("errorContactAdmin"),{hideDelay:2e3})):t.onlyDelete?i?d.push(new g(a.getText("tagDeletionSuccess"),{className:"success",hideDelay:2e3})):d.push(new g(a.getText("tagDeletionFailure")+a.getText("errorContactAdmin"),{hideDelay:2e3})):t.bothOperations&&(e&&i?d.push(new g(a.getText("tagUpdateSuccess"),{className:"success",hideDelay:2e3})):d.push(new g(a.getText("tagUpdateFailure")+a.getText("errorContactAdmin"),{hideDelay:2e3}))),d.dispatch()}},actionOnSuccess:function(e,t){var i=this.userTagModel.get("platformId");UWA.is(i,"object")&&(i=i.id);var a=this.taggerView.observedNavImpl.getProxiesInEdition(),n={};for(var s in e)e[s]&&UWA.is(e[s],"object")&&e[s].tags&&e[s].tags.forEach(function(e){n[s]||(n[s]=[]),n[s].push(e)});a.length&&(t===l.OPERATION_ADD?a[0].onAddTagSuccess(n,i):t===l.OPERATION_DELETE&&a[0].onDeleteTagSuccess(n,i)),this.userTagView.clear()},redraw:function(){let e,t=this.taggerView.observedNavImpl.getProxiesInEdition();t.length&&(e=t[0],this.redrawUserTagsView(e)),this.addTag.disabled=!0,this.resetTag.disabled=!0},redrawUserTagsView:function(e){i.unmask(this.container),this.userTagModel.unset("subjects");var t=e.getFocusedSubjectsData();t=h.checkForCommunityTags(t,e),this.payload={subjects:t,rootWs:e.getAllowedRootWForTagging(),freeInput:!0,showSummaryTooltip:!0,showVocabularySuggestions:e.showVocabularySuggestions(),showOntologySuggestions:e.showOntologySuggestions(),showCommunitySuggestions:e.showCommunitySuggestions(),showSubjectContent:!0,persistTags:e.getPersistTags()},this.userTagModel.set("platformId",this.getPlatformId(e)),this.userTagModel.set("explicitSuggestions",e.getExplicitTagSuggestions()),this.userTagModel.set(this.payload)},getPlatformId:function(e){var t,i=e.getCStorages(),a=e.getTagsServers(),n={};if(a)for(t in a)n[a[t].getTenantName()]=t;else if(i)for(t in i)n[i[t].getTenantName()]=t;return!e.hasPlatformData()&&a&&Object.keys(n).length>1?(this.dropdownCont.show(),this.selectedTenant=this.tenantDropdown.value):1===Object.keys(n).length&&(this.dropdownCont.isHidden()||this.dropdownCont.hide(),this.selectedTenant=n[Object.keys(n)[0]]),this.selectedTenant},onTenantChange:function(){var e=this.taggerView.observedNavImpl.getProxiesInEdition();if(e.length){var t=e[0];this.redrawUserTagsView(t)}},onAddTag:function(){var e=this.taggerView.observedNavImpl.getProxiesInEdition();e.length&&(i.mask(this.container,a.getText("tagUpdateOngoing")),this.userTagView.commit({hasPlatformData:e[0].hasPlatformData()}))},onResetTag:function(){this.userTagView.restore()},setAutoCompletePopupWidth:function(e){let t=Number(e.style.width.slice(0,e.style.width.length-2));var i=t||e.getDimensions().width,a=this.addTag.elements.button.getDimensions().width+10;e.setStyles({width:i-a,"max-width":i-a,"overflow-x":"hidden","min-width":"180"})},clear:function(){this.userTagView.clear()},destroy:function(){this.stopListening(),this._parent()}})}),define("DS/TagNavigator/simplified/views/WrapperView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","UWA/Class/Promise","DS/MessageBus/MessageBus","DS/UIKIT/Scroller","DS/UIKIT/Tooltip"],function(e,t,i,a,n,s,o){"use strict";return t.extend({tagName:"div",className:"root-wrapper-view",domEvents:{"click .rootw-arrow-container":"toggleRootWArea","click .item-circle":"toggleHorizontalRootArea","mousedown .verticalContainer":"rootResizeStart","mousemove .verticalContainer":"rootResize","mouseup .verticalContainer":"rootResizeEnd","mousemove .leftPanel":"addHoverEffect","mousemove .rootw-arrow-container":"addHoverEffect","mouseout .leftPanel":"removeHoverEffect","mouseout .rootw-arrow-container":"removeHoverEffect"},_rootWViewContainers:{},isMouseDown:!1,setup:function(e){this._parent(e)},render:function(){this.wExpandStatus=this.getOption("wExpandStatus");let e=this.getOption("wExpandStatus");return this.addContent(e),this.setContent(),this},addContent:function(){let t=this.getOption("noResize");this.rootW=this.getOption("rootW");var a=this.rootW.split(":")[1];this._rootWViewContainers[this.rootW]=e.createElement("div",{id:"content-"+a,class:"root-container root-border",html:{tag:"div",class:"leftPanel",html:[{tag:"div",class:"item-circle",html:{tag:"span",class:"fonticon fonticon-3ds-"+a}},{tag:"div",class:`verticalContainer ${!0===t?"noCursor":""}`,html:[{tag:"div",class:"verticalSeparator"},{tag:"span",class:"fonticon fonticon-arrow-combo-horizontal resizer"}]}]}}).inject(this.container);var n=e.createElement("div",{id:this.rootW,class:"rootw-expander",html:[{tag:"div",class:"rootw-arrow-container",html:[{tag:"div",class:"arrow",html:[{class:"fonticon fonticon-chevron-down",tag:"span"},{class:"fonticon fonticon-chevron-right",tag:"span"}]},{tag:"div",class:"rootw-label",text:i.getText(a)}]},{tag:"div",class:"root-container-inner",html:[{tag:"div",class:"content"}]}]});n.inject(this._rootWViewContainers[this.rootW]),this.rootIconTooltip=new o({position:"bottom",target:this.getElement(".item-circle"),body:`${this.wExpandStatus?`Collapse ${i.getText(a)} Tags`:`Expand ${i.getText(a)} Tags`}`,className:"root-icon-tooltip"});let r=n.getElement(".root-container-inner");new s({element:r})},addHoverEffect:function(){this._rootWViewContainers[this.rootW].addClassName("hovered")},removeHoverEffect:function(){this._rootWViewContainers[this.rootW].removeClassName("hovered")},toggleRootWArea:function(){var t=this.container.getElement(".rootw-arrow-container"),a=this.container.getElement(".rootw-expander");let n=this.getOption("expandDirection");var s,o,r,l,c,d=this.rootW.split(":")[1];if(t.hasClassName("expanded")?"horizontal"===n?(a.addClassName("horizontalHidden"),this.rootIconTooltip.setBody(`Expand ${i.getText(d)} Tags`)):a.addClassName("hiddenW"):"horizontal"===n?(a.removeClassName("horizontalHidden"),this.rootIconTooltip.setBody(`Collapse ${i.getText(d)} Tags`)):a.removeClassName("hiddenW"),t){for(t.toggleClassName("expanded"),r=0,l=(s=t.getParent().getChildren()).length;r<l;++r)(o=e.extendElement(s[r])).match(".root-container-inner")&&(c=e.extendElement(o.getChildren()[0]),new e.Fx(o,{duration:300,transition:"quadInOut",events:{onComplete:function(){this.wExpandStatus?o.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}):o.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"100%",visibility:"visible"})},onStart:function(){o.setStyle("position","relative"),o.setStyle("overflow","hidden")}}}).start({height:this.wExpandStatus?[c.getSize().height,0]:[0,c.getSize().height]}));this.wExpandStatus=!this.wExpandStatus;let i={rootW:this.rootW,expand:this.wExpandStatus};this.dispatchEvent("onExpanderToggle",i)}},toggleHorizontalRootArea:function(e){var t=e.target.getParent().getParent().getParent().getElement(".rootw-expander"),a=this.rootW.split(":")[1];t&&(t.hasClassName("hiddenW")?t.removeClassName("hiddenW"):(t.toggleClassName("horizontalHidden"),t.hasClassName("horizontalHidden")?this.rootIconTooltip.setBody(`Expand ${i.getText(a)} Tags`):this.rootIconTooltip.setBody(`Collapse ${i.getText(a)} Tags`)),this.toggleRootWArea())},setExpandStatus:function(e){let t=this.getOption("expandDirection");var i=this.container.getElement(".root-container-inner"),a=this.container.getElement(".root-container");let n=this.container.getElement(".rootw-expander");e?(i.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto",visibility:"visible"}),a.getElement(".rootw-arrow-container").addClassName("expanded")):(i.setStyles({position:"absolute",opacity:0,height:"0",visibility:"hidden"}),a.getElement(".rootw-arrow-container").removeClassName("expanded")),"horizontal"==t?n.toggleClassName("horizontalHidden",!e):n.toggleClassName("hiddenW",!e),this.wExpandStatus=e},setContent:function(){let e=this.getOption("content"),t=this.container.getElement(".content");e?t.setContent(e):t.setContent("")},hideRootView:function(){this.hide()},showRootView:function(){this.show()},rootResizeStart:function(e){this.isMouseDown=!0,this.dispatchEvent("onRootResizeStart",e)},rootResize:function(e){this.isMouseDown&&this.dispatchEvent("onRootResize",e)},rootResizeEnd:function(e){this.isMouseDown&&this.dispatchEvent("onRootResizeEnd",e),this.isMouseDown=!1},destroy:function(){this._parent()}})}),define("DS/TagNavigator/userTags/advocacy/CompanyTagsAdvocacyView",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerUtils","DS/TagNavigator/userTags/UserTagsView","DS/TagNavigator/userTags/utils/UserTagsUtils","DS/TagNavigator/userTags/UserTagsModel","DS/Controls/Editor","DS/Controls/LineEditor","DS/TagNavigator/userTags/advocacy/utils/AdvocacyUtils","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p){"use strict";return t.extend({tagName:"div",className:"advocacy-tags-view",init:function(e){this._parent(e),this._advocacyCommunityDetailsPromise=void 0,this._subjects=this.getOption("subjects"),this._platformId=this.getOption("platformId")},render:function(){let t=this,l=e.createElement("div",{class:"content-tags"}).inject(this.container);this.userTagModel=new c({subjects:Array.isArray(this._subjects)?this.getSubjectWithOnlyCompanyTags():[],showSubjectContent:!0,showVocabularySuggestions:!1,showCommunitySuggestions:!1,explicitSuggestions:!1,showOntologySuggestions:!0,showResetLink:!0,showSummaryTooltip:!0,platformId:this._platformId}),this.userTagView=new r({model:this.userTagModel,onCommit:function(){},suggestsInfo:{allowFreeText:!1,placeHolder:n.getText("advocacyViewAutocompletePlaceholder")},onSelectionChange:this.onSelectionChangeInView.bind(this),clientId:"compayTagsAdvocacy"}).render().inject(l),this.modal=new i({header:n.getText("addRemoveCompanyTags"),className:"addRemoveCompanyTags",closable:!0,escapeToClose:!0,visible:!0,events:{onHide:function(){t.destroy()}},footer:[new a({value:n.getText("sendRequest"),className:"primary sentRequestButton",events:{onClick:function(){t.createIdea()}}}),new a({value:n.getText("cancel"),className:"cancelButtton default",events:{onClick:function(){t.destroy()}}})]}).inject(document.body),this._getAdvocacyCommunityDetails().then(e=>{o.build3DSwymContentURL({platformId:e.platformId,contentId:e.id,contentType:"swym:Community"}).then(t=>{this.setCommunityIdeaTip({text:e.title,href:t})})});var h=new UWA.Element("span",{text:" *",class:"tn-utv-mandatoryFieldSign"}),u=new UWA.Element("span",{text:" *",class:"tn-utv-mandatoryFieldSign"});new UWA.Element("span",{text:n.getText("advocacyTitleLabel"),class:"tn-utv-advocacyTitleLabel"}).inject(this.container);u.inject(this.container),this.requestTitleEditor=new g({placeholder:n.getText("userTagsIdeaCreationTitlePlaceholder"),maxLength:s.getOption("maxAdvocacyRequestTitleLength")?s.getOption("maxAdvocacyRequestTitleLength"):100,displayClearFieldButtonFlag:!1,touchMode:!0}).inject(this.container),this.requestTitleEditor.domId="tn-utv-advocacyModal-title";new UWA.Element("span",{text:n.getText("advocacyDescriptionLabel"),class:"tn-utv-advocacyDescriptionLabel"}).inject(this.container);h.inject(this.container);let p=this.getOption("maxLength");this.requestEditor=new d({placeholder:n.getText("sendRequestMessage").format("number"==typeof p?p:s.getOption("maxAdvocacyRequestLength")),nbRows:7,maxLength:s.getOption("maxAdvocacyRequestLength"),newLineMode:"enter",touchMode:!0}).inject(this.container),this.requestTitleEditor.addEventListener("uncommittedChange",this.checkShowButton.bind(this)),this.requestEditor.addEventListener("uncommittedChange",this.checkShowButton.bind(this)),this.modal.getFooter().getElement("button.sentRequestButton").disabled=!0,this.modal.setBody(this.container)},getSubjectWithOnlyCompanyTags:function(){let e=[];return this._subjects[0].tags&&this._subjects[0].tags.length&&this._subjects[0].tags.forEach(t=>{l.getUserTagInfo(t).isEnterpriseOntologySuggestion&&e.push(t)}),this._subjects[0].tags=e,this._subjects},_getAdvocacyCommunityDetails:function(){return this._advocacyCommunityDetailsPromise||(this._advocacyCommunityDetailsPromise=new Promise(function(e){let t=this._platformId;t&&h._getCommunityId(t).then(i=>{if(i){let a={platformId:t};a.id=i,h._getCommunityTitle(t,i).then(t=>{t&&(a.title=t),e(a)})}})}.bind(this))),this._advocacyCommunityDetailsPromise},setCommunityIdeaTip:function(t){var i=new e.Element("div").inject(this.container);i.addClassName("tn-addRemove-communityIdeaTip"),i.id="tn-addRemove-communityIdeaTip";var a=new e.Element("span",{}),s=new e.Element("a",{id:"advocacyCommunityURL",target:"_blank"});s.text=t.text,s.href=t.href,a.addContent(n.getText("ideaCreationInfoMessage")+" <i>"+n.getText("idea")+"</i> "+n.getText("in")+" "),a.addContent(s),a.addContent(" "+n.getText("community")+"."),a.inject(i)},checkShowButton:function(e){this.disableEnableSendRequestButton()},createIdea:function(){this._getAdvocacyCommunityDetails().then(e=>{h._getCsrfTokenPromise(e.platformId).then(t=>{let i=this.requestTitleEditor.value,a=this.getIdeaDescription(this.requestEditor.value);h._createIdea(e.platformId,t,e.id,i,a).then(t=>{if(t.result.crdate){try{let i=t.result.subject6wuri;o.build3DSwymContentURL({platformId:e.platformId,contentId:i,contentType:"swym:Idea"}).then(e=>{let t='<a target="_blank" href="'+e+'">'+n.getText("idea")+"</a> "+n.getText("ideaCreationSuccess");u.push(new p(t,{className:"success"})),u.dispatch()})}catch(e){u.push(new p(n.getText("idea")+" "+n.getText("ideaCreationSuccess"),{className:"success"})),u.dispatch()}this.destroy()}else u.push(new p(n.getText("ideaCreationFailure"))),u.dispatch()})})})},getIdeaDescription:function(e){let t="";if(t=e.replaceAll("\n","<br>")+"<br><br>",this.utvState&&this.utvState.toBeAddedRemoved){let e=this.utvState.toBeAddedRemoved;e.tagsToCreate&&e.tagsToCreate.length&&(t+="<b>"+n.getText("tagsToCreate")+":</b><br> ",t+=this.getTagBreadcrumbText(e.tagsToCreate)),e.tagsToDelete.length&&(t+="<b>"+n.getText("tagsToDelete")+":</b><br> ",t+=this.getTagBreadcrumbText(e.tagsToDelete))}return t},getTagBreadcrumbText:function(e){let t="";return e.forEach(e=>{t+="<i>"+e.getAttributeValue("predicate").split(":")[1]+"</i>";let i=e.getAttributeValue("label");for(;e.getNodeDepth();)e=e.getParent(),t+=" -> "+e.getAttributeValue("label");t+=" -> "+i,t+="<br>"}),t},onSelectionChangeInView:function(e,t,i){this.utvState={nbSelections:e,isDirty:t,toBeAddedRemoved:i},this.disableEnableSendRequestButton()},disableEnableSendRequestButton:function(){if(this.modal&&this.modal.isVisible){let e=this.modal.getFooter().getElement(".sentRequestButton"),t=this.requestEditor.getContent().getElement("textarea").value,i=this.requestTitleEditor.getContent().getElement("input").value;i&&i.length&&t&&t.length&&this.utvState.isDirty?e.disabled=!1:e.disabled=!0}},show:function(){this.modal.show()},destroy:function(){this.modal.destroy()}})}),define("DS/TagNavigator/simplified/activeTags/ExcludedTags",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/activeTags/AdvActiveTagView","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils"],function(e,t,i,a,n,s){"use strict";return t.extend({tagName:"div",className:"excluded-tags-list",setup:function(e){this._parent(e)},render:function(){return this.mode=this.getOption("mode"),this.exclude=this.getOption("exclude"),this.isAdvCriteria=this.getOption("isAdvCriteria"),this.container.hide(),e.createElement("span",{class:"fonticon fonticon-block"}).inject(this.container),e.createElement("span",{class:"title",text:i.getText("excludedTags")}).inject(this.container),this.excludedTagsList=e.createElement("ul",{class:"active-predicate-list "+this.mode}).inject(this.container),this.activeTagView={},this},updateExcludedTags:function(e){let t=this;this.emptyContent(),e.forEach(e=>{let i=[],a=Object.keys(e)[0],o=a.split("/").pop(),r=o.contains("sixw:")?n.getPredicate(o.replace("sixw:","")).displayName():n.getPredicate(o).displayName();(i=s.getTags(e[a],!1,!0))&&i.length&&(t.container.show(),i.forEach(t=>{let i,n;t.condition.display?i=t.condition.display:"date"==t.condition.type&&(i=t.condition.display?t.condition.display:s._computeDateNls(UWA.clone(t.condition.object))),e[a].isComplex?n={condition:t.condition,id:a,predDispName:r,tagName:i}:((n=t.condition).id=a,n.predDispName=r,n.tagName=i);let o=this._getActiveTagsOption(n);r&&(o.predDispName=r);let l=this.createTagView(o);this.activeTagView[o.attribute[0].unique_id]=l,this.excludedTags++}),t.show())})},addTag:function(e){this.container.show();let t=this._getActiveTagsOption(e),i=this.createTagView(t);this.activeTagView[t.attribute[0].unique_id]=i,this.excludedTags++},createTagView:function(e){let t=new a(e).render().inject(this.excludedTagsList);return t.addEvent("unexcludeTag",this.dispatchExcludeEvent.bind(this)),t.addEvent("removeActiveTag",this.dispatchRemoveEvent.bind(this)),t},dispatchExcludeEvent:function(e){let t=e.option;e.target.destroy(),this.enableActionButton(),this.destroyActiveTagView(t),this.excludedTags||this.container.hide(),this.dispatchEvent("excludeTag",t)},dispatchRemoveEvent:function(e){let t=e.option;this.dispatchEvent("removeTag",t),this.destroyActiveTagView(t),this.excludedTags||this.hide()},enableActionButton:function(){this.dispatchEvent("informActiveView")},emptyContent:function(){this.hide(),this.excludedTagsList.empty(),this.destroyAllActiveTagViews()},_getActiveTagsOption:function(e){let t,i="";e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e),"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+t.id:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+t.id);let a=t.id.split("/");return{text:t.tagName,isSimplified:!0,hasActions:this.exclude,hasExcludeSupport:this.exclude,isExcluded:t.excluded,condition:e,attribute:[{"predicate-name":a.pop(),unique_id:i}],advancedProxy:!0,renderTo:!0}},destroyActiveTagView:function(e){let t,i="";return e.condition?((t=UWA.clone(e.condition)).id=e.id,t.tagName=e.tagName):t=UWA.clone(e),"string"==typeof t.object?i=t.object.replaceAll(" ","_")+"_"+t.id:Array.isArray(t.object)&&(i=t.object.join("_")+"_"+t.id),!!this.activeTagView[i]&&(this.activeTagView[i].destroy(),delete this.activeTagView[i],this.excludedTags--,this.excludedTags||this.hide(),!0)},destroyAllActiveTagViews:function(){for(let e in this.activeTagView)this.activeTagView[e].destroy();this.excludedTags=0},destroy:function(){this.stop,this._parent()}})}),define("DS/TagNavigator/simplified/actions/EditTagsSelect",["UWA/Core","DS/TagNavigator/simplified/actions/Select","DS/TagNavigator/TagValue"],function(e,t,i){"use strict";return t.extend({setup:function(){this._parent(),this._selection=this.get("selection")},onTagSelection:function(e){this._parent(e)},onPersonSelection:function(e){var t=this._parent(e);this.get("isInteractive")&&this.set("selectionCount",1),this.getTaggerView().updateActiveTagView(t)},onDateSelection:function(e){this._parent(e),this.getTaggerView().updateActiveTagView(e.freeInputData)}})}),define("DS/TagNavigator/simplified/activeTags/AdvancedActiveTagsView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/simplified/model/AdvancedFilter","DS/TagNavigator/simplified/activeTags/ActiveTagsViewModel","DS/UIKIT/Tooltip","DS/TagNavigator/simplified/views/Expander","DS/TagNavigator/simplified/views/ActionsView","DS/TagNavigator/simplified/views/EmptyView","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/activeTags/ActiveTagsUtils","DS/TagNavigator/simplified/activeTags/PredicateView","DS/TagNavigator/simplified/activeTags/GroupedTags","DS/TagNavigator/simplified/activeTags/ExcludedTags","DS/TagNavigator/Predicate"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p){"use strict";return t.extend({tagName:"div",className:"active-tags-edit-container",domEvents:{"click .active-tags-close":"clearAllActiveTags","click .wux-controls-button":"toggleView"},setup:function(e){this._parent(e)},render:function(){this.exclude=this.getOption("exclude"),this.toShowHeader=!1,this.predicateViews={},this.modifiedFromUI={},this.model instanceof n&&this.listenTo(this.model,{"onChange:mode":this.updateMode}),this.advanceFilter=new a,this.mainContainer=e.createElement("div",{class:"active-tags-container"});let t=e.createElement("div",{class:"active-tags-close"}),c=e.createElement("span",{class:"fonticon fonticon-trash"}).inject(t);return new s({position:"bottom",target:c,body:i.getText("clearActiveTags"),className:"tagger-filter-tooltip"}),this.expander=new o({label:i.getText("activeTagsHeader"),deleteButton:!0,editBtn:!0}).render().inject(this.container),this.mainContainer.inject(this.expander.container.getElement(".section-body")),this.emptyView=(new l).render().inject(this.expander.container.getElement(".section-body")),this.emptyView.setMessageText(i.getText("selectTagMsg")),this.createGroupView(),this.includedTags=e.createElement("div",{class:"included-tags-list not-modified "+this.mode}).inject(this.mainContainer),this.createExcludeView(),this.mode=this.model.get("mode"),this.actionView=new r({hideMenuBtn:!0}).render().inject(this.expander.container.getElement(".section-body")).show(),this.redraw(),this},redraw:function(){if(this.mainContainer.innerHTML="",this.advCriteriaToRemove=[],this.destroyPredicateViews(),this.groupedView.container.inject(this.mainContainer),"writeable"==this.mode?this.groupedView.container.hide():this.groupedView.redraw(this.activeGroupings),this.includedTags=e.createElement("div",{class:"included-tags-list not-modified "+this.mode}).inject(this.mainContainer),this.excludeView.container.inject(this.mainContainer),"readOnly"!==this.mode||void 0!==this.filter&&this.filter.allfilters.condition.length||void 0!==this.activeGroupings&&this.activeGroupings.length){this.show(),this.toShowHeader=!1;document.getElementsByClassName("maximized");"readOnly"==this.mode?(this.actionView.hide(),this.expander.toggleEditBtn(!0)):(this.actionView.show(),this.expander.toggleEditBtn()),this.updateTags(),this.dispatchEvent("showTaggerCriteria")}else if(!this.container.isHidden())return void this.hide()},setActionsManager:function(e){this.actionManager=e,this.actionView.addEvent("onActionSelection",e.startAction.bind(e)),this.actionView.addEvent("onActionLaunched",e.launchAction.bind(e)),this.actionView.addEvent("onActionCancelled",e.cancelAction.bind(e))},toggleView:function(){this.actionManager.hideActionMenu(),this.actionView.container.setStyle("height",50),this.actionView.show(),this.actionView.primaryButton.disable(),this.actionView.actionSelected("editTagsSelect")},callUpdateModelFromAction:function(e){this.actionView.updateModel(e)},clearAllActiveTags:function(e){e.preventDefault(),e.stopPropagation(),this.toShowHeader=!1,"readOnly"==this.model.get("mode")?this.dispatchEvent("clickOnTrash"):(this.removeAllTags(),this.addNoTagsText(),this.dispatchEvent("removeSelectedElems"),this.enableActionButton())},updateMode:function(){this.mode=this.model.get("mode"),this.redraw()},setAdvancedFilter:function(e,t){this.advanceFilter=e,this.groupings=t,this.activeGroupings=UWA.clone(this.groupings.getActiveGroupings()),this.computeFilters(),this.redraw()},disableEditView:function(e){e=e||!1,this.container.toggleClassName("disable",e)},isAdvancedCriteria:function(e){this.isAdvCriteria=e},getAdvCriteriaToRemove:function(){return this.advCriteriaToRemove},createGroupView:function(){let e=this.activeGroupings;this.groupedView=new h({activeGroupings:e}).render().inject(this.mainContainer),this.groupedView.addEvent("removeGroup",this.removeGroupFromfilter.bind(this))},createExcludeView:function(){this.excludeView=new u({mode:this.mode,exclude:this.exclude,isAdvCriteria:this.isAdvCriteria}).render().inject(this.mainContainer),this.excludeView.addEvent("excludeTag",this.excludeTag.bind(this)),this.excludeView.addEvent("informActiveView",this.enableActionButton.bind(this)),this.excludeView.addEvent("removeTag",this.removeTag.bind(this))},computeFilters:function(){let e,t=this.advanceFilter.computeFilterObj(null,null,void 0,!0,!1);t&&t.allfilters&&t.allfilters.condition&&t.allfilters.condition.length?e=t:t.allfiters&&t.allfiters.condition&&0!=t.allfiters.condition.length||(e=void 0),this.filter=e},updateTags:function(e){let t,i=[];if(e&&(e.isFreeInput?this.updateFreeInputValues(e):t=this.advanceFilter.toggle(e)),!t||t.isSelected)this.computeFilters(),this.filter&&this.filter.allfilters&&(i=this.filter.allfilters.condition?this.filter.allfilters.condition:this.filter.allfilters),i.length||this.activeGroupings&&this.activeGroupings.length&&"readOnly"==this.mode?(this.emptyView&&(this.emptyView.hide(),this.expander.toggleClearButton(!1)),this.createPredicateView(i),"writeable"==this.mode||this.toShowHeader&&"readOnly"==this.mode?this.excludeView.updateExcludedTags(i):this.excludeView.emptyContent()):this.addNoTagsText();else{let e=!1,i={condition:t.condition,id:t.id};this.predicateViews[t.id]&&((e=this.predicateViews[t.id].destroyActiveTagView(i))||this.excludeView.destroyActiveTagView(i))}},destroyPredicateViews:function(e){if(e)this.predicateViews[e].destroy(),delete this.predicateViews[e];else{for(let e in this.predicateViews)this.predicateViews[e].destroy();this.predicateViews={}}},addNoTagsText:function(){this.emptyView.container.show(),this.expander.toggleClearButton(!0)},updateFreeInputValues:function(e){let t;if(e){let i=e.predicate.id();(t=this.advanceFilter.isSelectedAttribute(i,e))?this.removeFreeInputs(e):this.createFreeInputs(e)}},createFreeInputs:function(e){if(e){let t=e.predicate.getFullPredicateID();this.advanceFilter.createFreeInput(t,e.type,e.value,e.value.nls)}},removeFreeInputs:function(e){let t=e.predicate.getFullPredicateID();this.advanceFilter.removeFreeInput(t,e.type,e.value,e.value.nls,e.value.isSimplifiedCriteria);e.value.nls},createPredicateView:function(e){let t=this;this.toShowHeader||(this.toShowHeader=d.hasOverloadedOperator(e,this.advanceFilter)),this.includedTags.toggleClassName("not-modified",!this.toShowHeader),e.forEach(e=>{let i=Object.keys(e)[0];if(t.predicateViews[i])t.predicateViews[i].updatePredicateView({predicateInfo:e,mode:t.mode,toShowHeader:t.toShowHeader}),t.predicateViews[i].container.isInjected()||t.predicateViews[i].inject(t.includedTags);else{let a=new g({predicateInfo:e,mode:t.mode,toShowHeader:t.toShowHeader,exclude:t.exclude,isAdvCriteria:t.isAdvCriteria}).render().inject(t.includedTags);t.predicateViews[i]=a,a.addEvent("removeTag",t.removeTag.bind(t)),a.addEvent("informActiveView",t.enableActionButton.bind(t)),a.addEvent("updatePredicateOperator",t.updateOperator.bind(t)),a.addEvent("excludeTag",t.excludeTag.bind(t)),a.addEvent("destroyView",t.destroyPredicateViews.bind(t))}})},hasActiveGroupings:function(){return this.activeGroupings&&this.activeGroupings.length},enableActionButton:function(){this.actionView.enablePrimaryButton(),this.actionManager.enablePrimaryButton()},removeGroupFromfilter:function(e){this.actionManager.startAction({action:c.ACTION_GROUP,isInteractive:!1,grouping:e})},removeTag:function(e){if(e.id.contains("sixw:")){let t=e.id.replace("sixw:",""),i=["string","boolean"],a={type:e.type};-1==i.indexOf(e.type)&&(e.object.from||e.object.to)?a.value={isSimplifiedCriteria:e.isSimplifiedCriteria,from:e.object.from,to:e.object.to}:a.value=e.object,this.advanceFilter.removeFreeInput(t,a.type,a.value),a.predicate=p.getPredicate(t.split("/").pop()),this.advCriteriaToRemove.push(a)}else this.advanceFilter.toggle(e);this.enableActionButton(),"readOnly"==this.mode&&this.dispatchEvent("removeTagFromActive")},excludeTag:function(e){let t=e.condition?e.condition.excluded:e.excluded;this.advanceFilter.handleExclude(e,t),this.enableActionButton(),"readOnly"==this.mode?this.dispatchEvent("removeTagFromActive"):t?this.excludeView.addTag(e):this.predicateViews[e.id].addTag(e)},updateOperator:function(e){let{predicate:t,operator:i,informView:a}=e;this.advanceFilter.changeLocalOperator(t,i),a?(this.modifiedFromUI[t]=i,this.enableActionButton()):this.modifiedFromUI={}},removeAllTags:function(){this.activeGroupings=null,this.advanceFilter.clear(),this.destroyPredicateViews(),this.groupedView&&this.groupedView.emptyContent(),this.excludeView.emptyContent()},destroy:function(){this.stopListening(this.model),this.model=null,this.actionView&&this.actionView.destroy(),this.groupedView&&this.groupedView.destroy(),this.excludeView&&this.excludeView.destroy(),this.emptyView&&this.emptyView.destroy(),this.destroyPredicateViews(),this._parent()}})}),define("DS/TagNavigator/TaggerProxy",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class/Promise","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/Filter","DS/TagNavigator/Logger","DS/TagNavigator/Parameters","DS/TagNavigator/NotificationManager","DS/TagNavigator/Notification","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerNLS","DS/SNInfraUX/TaggerConfigAccess","DS/TagNavigator/simplified/model/AdvancedFilter","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/Groupings","DS/TagNavigator/simplified/utils/PersonUtils","DS/MessageBus/MessageBus","DS/TagNavigator/simplified/activeTags/AdvancedActiveTagsView","DS/TagNavigator/simplified/activeTags/ActiveTagsViewModel"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f,m,v,T,C,w,b){"use strict";var y=t.extend(i,{init:function(t,i){var a;if(this._enablePerfo=h.getOption("enablePerfo"),this._initPromise=void 0,!t||"string"!=typeof t.id)throw new Error("Invalid input arg");for(a in this._alive=!0,this._navimpl=i,this._listenerOf={},this._tagValuesMap={},this._hierarchicalTagValuesInSummary=new Map,this._predicateTagValuesMap={},this._subjectsTagValuesMap={},this._explicitValues={},this._explicitTagSuggestions={sortAlphabetically:void 0,suggestions:[],sortByW:void 0},this.hidePredicateCounts={},this.advancedOptions={},t.isSimplifiedView&&(this.advancedOptions=t.simplified||{},Object.keys(this.advancedOptions).length>0&&(this._selectedValues=new f)),this.isSimplifiedView=t.isSimplifiedView,this._selectedValues||(this._selectedValues=new o),this._groupingOptions=t.enableGrouping||void 0,this.validateGroupingOptions(),this._groupings=new v,this._excludeInfo=t.exclude,this._selectInAppInfo=t.selection,this._activeTagsOptions=t.activeTagsOptions,this.hideCounts=!1,this._tagValuesIdxForSubject={},this._nbSubjects={},this._subjectsInEdition=[],this._persistTags=!0,this._allowedRootWForSubjects=h.getOption("simplifiedRootW"),this._tagsInCreation=[],this._showOntologySuggestions=!0,this._showCommunitySuggestions=!0,this._showVocabularySuggestions=!0,this.subjectsMapByPredValue={},this._fields={},this._id=t.id,this._widgetId=t.widgetId,this._isActive=!0,this._isReady=!0,t.cStorages)e.is(t.cStorages[a],"object")||delete t.cStorages[a];for(a in t.tagsServers)e.is(t.tagsServers[a],"object")||delete t.tagsServers[a];this._cStorages=t.cStorages||{},this._tagsServers=e.is(t.tagsServers,"object")&&Object.keys(t.tagsServers).length?t.tagsServers:null,this._tenant=t.tenant||null,this._filteringMode=t.filteringMode,this._hasPlatformData=t.hasPlatformData,this.colorizeSupport=t.colorize||!1,this._enableTagsOnDemand=h.getOption("enableTagsOnDemand")&&t.enableTagsOnDemand||!1,this._searchMoreTagsOnDemand=t.searchMoreTagsOnDemand,this._fetchAllTags=!t.enableTagsOnDemand&&void 0,this.freeInputSupport=t.freeInput||!1,this.preciseCount=t.preciseCount||!1,this.predicateSortOrder=t.predicateSortOrder||void 0,this.relevantPredicates=[],this.lastLoadMoreBySearch=!1,this.enablePLM=t.enablePLM||!1,this.parameters=null,this.enablePLM&&(this.parameters=new l),this._criteriaIdsMap={},this._tagsWithInternalName=h.getOption("tagsWithInternalName"),this._moreCountVar,this.predicateInfo=void 0,this._adminConfig=void 0,this.appID=t.appId,this._adminConfigPromise=void 0,this._taggerViewVisibility=this._navimpl.getTaggerViewVisibility();if(this._predicateOperatorConfig=void 0,this._predicateOperatorPromise=void 0,this.predicateTagsMap=new Map,t&&t.embeddedTagger&&(this.hasEmbeddedView=!0,this.embeddedViewVisibility=!1,this._embeddedTaggerView=void 0,this._embeddedTaggerViewOptions=t.embeddedTagger,this.embMultiselect=!t.embeddedTagger.hasOwnProperty("multiselect")||t.embeddedTagger.multiselect,this.zProperty=t.embeddedTagger.hasOwnProperty("zIndexForMenu")?t.embeddedTagger.zIndexForMenu:200,this._initializeEmbeddedView()),Object.keys(this.advancedOptions).length>0&&this.advancedOptions.editTagsRelationships){this.editTagsRelationships=this.advancedOptions.editTagsRelationships;var n=this.hasExcludeSupport();this.activeTagsViewModel=new b,this.activeTagsView=new w({model:this.activeTagsViewModel,exclude:n}).render(),this.activeTagsView.hide()}this._globalFiltersWithoutExclude=this._navimpl.getFilters(),this.listenTo(this._navimpl,"onBeforeGlobalFilterChange",this._onBeforeGlobalFilterChangeCB.bind(this)),this._predicateSummaryOptions={countPolicy:1};let s=t.predicateSummary;if(UWA.is(s,"object")){let e=s.countPolicy;UWA.is(e,"number")&&e>=1&&e<=3&&(this._predicateSummaryOptions.countPolicy=e)}this._customCountOnHierarchicalTags=h.getOption("customCountOnHierarchicalTags")?h.getOption("customCountOnHierarchicalTags"):!!UWA.is(t.customCountOnHierarchicalTags,"boolean")&&t.customCountOnHierarchicalTags},_onBeforeGlobalFilterChangeCB:function(){r.log("Inside _onBeforeGlobalFilterChangeCB for proxy id="+this._id),this.supportsAdvancedFilter()||(this._globalFiltersWithoutExclude=this._removeExcludedTags(this._navimpl.getFilters().allfilters))},isDateRange:function(e){if(this.predicateTypeMap){return"daterange"==this.predicateTypeMap.get(e)}},getActiveTagsEditView:function(){return this.activeTagsView},getActiveTagsEditModel:function(){return this.activeTagsViewModel},injectEmbeddedTaggerView:function(){if(this._embeddedTaggerView&&!this._embeddedTaggerView.container.isInjected()){var t=document.body.getElement(this._embeddedTaggerViewOptions.target);t?(r.log("targetElem for embedded tagger is AVAILABLE, injecting the view into the DOM"),this._embeddedTaggerView.inject(t)):e.is(this._embeddedTaggerViewOptions)&&e.is(this._embeddedTaggerViewOptions.is6WInWebInWinActive)&&!0===this._embeddedTaggerViewOptions.is6WInWebInWinActive?r.log("targetElem for embedded tagger is IN WebInWin"):r.error("targetElem for embedded tagger is NOT YET AVAILABLE")}},showEmbeddedTaggerView:function(){r.log("inside TaggerProxy#showEmbeddedTaggerView"),this._taggerViewVisibility?r.warn("Main Tagger is visible so ignoring the showEmbeddedTaggerView request"):(this.embeddedViewVisibility=!0,this._embeddedTaggerView&&this._embeddedTaggerView.show())},hideEmbeddedTaggerView:function(){r.log("inside TaggerProxy#hideEmbeddedTaggerView"),this.embeddedViewVisibility=!1,this._embeddedTaggerView&&this._embeddedTaggerView.hide()},redrawEmbeddedView:function(){return this._embeddedTaggerView._redrawTags()},requestEmbeddedViewGroupingChange:function(e){this._embeddedTaggerView&&this._embeddedTaggerView.requestGroupingChange(e)},embeddedViewMultiSelect:function(){return this.embMultiselect},embeddedZProperty:function(){return this.zProperty},setMessageToDisplay:function(e){this._navimpl.dispatchInfoMessageEvent(e)},clearMessage:function(){this._navimpl.dispatchInfoMessageEvent()},infoMessageLinkCB:function(){this.triggerCallbackOfEvent(y.handleMessageAction)},getNavImpl:function(){return this._navimpl},setNavImpl:function(e){this._navimpl=e},isFeatureSupported:function(e){var t=!1;switch(e){case"customCountOnHierarchicalTags":t=this._customCountOnHierarchicalTags;break;case"grouping":t=!!this._groupingOptions;break;case"exclude":t=!!this._excludeInfo;break;case"selectInApp":t=null!=this._selectInAppInfo&&"object"==typeof this._selectInAppInfo}return t},getTenant:function(){return this._tenant},isTagInEdition:function(e){return this._tagsInCreation[e.fullid]},widgetId:function(){return this._widgetId},isActive:function(){return this._isActive},isReady:function(){return this._isReady},isFilteringOnServer:function(){return"FilteringOnServer"===this._filteringMode},getFilters:function(e,t,i){var a={};return a.localfilters=e&&!this.isActive()?{}:this._selectedValues.computeFilterObj(null,this._fields,e,t,i).allfilters,a.allfilters=this._selectedValues.computeFilterObj(this._navimpl.getFilters(this._fields),this._fields,e,t,i).allfilters,this._enableTagsOnDemand&&(a.fetchAllTags=this._fetchAllTags),this.hasExcludeSupport()||this.supportsAdvancedFilter()||(a.allfilters=this._removeExcludedTags(a.allfilters)),a},setFilters:function(e){this._selectedValues.setCondition(e)},hasFreeInputOnly:function(e){return!(!this.predicateInfo||!this.predicateInfo.hasOwnProperty(e))&&(!!this.predicateInfo[e].hasOwnProperty("freeInputOnly")&&this.predicateInfo[e].freeInputOnly)},hasFreeInputSupport:function(e){var t;return t=!(!this.predicateInfo||!this.predicateInfo.hasOwnProperty(e))&&(!!this.predicateInfo[e].hasOwnProperty("allowFreeInput")&&this.predicateInfo[e].allowFreeInput),this.freeInputSupport||t},validateGroupingOptions:function(){if(this._groupingOptions){if(!UWA.is(this._groupingOptions,"object"))throw new Error("INVALID grouping options provided to the proxy, "+JSON.stringify(this._groupingOptions));var e=this._groupingOptions.maxLevels;e?Number.isInteger(e)&&0!=e||(r.error("INVALID grouping options provided to the proxy, maxLevels= "+JSON.stringify(e)+", setting to default value"),this._groupingOptions.maxLevels=-1):this._groupingOptions.maxLevels=-1;var t=this._groupingOptions.maxPerLevel;t?Number.isInteger(t)&&0!=t||(r.error("INVALID grouping options provided to the proxy, maxPerLevel= "+JSON.stringify(t)+", setting to default value"),this._groupingOptions.maxPerLevel=-1):this._groupingOptions.maxPerLevel=-1;var i=this._groupingOptions.maxHierarchyPerLevel;i?Number.isInteger(i)&&0!=i||(r.error("INVALID grouping options provided to the proxy, maxHierarchyPerLevel= "+JSON.stringify(i)+", setting to default value"),this._groupingOptions.maxHierarchyPerLevel=-1):this._groupingOptions.maxHierarchyPerLevel=-1}},hasGroupingSupport:function(e,t){var i=!1;if(this._groupingOptions&&(i=!0,e&&this.predicateInfo)){var a=this.predicateInfo[e];a&&(0==a.allowGrouping?i=!1:t&&0==a.allowPredicateGrouping&&(i=!1))}return i},getGroupingConfig:function(){return UWA.clone(this._groupingOptions)},isGroupedBy:function(e,t,i){return this._groupings.isGroupedBy(e,t,i)},selectInAppBy:function(e){this.triggerCallbackOfEvent(y.SelectInApp,e)},groupBy:function(e,t,i,a){let n=this,s={},o=UWA.clone(this._navimpl.getGroupingInfo()),r={};e&&e.length||e&&!e.length&&!a?(n._groupings.computeGroupingInfo(e,i,!0),s=UWA.clone(this._groupings.getGroupingInfo()),o&&o.groups&&(s.groups=s.groups.concat(o.groups))):(!e||e&&!e.length&&a)&&(s=UWA.clone(o),(r=UWA.clone(this._groupings.getGroupingInfo()))&&r.groups&&(s.groups=s.groups.concat(r.groups))),t&&this.triggerCallbackOfEvent(y.GroupingChange,s)},getActiveGroupings:function(){return this._groupings.getActiveGroupings()},hasActiveGroupings:function(){return this._groupingOptions&&this._groupings.hasActiveGroupings()},setLocalGrouping:function(e){return new a(function(t,i){if(this._groupingOptions)if(UWA.is(e.grouping,"object")&&UWA.is(e.grouping.groups,"array")){var a=e.grouping.groups;a.length>0?(this.groupBy(a,e.triggerGroupingChangeCB),this._navimpl.dispatchRedrawTagsEvent({event:"setLocalGrouping"}),t()):i("INVALID inputs for setLocalGrouping, call ignored")}else i("INVALID inputs for setLocalGrouping, call ignored");else i("Proxy does not support groupings, setLocalGrouping ignored")}.bind(this))},_requestGroupingChange:function(e){this._navimpl.dispatchEvent("REQUEST_GROUPING_CHANGE",{event:"requestGroupingChange",data:e})},clearLocalGrouping:function(e,t){return new a(function(i,a){if(this._groupingOptions){this.groupBy([],e?e.triggerGroupingChangeCB:void 0,null,t),this._navimpl.dispatchRedrawTagsEvent({event:"clearLocalGrouping"}),i()}else a("Proxy does not support groupings, clearLocalGrouping ignored")}.bind(this))},hasExcludeSupport:function(e){var t=!1;return UWA.is(this._excludeInfo,"boolean")?t=this._excludeInfo:UWA.is(this._excludeInfo,"obejct"),t},hasSelectInAppSupport:function(){return UWA.is(this._selectInAppInfo,"object")},hasLoadMoreTagsEnabled:function(){return this._enableTagsOnDemand},hasSearchLoadMoreTagsEnabled:function(){return this._searchMoreTagsOnDemand},isFetchAllTagsCalled:function(){return this._fetchAllTags},hasCusomActiveTags:function(){return!!UWA.is(this._activeTagsOptions,"object")},getActiveTagsOptions:function(){return this._activeTagsOptions},getExpandStatus:function(e){var t=this._adminConfig||this.predicateInfo;return!!t&&("person"==e||(t.hasOwnProperty(e)?!!t[e].hasOwnProperty("expanded")&&t[e].expanded:void 0))},isPreciseCount:function(){return this.preciseCount},isAdvancedSearch:function(){return Object.keys(this._criteriaIdsMap).length>0},getTagsServers:function(){return this._tagsServers},getCStorages:function(){return this._cStorages},hasPlatformData:function(){return this._hasPlatformData},getSortOrder:function(){return this.predicateSortOrder},setSortOrder:function(e){this.predicateSortOrder=e,this.triggerCallbackOfEvent(y.SortChange,e)},getAdvancedOption:function(e){return this.advancedOptions[e]},_alivePreCond:function(){if(!this._alive)throw new Error("TaggerProxy '"+this._id+"' is a zombie")},_sanitizeTags:function(t,i,a){const n=performance.now();if(!e.is(t,["object","array"]))return t;var o=Array.isArray(t)?t:[].concat.apply([],Object.keys(t).map(function(e){return t[e]}));r.log("duration convert to Array="+(performance.now()-n));const l=performance.now();var c={},d=h.getOption("forbiddenTags"),g=UWA.is(d,"object")&&this._navimpl.isInternalProduction();const u=new Map;var p,f;let m=new Map,v=new Map;o.forEach(function(e){delete e._blockedForDisplay,f=!0;var t=e.sixw,n=u.get(t),o=e.type;let l;if(g&&i&&(p=d[t])&&-1!=p.indexOf(e.object)&&(f=!1,r.log("forbidden tag removed from the summary:"+JSON.stringify(e))),f&&(Array.isArray(e.object)&&(e.object.length>0?(c[t]=!0,(!Array.isArray(e.dispValue)||Array.isArray(e.dispValue)&&e.dispValue.length!==e.object.length)&&(e.dispValue=e.object.slice(0))):(f=!1,r.log("tag removed from the summary, t.object is not a valid array:"+JSON.stringify(e)))),f))if(n)e.predicate=m.get(t),e.predicate&&!e.predicate.getDisplayStatus()?(r.log("Tag blocked for display: tag="+e.object+", predicate="+e.predicate.id()),e._blockedForDisplay=!0):n.push(e);else try{let i={sixw:t,type:e.type,server:a};l=new s(i),m.set(t,l),l.getDisplayStatus()?(e.predicate=l,n=[e],u.set(t,n),v.set(l.id(),o)):(r.log("Tag blocked for display: tag="+e.object+", predicate="+l.id()),e._blockedForDisplay=!0)}catch(e){r.error("Unable to create predicate")}}),this.predicateTypeMap=v,r.log("generic treatment="+(performance.now()-l));const T=performance.now();for(var C in r.log("Number of predicates with hierarchical tags="+Object.keys(c).length),c){r.log("treating predicate with hierarchical tags="+C);var w=u.get(C);if(Array.isArray(w)){let t={},i=[],a=w.length;r.log("total number of tags="+a);for(let e=0;e<a;e++){let a=w[e];Array.isArray(a.object)?t[a.object[0]]=!0:i.push(a)}let n=i.length;r.log("total number of tags with object as string="+n),r.log("size of map of first element of those objects which are array ="+Object.keys(t).length);for(let a=0;a<n;a++){let n=i[a],s=n.object;"string"==typeof s&&t[s]&&(n.object=[s],n.dispValue=e.is(n.dispValue)?[n.dispValue]:n.dispValue)}}}if(r.log("hierarchical treatment="+(performance.now()-T)),i){const e=performance.now();var b=[];for(let e of u.values())b=b.concat(e);return r.log("tags concatenation="+(performance.now()-e)),r.log("total time taken by _sanitizeTags="+(performance.now()-n)),b}return r.log("total time taken by _sanitizeTags="+(performance.now()-n)),t},addNbSubjectsForTagValue:function(e,t){if(this._tagValuesMap[e])this._nbSubjects[e]+=t;else{this._tagValuesMap[e]=e,this._nbSubjects[e]=t;var i=e.pred.id();this._predicateTagValuesMap[i]?this._predicateTagValuesMap[i].push(e):this._predicateTagValuesMap[i]=[e]}},getNbSubjectsForTagValue:function(e){return this._nbSubjects[e]},_addFieldsForTagValue:function(e,t){t&&""!==t&&(this._fields[e]=this._fields[e]||{},this._fields[e][t]=!0,e.parent&&this._addFieldsForTagValue(e.parent,t))},addTagValueForSubject:function(e,t){this.addNbSubjectsForTagValue(t,1),this.indexSubjectsTagsForFiltering(t,e),this._tagValuesIdxForSubject[e].push(t.fullid)},removeTagValueForSubject:function(e,t){this._nbSubjects[t]--,this._nbSubjects[t]<=0&&delete this._tagValuesMap[t],this.removeFromIndexTagForFiltering(t,e),this._tagValuesIdxForSubject[e].splice(this._tagValuesIdxForSubject[e].indexOf(t.fullid),1)},_computeTagsValues:function(e){var t,i,a,n,s,o,l,c,d,g,h,u,p,f,m,v;h={},a=[];let T=0;for(t in e)if(e.hasOwnProperty(t))for(u=0,p=(n=e[t]).length;u<p;u++)if((i=n[u])._blockedForDisplay)T++;else{if(d=(o=h[f=i.sixw]?h[f]:h[f]={})[m=i.field]?o[m]:o[m]={},!("string"==typeof(v=i.object)&&0!==v.length||Array.isArray(v)&&0!==v.length))throw new Error("Invalid input arg");d[v]||(d[v]={count:0,type:i.type,uri:i.object},void 0!==i.dispValue&&(d[v].dispValue=i.dispValue)),d[v].count+=1}for(g in T&&r.log("nbBlockedTagValues inside _computeTagsValues="+T),h)if(h.hasOwnProperty(g))for(s in o=h[g])if(o.hasOwnProperty(s))for(l in d=o[s])d.hasOwnProperty(l)&&(i={count:(c=d[l]).count,type:c.type,object:c.uri,sixw:g},void 0!==c.dispValue&&(i.dispValue=c.dispValue),s&&"undefined"!==s&&(i.field=s),a.push(i));return a},getLocalFilter:function(){return this._selectedValues},setClonedFilter:function(e){this._selectedValues=e},supportsAdvancedFilter:function(){return this._selectedValues instanceof f},id:function(){return this._alivePreCond(),this._id},addListener:function(e,t,i){return this._alivePreCond(),this._listenerOf[e]={cb:t,scope:i},this},compareObjects:function e(t,i){if(t===i)return!0;if(!(t instanceof Object&&i instanceof Object))return!1;if(t.constructor!==i.constructor)return!1;for(var a in t)if(t.hasOwnProperty(a)){if(!i.hasOwnProperty(a))return!1;if(t[a]===i[a])continue;if("object"!=typeof t[a])return!1;if(!e(t[a],i[a]))return!1}for(a in i)if(i.hasOwnProperty(a)&&!t.hasOwnProperty(a))return!1;return!0},_removeExcludedTags:function(e){for(var t in e)e[t]=e[t].filter(function(e){return!0!==e.excluded});var i={};for(var t in e)e[t].length>0&&(i[t]=e[t]);return i},shouldBeWarned:function(e){var t=!0;if(!this.hasExcludeSupport()&&UWA.is(e,"object")&&UWA.is(e.allfilters,"object")&&(!(this._navimpl.getFocusedProxy()===this)&&!this.hasLocalFilters()&&!this.supportsAdvancedFilter())){var i=this._removeExcludedTags(UWA.clone(e.allfilters));UWA.is(this._globalFiltersWithoutExclude,"object")&&this.compareObjects(this._globalFiltersWithoutExclude,i)&&(t=!1)}return t},onBeforeRefine:function(){this._isReady=!1},onRefine:function(e){var t,i,a,n;UWA.is(e,"object")&&(t=e.isSearch,i=e.isInternal,a=e.triggerProxyCB);var s=this._isReady;if(this._isReady=!1,n=this.getFilters(),t&&(n.search=!0),UWA.is(a,"boolean")?(n.triggerProxyCB=a,this._isReady=s):null==a&&!0===i&&(this._isReady=s),this.getParameters()){var o=this.getParameters().getFilters();o&&(n.PLMParameters=o)}!0===i?this.triggerCallbackOfEvent(y.InternalFilterChange,n):this.triggerCallbackOfEvent(y.FilterChange,n)},onLoadMoreTags:function(e,t){this._fetchAllTags=this._enableTagsOnDemand,this._searchMoreTagsOnDemand&&(this.lastLoadMoreBySearch&&"clear"===e||"search"===e)?(this.lastLoadMoreBySearch="search"===e,this._isReady=!1,this.triggerCallbackOfEvent(y.LoadMoreTags,{searchString:t})):this._enableTagsOnDemand&&"clear"!=e&&(this._isReady=!1,this.triggerCallbackOfEvent(y.LoadMoreTags))},onSearch:function(){this._isReady=!1,this.onRefine({isSearch:!0}),this._navimpl.dispatchEvent("SEARCH_LAUNCH")},warnForCriteriaChange:function(e){this.triggerCallbackOfEvent(y.CriteriaChange,e)},warnForCriteriaModified:function(e){this.triggerCallbackOfEvent(y.CriteriaModified,e)},onAdditionalFilterChange:function(e){this.triggerCallbackOfEvent(y.AddFilterChange,e)},informProxyOfFocusChange:function(e){this.triggerCallbackOfEvent(y.AddFocusChange,e)},updateTaggerDisplayStatus:function(e,t){this._taggerViewVisibility=e,t&&this.triggerCallbackOfEvent(y.updateDisplayStatus,e)},_initialize:function(){return this._initPromise||(this._initPromise=new a(function(e){let t,i,n,s,o,r=[],l=this.getGrantedRoles();r.push(l),this.appID&&this._tenant&&(t=this.retrieveAdminConfig(),r.push(t)),this._embeddedTaggerViewOptions&&(i=this._initializeEmbeddedView(),r.push(i)),this.advancedOptions&&this.advancedOptions.editTagsRelationships&&(n=this.retrieveAdminPredicateOperatorConfig(),r.push(n)),(s=this._retrieveEnterpriseOntologyConfig())&&r.push(s),(o=this._getControlledVocab())&&r.push(o),a.all(r).then(()=>{e()})}.bind(this))),this._initPromise},_retrieveEnterpriseOntologyConfig:function(){if(this._tenant)return s.updateCompanyTagPredicatesData(this._tenant)},_getControlledVocab:function(){let e=this._tenant;if(this._tenant)return new a(function(t){g.getControlledVocabularyMode({platformId:e}).then(function(e){s.updateRootWPredicates(e.mode),t()})})},getGrantedRoles:function(){return this._rolesPromise||(this._rolesPromise=new a(function(e){e()})),this._rolesPromise},populateRelevantPredicates:function(e){this.relevantPredicates=this.relevantPredicates.concat(Object.keys(e).filter(t=>e[t].relevant))},retrieveAdminConfig:function(){return this._adminConfigPromise||(this._adminConfigPromise=new a(function(e){if(this.appID&&this.isSimplifiedView)if(h.getOption("testEnableTagsOnDemand")){require(["DS/TagNavigator.tst/utils/LoadDataUtil"],t=>{t.getData("BasicTagsDemo",this._widgetId,"configure").then(t=>{this._adminConfig=t,e()})})}else p.get6WTagsConfiguration({appID:this.appID,tenantID:this._tenant}).then(function(t){r.log(`Configured Predicates for App ID ${this.appID}: ${JSON.stringify(t)}`),this._adminConfig=t,this._adminConfig&&this.populateRelevantPredicates(this._adminConfig),this.relevantPredicates.length&&this._addAdditionalPreferredPredicates(),e()}.bind(this),function(){r.log(`No Configured Predicates for App ID ${this.appID}.`),e()}.bind(this));else e()}.bind(this))),this._adminConfigPromise},_initializeEmbeddedView:function(){return this._embeddedViewPromise||(this._embeddedViewPromise=new a(function(e){if(this.hasEmbeddedView){var t,i,a=h.getOption("simplifiedRootW"),n={};i=Array.isArray(this._embeddedTaggerViewOptions.rootw)?this._embeddedTaggerViewOptions.rootw.reduce(function(e,t,i){return e[t]={},e},{}):this._embeddedTaggerViewOptions.rootw,a.forEach(function(e){for(var t in i)e==t&&(n[t]=i[t])}),t=i.hasOwnProperty("allw")?{allw:i.allw,...n}:{allw:{},...n},h.getOption("embeddedWHY")&&(t["ds6w:why"]={}),require(["DS/TagNavigator/embeddedTagger/EmbeddedTaggerView"],function(i){this._embeddedTaggerView=new i({rootw:t,proxy:this,is6WInWebInWinActive:this._embeddedTaggerViewOptions?this._embeddedTaggerViewOptions.is6WInWebInWinActive:void 0,broadcastId:this._embeddedTaggerViewOptions?this._embeddedTaggerViewOptions.broadcastId:""}).render(),this.embeddedViewVisibility||this._embeddedTaggerView.hide(),this.injectEmbeddedTaggerView(),e()}.bind(this))}else e()}.bind(this))),this._embeddedViewPromise},retrieveAdminPredicateOperatorConfig:function(){let e=h.getOption("editTagsPredicateOperators");return this._predicateOperatorPromise||(this._predicateOperatorPromise=new a(function(t){if(this.isSimplifiedView){if(e)this._predicateOperatorConfig=e,this._selectedValues.setAdminPredOperator&&this._selectedValues.setAdminPredOperator(this._predicateOperatorConfig),t();else if(UWA.is(p.get6WTagsRelationship,"function")){let e=p.get6WTagsRelationship({tenantID:this._tenant});e?e.then(function(e){r.log(`Retrieving the predicate operators from Admin: ${JSON.stringify(e)}`),this._predicateOperatorConfig=e,this._selectedValues.setAdminPredOperator&&this._selectedValues.setAdminPredOperator(this._predicateOperatorConfig),t()}.bind(this),function(){r.log("No operators set by Admin"),t()}.bind(this)):(r.log("Error resolving promise"),t())}else p.get6WTagsRelationship=function(){return new a(function(e){this._predicateOperatorConfig={"ds6w:type":{operator:"AND"},"ds6w:policy":{operator:"XOR"},"ds6w:context":{opertaor:"AND"}},this._selectedValues.setAdminPredOperator&&this._selectedValues.setAdminPredOperator(this._predicateOperatorConfig),e()})};t()}else t()}.bind(this))),this._predicateOperatorPromise},getResultsCount:function(){return this.resultCount},getPredicateSummaryCount:function(e){if(UWA.is(this._predicatesData,"object")){let t=this._predicatesData[e];if(UWA.is(t,"object"))return t.subjectsCount}},getPredicatesDataOnSummary:function(e){if(UWA.is(this._predicatesData,"object"))return this._predicatesData[e]},getPredicateCountPolicy:function(){return this._predicateSummaryOptions.countPolicy},getCountDisplayStatus:function(){return this.hideCounts||h.getOption("hideCounts")},setTags:function(e,t,i){this.dispatchEvent("setTags_ended_external");var s=performance.now();return this.hasEmbeddedView&&this.injectEmbeddedTaggerView(),UWA.is(i,"object")&&UWA.is(i.hideCounts,"boolean")&&(this.hideCounts=i.hideCounts),this._predicatesData=void 0,UWA.is(i,"object")&&(this.resultCount=UWA.is(i.count,"number")?i.count:null,UWA.is(i.predicateOptions,"object")&&(this._predicatesData=Object.freeze(i.predicateOptions))),this._hierarchicalTagValuesInSummary.clear(),new a(function(i){var a=performance.now();this._initialize().then(function(){var o,l,c,d,g,h;this._enableTagsOnDemand&&!this.hasRelevantPredicates().length&&(r.log("Proxy "+this.id()+"supporting loadMoreTagsOnDemand but has no preferred predicates - feature disabled, flag discarded."),this._enableTagsOnDemand=!1),this._enablePerfo&&console.profile("SET TAGS"),r.log("TaggerProxy.setTags _initialize performance: "+(performance.now()-a)+"ms"),this.dispatchEvent("setTags_started"),h=this._getTagsServerToUse(),e=this._sanitizeTags(e,null,h),(t=this._sanitizeTags(t,!0,h))||(t=null),this.unloadAllTags();let u=performance.now();if(null===t||0===t.length)try{t=this._computeTagsValues(e)}catch(e){r.error("Invalid input arg")}if(r.log("TaggerProxy.setTags _computeTagsValues performance: "+(performance.now()-u)+"ms"),t){let a=performance.now();for(d=0,g=t.length;d<g;d++){"date"===(c=t[d]).type&&(c.object=c.object.split("-").join("/").substr(0,10));let e=c.sixw,i=this.predicateTagsMap.get(e);try{if(c.field&&(c.explicit=c.field==n.EXPLICIT_TAG,c.explicit&&c.object&&("string"==typeof c.object&&0==c.object.indexOf(n.SIXW_ROOT_ONTOLOGY)||Array.isArray(c.object)&&1==c.object.length&&0==c.object[0].indexOf(n.SIXW_ROOT_ONTOLOGY)))){r.log("Ignoring the standard explicit tag which is not an hierarchy - "+JSON.stringify(c));continue}l=n.getTagValue(c,null,null,null,null,h,!0,this._hierarchicalTagValuesInSummary)}catch(e){r.error("Error in setTags")}if(l){if(l.isCommunityTagV1)continue;if("string"==l.type){let e=Array.isArray(l.uri);e&&(l.hasOwnCount=c.count);let t=l.parent;if(t)for(;t;)this._hierarchicalTagValuesInSummary.set(t.fullid,t),t=t.parent;else e&&this._hierarchicalTagValuesInSummary.set(l.fullid,l)}"string"==typeof(o=c.count)&&(o=parseInt(o,10)),"number"!=typeof o||isNaN(o)?r.warn("Invalid count '"+c.count+"' passed to setTags API for tag '"+c.dispValue+"'"):(this.addNbSubjectsForTagValue(l,o),this._addFieldsForTagValue(l,c.field)),i?i.push(l):(i=[l],this.predicateTagsMap.set(e,i))}}r.log("TaggerProxy.setTags TagValue.getTagValue & related processes performance: "+(performance.now()-a)+"ms"),this.addSubjects(e).then(function(){this._isReady=!0,this.dispatchEvent("setTags_ended");let e=performance.now()-s;r.log("TaggerProxy.setTags performance: "+e+"ms"),this._enablePerfo&&console.profileEnd(),this.redrawTaggerWhenAllReady(),i()}.bind(this))}else i()}.bind(this))}.bind(this))},redrawTaggerWhenAllReady(){try{this._navimpl.checkAllLoadMoreTagsProxiesPending(this.id())||this._navimpl.dispatchRedrawTagsEvent({event:"setTags"})}catch(e){console.log("Check proxy feature support exception in setTags: ",e),this._navimpl.dispatchRedrawTagsEvent({event:"setTags"})}},messageBusAnalytics:function(e,t){C.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:e,persDim:t}})},getAdditonalFilter:function(){return this.additionalFilters},setAdditionalFilter:function(e){this.additionalFilters={filters:e},this._navimpl.dispatchEvent("UPDATE_ADDITIONAL_CRITERIA",this.additionalFilters)},setAdditionalFilterProperties:function(e){let t={properties:e};this._navimpl.dispatchEvent("SET_ADD_FILTER_PROPERTIES",t)},setEmbeddedViewProperties:function(e){return this.dispatchEvent("embedded_properties_change",e),this},_addInternalNameToEnumDisplay:function(e){UWA.is(e.datasets)&&UWA.is(e.datasets.items,"array")&&e.datasets.items.forEach(function(e){e.label&&e.value&&(e.label+=" ("+e.value+")")})},setCriteria:function(e){return new a(function(t){this._initialize().then(function(){var i,a,n,o,l;if(o=this._getTagsServerToUse(),this._criteriaIdsMap={},e)for(i=0,a=e.length;i<a;i++){if(this._criteriaIdsMap[e[i].sixw]=!0,!(n=s.getPredicate(e[i].sixw.split("/").pop()))){-1===e[i].sixw.indexOf("/")&&(e[i].sixw="void/"+e[i].sixw),l="enum"===e[i].type?"string":e[i].type;var g={sixw:e[i].sixw,type:l,server:o,options:e[i].options};(e[i].forceDispValue||"void/vpmextension"===g.sixw)&&(r.warn("considering the input display name for predicate "+g.sixw+"="+e[i].dispValue),g.displayName=e[i].dispValue);try{n=new s(g)}catch(e){c.push(new d("Fail to create a predicate with invalid arg. Id is :'"+g.sixw+"'")),c.dispatch()}}"enum"===e[i].type&&n.setIsEnum(!0),n.setSuggestSupport(e[i].allowSuggestions),n.setUnit(e[i].unit),e[i].options&&(this._tagsWithInternalName&&n.isEnum()&&this._addInternalNameToEnumDisplay(e[i].options),n.setElemOptions(e[i].options))}this.countMore(),this._navimpl.dispatchEvent("REDRAW_CRITERIA"),t()}.bind(this))}.bind(this))},updateCriteria:function(e){return new a(function(t){this._initialize().then(function(){var i,a,n,o;if(o=this._getTagsServerToUse(),e&&e.length){for(i=0,a=e.length;i<a;i++){if(this._criteriaIdsMap[e[i].sixw]=!0,n=s.getPredicate(e[i].sixw.split("/").pop()))e[i].options&&(this._tagsWithInternalName&&n.isEnum()&&this._addInternalNameToEnumDisplay(e[i].options),n.setElemOptions(e[i].options));else{-1===e[i].sixw.indexOf("/")&&(e[i].sixw="void/"+e[i].sixw);var l={sixw:e[i].sixw,type:e[i].type,server:o,options:e[i].options};(e[i].forceDispValue||"void/vpmextension"===l.sixw)&&(r.warn("considering the input display name for predicate "+l.sixw+"="+e[i].dispValue),l.displayName=e[i].dispValue);try{n=new s(l)}catch(e){c.push(new d("Fail to create a predicate with invalid arg. Id is :'"+l.sixw+"'")),c.dispatch()}e[i].dispValue&&n.displayName()!==e[i].dispValue&&n.setDisplayName(e[i].dispValue),this._tagsWithInternalName&&n.isEnum()&&e[i].options&&this._addInternalNameToEnumDisplay(e[i].options),n.setElemOptions(e[i].options)}n.setSuggestSupport(e[i].allowSuggestions),n.setUnit(e[i].unit)}this.countMore(),this._navimpl.dispatchEvent("REDRAW_CRITERIA"),t()}}.bind(this))}.bind(this))},removeCriteria:function(e){var t,i;if(this._cStorages[Object.keys(this._cStorages)[0]],e&&e.length){for(t=0,i=e.length;t<i;t++)s.getPredicate(e[t].sixw.split("/").pop())&&delete this._criteriaIdsMap[e[t].sixw];this.countMore(),this._navimpl.dispatchEvent("REDRAW_CRITERIA")}},countMore:function(){var e=0;for(var t in this._criteriaIdsMap)s.getPredicate(t.split("/").pop()).getElemOptions()&&!1===s.getPredicate(t.split("/").pop()).getElemOptions().showByDefault&&e++;this.setMoreCountProxy(e)},setMoreCountProxy:function(e){this._moreCountVar=e},getMoreCountProxy:function(){return this._moreCountVar},_addAdditionalPreferredPredicates:function(){if(this.relevantPredicates||(this.relevantPredicates=[]),this.predicateInfo||(this.predicateInfo={}),!h.getOption("blockCommunityTagsInPreferredSection")&&this.isSimplifiedView){let e;s.ensureDefaultPredicates();for(let t in s.COMMUNITY_TAGS_PREDICATES)e=s.COMMUNITY_TAGS_PREDICATES[t].id(),-1==this.relevantPredicates.indexOf(e)&&this.relevantPredicates.push(e),this.predicateInfo[e]={relevant:!0,weight:1,expanded:!0}}if(!h.getOption("blockCompanyTagsInPreferredSection")&&this.isSimplifiedView){let e;s.ensureDefaultPredicates();for(let t in s.COMPANY_TAGS_PREDICATES)e=s.COMPANY_TAGS_PREDICATES[t].id(),-1==this.relevantPredicates.indexOf(e)&&this.relevantPredicates.push(e),this.predicateInfo[e]={relevant:!0,weight:3,expanded:!0};for(let t in s.AUTO_COMPANY_TAGS_PREDICATES)e=s.AUTO_COMPANY_TAGS_PREDICATES[t].id(),-1==this.relevantPredicates.indexOf(e)&&this.relevantPredicates.push(e),this.predicateInfo[e]={relevant:!0,weight:2,expanded:!0}}this.getAdvancedOption(T.PERSON_REFINE)&&(this.predicateInfo[T.PERSON_PREDICATE]={relevant:!0,weight:99,expanded:!0},this.populateRelevantPredicates(this.predicateInfo))},getHideCountPropertyForPredicate:function(e){if(h.getOption("hideCounts"))return!0;this.hidePredicateCounts=Object.fromEntries(Object.entries(e).filter(([e,t])=>t.hasOwnProperty("hideCount")).map(([e,t])=>[e,{hideCount:t.hideCount}]))},configurePredicates:function(t){e.is(t,"object")?(this.populateRelevantPredicates(t),this.getHideCountPropertyForPredicate(t),this.predicateInfo=t):r.error("the configurePredicates API take an Object as first arg."),UWA.is(this.predicateSortOrder)||(this.predicateSortOrder="sort-weight"),this.relevantPredicates.length&&this._addAdditionalPreferredPredicates()},getPredicateInfo:function(){return this.predicateInfo?UWA.clone(this.predicateInfo):void 0},hasRelevantPredicates:function(e){var t=UWA.clone(this.relevantPredicates);if(t&&t.length>0&&e){var i=this.getHiddenPredicates();return t.filter(function(e){return-1==i.indexOf(e)})}return t},getHiddenPredicates:function(){var e=[],t=this._adminConfig||this.predicateInfo;if(t)for(var i in t){var a=t[i];a&&UWA.is(a.weight,"number")&&a.weight<1&&e.push(i)}return this.getAdvancedOption(m.TYPE_CATEGORIZATION)&&e.push("ds6w:typeCategory"),e},getRangeDefine:function(e){},setStatus:function(e){this._navimpl.dispatchEvent("STATUS_UPDATE",e)},addSubjects:function(e){return new a(function(t){this._initialize().then(function(){var i,a,s,o,l,c,d;d=this._getTagsServerToUse();let g=0;for(i in e)if(e.hasOwnProperty(i))for(a=e[i],this._tagValuesIdxForSubject[i]=[],this._subjectsTagValuesMap[i]={},l=0,c=a.length;l<c;l++)if((s=a[l])._blockedForDisplay)g++;else if(s.field&&(s.explicit=s.field==n.EXPLICIT_TAG,s.explicit&&s.object&&("string"==typeof s.object&&0==s.object.indexOf(n.SIXW_ROOT_ONTOLOGY)||Array.isArray(s.object)&&1==s.object.length&&0==s.object[0].indexOf(n.SIXW_ROOT_ONTOLOGY))))r.log("Ignoring the standard explicit tag which is not an hierarchy - "+JSON.stringify(s));else{"date"===s.type&&(s.object=s.object.split("-").join("/").substr(0,10));try{o=n.getTagValue(s.sixw,s.dispValue,s.object,s.type,null,d)}catch(e){r.error("Error in addSubjects")}if(o){if(o.pred&&!o.pred.getDisplayStatus()){r.log("Ignoring the tag on the subject - tag="+s.object+", predicate="+o.pred.id());continue}if(o.isCommunityTagV1)continue;this.indexSubjectsTagsForFiltering(o,i),this._tagValuesIdxForSubject[i].push(o.fullid),this._subjectsTagValuesMap[i][o.fullid]=o}}g&&r.log("nbBlockedTagValues inside TaggerProxy#addSubjects="+g),t()}.bind(this))}.bind(this))},indexSubjectsTagsForFiltering:function(e,t){var i=e.fullid;return this.subjectsMapByPredValue[i]=this.subjectsMapByPredValue[i]||{},this.subjectsMapByPredValue[i][t]=!0,e.parent&&this.indexSubjectsTagsForFiltering(e.parent,t),this},removeFromIndexTagForFiltering:function(e,t){var i=e.fullid;return delete this.subjectsMapByPredValue[i][t],this},getSubjectsFromTag:function(e){return Object.keys(this.subjectsMapByPredValue[e.fullid]||{})||[]},supportsEmbeddedView:function(){return this._embeddedTaggerView||this.hasEmbeddedView},die:function(e){return r.log("Inside TgagerProxy#die for proxy id="+this._id),this._isDying=!0,e||(e=!0),this._alivePreCond(),this.unloadAllTags(),this.clearLocalFilter(),this._isActive=!1,this._navimpl.getFocusedProxy()===this&&this._navimpl.removeFocusedProxy(!0),this.hasSubjectsInEdition()?this.unfocus():e&&this._navimpl.dispatchRedrawTagsEvent({event:"die"}),this._navimpl.removeProxy(this),this._navimpl.updateFocusedProxy(),this.stopListening(this._navimpl,"onBeforeGlobalFilterChange"),this._navimpl=null,this._alive=!1,this._embeddedTaggerView&&this._embeddedTaggerView.destroy(),this.activeTagsView&&(this.activeTagsView.destroy(),this.activeTagsView=null,this.activeTagsViewModel=null),this},isAlive:function(){return this._alive},isDying:function(){return this._isDying},hasSubjectsInEdition:function(){return 0!==this._subjectsInEdition.length},getPersistTags:function(){return this._persistTags},focusOnSubjects:function(e,t,i,a){if(!0!==h.getOption("offline6W")){"boolean"!=typeof t&&(t=!0),i&&(this._dataSources=i),this._alivePreCond(),this._persistTags=t,this._subjectsInEdition=e.slice(0);var n=h.getOption("simplifiedRootW");if(a&&a.rootW?UWA.is(a.rootW,"array")&&(0==a.rootW.length?this._allowedRootWForSubjects=[]:this._allowedRootWForSubjects=a.rootW.filter(function(e){return-1!==n.indexOf(e)})):this._allowedRootWForSubjects=n,!this.hasSubjectsInEdition())return this.unfocus(),!1;if(h.getOption("EXISTINGS_TAGS_FROM_6WTAGS_DB")){const e=performance.now();this._tagsServers[Object.keys(this._tagsServers)[0]].getExistingTags({subject_uri:this._subjectsInEdition[this._subjectsInEdition.length-1],onComplete:function(t){console.log("existing tags subject="+t),console.log("duration to get existing tags="+(performance.now()-e))},onFailure:function(){console.error("FAILED to reetrive existing tags for subject")},onTimeout:function(){console.error("TIMEOUT to retrive existing tags for subject")}})}if(this._resetExplicitTagSuggestions(),a&&a.suggestionOptions){let e=a.suggestionOptions;this._showOntologySuggestions="boolean"==typeof e.showOntologySuggestions&&e.showOntologySuggestions,this._showCommunitySuggestions="boolean"==typeof e.showCommunitySuggestions&&e.showCommunitySuggestions,this._showVocabularySuggestions="boolean"==typeof e.showVocabularySuggestions&&e.showVocabularySuggestions,e.suggestions&&Array.isArray(e.suggestions)&&(e.suggestions.forEach(e=>{e.isExplicitTagSuggestion=!0}),this._explicitTagSuggestions.suggestions=e.suggestions,this._explicitTagSuggestions.sortAlphabetically="boolean"==typeof e.sortAlphabetically&&e.sortAlphabetically,this._explicitTagSuggestions.sortByW="boolean"==typeof e.sortByW&&e.sortByW)}return this._navimpl.dispatchRedrawTagsEvent({event:"focusOnSubjects"}),this._navimpl.setIconVisibleBool(this._widgetId,!1),this._navimpl.dispatchEvent("UPDATE_ICON"),this}r.warn("Focus on subject ignored on offline mode")},showOntologySuggestions:function(){return this._showOntologySuggestions},showCommunitySuggestions:function(){return this._showCommunitySuggestions},showVocabularySuggestions:function(){return this._showVocabularySuggestions},_resetExplicitTagSuggestions:function(){this._showOntologySuggestions=!0,this._showCommunitySuggestions=!0,this._showVocabularySuggestions=!0,this._explicitTagSuggestions={sortAlphabetically:void 0,suggestions:[],sortByW:void 0}},getExplicitTagSuggestions:function(){if(this._explicitTagSuggestions.suggestions.length)return this._explicitTagSuggestions},getFocusedSubjectsData:function(){var e=[],t=this;return this._subjectsInEdition.forEach(function(i){let a=t._dataSources?t._dataSources[i]:void 0,n={uri:i};a?UWA.is(a,"string")?n.service=a||(t.createTagOn3DSpace(i)?"3DSpace":""):UWA.is(a,"object")&&(n.source=a.source,n.service=a.serviceToPersistTags,n.containerId=a.containerId):n.service=t.createTagOn3DSpace(i)?"3DSpace":"",h.getOption("disable_FUN136500")||(n.tags=t.getUserTagsForSubject(n.uri)),e.push(n)}),e},getUserTagsForSubject(e){let t=this._tagValuesIdxForSubject[e],i=[];return t&&t.forEach(e=>{let t=this._tagValuesMap[e];if(t&&!0===t.explicit){let e={sixw:t.pred.getFullPredicateID(),type:t.type,object:t.uri};i.push(e)}}),i},getAllowedRootWForTagging:function(){return this._allowedRootWForSubjects},activate:function(){this._alivePreCond(),!0!==this._isActive&&(this._isActive=!0,this._navimpl.updateFocusedProxy(),this._navimpl.dispatchRedrawTagsEvent({event:"activate"}))},deactivate:function(){this._alivePreCond(),!1!==this._isActive&&(this._isActive=!1,this._navimpl.updateFocusedProxy(),this._navimpl.dispatchRedrawTagsEvent({event:"deactivate"}))},unfocus:function(){this._alivePreCond(),this._subjectsInEdition=[],this._navimpl.dispatchRedrawTagsEvent({event:"unfocus"}),this._navimpl.getIconVisibleBool(this._widgetId)!==(0!==Object.keys(this.getFilters().localfilters).length)&&(this._navimpl.setIconVisibleBool(this._widgetId,0!==Object.keys(this.getFilters().localfilters).length),this._navimpl.dispatchEvent("UPDATE_ICON"))},unsetTags:function(){return this._alivePreCond(),this.unloadAllTags(),this._isReady=!0,this.unfocus(),this},unloadAllTags:function(){return this._alivePreCond(),this.subjectsMapByPredValue={},this._tagValuesIdxForSubject={},this._nbSubjects={},this._tagValuesMap={},this._predicateTagValuesMap={},this._subjectsTagValuesMap={},this._navimpl.preparePredicateTagMap(),this},updateLocalFilterStatus:function(e){return this.triggerCallbackOfEvent(y.UpdateLocalFilterStatus,e)},toggleProxyFocus:function(e){return this._alivePreCond(),this._isActive?(this._navimpl.toggleProxyFocus(this,e),this):(r.error("Proxy is deactivate: Cannot focus on an inactive proxy"),this)},clearLocalFilter:function(e){this._alivePreCond();var t,i,a,n,o,r=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id()),l=this._selectedValues.isEmpty();for(a in this._selectedValues.clear(),r)if(i=s.getPredicate(a),r[a].value)for(n=0;n<r[a].value.length;n++)-1!==(t=(o=i.getElemOptions())&&o.datasets&&o.datasets.items?o.datasets.items.map(function(e){return e.value}).indexOf(r[a].value[n].value):-1)&&!0===o.datasets.items[t].predefined&&delete o.datasets.items[t].predefined;return this._navimpl.getCache().resetCriteriaToResetBeforeFilterChange(this.id()),this._navimpl.getCache().resetCriteriaToRemoveBeforeFilterChange(this.id()),this.getParameters()&&this.getParameters().clearValues(),this.updateProxyView(l),!0===e&&this.onRefine(),this},_getTagsServerToUse:function(){return e.is(this._cStorages,"object")&&Object.keys(this._cStorages).length>0?this._cStorages[Object.keys(this._cStorages)[0]]:e.is(this._tagsServers,"object")&&Object.keys(this._tagsServers).length>0?this._tagsServers[Object.keys(this._tagsServers)[0]]:void 0},setLocalFilter:function(t,i,o){return new a(function(a){this._initialize().then(function(){r.log("Inside setLocalFilter after _initialize"),r.log("mode = "+(o||"toggle"));var l,g,h,p,m,v,T,C,w,b,y=this,S=["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"],I=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id()),E={};b=this._getTagsServerToUse();var x=(g=t.localFilter).isSimplified;!x||this._selectedValues instanceof f||r.error("Error in setLocalFilter, cannot handle the advanced input filter"),this._alivePreCond(),v=this._selectedValues.isEmpty();var _=function(t,i,a){if(h=t.replace("sixw:",""),T=h.split("/").pop(),"string"===a){for(p=0,m=i.length;p<m;p++)this._selectedValues.createFreeInput(h,a,i[p].object,i[p].displayValue),i[p].value=i[p].object,i[p].label=i[p].displayValue,i[p].selected=!0;E[T]=I[T]||{},E[T].type=I[T]&&I[T].type?I[T].type:i[0].type,E[T].value=I[T]&&I[T].value?I[T].value.concat(i):i,I=e.merge(E,I)}else if("boolean"===a)i.map(function(e){e.value=e.object,e.label="true"===e.object?u.getText("yes"):u.getText("no")}),E[T]={},E[T].value=i,E[T].type=a,this._selectedValues.createFreeInput(h,a,i[0].object,i[0].label);else if("integer"===a||"double"===a||"float"===a||"date"===a)for(w in"date"===a&&x?i.forEach(function(e){e.object.isSimplifiedCriteria=e.isSimplifiedCriteria,e.object.nls=e.displayValue,y._selectedValues.isSelectedAttribute(t,e)?y._selectedValues.removeFreeInput(h,a,e.object):y._selectedValues.createFreeInput(h,a,e.object)}):this._selectedValues.createFreeInput(h,a,i[0].object),E[T]={},E[T].type=a,i[0].object)"type"!==w&&(E[T][w]={value:"date"===a?new Date(i[0].object[w]):i[0].object[w],type:a});if(!s.getPredicate(T)){-1===S.indexOf(h.split("/")[0])&&(h="void/"+h);var n={sixw:h,type:a,server:b};try{new s(n)}catch(e){c.push(new d("Fail to create a predicate with invalid arg. Id is :'"+n.sixw+"'")),c.dispatch()}}};if(x)r.log("filter is AdvancedFilter"),g.condition.forEach(function(e){UWA.is(e,"object")&&r.log("filterCondition="+JSON.stringify(e));var t=Object.keys(e)[0];if(r.log("fullPredId="+t),0===t.indexOf("sixw:")){var i=e[t];C=e[t][0].type,_.call(y,t,i,C)}else{var a=e[t];UWA.is(a,"object")&&r.log("filterConditionInfo="+JSON.stringify(a)),a.isComplex?(r.log("filterCondition is complex"),a.condition.forEach(function(e){y._selectedValues.toggle({id:t,operator:a.operator,isComplex:!0,condition:e})})):a.condition.forEach(function(e){if(UWA.is(e,"object")&&r.log("condition="+JSON.stringify(e)),e.isComposite){r.log("filterCondition is composite");var i=y._navimpl._getCompositeTagValue({predicate:t,type:e.predicates[0].type,object:e.object,dispValue:e.display});y.getAdvancedOption("editTagsRelationships")&&(i.operator=a.operator),"add"===o?y._selectedValues.isSelected(i,!0)?r.log("filter is currently ALREADY SELECTED, no action needed"):(r.log("filter is currently NOT SELECTED, adding it"),y._selectedValues.toggle(i,P)):"remove"===o?y._selectedValues.isSelected(i,!0)?(r.log("filter is currently SELECTED, removing it"),y._selectedValues.toggle(i,P)):r.log("filter is currently NOT SELECTED, no action needed"):y._selectedValues.toggle(i,P)}else e.value.forEach(function(i,s){UWA.is(i,"object")&&r.log("tagObject="+JSON.stringify(i));try{var l=n.getTagValue(t,e.display,i,e.predicates[s].type,null,b)}catch(e){r.error("Error in setLocalFilter with TagValue.getTagValue")}y.getAdvancedOption("editTagsRelationships")&&(l.operator=a.operator),"add"===o?y._selectedValues.isSelected(l,!0)?r.log("filter is currently ALREADY SELECTED, no action needed"):(r.log("filter is currently NOT SELECTED, adding it"),y._selectedValues.toggle(l,P)):"remove"===o?y._selectedValues.isSelected(l,!0)?(r.log("filter is currently SELECTED, removing it"),y._selectedValues.toggle(l,P)):r.log("filter is currently NOT SELECTED, no action needed"):y._selectedValues.toggle(l,P)})})}});else for(var A in g)if(r.log("fullPredId="+A),g.hasOwnProperty(A))if(0===A.indexOf("sixw:")){var N=g[A];C=g[A][0].type,_.call(y,A,N,C)}else{UWA.is(g[A],"array")&&r.log("tags before manageDuplicates="+JSON.stringify(g[A]));N=this.manageDuplicates(g[A]);for(UWA.is(N,"array")&&r.log("tags after manageDuplicates="+JSON.stringify(N)),p=0,m=N.length;p<m;p++){var V=N[p];UWA.is(V,"object")&&r.log("tag to treat="+JSON.stringify(V));try{l=V.isComposite?this._navimpl._getCompositeTagValue({predicate:A,object:V.object,dispValue:V.disptext,type:V.type,isComposite:!0}):n.getTagValue(A,V.disptext,V.object,V.type,null,b)}catch(e){r.error("Error in setLocalFilter")}var P=void 0;UWA.is(V.excluded,"boolean")&&(P=V.excluded),"add"===o?y._selectedValues.isSelected(l,!0)?r.log("filter is currently ALREADY SELECTED, no action needed"):(r.log("filter is currently NOT SELECTED, adding it"),y._selectedValues.toggle(l,P)):"remove"===o?y._selectedValues.isSelected(l,!0)?(r.log("filter is currently SELECTED, removing it"),y._selectedValues.toggle(l,P)):r.log("filter is currently NOT SELECTED, no action needed"):y._selectedValues.toggle(l,P)}}this._navimpl.getCache().setCriteriaToResetBeforeFilterChange(this.id(),I),this.updateProxyView(v),!0===t.warn?this.onRefine():window.richClient?this.onRefine({isInternal:!0}):this.onRefine({triggerProxyCB:!1}),e.is(i,"function")&&i(),a()}.bind(this))}.bind(this))},manageDuplicates:function(e,t){var i={};return e.forEach(function(e){var t=e.disptext?e.disptext:e.object,a=i[t];a?(UWA.is(a.object),a.object=[a.object],a.isComposite=!0,a.object.push(e.object)):i[t]=e}),Object.keys(i).map(function(e){return i[e]})},addLocalFilter:function(e){return r.log("Inside TaggerProxy#addLocalFilter"),this.setLocalFilter(e,void 0,"add")},removeLocalFilter:function(e){return r.log("Inside TaggerProxy#removeLocalFilter"),this.setLocalFilter(e,void 0,"remove")},updateTenantInfo:function(e){},eachTagValue:function(e,t){var i,a,n,s,o,r,l;this._alivePreCond();var c=t&&UWA.is(t.allTagsInheritingFromType,"string"),d=t&&UWA.is(t.allTagsOfType,"array")&&t.allTagsOfType.length>0,g=this.getHiddenPredicates(),h=t&&t.excludeHiddenPredicates&&g.length>0,u=function(e){var i=!0;return c?e.pred.isAKindOf(t.allTagsInheritingFromType)||(i=!1):d&&-1===t.allTagsOfType.indexOf(e.pred.id())&&(i=!1),i&&h&&(i=g.indexOf(-1!==e.pred.id())),i};if(this.hasSubjectsInEdition()){for(n=0,o=this._subjectsInEdition.length;n<o;n++)if(a=this._subjectsInEdition[n],this._tagValuesIdxForSubject[a])for(s=0,r=(l=this._tagValuesIdxForSubject[a]).length;s<r;s++)i=l[s],t?this._tagValuesMap[i]&&u(this._tagValuesMap[i])?e.call(this,this._tagValuesMap[i],1):this._subjectsTagValuesMap[a]&&this._subjectsTagValuesMap[a][i]&&u(this._subjectsTagValuesMap[a][i])&&e.call(this,this._subjectsTagValuesMap[a][i],1):this._tagValuesMap[i]?e.call(this,this._tagValuesMap[i],1):this._subjectsTagValuesMap[a]&&this._subjectsTagValuesMap[a][i]&&e.call(this,this._subjectsTagValuesMap[a][i],1)}else Object.keys(this._tagValuesMap).forEach(function(i){var a;0!==this._nbSubjects[i]&&(t?(a=this._tagValuesMap[i],u(a)&&e.call(this,a,this._nbSubjects[i])):e.call(this,this._tagValuesMap[i],this._nbSubjects[i]))}.bind(this));return this},getEachTagValueForPredicate:function(e,t){var i,a=this._predicateTagValuesMap[e];if(UWA.is(a),!t)return a;a.forEach(function(e){(i=this._tagValuesMap[e])?t(i,this._nbSubjects[i]):r.error("TaggerProxy#getEachTagValueForPredicate: "+e+" not found in _tagValuesMap")}.bind(this))},getTagValuesForPredicate:function(e){return this._predicateTagValuesMap[e]},updateSelectedTVLocalFilter:function(e,t,i,a){var n,s;return s=this._selectedValues.isEmpty(),n=this._selectedValues.toggle(t,a),this.updateProxyView(s,null,i),n},updateFreeInputs:function(e,t){var i,a,n=this._selectedValues.isEmpty();for(a=0,t.length;a<t.length;a++)i=t[a],this._selectedValues.removeFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls);for(this._navimpl.getCache().resetCriteriaToRemoveBeforeFilterChange(this.id()),a=0,e.length;a<e.length;a++)i=e[a],this._selectedValues.createFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls);this.updateProxyView(n,null,!1),this.onSearch()},createFreeInputs:function(e,t){var i,a,n=this._selectedValues.isEmpty();for(a=0,e.length;a<e.length;a++)i=e[a],this._selectedValues.createFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls);this.updateProxyView(n,null,!1),!1!==t&&this.onRefine()},removeFreeInputs:function(e,t){var i,a,n,s,o,r,l,c,d=!1,g=this._navimpl.getCache().getCriteriaToResetBeforeFilterChange(this.id()),h=this._selectedValues.isEmpty();for(a=0,e.length;a<e.length;a++)if(i=e[a],this._selectedValues.removeFreeInput(i.predicate.getFullPredicateID(!0),i.type,i.value,i.nls),n=i.predicate.getFullPredicateID().split("/").pop(),r=i.type,n&&g[n])if("boolean"===r)delete g[n];else if("string"===r){for(s=0,g[n].value.length;s<g[n].value.length;s++)if(g[n].value[s].value===i.value){d=!0;break}d&&(g[n].value.splice(s,1),0===g[n].value.length&&delete g[n]),-1!==(l=(c=i.predicate.getElemOptions())&&c.datasets&&c.datasets.items?c.datasets.items.map(function(e){return e.value}).indexOf(i.value):-1)&&!0===c.datasets.items[l].predefined&&delete c.datasets.items[l].predefined}else{for(o in i.value)g[n][o]&&delete g[n][o];1===Object.keys(g[n]).length&&delete g[n]}this.updateProxyView(h,null,!1),!1!==t&&this.onRefine()},hasLocalFilters:function(){var e=this.getFilters().localfilters;return this._selectedValues instanceof f?UWA.is(e.condition,"array")&&e.condition.length>0:0!==Object.keys(e).length},updateProxyView:function(e,t,i){var a=this._selectedValues.isEmpty(),n=this._navimpl.getFocusedProxy()===this;(a!==e||t)&&this.updateLocalFilterStatus({hasFilter:!a,isFocused:n});var s=this.hasLocalFilters();this._navimpl.getIconVisibleBool(this._widgetId)!==s&&(this._navimpl.setIconVisibleBool(this._widgetId,s),this._navimpl.dispatchEvent("UPDATE_ICON")),!1!==i&&this._navimpl.dispatchRedrawTagsEvent({event:"focus"}),t&&(n?(this.showEmbeddedTaggerView(),r.log("showing the embedded view")):(r.log("hiding the embedded view"),this.hideEmbeddedTaggerView()))},getCriteriaIdsMap:function(){return this._criteriaIdsMap},hasCriteria:function(){return 0!==Object.keys(this._criteriaIdsMap).length},colorize:function(t){var i=this;if(this.colorizeSupport&&t){t=e.extend({coloredSubjects:{}},t);var a=function(e){try{var a=n.getTagValue(e)}catch(e){r.error("Error in colorize")}i.getSubjectsFromTag(a).forEach(function(i){t.coloredSubjects[i]=e.color})};t.tagColors.forEach(function(e){e&&e.isComposite?e.object.forEach(function(t){var i=UWA.clone(e);i.object=t,a(i)}):a(e)}),this.triggerCallbackOfEvent(y.colorize,t)}},unColorize:function(){this.colorizeSupport&&this.triggerCallbackOfEvent(y.unColorize)},setColorMap:function(e){this._navimpl.setColorMap(e)},triggerCallbackOfEvent:function(e,t){var i;return this._alivePreCond(),(i=this._listenerOf[e])&&i.cb?i.cb.call(i.scope||void 0,t):void 0},onAddTagSuccess:function(e,t){for(var i,a,o,l=this,c=this.getEventData(e).subjects,d=this.getEventData(e).tags,g=0;g<d.length;g++)o={subjects:c,predicate:d[g].split("|")[0],object:d[g].split("|")[1]},this.triggerCallbackOfEvent(y.AddTag,o);for(var h in e){e[h].forEach(function(e){i=e.sixw;let o=a=e.object;-1!=a.indexOf(n.BELCHAR)&&(o=void 0,2==(a=a.split(n.BELCHAR)).length&&0==a[1].indexOf(n.COMMUNITY_TAG)&&(i=s.COMMUNITY_TAGS_PREDICATES[i].id()));var c=s.getPredicate(i);try{var d=n.getTagValue(c,o,a,c.getType(),!0)}catch(e){r.error("Error in createTagValue")}-1===l._tagValuesIdxForSubject[h].indexOf(d.fullid)&&l.addTagValueForSubject(h,d),l._explicitValues[c.getFullPredicateID()+a]=t})}this._navimpl.dispatchRedrawTagsEvent({event:"addTag"})},onDeleteTagSuccess:function(e,t){let i={},a=[],s=this._subjectsTagValuesMap[this._subjectsInEdition[0]],o=Object.keys(this._subjectsTagValuesMap[this._subjectsInEdition[0]]),r=e[this._subjectsInEdition[0]];o.forEach(e=>{let t=!1;for(let i=0;i<r.length;i++){let a=UWA.clone(s[e].uri);if(Array.isArray(a)&&(a=a.join(n.BELCHAR)),a===r[i].object&&s[e].pred.getFullPredicateID().includes(r[i].sixw)){t=!0;break}}t?a[e]=s[e]:i[e]=s[e]}),this._tagValuesIdxForSubject[this._subjectsInEdition[0]]=Object.keys(i),this._subjectsTagValuesMap[this._subjectsInEdition[0]]=i,this._navimpl.dispatchRedrawTagsEvent({event:"addTag"});let l={};l.subjects=Object.keys(e),e[l.subjects[0]].forEach(e=>{l.predicate=e.sixw,l.object=e.object,this.triggerCallbackOfEvent(y.RemoveTag,l)})},getEventData:function(e){var t=[],i=[];for(var a in e){t.push(a),e[a].forEach(function(e){i.push(e.sixw+"|"+e.object)})}return{subjects:t,tags:i.filter(function(e,t,i){return i.indexOf(e)===t})}},createTagOn3DSpace:function(e){if(this._dataSources){let t=this._dataSources[e];return UWA.is(t,"string")?"3DSpace"==t:UWA.is(t,"object")?"3DSpace"==t.serviceToPersistTags:this._hasPlatformData}return this._hasPlatformData},deleteTagValue:function(e,t,i){var a,o,l,c,d,g,h,u,p,f,m,v=0;if(this._alivePreCond(),!(t instanceof s))throw new Error("Invalid input arg");let T;t.isCommunityPredicate()&&(T=t.get6WRootFather()),l={subjects:[],predicate:T?T.id():t.id(),object:e},a={tag:[{subject:[],predicate:T?T.id():t.id(),object:{literal:Array.isArray(e)?e.join(n.BELCHAR):e}}]},o={tag:[{subject:[],predicate:T?T.id():t.id(),object:{literal:Array.isArray(e)?e.join(n.BELCHAR):e}}]};try{d=n.getTagValue(t,e,e)}catch(e){r.error("Error in deleteTagValue")}if(!this._tagValuesMap[d.fullid])return!1;for(u=0,f=this._subjectsInEdition.length;u<f;u++)c=this._subjectsInEdition[u],-1!==this._tagValuesIdxForSubject[c].indexOf(d.fullid)&&(this.createTagOn3DSpace(c)?o.tag[0].subject.push({uri:c}):a.tag[0].subject.push({uri:c}),l.subjects.push(c));if(g=function(a){if(this._explicitValues[t.getFullPredicateID()+e]&&delete this._explicitValues[t.getFullPredicateID()+e],0===--v){for(p=0,m=a.length;p<m;p++)c=a[p].uri,this.removeTagValueForSubject(c,d);i(),this.triggerCallbackOfEvent(y.RemoveTag,l)}}.bind(this),h=function(){0===--v&&i()}.bind(this),!0===this._persistTags){if(a.tag[0].subject.length>0)for(u in this._tagsServers)this._tagsServers[u].deleteTag(a,this._hasPlatformData,g,h),v+=1;if(o.tag[0].subject.length>0)for(u in this._cStorages)this._cStorages[u].deleteTag(o,this._hasPlatformData,g,h),v+=1}else a.tag[0].subject.length>0&&(v+=1,g(a.tag[0].subject)),o.tag[0].subject.length>0&&(v+=1,g(o.tag[0].subject));return this},addPLMUpdateListener:function(e,t){return this.addListener(y.PLMUpdate,e,t)},addRequestSuggestionsListener:function(e,t){return this.addListener(y.RequestSuggestions,e,t)},addFilterChangeListener:function(e,t){return this.addListener(y.FilterChange,e,t)},addCriteriaChangeListener:function(e,t){return this.addListener(y.CriteriaChange,e,t)},addTagCreationListener:function(e,t){return this.addListener(y.AddTag,e,t)},addTagDeletionListener:function(e,t){return this.addListener(y.RemoveTag,e,t)},addLocalFilterStatusListener:function(e,t){return this.addListener(y.UpdateLocalFilterStatus,e,t)},addInternalFilterChangeListener:function(e,t){return this.addListener(y.InternalFilterChange,e,t)},addUnfocusSubjectsListener:function(e,t){return this.addListener(y.UnfocusSubjects,e,t)},addColorizeListener:function(e,t){return this.addListener(y.colorize,e,t)},addOpenTaggerListener:function(e,t){return this.addListener(y.openTagger,e,t)},addCloseTaggerListener:function(e,t){return this.addListener(y.closeTagger,e,t)},addUpdateDisplayStatusListener:function(e,t){return this.addListener(y.updateDisplayStatus,e,t)},addUnColorizeListener:function(e,t){return this.addListener(y.unColorize,e,t)},addSortChangeListener:function(e,t){return this.addListener(y.SortChange,e,t)},addGroupingChangeListener:function(e,t){return this.addListener(y.GroupingChange,e,t)},addSelectInAppListener:function(e,t){return this.addListener(y.SelectInApp,e,t)},addLoadMoreTagsListener:function(e,t){return this.addListener(y.LoadMoreTags,e,t)},isPLMParameterEnabled:function(){return this.enablePLM},sendStringTypedForPLM:function(e){var t=this.getFilters();return t.PLMTitle=e,this.triggerCallbackOfEvent(y.PLMUpdate,t)},getParameters:function(){return this.parameters},addInfoMessageLinkClickListener:function(e,t){return this.addListener(y.handleMessageAction,e,t)},addCriteriaModifiedListener:function(e,t){return this.addListener(y.CriteriaModified,e,t)},addAdditionalFilterChangeListener:function(e,t){return this.addListener(y.AddFilterChange,e,t)},addFocusChangeListener:function(e,t){return this.addListener(y.AddFocusChange,e,t)}});return y.FilterChange=1,y.AddTag=2,y.RemoveTag=3,y.CriteriaChange=4,y.UpdateLocalFilterStatus=5,y.colorize=7,y.unColorize=8,y.PLMUpdate=9,y.openTagger=10,y.closeTagger=11,y.RequestSuggestions=12,y.SortChange=14,y.GroupingChange=15,y.SelectInApp=16,y.LoadMoreTags=17,y.updateDisplayStatus=21,y.InternalFilterChange=100,y.handleMessageAction=18,y.CriteriaModified=19,y.AddFilterChange=20,y.AddFocusChange=23,y}),define("DS/TagNavigator/TaggerProxyWithFilteringServices",["DS/TagNavigator/TaggerProxy","DS/TagNavigator/TaggerSettings","UWA/Class/Promise","DS/TagNavigator/Logger","UWA/Core"],function(e,t,i,a,n){"use strict";var s={},o=[];function r(t){var i,a,r,l,c,d,g,h,u,p,f,m,v,T,C,w,b,y,S,I,E,x,_=this;if(!(t instanceof e))throw new Error("Invalid input arg");x=t,u={},g={},d=[],E={},p={},f={},m={},v={},h=function(e,t){var i,a,n,s;return"string"!==(i=e.type)&&"integer"!==i&&"date"!==i&&"tree"!==i&&"double"!==i&&(i="string"),E[n=e.sixw]||(E[n]={}),E[e.sixw][i]||(E[e.sixw][i]={}),(a=E[e.sixw][i])[s=e.object]||(a[s]={}),E[e.sixw][i][s][t]={field:e.field,dispValue:e.dispValue,type:i,uri:e.object},this},I=function(e,t){return delete E[e.sixw][e.type][e.object][t],this},this.getTaggerProxy=function(){return x},this.id=function(){return x.id()},this.widgetId=function(){return x.widgetId()},this.supportsAdvancedFilter=function(){return x.supportsAdvancedFilter()},this.hasLocalFilters=function(){return x.hasLocalFilters()},this.addFilterSubjectsListener=function(e,t){u={cb:e,scope:t}},this.addTagCreationListener=function(e,t){p={cb:e,scope:t}},this.addTagDeletionListener=function(e,t){f={cb:e,scope:t}},this.addLocalFilterStatusListener=function(e,t){m={cb:e,scope:t}},this.addUnfocusSubjectsListener=function(e,t){v={cb:e,scope:t}},this.addColorizeListener=function(e,t){T={cb:e,scope:t}},this.addUnColorizeListener=function(e,t){C={cb:e,scope:t}},this.addGroupingChangeListener=function(e,t){w={cb:e,scope:t}},this.setColorMap=function(e){x.setColorMap(e)},this.setSubjectsTags=function(e,t){return x.hasPlatformData()||!1===t||b(e),S(e)},this.addSubjectsTags=function(e,t){return x.hasPlatformData()||!1===t||b(e),y(e)},y=function(e){for(var t in e)g[t]=g[t]||[],g[t]=g[t].concat(e[t]);return S(n.clone(g)),this},S=function(e){var t,i,n,s,o,r,l;for(n in _.unloadAllTags(),t=x.getFilters(),(i=0===Object.keys(t.allfilters).length)&&x.setTags(e),g=e,e)for(o=e[n],d.push(n),r=0,l=o.length;r<l;r++)s=o[r],h(s,n);return i||a(t),this},this.die=function(){return this.unloadAllTags(),x.die(!0),this},this.isAlive=function(){return x.isAlive()},this.isActive=function(){return x.isActive()},this.getNavImpl=function(){return x.getNavImpl()},this.focusOnSubjects=function(e,t,i){return"boolean"!=typeof t&&(t=!0),x.focusOnSubjects(e,t,i),this},this.getAllowedRootWForTagging=function(){return x.getAllowedRootWForTagging()},this.unfocus=function(){return x.unfocus(),this},this.activate=function(){x.activate()},this.deactivate=function(){x.deactivate()},this.activate=function(){x.activate()},this.toggleProxyFocus=function(e){x.toggleProxyFocus(e)},this.clearLocalFilter=function(e){x.clearLocalFilter(e)},this.setLocalFilter=function(e){x.setLocalFilter(e,function(){x.getNavImpl().dispatchEvent("UPDATE_ACTIVECRITERIA")})},this.updateLocalFilterStatus=function(e){x.updateLocalFilterStatus(e)},this.updateTaggerDisplayStatus=function(e){x.updateTaggerDisplayStatus(e)},this.unloadAllTags=function(){return x.unloadAllTags(),g={},d=[],E={},this},this.unsetTags=function(){this.unloadAllTags(),x.unsetTags()},this.notifyListenerOfFilterSubjects=function(e){return u&&u.cb&&u.cb.call(u?u.scope:void 0,{filteredSubjectList:e,hasFiltersTEMP:0!==Object.keys(x.getNavImpl().getFilters().allfilters).length}),this},this.getFilters=function(){return x.getFilters()},this.hasCriteria=function(){return x.hasCriteria()},b=function(e){var t,i=[];if(!x.hasPlatformData()){for(t in e)i.push({uri:t});0!==i.length&&(s[_.id()]={proxy:x,subjects:i,proxyWF:_}),o=o.concat(i)}},i=function(e){var t,i,a,n,s,o;for(i={sixw:e.predicate,object:e.object},a=0,n=(s=e.subjects).length;a<n;a++)t=s[a],g[t].push(i),h(i,t);return p&&(o=p.cb)&&o.call(p?p.scope:void 0,e),_},r=function(e){var t,i,a,n,s,o;for(i={sixw:e.predicate,object:e.object},s=0,o=(a=e.subjects).length;s<o;s++)t=a[s],n=g[t].indexOf(i),g[t].splice(n,1),I(i,t);return f&&(a=f.cb)&&a.call(f?f.scope:void 0,e),_},l=function(e){var t;return m&&(t=m.cb)&&t.call(m?m.scope:void 0,e),_},c=function(e){var t;return v&&(t=v.cb)&&t.call(v?v.scope:void 0,e),_};a=function(e){var t,i,a,s,o,r,l,c,h,u,p,f,m,v,T,C,w,b,y,S,I,N,V,P,D,O,M,U,F,W,R;for(o in t=e.allfilters,a=[],h=0,m={},p={},l={},t){for(u=t[o],o=A(o),l[o]||(l[o]={}),V=0,O=u.length;V<O;V++)if(b=(C=u[V]).object,E[o]){if("date"===C.type||"tree"===C.type||Array.isArray(b))for(N in F=E[o][C.type])S=F[N],R=C.object.toString(),N.substring(0,R.length)===R&&n.extend(m,S);else m=C.type?E[o][C.type][b]||{}:E[o][typeof C.object][b]||{};for(f in m)l[o][f]=1,p[f]||(p[f]=0),p[f]+=1;m={}}h++}if(0===h)a=d;else for(f in p)p[f]>=h&&a.push(f);for(c={},s={},P=0,M=a.length;P<M;P++)for(f=a[P],y=g[f],s[f]=y,D=0,U=y.length;D<U;D++)r=(C=y[D]).sixw+C.field+C.object+C.type,"string"!==(I=C.type)&&"integer"!==I&&"date"!==I&&"tree"!==I&&"double"!==I&&(I="string"),c[r]||(c[r]={object:C.object,sixw:C.sixw,field:C.field,dispValue:C.dispValue,count:0,type:I}),c[r].count+=1;for(o in W=function(e){return e.object===N},t)if("date"!==(u=t[o])[0].type)for(I in E[o])for(N in E[o][I])if(m=E[o][I][N],!u.detect(W))for(f in m)-1===a.indexOf(f)&&!Object.keys(t).some(function(e){return(e=A(e))!==o&&!l[e][f]})&&(w=m[f].uri,i=m[f].field,c[r=o+i+w]||(c[r]={object:w,sixw:o,field:i,dispValue:m[f].dispValue,count:0,type:m[f].type}),c[r].count+=1,s[f]||(s[f]=[]),s[f].push(c[r]));for(r in v=[],c)T=c[r],v.push(T);return _.notifyListenerOfFilterSubjects(a),x.setTags(s,v),!1};var A=function(e){return e.contains("CompanyTag")&&(e=e.slice(e.indexOf("/")+1)),e};return x.addListener(e.FilterChange,a,this),x.addListener(e.AddTag,i,this),x.addListener(e.RemoveTag,r,this),x.addListener(e.UpdateLocalFilterStatus,l,this),x.addListener(e.UnfocusSubjects,c,this),x.addListener(e.colorize,function(e){T&&T.cb&&T.cb.call(T.scope,e)},this),x.addListener(e.unColorize,function(){C&&C.cb&&C.cb.call(C.scope)},this),x.addListener(e.GroupingChange,function(){w&&w.cb&&w.cb.call(w.scope)},this),this}return r.getSubjectsForExplicitTags=function(){return o},r.clearProxiesTemp=function(){o=[],s={}},r.getExplicitTags=function(){if(!0===t.getOption("offline6W"))return a.warn("TaggerProxyWithFilteringServices: No explicit tags to be fetched."),[];var e,n,r,l,c,d=[];if(Object.keys(s).length)for(e in n=s[Object.keys(s)[0]].proxy.getTagsServers(),r={tag:[{subject:o}]},l=function(e,t,i){if(e){var a,n,o,r,l,c,d,g,h,u,p,f,m,v,T={},C={};if((e=JSON.parse(e)).data.length){for(a=0,r=e.data.length;a<r;a++)for(n=0,l=e.data[a].tag.length;n<l;n++){for(C[c=e.data[a].subject.uri]=C[c]||[],d=e.data[a].tag[n].object.literal,g=e.data[a].tag[n].predicate,h=!0,o=0;o<C[c].length;o++)T=C[c][o],h=!!h&&(T.object!==d||T.sixw!==g);h&&(g.includes("CompanyTag")&&(d=d.split("_BELCHAR_")),C[c].push({object:d,sixw:g,dispValue:d}))}for(u in s){for(p=s[u].subjects,f={},n=0;n<p.length;n++)if(C[p[n].uri])for(f[p[n].uri]=C[p[n].uri],a=0;a<C[p[n].uri].length;a++)v=C[p[n].uri][a].sixw,m=C[p[n].uri][a].object,s[u].proxyWF.getTaggerProxy()._explicitValues[v+m]=t;Object.keys(f).length&&s[u].proxyWF.addSubjectsTags(f,!1)}}}i("ExplicitTags OK")},n)c=new i(function(t){n[e].getExplicitTag(r,l,t)}),d.push(c);return d},r}),define("DS/TagNavigator/simplified/utils/ColorUtils",["UWA/Core","UWA/Class","DS/TagNavigator/Logger","DS/SNInfraUX/TaggerConfigAccess"],function(e,t,i,a){return t.singleton({init:function(){this.colorPromiseFromTenants={}},retrieveAdminColors:function(e){return this.colorPromiseFromTenants[e]||(this.colorPromiseFromTenants[e]=new Promise(function(t){a.get6WTagsColorsConfiguration({tenantID:e}).then(function(a){UWA.is(a,"object")?(i.log(`Retrieved admin colors from tenant ${e}:`,a),t(a)):(i.warn(`Invalid object type from tenant ${e}:`,a),t({}))},function(){i.error(`Error while retrieving colors from ${e}:`,colorMapObj),t({})})})),this.colorPromiseFromTenants[e]},getColorPromisesForTenants:function(e){var t=e.getProxiesToDisplay().map(function(e){return e.getTenant()});t=[...new Set(t)];var i=[];for(var a of t)a&&i.push(this.retrieveAdminColors(a));return i}})}),define("DS/TagNavigator/Suggestions",["UWA/Class","UWA/Core","UWA/Element","DS/UIKIT/Autocomplete","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n){"use strict";return e.singleton({init:function(){var e={},t=null,i=null,a=null,n=null;this.getSuggestionsFromServers=function(s){var o;s.tagsServers,a=s.pred,i=s.tenants&&s.tenants.length?s.tenants[0]:null,n=s.autocomplete,o=function(i,a,s){var o,r,l={};if(e[i+a]={},s&&Object.keys(s).length){for(l={name:i+a,items:[]},o=0,r=(s=s.literalInfo).length;o<r;o++)s[o].value&&l.items.push({value:s[o].value});l.items.sort(function(e,t){return(e.label||e.value).toLowerCase()<(t.label||t.value).toLowerCase()?-1:(e.label||e.value).toLowerCase()>(t.label||t.value).toLowerCase()?1:0}),t&&n.removeDataset(t),e[i+a]=l,t=i+a,n.addDataset(e[i+a])}},i&&a&&n&&(t&&n.removeDataset(t),e[i+a]?(t=i+a,Object.keys(e[t]).length&&n.addDataset(e[t])):s.tagsServers[i].getVocabularySuggestions(i,a,o))}}}).init()}),define("DS/TagNavigator/TagWidget/freeInput/BooleanInputView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Select","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"tnw add-tag-cont",_input:void 0,isFreeInput:function(){return!0},setup:function(e){this._parent(e),this._predicate=e.predicate},render:function(){return this._parent(),this.draw()},draw:function(){let e=this.getOption("navImpl"),t=this,n=this.getOption("type"),s={},o=e.getCache(),r=e.getFocusedProxy(),l=o.getCriteriaToResetBeforeFilterChange(r?r.id():void 0),c=o.getCriteriaToRemoveBeforeFilterChange(r?r.id():void 0);s.onChange=function(i){var s={value:this.getValue()[0],label:"true"===this.getValue()[0]?a.getText("yes"):a.getText("no")};s?(e.updateFreeInputs([{predicate:t._predicate,value:s.value,type:n,nls:s.label}],[{predicate:t._predicate,value:"true"===this.getValue()[0]?"false":"true",nls:"true"===this.getValue()[0]?a.getText("no"):a.getText("yes"),type:n}]),t.dispatchEvent("criteriaSelected")):(l[t._predicate.id()]&&c.push({predicate:t._predicate,value:l[t._predicate.id()].value.value,nls:l[t._predicate.id()].value.label,type:n}),s?l[t._predicate.id()]={value:s,type:n}:delete l[t._predicate.id()])};var d=l[t._predicate.id()]?l[t._predicate.id()].value.value:null;if(t._input=new i({placeholder:a.getText("selectValue"),options:[{value:"true",label:a.getText("yes"),selected:"true"===d},{value:"false",label:a.getText("no"),selected:"false"===d}],events:s.onChange?s:{}}),l[t._predicate.id()]){var g=l[t._predicate.id()].value||[];if(0!==g.length){t._input.addItems(g,{items:[]});for(let e=0;e<g.length;e++)g[e].pending&&delete g[e].pending}}return t._input.inject(this.container),this},destroy:function(){this._input&&(this._input.destroy(),this._input=void 0),this._parent()}})}),define("DS/TagNavigator/TagWidget/freeInput/StringInputView",["UWA/Core","UWA/Class/View","DS/UIKIT/Autocomplete","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger"],function(e,t,i,a,n){"use strict";return t.extend({tagName:"div",className:"tnw add-tag-cont",_input:void 0,isFreeInput:function(){return!0},setup:function(e){this._parent(e),this._predicate=e.predicate},render:function(){return this._parent(),this.draw()},draw:function(){let e=this.getOption("navImpl"),t=this,s={},o=e.getCache(),r=e.getFocusedProxy(),l=o.getCriteriaToResetBeforeFilterChange(r?r.id():void 0);o.getCriteriaToRemoveBeforeFilterChange(r?r.id():void 0);s.onKeyDown=function(e){if(-1===[8,46].indexOf(e.keyCode)||this.options.multiSelect||!e.target.value)return!1;this.options.events.onUnselect.call(this,this.selectedItems[0])},s.onKeyUp=function(e){var i,a=[];if(-1!==[8,46].indexOf(e.keyCode))return!1;if(13!==e.keyCode||e.target.value)return!1;for(i=0;i<this.getSelection().length;i++)a.push({predicate:t._predicate,value:this.getSelection()[i].value,type:"string"});r.createFreeInputs(a),t.dispatchEvent("criteriaSelected")},s.onSelect=function(e){"ds6w:dataSource"==t._id&&Mask.mask(pvWithUiElemInSuggested["ds6w:type"].criterion.string.elements.container);var i=this.getSelection();"string"==typeof i&&(i=void 0!==e?[e]:[]),"string"==typeof i[i.length-1]&&i.pop(),i.length>0?l[t._predicate.id()]={value:i,type:"string"}:delete l[t._predicate.id()]},s.onUnselect=function(e){if(!this.opened){var i=this.getSelection();"string"==typeof i[i.length-1]&&i.pop(),i.length>0?l[t._predicate.id()]={value:i,type:"string"}:delete l[t._predicate.id()],r.removeFreeInputs([{predicate:t._predicate,type:"string",value:e.value}])}};var c={showSuggestsOnFocus:!0,placeholder:a.getText("typestring"),multiSelect:!0,allowFreeInput:!0,noResultsMessage:!1,events:s},d=i.extend({onClickOutside:function(){var e;if(this.elements.input&&(e=this.elements.input.value),UWA.is(e,"string")&&e.length>0){n.log("Input freetext: "+e);var t=e.replace(/\||\n/g,"\t").replace(/^\s+|\s+$/g,"").split("\t").map(function(e){return e.trim()}).filter(function(e,t,i){return i.indexOf(e)===t}).map(function(e){return{value:e,selected:!0}});this.addItems(t,{items:[]})}this._parent()}});if(t._input=new d(c),t._input.elements.input.onpaste=function(e){var t;if(e.preventDefault(),e.clipboardData&&UWA.is(e.clipboardData.getData,"function")?t=e.clipboardData.getData("text/plain"):window.clipboardData&&UWA.is(window.clipboardData.getData,"function")&&(t=window.clipboardData.getData("text")),UWA.is(t,"string")){var i=t.replace(/^\s+/g,"").replace(/\||\n|\r\n|\t/g,"\t").split("\t").filter(function(e,t,i){if(""!=e)return i.indexOf(e)===t}).map(function(e){return{value:e,selected:!0}});this.addItems(i,{items:[]})}}.bind(t._input),l[t._predicate.id()]){var g=l[t._predicate.id()].value||[];if(0!==g.length){t._input.addItems(g,{items:[]});for(let e=0;e<g.length;e++)g[e].pending&&delete g[e].pending}}return t._input.inject(this.container),this},destroy:function(){this._input&&(this._input.destroy(),this._input=void 0),this._parent()}})}),define("DS/TagNavigator/simplified/views/PersonView",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/Tooltip","DS/TagNavigator/simplified/views/PersonPredicateView","DS/TagNavigator/simplified/utils/PersonUtils","text!DS/TagNavigator/assets/templates/PersonViewTemplate.html","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Predicate","DS/TagNavigator/simplified/actions/ActionUtils","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s,o,r,l,c,d,g){"use strict";return t.extend({tagName:"li",className:"people-view",template:i.compile(o),_tooltip:void 0,domEvents:{"click div.people-template":"clickOnPerson","click .people-filter":"togglePredicateListView",contextmenu:"onContextMenuOpen",touchstart:"startTheTimer",touchend:"stopTheTimer"},init:function(e){this._parent(e),this.hideTagsCount=this.getOption("hideTagsCount")},setup:function(e){this._parent(e)},updateImageCB:void 0,updateSubTitleCB:void 0,render:function(){var e=this.template();return this.container.setContent(e),this.navImpl=this.getOption("navImpl"),this.addContent(),this.getOption("expandable")&&(this.container.addClassName("expandable"),this.container.getElement(".people-filter").setStyle("display","block")),this.personInfo=this.model.get("personInfo"),this.personInfo&&(this.updateImageCB=this.updateImage.bind(this),this.personInfo.addEvent("onChange:imageURL",this.updateImageCB),this.updateSubTitleCB=this.updateSubTitle.bind(this),this.personInfo.addEvent("onChange:country",this.updateSubTitleCB)),this.personPredicateView=null,this.listenTo(this.model,"onHideView",this.onHideView.bind(this)),this.listenTo(this.model,"onShowView",this.onShowView.bind(this)),this._tooltip=new a({position:"bottom",target:this.container.getElement(".people-template"),body:this.model.get("title"),className:"person-tooltip"}),this.contextMenu=this.getOption("contextMenu"),this},updateExcludeIcon:function(t){if(t)this.model.set("isExcluded",!0),e.createElement("span",{class:"fonticon fonticon-block"}).inject(this.container.getElement(".item-label"),"before");else{this.model.set("isExcluded",!1);var i=this.container.getElement(".fonticon-block");i&&i.remove()}},excludeTag:function(e){let t=this.getOption("hasAdvancedFocsuedProxy")(s.PERSON_REFINE);this.updateExcludeIcon(e);var i=this.getOption("getTaggerView")(),a=i?i.actionManager.getCurrentAction():void 0;let n=this.model.getUniqueTagValuesPerPredicate();if(t&&this.getOption("expandable")){let t=s.buildCondition(this.model,null,e);a?a.id===d.ACTION_SELECT&&Object.keys(n).length&&(UWA.is(e,"boolean")||this.updateExcludeIcon(isExcluded),a.onPersonSelection({view:this,isComplex:!0,refineData:t,isExcluded:e})):!this.isSelected()&&e?this.navImpl.toggleComplexTagSelection(t,!0,e):e?this.navImpl.excludeTag(t):this.navImpl.undoExcludeTag(t)}else{let t=c.getPredicate(Object.keys(n)[0]).getFullPredicateID(),i=this.model.getRefineStructure(t);a?a.id===d.ACTION_SELECT&&1===Object.keys(n).length&&this.onPredicateSelection({currentPredicate:c.getPredicate(Object.keys(n)[0]).getFullPredicateID()},void 0,e):this.isSelected()?e?this.navImpl.excludeTag(i):this.navImpl.undoExcludeTag(i):this.navImpl.toggleTagSelection(i,!0,e)}},onHideView:function(){this.hide()},onShowView:function(){this.show()},updateImage:function(){this.container.getElement("img").setAttributes({src:this.model.getImage()})},updateSubTitle:function(){var e=this.container.getElement(".sub-label"),t=this.model.getCountry();if(1===this.model.getNbMatches()&&1===t.length&&t[0]){var i,a=t[0].split(".");2==a.length&&(i=r.getTagValueNls(a[0],a[1])),i?e.setText(i):e.setText(t[0]),e.setStyle("display","block")}else e.setText(""),e.setStyle("display","none")},isExcluded:function(){let e=this.getOption("hasAdvancedFocsuedProxy")(s.PERSON_REFINE),t=!1;var i=this.model.getUniqueTagValuesPerPredicate();if(e&&this.getOption("expandable")){let i=s.getExistingCondition(e,this.model.get("title"));return i&&i.excluded?i.excluded:t}if(1===Object.keys(i).length){let e=i[Object.keys(i)[0]][0];t=this.navImpl.isExcluded(JSON.stringify(this.model.getRefineStructure(e.pred.getFullPredicateID())))}return t},onContextMenuOpen:function(e){var t=this.getOption("getTaggerView")();let i=void 0;var a=this.model.getUniqueTagValuesPerPredicate();a[Object.keys(a)[0]][0];if(t&&(i=t.actionManager?t.actionManager.getCurrentAction():void 0),this.navImpl.hasExcludeSupport()){e.preventDefault();this.contextMenu.dropdown&&(this.contextMenu.dropdown.destroy(),this.contextMenu.dropdown=null);let t=[];this.model.get("isExcluded")?t.push({text:l.getText("unexludeTag"),fonticon:"block",id:"include"}):t.push({text:l.getText("excludeTag"),fonticon:"block",id:"exclude"}),i?i.id==d.ACTION_SELECT&&this.contextMenu.createDropdown({cont:this.container,target:this.container,view:this,items:t,evtObj:{pageX:e.x,pageY:e.y}}):this.contextMenu.createDropdown({cont:this.container,target:this.container,view:this,items:t,evtObj:{pageX:e.x,pageY:e.y}}),console.log("in dropdown")}return!1},startTheTimer:function(e){this.touchStartTimeStamp=e.timeStamp},stopTheTimer:function(e){let t=e.timeStamp-this.touchStartTimeStamp;console.log("Press Time = "+t),t>=3e3&&this.onContextMenuOpen(e)},isSelected:function(){return this.container.getElement("div.people-template").hasClassName("people-selected")},setAsSelected:function(){this.container.getElement("div.people-template").addClassName("people-selected")},setAsUnselected:function(){this.container.getElement("div.people-template").removeClassName("people-selected")},isSelectedForAction:function(e){return this.container.getElement("div.people-template").hasClassName(e)},setAsSelectedForAction:function(e){this.container.getElement("div.people-template").addClassName(e)},setAsUnselectedForAction:function(e){this.container.getElement("div.people-template").removeClassName(e)},getSelectedPredicatesCount:function(){var e=this.getOption("hasAdvancedFocsuedProxy")(s.PERSON_REFINE);if(e)return s.getActivePredicates(e,this.model.get("title")).length;var t=0,i=this.model.getUniqueTagValuesPerPredicate();for(var a in i){var n=i[a][0];this.navImpl&&this.navImpl.isSelected(JSON.stringify(this.model.getRefineStructure(n.pred.getFullPredicateID())))&&t++}return t},setAsExpanded:function(){this.showPredicateListView()},addContent:function(){this.updateImage(),this.container.getElement(".people-filter").setAttributes({title:this.model.get("title")}),this.updateExcludeIcon(this.isExcluded()),this.container.getElement(".item-label").setText(this.model.get("title"));var e=this.model.getCount();(this.hideTagsCount?this.container.getElement(".item-count").setText(""):e.exactCount?this.container.getElement(".item-count").setText(this.getOption("preciseCount")?e.count:l.convertToUnity(e.count)):this.container.getElement(".item-count").setText(l.getText("atleast")+" "+(this.getOption("preciseCount")?e:l.convertToUnity(e))),this.updateSubTitle(),this.getOption("expandable"))&&((e=this.getSelectedPredicatesCount())>0&&this.container.getElement(".people-filter").setAttributes({"data-badge":e}));if(this.getOption("color")){var t=this.getOption("color");this.container.addClassName("colorize"),this.container.getElement("img").setStyle("border","5px solid "+t),this.container.getElement("img").setAttributes({color:t})}var i=this.getOption("getTaggerView")();if(i){var a=i.actionManager?i.actionManager.getCurrentAction():void 0;a&&a.id===d.ACTION_COLORIZE&&this.container.hasClassName("colorize")&&this.container.addClassName("picked-for-colorize")}let n=this.model.get("title"),s=c.getPredicate(Object.keys(this.model.getUniqueTagValuesPerPredicate())[0]).getFullPredicateID(),o=this;this.navImpl.getTagPinnedFromCurrentContext().forEach(function(e){let t=JSON.parse(e.predicate);t.predicate===s&&n===t.object&&o.container.addClassName("disabled-tag")})},togglePredicateListView:function(){var e=!1;this.personPredicateView?this.personPredicateView.container.isHidden()?this.personPredicateView.show():this.personPredicateView.hide():(e=!0,this.showPredicateListView()),s.setExpandStatus(this.model.get("title"),e)},clickOnPerson:function(e){if(this.navImpl.hasProxiesInEdition())console.warn("Refine not possible when subject is in focus");else{if(this.getOption("expandable")&&e&&e.target.hasClassName("people-filter"))return;if(this.getOption("hasAdvancedFocsuedProxy")(s.PERSON_REFINE)&&this.getOption("expandable")){var t=!0;if(e&&e.ctrlKey&&e.altKey)return!1;var i=s.buildCondition(this.model),a=this.getOption("getTaggerView")(),n=a?a.actionManager.getCurrentAction():void 0;if(e&&e.ctrlKey||n&&(n.id===d.ACTION_SELECT||n.id===d.ACTION_EDITTAGREL))t=!1,n||(n=a.startSelectAction()),n.onPersonSelection({view:this,refineData:i,isComplex:!0});else if(n&&n.id===d.ACTION_GROUP){t=!1;let e=!!a&&a.isMaximized;n.onPersonSelection({view:this,refineData:i,isComplex:!0},e)}else if(n&&n.id===d.ACTION_SELECTINAPP)t=!1,n.onPersonSelection({view:this,refineData:i,isComplex:!0});else if(n&&n.id===d.ACTION_EXCLUDE)t=!1,i=s.buildCondition(this.model,null,!0),n.onPersonSelection({view:this,refineData:i,isComplex:!0});else{if(n&&n.id===d.ACTION_COLORIZE)return void n.onPersonSelection({view:this,refineData:i,isComplex:!0,model:this.model});this.navImpl.toggleComplexTagSelection(i)}t&&this.getOption("setSpinner")()}else{var o=this.model.getUniqueTagValuesPerPredicate();1===Object.keys(o).length&&this.onPredicateSelection({currentPredicate:c.getPredicate(Object.keys(o)[0]).getFullPredicateID()},e)}let r=c.getPredicate(Object.keys(this.model.getUniqueTagValuesPerPredicate())[0]).getFullPredicateID();this.trackPersonRefine(r)}},trackPersonRefine:function(e){setTimeout(()=>{let t=e.split("/"),i={pd1:t[t.length-1],pd2:t[0]};g.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnTag",persDim:i}})})},showPredicateListView:function(){var e=this;this.personPredicateView=new n({model:this.model,navImpl:this.navImpl,hasAdvancedFocsuedProxy:this.getOption("hasAdvancedFocsuedProxy"),setAsSelected:function(){e.setAsSelected()},hideTagsCount:e.hideTagsCount}).render().inject(this.container),this.personPredicateView.show(),this.personPredicateView.addEvent("onPredicateSelection",this.onPredicateSelection.bind(this))},onPredicateSelection:function(e,t,i){var a=this.navImpl;if(a)if(a.hasProxiesInEdition())console.warn("no refine possible when focused on subjects");else{var n=!0,o=this.getOption("hasAdvancedFocsuedProxy")(s.PERSON_REFINE),r=this.getOption("getTaggerView")(),l=r?r.actionManager.getCurrentAction():void 0;if(UWA.is(i,"boolean")||this.updateExcludeIcon(i),o&&this.getOption("expandable")){if(t&&t.ctrlKey&&t.altKey)return!1;if(t&&t.ctrlKey||l&&(l.id===d.ACTION_SELECT||l.id===d.ACTION_EDITTAGREL))n=!1,l||(l=r.startSelectAction()),l.onPersonSelection({view:this,isComplex:!0,selectedPredicates:e.activePredicates,isExcluded:i});else if(l&&l.id===d.ACTION_GROUP){n=!1;let t=!!r&&r.isMaximized;l.onPersonSelection({view:this,isComplex:!0,selectedPredicates:e.activePredicates},t)}else if(l&&l.id===d.ACTION_EXCLUDE)n=!1,l.onPersonSelection({view:this,isComplex:!0,selectedPredicates:e.activePredicates});else{if(l&&l.id===d.ACTION_COLORIZE)return void l.onPersonSelection({view:this,refineData:e.activePredicates,model:this.model,isComplex:!0});if(s.getExistingCondition(o,this.model.get("title"))){var c=s.buildCondition(this.model);o.getLocalFilter().toggle(c)}if(e.activePredicates.length>0){var g=s.buildCondition(this.model,e.activePredicates);o.getLocalFilter().toggle(g)}a.onRefine()}}else{if(t&&t.ctrlKey&&t.altKey)return!1;var h=this.model.getRefineStructure(e.currentPredicate);if(t&&t.ctrlKey||l&&(l.id===d.ACTION_SELECT||l.id===d.ACTION_EDITTAGREL))n=!1,l||(l=r.startSelectAction()),l.onPersonSelection({view:this,refineData:h,isComplex:!1,isExcluded:i});else if(l&&l.id===d.ACTION_GROUP){n=!1;let e=!!r&&r.isMaximized;l.onPersonSelection({view:this,refineData:h,isComplex:!0},e)}else if(l&&l.id===d.ACTION_EXCLUDE)n=!1,l.onPersonSelection({view:this,refineData:h,isComplex:!1});else if(l&&l.id===d.ACTION_SELECTINAPP)n=!1,l.onPersonSelection({view:this,refineData:h,isComplex:!1,model:this.model});else{if(l&&l.id===d.ACTION_COLORIZE)return void l.onPersonSelection({view:this,refineData:h,isComplex:!1,model:this.model});a.getFocusedProxy()||a.dispatchEvent("onBeforeGlobalFilterChange"),a.toggleTagSelection(JSON.stringify(h))}}n&&this.getOption("setSpinner")()}},toggleGrouping:function(){let e=this.container.hasClassName("grouped-by");this.container.toggleClassName("grouped-by",!e),this.container.getElement(".people-template").toggleClassName("people-selected",!e)},destroy:function(){this.personPredicateView&&this.personPredicateView.destroy(),this._tooltip.destroy(),this.stopListening(),this.personInfo&&(this.personInfo.removeEvent("onChange:imageURL",this.updateImageCB),this.personInfo.removeEvent("onChange:country",this.updateSubTitleCB)),this.model=null,this.updateImageCB=null,this.updateSubTitleCB=null,this.contextMenu.dropdown&&this.contextMenu.dropdown.destroy(),this.touchStartTimeStamp&&(this.touchStartTimeStamp=null),this._parent()}})}),define("DS/TagNavigator/simplified/views/PersonListView",["UWA/Core","UWA/Class/View","DS/TagNavigator/simplified/views/PersonView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/TagValue","DS/TagNavigator/Logger","DS/TagNavigator/TaggerNLS","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Predicate","DS/TagNavigator/UserSettings","DS/MessageBus/MessageBus","DS/TagNavigator/simplified/views/ContextMenu"],function(e,t,i,a,n,s,o,r,l,c,d,g){"use strict";return t.extend({tagName:"div",className:"people-list-div",personViewList:void 0,personModelList_global:void 0,init:function(e){this.personViewList=[],this._parent(e);var t=this.getOption("taggerView");this.navImpl=this.getOption("navImpl")||t.getObservedNavigator(),this.hideTagsCount=!1},setup:function(e){this._parent(e)},render:function(){this.ulList=e.createElement("ul",{class:"people-list"}).inject(this.container),this.moreDiv=e.createElement("div",{class:"show-more-container",id:"show-more-people",html:[{tag:"div",class:"show-more"}]}).inject(this.container).show(),this.moreDiv.addEventListener("click",this.clickOnShowMore.bind(this));var t=this.getOption("taggerView");return this.contextMenu=t?t.contextMenu:new g,this},getPredicateId:function(){return this.getOption("predicates")[0]},hasEmbeddedTagger:function(){return this.navImpl.hasEmbeddedView()},clickOnShowMore:function(e){let t=(e.target.getClosest(".predicate")||e.target.getClosest(".section.ds6w-root-predicate")).getElements(".picked"),i=[];t.forEach(e=>{i.push(e.getElement(".item-label").getText())}),this.navImpl.clickOnMoreButton(this.getPredicateId()),this.updatePeopleList(this.navImpl),this.personViewList.filter(e=>i.includes(e.getElement(".item-label").getText())).forEach(e=>{e.container.addClassName("picked"),e.getElement(".people-template").addClassName("people-selected")}),d.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnViewMore",persDim:{pd1:this.getPredicateId()}}})},getFullPredicateId:function(){var e=this.getPredicateId();return l.getPredicate(e).getFullPredicateID(e)},redraw:function(e){var t=this;e&&(t.hideTagsCount=e.hideTagsCount);var i,n=this.navImpl;if(this.hasAdvancedFocsuedProxy=this.getOption("hasAdvancedFocsuedProxy"),"person"==this.getPredicateId()){let e=[l.ROOT_WHO,l.getCommunityTagPredicate(l.ROOT_WHO).id(),l.getCompanyTagPredicate(l.ROOT_WHO).id(),l.getAutoCompanyTagPredicate(l.ROOT_WHO).id()];i=this._getPreferredPredicates(this.hasAdvancedFocsuedProxy(n,a.PERSON_REFINE)).filter(function(t){return-1==e.indexOf(t)})}else i=this.getOption("predicates");var s=[];("string"==typeof i||Array.isArray(i)&&i.length>0)&&(s=a.getUsersInfo(n,i));var r={};0==s.length&&(r.isEmpty=!0),this.hasEmbeddedTagger()?c.getUserInfo().then(function(e){t.me=e.firstname+" "+e.lastname;for(var i=0;i<s.length;i++)if(t.me&&t.me==s[i].get("title")){s[i].set("title",o.getText("me")),t.meInfoModel=s[i];break}t._internalRedraw(r,s)}):this._internalRedraw(r,s)},_internalRedraw:function(e,t){var i=this.getSearchString();if(i){var a=i.toLowerCase();this.personModelList_global=t.filter(function(e){if(-1!==e.get("title").toLowerCase().indexOf(a))return e})}else this.personModelList_global=t;if(0!==this.personModelList_global.length||e.isEmpty||(e.hasNoResults=!0),this.sortPersonListView(),this.updatePeopleList(this.navImpl),"person"==this.getPredicateId()){if(this.personModelList_global.length>0){var n=this.container.getClosest(".predicate");n&&(n.show(),n.getElement(".predicate-header .predicate-count").setText(this.personModelList_global.length))}var s=this.getOption("taggerView");s&&s.dispatchEvent("onFlattenedPersonListStatusUpdate",e)}},setSearchString:function(e){this.searchString=e},getSearchString:function(){return this.searchString?this.searchString:this.navImpl.getCache().getSearchValue()},getTotalNumberOfTags:function(){return this.personModelList_global?this.personModelList_global.length:0},sortPersonListView:function(){var e=this.getCurrentSort();if("alphaSort"==e.sortMode)e.order?this.personModelList_global=this.personModelList_global.sort(function(e,t){return e.get("title").localeCompare(t.get("title"))}):this.personModelList_global=this.personModelList_global.sort(function(e,t){return t.get("title").localeCompare(e.get("title"))});else if("nbSort"==e.sortMode&&!this.hideTagsCount){var t,i,a=function(e,a){let n=e.getCount(),s=a.getCount();t=n.exactCount?n.count:n,i=s.exactCount?s.count:s};e.order?this.personModelList_global=this.personModelList_global.sort(function(e,n){return a(e,n),t-i||e.get("title").localeCompare(n.get("title"))}):this.personModelList_global=this.personModelList_global.sort(function(e,n){return a(e,n),i-t||e.get("title").localeCompare(n.get("title"))})}},setCurrentSort:function(e){this.sort=e},getCurrentSort:function(){return this.sort?this.sort:this.navImpl.getCache().getCurrentSort("ds6w:who/"+this.getPredicateId())},_getPreferredPredicates:function(e){var t;return e&&(t=e.hasRelevantPredicates()),t.filter(function(e){var t=l.getPredicate(e);if(t)return"ds6w:who"==t.get6WRootFather().id()})},updatePeopleList:function(e){var t=this;let n=this.getOption("noShowMore");this.destroyPersonView();let s=this.getOption("taggerView"),r=e.getProxiesToDisplay();if(r.length&&r.some(e=>e.isFeatureSupported("grouping")))var l=function(t,i){return e.isGroupedBy(h,t,i)}.bind(this);var c=this.getOption("hasAdvancedFocsuedProxy")(e,a.PERSON_REFINE);if(UWA.is(this.personModelList_global,"array")&&this.personModelList_global.length>0){var d,g=!(!this.hasAdvancedFocsuedProxy(e,a.PERSON_REFINE)||"person"!=this.getPredicateId())||this.getOption("expandablePerson"),h=this.getPredicateId(),u=this.getFullPredicateId(h),p=n?this.personModelList_global.length:e.getMoreLimitForPredicate(h),f=e.getCache().colorManager.isColorized(this.getFullPredicateId());this.hasEmbeddedTagger()&&this.getLoggedInPersonModel();for(var m=this.personViewList.length;m<this.personModelList_global.length&&m<p;m++){var v=this.personModelList_global[m];if(f)var T=v.get("tagValues"),C=e.getCache().colorManager.getColorForTagValue(T[0]);if(d=new i({model:v,navImpl:e,hasAdvancedFocsuedProxy:function(i){return t.getOption("hasAdvancedFocsuedProxy")(e,i)},setSpinner:function(){s&&s.setSpinner()},expandable:!(!this.hasAdvancedFocsuedProxy(e,a.PERSON_REFINE)||"person"!=this.getPredicateId())||this.getOption("expandablePerson"),getTaggerView:function(){return s},color:C||null,contextMenu:this.contextMenu,hideTagsCount:this.hideTagsCount}).render().inject(this.ulList),c)if(u==a.PERSON_REFINE_PREDICATE){var w=a.getActivePredicates(c,v.get("title")),b=v.getUniqueTagValuesPerPredicate(),y=[];for(var h in b){var S=b[h];y.push(S[0])}for(var I=0,E=0;E<y.length;E++){var x=y[E];-1!==w.indexOf(x.pred.getFullPredicateID())&&I++}I===y.length&&d.setAsSelected()}else e.isSelected(JSON.stringify(v.getRefineStructure()))&&d.setAsSelected();else(e.isSelected(JSON.stringify(v.getRefineStructure()))||l&&l(v.get("title")))&&(d.setAsSelected(),l&&l(v.get("title"))&&d.container.addClassName("grouped-by"));g&&1==v.get("expandStatus")&&d.setAsExpanded();var _=d.getElement(".item-count").getDimensions().width;d.getElement(".item-label").setStyle("width","calc(100% - "+(_+40)+"px)"),this.personViewList.push(d)}this.getOption("noShowMore")||(this.personModelList_global.length>7&&this.personViewList.length<this.personModelList_global.length?(this.moreDiv.show(),this.moreDiv.getElement(".show-more").setText(o.getText("showMore")+" ["+(this.personModelList_global.length-p)+"]").show()):this.moreDiv.hide())}},clearAllFilters:function(){let e=this;this.navImpl&&!this.navImpl.getFocusedProxy()&&this.navImpl.dispatchEvent("onBeforeGlobalFilterChange"),this.personViewList.filter(t=>{if(t.isSelected()){let i=t.model.getRefineStructure();e.navImpl.toggleTagSelection(i,!1)}}),this.navImpl.onRefine()},getLoggedInPersonModel:function(){var e=this,t=this.personModelList_global.findIndex(function(t){return t==e.meInfoModel});-1!==t&&(this.personModelList_global.splice(t,1),this.personModelList_global.unshift(this.meInfoModel))},clearTagColors:function(){this.personViewList.forEach(e=>{e.container.hasClassName("colorize")&&e.clickOnPerson()})},updatePersonColorizedTags:function(){var e=this.getOption("taggerView");let t=e.actionManager?e.actionManager.getCurrentAction():void 0;this.personViewList.filter(e=>{e.container.hasClassName("colorize")&&(e.container.addClassName("picked-for-colorize"),t._selection.push(e.model.get("title")))});let i=t.getSelectionCount();t.set("selectionCount",i)},resetColorizedTags:function(){this.personViewList.filter(e=>{e.container.hasClassName("colorize")&&e.container.removeClassName("picked-for-colorize")})},toggleGrouping:function(e){this.personViewList.filter(t=>t.model.get("title")===e).toggleGrouping()},updateGroupedTags:function(){this.personViewList.forEach(e=>{e.toggleGrouping()})},destroyPersonView:function(){this.personViewList.forEach(function(e){e.destroy(),e=null}),this.personViewList=[]},destroy:function(){this.destroyPersonView(),this.meInfoModel=void 0,this.stopListening(),this._parent()}})}),define("DS/TagNavigator/AbstractPredicateView",["UWA/Core","UWA/Class","UWA/Controls/Drag","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerNLS","DS/UIKIT/Input/Date","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Autocomplete","DS/UIKIT/Mask","UWA/Promise","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/views/PersonListView","DS/TagNavigator/simplified/views/CriteriaListView","DS/TagNavigator/TagWidget/TagWidgetUtils"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f){"use strict";var m,v={},T={},C={},w=/^[\w-.\s,]*$/;return(m=t.extend({init:function(e,t){if(!(e instanceof a))throw new Error("Invalid input arg");var i,n,s,o,r,l;this.taggerView=t,this.nbDescendantTagValues=0,this._id=e.id(),this._displayName=e.displayName(),this._tagValueViews=[],this._tagValueViewsMap={},this._predicate=e,this._colorize=!1,this.criterion={},this.colorManager=null,this.debouncedRequestSuggestions=(i=this.taggerView.observedNavImpl.requestSuggestions,n=250,s=this.taggerView.observedNavImpl,(l=function(){var e,t=s||this,a=arguments,l=function(){r=null,o||(e=i.apply(t,a))};if(r&&clearTimeout(r),o){var c=!r;r=setTimeout(l,n),c&&(e=i.apply(this,a))}else r=setTimeout(l,n);return e}).cancel=function(){clearTimeout(r),r=null},l);var c=this.taggerView.getObservedNavigator().getCache(),d=e.getFullPredicateID().split("/");d.length>1&&"ds6w:when"===d[0]&&!UWA.is(c.viewMode[this._id])&&this.taggerView.hasFreeInputSupport(this._id)?c.setViewMode(this._id,"freeInput"):d.length>1&&"ds6w:when"===d[0]&&!UWA.is(c.viewMode[this._id])&&!this.taggerView.hasFreeInputSupport(this._id)&&c.setViewMode(this._id,"tag"),this.from_keyup_handler=null,this.to_keyup_handler=null,this.boolean_keyup_handler_handler=null,this._hasHierarchicalTags=!1},_onDragHandles:function(e){return e.target.getClosest(".predicate")},hasHierarchicalTags:function(){this._hasHierarchicalTags=!0},getHasHierarchyTags:function(){return this._hasHierarchicalTags},getDisplayname:function(){return this._displayName},getCompleteID:function(e){return this._predicate.getFullPredicateID(e)},getPredicate:function(){return this._predicate},getChildrenTagValueViews:function(e){var t,i,a,n;for(e||(e=function(){return!0}),n=[],i=0,a=this._tagValueViews.length;i<a;i++)e((t=this._tagValueViews[i]).id())&&n.push(t);return n},getTagValueViews:function(e,t,i){var a=this;if(e){var n;g.log("looking for tvv for tagName="+e);var s,o=function(e,t){var a=e.findIndex(function(e){if(i){if(n=e.id(),UWA.is(n,"array")&&(n=n[n.length-1]),n==t)return!0}else if(e.getDisplayname()==t)return!0});if(-1!==a)return e[a];g.error("FAILED to find tvv for "+t)};if(t){var r,l=[];e.forEach(function(e,t){g.log("looking for tvv for hierarchical tag="+e),0==t?(r=o(a._tagValueViews,e))&&l.push(r):r&&(r=o(r.getChildrenTagValueViews(),e))&&l.push(r)}),s=[l]}else{var c=o(this._tagValueViews,e);c&&(s=[c])}return s}return this._tagValueViews},getChildTagValueView:function(e){return this._tagValueViewsMap[e]},addTagValueView:function(e){if(this._tagValueViewsMap[e.getDisplayname()])throw new Error("Unexpected addition of already existing child TagValueView");return this._tagValueViews.push(e),this._tagValueViewsMap[e.getDisplayname()]=e,this.incNbDescendantTagValues(),this},predComparator:function(e,t){return e.getDisplayname().toLowerCase()>t.getDisplayname().toLowerCase()?1:e.getDisplayname().toLowerCase()<t.getDisplayname().toLowerCase()?-1:0},findInsertionPoint:function(e,t,i){var a,n,s,o;for(s=0,n=e.length,o=-1,a=0;s<n;)if((a=i(e[o=parseInt((s+n)/2,10)],t))<0)s=o+1;else{if(!(a>0))return o;n=o}return s},getComparator:function(e,t){var i=e?1:-1,a=t?1:-1;return this.sortTwoValues.bind(this,i,a)},sortTwoValues:function(e,t,i,a){function n(e,t,i){return(t.t!==i.t?t.t>i.t?1:-1:t.localeSort||i.localeSort?t.value.localeCompare(i.value):t.value>i.value?1:t.value===i.value?0:-1)*e}var s=0;return 0===(s=n(e,i[0],a[0]))&&(s=n(t,i[1],a[1])),s},getNbDescendantTagValues:function(){return this.nbDescendantTagValues},incNbDescendantTagValues:function(){return this.nbDescendantTagValues++,this},getTagValuesTotalCount:function(){let e=0;return Array.isArray(this._tagValueViews)&&(e=this._tagValueViews.reduce(function(e,t){return e+t.nbSubjectsTagged()},0)),0==e&&(e=this.nbDescendantTagValues),e},getPredicateSummaryCount:function(e,t){let i=e?e.getPredicateCountPolicy():1;if(1==i||t)return this.nbDescendantTagValues;if(2==i)return this.getTagValuesTotalCount();if(3==i){let t=e.getPredicateSummaryCount(this._id);return UWA.is(t,"number")&&t>0?t:(g.log("Predicate summary count ignored as it is not a number for "+this._id),this.getTagValuesTotalCount())}},isRootPredView:function(){return this._isRootPredView},hasSuggestSupport:function(){var e=this._predicate.getElemOptions();return e&&e.multiSelect&&e.allowFreeInput&&!1!==this._predicate.isSuggestSupported()},updateSuggestions:function(t){if(e.is(this.criterion,"object")&&e.is(this.criterion.string)){var i=this.criterion.string.getDataset("displayedSuggestions");e.is(t)&&e.is(t.items,"array")&&0!==t.items.length?(t.items.unshift({label:this.criterion.string.elements.input.value,value:this.criterion.string.elements.input.value,isUserText:!0}),UWA.is(this.resolve,"function")&&this.resolve({dataset:i,matchingItems:t.items})):UWA.is(this.resolve,"function")&&this.reject({type:"error",dataset:i})}},id:function(){return this._id},idForDOM:function(){return this.taggerView.getDOMId(this._predicate.getFullPredicateID())},updateCompositeStatus:function(){for(var e=0;e<this._tagValueViews.length;e++){this._tagValueViews[e].updateCompositeStatus()}},createTempArrayForSort:function(t,i){return t.map(function(t,a){var n,s,o,r=[],l=!1,c=!1,d=t.type();return n={value:t.nbSubjectsTagged(),t:0,localeSort:!1},"date"===d?(o=t.id().toLowerCase(),l=!1):(o=t.getDisplayname(),isNaN(o)&&e.is(o,"string")?(o=o.toLowerCase().trim(),l=!w.test(o)):(o=parseFloat(o),l=!1,c=!0)),s={value:o,t:c?0:"date"===d?1:2,localeSort:l},r.index=a,"nbSort"===i.sortMode?(r.push(n),r.push(s)):(r.push(s),r.push(n)),r})},sortTagValues:function(e){var t,i;this.id();return t=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID()),0!==this.getChildrenTagValueViews().length&&this.getChildrenTagValueViews()[0].nbSubjectsTagged()<0&&"alphaSort"!==t.sortMode&&this.taggerView.getObservedNavigator().getCache().changeSort("alphaSort",this._predicate.getFullPredicateID()),t=UWA.clone(this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID())),this.hideTagsCount&&"nbSort"===t.sortMode&&(t.sortMode="alphaSort",t.secondaryorder&&(t.order=!0)),(i=this.createTempArrayForSort(e,t)).sort(this.getComparator(t.order,t.secondaryorder)),i=i.map(function(t){return e[t.index]})},destroyUiElement:function(e){if(e?delete C[this.id()]:delete T[this.id()],Object.keys(this.criterion).length){var t=Object.keys(this.criterion)[0];switch(t){case"graph":case"category":case"string":case"people":case"calendar":this.criterion[t].destroy();break;case"integer":case"float":case"double":case"date":this.from_keyup_handler&&this.criterion[t].from.elements.input.removeEvent("keyup",this.from_keyup_handler),this.from_keyup_handler=null,this.to_keyup_handler&&this.criterion[t].to.elements.input.removeEvent("keyup",this.to_keyup_handler),this.to_keyup_handler=null,this.criterion[t].from.destroy(),this.criterion[t].to.destroy();break;case"boolean":this.boolean_keyup_handler&&this.criterion[t].elements.input.removeEvent("keyup",this.boolean_keyup_handler),this.boolean_keyup_handler=null,this.criterion[t].destroy()}delete this.criterion[t]}this.resolve&&(this.resolve=null),this.reject&&(this.reject=null)},redrawUiElement:function(t){var i,a,s,h=this,f={},v=["from","to"],T=this.taggerView.getObservedNavigator().getCache(),w=this.taggerView.getObservedNavigator().getFocusedProxy(),b=this._predicate.getElemOptions(),y=T.getCriteriaToResetBeforeFilterChange(w?w.id():void 0),S=T.getCriteriaToRemoveBeforeFilterChange(w?w.id():void 0),I="",E=this.taggerView.getDOMId(this.getCompleteID()),x={};if(x.hideTagsCount=this.hideTagsCount,i=t?this.taggerView.taggerUWAElement.getElement("#"+E+"sug"):this.taggerView.taggerUWAElement.getElement("#"+E),I=this.taggerView._simplifiedTagger?this.taggerView.getCacheSimplified().getViewMode(this.id()):this.taggerView.getObservedNavigator().getCache().getViewMode(this.id()),this.taggerView.getObservedNavigator().hasDateRangeType(this.id())&&w&&(I="freeInput"),e.is(i)){switch(t||0!==I.indexOf("graph")?t||0!==I.indexOf("category")?t||0!==I.indexOf("people")?!this.taggerView._simplifiedTagger||t||"date"!=this._predicate.getType()&&"daterange"!=this._predicate.getType()?a=this._predicate.getType()||"string":(this.taggerView.hasFreeInputOnly(this.id())||"freeInput"==I&&this.taggerView.hasFreeInputSupport(this.id()))&&(a="calendar"):a="people":a="category":a="graph",a){case"category":(i=this.taggerView.taggerUWAElement.getElement("#"+E.concat("_category")))&&(h.criterion.category&&(g.log("destroying the existing category view before creating a new one"),h.criterion.category.destroy(),h.criterion.category=null),h.taggerView&&(h.criterion.category=new p({taggerView:h.taggerView,hasAdvancedFocsuedProxy:h.taggerView.hasAdvancedFocsuedProxy,predicates:"ds6w:typeCategory"==h.id()?[h.id()]:void 0}).inject(i).render(),h.criterion.category.redraw(x)));break;case"people":(i=this.taggerView.taggerUWAElement.getElement("#"+E.concat("_people")))&&h.taggerView&&(h.criterion.people=new u({taggerView:h.taggerView,hasAdvancedFocsuedProxy:h.taggerView.hasAdvancedFocsuedProxy,predicates:[h.id()],expandablePerson:!1,searchString:T.getSearchValue()}).render().inject(i),h.criterion.people.redraw(x));break;case"calendar":require(["DS/TagNavigator/simplified/views/DateCalendarView"],function(e){h.taggerView&&(h.criterion.calendar=new e({taggerView:h.taggerView,navImpl:h.taggerView.getObservedNavigator(),predicateId:h._predicate.id()}).render().inject(i.getElement(".date-view-container")))});break;case"graph":var _="graphBar"===I,A=E.concat("_graph");i=this.taggerView.taggerUWAElement.getElement("#"+A),require(["DS/W3DXComponents/Views/GraphView"],function(e){h.criterion.graph=new e({type:_?"column":"pie",width:h.dataForGraph.widthBarChartGraph,series:[{type:_?"column":"pie",pointRange:h.dataForGraph.dateRange,data:h.dataForGraph.completeData,borderWidth:_?2:1,borderColor:_?null:"white"}],expertOpts:{chart:{zoomType:"x"},title:{text:null},plotOptions:{pie:{borderWidth:1,borderColor:"#FFFFFF",point:{events:{legendItemClick:function(){return!!this.id&&((h.taggerView.actionManager?h.taggerView.actionManager.getCurrentAction():void 0)?(g.log("NO treatment for pie chart selection during action mode"),!1):void h.taggerView.toggleTagSelection(this.id.replace("atv","")))}}},dataLabels:{enabled:!1},showInLegend:!0},column:{states:{select:{color:null,borderWidth:2,borderColor:"#368ec4"}},colorByPoint:!0},series:{allowPointSelect:!1,cursor:"pointer",point:{events:{click:function(e){if(this.id){if(h.taggerView.actionManager?h.taggerView.actionManager.getCurrentAction():void 0)return g.log("NO treatment for bar chart selection during action mode"),!1;h.taggerView.toggleTagSelection(this.id.replace("atv",""))}}}},turboThreshold:1e4}},legend:{enabled:!_,maxHeight:"56",itemStyle:{width:"150px",textOverflow:"ellipsis",overflow:"hidden"},labelFormat:'{name} <span style="font-weight:normal">({percentage:.1f}%)</span>'},xAxis:{type:h.dataForGraph.datetime?"datetime":"category",tickInterval:h.dataForGraph.datetime?h.dataForGraph.dateRange:null,minRange:h.dataForGraph.datetime?h.dataForGraph.dateRange:null,dateTimeLabelFormats:{day:"%d",month:"%B",year:"%Y"},labels:{rotation:-45,formatter:h.dataForGraph.datetime?null:function(){var e=this.value;return e.length>10&&!h.dataForGraph.datetime&&(e=e.substring(0,9).concat("...")),e}},reversed:!!h.dataForGraph.datetime&&h.dataForGraph.reversed,crosshair:!0},tooltip:{pointFormat:_?"<b>{point.y}</b>":"<b>{point.y}</b> ({point.percentage:.1f}%)",formatter:null,followPointer:!0,positioner:_?function(e,t,i){return{x:i.plotX+h.criterion.graph._highcharts.plotLeft-e/2,y:t>i.plotY?h.criterion.graph._highcharts.plotHeight+h.criterion.graph._highcharts.plotTop+10:i.plotY+h.criterion.graph._highcharts.plotTop-t-10}}:void 0}}}),h.criterion[a].setContainer(i).render(),i&&i.scrollWidth!==i.clientWidth&&i.setStyle("padding-bottom","15px")});break;case"string":f.onKeyDown=function(e){if(-1===[8,46].indexOf(e.keyCode)||this.options.multiSelect||!e.target.value)return!1;this.options.events.onUnselect.call(this,this.selectedItems[0])},f.onKeyUp=function(e){var i,a=[];if(-1!==[8,46].indexOf(e.keyCode))return!1;if(13!==e.keyCode||e.target.value)return!1;if(t)h.taggerView.onSearchLaunch();else{for(i=0;i<this.getSelection().length;i++)a.push({predicate:h._predicate,value:this.getSelection()[i].value,type:"string"});h.taggerView.observedNavImpl.createFreeInputs(a),h.taggerView.setActiveCriteria(!0,!0)}},f.onSelect=function(e){"ds6w:dataSource"==h._id&&c.mask(C["ds6w:type"].criterion.string.elements.container);var t,i=[],a=this.getSelection();if("string"==typeof a&&(a=void 0!==e?[e]:[]),h._predicate.warnSelect()&&h._predicate.isEnum()){for(t=0;t<a.length;t++)i.push(a[t].value);h.taggerView.warnProxyOfCriteriaChange({sixw:h._predicate.getFullPredicateID(),value:i})}if("string"==typeof a[a.length-1]&&a.pop(),a.length>0?y[h._predicate.id()]={value:a,type:"string"}:delete y[h._predicate.id()],m.checkActiveSearch(h.taggerView),b&&b.informOnCriteriaModification){a[a.length-1].doNotInformCriteriaModification||h.taggerView.warnProxyOfCriteriaModified()}},f.onUnselect=function(e){if(!this.opened){var i,a=[],n=this.getSelection();if(h._predicate.warnSelect()&&h._predicate.isEnum()){for(i=0;i<n.length;i++)a.push(n[i].value);h.taggerView.warnProxyOfCriteriaChange({sixw:h._predicate.getFullPredicateID(),value:a})}"string"==typeof n[n.length-1]&&n.pop(),n.length>0?y[h._predicate.id()]={value:n,type:"string"}:delete y[h._predicate.id()],t?S.push({predicate:h._predicate,type:"string",value:e.value}):h.taggerView.getObservedNavigator().getFocusedProxy().removeFreeInputs([{predicate:h._predicate,type:"string",value:e.value}]),b&&b.datasets&&b.datasets.items&&b.datasets.items.length&&b.datasets.items.forEach(function(e){!0===e.predefined&&(e.predefined=!1)}),m.checkActiveSearch(h.taggerView),b&&b.informOnCriteriaModification&&h.taggerView.warnProxyOfCriteriaModified()}},b&&b.events&&delete b.events;var N=e.merge(b||{},{showSuggestsOnFocus:!0,placeholder:n.getText("typestring"),multiSelect:!0,allowFreeInput:!h._predicate.isEnum(),noResultsMessage:!!h._predicate.isEnum()&&n.getText("noRslt"),events:f});if(h.hasSuggestSupport()?(N.datasets={name:"displayedSuggestions",items:[],configuration:{templateEngine:function(e,t,i){e.addClassName("default-template");var a=UWA.createElement("span",{class:"item-label"});a.setText(i.label),a.inject(e),!0===i.isUserText&&a.setStyle("font-style","italic")}}},"criteria"==h.taggerView.tabView.selectedTab.getName()&&(N.datasets.configuration.remoteSearchEngine=function(e,t){return new d(function(e,i){h.resolve=e,h.reject=i,h.debouncedRequestSuggestions(h._id,t)})})):h._predicate.isEnum()&&h.taggerView._customEnumFiltering&&(N.datasets.configuration={searchEngine:function(e,t){var i=t.trim().toLowerCase(),a=e.items.filter(function(e,t){var a=e.label.toLowerCase().indexOf(i);if(-1!==a)return e.matchInfo={matchFoundAt:a},!0});return a.sort(function(e,t){return e.matchInfo.matchFoundAt===t.matchInfo.matchFoundAt?0:e.matchInfo.matchFoundAt>t.matchInfo.matchFoundAt?1:-1}),a}}),h._predicate.isEnum())h.criterion[a]=new l(N);else{var V=l.extend({onClickOutside:function(){var e;if(g.log("Inside onClickOutside"),this.elements.input&&(e=this.elements.input.value),UWA.is(e,"string")&&e.length>0){g.log("Input freetext: "+e);var t=e.replace(/\||\n/g,"\t").replace(/^\s+|\s+$/g,"").split("\t").map(function(e){return e.trim()}).filter(function(e,t,i){return i.indexOf(e)===t}).map(function(e){return{value:e,selected:!0,doNotInformCriteriaModification:!0}});this.addItems(t,{items:[]})}h.hasSuggestSupport()&&this.resetCache(),this._parent()}});h.criterion[a]=new V(N)}if(h._predicate.isEnum()||(h.criterion[a].elements.input.onpaste=function(e){var t;if(e.preventDefault(),e.clipboardData&&UWA.is(e.clipboardData.getData,"function")?t=e.clipboardData.getData("text/plain"):window.clipboardData&&UWA.is(window.clipboardData.getData,"function")&&(t=window.clipboardData.getData("text")),UWA.is(t,"string")){var i=t.replace(/^\s+/g,"").replace(/\||\n|\r\n|\t/g,"\t").split("\t").filter(function(e,t,i){if(""!=e)return i.indexOf(e)===t}).map(function(e){return{value:e,selected:!0,doNotInformCriteriaModification:!0}});this.addItems(i,{items:[]})}}.bind(h.criterion[a])),h._predicate.isEnum()&&b.datasets&&b.datasets.items&&0===b.datasets.items.length){if(y[h._predicate.id()]&&y[h._predicate.id()].value){var P=y[h._predicate.id()].value;for(s=0,P.length;s<P.length;s++)S.push({type:"string",predicate:h._predicate,value:P[s].value,nls:P[s].label});delete y[h._predicate.id()]}}else{if(y[h._predicate.id()]){var D=y[h._predicate.id()].value||[];if(D.forEach(e=>{e.doNotInformCriteriaModification=!0}),h._predicate.isEnum()||0===D.length)for(s=0;s<D.length;s++)h.criterion[a].getItem(D[s].value)&&(h.criterion[a].onSelect(h.criterion[a].getItem(D[s].value)),m.checkActiveSearch(h.taggerView));else for(h.criterion[a].addItems(D,{items:[]}),s=0;s<D.length;s++)D[s].pending&&delete D[s].pending}if(b.datasets&&b.datasets.items)b.datasets.items.filter(function(e){return!0===e.predefined}).forEach(function(e,t,i){y[h._predicate.id()]=y[h._predicate.id()]||{type:"string",value:[]},t=y[h._predicate.id()].value.map(function(e){return e.value}).indexOf(e.value),h.criterion[a].getItem(e.value)&&-1===t&&(h.criterion[a].onSelect(h.criterion[a].getItem(e.value)),y[h._predicate.id()].value.push(h.criterion[a].getItem(e.value)),m.checkActiveSearch(h.taggerView)),1===i.length&&"ds6w:dataSource"===h._id&&(m.mask=!0)});else if(b.defaultValue){if(h._predicate.isEnum())console.warn("defaultValue ignored for enum predicate"+h._predicate.id()+", plz provide datasets.items");else{var O=null,M=[];if(y[h._predicate.id()]&&(M=y[h._predicate.id()].value.map(e=>e.label)),UWA.is(b.defaultValue,"string")?O=[b.defaultValue]:UWA.is(b.defaultValue,"array")&&(O=b.defaultValue),UWA.is(O,"array")){for(var U=[],F=0;F<O.length;F++){var W;(M.length>0&&!M.includes(O[F])||M.length<=0&&O.length>0)&&(W=O[F],UWA.is(W,"string")?U.push({value:W,selected:!0,doNotInformCriteriaModification:!0}):console.warn("default value provided is not a string, ignored..."))}U.length>0&&h.criterion[a].addItems(U,{items:[]})}}delete b.defaultValue}}this.criterion[a].inject(i.getElement(".add-tag-close"),"before");break;case"integer":case"float":case"double":var R=[],j=null,L="integer"===a?"int":"float";for(h.criterion[a]={},s=0;s<v.length;s++){var k=v[s];h.criterion[a][k]=new r({placeholder:b&&b.placeholder?b.placeholder:n.getText(k)+":"+n.getText("type"+L+("from"===k?"min":"max")),className:k});var B=function(e){var i,n={};i=(i=e.target.value).replace(",",".");var s=e.target.hasClassName("from")?"from":"to",o=i.length<=0;if(o||(o="int"===L?!isNaN(parseInt(i))&&parseInt(i)+""===i:!isNaN(parseFloat(i))&&parseFloat(i)+""===i),UWA.is(e.target.type,"string")&&"text"==e.target.type&&UWA.is(e.target.parentNode)){if(!0!==o)return e.target.parentNode.addClassName("has-error")&&!1;e.target.parentNode.removeClassName("has-error")}if(13===e.keyCode)if(!t&&i){var r={predicate:h._predicate,type:a};n[s]=i,r.value=n,R.push(r),y[h._predicate.id()]["from"===s?"to":"from"]&&((j={predicate:h._predicate,type:a}).value={},j.value["from"===s?"to":"from"]=y[h._predicate.id()]["from"===s?"to":"from"].value),j&&R.push(j),h.taggerView.observedNavImpl.createFreeInputs(R),h.taggerView.setActiveCriteria(!0,!0)}else t&&h.taggerView.onSearchLaunch();else{var l;if(y[h._predicate.id()]=y[h._predicate.id()]||{},y[h._predicate.id()].type=a,i)y[h._predicate.id()][s]={value:i,type:a};else l={predicate:h._predicate,type:a},y[h._predicate.id()][s]&&y[h._predicate.id()][s].value&&(l.value={},l.value[s]=y[h._predicate.id()][s].value,S.push(l)),delete y[h._predicate.id()][s];1===Object.keys(y[h._predicate.id()]).length&&delete y[h._predicate.id()]}h.taggerView.addOrRemoveClear(e),t&&b&&b.informOnCriteriaModification&&h.taggerView.warnProxyOfCriteriaModified()};"from"===k?(this.from_keyup_handler&&console.warn("keyup handler for 'from' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type="+a),this.from_keyup_handler=B):(this.to_keyup_handler&&console.warn("keyup handler for 'to' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type="+a),this.to_keyup_handler=B),h.criterion[a][k].elements.input.addEvent("keyup",B),y[h._predicate.id()]&&y[h._predicate.id()][k]&&h.criterion[a][k].setValue(y[h._predicate.id()][k].value)}UWA.is(b.defaultValue,"object")&&(UWA.is(b.defaultValue.from)&&(h.criterion[a].from.getValue()||(y[h._predicate.id()]=y[h._predicate.id()]||{type:a},h.criterion[a].from.setValue(b.defaultValue.from),y[h._predicate.id()].from={value:h.criterion[a].from.getValue(),type:a},delete b.defaultValue.from)),UWA.is(b.defaultValue.to)&&(h.criterion[a].to.getValue()||(y[h._predicate.id()]=y[h._predicate.id()]||{type:a},h.criterion[a].to.setValue(b.defaultValue.to),y[h._predicate.id()].to={value:h.criterion[a].to.getValue(),type:a},delete b.defaultValue.to))),this.criterion[a].from.inject(i.getElement(".from.add-tag-close"),"before"),this.criterion[a].to.inject(i.getElement(".to.add-tag-close"),"before");break;case"date":f.onChange=function(e){if(h.criterion[a]){var i,n,s="SPAN"===e.target.tagName?e.target.getClosest(".add-tag-cont").getElement("input").hasClassName("from"):e.target.hasClassName("from"),o=s?"from":"to",r={};if(y[h._predicate.id()]=y[h._predicate.id()]||{type:"date"},this.getValue()){if(y[h._predicate.id()][o]={value:this.getDate(),type:"date"},s?h.criterion[a].to.setMinDate(this.getDate()):h.criterion[a].from.setMaxDate(this.getDate()),!t){r[o]=this.getDate().getFullYear()+"/"+("0"+(this.getDate().getMonth()+1)).slice(-2)+"/"+("0"+this.getDate().getDate()).slice(-2);var l={predicate:h._predicate,value:r,type:a};h.taggerView.observedNavImpl.createFreeInputs([l])}}else n={predicate:h._predicate,type:"date"},i=(i=y[h._predicate.id()][o].value).getFullYear()+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+("0"+i.getDate()).slice(-2),n.value={},n.value[o]=i,delete y[h._predicate.id()][o],1===Object.keys(y[h._predicate.id()]).length&&delete y[h._predicate.id()],this.setDate("",!0),t?S.push(n):h.taggerView.getObservedNavigator().getFocusedProxy().removeFreeInputs([n]),s?h.criterion[a].to.setMinDate(!1):h.criterion[a].from.setMaxDate(!1);h.taggerView.setActiveCriteria(!0,!0),h.taggerView.addOrRemoveClear(e),b&&b.informOnCriteriaModification&&h.taggerView.warnProxyOfCriteriaModified()}};var G=h.taggerView.taggerRoot;if(h.criterion[a]=m.createDateInput({events:{onChange:f.onChange}},y[h._predicate.id()],G),UWA.is(b.defaultValue,"object")){var z;if(UWA.is(b.defaultValue.from,"string"))if(!h.criterion[a].from.getDate())3===(z=b.defaultValue.from.split("/")).length&&(y[h._predicate.id()]=y[h._predicate.id()]||{type:"date"},h.criterion[a].from.setDate(new Date(parseInt(z[0]),z[1]-1,z[2]),!0),y[h._predicate.id()].from={value:h.criterion[a].from.getDate(),type:"date"},delete b.defaultValue.from);if(UWA.is(b.defaultValue.to,"string"))if(!h.criterion[a].to.getDate())3===(z=b.defaultValue.to.split("/")).length&&(y[h._predicate.id()]=y[h._predicate.id()]||{type:"date"},h.criterion[a].to.setDate(new Date(parseInt(z[0]),z[1]-1,z[2]),!0),y[h._predicate.id()].to={value:h.criterion[a].to.getDate(),type:"date"},delete b.defaultValue.to)}for(s=0;s<v.length;s++){B=function(e){if(13!==e.keyCode)return!1;b&&b.informOnCriteriaModification&&h.taggerView.warnProxyOfCriteriaModified(),h.taggerView.onSearchLaunch()};"from"===v[s]?(this.from_keyup_handler&&console.warn("keyup handler for 'from' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type=Date"),this.from_keyup_handler=B):(this.to_keyup_handler&&console.warn("keyup handler for 'to' field found, possibly an issue with AbstractPredicateView lifecycle...., Predicate type=Date"),this.to_keyup_handler=B),h.criterion[a][v[s]].elements.input.addEvent("keyup",B)}this.criterion[a].from.inject(i.getElement(".from.add-tag-close"),"before"),this.criterion[a].to.inject(i.getElement(".to.add-tag-close"),"before");break;case"boolean":f.onChange=function(e){var i={value:this.getValue()[0],label:"true"===this.getValue()[0]?n.getText("yes"):n.getText("no")};i&&!t?(h.taggerView.observedNavImpl.updateFreeInputs([{predicate:h._predicate,value:i.value,type:a,nls:i.label}],[{predicate:h._predicate,value:"true"===this.getValue()[0]?"false":"true",nls:"true"===this.getValue()[0]?n.getText("no"):n.getText("yes"),type:a}]),h.taggerView.setActiveCriteria(!0,!0)):(y[h._predicate.id()]&&S.push({predicate:h._predicate,value:y[h._predicate.id()].value.value,nls:y[h._predicate.id()].value.label,type:a}),i?y[h._predicate.id()]={value:i,type:a}:delete y[h._predicate.id()],b&&b.informOnCriteriaModification&&h.taggerView.warnProxyOfCriteriaModified()),m.checkActiveSearch(h.taggerView)};var H=y[h._predicate.id()]?y[h._predicate.id()].value.value:null;if(!UWA.is(H)&&b&&UWA.is(b.defaultValue))if(UWA.is(b.defaultValue,"string")){var J={value:H=b.defaultValue.toLowerCase(),label:"true"===H?n.getText("yes"):n.getText("no")};y[h._predicate.id()]={type:a,value:J},delete b.defaultValue}else console.warn("defaultValue specified for boolean type of field is not a string");h.criterion[a]=new o({placeholder:n.getText("selectValue"),options:[{value:"true",label:n.getText("yes"),selected:"true"===H},{value:"false",label:n.getText("no"),selected:"false"===H}],events:f.onChange?f:{}}),h.boolean_keyup_handler&&console.warn("keyup handler for 'boolean' field found, possibly an issue with AbstractPredicateView lifecycle...."),h.boolean_keyup_handler=function(e){if(13!==e.keyCode)return!1;h.taggerView.onSearchLaunch()},h.criterion[a].elements.input.addEvent("keyup",h.boolean_keyup_handler),this.criterion[a].inject(i.getElement(".boolean"))}"integer"!==a&&"float"!==a&&"double"!==a&&"date"!==a||(this.taggerView.addOrRemoveClear(this.criterion[a].from.elements.input),this.taggerView.addOrRemoveClear(this.criterion[a].to.elements.input)),!0===m.mask&&C["ds6w:type"]&&C["ds6w:type"].criterion.string&&0===C["ds6w:type"].criterion.string.datasets[0].items.length&&(c.mask(C["ds6w:type"].criterion.string.elements.container),m.mask=!1)}},getTagValueViewOfSelectedDate:function(e,t,i,a){var n,s,o,r,l=[];if(1===(s=t.split("/").length))if(n=e.length>1?e.filter(function(e){return e.id()===t}).pop():e[0],i)for(o=n.getChildrenTagValueViews(),r=0;r<o.length;r++)-1!==o[r].getDisplayname().toLowerCase().indexOf(a)&&l.push(o[r]);else l=n.getChildrenTagValueViews();else if(2===s)if(n=(n=e.length>1?e.filter(function(e){return e.id()===t.split("/")[0]}).pop().getChildrenTagValueViews():e[0].getChildrenTagValueViews()).length>1?n.filter(function(e){return e.id()===t}).pop():n[0],i)for(o=n.getChildrenTagValueViews(),r=0;r<o.length;r++)-1!==o[r].getDisplayname().toLowerCase().indexOf(a)&&l.push(o[r]);else l=n.getChildrenTagValueViews();else if(3===s)if(n=(n=(n=e.length>1?e.filter(function(e){return e.id()===t.split("/")[0]}).pop().getChildrenTagValueViews():e[0].getChildrenTagValueViews()).length>1?n.filter(function(e){return e.id()===t.split("/").slice(0,-1).join("/")}).pop().getChildrenTagValueViews():n[0].getChildrenTagValueViews()).length>1?n.filter(function(e){return e.id()===t}).pop():n[0],i)for(o=e[0].getChildrenTagValueViews()[0].getChildrenTagValueViews(),r=0;r<o.length;r++)-1!==o[r].getDisplayname().toLowerCase().indexOf(a)&&l.push(o[r]);else l=n.getMotherView().getChildrenTagValueViews();return{motherDate:n,tvv:l}},updateGraphColors:function(){var e=this.taggerView.getObservedNavigator().getCache();if(this.tvvForGraph&&this.dataForGraph&&this.dataForGraph.completeData&&this.tvvForGraph.length===this.dataForGraph.completeData.length){var t=this;this.tvvForGraph.forEach(function(i,a){t.dataForGraph.completeData[a].color=e.colorManager.getNewColorForTagValue(i)})}},getElementTvvForGraph:function(e,t){var i,a,s,o=!1,r=1,l=[],c=0,d=0,g=0,h=this,u=[],p=[],f=[],m=[],v=this.taggerView.getObservedNavigator().getCache();function T(e,t){var i,a={name:e.getDisplayname(),id:h.taggerView.getDOMId(e.getSelectedTagId()),category:e.getDisplayname(),y:e.nbSubjectsTagged(),selected:e.isSelectedTag(),sliced:e.isSelectedTag(),color:v.colorManager.getNewColorForTagValue(e)};return t&&(i=new Date(e.id().split("/").join("-")),a.x=Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),a}function C(e,t,i){return{name:e,category:t,y:i,selected:!1,sliced:!1}}if(m=e.slice(0),e.length&&"date"===e[0].type())switch(o=!0,e[0].getDateLevel()){case"year":r=365;break;case"month":r=30;break;case"day":r=1}for(i=0;i<e.length;i++)c+=e[i].nbSubjectsTagged();for(i=0;i<e.length;i++)100*e[i].nbSubjectsTagged()/c<.5?u.push(e[i]):p.push(e[i]);if(d=0,u.length>0&&void 0!==u)for(i=0;i<u.length;i++)d+=u[i].nbSubjectsTagged();if(a=this.taggerView.getObservedNavigator().getCache().getCurrentSort(this._predicate.getFullPredicateID()),s=o&&"alphaSort"===a.sortMode&&t,p.length>31)if("nbSort"===a.sortMode&&!1===a.order)for(f=p.splice(31,p.length),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();else for(f=p.splice(0,p.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();if(d<.75*c&&!t&&u.length>0){if("alphaSort"===a.sortMode){for(i=0;i<p.length;i++)l.push(T(p[i],s));l.push(C(n.getText("otherUnderThreshold"),n.getText("otherUnderThreshold"),d)),f.length>0&&l.push(C(n.getText("other"),n.getText("other"),g))}else if(!0===a.order)for(l.push(C(n.getText("otherUnderThreshold"),n.getText("otherUnderThreshold"),d)),f.length>0&&l.push(C(n.getText("other"),n.getText("other"),g)),i=0;i<p.length;i++)l.push(T(p[i],s));else if(!1===a.order){for(i=0;i<p.length;i++)l.push(T(p[i],s));f.length>0&&l.push(C(n.getText("other"),n.getText("other"),g)),l.push(C(n.getText("otherUnderThreshold"),n.getText("otherUnderThreshold"),d))}}else if(e.length>31)if("nbSort"===a.sortMode)if(!0===a.order){for(f=m.splice(0,e.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();for(f.length>0&&l.push(C(n.getText("other"),n.getText("other"),g)),i=0;i<m.length;i++)l.push(T(m[i],s))}else{for(f=m.splice(31,m.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();for(i=0;i<m.length;i++)l.push(T(m[i],s));f.length>0&&l.push(C(n.getText("other"),n.getText("other"),g))}else{for(f=m.splice(0,m.length-31),i=0;i<f.length;i++)g+=f[i].nbSubjectsTagged();for(i=0;i<m.length;i++)l.push(T(m[i],s));f.length>0&&l.push(C(n.getText("other"),n.getText("other"),g))}else for(i=0;i<m.length;i++)l.push(T(m[i],s));return{completeData:l,dateRange:s?24*r*3600*1e3:null,datetime:s,reversed:!a.order}},tvvToHtml:function(e,t,i){var a,n,s,o,r,l,c,d,g=0,u=0,p="",f="",v=this._predicate.getFullPredicateID(),w=this.taggerView.getDOMId(v),b=this._predicate.getType()?this._predicate.getType():this._tagValueViews[0]?this._tagValueViews[0].type():"string",y=this._predicate.isTypeValidBool(),S=this.taggerView.getObservedNavigator().getCache(),I=this.taggerView._simplifiedTagger?this.taggerView.getCacheSimplified():this.taggerView.getObservedNavigator().getCache(),E=this.taggerView._simplifiedTagger?this.taggerView.getCacheSimplified().getViewMode(this.id(),this._predicate.is6WRoot()?void 0:this._predicate.get6WRootFather().id()):S.getViewMode(this.id()),x=this.taggerView.getObservedNavigator().getFocusedProxy(),_=S.colorManager;this.isColorized=this.taggerView.isColorizePossible(this.id())&&(_.isColorized(v)||_.isInColorization(v));var A=[this.id()];this.hideTagsCount=this.taggerView.getObservedNavigator().getHideCountProperty(A),this.hideTagsCount&&("graphPie"!==E&&"graphBar"!==E||(E="tag"));let N=this.taggerView.getObservedNavigator().hasProxiesInEdition();"freeInput"===E&&N&&(E="tag"),"freeInput"!==E||this.taggerView.isProxyWithFilteringOnServer()||(S.setViewMode(this.id(),"tag"),E=S.getViewMode(this.id())),this.taggerView.hasFreeInputOnly(this.id())&&!N&&(E="freeInput");var V=this.taggerView.getObservedNavigator().hasDateRangeType(this.id());if(V&&x?E="freeInput":V&&(E=""),this._hasHierarchicalTags&&"people"==E&&this.taggerView._simplifiedTagger&&(E="tag",this.taggerView.getCacheSimplified().setViewMode(this.id(),E)),n=S.getSearchValue().toLowerCase(),s=S.getSearchId(),a=S.isSearchVisible()&&""!==n&&("filter-all"===s||s.replace("filter-","")===this._predicate.get6WRootFather().id().replace("ds6w:","")),this.taggerView._simplifiedTagger&&!t&&!a){this.updateCompositeStatus();let e=this.taggerView.getObservedNavigator().getProxiesToDisplay();e.length&&e.some(e=>e.isFeatureSupported("grouping"))&&(o=function(e,t){return this.taggerView.getObservedNavigator().isGroupedBy(this._predicate.id(),e,t)}.bind(this))}switch(!e&&a||(this._tagValueViews=this.sortTagValues(this._tagValueViews)),"freeInput"!==E&&0!==this._tagValueViews.length&&"date"===this._tagValueViews[0].type()&&(d=this.taggerView.getListOfSelectedTagValues(this.getCompleteID())).length&&(p=d[0].uri),t?(r=C,E="freeInput"):this.taggerView._simplifiedTagger&&!t&&"freeInput"==E?(r=T,!this.taggerView.hasFreeInputOnly(this.id())&&!this.taggerView.hasFreeInputSupport(this.id())||"date"!=b&&"daterange"!=b||(E="calendar")):r=T,E){case"tag":this.isColorized||_.clearComputedColorMap(v);var P="tree"===this._tagValueViews[0].type(),D=this.taggerView.getMoreLimitForPredicate(this._predicate.id());let i=!1;if(h.getOption("activate_hierarchical_tag_scroll"))for(O=0;O<this._tagValueViews.length&&O<=D;O++){let e=this._tagValueViews[O].getSelectedTagId(),t=this.taggerView.getDOMId(e);if(I.isTagTreeExpanded(t)){i=!0;break}}if(f+="<ul class='tags-list "+(P?" treeview":"")+(i?" manage-horizontal-scroll":"")+("date"===b?" date":"")+"'>",a){for(O=0;O<this._tagValueViews.length;O++)(l=this._tagValueViews[O].getNbTagMatch(n))>0&&g<D?(f+=this._tagValueViews[O].toHtml(g<D,!1,p,n,y,o,N,"",this.hideTagsCount),g+=l):l>0&&(u+=l);0!==u&&(f+=m.more(u)),g>0?S.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM()):!this._isRootPredView&&this.taggerView.isW||!this.taggerView.isW?S.collapsePredicate(this.idForDOM()):-1===this.getDisplayname().toLowerCase().indexOf(n)&&(this._hiddenPredicate=!0)}else for(O=0;O<this._tagValueViews.length&&O<=D;O++)f+=O!==D?this._tagValueViews[O].toHtml(O<D,!1,p,"",y,o,N,"",this.hideTagsCount):m.more(this._tagValueViews.length-D);f+="</ul>";break;case"freeInput":this._predicate.getElemOptions();switch(b="tree"===b?"string":b){case"dateTime":case"date":case"integer":case"float":case"double":f+="<div class='add-tag-cont fromto'>",f+=m.freeInputToHtml(b,this);break;case"boolean":case"string":f+="<div class='add-tag-cont'>",f+=m.freeInputToHtml(b,this)}r[this.id()]=this,f+="</div>";break;case"category":if(f+="<div class='category-view ' id='"+w.concat("_category")+"'></div>",T[this.id()]=this,a)this._tagValueViews.filter(function(e){return e.getNbTagMatch(n)>0}).length>0&&S.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM());break;case"people":if(this.isColorized||_.clearComputedColorMap(v),f+="<div class='people-view-container' id='"+w.concat("_people")+"'></div>",T[this.id()]=this,S.colorManager.isColorized(v))for(var O=0;O<this._tagValueViews.length;O++)S.colorManager.getColorForTagValue(this._tagValueViews[O]);if(a)this._tagValueViews.filter(function(e){return e.getNbTagMatch(n)>0}).length>0&&S.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM());break;case"calendar":f+="<div class='date-view-container'></div>",r[this.id()]=this;break;case"graphBar":case"graphPie":var M,U="graphBar"===E,F=(w=this.taggerView.getDOMId(v)).concat("_graph");if(0!==(M=a?this._tagValueViews.filter(function(e){return e.getNbTagMatch(n)>0}):this._tagValueViews).length){if(a&&S.expandPredicate(this.taggerView._simplifiedTagger?this._predicate.id():this.idForDOM()),"date"===M[0].type()&&""!==p){var W=this.getTagValueViewOfSelectedDate(M,p,a,n),R=W.motherDate;R&&(this._tagValueMarkup="<ul class='date-filters'>"+R.toHtml(!0,!0)+"</ul>"),M=this.sortTagValues(W.tvv)}this.dataForGraph=this.getElementTvvForGraph(M,U),this.tvvForGraph=M;var j=this.dataForGraph.completeData.length;this.dataForGraph.datetime&&(j=Math.abs(this.dataForGraph.completeData[j-1].x-this.dataForGraph.completeData[0].x)/this.dataForGraph.dateRange),c=(c=30*j+80)>310&&U?c:null,this.dataForGraph.widthBarChartGraph=c,T[this.id()]=this,f+="<div class='graph' id='"+F+"'></div>"}else-1===this.getDisplayname().toLowerCase().indexOf(n)&&(S.collapsePredicate(this.idForDOM()),this._hiddenPredicate=!0)}let L=this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0;if(S.colorManager.isColorized(v)&&(!L||L&&"colorize"!==L.id)&&!i){var k=[],B=p?3===p.split("/").length?3:p.split("/").length+1:1;if("date"===this._predicate.getType()){for(O=0;O<_.computedColorMap[v].tagColors.length;O++)_.computedColorMap[v].tagColors[O].object.split("/").length==B&&k.push(_.computedColorMap[v].tagColors[O]);this.taggerView.warnForColorize({}[v]={tagColors:k})}else P?(_.getComputedMap(v)&&this.taggerView.warnForColorize({}[v]={tagColors:_.getComputedMap(v).tagColors.concat(_.getColoredTreeTagList())}),_._clearTempTreeMap()):_.getComputedMap(v)&&this.taggerView.warnForColorize(_.getComputedMap(v))}return f},toHtml:function(t,i,a,s,o,r){var l,c=this.id(),d=m.isInFavorites(c)||!1,g=this.taggerView.getObservedNavigator().getCache().isMoreClicked(),h=this.taggerView.getObservedNavigator().getCache(),u=(s=h.getSearchValue().toLowerCase(),h.isSearchVisible()&&""!==s&&("filter-all"===h.getSearchId()||h.getSearchId().replace("filter-","")===this._predicate.get6WRootFather().id().replace("ds6w:",""))),p=this._predicate.getElemOptions(),f=function(e){return-1!==e.getDisplayname().toLowerCase().indexOf(s)||e.getChildrenTagValueViews().some(f)};if(a=a||!1,(i=i||!1)===d){if(this._hiddenPredicate=u&&!this._tagValueViews.some(f),u&&!this._hiddenPredicate&&h.collapsePredicate(this.idForDOM()),this._tagValueMarkup="",this.destroyUiElement(a),l="",this._tagValueViews.length&&!a||a&&(p&&(!0===p.showByDefault||void 0===p.showByDefault)||g)){if(l=this.tvvToHtml(t,a,r)+"</div>",this.taggerView._simplifiedTagger&&!a)if("ds6w:type"==c)if("tag"==this.taggerView.getCacheSimplified().getViewMode(c)){var v=this.taggerView.buildTypeToggleElem({viewMode:"tag",text:n.getText("showLess")}),T=e.createElement();T.grab(v),l+=T.getHTML()}let i=/ /g;l+="</div></li><div id="+c.trim().replace(i,"_")+"></div>",l=this.headerToHtml(this._tagValueMarkup,this._hiddenPredicate,a)+l}return l}},headerToHtml:function(e,t,i){var a="",n=this.taggerView.isColorizePossible(this.id());return e=e||"",a+=m.predHeader(this,this.taggerView,e,t,null,!1,n,this.isColorized,i),a+=m.openingPredContent(this,!1,e,i)}})).openingPredContent=function(e,t,i,a){var n,s,o,r="";return e&&(s=e._predicate&&e._predicate.getType(),o=e.taggerView._simplifiedTagger?e.taggerView.getCacheSimplified().getViewMode(e._predicate.id()):""),n=!e.taggerView.getObservedNavigator().getCache().isPredicateCollapsed(e.taggerView._simplifiedTagger?e._id:e.idForDOM())||e.taggerView.observedNavImpl.hasProxiesInEdition()&&e._predicate.is6WRoot()||a,e.taggerView.observedNavImpl.hasFocusedProxyWithRelevantPredicate()&&(n=e.taggerView.getExpandStatus(e._id)||n),e.taggerView.isW&&e._predicate.is6WRoot()&&(n=t&&e._predicate.is6WRoot()),i=i||"",r+="<div class='predicate-content expandable'",e.taggerView.isW?r+=n?'style="height: auto; position: relative;"':'style="height: 0px; overflow: hidden;position: absolute;"':r+=n?'style="opacity: 1; height: auto; position: relative;"':'style="opacity: 0; height: 0px; overflow: hidden;position: absolute;"',h.getOption("activate_hierarchical_tag_scroll")&&e.getHasHierarchyTags()&&"date"!==s&&"tag"==o?r+="><div class='innerForTransition add-horizontal-scroll'>":r+="><div class='innerForTransition'>",r},m.getArrayDayOfMonth=function(e,t,i){var a,n,s,o=[];if(a="02"===t?e%4!=0||e%100==0&&e%400!=0?28:29:["04","06","09","11"].indexOf(t)>=0?30:31,i)for(s=1;s<=a;s++)n=s>9?String()+s:"0"+s,o.push(n);else for(s=a;s>0;s--)n=s>9?String()+s:"0"+s,o.push(n);return o},m.isInFavorites=function(e){return v[e]},m.more=function(e){var t="";return t+="<li class='tag more' title='"+e+" "+n.getText("moreHidden")+"'>",t+="<div class='tag-elem'><div class='tag-label'><span class='fonticon fonticon-dot-3'></span><span class='fonticon fonticon-right-dir'></span></div>",t+="<div class='tag-tail'><div class='tag-count'>"+n.convertToUnity(e)+"</div></div></div>",t+="</li>"},m.predHeader=function(e,t,i,s,o,r,l,c,d){var g,u,p,m=t.getObservedNavigator().getCache(),v=(r?"atv":"")+e.idForDOM(),T=!m.isPredicateCollapsed(t._simplifiedTagger?e._id:e.idForDOM())||t.observedNavImpl.hasProxiesInEdition()&&e._predicate.is6WRoot(),C=m.isCloud(e.idForDOM()),w=m.isToolboxVisible(e.idForDOM()),b=e.getDisplayname(),y=(e&&e._predicate&&e._predicate.getType(),o||e.getNbDescendantTagValues(),m.getCurrentSort(e._predicate.getFullPredicateID())),S=t._simplifiedTagger?t.getCacheSimplified().getViewMode(e._predicate.id()):m.getViewMode(e._predicate.id()),I=t.isProxyWithFilteringOnServer(),E=t.hasFreeInputSupport(e._id),x=t.hasFreeInputOnly(e._id),_=t.getExpandStatus(e._id),A=t.isGroupedBy(e._id),N=e._predicate.get6WRootFather().id().replace("ds6w:",""),V=t.observedNavImpl.hasProxiesInEdition(),P=m.isActivePredicate(e.getCompleteID()),D=0!==e.getChildrenTagValueViews().length&&e.getChildrenTagValueViews()[0].nbSubjectsTagged()<0,O=t.getObservedNavigator().isPreciseCount(),M=t.getObservedNavigator().isRelevantPredicate(e.id())&&!s,U=t.actionMode,F=m.colorManager.isColorized(e._predicate.getFullPredicateID())||m.colorManager.isInColorization(e._predicate.getFullPredicateID()),W=[e._id],R=t.getObservedNavigator().getHideCountProperty(W),j=!0,L=!1,k=t.getObservedNavigator().getFocusedProxy();if(R&&(j=!1),A||"ds6w:type"!=e._id||(A=t.isGroupedBy("type_categorization")),t.getObservedNavigator().hasDateRangeType(e._id)&&(k&&(E||x)?x=!0:L=!0),d){var B=e._predicate.getUnit();B&&(b+=" ("+B+")")}i=i||"",u="nbSort"===y.sortMode?(y.order?"asc ":"desc ")+"selected":y.secondaryorder?"asc ":"desc ",R?(u="","category"!=S&&"people"!=S&&(S="tag"),p="nbSort"===y.sortMode?"asc selected":(y.order?"asc ":"desc ")+"selected"):p="nbSort"===y.sortMode?y.secondaryorder?"asc ":"desc ":(y.order?"asc ":"desc ")+"selected";let G=!1;F&&!w&&(G=!0);let z=t.actionManager?t.actionManager.getCurrentAction()&&"colorize"==t.actionManager.getCurrentAction().id:void 0,H="3DDashboard"===t.observedNavImpl.getBrand()&&!t.observedNavImpl.getRightPanelContext()&&!t.observedNavImpl.hasWidgetMaximized()&&f.isDraggable(),J=f.builAttrString({predicateId:e.id(),fullPredicateId:e._predicate.getFullPredicateID(),type:e._predicate.getType(),contextId:t.observedNavImpl.id(),sort:y,currentViewMode:S});if(L)return"";g="<li class='predicate "+(H?"draggable-predicate ":"")+(M?"more-relevant ":"")+((e.taggerView.observedNavImpl.hasFocusedProxyWithRelevantPredicate()?_||T:T||d)?"expanded ":"")+(C?"":"list-view ")+N+(s?" searchexcluded ":"")+(c?" colorize ":"")+("when"==N&&U?" group-disabled ":"")+(P?" selected ":"")+"' id='"+v+(d?"sug":"")+"' data-rec-id='"+v+"' predicate='"+e.id()+"'"+(h.getOption("odt6WTagsAsWidget")?" draggable='true'":"")+"><div class='predicate-header"+(A?" grouped-by":"")+(H?" widget-item ":"")+"'title='"+b+"'"+(H&&J?J:"")+">",g+=r?"":t._simplifiedTagger?"<div class='arrow'><span class='fonticon fonticon-chevron-down'></span><span class='fonticon fonticon-chevron-right'></span></div>":"<div class='arrow'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>";let Y=e._predicate.getIcon();Y&&(g+="<div class='predicate-icon'>",Y.isFontIcon?g+="<span class='pred-icon fonticon "+Y.icon+"'></span></div>":g+="<img class='pred-icon' src='"+Y.icon+"'/></div>"),g+=t._simplifiedTagger?"<div class='predicate-label "+(H?"widget-item ":"")+(G?"adjust-width":"")+"'"+(H&&J?J:"")+"><div class='pred-label'>"+b+"</div>":"<div class='predicate-label'><span class='fonticon fonticon-3ds-"+N+"'></span>"+b,/*!isToolboxVisible && */A&&(g+="<span class='action-icon fonticon fonticon-group' action='group' title='"+n.getText("remove_groupBy")+"'></span>"),g+="</div>",g+="<a class='clear-selection "+(z&&F?"":"hide")+"' title='"+n.getText("clear-selections")+"'>"+n.getText("clearSearch")+"</a><span class='action-icon fonticon fonticon-palette "+(G&&!z?"":"hide")+"' action='colorize' title='"+n.getText("uncolorizeTags")+"'></span>";var X="category"==S,q="people"===S,K="ds6w:who"!==e._predicate.id()&&"ds6w:who"==e._predicate.get6WRootFather().id();if(!x&&!X){let i=e.getPredicateSummaryCount(t.hasFocusedProxy(),D);g+="<div class='predicate-count' title='"+i+"'>"+n.convertToUnity(i,O)+"</div>"}if("atvid_"!==v.substring(0,6)&&!d&&!x){if(g+="<div class='toolbox "+(w?"expanded":"")+"' title='"+n.getText("toolbox")+"'><span class='fonticon fonticon-menu-dot'></span>","ds6w:type"==e._id&&(X?(g+="<span class='tool-icon categoryViewIcon toolboxView fonticon fonticon-view-small-thb selected' title='"+n.getText("categoryView")+"' optionId='Show Categories'></span>",g+="<span class='tool-icon toolboxView fonticon tags-view "+(C?"fonticon-th-tag":"fonticon-list")+"' title='"+n.getText("tagsView")+"' optionId='Tags View'></span>",g+="<span class='option-disabled tool-icon sort fonticon fonticon-sort-alpha-asc selected' title='"+n.getText("alphabeticalOrder")+"' optionId='Alphabetical Order'></span>",j&&(g+="<span class='option-disabled tool-icon sort fonticon fonticon-sort-num-asc' title='"+n.getText("occurenceOrder")+"' optionId='Occurence Order'></span>",g+="<span class='option-disabled tool-icon toolboxView bar fonticon fonticon-chart-bar ' title='"+n.getText("barChart")+"' optionId='Bar Chart'></span>",g+="<span class='option-disabled tool-icon toolboxView pie fonticon fonticon-chart-pie ' title='"+n.getText("pieChart")+"' optionId='Pie Chart'></span>"),l&&(g+="<span class='option-disabled tool-icon toolboxView fonticon fonticon-palette "+(c?"selected ":"")+" "+(z?"hide":"")+"' title='"+n.getText("colorize")+"' optionId='Colorize'></span>")):t._simplifiedTagger&&(g+="<span class='tool-icon categoryViewIcon toolboxView fonticon fonticon-view-small-thb' title='"+n.getText("categoryView")+"' optionId='Show Categories'></span>")),K)if(q)"person"!=e._id?(g+="<span class='tool-icon peopleView toolboxView fonticon fonticon-user-alt selected ' title='"+n.getText("peopleView")+"' optionId='Show People'></span>",g+="<span class='tool-icon toolboxView fonticon tags-view "+(C?"fonticon-th-tag":"fonticon-list")+"' title='"+n.getText("tagsView")+"' optionId='Tags View'></span>",g+="<span class='tool-icon sort fonticon fonticon-sort-alpha-"+p+"' title='"+n.getText("alphabeticalOrder")+"' optionId='Alphabetical Order'></span>",j&&(g+="<span class='tool-icon sort fonticon fonticon-sort-num-"+u+"' title='"+n.getText("occurenceOrder")+"' optionId='Occurence Order'></span>"),!t.hasAdvancedFocsuedProxy()&&j&&(g+="<span class='tool-icon toolboxView bar fonticon fonticon-chart-bar ' title='"+n.getText("barChart")+"' optionId='Bar Chart'></span>",g+="<span class='tool-icon toolboxView pie fonticon fonticon-chart-pie ' title='"+n.getText("pieChart")+"' optionId='Pie Chart'></span>",l&&(g+="<span class='tool-icon toolboxView fonticon fonticon-palette "+(c?"selected ":"")+" "+(z?"hide":"")+"' title='"+n.getText("colorize")+"' optionId='Colorize'></span>"))):(g+="<span class='tool-icon sort fonticon fonticon-sort-alpha-"+p+"' title='"+n.getText("alphabeticalOrder")+"' optionId='Alphabetical Order'></span>",j&&(g+="<span class='tool-icon sort fonticon fonticon-sort-num-"+u+"' title='"+n.getText("occurenceOrder")+"' optionId='Occurence Order'></span>"));else if(t._simplifiedTagger&&!e._hasHierarchicalTags){let t=a.COMMUNITY_TAGS_PREDICATES["ds6w:who"].id(),i=a.COMPANY_TAGS_PREDICATES["ds6w:who"].id();e._id!=t&&e._id!=i&&(g+="<span class='tool-icon peopleView toolboxView fonticon fonticon-user-alt ' title='"+n.getText("peopleView")+"' optionId='Show People'></span>")}X||q||(g+="<span class='tool-icon toolboxView fonticon tags-view "+("tag"===S?"selected ":"")+(C?"fonticon-th-tag":"fonticon-list")+"' title='"+n.getText("tagsView")+"' optionId='Tags View'></span>",g+="<span class='tool-icon sort fonticon fonticon-sort-alpha-"+p+"' title='"+n.getText("alphabeticalOrder")+"' optionId='Alphabetical Order'></span>",!D&&j&&(g+="<span class='tool-icon sort fonticon fonticon-sort-num-"+u+"' title='"+n.getText("occurenceOrder")+"' optionId='Occurence Order'></span>",g+="<span class='tool-icon toolboxView bar fonticon fonticon-chart-bar "+("graphBar"===S?"selected ":"")+"' title='"+n.getText("barChart")+"' optionId='Bar Chart'></span>",g+="<span class='tool-icon toolboxView pie fonticon fonticon-chart-pie "+("graphPie"===S?"selected ":"")+"' title='"+n.getText("pieChart")+"' optionId='Pie Chart'></span>"),l&&(g+="<span class='tool-icon toolboxView fonticon fonticon-palette "+(c?"selected ":"")+" "+(z?"hide":"")+"' title='"+n.getText("colorize")+"' optionId='Colorize'></span>"),I&&E&&!V&&(g+="<span class='tool-icon toolboxView fonticon fonticon-text "+("freeInput"===S?"selected ":"")+"' title='"+n.getText("inputText")+"'></span>")),g+="</div>"}return g+="</div>"},m.freeInputToHtml=function(e,t){var i="";switch(e){case"string":i+="<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"date":i+="<span class='from add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>",i+="</div><div class='add-tag-cont fromto'>",i+="<span class='to add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"integer":case"float":case"double":e="integer"===e?"int":"float",i+="<span class='from add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>",i+="</div><div class='add-tag-cont fromto'>",i+="<span class='to add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span>";break;case"boolean":i+="<span class='boolean'></span>"}return i},m.createDateInput=function(t,i,a){var o,r,l={},c=["from","to"];for(o=0;o<c.length;o++)"from"==(r=c[o])&&i&&!i[r]&&i.to?l[r]=new s(e.merge({max:i&&"from"===r?new Date(i.to.value):null,min:i&&i[r]&&i[r]&&"to"===r?new Date(i[r].value):null,placeholder:n.getText(r),className:"date freeinput tagger-input "+r,renderTo:a},t)):(l[r]=new s(e.merge({max:i&&i[r]&&"from"===r&&i.to?new Date(i.to.value):null,min:i&&i[r]&&"to"===r&&i.from?new Date(i.from.value):null,placeholder:n.getText(r),className:"date freeinput tagger-input "+r,renderTo:a},t)),i&&i[r]&&l[r].setDate(i[r].value,!0));return l},m.destroyUiElements=function(){var e;for(e in T)T[e].destroyUiElement();for(e in T={},C)C[e].destroyUiElement(!0)},m.redrawUiElements=function(e,t){var i;if(e)for(i in C)C[i].redrawUiElement(!0);else for(i in T)t?T[i]._predicate.get6WRootFather().id()==t&&T[i].redrawUiElement():T[i].redrawUiElement()},m.getPvWithUiElemInSuggested=function(){return C},m.getPvWithUiElemInPage=function(){return T},m.checkActiveSearch=function(e){var t=e.getObservedNavigator().getFocusedProxy();if(!t)throw new Error("ERROR : AbstractPredicateView.checkActiveSearch is called when there is no focused proxy !!!");var i=e.getObservedNavigator().getCache().getCriteriaToResetBeforeFilterChange(t?t.id():void 0),a=e.getObservedNavigator().getCache().getCriteriaToRemoveBeforeFilterChange(t?t.id():void 0);return Object.keys(i).length>=2||1===Object.keys(i).length&&"ds6w:dataSource"!==Object.keys(i)[0]||0!==Object.keys(a).length&&(1===Object.keys(i).length?"ds6w:dataSource"!==Object.keys(i)[0]:Object.keys(i).length>=2)?(e.getSearchButton().enable(),!0):(e.getSearchButton().disable(),!1)},m.onSearchLaunch=function(e,t){var i,n,s,o,r,l,c,d=[],g=!1,h=["from","to"],u=e.getObservedNavigator().getFocusedProxy();if(!u)throw new Error("ERROR : AbstractPredicateView.onSearchLaunch is called when there is no focused proxy !!!");var p=e.getObservedNavigator().getCache().getCriteriaToResetBeforeFilterChange(u?u.id():void 0),f=e.getObservedNavigator().getCache().getCriteriaToRemoveBeforeFilterChange(u?u.id():void 0);if(m.checkActiveSearch(e)){for(i in t)if(o=a.getPredicate(i),p[i]){var v=p[i].type;switch(v){case"string":if((n=p[i].value).length)for(s=0,n.length;s<n.length;s++)d.push({type:"string",predicate:o,value:n[s].value,nls:n[s].label});break;case"boolean":(n=p[i].value)&&d.push({predicate:o,value:n.value,type:v,nls:n.label});break;case"integer":case"float":case"double":case"date":for(l={},s=0;s<h.length;s++)r=h[s],(n=p[i][r]?p[i][r].value:null)&&("date"!==v?(c=t[i].criterion,l[r]=n.replace(",","."),isNaN(parseFloat(l[r]))?(c[v][r].elements.input.addClassName("has-error"),g=!0):c[v][r].elements.input.removeClassName("has-error")):l[r]=n.getFullYear()+"/"+("0"+(n.getMonth()+1)).slice(-2)+"/"+("0"+n.getDate()).slice(-2),d.push({predicate:o,value:l,type:v}))}}!1===g&&e.observedNavImpl.updateFreeInputs(d,f)}},m}),define("DS/TagNavigator/RootPredicateView",["UWA/Class","DS/TagNavigator/AbstractPredicateView"],function(e,t){"use strict";var i,a={},n=["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"];return(i=e.extend(t,{init:function(e,t){this._isRootPredView=!0,this._predicateViews=[],this._parent(e,t)},getChildrenPredicateViews:function(e){var t,i,a,n;for(e||(e=function(){return!0}),n=[],i=0,a=this._predicateViews.length;i<a;i++)e((t=this._predicateViews[i]).id())&&n.push(t);return n},addPredicateView:function(e){var t;if(this.getChildrenPredicateViews(function(t){return t===e.id()}).length>0)throw new Error("Unexpected addition of already existing child PredicateView ");return e.isRootPredView()?this._predicateViews.push(e):(t=this.findInsertionPoint(this._predicateViews,e,this.predComparator),this._predicateViews.splice(t,0,e)),this},clearContent:function(){var e,t;for(e=0,t=this._predicateViews.length;e<t;e++)this._predicateViews[e].clearContent();return this._predicateViews=[],this._parent(),this},headerToHtml:function(e,i){var a,n;return this.taggerView.isW?(e||(e=""),n=function(e,t){var i,a,n;for(i=0,a=(n=this._predicateViews).length;i<a;i++)t+=n[i]._tagValueViews.length;return t}.bind(this),a=n(this,this._tagValueViews.length),this.rootpredHeader(this.idForDOM(),this.id(),!this.taggerView.observedNavImpl.getCache().isSectionCollapsed(this.id().replace("ds6w:","")),this._displayName,a)+t.openingPredContent(this,!this.taggerView.observedNavImpl.getCache().isSectionCollapsed(this.id().replace("ds6w:","")),!!this.taggerView.isW&&this.id().replace("ds6w:",""),e)):this._parent(e,i)},rootpredHeader:function(e,t,i,a,n){return"<div class='section ds6w-root-predicate "+t.replace(":","_")+(i?" expanded-section":"")+"' id='"+e+"'>"+this.taggerView.sectionHeaderToHtml(a.toLowerCase(),{count:n,isw:!0})},toHtml:function(e,i,a,n,s,o){var r;return r="",this._tagValueMarkup="",this._hiddenPredicate=!1,this.taggerView.isW?(r=this.headerToHtml(),this._tagValueViews.length&&(r+=this.tvvToHtml(e)),this._predicateViews.length&&(this._predicateViews.sort(this.predComparator),r+="<ul class='predicates-list'>"+this._predicateViews.map(function(e){return e.toHtml()}).join("")+"</ul>"),r+="</div></div></div>"):(s||(s=this.taggerView.observedNavImpl.getCache().get6WSort()),"sort-tag"===s?(this._predicateViews.length||this._tagValueViews.length)&&(this._tagValueViews.length&&!this.taggerView._simplifiedTagger&&(r+=this._parent(e,t.isInFavorites(this.id()),null,null,null,o)),this._predicateViews.length&&(this._predicateViews.sort(this.predComparator),r+=this._predicateViews.map(function(e){return e.toHtml()}).join(""))):this._tagValueViews.length&&(r+=this._parent(e,t.isInFavorites(this.id()),null,null,null,o))),r},hasExplicitTags:function(){return this._tagValueViews.length>0},toHtmlForSeach:function(){var e="";return this._tagValueViews.length&&(e+=this.tvvToHtml()),this._predicateViews.length&&(this._predicateViews.sort(this.predComparator),e+="<ul class='predicates-list'>"+this._predicateViews.map(function(e){return e.toHtml()}).join("")+"</ul>"),e}})).getRoots=function(e){var t,i,s,o;for("boolean"!=typeof e&&(e=!1),o=[],i=0,s=n.length;i<s;i++)t=a[n[i]],(!e||t.getNbDescendantTagValues()>0)&&o.push(t);return o},i.clear=function(){var e,t,i;if(Object.keys(a).length){for(t=0,i=n.length;t<i;t++)(e=a[n[t]])&&e.clearContent();a={}}return this},i.getRootPredicateView=function(e,t){var n=e.id();return a[n]||(a[n]=new i(e,t)),a[n]},i}),define("DS/TagNavigator/PredicateView",["UWA/Class","DS/TagNavigator/AbstractPredicateView","DS/TagNavigator/RootPredicateView","DS/TagNavigator/Logger"],function(e,t,i,a){"use strict";var n,s={};return(n=e.extend(t,{init:function(e,t){this._parent(e,t),this._rootPredicateView=n.getPredicateView(e.get6WRootFather(),this.taggerView),this._rootPredicateView.addPredicateView(this),this.weight=e.weight||1},clearContent:function(e){var t,i;for(this.destroyUiElement(),this.destroyUiElement(!0),t=0,i=this._tagValueViews.length;t<i;t++)this._tagValueViews[t].clearContent();return this._tagValueViews=[],this._tagValueViewsMap={},e||(this.taggerView=null),this.hasHierarchicalTags=!1,this}})).clear=function(){return s={},t.destroyUiElements(),this},n.getListOfHierarchyPredicates=function(){let e=[];for(let t in s)s[t]&&s[t].getHasHierarchyTags()&&e.push(t);return e},n.getPredicates=function(e,t){var i,a,n=[],o={},r=[],l=(a=s[Object.keys(s)[0]])&&a.taggerView&&a.taggerView.getObservedNavigator().hasWidgetMaximized()&&a.taggerView.getObservedNavigator().getFocusedProxy()&&a.taggerView.getObservedNavigator().getFocusedProxy().relevantPredicates.length;for(i in s)s.hasOwnProperty(i)&&(s[i]._isRootPredView?o[s[i]._id]=s[i]:n.push(s[i]));return["ds6w:who","ds6w:when","ds6w:what","ds6w:where","ds6w:why","ds6w:how"].forEach(function(e){o[e]&&r.push(o[e])}),"sort-weight"===e||!e&&l?r.concat(n).sort(function(e,i){var a=t&&t[e._id]?t[e._id].hasOwnProperty("weight")?t[e._id].weight:0:1,n=((t&&t[i._id]?t[i._id].hasOwnProperty("weight")?t[i._id].weight:0:1)||1)-(a||1);return 0===n?e._displayName.localeCompare(i._displayName):n}):"sort-alpha-asc"!==e&&e?"sort-alpha-desc"===e?r.concat(n).sort(function(e,t){return e._displayName.localeCompare(t._displayName)}).reverse():"sort-num-asc"===e?r.concat(n).sort(function(e,t){return e.nbDescendantTagValues-t.nbDescendantTagValues==0?e._displayName.localeCompare(t._displayName):e.nbDescendantTagValues-t.nbDescendantTagValues}):"sort-num-desc"===e?r.concat(n).sort(function(e,t){return t.nbDescendantTagValues-e.nbDescendantTagValues==0?e._displayName.localeCompare(t._displayName):t.nbDescendantTagValues-e.nbDescendantTagValues}):void 0:r.concat(n).sort(function(e,t){return e._displayName.localeCompare(t._displayName)})},n.getExistingPredicateViewById=function(e){return s[e]||null},n.getPredicateView=function(e,t){var a=e.id();return s[a]||(e.is6WRoot()?s[a]=i.getRootPredicateView(e,t):s[a]=new n(e,t)),s[a]},n.redrawUiElements=function(e,i){t.redrawUiElements(e,i)},n}),define("DS/TagNavigator/TagNavigatorManagerImpl",["UWA/Core","UWA/Class","DS/TagNavigator/TaggerProxy","DS/TagNavigator/TaggerProxyWithFilteringServices","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/TagValue","DS/TagNavigator/Filter","DS/TagNavigator/TagsServer","DS/TagNavigator/Logger","DS/TagNavigator/CacheManager","DS/TagNavigator/ActiveCriteria","DS/TagNavigator/TaggerSettings","DS/TagNavigator/UserSettings","DS/TagNavigator/Groupings","DS/MessageBus/MessageBus","DS/TagNavigator/TagWidget/TagWidgetUtils"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f,m){"use strict";var v,T,C;function w(t,s,l,u,b,y){var S,I,E,x,_,A,N,V,P,D,O,M,U,F,W,R,j=this,L=u?u.tagServers:null;if("string"!=typeof t)throw new Error("Invalid input arg");if(T.some(function(e){return(S=e).id()===t}))return S;e.is(l,"function")&&(F=l),_=new d,I=!0;let k="RightPanelContext"===(x=t);N=[],V={},O=(D=s)||k?null:"IsNotInWidget",M=null,P=new r,v||(v=this),A={},W=new p,E=function(){if(!I)throw new Error("TagNavigator #{"+x+"} is a zombie")},R={};var B=!1,G={};return this._predicateTagValuesMap={},this.locationTagValueMap={},this.eventsNotToConsider=new Map([["focusOnSubjects",!0],["setLocalGrouping",!0],["clearLocalGrouping",!0],["unfocus",!0],["navImplDie",!0],["toggleTagSelection",!0],["colorMap",!0]]),this.getInteractiveMoreTagsSectionStatus=function(){return B},this.setInteractiveMoreTagsSectionStatus=function(e){if("boolean"!=typeof e)throw new Error("More Tags expand status was not set!");B=e},this.createActiveCriteria=function(){null!==document.getElementById("active-tags")&&(this.activeCriteriaProxy||(this.activeCriteriaProxy=g.setupActiveCriteria({id:"taggerCriteria",contextId:x,container:"active-tags",module:"DS/TagNavigator/TaggerActiveCriteria",widgetId2contextId:F}),this.activeCriteriaProxy.addEvent("onCriteriaClick",function(e){this.dispatchEvent(w.events.CRITERIA_CLICK,e)},this),this.activeCriteriaProxy.addEvent("onTrashClick",function(e){this.dispatchEvent(w.events.TRASH_CLICK,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaPin",function(e){this.dispatchEvent(w.events.CRITERIA_PIN,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaUnpin",function(e){this.dispatchEvent(w.events.CRITERIA_UNPIN,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaRemove",function(e){this.dispatchEvent(w.events.CRITERIA_UNPIN,e),this.dispatchEvent(w.events.CRITERIA_CLICK,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaExclude",function(e){this.dispatchEvent(w.events.CRITERIA_EXCLUDE,e)},this),this.activeCriteriaProxy.addEvent("onCriteriaUnexclude",function(e){this.dispatchEvent(w.events.CRITERIA_UNEXCLUDE,e)},this),this.activeCriteriaProxy.addEvent("onGroupingClick",function(e){this.dispatchEvent(w.events.GROUPING_REMOVED,e)},this)),this.activeSearchProxy||(this.activeSearchProxy=g.setupActiveCriteria({id:"searchCriteria",contextId:x,container:"active-tags",module:"DS/TagNavigator/AdvancedSearchCriteria"}),this.activeSearchProxy.addEvent("onCriteriaClick",function(e,t){this.dispatchEvent(w.events.CRITERIA_CLICK2,[e,t])},this),this.activeSearchProxy.addEvent("onTrashClick",function(e){this.dispatchEvent(w.events.TRASH_CLICK,e)},this)))},this.createActiveCriteria(),this.tabId2tabTitle=function(){let t;return h.getOption("contextWidgetId")?x:e.is(b,"function")&&null!==b?t=b(x):void 0},this.widgetId2widgetTitle=function(){let t,i;return i=this.getFocusedProxy()?this.getFocusedProxy()._widgetId:null,h.getOption("contextWidgetId")?i:e.is(y,"function")&&null!==y&&null!==i?t=y(i):void 0},this.getIconVisibleBool=function(e){return!!V[e]&&(void 0!==V[e].localFilterIcon&&V[e].localFilterIcon)},this.setIconVisibleBool=function(e,t){V[e]&&(V[e].localFilterIcon=t)},this.getCache=function(){return _},this.setFavoritesStatus=function(e){U=e},this.isFavoritesExpanded=function(){return U},this.isAlive=function(){return I},this.isTagInEdition=function(e){var t=N;return j.hasProxiesInEdition()&&(t=this.getProxiesInEdition()),t.some(function(t){return t.isTagInEdition(e)})},this.isReadyForDisplay=function(){return!!this.isAlive()&&j.getProxiesToDisplay().every(function(e){return e.isReady()})},this.id=function(){return x},this._updateTagsServers=function(e){UWA.is(e,"object")&&(Object.keys(e).length>=Object.keys(L).length?L=e:c.error("Attempt to overwrite _tagServers by invalid input"))},this.getProxy=function(e){var t=null;E();try{t=new i(e,this),N.push(t),"FilteringOnServer"!==e.filteringMode&&(t=new a(t))}catch(e){throw new Error(e.message)}return e.widgetId&&!V[e.widgetId]&&(V[e.widgetId]={lastFocusedProxyId:null}),w.allProxiesMap[t.id()]=t,this.updateFocusedProxy(),t},this.hasFreeInputOnly=function(e){return this.getFocusedProxy()&&this.getFocusedProxy().hasFreeInputOnly(e)},this.hasFreeInputSupport=function(e){var t,i,a=!0,n=this.getProxiesToDisplay();for(t=0,i=n.length;t<i;t++)if(!0!==n[t].hasFreeInputSupport(e)){a=!1;break}return a},this.getGroupingInfo=function(){return W.getGroupingInfo()},this.getActiveGroupings=function(){return W.getActiveGroupings()},this._getProxiesHavingGroupingSupport=function(){let e=[],t=this.getProxiesToDisplay();for(let i=0;i<t.length;i++)t[i].hasGroupingSupport()&&e.push(t[i]);return e},this._getProxiesHavingSelectInAppSupport=function(){let e=[],t=this.getProxiesToDisplay();for(let i=0;i<t.length;i++)t[i].hasSelectInAppSupport()&&e.push(t[i]);return e},this.getProxiesHavingLoadMoreTagsPending=function(){let e=[],t=N;for(let i of t)i.hasLoadMoreTagsEnabled()&&!i.isFetchAllTagsCalled()&&e.push(i);return e},this.checkAllLoadMoreTagsProxiesPending=function(e){return this.getProxiesHavingLoadMoreTagsPending().length&&this.proxiesHavingPreferredTags().noPreferred.length&&this.dispatchTagsOnDemandToProxies("expander"),this.getProxiesWaitingForAllTags(e)&&this.removeProxyWaitingForAllTags(e),Object.keys(this.getProxiesWaitingForAllTags()).length},this.dispatchTagsOnDemandToProxies=function(e){this.getCache().setIsMoreTagsButtonClicked(!0);let t=this.getAllOnDemandSupportingProxies(),i=this.getCache().getSearchValue();t.forEach((t,a)=>{G[t.id()]=t,t.onLoadMoreTags(e,i)})},this.getAllOnDemandSupportingProxies=function(){let e=this.getProxiesHavingLoadMoreTagsPending(),t=this.getProxiesSupportingSearchLoadMoreTags(),i=[];return(e.length||t.length)&&(i=[...new Set([...e,...t])]),i},this.getProxiesWaitingForAllTags=function(e){return e?G&&G[e]:G},this.removeProxyWaitingForAllTags=function(e){G&&G[e]&&delete G[e]},this.getProxiesSupportingSearchLoadMoreTags=function(){let e=[],t=this.getProxiesToDisplay();for(let i of t)i.hasSearchLoadMoreTagsEnabled()&&e.push(i);return e},this.hasGroupingSupport=function(e,t){let i=this._getProxiesHavingGroupingSupport();return!!i.length&&(!e||!!function(i){let a=[];return i.forEach(i=>{a.push(i.hasGroupingSupport(e,t))}),a}(i).every(e=>!0===e))},this.isGroupedBy=function(e,t,i){var a=this.getFocusedProxy();return a?a.isGroupedBy(e,t,i):W.isGroupedBy(e,t,i)},this.setGroupedByStatus=function(e,t,i){var a=this.getFocusedProxy();a?a.groupBy(e,t,i):(W.computeGroupingInfo(e,i),this._getProxiesHavingGroupingSupport().forEach((e,i)=>{e.groupBy(null,t)}))},this.getGroupings=function(){let e={allGroupings:[],localGroupings:[]};return e.allGroupings=UWA.clone(this.getActiveGroupings()),this.getFocusedProxy()&&(e.localGroupings=UWA.clone(this.getFocusedProxy().getActiveGroupings())),e},this.setSelectInAppStatus=function(e){this._getProxiesHavingSelectInAppSupport().forEach((t,i)=>{t.selectInAppBy(e)})},this.proxiesHavingPreferredTags=function(){let e=this.getProxiesToDisplay(),t={noPreferred:[],supportingPreferred:[],noTags:[]};return e.forEach(e=>{e.relevantPredicates&&e.relevantPredicates.length?t.supportingPreferred.push(e):e.predicateTagsMap.size?t.noPreferred.push(e):t.noTags.push(e)}),t},this.hasExcludeSupport=function(e){var t=this.getProxiesToDisplay();let i=!1;return t.length>0&&(i=t.some(t=>t.hasExcludeSupport(e)),c.log("hasExcludeSupport status for the context ="+i)),i},this.hasSelectInAppSupport=function(){var e=this.getProxiesToDisplay();let t=!1;return e.length>0&&(t=e.some(e=>e.hasSelectInAppSupport()),c.log("hasSelectionSupport status for the context ="+t)),t},this.getExpandStatus=function(e){return this.getFocusedProxy().getExpandStatus(e)},this.hasEmbeddedView=function(){return!(!this.getFocusedProxy()||!this.getFocusedProxy().supportsEmbeddedView())},this.isPreciseCount=function(){return this.getProxiesToDisplay().every(function(e){return e.isPreciseCount()})},this.isAdvancedSearch=function(){return this.getFocusedProxy()&&this.getFocusedProxy().isAdvancedSearch()},this.getStoredTags=function(e){var t={contextId1:{"ds6w:when/ds6w:starts":{"date-string":{"2016/02":{disp:"February",uri:"2016/02"}}}}};for(one in t.contextId1)t.contextId1[one].forEach(function(e){var t=new o(e);P.isSelected(t)||P.toggle(t)})},this.setAsCurrent=function(){var e;return E(),this===v?this:(e=v,v=this,e.dispatchEvent(w.events.CHANGE_OF_CURRENT_TN,x),this.dispatchEvent("UPDATE_ICON"),this)},this.updatePinnedTag=function(e){var t=JSON.parse(localStorage.getItem("taggerPinned"))||{},i=(t=t[w._userId]||{})["3DDashboard"===w._brand?this.id():window.location.hostname]||{keep:[]},a=this,n=!1;i.keep.forEach(function(e){e&&!a.isSelected(e.predicate)&&(a.toggleTagSelection(e.predicate,void 0),n=!0)}),setTimeout(function(){n&&a.dispatchEvent(w.events.UPDATE_ACTIVECRITERIA)},1e3)},this.die=function(){var e,t,i;for(E(),e=0,t=(i=N.slice(0)).length;e<t;e++)i[e].die(!1);return N=[],M=null,_=null,-1!==T.indexOf(this)&&T.splice(T.indexOf(this),1),this.dispatchRedrawTagsEvent({event:"navImplDie"}),I=!1,this},this.removeProxy=function(e){var t;return-1!==(t=N.indexOf(e))&&N.splice(t,1),delete w.allProxiesMap[e.id()],this},this.removeProxiesOfCC=function(e){N.slice(0).forEach(function(t){if(t.widgetId()===e)try{t.die()}catch(e){c.log("removeAllProxies error: trying to remove an already removed proxy...")}})},this.removeProxyAfterSwitch=function(e){c.log("Enter removeProxyAfterSwitch, current navImpl id: "+this.id());var t=N.indexOf(e);-1!==t&&(c.log("proxyToRemove successfully located at index:"+t),N.splice(t,1))},this.addProxyAfterSwitch=function(e){c.log("Enter addProxyAfterSwitch, current navImpl id: "+this.id()),N.push(e),e.setNavImpl(this)},this.switchProxiesOnCC=function(e){if(c.log("Enter switchProxiesOnCC, current navImpl id: "+this.id()),e){c.log("proxies of widgetId id to swicth: "+e);var t=!1;if(N.forEach(function(i){i.widgetId()===e&&(console.error("switchProxiesOnCC: proxy with the given widget id already exist"),t=!0)}),!t){var i=this,a=!1;T.forEach(function(t){if(t)if(t.isAlive()){if(t.id()!==i.id()){c.log("finding the proxy on navImpl: "+t.id());var n=t.getProxiesArray();if(n)n.slice(0).forEach(function(n){n.isAlive()?n.widgetId()===e&&(c.log("adding proxy to this navImpl, proxy id="+n.id()),i.addProxyAfterSwitch(n),t.removeProxyAfterSwitch(n),a=!0):c.log("TaggerProxy '"+n.id()+"' is a zombie")})}}else c.log("navImpl is dead: "+t.id())}),a&&this.dispatchEvent(w.events.REDRAW_TAGS)}}},this.removeAllProxies=function(){N.slice(0).forEach(function(e){try{e.die()}catch(e){c.log("removeAllProxies error: trying to remove an already removed proxy...")}})},this.getProxiesToDisplay=function(e){var t=[],i=!1;return E(),e||(e=function(e){return!!e.isActive()&&((!M||M===e)&&(!(O&&!R[O]&&O&&O!==e.widgetId())&&(i||(i=null!==O&&e.hasSubjectsInEdition()),!0)))}),t=N.filter(e),i&&(t=t.filter(function(e){return e.hasSubjectsInEdition()})),t.editionMode=i,t},this.eachTagValue=function(e,t){return E(),j.getProxiesToDisplay().forEach(function(i){i.eachTagValue(e,t)}),this},this.listPredicates=function(e){var t,i={};UWA.is(e,"string")?i.allTagsInheritingFromType=e:i.allTagsOfType=e,E(),t=j.getProxiesToDisplay();var a={};return t.forEach(function(e){var t=e.id();e.eachTagValue(function(e){if(e){var i=e.pred.id();a[i]||(a[i]={}),a[i][t]||(a[i][t]=[]),a[i][t].push(e)}},i)}),a},this.isColorizePossible=function(){return j.getProxiesToDisplay().some(function(e){return e.colorizeSupport})},this.colorize=function(e){if(e&&e.tagColors){var t={tagColors:[]};e.tagColors.forEach(function(e){e.isComposite?e.object.forEach(function(i){var a=UWA.clone(e);delete a.isComposite,a.object=i,t.tagColors.push(a)}):t.tagColors.push(e)}),N.forEach(function(e){e.colorize(t)}),this.onRedrawEvent({event:"COLORIZE"});let i=e.tagColors[0].predicate;this.dispatchEvent("COLORIZE",i)}},this.unColorize=function(e){N.forEach(function(e){e.unColorize()}),this.onRedrawEvent({event:"UNCOLORIZE"}),this.dispatchEvent("COLORIZE",e)},this.isRelevantPredicate=function(e){var t;return E(),(t=!D||window.richClient?(t=this.getProxiesToDisplay())&&1===t.length?t[0]:void 0:this.hasWidgetMaximized()?this.getFocusedProxy():void 0)&&t.relevantPredicates&&t.relevantPredicates.length&&-1!==t.relevantPredicates.indexOf(e)},this.hasProxiesInEdition=function(){return E(),this.getProxiesToDisplay().editionMode},this.getProxiesInEdition=function(){var e;return E(),(e=this.getProxiesToDisplay()).editionMode?e:[]},this.hasWidgetMaximized=function(){return E(),D&&null!==O||!D&&k&&null!==O},this.getWidgetIds=function(){return Object.keys(V)},this.getActiveTags=function(){var e=[];return E(),P.each(function(t){return e.push(t)}),e},this.getLocalActiveTags=function(){var e=[];return E(),null!==this.getFocusedProxy()&&this.getFocusedProxy().getLocalFilter().each(function(t){return e.push(t)}),e},this.hasActiveTags=function(){E();var e=this.getFocusedProxy()?this.getFocusedProxy().getParameters():null;return!P.isEmpty()||e&&e.isReadyForSearch()},this.hasLocalActiveTags=function(){return E(),null!==this.getFocusedProxy()&&!this.getFocusedProxy().getLocalFilter().isEmpty()},this.isSelected=function(e,t){var i,a,n;(E(),e instanceof o)?a=e:(i=JSON.parse(e),UWA.is(L)&&(n=L[Object.keys(L)[0]]),a=i.isComposite?this._getCompositeTagValue(i):o.getTagValue(i.predicate,i.dispValue,i.object,i.type,null,n));return P.isSelected(a,t)||null!==this.getFocusedProxy()&&this.getFocusedProxy().getLocalFilter().isSelected(a,t)},this.isExcluded=function(e){var t,i,a;(E(),e instanceof o)?i=e:(t=JSON.parse(e),UWA.is(L)&&(a=L[Object.keys(L)[0]]),i=t.isComposite?this._getCompositeTagValue(t):o.getTagValue(t.predicate,t.dispValue,t.object,t.type,null,a));return P.isExcluded(i)||null!==this.getFocusedProxy()&&this.getFocusedProxy().getLocalFilter().isExcluded(i)},this.getListOfSelectedTagValues=function(e){return(null!==this.getFocusedProxy()?this.getFocusedProxy().getLocalFilter().getSelectedTagValues(e):[]).concat(P.getSelectedTagValues(e))},this.getSelectedAttributes=function(e){return this.getFocusedProxy().getLocalFilter().getSelectedAttributes(e)},this.isSelectedAttribute=function(e,t){return this.getFocusedProxy().getLocalFilter().isSelectedAttribute(e,t)},this.onRefine=function(e){var t,i;f.publish({channel:"TagWidgetInterface",topic:"laoding"}),E(),t=P.computeFilterObj(),this.dispatchEvent("FILTER_CHANGE",t),e||(i=function(e){return e.isActive()});var a=this.getProxiesToDisplay(i),n=[];return a.forEach(function(e,i){e.shouldBeWarned(t)?e.onBeforeRefine():n.push(i)}),a.forEach(function(e,t){-1==n.indexOf(t)&&e.onRefine()}),this},this.clearFilters=function(e){E();var t=this.getActiveTags(),i=this,a=this.getTagPinnedFromCurrentContext(),n=this.getFocusedProxy(),s="3DDashboard"===w._brand,o=!1;if(!(t.length>0&&a.length>0)||n&&s?n&&s||(o=P.count()>0,P.clear()):t.forEach(function(e){var t=!1;a.forEach(function(a){a=JSON.parse(a.predicate),t=t||i.isTheSameTag(e,a)}),t||(P.toggle(e),o=!0)}),n&&(o=n.getLocalFilter().count()>0,n.clearLocalFilter()),o&&this.onRefine(),!n&&W.hasActiveGroupings()&&(!e||e&&e.clearGrouping)){W.clear(),this._getProxiesHavingGroupingSupport().forEach(e=>{e.clearLocalGrouping({triggerGroupingChangeCB:!0},!0)})}return n&&n.hasActiveGroupings()&&(!e||e&&e.clearGrouping)&&n.clearLocalGrouping({triggerGroupingChangeCB:!0},!1),this},this.isTheSameTag=function(e,t){var i=!1;if(e.type===t.type){var a=e.object||e.uri,n=t.object||t.uri,s=e.predicate||e.pred.getFullPredicateID(),o=t.predicate;if(a===n&&s===o)i=!0;else if(a instanceof Array&&a.length===n.length){for(var r=!0,l=0;l<a.length;l++)r=r&&a[l]===n[l];i=r}}return i},this.setUserId=function(e){c.log("this.setUserId"),w._userId=e},this.getUserInfo=function(){return w._userId},this.getBrand=function(){return w._brand},this.getTagPinnedFromCurrentContext=function(){var e=JSON.parse(localStorage.getItem("taggerPinned"))||{};return((e=e[w._userId]||{})["3DDashboard"===w._brand?this.id():window.location.hostname]||{keep:[]}).keep},this.saveTagPinToLocal=function(e,t){var i=JSON.parse(localStorage.getItem("taggerPinned"))||{},a="",n=(i[w._userId]||{})[a="3DDashboard"===w._brand?this.id():window.location.hostname]||{keep:[]},s=!1;n.keep.forEach(function(i,a){var o=UWA.is(e,"object")?e:JSON.parse(e),r=UWA.is(i.predicate,"object")?i.predicate:JSON.parse(i.predicate);i.predicate===e&&(s=!0),!1===s&&"date"===o.type&&o.predicate===r.predicate&&(n.keep.splice(a,1),n.keep.push({predicate:e,DOMId:t}),s=!0)}),!s&&n.keep.push({predicate:e,DOMId:t}),i[w._userId]=i[w._userId]||{},i[w._userId][a]=n,localStorage.setItem("taggerPinned",JSON.stringify(i)),this.dispatchEvent(w.events.UPDATE_ACTIVECRITERIA),this.dispatchRedrawTagsEvent({event:"pinTag"})},this.clearTagPinInLocal=function(e,t,i){var a=JSON.parse(localStorage.getItem("taggerPinned"))||{},n="",s=(a[w._userId]||{})[n="3DDashboard"===w._brand?this.id():window.location.hostname]||{keep:[]},o=-1,r=0,l=s.keep.length,c=0;for(r=0;r<l;r++){-1===c&&(c=0);var d=s.keep[c];this.isTheSameTag(JSON.parse(d.predicate),JSON.parse(e))&&(o=r);var g=JSON.parse(e),h=JSON.parse(d.predicate);if(/*!isSimplified &&*/"date"===g.type&&"date"===h.type&&g.predicate===h.predicate){var u=this.getFilters(null,!0);!0===u.allfilters.hasOwnProperty(h.predicate)&&(u.allfilters[h.predicate][0].object===g.object?(UWA.is(u.allfilters[h.predicate][0].parent)&&(g.object=u.allfilters[h.predicate][0].parent.object,g.dispValue=u.allfilters[h.predicate][0].parent.disptext),e=JSON.stringify(g),this.isTheSameTag(JSON.parse(d.predicate),JSON.parse(e))||s.keep.push({predicate:e,DOMId:t}),s.keep.splice(c,1),c-=1):u.allfilters[h.predicate][0].parent.object===g.object?(UWA.is(u.allfilters[h.predicate][0].parent.parent)&&(g.object=u.allfilters[h.predicate][0].parent.parent.object,g.dispValue=u.allfilters[h.predicate][0].parent.parent.disptext),e=JSON.stringify(g),this.isTheSameTag(JSON.parse(d.predicate),JSON.parse(e))||s.keep.push({predicate:e,DOMId:t}),s.keep.splice(c,1),c-=1):(s.keep.splice(c,1),c-=1)),o=-1}c+=1}-1!==o&&s.keep.splice(o,1),a[w._userId]=a[w._userId]||{},a[w._userId][n]=s,localStorage.setItem("taggerPinned",JSON.stringify(a)),this.dispatchEvent(w.events.UPDATE_ACTIVECRITERIA),this.dispatchRedrawTagsEvent({event:"pinTag"})},this.getFilters=function(e,t,i,a){return P.computeFilterObj(null,e,t,i,a)},this.toggleComplexTagSelection=function(e,t,i){this.getFocusedProxy().getLocalFilter().toggle(e,i),!1!==t&&this.onRefine()},this._getCompositeTagValue=function(e,t){return new o(new n({sixw:e.predicate,type:e.type}),{type:e.type,uri:e.object,displayValue:e.dispValue,hasDisplayValue:!0,isComposite:!0},t)},this.hasDateRangeType=function(e){let t=!1,i=j.getProxiesToDisplay();for(let a=0;a<i.length;a++)i[a]&&i[a].isDateRange(e)&&(t=!0);return t},this.updateCriteriaBasedOnFilters=function(e){var t;c.log("filterData :-",e);let i=j.getProxiesToDisplay();for(let l=0;l<i.length;l++){var a=this.getCache().getCriteriaToResetBeforeFilterChange(i[l].id());for(let l in a){var s=l,o=[];if(e.condition.forEach(e=>{for(let t in e)o.push(Object.keys(e)[0].split("/").pop())}),o.includes(s))e.condition.forEach(e=>{let o=Object.keys(e),r=o[0].split("/").pop();if(s===r&&a[s].value&&(t=a[s].value.find(t=>!e[o].some(e=>t.label===e.displayValue)))){let e=n.getPredicate(r);i[0].removeFreeInputs([{predicate:e,type:"string",value:t.value}],!1)}});else{let e=n.getPredicate(s);if(a[s].value&&a[s].value.length>0&&"string"===a[s].type)i[0].removeFreeInputs([{predicate:e,type:"string",value:a[s].value[0].value}],!1);else if("date"===a[s].type){var r=function(e){var t=new Date(e);return t.getFullYear()+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+("0"+t.getDate()).slice(-2)};let t={predicate:e,type:"date",value:{}};a[s].from?t.value.from=r(a[s].from.value):a[s].to&&(t.value.to=r(a[s].to.value)),i[0].removeFreeInputs([t],!1)}}}}},this.getHideCountProperty=function(e){let t,i=!1,a=j.getProxiesToDisplay();for(let n=0;n<a.length&&!t;n++)if(a[n].hidePredicateCounts)for(let s=0;s<e.length;s++){let o=a[n].hidePredicateCounts[e[s]];if(o)UWA.is(o.hideCount,"boolean")&&(i=o.hideCount,t=o.hideCount);else{if(UWA.is(t,"boolean"))continue;{let e=a[n].getCountDisplayStatus();e&&(i=e)}}}return i},this.toggleTagSelection=function(e,t,i){var a,n,s,r;if(E(),(n=UWA.is(e,"object")?e:JSON.parse(e)).isComplex)return this.toggleComplexTagSelection(n,i);s=n.isComposite?this._getCompositeTagValue(n):o.getTagValue(n.predicate,n.dispValue,n.object,n.type),o.updateDisplayValue(s);var l="3DDashboard"===w._brand;"3DDashboard"===w._brand?null!==this.getFocusedProxy()&&l&&(r="local"):null!==this.getFocusedProxy()&&(P.isSelected(s)?this.getFocusedProxy().getLocalFilter().isSelected(s)&&(r="local"):r="local_selectedFilters");var c=!1;if("local"===r||"local_selectedFilters"===r){var d=this.getFocusedProxy().updateSelectedTVLocalFilter(r,s,t,i);UWA.is(d,"boolean")?a=d:UWA.is(d,"object")&&(a=d.isSelected)}else if(P.isSelected(s)&&this.getTagPinnedFromCurrentContext().forEach(function(t){t.predicate===e&&(c=!0)}),!c){var g=P.toggle(s,i);UWA.is(g,"boolean")?a=g:UWA.is(g,"object")&&(a=g.isSelected)}return"date"===n.type&&this.getCache().colorManager.clearComputedColorMap(n.predicate),!1!==t&&(N.length?this.onRefine():this.dispatchRedrawTagsEvent({event:"toggleTagSelection"})),a},this.updateFreeInputs=function(e,t){E(),null!==this.getFocusedProxy()&&this.getFocusedProxy().updateFreeInputs(e,t)},this.createFreeInputs=function(e,t){E(),null!==this.getFocusedProxy()&&this.getFocusedProxy().createFreeInputs(e,t)},this.removeFreeInputs=function(e,t){E(),null!==this.getFocusedProxy()&&this.getFocusedProxy().removeFreeInputs(e,t)},this._handleExclude=function(e,t){if(!this.hasExcludeSupport())throw new Error("TagNavigatorManagerImpl#handleExclude: CANNOT handle the operation, EXCLUDE NOT SUPPORTED on the context");{let a,n=this.getFocusedProxy();n?a=n.getLocalFilter():(a=P,this.dispatchEvent("onBeforeGlobalFilterChange"));let s=UWA.is(e,"object")?e:JSON.parse(e);if(e.isComplex)a.handleExclude(e,t),this.onRefine(!!n);else{var i=s.isComposite?this._getCompositeTagValue(s):o.getTagValue(s);if(!(a.isSelected(i)||"date"==i.type&&a.isSelectedDate(i)))throw new Error("TagNavigatorManagerImpl#handleExclude: CANNOT handle the operation, tag is not selected");a.handleExclude(i,t),this.onRefine(!!n)}this.dispatchEvent(w.events.UPDATE_ACTIVECRITERIA)}},this.excludeTag=function(e){this._handleExclude(e,!0)},this.undoExcludeTag=function(e){this._handleExclude(e,!1)},this.requestSuggestions=function(e,t){var a,n=this.getFocusedProxy();null!==n&&(a={suggestField:e,suggestTitle:t,allfilters:n.getFilters().allfilters,localfilters:n.getFilters().localfilters},n.triggerCallbackOfEvent(i.RequestSuggestions,a))},this.clickOnMoreButton=function(e){E(),A[e]?A[e]+=h.getOption("moreTagsToAdd"):A[e]=7+h.getOption("moreTagsToAdd")},this.getMoreLimitForPredicate=function(e){return E(),A[e]||7},this.createTagValue=function(e,t,i){var a,s=this;if(E(),!this.hasProxiesInEdition())throw new Error("Unexpected creation of tag without a proxy in edition");if(!(t instanceof n&&"string"==typeof e))throw new Error("Invalid input arg");return a=function(){s.modifiedPredicate=t,s.dispatchEvent(w.events.REDRAW_TAGS)},this.getProxiesInEdition().forEach(function(n){n.createTagValue(e,t,a,i)}),this},this.deleteTagValue=function(e,t){var i,a=this;if(E(),!this.hasProxiesInEdition())throw new Error("Unexpected delete of tag without a proxy in edition");if(!(t instanceof n))throw new Error("Invalid input arg");return i=function(){return a.removeTagValueFromPredicateMap(e,t),a.dispatchEvent(w.events.REDRAW_TAGS)},this.getProxiesInEdition().forEach(function(a){a.deleteTagValue(e,t,i)}),this},this.getCriteriaIdsMap=function(){return this.getFocusedProxy()?this.getFocusedProxy().getCriteriaIdsMap():{}},this.updateFocusedProxy=function(){var e,t;O&&((t=this.getFocusedProxy())&&t._widgetId===O&&t.isActive()?e=t:(e=this.getProxyToFocusFromWidgetId(O),this.toggleProxyFocus(e,!0))),this.dispatchEvent("UPDATE_ICON"),"3DDashboard"===w._brand&&this.dispatchEvent(w.events.UPDATE_ACTIVECRITERIA)},this.focusOnCC=function(e){return window.proxyLogs&&(c.group("Focus on widget"),c.info("Widget id : ",e),c.groupEnd("Focus on widget")),E(),!D&&!k||"IsNotInWidget"===e?(c.error("Request to focus on widget, but not a widget"),this):(O=e,R&&R[e]?this:(this.updateFocusedProxy(),this.getFocusedProxy()&&this.getFocusedProxy().informProxyOfFocusChange({isFocused:!0}),this))},this.unfocusCC=function(){return window.proxyLogs&&(c.group("Unfocus widget"),c.info("Widget id : ",O),c.groupEnd("Unfocus widget")),E(),O=null,this.removeFocusedProxy(!0),this},this.getWidgetMaximized=function(){return O},this.getFocusedProxy=function(){return M},this.hasSubjectsInEdition=function(){let e=this.getFocusedProxy();return!!e&&e.hasSubjectsInEdition()},this.getProxyToFocusFromWidgetId=function(e){var t,i=V[e]?V[e].lastFocusedProxyId:void 0;return N.some(function(a){if(a._widgetId===e&&a._isActive){if(!t&&(t=a,!i))return!0;if(a._id===i)return t=a,!0}return!1}),t},this.removeFocusedProxy=function(e){this.getFocusedProxy()&&this.getFocusedProxy().informProxyOfFocusChange({isFocused:!1}),this.toggleProxyFocus(M,!1),this.dispatchEvent("UNFOCUS",e),this.dispatchEvent("UPDATE_ICON")},this.toggleProxyFocus=function(e,t){var i=null;e?(e!==M&&null!==M&&(i=M),(M=t?e:null)&&(V[M._widgetId].lastFocusedProxyId=M._id),i&&i.updateProxyView(i._selectedValues.isEmpty(),!0,!1),e.updateProxyView(e._selectedValues.isEmpty(),!0),e._widgetId,e._id):this.dispatchRedrawTagsEvent({event:"toggleProxyFocus"})},this.hasFocusedProxyWithRelevantPredicate=function(){var e=this.getProxiesToDisplay();if(UWA.is(e,"array")&&1===e.length&&e[0]){let t=e[0].hasRelevantPredicates();if(t&&t.length>0&&e[0]===this.getFocusedProxy())return e[0]}},this.showCustomCountOnHierarchy=function(e){var t=this.getProxiesToDisplay();if(1==t.length)return t[0].isFeatureSupported("customCountOnHierarchicalTags")},this.hasPreferredPredicates=function(e){var t=this.getFocusedProxy();if(t)return c.log("Proxy is focused."),t.hasRelevantPredicates(e);c.log("Proxy is unfocused, checking if all proxies support preferred Predicates");var i=this.getProxiesToDisplay();if(i.length>0){var a=[];for(var n of(i.forEach(t=>{!t.predicateTagsMap.size||a.push(t.hasRelevantPredicates(e))}),a))if(!n||0==n.length)return void c.log("One of the proxy does not support preferred predicates.");c.log("All proxies support preferred Predicates: Taking union of all Predicates from all proxies");var s=new Set;for(var n of a)for(var o of n)s.add(o);return s.has("computedCountryInfo")&&s.delete("computedCountryInfo"),c.log(`Predicate List: ${[...s]}`),[...s]}c.log("No proxies found in the current context.")},this.hasHiddenPredicates=function(){var e=this.getFocusedProxy();if(e)return c.log("Proxy is focused, return all hidden predicate list for focused proxy."),e.getHiddenPredicates();c.log("Proxy is unfocused, get all hidden predicates from each proxy.");var t=this.getProxiesToDisplay().map(e=>e.getHiddenPredicates()),i=new Set(t[0]);for(var a of t.slice(1)){if(0==i.length||!a||0==a.length)return void c.log("The intersection is empty: At least one proxy does not have support for each predicate to display");var n=a.filter(e=>i.has(e));i=new Set(n)}return c.log(`Hidden Predicate List: ${[...i]}`),[...i]},this.getProxyPreferredSortOrder=function(){var e=this.getFocusedProxy();if(e)return e.getSortOrder()},this.getTaggerViewVisibility=function(){return C},this.updateDisplayStatus=function(e){C=e;var t=this;T.forEach(function(i){if(i)if(i.isAlive()){var a=i.getProxiesArray();a&&a.forEach(function(a){a.isAlive()?a.updateTaggerDisplayStatus(e,i.id()===t.id()):c.log("TaggerProxy '"+a.id()+"' is a zombie")})}else c.log("navImpl is dead: "+i.id())})},this.getProxiesArray=function(){return N},this.setColorMap=function(e){_.colorManager.setColorMap(e),this.dispatchRedrawTagsEvent({event:"setColorMap"})},this.getTagsServerForUserInfo=function(){var e,t=this.getFocusedProxy();return t&&(e=t.getTagsServers(),UWA.is(e,"object")&&(e=e[Object.keys(e)[0]])),e||1===Object.keys(L).length&&(e=L[Object.keys(L)[0]]),e},this.isInternalProduction=function(){return!!h.getOption("internalProd")||(L&&1===Object.keys(L).length&&(e=L[Object.keys(L)[0]]),e&&"DSEXT001"===e.getTenantName().toUpperCase());var e},this.getTenantList=function(){if(L&&Object.keys(L).length>0)var e=L;return e},this.dispatchRedrawTagsEvent=function(e){this.preparePredicateTagMap(),this.isReadyForDisplay()&&e&&!this.eventsNotToConsider.has(e.event)&&this.onRedrawEvent(e),e&&"pinTag"!==e.event&&this.dispatchEvent("REDRAW_TAGS",e)},this.onRedrawEvent=function(e){if(C||Object.keys(R).length){let t=o.getPredicateValue(),i=o.translateOntologyTagValues(),n=a.getExplicitTags();Promise.all(t.concat(i).concat(n)).then(function(t){f.publish({channel:"TagWidgetInterface",topic:"redraw",data:e})})}},this.dispatchInfoMessageEvent=function(e){this.dispatchEvent("SET_MESSAGE_ON_VIEW",e),f.publish({channel:"TagWidgetInterface",topic:"InfoMessageEvent",data:e})},this.registerTagWidget=function(e){R[e]||(R[e]="alive")},this.deregisterTagWidget=function(e){R[e]&&delete R[e]},this.removeTagValueFromPredicateMap=function(e,t){let i=t.id(),a=o.getTagValue(t,e,e).fullid;delete this._predicateTagValuesMap[i][a],0===Object.keys(this._predicateTagValuesMap[i]).length&&delete this._predicateTagValuesMap[i]},this.preparePredicateTagMap=function(){let e=this;this._predicateTagValuesMap={};let t=this.getFocusedProxy(),i=!!t&&t.hasSubjectsInEdition(),a=[];(a=t?[t]:this.getProxiesToDisplay()).length&&a.forEach(t=>{if(i){let i=t._subjectsInEdition,a=t._subjectsTagValuesMap;i.forEach(i=>{if(t._tagValuesIdxForSubject[i]){t._tagValuesIdxForSubject[i].forEach(n=>{let s;t._tagValuesMap[n]?s=t._tagValuesMap[n]:a[i][n]&&(s=a[i][n]);let o=s.pred.id(),r=e._predicateTagValuesMap[o];r||(e._predicateTagValuesMap[o]={}),r=e._predicateTagValuesMap[o];let l=s.fullid;r[l]||(r[l]=[]),s.addCount=1,s.addCount>0&&r[l].push(s)})}})}else for(let i in t._predicateTagValuesMap){let a=e._predicateTagValuesMap[i];a||(e._predicateTagValuesMap[i]={}),a=e._predicateTagValuesMap[i],t._predicateTagValuesMap[i].forEach(e=>{let i=e.fullid;a[i]||(a[i]=[]),e.addCount=t.getNbSubjectsForTagValue(e),e.addCount>0&&a[i].push(e)})}})},this.getLocationTagValueMap=function(){return this.locationTagValueMap},this.setLocationTagValueMap=function(e){this.locationTagValueMap=e},this.getTagInfo=function(e){let t;return t=this.locationTagValueMap[e]?this.locationTagValueMap[e]:this._predicateTagValuesMap[e],m.getTagInfo(t,this)},this.getPredicateTagsMap=function(e){let t=[];for(let i in this._predicateTagValuesMap)Object.keys(this._predicateTagValuesMap[i])[0].contains(e)&&t.push(i);return t},this.getCurrentTenantId=function(){let e=this.getTenantList();if(UWA.is(e,"object")&&Object.keys(e).length)return Object.keys(e)[0]},this.getRightPanelContext=function(){return k},this.infoMessageCB=function(){let e=this.getProxiesToDisplay(),t=this.getFocusedProxy()?this.getFocusedProxy():1===e.length?e[0]:null;t&&t.infoMessageLinkCB()},T.push(this),this}e.extend(w.prototype,t.Events.prototype),w.count=function(){return T.length},w.events={CHANGE_OF_CURRENT_TN:"CHANGE_OF_CURRENT_TN",UNFOCUS:"UNFOCUS",UPDATE_ICON:"UPDATE_ICON",REDRAW_TAGS:"REDRAW_TAGS",REDRAW_CRITERIA:"REDRAW_CRITERIA",FILTER_CHANGE:"FILTER_CHANGE",OPEN_TAGGER:"OPEN_TAGGER",CLOSE_TAGGER:"CLOSE_TAGGER",SEARCH_LAUNCH:"SEARCH_LAUNCH",CRITERIA_CLICK:"CRITERIA_CLICK",CRITERIA_CLICK2:"CRITERIA_CLICK2",TRASH_CLICK:"TRASH_CLICK",CRITERIA_PIN:"CRITERIA_PIN",CRITERIA_UNPIN:"CRITERIA_UNPIN",CRITERIA_EXCLUDE:"CRITERIA_EXCLUDE",CRITERIA_UNEXCLUDE:"CRITERIA_UNEXCLUDE",GROUPING_REMOVED:"GROUPING_REMOVED",UPDATE_ACTIVECRITERIA:"UPDATE_ACTIVECRITERIA",STATUS_UPDATE:"STATUS_UPDATE",REQUEST_GROUPING_CHANGE:"REQUEST_GROUPING_CHANGE",COLORIZE:"COLORIZE",SET_MESSAGE_ON_VIEW:"SET_MESSAGE_ON_VIEW",UPDATE_ADDITIONAL_CRITERIA:"UPDATE_ADDITIONAL_CRITERIA",SET_ADD_FILTER_PROPERTIES:"SET_ADD_FILTER_PROPERTIES"},w.allProxiesMap={},T=[],v=null,w.isTagPinned=function(e,t,i){"3DDashboard"===w._brand||(e=window.location.hostname);var a=JSON.parse(localStorage.getItem("taggerPinned"))||{},n=(a=a[w._userId]||{})[e]||{keep:[]},s=!1;return n.keep.forEach(function(e){var a=UWA.is(e.predicate,"object")?e.predicate:JSON.parse(e.predicate);if(a.predicate===t)if("date"===i.type)i.object!==a.object?UWA.is(i.parent)&&i.parent.object!==a.object?UWA.is(i.parent.parent)&&i.parent.parent.object===a.object&&(s=!0,i.parent.parent.isPinnedActive=!0,i.parent.isPinnedActive=!1,i.isPinnedActive=!1):(i.isPinnedActive=!1,i.parent&&(i.parent.isPinnedActive=!0,UWA.is(i.parent.parent)&&(i.parent.parent.isPinnedActive=!0)),s=!0):(s=!0,i.isPinnedActive=!0);else if(i.object===a.object)s=!0;else if(i.object instanceof Array&&i.object.length===a.object.length){for(var n=!0,o=0;o<i.object.length;o++)n=n&&i.object[o]===a.object[o];s=n}}),s};try{g.init(w.allProxiesMap)}catch(e){c.log("Issue in ActiveCriteria.init, message="+e.message)}return w}),define("DS/TagNavigator/TaggerActiveCriteria",["UWA/Core","DS/TagNavigator/TaggerNLS","DS/TagNavigator/ActiveTagView","DS/TagNavigator/TagNavigatorManagerImpl"],function(e,t,i,a){"use strict";return function(){var n={},s={},o={};function r(e){if(e.withoutPredHeader)return"";var t=e.predicate.split("/"),i=t[0].split(":")[1],a=o[t.join("/")]||t[t.length-1].split(":")[1],n='<li class="predicate expanded list-view selected '+i+'" id="atv'+g(t.join("/"))+'">';return n+='<div class="predicate-header" title="'+a+'"><div class="predicate-label">',n+='<span class="fonticon fonticon-3ds-'+i+'"></span>'+a+"</div></div></li>"}function l(t,a){var n,s=0,o=0,r=["year","month","day"],l=e.createElement(),c={id:void 0,text:void 0,icon:void 0,isPinned:!1,isExcluded:!1,isSimplified:a.isSimplified,onePerLine:a.onePerLine,disabled:!1,hasActions:!1,withoutTitle:a.isSimplified};a.withRootIcon&&(n="fonticon-3ds-"+a.predicate.split("/")[0].split(":")[1]);var d,g=!a.proxyId&&a.is3DDashboard,h=function(e,t){g&&e.addClassName("canBePinned"),t.canBeExcluded&&e.addClassName("canBeExcluded"),a.globalTag&&e.addClassName("globalTag"),a.isSimplified&&e.setAttributes({"context-id":a.contextId,"proxy-name":"taggerCriteria","predicate-name":a.predicate.split("/").pop()})};for(s=0;s<t.length;s++)if(c.icon=n,c.isPinned=t[s].isPinned,a.globalTag&&(c.disabled=a.is3DDashboard&&a.proxyId),c.isExcluded=UWA.is(t[s].isExcluded,"boolean")?t[s].isExcluded:void 0,a.globalTag&&a.is3DDashboard&&!a.proxyId?c.hasActions=!0:a.proxyId&&t[s].canBeExcluded&&(c.hasActions=!0),c.hasActions=a.globalTag&&a.is3DDashboard||t[s].canBeExcluded,t[s].text instanceof Array)for(o=0;o<t[s].text.length;o++)c.text=t[s].text[o],c.id=t[s].tagId[o]+"atv",c.onePerLine&&(c.onePerLine=!1),o>0&&a.withRootIcon&&!a.isSimplified&&(c.icon=null),c.hasActions=!1,a.globalTag&&a.is3DDashboard&&(c.hasActions=!0),a.proxyId&&t[s].canBeExcluded&&t[s].canBeExcluded[o]&&(c.hasActions=!0),c.hasActions&&t[s].isExcluded&&(c.isExcluded=t[s].isExcluded[o]),(d=new i(c).render()).container.addClassName(r[o%r.length]),h(d.container,{canBeExcluded:t[s].canBeExcluded&&t[s].canBeExcluded[o]}),l.grab(d.container);else c.id=t[s].tagId+"atv",c.text=t[s].text,c.onePerLine=a.onePerLine,h((d=new i(c).render()).container,{canBeExcluded:t[s].canBeExcluded}),l.grab(d.container);return l.getHTML()}function c(e,t){if(e&&"string"==typeof e)return!(0===e.length||t&&t instanceof RegExp&&!t.test(e));if(e instanceof Array){for(var i=0;i<e.length;i++)if(!e[i]||"string"!=typeof e[i]||0===e[i].length||t&&t instanceof RegExp&&!t.test(e[i]))return!1;return!0}return!1}function d(e){if(0===Object.keys(e).length)return!1;for(var t in e)if(e[t].length>0)return!0;return!1}function g(e){var t,i,a;if(t=0,0!==e.length)for(i=0,a=e.length;i<a;i++)t=(t<<5)-t+e[i].charCodeAt(0),t&=t;return s[t="id_"+t]=e,t}function h(e,t,i){var a={predicate:t,object:e.object};return i?(a.dispValue=e.display,a.type=e.type,a.isComplex=!0):(a.dispValue=e.disptext||e.display,a.type=e.type),e.isComposite&&(a.isComposite=!0),g(JSON.stringify(a))}this.setActiveCriteria=function(e,t){var i,a,n,s,r,l,d={};t.isSimplified,r={allproxies:{},localfilters:{}};var g=function(e,i){l=[],d=[];var a=t.isTagPinned(t.contextId,e,i);UWA.is(i.isPinnedActive)&&!1===i.isPinnedActive?(l=[i.disptext],d=[h(i,e)],UWA.is(i.parent)&&!1===i.parent.isPinnedActive?(l.push(i.parent.disptext),d.push(h(i.parent,e)),UWA.is(i.parent.parent)&&!0===i.parent.parent.isPinnedActive&&(n=[i.parent.parent.disptext],s=[h(i.parent.parent,e)])):UWA.is(i.parent)&&(n=[i.parent.disptext],s=[h(i.parent,e)],UWA.is(i.parent.parent)&&!0===i.parent.parent.isPinnedActive&&(n.push(i.parent.parent.disptext),s.push(h(i.parent.parent,e))))):(n=[i.disptext],s=[h(i,e)],i.parent&&(n.push(i.parent.disptext),s.push(h(i.parent,e)),i.parent.parent&&(n.push(i.parent.parent.disptext),s.push(h(i.parent.parent,e))))),r.allproxies[e]=[{text:n.reverse(),tagId:s.reverse(),isPinned:a}],UWA.is(l,"array")&&l.length>0&&r.allproxies[e].push({text:l.reverse(),tagId:d.reverse(),isPinned:!1})};for(i in e.allfilters)(a=e.allfilters[i]).length>0&&"date"===a[0].type?1===a.length&&g(i,a[0]):r.allproxies[i]=a.map(function(e){return{text:e.disptext,tagId:h(e,i),isPinned:t.isTagPinned(t.contextId,i,e),canBeExcluded:t.canBeExcluded(i),isExcluded:e.excluded}});if(c([t.widgetId,t.proxyId])&&e.localfilters)if(UWA.is(e.localfilters,"object")&&e.localfilters.isAdvanced)e.localfilters.condition.forEach(function(e){var t=Object.keys(e)[0],i=r.localfilters[t]=[];e[t].hasOwnProperty("condition")&&e[t].condition.forEach(function(a){i.push({text:a.display,tagId:h(a,t,e[t].isComplex),isPinned:!1})})});else for(i in e.localfilters)(a=e.localfilters[i]).length>0&&"date"===a[0].type?1===a.length&&function(e,a){var o=t.canBeExcluded(i);n=[e.disptext],s=[h(e,i)];var l=[o],c=[e.excluded];e.parent&&(n.push(e.parent.disptext),s.push(h(e.parent,i)),l.push(o),c.push(e.parent.excluded),e.parent.parent&&(n.push(e.parent.parent.disptext),s.push(h(e.parent.parent,i)),l.push(o),c.push(e.parent.parent.excluded))),r.localfilters[i]=[{text:n.reverse(),tagId:s.reverse(),canBeExcluded:l.reverse(),isExcluded:c.reverse()}]}(a[0]):r.localfilters[i]=a.map(function(e){return{text:e.disptext,tagId:h(e,i),isPinned:!1,canBeExcluded:t.canBeExcluded(i),isExcluded:e.excluded}});return e.groupings&&(r.groupings=e.groupings.map(function(e){return{text:e.dispText,predicate:e.predicate,isPredicate:e.isPredicate}})),e.allgroupings&&(r.allgroupings=e.allgroupings.map(function(e){return{text:e.dispText,predicate:e.predicate,isPredicate:e.isPredicate}})),t.predicatesNLS&&(o=t.predicatesNLS),r},this.criteriaToHTML=function(s,o){var g,h,u,p=[];if(!s)return"";if(o.proxyId=o.proxyId||n[o.widgetId],n[o.widgetId]=o.proxyId,p.push(d(s.allproxies)||s.allgroupings&&s.allgroupings.length>0),c([o.widgetId,o.proxyId])&&o.widgetId in s&&o.proxyId in s[o.widgetId]?p.push(d(s[o.widgetId][o.proxyId].localfilters)||s[o.widgetId][o.proxyId].groupings&&s[o.widgetId][o.proxyId].groupings.length>0):p.push(!1),!p[0]&&!p[1])return"";var f={isSimplified:o.isSimplified,withoutPredHeader:o.withoutPredHeader,onePerLine:o.onePerLine,withRootIcon:o.withRootIcon,proxyId:o.proxyId,contextId:o.contextId,is3DDashboard:"3DDashboard"===a._brand};if(g='<div id="taggerCriteria-_-'+o.contextId+'" class="appCriteria">',p[0]){for(h in p[1]&&(g+='<span class="title-active-criteria"> '+t.getText("tab")+" </span>"),o.isSimplified&&(g+='<ul class="active-predicate-list globalTags">'),f.globalTag=!0,s.allproxies)f.predicate=h,(u=s.allproxies[h]).length>0&&(o.isSimplified||(g+="<ul class=active-predicate-list>"),g+=r(f),g+=l(u,f),o.isSimplified||(g+="</ul>"));if(s.allgroupings&&s.allgroupings.length){let t,a=s.allgroupings;g+='<ul class="active-predicate-list global-groupings">';let n=e.createElement();a.forEach(function(e){(t=new i({text:e.text,icon:"fonticon-group",isSimplified:!0,hasActions:!1,withoutTitle:!0}).render()).container.setAttribute("grouped",""),t.container.setAttribute("predicate",e.predicate),t.container.addClassName("globalTag"),e.isPredicate&&t.container.setAttribute("is_predicate",""),n.grab(t.container)}),g+=n.getHTML(),g+="</ul>"}o.isSimplified&&(g+="</ul>")}if(p[1]){p[0]&&(g+='<span class="title-active-criteria">Current Widget: </span>');var m=s[o.widgetId][o.proxyId].localfilters;if(Object.keys(m).length>0){for(h in o.isSimplified&&(g+='<ul class="active-predicate-list localTags">'),f.globalTag=!1,s[o.widgetId][o.proxyId].localfilters)f.predicate=h,(u=s[o.widgetId][o.proxyId].localfilters[h]).length>0&&(o.isSimplified||(g+="<ul class=active-predicate-list>"),g+=r(f)+l(u,f),o.isSimplified||(g+="</ul>"));o.isSimplified&&(g+="</ul>")}if(!o.isEmbedded){var v=s[o.widgetId][o.proxyId].groupings;if(v&&v.length>0){let t;g+='<ul class="active-predicate-list active-groupings">';let a=e.createElement();v.forEach(function(e){(t=new i({text:e.text,icon:"fonticon-group",isSimplified:!0,hasActions:!1,withoutTitle:!0}).render()).container.setAttribute("grouped",""),t.container.setAttribute("predicate",e.predicate),e.isPredicate&&t.container.setAttribute("is_predicate",""),a.grab(t.container)}),g+=a.getHTML(),g+="</ul>"}}}return g+="</div>"}}}),define("DS/TagNavigator/TagValueView",["DS/TagNavigator/PredicateView","DS/TagNavigator/TagValue","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/OntologyUtils"],function(e,t,i,a,n){"use strict";function s(i,o,r,l){var c,d,g,h,u,p,f,m,v,T,C,w,b,y;if("number"!=typeof r&&(r=1),!(i instanceof t))throw new Error("Invalid input arg");w=o,m=r,g=i.getDisplayValue(),h=i.uri,b=Array.isArray(i.uri)?"tree":i.type,u=i.explicit,v=i.pred.getFullPredicateID(),T=i.icon,C={predicate:v,object:h,dispValue:i.getDisplayValue(),type:i.type},i.embeddedSixW&&(C.isComplex=!0),C=JSON.stringify(C),y=[];var S=[];this.getSelectedTagId=function(){return C},this.incNbSubjects=function(e){if(!l||!i.hasOwnCount)return m+=e,p&&p.incNbSubjects&&p.incNbSubjects(e),m},this.id=function(){return h},this.setIcon=function(e){T=e},this.isADateFilter=function(){return!1},this.getDateLevel=function(){return"date"===b?[0,"year","month","day"][h.split("/").length]:0},this.type=function(){return b},this.nbSubjectsTagged=function(){return m},this.getDisplayname=function(){return Array.isArray(g)?g[g.length-1]:g},this.clearContent=function(){var e,t;for(w=null,e=0,t=y.length;e<t;e++)y[e].clearContent();return y=[],w},this.getMotherView=function(){return p},this.getPredicateView=function(){return p instanceof s?p.getPredicateView():p},this.getTagsInCreation=function(){return w.getTagsInCreation()},this.isSelectedTag=function(){return w.isSelected(i)},this.hasChildren=function(){return y.length>0},this.addTagValueView=function(e){if(this.getChildrenTagValueViews(function(t){return t===e.getDisplayname()}).length>0)throw new Error("Unexpected addition of already existing child TagValueView");return y.push(e),this.incNbSubjects(e.nbSubjectsTagged()),f.hasHierarchicalTags(),this},this.addDuplicateTagValue=function(e){S.push(e),a.log("merging a tag "+e.id()+" under tag "+this.id())},this.getDuplicateTagValues=function(){return S},this.updateCompositeStatus=function(){if(S.length>0){var e=JSON.parse(C);e.object=UWA.is(e.object,"array")?e.object:[e.object],S.forEach(function(t){var i=t.id();-1===e.object.indexOf(i)&&e.object.push(i)}),e.isComposite=!0,C=JSON.stringify(e)}},this.getChildrenTagValueViews=function(e){return e||(e=function(){return!0}),y.filter(function(t){return e(t.getDisplayname())})},this.getChildTagValueView=function(e){var t=this.getChildrenTagValueViews(function(t){return t===e});return t.length?t[0]:void 0},this.getNbTagMatch=function(e){var t,i=0,a=this.getChildrenTagValueViews();if(-1!==this.getDisplayname().toLowerCase().indexOf(e)&&i++,"date"!==this.type()||"date"===this.type()&&this.isSelectedDate())for(t=0;t<a.length;t++)a[t].getChildrenTagValueViews().length>0?i+=a[t].getNbTagMatch(e):-1!==a[t].getDisplayname().toLowerCase().indexOf(e)&&i++;return i},this.isSelectedDate=function(){return this.isSelectedTag()||this.getChildrenTagValueViews().some(function(e){return e.isSelectedTag()||e.isSelectedDate()})},this.toHtml=function(e,a,o,r,l,c,d,g,f){var I,E,x,_,A,N,V,P=S.length>0?w.isSelected(C):w.isSelected(i),D=u&&w.isTagInEdition(i),O=u&&!a&&!D&&d,M=w.getObservedNavigator().isPreciseCount(),U=r&&""!==r,F=w.getObservedNavigator().getCache(),W=w._simplifiedTagger?w.getCacheSimplified():F,R=S.length>0?w.isExcluded(C):w.isExcluded(i),j=!1;if(w.getObservedNavigator().getTagPinnedFromCurrentContext().forEach(function(e){let t=JSON.parse(e.predicate),i=JSON.parse(C).object;Array.isArray(t.object)?Array.isArray(i)?t.predicate===v&&t.object.toString()===i.toString()&&(j=!0):t.predicate===v&&-1!==t.object.indexOf(i)&&(j=!0):t.predicate===v&&i===t.object&&(j=!0)}),i.isOntologyTag&&!g){let e=n.getConcept(i.ontologyURI);g=e&&e.isDeprecated()}switch(O&&(t.isSwymCommunityInFocus(w)&&i.isCommunityTag?O=!1:i.isOntologyTag&&y.length>0&&(O=!1)),"boolean"!=typeof a&&(a=!1),x=String()+w.getDOMId(C)+(a?"atv":""),b){case"date":var L=["year","month","day"][h.split("/").length-1];if(a)return E="",p instanceof s&&(E=p.toHtml(e,a,o,void 0,l)),E+=s.toHtml({id:x,displayName:this.getDisplayname(),count:m,isPreciseCount:M,isSelected:!0,isDisplayed:!0,isExplicit:u,additionalClassName:L+(l?"":" wrongType"),icon:T,hasProxiesInEdition:d,hideTagsCount:f},w);if(o&&""!==o&&!(P=0===o.indexOf(h))&&0!==h.indexOf(o))return"";if(_=s.toHtml({id:x,displayName:this.getDisplayname(),count:m,isPreciseCount:M,isSelected:P,isDeletable:O,isDisplayed:e,isExplicit:u,isUnderCreation:D,isExpanded:!0,icon:T,additionalClassName:(P?L:"")+(l?"":" wrongType"),color:!F.colorManager.isColorized(v)||P&&"day"!==L?void 0:F.colorManager.getNewColorForTagValue(this),hasProxiesInEdition:d,isExcluded:R,isPinned:j,hideTagsCount:f},w),!a&&P){for(y=this.getPredicateView().sortTagValues(y),w.isSelected(C)&&(_+="<li class='treeTags'><ul class='tags-list'>"),I=0;I<y.length;I++)(!U||U&&y[I].getNbTagMatch(r)>0)&&(_+=y[I].toHtml(e,!1,o,r,l,void 0,void 0,void 0,f));w.isSelected(C)&&(_+="</ul></li>")}return _;case"tree":A=!a&&y.length>0,_="",N="";var k=null;if(V=Array.isArray(this.id())?this.id().length:this.id().split("/").length,(F.colorManager.isColorized(v)||F.colorManager.isInColorization(v))&&(this.getMotherView()===this.getPredicateView()?F.colorManager.addToColoredTreeTagList(this):Object.getPrototypeOf(this.getMotherView())===Object.getPrototypeOf(this)&&W.isTagTreeExpanded(w.getDOMId(this.getMotherView().getSelectedTagId()))&&(F.colorManager.partialColorize&&F.colorManager.partialColorize[v]||(k=F.colorManager.addToColoredTreeTagList(this)))),U?this.getNbTagMatch(r)>0&&(W.expandTagTree(x),N=s.toHtml({id:x,displayName:this.getDisplayname(),count:m,isPreciseCount:M,isSelected:P,isDeletable:O,isDisplayed:e,isExplicit:u,isGrouped:c&&c(this.getDisplayname(),this.id()),icon:T,isUnderCreation:D,isExpanded:W.isTagTreeExpanded(x),isTree:A,additionalClassName:l?"":" wrongType",color:F.colorManager.isColorized(v)||F.colorManager.isInColorization(v)?F.colorManager.getNewColorForTagValue(this)||k:void 0,level:V,hasProxiesInEdition:d,isExcluded:R,isDeprecated:g,isPinned:j,hideTagsCount:f},w)):N=s.toHtml({id:x,displayName:this.getDisplayname(),count:m,isPreciseCount:M,isSelected:P,isDeletable:O,isDisplayed:e,isExplicit:u,isGrouped:c&&c(this.getDisplayname(),this.id()),icon:T,isUnderCreation:D,isExpanded:W.isTagTreeExpanded(x),isTree:A,additionalClassName:l?"":" wrongType",color:F.colorManager.isColorized(v)||F.colorManager.isInColorization(v)?F.colorManager.getNewColorForTagValue(this)||k:void 0,level:V,hasProxiesInEdition:d,isExcluded:R,isDeprecated:g,isPinned:j,hideTagsCount:f},w),!a){if(y=this.getPredicateView().sortTagValues(y),V=Array.isArray(this.id())?this.id().length:this.id().split("/").length,y.length)return _+="<ul class='treeTags"+(V>20?" maxLevel":"")+"'>"+N+"<li class='childrenTags' style='"+(W.isTagTreeExpanded(x)?"position: relative; overflow: hidden; height: auto;":"position: absolute; overflow: hidden; height: 0px;")+"'><ul class='tags-list'>"+y.map(function(t){return t.toHtml(e,a,null,r,l,c,d,g,f)}).join("")+"</li></ul></ul>";N=N.replace("<li class='tag ","<li level='"+V+"' class='tag first")}return N;default:return s.toHtml({id:x,displayName:this.getDisplayname()||this.id(),count:m,isPreciseCount:M,isSelected:P,isDeletable:O,isDisplayed:e,isExplicit:u,isGrouped:c&&c(this.getDisplayname()),icon:T,isUnderCreation:D,additionalClassName:l?"":" wrongType",color:F.colorManager.isColorized(v)||F.colorManager.isInColorization(v)?F.colorManager.getNewColorForTagValue(this)||k:void 0,hasProxiesInEdition:d,isExcluded:R,isDeprecated:g,isPinned:j,hideTagsCount:f},w)}},d=i.displayPredicate||i.pred,f=e.getPredicateView(d,w);var I=i.parent;return function(e){return e===h},(c=(p=I?new s(I,w,0):f).getChildTagValueView(this.getDisplayname()))?(c&&(UWA.is(h,"array")||"date"==i.pred.getType()||c.id()!==this.id()&&c.addDuplicateTagValue(this)),c.incNbSubjects(r),c):(p.addTagValueView(this),this)}return s.toHtml=function(e,t){var a,n=e.isExplicit&&!0===e.isExplicit,s=e.isUnderCreation&&!0===e.isUnderCreation,o=e.isTree&&!0===e.isTree,r=e.isExpanded&&!0===e.isExpanded,l=e.additionalClassName?" "+e.additionalClassName:"",c=e.color||!1,d=e.isPreciseCount||!1,g=e.icon,h="",u="",p=e.isExcluded,f=e.displayName,m=e.isPinned,v=e.hideTagsCount;e.isDeprecated&&(f+=i.getText("deprecated")),g&&g.match(/fonticon-*/)?h='<span class="tag-icon fonticon '+g+'"></span>':g&&g.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/)&&-1!==["gif","tiff","jpg","jpeg","bmp","png","ico"].indexOf(g.split(".").pop())&&(h='<img class="tag-image" src="'+g+'" style="width:20px;height:20px;">'),p&&(u='<span class="fonticon fonticon-block excluded"></span>');let T=t.actionManager?t.actionManager.getCurrentAction():void 0,C=!1;return T&&"colorize"==T.id&&c&&(C=!0),a="<li"+(e.level?" level= "+e.level:"")+" class='tag "+l+(e.isSelected?" selected":"")+(e.isDeletable?" deletable":"")+(r?" expanded":"")+(e.isGrouped?" grouped-by":"")+(c?" colorize":"")+(C?" picked-for-colorize":"")+(!c&&e.count<0?" no-count":"")+(e.isDisplayed?"":" morelimit")+(n?" explicit":"")+(s?" creating":"")+(m?" disabled-tag":"")+"' title='"+f.replace(/'/g,"&#39;")+"' id='"+e.id+"' data-rec-id='"+e.id+"'>",n||(a+=""),a+="<div class='tag-color "+(c?"":"hide-color")+"' style='background-color:"+(c||0)+";'></div>",a+=o?"<div class='arrow tree'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>":"",a+="<div class='tag-elem'>"+u+h+"<div class='tag-label'>"+f.escapeHTML(),s&&(a+='<div class="spinner spinner-sm spinning fade in" style="height: 12px; padding: 6px; -webkit-transform: translate3d(0px, 0px, 0px); display: inline-block;"><span class="spinner-bar"></span><span class="spinner-bar spinner-bar1"></span><span class="spinner-bar spinner-bar2"></span><span class="spinner-bar spinner-bar3"></span></div>'),a+="</div>",a+="<div class='tag-tail'>",v?a+="<div class='tag-count' title='"+e.count+"'></div>":e.count>=0&&(a+="<div class='tag-count' title='"+e.count+"'>"+i.convertToUnity(e.count,d)+"</div>"),a+="</div></div>",e.isDeletable&&(t._simplifiedTagger?a+="<div class='tag-delete' title='"+i.getText("deleteTag")+"'><span class='fonticon fonticon-trash'></span></div>":a+="<div class='tag-delete' title='"+i.getText("deleteTag")+"'><span class='fonticon fonticon-cancel'></span></div>"),a+="</li>"},s}),define("DS/TagNavigator/embeddedTagger/LeafCriteriaListView",["UWA/Core","UWA/Class/View","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/views/CriteriaView"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"type-categories",init:function(t){let n;return this._parent(t),this.hideTagsCount=t.hideTagsCount,this.render=function(t){let i=this.getOption("rootCategory");if(this.getOption("withHeader")){var a=e.createElement("div",{class:"embedded-category-header"}).inject(this.container);a.setHTML('<div class="embedded-category-header-icon fonticon tn-level0 category-v3"></div>                                           <div class="embedded-category-header-title">                                              <p class="embedded-category-header-text"></p>                                           </div>'),a.getElement(".embedded-category-header-text").setText(i.get("title"));let t=a.getElement(".embedded-category-header-icon");var s=i.get("iconClass");t.addClassName(s),t.addClassName(s.replace("fonticon-","tn-"))}return n=e.createElement("ul",{class:"root-category"}).inject(this.container),this},this.addView=function(e,s,o,r){let l=new a({model:s,taggerView:e,navImpl:e.observedNavImpl,hideTagsCount:this.hideTagsCount});l.render().inject(n),l.setAsLeaf();let c=e.observedNavImpl.getFocusedProxy();if(c)o||s.get("isParentSelected")?(l.setAsSelected(),r||l.setDisabledState(!0)):c.getLocalFilter().isSelected(i.buildCondition(l.model))&&l.setAsSelected();else{var d=l.model.isContainer();t.navImpl.isSelected(JSON.stringify(l.model.getRefineStructure(!0)[0]),d)&&l.setAsSelected()}if(!r){let e=this.getOption("rootCategory").get("iconClass").replace("fonticon-","");l.container.addClassName(e)}l.addEvent("onCriteriaToggle",function(t,a){var n=a.model,s=i.buildCondition(n);s.treatEmbeddingFilter=!0,e.observedNavImpl.toggleComplexTagSelection(s)})},this},destroy:function(){this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedCriteriaListView",["UWA/Core","UWA/Class/View","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/views/SearchFieldView","DS/TagNavigator/embeddedTagger/LeafCriteriaListView","DS/TagNavigator/simplified/views/EmptyView"],function(e,t,i,a,n,s,o,r){"use strict";return t.extend({tagName:"div",className:"embedded-type-categories",init:function(t){var l=this;this._parent(t),this.container.addClassName("type-categories"),this._categories=[],this.render=function(){var t=e.createElement("div",{class:"embedded-type-categories-search"}).inject(this.container);return new s({style:"large",placeholder:i.getText("search_types")}).inject(t).render().addEvent("onSearch",function(e){let t=e.currentText;a.log("EmbeddedCriteriaListView: searchText = "+t),t=t.toUpperCase(),l.redraw(t)}),this._categoryHeadersContainer=e.createElement("div",{class:"embedded-categories-list"}).inject(this.container),this._emptyView=(new r).render().inject(this._categoryHeadersContainer),this},this.redraw=function(e){return this._emptyView&&this._emptyView.hide(),this._categories.forEach(function(e){e.destroy()}),this._categories=[],require(["DS/TagNavigator/TagNavigator"],function(t){this._navImpl=t.view.observedNavImpl;var s=this._navImpl.getFocusedProxy();this.hideTagsCount=this._navImpl.getHideCountProperty("ds6w:type");var r=n.getCriteriaInfo(this._navImpl,s,void 0,e);let l=function(e){return e.isContainer()?e.get("subCategories").length:e.get("count")};var c,d=r.sortBy(l);if((d=d.reverse()).length>0){let i=function(e,t,o){e.getAllSubCategories().forEach(function(e){if(e.isContainer()){var r=s.getLocalFilter().isSelected(n.buildCondition(e));r&&a.log("Parent category "+e.get("title")+" is selected"),i(e,t,r)}else o&&e.set("isParentSelected",!0),t.push(e)})};d.forEach(function(r){a.log("rootCriteria title="+r.get("title")+", count="+l(r));var d=s.getLocalFilter().isSelected(n.buildCondition(r));if(d&&a.log("Root category "+r.get("title")+" is selected"),r.isContainer()){let a=[];if(i(r,a),e&&(a=a.filter(function(t){return-1!=t.get("title").toUpperCase().indexOf(e)})),a.length>0){a.sort(function(e,t){return t.get("count")-e.get("count")});var g=r.get("iconClass").replace("fonticon-",""),h=new o({rootCategory:r,withHeader:!0,hideTagsCount:this.hideTagsCount}).render().inject(this._categoryHeadersContainer);this._categories.push(h),a.forEach(function(e){e.set("rootIconClass",g),h.addView(t.view,e,d)})}}else{let i=!0;(!e||-1!=r.get("title").toUpperCase().indexOf(e))&&(c||(c=new o({rootCategory:r,withHeader:!1}).render().inject(this._categoryHeadersContainer),this._categories.push(c)),c.addView(t.view,r,d,i))}}.bind(this))}else this._emptyView.show(),this._emptyView.setMessageText(i.getText("noTags"))}.bind(this)),this},this.destroy=function(){this._parent()}},setup:function(e){this._parent(e)}})}),define("DS/TagNavigator/simplified/actions/Group",["UWA/Core","UWA/Class/Promise","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/Logger","DS/TagNavigator/TaggerNLS"],function(e,t,i,a,n,s,o,r){"use strict";return i.extend({setup:function(e){this._parent(e),this.set({actionClass:"grouped-by"}),this._selection=this.get("selection")},_getGroupingConfig:function(){let e=this.getNavImpl(),t=e.getFocusedProxy(),i={};if(t)return t.getGroupingConfig();{let t=e._getProxiesHavingGroupingSupport();if(t.length)for(let e=0;e<t.length;e++){let a=t[e].getGroupingConfig();if(0===Object.keys(i).length&&i.constructor===Object&&a)i=a;else for(let e in a)i[e]>=-1&&-1!=a[e]&&(-1==i[e]?i[e]=a[e]:i[e]>a[e]&&(i[e]=a[e]))}}return i},onPredicateSelection:function(i,n){var s=this;return new t(function(t,l){var c,d,g,h=n?i.getElement(".predicate-header"):i.getClosest(".predicate-header"),u=n?i:h.getParent();c="ds6w:type"==u.getAttribute("predicate")&&(d="type_categorization",(g=s.getNavImpl().getFocusedProxy())&&d&&g.getAdvancedOption(d)&&g)?a.getPredicate("type_categorization"):a.getPredicate(u.getAttribute("predicate"));if(0==s.getNavImpl().hasGroupingSupport(c.id(),!0))return o.log("Predicate level grouping is disabled for "+c.id()),void l();if(h.hasClassName(this.get("actionClass")))n||(h.removeClassName(this.get("actionClass")),h.getElement(".action-icon").remove()),this.removeAddedObject(c,void 0,void 0,n);else{if(function(){var e=u.getElements("li.tag");if(e.length&&e.forEach(function(e){e.hasClassName(s.get("actionClass"))&&e.removeClassName(s.get("actionClass"))}),u.getElement(".people-view-container")){var t=u.getElement(".people-view-container").getElements(".people-view");t.length&&t.forEach(function(e){e.hasClassName(s.get("actionClass"))&&(e.removeClassName(s.get("actionClass")),e.removeClassName("picked"),e.getElement(".people-template").removeClassName("people-selected"))})}}(),!n)h.addClassName(this.get("actionClass")),e.createElement("span",{class:"action-icon fonticon fonticon-group",title:r.getText("remove_groupBy")}).inject(i,"after").setAttribute("action","group");this.computePredObject(c,null,h,n)}t()}.bind(this))},onTagSelection:function(e,t){var i=t?e.getClosest(".tnw.predicate"):e.getClosest("li.predicate"),n=i.getAttribute("predicate"),s=e.getAttribute("title"),o=a.getPredicate(n),r=function(){i.getElement(".predicate-header").hasClassName(this.get("actionClass"))&&(i.getElement(".predicate-header").removeClassName(this.get("actionClass")),t?i.getElement(".action-icon.groupBy").addClassName("hide"):i.getElement(".action-icon").remove(),this.removeAddedObject(o,void 0,void 0,t))}.bind(this);e.hasClassName(this.get("actionClass"))?(e.removeClassName(this.get("actionClass")),this.removeAddedObject(o,s,void 0,t)):(r(),e.addClassName(this.get("actionClass")),this.computePredObject(o,s,e,t))},onPersonSelection:function(e,t){var i=e.view,n=e.refineData,s=n.predicate.split("/")[n.predicate.split("/").length-1],o=a.getPredicate(s),r=t?i.container.getClosest(".tnw.predicate"):i.container.getClosest("li.predicate");r.getElement(".predicate-header").hasClassName(this.get("actionClass"))&&(r.getElement(".predicate-header").removeClassName(this.get("actionClass")),t?r.getElement(".action-icon.groupBy").addClassName("hide"):r.getElement(".action-icon").remove(),this.removeAddedObject(o,void 0,void 0,t)),i.container.hasClassName("picked")&&i.container.hasClassName(this.get("actionClass"))?(i.container.removeClassName("picked"),i.container.removeClassName(this.get("actionClass")),i.setAsUnselected(),this.removeAddedObject(o,n.dispValue,void 0,t)):(i.container.addClassName("picked"),i.container.addClassName(this.get("actionClass")),i.setAsSelected(),this.computePredObject(o,n.dispValue))},_getTagObjectInfo:function(e,t,i){return t?e[e.length-1].id():i&&e.hasChildren()?[e.id()]:e.id()},_manageUniqueHierarchyPathSelection:function(e,t,i,n,s,o,r){var l=this,c=e.object.map(function(e){return e.object}),d=this._getTagObjectInfo(t,n,s),g=c.filter(function(e){if(e.length!==i.length)return a=d,(t=e).length<a.length?n=t.every(function(e,t){return a[t]===e}):s=a.every(function(e,i){return t[i]===e}),n||s;var t,a,n,s}),h=g;if(0==g.length&&this._getGroupingConfig().maxHierarchyPerLevel>0&&c[0][0]!==d[0]){h=c;var u=t[0].getPredicateView().getTagValueViews(h[0],!0,!0)[0].map(function(e){return e.getDisplayname()});o=this._getRootTagValueView(e.predicate,u[0],r)}h.forEach(function(i){l.removeAddedObject(a.getPredicate(e.predicate),i,!0,r);var n=t[0].getPredicateView().getTagValueViews(i,!0,!0)[0].map(function(e){return e.getDisplayname()});l._removeHierarchySelection(o,n,r)})},computePredObject:function(e,t,i,s){var r,l,c,d=this,g=this._getGroupingConfig(),h=e.id(),u=n.getPredicateView(e);i&&(t?s?i.getClosest(".tree")&&(r=!0,o.log("a hierarchical tag is selected")):i.getClosest("ul.treeTags")&&(r=!0,o.log("a hierarchical tag is selected")):i.getClosest(".predicate").getElement(".predicate-content").getElements("ul.treeTags").length>0&&(l=!0,o.log("a predicate with hierarchical tags is selected")));var p=[],f=[];if(r){var m,v=i.getElement(".arrow.tree"),T=i;if(s){for(f.push(T.getElement(".tag-label").getText()),T=T.getClosest(".tags-list-tree");m=T&&T.getClosest("li.tag.expanded");)p.push(m),f.push(m.getElement(".tag-label").getText()),T=m.getClosest(".tags-list-tree");f=f.reverse(),p=p.reverse()}else{for(;m=T.getClosest("ul.treeTags");)p.push(m),T=m.getClosest("ul.tags-list");for(var C=p.length-1;C>=0;C--)f.push(p[C].getElement("li.tag").getElement(".tag-label").getText());v||f.push(i.getElement(".tag-label").getText())}o.log("selection path is:"+JSON.stringify(f)),c=u.getTagValueViews(f,!0)}else c=u.getTagValueViews(t||null);var w,b,y=this._selection.map(function(e){return e.predicate}),S=y.indexOf(h);if(-1!==S?(w=this._selection[S],t?(g.maxPerLevel>0&&w.object.length+1>g.maxPerLevel&&this.removeAddedObject(a.getPredicate(w.predicate),w.object[0].dispText,!0,s),r&&(this._manageUniqueHierarchyPathSelection(w,c[0],f,r,l,p[p.length-1],s),g.maxHierarchyPerLevel>0&&g.maxPerLevel>0&&this._selection[S].object.length+1>g.maxPerLevel&&this.removeAddedObject(a.getPredicate(this._selection[S].predicate),this._selection[S].object[0].dispText,!0,s))):(this._selection[S].object=[],this._selection[S].predLevel=!0),b=this._selection[S].object):(t?(g.maxLevels>0&&y.length+1>g.maxLevels&&this.removeAddedObject(a.getPredicate(y[0]),void 0,!0,s),this._selection.push({predicate:h,object:[]})):(g.maxLevels>0&&y.length+1>g.maxLevels&&this.removeAddedObject(a.getPredicate(y[0]),void 0,!0,s),this._selection.push({predicate:h,object:[],predLevel:!0})),b=this._selection[this._selection.length-1].object),c.forEach(function(t){var i={};if(i.dispText=UWA.is(t,"array")?t[t.length-1].getDisplayname():t.getDisplayname(),i.object=d._getTagObjectInfo(t,r,l),i.type=e.getType(),!r){var a=t.getDuplicateTagValues();if(UWA.is(a,"array")&&a.length>0){var n=i.merged=[];a.forEach(function(e){n.push({object:e.id()})})}}b.push(i)}),this.get("isInteractive")){var I=0;this._selection.forEach(function(e){I+=e.object.length}),this.set("selectionCount",I)}},_removeSelection:function(e,t,i,a){var n=this,s=this.getPredicateElement(e,a);if(s){var r=s.getElement(".predicate-header");if(i)r.removeClassName("grouped-by"),a?r.getElement(".action-icon.groupBy").addClassName("hide"):r.getElement(".action-icon").remove();else if(s.getElements("li.tag").forEach(function(e){var i=!0;t&&e.getElement(".tag-label").getText()!==t&&(i=!1),i&&e.hasClassName(n.get("actionClass"))&&e.removeClassName(n.get("actionClass"))}),s.getElement(".people-view-container"))s.getElement(".people-view-container").getElements(".people-view").forEach(function(e){e.hasClassName(n.get("actionClass"))&&(e.removeClassName(n.get("actionClass")),e.removeClassName("picked"),e.getElement(".people-template").removeClassName("people-selected"))})}else o.error("Predicate elem not found in the DOM for "+predId)},_getRootTagValueView:function(e,t,i){var a=this.getPredicateElement(e,i).getElement(".predicate-content").getElement(".tags-list");return i?a.getChildren().filter(e=>e.getElement(".tag-label").getText()===t)[0]:a.getChildren().filter(function(e){return e.hasClassName("treeTags")?e.getElement(".tag:not(.childrenTags)").getElement(".tag-label").getText()===t:e.getElement(".tag-label").getText()===t})[0]},_removeHierarchySelection:function(e,t,i){if(i)if(1==t.length)e.removeClassName(this.get("actionClass"));else{var a=0;let i=e.getElements("li.tag.grouped-by");for(var n of t)0==a?o=e:i.forEach(e=>{e.getElement(".tag-label").getText()===n&&(o=e)}),++a;o.removeClassName(this.get("actionClass"))}else if(1==t.length)e.getElement(".tag:not(.childrenTags)").removeClassName(this.get("actionClass"));else{var o;a=0;for(var n of t)o=0==a?e:s.getChildTag(o,n),++a;o.hasClassName("treeTags")?o.getElement(".tag:not(.childrenTags)").removeClassName(this.get("actionClass")):o.removeClassName(this.get("actionClass"))}},removeAddedObject:function(e,t,i,a){var n,s=e.id(),r=-1;if(o.log("removing the entry for predicate="+s+(t?", and tag ="+t:"")),-1!==(n=this._selection.findIndex(function(e){return e.predicate==s})))if(t){var l=this._selection[n],c=UWA.is(t,"array");-1!==(r=c?l.object.findIndex(function(e){if(e.object.length==t.length)return e.object.every(function(e,i){return e===t[i]})}):l.object.findIndex(function(e){return e.dispText==t}))?(l.object.splice(r,1),0==l.object.length&&(i||this._selection.splice(n,1)),i&&!c&&this._removeSelection(s,t,void 0,a)):o.error("tag entry NOT found")}else{var d=this._selection.splice(n,1);i&&this._removeSelection(s,void 0,d[0].predLevel,a)}else o.error("predicate entry NOT found");if(this.get("isInteractive")){var g=0;this._selection.forEach(function(e){g+=e.object.length}),this.set("selectionCount",g)}},addPredicate:function(e){o.log("inside Group#addPredicate");var t=e.predicate,i=this._selection.map(function(e){return e.predicate}),n=i.indexOf(t),s=this._getGroupingConfig();-1===n?(s.maxLevels>0&&i.length+1>s.maxLevels&&this.removeAddedObject(a.getPredicate(i[0])),this._selection.push({predicate:t,object:e.object,predLevel:!0})):(this._selection[n].object=e.object,this._selection[n].predLevel=!0)},removePredicate:function(e){return o.log("inside Group#removePredicate"),this.removeAddedObject(a.getPredicate(e.predicate))},isRefreshNeeded:function(e){return this._selection.filter(function(t){var i=!1;if(t.predLevel){var s=t.predicate,r=a.getPredicate(s);if(e&&e.isEmbedded){var l=this.get("current");(function(e,t){if(o.log("currentGroups="+JSON.stringify(e)),o.log("newGroups="+JSON.stringify(t)),e.length==t.length){for(var i=!0,a=0;a<e.length&&i;a++){i=!1;var n=e[a],s=t[a];if(UWA.is(n.object,"string"))UWA.is(s.object,"string")&&(i=n.object===s.object);else if(UWA.is(n.object,"object")){if(UWA.is(s.object,"object"))if("date"==n.type&&"date"==s.type)i=!0;else{var r=Object.keys(n.object.value),l=Object.keys(s.object.value);r.length==l.length&&(i=r.every(function(e){return-1!==l.indexOf(e)}))}}else UWA.is(n.object,"array")&&UWA.is(s.object,"array")&&(i=n.object.every(function(e){return-1!==s.object.indexOf(e)}));i||(o.warn("DIFFERENCE FOUND IN THE EXISTING AND NEW GROUPINGS"),o.log("_current="+JSON.stringify(n)),o.log("_new="+JSON.stringify(s)))}return!i}return o.warn("NUMBER OF THE EXISTING AND NEW GROUPINGS ARE DIFFERENT"),!0})(l.object,t.object)&&(i=!0,o.log("grouping needs to be updated"),this.addPredicate(l))}else{var c=n.getPredicateView(r).getTagValueViews();UWA.is(c,"array")&&function(e,t){if(e.length!=t.length)return o.warn("NUMBER OF THE EXISTING AND NEW GROUPINGS ARE DIFFERENT"),!0;var i={};return t.forEach(function(e){i[e.dispText]=[e.object].concat(e.merged?e.merged:[])}),e.some(function(e){var t=!1,a=i[e.getDisplayname()];if(a){var n=[e.id()].concat(e.getDuplicateTagValues().map(function(e){return e.id()}));a.length===n.length?a.every(function(e){return-1!==n.indexOf(e)})||(o.log("There is a difference between the existing and new group, due to different merged tags"),o.log("existing Info="+JSON.stringify(a)),o.log("new Info="+JSON.stringify(n)),t=!0):(o.log("There is a difference between the existing and new group, different number of merged tags"),o.log("existing Info="+JSON.stringify(a)),o.log("new Info="+JSON.stringify(n)),t=!0)}else o.log("Tag not found in the existing groups:"+e.getDisplayname()),t=!0;return t})}(c,t.object)&&(i=!0,o.log("grouping needs to be updated"),this.computePredObject(r,null))}}return i}.bind(this)).length>0}})}),define("DS/TagNavigator/TagWidget/PredicateView",["UWA/Core","UWA/Class/View","UWA/Class/Collection","text!DS/TagNavigator/assets/templates/PredicateView.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/TagNavigator/TagWidget/PredicateHeaderView","DS/TagNavigator/TagWidget/TagListView","DS/TagNavigator/TagWidget/GraphView","DS/TagNavigator/TagWidget/TagsModel","DS/TagNavigator/simplified/views/EmptyView","DS/TagNavigator/simplified/views/PersonListView","DS/TagNavigator/simplified/views/CriteriaListView","DS/TagNavigator/simplified/views/DateCalendarView","DS/TagNavigator/TagWidget/freeInput/StringInputView","DS/TagNavigator/TagWidget/freeInput/BooleanInputView","DS/TagNavigator/TagWidget/freeInput/NumberRangeInputView","DS/MessageBus/MessageBus","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/views/WarningInfoView","css!DS/TagNavigator/TagNavigator.css"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f,m,v,T,C,w,b){"use strict";return t.extend({tagName:"div",className:"tnw predicate",template:n.compile(a),setup:function(e){this._parent(e)},domEvents:{"click .type-show-more":"toggleCategoryview"},render:function(){var t=this.template();this.container.setContent(t),this.navImpl=this.getOption("navImpl"),this.predicate=this.getOption("predicate"),this.id=this.predicate.id(),this.predicateLineage=this.predicate.getFullPredicateID(),this.sort=this.getOption("sort"),this.currentViewMode=this.getOption("viewMode"),this.noTagsView=!!this.getOption("withNoTags")&&(new h).render(),this.tagsExpandStatus=this.getOption("tagsExpand"),this.colorManager=this.navImpl.getCache().colorManager,this.maxTagger=this.getOption("maxTagger"),this.cache=this.navImpl.getCache(),this.taggerCache=this.getOption("taggerCache")||null,this.searchString=this.getOption("searchString")||"",this.onSearch=this.getOption("onnSearch"),this.taggerView=this.getOption("taggerView"),this.container.setAttributes({predicate:this.id}),this.maxTagger||(this.warningInfoView=(new b).render().inject(this.container.getElement(".predicate-content"),"before"),this.warningInfoView.addEvent("warningLinkClick",function(){this.navImpl.infoMessageCB()}.bind(this))),this.tagsSorted=!1,this.predicateHeader=new l({sort:this.sort,currentViewMode:this.currentViewMode,maxTagger:this.maxTagger,cache:this.cache,taggerCache:this.taggerCache,predicate:this.predicate,typePredicate:this.predicateLineage.includes("ds6w:type"),predicateLineage:this.predicateLineage,taggerView:this.taggerView}).render().inject(this.container.getElement(".predicate-content"),"before"),this.predicateHeader.addEvent("togglePredExpand",this.togglePredicateExpandCB.bind(this)),this.predicateHeader.addEvent("clearAllFilters",this.clearAllFiltersCB.bind(this)),this.predicateHeader.addEvent("sortChanged",this.changeSort.bind(this)),this.predicateHeader.addEvent("viewChanged",this._changeView.bind(this)),this.predicateHeader.addEvent("toggleColorize",this.colorizeTags.bind(this)),this.predicateHeader.addEvent("clearColorizeSelections",this.clearColorizedTags.bind(this)),this.predicateHeader.addEvent("cacheToolboxVisibility",this.updateToolboxStatus.bind(this)),this.predicateHeader.addEvent("groupingPredicate",this.updateGrouping.bind(this));let i=this.container.getElement(".predicate-content");return this.getOption("withScroll")&&(this.scrollerElem=new o({element:i.getElement(".innerForTransition")}).inject(i)),"ds6w:type"==this.id&&(this.showMore=e.createElement("div",{class:"show-more-container",id:"typePredicateViewToggle"}),this.toggleElem=e.createElement("div",{tag:"div",class:"show-more type-show-more",text:s.getText("showAll")}).inject(this.showMore)),this},getPredicateExpandStatus:function(){let e=this.navImpl.getFocusedProxy(),t=this.cache.isPredicateCollapsed(this.id);if(e){t=!(this.navImpl.getExpandStatus(this.id)||!t)}return this.predicateHeader.setPredicateExpandStatus(t),!t},updateToolboxStatus:function(){this.cache.toggleToolboxVisibility(this.id)},togglePredicateExpandCB:function(t){let i=t.expand,a=t.interactiveExpand;i?(this.cache.expandPredicate(this.id),a&&this.cache.setAsInteractivelyExpanded(this.id)):(this.cache.collapsePredicate(this.id),this.cache.setAsInteractivelyCollapsed(this.id)),this.container.toggleClassName("expanded",i);let n=e.extendElement(this.container.getElement(".predicate-content")),s=e.extendElement(n.getChildren()[0]);s.getSize().height||(s.style.height="100px"),new e.Fx(n,{duration:300,transition:"quadInOut",events:{onComplete:function(){i?n.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto"}):n.setStyles({position:"absolute",opacity:0,height:"auto"})},onStart:function(){n.setStyle("position","relative"),n.setStyle("overflow","hidden")}}}).start({height:i?[0,s.getSize().height]:[s.getSize().height,0]}),i&&(s.style.height="auto",t.interactiveExpand&&this.redrawPredicateView())},redrawPredicateView:function(e){let t;if(e&&this.maxTagger&&(this.searchString=e.searchString,this.dateRange=e.dateRange,this.navImpl=e.navImpl?e.navImpl:this.navImpl),this.maxTagger)this.navImpl&&(t=this.navImpl.getFocusedProxy());else if(!this.warningInfoView.container.isHidden()){let e=this.navImpl.getProxiesToDisplay(),i=!!((t=this.navImpl.getFocusedProxy())||(1===e.length?e[0]:null));this.warningInfoView.displayMessage(i)}let i=this.navImpl.getTagInfo(this.id);var a;if(this.updateTagCollection(i),this.taggerView&&(a=this.taggerView.getObservedNavigator().hasDateRangeType(this.id)),this.maxTagger){let e=this.navImpl.isGroupedBy(this.id);(this.taggerView&&this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0)||(e||"ds6w:type"!=this.id||(e=this.navImpl.isGroupedBy("type_categorization")),e?(this.container.getElement(".predicate-header").addClassName("grouped-by"),this.container.getElement(".action-icon.groupBy").removeClassName("hide")):(this.container.getElement(".predicate-header").removeClassName("grouped-by"),this.container.getElement(".action-icon.groupBy").addClassName("hide"))),this.currentViewMode=this.taggerCache.getViewMode(this.id),this.sort=this.cache.getCurrentSort(this.predicateLineage),"category"!==this.currentViewMode?(this.predicateCount=this.setPredicateCount(),this.predicateHeader.setPredicateCount(this.predicateCount)):this.predicateHeader.getElement(".predicate-count").hide();let i=this.navImpl.hasProxiesInEdition();"freeInput"===this.currentViewMode&&i&&(this.currentViewMode="tag"),"freeInput"===this.currentViewMode&&this.taggerView&&!this.taggerView.isProxyWithFilteringOnServer()&&(this.taggerCache.setViewMode(this.id,"tag"),this.currentViewMode="tag"),this.taggerView&&this.taggerView.hasFreeInputOnly(this.id)&&!i&&(this.currentViewMode="freeInput"),a&&t?this.currentViewMode="freeInput":a&&(this.currentViewMode="")}let n=[this.predicateHeader.id];this.hideTagsCount=this.navImpl.getHideCountProperty(n),this.predicateHeader.updateToolBar({isHierarchy:this.isHierachicalPredicate,currentViewMode:this.currentViewMode,currentSort:this.sort,navImpl:this.navImpl,dateRange:this.dateRange,hideTagsCount:this.hideTagsCount}),this.maxTagger?this.searchString?(this.getFilteredTags(this.searchString),this.hasMatchingResult||"person"==this.id?(this.container.removeClassName("searchexcluded"),this._redrawView(!0)):this.container.addClassName("searchexcluded")):(this.container.removeClassName("searchexcluded"),this.getPredicateExpandStatus()&&(this.predicateHeader.expandPredicate(),this._redrawView())):this._redrawView();var s=!1;a&&(t&&(this.taggerView.hasFreeInputOnly(this.id)||this.taggerView.hasFreeInputSupport(this.id))||(s=!0)),s?(this.predicateHeader.hide(),this.container.getElement(".predicate-content").hide()):(this.predicateHeader.show(),this.container.getElement(".predicate-content").show())},_redrawView:function(e){let t,i="",a=this.scrollerElem?this.scrollerElem.elements.content:this.getElement(".innerForTransition");this.clearViewContent(),t=this.sortTags();this.searchString&&!e&&this.getFilteredTags(this.searchString);var n={hideTagsCount:!1};if(n.hideTagsCount=this.hideTagsCount,t=this.tagCollection,this.hideTagsCount&&(this.currentViewMode=UWA.clone(this.currentViewMode),"graphPie"!==this.currentViewMode&&"graphBar"!==this.currentViewMode||(this.currentViewMode="tag")),0===this.currentViewMode.indexOf("graph")?i="graph":0===this.currentViewMode.indexOf("people")?i="people":0===this.currentViewMode.indexOf("category")?i="category":0===this.currentViewMode.indexOf("freeInput")&&"daterange"==this.predicate.getType()?i="date":((i=this.predicate.getType()?this.predicate.getType():t&&t.length?t.first().get("type"):"string").startsWith("xsd:")&&(i=i.substring(4,i.length).toLowerCase()),"tree"===i&&(i="string")),t&&t.length||"people"===i&&"person"==this.id){switch(this.maxTagger?(this.container.removeClassName("hide"),this.toHaveTagsLimit=!0,this.hasMatchingResult&&this.predicateHeader.expandPredicate({expand:!0})):this.container.getElement(".toolbox").removeClassName("hide"),i){case"string":case"boolean":case"integer":case"float":case"double":case"date":"date"==i&&this.dateRange?(this.dateView||(this.dateView=new f({navImpl:this.navImpl,predicateId:this.id,taggerView:this.taggerView}).render().inject(a)),this.dateView.navImpl=this.navImpl):-1===this.currentViewMode.indexOf("freeInput")?(this.tagsListView||(this.tagsListView=new c({navImpl:this.navImpl,predicate:this.predicate,tagsLimit:this.toHaveTagsLimit,redrawFromSearch:this.hasMatchingResult,tvView:this.taggerView,maxTagger:this.getOption("maxTagger")}).render().inject(a),this.tagsListView.addEvent("tagExpanded",this.storeExpansionStatus.bind(this)),this.tagsListView.addEvent("_actionOnTag",this.actionOnPredicate.bind(this))),this.tagsListView.navImpl=this.navImpl,this.tagsListView.setTags(t,i,n),this.currentView=this.tagsListView):("date"==i?(this.dateView||(this.dateView=new f({navImpl:this.navImpl,predicateId:this.id,taggerView:this.taggerView}).render().inject(a)),this.dateView.navImpl=this.navImpl):this.freeInputView="string"==i?new m({navImpl:this.navImpl,predicate:this.predicate,type:i,redrawFromSearch:!1}).render().inject(a):"boolean"==i?new v({navImpl:this.navImpl,predicate:this.predicate,type:i,redrawFromSearch:!1}).render().inject(a):new T({navImpl:this.navImpl,predicate:this.predicate,type:i,redrawFromSearch:!1}).render().inject(a),this.freeInputView&&this.freeInputView.addEvent("criteriaSelected",function(){this.taggerView&&this.taggerView.setActiveCriteria(!0,!0)}.bind(this)));break;case"graph":this.graphView||(this.graphView=new d({navImpl:this.navImpl,predicate:this.predicate,taggerView:this.taggerView}).render().inject(a)),this.graphView.navImpl=this.navImpl;let e=this.currentViewMode.contains("Bar");this.graphView.setGraphBar(e),this.graphView.setTags(t,this.sort),this.currentView=this.graphView;let s=this;setTimeout(function(){s.graphView.restoreGraph()},1e3);break;case"people":this.personListView||(this.personListView=new u({hasAdvancedFocsuedProxy:this.hasAdvancedFocusedProxy,predicates:[this.id],expandablePerson:!1,navImpl:this.navImpl,noShowMore:!this.toHaveTagsLimit,taggerView:this.taggerView}).render().inject(a)),this.personListView.navImpl=this.navImpl,this.personListView.show(),this.personListView.redraw(n),this.predicateCount=this.personListView.getTotalNumberOfTags()||"",this.maxTagger&&(this.searchString&&"person"==this.id&&!this.predicateCount?this.container.addClassName("searchexcluded"):this.predicateCount>0&&(this.container.removeClassName("searchexcluded"),this.predicateHeader.setPredicateCount(this.predicateCount))),this.currentView=this.personListView;break;case"category":this.categoryView||(this.categoryView=new p({hasAdvancedFocsuedProxy:this.hasAdvancedFocusedProxy,predicates:[this.id],expandablePerson:!1,navImpl:this.navImpl,taggerView:this.taggerView}).render().inject(a)),this.categoryView.navImpl=this.navImpl,this.categoryView.show(),this.categoryView.redraw(n),this.currentView=this.categoryView}this.showMore&&(this.showMore.remove(),"string"==i?(this.showMore.show(),this.toggleElem.setText(s.getText("showLess"))):"category"==i?(this.showMore.show(),this.toggleElem.setText(s.getText("showAll"))):"graph"===i&&this.showMore.hide(),this.showMore.inject(a,"bottom"))}else this.getElement(".toolbox").addClassName("hide"),this.noTagsView?this.loadNoTagsView():this.maxTagger&&this.container.addClassName("hide");let o=this.navImpl.getListOfSelectedTagValues(this.predicateLineage);this.maxTagger||this.getElement(".clear-filters").toggleClassName("hide",!o.length),this.navImpl.isGroupedBy(this.id)&&this.container.getElement(".action-icon.groupBy").show()},setPredicateCount:function(){let e=this.navImpl.getFocusedProxy(),t=e?e.getPredicateCountPolicy():1;if(1==t||noCountOnTags){if(this.tagCollection)return this.tagCollection.length}else{if(2==t)return this.getTagsTotalCount();if(3==t){let t=e.getPredicateSummaryCount(this.id);return UWA.is(t,"number")&&t>0?t:this.getTagsTotalCount()}}},getTagsTotalCount:function(){let e=0;return 0==(e=this.tagCollection.reduce((e,t)=>t+e.get("count")))?this.tagCollection.length:e},hasAdvancedFocusedProxy:function(e,t){let i=e?e.getFocusedProxy():this.navImpl.getFocusedProxy();if(i&&t&&i.getAdvancedOption(t))return i},updateTagExpansion:function(e){this.tagsExpandStatus=UWA.clone(e)},storeExpansionStatus:function(e){if(this.maxTagger)e.expand?this.taggerCache.expandTagTree(e.id):this.taggerCache.collapseTagTree(e.id);else{let t={};t[e.id]=e.expand,this.dispatchEvent("preferenceChange",{tagExpansion:t})}},showDeleteButton:function(){this.container.getElement(".fonticon-trash").toggleClassName("hide",!0)},clearAllFiltersCB:function(){this.currentView.clearAllFilters()},loadNoTagsView:function(){this.noTagsView.setNoTagsContent(),this.noTagsView.inject(this.scrollerElem.elements.container).show()},changeSort:function(e){let t=e;return this.cache&&this.maxTagger?(this.cache.changeSort(t,this.predicateLineage),this.sort=this.cache.getCurrentSort(this.predicateLineage)):(this._updateSort(t),this.dispatchEvent("preferenceChange",{sort:this.sort})),"people"===this.currentViewMode&&this.personListView.setCurrentSort(this.sort),this.predicateHeader.updateToolBar({currentSort:this.sort,navImpl:this.navImpl,hideTagsCount:this.hideTagsCount}),this._redrawView(),!1},_updateSort:function(e){let t,i=this.sort;e==i.sortMode?i.order=!i.order:(i.sortMode=e,t=i.order,i.order=i.secondaryorder,i.secondaryorder=t)},sortTags:function(){let e=this.tagCollection,t=this;if(e&&e.length){let i=this._sortCollections(e),a=this.predicate.getType(),n=function(e){let i=e.getChildCollection();i.length&&(e.set("childCollection",t._sortCollections(i)),i.forEach(e=>{n(e)}))};return(this.isHierachicalPredicate||"date"==a)&&this.tagCollection.forEach(e=>{n(e)}),this.tagCollection=i}return[]},_sortCollections:function(e){let t=[];return this.hideTagsCount&&(this.sort=UWA.clone(this.sort),"nbSort"==this.sort.sortMode&&(this.sort.sortMode="alphaSort",this.sort.order=!0)),"nbSort"==this.sort.sortMode?0==this.sort.order?(e.comparator=function(e,t){return e.get("count")<t.get("count")?1:e.get("count")>t.get("count")?-1:e.get("displayName").localeCompare(t.get("displayName"))},t=e.sort()):(e.comparator=function(e,t){return e.get("count")>t.get("count")?1:e.get("count")<t.get("count")?-1:t.get("displayName").localeCompare(e.get("displayName"))},t=e.sort()):"alphaSort"==this.sort.sortMode&&(1==this.sort.order?(e.comparator=function(e,t){return e.get("displayName").toLowerCase().trim()>t.get("displayName").toLowerCase().trim()?1:e.get("displayName").toLowerCase().trim()<t.get("displayName").toLowerCase().trim()?-1:0},t=e.sort()):(e.comparator=function(e,t){return e.get("displayName").toLowerCase().trim()<t.get("displayName").toLowerCase().trim()?1:e.get("displayName").toLowerCase().trim()>t.get("displayName").toLowerCase().trim()?-1:0},t=e.sort())),t},updateTagColors:function(e){"people"===this.currentViewMode?this.personListView.updatePeopleList(this.navImpl):this.tagCollection.forEach((t,i)=>{t.updateColorization(e)})},_changeView:function(e){let t=this.currentViewMode;if(this.currentViewMode=e,this.maxTagger&&this.taggerCache?this.taggerCache.setViewMode(this.id,this.currentViewMode):this.dispatchEvent("preferenceChange",{currentViewMode:this.currentViewMode}),this._redrawView(),!this.maxTagger){let e={pd1:this.id,pd2:t,pd3:this.currentViewMode};try{C.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagsWidget",action:"onTagWidgetViewChange",persDim:e}})}catch(e){console.log("Message bus publish did not work!!")}}},colorizeTags:function(e){return this.colorManager.toggleColorize(this.predicateLineage),this.updateTagColors(!e),e?this.sendUnColorize():this.sendColorize(),!1},clearColorizedTags:function(){if(this.taggerView){let e=this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0;return e?(e.id===w.ACTION_COLORIZE&&("people"==this.currentViewMode&&this.personListView?this.personListView.clearTagColors():this.tagsListView&&this.tagsListView.clearTagColors()),this.wasColorized=!0,this.dispatchEvent("disablePredicate",{toDisable:!1,predicateId:this.id}),!1):void 0}},sendColorize:function(){let e,t=this.isHierachicalPredicate?"tree":this.predicate.getType();if("date"===t){let t,i=[],a=this.navImpl.getListOfSelectedTagValues(this.predicateLineage);a.length&&(t=a[0].uri);let n=t?3===t.split("/").length?3:t.split("/").length+1:1,s=this.colorManager.computedColorMap[this.predicateLineage];for(let e=0;e<s.tagColors.length;e++)s.tagColors[e].object.split("/").length==n&&i.push(s.tagColors[e]);e={}[this.predicateLineage]={tagColors:i}}else e="tree"===t?{}[this.predicateLineage]={tagColors:this.colorManager.getComputedMap(this.predicateLineage).tagColors.concat(this.colorManager.getColoredTreeTagList())}:this.colorManager.getComputedMap(this.predicateLineage);this.navImpl.colorize(e),this.colorManager._clearTempTreeMap()},sendUnColorize:function(){this.navImpl.unColorize(this.predicateLineage),this.colorManager._clearTempTreeMap()},onSearchEvent:function(e){let t;this.searchString=e?e.toLowerCase().trim():e,"people"==this.currentViewMode&&(t=this.personListView),"category"==this.currentViewMode&&this.categoryView.onSearchInput(this.searchString),this.currentViewMode.includes("graph")&&(t=this.graphView),t&&(t.setSearchString(this.searchString),this._redrawView())},getFilteredTags:function(){let e=this;this.hasMatchingResult=!1,this.tagCollection&&this.tagCollection.forEach(t=>{t.get("displayName").toLowerCase().includes(e.searchString.toLowerCase())||!e.searchString?(t.set("hide",!1),this.hasMatchingResult=!0):t.set("hide",!0)})},clearViewContent:function(){this.colorManager._clearTempTreeMap(),this.graphView&&this.graphView.clearContent(),this.tagsListView&&this.tagsListView.clearContent(),this.personListView&&(this.personListView.ulList.empty(),this.personListView.hide()),this.categoryView&&(this.categoryView._typesRootUL.empty(),this.categoryView.hide()),this.showMore&&this.showMore.remove(),this.noTagsView&&this.noTagsView.container.remove(),this.dateView&&(this.dateView.container.remove(),this.dateView=null),this.freeInputView&&(this.freeInputView.destroy(),this.freeInputView=void 0)},updateTagCollection:function(e){let t=this,a=function(e){let i=e.get("parent").id,s=n.get(i);s||(s=new g(e.get("parent"),{silent:!0}),n.add(s));let o=s.getChildCollection();if(o&&o.length&&o.get(e)&&o.remove(e),s.addToChildCollection(e),e.getParentModel()||(e.addToParentCollection(s),s.updateParentCount(e)),t.tagsExpandStatus){let e=t.tagsExpandStatus[i];s.updateExpansionStatus(e)}s.get("parent")?a(s):t.tagCollection.get(s)||t.tagCollection.add(s)};if(e.length){var n=new i([],{model:g});this.tagCollection?this.tagCollection.reset():this.tagCollection=new i([],{model:g}),e.forEach(e=>{let i=this.predicate.getType(),s=new g(e);s.get("parent")?("string"===i&&(this.isHierachicalPredicate=!0),a(s)):(n.add(s),t.tagCollection.add(s,{sort:!1}))})}else this.tagCollection&&this.tagCollection.reset()},toggleCategoryview:function(){"category"==this.currentViewMode?(this.predicateHeader.changeToTagsListView(),this.maxTagger&&(this.predicateHeader.setPredicateCount(this.setPredicateCount()),this.predicateHeader.getElement(".predicate-count").show())):(this.predicateHeader.changeToCategoryView(),this.maxTagger&&(this.predicateHeader.setPredicateCount(""),this.predicateHeader.getElement(".predicate-count").hide()))},updateColorizeOptions:function(e){this.predicateHeader.updateColorizeOptions(e)},updateGrouping:function(e){let t=this;var i=this.taggerView&&this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0;if(i)i.onPredicateSelection(this.container,!0).then(function(){t.predicateHeader.updateGroupingIcon(),"tag"===t.currentViewMode&&t.tagsListView?t.tagsListView.updateGroupedTags():"people"===t.currentViewMode&&t.personListView&&t.personListView.updateGroupedTags()});else if(this.taggerView.actionManager){return void this.taggerView.actionManager.startAction({action:w.ACTION_GROUP,isInteractive:!1}).onPredicateSelection(this.container,!0).then(function(){t.predicateHeader.updateGroupingIcon(),t.taggerView.actionManager.launchAction({isInteractive:!1})}.bind(this))}},updatePredicateForColorize:function(e){let t=this.cache.colorManager,i=t.isColorized(this.predicateLineage)||t.isInColorization(this.predicateLineage),a=t.activePredicate&&t.activePredicate!==this.predicateLineage||t.getInColorizePredicate()||void 0,n=this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0,s=!0;if("cancel"!==e.action&&"execute"!==e.action||(s=!1,this.container.removeClassName("add-opacity")),"category"===this.currentViewMode||this.dateRange||"freeInput"==this.currentViewMode||a)return"cancel"===e.action||"execute"===e.action?void this.container.removeClassName("add-opacity"):void this.container.addClassName("add-opacity");if(this.wasColorized||i){if("cancel"===e.action)i?this.tagsListView?this.tagsListView.resetColorizedTags():this.personListView&&this.personListView.resetColorizedTags():(t.clearComputedColorMap(this.predicateLineage),t.clearComputedPartialColorMap(this.predicateLineage)),this.predicateHeader.updateColorizeActionOptions(s);else if("start"===e.action){"tag"===this.currentViewMode&&this.tagsListView?this.tagsListView.updateColorizedTags():"people"===this.currentViewMode&&this.personListView&&this.personListView.updatePersonColorizedTags();let e=n.getSelectionCount();this.predicateHeader.updateColorizeActionOptions(s),this.predicateHeader.updateClearText(e)}else this.predicateHeader.updateColorizeActionOptions(s);this.wasColorized=!1}},actionOnPredicate:function(e){e&&e.id===w.ACTION_COLORIZE&&(e.selectionCount&&this.predicateLineage===e.fullPredId?(this.cache.colorManager.inColorizePredicate(this.predicateLineage),this.dispatchEvent("disablePredicate",{toDisable:!0,predicateId:this.id}),this.wasColorized=!0):(this.dispatchEvent("disablePredicate",{toDisable:!1,predicateId:this.id}),this.wasColorized=!0),this.predicateHeader.updateColorizeActionOptions(!0),this.predicateHeader.updateClearText(e.selectionCount))},disablePredicateForColorize:function(e){e.toDisable?this.container.addClassName("add-opacity"):this.container.removeClassName("add-opacity")},updatePredicateForExclude:function(e){"start"===e.action?"date"===this.predicate.getType()&&this.container.addClassName("exclude-disable"):this.container.removeClassName("exclude-disable")},updatePredicateForGrouping:function(e){if("update"===e.action)if(e.grouping.isPredicate)this.predicateHeader.updateGroupingIcon(!1);else{let e=options.grouping.text;"tag"===this.currentViewMode&&this.tagsListView?this.tagsListView.tagsView[e].toggleGrouping():"people"===this.currentViewMode&&this.personListView&&this.personListView.toggleGrouping(e)}else"start"===e.action?"date"!==this.predicate.getType()&&this.navImpl.hasGroupingSupport(this.id)||this.container.addClassName("group-disable"):this.container.removeClassName("group-disable")},showNewMessageOnView:function(e){if(e&&e.hasOwnProperty("predicateInfo")){let t;e.predicateInfo.predicateId===this.id&&(t=e),this.warningInfoView.setMessageText(t)}else this.warningInfoView.setMessageText(e)},destroyViews:function(){this.tagsListView&&this.tagsListView.destroy(),this.graphView&&this.graphView.destroy(),this.personListView&&this.personListView.destroy(),this.categoryView&&this.categoryView.destroy(),this.dateView&&this.dateView.destroy()},destroy:function(){this.stopListening(),this.predicateHeader.destroy(),this.destroyViews(),this._parent()}})}),define("DS/TagNavigator/simplified/views/RootWView",["UWA/Core","UWA/Class/View","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerSettings","DS/TagNavigator/Logger","DS/TagNavigator/TagWidget/PredicateView","DS/TagNavigator/simplified/views/WrapperView"],function(e,t,i,a,n,s,o){"use strict";var r=t.extend({searchString:"",customSearch:!1,_tabView:void 0,_rootW:void 0,_preferredPredicates:void 0,_redrawStatus:void 0,_optimizedRedraw:void 0,init:function(e){this._optimizedRedraw=a.getOption("optimizedRedraw"),this._redrawStatus=!0,this._parent(e)},setup:function(e){this._parent(e)},render:function(){if(this.customSearch||this.getTaggerView().addEvent("TopBarSearch",this.onSearchInput.bind(this)),this.getTaggerView().addEvent("redrawStatusUpdate",this.onRedrawStatusUpdate.bind(this)),this.toInstPV=this.getOption("toInstPV"),this.predicateViews={},this.toInstPV){let e=this.container,t=this.getWViewExpandStatus(),i=this.getOption("expandDirection")||"vertical";this.wrapperView=new o({rootW:this._rootW,wExpandStatus:t,expandDirection:i,content:e,noResize:"ds6w:what"===this._rootW}).render(),this.wrapperView.addEvent("onExpanderToggle",this.storeWExpandStatus.bind(this))}return this},activate:function(){this.show()},deactivate:function(){this.hide()},getTaggerView:function(){return this.getOption("taggerView")},getObservedNavImpl:function(){return this.getTaggerView().getObservedNavigator()},availableTagsToHtml:function(e,t,i){return e.availableTagsToHtml(this._rootW,this._getPredicateInfo(t),i)},hasFocusedProxy:function(){return this.getTaggerView().hasFocusedProxy()},hasAdvancedFocsuedProxy:function(e,t){return this.getTaggerView().hasAdvancedFocsuedProxy(e,t)},_getPredicateInfo:function(e){var t,i=e||this.hasFocusedProxy();return i&&(t=i.getPredicateInfo()),t},redraw:function(){return r.getContentStatus(this.container)},instantiatePredicateViews:function(e){this.createPreferredTags(e),this.toggleMoreTags(e)},toggleMoreTags:function(t){let i=this,a=this.getObservedNavImpl().getProxiesToDisplay();if(a&&a.length)if(this.container.getElement(".more-content")?this.moreDiv.inject(this.container.getElement("#all-tags")):(this.moreDiv=e.createElement("div",{class:"more-content"}).inject(this.container.getElement("#all-tags")),e.createElement("hr").inject(this.moreDiv)),this.toShow){let e=this.getMoreTags();if(e.length){if(this.moreTagsView=[],this._createPredicateViews(e,t,"moreTags"),this.moreTagsView.forEach(e=>{e.container.hasClassName("searchexcluded")||e.show()}),this.moreDiv.addClassName("expanded"),this.moreTagsView.length){this.preferredDiv.getElements(".tnw.predicate").length&&this.container.addClassName("addHR")}}else this.moreTagsView&&this.moreTagsView.length&&(this.moreTagsView.forEach(e=>{let t=e.id;delete i.predicateViews[t],e.destroy()}),this.moreTagsView=[],this.container.removeClassName("addHR"),this.moreDiv.empty())}else this.moreDiv.removeClassName("expanded"),this.moreTagsView&&this.moreTagsView.length&&(this.moreTagsView.forEach(e=>{let t=e.id;delete i.predicateViews[t],e.destroy()}),this.moreTagsView=[],this.container.removeClassName("addHR"));else this.destroyPredicateViews()},setToShowProperty:function(e){this.toShow=e},createPreferredTags:function(t,a,n){let s=this.getObservedNavImpl().getProxiesToDisplay();if(s&&s.length){if(this.container.getElement(".preferred-content")||(this.preferredDiv=e.createElement("div",{class:"preferred-content"}).inject(this.container.getElement("#all-tags"))),a=a||this._getPreferredPredicates(),this.getObservedNavImpl().getFocusedProxy()){let e=this._getPredicateInfo();a=a.sort(function(t,a){let n=i.getPredicate(t),s=i.getPredicate(a);var o=e[t].hasOwnProperty("weight")?e[t].weight:1,r=((e[a].hasOwnProperty("weight")?e[a].weight:1)||1)-(o||1);return 0===r?n.displayName().localeCompare(s.displayName()):r})}else a=a.sort(function(e,t){let a=i.getPredicate(e),n=i.getPredicate(t);return a.displayName().localeCompare(n.displayName())});this._createPredicateViews(a,t,"preferredTags",n)}else this.destroyPredicateViews()},_createPredicateViews:function(e,t,a,n){var o=this.getTaggerView(),r=this.getObservedNavImpl();let l=r.getCache(),c=this;t.searchString=this.getTaggerView().searchedString,e.length&&e.forEach(e=>{if(!this.predicateViews[e]&&(r.getTagInfo(e).length||"person"===e)){let n=i.getPredicate(e),d=o.getCacheSimplified().getViewMode(e,n.is6WRoot()?void 0:n.get6WRootFather().id()),g=l.getCurrentSort(n.getFullPredicateID()),h=new s({navImpl:r,predicate:n,viewMode:d,sort:g,taggerCache:o.getCacheSimplified(),maxTagger:!0,searchString:t.searchString,taggerView:o,onSearch:t.onSearch}).render().inject("preferredTags"===a?c.preferredDiv:c.moreDiv);this.predicateViews[e]=h,h.addEvent("disablePredicate",this.disablePredicate.bind(this)),"moreTags"==a&&this.moreTagsView.push(h)}this.predicateViews[e]&&(this.toShow&&this.predicateViews[e].container.removeClassName("hide"),this.predicateViews[e].inject("preferredTags"===a?c.preferredDiv:c.moreDiv),"ds6w:when"===this._rootW&&n?t.dateRange=!0:delete t.dateRange,this.predicateViews[e].redrawPredicateView(t))})},disablePredicate:function(e){this.dispatchEvent("disablePredicateForColorize",e)},_redrawPredicateViews:function(e){if(0!=Object.keys(this.predicateViews).length)for(const t in this.predicateViews)this.predicateViews[t]&&(this.predicateViews[t].inject(this.container.getElement("#all-tags")),this.predicateViews[t].redrawPredicateView(e))},getMoreTags:function(){var t=void 0,a=this.getTaggerView().hasFocusedProxy();a?(t=this._getPreferredPredicates(),e.is(t,"array")&&0==t.length&&(t=void 0),t||(t=[]),t=t.concat(a.getHiddenPredicates())):(t=this._getPreferredPredicates())&&(t=t.concat(this.getTaggerView().observedNavImpl.hasHiddenPredicates()||[]));let n=[];return this.getObservedNavImpl().getPredicateTagsMap(this._rootW).forEach(e=>{-1===t.indexOf(e)&&n.push(e)}),n=n.sort(function(e,t){let a=i.getPredicate(e),n=i.getPredicate(t);return a.displayName().localeCompare(n.displayName())})},_getPreferredPredicates:function(e,t){var a,n=this;return(a=this.getObservedNavImpl().hasPreferredPredicates(!0))||(this._preferredPredicates||(this._preferredPredicates=[]),a=this._preferredPredicates),a.filter(function(e){var a=i.getPredicate(e);if("ds6w:who"!==e&&a)return a.get6WRootFather().id()===n._rootW&&(!t||a.getType()==t)})},clearViews:function(){this.getTaggerView().destroyTagValues()},isActiveView:function(){return!this.container.isHidden()},getActiveTabId:function(){return this._tabView?this._tabView.selectedTab.getName():""},onSearchInput:function(e){this.searchString=e,this._redrawStatus=!0,this.isActiveView()&&this.redraw({onSearch:!0})},onRedrawStatusUpdate:function(e){this._redrawStatus=e,n.warn("RootWView: new redraw status="+e)},getContentStatus:function(e){var t={viewId:this._rootW,isEmpty:!1,hasNoResults:!1,hideBorder:!1},i=e.getElements(".predicate.searchexcluded").length,a=e.getElements(".predicate").length;if(0===a)t.isEmpty=!0;else if(i==a&&(t.hasNoResults=!0),1===a){e.getElements(".predicate")[0].isHidden()&&(t.isEmpty=!0),t.hideBorder=!0}return t},destroyPredicateViews:function(){this.moreTagsView=[],this.moreTagsLoaded=!1,this.preferredDiv&&this.preferredDiv.empty(),this.moreDiv&&this.moreDiv.empty();for(const e in this.predicateViews)this.predicateViews[e].destroy();this.predicateViews={}},getWViewExpandStatus:function(e){let t,i=this.getTaggerView().getCacheSimplified();switch(e&&(i.setExpandCollapseRootWStatus("preferred",this._rootW,!0),i.setExpandCollapseRootWStatus("all",this._rootW,!0)),this.getOption("view")){case"maximize":t=i.getExpandCollapseStatusRootW("preferred",this._rootW)||i.getExpandCollapseStatusRootW("all",this._rootW);break;case"preferred":t=i.getExpandCollapseStatusRootW("preferred",this._rootW);break;case"all":t=i.getExpandCollapseStatusRootW("all",this._rootW)}return t},setWViewExpandStatus:function(e){let t=this.getWViewExpandStatus(e);this.wrapperView.setExpandStatus(t)},storeWExpandStatus:function(e){let t=this.getTaggerView().cacheForSimplified;if(t.setExpandCollapseRootWStatus("preferred",e.rootW,e.expand),t.setExpandCollapseRootWStatus("all",e.rootW,e.expand),e.expand){let e={searchString:this.getTaggerView().searchedString};this.redraw(e)}this.dispatchEvent("RootWCollapsed")},destroy:function(){this.wrapperView&&this.wrapperView.destroy(),this.getTaggerView().removeEvent("TopBarSearch"),this.destroyPredicateViews(),this.stopListening(),this.model=null,this._parent()}});return r}),define("DS/TagNavigator/simplified/actions/Colorize",["UWA/Core","DS/TagNavigator/simplified/actions/AbstractAction","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/simplified/utils/PersonUtils"],function(e,t,i,a,n){"use strict";return t.extend({setup:function(){this._parent(),this.set({actionClass:"colorized"}),this._selection=this.get("selection"),this._selectionToReset=[],this.taggerView=this.getTaggerView()},onTagSelection:function(e,t){var n=e.getClosest(".predicate"),s=n.getAttribute("predicate"),o=e.getAttribute("title"),r=i.getPredicate(s);let l,c=a.getPredicateView(r),d=[];if(e.hasAttribute("level")||e.getClosest(".hierarchy")){var g,h=[],u=[],p=e.getElement(".arrow.tree"),f=e;if(e.hasAttribute("level")){for(;g=f.getClosest("ul.treeTags");)h.push(g),f=g.getClosest("ul.tags-list");for(var m=h.length-1;m>=0;m--)u.push(h[m].getElement("li.tag").getElement(".tag-label").getText())}else if(e.getClosest(".hierarchy")){for(u.push(f.getElement(".tag-label").getText()),f=f.getClosest(".tags-list-tree");g=f&&f.getClosest("li.tag.expanded");)u.push(g.getElement(".tag-label").getText()),f=g.getClosest(".tags-list-tree");u=u.reverse()}p||u.push(e.getElement(".tag-label").getText()),d=c.getTagValueViews(u,!0),l=u.length-1,d[0]=d[0][l]}else d=c.getTagValueViews(o);let v=this.taggerView.getObservedNavigator().getCache();if(this.fullPredId=r.getFullPredicateID(),this.copiedColorMap||(v.colorManager.copyInPartialMap(this.fullPredId),v.colorManager.copyOfPartialColorizeMap(this.fullPredId),this.copiedColorMap=!0),e.hasClassName("colorize")){e.removeClassName("colorize"),e.removeClassName("picked-for-colorize");var T=this._selection.findIndex(function(t){return t===e.id});-1!==T&&this._selection.splice(T,1),e.getElement(".tag-color").addClassName("hide-color");let t=v.colorManager.resetColorForTagValue(d[0]);this._selectionToReset.push({tv:d[0],color:t,isRemoved:!0,tagElem:e,parentElem:n})}else{v.colorManager.checkForMapObject(this.fullPredId,d[0]),e.addClassName("colorize"),e.addClassName("picked-for-colorize"),this._selection.push(e.id);let t=v.colorManager.getNewColorForTagValue(d[0],!0);t&&(e.getElement(".tag-color").setStyle("background-color",t),e.getElement(".tag-color").removeClassName("hide-color"),this._selectionToReset.push({tv:d[0],color:t,isRemoved:!1,tagElem:e,parentElem:n}))}return this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount()),v.colorManager.inColorizePredicate(this.fullPredId),this.disablePredicate(n,s),!1},disablePredicate:function(e,t){let i=this.taggerView.tagsContainer.getElements("li.predicate"),a=!!e.getElements(".colorize").length;e.toggleClassName("colorize",a),e.getElement(".toolboxView.fonticon-palette")&&e.getElement(".toolboxView.fonticon-palette").toggleClassName("selected",a),i.forEach((e,i)=>{let n=e.getAttribute("predicate");e.getElement(".toolboxView.fonticon-palette")&&e.getElement(".tool-icon.fonticon-palette").addClassName("hide"),n!==t&&(e.getElement(".predicate-content .innerForTransition").toggleClassName("add-opacity",a),e.getElement(".toolbox")&&e.getElement(".toolbox").toggleClassName("add-opacity",a))}),e.getElement(".clear-selection").toggleClassName("hide",!this.getSelectionCount()),e.getElement(".predicate-label").toggleClassName("adjust-width",this.getSelectionCount())},onPersonSelection:function(e,t,a,s){let o,r,l,c,d,g,h;if(e){o=e.view.container,r=e.refineData,l=e.isComplex,d=(c=e.model).get("tagValues"),h=(g=o.getClosest(".predicate")).getAttribute("predicate");var u=i.getPredicate(h);this.fullPredId=u.getFullPredicateID()}else{let e=this.taggerView.getObservedNavigator(),p=n.getUsersInfo(e,[t]),f=a.getElement(".item-label").getText();g=(o=a).getClosest("li.predicate"),h=t;u=i.getPredicate(h);this.fullPredId=u.getFullPredicateID(),c=p.filter(e=>{if(e.get("title")==f)return e}),r=(l=this.taggerView.hasAdvancedFocsuedProxy(e,n.PERSON_REFINE)&&s)?n.buildCondition(c):c[0].getRefineStructure(this.fullPredId),d=c[0].get("tagValues")}let p,f=this.taggerView.getObservedNavigator().getCache();if(this.copiedColorMap||(f.colorManager.copyInPartialMap(this.fullPredId),f.colorManager.copyOfPartialColorizeMap(this.fullPredId),this.copiedColorMap=!0),o.hasClassName("colorize")){o.removeClassName("colorize"),o.removeClassName("picked-for-colorize"),p=l?r.condition.object:r.object;var m=this._selection.findIndex(e=>e===p);-1!==m&&this._selection.splice(m,1);let e=f.colorManager.resetColorForPersonTagValue(d[0]);o.getElement("img").setStyle("border","none"),this._selectionToReset.push({tv:d[0],color:e,isRemoved:!0,tagElem:o,isPerson:!0,parentElem:g})}else{f.colorManager.checkForMapObject(this.fullPredId,d[0]),o.addClassName("picked-for-colorize"),l?this._selection.push(r.condition.object):this._selection.push(r.object);let e=f.colorManager.getColorForTagValue(d[0],!0);e&&this.addColorToPerson(o,e),this._selectionToReset.push({tv:d[0],color:e,isRemoved:!1,tagElem:o,isPerson:!0,parentElem:g})}return f.colorManager.inColorizePredicate(this.fullPredId),this.get("isInteractive")&&this.set("selectionCount",this.getSelectionCount()),this.disablePredicate(g,h),!1},addSelections:function(){let e=this.taggerView.getElements(".colorize"),t=this;console.log("Selection count: "+this.get("selectionCount")),e.forEach(e=>{e.hasClassName("predicate")||(e.addClassName("picked-for-colorize"),e.id?t._selection.push(e.id):e.hasClassName("people-view")&&t._selection.push(e.getElement(".item-label").getText()),t.get("isInteractive")&&t.set("selectionCount",t.getSelectionCount()))})},removeSelections:function(e){let t=this;this.taggerView.getElements(".picked-for-colorize").forEach(i=>{i.removeClassName("picked-for-colorize");let a=i.hasClassName("people-view"),n=i.hasClassName("expandable");if(e)if(a){let e=i.getClosest("li.predicate").getAttribute("predicate");t.onPersonSelection(null,e,i,n)}else t.onTagSelection(i)})},addColorToPerson:function(e,t){e.addClassName("colorize"),e.getElement("img").setStyle("border","5px solid "+t),e.getElement("img").setAttributes({color:t})},executeColorize:function(){this.copiedInMap=!1;let e=this.taggerView.getObservedNavigator().getCache(),t=this.fullPredId||e.colorManager.activePredicate||e.colorManager.getInColorizePredicate();e.colorManager.colorizePredicate(t),this.taggerView.warnForColorize(e.colorManager.computedPartialColorMap[t]),this.removeSelections()},cancelColorize:function(){this.copiedInMap=!1;let e=this.taggerView.getObservedNavigator().getCache(),t=e.colorManager.reassignComputedMap();t&&this._selectionToReset.forEach((i,a)=>{let n=UWA.is(i.tv.id,"function")?i.tv.id():i.tv.uri;for(let i=0;i<t.length;i++)if(t[i].object==n){e.colorManager.setColorByTV(t[i].predicate,n,t[i].color);break}}),e.colorManager.inColorizePredicate(),this.removeSelections()}})}),define("DS/TagNavigator/simplified/actions/ActionsManager",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Events","DS/TagNavigator/Predicate","DS/TagNavigator/Logger","DS/SNInfraUX/tracker/SearchTrackerApi","DS/TagNavigator/simplified/views/ActionsView","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/actions/Select","DS/TagNavigator/simplified/actions/Exclude","DS/TagNavigator/simplified/actions/Group","DS/TagNavigator/simplified/actions/SelectInApp","DS/TagNavigator/simplified/actions/EditTagsSelect","DS/TagNavigator/simplified/actions/Colorize","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f){"use strict";return t.singleton(i,a,{init:function(e){o.set(),this.setOptions(e);var t,i,a=this.getOption("taggerView");this.initActionsView=function(){return t||((t=new r({taggerView:a}).render()).addEvent("onActionSelection",this.startAction.bind(this)),t.addEvent("onActionLaunched",this.launchAction.bind(this)),t.addEvent("onActionCancelled",this.cancelAction.bind(this)),t.addEvent("addOpacity",this.addOpacity.bind(this)),t.addEvent("removeOpacity",this.removeOpacity.bind(this)),t.addEvent("addRemoveCompanyTags",this.addRemoveCompanyTags.bind(this))),t},this.addRemoveCompanyTags=function(){a.launchAddRemoveCompanyTags()},this.hideActionMenu=function(){t.hideActionMenu()},this.enablePrimaryButton=function(){t.enablePrimaryButton()},this.redraw=function(e){t&&(e.abortAction&&this.abortAction(),t.redraw())},this.getCurrentAction=function(){return i},this.addOpacity=function(){a.addOpacity()},this.removeOpacity=function(){a.removeOpacity()},this.removeSelectedAction=function(){let e=a.container.getElement(".actionSelected");e&&e.removeClassName("actionSelected")},this.startAction=function(e){if(i)throw new Error("INVALID: action already exists");switch(e.action){case l.ACTION_SELECT:i=new c({id:l.ACTION_SELECT,isInteractive:e.isInteractive,selection:[]});break;case l.ACTION_GROUP:this._startGrouping(e);break;case l.ACTION_EXCLUDE:this._startExclude(e);break;case l.ACTION_EDITTAGREL:i=new u({id:l.ACTION_EDITTAGREL,isInteractive:!0,selection:[],taggerView:function(){return a}}),a.toggleActiveTagsMode(),a.addOpactiyToolbar();break;case l.ACTION_SELECTINAPP:i=this._startSelectInApp(e);break;case l.ACTION_COLORIZE:this._startColorize(e)}return a.tagContainer.removeClassName("add-opacity"),t.updateModel(i),i&&i.id==l.ACTION_EDITTAGREL&&(e.stdView||a.callUpdateModelOnActiveActions(i),a.disableType("start")),f.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"startAction",persDim:{pd1:e.action}}}),i},this.launchAction=function(e){switch(i.id){case l.ACTION_SELECT:this._executeSelect(e);break;case l.ACTION_GROUP:this._executeGrouping(e);break;case l.ACTION_EXCLUDE:this._executeExclude(e);break;case l.ACTION_EDITTAGREL:this._executeEditTagsSelect();break;case l.ACTION_SELECTINAPP:this._executeSelectInApp(e);break;case l.ACTION_COLORIZE:this.executeColorize()}this.removeSelectedAction(),a.removeOpacity(),f.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"launchAction",persDim:{pd1:this.getCurrentAction().id}}}),i&&i.id==l.ACTION_EDITTAGREL&&(e&&!e.stdView&&(a.callUpdateModelOnActiveActions(i),t.showActionMenu()),a.disableType("launch")),i=void 0,t.resetBox(),t.updateModel(i)},this.cancelAction=function(e){i.id==l.ACTION_COLORIZE?(i.cancelColorize(),a.isMaximized&&a.maximizeTaggerView.updatePredicateForColorize({action:"cancel"})):i.id==l.ACTION_EXCLUDE?a.isMaximized&&a.maximizeTaggerView.updatePredicateForExclude({action:"cancel"}):i.id==l.ACTION_GROUP&&a.isMaximized&&a.maximizeTaggerView.updatePredicateForGrouping({action:"cancel"}),i&&i.id==l.ACTION_EDITTAGREL&&(e&&!e.stdView&&(a.callUpdateModelOnActiveActions(i),t.showActionMenu()),a.disableType("launch")),this.removeSelectedAction(),i&&i.id!==l.ACTION_EDITTAGREL&&(i=void 0),a.actionCancel(),i=void 0,t.resetBox(),t.updateModel(i),a.removeOpacity(),i&&i.id==l.ACTION_EDITTAGREL&&a.disableType("cancel")},this.abortAction=function(){i&&(i.get("isInteractive")&&t.abortAction(),i.id==l.ACTION_COLORIZE?(i.cancelColorize(),a.isMaximized&&a.maximizeTaggerView.updatePredicateForColorize({action:"cancel"})):i.id==l.ACTION_EXCLUDE?a.isMaximized&&a.maximizeTaggerView.updatePredicateForExclude({action:"cancel"}):i.id==l.ACTION_GROUP&&a.isMaximized&&a.maximizeTaggerView.updatePredicateForGrouping({action:"cancel"}),a.removeOpacity(),i=void 0,t.resetBox(),t.updateModel(i))},this._startSelectInApp=function(e){return new h({id:l.ACTION_SELECTINAPP,isInteractive:e.isInteractive,selection:[]})},this._startGrouping=function(e){var t=a.getObservedNavigator(),o=t.getFocusedProxy();let r=[];if(r=o?o.getActiveGroupings():t.getActiveGroupings(),i=new g({id:l.ACTION_GROUP,isInteractive:e.isInteractive,selection:r,taggerView:function(){return a},current:e.current}),e.isInteractive)a.isMaximized?a.maximizeTaggerView.updatePredicateForGrouping({action:"start"}):a.container.getElements("li.predicate").forEach(function(e){var i=e.getAttribute("predicate");"date"==n.getPredicate(i).getType()?e.addClassName("group-disabled"):0==t.hasGroupingSupport(i)&&e.addClassName("group-disabled")});else if(e.grouping){var c=n.getPredicate(e.grouping.predicate),d=c.get6WRootFather();if(i.removeAddedObject(c,e.grouping.isPredicate?void 0:e.grouping.text),a.isMaximized)a.maximizeTaggerView.updatePredicateForGrouping({action:"update",rootW:d,predicate:c.id(),groupingInfo:e.grouping});else{var h=a.container.getElement("li.predicate[predicate='"+c.id()+"']");if(h||"type_categorization"==c.id()&&(h=a.container.getElement("li.predicate[predicate='ds6w:type']")),h)if(e.grouping.isPredicate){var u=h.getElement(".predicate-header");u.removeClassName("grouped-by"),u.getElement(".action-icon").remove()}else{var p=h.getElement(".predicate-content .tag[title='"+e.grouping.text+"']");if(p)p.removeClassName("grouped-by");else{var f=h.getElements(".predicate-content .people-view-container .people-view.grouped-by");f?f.forEach(function(t,i){t.getElement(".people-filter").getAttribute("title")==e.grouping.text&&(t.removeClassName("picked"),t.removeClassName("grouped-by"),t.getElement(".people-template").removeClassName("people-selected"))}):s.log("FAILED to locate the tag element in the DOM")}}else s.log("FAILED to locate the predicate element in the DOM")}this.launchAction({isInteractive:!1})}else if(e.embedded&&!e.refreshMode)e.remove&&i.removePredicate(e.remove),e.add&&i.addPredicate(e.add),this.launchAction({isInteractive:!1});else if(e.refreshMode){i.isRefreshNeeded({isEmbedded:e.embedded})?this.launchAction({isInteractive:!1,forcedUpdate:!0}):this.abortAction()}},this._executeGrouping=function(e){var t=i.get("selection");s.log("The selected predicates and tags for GROUPING are:"+JSON.stringify(t)),a.setSpinner(),a.getObservedNavigator().setGroupedByStatus(t,!0,e&&e.forcedUpdate),this._endGrouping(e)},this._endGrouping=function(e){e.isInteractive&&(a.isMaximized?a.maximizeTaggerView.updatePredicateForGrouping({action:"execute"}):a.container.getElements("li.predicate").forEach(function(e){e.removeClassName("group-disabled")}))},this._endSelectInApp=function(e){i.removeTagHighlight()},this._startExclude=function(e){(i=new d({id:l.ACTION_EXCLUDE,isInteractive:e.isInteractive,selection:[]}),e.isInteractive)&&(a.isMaximized?a.maximizeTaggerView.updatePredicateForExclude({action:"start"}):a.container.getElements("li.predicate").forEach(function(e){var t=e.getAttribute("predicate");"date"==n.getPredicate(t).getType()&&e.addClassName("exclude-disabled")}))},this._executeExclude=function(e){var t=i.get("selection");s.log("The selected predicates and tags for EXCLUDE are:"+JSON.stringify(t)),a.setSpinner();var n=a.getObservedNavigator();n.getFocusedProxy()||n.dispatchEvent("onBeforeGlobalFilterChange");for(var o=0;o<t.length;o++){var r=t[o];UWA.is(r,"object")?r.isComplex?n.toggleComplexTagSelection(r,!1,!0):n.toggleTagSelection(r,!1,!0):a.toggleTagSelection(r,!1,!0)}a.getObservedNavigator().onRefine(),this._endExclude(e)},this._endExclude=function(e){e.isInteractive&&(a.isMaximized?a.maximizeTaggerView.updatePredicateForExclude({action:"execute"}):a.container.getElements("li.predicate").forEach(function(e){var t=e.getAttribute("predicate");"ds6w:when"==n.getPredicate(t).get6WRootFather().id()&&e.removeClassName("exclude-disabled")}))},this._executeSelect=function(e){a._onRefineLaunch(i.get("selection"))},this._executeEditTagsSelect=function(){a._onEditTagsRefine()},this._startColorize=function(e){if(i=new p({id:l.ACTION_COLORIZE,isInteractive:e.isInteractive,selection:[],taggerView:function(){return a}}),t.updateModel(i),a.isMaximized)a.maximizeTaggerView.updatePredicateForColorize({action:"start"});else{let e=a.getObservedNavigator().getCache();a.ensureColorCusto(e).then(function(){i.addSelections(),a.container.getElements("li.predicate").forEach((e,t)=>{let i=e.getAttribute("predicate");"date"==n.getPredicate(i).getType()&&e.getElement(".tn-calendar-div")&&!e.getElement(".tn-calendar-div").isHidden()&&e.addClassName("add-opacity"),e.getElement(".tool-icon.fonticon-palette")&&e.getElement(".tool-icon.fonticon-palette").addClassName("hide");let s=a.taggerUWAElement.getElement(".predicate.colorize");if(s){i!==s.getAttribute("predicate")&&(e.getElement(".predicate-content .innerForTransition").addClassName("add-opacity"),e.getElement(".toolbox")&&e.getElement(".toolbox").addClassName("add-opacity"))}}),a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette")&&(a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette").addClassName("hide"),a.taggerUWAElement.getElement(".predicate.colorize .clear-selection").removeClassName("hide"))})}},this.executeColorize=function(){(i.executeColorize(),a.isMaximized)?a.maximizeTaggerView.updatePredicateForColorize({action:"execute"}):(a.container.getElements("li.predicate").forEach(function(e){e.getElement(".tool-icon.fonticon-palette")&&e.getElement(".tool-icon.fonticon-palette").removeClassName("hide");var t=e.getAttribute("predicate");"ds6w:when"==n.getPredicate(t).get6WRootFather().id()&&e.removeClassName("add-opacity")}),a.taggerUWAElement.getElement(".predicate.colorize")&&(a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette")&&a.taggerUWAElement.getElement(".predicate.colorize .action-icon.fonticon-palette").removeClassName("hide"),a.taggerUWAElement.getElement(".predicate.colorize .clear-selection").addClassName("hide")))},this._executeSelectInApp=function(e){var t=i.get("selection");s.log("The selected predicates and tags for SELCT_IN_APP are:"+JSON.stringify(t)),a.setSpinner();let n={};t.forEach(function(e){let t={};t=e.predicate?e:JSON.parse(a.getIdFromDOMId(e)),n[t.predicate]||(n[t.predicate]=[]),t.isComposite&&Array.isArray(t.object)?t.object.forEach(e=>{n[t.predicate].push({disptext:t.dispValue,object:e,type:t.type,field:["implicit"]})}):n[t.predicate].push({disptext:t.dispValue,object:t.object,type:t.type,field:["implicit"]})}),a.getObservedNavigator().setSelectInAppStatus(n),this._endSelectInApp(e)}}})}),define("DS/TagNavigator/simplified/views/RootWhoView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/Logger","UWA/Class/Promise","DS/TagNavigator/Predicate","DS/TagNavigator/TagValue","DS/TagNavigator/TagValueView"],function(e,t,i,a,n,s,o,r){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-who-container",init:function(e){this._rootW="ds6w:who",this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags",class:"people-container"}),this._contentDiv.inject(this.container),this._parent()},toggleToolBoxVisibility:function(e){this.sortIcon.container.toggleClassName("expanded")},redraw:function(e){return this.redrawOptions=e,new n(function(t){if(a.log("RootWhoView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return a.warn("RootWhoView: redraw status is false, returning.."),this;this._contentDiv.empty();var n=this.getObservedNavImpl(),l=this.hasAdvancedFocsuedProxy(n,i.PERSON_REFINE),c=this._getPreferredPredicates().filter(function(e){return"ds6w:who"!=e});if(l&&c.length>0){var d=this.getTaggerView(),g=new o(i.personPredicate,{type:"string",displayValue:"Person",hasDisplayValue:!0});new r(g,d,1);let a=["person"],n=s.getCommunityTagPredicate(this._rootW).id();-1!=c.indexOf(n)&&a.push(n);let l=s.getCompanyTagPredicate(this._rootW).id();-1!=c.indexOf(l)&&a.push(l);let u=s.getAutoCompanyTagPredicate(this._rootW).id();if(-1!=c.indexOf(u)&&a.push(u),this.toInstPV)a=this.updatePredicateList(a),this.createPreferredTags(e,a),this.toShow&&this.toggleMoreTags(e);else{var h=this.availableTagsToHtml(d,null,a);this._contentDiv.innerHTML=h,this.container.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()})}t(this.getContentStatus(this._contentDiv)),d.hasEvent("onFlattenedPersonListStatusUpdate")||(this.onPersonListUpdate=this.onFlattenedPersonListStatusUpdate.bind(this),d.addEvent("onFlattenedPersonListStatusUpdate",this.onPersonListUpdate))}else{if(this.toInstPV){let t=c.filter(e=>{if("person"!=e)return e});this.createPreferredTags(e,t),this.toShow&&this.toggleMoreTags(e)}else{h=this.availableTagsToHtml(this.getTaggerView(),null,c);this._contentDiv.innerHTML='<div id="all-tags">'+h+"</div>",this.container.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()})}t(this.getContentStatus(this._contentDiv))}this._redrawStatus=!1}.bind(this))},onFlattenedPersonListStatusUpdate:function(e){e.viewId=this._rootW,this.dispatchEvent("onViewUpdate",e)},updatePredicateList:function(e){let t=this.getObservedNavImpl(),a=this._getPreferredPredicates(),n=["person",s.ROOT_WHO,s.getCommunityTagPredicate(s.ROOT_WHO).id(),s.getCompanyTagPredicate(s.ROOT_WHO).id(),s.getAutoCompanyTagPredicate(s.ROOT_WHO).id()];a=this._getPreferredPredicates(this.hasAdvancedFocsuedProxy(t,i.PERSON_REFINE)).filter(function(e){return-1==n.indexOf(e)});let o=!1;for(let e=0;e<a.length;e++)if(t.getTagInfo(a[e]).length){o=!0;break}return o||e.shift(),e},destroy:function(){this.stopListening(),this.model=null,this.onPersonListUpdate&&(this.getTaggerView().removeEvent("onFlattenedPersonListStatusUpdate",this.onPersonListUpdate),this.onPersonListUpdate=null),this._parent()}})}),define("DS/TagNavigator/simplified/views/RootWhyView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/Logger","UWA/Class/Promise"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-why-container",_contentDiv:void 0,init:function(e){this._rootW="ds6w:why",this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},redraw:function(e){return this.redrawOptions=e,new a(function(t){if(i.log("RootWhyView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return i.warn("RootWhyView: redraw status is false, returning.."),this;if(this._contentDiv.empty(),this.toInstPV)this.instantiatePredicateViews(e);else{var a=this.getTaggerView(),n=this._getPreferredPredicates(),s=this.availableTagsToHtml(a,null,n);this._contentDiv.setHTML(s),this._contentDiv.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1}t(this.getContentStatus(this._contentDiv))}.bind(this))},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/views/ActionsToolbar",["UWA/Core","UWA/Class/View","DS/Tweakers/GeneratedToolbar","DS/TagNavigator/TaggerNLS","DS/Utilities/TouchUtils","DS/UIKIT/Tooltip","DS/TagNavigator/simplified/actions/ActionsManager","DS/TagNavigator/simplified/actions/ActionUtils","DS/Controls/Toggle","DS/Controls/TooltipModel"],function(e,t,i,a,n,s,o,r,l,c){"use strict";return t.extend({tagName:"div",className:"tn-action-toolbar",domEvents:{"click #actionToolbar .wux-toolbar-dropdown-button":"onMenuClick"},isMenuOpen:!1,render:function(){let t=this;this.taggerView=this.getOption("taggerView");let n=this.taggerView._simplifiedSelectedRootWs.length;var s={entries:[{id:"select",dataElements:{typeRepresentation:"function",domId:"tn-action-select",tooltip:a.getText("multi_Tag_Refine"),icon:{iconName:"filter-select-on",fontIconFamily:1},position:"near",category:"2",label:a.getText("multi_Tag_Refine"),touchMode:!0,visibleFlag:!1}},{id:"editTagsSelect",dataElements:{typeRepresentation:"function",domId:"tn-action-editTagsSelect",tooltip:a.getText("editTagPen"),icon:{iconName:"pencil",fontIconFamily:1},position:"near",category:"2",label:a.getText("editTagPen"),touchMode:!0,visibleFlag:!1}},{id:"exclude",dataElements:{typeRepresentation:"function",domId:"tn-action-exclude",tooltip:a.getText("exclude"),icon:{iconName:"block",fontIconFamily:1},position:"near",category:"2",label:a.getText("exclude"),touchMode:!0,visibleFlag:!1}},{id:"colorize",dataElements:{typeRepresentation:"function",domId:"tn-action-colorize",tooltip:a.getText("colorize"),icon:{iconName:"palette",fontIconFamily:1},position:"near",category:"2",label:a.getText("colorize"),touchMode:!0,visibleFlag:!1}},{id:"selectInApp",dataElements:{typeRepresentation:"function",domId:"tn-action-selectInApp",tooltip:a.getText("selectInApp"),icon:{iconName:"doc-select",fontIconFamily:1},position:"near",category:"2",label:a.getText("selectInApp"),touchMode:!0,visibleFlag:!1}},{id:"group",dataElements:{typeRepresentation:"function",domId:"tn-action-group",tooltip:a.getText("group"),icon:{iconName:"group",fontIconFamily:1},position:"near",category:"2",label:a.getText("group"),touchMode:!0,visibleFlag:!1}},{id:"addRemoveTags",dataElements:{typeRepresentation:"functionMenu",value:{menu:[{id:"addRemoveCompanyTags",type:"PushItem",title:a.getText("addRemoveCompanyTags"),action:{callback:function(e){e.context={nodeModel:{_ID:"addRemoveCompanyTags"}},t._launchAction(e)}}}]},icon:{iconName:"tag",fontIconFamily:1},label:a.getText("addRemoveTags"),position:"near",category:"2"}},{id:"hideShow6WTags",dataElements:{typeRepresentation:"functionIcon",domId:"tn-action-hideShow6WTags",tooltip:a.getText("hideShow"),icon:{iconName:"tag-eye",fontIconFamily:1,className:`${n<6?"hide-show-active":""} `},position:"near",category:"1",displayLabel:!1,label:a.getText("hideShow")}}]};let o={hideShow6WTags:function(e){t.hideShow6WTagsToggle(e)},colorize:function(e){t._launchAction(e)},exclude:function(e){t._launchAction(e)},group:function(e){t._launchAction(e)},selectInApp:function(e){t._launchAction(e)},select:function(e){t._launchAction(e)},editTagsSelect:function(e){t._launchAction(e)}};return s.entries.forEach(function(e){let t=o[e.id];t&&(e.dataElements.value=t)}),this.toolbarTreeDocumentStandard=i.prototype.createTreeDocument(s),this.actionsToolbarStandard=new i({overflowManagement:"dropdown",direction:"horizontal",items:this.toolbarTreeDocumentStandard,className:"actionToolbar",domId:"actionToolbar",touchMode:!0}),this.actionsToolbarStandard.inject(this.container),this.showMoreTagsDiv=e.createElement("div",{class:"show-more-tags-div"}).inject(this.container),this.showMoreToggle=new l({type:"switch",label:a.getText("showMoreTags"),touchMode:!0,checkFlag:void 0,tooltipInfos:new c({shortHelp:a.getText("showMoreTags")})}),this.showMoreToggle.inject(this.showMoreTagsDiv),this.showMoreToggle.addEventListener("change",function(e){t.dispatchEvent("showMoreTagsUpdated",t.showMoreToggle.checkFlag)}),this},redrawToolbar:function(e,t){let i=[];UWA.is(e,"array")&&(i=e.map(function(e){if(e&&e.id)return e.id})),this.toolbarTreeDocumentStandard.prepareUpdate(),r.getAvailableActions().forEach(function(e){let t=!1;-1!=i.indexOf(e.id)&&(t=!0),this.actionsToolbarStandard.updateNodeModel(e.id,{visibleFlag:t})}.bind(this)),this.toolbarTreeDocumentStandard.pushUpdate();let a=this.container.getElement(".wux-ui-3ds-tag-eye");if(a&&(this.taggerView._simplifiedSelectedRootWs.length<6?a.addClassName("hide-show-active"):a.removeClassName("hide-show-active")),t){this.actionsToolbarStandard.updateNodeModel("hideShow6WTags",{displayLabel:!0});let e=this.container.getElement("#tn-action-hideShow6WTags .wux-button-label");e&&(e.style.display="block");var n=this.taggerView.actionManager?this.taggerView.actionManager.getCurrentAction():void 0,s=n?n.id:void 0;if(this.taggerView.isMaximized&&this.container.getElement("#tn-action-"+s))this.container.getElement("#tn-action-"+s).addClassName("actionSelected");else{let e=this.container.getElement(".actionSelected");e&&e.removeClassName("actionSelected")}r.getAvailableActions().forEach(function(e){if(null==s){let e=this.container.getElement(".add-opacity");e&&e.hasClassName("add-opacity")&&e.removeClassName("add-opacity")}else e.id!==s&&this.container.getElement("#tn-action-"+e.id)&&this.container.getElement("#tn-action-"+e.id).parentElement.parentElement.addClassName("add-opacity")}.bind(this))}else{let e=this.container.getElement("#tn-action-hideShow6WTags .wux-button-label");e&&(e.style.display="none")}},showMoreTagsToggle:function(e){this.dispatchEvent("showMoreTagsUpdated",e)},hideShow6WTagsToggle:function(e){let t=e.dsModel.elements.container;this.dispatchEvent("hideShow6WTagsUpdated",t)},_launchAction:function(e){this.taggerView.actionManager.initActionsView().actionSelected(e.context.nodeModel._ID),e&&e.context&&"addRemoveCompanyTags"!==e.context.nodeModel._ID&&this.taggerView.addOpactiyToolbar(),this.taggerView.isMaximized&&this.container.getElement("#tn-action-"+e.context.nodeModel._ID)&&this.container.getElement("#tn-action-"+e.context.nodeModel._ID).addClassName("actionSelected"),r.getAvailableActions().forEach(function(t){t.id!==e.context.nodeModel._ID&&this.container.getElement("#tn-action-"+t.id)&&this.container.getElement("#tn-action-"+t.id).parentElement.parentElement.addClassName("add-opacity")}.bind(this))},setShowMoreHideShowValue:function(e){this.showMoreToggle&&(this.showMoreToggle.checkFlag=e)},setShowMoreVisibility:function(e){e?this.showMoreTagsDiv.show():this.showMoreTagsDiv.hide()},onMenuClick:function(){this.isMenuOpen=!this.isMenuOpen,this.taggerView.addOpacity();let e=document.getElementsByClassName("wux-menu"),t=this.container.getElement(".wux-toolbar-dropdown-button .wux-button-icon-placeholder");!1===this.isMenuOpen&&(this.taggerView.removeOpacity(),1==e.length&&(e[0].remove(),this.taggerView.removeOpacity())),document.body.addEventListener("click",function(e){e.target!==t&&!0===this.isMenuOpen&&(this.isMenuOpen=!1,this.taggerView.removeOpacity())}.bind(this))},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/TaggerTopBar",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/TaggerTopBar.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/TagNavigator/Predicate","DS/TagNavigator/Logger","DS/TagNavigator/UserSettings","DS/TagNavigator/TaggerSettings","DS/TagNavigator/simplified/views/DropdownMenu6W","DS/TagNavigator/simplified/views/RoundRootView","DS/TagNavigator/simplified/views/ActionsToolbar","DS/Controls/Toggle","DS/MessageBus/MessageBus"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p){"use strict";return t.extend({tagName:"div",className:"tagger-topbar-container",template:a.compile(i),setup:function(e){this._parent(e)},domEvents:{"click .clear-search-tag":"clearSearchInput","click .type-icon-cnt":"showTypeIconDetails","click .tag-settings-cnt":"deactivateSimplifiedTagger"},render:function(){var t=this.template();this.container.setContent(t);var i=this;this.taggerView=this.getOption("taggerView"),this.roundRootViews={},this.searchIcon=this.getElement("#taggerSearchIcon"),this._attachUWATooltips(),this.searchField=this.getElement("#taginput"),this.searchField.setAttributes({placeholder:n.getText("searchTag")}),this.searchField.addEventListener("keyup",this.onSearchInput.bind(this)),!c.getOption("WebInWin")&&c.getOption("simplifiedTagger")||this.getElement(".tag-settings-cnt").hide(),c.getOption("typeIcons")||this.getElement(".type-icon-cnt").hide();let a=["allw","",...c.getOption("simplifiedRootW")],s=[];a.forEach(e=>{e?s.push({name:e}):s.push({className:"divider"})}),this.dropDownMenu=new d({position:"bottom",className:"root-w-menu",closeOnClick:!1,events:{onShow:function(){i.dropdownButton.addClassName("active")},onHide:function(){6==i.taggerView._simplifiedSelectedRootWs.length&&i.dropdownButton.removeClassName("active")}},items:s});for(var o=0;o<this.dropDownMenu.items.length;++o)if(1!==o){var r=this.dropDownMenu.items[o].name;this.roundRootViews[r]=new g({taggerView:this.getOption("taggerView"),rootw:this.dropDownMenu.items[o].name}).render(),i.roundRootViews[r].inject(this.dropDownMenu.items[o].elements.container),i.roundRootViews[r].addEvent("onRootWClick",i.onRootWSelect.bind(i))}var l=this.taggerView.getActiveRootW();l&&this.enableAllWSelection(l),this.actionsToolbar=new h({taggerView:this.taggerView}),this.actionsToolbar.render().inject(this.container.getElement(".tagger-topbar-actions")),this.actionsToolbar.addEvent("showMoreTagsUpdated",this.informViewsOfShowMoreTags.bind(this)),this.actionsToolbar.addEvent("hideShow6WTagsUpdated",this.hideShow6WTags.bind(this)),this.taggerView.addEvent("CONTEXT_UPDATED",this.setContextTitle.bind(this));let u=this.container.getElement(".tagger-topbar-title");return this.contextTitle=e.createElement("div",{id:"context-title",class:"context-title"}).inject(u),this.taggerView.getContextWidgetTitle()?this.contextTitle.setText(n.getText("appliesTo").replace(/&#x27;/g,"'")+" "+this.taggerView.getContextWidgetTitle()):this.contextTitle.setText(""),this},informViewsOfShowMoreTags:function(e){this.dispatchEvent("updateShowMoreTags",e)},setContextTitle:function(e){e?this.contextTitle.setText(n.getText("appliesTo").replace(/&#x27;/g,"'")+" "+e):this.contextTitle.setText("")},hideShow6WTags:function(e){this.dropdownButton=e,this.dropDownMenu.options.target=e,this.dropDownMenu.isVisible?this.dropDownMenu.hide():this.dropDownMenu.show();let t=this.dropDownMenu.elements.container;document.body.addEventListener("click",function(i){i.target===e||t.contains(i.target)||this.dropDownMenu.hide()}.bind(this)),e.addEvent("click",function(e){e.stopPropagation()})},redrawActionsToolbar:function(e){this.taggerView.getAvailableActions().then(t=>{let i=t.availableActions;this.actionsToolbar.redrawToolbar(i,e)})},onRootWSelect:function(e){if(e){var t=e.activeW,i=e.isActive;"allw"==t?(i?this.setAllW():this.resetW(),this.taggerView._simplifiedSelectedRootWs=this.taggerView.getRootWs(),this.dropdownButton.removeClassName("active")):(this.dropDownMenu.elements.container.removeClassName("all-w-active"),this.roundRootViews.allw.container.removeClassName("active"),this.dropdownButton.addClassName("active"),0==this.taggerView._simplifiedSelectedRootWs.length&&(this.setAllW(),t="allw",this.taggerView._simplifiedSelectedRootWs=this.taggerView.getRootWs(),this.dropdownButton.removeClassName("active"))),this.dispatchEvent("onRootWSelection",t.replace("ds6w:",""))}this.taggerView._simplifiedSelectedRootWs.length?this.dropdownButton.addClassName("active"):this.dropdownButton.removeClassName("active")},setAllW:function(){for(var e in this.dropDownMenu.elements.container.addClassName("all-w-active"),this.roundRootViews)"allw"!==e&&this.roundRootViews[e].container.removeClassName("active")},resetW:function(){for(var e in this.dropDownMenu.elements.container.removeClassName("all-w-active"),this.roundRootViews)"allw"!==e&&this.roundRootViews[e].container.addClassName("active")},resetToOriginalW:function(e){for(var t in this.dropDownMenu.elements.container.removeClassName("all-w-active"),this.roundRootViews)e.includes(t)&&this.roundRootViews[t].container.addClassName("active")},enableAllWSelection:function(e){e.length==this.taggerView.getRootWs().length?(this.setAllW(),this.roundRootViews.allw.container.addClassName("active")):e.forEach((e,t)=>{this.roundRootViews[e]&&this.roundRootViews[e].container.addClassName("active")}),this.taggerView._simplifiedSelectedRootWs=e},addOpacity:function(){this.getElement("#filter-tags").toggleClassName("add-opacity",!0)},launchEditAction:function(){this.getElement(".edit-tag").hasClassName("active-edit-tag")||(this.getElement(".edit-tag").addClassName("active-edit-tag"),this.dispatchEvent("onTopBarEditClick","editTagRelationShip")),this.dispatchEvent("onTopBarEditClickTagger")},cancelEditActionCall:function(){this.dispatchEvent("cancelEditAction")},onSearchInput:function(e){var t=this.getElement("#taginput").value;this.sendSearchMetrics(t),""==t?this.dispatchEvent("onTopBarSearch",{searchText:""}):this.dispatchEvent("onTopBarSearch",{searchText:t,allWView:!0}),"Enter"===e.key&&this.searchIcon.checkVisibility()&&this.searchField.value.length>1&&this.searchIcon.click(),this.dispatchEvent("keyup_searchField",e)},sendSearchMetrics:function(e){this.to&&clearTimeout(this.to),e&&e.length&&(this.to=setTimeout(()=>{p.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"onSearchTag",persDim:{pd1:e}}})},1e3))},clearSearchInput:function(e){this.searchField.value="",this.searchField.getClosest(".addClear")&&this.searchField.getClosest(".addClear").removeClassName("addClear"),this.searchField.focus(),this.dispatchEvent("onTopBarSearch",{searchText:""})},startEventListening:function(){this.handleSearchCB=this.handleSearch.bind(this),document.body.addEvent("keydown",this.handleSearchCB),document.body.addEvent("click",this.handleSearchCB)},handleSearch:function(e){if("click"==e.type)document.body.removeEvent("keydown",this.handleSearchCB),document.body.removeEvent("click",this.handleSearchCB),this.handleSearchCB=null;else{if("BODY"==e.target.tagName){var t=new Array;t.push(8),t.push(9),t.push(46),t.push(36),t.push(35),t.push(37),t.push(39);var i=0==e.keyCode?e.charCode:e.keyCode;(i>=48&&i<=57||i>=65&&i<=90||32==i||i>=97&&i<=122)&&this.searchField.focus()}document.body.removeEvent("keydown",this.handleSearchCB),document.body.removeEvent("click",this.handleSearchCB),this.handleSearchCB=null}},showTypeIconDetails:function(){require(["DS/SimplifiedTaggerTests/TypeCategoriesInfo"],function(e){e()})},deactivateSimplifiedTagger:function(){l.setPreference({name:"simplified",value:!1,onComplete:function(){c.getOption("WebInWin")||location.reload()},onFailure:function(){r.warn("FAILED to de-activate the 6WTagger Beta")}})},_attachUWATooltips:function(){new s({target:this.searchIcon,body:"<div><b>"+n.getText("searchAllTags")+"</b>&nbsp;&nbsp;("+n.getText("enter")+")</div>"}),new s({position:"bottom",target:this.getElement(".tagger-close"),body:n.getText("closeTagger"),className:"tagger-close-tooltip"}),new s({position:"bottom",target:this.getElement(".type-icon-cnt"),body:"Type Icons",className:"tagger-clearAllTags-tooltip"}),new s({position:"bottom",target:this.getElement(".tag-close"),body:n.getText("clearSearch"),className:"tagger-clear-tooltip"}),new s({position:"bottom",target:this.getElement(".tagger-settings"),body:n.getText("deactivate-simplified"),className:"tagger-settings-tooltip"})},destroy:function(){this.stopListening(),this.handleSearchCB=null,this.handleRemovalOfListenersCB=null,this._parent()}})}),define("DS/TagNavigator/maximizedTagger/MaximizedWhoView",["UWA/Core","DS/TagNavigator/simplified/views/RootWhoView","DS/TagNavigator/Logger","UWA/Class/Promise","DS/UIKIT/Scroller"],function(e,t,i,a,n){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this},redraw:function(e){return this._parent(e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/maximizedTagger/MaximizedWhyView",["UWA/Core","DS/TagNavigator/simplified/views/RootWhyView","DS/TagNavigator/Logger","UWA/Class/Promise","DS/UIKIT/Scroller"],function(e,t,i,a,n){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this},redraw:function(e){return this._parent(e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/simplified/views/RootWhereView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/TagValue","DS/TagNavigator/TagValueView","DS/TagNavigator/Logger","DS/TagNavigator/simplified/utils/LocationUtils","UWA/Class/Promise","DS/TagNavigator/PredicateView","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s,o,r,l,c){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-where-container",init:function(e){this._rootW="ds6w:where";try{o.init()}catch(e){}this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},redraw:function(e){if(s.log("RootWhereView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return s.warn("RootWhereView: redraw status is false, returning.."),this;this._contentDiv.empty();var t=this.getTaggerView(),i=t.getObservedNavigator(),a=e.onSearch,n=this.hasAdvancedFocsuedProxy(i,o.DATA_LOCATION),c=this._getPreferredPredicates();if(!a){var d=UWA.is(c,"array")?c.filter(function(e){return e==o.COMPUTED_COUNTRY_INFO||e==o.COMPUTED_CITY_INFO}):n?[o.COMPUTED_COUNTRY_INFO,o.COMPUTED_CITY_INFO]:[];d.length>0&&n&&this._computeUsersLocations(t,d)}if(-1!==c.indexOf("ds6w:dataSource")){var g=l.getExistingPredicateViewById("ds6w:dataSource");g&&g.getChildrenTagValueViews().forEach(function(e){var t=e.id();UWA.is(t)&&UWA.is(t,"array")&&t.length>0&&(t=t[0]),t&&e.setIcon(o.getSourceIcon(t))})}if(this.toInstPV)return this.instantiatePredicateViews(e),new r(function(e){e(this.getContentStatus(this.container))}.bind(this));var h=this.availableTagsToHtml(t,null,c);if(this._contentDiv.setHTML(h),this.container.getElements(".predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1,!e.updateOnRedraw)return new r(function(e){e(this.getContentStatus(this.container))}.bind(this));this.dispatchEvent("onViewUpdate",this.getContentStatus(this._contentDiv))},_clearContents:function(e){e.forEach(function(e){var t=l.getExistingPredicateViewById(e);t&&t.clearContent(!0)})},_computeUsersLocations:function(e,t){s.log("RootWhereView: ENTER _computeUsersLocations");var r=e.getObservedNavigator(),l=r.getTagsServerForUserInfo();let d=r.getLocationTagValueMap();if(d={},o.ensurePredicates(l),c.getOption("geolocationHierarchy")){var g=o.computeGeoLocations(r,["ds6w:responsible"],void 0,!0);if(0!==g.total&&g.total!==g.pending){var h=g.continents,u=o.computedCountryInfo.getFullPredicateID(),p=o.computedCountryInfo.id();h.forEach(function(t){var i,s,r=t.get("title"),c=[];t.getCountries().forEach(function(g,h){i=a.getTagValue({count:g.getCount(),type:"string",object:[t.id,g.id],dispValue:[r,g.get("title")],sixw:u,icon:g.get("imageURL")},null,null,null,null,l),0==h&&i.parent.clearEmbeddedTagValues(),i.setEmbeddedSixW(o.countryPredicate),s=g.getPersons(),i.setEmbeddedTagValues(s),d[p]||(d[p]={});let f=d[p],m=i.fullid;f[m]||(f[m]=[]),c=c.concat(s),new n(i,e,g.getCount()),i.addCount=g.getCount(),f[m].push(i)})})}}else{var f=i.getUsersInfo(r,["ds6w:responsible"]),m={},v={};if(UWA.is(f,"array")){if(s.log("RootWhereView: number of persons info found="+f.length),f.forEach(function(e){if(-1!==t.indexOf(o.COMPUTED_COUNTRY_INFO)){var i=e.getCountry();i&&(i=i.filter(function(e){return!!e})).forEach(function(t){var i=m[t];i||(i=[],m[t]=i),i.push(e)})}var a;-1!==t.indexOf(o.COMPUTED_CITY_INFO)&&((a=e.getCity())&&(a=a.filter(function(e){return!!e})).forEach(function(t){var i=v[t];i||(i=[],v[t]=i),i.push(e)}))}),Object.keys(m).length>0){u=o.computedCountryInfo.getFullPredicateID();var T=o.countryPredicate.id();for(var C in m){C.split(".")[1];(y=a.getTagValue({count:m[C].length,type:"string",object:C,sixw:u},null,null,null,null,l)).setEmbeddedSixW(o.countryPredicate),y.setEmbeddedTagValues(m[C]);let t=0;new n(y,e,m[C].reduce(function(e,i){return t=e+i.get("count")},0)),d[T]||(d[T]={});let i=d[T],s=y.fullid;i[s]||(i[s]=[]),y.addCount=t,i[s].push(y)}}if(Object.keys(v).length>0){u=o.computedCityInfo.getFullPredicateID();var w=o.cityPredicate.id();for(var b in v){var y;(y=a.getTagValue({count:v[b].length,type:"string",object:b,sixw:u},null,null,null,null,l)).setEmbeddedSixW(o.cityPredicate),y.setEmbeddedTagValues(v[b]),new n(y,e,v[b].reduce(function(e,t){return e+t.get("count")},0));let t=0;d[w]||(d[w]={});let i=d[w],s=y.fullid;i[s]||(i[s]=[]),y.addCount=t,i[s].push(y)}}}}r.setLocationTagValueMap(d)},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/simplified/views/RootWhatView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/Logger","UWA/Class/Promise"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-what-container",init:function(e){this._rootW="ds6w:what",this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},redraw:function(e){return new a(function(t){if(i.log("RootWhatView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return i.warn("RootWhatView: redraw status is false, returning.."),this;if(this._contentDiv.empty(),this.toInstPV)this.instantiatePredicateViews(e);else{var a=this.getTaggerView(),n=a.getObservedNavigator(),s=this.hasFocusedProxy(n),o=this._getPreferredPredicates(s),r=this.availableTagsToHtml(a,s,o);this._contentDiv.setHTML(r),this._contentDiv.getElements(".predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1}t(this.getContentStatus(this._contentDiv))}.bind(this))},destroy:function(){this._parent()}})}),define("DS/TagNavigator/maximizedTagger/MaximizedWhereView",["UWA/Core","DS/TagNavigator/simplified/views/RootWhereView","DS/TagNavigator/Logger","UWA/Class/Promise","DS/UIKIT/Scroller"],function(e,t,i,a,n){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this},redraw:function(e){return this._parent(e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/maximizedTagger/MaximizedWhatView",["UWA/Core","DS/TagNavigator/simplified/views/RootWhatView","DS/TagNavigator/Logger","UWA/Class/Promise"],function(e,t,i,a){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this},redraw:function(e){return this._parent(e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedRootWhyView",["UWA/Core","UWA/Class/Model","DS/TagNavigator/embeddedTagger/EmbeddedRootWView","DS/TagNavigator/embeddedTagger/EmbeddedHierarchyMenuItems","DS/TagNavigator/embeddedTagger/EmbeddedSeparatorMenuItem","DS/TagNavigator/simplified/model/TagValueModel","DS/TagNavigator/TaggerSettings","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Predicate","DS/TagNavigator/TaggerUtils","DS/TagNavigator/TagValue"],function(e,t,i,a,n,s,o,r,l,c,d){"use strict";return i.extend({tagName:"div",className:"embedded-root-container embedded-why",init:function(e){this._parent(e)},render:function(){return this.label=this.defaultValues.label?this.defaultValues.label:r.getText("why"),this.icon="fonticon-3ds-why",this._parent()},redrawTags:function(e){var i=this;if(0===Object.keys(d.getTvToTranslate()).length&&0===Object.keys(d.getOntologyTvToTranslate()).length){this.menuItems.forEach(function(e){e.destroy()}),this.menuItems=[],this.selectedItems=[];let e=this._getUserTagsPredicateMap();this.container.hide(),this.container.addClassName("disableW");var s=!1,o=!1;let d={companyTags:{predicates:l.AUTO_COMPANY_TAGS_PREDICATES,iconInfo:c.getCompanyTagIcon(),tags:[]},companyTagsManual:{predicates:l.COMPANY_TAGS_PREDICATES,iconInfo:c.getCompanyTagIcon(),tags:[]},communityTags:{predicates:l.COMMUNITY_TAGS_PREDICATES,iconInfo:{isFontIcon:!0,icon:c.getCommunityTagIcon()},tags:[]},"user-tags":{predicates:e,iconInfo:{isFontIcon:!0,icon:c.getUserTagIcon()},tags:[]}},h=this.navImpl.getFocusedProxy(),u=function(e){var s=new a({model:new t({title:e.title,iconClass:e.icon,imageURL:e.imageUrl,isEmbeddedWhySection:!0,sortByW:!0}),navImpl:i.navImpl,eventsToListen:{toggleSelection:i.onTagClick.bind(i)},tags:e.tags}).render();i.menuItems.push(s),i.menuItems.push(new n({}).render())};for(let e in d){let t=d[e],i=d[e].predicates;for(let t in i){let a=i[t].id(),n=h?h.getEachTagValueForPredicate(a):[];UWA.is(n,"array")&&n.length&&(d[e].tags=d[e].tags.concat(n))}t.tags.length&&(s?o=!0:s=!0)}if(s&&!o){let e,n,s=[];for(let t in d)d[t].tags.length&&(s=d[t].tags,e=d[t].iconInfo.isFontIcon?d[t].iconInfo.icon:"",n=d[t].iconInfo.isFontIcon?"":d[t].iconInfo.icon);var g=new a({model:new t({proxy:h,isEmbeddedWhySection:!0,sortByW:!0,iconClass:e,imageURL:n,showPredicateIcon:!0}),navImpl:i.navImpl,eventsToListen:{toggleSelection:i.onTagClick.bind(i)},tags:s}).render();this.menuItems=g.getOption("subMenuItems")}else if(s||o)for(let e in d)d[e].tags.length&&u({title:r.getText(e),icon:d[e].iconInfo.isFontIcon?d[e].iconInfo.icon:"",imageUrl:d[e].iconInfo.isFontIcon?"":d[e].iconInfo.icon,tags:d[e].tags});else this.container.hide();return this.dropDownMenu&&this.dropDownMenu.destroy(),i.createDropdown(),this.menuItems.length&&(this.container.show(),this.container.removeClassName("disableW")),this}{let e=d.getPredicateValue(),t=d.translateOntologyTagValues();Promise.all(e.concat(t)).then(function(){i.redrawTags()})}},_getTagIdForFilter:function(e){if(e instanceof s){var t=e.get("tagValue");return{predicate:t.pred.getFullPredicateID(),object:t.getUri(),dispValue:e.get("title"),type:"string"}}},onTagClick:function(e){var t=e.model;this._parent(e);var i=this._getTagIdForFilter(t);this.navImpl.toggleTagSelection(i)},searchTagsInMenu:function(){this._parent({notToSort:!0})},_getUserTagsPredicateMap:function(){let e={};return o.getOption("simplifiedRootW").forEach(t=>{e[t]=l.getPredicate(t)}),e},onGroupingChange:function(){this.dropDownMenu.show()}})}),define("DS/TagNavigator/embeddedTagger/EmbeddedTaggerView",["UWA/Core","UWA/Class/View","UWA/Class/Promise","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/Logger","DS/TagNavigator/TaggerSettings","DS/TagNavigator/embeddedTagger/EmbeddedRootWhereView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhatView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhenView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhoView","DS/TagNavigator/embeddedTagger/EmbeddedRootWhyView","DS/TagNavigator/embeddedTagger/EmbeddedRootHowView","DS/TagNavigator/embeddedTagger/EmbeddedAllWView","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/simplified/actions/ActionsManager","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/embeddedTagger/EmbeddedTaggerActiveCriteria","DS/TagNavigator/TaggerUtils"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f,m,v,T){"use strict";return t.extend({tagName:"div",className:"embedded-tagger-view",init:function(e){e=e||{},this.rootwArray=e.rootw,this.rootViews=[],this._BroadcastchannelSearchManager=null,this._parent(e)},setup:function(e){s.log("setting up embedded view"),this._parent(e),this.proxy=e.proxy,this.observedNavImpl=this.proxy.getNavImpl();var t={REDRAW_TAGS:"REDRAW_TAGS",GROUPING_REMOVED:"GROUPING_REMOVED",STATUS_UPDATE:"STATUS_UPDATE",ON_TAGGERVIEW_MASKED:"ON_TAGGERVIEW_MASKED"},i={};for(var a in i[t.REDRAW_TAGS]=function(e){if(!this.proxy.isDying()){this._redrawTags(!0,e)}},i[t.GROUPING_REMOVED]=function(){this._onGroupingRemoved()},i[t.STATUS_UPDATE]=function(){this.removeOpacity(),this._redrawTags()},i[t.ON_TAGGERVIEW_MASKED]=function(){this.addOpacity()},t)this.observedNavImpl.addEvent(a,i[a],this);this.proxy.addEvent("embedded_properties_change",this.updateSubLabel,this),this._initBroadcastChannel(e)},render:function(){for(var t in s.log("rendering embedded view"),this.tabBarContainer=e.createElement("div",{class:"tab-bar-container"}).inject(this.container),this.tabBarContainer.addClassName("tn-gradientAfter"),document.addEventListener("click",this.onClickInsideTabViewContainer.bind(this)),this.rootwArray){var i=void 0;switch(t){case"ds6w:where":i=new r({rootw:"ds6w:where",defaultValues:this.rootwArray[t],proxy:this.proxy,icon:"fonticon-3ds-where"}).render().inject(this.tabBarContainer);break;case"ds6w:what":i=new l({rootw:"ds6w:what",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:when":i=new c({rootw:"ds6w:when",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:who":i=new d({rootw:"ds6w:who",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:why":i=new g({rootw:"ds6w:why",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"ds6w:how":i=new h({rootw:"ds6w:how",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer);break;case"allw":i=new u({rootw:"allw",defaultValues:this.rootwArray[t],proxy:this.proxy}).render().inject(this.tabBarContainer)}i.addEvent("notifyAllViews",this.closeDropDown.bind(this)),i.addEvent("toggleGrouping",this.onToggleGrouping.bind(this)),i.addEvent("deactiveEmbeddedView",this.addOpacity.bind(this)),i.addEvent("updateGroupings",this.updateGroupings.bind(this)),this.rootViews.push(i)}var a,n=this;return this.container.addEvent("resize",function(){clearTimeout(a),a=setTimeout(n.addScroll.bind(n),1e3)}),this.tabBarContainer.addEventListener("scroll",this.mobileScroll.bind(this)),this.tabBarContainer.addEventListener("wheel",this.desktopWheel.bind(this)),this.embeddedActiveCriteria=new v({proxy:this.proxy}).render().inject(this.container),this},desktopWheel:function(e){this.tabBarContainer.addClassName("tn-gradientBefore"),this.tabBarContainer.addClassName("tn-gradientAfter"),this.tabBarContainer.scrollLeft+=e.deltaY,this.tabBarContainer.scrollLeft>0&&this.tabBarContainer.addClassName("tn-gradientBefore");let t=this.tabBarContainer.scrollWidth-this.tabBarContainer.clientWidth;Math.floor(this.tabBarContainer.scrollLeft)!=t&&0!=t||this.tabBarContainer.removeClassName("tn-gradientAfter"),0!=t&&0!=Math.floor(this.tabBarContainer.scrollLeft)||this.tabBarContainer.removeClassName("tn-gradientBefore")},mobileScroll:function(){let e=this.tabBarContainer.scrollWidth-this.tabBarContainer.clientWidth;this.tabBarContainer.addClassName("tn-gradientBefore"),this.tabBarContainer.addClassName("tn-gradientAfter"),this.tabBarContainer.scrollLeft>0&&this.tabBarContainer.addClassName("tn-gradientBefore"),0==Math.floor(this.tabBarContainer.scrollLeft)&&this.tabBarContainer.removeClassName("tn-gradientBefore"),Math.floor(this.tabBarContainer.scrollLeft)==e&&this.tabBarContainer.removeClassName("tn-gradientAfter")},addScroll:function(){this.tabBarContainer.getDimensions().width<=1223&&0!==this.tabBarContainer.getDimensions().width?(this.tabBarContainer.getDimensions().width<="639"?this.tabBarContainer.addClassName("mobile-view"):this.tabBarContainer.removeClassName("mobile-view"),this.tabBarContainer.addClassName("with-scroll")):this.tabBarContainer.removeClassName("with-scroll"),this._postMessage("addScroll")},_onGroupingRemoved:function(e){this.rootViews.forEach(e=>{e.isGroupedBy()&&e.deactivateGroupingUX()}),this.removeOpacity(),this._postMessage("_onGroupingRemoved")},_redrawTags:function(t,r){s.log("inside embedded view redraw"),this.observedNavImpl.getFocusedProxy()===this.proxy?i.all(n.getElementsNLS().concat(a.getPredicateValue())).then(function(){s.log("redrawing the W views after nls computation"),this.rootViews.forEach(e=>{e.setUpdateGroupingsWhenReadyFlag(!1),e.redrawTags(t),e.updateGroupingUX()}),this.observedNavImpl.hasProxiesInEdition()?this.addOpacity():(this.removeOpacity(),r&&"setTags"==r.event&&this.proxy.getActiveGroupings().length>0&&o.getOption("updateEmbeddedGroupings")&&this.updateGroupings());var i={widgetId:this.observedNavImpl.getWidgetMaximized(),proxyId:this.proxy?this.proxy._id:void 0,isEmbedded:!0};this.embeddedActiveCriteria.redraw(i),(!e.is(r)||e.is(r)&&e.is(r.event)&&("setTags"===r.event||"clearLocalGrouping"===r.event||"unfocus"===r.event||"focusOnSubjects"===r.event||"activate"===r.event||"deactivate"===r.event))&&this._postMessage("_redrawTags")}.bind(this)):s.log("embedded view proxy is not same as focused proxy, redraw ignored")},closeDropDown:function(e){this.notToCallOnClickOutside=e.noClickOutside,this.rootViews.forEach((t,i)=>{t.rootw!=e.id&&t.dropdownCont.hasClassName("show")&&t.destroyDropDowmMenu()})},updateSubLabel:function(e){var t=e.rootw;for(var i in t)this.rootViews.forEach((e,a)=>{e.rootw==i&&t[i].subLabel&&e.updateSubLabelCall(t[i])})},onToggleGrouping:function(e){var t,i;if(this.addOpacity(),"allw"==e.id)this.clearAllGroupings();else{this.rootViews.forEach(a=>{a.isGroupedBy(e.predicate)?(i=a,a.deactivateGroupingUX()):a.rootw==e.id&&(t=a,a.activateGroupingUX())});var a={action:m.ACTION_GROUP,isInteractive:!1,embedded:!0};t&&(a.add=t.getGroupingData()),i&&!t&&(a.remove=i.getGroupingData()),f.startAction(a)}this._postMessage("onToggleGrouping")},clearAllGroupings:function(){var e;this.rootViews.forEach(t=>{var i={action:m.ACTION_GROUP,isInteractive:!1,embedded:!0};t.isGroupedBy()&&(e=t,t.deactivateGroupingUX(),i.remove=e.getGroupingData(),f.startAction(i))}),this._postMessage("clearAllGroupings")},updateGroupings:function(){var e,t=this.rootViews.findIndex(e=>e.isGroupedBy());if(-1!==t)if((e=this.rootViews[t])&&e.isReadyToUpdateGroupings()){e.setUpdateGroupingsWhenReadyFlag(!1);var i={action:m.ACTION_GROUP,isInteractive:!1,embedded:!0,refreshMode:!0,current:e.getGroupingData()};f.startAction(i)}else s.log("view is not yet ready for grouping update, wait..."),e.setUpdateGroupingsWhenReadyFlag(!0);this._postMessage("updateGroupings")},requestGroupingChange:function(e){var t=this.rootViews.findIndex(t=>t.getOption("rootw")===e.rootW);if(-1!==t){var i=this.rootViews[t],a={predicate:e.predicate};i.onGroupingChange(void 0,a)}},onClickInsideTabViewContainer:function(e){this.notToCallOnClickOutside=!1},addOpacity:function(){this.container.addClassName("stop-action")},removeOpacity:function(){this.container.removeClassName("stop-action")},destroy:function(){this.stopListening(),this.tabBarContainer.removeEventListener("wheel",this.desktopWheel),this.tabBarContainer.removeEventListener("scroll",this.mobileScroll),this.rootViews.forEach(function(e){e.destroy()}),this._BroadcastchannelSearchManager&&this._BroadcastchannelSearchManager.destroy(),this._BroadcastchannelSearchManager&&delete this._BroadcastchannelSearchManager,this._BroadcastchannelSearchManager=null,this._parent()},show:function(){this._parent();this._postMessage("show",{type:"showEmbeddedTaggerView"})},hide:function(){this._parent();this._postMessage("hide",{type:"hideEmbeddedTaggerView"})},_initBroadcastChannel:function(t){let i=this;e.is(t)&&e.is(t.is6WInWebInWinActive)&&!0===t.is6WInWebInWinActive&&(e.is(this._BroadcastchannelSearchManager)&&this._BroadcastchannelSearchManager.destroy(),e.is(this._BroadcastchannelSearchManager)&&delete this._BroadcastchannelSearchManager,this._BroadcastchannelSearchManager=null,require(["DS/TagNavigator/BroadcastchannelSearchManager"],function(e){s.log("init BroadcastChannel");let a={EmbeddedTaggerView:i,broadcastId:t.broadcastId};i._BroadcastchannelSearchManager=new e,i._BroadcastchannelSearchManager.setup(a),i._BroadcastchannelSearchManager.listenBroadcast(),i._postMessage("_redrawTags"),i.show()}))},_postMessage:function(t,i){e.is(this._BroadcastchannelSearchManager)&&this._BroadcastchannelSearchManager.postMessage(t,i)}})}),define("DS/TagNavigator/simplified/views/RootWhenView",["UWA/Core","DS/Handlebars/Handlebars","DS/TagNavigator/simplified/views/RootWView","text!DS/TagNavigator/assets/templates/RootWhenViewTemplate.html","DS/TagNavigator/Predicate","DS/UIKIT/Input/Select","DS/TagNavigator/Logger","DS/TagNavigator/simplified/views/DateCalendarView"],function(e,t,i,a,n,s,o,r){"use strict";var l=i.extend({tagName:"div",className:"root-container-inner root-when-container",template:t.compile(a),domEvents:{},predicateSelector:void 0,init:function(e){this._rootW="ds6w:when",this._parent(e)},setup:function(e){this._parent(e)},render:function(){var t=this;return this._calendarContentDiv=e.createElement("div",{id:"calendar-content-div"}).inject(this.container),this.predicateSelector=new s({className:"predicate-selector",placeholder:!1,disabled:!0,showTooltips:!0,renderTo:t.getTaggerView().simplifiedTaggerRoot,events:{onChange:function(e){t.activePredicate=this.getValue()[0],t.dateView.onPredicateChange(t.activePredicate)}}}).inject(e.createElement("div",{id:"predicate-selector-div"}).inject(this._calendarContentDiv)),this.dateView=new r({taggerView:this.getTaggerView(),predicateId:this.activePredicate,navImpl:this.getObservedNavImpl()}).render().inject(this._calendarContentDiv),this._defaultContentDiv=e.createElement("div",{id:"default-content-div"}).inject(this.container),this._defaultContentDiv.hide(),this._calendarContentDiv.hide(),this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},onPostInject:function(){if(this.predicateSelector){var e=this.dateView.getDatePicker().getContent().getStyle("z-index");e&&(e=parseInt(e),o.log("datePickerZIndex="+e),this.predicateSelector.getContent().setStyle("z-index",e+1)),this.dateView.getFromToDiv()}},redraw:function(e){this.redrawOptions=e;var t=e&&e.onSearch,i=this.getTaggerView();if(t&&i.searchedString&&this._defaultContentDiv.isHidden())return this._calendarContentDiv.hide(),new Promise(function(e){e({viewId:this._rootW,hasNoResults:!0})}.bind(this));var a=this.hasFocusedProxy(),s={},r={};this.toInstPV?this._contentDiv.empty():this.dateView.redraw();var c=this._getPreferredPredicates(a),d=this.getObservedNavImpl(),g=this;if(d){var h=d.listPredicates(c),u=[],p=[];for(var f in h)if(-1!==c.indexOf(f)){var m=h[f];if(UWA.is(m,"object")){var v=[];for(var T in m){var C=m[T];if(UWA.is(C,"array")){var w=C.every(function(e){return!e||("date"==e.type||"daterange"==e.type)});v.push(w)}}v.every(function(e){return e})?u.push(f):(o.warn("predicate "+f+" does not have DATE type of tag values"),p.push(f))}}var b=[];u.forEach(function(e){a&&(a.hasFreeInputSupport(e)||a.hasFreeInputOnly(e))?b.push(e):p.push(e)});var y=this._getPredicateInfo(a);if((b=b.sort(function(e,t){var i=y&&y[e]&&y[e].hasOwnProperty("weight")?y[e].weight:0,a=((y&&y[t]&&y[t].hasOwnProperty("weight")?y[t].weight:0)||0)-(i||0);return 0===a?n.getPredicate(e).displayName().localeCompare(n.getPredicate(t).displayName()):a})).length>0&&!i.searchedString)if(this.toInstPV||this._calendarContentDiv.show(),0!==Object.keys(n.getElementsToTranslate()).length){var S=n.getElementsNLS();Promise.all(S).then(function(){if(g.toInstPV){let t=!0;g.createPreferredTags(e,b,t),this.toShow&&this.toggleMoreTags(e)}else g._updatePredicateOptions(b)})}else if(g.toInstPV){let t=!0;g.createPreferredTags(e,b,t),this.toShow&&this.toggleMoreTags(e)}else g._updatePredicateOptions(b);else this.toInstPV||!d.hasActiveTags()&&!d.hasLocalActiveTags()||0!=this._calendarContentDiv.isHidden()?(i.searchedString?s.hasNoResults=!0:s.isEmpty=!0,this._calendarContentDiv.hide()):this._calendarContentDiv.show();if(-1!=c.indexOf(l.COMMUNITY_TAGS)&&p.push(l.COMMUNITY_TAGS),this.toInstPV)g.createPreferredTags(e,p),this.toShow&&this.toggleMoreTags(e),r=this.getContentStatus(this._contentDiv);else{var I=this.availableTagsToHtml(i,a,p);this._defaultContentDiv.innerHTML='<div id="all-tags">'+I+"</div>",this.container.getElements(".predicate:not(.searchexcluded)").forEach(function(e){e.show()}),r=this.getContentStatus(this._defaultContentDiv)}r.isEmpty||r.hasNoResults?(this._defaultContentDiv.hide(),r.isEmpty&&(r.hasNoResults=!0)):this._defaultContentDiv.show()}return this._redrawStatus=!1,new Promise(function(e){e({viewId:this._rootW,isEmpty:s.isEmpty&&r.isEmpty,hasNoResults:s.hasNoResults&&r.hasNoResults,hideBorder:r.hideBorder})}.bind(this))},_updatePredicateOptions:function(e){var t=this,i=[];e.forEach(function(e,a){let s=n.getPredicate(e)?n.getPredicate(e).displayName():e;i.push({value:e,label:s,selected:t.activePredicate==e||0==a,attributes:{id:e,labelText:s}}),t.activePredicate==e?t.predicateSelector.setValue(s):t.activePredicate||0!=a||t.predicateSelector.setValue(s)}),this.predicateSelector.add(i),this.predicateSelector.setDisabled(!1)},destroy:function(){this.dateView.destroy(),this.predicateSelector&&this.predicateSelector.destroy(),this._parent()},resetUI:function(){this.clearDates()}});return l.COMMUNITY_TAGS="communityTags_when",l}),define("DS/TagNavigator/simplified/views/RootHowView",["UWA/Core","DS/TagNavigator/simplified/views/RootWView","DS/TagNavigator/Logger","UWA/Class/Promise"],function(e,t,i,a){"use strict";return t.extend({tagName:"div",className:"root-container-inner root-how-container",init:function(e){this._rootW="ds6w:how",this._parent(e)},setup:function(e){this._parent(e)},_contentDiv:void 0,render:function(){return this._contentDiv=e.createElement("div",{id:"all-tags"}).inject(this.container),this._parent()},redraw:function(e){return new a(function(t){if(i.log("RootHowView: Inside redraw"),!this._redrawStatus&&this._optimizedRedraw)return i.warn("RootHowView: redraw status is false, returning.."),this;this._contentDiv.empty();var a=this.getTaggerView();if(this.toInstPV)this.instantiatePredicateViews(e);else{var n=this._getPreferredPredicates(),s=this.availableTagsToHtml(a,null,n);this._contentDiv.setHTML(s),this._contentDiv.getElements("#all-tags .predicate:not(.searchexcluded)").forEach(function(e){e.show()}),this._redrawStatus=!1}t(this.getContentStatus(this._contentDiv))}.bind(this))},destroy:function(){this.stopListening(),this.model=null,this._parent()}})}),define("DS/TagNavigator/maximizedTagger/MaximizedWhenView",["UWA/Core","DS/TagNavigator/simplified/views/RootWhenView","DS/TagNavigator/Logger","UWA/Class/Promise","DS/UIKIT/Scroller"],function(e,t,i,a,n){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this},redraw:function(e){return this._parent(e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/maximizedTagger/MaximizedHowView",["UWA/Core","DS/TagNavigator/simplified/views/RootHowView","DS/TagNavigator/Logger","UWA/Class/Promise","DS/UIKIT/Scroller"],function(e,t,i,a,n){"use strict";return t.extend({init:function(e){this._parent(e)},setup:function(e){this._parent(e)},render:function(){return this._parent(),this},redraw:function(e){return this._parent(e)},destroy:function(){this._parent()}})}),define("DS/TagNavigator/maximizedTagger/MaximizedView",["UWA/Core","UWA/Class/View","text!DS/TagNavigator/assets/templates/MaximizedView.html","DS/Handlebars/Handlebars","DS/TagNavigator/TaggerNLS","DS/UIKIT/Tooltip","DS/MessageBus/MessageBus","DS/TagNavigator/maximizedTagger/MaximizedWhatView","DS/TagNavigator/maximizedTagger/MaximizedWhoView","DS/TagNavigator/maximizedTagger/MaximizedWhenView","DS/TagNavigator/maximizedTagger/MaximizedWhereView","DS/TagNavigator/maximizedTagger/MaximizedHowView","DS/TagNavigator/maximizedTagger/MaximizedWhyView","DS/TagNavigator/simplified/views/EmptyView","css!DS/TagNavigator/TagNavigator.css"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u){"use strict";return t.extend({tagName:"div",className:"tnmax-tagger",template:a.compile(i),setup:function(e){this._parent(e)},domEvents:{"click #left-btn":"slideToLeft","click #right-btn":"slideToRight"},views:{"ds6w:what":r,"ds6w:who":l,"ds6w:when":c,"ds6w:where":d,"ds6w:how":g,"ds6w:why":h},render:function(){var e=this.template();this.container.setContent(e),this.navImpl=this.getOption("navImpl"),this.taggerView=this.getOption("taggerView"),this.slideCount=-1,this.totalSlidesVisibleOnLoad=0,this.rootWView={},this.verticalLines={},this.noTagsView=(new u).render().inject(this.getElement(".tnmax-all-view-container")).hide();for(let e in this.views){let t=this.container.getElement("#tn-root"+e.replace("ds6w:",""));this.rootWView[e]=new this.views[e]({taggerView:this.taggerView,toInstPV:!0,expandDirection:"horizontal",view:"maximize"}).render(),this.rootWView[e].wrapperView.inject(t),this.rootWView[e].addEvent("RootWCollapsed",this.checkForSlider.bind(this)),this.rootWView[e].addEvent("disablePredicateForColorize",this.disableOtherPredicates.bind(this))}return this.checkForSlider(),this.addSeparatorResizing(),this.initializeDragScroll(),document.documentElement.addEventListener("keyup",function(e){this.container.getClosest(".column.left")&&this.container.getClosest(".column.left").hasClassName("shown")&&this.container.getClosest("#tagger-ct")&&!this.container.getClosest("#tagger-ct").isHidden()&&!this.container.isHidden()&&17===e.keyCode&&this.taggerView.onRefineLaunch(e)}.bind(this),!1),this},init:function(e){this._parent(e)},setWidth:function(e){this.minWidth=e;for(let t in this.views){this.rootWView[t].wrapperView.getElement(".rootw-expander").style.width<=e&&this.rootWView[t].wrapperView.getElement(".rootw-expander").setStyle("width",e)}},redraw:function(e,t){this.selectedRootWs=t;let i=[],a=this,n=this.taggerView.observedNavImpl;if(e){let t=n.getFocusedProxy();t&&(this.showMoreTags=t.showAllBool),e.hasOwnProperty("toShow")?this.showMoreTags=e.toShow:e.toShow=this.showMoreTags}this.taggerView.getRootWs().forEach(function(e){let i=a.rootWView[e];t.indexOf(e)>=0?(i.show(),a.container.getElement("#tn-root"+e.replace("ds6w:","")).show(),a.container.getElement("#tn-root"+e.replace("ds6w:","")).removeClassName("hiddenRootW")):(i.hide(),a.container.getElement("#tn-root"+e.replace("ds6w:","")).hide(),a.container.getElement("#tn-root"+e.replace("ds6w:","")).addClassName("hiddenRootW"))});for(let a in this.rootWView)if(-1!==t.indexOf(a)){let t=!(!e||!e.searchString);this.rootWView[a].setWViewExpandStatus(t),this.rootWView[a].setToShowProperty(this.showMoreTags),this.rootWView[a].getWViewExpandStatus()&&i.push(this.rootWView[a].redraw(e))}Promise.all(i).then(e=>{let t=0;e.forEach(e=>{if(e){let i=e.viewId;e.isEmpty||e.hasNoResults?(a.container.getElement("#tn-root"+i.replace("ds6w:","")).hide(),t++):a.container.getElement("#tn-root"+i.replace("ds6w:","")).show()}}),Object.keys(this.rootWView).length===t?this.noTagsView.show():this.noTagsView.hide(),this.checkForSlider()})},restoreOriginalView:function(){this.slideCount=-1,this.totalSlidesVisibleOnLoad=0},slideToLeft:function(){this.slideRootW("left")},slideToRight:function(){this.slideRootW("right")},_isInViewPort:function(e){let t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth},slideRootW:function(e){let t=[];var i=this.container.getElement(".tnmax-all-view-container");let a=this.container.getElement(".tnmax-maximized-views");i.removeClassName("change-overflow");this.container.getElement(".tnmax-maximized-views").clientWidth;let n=i.getElements(".tnmax-root-view");var s=-1;for(let e=0;e<n.length;++e)n[e].isHidden()||(s++,t.push(n[e]));this.slideCount>t.length&&(this.slideCount=t.length-1);let o=this.slideCount;if(this.totalVisibleWidth=0,t.forEach((t,i)=>{this._isInViewPort(t)&&(this.slideCount="right"==e?i+1:i-1),this.totalSlidesVisibleOnLoad||(this.totalSlidesVisibleOnLoad=this.slideCount)}),"right"===e)if(a.scrollLeft){let e=t[o].clientWidth;a.scrollLeft=a.scrollLeft+e}else a.scrollLeft=t[o].clientWidth;else if(this.slideCount<=this.totalSlidesVisibleOnLoad)a.scrollLeft=0;else{let e=t[o].clientWidth;a.scrollLeft=a.scrollLeft-e}this.getElement(".slider-btn-hldr-left").style.display=this.slideCount>this.totalSlidesVisibleOnLoad?"block":"none",this.getElement(".slider-btn-hldr-right").style.display=this.slideCount<s?"block":"none"},checkForSlider:function(){let e=[],t=!1;let i=this.container.getElement(".tnmax-all-view-container").getElements(".tnmax-root-view");var a=0,n=this;for(let t=0;t<i.length;++t)i[t].isHidden()||(a++,e.push(i[t]));this.slideCount>this.totalSlidesVisibleOnLoad&&(this.slideCount=this.totalSlidesVisibleOnLoad,n.getElement(".slider-btn-hldr-left").style.display="none"),setTimeout(function(){n.totalVisibleWidth=0;let i=n.container.getElement(".tnmax-maximized-views").clientWidth;for(let a=0;a<e.length;++a){if(e[a].getElement(".rootw-expander").hasClassName("horizontalHidden")||(n.totalVisibleWidth+=e[a].clientWidth),n.totalVisibleWidth>i){n.totalSlidesVisibleOnLoad||(n.totalSlidesVisibleOnLoad=a),n.slideCount=a-1,t=!1;break}t=!0}a<=1?n.getElement(".slider-btn-hldr-right").style.display="none":-1==n.slideCount||t?(n.getElement(".slider-btn-hldr-right").style.display="none",console.log("Display right none")):(n.getElement(".slider-btn-hldr-right").style.display="block",console.log("Display right block"))},500)},toggleShowMore:function(e){let t=e&&e.selectedRootWs||[];this.setShowMoreProperty(e),e.isInteractive&&this.redraw(e,t)},setShowMoreProperty:function(e){this.showMoreTags=e&&e.toShow},addSeparatorResizing:function(){let e,t,i,a=this;function n(a){a.stopPropagation(),a.preventDefault();const n=a.target.getClosest(".tnmax-root-view");if(n){const l=n.previousElementSibling;if(l){const c=l.getElement(".rootw-expander");let d=n.getElement(".resizer");c&&function(a,n,l){e=a.clientX||a.touches[0].clientX,t=parseInt(window.getComputedStyle(n).width,10),i=n,l&&l.addClassName("show");document.documentElement.addEventListener("mousemove",s,!1),document.documentElement.addEventListener("touchmove",o,!1),document.documentElement.addEventListener("mouseup",()=>r(l),!1),document.documentElement.addEventListener("touchend",()=>r(l),!1)}(a,c,d)}}}function s(n){if(!a.container.isHidden()){const s=t+(n.clientX-e);s>=a.taggerView.tabViewWidth&&(i.style.width=s+"px")}}function o(n){if(!a.container.isHidden()){const s=t+(n.touches[0].clientX-e);s>=a.taggerView.tabViewWidth&&(i.style.width=s+"px")}}function r(e){if(!a.container.isHidden()){let t=i.id,n=a.rootWView[t].predicateViews;for(let e in n){let t=n[e];t.currentViewMode.includes("graph")&&t.getPredicateExpandStatus()&&t.graphView.restoreGraph()}document.documentElement.removeEventListener("mousemove",s,!1),document.documentElement.removeEventListener("touchmove",o,!1),document.documentElement.removeEventListener("mouseup",r,!1),document.documentElement.removeEventListener("touchend",r,!1),e&&e.removeClassName("show")}}this.verticalLines=this.container.getElements(".verticalContainer"),this.verticalLines.forEach(e=>{e.addEventListener("mousedown",n,!1),e.addEventListener("touchstart",n,!1)})},initializeDragScroll:function(){let e,t=!1,i=this.container.getElement(".tnmax-maximized-views"),a=i.offsetLeft;let n=this.container.getElement(".tnmax-all-view-container").getElements(".tnmax-root-view");var s=this,o=[];for(let e=0;e<n.length;++e)n[e].isHidden()||(0,o.push(n[e]));function r(n){t=!0,e="touchstart"===n.type?n.touches[0].pageX-i.offsetLeft:n.pageX-i.offsetLeft,a=i.scrollLeft,"touchstart"===n.type?(i.addEventListener("touchmove",c,!1),i.addEventListener("touchend",l,!1),i.addEventListener("touchcancel",l,!1)):(i.addEventListener("mousemove",c,!1),i.addEventListener("mouseup",l,!1),i.addEventListener("mouseleave",l,!1))}function l(){t=!1,"touchend"===event.type||"touchcancel"===event.type?(i.removeEventListener("touchmove",c,!1),i.removeEventListener("touchend",l,!1),i.removeEventListener("touchcancel",l,!1)):(i.removeEventListener("mousemove",c,!1),i.removeEventListener("mouseup",l,!1),i.removeEventListener("mouseleave",l,!1)),function(){let e=0,t=i.offsetWidth+i.scrollLeft;t=i.offsetWidth===t?0:t;for(let i=0;i<o.length;++i){let a=o[i].getElement(".rootw-expander");if(!a.hasClassName("horizontalHidden")){if(e+=o[i].clientWidth,0==t){s.getElement(".slider-btn-hldr-right").style.display="block",s.getElement(".slider-btn-hldr-left").style.display="none",s.slideCount=s.totalSlidesVisibleOnLoad;break}if(e>t){s.slideCount=i-1,s.getElement(".slider-btn-hldr-right").style.display="block",s.getElement(".slider-btn-hldr-left").style.display="block";break}if(i==o.length-1){s.slideCount=i,s.getElement(".slider-btn-hldr-right").style.display="none",s.getElement(".slider-btn-hldr-left").style.display="block";break}}}}()}function c(n){if(n.preventDefault(),!t)return;const s=("touchmove"===n.type?n.touches[0].pageX-i.offsetLeft:n.pageX-i.offsetLeft)-e;i.scrollLeft=a-s}i.addEventListener("mousedown",r,!1),i.addEventListener("touchstart",r,!1)},updatePredicateForColorize:function(e){if(e)for(let t in this.rootWView)if(-1!==this.selectedRootWs.indexOf(t)){let i=this.rootWView[t].predicateViews;for(let t in i)i[t].updatePredicateForColorize(e)}},disableOtherPredicates:function(e){if(e)for(let t in this.rootWView)if(-1!==this.selectedRootWs.indexOf(t)){let i=this.rootWView[t].predicateViews;for(let t in i)e.predicateId!==t&&i[t].disablePredicateForColorize(e)}},updatePredicateForExclude:function(e){if(e&&-1!==this.selectedRootWs.indexOf("ds6w:when")){let t=this.rootWView["ds6w:when"].predicateViews;for(let i in t)t[i].updatePredicateForExclude(e)}},updatePredicateForGrouping:function(e){if(e)if("update"===e.action){let t=e.rootW;if(-1!==this.selectedRootWs.indexOf(e.rootW)){let i=e.predicate;"type_categorization"===i&&(e.predicate="ds6w:type"),this.rootWView[t].predicateViews[i].updatePredicateForGrouping(e)}}else for(let t in this.rootWView)if(-1!==this.selectedRootWs.indexOf(t)){let i=this.rootWView[t].predicateViews;for(let t in i)i[t].updatePredicateForGrouping(e)}},destroy:function(){this.rootWView.forEach(e=>{e.destroy()}),this.stopListening(),this._parent()}})}),define("DS/TagNavigator/TagNavigatorManager",["DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/TagsServer"],function(e,t){"use strict";return function(i){var a;if(!(i instanceof e))throw new Error("Invalid input arg");a=i,this.isAlive=function(){return a.isAlive()},this.setAsCurrent=function(){return a.setAsCurrent(),this},this.focusOnCC=function(e){return a.focusOnCC(e),this},this.unfocusCC=function(){return a.unfocusCC(),this},this.getProxy=function(e){var i,n,s;if(!arguments.length)throw new Error("Invalid Input arguments");if(1===arguments.length&&"object"==typeof e&&null!==e)return e.widgetId&&"string"==typeof e.widgetId||(e.widgetId="IsNotInWidget"),e.cStorages||!e.tagsServicesURL&&!e.tagsServerUrl||(e.cStorages={},i=e.tagsServicesURLQueryParams?e.tagsServicesURLQueryParams.tenant:e.tagsServerUrlParams?e.tagsServerUrlParams.tenant:null,n=e.tagsServicesURL||e.tagsServerUrl,s=new t(n,i),e.cStorages._default=s,i&&(e.cStorages[i]=s)),e.filteringMode||(e.filteringMode="FilteringOnServer"),"boolean"!=typeof e.hasPlatformData&&(e.hasPlatformData=!0),a.getProxy(e);throw new Error("Invalid Input arguments")},this.removeProxiesOfCC=function(e){return a.removeProxiesOfCC(e),this},this.switchProxiesOnCC=function(e){return a.switchProxiesOnCC(e),this},this.removeAllProxies=function(){return a.removeAllProxies(),this},this.getProxyWithFilteringServices=function(e,t){return this.getProxy({proxyDisplayName:e,tagsServerUrl:t,filteringMode:"WithFilteringServices"})},this.getFilters=function(){return a.getFilters()},this.clearFilters=function(){return a.clearFilters(!0)},this.id=function(){return a.id()},this.die=function(){return a.die(),this},this._updateTagsServers=function(e){a._updateTagsServers(e)}}}),define("DS/TagNavigator/TagNavigator",["UWA/Core","UWA/Class","UWA/Promise","UWA/Class/Events","UWA/Utils/InterCom","DS/TagNavigator/TagNavigatorManager","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/TaggerView","DS/TagNavigator/Logger","DS/TagNavigator/LoggerUX","DS/TagNavigator/TagsServer","DS/TagNavigator/TaggerNLS","DS/TagNavigator/UserSettings","DS/TagNavigator/TaggerSettings"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u){"use strict";var p,f,m,v,T=o.allProxiesMap,C={},w={},b=null,y=null,S=null,I=null,E=null,x=!1;function _(e){if(e&&e.origin)return e.origin.socket;l.warn("Could not get proxy ID, socket not defined.")}p=t.extend(a,{init:function(){var t=this;t.view=null;var i={},a=window.location.search.substring(1);if(a){for(var n=a.split("&"),c=0;c<n.length;c++){var p=n[c].split("=");1==p.length?i[p[0]]=!0:2==p.length&&p[0].length>0&&(i[p[0]]=p[1])}u.urlSettings(i)}var m=u.getOption("preciseTagsCount");UWA.is(m,"boolean")&&(g.preciseCount_global=m),this.create6WTaggerView=function(i,a,n,s){var c;return l.group("TagNavigator::create6WTaggerView"),l.info("Options : ",n),l.groupEnd("TagNavigator::create6WTaggerView"),(c=null===t.view)&&(e.is(n,"object")&&this.addEvents(n),t.view=new r(new o(null!==i&&i.id()),a,t,f,I,E,s),D.resolve()),c},this.addEvents=function(e){for(var i in e)t.addEvent(i,e[i])},this.toggle6WTaggerViewVisibility=function(e){t.view&&t.view.toggleVisibility(e)},this.get6WTaggerViewVisibility=function(){return!(!t.view||!t.view.visibility)&&t.view.tabView.selectedTab.getName()},this.get6WTagger=function(e){var t;t=null;try{t=new s(new o(e,x,b,{tagServers:C},S,y))}catch(e){l.error(e.message)}return t},this.setDefault6WTagsServicesURL=function(e,t){return l.log("depreacted: please use set6WTaggerOptions"),t||(t={}),this.set6WTaggerOptions({tagsServerUrl:e,tagsServerUrlParams:t})},this.set6WTaggerOptions=function(t){l.group("TagNavigator::set6WTaggerOptions"),l.info("Options : ",t),l.groupEnd("TagNavigator::set6WTaggerOptions");var i,a,n,s,r,c,p,m=0;if(!e.is(t,"object"))throw new Error("Invalid Input arguments");if(t.lang?g.setCurrentLanguage(t.lang.substr(0,2)):window.dsLang?g.setCurrentLanguage(window.dsLang.substr(0,2)):null!==(window.App?window.App.lang:null)&&g.setCurrentLanguage(window.App.lang.substr(0,2)),"3DDashboard"===t.brand?x=!0:t.webInWin&&(window.richClient=!0),o._brand=t.brand,t.startupParams)if(i=t.startupParams,t.startupParams.cstorage=t.startupParams.cstorage.filter(function(e){return e.url&&""!==e.url}),t.startupParams.tagger=t.startupParams.tagger.filter(function(e){return e.url&&""!==e.url}),!x&&t.tenant){for(m=0;m<i.cstorage.length;m++)if(i.cstorage[m].id===t.tenant){s=i.cstorage[m].url,c=i.cstorage[m].id,p=i.cstorage[m].displayName,a=new d(s,c,p),w[c]=a,w._default=a;break}for(m=0;m<i.tagger.length;m++)if(i.tagger[m].id===t.tenant){r=i.tagger[m].url,c=i.tagger[m].id,p=i.tagger[m].displayName,n=new d(r,c,p),C[c]=n,C._default=n;break}}else{if(!x&&!t.tenant)throw new Error("Error: standalone env, a tenant should be given to the Tagnavigator");for(m=0;m<i.cstorage.length;m++)s=i.cstorage[m].url,c=i.cstorage[m].id,p=i.cstorage[m].displayName,a=new d(s,c,p),w[c]=a;for(i.tagger&&0!==i.tagger.length||(i.tagger=i.cstorage),m=0;m<i.tagger.length;m++)r=i.tagger[m].url,c=i.tagger[m].id,p=i.tagger[m].displayName,n=new d(r,c,p),C[c]=n}else t.cStorageService?(c=t.tenant||null,a=new d(t.cStorageService,c),w._default=a,c&&(w[c]=a)):(t.tagsServicesURL||t.tagsServerUrl)&&(r=t.tagsServicesURL||t.tagsServerUrl,c=t.tenant||(t.tagsServicesURLQueryParams?t.tagsServicesURLQueryParams.tenant:null)||(t.tagsServerUrlParams?t.tagsServerUrlParams.tenant:null),n=new d(r,c),w._default=n,c&&(w[c]=n));t&&t.getContextIdFromWidgetId&&"function"==typeof t.getContextIdFromWidgetId&&(b=t.getContextIdFromWidgetId),t&&t.getWidgetNameFromWidgetId&&"function"==typeof t.getWidgetNameFromWidgetId&&(y=t.getWidgetNameFromWidgetId),t&&t.getTabTitleFromTabId&&"function"==typeof t.getTabTitleFromTabId&&(S=t.getTabTitleFromTabId),t&&t.displayFilteredState&&"function"==typeof t.displayFilteredState&&(I=t.displayFilteredState),t&&UWA.is(t.isAuthenticated,"function")&&!t.isAuthenticated()&&(u.getOption("legacy6W")||sessionStorage.getItem("legacy6W")||!1===u.getOption("offline6W")||u.setOption("offline6W",!0)),t.taggerIconId&&(E=t.taggerIconId),t.myAppsBaseUrl&&(f=h.init(t.myAppsBaseUrl))}},_executeProxyAPI:function(e,t,i){var a=T[i];a?V[e](a,t):N(i,e,t)},_setTags:function(e,t){this._executeProxyAPI("setTags",e,t)},_configurePredicates:function(e,t){this._executeProxyAPI("configurePredicates",e,t)},_unsetTags:function(e,t){this._executeProxyAPI("unsetTags",e,t)},_setSubjectsTags:function(e,t){this._executeProxyAPI("setSubjectsTags",e,t)},_focusOnSubjects:function(e,t){this._executeProxyAPI("focusOnSubjects",e,t)},_unfocus:function(e,t){this._executeProxyAPI("unfocus",e,t)}}),m=new p,c.start(),l.log("TagNavigator - init of intercom server"),v=new n.Server("com.ds.tagger6w",{isPublic:!1});var A=[],N=function(e,t,i){var a=A.findIndex(function(t){return t.id==e}),n=-1!==a?A[a]:void 0;n||(n={id:e,calls:[]},A.push(n)),l.warn("stacking a proxy call, "+t),n.calls.push({id:t,data:i})},V={};V.setTags=function(e,t){e.setTags(t.tagsdata,t.summaryData,t.options)},v.addListener("setTags",function(e,t){var i=T[_(t)];i?V.setTags(i,e):N(_(t),"setTags",e)}),V.setEmbeddedViewProperties=function(e,t){e.setEmbeddedViewProperties(t)},v.addListener("setEmbeddedViewProperties",function(e,t){var i=T[_(t)];i?V.setEmbeddedViewProperties(i,e):N(_(t),"setEmbeddedViewProperties",e)}),v.addListener("addSubjects",function(e,t){T[_(t)].addSubjects(e.tagsdata)}),v.addListener("setCriteria",function(e,t){T[_(t)].setCriteria(e.criteria)}),v.addListener("updateCriteria",function(e,t){T[_(t)].updateCriteria(e.criteria)}),v.addListener("removeCriteria",function(e,t){T[_(t)].removeCriteria(e.criteria)}),V.setSubjectsTags=function(e,t){e.setSubjectsTags(t)},v.addListener("setSubjectsTags",function(e,t){var i=T[_(t)];i?V.setSubjectsTags(i,e):N(_(t),"setSubjectsTags",e)}),v.addListener("addSubjectsTags",function(e,t){T[_(t)].addSubjectsTags(e)}),v.addListener("die",function(e,t){var i=_(t),a=T[i];a&&a.isAlive()&&a.die(),v.dispatchEvent("isDead",null,null,[i])}),V.setAdditionalFilter=function(e,t){e.setAdditionalFilter(t)},v.addListener("setAdditionalFilter",function(e,t){var i=T[_(t)];i?V.setAdditionalFilter(i,e):N(_(t),"setAdditionalFilter",e)}),V.setAdditionalFilterProperties=function(e,t){e.setAdditionalFilterProperties(t)},v.addListener("setAdditionalFilterProperties",function(e,t){var i=T[_(t)];i?V.setAdditionalFilterProperties(i,e):N(_(t),"setAdditionalFilterProperties",e)}),V.activate=function(e,t){e.activate(t),m.view.setActiveCriteria(!0,!0)},v.addListener("activate",function(e,t){var i=T[_(t)];i?V.activate(i,e):N(_(t),"activate",e)}),V.deactivate=function(e,t){e.deactivate(t),m.view.setActiveCriteria(!0,!0)},v.addListener("deactivate",function(e,t){var i=T[_(t)];i?V.deactivate(i,e):N(_(t),"deactivate",e)}),V.focusOnSubjects=function(e,t){e.focusOnSubjects(t.subjectsURI,t.persistTags,t.dataSources,t.options)},v.addListener("focusOnSubjects",function(e,t){var i=T[_(t)];i?V.focusOnSubjects(i,e):N(_(t),"focusOnSubjects",e)}),V.unfocus=function(e,t){e.unfocus()},v.addListener("unfocus",function(e,t){var i=T[_(t)];i?V.unfocus(i,e):N(_(t),"unfocus",e)}),V.unsetTags=function(e){e.unsetTags()},v.addListener("unsetTags",function(e,t){var i=T[_(t)];i?V.unsetTags(i):N(_(t),"unsetTags",e)}),V.toggleProxyFocus=function(e,t){e.toggleProxyFocus(t.focusStatus)},v.addListener("toggleProxyFocus",function(e,t){var i=T[_(t)];i?V.toggleProxyFocus(i,e):N(_(t),"toggleProxyFocus",e)}),V.clearLocalFilter=function(e,t){e.clearLocalFilter(!!t&&t.refine),m.view.setActiveCriteria(!0,!0,e)},v.addListener("clearLocalFilter",function(e,t){var i=T[_(t)];i?V.clearLocalFilter(i,e):N(_(t),"clearLocalFilter",e)}),v.addListener("setLocalFilter",function(e,t){T[_(t)].setLocalFilter(e,function(){m.view.setActiveCriteria(!0,!0,T[_(t)])})}),V.addLocalFilter=function(e,t){e.addLocalFilter(t).then(function(){m.view&&m.view.setActiveCriteria(!0,!0,e)},function(e){l.error(e)})},v.addListener("addLocalFilter",function(e,t){var i=T[_(t)];i?V.addLocalFilter(i,e):N(_(t),"addLocalFilter",e)}),V.removeLocalFilter=function(e,t){e.removeLocalFilter(t).then(function(){m.view&&m.view.setActiveCriteria(!0,!0,e)},function(e){l.error(e)})},v.addListener("removeLocalFilter",function(e,t){var i=T[_(t)];i?V.removeLocalFilter(i,e):N(_(t),"removeLocalFilter",e)}),v.addListener("setLocalGrouping",function(e,t){T[_(t)].setLocalGrouping(e).then(function(){m.view.setActiveCriteria(!0,!0,T[_(t)])},function(e){l.error(e)})}),v.addListener("requestGroupingChange",function(e,t){T[_(t)]._requestGroupingChange(e)}),v.addListener("clearLocalGrouping",function(e,t){T[_(t)].clearLocalGrouping(e).then(function(){m.view.setActiveCriteria(!0,!0,T[_(t)],!0)},function(e){l.error(e)})}),v.addListener("setColorMap",function(e,t){T[_(t)].setColorMap(e)}),V.configurePredicates=function(e,t){e&&"string"==typeof e?this._executeProxyAPI("configurePredicates",t,e):"object"==typeof e&&e.configurePredicates(t)},v.addListener("configurePredicates",function(e,t){var i=T[_(t)];i?V.configurePredicates(i,e):N(_(t),"configurePredicates",e)}),v.addListener("setStatus",function(e,t){T[_(t)].setStatus(e)}),v.addListener("showEmbeddedView",function(e,t){T[_(t)].showEmbeddedTaggerView()}),v.addListener("hideEmbeddedView",function(e,t){T[_(t)].hideEmbeddedTaggerView()}),v.addListener("updateProxyOptions",function(e,t){var i,a=T[_(t)];if(a)for(i in e)switch(i){case"tenant":var n=e.tenant;a.updateTenantInfo({tenant:n,cStorage:w[n],tagsServer:C[n]})}}),V.setInfoMessage=function(e,t){e.setMessageToDisplay(t)},v.addListener("setInfoMessage",function(e,t){var i=T[_(t)];i?V.setInfoMessage(i,e):N(_(t),"setInfoMessage",e)}),V.clearInfoMessage=function(e){e.clearMessage()},v.addListener("clearInfoMessage",function(e,t){var i=T[_(t)];i?V.clearInfoMessage(i):N(_(t),"clearInfoMessage")}),v.addListener("toggleDisplayAll",function(e,t){m.view.toggleDisplayAll(e)}),v.addListener("displayCriteria",function(e,t){l.log("received displayCriteria event");var i=T[_(t)];if(i){l.log("proxy id="+i.id());var a=i.getNavImpl();if(a){l.log("navImplOfProxy id="+a.id());var n=m.view.getObservedNavigator();if(n){l.log("observedNavImpl id="+n.id());var s=!(!1===e||e&&e.param&&!1===e.param.checkIsACriteria);if(l.log("displayCriteria flag="+s),a.id()===n.id())l.log("navImplOfProxy.id() === observedNavImpl.id()"),s?m.view.displayCriteria(e):m.view.displayTags();else l.warn("navImplOfProxy.id() NOT EQUAL TO observedNavImpl.id()"),a.getFocusedProxy()===i&&l.log("focusedProxy === proxy, set the selectedTab as per displayCriteria flag"),a.getCache()&&(a.getCache().selectedTab=s?"criteria":"tags")}}}}),v.addListener("toggleDisplayAllCriteria",function(e,t){m.view.toggleDisplayAllCriteria(e)}),v.addListener("updatePLMSuggestions",function(e,t){m.view.updatePLMSuggestions(e)}),v.addListener("updateSuggestions",function(e,t){m.view.updateSuggestions(e)});var P={},D=i.deferred();return v.addListener("getProxy",function(t,a){var n=function(s){var o,r,c,h,u;if(t.isSimplifiedView=s,o=_(a),c=t.filteringMode,"FilteringOnServer"===t.filteringMode&&(t.getExplicitTagsByTagger=!1),h=t.tenant||(t.tagsServerUrlParams?t.tagsServerUrlParams.tenant:null),t.contextId||"function"!=typeof b){if(!t.contextId||"string"!=typeof t.contextId)throw new Error("The context identifier can not be defined.");r=t.contextId}else if(r=b(t.widgetId),l.log("getContextIdFromWidgetId="+r),!r&&(UWA.is(e.Widgets)&&UWA.is(e.Widgets.instances,"array")&&e.Widgets.instances.length>0&&(r=e.Widgets.instances.filter(function(i){return e.is(i,"object")&&"sidepanel"===i.getView().type&&i.id===t.widgetId}).map(function(e){return e.context}).pop()),l.log("getContextIdFromWidgetId after treatment ="+r),!r))throw new Error("The widget id is unknown by 3DDashboard.");t.tagsServers={},t.cStorages={},h&&"onpremise"===h&&(h="OnPremise");if(x)if("IsNotInWidget"===t.widgetId&&l.error("Error: please set a widgetId for the proxy"),h)if(t.pod&&"3DSpace"!==t.pod||!w[h]){if(t.pod&&"6WTags"!==t.pod||!C[h])return function(e){let t=P[e];return t||(t=new i(function(t){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(i){i.getPlatformServices({platformId:e,onComplete:function(i){if(!UWA.is(i,"object"))throw new Error("The given tenant name is unknown by the TagNavigator.");l.log("Services for tenant "+h+"="+JSON.stringify(i)),i["3DSpace"]?w[h]=new d(i["3DSpace"],e,i.displayName):l.log("3DSpace URL NOT found for tenant "+e),i["6WTags"]?C[h]=new d(i["6WTags"],e,i.displayName):l.log("6WTags URL NOT found for tenant "+e),m.get6WTagger(r)._updateTagsServers(C),t()}})})})),t}(h).then(function(){n(s)});t.hasPlatformData=!1,t.cStorages[h]=w[h],t.tagsServers[h]=C[h]}else t.hasPlatformData=!0,t.cStorages[h]=w[h],t.tagsServers[h]=C[h]||w[h];else t.hasPlatformData=!1,t.tagsServers=C,t.cStorages=w;else if("IsNotInWidget"!==t.widgetId&&"RightPanelContext"!==t.contextId&&"RightPanelContext"!==r&&(t.widgetId="IsNotInWidget",l.error("Error Not in 3DD: the widgetId will be ignored, please do not set the widgetId parameter")),h)if(t.pod&&"3DSpace"!==t.pod||!w[h]){if(t.pod&&"6WTags"!==t.pod||!C[h])throw new Error("The given tenant name is unknown by the TagNavigator.");t.hasPlatformData=!1,t.cStorages[h]=w[h],t.tagsServers[h]=C[h]}else t.hasPlatformData=!0,t.cStorages[h]=w[h],t.tagsServers[h]=C[h]||w[h];else w._default&&(t.hasPlatformData=!0,t.cStorages._default=w._default);(function(e){var t=e.id(),i=A.findIndex(function(e){return e.id==t}),a=-1!==i?A.splice(i,1)[0]:void 0;a&&a.calls.forEach(function(t){l.warn("launching stacked proxy call, "+t.id),V[t.id](e,t.data)})})(u=m.get6WTagger(r).getProxy(t)),"FilteringOnServer"===c?(u.addFilterChangeListener.apply(u,[function(e){v.dispatchEvent("onFilterChange",e,null,[o])},this]),u.addCriteriaChangeListener.apply(u,[function(e){v.dispatchEvent("onCriteriaChange",e,null,[o])},this]),u.addPLMUpdateListener.apply(u,[function(e){v.dispatchEvent("plmUpdate",e,null,[o])},this]),u.addRequestSuggestionsListener.apply(u,[function(e){v.dispatchEvent("requestSuggestions",e,null,[o])},this]),u.addOpenTaggerListener.apply(u,[function(){v.dispatchEvent("onOpenTagger",null,null,[o])},this]),u.addCloseTaggerListener.apply(u,[function(){v.dispatchEvent("onCloseTagger",null,null,[o])},this]),u.addUpdateDisplayStatusListener.apply(u,[function(e){v.dispatchEvent("updateDisplayStatus",e,null,[o])},this]),u.addSelectInAppListener.apply(u,[function(e){v.dispatchEvent("onSelection",e,null,[o])},this]),u.addLoadMoreTagsListener.apply(u,[function(e){v.dispatchEvent("onLoadMoreTags",e,null,[o])},this]),u.addInfoMessageLinkClickListener.apply(u,[function(e){v.dispatchEvent("handleMessageAction",e,null,[o])},this]),u.addCriteriaModifiedListener.apply(u,[function(e){v.dispatchEvent("onCriteriaModified",e,null,[o])},this]),u.addAdditionalFilterChangeListener.apply(u,[function(e){v.dispatchEvent("onAdditionalFilterChange",e,null,[o])},this]),u.addFocusChangeListener.apply(u,[function(e){v.dispatchEvent("onFocusChange",e,null,[o])},this]),u.triggerCallbackOfEvent(21,m.view.visibility)):"WithFilteringServices"===c&&u.addFilterSubjectsListener.apply(u,[function(t){t=e.merge(t,u.getFilters()),v.dispatchEvent("onFilterSubjectsChange",t,null,[o])},this]),u.addTagCreationListener.apply(u,[function(e){v.dispatchEvent("addTagCreationListener",e,null,[o])},this]),u.addTagDeletionListener.apply(u,[function(e){v.dispatchEvent("addTagDeletionListener",e,null,[o])},this]),u.addLocalFilterStatusListener.apply(u,[function(e){v.dispatchEvent("addLocalFilterStatusListener",e,null,[o])},this]),u.addUnfocusSubjectsListener.apply(u,[function(e){v.dispatchEvent("addUnfocusSubjectsListener",e,null,[o])},this]),u.addColorizeListener.apply(u,[function(e){v.dispatchEvent("colorize",e,null,[o])},this]),u.addUnColorizeListener.apply(u,[function(e){v.dispatchEvent("unColorize",e,null,[o])},this]),UWA.is(u.addSortChangeListener,"function")&&u.addSortChangeListener.apply(u,[function(e){v.dispatchEvent("onSortChange",e,null,[o])},this]),u.addGroupingChangeListener.apply(u,[function(e){v.dispatchEvent("onGroupingChange",e,null,[o])},this]),!0===window.richClient&&u.addInternalFilterChangeListener.apply(u,[function(e){v.dispatchEvent("_internalFilterChangeListener",e,null,[o])},this]),function(e,t){var i={filters:T[e].getFilters(),forceFilterChangeEvent:t};i.lang=g.getLang(),v.dispatchEvent("proxyIsReady",i,null,[e])}(o,!0===t.forceFilterChangeEvent)};l.log("TagNavigator - received a getProxy event!"),l.log("Stacking up the get Proxy call!"),D.promise.then(function(){l.log("After deferred promise resloved!!"),m.view._viewInitializationPromise.then(function(){l.log("TagNavigator - handling a getProxy event as view is INITIALIZED!"),n(m.view._simplifiedTagger)})})}),m}),define("TagNavigator",["TagNavigator/TagNavigator"],function(e){"use strict";return e}),define("TagNavigator/TagNavigator",["DS/TagNavigator/TagNavigator"],function(e){"use strict";return e}),define("DS/TagNavigator/ParameterView",["UWA/Class/View","UWA/Core","DS/TagNavigator/Parameter","DS/TagNavigator/Parameters","DS/TagNavigator/TaggerView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/AbstractPredicateView","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button"],function(e,t,i,a,n,s,o,r,l,c){"use strict";return e.extend({domEvents:{"click .add-tag-close-param":"clearInput"},setup:function(e){this.focusOn=!0,this.taggerView=e.taggerView,this.disabled=!0},clearInput:function(e){if(!this.disabled){var t=e.target.getParent(".add-tag-cont").getElement("input");if(t){t.getClosest(".addClear").removeClassName("addClear");var i=t.getClosest(".form-control-root");i&&(i.value="",i.triggerEvent("keyup",e))}}},render:function(e){var i,a,n,c=this,d=function(){c.taggerView.onSearchLaunch()},g=function(e){var i=e.get("displayValue"),a=e.get("unit");return a&&(i=i+" ("+a+")"),t.createElement("div",{class:"predicate-label",html:i})},h=function(e,i){var a=t.createElement("span",{class:i}).inject(e);return a.setStyle("cursor","pointer"),a.setStyle("vertical-align","top"),a.setStyle("line-height","34px"),a.setStyle("display","inline-block"),"fonticon fonticon-fonticon fonticon-minus"===i&&a.addClassName("param-remove-button"),a},u=e,p=u.get("type");if("string"===p){i=t.createElement("div",{id:"paramString-container"}).inject(this.container),g(u).inject(i),a=t.createElement("div",{id:"paramString-innerContainer"}).inject(i),n=new r({placeholder:s.getText("typestring"),className:"param-inline-container"}).inject(a),this.disabled&&n.disable(),n.elements.input.addEvent("keyup",function(e){this.value.length&&this.value.split("*").length-1===this.value.length?e.target.addClassName("has-error"):(e.target.removeClassName("has-error"),u.set({stringVal:this.value})),o.checkActiveSearch(c.taggerView),13===e.keyCode&&d()}),h(a,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(e){c.disabled||(i.remove(),u.collection.remove(u))}).setAttributes({title:s.getText("paramRemove")});var f=u.get("stringVal");""!==f&&(n.elements.input.value=f,n.dispatchEvent("onKeyUp"))}else if("boolean"===p){i=t.createElement("div",{id:"paramBoolean-container"}).inject(this.container),g(u).inject(i),a=t.createElement("div",{id:"paramBoolean-innerContainer"}).inject(i),n=new l({placeholder:s.getText("selectValue"),className:"param-inline-container",options:[{value:"1",label:s.getText("yes")},{value:"2",label:s.getText("no")}],events:{onChange:function(e){u.set({boolVal:this.getValue()}),o.checkActiveSearch(c.taggerView)}}}).inject(a),this.disabled&&n.disable(),n.elements.input.addEvent("keyup",function(e){13===e.keyCode&&d()}),h(a,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(e){c.disabled||(i.remove(),u.collection.remove(u))}).setAttributes({title:s.getText("paramRemove")});var m=u.get("boolVal");m.length>0&&""!==m[0]&&(n.setValue(m),n.dispatchEvent("onChange"))}else if("integer"===p||"double"===p){var v=u.get("intType"),T=[],C=function(){var e=[];return v.forEach(function(t){t.rangeVal.length>0&&e.push(t.rangeVal)}),e},w=function(){v.forEach(function(e){var t=null!==e.rangeContainer&&e.rangeContainer.hasChildNodes()?e.rangeContainer.getChildren():null;(d=t?t[0]:null)&&(d.remove(),d.destroy());var i,a=[],n=[];for(T.forEach(function(t){e.rangeVal!==t&&n.push(t)}),i=0;i<4;i++){var o,r;switch(i){case 0:o="1",r=s.getText("paramIntType1");break;case 1:o="2",r=s.getText("paramIntType2");break;case 2:o="3",r=s.getText("paramIntType3");break;case 3:o="4",r=s.getText("paramIntType4")}-1===n.indexOf(o)&&(a.push({value:o,label:r}),o===e.rangeVal&&(a[a.length-1].selected=!0,a[a.length-1].disabled=!0))}var d=new l({placeholder:!1,options:a,events:{onChange:function(t){e.rangeVal=t.target.value,T=C(),w()}}}).inject(e.rangeContainer);c.disabled&&d.disable()})},b=function(e,i,a){i||g(u).inject(e);var n=a||function(){var e={fromVal:null,toVal:null,rangeContainer:null,rangeVal:"1"};return v.push(e),e}();if(!n.rangeContainer){if(T.length>0){var l=0;for(l=0;l<4;l++){var f=l+1+"";if(-1===T.indexOf(f)){n.rangeVal=f;break}}}T=C()}var m=t.createElement("div",{class:"paramInteger-innerContainer"}).inject(e);n.rangeContainer=t.createElement("div",{class:"add-tag-cont fromtoSelect"}).inject(m);var y=function(e,t,i){var a=e.target.value,s=t?parseInt(a,10):parseFloat(a);if(a.length&&isNaN(s))e.target.addClassName("has-error");else{if("from"===i&&null!==n.toVal&&s>n.toVal||"to"===i&&null!==n.fromVal&&n.fromVal>s)return e.target.addClassName("has-error"),null;e.target.removeClassName("has-error")}return isNaN(s)?null:s},S=t.createElement("div",{class:"add-tag-cont fromto from"}).inject(m),I=new r({placeholder:s.getText("from")}).inject(S),E=t.createElement("span",{class:"add-tag-close-param"}).inject(S);t.createElement("span",{class:"fonticon fonticon-cancel-circled"}).inject(E),c.disabled&&I.disable();var x=function(e){e.target&&(e=e.target),""===e.value?e.getClosest(".add-tag-cont").removeClassName("addClear"):e.getClosest(".add-tag-cont").addClassName("addClear"),o.checkActiveSearch(c.taggerView)};I.elements.input.addEvent("keyup",function(e){n.fromVal=y(e,"integer"===p,"from"),x(e),13===e.keyCode&&d()}),""!==n.fromVal&&(I.setValue(n.fromVal),x(I.elements.input));var _=t.createElement("div",{class:"add-tag-cont fromto to"}).inject(m),A=new r({placeholder:s.getText("to")}).inject(_);c.disabled&&A.disable();var N=t.createElement("span",{class:"add-tag-close-param"}).inject(_);return t.createElement("span",{class:"fonticon fonticon-cancel-circled"}).inject(N),A.elements.input.addEvent("keyup",function(e){n.toVal=y(e,"integer"===p,"to"),x(e),13===e.keyCode&&d()}),""!==n.toVal&&(A.setValue(n.toVal),x(A.elements.input)),h(m,"fonticon fonticon-fonticon fonticon-plus").addEvent("click",function(t){c.disabled||v.length<4&&(b(e,!0).inject(e),w())}).setAttributes({title:s.getText("paramAdd")}),h(m,"fonticon fonticon-fonticon fonticon-minus").addEvent("click",function(t){if(!c.disabled){1===v.length?e.remove():m.remove();var i=v.indexOf(n);i>-1&&v.splice(i,1),v.length<1&&u.collection.remove(u),T=C(),w()}}).setAttributes({title:s.getText("paramRemove")}),m};n=t.createElement("div",{id:"paramInteger-container"}).inject(this.container);var y,S=v.length;if(S>0){for(y=0;y<S;y++)b(n,0!==y,v[y]);T=C()}else b(n,!1);w()}if(n&&this.focusOn)if("string"===p||"boolean"===p)n.focus();else{var I=u.get("intType");I&&I.length>0&&I[0].rangeContainer&&I[0].rangeContainer.focus()}return this}})}),define("DS/TagNavigator/TaggerView",["UWA/Core","UWA/Class/View","UWA/Class/Promise","UWA/Storage","DS/TagNavigator/TagNavigatorManagerImpl","DS/TagNavigator/AbstractPredicateView","DS/TagNavigator/TagValue","DS/TagNavigator/Predicate","DS/TagNavigator/PredicateView","DS/TagNavigator/RootPredicateView","DS/TagNavigator/TagValueView","DS/TagNavigator/TaggerNLS","DS/TagNavigator/Parameter","DS/TagNavigator/ParameterView","DS/TagNavigator/UserSettings","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/TagNavigator/NotificationManager","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/IconDropdown","DS/UIKIT/Autocomplete","DS/UIKIT/Tooltip","UWA/Controls/TabView","DS/TagNavigator/Logger","DS/TagNavigator/LoggerUX","DS/TagNavigator/Suggestions","DS/UIKIT/Scroller","DS/TagNavigator/TaggerProxyWithFilteringServices","DS/TagNavigator/TaggerSettings","DS/TagNavigator/ActiveCriteria","DS/TagNavigator/simplified/actions/ActionUtils","DS/TagNavigator/simplified/utils/ColorUtils","DS/TagNavigator/TaggerTrackerApi","DS/MessageBus/MessageBus","DS/TagNavigator/simplified/views/ContextMenu","DS/TagNavigator/userTags/advocacy/CompanyTagsAdvocacyView","DS/TagNavigator/TaggerUtils","DS/TagNavigator/userTags/utils/UserTagsUtils","DS/TagNavigator/simplified/views/WarningInfoView","DS/TagNavigatorOpenness/views/ActiveCriteriaView"],function(e,t,i,a,n,s,o,r,l,c,d,g,h,u,p,f,m,v,T,C,w,b,y,S,I,E,x,_,A,N,V,P,D,O,M,U,F,W,R,j,L,k,B,G,z){"use strict";var H=600,J=600,Y={"ds6w:who":"Who","ds6w:when":"When","ds6w:what":"What","ds6w:where":"Where","ds6w:why":"Why","ds6w:how":"How"};return t.extend({_customEnumFiltering:void 0,_simplifiedTagger:void 0,_simplifiedSelectedRootWs:[],actionManager:void 0,_viewInitializationPromise:void 0,_enabledAllwMode:void 0,_viewMoreStatus:!1,init:function(e,t,i,a,n,s,o){for(var l in W.set(),this._customEnumFiltering=O.getOption("customFilteringAdvSearch"),Y)new r({sixw:[l],type:"string"});this._ignoreRedraw=O.getOption("ignoreRedraw"),this._parent({tnManagerImpl:e,domId:t,tn:i,userSettings:a,setLocalFilterIcon:n,taggerIconId:s,visibility:!0===o})},setup:function(t){var s;if(!(t.tnManagerImpl instanceof n))throw new Error("Invalid input arg");if("string"==typeof t.domId&&(this.taggerUWAElement=document.getElementById(t.domId)),!this.taggerUWAElement)throw new Error("Unexisting target DOM element");if(this.taggerUWAElement=e.extendElement(this.taggerUWAElement),this.taggerIcon=e.extendElement(document.getElementById(t.taggerIconId)),this.taggerIcon&&this.taggerIcon.addEvent("click",this.mainTaggerIconClicked.bind(this)),this.storage=new a({adapter:"Dom",database:"TagNavigator"}),this.isW=!(!this.storage||"true"!==this.storage.get("isW")),this.container=this.taggerUWAElement,this.tagnavigator=t.tn,this.taggerScroller=null,this.criteriaScroller=null,this.allContentView=null,this.loadMoreTagsView=null,this.timer=null,this.callServerInProgress=!1,this.timerOnSearch=null,this.internalRedrawTimer=null,this.DOMIdToId={},this.selectedTags=[],this.canBeMaximized()){this.container.addClassName("panelManagerMaximizable");let e=this.container.getClosest(".column.left");if(e){let t=e.getElement(".panel-action.maximize-action"),i=e.getElement(".panel-action.minimize-action");t&&i&&(t.addEventListener("click",function(){this.tabView.elements.container.setStyle("display","none"),this.isMaximized=!0}.bind(this)),i.addEventListener("click",function(){this.isMaximized=!1,this.maximizeTaggerView.container.setStyle("display","none")}.bind(this)))}}this.fx=function(t,i,a){var n=this;return new e.Fx(t,{duration:300,transition:"quadInOut",events:{onComplete:function(){i?"createTag"==a?t.setStyles({position:"relative",overflow:"visible",height:"auto"}):t.setStyles({position:"relative",overflow:"hidden",height:"auto"}):t.setStyles({position:"absolute",height:"0px"}),n.updateScroller()},onStart:function(){t.setStyle("position","relative"),t.setStyle("overflow","hidden")}}})},this.setLocalFilterIcon=t.setLocalFilterIcon,this.visibility=t.visibility,this.myNotificationControl=new f({closable:!0,visible:!0,maximumVisibleMessages:2,autoHide:!1,messageClassName:"error"}),this.selectedTenant=null,this.selectedPredicate="ds6w:what";var o={};this.observedNavImpl=t.tnManagerImpl;var r=this;for(s in o[n.events.FILTER_CHANGE]=function(e){this.tagnavigator.hasEvent("onFilterChange")&&this.tagnavigator.dispatchEvent("onFilterChange",e),this.setActiveCriteria(!0,!0)},o[n.events.CHANGE_OF_CURRENT_TN]=function(e){var t,i=new n(e);if(!this.observedNavImpl)throw new Error("Unexpected change of current TN while the TaggerView is not already observing a Tagger?!");if(this.observedNavImpl===i)return!1;if(this._viewInitializationPromise.then(function(){this._simplifiedTagger&&this.observedNavImpl.getCache().set6WSort("sort-weight")}.bind(this)),"3DDashboard"===n._brand){var a=function(){p.getUserId().then(function(e){e&&r.observedNavImpl.setUserId(e),r.observedNavImpl.updatePinnedTag(void 0,r._simplifiedTagger)})};this._viewInitializationPromise.then(function(){a()},function(){a()})}var s=this.storage.get("activeSimplifiedW");for(t in s&&i.getCache().setActiveW(s),n.events)this.observedNavImpl.removeEvent(t,o[t]);for(t in A.log("The view now ignores the TagNavigator '"+this.observedNavImpl.id()+"'"),this.observedNavImpl=i,n.events)this.observedNavImpl.addEvent(t,o[t],this);return A.log("The view now observes the TagNavigator '"+e+"'"),N.updateContext(e),this.tagnavigator.hasEvent("onFilterChange")&&this.tagnavigator.dispatchEvent("onFilterChange",this.observedNavImpl.getFilters()),this.actionManager&&this.actionManager.abortAction(),this.getContextWidgetTitle(),this.redraw(),this},o[n.events.REDRAW_TAGS]=function(e){this.redrawTriggeredBy=e?e.event:void 0,!this.tabView||"criteria"===this.tabView.selectedTab.getName()&&"focusOnSubjects"===this.redrawTriggeredBy||this.redraw();let t=this.observedNavImpl.getProxiesToDisplay(),i=this.observedNavImpl.getFocusedProxy(),a=!!(i||(1===t.length?t[0]:null));this.warningInfoView&&this.warningInfoView.displayMessage(a)},o[n.events.REDRAW_CRITERIA]=function(){this.internalRedrawTimer=setTimeout(this.redrawCriteria.bind(this),50)},o.SEARCH_LAUNCH=function(){this.visibility&&this.redrawActiveCriteria(!1)},o[n.events.UPDATE_ICON]=function(){var e;if(this.setLocalFilterIcon)for(var t in n.allProxiesMap)e=n.allProxiesMap[t].widgetId(),this.observedNavImpl.getProxyToFocusFromWidgetId(e)&&t===this.observedNavImpl.getProxyToFocusFromWidgetId(e).id()&&this.setLocalFilterIcon(e,n.allProxiesMap[t].hasLocalFilters());this.getContextWidgetTitle(),this.redrawTopBarTagIcon()},o[n.events.UNFOCUS]=function(e){return e?this.displayTags(!1):this.displayTags(),this.redraw()},o[n.events.OPEN_TAGGER]=function(){return this.openTagger()},o[n.events.CLOSE_TAGGER]=function(){return this.closeTagger()},o[n.events.CRITERIA_CLICK]=function(e){this.observedNavImpl.getFocusedProxy()||this.observedNavImpl.dispatchEvent("onBeforeGlobalFilterChange"),this.toggleTagSelection(e.replace("atv",""))},o[n.events.CRITERIA_CLICK2]=function(e,t){e?this.deleteFreeInput(e):this.onToggleParamTagSelection(t)},o[n.events.TRASH_CLICK]=function(e){this.clearActiveTags(e)},o[n.events.CRITERIA_PIN]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.saveTagPinToLocal(t,e)},o[n.events.CRITERIA_UNPIN]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.clearTagPinInLocal(t,e,this._simplifiedTagger)},o[n.events.CRITERIA_EXCLUDE]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.excludeTag(t)},o[n.events.CRITERIA_UNEXCLUDE]=function(e){e=e.replace("atv","");var t=this.getIdFromDOMId(e);this.observedNavImpl.undoExcludeTag(t)},o[n.events.UPDATE_ACTIVECRITERIA]=function(e){this.setActiveCriteria(!0,!0),!1!==e&&this.redraw()},o[n.events.STATUS_UPDATE]=function(e){(e&&"grouping"===e.action||"selection"===e.action)&&this.setActiveCriteria(!0,!0,void 0,!0).then(function(){r.redrawActiveCriteria(!0),m.isMasked(r.taggerRoot)&&m.unmask(r.taggerRoot)})},o[n.events.GROUPING_REMOVED]=function(e){A.log("GROUPING_REMOVED event received for "+e.text+", predicate="+e.predicate),this.actionManager.startAction({action:U.ACTION_GROUP,isInteractive:!1,grouping:e})},o[n.events.REQUEST_GROUPING_CHANGE]=function(e){A.log("REQUEST_GROUPING_CHANGE event received for "+e.predicate);var t=[];this.tabView&&"tags"===this.tabView.selectedTab.getName()&&t.push(this.redrawTags()),this.hasEmbeddedView()&&t.push(this.observedNavImpl.getFocusedProxy().redrawEmbeddedView()),i.all(t).then(function(){this.observedNavImpl.getFocusedProxy().requestEmbeddedViewGroupingChange(e.data)}.bind(this))},o[n.events.COLORIZE]=function(e){let t=e.split("/").pop();this.getObservedNavigator().getCache().colorManager._clearTempTreeMap();let i=this.taggerUWAElement.getElement("li.predicate[predicate='"+t+"']");if(i){let e=i.id;this.redrawPredicate(e,!1,!1,!0)}},o[n.events.SET_MESSAGE_ON_VIEW]=function(e){this.showNewMessageOnView(e)},o[n.events.UPDATE_ADDITIONAL_CRITERIA]=function(e){this.updateAdditionalCriteria(e)},o[n.events.SET_ADD_FILTER_PROPERTIES]=function(e){this.setAdditionalFilterProperties(e)},this.observedNavImpl=t.tnManagerImpl,n.events)this.observedNavImpl.addEvent(s,o[s],this);this.observedNavImpl.setAsCurrent(),this.taggerRoot=e.createElement("div",{id:"tagnavigator",class:this.isW?"isw":"no-w","data-rec-id":"tagnavigator"}),this.taggerUWAElement.addContent(this.taggerRoot),v.addEvent("notify",function(e){if(this.taggerRoot&&(this.myNotificationControl=new f({closable:!0,visible:!0,maximumVisibleMessages:2,autoHide:!0,hideDelay:e.data.hideDelay||8e3,messageClassName:e.data.className||"error"}),this.myNotificationControl.add(e.message),this._simplifiedTagger)){let e=this.container.getElement(".withSimplified");this.myNotificationControl.inject(e,"before")}}.bind(this)),this._viewInitializationPromise=new i(function(e){p.retrieveTaggerPreferences().then(function(){p.getUserId().then(function(t){A.log("User Id:"+t),r._simplifiedTagger=p.getPreference("simplified"),r._simplifiedTagger?(r.observedNavImpl&&r.observedNavImpl.getCache().set6WSort("sort-weight"),A.log("Initializing Simplified TaggerView"),M.setAsSimplified(),r.initSimplifiedTaggerView(e)):(A.log("Initializing Legacy TaggerView"),r.initLegacyTaggerView(),e())})})})},initLegacyTaggerView:function(){this.storage.set("simplifiedTagger",!1),this.tagnavigator.hasEvent("onClose")&&this.taggerRoot.setHTML("<span class='tagger-close fonticon fonticon-cancel' data-rec-id='tagger-close'></span>"),this.taggerActiveCriteria=e.createElement("div",{id:"active-tags",class:"active-tags section "+(this.observedNavImpl.getCache().isSectionCollapsed("activeFilters")?"":"expanded-section"),"data-rec-id":"active-tags",styles:{display:!1!==((this.observedNavImpl.hasActiveTags()||this.observedNavImpl.hasLocalActiveTags())&&!this.observedNavImpl.hasProxiesInEdition())?"block":"none"}}),this.taggerHeader=e.createElement("div",{id:"header-container",class:"allw"}),this.taggerRoot.addContent([this.taggerActiveCriteria,this.taggerHeader]),this.tagsContainer=e.createElement("div",{style:{height:H},id:"all-tags-container","data-rec-id":"all-tags-container",tabindex:0}),this.tagsContainer.grab(e.createElement("div",{id:"all-tags"}).grab(e.createElement("div",{id:"tags-var-height"}))),this.criteriaContainer=e.createElement("div",{style:{height:J},id:"all-criteria-container"}),this.globalSearchInput=e.createElement("div",{id:"filter-all",class:"add-tag-cont search-cont",styles:{overflow:"hidden",height:"0px"},html:"<span class='add-tag-close'><span class='fonticon fonticon-cancel-circled'></span></span><input id='taginput' class='tagger-input searchbox' title='"+g.getText("searchTag")+"' placeholder='"+g.getText("searchTag")+"'/>"}),this.criteriaContainer.setContent("<div id='all-criteria'></div>"),this.searchButton=new C({value:g.getText("search"),className:"primary search-button"}),this.searchButton.disable(),H=600,J=600;var t=this;this.createHeaderElemNoW(),this.taggerHeader.innerHTML=this.tnHeaderToHtml(),this.menu6wContainer.inject(this.taggerHeader.getElement(".tn-header-title")),this.menu6wIcon.inject(this.taggerHeader.getElement(".tn-header-title span.badgeContainer")),this.menu6wBadge.inject(this.taggerHeader.getElement(".tn-header-title span.badgeContainer"));var i=this.taggerHeader.getElement(".sort-6w");this.menuSort6WIcon.inject(i,"bottom"),new x({position:"bottom",target:i,body:g.getText("sort6w"),className:"sort6w-tooltip"});var a=this.taggerHeader.getElement(".tagger-filter");new x({position:"bottom",target:a,body:g.getText("searchTag"),className:"tagger-filter-tooltip"}),this.taggerHeader.getElement(".activate-simplified")&&new x({position:"bottom",target:this.taggerHeader.getElement(".activate-simplified"),body:g.getText("activate-simplified"),className:"tagger-filter-tooltip"}),new x({position:"bottom",target:this.taggerRoot.getElement(".tagger-close"),body:g.getText("closeTagger"),className:"tagger-close-tooltip"}),O.getOption("simplifiedTagger")&&!O.getOption("WebInWin")&&(i.setStyle("right","92px"),a.setStyle("right","57px")),this.tabView=new _({tabs:[new _.Tab({id:"tags-tab",name:"tags",text:"6WTags"}),new _.Tab({id:"criteria-tab",name:"criteria",text:g.getText("suggestedTags")})],events:{onSelectTab:function(e,i,a){t.tabView&&(t.taggerHeader.getElement(".tagnavheader").toggleClassName("criteria","criteria"===e.options.name),"criteria"===e.getName()?t.displayCriteria():"tags"===e.getName()&&t.displayTags(),t.observedNavImpl&&t.observedNavImpl.getCache()&&(t.observedNavImpl.getCache().selectedTab=e.getName()),t.redraw())}}}).inject(this.taggerRoot),this.observedNavImpl.activeCriteriaProxy&&this.observedNavImpl.activeSearchProxy||this.observedNavImpl.createActiveCriteria(),this.tabView.getTab("tags").setContent(this.tagsContainer),this.tabView.getTab("criteria").setContent(this.criteriaContainer),this.globalSearchInput.inject(this.tabView.elements.contentNode.getElement("#tags-tab"),"top"),this.taggerScroller||(this.taggerScroller=new P({element:this.tagsContainer.getElement("#all-tags")}).inject(this.tagsContainer)),this.criteriaScroller||(this.criteriaScroller=new P({element:this.criteriaContainer}).inject(this.taggerRoot.getElement("#criteria-tab"))),window.addEventListener&&window.addEventListener("resize",this.updateScroller.bind(this)),this.tagsContainer.grab(e.createElement("div",{id:"tagger-footer"})),this.criteriaContainer.grab(e.createElement("div",{id:"criteria-footer"})),this.criteriaContainer.getElement("#criteria-footer").innerHTML+="<hr/><div id='criteria-toggle-container'></div><div id='search-button-container'></div>",this.redraw()},redrawActiveCriteriaForGrouping:function(){let e={groups:{allGroupings:[],localGroupings:[]}};if(this.observedNavImpl.hasGroupingSupport()){let t=this.observedNavImpl.getGroupings();UWA.clone(t);e.groups=t}this.activeCriteriaView.updateCriteria(e)},canBeMaximized:function(){let e=O.getOption("allowedMaximizeTaggerApps"),t=O.getOption("addinmode");return-1!==e.indexOf(n._brand)&&!t},manageMaximizeCapability:function(e){if(this.canBeMaximized()&&!O.getOption("maximizedAdvancedSearch")){require(["DS/TopFrame/TopFrame"],function(t){e?this.container.addClassName("panelManagerMaximizable"):this.container.removeClassName("panelManagerMaximizable");try{t._frame.activateLeftPanelActions(t._frame)}catch(e){A.error("Issue during TaggerView#manageMaximizeCapability")}}.bind(this))}},initSimplifiedTaggerView:function(t){this.storage.set("simplifiedTagger",!0);var i=this;require(["DS/TagNavigator/simplified/views/TaggerTopBar","DS/TagNavigator/CacheManager","DS/TagNavigator/simplified/views/PreferredContentView","DS/TagNavigator/simplified/views/AllContentView","DS/TagNavigator/simplified/views/ShowResultsView","DS/TagNavigator/simplified/utils/PersonUtils","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/TagNavigator/simplified/utils/LocationUtils","DS/TagNavigator/simplified/actions/ActionsManager","DS/TagNavigator/simplified/views/UserTagsSimplifiedView","DS/TagNavigator/TagWidget/TagWidgetUtils","DS/TagNavigator/maximizedTagger/MaximizedView"],function(a,s,o,c,d,h,u,p,f,v,T,w){window.ds&&"3DSwym"==window.ds.env&&O.setOption("searchOnUserType",!1);let b=n._brand;T.init({brand:b}),this.contextMenu=new j,this.PersonUtils=h.init();try{u.init(),p.init()}catch(e){console.log("Utils already initialized")}r.ensureDefaultPredicates(),this.getRootWs().forEach(function(e){r.getPredicate(e).setDisplayName(g.getText("user-tags"))}),this.cacheForSimplified=new s({storage:this.storage}),this.taggerRoot.removeClassName("isw"),this.taggerRoot.addClassName("simplified");this.getActiveRootW().length>1||this.getActiveRootW()[0].replace("ds6w:","");this._topBar=new a({taggerView:this}).render().inject(this.taggerRoot),this._topBar.addEvent("onTopBarSearch",this.onTopBarSearch.bind(this)),this._topBar.addEvent("updateShowMoreTags",this.informShowMoreUpdate.bind(this)),this._topBar.addEvent("keyup_searchField",this.onRefineLaunch.bind(this)),this._topBar.addEvent("onRootWSelection",this.onRootWSelection.bind(this)),this.warningInfoView=(new G).render().inject(this.taggerRoot),this.warningInfoView.addEvent("warningLinkClick",function(){this.observedNavImpl.infoMessageCB()}.bind(this)),this.activeEditTagsCont=e.createElement("div",{id:"active-edit-cont",class:"simplifiedActiveCriteria"}),this.taggerActiveCriteria=e.createElement("div",{id:"active-tags-cont",class:"simplifiedActiveCriteria"}).inject(this.activeEditTagsCont).hide(),this.simpleActiveCriteria=e.createElement("div",{id:"active-tags",class:"simplifiedActiveCriteria","data-rec-id":"active-tags"}).inject(this.taggerActiveCriteria),this.advancedActiveCriteria=e.createElement("div",{id:"advanced-active-tags"}).inject(this.taggerActiveCriteria).hide(),this.activeCriteriaView=new z({sections:[{id:"section-additionalFilters"},{id:"section-filters",isDisabled:!1,canBePinned:!1,canBeExcluded:this.observedNavImpl.hasExcludeSupport()}],scroll:!1,tenantId:this.observedNavImpl.getCurrentTenantId()}).render().inject(this.activeEditTagsCont),this.activeCriteriaView.addEvent("onAdditionalCriteriaChange",function(e){this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().onAdditionalFilterChange(e)}.bind(this)),this.activeCriteriaView.addEvent("onCriteriaChange",function(e){if(e)if(e.groups){let t=e.groups;this.observedNavImpl.setGroupedByStatus(t,!0),function(){var t=r.getPredicate(e.removedGroupings.predicate),i=t.get6WRootFather();if(this.isMaximized)this.maximizeTaggerView.updatePredicateForGrouping({action:"update",rootW:i,predicate:t.id(),groupingInfo:e.removedGroupings});else{var a=this.container.getElement("li.predicate[predicate='"+t.id()+"']");if(a||"type_categorization"==t.id()&&(a=this.container.getElement("li.predicate[predicate='ds6w:type']")),a)if(e.removedGroupings.isPredicate){var n=a.getElement(".predicate-header");n.removeClassName("grouped-by"),n.getElement(".action-icon").remove()}else{var s=a.getElement(".predicate-content .tag[title='"+e.removedGroupings.text+"']");if(s)s.removeClassName("grouped-by");else{var o=a.getElements(".predicate-content .people-view-container .people-view.grouped-by");o?o.forEach(function(t,i){t.getElement(".people-filter").getAttribute("title")==e.removedGroupings.text&&(t.removeClassName("picked"),t.removeClassName("grouped-by"),t.getElement(".people-template").removeClassName("people-selected"))}):A.log("FAILED to locate the tag element in the DOM")}}else A.log("FAILED to locate the predicate element in the DOM")}}.bind(this)()}else if(e.event){void 0===e.excluded&&delete e.excluded;let i=JSON.stringify(e),a=this.getDOMId(i);if("pinTag"===e.event)delete e.event,this.observedNavImpl.saveTagPinToLocal(i,a);else if("unpinTag"===e.event){delete e.event;var t=this.getIdFromDOMId(a);this.observedNavImpl.clearTagPinInLocal(t,a,!0)}}else if(e.isAdvProxy)e.filter.localfilters&&(this.observedNavImpl.getFocusedProxy().setFilters(e.filter.localfilters),this.observedNavImpl.updateCriteriaBasedOnFilters(e.filter.localfilters),this.observedNavImpl.onRefine());else{let i=JSON.stringify(e),a=this.getDOMId(i);t=this.getIdFromDOMId(a);if(this.observedNavImpl.hasExcludeSupport()&&("boolean"==typeof e.excluded||e.condition&&"boolean"==typeof e.condition.excluded)){let i=e.excluded;i?this.observedNavImpl.isExcluded(JSON.stringify(e))?(this.observedNavImpl.clearTagPinInLocal(t,a,!0),this.observedNavImpl.toggleTagSelection(e,null)):this.observedNavImpl.excludeTag(e,i):this.observedNavImpl.undoExcludeTag(e,i)}else if(delete e.excluded,this.observedNavImpl.getFocusedProxy()||this.observedNavImpl.dispatchEvent("onBeforeGlobalFilterChange"),e.predicate.contains("sixw:")){let t=e.predicate.replace("sixw:",""),i=t.split("/")[0],a=t.replace(i+"/",""),n=r.getPredicate(a);this.observedNavImpl.removeFreeInputs([{predicate:n,type:e.type,value:e.object}],!0)}else this.observedNavImpl.clearTagPinInLocal(t,a,!0),this.observedNavImpl.toggleTagSelection(e,null)}else this.clearActiveTags()}.bind(this)),this.activeCriteriaView.addEvent("editActionStart",function(){this.actionManager.startAction({action:U.ACTION_EDITTAGREL,isInteractive:!0,selection:[],taggerView:function(){return taggerView}})}.bind(this)),this.activeCriteriaView.addEvent("editActionCancel",function(){this.actionManager.cancelAction()}.bind(this)),this.activeCriteriaView.addEvent("editActionLaunch",function(){this.actionManager.launchAction()}.bind(this)),this.activeCriteriaView.addEvent("enableApply",function(){this.actionManager.enablePrimaryButton()}.bind(this));var y=this.sectionHeaderToHtml("createTags");this.editArea=e.createElement("div",{id:"edit-area-container",class:"allw",html:'<div id="edit-tags" data-rec-id="edit-tags"><div class="edit-section simplified-section '+(this.observedNavImpl.getCache().isSectionCollapsed("createTag")?'">':' expanded-section">')+'<div class="edit-tags-title">Add/Remove Tags</div>'+y+"</div></div>"}).inject(this.activeEditTagsCont),this.userTagsView=new v({taggerView:this}).render().inject(this.editArea.getElement(".edit-section")),this.scrollerContainerDiv=e.createElement("div",{class:"simplified scroll-div"}).inject(this.taggerRoot),this.scrollerContainerDiv.addContent([this.activeEditTagsCont]),this.tabView=new _({tabs:[new _.Tab({id:"tags-tab",name:"tags",text:"6WTags"}),new _.Tab({id:"criteria-tab",name:"criteria",text:g.getText("suggestedTags")})],className:"withSimplified",events:{onSelectTab:function(e,t,a){i.tabView&&(i._topBar.getElement("#filter-tags").toggleClassName("disabled","criteria"===e.options.name),i._topBar.getElement(".tagger-topbar-actions").toggleClassName("hidden"),i._topBar.getElement("#filter-tags").hasClassName("disabled")?(i._topBar.getElement("input").disabled=!0,i._topBar.getElement("#filter-tags").toggleClassName("add-opacity",!0)):(i._topBar.getElement("input").disabled=!1,i._topBar.getElement("#filter-tags").toggleClassName("add-opacity",!1)),"criteria"===e.getName()?(i.displayCriteria(),i._manageEmbeddedViewVisibility(!1),i.actionManager&&i.actionManager.initActionsView().container.hide(),i.taggerRoot.getElement("#criteria-footer-wrapper").show(),i.manageMaximizeCapability(!1)):"tags"===e.getName()&&(i.displayTags(),i._topBar.getElement(".tn-action-toolbar").removeClassName("hiddenToolbar"),i.actionManager&&i.actionManager.initActionsView().container.show(),i.taggerRoot.getElement("#criteria-footer-wrapper").hide(),i.manageMaximizeCapability(!0)),i.observedNavImpl&&i.observedNavImpl.getCache()&&(i.observedNavImpl.getCache().selectedTab=e.getName()),i.redraw())}}}).inject(this.scrollerContainerDiv),this.tagsContainer=e.createElement("div",{style:{height:H},id:"all-tags-container","data-rec-id":"all-tags-container",tabindex:0}),this.tabView.getTab("tags").setContent(this.tagsContainer),this.criteriaContainer=e.createElement("div",{style:{height:J},id:"all-criteria-container"}),this.criteriaContainer.setContent("<div id='all-criteria'></div>"),this.tabView.getTab("criteria").setContent(this.criteriaContainer),this.searchButton=new C({value:g.getText("search"),className:"primary search-button"}),this.searchButton.disable(),this.simplifiedTaggerRoot=e.createElement("div",{id:"simplified-tagger-root",class:"tagger-root"}),this.taggerContentContainer=e.createElement("div",{id:"tag-content",class:"tagger-content-container"}),this.rootWContainer=e.createElement("div",{class:"roots-w-container"});e.createElement("div",{});this.taggerContentContainer.grab(this.rootWContainer),this.tagContainer=e.createElement("div",{class:"tags-container"}),this.preferredView=new o({taggerView:this}).render(),this.preferredView.inject(this.tagContainer).hide(),this.addAllContentView(!1,c),this.wrapperContainer=e.createElement("div",{class:"wrapper"}),this.wrapperContainer.grab(this.tagContainer),this.taggerContentContainer.grab(this.wrapperContainer),this.simplifiedTaggerRoot.grab(this.taggerContentContainer),this.tagsContainer.addContent(this.simplifiedTaggerRoot),this.taggerScroller=new P({element:this.scrollerContainerDiv}).inject(this.taggerRoot);let S=0;this.scrollerContainerDiv.getElement(".no-native-scrollbars")&&this.scrollerContainerDiv.getElement(".no-native-scrollbars").addEvent("scroll",function(){var e=this.taggerScroller._infos.y.scrollPosition;S>=e?this.warningInfoView.container.addClassName("showWarning"):this.warningInfoView.container.removeClassName("showWarning"),S=e}.bind(this)),O.getOption("WebInWin")?this.taggerRoot.addClassName("tagger-webInwin"):(this.showResultsView=(new d).render().inject(this.taggerRoot,"bottom"),this.showResultsView.addEvent("showResultClick",this.closeTagger.bind(this))),this.actionManager=f.init({taggerView:this}),this.actionManager.initActionsView().inject(this.taggerRoot,"bottom"),e.createElement("div",{id:"criteria-footer-wrapper"}).inject(this.taggerRoot,"bottom").hide(),e.createElement("div",{id:"criteria-footer"}).inject(this.taggerRoot.getElement("#criteria-footer-wrapper")),this.taggerRoot.getElement("#criteria-footer").innerHTML+="<div id='criteria-toggle-container'></div><div id='search-button-container'></div>",window.addEventListener("resize",this.updateShowResults.bind(this)),this.resizeObserver=new ResizeObserver(e=>{let t=this.container.getClosest(".column.left");t&&(t.hasClassName("maximized")||t.hasClassName("fitted"))?this.isMaximized=!0:this.isMaximized=!1,this.isMaximized?(this.maximizeTaggerView||(this.maximizeTaggerView=new w({navImpl:this.getObservedNavigator(),taggerView:this}).render().inject(this.showResultsView.container,"before")),this.maximizeTaggerView.container.setStyle("display","block"),this.maximizeTaggerView.restoreOriginalView(),i.taggerScroller&&i.taggerScroller.destroy(),i.taggerScroller=null,this.scrollerContainerDiv.style.overflow="initial",this.isMaximized=!0):(this.taggerScroller||(this.taggerScroller=new P({element:this.scrollerContainerDiv}).inject(i.warningInfoView.container,"after")),this.isMaximized=!1,this.tabView.elements.container.setStyle("display","block"));var a=[],n=!1,s="";this.searchedString?(a=this.getRootWs(),n=!0,s=this.searchedString):a=this._simplifiedSelectedRootWs,this.redrawSimplifiedTags({redrawActiveCriteria:!1,redrawAllView:!0,onSearch:n,searchString:s,redrawEditTagsArea:!1,actionCancel:!0},a).then(function(){m.isMasked(i.taggerRoot)&&m.unmask(i.taggerRoot),i.isMaximized||a.forEach(function(e){l.redrawUiElements(void 0,e)}),i.isMaximized})}),this.resizeObserver.observe(this.container),O.getOption("viewPromiseDelay")?setTimeout(function(){t()},O.getOption("viewPromiseDelay")):t()}.bind(this)),this.addAllContentView=function(e,t){this.allContentView||(this.allContentView=new t({taggerView:this}).render(),this.allViewHeaderVisibility(e),this.allContentView.collapse(),this.allContentView.inject(this.tagContainer),this.allContentView.allTagsExp.getContent().addEventListener("expand",this.onSectionExpand.bind(this)),this.allContentView.allTagsExp.getContent().addEventListener("collapse",this.onSectionCollapse.bind(this)))}},domEvents:{"click .tagger-filter":"toggleSearchInput","click .section-header":"toggleSection","click .parameter":"onToggleParamTagSelection","click .attribute":"onFreeInputDeletion","click .withSimplified .tag-delete":"onTagDeletion","click .more":"moreClicked","click .withSimplified .tree":"toggleTagExpand","click #all-tags .tag":"triggerToggleTagSelection","contextmenu #simplified-tagger-root #all-tags .tag":"openTagContextMenu","click .fonticon-menu-dot":"toggleToolBoxVisibility","click .tool-icon.sort":"changeSort","click .toolboxView":"changeView","click #all-tags .predicate-header":"clickedPredicateEvent","click .add-tag-close":"clearInput","click #taggerSearchIcon":"fetchTagsOnDemand","input .tagger-input":"addOrRemoveClear","click .tagger-close":"closeTagger","click .criteria-toggle":"toggleCriteriaExpand","click .show-all-toggle":"toggleMore","click .search-button":"onSearchLaunch","keyup #all-tags-container":"onRefineLaunch","keydown #tagnavigator":"toggleIsW","click .parameters-toggle":"toggleParametersExpand","click .add-tag-magnifier-param":"clickParameterMagnifier","keydown #parameter-input-field":"clickParameterMagnifier","click .activate-simplified":"activateSimplifiedTagger","click .withSimplified #typePredicateViewToggle":"onTypePredicateViewToggle","dragstart li.predicate":"onDrag"},showNewMessageOnView:function(e){this.warningInfoView.setMessageText(e)},setAdditionalFilterProperties:function(e){let t=e.properties;this.activeCriteriaView.setAdditionalFilterProperties(t)},updateAdditionalCriteria:function(e){let t=e&&e.filters||[];this.activeCriteriaView.updateAdditionalCriteria(t),t.length&&this.activeCriteriaView.container.show()},launchAddRemoveCompanyTags:function(){let e,t={},i=this.observedNavImpl.getProxiesInEdition();if(i.length){var a=(e=i[0]).getFocusedSubjectsData();t={subjects:a=k.checkForCommunityTags(a,e),rootWs:e.getAllowedRootWForTagging(),freeInput:!0,showVocabularySuggestions:e.showVocabularySuggestions(),showOntologySuggestions:e.showOntologySuggestions(),showCommunitySuggestions:e.showCommunitySuggestions(),showSubjectContent:!0};let n=k.getPlatformId(e);t.platformId=n,t.explicitSuggestions=e.getExplicitTagSuggestions(),this.companyTagsAdvocacyView=new L(t),this.companyTagsAdvocacyView.render(),this.companyTagsAdvocacyView.show()}},cleanUserTagsModal:function(){this.companyTagsAdvocacyView&&(this.companyTagsAdvocacyView.destroy(),delete this.companyTagsAdvocacyView)},onDrag:function(e){let t=e.target;e.dataTransfer.setData("data",t.getAttribute("data-data"))},fetchTagsOnDemand:function(e){this.setSpinner(),this.observedNavImpl.dispatchTagsOnDemandToProxies("search")},checkForSearchTagsOnDemandSupport(){let e=this._topBar.searchField;(this.observedNavImpl.getProxiesSupportingSearchLoadMoreTags().length||this.observedNavImpl.getProxiesHavingLoadMoreTagsPending().length)&&e.value&&e.value.length>1?(e.getClosest(".add-tag-cont").addClassName("addSearchInTagger"),this._topBar.searchIcon.addClassName("enabled")):(e.getClosest(".add-tag-cont").removeClassName("addSearchInTagger"),this._topBar.searchIcon.removeClassName("enabled"))},activateSimplifiedTagger:function(){p.setPreference({name:"simplified",value:!0,onComplete:function(){O.getOption("WebInWin")||location.reload()},onFailure:function(){A.warn("FAILED to activate the 6WTagger Beta")}})},getRootWs:function(){return O.getOption("simplifiedRootW")},onSectionExpand:function(e){if(!this.preferredView.isEmpty()&&this.observedNavImpl.getProxiesHavingLoadMoreTagsPending().length)this.setPartialSpinner(this.allContentView.container,!0),this.observedNavImpl.dispatchTagsOnDemandToProxies("expander");else{var t=this.observedNavImpl.getFocusedProxy();t?t.showAllBool=!0:this.observedNavImpl.setInteractiveMoreTagsSectionStatus(!0),this.isMaximized&&this.toggleMaximizedMoreTags({toShow:!0})}e&&e.isTrusted&&R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"MoreTags",persDim:{pd1:"expand"}}})},onSectionCollapse:function(e){var t=this.observedNavImpl.getFocusedProxy();t?t.showAllBool=!1:this.observedNavImpl.setInteractiveMoreTagsSectionStatus(!1),this.isMaximized&&this.toggleMaximizedMoreTags({toShow:!1}),e&&e.isTrusted&&R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"MoreTags",persDim:{pd1:"collapse"}}})},toggleMaximizedMoreTags:function(e){if(this.maximizeTaggerView){var t={searchString:this.searchString,selectedRootWs:this._simplifiedSelectedRootWs,toShow:e.toShow,isInteractive:this.interactiveShowMoreToggle};this.maximizeTaggerView.toggleShowMore(t)}},addOpacity:function(){this._topBar.addOpacity(),M.addOpacity(),this.editArea.addClassName("add-opacity"),this.tagContainer.addClassName("add-opacity")},addOpactiyToolbar:function(){this._topBar.getElement(".tn-action-toolbar .wux-controls-toolbar-farContainer").addClassName("add-opacity"),this._topBar.addOpacity(),M.addOpacity(),this.editArea.addClassName("add-opacity")},removeOpacity:function(){this.container.getElements(".add-opacity").forEach(function(e){e.removeClassName("add-opacity")}),this.scrollerContainerDiv.removeClassName("set-height")},actionCancel:function(){var e=this.actionManager?this.actionManager.getCurrentAction():void 0;if(e&&e.id==U.ACTION_EDITTAGREL){this.activeCriteriaView.editCriteria(!0);let e=this.activeCriteriaView.getOldFilters();e.filter.localfilters&&this.observedNavImpl.getFocusedProxy().setFilters(e.filter.localfilters);var t=this.observedNavImpl.getCache();if(t&&"criteria"===t.selectedTab)return this.displayCriteria(),void this.redrawCriteria.bind(this)}var i=this;this.redrawSimplifiedTags({redrawActiveCriteria:!1,redrawAllView:!0,actionCancel:!0,redrawEditTagsArea:!0},this._simplifiedSelectedRootWs).then(function(){i._simplifiedSelectedRootWs.forEach(function(e){l.redrawUiElements(void 0,e)})}),this.removeOpacity()},onRootWSelection:function(e){if(UWA.is(e,"string")){var t=this;this.storage.set("activeSimplifiedW",this._simplifiedSelectedRootWs),this.getObservedNavigator().getCache().setActiveW("allw"),t.redrawSimplifiedTags({redrawActiveCriteria:!1,redrawAllView:!0,onRootWSelection:!0,redrawEditTagsArea:!0},this._simplifiedSelectedRootWs).then(function(){t._simplifiedSelectedRootWs.forEach(function(e){l.redrawUiElements(void 0,e)})})}},onAllWViewDeactivation:function(){this._enabledAllwMode=!this._enabledAllwMode&&this._enabledAllwMode},informShowMoreUpdate:function(e){e?this.onSectionExpand():this.onSectionCollapse()},updateShowResults:function(){if(this.showResultsView)if((this.observedNavImpl.hasActiveTags()||this.observedNavImpl.hasLocalActiveTags())&&document.body.clientWidth<640)if(this.showResultsView.show(),this.hasFocusedProxy()){var e=this.observedNavImpl.getFocusedProxy().getResultsCount();"number"==typeof e?this.showResultsView.container.getElement(".show-results").setText(g.getFormattedText("seeResultsWithNumber",{count:g.convertToUnity(e)})):this.showResultsView.container.getElement(".show-results").setText(g.getText("seeResults"))}else this.showResultsView.container.getElement(".show-results").setText(g.getText("seeResults"));else this.showResultsView.hide()},getActiveRootW:function(){var t=this.storage.get("activeSimplifiedW");return(!t||"array"!==e.typeOf(t)||"array"==e.typeOf(t)&&t.length<=0)&&(t=this.getRootWs(),this.storage.set("activeSimplifiedW",t)),t},hasFocusedProxy:function(e){var t=e||this.getObservedNavigator();return t?t.getFocusedProxy():void 0},getContextWidgetTitle:function(){const e=e=>(this.dispatchEvent("CONTEXT_UPDATED",e),e);let t;try{let i,a;if(this.hasFocusedProxy(this.observedNavImpl)){i=this.hasFocusedProxy(this.observedNavImpl)._widgetId,a=this.observedNavImpl.widgetId2widgetTitle(i)}else this.observedNavImpl.getProxiesToDisplay().length>0&&(i=this.observedNavImpl.id(),a=this.observedNavImpl.tabId2tabTitle(i));return e(t=a)}catch(i){return A.log("Error in fetching title from Dashboard"),e(t)}},hasAdvancedFocsuedProxy:function(e,t){var i=e?e.getFocusedProxy():this.hasFocusedProxy();if(i&&t&&i.getAdvancedOption(t))return i},isAdvProxyWOEditRel:function(e,t){let i=t.some(t=>e.getAdvancedOption(t));return e.getAdvancedOption("editTagsRelationships")&&i&&(i=!1),i},allViewHeaderVisibility:function(e){this.allContentView&&this.allContentView.showHideHeader(e)},getCacheSimplified:function(){return this.cacheForSimplified},startSelectAction:function(){return this.actionManager.startAction({action:U.ACTION_SELECT,isInteractive:!1})},onRefineLaunch:function(e){if(A.log("inside onRefineLaunch"),17===e.keyCode)if(A.log("inside onRefineLaunch, event.keyCode === 17"),this._simplifiedTagger){var t=this.actionManager.getCurrentAction();t&&t.id===U.ACTION_SELECT&&!t.get("isInteractive")&&(A.log("launching Select action"),this.actionManager.launchAction({isInteractive:!1}))}else this._onRefineLaunch()},_onRefineLaunch:function(e){if(this._simplifiedTagger&&(this.selectedTags=UWA.clone(e)),this.selectedTags.length){this.setSpinner();for(var t=0;t<this.selectedTags.length;++t){var i=this.selectedTags[t].excluded,a=this.selectedTags[t];UWA.is(a,"object")?(delete a.doNotCount,a.isFreeInput?this.observedNavImpl.createFreeInputs([a]):a.isComplex?this.observedNavImpl.toggleComplexTagSelection(a,!1,i):this.observedNavImpl.toggleTagSelection(a,!1,i)):this.toggleTagSelection(this.selectedTags[t],!1)}this.selectedTags=[],this.observedNavImpl.onRefine()}},moreClicked:function(e){var t=e.target.getClosest(".predicate")||e.target.getClosest(".section.ds6w-root-predicate"),i=this.getIdFromDOMId(t.id).split("/").pop();let a=t.getElements(".picked");this.observedNavImpl.clickOnMoreButton(i),this.redrawPredicate(t.id),a.forEach(e=>{this.taggerUWAElement.getElement("#"+e.id).addClassName("picked")}),R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnViewMore",persDim:{pd1:i}}})},toggleCriteriaExpand:function(e){var t=this.observedNavImpl.getCache();UWA.is(e,"boolean")?t.setMoreClicked(e):(t.setMoreClicked(!t.isMoreClicked()),this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&this.actionManager&&this.actionManager.abortAction()),this.redraw()},toggleTagExpand:function(t){var i,a,n,s=t.target.getClosest(".tag"),o=t.target.getClosest(".tag").id,r=this.observedNavImpl.getCache(),l=this._simplifiedTagger?this.getCacheSimplified():this.observedNavImpl.getCache(),c=t.target.getClosest(".predicate"),d=this.getIdFromDOMId(c.id),g=(d.split("/").pop(),c.getElement(".predicate-content"));(n=!l.isTagTreeExpanded(o))?l.expandTagTree(o):l.collapseTagTree(o);let h=this.actionManager?this.actionManager.getCurrentAction():void 0;if(r.colorManager.isColorized(d)&&(!h||h&&h.id!=U.ACTION_COLORIZE))this.redrawPredicate(c.id);else{if(s.toggleClassName("expanded",n),O.getOption("activate_hierarchical_tag_scroll")){let e=g.getElement(".treeview");if(e&&"1"==s.getAttribute("level"))if(n)e.addClassName("manage-horizontal-scroll");else{g.getElements(".tag.expanded[level='1']").length||e.removeClassName("manage-horizontal-scroll")}}i=s.getParent().getElement(".childrenTags"),a=e.extendElement(i.getChildren()[0]),this.fx(i,n).start({height:n?[0,a.getSize().height]:[a.getSize().height,0]})}return!1},openTagContextMenu:function(e){if(!(this.actionManager?this.actionManager.getCurrentAction():void 0)){let t=e.target.getClosest(".tag"),i=t.getClosest("li.predicate").getAttribute("predicate");if(this.observedNavImpl.hasExcludeSupport(i)){e.preventDefault();this.contextMenu.dropdown&&this.contextMenu.dropdown.destroy();let i=this.getIdFromDOMId(t.id),a=this.observedNavImpl.isExcluded(i),n=O.getOption("dummyContextualMenuItem");console.log("isRemoved: ",n);let s=[];a?s.push({text:g.getText("unexludeTag"),fonticon:"block",id:"include"}):s.push({text:g.getText("excludeTag"),fonticon:"block",id:"exclude"}),n&&s.push({text:"Remove",fonticon:"block",id:"remove"}),this.contextMenu.createDropdown({cont:this.taggerRoot,target:t,view:this,items:s,evtObj:{pageX:e.x,pageY:e.y}}),console.log("in dropdown")}}return!1},excludeTag:function(e,t){let i=this.getIdFromDOMId(t);this.isSelected(i)?e?this.observedNavImpl.excludeTag(i,e):this.observedNavImpl.undoExcludeTag(i,e):this.toggleTagSelection(t,null,e)},triggerToggleTagSelection:function(t){var i,a,n,s;if(this.taggerUWAElement.getElement("#tagnavigator").hasClassName("edition_mode"))return!1;i=t.target.getClosest(".tag");var o=this.actionManager?this.actionManager.getCurrentAction():void 0;if(o){if(o.id==U.ACTION_GROUP)return o.onTagSelection(i);if(o.id==U.ACTION_EXCLUDE||o.id==U.ACTION_SELECTINAPP)return o.onTagSelection(i);if(o.id==U.ACTION_COLORIZE)return!i.hasClassName("more")&&o.onTagSelection(i)}if(t.ctrlKey&&t.altKey)return!1;if(t.ctrlKey||o&&(o.id==U.ACTION_SELECT||o.id==U.ACTION_EDITTAGREL||o.id==U.ACTION_SELECTINAPP))return this._simplifiedTagger?(o||(o=this.startSelectAction()),o.id==U.ACTION_EDITTAGREL?(this.emitClickedTagEvent(i),o.onTagSelection(i),!1):o.onTagSelection(i)):U.onTagMultiSelection(i,this.selectedTags);if(this.observedNavImpl&&!this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.dispatchEvent("onBeforeGlobalFilterChange"),t.altKey&&!o){if(-1!==i.id.indexOf("atv"))return!1;var r=e.extendElement(i.parentElement).getElements("li.selected");for(n=0,s=r.length;n<s;++n)this.toggleTagSelection(r[n].id,!1)}return a=i.id.replace("atv",""),this.toggleTagSelection(a),!1},trackTagClick:function(e){setTimeout(()=>{let t=JSON.parse(e).predicate.split("/"),i={pd1:t[t.length-1],pd2:t[0]};R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnTag",persDim:i}})})},toggleTagSelection:function(e,t,i){var a;(a=this.getIdFromDOMId(e))&&(this.setSpinner(),!1!==t&&(this.selectedTags=[]),this.trackTagClick(a),this.observedNavImpl.toggleTagSelection(a,t,i))},toggleToolBoxVisibility:function(e){var t,i,a,n=this.observedNavImpl.getCache();if(a=(i=e.target).getClosest(".predicate-header")){t=a.getParent().id;let e=this.getIdFromDOMId(t);if(i.getParent().toggleClassName("expanded",!n.isToolboxVisible(t)),n.toggleToolboxVisibility(t),!(this.actionManager?this.actionManager.getCurrentAction()&&this.actionManager.getCurrentAction().id==U.ACTION_COLORIZE:void 0)){let i=!n.isToolboxVisible(t)&&a.getElement(".action-icon.fonticon-palette")&&n.colorManager.isColorized(e);a.getElement(".action-icon.fonticon-palette").toggleClassName("hide",!i),a.getElement(".predicate-label").toggleClassName("adjust-width",i)}}return!1},changeSort:function(e){if(e.ctrlKey)return!1;if(e.target.hasClassName("option-disabled"))return!1;var t=e.target.hasClassName("fonticon-sort-num-desc")||e.target.hasClassName("fonticon-sort-num-asc"),i=e.target.getClosest(".predicate"),a=this.observedNavImpl.getCache(),n=n=this.getIdFromDOMId(i.id);t?a.changeSort("nbSort",n):a.changeSort("alphaSort",n);var s=a.getCurrentSort(n);return R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"TaggerSortChange",persDim:{pd1:i.getAttribute("predicate"),pd2:s.sortMode}}}),i&&this.redrawPredicate(i.id,!0),!1},toggleSection:function(t){var i,a,n,s,o=this.observedNavImpl.getCache(),r=t.target.getClosest(".section")||t.target.getClosest(".simplified-section");if(!t.target.classList.contains("active-tags-close")){if(r){i=r.getElement(".header-title").id,a=r.getElement(".expandable"),n=UWA.is(o.isSectionCollapsed(i),"boolean")?o.isSectionCollapsed(i):!r.hasClassName("expanded-section"),s=e.extendElement(a.getChildren()[0]);var l="createTag"===i?i:void 0;if(this.fx(a,n,l).start({height:n?[0,s.getSize().height]:[s.getSize().height,0]}),n?t.target.getClosest(".section-header").getParent().addClassName("expanded-section"):t.target.getClosest(".section-header").getParent().removeClassName("expanded-section"),o.toggleSection(i),o.isSearchVisible()&&o.getSearchId()==="filter-"+i){if(o.setSearchVisibility(n),!n){var c=a.getParent().getElement("input");this.resetSearch(c,!0)}this.toggleSearchInput(null,!1,!0)}}return!1}},getSearchButton:function(){return this.searchButton},changeView:function(e){if(e.ctrlKey)return!1;var t=e.target;if(t.hasClassName("option-disabled"))return!1;var i=this._simplifiedTagger?this.getCacheSimplified():this.observedNavImpl.getCache(),a=t.getClosest(".predicate"),n=this.getIdFromDOMId(a.id),s=n.split("/").pop(),o=!1,l={channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"TaggerViewChange",persDim:{pd1:s}}};if("colorize"==(o=!(o=!(o=!(o=(o=!(o=t.hasClassName("bar")?"bar":t.hasClassName("pie")?"pie":o)&&t.hasClassName("fonticon-palette")?"colorize":o)||!t.hasClassName("fonticon-th-tag")&&!t.hasClassName("fonticon-list")?o:"tag")&&t.hasClassName("fonticon-text")?"input":o)&&t.hasClassName("fonticon-view-small-thb")?"category":o)&&t.hasClassName("peopleView")?"people":o)){var c=this.observedNavImpl.getCache();l.data.action="colorize",l.data.persDim.pd2=c.colorManager.isColorized(n)?"uncolorize":"colorize"}else l.data.persDim.pd2=o;switch(R.publish(l),o){case"bar":case"pie":return this.handleChartView(o,s,a),!1;case"input":"freeInput"===i.getViewMode(s)?i.setViewMode(s,"tag"):i.setViewMode(s,"freeInput");break;case"tag":"tag"!==i.getViewMode(s)?i.setViewMode(s,"tag"):e.target.hasClassName("fonticon-th-tag")?i.removeCloud(a.id):e.target.hasClassName("fonticon-list")&&i.addCloud(a.id);break;case"colorize":return this.handleColorize(a),!1;case"category":i.setViewMode(s,"category");break;case"people":"people"===i.getViewMode(s)?i.setViewMode(s,"tag"):i.setViewMode(s,"people")}return a&&(this.redrawPredicate(a.id),"input"===o&&"freeInput"===i.getViewMode(s)&&(this._simplifiedTagger&&"date"===r.getPredicate(s).getType()||this.container.getElement("#"+a.id+" input").focus())),!1},ensureColorCusto:function(e){return new i(function(t){var a=F.getColorPromisesForTenants(this.observedNavImpl);i.all(a).then(function(i){e.colorManager.updateAdminColors(UWA.clone(i)),t()})}.bind(this))},handleChartView:function(e,t,i){var a=this.observedNavImpl.getCache();this.ensureColorCusto(a).then(function(){var n=this._simplifiedTagger?this.getCacheSimplified():a;"bar"===e?"graphBar"===n.getViewMode(t)?n.setViewMode(t,"tag"):n.setViewMode(t,"graphBar"):"pie"===e&&("graphPie"===n.getViewMode(t)?n.setViewMode(t,"tag"):n.setViewMode(t,"graphPie")),i&&this.redrawPredicate(i.id)}.bind(this))},handleColorize:function(e){let t=this.actionManager?this.actionManager.getCurrentAction():void 0;if(t&&t.id==U.ACTION_COLORIZE)t.removeSelections(!0);else if(!t){var i=[],a=this.observedNavImpl.getCache(),n=this.getIdFromDOMId(e.id);e.getAttribute("predicate");this.taggerUWAElement.getElement(".predicate.colorize")&&i.push(this.taggerUWAElement.getElement(".predicate.colorize")),a.colorManager.toggleColorize(n),this.ensureColorCusto(a).then(function(){this.taggerUWAElement.getElements(".graph").forEach(function(e){i.push(e.getClosest(".predicate"))}.bind(this)),i.forEach(function(t){t!==e&&this.redrawPredicate(t.id)}.bind(this)),a.colorManager.isColorized(n)||this.observedNavImpl.unColorize(n),e&&this.redrawPredicate(e.id)}.bind(this))}},clickedPredicateEvent:function(e){var t,i=e.target.getClosest(".predicate-header");if(i.getClosest(".active-predicate-list"))return!1;t=i.getParent().id;var a=this.actionManager?this.actionManager.getCurrentAction():void 0;if(a&&a.id==U.ACTION_GROUP&&e.target.hasClassName("pred-label"))return a.onPredicateSelection(e.target).then(function(){},function(){this.togglePredicateExpand(t,i)}.bind(this));if(e.target.hasClassName("action-icon")){if(e.target.hasClassName("fonticon-palette"))a||(this.observedNavImpl.getCache().colorManager.toggleColorize(this.getIdFromDOMId(t)),this.observedNavImpl.unColorize(this.getIdFromDOMId(t)),this.redrawPredicate(t));else if(a)a.onPredicateSelection(e.target);else if(this.actionManager){this.actionManager.startAction({action:U.ACTION_GROUP,isInteractive:!1}).onPredicateSelection(e.target).then(function(){this.actionManager.launchAction({isInteractive:!1})}.bind(this)),R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"RemovePredicateGrouping",persDim:{pd1:this.getIdFromDOMId(t)?this.getIdFromDOMId(t).split("/").pop():"error"}}})}}else e.target.hasClassName("clear-selection")&&a&&a.id==U.ACTION_COLORIZE?a.removeSelections(!0):this.togglePredicateExpand(t,i)},togglePredicateExpand:function(t,i){var a,n,s,o,c,d=this,g=this.observedNavImpl.getCache(),h=r.getPredicate(this.getIdFromDOMId(t).split("/").pop()),u=l.getPredicateView(h),p=!i.getParent().hasClassName("expanded");if(this._simplifiedTagger){var f=h.id(),m={channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"PredicateExpandCollapse",persDim:{pd1:f,pd2:"expanded"}}},v=i.getClosest(".root-border");if(p)g.expandPredicate(f),g.setAsInteractivelyExpanded(f),v&&v.removeClassName("hide-left-border");else m.data.persDim.pd2="collapsed",g.collapsePredicate(f),g.setAsInteractivelyCollapsed(f),1==i.getClosest("ul.predicates").getElements("li.predicate").length&&v&&v.addClassName("hide-left-border");R.publish(m)}else p?g.expandPredicate(t):g.collapsePredicate(t);if(i){for(i.getParent().toggleClassName("expanded",p),s=0,o=(a=i.getParent().getChildren()).length;s<o;++s)(n=e.extendElement(a[s])).match(".predicate-content")&&(c=e.extendElement(n.getChildren()[0]),new e.Fx(n,{duration:300,transition:"quadInOut",events:{onComplete:function(){p?n.setStyles({position:"relative",overflow:"hidden",opacity:1,height:"auto"}):n.setStyles({position:"absolute",opacity:0,height:"auto"}),d.updateScroller()},onStart:function(){n.setStyle("position","relative"),n.setStyle("overflow","hidden")}}}).start({height:p?[0,c.getSize().height]:[c.getSize().height,0]}));var T=this._simplifiedTagger?this.getCacheSimplified():this.observedNavImpl.getCache();p&&-1!==T.getViewMode(h.id()).indexOf("graph")&&this.ensureColorCusto(this.observedNavImpl.getCache()).then(function(){u.updateGraphColors(),u.redrawUiElement()})}},toggleSearchInput:function(e,t,i){var a,n,s,o,r,l=this.observedNavImpl?this.observedNavImpl.getCache():null;return!!l&&(n=function(i){var a=i.getElement("#taginput");null!==a&&(a.value=l.getSearchValue(),this.addOrRemoveClear(a,!1)),this.fx(i,!0).start({height:[0,34]}),(t||e)&&a.focus()}.bind(this),s=function(e){var t=e.getElement("#taginput");t&&(this.fx(e,!1).start({height:[e.getSize().height,0]}),t.blur(),l.getSearchValue()&&!i&&this.resetSearch(t,"filter-all"!==e.id))}.bind(this),r=l.getSearchId(),o=(a=e&&e.target.getClosest(".section")?e.target.getClosest(".section").getElement(".add-tag-cont"):e&&e.target.getClosest("#header-container")?this.globalSearchInput:this.taggerUWAElement.getElement("#"+r)).id,i?l.isSearchVisible()&&a?(n(a),"filter-all"!==a.id&&s(this.globalSearchInput)):s(a):(o!==r&&l.isSearchVisible()||!l.isSearchVisible()?(s(this.taggerUWAElement.getElement("#"+r)),l.setSearchVisibility(!0)):l.setSearchVisibility(!1),l.setSearchId(o),l.isSearchVisible()?n(this.taggerUWAElement.getElement("#"+o)):s(this.taggerUWAElement.getElement("#"+o))),this.taggerRoot.getElement(".tagger-filter").toggleClassName("selected","filter-all"===o&&l.isSearchVisible()),l.isSearchVisible()&&l.isSectionCollapsed(o.replace("filter-",""))||!1)},clearInput:function(e){var t=e.target.getParent(".add-tag-cont").getElement("input");if(t.getClosest(".addClear").removeClassName("addClear"),t){if(t.hasClassName("searchbox"))this.resetSearch(t,"filter-all"!==e.target.getParent(".add-tag-cont").id);else{var i=this.getIdFromDOMId(e.target.getClosest(".predicate").id),a=r.getPredicate(i.split("/").pop());if(a){var n=t.hasClassName("from")?"from":"to",s=l.getPredicateView(a,this),o=a.getType();switch(o){case"integer":case"float":case"double":e.target.value="",s.criterion[o][n].elements.input.value="",s.criterion[o][n].elements.input.triggerEvent("keyup",e);break;case"date":e.target.value="",s.criterion[o][n].elements.input.value="",s.criterion[o][n].events.input.change(e)}}}t.value="",t.focus()}},onTopBarSearch:function(e){if(this.searchInputChanged=!0,this.observedNavImpl){var t=this.observedNavImpl.getCache();t.setSearchVisibility(!0),t.setSearchValue(e.searchText),this.searchedString=e.searchText,this.checkForSearchTagsOnDemandSupport(),this.addOrRemoveClear(this._topBar.searchField,!1),this.searchedString&&""!==this.searchedString||!this.observedNavImpl.getProxiesSupportingSearchLoadMoreTags().length||this.observedNavImpl.dispatchTagsOnDemandToProxies("clear"),this.timerOnSearch&&clearTimeout(this.timerOnSearch),this.timerOnSearch=setTimeout(function(){var t=this._simplifiedSelectedRootWs;e.allWView?(this._topBar.setAllW(),t=this.getRootWs()):this._simplifiedSelectedRootWs.length<6&&this._topBar.resetToOriginalW(this._simplifiedSelectedRootWs),this.redrawSimplifiedTags({onSearch:!0,searchString:this.searchedString,redrawEditTagsArea:!0},t).then(function(){t.forEach(function(e){l.redrawUiElements(void 0,e)})})}.bind(this),200)}},emitClickedTagEvent:function(e){var t=e.id.replace("atv",""),i=this.getIdFromDOMId(t),a=UWA.is(i,"object")?i:JSON.parse(i);this.getTagValueForTag(a)},getTagValueForTag:function(e){var t=this.observedNavImpl.getFocusedProxy();let i,a=e.predicate.split("/").pop(),n=e.dispValue;if(t){var s=t.getEachTagValueForPredicate(a);if(UWA.is(s,"array"))for(var r=0;r<s.length;r++)if(s[r].getDisplayValue()==n){i=s[r];break}i&&!a.includes("computedCountryInfo")||(i=o.getTagValue(e.predicate,e.dispValue,e.object,e.type)),this.updateActiveTagView(i)}},updateActiveTagView:function(e){let t=this.observedNavImpl.getFocusedProxy();if(t){let i;if(e.isFreeInput){let t=e.predicate.id();(i=this.observedNavImpl.isSelectedAttribute(t,e))?this.observedNavImpl.removeFreeInput([{predicate:e.predicate,type:e.type,value:e.value}],!1):this.observedNavImpl.createFreeInputs([{predicate:e.predicate,type:e.type,value:e.value}],!1)}else t.updateSelectedTVLocalFilter("local",e,!1);let a={allfilters:{},localfilters:{}};a.allfilters=this.observedNavImpl.getFilters(null,!0).allfilters,a.localfilters=t.getFilters().localfilters,this.activeCriteriaView.updateCriteria(a)}},addOrRemoveClear:function(e,t){e.target&&(e=e.target),""===e.value?e.getClosest(".add-tag-cont").removeClassName("addClear"):e.getClosest(".add-tag-cont").addClassName("addClear"),UWA.is(t)&&!0!==t||s.checkActiveSearch(this)},displayNoTags:function(t,i){var a=this.tagsContainer.getElement("#all-tags ul");this.tagsContainer.getElement(".no-tags")&&this.taggerUWAElement.getElement(".no-tags").destroy(),this.visibility&&a&&0===a.getSize().height&&e.createElement("div",{html:{text:t?g.getText("noRslt"):i?g.getText("noRelevantTags"):g.getText("noTags"),class:"no-tags"}}).inject(a,"after")},toggleIsW:function(e){(A.log("inside toggleIsW"),e.ctrlKey&&this._simplifiedTagger)&&(A.log("e.ctrlKey && this._simplifiedTagger"),this.actionManager.getCurrentAction()||(A.log("Launching Select action in silent mode"),this.actionManager.startAction({action:U.ACTION_SELECT,isInteractive:!1})));if(e.ctrlKey&&e.altKey&&e.keyCode==="D".charCodeAt(0)&&(window.proxyLogs=!0),e.ctrlKey&&e.keyCode==="Q".charCodeAt(0)&&!this._simplifiedTagger){var t=this.observedNavImpl?this.observedNavImpl.getCache():null;this.isW=!this.isW,e.preventDefault(),this.taggerUWAElement&&(this.isW?(this.taggerUWAElement.getElement("#tagnavigator").addClassName("isw",this.isW),this.taggerUWAElement.getElement("#tagnavigator").removeClassName("no-w",this.isW),this.taggerRoot.getElement("#header-container").className="allw"):(this.taggerUWAElement.getElement("#tagnavigator").addClassName("no-w",!this.isW),this.taggerUWAElement.getElement("#tagnavigator").removeClassName("isw",!this.isW),t&&t.setSearchId("filter-all"),this.updateHeaderForActiveW()),this.storage&&this.storage.set("isW",!0===this.isW?"true":"false"),this.redraw())}},createHeaderElemNoW:function(){var t,i,a,n=0,s="",o=this;this.observedNavImpl.getCache();for(this.menu6wContainer=e.createElement("span",{class:"badgeContainer"}),this.menu6wIcon=e.createElement("span",{class:"fonticon fonticon-down-open"}),this.menu6wBadge=e.createElement("span",{class:"badge badge-primary tn-badge-count tn-badge-rounded hidden"}),this.menu6w=new S({className:"menu-6w",items:[{name:"allw"},{className:"divider"},{name:"who"},{name:"when"},{name:"what"},{name:"where"},{name:"why"},{name:"how"}],position:"bottom right",closeOnClick:!1,target:this.menu6wContainer,renderTo:this.taggerRoot,events:{onClick:function(e,t){o[t.name].dispatchEvent("onChange",e)},onShow:function(){o.menu6wContainer.addClassName("active")},onHide:function(){o.menu6wContainer.removeClassName("active")}}}),n=0,t=this.menu6w.items.length;n<t;++n)1!==n&&(i=this.menu6w.items[n].name,s=g.getText(i)!==i?g.getText(i):i.replace(/^\w/,function(e){return e.toUpperCase()}),a={type:"checkbox",events:{onChange:this.toggleActiveW.bind(this)},className:"primary "+i,value:"allw"===i?g.getText("allw"):s,checked:0===n,label:""},this[i]=new w(a),this[i].inject(this.menu6w.items[n].elements.container),this.menu6w.items[n].elements.container.getElement("label").setContent("<span class='fonticon fonticon-"+("allw"===i?"tag":"3ds-"+i)+"'></span>"+("allw"===i?g.getText("allw"):s)));this.menuSort6WIcon=e.createElement("span",{class:"fonticon fonticon-sort-tag selected",id:"sort-6w-menu"}),this.menuSort6W=new I({title:g.getText("changePredicateSort"),className:"sort-6w-menu",items:[{fonticon:"sorting",name:"sort-weight",description:g.getText("sort_by_weight")},{fonticon:"sort-tag",name:"sort-tag",description:g.getText("sortbyw"),selected:!0},{fonticon:"sort-alpha-asc",name:"sort-alpha-asc",description:g.getText("alphabeticalOrder")},{fonticon:"sort-alpha-desc",name:"sort-alpha-desc",description:g.getText("reverseAlphabeticalOrder")},{fonticon:"sort-num-asc",name:"sort-num-asc",description:g.getText("occurenceOrder")},{fonticon:"sort-num-desc",name:"sort-num-desc",description:g.getText("reverseOccurenceOrder")}],position:"bottom right",target:this.menuSort6WIcon,renderTo:this.taggerRoot,events:{onClick:function(e,t){var i=o.observedNavImpl.getFocusedProxy();i?i.setSortOrder(t.name):o.observedNavImpl.getCache().set6WSort(t.name),o.updateSortPred(t.name),o.redraw()}}})},toggleMore:function(){this.toggleDisplayAll()},toggleDisplayAll:function(t){if(this._simplifiedTagger)A.log("toggleDisplayAll is not handled with new Tagger UX");else{var i,a=this.observedNavImpl.getFocusedProxy();e.is(t)?(this.isW?this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",!t):this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",!t),a.showAllBool=t):(i=!(!a||!a.relevantPredicates.length)&&a.showAllBool,this.isW?this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",i):this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",i),a.showAllBool=!i),this.tagsContainer.getElement(".show-all-toggle").innerHTML=g.getText(a.showAllBool?"showLess":"showAll"),this.isW||this.displayNoTags(!1,!0)}},toggleDisplayAllCriteria:function(e){this.toggleCriteriaExpand(e)},updateSortPred:function(e){if(!this._simplifiedTagger){var t=e||this.observedNavImpl.getCache().get6WSort();this.menuSort6WIcon.className="fonticon selected fonticon-"+("sort-weight"===t?"sorting":t),this.menuSort6W._activeItem.name!==t&&this.menuSort6W.setActiveItem(t)}},manageSortByPreference:function(){var e=!!this.observedNavImpl.hasFocusedProxyWithRelevantPredicate();if(this.menuSort6W){var t=this.menuSort6W.getItem("sort-weight");t&&(e?t.elements.container.removeClassName("hidden"):t.elements.container.addClassName("hidden"))}},_manageEmbeddedViewVisibility:function(e){if(UWA.is(e,"boolean")){var t=this.observedNavImpl.getFocusedProxy();t&&t.supportsEmbeddedView()&&(e?t.showEmbeddedTaggerView():t.hideEmbeddedTaggerView())}},mainTaggerIconClicked:function(){R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"ClickOnTaggerIcon",persDim:{pd1:this.visibility?"Closing":"Opening"}}});var e=this.getObservedNavigator();if(this.taggerIcon){var t=O.getOption("madeForEachOther");this.visibility?"criteria"===this.tabView.selectedTab.getName()?(this.displayTags(),this.redrawTopBarTagIcon(),!t&&this._manageEmbeddedViewVisibility(!1)):e.hasWidgetMaximized()||null===e.getFocusedProxy()?(this.closeTagger(),!t&&this._manageEmbeddedViewVisibility(!0)):(this.closeTagger(),this.redrawTopBarTagIcon(),!t&&this._manageEmbeddedViewVisibility(!0)):(null!==e.getWidgetMaximized()&&"IsNotInWidget"!==e.getWidgetMaximized()&&e.updateFocusedProxy(),this.displayTags(),this.openTagger(),!t&&this._manageEmbeddedViewVisibility(!1))}},closeTagger:function(){this.isMaximized=!1,this.tagnavigator.hasEvent("onClose")&&(this.tagnavigator.dispatchEvent("onClose"),this.toggleVisibility(!1),this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().triggerCallbackOfEvent(11,null),!O.getOption("madeForEachOther")&&this._manageEmbeddedViewVisibility(!0))},openTagger:function(){this.getObservedNavigator();this.tagnavigator.hasEvent("onOpen")&&(this.tagnavigator.dispatchEvent("onOpen"),this.toggleVisibility(!0),this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().triggerCallbackOfEvent(10,null))},setTaggerMode:function(e){this.getObservedNavigator()&&e&&(this.observedNavImpl.getFocusedProxy()&&"criteria"===e?(this.tabView.selectTab("criteria-tab"),this.actionManager&&this.actionManager.initActionsView().container.hide(),this.taggerRoot.getElement("#criteria-footer-wrapper").show()):"tags"===e?(this.tabView.selectTab("tags-tab"),this.actionManager&&this.actionManager.initActionsView().container.show(),this.taggerRoot.getElement("#criteria-footer-wrapper").hide()):A.info("cannot set mode = "+e))},clearActiveTags:function(e){return R.publish({channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"clickTrashEvent",persDim:{pd1:"Click on Trash Icon"}}}),this.observedNavImpl.getFocusedProxy()||this.observedNavImpl.dispatchEvent("onBeforeGlobalFilterChange"),this.setSpinner(),this.observedNavImpl.clearFilters(),this.observedNavImpl.isReadyForDisplay()&&this.redraw(),!1},getObservedNavigator:function(){return this.observedNavImpl},isColorizePossible:function(){return this.observedNavImpl.isColorizePossible()},warnForColorize:function(e){this.observedNavImpl.colorize(e)},toggleVisibility:function(e){this._simplifiedTagger&&e&&O.searchOnType()&&this._topBar&&this._topBar.startEventListening(),this.visibility!==e&&(this.visibility=void 0===e?!this.visibility:e,this.visibility||this.actionManager&&this.actionManager.abortAction(),setTimeout(this.updateScroller.bind(this),500),this.redrawTopBarTagIcon(),this.redraw(),this.observedNavImpl.updateDisplayStatus(this.visibility))},isTagInEdition:function(e){return this.observedNavImpl.isTagInEdition(e)},setSpinner:function(){this.taggerRoot&&(m.mask(this.taggerRoot),this.observedNavImpl&&this.observedNavImpl.dispatchEvent("ON_TAGGERVIEW_MASKED"))},redrawPredicate:function(t,i,a,n){var o,d,g,h,u,p=this._simplifiedTagger?this.getCacheSimplified():this.observedNavImpl.getCache();t&&(g=(d=(o=r.getPredicate(this.getIdFromDOMId(t).split("/").pop())).is6WRoot()?c.getRootPredicateView(o,this):l.getPredicateView(o,this)).toHtml(i,s.isInFavorites(d.id()),-1!==t.indexOf("sug"),"",void 0,n),h=this.taggerUWAElement.getElement("#"+t),u=e.createElement("div").addContent(g).getElement("#"+t).inject(h,"before"),h.destroy(),"tag"!==p.getViewMode(o.id())&&d.redrawUiElement(-1!==t.indexOf("sug")),this._simplifiedTagger?u.show():this.updateScroller())},redrawTopBarTagIcon:function(){var e=this.getObservedNavigator(),t=e.getFocusedProxy(),i=this.observedNavImpl.getFilters(null,!0).allfilters,a=t?e.getFocusedProxy().getFilters(!0).localfilters:void 0,n=0;n+=Object.keys(i).reduce(function(e,t){return e+i[t].length},0),a&&(t.supportsAdvancedFilter()&&UWA.is(a.condition,"array")?n+=a.condition.length:n+=Object.keys(a).reduce(function(e,t){return e+a[t].length},0)),this.taggerIcon?(this.taggerIcon.toggleClassName("tagger-filter",0!==n),this.tabView&&(this.visibility&&"criteria"!==this.tabView.selectedTab.getName()?this.taggerIcon.toggleClassName("tagger-icon-active",!0):this.taggerIcon.toggleClassName("tagger-icon-active",!1))):window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")&&this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":0!==n}])},updateActiveCriteriaAfterNlsComputation:function(e,t,i,a){var s,l,c,d,g,h,u,p=this,f=!!i&&i instanceof D,m={},v={},T=0,C=i||this.observedNavImpl.getFocusedProxy(),w=i?f?i.getTaggerProxy()._navimpl:i._navimpl:this.observedNavImpl;if(g={widgetId:i?i.widgetId():C?w.getWidgetMaximized()||C:null,proxyId:C?C.id():void 0},w.activeCriteriaProxy&&w.activeSearchProxy||w.createActiveCriteria(),w.activeCriteriaProxy&&w.activeSearchProxy){if(e){for(c in h={},s=w.getFilters(null,!0,this._simplifiedTagger,!0).allfilters)(d=r.getPredicate(c.split("/").pop()))&&!h[c]&&(h[c]=d.displayName()),s[c]=s[c].map(function(e){T++;var t={predicate:c,object:e.object,dispValue:e.disptext,type:e.type};if(e.isComposite&&(t.isComposite=!0),this.getDOMId(JSON.stringify(t)),e.disptext!==e.object||"string"!==e.type)return e;var i=o.getTagValue(c,null,e.object,e.type);return e.disptext=i&&i.getDisplayValue()?i.getDisplayValue():e.disptext,e},this);v.allfilters=s;var b=w.getActiveGroupings();if(UWA.is(b,"array")&&(b.length>0||a)){let e=v.allgroupings=[];b.forEach(function(t){let i=t.predicate;(d=r.getPredicate(i.split("/").pop()))&&!h[c]&&(h[c]=d.displayName()),t.predLevel?e.push({dispText:d.displayName(),predicate:d.id(),type:d.getType(),isPredicate:!0}):t.object.forEach(function(t){e.push({dispText:t.dispText,predicate:d.id(),type:t.type})})})}if(C){if(l=C.getFilters(!0,this._simplifiedTagger,!0).localfilters,C.supportsAdvancedFilter()&&UWA.is(l.condition,"array"))l.isAdvanced=!0,l.condition.forEach(function(e){T++;var t=Object.keys(e)[0];(d=r.getPredicate(t.split("/").pop()))&&!h[t]&&(h[t]=d.displayName()),e[t].hasOwnProperty("condition")&&e[t].condition.forEach(function(i){var a={predicate:t,object:i.object,dispValue:i.display,type:i.type};e[t].isComplex&&(a.isComplex=!0),i.isComposite&&(a.isComposite=!0),p.getDOMId(JSON.stringify(a))})});else for(c in l)(d=r.getPredicate(c.split("/").pop()))&&!h[c]&&(h[c]=d.displayName()),l[c]=l[c].map(function(e){T++;var t={predicate:c,object:e.object,dispValue:e.disptext,type:e.type};if(e.isComposite&&(t.isComposite=!0),this.getDOMId(JSON.stringify(t)),e.disptext!==e.object||"string"!==e.type)return e;var i=o.getTagValue(c,null,e.object,e.type);return e.disptext=i&&i.getDisplayValue()?i.getDisplayValue():e.disptext,e},this);v.localfilters=l;b=C.getActiveGroupings();if(UWA.is(b,"array")&&(b.length>0||a)){let e=v.groupings=[];b.forEach(function(t){let i=t.predicate;(d=r.getPredicate(i.split("/").pop()))&&!h[c]&&(h[c]=d.displayName()),t.predLevel?e.push({dispText:d.displayName(),predicate:d.id(),type:d.getType(),isPredicate:!0}):t.object.forEach(function(t){e.push({dispText:t.dispText,predicate:d.id(),type:t.type})})})}}this.taggerIcon?this.taggerIcon.toggleClassName("tagger-filter",0!==T):window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")&&this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":0!==T}]),g.isTagPinned=n.isTagPinned,g.canBeExcluded=function(e){return w.hasExcludeSupport(e)},w.activeCriteriaProxy.getInitPromise().then(function(){g.predicatesNLS=h,w.activeCriteriaProxy.setActiveCriteria(v,g)})}if(t&&!f){if(u={},C&&C.isActive()){if(C.supportsAdvancedFilter())m.isAdvanced=!0,m.search={},C.getFilters(!1).localfilters.condition.forEach(function(e){var t=Object.keys(e)[0];m.search[t]=[],e[t].forEach(function(e){m.search[t].push({type:e.type,object:e.object,displayValue:e.displayValue,isSimplifiedCriteria:e.isSimplifiedCriteria})})});else m.search=C.getFilters(!1).localfilters;C.getParameters()&&(m.plmparam=C.getParameters()._models),Object.keys(m.search).forEach(function(e){var t=e.split("/").slice(-1)[0].replace("sixw:","");u[e]=r.getPredicate(t).displayName()})}w.activeSearchProxy.getInitPromise().then(function(){g.predicatesNLS=u,w.activeSearchProxy.setActiveCriteria(m,g)})}}},updateGroupings:function(){var e=this.hasFocusedProxy();if(e){var t=e.getGroupingConfig();if(t&&!t.disableGroupingUpdate)e.getActiveGroupings().length>0&&(e.supportsEmbeddedView()||this.actionManager.startAction({action:U.ACTION_GROUP,isInteractive:!1,refreshMode:!0}))}},setActiveCriteria:function(e,t,a,n){var s=this;return new i(function(o){i.all(r.getElementsNLS()).then(function(){s.updateActiveCriteriaAfterNlsComputation(e,t,a,n),o()})})},redrawActiveCriteria:function(e){var t,i,a=0,s=this.observedNavImpl.getFocusedProxy();this.observedNavImpl.getWidgetMaximized(),s&&s._id;let o={allfilters:{},localfilters:{}},r={canBeExcluded:this.observedNavImpl.hasExcludeSupport(),canBePinned:!s&&"3DDashboard"===n._brand,isFocused:!!s,isTagPinned:n.isTagPinned,hasEditTagRelations:!1,canDateBeExcluded:!1,focusedSubject:this.observedNavImpl.hasProxiesInEdition(),is3DDashboard:"3DDashboard"===n._brand};if(!this.observedNavImpl.getCurrentTenantId()){let e=this.observedNavImpl.getFocusedProxy()?this.observedNavImpl.getFocusedProxy()._tenant:null;e&&(r.tenantId=e)}this.activeCriteriaView.updateTagOptions(r),this.redrawActiveCriteriaForGrouping();let l=s?s.getAdditonalFilter():[];if(this.updateAdditionalCriteria(l),this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&s.isActive())o.allfilters=this.observedNavImpl.getFilters(null,!0).allfilters,o.localfilters=s?s.getFilters().localfilters:{},r.hasEditTagRelations=!0,r.canDateBeExcluded=!0,r.advancedActiveTags={toShowXOR:O.getOption("toShowXOR"),isAdvancedSearch:!e},this.activeCriteriaView.updateTagOptions(r),this.activeCriteriaView.updateCriteria(o);else{var c=s&&s.hasCusomActiveTags()?s.getActiveTagsOptions():void 0;c&&c.display&&(r.headerTitle=c.sectionName,r.onePerLine=c.display.onePerLine),o.allfilters=this.observedNavImpl.getFilters(null,!0).allfilters;let n=["data_location","type_categorization","person_data"];s&&this.isAdvProxyWOEditRel(s,n)?o.localfilters=s?s.getFilters().localfilters:{}:o.localfilters=s?s.getFilters(!0,!0,!0).localfilters:{},this.activeCriteriaView.updateTagOptions(r);let l=this.filterWithAdditionalProperties(o.allfilters);this.activeCriteriaView.updateCriteria(o,l),this.simpleActiveCriteria&&this.simpleActiveCriteria.isHidden()&&this.simpleActiveCriteria.show(),e||(this._simplifiedTagger&&(n.withoutPredHeader=!0,n.withRootIcon=!0),this.observedNavImpl.activeCriteriaProxy&&this.observedNavImpl.activeSearchProxy||this.observedNavImpl.createActiveCriteria()),(this.taggerIcon||window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon"))&&(t=this.observedNavImpl.getFilters(null,!0).allfilters,a+=Object.keys(t).reduce(function(e,i){return e+t[i].length},0),s&&(i=s.getFilters(!0).localfilters,s.supportsAdvancedFilter()&&UWA.is(i.condition,"array")?a+=i.condition.length:a+=Object.keys(i).reduce(function(e,t){return e+i[t].length},0)),this.taggerIcon?this.taggerIcon.toggleClassName("tagger-filter",0!==a):window.richClient&&this.tagnavigator.hasEvent("changeTaggerIcon")&&this.tagnavigator.dispatchEvent("changeTaggerIcon",[{"tagger-filter":0!==a}]))}this.activeCriteriaView.container.getElement("#section-additionalFilters").isHidden()&&this.activeCriteriaView.container.getElement("#section-filters").isHidden()?this.activeCriteriaView.container.hide():this.activeCriteriaView.container.show()},filterWithAdditionalProperties:function(e){let t=this.observedNavImpl.id(),i=UWA.clone(e);for(const e in i)i[e].forEach(i=>{if("date"===i.type){let a=n.isTagPinned(t,e,i);UWA.is(i.isPinnedActive)&&!1===i.isPinnedActive?(i.pin=!1,UWA.is(i.parent)&&!1===i.parent.isPinnedActive?(i.parent.pin=!1,UWA.is(i.parent.parent)&&!0===i.parent.parent.isPinnedActive&&(i.parent.parent.pin=!0)):UWA.is(i.parent)&&(i.parent.pin=!0,UWA.is(i.parent.parent)&&!0===i.parent.parent.isPinnedActive&&(i.parent.parent.pin=!0))):a&&(i.pin=!0,i.parent&&(i.parent.pin=!0,i.parent.parent&&(i.parent.parent.pin=!0)))}else n.isTagPinned(t,e,i)&&"date"!==i.type&&(i.pin=!0)});return i},getActiveTagsEditView:function(){return this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships").getActiveTagsEditView()},getActiveTagsEditModel:function(){return this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships").getActiveTagsEditModel()},redrawActiveTagsEdit:function(e,t){var i=this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships"),a=i.getLocalFilter().cloneFilter(),n=i._groupings;let s=this.getActiveTagsEditView();this.addEventsOnEditView(),s&&(s.setAdvancedFilter(a,n),s.disableEditView(e),s.isAdvancedCriteria(!t));let o=this.getActiveTagsEditModel();o&&"readOnly"!=o.get("mode")&&o.set("mode","readOnly")},editActionStart:function(){this.toggleActiveTagsMode()},toggleActiveTagsMode:function(){this.removeOpacity(),this.activeCriteriaView.editCriteria()},cancelEditAction:function(e){this.actionCancel()},showTaggerCrietria:function(){this.advancedActiveCriteria.show()},addEventsOnEditView:function(){if(this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")){let e=this.getActiveTagsEditView();this.advancedActiveCriteria.innerHTML="",e.container.inject(this.advancedActiveCriteria),this.taggerActiveCriteria.show(),e&&!e.hasEvent("closeSelectedTags")&&(this.actionManager&&e.setActionsManager(this.actionManager),e.addEvent("closeSelectedTags",this.cancelEditAction.bind(this)),e.addEvent("showTaggerCriteria",this.showTaggerCrietria.bind(this)),e.addEvent("clickOnTrash",this.clearActiveTags.bind(this)),e.addEvent("removeTagFromActive",this._onEditTagsRefine.bind(this)),e.addEvent("removeSelectedElems",this.removeSelectedElems.bind(this)),this.showTaggerCrietria())}},_onEditTagsRefine:function(){let e=this.activeCriteriaView.getModifiedFilters();this.activeCriteriaView.editCriteria(),e.filter.localfilters&&(this.observedNavImpl.getFocusedProxy().setFilters(e.filter.localfilters),this.observedNavImpl.onRefine()),e.group&&this.observedNavImpl.getFocusedProxy().groupBy(e.group),this.activeCriteriaView.resetModifiedFilters()},callUpdateModelOnActiveActions:function(e){this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&this.getActiveTagsEditView().callUpdateModelFromAction(e)},disableType:function(e){let t=this.taggerRoot.getElement(".category-view");"start"==e?t&&t.addClassName("disable-click"):"cancel"!=e&&"launch"!=e||t&&t.removeClassName("disable-click")},removeSelectedElems:function(e){if(e){if(e.tagName&&e.predicate){let t=this.taggerUWAElement.getElement("li.predicate[predicate='"+e.predicate+"']");if(t){t.getElements(".tag-label").forEach(t=>{t.getText()==e.tagName&&(t.getClosest(".tag").hasClassName("selected")||t.getClosest(".tag").hasClassName("picked")?(t.getClosest(".tag").removeClassName("selected"),t.getClosest(".tag").removeClassName("picked")):t.getClosest(".people-selected").removeClassName("people-selected"))})}}}else{let e=this.taggerUWAElement.getElements(".tag.selected");e.forEach(e=>{e.removeClassName("selected")}),(e=this.taggerUWAElement.getElements(".people-selected")).forEach(e=>{e.removeClassName("people-selected")})}},_firstVisibility:!0,forceRedraw:function(){var e=this.hasFocusedProxy();return e&&e.hasActiveGroupings()},setPartialSpinner:function(e,t){if(!e)throw new Error("setPartialSpinner called without component");t?m.mask(e):m.unmask(e)},_redraw:function(){var t=this.observedNavImpl.getCache();if(this.visibility||this.forceRedraw()){this._firstVisibility&&(this._firstVisibility=!1,this._simplifiedTagger&&this.getActiveRootW().length>1&&(this._enabledAllwMode=!0));var a,n,s,l,c=this;this.internalRedrawTimer&&(clearTimeout(this.internalRedrawTimer),this.internalRedrawTimer=null),0===Object.keys(r.getElementsToTranslate()).length&&0===Object.keys(r.getPendingPromisesForElementsToTranslate()).length&&0===Object.keys(o.getTvToTranslate()).length&&0===Object.keys(o.getOntologyTvToTranslate()).length&&0===D.getSubjectsForExplicitTags().length||!1!==this.callServerInProgress||(a=r.getElementsNLS(),n=o.getPredicateValue(),l=o.translateOntologyTagValues(),s=D.getExplicitTags(),this.callServerInProgress=!0,i.all(a.concat(n).concat(s).concat(l)).then(function(e){D.clearProxiesTemp(),c.callServerInProgress=!1,c.redraw()})),this.destroyTagValues(),this.selectedTags=[],t&&"criteria"===t.selectedTab?("criteria"!==this.tabView.selectedTab.getName()&&this.displayCriteria(),this.internalRedrawTimer=setTimeout(this.redrawCriteria.bind(this),50)):("tags"!==this.tabView.selectedTab.getName()&&this.displayTags(),this.internalRedrawTimer=setTimeout(function(){var e=this.redrawTags();e&&this._simplifiedTagger&&(O.getOption("disableGroupingUpdate")||"setTags"===this.redrawTriggeredBy&&(this.redrawTriggeredBy=void 0,e.then(function(){this.updateGroupings()}.bind(this))))}.bind(this),50))}else if(this.isColorizePossible()&&t.colorManager.activePredicate)this.destroyTagValues(),this.buildTagValues(),this.availableTagsToHtml(),this.redrawActiveCriteria(!0);else{var d=document.getElementById("data-filter-panel-ct");d&&UWA.is(d.isHidden,"function")&&!1===d.isHidden()&&e.extendElement(document.body).getElements(".column.left.shown").length>0&&(console.warn("tagger is hidden but filters panel is visible, so forcing the active criteria redraw"),this.redrawActiveCriteria(!0,!0))}},redraw:function(){if(this.allContentView&&this.setPartialSpinner(this.allContentView.container,!1),!this._ignoreRedraw){var e=this;this._viewInitializationPromise.then(function(){e._redraw()},function(){e._redraw()})}},redrawParameters:function(){var t,i,a,n=this,o=this.observedNavImpl.getCache(),r=this.observedNavImpl.getFocusedProxy();if((null!==r&&r.isPLMParameterEnabled()&&(null!==(t=r.getParameters())&&(t.hasEvent("onAdd")||t.addEvent("onAdd",function(e){n.parameterView.render(e)}),t.hasEvent("onRemove")||t.addEvent("onRemove",function(e){s.checkActiveSearch(n)})),this.paramWarning||(this.paramWarning=e.createElement("div",{id:"paramWarning"})),this.parametersText||(this.parametersText=new y({id:"parameter-input-field",placeholder:g.getText("paramAutocomplete")}))),this.parametersText)&&(this.parametersText.remove(),i=this.criteriaContainer.getElement("#parameters-parent-container"),a=this.criteriaContainer.getElement("#parameters-input-container"),e.is(i)&&e.is(a))){this.parametersText.inject(a);e.createElement("span",{class:"add-tag-magnifier-param fonticon fonticon-search"}).inject(a);if(this.parameterView=new u({model:h,container:i,taggerView:n}),null!==r&&null!==(t=r.getParameters())){if(this.criteriaContainer.getElement("#parameter-list")&&o.getCriteriaToResetBeforeFilterChange(r.id())){var l=!1,c=o.getCriteriaToResetBeforeFilterChange(r.id())["ds6w:dataSource"];c&&c.value&&c.value.length>0&&(l=c&&c.value&&c.value.some(function(e){return"3dspace"===e.value})),l?(n.parametersText.enable(),n.parameterView.disabled=!1):(n.parametersText.disable(),n.parameterView.disabled=!0)}t.forEach(function(e){n.parameterView.render(e)})}}},redrawCriteria:function(){if(this.visibility&&this.tabView&&"criteria"===this.tabView.selectedTab.getName()){var e=this,t=function(){m.unmask(this.taggerRoot),this.redrawActiveCriteria(!1),this.taggerRoot.toggleClassName("edition_mode",!1),this.searchButton.remove(),this.criteriaContainer.getElement("#all-criteria").innerHTML=this.getCriteriaToHtml(),this.criteriaContainer.getElement("#search-button-container")?this.searchButton.inject(this.criteriaContainer.getElement("#search-button-container")):this.taggerRoot.getElement("#search-button-container")&&this.searchButton.inject(this.taggerRoot.getElement("#search-button-container")),l.redrawUiElements(!0),this.redrawParameters(),setTimeout(this.updateScroller.bind(this,!0),50)};if(0!==Object.keys(r.getElementsToTranslate()).length||0!==Object.keys(r.getPendingPromisesForElementsToTranslate()).length){A.info("found some predicates to be translated, redraw adv criteria only after nls is retrieved");var a=r.getElementsNLS();i.all(a).then(function(i){A.info("redraw the Criteria as nls is now retrieved"),t.call(e)})}else t.call(this)}},getViewMoreStatus:function(){return this._viewMoreStatus},updateActiveTagsArea:function(){this.redrawActiveCriteria(!0),this.form?this.simplifiedTaggerRoot.addClassName("border-change"):this.simplifiedTaggerRoot.removeClassName("border-change")},buildTagValues:function(e){if(this._simplifiedTagger&&(e?e.excludeHiddenPredicates=!0:e={excludeHiddenPredicates:!0}),this.observedNavImpl){let t=this.observedNavImpl.showCustomCountOnHierarchy();this.observedNavImpl.eachTagValue(function(e,i){return new d(e,this,i,t)}.bind(this),e)}this._simplifiedTagger&&this.PersonUtils.getUsersInfo(this.observedNavImpl,"ds6w:who",function(){this.hasAdvancedFocsuedProxy(void 0,"data_location")&&this.redraw()}.bind(this))},destroyTagValues:function(){for(var e in c.clear(),l.clear(),Y)c.getRootPredicateView(r.getPredicate(e),this)},redrawSimplifiedTags:function(e,t){return new i(function(a){if(this.visibility||this.forceRedraw()){var n=this;if(!this.observedNavImpl.isReadyForDisplay())return this.setSpinner(0),this;var s=n.observedNavImpl.hasProxiesInEdition();n.taggerRoot.toggleClassName("edition_mode",s),n.form&&(n.form.destroy(),n.form=null),e&&e.redrawEditTagsArea&&(s?(n.cleanUserTagsModal(),n.userTagsView.redraw()):n.userTagsView.clear()),e&&e.redrawActiveCriteria&&n.updateActiveTagsArea();var o={};if(e&&(e.onSearch||e.onRootWSelection||e.actionCancel||(o.abortAction=!0)),e&&!e.actionCancel){let e=this.actionManager?this.actionManager.getCurrentAction():void 0;e&&e.id==U.ACTION_COLORIZE&&e.cancelColorize()}this.actionManager.redraw(o),this._topBar.redrawActionsToolbar(this.isMaximized);var r={onSearch:e&&e.onSearch,searchString:e&&e.searchString};if(this.isMaximized){this.updateAllContentViewStatus(),this.maximizeTaggerView&&this.maximizeTaggerView.setWidth(this.tabViewWidth),this.interactiveShowMoreToggle=!1;let e=this.allContentView.getAllViewStatus();this._topBar.actionsToolbar.setShowMoreHideShowValue(e.toShow),this._topBar.actionsToolbar.setShowMoreVisibility(e.headerVisible),r.toShow=e.toShow,r.navImpl=this.observedNavImpl,this.maximizeTaggerView.redraw(r,t),this.interactiveShowMoreToggle=!0,a()}else{this._topBar.actionsToolbar.setShowMoreVisibility(!1),this.tabViewWidth=this.tabView.elements.container.clientWidth;var l=[];let e=n.observedNavImpl.hasPreferredPredicates();var c=!!(e&&e.length>0);n.preferredView.setAvailability(!0),n.preferredView.show(),r.excludePreferred=!0,l.push(n.preferredView.redraw(r,t)),i.all(l).then(function(){c||(n.preferredView.setAvailability(c),n.preferredView.hide(),n.allViewHeaderVisibility(!1),n.allContentView.expand()),n.allContentView.redraw(r,t),n.updateShowResults(),n.checkForSearchTagsOnDemandSupport(),n.updateAllContentViewStatus(),a()}.bind(this))}}}.bind(this))},updateAllContentViewStatus:function(){if(this.observedNavImpl.getProxiesHavingLoadMoreTagsPending().length)this.preferredView.isEmpty()?(this.allContentView.expand(!0),this.allViewHeaderVisibility(!1)):(this.allContentView.collapse(),this.allViewHeaderVisibility(!0));else if(this.preferredView.isEmpty()||this.allContentView.isEmpty())this.allViewHeaderVisibility(!1),this.preferredView.isEmpty()?this.allContentView.expand(!0):this.allContentView.collapse(!0);else if(this.allViewHeaderVisibility(!0),this.observedNavImpl.getCache().getIsMoreTagsButtonClicked())this.observedNavImpl.getCache().setIsMoreTagsButtonClicked(!1),this.allContentView.expand(!0);else{this.observedNavImpl.getInteractiveMoreTagsSectionStatus()?this.allContentView.expand(!0):this.allContentView.collapse()}let e=this.actionManager.initActionsView();this.preferredView.isEmpty()&&this.allContentView.isEmpty()||!e.showActions?e.container.hide():e.container.show()},onPreferredViewUpdate:function(){this.updateAllContentViewStatus()},redrawTags:function(){if(A.log("redrawTags called on: "+(new Date).getTime()),this._simplifiedTagger){this.dispatchEvent("redrawStatusUpdate",!0),this.buildTagValues();var e=[],t=!1,i="";return this.searchedString?(e=this.getRootWs(),t=!0,i=this.searchedString):e=this._simplifiedSelectedRootWs,this.redrawSimplifiedTags({redrawActiveCriteria:!0,redrawAllView:!0,onSearch:t,searchString:i,redrawEditTagsArea:!0},e).then(function(){m.isMasked(this.taggerRoot)&&m.unmask(this.taggerRoot),e.forEach(function(e){l.redrawUiElements(void 0,e)})}.bind(this))}var a=document.activeElement&&"taginput"===document.activeElement.id,n=this.observedNavImpl.getCache();if(this.visibility){if(m.unmask(this.taggerRoot),void 0===this.observedNavImpl)throw new Error("Unexpected rendering of TaggerView without an observed Tagger?!");if(!this.observedNavImpl.isReadyForDisplay())return this.setSpinner(0),this;this.buildTagValues(),this.redrawActiveCriteria(!0),this.globalSearchInput.inject(this.tabView.elements.contentNode.getElement("#tags-tab"),"top"),this.tagsContainer.getElement("#tags-var-height").innerHTML=this.availableTagsToHtml(),this.isW||this.displayNoTags(),this.taggerHeader.getElement(".tagger-filter").toggleClassName("selected",n&&n.isSearchVisible()),this.taggerRoot.toggleClassName("edition_mode",this.observedNavImpl.hasProxiesInEdition()),this.form&&(this.form.destroy(),this.form=null),this.observedNavImpl.hasProxiesInEdition()&&this.editionAreaToHtml(),this.redrawShowAll(),this.manageSortByPreference(),l.redrawUiElements();try{this.myNotificationControl.inject(this.taggerUWAElement.getElement(".tagnavheader"),"after")}catch(e){}try{v.dispatch(!0)}catch(e){}this.toggleSearchInput(null,a,!0),setTimeout(this.updateScroller.bind(this,!0),50)}return this},updateScrollOnHierarchyTags:function(){let e=this,t=new Set,i=this.observedNavImpl.getCache();(t=l.getListOfHierarchyPredicates()).forEach((t,a)=>{if(!i.isPredicateCollapsed(t)){let i=e.taggerRoot.getElement("li.predicate[predicate='"+t+"']"),a=i.getElement('.tag[level="5"]'),n=a?a.getClosest(".childrenTags").getElements(".tag"):[];if(n.length)for(let e=0;e<n.length;e++){let t=n[e];if("0px"==t.getClosest(".childrenTags").getStyle("height"))break;{let e=i.getElement(".predicate-content"),a=e.getDimensions().width;if((e=>e.offsetWidth<e.scrollWidth||e.offsetWidth!=e.scrollWidth&&void 0)(t.getElement(".tag-label"))){a="37em",e.setStyle("width",a);break}}}}})},redrawShowAll:function(){var e=this.observedNavImpl.getFocusedProxy();if(e&&e.relevantPredicates.length&&Object.keys(e._tagValuesMap).length){var t=!(!e||!e.relevantPredicates.length)&&e.showAllBool,i='<hr/><div class="show-all-toggle">'+g.getText(t?"showLess":"showAll")+"</div>";this.tagsContainer.getElement("#tagger-footer")&&(this.tagsContainer.getElement("#tagger-footer").setStyle("display","").innerHTML=i),this.isW?this.tagsContainer.getElement("#all-tags").toggleClassName("relevant-only",!e.showAllBool):this.tagsContainer.getElement(".predicates").toggleClassName("relevant-only",!e.showAllBool),this.tagsContainer.getElement("#all-tags").addClassName("remove-border"),this.isW||e.showAllBool||this.displayNoTags(!1,!0)}else this.tagsContainer.getElement("#tagger-footer")&&this.tagsContainer.getElement("#tagger-footer").setStyle("display","none"),this.tagsContainer.getElement("#all-tags")&&this.tagsContainer.getElement("#all-tags").removeClassName("remove-border")},updateScroller:function(e){if(!this._simplifiedTagger){var t,i,a,n,s,o,r,l=this.observedNavImpl.getFocusedProxy();if(e||(e=!1),e||this.visibility){if(t=this.taggerRoot.getDimensions().innerHeight-42+(this.observedNavImpl.getCache()&&this.observedNavImpl.getCache().isSearchVisible()?0:30),t-=this.taggerUWAElement.getElement("#active-tags").getDimensions().outerHeight,t-=this.taggerHeader.getDimensions().outerHeight,o=(r=l&&l.relevantPredicates.length&&Object.keys(l._tagValuesMap).length)?t-this.tagsContainer.getElement("#tagger-footer").getDimensions().outerHeight:Math.min(this.tagsContainer.getElement("#tags-var-height").getDimensions().height+5,t),"criteria"!==this.tabView.selectedTab.getName()||this.observedNavImpl.hasProxiesInEdition()?(i=this.tagsContainer,a=this.taggerScroller,n=H):(i=this.criteriaContainer,a=this.criteriaScroller,n=J),a&&(t!==n||e)&&(i.setStyle("height",t),n=t),"tags"===this.tabView.selectedTab.getName()){var c=this.getObservedNavigator().modifiedPredicate;c&&(a.scrollToElement("#"+this.getDOMId(c.getFullPredicateID())),this.getObservedNavigator().modifiedPredicate=null)}else i.getElement(".no-native-scrollbars")?i.getElement(".no-native-scrollbars").setStyle("height",n-40):i.getElement(".native-scrollbars")&&i.getElement(".native-scrollbars").setStyle("height",n-40),s=Math.max(n-40,i.getElement(".criteria-list")?i.getElement(".criteria-list").getDimensions().height+20:0),this.container.getElement("#all-criteria").setStyle("height",s);return this.tagsContainer.getElement(".scroller-content").setStyle("height",r?o:""),this.tagsContainer.getElement("#all-tags").setStyle("height",o),this}}},onSearchLaunch:function(){var e,t,i={},a=this.observedNavImpl.getCriteriaIdsMap();for(t in a)i[e=t.split("/").pop()]=l.getPredicateView(r.getPredicate(e),this);s.onSearchLaunch(this,i),this.setActiveCriteria(!1,!0)},onFreeInputDeletion:function(t){var i,a,n,o,l,c,d,g,h={};if(-1!==t.target.getClosest(".tag").id.indexOf("atv"))return this.observedNavImpl.activeSearchProxy.clickCriteriaEvent(t),!1;if(t.target.getClosest(".freeinput-predicate-list")){n=t.target.getClosest(".freeinput-predicate-list").getElement(".predicate").id,a=this.getIdFromDOMId(n),d=r.getPredicate(a.split("/").pop().replace("sixw:","")),l=this.getIdFromDOMId(t.target.getParent().id),"string"!==(i=d.getType())&&"boolean"!==i&&(h[c=!0===t.target.hasClassName("from")?"from":"to"]=l,l=h);var u=this.observedNavImpl.getFocusedProxy();if(!u)throw new Error("ERROR : TaggerView.onFreeInputDeletion is called when there is no focused proxy !!!");return g=this.observedNavImpl.getCache().getCriteriaToResetBeforeFilterChange(u?u.id():void 0),o=e.is(c)?g[d.id()][c].value:"boolean"===i?g[d.id()].value:g[d.id()].value.filter(function(e){return e.value!==l}).map(function(e){return e.value}),this.warnProxyOfCriteriaChange({sixw:d.getFullPredicateID(),value:o}),this.observedNavImpl.removeFreeInputs([{predicate:d,type:i,value:l}]),s.redrawUiElements(!0),!1}},deleteFreeInput:function(t){var i,a={},n=t.predicate,o=t.type;return i=r.getPredicate(n.split("/").pop().replace("sixw:","")),"string"!==o&&"boolean"!==o&&(t.dispValue=t.object),t.isSimplifiedCriteria&&(a.isSimplifiedCriteria=!0),e.extend(a,t.object),this.observedNavImpl.removeFreeInputs([{predicate:i,type:o,value:UWA.is(t.object,"object")?a:t.object}]),s.checkActiveSearch(this),this.onSearchLaunch(),!1},warnProxyOfCriteriaChange:function(e){this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().warnForCriteriaChange(e)},warnProxyOfCriteriaModified:function(e){var t,i,a,n,s=[],o=["from","to"],l=this.getObservedNavigator().getFocusedProxy();e=this.getObservedNavigator().getCache().getCriteriaToResetBeforeFilterChange(l?l.id():void 0);let c={};var d,g,h=this.observedNavImpl.getCriteriaIdsMap();for(g in h)if(s=[],d=g.split("/").pop(),g="sixw:"+g,r.getPredicate(d),e[d]){var u=e[d].type;switch(c[g]||(c[g]=[]),u){case"string":if((t=UWA.clone(e[d].value)).length){let e=-1,i=[];t.forEach(t=>{i.length&&(e=i.findIndex(function(e){return e.object===t.value}));let a={type:"string",object:t.value,displayValue:t.label};i.push(a),-1===e&&s.push(a)})}break;case"boolean":t=UWA.clone(e[d].value);let r=-1;s.length&&(r=s.findIndex(function(e){return e.object===t.value})),-1===r&&t&&s.push({object:t.value,type:u,displayValue:t.label});break;case"integer":case"float":case"double":case"date":for(n={},i=0;i<o.length;i++)if(a=o[i],t=e[d][a]?UWA.clone(e[d][a].value):null){n[a]="date"!==u?t.replace(",","."):t.getFullYear()+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+("0"+t.getDate()).slice(-2);let e=0;s.length&&(e=s.every(function(e){if(e.object.from===n.from&&e.object.to===n.to)return!0})),e||s.push({object:n,type:u})}}c[g]=c[g].concat(s)}this.observedNavImpl.getFocusedProxy()&&this.observedNavImpl.getFocusedProxy().warnForCriteriaModified(c)},onTagDeletion:function(e){var t,i,a,n;return t=(n=JSON.parse(this.getIdFromDOMId(e.target.getClosest(".tag").id))).predicate,i=n.object,a=r.getPredicate(t.split("/").pop()),!!(i.length&&i.length>0)&&(this.observedNavImpl.deleteTagValue(i,a),!1)},onTagCreation:function(e,t,i){var a={sixw:[t],type:"string"};try{this.observedNavImpl.createTagValue(e,new r(a),i)}catch(e){v.push(new Notification("Fail to create a predicate with invalid arg. Id is :'"+a.sixw[0]+"'")),v.dispatch()}},isSelected:function(e){return this.observedNavImpl.isSelected(e)},isExcluded:function(e){if(this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships"))return this.observedNavImpl.isExcluded(e)},getListOfSelectedTagValues:function(e){return this.observedNavImpl.getListOfSelectedTagValues(e)},getMoreLimitForPredicate:function(e){return this.observedNavImpl.getMoreLimitForPredicate(e)},getDOMId:function(e){var t,i,a=0;for(t=0,i=e.length;t<i;t++)a=(a<<5)-a+e[t].charCodeAt(0),a&=a;return a="id_"+a,this.DOMIdToId[a]=e,a},getIdFromDOMId:function(e){return this.DOMIdToId[e.replace("sug","")]},isProxyWithFilteringOnServer:function(){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.getFocusedProxy().isFilteringOnServer()},hasFreeInputOnly:function(e){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.hasFreeInputOnly(e)},hasFreeInputSupport:function(e){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.hasFreeInputSupport(e)},hasGroupingSupport:function(e){return!!this.observedNavImpl&&this.observedNavImpl.hasGroupingSupport(e)},hasEmbeddedView:function(){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.getFocusedProxy().supportsEmbeddedView()},isGroupedBy:function(e){return!!this.observedNavImpl&&this.observedNavImpl.isGroupedBy(e)},getExpandStatus:function(e){return!(!this.observedNavImpl||null===this.observedNavImpl.getFocusedProxy())&&this.observedNavImpl.getExpandStatus(e)},toggleParametersExpand:function(){var e=this.observedNavImpl.getCache();e.setParameterClicked(!e.getParameterClicked());var t=this.criteriaContainer.getElement("#parameters-parent-container");e.getParameterClicked()?(t.setStyle("visibility","inherit"),t.setStyle("height","auto")):(t.setStyle("visibility","hidden"),t.setStyle("height","0px"))},clickParameterMagnifier:function(e){this.parametersText&&this.parametersText.isDisabled()||"keydown"===e.type&&13!==e.keyCode||this.validateParameterTitle()},validateParameterTitle:function(e){var t=this.parametersText.getValue(),i=this.criteriaContainer.getElement("#parameters-input-container"),a=this.observedNavImpl.getFocusedProxy();i&&a&&(this.paramWarning.remove(),t.length<2?(this.paramWarning.innerHTML=g.getText("paramWarning1"),this.paramWarning.inject(i,"before"),this.parametersAutocomplete&&this.parametersAutocomplete.remove()):t.split(" ").every(function(e){return/[A-Za-z0-9]{2,}/.test(e)})?(m.mask(i),a.sendStringTypedForPLM(t)):(this.paramWarning.innerHTML=g.getText("wildcardWarning"),this.paramWarning.inject(i,"before"),this.parametersAutocomplete&&this.parametersAutocomplete.remove()))},editionAreaToHtml:function(){var t,i,a,n,s,o,r,l=[],c=[],d=[],h=this.observedNavImpl.getProxiesInEdition(),u=[],p=this.taggerUWAElement.getElement(".edit-section"),f=this;this.observedNavImpl.getCache();if(h.length){if(t=h[0].getCStorages(),i=h[0].getTagsServers(),a={},i)for(s in i)o=i[s],a[o.getTenantDisplayName()]=s;else for(s in t)o=t[s],a[o.getTenantDisplayName()]=s;if(f._simplifiedTagger)c.push({label:Y["ds6w:where"],value:"ds6w:where"}),c.push({label:Y["ds6w:what"],value:"ds6w:what"}),c.push({label:Y["ds6w:when"],value:"ds6w:when"}),c.push({label:Y["ds6w:who"],value:"ds6w:who"}),c.push({label:Y["ds6w:how"],value:"ds6w:how"}),c.push({label:Y["ds6w:why"],value:"ds6w:why"});else{for(n in Y)d.push(new C({value:Y[n],icon:"3ds-"+n.replace("ds6w:",""),className:"predicate-button",name:n,active:f.selectedPredicate===n}));c=new b({type:"radio",buttons:d,events:{onClick:function(e,t){f.selectedPredicate=t.options.name,V.getSuggestionsFromServers({tagsServers:i,tenants:f.selectedTenant,pred:f.selectedPredicate,autocomplete:f.form?f.form.getAutocompleteInput("autocomplete"):null})}}})}!h[0].hasPlatformData()&&i&&Object.keys(a).length>1?l=[{id:"tenant-list",type:"select",name:"platform",label:g.getText("platformName"),value:this.selectedTenantName||null,placeholder:g.getText("enterPlatformName"),options:Object.keys(a),required:!0,events:{onChange:function(){f.selectedTenantName=this.getValue(),f.selectedTenant=[a[this.getValue()[0]]],V.getSuggestionsFromServers({tagsServers:i,tenants:f.selectedTenant,pred:f.selectedPredicate,autocomplete:f.form?f.form.getAutocompleteInput("autocomplete"):null})}}}]:1===Object.keys(a).length&&(this.selectedTenant=[a[Object.keys(a)[0]]])}f._simplifiedTagger?(this.selectedPredicate=f.cacheForSimplified.getAddTagActiveW(),r={className:"predicate-buttons",id:"pred-buttons",type:"select",name:"predButtons",label:g.getText("selectW"),value:this.selectedPredicate,options:c,required:!0,events:{onChange:function(){f.selectedPredicate=this.getValue()[0],f.cacheForSimplified.setAddTagActiveW(f.selectedPredicate),V.getSuggestionsFromServers({tagsServers:i,tenants:f.selectedTenant,pred:f.selectedPredicate,autocomplete:f.form?f.form.getAutocompleteInput("autocomplete"):null})}}}):r={type:"text",className:"predicate-buttons"},u=[r,{type:"autocomplete",name:"autocomplete",allowFreeInput:!0,showSuggestsOnFocus:!0,label:g.getText("tagName"),placeholder:g.getText("enterTagName"),noResultsMessage:!1,typeDelayBeforeSearch:300,className:"tagger-autocomplete nv-autocomplete",required:!0,events:{onFocus:function(e){this.getSuggestions(this.elements.input.value)}}}],l.length&&(u=l.concat(u)),this.form=new T({className:"edit-tags-form expandable",fields:u,buttons:[{type:"submit",className:"create-tag-button primary",value:g.getText("createTag")}],events:{onSubmit:function(){var t=f.form.getAutocompleteInput("autocomplete").getSelection().value||f.form.getAutocompleteInput("autocomplete").getSelection();t&&(t!==e.String.unescapeHTML(t)&&(t=e.String.unescapeHTML(t),v.push(new Notification("For security reasons, your tag has been changed to "+t,{className:"warning"})),v.dispatch()),f.onTagCreation(t,f.selectedPredicate,f.selectedTenant))},onReset:function(){}}}),this.form.inject(p),this._simplifiedTagger||this.form.elements.container[l.length?1:0].getParent().setContent(c),this.selectedPredicate&&this.selectedTenant&&V.getSuggestionsFromServers({tagsServers:i,tenants:this.selectedTenant,pred:this.selectedPredicate,autocomplete:this.form?this.form.getAutocompleteInput("autocomplete"):null}),this._simplifiedTagger&&(4===this.form.elements.container.length?(this.form.elements.container[1].getParent().getParent().setStyles({width:"50%",float:"left"}),this.form.elements.container[2].getParent().getParent().getParent().setStyles({width:"50%",float:"right"})):(this.form.elements.container[0].getParent().getParent().setStyles({width:"50%",float:"left"}),this.form.elements.container[1].getParent().getParent().getParent().setStyles({width:"50%",float:"right"})),this.observedNavImpl.getCache().isSectionCollapsed("createTag")&&this.form.elements.container.setStyles({position:"absolute",height:"0px",overflow:"hidden"}))},tnHeaderToHtml:function(){var e;return e="<div id='edit-tags' data-rec-id='edit-tags'>",e+="<div class='edit-section'>",e+=this.sectionHeaderToHtml("createTag"),e+="</div></div>",e+="<div class='tagnavheader'>",e+="<div class='tn-header-title'>6WTags</span></div>",e+="<div class='search-header-title'>"+g.getText("suggestedTags")+"</span></div>",e+="<div class='show-all'></div>",e+="<div class='ds6w-button sort-6w'></div>",e+="<div class='ds6w-button tagger-filter'><span class='fonticon fonticon-search'></span></div>",O.getOption("simplifiedTagger")&&!O.getOption("WebInWin")&&(e+="<div class='ds6w-button activate-simplified'><span class='fonticon fonticon-cog'></span></div>"),e+="</div>"},availableTagsToHtml:function(e,t,i,a,n){var s=this,o="",r="",d=this.observedNavImpl.getCache(),h=this.observedNavImpl.getFocusedProxy();if(this.isW)o+=c.getRoots().map(function(e){return e.toHtml()}).join("");else{var u=this.observedNavImpl.getProxyPreferredSortOrder(),p=d.get6WSort(),f=u||p;if("sort-tag"===f)r+=c.getRoots().map(function(t){return s._simplifiedTagger&&e?t.id()===e?(A.log("convert the active root predicate view to html: "+t.id()),t.toHtml(void 0,void 0,void 0,void 0,f)):void 0:t.toHtml(void 0,void 0,void 0,void 0,f)}).join("");else{r+=l.getPredicates(f,t||(h?h.getPredicateInfo():null)).map(function(t){return function(t){if(!s._simplifiedTagger||!e)return t.toHtml(null,null,null,d.getSearchValue,f);var a=t.getPredicate();return i&&-1!==i.indexOf(a.id())&&/*!predicate.is6WRoot() &&*/a.get6WRootFather().id()===e?t.toHtml(null,null,null,d.getSearchValue,f):i?void 0:n&&-1!==n.indexOf(a.id())||/*!predicate.is6WRoot() &&*/a.get6WRootFather().id()!==e?"":t.toHtml(null,null,null,d.getSearchValue,f)}(t)}).join("")}o+="<ul class='predicates allw'>",o+=r||(a?"":"<div class='no-tags'>"+g.getText("noTags")+"</div>"),o+="</ul>",this.updateSortPred(f)}return o},sectionHeaderToHtml:function(e,t){var i="";return i+="<div class='section-header'>",i+="<div class='header-title' id='"+(e=e||"")+"'>",i+="createTag"!==e||this._simplifiedTagger?"<div class='arrow'><span class='fonticon fonticon-down-dir'></span><span class='fonticon fonticon-right-dir'></span></div>":"",i+=t&&t.isw?"<span class='fonticon fonticon-3ds-"+e+"'></span>":"",i+=(t&&t.isw?e.replace(/^\w/,function(e){return e.toUpperCase()}):g.getText(e))+"</div>",t&&t.isw&&t.count>=0&&(i+="<span class='tagger-filter fonticon fonticon-search section-header-left'></span>",i+="<span class='root-count section-header-left'>"+t.count+"</span>"),i+="</div>",t&&t.isw&&(i+="<div id='filter-"+e+"' class='add-tag-cont' style='overflow: hidden; height: 0px;'>",i+="<span class='add-tag-close'></span><span class='fonticon fonticon-cancel-circled'></span></span><input id='taginput' class='tagger-input searchbox' title='",i+=g.getText("searchTag")+"' placeholder='"+g.getText("searchTag")+"'/>",i+="</div>"),i},onToggleParamTagSelection:function(e){var t=this,i=e.target.getAttribute("id");return this.observedNavImpl.getFocusedProxy().getParameters().forEach(function(a){if(i===a.cid){var n=a.get("type");if("string"===n)a.set({stringVal:""});else if("boolean"===n)a.set({boolVal:[]});else{var s=a.get("intType"),o=e.target.getAttribute("rangeval");s.forEach(function(t){(t.rangeContainer&&t.rangeContainer.hasChildNodes()?t.rangeContainer.getElement(".form-control"):null).value===o&&("from"===e.target.getAttribute("fromto")?t.fromVal=null:t.toVal=null)})}t.observedNavImpl.getFocusedProxy().onRefine()}}),this.setActiveCriteria(!1,!0),!1},getCriteriaToHtml:function(){var e,t,i=this.observedNavImpl.getCache(),a=this.observedNavImpl.getCriteriaIdsMap(),n="<ul class='criteria-list'>",s=this.observedNavImpl.getFocusedProxy();if(Object.keys(a).length){for(e in a)t=r.getPredicate(e.split("/").pop()),l.getPredicateView(t,this),n+=l.getPredicateView(t,this).toHtml(null,!1,!0);s&&s.getMoreCountProxy()>0&&(this.criteriaContainer.getElement("#criteria-toggle-container")?this.criteriaContainer.getElement("#criteria-toggle-container").innerHTML="<div class='criteria-toggle' nb-more="+s.getMoreCountProxy()+">"+(i.isMoreClicked()?g.getText("lessCriteria"):g.getText("moreCriteria"))+" ["+s.getMoreCountProxy()+"]</div>":this.taggerRoot.getElement("#criteria-toggle-container")&&(this.taggerRoot.getElement("#criteria-toggle-container").innerHTML="<div class='criteria-toggle' nb-more="+s.getMoreCountProxy()+">"+(i.isMoreClicked()?g.getText("lessCriteria"):g.getText("moreCriteria"))+" ["+s.getMoreCountProxy()+"]</div>")),null!==s&&s.isPLMParameterEnabled()&&(0===s.getMoreCountProxy()||i.isMoreClicked())&&(i.setParameterClicked(!0),n+="<hr/> <li id='parameter-list'><div class='parameters-toggle'>"+g.getText("paramTitle")+"</div>",n+="<div id='parameters-parent-container' style='visibility:inherit; height:auto'>",n+="<div id='parameters-input-container' style='display:inline-block; width:100%; position:relative;'></div></div>")}return n+="</ul>"},displayCriteria:function(e){this.observedNavImpl.getFocusedProxy()&&"criteria"!==this.tabView.selectedTab.getName()&&"criteria"!==this.tabView.selectedTab?(this.tabView.selectTab("criteria-tab"),this.actionManager&&this.actionManager.initActionsView().container.hide(),this.redrawTopBarTagIcon()):A.info("Cannot display adv search, the widget is not maximized"),this.visibility||!1===e||this.openTagger()},displayTags:function(e){(this.visibility||!1!==e)&&(this.tabView&&"tags"!==this.tabView.selectedTab&&(this.tabView.selectTab("tags-tab"),this.actionManager&&this.actionManager.initActionsView().container.show(),this.redrawTopBarTagIcon()),this.visibility||!1===e||this.openTagger())},updatePLMSuggestions:function(e){var t,i=this,a=this.criteriaContainer.getElement("#parameters-input-container"),n=this.observedNavImpl.getFocusedProxy();if(t=n.getParameters(),a&&this.paramWarning){if(this.parametersAutocomplete&&this.parametersAutocomplete.destroy(),this.parametersAutocomplete=new E({showSuggestsOnFocus:!0,events:{onSelect:function(e){if(null!==e&&e.selected&&i.paramWarning)if(this.reset(),i.paramWarning.remove(),t.appendParameter(new h({value:e.title||e.value,interface:e.subLabel,unit:e.unit,type:e.type,displayValue:e.value||e.title})))this.dispatchEvent("onClickOutside");else{var a=i.criteriaContainer.getElement("#parameters-input-container");a&&(i.paramWarning.innerHTML=g.getText("paramWarning3"),i.paramWarning.inject(a,"before"))}}}}),this.paramWarning.remove(),e.items.length<1)this.paramWarning.innerHTML=g.getText("paramWarning2")+" '"+e.name+"'",this.paramWarning.inject(a,"before");else{this.parametersAutocomplete.inject(a),this.parametersAutocomplete.addDataset(e),this.parametersAutocomplete.showAll();var s=e.hasMore?g.getText("paramPlaceholder1"):e.items.length+" "+g.getText("paramPlaceholder2");this.parametersAutocomplete.options.placeholder=s,this.parametersAutocomplete.defaultOptions.placeholder=s,this.parametersAutocomplete.elements.input.placeholder=s,this.parametersAutocomplete.elements.input.setAttribute("placeholder",s)}m.unmask(a)}},updateSuggestions:function(t){var i=e.is(t.suggestField,"string")?r.getPredicate(t.suggestField.split("/").pop()):null,a=i?l.getPredicateView(i,this):null;a&&a.updateSuggestions(t.datasets)},buildTypeToggleElem:function(t){var i=e.createElement("div",{class:"show-more-container",id:"typePredicateViewToggle",html:[{tag:"div",class:"show-more type-show-more",text:t.text}]});return i.setAttribute("viewMode",t.viewMode),i},onTypePredicateViewToggle:function(e){var t=e.target.getClosest("#typePredicateViewToggle").getAttribute("viewMode"),i=e.target.getClosest("li[predicate='ds6w:type']"),a=this.getCacheSimplified();if(i){var n={channel:"TaggerTrackerApi",topic:"hit",data:{category:"6WTagger",action:"TypeCategoryViewSwitch",persDim:{pd1:"category"}}};if("category"==t?(a.setViewMode("ds6w:type","tag"),n.data.persDim.pd1="tag"):a.setViewMode("ds6w:type","category"),R.publish(n),this.redrawPredicate(i.id),"tag"==t){var s=this.actionManager?this.actionManager.getCurrentAction():void 0;s&&s.id==U.ACTION_EDITTAGREL&&this.disableType("start")}}},showComanyTagsMenu:function(){let e=!1;try{if(this.observedNavImpl.hasProxiesInEdition()&&this.observedNavImpl.getFocusedProxy()){let t=this.observedNavImpl.getFocusedProxy().getFocusedSubjectsData();t&&1===t.length&&"3DSpace"!==t[0].service&&-1!=O.getOption("supportedSourcesForEnterpriseOntology").indexOf(B.getSourceFromSubjectURI(t[0].uri))&&(e=!0)}}catch(e){A.error(e)}return e},getAvailableActions:function(){return new i(e=>{let t={availableActions:[],showMenuIcon:!1};var i=[];if(this.showComanyTagsMenu()){A.log("No actions available during edition mode");let a=this.observedNavImpl.getFocusedProxy().getTenant();p.getUserCategory(a).then(a=>{a&&a.showAdvocacyView&&i.push({text:g.getText(U.ACTION_ADDREMOVE_TAGS),fonticon:"tag",id:U.ACTION_ADDREMOVE_TAGS,position:"top left",items:[{text:g.getText(U.ACTION_ADDREMOVE_COMPANY_TAGS),id:U.ACTION_ADDREMOVE_COMPANY_TAGS,position:"top left"}]}),t.availableActions=i,t.showMenuIcon=!0,e(t)})}else this.observedNavImpl.getProxiesToDisplay().length>0&&(!this.observedNavImpl.getFocusedProxy()||0===this.observedNavImpl.getFocusedProxy().getFocusedSubjectsData().length)&&(this.hasGroupingSupport()&&!this.hasEmbeddedView()&&i.push({text:g.getText(U.ACTION_GROUP),fonticon:"group",id:U.ACTION_GROUP}),this.observedNavImpl.hasSelectInAppSupport()&&i.push({text:g.getText(U.ACTION_SELECTINAPP),fonticon:"doc-select ",id:U.ACTION_SELECTINAPP}),this.isColorizePossible()&&i.push({text:g.getText(U.ACTION_COLORIZE),fonticon:"palette",id:U.ACTION_COLORIZE}),this.observedNavImpl.hasExcludeSupport()&&!this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&i.push({text:g.getText(U.ACTION_EXCLUDE),fonticon:"block",id:U.ACTION_EXCLUDE}),this.hasAdvancedFocsuedProxy(void 0,"editTagsRelationships")&&i.push({text:g.getText("editTagPen"),fonticon:"pencil",id:U.ACTION_EDITTAGREL}),i.push({text:g.getText("multi_Tag_Refine"),fonticon:"filter-select-on",id:U.ACTION_SELECT})),t.availableActions=i,t.showMenuIcon=!1,e(t)})},destroy:function(){this.resizeObserver.disconnect(),this._parent()}})});