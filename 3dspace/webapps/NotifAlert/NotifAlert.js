define("DS/NotifAlert/NotificationUsageTracker",["UWA/Core","DS/Usage/TrackerAPI"],function(e,t){"use strict";return{trackCenterAction:function(n){var o={eventCategory:"notification.center",eventAction:n.eventAction,eventLabel:n.eventLabel,eventValue:n.eventValue,persDim:n.persDim,persVal:n.persVal,appID:"X3DNTFC_AP"};try{t.trackPageEvent(o)}catch(t){e.log("Analytics request failed : "+t)}},trackNotifSettingIconAction:function(n){var o={eventCategory:"notification.settingsicon",eventAction:n.eventAction,eventLabel:n.eventLabel,eventValue:n.eventValue,persDim:n.persDim,persVal:n.persVal,appID:"X3DNTFC_AP"};try{t.trackPageEvent(o)}catch(t){e.log("Analytics request failed : "+t)}},trackNotifSettingsViewAction:function(n){var o={eventCategory:"notification.settingsview",eventAction:n.eventAction,eventLabel:n.eventLabel,eventValue:n.eventValue,persDim:n.persDim,persVal:n.persVal,appID:"X3DNTFC_AP"};try{t.trackPageEvent(o)}catch(t){e.log("Analytics request failed : "+t)}},trackNotifFilterViewAction:function(n){var o={eventCategory:"notification.filterview",eventAction:n.eventAction,eventLabel:n.eventLabel,eventValue:n.eventValue,persDim:n.persDim,persVal:n.persVal,appID:"X3DNTFC_AP"};try{t.trackPageEvent(o)}catch(t){e.log("Analytics request failed : "+t)}},trackNotificationsLoadTime:function(n){var o={eventCategory:"notification.center",eventAction:n.eventAction,eventLabel:n.eventLabel,eventValue:n.eventValue,persDim:n.persDim,persVal:n.persVal,appID:"X3DNTFC_AP"};try{t.trackPageEvent(o)}catch(t){e.log("Analytics request failed : "+t)}}}}),define("DS/NotifAlert/NotifSuperModal",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Form","DS/UIKIT/Input/Select","i18n!DS/UIKIT/assets/nls/UIKIT","i18n!DS/NotifAlert/assets/nls/feed"],function(e,t,n,o,i,a,r,s,l){"use strict";var d={defaultOptions:{className:"",animate:!1,closable:!0,overlay:!0,okButtonText:s.ok,koButtonText:s.ko},modals:{current:null,queue:[]},init:function(e){this._parent(e)},activatePrompt:function(t,n,s){var d=this,c=void 0,p=e.merge({visible:!1},this.options),m=[],g=[],h=t.title;s=s;function u(t){var n=[],o=d.modal.getContent();return function(){if(t.value)for(var i=0;i<g.length;i++)if(o.getElements(g[i]).length>1)for(var a=0;a<o.getElements(g[i]).length;a++)n.push({reference:o.getElement(g[i])[a].attributes.reference.value||o.getElement(g[i])[a].placeholder,value:o.getElement(g[i])[a].value});else n.push({reference:o.getElement(g[i]).attributes.reference.value||o.getElement(g[i]).placeholder,value:o.getElement(g[i]).value});d.modal.preventEvent=!0,d.modal.hide(),t.options&&t.options.event&&t.options.event.options&&(t.options.event.options.options?t.options.event.options.options.data?(t.options.event.options.options.data=[t.options.event.options.options.data],t.options.event.options.options.data.push(n)):t.options.event.options.options.data=n:(t.options.event.options.options={},t.options.event.options.options.data=n)),e.is(s,"function")&&s(t)}}p.closable=!1!==this.options.closable,p.events={onHide:function(){!d.modal.preventEvent&&e.is(s,"function")&&s()},onShow:function(){c.getField("input-confirm").focus()}},d.modal=this.modalFactory({renderTo:document.body}),c=new a({fields:[],events:{onSubmit:u(!0)}});for(var f=0;f<t.attachments.length;f++)switch(t.attachments[f].type){case"textbox":var v=new i({placeholder:t.attachments[f].placeholder||"Text input",multiline:t.attachments[f].multi,attributes:{reference:t.attachments[f].reference}}).inject(c.elements.container);!f<=t.attachments.length&&(v.elements.input.style.marginBottom="10px"),t.attachments[f].multi&&(v.elements.input.style.resize="none",v.elements.input.rows=4),g.push(t.attachments[f].multi?"textarea":"input");break;case"label":n&&t.attachments[f].text&&-1!==t.attachments[f].text.search("##MERGE_COUNT##")&&(t.attachments[f].text=t.attachments[f].text.replace("##MERGE_COUNT##",n.toString()));var w=e.createElement("p",{text:t.attachments[f].text,reference:t.attachments[f].reference}).inject(c.elements.container);!f<=t.attachments.length&&(w.style.marginBottom="10px");break;case"select":var b=new r({placeholder:t.attachments[f].placeholder||!1,options:t.attachments[f].options,attributes:{reference:t.attachments[f].reference}}).inject(c.elements.container);!f<=t.attachments.length&&(b.elements.input.style.marginBottom="10px"),g.push("select");break;case"button":var A=new o({value:t.attachments[f].options.label||p.okButtonText,className:"primary"});m.push(A),A.addEvent("onClick",u({value:!0,options:t.attachments[f].options}))}let M=new o({value:l.btnCancel||"Cancel",className:"default"});m.push(M),M.addEvent("onClick",function(){d.modal.hide()}),d.modal.elements.body.addContent(c),void 0===h&&(h=l.confirmMsg),h&&e.is(h,"string")?d.modal.setHeader({tag:"h4",text:h}):(d.modal.getHeader().hide(),s||(s=h)),!e.is(s,"function")&&this.options.callback&&(s=this.options.callback),d.modal.setFooter(m),d.modal.dispatchEvent("onShowModal")},next:function(){this.modals.current&&this.modals.current.hide()},modalFactory:function(t){var o,i=this;return(o=new n(t)).addEvents({onShowModal:function(){i.modals.current?i.modals.queue.push(this):(i.modals.current=this,i.lastFocus=document.activeElement,this.show())},onShow:function(){i.dispatchEvent("onShow")},onHide:function(){var t,n=i.modals.queue;i.dispatchEvent("onHide"),this.destroy(),n&&n.length>0?(t=n.splice(0,1)[0]).elements&&(t.show(),i.modals.current=t):(i.modals.current=null,i.lastFocus&&e.is(i.lastFocus.focus,"function")&&i.lastFocus.focus())}}),o.inject(t.renderTo||document.body),o}};return t.extend(d)}),define("DS/NotifAlert/NotifAlert",["UWA/Core","UWA/Utils","UWA/Class/View","DS/UIKIT/DropdownMenu","DS/i3DXCompassPlatformServices/OpenWith","DS/WAFData/WAFData","i18n!DS/NotifAlert/assets/nls/feed","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/NotifAlert/NotifSuperModal","DS/UWPClientCode/PublicAPI","DS/NotifAlert/NotificationUsageTracker","DS/TransientWidget/TransientWidget","css!NotifAlert/NotifAlert.css"],function(Core,Utils,View,DropdownMenu,OpenWith,WAFData,NLS,PlatformAPI,i3DXCompassPlatformServices,NotifSuperModal,PublicAPI,NotificationUsageTracker,TransientWidget){"use strict";const MERGED_NOTIFS_MAX_DISPLAY=10;var Transient=window!==top&&top.require?window.top.require("DS/TransientWidget/TransientWidget"):TransientWidget,iView=View.extend({setup:function(e){this.timer=void 0,this.isClosed=!1,this.showAlertFx=void 0,this.oldText=void 0,this.mobileDevice=window.ds&&"MOBILE"==window.ds.env||window.top&&window.top.ds&&"MOBILE"==window.top.ds.env,this.mobileCheckFlag=!1,this.listEventTypes={bus:this.bus,url:this.url},this.numMerged=parseInt(this.model.get("isMerge"))||1,this.mergedPage=0,this.viewMoreMergedButton=!1,this.mergedCollection=void 0,this._createContent(),this._addEvents(),this.getAppInfo(this.model.get("provider")),this.model.get("isMerge")>1&&(this.mergedWrapper=UWA.createElement("div",{class:"RTmergedWrapper",styles:{height:"auto","padding-top":"10px"}}),this.container.appendChild(this.mergedWrapper),this.merge(this.model.get("isMerge")),this.viewMerged=!0),this.listenTo(this.model,"onChange:actioned",this.modelActioned)},_createContent:function(){var e=this;this.readIndex,this.starredIndex,this.dropdownMenuClose=null,this.alertImageUpdate=!1;var t=this.model.get("img"),n=this.model.get("text"),o=this.model.get("provider"),i=(this.model.get("url"),this.model.get("date"),this.model.get("options")),a=(this.model.get("notifications"),this.model.get("appIconBorder")),r=(this.model.get("actioned"),this.model.get("isInNotifCenter")),s=(this.model.get("refresh"),this.model.get("creationDate")),l=this.model.get("merged");if(this.appName=this.model.get("appName"),this.currentTenant=this.model.get("currentTenant"),e.numMerged>1){var d=e.numMerged;d=("<strong class='mergecount'>"+d+" </strong>").toString(),(n=-1!==n.search("##MERGE_COUNT##")?n.replace("##MERGE_COUNT##",d):n.replace(/<strong>.*?<\/strong>/,d)).search(/\(.*?\)/)&&(n=n.replace(/\(.*?\)/,""))}this.id=this.model.get("id"),t&&"string"==typeof t||(t="./resources/en/1/webapps/NotifAlert/assets/icons/notificon.png",a=!0);var c=this.isMerge?" RTMergedNotif":"";this.setContainer({tag:"div",class:"RTMainNotifAlert "+o+c,styles:{width:"100%"},html:[{tag:"span",class:"RTnotif-close fonticon fonticon-cancel",styles:{display:r?"none":"block"}},{tag:"div",class:"RTnotif-alertboxbody",html:[{tag:"div",class:"RTnotif-alertIcon",html:[{class:"RTnotif-alertImg",tag:"img",src:WAFData.proxifyUrl(t,{proxy:"passport"})||t,height:"48px",width:"48px",styles:{borderRadius:a?"0px":"24px"}}]},{tag:"div",class:"RTnotif-alertBody",html:[{class:"RTnotif-Txt",tag:"div",html:[{tag:"span",class:"RTnotif-span-Txt",html:decodeURI(encodeURI(n))}]}]},{tag:"span",class:"fonticon fonticon-chevron-down RTnotif-alertCenterOptions",styles:{margin:"auto 0",display:r?"block":"none",fontSize:"1.6em",cursor:"pointer",color:"#77797C",marginTop:"6px"},events:{mouseover:function(){"#368ec4"!=e.container.getElement(".RTnotif-alertCenterOptions").style.color.rgbToHex()&&(e.container.getElement(".RTnotif-alertCenterOptions").style.color="#3d3d3d")},mouseout:function(){"#368ec4"!=e.container.getElement(".RTnotif-alertCenterOptions").style.color.rgbToHex()&&(e.container.getElement(".RTnotif-alertCenterOptions").style.color="#77797C")}},html:this.dropdownMenuClose}]},{tag:"div",class:"RTAlertActions",styles:{display:"none",textAlign:"right"}}]});var p=this.container.getElement(".RTnotif-alertImg");if(p.onerror=function(){i3DXCompassPlatformServices.getAppInfo({appId:"X3DNTFC_AP",onComplete:function(t){if(t){var n;if(t.launchInfos)n=t.launchInfos;else{try{var o,i,a=JSON.parse(PublicAPI.user.properties.dashboards)}catch(e){UWA.log("3DNotification error: unable to parse user dahboards")}if(n=t.platforms[0].launchInfos,0===window.location.href.search(/https:\/\/([A-z0-9]+)-[A-z0-9]+-[A-z0-9]+-[A-z0-9]+/))i=(i=window.location.href.split(/https:\/\//)[1].split("-")[0]).toUpperCase();else for(o in a)if(a[o].platformId){i=a[o].platformId,UWA.log("findCurrentTenant selected the first PublicAPI.user.properties.dashboards tenant "+i);break}if(i)for(var r in t.platforms)if(t.platforms[r].id.toUpperCase()==i.toUpperCase()){n=t.platforms[r].launchInfos;break}}(n=n.split("/")).pop(),n.pop(),e.alertImageUpdate||(p.src=n.join("/").concat("/NotifAlert/assets/icons/notificon.png")),p.onerror=void 0}}})},r){var m,g;if(this.model.get("readState")?(e.container.style.opacity=.4,m=NLS.markAsUnread):(e.container.style.opacity=1,m=NLS.markAsRead),g=this.model.get("starredState")?NLS.removeImportant:NLS.markAsImportant,e.container.getElement(".RTnotif-alertCenterOptions").onclick=function(){"#77797c"===e.container.getElement(".RTnotif-alertCenterOptions").style.color.rgbToHex()||"#3d3d3d"===e.container.getElement(".RTnotif-alertCenterOptions").style.color.rgbToHex()?e.container.getElement(".RTnotif-alertCenterOptions").style.color="#368ec4":e.container.getElement(".RTnotif-alertCenterOptions").style.color="#77797C"},l){e.mergedTime=UWA.createElement("div",{class:"RTnotif-Txt",styles:{fontSize:"11px"}}).inject(e.container.getElement(".RTnotif-alertBody")),e.mergedTimeIcon=UWA.createElement("span",{class:"fonticon fonticon-clock site-icon"}).inject(e.mergedTime);var h=new Date(s);e.mergedTimeText=UWA.createElement("strong",{html:" "+h.getDate()+"/"+Number(h.getMonth()+1)+"/"+h.getFullYear()+" - "+(h.getHours()<10?"0":"")+h.getHours()+":"+(h.getMinutes()<10?"0":"")+h.getMinutes()}).inject(e.mergedTime)}if(1===e.numMerged){var u=[{text:m,fonticon:"bell",handler:function(t){let n=e.getReadstate();e.isMerge&&(e.setReadstate(!e.getReadstate()),e.model.dispatchEvent("readStateforMainMerge",{read:e.getReadstate()})),e.dropdownMenuClose.hide(),e.model.dispatchEvent("read",[{id:e.model.get("id"),read:!n}])}},{text:NLS.unsubscribe,fonticon:"list-times",handler:function(e){e.stopPropagation()},items:[{text:NLS.unsubscribeForHour,fonticon:"list-times",handler:function(){e.dropdownMenuClose.hide(),e.model.dispatchEvent("unsubscribe",[{forHour:!0}])}},{text:NLS.unsubscribeIndefinitely,fonticon:"list-times",handler:function(){e.dropdownMenuClose.hide(),e.model.dispatchEvent("unsubscribe")},disabled:"X3DNTFC_AP"==o,title:"X3DNTFC_AP"==o?NLS.unsubscribeDisabled||"You cannot subscribe again":""}]},{text:NLS.trash,fonticon:"trash",handler:function(){e.dropdownMenuClose.hide(),e.model.dispatchEvent("delete",{id:e.model.get("id"),read:e.getReadstate()})},disabled:"X3DNTFC_AP"==o,title:"X3DNTFC_AP"==o?NLS.trashDisabled||"You cannot restore again":""}];e.model.get("merged")?u.splice(1,0,{className:"divider"}):(u.splice(1,0,{text:g,fonticon:"star",handler:function(t){e.getStarredstate()?e.setStarredstate(0):e.setStarredstate(1),e.dropdownMenuClose.hide(),e.model.dispatchEvent("starred",[{id:e.model.get("id"),starred:e.getStarredstate()}])}}),u.splice(2,0,{className:"divider"}));var f=!1;if(i&&i.length>0&&"link"===i[0].type&&e._checkAction(i[0])){u.splice(0,0,{text:NLS.openInNewTab,fonticon:"window",handler:function(t){e.dropdownMenuClose.hide(),e.linkClickAction(i[0],!0)}});try{var v=i[0].options.event.options.uri;if(v){let t=decodeURIComponent(v).replace(/\+/g," ").match(/X3DContentId=.*.}/);if(t&&t[0]&&t[0].split("=")&&t[0].split("=")[1]){let n=JSON.parse(t[0].split("=")[1]);UWA.log("Content:  "+n);var w=new OpenWith;w.set3DXContent(n),f=!0,e.getOpenWithMenu(w).then(function(t){u.splice(1,0,{text:NLS.openWith||"Open With",fonticon:"open-menu-dot",handler:function(e){},items:t}),u.splice(2,0,{className:"divider"}),e.renderDropDownMenu(u)}).catch(function(t){UWA.log("Warning:"+t),u.splice(1,0,{className:"divider"}),e.renderDropDownMenu(u),f=!1})}}}catch(e){UWA.log("Warning: Content not received in the uri")}}f||(u.splice(1,0,{className:"divider"}),e.renderDropDownMenu(u))}for(var b=e.container.getElement(".RTnotif-span-Txt").children,A=0;A<b.length;A++)b[A].style.color="rgb(54, 142, 196)"}if(i)this._buildActions(i);else{var M=this.container.getElement(".RTnotif-close");this.container.onmouseover=function(){e.container.style.cursor="default"},M.onmouseover=function(){M.style.cursor="pointer"}}t&&this._buildIcon(t),4===this.model.get("state")&&this.anonymize()},getAppInfo:function(e){var t=this;this.appID=[],i3DXCompassPlatformServices.getAppInfo({appId:e,onComplete:function(n){if(UWA.log(n),n&&(t.appID[e]={},t.appID[e].platforms=[],n.platforms))if(0===n.platforms.length)t.appID[e].platforms[n.platformId]={serviceId:n.serviceId,url:n.launchUrl};else for(var o=0;o<n.platforms.length;o++){var i={serviceId:n.serviceId,url:n.platforms[o].launchUrl};t.appID[e].platforms[n.platforms[o].id]=i}}})},modelActioned:function(e){if(this.model.changedAttributes().actioned){var t=this.container.querySelectorAll(".RTnotif-alertActionButton");if(t)for(var n=0;n<t.length;n++)t[n].disabled=!0}},getReadstate:function(){return this.model.get("readState")},getStarredstate:function(){return this.model.get("starredState")},setReadstate:function(e){this.model.set("readState",e),e?(this.container.style.opacity=.4,1===this.numMerged?this.dropdownMenuClose.items[this.readIndex].elements.container.innerHTML='<span class="fonticon fonticon-bell"></span><span class="item-text">'+NLS.markAsUnread+"</span>":this.dropdownMenuMerged.items[2].elements.container.innerHTML='<span class="fonticon fonticon-bell"></span><span class="item-text">'+NLS.markGroupAsUnRead+"</span>"):(this.container.style.opacity=1,1===this.numMerged?this.dropdownMenuClose.items[this.readIndex].elements.container.innerHTML='<span class="fonticon fonticon-bell"></span><span class="item-text">'+NLS.markAsRead+"</span>":this.dropdownMenuMerged.items[2].elements.container.innerHTML='<span class="fonticon fonticon-bell"></span><span class="item-text">'+NLS.markGroupAsRead+"</span>")},setStarredstate:function(e){this.model.set("starredState",e),e?1===this.numMerged?this.dropdownMenuClose.items[this.starredIndex].elements.container.innerHTML='<span class="fonticon fonticon-star"></span><span class="item-text">'+NLS.removeImportant+"</span>":this.dropdownMenuMerged.items[3].elements.container.innerHTML='<span class="fonticon fonticon-star"></span><span class="item-text">'+NLS.removeGroupImportant+"</span>":1===this.numMerged?this.dropdownMenuClose.items[this.starredIndex].elements.container.innerHTML='<span class="fonticon fonticon-star"></span><span class="item-text">'+NLS.markAsImportant+"</span>":this.dropdownMenuMerged.items[3].elements.container.innerHTML='<span class="fonticon fonticon-star"></span><span class="item-text">'+NLS.markGroupAsImportant+"</span>"},getCenterState:function(){return this.model.get("isInNotifCenter")},getActionedState:function(){return this.model.get("actioned")},_addEvents:function(){var e=this;this.addEvent("updatePicture",function(t){e.container.getElement(".RTnotif-alertImg").src=t.src,e.alertImageUpdate=!0}),this.container.getElement(".RTnotif-close").onclick=function(t){e.close({context:e,decrementFlag:!0})}},_buildActions:function(e){var t=!0,n="RTnotif-alertActionButton btn btn-primary btn-sm";if(e.length>1&&(e[0].type,1)&&this.getActionedState())this.updateActionedLabel(this.model.get("actionedLabel"),!1,this.model.get("actor_data"));else for(var o=0;o<e.length;o++)if(t&&this._checkAction(e[o])){var i=e[o].options.event.type;switch(e[o].type){case"link":this.activateLink(),this.activateEvent({action:e[o],eventType:i}),t=!1;break;case"button":o>0&&(n="RTnotif-alertActionButton btn btn-default btn-sm",e[o].title="deny");var a=this.activateButton(e[o],n);a&&this.activateEvent({action:e[o],eventType:i},a);break;case"select":this.select=!0,this.activateSelect(e[o],n)}}},_buildIcon:function(e){var t,n,o,i=e&&decodeURIComponent(e);if(i.includes("login/"))try{t=i.split("login/")[1].split("/")[0]}catch(e){console.error(e)}if(t){var a=this.container.getElement(".RTnotif-alertIcon");a.onclick=function(){var e,i,a=window.location.href.match(/https:\/\/([A-z0-9]+)-([A-z0-9]+)-[A-z0-9]+(-|.)/);if(a&&4==a.length&&("-"==a[3]||a[1]&&a[1].length>4)&&(i=(i=a[1]).toUpperCase()),"3DSwym"===window.parent.ds.env){var r=decodeURIComponent(this.getElement(".RTnotif-alertImg").src);r.includes("login")&&(e=r.split("login/")[1].split("/")[0]),i3DXCompassPlatformServices.getServiceUrl({serviceName:"3DSwym",platformId:i,onComplete:function(t){"object"==typeof t?n=t[0].url:"string"==typeof t&&(n=t),o=n+"/#people:"+e+"/activities",window.parent.location.href=o}})}else{var s={login:t,url:o,x3dPlatformId:i};Transient.showWidget("X3DPRFL_AP","My Profile",s)}},a.onmouseover=function(){a.style.cursor="pointer"}}},getEventOptions:function(e){if(e&&e.event&&e.event.options){var t=e.event.options;if(t.topic&&t.data)return{topic:t.topic,data:t.data};UWA.log("3DNotification Error eventOptions missing topic or data")}else UWA.log("3DNotification Error eventOptions")},url:function(e,t){var n=this;e&&e.type&&e.options&&("link"!==e.type?"button"===e.type&&(t.onclick=function(t){if(!n.getActionedState()){var o=1;if(n.numMerged>1){if("UI"===e.options.event.type&&e.options.event.options)new NotifSuperModal({renderTo:document.body}).activatePrompt(e.options.event.options,n.numMerged,function(t){t.value&&(n.values=t.options.event.options.options.data,n.mergeList&&n.mergeList.length>0?(n.mergeList.forEach(function(e){e.values=t.options.event.options.options.data}),i()):n.model.dispatchEvent("getMerge",[{id:n.model.get("id"),groupID:n.model.get("groupID"),toBeActioned:{title:e.title,button:!0,values:t.options.event.options.options.data}}]),n.model.dispatchEvent("read",[{id:n.model.get("id"),read:!0,actioned:!0}]),n.getCenterState()&&n.setReadstate(!0))});else n.mergeList&&n.mergeList.length>0?i():n.model.dispatchEvent("getMerge",[{id:n.model.get("id"),groupID:n.model.get("groupID"),toBeActioned:{button:!0}}]);function i(){for(var t=0;t<n.mergeList.length;t++)"deny"===e.title?(o=n.mergeList[t].select?2:1,n.mergeList[t].container.children[2].children[o]&&n.mergeList[t].container.children[2].children[o].click()):n.mergeList[t].container.children[2].children[0]&&n.mergeList[t].container.children[2].children[0].click()}}else{if("UI"===e.options.event.type&&e.options.event.options)if(n.isMerge&&n.values)e.options.event.options.attachments.forEach(function(e){"button"===e.type&&(e.options&&e.options.event&&e.options.event.options&&(e.options.event.options.options?e.options.event.options.options.data?(e.options.event.options.options.data=[e.options.event.options.options.data],e.options.event.options.options.data.push(n.values)):e.options.event.options.options.data=n.values:(e.options.event.options.options={},e.options.event.options.options.data=n.values)),a(e))});else new NotifSuperModal({renderTo:document.body}).activatePrompt(e.options.event.options,!1,function(e){e.value&&a(e)});else a(!1);function a(o){o?n.activateLinkAction(o.options):n.activateLinkAction(e.options),n.model.dispatchEvent("read",[{id:n.model.get("id"),read:!0,actioned:!0}]),n.model.dispatchEvent("actioned",[{id:n.model.get("id"),actioned:!0}]),n.getCenterState()&&n.setReadstate(!0),n.isMerge&&n.model.dispatchEvent("readStateforMainMerge",{read:n.getReadstate()}),n.model.set("actioned",!0),t.target.disabled=!0}}}}):n.container.getElement(".RTnotif-alertBody").onclick=function(){var t=!1;n.appName&&(t=!("3ddashboard"==n.appName||"3dswym"==n.appName||"my3dexperience"==n.appName||"ifweloop"==n.appName)),n.linkClickAction(e,t)})},bus:function(e,t){var n=this;if(e&&e.type&&e.options){var o=this.getEventOptions(e.options);o&&("link"===e.type?n.alertBoxClick(".RTnotif-alertBody",function(){n.model.dispatchEvent("publish",[{topic:o.topic,data:o.data}]),n.model.dispatchEvent("read",[{id:n.model.get("id"),read:!0}]),n.getCenterState()?n.setReadstate(!0):n.close({decrementFlag:!0})}):"button"===e.type&&(o.data&&"rollback"==o.data.action&&(o.data.id=n.model.get("id"),o.data.isInNotifCenter=n.model.get("isInNotifCenter")),t.onclick=function(e){n.getActionedState()||(n.model.dispatchEvent("publish",[{topic:o.topic,data:o.data}]),n.model.dispatchEvent("read",[{id:n.model.get("id"),read:!0,actioned:!0}]),n.model.dispatchEvent("actioned",[{id:n.model.get("id"),actioned:!0}]),n.model.set("actioned",!0),e.target.disabled=!0,n.getCenterState()?n.setReadstate(!0):n.close({decrementFlag:!0}))}))}},alertBoxClick:function(e,t){this.container.getElement(e).onclick=t},_checkAction:function(e){return!!(e.options&&e.options.event&&e.options.event.type)},_checkUrlAction:function(e){return!(!e.event.options||!e.event.options.type)},activateEvent:function(e,t){if("UI"===e.eventType)this.listEventTypes.url.call(this,e.action,t);else for(var n in this.listEventTypes)this.listEventTypes.hasOwnProperty(n)&&e.eventType===n&&this.listEventTypes[e.eventType].call(this,e.action,t)},activateButton:function(e,t){var n;if((e&&e.options&&null==e.options.label||"select"!=e.type)&&e.options.event.options.data&&"rollback"==e.options.event.options.data.action&&(e.options.label="Restore"),!e||!e.options||!e.options.label&&"select"!==e.type)return UWA.log("3DNotification activateButton error : missing parameters"),null;var o=this.container.getElement(".RTAlertActions");o.style.display="block";var i="select"===e.type?e.options.event.options[0].label:e.options.label;return n=new UWA.Element("button",{class:t,text:i,styles:{marginBottom:"5px",marginRight:"10px",maxWidth:-1!=t.search("primary")?"130px":"100px",overflow:"hidden",textOverflow:"ellipsis"}}).inject(o),this.getActionedState()&&1===this.numMerged&&(n.disabled=!0),n},activateSelect:function(e,t){var n=this,o=this.container.getElement(".RTAlertActions"),i=this.activateButton(e,t);if(i.style.marginRight="1px",i.style.borderBottomRightRadius="0",i.style.borderTopRightRadius="0",i.onclick=function(t){e.options.event.options=e.options.event.options[0],e.num=0,n.activateSelectAction(e,t),t.target.disabled=!0},e.options.event.options.length>0){var a=new UWA.Element("button",{class:t,text:"",styles:{marginBottom:"5px",marginRight:"10px",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",padding:"0px",minWidth:"18px",borderBottomLeftRadius:"0",borderTopLeftRadius:"0"}}).inject(o);new UWA.Element("span",{class:"caret",text:"",styles:{marginLeft:"0px"}}).inject(a);var r=[],s=1;e.options.event.options.slice(1).forEach(function(t){t.num=s;var o={text:t.label,handler:function(o){e.options.event.options=t,e.num=t.num,n.activateSelectAction(e,o)}};r.push(o),s++}),this.caretDropDown=new DropdownMenu({target:a,items:r,events:{onHide:function(){n.model.dispatchEvent("removeDropDownMenu",{id:n.model.get("id")})},onShow:function(){n.model.dispatchEvent("addDropDownMenu",{id:n.model.get("id"),dropDown:n.caretDropDown})}}})}},activateSelectAction:function(e,t){if(!this.getActionedState())if(this.numMerged>1)if(this.mergeList&&this.mergeList.length>0){for(var n=0;n<this.mergeList.length;n++)0===e.num&&this.mergeList[n].container.children[2].children[0]?this.mergeList[n].container.children[2].children[0].click():this.mergeList[n].caretDropDown.items[e.num-1]&&this.mergeList[n].caretDropDown.items[e.num-1].elements.container.click();this.model.dispatchEvent("read",[{id:this.model.get("id"),read:!0,actioned:!0}]),this.getCenterState()&&(this.setReadstate(!0),t.target.disabled=!0)}else this.model.dispatchEvent("getMerge",[{id:this.model.get("id"),groupID:this.model.get("groupID"),toBeActioned:{num:e.num}}]);else this.activateLinkAction(e.options),this.model.dispatchEvent("read",[{id:this.model.get("id"),read:!0,actioned:!0}]),this.model.dispatchEvent("actioned",[{id:this.model.get("id"),actioned:!0}]),this.isMerge&&this.model.dispatchEvent("readStateforMainMerge",{read:this.getReadstate()}),this.model.set("actioned",!0),t.target.disabled=!0,this.caretDropDown=[]},close:function(e){e.context||(e.context=this),e.context.timer&&e.context.model&&e.context.model.collection&&(e.decrementFlag&&e.context.model.dispatchEvent("alertBoxClosed"),e.context.timer.stop(),e.context.model.collection.remove(e.context.model))},show:function(){var e=this,t=5e3,n=this.container.getElement(".RTnotif-span-Txt");this.timer=new function(n,o){var i;this.stop=function(){window.clearTimeout(i),e.isClosed=!1},this.resume=function(e){new Date,window.clearTimeout(i),i=window.setTimeout(n,e)},this.resume(t)}(function(){e.isClosed||(e.close({context:e}),e.isClosed=!0)},t),this.container.addEventListener("mouseenter",function(){e.timer.stop()}),this.container.addEventListener("mouseleave",function(){e.timer.resume(3e3)}),n&&this.cutText(n)},post:function(e,t){var n=this;if(!e||!e.url)return UWA.log("Notification Post Failed some parameters are missing !");WAFData.authenticatedRequest(e.url,{method:"POST",data:e.params,headers:e.headers,onComplete:function(e){var o;if(UWA.log("Notification Post Action Completed !"),e)try{o=JSON.parse(e)}catch(e){UWA.log("Notification post Action Error for json parse"+e),n.model.get("isInNotifCenter")&&n.updateActionedLabel(NLS.actionFailed,!1),n.model.dispatchEvent("updateLabel",[{id:n.model.get("id"),label:"NLS.actionFailed",flag:!1}])}o&&o.result&&o.result.success?(t=t||"NLS.actionLabel",n.model.get("isInNotifCenter")&&n.updateActionedLabel(t,!0),n.model.dispatchEvent("updateLabel",[{id:n.model.get("id"),label:t,flag:1===parseInt(n.model.get("shared"))}])):(n.model.get("isInNotifCenter")&&n.updateActionedLabel(NLS.actionFailed,!1),n.model.dispatchEvent("updateLabel",[{id:n.model.get("id"),label:"NLS.actionFailed",flag:!1}])),n.isMerge&&n.model.dispatchEvent("buttonLabelforMainMerge",{})},onFailure:function(e){UWA.log("Notification Post Action Failed !"),n.model.get("isInNotifCenter")&&n.updateActionedLabel(NLS.actionFailed,!1),n.model.dispatchEvent("updateLabel",[{id:n.model.get("id"),label:"NLS.actionFailed",flag:!1}]),n.isMerge&&n.model.dispatchEvent("buttonLabelforMainMerge",{})}})},csrf:function(e,t){var n=this;e&&e.csrf?WAFData.authenticatedRequest(e.csrf,{method:"GET",data:e.params,onComplete:function(o){var i;UWA.log("Notification csrf Action Completed !");try{i=JSON.parse(o)}catch(e){UWA.log("Notification Csrf Action Error for json parse"+e),n.updateActionedLabel(NLS.actionFailed,!1)}i&&(e.headers={"X-DS-SWYM-CSRFTOKEN":i.result.ServerToken},n.post(e,t))}}):UWA.log("Notification Csrf Action Failed some parameters are missing !")},cutText:function(e){this.oldText=e.innerHTML;for(var t=this.isTooLarge(e);e.innerText.length>3&&(this.countLines(e)>2||t);){var n=e.innerText;e.innerText="",n=n.substring(0,n.length-1-6),n+="...",e.innerText=n,e.style.display="none",e.offsetHeight,e.style.display="",t=this.isTooLarge(e)}},countLines:function(e){return e.offsetHeight/20},isTooLarge:function(e){return!(this.container.getElement(".RTnotif-alertboxbody").offsetWidth-48>e.offsetWidth)},adaptText:function(){var e=100,t=this.container.getElement(".RTnotif-span-Txt"),n=this.model.get("parentWidth");this.oldText=t.innerHTML;for(var o=!(n>t.offsetWidth);e>0&&o;){e-=1;for(var i=t.innerText,a=i.split(" "),r="",s=0;s<a.length;s++)a[s].length>r.length&&(r=a[s]);i=t.innerHTML.replace(r,r.substring(0,r.length/2)+" "+r.substring(r.length/2,r.length)),t.innerHTML=i,o=!(n>t.offsetWidth)}},getLocation:function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return t&&{protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]}},anonymize:function(){var e=this.container.getElement(".RTnotif-alertBody");e.onclick=null,e.onmouseover=null,this.container.getElement(".RTAlertActions")&&this.container.getElement(".RTAlertActions").destroy(),this.dropdownMenuClose.items[0].elements.container.destroy()},merge:function(e){var t,n,o=this;t=this.model.get("readState")?NLS.markGroupAsUnRead:NLS.markGroupAsRead,n=this.model.get("starredState")?NLS.removeGroupImportant:NLS.markGroupAsImportant,o.dropdownMenuMerged=new DropdownMenu({target:o.container.getElement(".RTnotif-alertCenterOptions"),closeOnClick:!1,items:[{text:t,fonticon:"bell",handler:function(e){if(o.mergeList){if(o.getReadstate())for(var t=0;t<o.mergeList.length;t++)o.mergeList[t].setReadstate(!1);else for(var n=0;n<o.mergedWrapper.getElements(".RTMainNotifAlert").length;n++)o.mergeList[n].setReadstate(!0);for(var i=o.mergedWrapper.getElements(".RTMainNotifAlert").length-1;i>=0;i--)o.model.dispatchEvent("readMerged",[{id:o.model.get("notifications")[i].ID,read:!o.getReadstate()}]);o.model.dispatchEvent("read",[{id:o.model.get("id"),read:!o.getReadstate()}])}else o.model.dispatchEvent("readHiddenMerged",[{id:o.model.get("id"),groupID:o.model.get("groupID"),read:!o.getReadstate()}]);o.dropdownMenuMerged.hide()}},{text:n,fonticon:"star",handler:function(e){if(o.mergeList){o.getStarredstate()?o.setStarredstate(0):o.setStarredstate(1);for(var t=o.mergedWrapper.getElements(".RTMainNotifAlert").length-1;t>=0;t--)o.model.dispatchEvent("starredMerged",[{id:o.model.get("notifications")[t].ID,starred:o.getStarredstate()}]);o.model.dispatchEvent("starred",[{id:o.model.get("id"),starred:o.getStarredstate()}])}else{let e=1;o.getStarredstate()&&(e=0),o.setStarredstate(e),o.model.dispatchEvent("starHiddenMerged",[{id:o.model.get("id"),groupID:o.model.get("groupID"),starred:o.getStarredstate()}]),o.model.dispatchEvent("starred",[{id:o.model.get("id"),starred:o.getStarredstate()}])}o.dropdownMenuMerged.hide()}},{text:NLS.unsubscribe,fonticon:"list-times",handler:function(e){e.stopPropagation()},items:[{text:NLS.unsubscribeForHour,fonticon:"list-times",handler:function(){o.dropdownMenuMerged.hide(),o.model.dispatchEvent("unsubscribe",[{forHour:!0}])}},{text:NLS.unsubscribeIndefinitely,fonticon:"list-times",handler:function(){o.dropdownMenuMerged.hide(),o.model.dispatchEvent("unsubscribe")}}]},{text:NLS.deleteGroup,fonticon:"trash",handler:function(){o.dropdownMenuMerged.hide(),o.model.dispatchEvent("delete",[{id:o.model.get("id"),groupID:o.model.get("groupID"),read:o.getReadstate()}])}}],events:{onHide:function(){o.container.getElement(".RTnotif-alertCenterOptions")&&(o.container.getElement(".RTnotif-alertCenterOptions").style.color="#b4b6ba"),o.model.dispatchEvent("removeDropDownMenu",{id:o.model.get("id")})},onShow:function(){o.model.dispatchEvent("addDropDownMenu",{id:o.model.get("id"),dropDown:o.dropdownMenuMerged})}}});let i=this.dropdownMenuMerged.items.length-2;this.dropdownMenuMerged.items[i].elements.container.style.cursor="default",o.countDiv=UWA.createElement("div",{class:"RTnotif-Mergecount"}).inject(o.container.getElement(".RTnotif-alertIcon")),o.mergeIcon=UWA.createElement("span",{class:"RTnotif-alertMergedImg fonticon fonticon-users"}).inject(o.countDiv),o.viewAllMerged=UWA.createElement("div",{class:"RTnotif-viewAll"}).inject(o.mergedWrapper),o.viewAllIcon=UWA.createElement("span",{class:"fonticon fonticon-expand-right"}).inject(o.viewAllMerged),o.viewAllspan=UWA.createElement("span",{text:NLS.viewAll,styles:{fontSize:"Arial regular 12pt",color:"#368ec4"}}).inject(o.viewAllMerged),o.viewMoreMerged=UWA.createElement("div",{class:"RTnotif-viewMore"}).inject(o.mergedWrapper),o.viewMoreMergedspan=UWA.createElement("span",{text:NLS.viewMore,styles:{fontSize:"Arial regular 12pt",color:"#368ec4"}}).inject(o.viewMoreMerged),o.viewMoreMerged.style.display=o.viewMoreMergedButton?"block":"none",o.viewAllMerged.onclick=function(){if(o.viewMerged){if(UWA.log("viewAllMerged "+alert.viewAllMerged),o.viewAllspan.textContent=NLS.hideAll,o.viewAllIcon.className="fonticon fonticon-expand-down",o.mergedWrapper.children.length>2){for(var e=1;e<o.mergedWrapper.children.length;e++)o.mergedWrapper.children[e].style.height="auto",o.mergedWrapper.children[e].style.display="block";o.viewMoreMerged.style.display=o.viewMoreMergedButton?"block":"none"}else o.model.dispatchEvent("getMerge",[{id:o.model.get("id"),groupID:o.model.get("groupID")}]);NotificationUsageTracker.trackCenterAction({eventAction:"viewAllMergeNotif",eventLabel:"View all merge notifications",eventValue:o.mergedWrapper.children.length}),o.viewMerged=!1}else{o.viewAllspan.textContent=NLS.viewAll,o.viewAllIcon.className="fonticon fonticon-expand-right",o.viewMoreMerged.style.display="none";for(e=1;e<o.mergedWrapper.children.length;e++)o.mergedWrapper.children[e].style.display="none";NotificationUsageTracker.trackCenterAction({eventAction:"hideAllMergeNotif",eventLabel:"Hide all merge notifications",eventValue:o.mergedWrapper.getElement.length}),o.viewMerged=!0}},o.viewMoreMerged.onclick=function(){o.model.dispatchEvent("setMerge",[{id:o.model.get("id"),groupID:o.model.get("groupID")}]),o.setMergeView(o.mergedCollection,o.model.get("notifications"))}},updateActionedLabel:function(label,flag,actor_data){var actionsWrapper=this.container.getElement(".RTAlertActions");if(this.numMerged>1)label=NLS.groupActionLabel;else if(label&&-1!=label.toString().indexOf("NLS"))label=eval(label);else if(flag&&1===parseInt(this.model.get("shared"))){var actor=" (by "+PlatformAPI.getUser().login+")";label&&(label+=actor)}else actor_data&&(label=label+" (by "+actor_data+")");if(0!=actionsWrapper.children.length)for(;0!=actionsWrapper.children.length;)actionsWrapper.removeChild(actionsWrapper.children[0]);this.actionLabel=UWA.createElement("span",{class:"item-text",styles:{color:"rgb(54, 142, 196)","font-weight":"bold"},text:label||NLS.actionLabel}).inject(actionsWrapper),actionsWrapper.style.display="block",actionsWrapper.style.marginLeft="48px",actionsWrapper.style.paddingLeft="5px",actionsWrapper.style.textAlign="initial"},setMergeView:function(e,t,n){var o=this;let i=e;if(!i)return;this.mergedCollection=i,o.model.set("notifications",t),this.numMerged=t.length,(o=this).mergeList=[],o.mergeUnreadFlag=!1;const a=o.mergedPage*MERGED_NOTIFS_MAX_DISPLAY,r=a+MERGED_NOTIFS_MAX_DISPLAY;for(let e=a;e<r;e++){let t=i._models[e];if(t){var s=new(0,o.constructor)({model:t});s.isMerge=!0,s.model=t,s._createContent(),s._addEvents(),s.getAppInfo(o.model.get("provider")),s.listenTo(o.model,"onChange:actioned",o.modelActioned),s.container.getElement(".RTnotif-alertImg").style.height="28px",s.container.getElement(".RTnotif-alertImg").style.width="28px",4===t.get("state")&&(s.setReadstate(!0),s.anonymize()),o.mergeList.push(s),s.model.addEvent("delete",function(e){o.numMerged--,s.destroy();var t=o.getElement(".RTnotif-span-Txt").innerHTML;if(1===o.numMerged)var n=('<strong class="mergecount">'+o.numMerged+"</strong>").toString();else n=('<strong class="mergecount">'+o.numMerged+"</strong>").toString();t=t.replace(/<strong class=.*?<\/strong>/,n),o.getElement(".RTnotif-span-Txt").innerHTML=t,s.model.dispatchEvent("deleteCenter",e),0===o.numMerged&&o.model.dispatchEvent("delete",{id:o.model.get("id"),read:o.model.get("readState")})}),s.model.addEvent("readStateforMainMerge",function(e){if(e.read){o.mergeUnreadFlag=!1;for(var t=0;t<o.mergeList.length;t++)if(!o.mergeList[t].getReadstate()){o.mergeUnreadFlag=!0;break}o.mergeUnreadFlag||o.getReadstate()||(o.setReadstate(!0),o.model.dispatchEvent("read",[{id:o.model.get("id"),read:o.getReadstate()}]),o.model.dispatchEvent("unreadCountDecrement",[{id:o.model.get("id"),read:o.getReadstate()}]))}else{var n=!1;for(t=0;t<o.mergeList.length;t++)if(!o.mergeList[t].getReadstate()){n=!0;break}n&&1!=o.container.getOpacity()&&(o.model.dispatchEvent("increaseCount",[{id:o.model.get("id"),read:!1}]),o.model.dispatchEvent("unreadMerge",[{id:o.model.get("id"),read:!1}])),o.setReadstate(!1)}}),s.model.addEvent("buttonLabelforMainMerge",function(){for(var e=!1,t=0;t<o.mergeList.length;t++)if(2===o.mergeList[t].container.getElement(".RTAlertActions").childElementCount||o.mergeList[t].container.getElement(".RTAlertActions").firstElementChild.hasClassName("btn")){e=!0;break}e||o.updateActionedLabel(NLS.groupActionLabel,!1)})}}for(var l=0;l<o.mergeList.length;l++)o.mergeList[l].container.style.display=n?"none":"block",o.mergedWrapper.appendChild(o.mergeList[l].container),o.mergeList[l].getReadstate()||(o.mergeUnreadFlag=!0);if(o.mergedPage+=1,t[r]?(o.viewMoreMergedButton=!0,o.viewMoreMerged.style.display="block"):(o.viewMoreMergedButton=!1,o.viewMoreMerged.style.display="none"),n&&null!=n.num)for(l=0;l<o.mergeList.length;l++)0===n.num&&o.mergeList[l].container.children[2].children[0]?o.mergeList[l].container.children[2].children[0].click():o.mergeList[l].caretDropDown.items[n.num-1]&&o.mergeList[l].caretDropDown.items[n.num-1].elements.container.click();else if(n&&n.button){var d;for(l=0;l<o.mergeList.length;l++)n.values&&(o.mergeList[l].values=n.values),"deny"===n.title?(d=o.mergeList[l].select?2:1,o.mergeList[l].container.children[2].children[d]&&o.mergeList[l].container.children[2].children[d].click()):o.mergeList[l].container.children[2].children[0]&&o.mergeList[l].container.children[2].children[0].click()}else o.mergeUnreadFlag?(o.setReadstate(!1),o.model.dispatchEvent("unreadMerge",[{id:o.model.get("id"),read:!1}])):o.setReadstate(!0)},closeNotifIfMobile:function(){if(!this.mobileDevice&!this.mobileCheckFlag){let t=!1;e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),this.mobileDevice=t,this.mobileCheckFlag=!0}var e;this.mobileDevice&&this.model.dispatchEvent("closeNotifCenter")},activateLink:function(){var e=this.container.getElement(".RTnotif-alertBody");e.onmouseover=function(){e.style.cursor="pointer"},e.onmouseout=function(){e.style.cursor="default"}},linkClickAction:function(e,t){if(this.activateLinkAction(e.options,t),this.numMerged>1)if(this.mergeList)for(var n=this.mergedWrapper.getElements(".RTMainNotifAlert").length-1;n>=0;n--)this.model.dispatchEvent("readMerged",[{id:this.model.get("notifications")[n].ID,read:!0}]),this.mergeList[n].setReadstate(!0);else this.model.dispatchEvent("readHiddenMerged",[{id:this.model.get("id"),groupID:this.model.get("groupID"),read:!0}]);this.isMerge&&this.model.dispatchEvent("readStateforMainMerge",{read:this.getReadstate()}),this.model.dispatchEvent("read",[{id:this.model.get("id"),read:!0}]),this.model.dispatchEvent("actioned",[{id:this.model.get("id"),actioned:!0}])},activateLinkAction:function(e,t){if(this._checkUrlAction(e)){var n=e.event.options,o=e.actioned_label;n.appID=this.model.get("provider"),"GET"===n.type?this.activateGetAction(n,t):"POST"===n.type&&this.activatePostAction(n,o),this.getCenterState()&&this.model.get("merged")?this.setReadstate(!0):this.close({decrementFlag:!0})}},activateGetAction:function(e,t){if(e&&(e.url||e.uri)){var n=this,o=e.url,i=n.model.get("platformId");if(!i)return UWA.log("[NOTIFALERT activateGetAction] Missing tenant in notification."),o?n.openInNewTab(o):UWA.log("[NOTIFALERT activateGetAction] Missing tenant and url in notification, unable to navigate.");n.getLocation(o)||(o=n.appID[n.model.get("provider")].platforms[i].url+e.uri);var a=n.getLocation(o),r="USASWYM_AP"==n.model.get("provider"),s=n.appName&&"3dswym"==n.appName.toLowerCase()||a.host&&a.host.contains("3dswym"),l=n.mobileDevice||["localhost","127.0.0.1","","::1"].includes(window.location.hostname);r&&s&&!l?n.appID[n.model.get("provider")]&&n.appID[n.model.get("provider")].platforms&&n.appID[n.model.get("provider")].platforms[i]?(o=n.appID[n.model.get("provider")].platforms[i].url+e.uri,n.openNotification(o,i,t)):i3DXCompassPlatformServices.getServiceUrl({serviceName:"3DSwym",platformId:i,onComplete:function(a){"object"==typeof a?o=a[0].url+e.uri:"string"==typeof a&&(o=a+e.uri),n.openNotification(o,i,t)}}):(r&&l&&(o=window.location.origin+"/"+e.uri),n.openNotification(o,i,t))}},openNotification:function(e,t,n){if(e&&t){var o=this.getLocation(e);if(n)return this.openInNewTab(e);var i,a,r=this.currentTenant||PlatformAPI.getTenant();if(!r){var s=(i=window.parent.location.host,(a=i.match(/^([A-z0-9]+)([-]|[.])(.*)$/))&&{platformId:a[1]});if(!s||!s.platformId)return UWA.log("[NOTIFALERT activateGetAction] Unknown current tenant."),this.openInNewTab(e);r=s.platformId}if(t.toLowerCase()==r.toLowerCase()){const t=this.appName&&this.appName.toLowerCase(),n=this.getServiceForNotification(o);if(this.isSameService(e,window.parent.location)||n===t){var l="3ddashboard"===t||o.host&&o.host.contains("ifwe")&&!o.host.contains("ifweloop"),d=Transient.isWidgetOpen(),c=o&&o.hash&&o.hash.contains("app")||n===t;if(!l||l&&!d&&c)return this.openInSameTab(e,window.parent.location.hash)}else{var p="USASWYM_AP"==this.model.get("provider"),m="my3dexperience"===t||o.host&&o.host.contains("my3dexperience"),g=this.mobileDevice||["localhost","127.0.0.1","","::1"].includes(window.location.hostname);if(p&&(g||m))return this.openInSameTab(e,window.parent.location.hash)}}return"X3DOPMR_AP"===this.model.get("provider")&&t&&(e=e+"/content:x3dPlatformId="+t.trim()),this.openInNewTab(e)}},openInSameTab:function(e,t){const n=this.getLocation(e);if(n.hash===t)e.contains("ifweloop")||e.contains("innovate")||e.contains("engineering")?(window.parent.document.location.href=e,this.closeNotifIfMobile()):PlatformAPI.publish("common.3DNotification.topic",{action:"refresh",data:{url:e}});else{var o=this.model.get("platformId");if("X3DOPMR_AP"===this.model.get("provider")&&o)if(window.parent.document.location.hash.contains("app:X3DOPMR_AP")){var i=UWA.Utils.getQueryString(window.parent.document.location.hash,"content:x3dPlatformId");window.parent.document.location.hash=i?window.parent.document.location.hash.replace(i,o.trim()):window.parent.document.location.hash+"/content:x3dPlatformId="+o.trim()}else window.parent.document.location.hash=n.hash+"/content:x3dPlatformId="+o.trim();else"USASWYM_AP"==this.model.get("provider")?PlatformAPI.publish("common.3DNotification.topic",{action:"refresh",data:{url:e}}):n.hash&&""!==n.hash?window.parent.document.location.hash=n.hash:n.search&&""!==n.search?window.parent.document.location.hash=`app:${this.model.get("provider")}/content:${n.search}`:window.parent.document.location.hash=n.hash;this.closeNotifIfMobile()}},activatePostAction:function(e,t){e&&e.url&&(e.csrf?this.csrf({csrf:e.csrf,url:e.url,params:e.options&&e.options.data?e.options.data:void 0,headers:e.options&&e.options.headers?e.options.headers:void 0},t):this.post({url:e.url,params:e.options&&e.options.data?e.options.data:void 0,headers:e.options&&e.options.headers?e.options.headers:void 0},t))},openInNewTab:function(e){if(e)window.open(e,"_blank")},renderDropDownMenu:function(e){var t=this;t.dropdownMenuClose=new DropdownMenu({target:t.container.getElement(".RTnotif-alertCenterOptions"),items:e,closeOnClick:!1,events:{onHide:function(){t.container.getElement(".RTnotif-alertCenterOptions")&&(t.container.getElement(".RTnotif-alertCenterOptions").style.color="#77797C"),t.model.dispatchEvent("removeDropDownMenu",{id:t.model.get("id")})},onShow:function(){t.model.dispatchEvent("addDropDownMenu",{id:t.model.get("id"),dropDown:t.dropdownMenuClose})}}});for(var n=0;n<t.dropdownMenuClose.items.length;n++)t.dropdownMenuClose.items[n].name!=NLS.markAsRead&&t.dropdownMenuClose.items[n].name!=NLS.markAsUnread||(t.readIndex=n),t.dropdownMenuClose.items[n].name!=NLS.markAsImportant&&t.dropdownMenuClose.items[n].name!=NLS.removeImportant||(t.starredIndex=n);let o=t.dropdownMenuClose.items.length-2;t.dropdownMenuClose.items[o].elements.container.style.cursor="default"},getOpenWithMenu:function(e){let t=[];var n=this;return new Promise(function(o,i){e.retrieveCompatibleApps(function(e){e&&0!=e.length?(console.log("APPLIST",e),e.forEach(function(e){t.push({text:e.text,icon:e.icon,className:"app-widget",handler:function(){n.isMerge&&(n.setReadstate(!n.getReadstate()),n.model.dispatchEvent("readStateforMainMerge",{read:n.getReadstate()})),n.model.dispatchEvent("read",[{id:n.model.get("id"),read:!0}]),e.handler(),n.dropdownMenuClose.hide()}})}),o(t)):i("No compatible apps found")})})},isSameService:function(e,t){return Utils.matchUrl(e,t)},getServiceForNotification:function(e){if(!e)return;let t;return e&&e.search&&(t=e.search.match(/.*&serviceForNotification=([^&]*)/)),t&&t[1]?t[1].toLowerCase():void 0}});return iView});