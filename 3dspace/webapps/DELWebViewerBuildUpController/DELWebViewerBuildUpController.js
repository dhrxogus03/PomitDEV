define("DS/DELWebViewerBuildUpController/BuildUpCommandsBehavior",["UWA/Core","DS/DELPPRData/Buildup/BuildUpSettings"],function(e,t){"use strict";return function(e,n,i){const r=i.getOption("mappingKeys");var o=n.getInstance("BuildUpBehaviorModelService"),l=i.getOption("eventCollection").getViewerCtrlEventHnd(),u=function(){return e.getMode()===r.VIEWERMODES.BUILDUP},a=function(e){let n;e&&u()&&(n=o.getBuildUpGlobalSettings())&&(t.updateBuildUpColorSettings(n,e.state),o.setBuildUpGlobalSettings({settings:n}))},s=function(e){let n;e&&u()&&(n=o.getBuildUpGlobalSettings(),t.updateBuildUpDisplayCategorySettings(n,e.category,e.settings),o.setBuildUpGlobalSettings({settings:n}))},p=function(){if(u()){let e=o.getProcessInfo();o.updateBuildUpSettings({processId:e&&e.processId?e.processId:null,clear:!0})}};return function(){var e={onShowBuildupColorChange:a,onBuildUpDisplayOptionsChange:s,onBuildUpDisplayOptionsReset:p};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&l.subscribe(l.events[t],e[t])}(),{reset:function(){}}}}),define("DS/DELWebViewerBuildUpController/BuildUpHelper",["UWA/Core","DS/DELPPRData/Buildup/BuildUpSettings","DS/DELWebViewerUtils/Utils"],function(e,t,n){"use strict";return function(n,i,r){var o=r.getOption("logger"),l=i.getInstance("BuildUpBehaviorModelService"),u=r.getOption("mappingKeys"),a=u.GRAPHICPROPERTIES;return{set:l.set,getCurrentBuildUpContent:function(){let t,n=l.get("currentBuildupContent");return n&&(t=e.clone(n,!0)),t},setCurrentBuildUpContent:function(e){l.set("currentBuildupContent",e)},removeCurrentBuildUpContent:function(){l.set("currentBuildupContent",null)},isBuildUpApplied:function(){return e.is(l.get("currentBuildupContent"))},getBuildUpData:async function(t){let n=[],i=l.getProcessInfo();if(!(t&&e.is(t.path,"array")&&t.path.length>0)){let e=new Error(r.getNLSValue("Error.StepPathInvalid.Message"));throw e.code="DELVIEWER_E001",e}return o.info("getBuildUpData method invoked with parameters :",t),n=await l.getBuildUp(function(t){var n=e.clone(t);return e.is(n.session,"object")||(n.session={}),e.is(n.scopedMfg,"object")||(n.scopedMfg={}),n.session.id=n.session.id?n.session.id:i&&i.sesssionId?i.sesssionId:null,n.scopedMfg.id=n.scopedMfg.id?n.scopedMfg.id:i&&i.mfgId?i.mfgId:null,n.id=n&&n.id?n.id:i&&i.processId?i.processId:null,n}(t)),e.is(n)||(n=[]),n},getBuildUpGlobalSettings:function(){return l.getBuildUpGlobalSettings()},reset:function(){n&&n.reset(),l.reset()},destroy:function(){l&&l.destroy(),o=l=u=a=null},getComputedBuildUpData:function(n){var i=[],r=t.getParsedBuildUpSettings(l.getBuildUpGlobalSettings());return o.info("getComputedBuildUpData method invoked with parameters : ",n),e.is(n,"array")&&(i=n.map(function(n){var i,o,l={},s=n[u.BUILDUPKEYS.CATEGORY]?n[u.BUILDUPKEYS.CATEGORY].toLowerCase():"";return s?(i=t.getGraphicProperties(r,s),l[u.BUILDUPKEYS.PATH]=n[u.BUILDUPKEYS.PATH],i&&(o=e.is(i[a.VISIBILITY],"boolean")?i[a.VISIBILITY]:null,l[a.VISIBILITY]=o,l[a.VISIBILITYFREE]=!o,l[a.COLOR]=i[a.COLOR]?i[a.COLOR]:null,l[a.OPACITY]=e.is(i[a.OPACITY],"number")?i[a.OPACITY]:null),l[u.BUILDUPKEYS.POSITION]=n[u.BUILDUPKEYS.POSITION]?n[u.BUILDUPKEYS.POSITION]:"",l[u.BUILDUPKEYS.CATEGORY]=s,l.type=n.type):l=n,l})),i},isObjectAvailable:l.isObjectAvailable}}}),define("DS/DELWebViewerBuildUpController/BuildUpController",["UWA/Core","DS/DELWebViewerBuildUpController/BuildUpHelper","DS/DELWebViewerBuildUpController/BuildUpCommandsBehavior"],function(e,t,n){"use strict";return function(i,r,o,l){let u;var a=l.getOption("logger"),s=r.getToolBar(),p=l.getOption("eventCollection").getModelCtrlEventHnd(),d=s?new n(r,o,l):null,c=new t(d,o,l),g=l.getOption("eventCollection").getViewerCtrlEventHnd(),f=l.getOption("mappingKeys"),U=function(t){s&&e.is(t,"boolean")&&(t?s.show():s.hide())},B=[],h=[],I=function(){B.length>0&&(r.getContext().getController().unlockNodes({ids:B}),B=[])},C=function(){r.removeSceneGraphOverrideSet(f.SCENEGRAPHKEYS.PUBLIC)},S=function(t){return function(t){return new e.Promise(function(n,i){var r;e.is(c.getBuildUpGlobalSettings(),"object")?n(t):(r=l.getNLSValue("Error.BuildUpSettingsNotFound.Message"),a.error(r),i(r))})}(t).then(function(t){return new e.Promise(function(n,i){var r;e.is(t.path,"array")?n(t):(r=l.getNLSValue("Error.StepPathInvalid.Message"),a.error(r),i(r))})}).then(function(e){return c.getBuildUpData(e)}).then(function(e){return c.getComputedBuildUpData(e)})},P=function(t,n){let i=!t||!1!==t.clear;return new e.Promise(function(o,s){var p=function(){r.render(),g.publish(g.events.onGlobalBuildUpComplete,c.getCurrentBuildUpContent()),o(n)};e.is(n,"array")?(u.isBuildUpApplied()&&!i||C(),r.setPickability(f.PICKABILITY.BUILDUP),r.deleteOverrides(f.SCENEGRAPHKEYS.BUILDUP),U(!0),c.set("currentBuildupContent",{pathIds:t.path,graphicData:n}),n.length>0?r.setGraphicProperties({graphicProperties:n},f.SCENEGRAPHKEYS.BUILDUP).then(function(){p()}).fail(s):p()):(a.error("BuildUp Graphic data not found"),s(l.getNLSValue("Error.GraphicDataNotFound.Message")))})},E=function(){let e=c.getCurrentBuildUpContent();if(e){let t=c.getComputedBuildUpData(e.graphicData);P({path:e.pathIds,clear:!1},t)}};return function(){if(g&&p){let e=[{name:p.events.onSetBuildUpGlobalSettingsComplete,callback:E,handler:p}];for(let t of e)h.push({handler:t.handler,token:t.handler.subscribe(t.name,t.callback)})}}(),u={applyBuildUp:function(t){let n=async function(t){var n=[],i=r.getContext().getController();return l.getOption("forceLoad")?(I(),e.is(t,"array")&&t.forEach(function(t){var r;t&&t[f.BUILDUPKEYS.CATEGORY]&&t[f.BUILDUPKEYS.CATEGORY].toLowerCase()===f.BUILDUPCATEGORY.Implement&&e.is(t.path,"array")&&t.path.length>0&&(r=t.path[t.path.length-1],i.isRegistered(r)&&!i.getNode({id:r})&&function t(n,i){var r=n.getChildren();0===r.length&&e.is(n.getReferenceId)&&n.isRepRef()&&-1===i.indexOf(n.getReferenceId())&&i.push(n.getReferenceId()),r.forEach(function(e){var n=e.getReferenceIterator();t(n,i)})}(i.createReferenceIterator(r),n))}),a.debug("3DShape reference ids to force load : ",n),n.length>0&&(B=n,i.lockNodes({ids:B}),await new Promise(e=>{i.setForceReferencesLoad({data:n.map(function(e){return{id:e,state:!0}}),callback:e})}),a.debug("Forcely loaded 3DShape successfully for ids : ",n)),t):t},i=function(e){var t=[];c.isObjectAvailable(f.BUILDUPKEYS.BUILDUPDEFKEYS.PLANNINGOBJECTS)&&(e.forEach(function(e){e.type!==f.BUILDUPKEYS.BUILDUPDEFKEYS.PLANNINGOBJECTS||r.isRegistered(e[f.BUILDUPKEYS.PATH])||t.push({path:e[f.BUILDUPKEYS.PATH]})}),t.length>0&&r.addRoots({objects:t},!0,!1))};return new e.Promise(function(e,r){U(!1),S(t).then(n).then(P.bind(this,t)).then(i).then(e).fail(function(e){r(e)})})},applyCurrentBuildUp:function(){let e=c.getCurrentBuildUpContent();e&&e.graphicData?r.setGraphicProperties({graphicProperties:e.graphicData},f.SCENEGRAPHKEYS.BUILDUP).then(r.render).fail(function(e){a.error(e)}):a.error("Current Operation data not found.")},getCurrentBuildUpContent:function(){return c.getCurrentBuildUpContent()},isBuildUpApplied:function(){return c.isBuildUpApplied()},removeBuildUp:function(e=!0){c.removeCurrentBuildUpContent(),r.removeSceneGraphOverrideSet(f.SCENEGRAPHKEYS.BUILDUP),C(),e&&r.render(),U(!1),g.publish(g.events.onGlobalBuildUpRemoved,{}),I(),r.setPickability(f.PICKABILITY.DEFAULT)},initializeBuildup:function(t={}){let n=o.getInstance("BuildUpBehaviorModelService"),i=l.getOption("dynamicBuildUp"),u=function(e,n){let i={info:"Info",warning:"Warn"};if(!0===t.displayNotif){let t=i[e],o={eventID:e,msg:l.getNLSValue(`${t}.${n}.Message`),message:l.getNLSValue(`${t}.${n}.Message`),title:l.getNLSValue(`${t}.${n}.Title`),level:e};r.getContext().displayNotification(o)}};return new e.Promise(function(e,r){t&&t.processId&&t.mfgId?n.initialize(t).then(function(){!0!==i&&u("info",t.publishedRepId?"FilteredPublishedContentFound":"FullPublishedContentFound")}).then(e).catch(function(e){let t=new Error(e);t.code="DELVIEWER_E002",u("warning",i?"DynamicContentNotFound":"PublishedContentNotFound"),r(t)}):r(l.getNLSValue("Error.InvalidInput.Message"))})},reset:function(){u.removeBuildUp(),c.reset()},destroy:function(){[c].forEach(e=>{e&&e.destroy()}),f&&r.removeSceneGraphOverrideSet(f.SCENEGRAPHKEYS.BUILDUP),I(),h&&h.forEach(function(e){e.handler.unSubscribe(e.token)}),h=[],a=c=g=f=B=null},getPartPosition:function(t){var n=function(e){return c.getBuildUpData({path:e})},i=function(n){return new e.Promise(function(e,i){var r=n.filter(function(e){var n=e[f.BUILDUPKEYS.PATH];return!(!(n&&n.length>1)||(t.part.path?n.toString().replace(/\s/g,"")!==t.part.path.toString().replace(/\s/g,""):!t.part.id||n[n.length-1]!==t.part.id&&n[n.length-2]!==t.part.id))});r&&r.length>0?e(r):i(l.getNLSValue("Error.PartNotFound.Message"))})},r=function(e){return e.map(function(e){return{path:e.path,position:e.position}})};return a.debug("BuildUpController::getPartPosition event received with parameters :",t),new e.Promise(function(u,s){new e.Promise(function(e,n){t&&t.operation?t.operation.path?e(t.operation.path):o.getOperationPath(t.operation.id).then(e).fail(n):n(l.getNLSValue("Error.InvalidInput.Message"))}).then(n).then(i).then(r).then(u).fail(function(e){a.error("BuildUpController::getPartPosition failed due to ",e),s(e)})})},getBuildUpGlobalContent:async function(e){return await S(e)}}}});