define("DS/LifecycleRecycleBinWidget/actions/RestoreExecutionService",["UWA/Controls/Abstract","DS/WAFData/WAFData","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e),this.securityContext=e.securityContext,this.tenant=e.tenant},using:function(e){return this.data=e,this},run:function(){var e={restoreRequests:[]};this.data.forEach(t=>{e.restoreRequests.push({id:t.objectId})});var n=i.get3DSpaceWSUrl(this.tenant,"/resources/v1/dslc/restoreversion",null),c=i.getHeaders(encodeURIComponent(this.securityContext));return new Promise(i=>{t.authenticatedRequest(n,{method:"POST",type:"json",headers:c,timeout:6e5,data:JSON.stringify(e),onComplete:function(e){i({OK:e})},onFailure:function(e,t,n){t&&console.log(t),i({error:t||e,waf_error:e})},onTimeout:function(){console.log("webservice failed: A connection timeout occured."),i({error:"timeout"})}})})},parseResults:function(e,t,i){var n=e.restoreRequests.length,c=0,o=0;"ERROR"===e.severity?o++:e.restoreRequests.forEach(function(e){if("SUCCEEDED"==e.status){c++;var t={physicalid:e.id,operation:"Restore"};i.created.push(t)}}),t.nresults=n,t.n_success=c,t.n_failure_error_not_in_recycle_bin=0,t.n_failure_error_branch_name_conflict=0,t.n_failure_other=o,t.notifications_messages=[],t.show_index_update_info=!1}})}),define("DS/LifecycleRecycleBinWidget/LifecycleRecycleBinWidget",[],function(){return{}}),define("DS/LifecycleRecycleBinWidget/RecycleBinAction",["UWA/Controls/Abstract","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/LifecycleCmd/MessageMediator","DS/PADServices/utils/PlatformURL","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/LifecycleServices/LifecycleAlert"],function(e,t,i,n,c,o,r,s,a,l){"use strict";return e.extend({context:null,init:function(){},Restore:function(e,t,i){this._launchRestoreServiceOperation(e,t,i)},Delete:function(e,t,i){this._launchDeleteServiceOperation("Delete",e,t,i)},_launchRestoreServiceOperation:function(e,t,i){console.log("RecycleBinAction _launchRestoreServiceOperation ");var n=this;if(t&&0!=t.length){var c="";if(e.hasOwnProperty("context")&&(this.context=e.context,"function"==typeof this.context.getSecurityContext)){var o=this.context.getSecurityContext();c=o.SecurityContext}var s=r.getPlatformId(),a=[];t.forEach(function(e){if(e.hasOwnProperty("id")&&""!=e.id){var t={objectId:e.id};a.push(t)}if(e.hasOwnProperty("physicalid")&&""!=e.physicalid){t={objectId:e.physicalid};a.push(t)}}),require(["DS/LifecycleRecycleBinWidget/actions/RestoreExecutionService"],function(e){var t=new e({securityContext:c,tenant:s});t.using(a);console.log("running restore:"),t.run().then(e=>{if(e.OK){console.log("restore execution succeeded");var c={},o={created:[],deleted:[],modified:[]};t.parseResults(e.OK,c,o),n.manageAppRefreshAndUserNotification("Restore",i,c,o,{sticky:!0})}else e.error?(console.log("restore execution failed: "+e.error),n.manageAppRefreshAndUserNotification("Restore",i,e.error,null,{sticky:!0})):(console.log("restore execution failed: (no error)"),n.manageAppRefreshAndUserNotification("Restore",i,null,null,{sticky:!0}))})})}},_launchDeleteServiceOperation:function(e,o,s,a){console.log("RecycleBinAction _launchDeleteServiceOperation "+e);var l=this,d="";o.hasOwnProperty("context")&&(this.context=o.context,"function"==typeof this.context.getSecurityContext&&(d=this.context.getSecurityContext().SecurityContext));var u=r.getPlatformId(),f=[];s.forEach(function(e){if(e.hasOwnProperty("id")&&""!=e.id){var t={objectId:e.id};f.push(t)}if(e.hasOwnProperty("physicalid")&&""!=e.physicalid){t={objectId:e.physicalid};f.push(t)}});var h=e,y="/resources/lifecycle/Delete/"+h,p={data:f},_=n.get3DSpaceWSUrl(u,y,null),g=n.getHeaders(encodeURIComponent(d));c.authenticatedRequest(_,{method:"POST",type:"json",headers:g,timeout:6e5,data:JSON.stringify(p),onComplete:function(e){var t={},i={created:[],deleted:[],modified:[]};l.parseResults(h,e,t,i),l.manageAppRefreshAndUserNotification(h,a,t,i)},onFailure:function(e,t){console.log("RecycleBinActionServer Request Failure"+e),l.showError(i.parseWebServiceError(e,t))},ontimeout:function(){l.showError(t.timeout)}})},parseResults:function(e,t,i,n){var c=t.results.length,o=0,r=0,s=0,a=0,l=0,d=[];t&&Array.isArray(t.results)&&t.results.forEach(function(e){"success"==e.status?o++:"failure"==e.status&&(e.hasOwnProperty("error")?"error_no_access"==e.error||"error_incorrect_state"==e.error?r++:"error_not_implemented"==e.error?s++:"error_branch_name_conflict"==e.error?a++:l++:l++),e.hasOwnProperty("notification")&&d.push(e.notification)}),i.nresults=c,i.n_success=o,i.n_failure_error_not_in_recycle_bin=r,i.n_failure_error_not_implemented=s,i.n_failure_error_branch_name_conflict=a,i.n_failure_other=l,i.notifications_messages=d,i.show_index_update_info=!1,c>0&&t.results.forEach(function(t){if("success"==t.status&&"logicalDelete"==e){var i={physicalid:t.objectId};n.deleted.push(i)}})},manageAppRefreshAndUserNotification:function(e,i,n,c,o){var r=this,s=e;let l={};"Delete"==e?(s=t.recycleBinDelete,l.actionName="Delete"):"Restore"==e&&(s=t.recycleBinRestore,l.actionName="Restore");var d=n.nresults||0,u=n.n_success||0,f=n.n_failure_error_not_in_recycle_bin||0,h=n.n_failure_error_not_implemented||0,y=n.n_failure_error_branch_name_conflict||0,p=n.n_failure_other||0,_=n.notifications_messages||[],g=n.show_index_update_info||!1;if(l.numberObjects=d,u>0){var v=t.recycleBinSuceeded.replace("{0}",s);this.showSuccess(v,{sticky:!!o&&o.sticky}),g=!0,l.actionStatus="success"}if(f>0){var S=null;S=0==u&&1==d?t.recycleBinObjectNotFound.replace("{0}",s):0==u&&d>1?t.recycleBinMultipleObjectsNotFound.replace("{0}",s):t.recycleBinSomeObjectsNotFound.replace("{0}",s),this.showError(S),l.actionStatus="partial_success"}if(h>0){S=t.recycleBinNotImplemented.replace("{0}",s);this.showError(S),l.actionStatus="failure"}if(y>0){S=t.recycleBinDuplicateRevisionName.replace("{0}",s);this.showError(S),l.actionStatus="failure"}if(p>0){S=null;S=0==u?t.recycleBinFailed.replace("{0}",s):t.recycleBinPartiallyFailed.replace("{0}",s),this.showError(S),l.actionStatus="failure"}if(_.forEach(function(e){r.showInformation(e,{sticky:!!o&&o.sticky})}),1==g){var m=t.recycleBinIndexUpdate;this.showInformation(m,{sticky:!!o&&o.sticky})}u>0&&"Delete"!=e&&this.refreshAppContent(e,null,c),i.trackerEvent=a.createValidationEventFromEvent(l,i.trackerEvent),a.checkAndTrackPageEvent(i.trackerEvent)},refreshAppContent:function(e,t,i){(i=i||{created:[],deleted:[],modified:[]}).context=this.context,o.dispatchEvent("onModification",i)},showSuccess:function(e,t){if("function"==typeof this.context.displayNotification){var i={eventID:"success",msg:e};t.sticky&&(i.sticky=!0),l.displayNotification(i)}console.log(e)},showError:function(e){if("function"==typeof this.context.displayNotification){var t={eventID:"error",msg:e};l.displayNotification(t)}console.log(e)},showInformation:function(e,t){if("function"==typeof this.context.displayNotification){var i={eventID:"info",msg:e};t.sticky&&(i.sticky=!0),l.displayNotification(i)}console.log(e)}})}),define("DS/LifecycleRecycleBinWidget/LogicalDeleteWidget",["UWA/Controls/Abstract","DS/LifecycleRecycleBinWidget/RecycleBinAction"],function(e,t){"use strict";return e.extend({init:function(e){},_onComplete:function(){},executeCmd:function(e,i,n){console.log("LogicalDeleteWidget executed"),this._onComplete=function(){n()},(new t).LogicalDelete(i,e),this._onComplete()}})}),define("DS/LifecycleRecycleBinWidget/RecycleBinSearch",["UWA/Class","UWA/Core","UWA/Utils/InterCom","UWA/Utils","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/LifecycleRecycleBinWidget/RecycleBinAction","DS/ENOCollabToolsUI/tracker/ENOCollabTracker"],function(e,t,i,n,c,o,r,s){"use strict";return e.singleton({init:function(){var e="search_recycle_bin_socket_"+n.getUUID();this.socket=new i.Socket(e,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.recycleBinOptions="",this.appOptions="",this.recycleBinAction=new r,this.registeredDone=!1},activate:function(e){console.log("RecycleBinSearch activate");var t=this,i=widget.getView();this.widgetViewBefore=i?i.type:void 0,console.log("RecycleBinSearch widget state before activate: "+this.widgetViewBefore),this.appOptions=e,this.recycleBinOptions=this._getRecycleBinSearchOptions(e);this.trackerEvent=s.createInitActionEvent({UXName:"Recycle Bin",numberObjects:0},this.trackerEvent),0==this.registeredDone?(this.socket.dispatchEvent("RegisterContext",this.recycleBinOptions),this.socket.addListener("RegisterContext_Response",function(){t.registeredDone=!0,t.socket.removeListener("RegisterContext_Response"),t.socket.addListener("Selected_global_action",t.Selected_global_action.bind(t)),t.socket.addListener("onCloseTransient",function(){t.deactivate()}),t.socket.dispatchEvent("InContextSearch",t.recycleBinOptions),s.checkAndTrackPageEvent(t.trackerEvent)})):(this.socket.dispatchEvent("InContextSearch",t.recycleBinOptions),s.checkAndTrackPageEvent(t.trackerEvent))},deactivate:function(){if(console.log("RecycleBinSearch deactivate"),1==this.registeredDone){this.socket.removeListener("Selected_global_action"),this.socket.removeListener("onCloseTransient");var e={widget_id:this.recycleBinOptions.widget_id};this.socket.dispatchEvent("UnregisterContext",e),this.registeredDone=!1}},Selected_global_action:function(e){"Restore"==e.id?(console.log("RecycleBinSearch Restore"),this.recycleBinAction.Restore(this.appOptions,e.selected_objects,this)):"Delete"==e.id&&(console.log("RecycleBinSearch Delete"),this.recycleBinAction.Delete(this.appOptions,e.selected_objects,this))},_getRecycleBinSearchOptions:function(e){var t={},i="";if(e.hasOwnProperty("context")){var r=e.context;if("function"==typeof r.getSecurityContext)i=r.getSecurityContext().SecurityContext.replace("ctx::","")}c.getUser();var s=o.getPlatformId();return t.app_socket_id=this.socket.id,t.widget_id="recycle_bin_"+n.getUUID(),t.tenant=s,t.role=i,t.source=["3dspace"],t.app_id="ENOLCMI_AP",t.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0}}},t.default_with_precond=!0,t.show_precond=!1,t.title="Recycle Bin",t.precond="availability:branchDeactivated",t.mode="",t.global_actions=[{id:"Restore",title:"Restore",icon:"navigation-history",overflow:!1},{id:"Delete",title:"Delete",icon:"trash",overflow:!1}],t.idcard_activated=!1,t.select_result_max_idcard=!1,t.UXOptions={lastIndexationTime:!0,searchRecentContent:!1,globalToolbarActions:{informations:!1,export:!1,saveAsFavorite:!1,print:!1},menuMyFavorites:!1,menuMyContent:!0,localActions:!1,dnD:!1,dblClk:!1,viewMode:"table"},t.multiSel=!0,t.columns=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:deletedate","ds6w:deletedby"],t.order_field="ds6w:deletedate",t.order_by="desc",t}})}),define("DS/LifecycleRecycleBinWidget/RecycleBinWidget",["UWA/Controls/Abstract","DS/LifecycleRecycleBinWidget/RecycleBinSearch"],function(e,t){"use strict";return e.extend({init:function(e){},_onComplete:function(){},executeCmd:function(e,i,n){console.log("RecycleBinWidget executed"),this._onComplete=function(){n()},t.activate(i),this._onComplete()}})});