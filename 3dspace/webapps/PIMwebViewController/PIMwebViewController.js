/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebViewController/PIMwebItfCtrl",["UWA/Class","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/PIMwebViewModel/PIMwebUtils","DS/CATWebUXSlideShow/CATWebUXSlideShowController","DS/PIMwebUX/PIMwebDetailedItfListUI","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/PIMwebViewModel/PIMwebIsrMgr","DS/PIMwebUX/PIMwebOpacitySlider","DS/PADUtils/PADUtilsServices","DS/CATWebUXComponents/CATWebUXUtils","DS/CATWebUXComponents/CATWebUXPanel","DS/Windows/Dialog","DS/Controls/Button","DS/Visualization/IdPath","DS/Visualization/IdPathMatcher","DS/PIMwebPreferences/PIMwebPreferences","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/ModelEvents","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/PIMwebViewController/assets/nls/PIMwebItfCtrl","i18n!DS/PIMwebUX/assets/nls/PIMwebItfListUI","i18n!DS/PIMwebViewController/assets/nls/PIMwebGenerateTICCmd","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],function(e,t,n,i,r,a,o,s,l,c,u,f,d,p,h,m,g,y,C,b,I,P,v,S,w,D,M,x,A){"use strict";function T(e,t){return!(!t||!t.length)&&e.isReferenceComplete(t[t.length-1].physicalid)}function O(e,t){return!(!t||!t.length)&&!1!==e.hasMeshInRAM(t[t.length-1].physicalid)}function L(e,t){return!!t&&t.every(e.isRegistered,e)}function E(e,t){var n,i,r,a;if(e&&e.length)for(r=t.getRootBagPath(),n=0,i=e.length;n<i;++n){if(!(a=t.getNode({id:e[n].physicalid}))){r=null;break}r.addElement(a)}return r&&r.checkExternalPath()?r:null}function k(e,t){function n(e,t){var n=0;e.itfLblSlide=0,Object.keys(t).forEach(function(i){t[i].row.itfLblSlide&&(e.itfLblSlide=(e.itfLblSlide?e.itfLblSlide:0)+t[i].row.itfLblSlide,t[i].row.itfNonUniqueSlide&&!n&&t[i].row.itfNonUniqueSlide.forEach(function(t){t&&e.ctxChilds.every(e=>t.includes(e))&&(e.itfLblSlide=e.itfLblSlide-e.childIds.length+1)}),++n)})}var i,r=(i="mID",e.reduce(function(e,t){var n=t[i]?i:"itfuid";return void 0===t[n]?e:Object.assign(e,{[t[n]]:(e[t[n]]||[]).concat(t)})},{})),a=[];return Object.keys(r).forEach(function(e){var i=r[e];e||(e=i[0].itfuid);var o=Object.assign({row:{},children:{}},t[e]?t[e]:{}),s=function(e){var n=Object.assign({},e,{itfLblSlide:t[e.mID]&&t[e.mID].row?t[e.mID].row.itfLblSlide:""});return n.icons=e.isNonPersistentPIM?[]:["I_PIMInterference.png"],n.itfuid=e.mID?e.mID:e.itfuid,n.itfName=n.tree=e.itfMetricName?e.itfMetricName:e.itfCtxName,delete n.itfCtxName,delete n.itfLblInst1Path,delete n.itfLblInst2Path,delete n.itfLblRef1Path,delete n.itfLblRef2Path,n}(i[0]);s.childIds=o.row.childIds?o.row.childIds:[],s.ctxChilds=o.row.ctxChilds?o.row.ctxChilds:[],Object.keys(i).forEach(function(e){var n=function(e){var t={itfuid:e.itfuid,tree:e.tree?e.tree:e.itfCtxName,itfName:e.itfCtxName,childOf:e.mID,itfCtxName:e.itfCtxName,itfLblSlide:e.itfLblSlide};return["itfLblInst1Path","itfLblInst2Path","itfLblRef1Path","itfLblRef2Path","itfNonUniqueSlide"].reduce(function(n,i){return t[i]=e[i],n},{}),t}(i[e]);-1===s.childIds.indexOf(i[e].itfuid)&&(s.childIds.push(i[e].itfuid),s.ctxChilds.push(i[e].itfuid)),o.children[n.itfuid]=t[n.itfuid]={row:n}}),o.children&&n(s,o.children),o.row=s;var l=function(e){if(!e.itfFeat1&&!e.itfFeat2||!e.itfPath1||!e.itfPath2)return null;var n=e.itfPath1[e.itfPath1.length-1].physicalid+e.itfPath2[e.itfPath2.length-1].physicalid,i=e.itfPath2[e.itfPath2.length-1].physicalid+e.itfPath1[e.itfPath1.length-1].physicalid;e.isNonPersistentPIM&&(n=e.itfFeat1+e.itfFeat2,i=e.itfFeat2+e.itfFeat1);var r=t[n]?t[n].row:t[i]?t[i].row:null,a=r?r.itfuid:n,o=r?r.icons:[];e.itfFeat1&&!o.find(e=>"I_PIMGeoBundle.png"===e)&&Boolean(e.itfPath1.find(e=>"ElectricalBranchGeometry"===e.type))&&o.push("I_PIMGeoBundle.png"),e.itfFeat1&&!o.find(e=>"I_PIMPathwayGeometry.png"===e)&&Boolean(e.itfPath1.find(e=>"Sys3D_PathwayGeometry"===e.type))&&o.push("I_PIMPathwayGeometry.png"),e.itfFeat2&&!o.find(e=>"I_PIMGeoBundle.png"===e)&&Boolean(e.itfPath2.find(e=>"ElectricalBranchGeometry"===e.type))&&o.push("I_PIMGeoBundle.png"),e.itfFeat2&&!o.find(e=>"I_PIMPathwayGeometry.png"===e)&&Boolean(e.itfPath2.find(e=>"Sys3D_PathwayGeometry"===e.type))&&o.push("I_PIMPathwayGeometry.png"),e.isNonPersistentPIM&&!o.find(e=>"I_PIMGeoBundle.png"===e)&&(e.ittEleFeat1Supported||e.ittEleFeat2Supported)&&o.push("I_PIMGeoBundle.png"),e.isNonPersistentPIM&&!o.find(e=>"I_PIMPathwayGeometry.png"===e)&&(e.ittPathway1Supported||e.ittPathway2Supported)&&o.push("I_PIMPathwayGeometry.png");var s={itfuid:a,icons:o,isNonEditable:!0,childIds:[],ctxChilds:[]};return s.itfName=s.tree=e.itfLblRef1+" / "+e.itfLblRef2,["itfLblRef1","itfLblRef2","itfLblRef1Owner","itfLblRef2Owner","itfLblRef1OwnerID","itfLblRef2OwnerID"].reduce(function(t,n){return s[n]=e[n],t},{}),s}(s);l&&(l.childIds=t[l.itfuid]&&t[l.itfuid].row?t[l.itfuid].row.childIds:[],l.ctxChilds=t[l.itfuid]&&t[l.itfuid].row?t[l.itfuid].row.ctxChilds:[],-1===l.childIds.indexOf(o.row.itfuid)&&l.childIds.push(o.row.itfuid),o.row.childIds&&(l.ctxChilds=l.ctxChilds.concat(o.row.ctxChilds).filter((e,t,n)=>n.indexOf(e)===t)),o.row.childOf=l.itfuid,a[l.itfuid]={row:l,children:t[l.itfuid]?t[l.itfuid].children:{}}),t[s.itfuid]=Object.assign({},o),o.children&&1===Object.keys(o.children).length?(Object.assign(o.row,o.children[Object.keys(o.children)[0]].row,{itfuid:s.itfuid,childOf:s.childOf}),o.row.itfName=o.row.tree=s.itfMetricName?s.itfMetricName:s.tree?s.tree:s.itfCtxName,delete o.children):o.row.itfCtxName=o.row.itfLblInst1Path=o.row.itfLblInst2Path=o.row.itfLblRef1Path=o.row.itfLblRef2Path=void 0,l?(a[l.itfuid].children[o.row.itfuid]=o,a[l.itfuid].children&&n(a[l.itfuid].row,a[l.itfuid].children),t[l.itfuid]=a[l.itfuid],function(e){function t(e,t){return"Undefined"===e||"Clash"===e||e===t?e:"Contact"===e&&"Clash"!==t?e:"Clearance"===e&&"Clash"!==t&&"Contact"!==t?e:"NoInterference"===e&&"Clash"!==t&&"Contact"!==t&&"Clearance"!==t?e:t}function n(e,t){return"NotAnalyzed"===e||"KO"===e||e===t||"OK"===e&&"KO"!==t?e:t}e.row.itfSystemType=e.row.itfUserType=e.row.itfAnalysis=e.row.itfPrevAnalysis=void 0,Object.keys(e.children).forEach(function(i){var r=e.children[i].row,a=e.row;e.row.itfSystemType=a.itfSystemType&&"Undefined"!==r.itfSystemType?t(a.itfSystemType,r.itfSystemType):r.itfSystemType,e.row.itfUserType=a.itfUserType&&"Undefined"!==r.itfUserType?t(a.itfUserType,r.itfUserType):r.itfUserType,e.row.itfAnalysis=a.itfAnalysis&&"NotAnalyzed"!==r.itfAnalysis?n(a.itfAnalysis,r.itfAnalysis):r.itfAnalysis,e.row.itfPrevAnalysis=a.itfPrevAnalysis&&"NotAnalyzed"!==r.itfPrevAnalysis?n(a.itfPrevAnalysis,r.itfPrevAnalysis):r.itfPrevAnalysis})}(a[l.itfuid])):a[o.row.itfuid]=o}),a}var R=[["itfLblShape1","itfLblShape1Owner","itfLblShape1OwnerID","itfLblInst1","itfLblInst1Owner","itfLblInst1OwnerID","itfLblRef1","itfLblRef1Owner","itfLblRef1OwnerID","itfLblInst1Path","itfLblInst1Path","itfLblRef1Path"],["itfLblShape2","itfLblShape2Owner","itfLblShape2OwnerID","itfLblInst2","itfLblInst2Owner","itfLblInst2OwnerID","itfLblRef2","itfLblRef2Owner","itfLblRef2OwnerID","itfLblInst2Path","itfLblInst2Path","itfLblRef2Path"]];var V=e.extend({init:function(e){var t,n,i=this,r=null,a=e.readOnly,s=e.cbDnD,l=e.prefUnitValues,c=e.pad3DViewer.getFrameWindow().getImmersiveFrame(),u=e.deforder,f=e.defCols;this.getTreeListViewer=function(){return r},this.show=function(){t&&(t.setPanelVisibilityFlag(!0),t.ensureVisible())},this.hide=function(){t&&t.setPanelVisibilityFlag(!1)},this.destroy=function(){t&&t.destroy()},this.updatePanelTitle=function(e){t&&(t.title=e)},this.onClose=null,this.toggleReadOnly=function(){r&&r.toggleReadOnly()},this.ensureSelectedLineVisibility=function(){r&&r.ensureSelectedLineVisibility()},n=b.getWebappsAssetUrl("PIMwebUX","icons/22/"),(t=new p({title:w.noItf,identifier:"PIMwebItfListPanel",icon:n+"I_ExamineInterference.png",immersiveFrame:c,viewerFrame:e.pad3DViewer.getFrameWindow().getViewerFrame(),resizableFlag:!0,height:200,width:500,collapsibleFlag:!0,floatableFlag:!0,maximizeButtonFlag:!0,horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,currentDockArea:WUXDockAreaEnum.BottomDockArea})).elements.container.addClassName(t.identifier),r=new o({parent:t,readOnly:a,cbDnD:s,units:{length:l.Length,volume:l.Volume},deforder:u,defCols:f,suffix:u&&u.length>0?"NonPersistent":"",filterCols:{addColsWithSet:u&&u.length>0?["label"]:void 0}}),s=null,t.close=function(){i.onClose?i.onClose():window.console.log("onClose function must be provided")}}}),U=e.extend({init:function(o){var p,v,U,N,F,_,j,G,W,B,H,q,X,Q,z,K,J,Z,Y,$,ee,te,ne,ie=this,re={},ae={},oe=[],se=new I,le=!1,ce=!1,ue={},fe={},de=[],pe={},he={},me=[],ge=o.pad3DViewer,ye=ge.getController(),Ce=!0,be=!1,Ie="",Pe=[],ve=[],Se=!0,we={Length:{unit:"Millimeter",decimalPlaceRW:3,decimalPlaceRO:3},Volume:{unit:"CubMm",decimalPlaceRW:3,decimalPlaceRO:3}},De=ye.getRootBagId(),Me={version:1,useStoredResults:1,itfAutoLoad:1,geometries:{mode:1,clash:1,contact:1,clearance:1},quantifiers:{minDist:!0},partsOverload:{type:0,parts:["#0000FF","#FFFF00"],itfType:["#CC092F","#FF8A2E","#6FBC48"],transparency:128},custAttr:{objectType:[],attrName:[]},customDefaultView:"M:Name, M:V_Itf_Type, M:V_Itf_User_Type, M:V_Itf_Analysis, M:V_Itf_Previous_Analysis, R1:V_Name, R2:V_Name, R1:owner, R2:owner, M:V_Quantifier, M:description, M:V_Itf_Real_Tolerance_Used_For_Computation, M:responsible"},xe=["ObjectType1","ObjectType2","ObjectType3","ObjectType4","ObjectType5","ObjectType6","ObjectType7","ObjectType8","ObjectType9","ObjectType10","ObjectType11","ObjectType12","ObjectType13","ObjectType14","ObjectType15","ObjectType16","ObjectType17","ObjectType18","ObjectType19","ObjectType20","AttrName1","AttrName2","AttrName3","AttrName4","AttrName5","AttrName6","AttrName7","AttrName8","AttrName9","AttrName10","AttrName11","AttrName12","AttrName13","AttrName14","AttrName15","AttrName16","AttrName17","AttrName18","AttrName19","AttrName20"],Ae="0",Te=!1,Oe=!1,Le=!1,Ee={clash:1,contact:1,clearance:1,quantifiers:1,zoom:0,colorsState:1,transparencyState:0},ke=!1,Re={},Ve={};function Ue(e,t){return se.publish({event:e,data:t})}function Ne(e){return re[e]?e:ae[e]&&ae[e].row&&ae[e].row.childIds?ae[e].row.childIds[0]:e}function Fe(e){return e?p?p.getSelectedInterferences(e):[]:(p?p.getSelectedInterferences(e):[]).map(function(e){return Ne(e)}).filter((e,t,n)=>n.indexOf(e)===t)}function _e(e){return function(e,t){return k(e.map(function(e){var t,n={};for(t in e)if(e.hasOwnProperty(t))switch(t){case"itfPenVec":case"itfMinDist":case"itfTolerance":case"itfPenVol":"number"==typeof e[t]&&(n[t]=e[t]);break;case"itfPrevAnalysis":n[t]="OK"===e[t]||"KO"===e[t]||"NotAnalyzed"===e[t]?e[t]:"";break;case"ifcLen1":case"ifcLen2":break;default:n[t]=e[t]}return n}),t)}(e,ae)}function je(){if(Se){var e,t=ge.getViewer(),n=1===t.getVisibleSpace()?"visibleSpace":"invisibleSpace";Object.keys(fe).forEach(function(i){if(fe[i][0]||fe[i][1])if(Ee.zoom&&he[i]){let t=he[i];if(!t)return;t.children.forEach(t=>t.children.forEach(t=>{var i=t.children[0].getBoundingSphere(n);i.applyMatrix4(t.children[0].getMatrix()),i&&!i.empty()&&(e?e.mergeWithSphere(i,e):e=i)}))}else{let r=re[i];if(!r)return;[E(r.itfPath1,ye),E(r.itfPath2,ye)].forEach(function(i){if(i&&i.checkExternalPath()){var r=i.getBoundingSphere(t,n);e?e.mergeWithSphere(r,e):e=r}})}}),e&&!e.isNaN()&&(e.radius=e.radius/1.1*1.05,ge.getFrameWindow().getViewpoint().reframe(void 0,void 0,e))}}function Ge(e){e&&(e.itfManipData&&(e.itfManipData.manipTks.forEach(e.itfManipData.manip.unsubscribe,e.itfManipData.manip),e.itfManipData.manip.unlink(e.itfManipData.manipTk),e.itfManipData=null),e.removeChildren())}function We(e){e&&(e.children.forEach(e=>Ge(e.children[1])),e.removeChildren())}function Be(e){let t=he[e];t&&(t.children.forEach(e=>e.children.forEach(e=>Ge(e.children[1]))),q.removeChild(t),delete he[e])}localStorage.setItem("PIMCSIInputI3S","PIM_CSI_I3S_Trace");let He=function(){let e,t,a,o,s,l,c,u,f,d,p,h,m,g=Me.partsOverload||Me.colors,y=new n.Color(g.itfType[0]),C=new n.Color(g.itfType[1]),b=new n.Color(g.itfType[2]),I=new n.LineBasicMaterial({color:y,side:n.DoubleSide,force:!0,lineWidth:3}),P=new n.MeshBasicMaterial({color:y,side:n.DoubleSide,opacity:.3,force:!0}),v=new n.MeshBasicMaterial({color:y,side:n.DoubleSide,force:!0}),w=new n.LineBasicMaterial({color:C,side:n.DoubleSide,force:!0,lineWidth:1}),D=new n.LineBasicMaterial({color:b,side:n.DoubleSide,force:!0,lineWidth:1}),M=new n.MeshBasicMaterial({color:b,side:n.DoubleSide,force:!0}),A=new n.MeshBasicMaterial({color:b,side:n.DoubleSide,force:!0}),L="PIMwebItfGeom",k="PIMwebItfQuantifier",R="Clash",V="Contact",U="Clearance",N=8,F=5,_=2,j=16,G=5,W="sans-serif",B=String(j)+"px "+W,H="#FFFFFF";function X(e,n){if(n.name===R&&n.children.length)return n.children[0];if(n.name===V&&n.children.length)return n.children[0];if(n.name===U&&e<n.children.length)return n.children[e];let r=new i(e);n.add(r);let a=new i(L);a.setPickable(t.PICKTHROUGH),r.add(a);let o=n.name,s=Ee,l=o===R&&!s.clash||o===V&&!s.contact||o===U&&!s.clearance;return a.setVisibility(!l),(a=new i(k)).setVisibility(s.quantifiers),r.add(a),r}I.color=P.color=v.color=y,w.color=C,D.color=M.color=A.color=b;let Q=function(){function r(e,t,n,r){return new Promise(function(a){n||a(),(m=new p).setFileType("cgr");let o=e.children[0];o.setMatrix(t);let s=new i;var l,c,u;o.add(s),m.setOnLoadedCallback(()=>{ge.getViewer().render(),a()}),m.loadModelFromBuffer((l=n,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=new ArrayBuffer(l.length/4*3),function(e,t){var n=c.indexOf(e.charAt(e.length-1)),i=c.indexOf(e.charAt(e.length-2)),r=e.length/4*3;64===n&&r--,64===i&&r--;var a,o,s,l,u,f,d,p=0,h=0;for(a=t?new Uint8Array(t):new Uint8Array(r),e=e.replace(/[^A-Za-z0-9+/=]/g,""),p=0;p<r;p+=3)o=c.indexOf(e.charAt(h++))<<2|(u=c.indexOf(e.charAt(h++)))>>4,s=(15&u)<<4|(f=c.indexOf(e.charAt(h++)))>>2,l=(3&f)<<6|(d=c.indexOf(e.charAt(h++))),a[p]=o,64!==f&&(a[p+1]=s),64!==d&&(a[p+2]=l)}(l,u),u),s),function(e,t){if(!e||!t)return;let n=e.createOverrideSetManager(),i=n.createSceneGraphOverrideSet();n.pushSceneGraphOverrideSet(i);let r=i.createOverride(new h([e]));r&&r.setMaterial(t,!0)}(s,r)})}return function(i,o,s,l){return new Promise(function(c){let u=re[i],f=he[i],d=!1;u&&f&&f.children&&3===f.children.length||c();let p=l.useStoredResults&&ue[u.mRepRef];if(f.__pimGeomDone&&(p||null===p)&&c(),null===p)f.__pimGeomDone=!0,f.removeChildren(),c();else if(p){d=!0;let e=new n.Matrix4,t=new n.Matrix4;if(p.r2scaInvMatrix){let t=p.r2scaInvMatrix;e=new n.Matrix4(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1)}if(u.msca){let e=E(u.itfPath1.slice(0,u.itfPath1.findIndex(e=>e.physicalid===u.msca)+1),ye);e&&(t=e.getWorldMatrix())}t.multiplyMatrices(t,e);var h=[];if(p.clearanceArea)h.push(r(X(0,f.children[0]),t,p.clearanceArea,M));else if(p.clearanceTriangle){(Array.isArray(p.clearanceTriangle)?p.clearanceTriangle:[p.clearanceTriangle]).forEach((e,n)=>h.push(r(X(n,f.children[0]),t,e,D)))}p.contactTriangle&&h.push(r(X(0,f.children[1]),t,p.contactTriangle,w)),p.clashVolume&&h.push(r(X(0,f.children[2]),t,p.clashVolume,P)),p.clashCurve&&h.push(r(X(0,f.children[2]),t,p.clashCurve,I)),Promise.all(h).then(function(){f.__pimGeomDone=!0,c()})}let m=[{t:U,b:!1},{t:V,b:!1},{t:R,b:!1}];if(!d){if([[f.children[0],l.geometries.clearance],[f.children[1],l.geometries.contact],[f.children[2],l.geometries.clash]].forEach(function(e){let t=e[0];e[1]||t.children.forEach(e=>e&&e.children.length&&e.children[0].removeChildren())}),!l.geometries.clearance&&!l.geometries.contact&&!l.geometries.clash)return c();if(2===l.geometries.mode)!l.geometries.clearance||f.children[0].children.length&&f.children[0].children.some(e=>e.children[0].children.length)||(m[0].b=!0),!l.geometries.contact||f.children[1].children.length&&f.children[1].children.some(e=>e.children[0].children.length)||u.itfSystemType===U||(m[1].b=!0),!l.geometries.clash||f.children[2].children.length&&f.children[2].children.some(e=>e.children[0].children.length)||u.itfSystemType===U||u.itfSystemType===V||(m[2].b=!0);else{if(u.itfSystemType===U){if(We(f.children[1]),We(f.children[2]),!l.geometries.clearance||f.children[0].children.length&&f.children[0].children.some(e=>e.children[0].children.length))return c()}else if(u.itfSystemType===V){if(We(f.children[0]),We(f.children[2]),!l.geometries.contact||f.children[1].children.length&&f.children[1].children.some(e=>e.children[0].children.length))return c()}else if(u.itfSystemType===R&&(We(f.children[0]),We(f.children[1]),!l.geometries.clash||f.children[2].children.length&&f.children[2].children.some(e=>e.children[0].children.length)))return c();u.itfSystemType===U?m[0].b=!0:u.itfSystemType===V?m[1].b=!0:u.itfSystemType===R&&(m[2].b=!0)}}let g=m.map(e=>e.b&&o&&s&&a.computeGeometries({path1:o,path2:s,itfSystemType:u.itfSystemType,itfType:e.t,clearanceValue:u.itfClearVal,metricTol:u.itfTolerance,maxTime:5e3}));if(g[0]&&g[0].clearance1&&g[0].clearance1.length&&g[0].clearance2&&g[0].clearance2.length&&["clearance1","clearance2"].forEach(function(i){let r,a=g[0][i].length,o=0,s=0,l=[],c=[];l.length=3*a,c.length=6*a;for(let e=0;e<a;++e)3===(r=g[0][i][e]).length&&(l[o++]=new n.Vector3(r[0][0],r[0][1],r[0][2]),l[o++]=new n.Vector3(r[1][0],r[1][1],r[1][2]),l[o++]=new n.Vector3(r[2][0],r[2][1],r[2][2]),c[s++]=o-3,c[s++]=o-2,c[s++]=o-2,c[s++]=o-1,c[s++]=o-1,c[s++]=o-3);X(0,f.children[0]).children[0].add(e.createLineNode({points:l,idx:c,material:D,drawMode:t.ConnectivityTypeEnum.LINES}))}),g[1]&&g[1].contact&&g[1].contact.Surface&&g[1].contact.Surface.length){let i,r=g[1].contact.Surface.length,a=0,o=0,s=[],l=[];s.length=3*r,l.length=6*r;for(let e=0;e<r;++e)3===(i=g[1].contact.Surface[e]).length&&(s[a++]=new n.Vector3(i[0][0],i[0][1],i[0][2]),s[a++]=new n.Vector3(i[1][0],i[1][1],i[1][2]),s[a++]=new n.Vector3(i[2][0],i[2][1],i[2][2]),l[o++]=a-3,l[o++]=a-2,l[o++]=a-2,l[o++]=a-1,l[o++]=a-1,l[o++]=a-3);X(0,f.children[1]).children[0].add(e.createLineNode({points:s,idx:l,material:w,drawMode:t.ConnectivityTypeEnum.LINES}))}if(g[2]&&g[2].clash&&g[2].clash.Segment&&g[2].clash.Segment.length){let i,r=g[2].clash.Segment.length,a=[],o=0;a.length=2*r;let s=[];s.length=a.length;for(let e=0;e<r;++e)i=g[2].clash.Segment[e],s[o]=o,a[o++]=new n.Vector3(i[0][0],i[0][1],i[0][2]),s[o]=o,a[o++]=new n.Vector3(i[1][0],i[1][1],i[1][2]);let l=e.createLineNode({points:a,idx:s,material:I,drawMode:t.ConnectivityTypeEnum.LINES});l.setNoZ(!0),X(0,f.children[2]).children[0].add(l)}g.some(e=>e&&"maxTime"===e.status)&&ge.displayNotification({msg:S.maxTime,eventID:"info"}),d||c()})}}(),z=function(){function i(e,i,r){var a=new n.Vector3(e[0],e[1],e[2]),s=new n.Vector3(i[0],i[1],i[2]),l=new o({arrowWidth:2,headLength:10,initialPoint:a,finalPoint:s,color:r,head:1});return l.setPickable(t.PICKTHROUGH),l.updateColor(r),l}function r(i,r,a,o,p,h,m){if(r.length){var g=[],y=0,C=0;r.map(function(i){var r=function(t){var i,r=document.createElement("div"),a=document.createElement("span"),o=document.createTextNode(t.text);r.setAttribute("style","font-family:"+W+";font-size:"+j+"px;"),a.setAttribute("style","white-space:nowrap;"),a.appendChild(o),r.appendChild(a),document.body.appendChild(r),i={width:a.offsetWidth,height:a.offsetHeight},document.body.removeChild(r);var s=i.width,l=i.height,c=new u({width:s,height:l,drawCB:function(e,n){try{n.fillStyle=H,n.font=B,n.textAlign="left",n.textBaseline="top",n.fillText(t.text,0,l-j)}catch(e){window.console.log("error")}},rectangleTexture:!0,materialParams:{depthTest:!1}});return new f({name:t.text,bottomLeftcorner:new n.Vector3(0,0,0),widthVector:new n.Vector3(s,0,0),heightVector:new n.Vector3(0,l,0),canvasNodeTexture:c},e)}({text:i}),a=r.getBoundingBox();r.setPickable(t.PICKTHROUGH),g.push(r),C+=a.max.y,y=Math.max(y,a.max.x)}),y=N+y+N,C=F+C+(r.length-1)*_+F;var b=function(e,i,r,a,o,u,f){let p,h=new c({type:"Spherical"});h.name="Texts",h.setMatrix((new n.Matrix4).setPosition(new n.Vector3(r[a+0],r[a+1],r[a+2]))),h.setPickParent(!0),h.setNoZ(!0),e.addChild(h);var m=new l({ratio:1});m.setPickParent(!0),h.addChild(m);var g=new n.Vector3(i[0],i[1],i[2]),y=new s({fixPt:g,width:o,height:u,color:f,viewpoint:ge.getFrameWindow().getViewpoint()});return y.setPickable(t.PICKTHROUGH),y.setNoZ(!0),y.updateLeader(h.getMatrix().multiply(m.getMatrix())),e.addChild(y),e.itfManipData={manipTks:[]},e.itfManipData.manip=p=new d,p.setDynamic(!0),p.setPrePickingDuringManipulation(!0),p.setPreActivationDuringManipulation(!0),p.setPickingDuringManipulation(!0),p.setExclusive(!0),e.itfManipData.manipTk=p.linkToNode(h),e.itfManipData.manipTks.push(p.subscribe("BeginManipulate",function(t){e.itfManipData.parentMatInv=(new n.Matrix4).getInverse(e.getMatrix());var i=(new n.Vector3).copy(t.manipulator.initial3dIntersectionPoint).applyMatrix4(e.itfManipData.parentMatInv);e.itfManipData.translation=(new n.Vector3).getPositionFromMatrix(h.getMatrix()).sub(i)})),e.itfManipData.manipTks.push(p.subscribe("Manipulate",function(t){var i=e.itfManipData,o=(new n.Vector3).copy(t.manipulator.initial3dIntersectionPoint).add(t.translationVector).applyMatrix4(i.parentMatInv).add(i.translation);r[a+0]=o.x,r[a+1]=o.y,r[a+2]=o.z,h.setMatrix(h.getMatrix().setPosition(o)),y.updateLeader(h.getMatrix().multiply(m.getMatrix())),ge.getViewer().render()})),e.itfManipData.manipTks.push(p.subscribe("EndManipulate",function(){delete e.itfManipData.translation,delete e.itfManipData.parentMatInv})),h.cbChange=function(e,t){e.call(this,t),y.updateLeader(this.getMatrix().multiply(m.getMatrix()))}.bind(h,h.cbChange),m}(i,a,o,p,y,C,m),I=function(t,i,r){var a=new n.Shape;a.moveTo(0,G),a.lineTo(0,i-G),a.absarc(G,i-G,G,Math.PI,.5*Math.PI,!0),a.lineTo(t-G,i),a.absarc(t-G,i-G,G,.5*Math.PI,0,!0),a.lineTo(t,G),a.absarc(t-G,G,G,2*Math.PI,1.5*Math.PI,!0),a.lineTo(G,0),a.absarc(G,G,G,1.5*Math.PI,Math.PI,!0);var o=new n.ShapeGeometry(a),s=new n.Mesh(o,r),l=e.createNodeFromTHREEMesh(s);return l.setShadow(!1),l.setFrustumCulled(!1),l}(y,C,h);I.excludeFromCSO(!0),I.excludeFromHSO(!0),I.setPickParent(!0),b.addChild(I),C-=F,g.forEach(function(e){var t=e.getBoundingBox();C-=t.max.y,e.setMatrix((new n.Matrix4).setPosition(new n.Vector3(.5*(y-t.max.x),C,0))),b.addChild(e),C-=_})}}function p(e,t){if(e>0)return t?x.convertUnitValueToString(e,"Volume",J.Volume.unit,J.Volume.decimalPlaceRW,Te,{displaySymbol:!0,displaySpace:!0}):x.convertUnitValueToString(.001*e,"Length",J.Length.unit,J.Length.decimalPlaceRW,Te,{displaySymbol:!0,displaySpace:!0})}return function(e,t,o,s){let l=re[e],c=he[e],u=new n.Matrix4;if(!l||!c||!c.children||3!==c.children.length)return;if(l.itfSystemType===U&&!l.itfMinDist&&!s.quantifiers.minDist){let e=c.children[0].children.length&&c.children[0].children[0];return void(e&&Ge(e.children[1]))}if(c.__pimQuantifierDone)return;if(c.children.forEach(e=>e.children.forEach(e=>e&&e.children.length&&Ge(e.children[1]))),l.msca){let e=E(l.itfPath1.slice(0,l.itfPath1.findIndex(e=>e.physicalid===l.msca)+1),ye);e&&(u=e.getWorldMatrix())}if(l.itfSystemType===U&&!l.itfMinDist&&s.quantifiers.minDist&&"number"!=typeof l.itfMinDistComputed&&t&&o){let e=a.computeMinDist({path1:t,path2:o});l.itfMinDistComputed=e.minDist;let i=(new n.Matrix4).getInverse(u);l.itfQtfPt1=new n.Vector3(e.pos1[0],e.pos1[1],e.pos1[2]).applyMatrix4(i),l.itfQtfPt2=new n.Vector3(e.pos2[0],e.pos2[1],e.pos2[2]).applyMatrix4(i),l.itfQtfPt1=[l.itfQtfPt1.x,l.itfQtfPt1.y,l.itfQtfPt1.z],l.itfQtfPt2=[l.itfQtfPt2.x,l.itfQtfPt2.y,l.itfQtfPt2.z]}let f,d=s.useStoredResults&&ue[l.mRepRef],h=[],m=new n.Matrix4,g=new n.Matrix4;if(l.pos3D||(l.pos3D=h),(l.itfSystemType===U||l.itfSystemType===R)&&(l.itfSystemType!==R||l.itfPenVec||l.itfPenVol)&&(l.itfSystemType!==U||l.itfMinDist||l.itfMinDistComputed)){if(l.isNonPersistentPIM&&(!l.itfQtfPt1||!l.itfQtfPt2)){let e=function(){var e=null,t=1===ge.getViewer().getVisibleSpace()?"visibleSpace":"invisibleSpace";if(Object.keys(fe).forEach(function(n){if((fe[n][0]||fe[n][1])&&he[n]){let i=he[n];if(!i)return;i.children.forEach(n=>n.children.forEach(n=>{var i=n.children[0].getBoundingSphere(t);i.applyMatrix4(n.children[0].getMatrix()),i&&!i.empty()&&(e?e.mergeWithSphere(i,e):e=i)}))}}),e&&!e.isNaN())return e}();null!==e&&(l.itfQtfPt1=[e.center.x,e.center.y,e.center.z],l.itfQtfPt2=[e.center.x,e.center.y,e.center.z])}if(l.itfQtfPt1&&3===l.itfQtfPt1.length&&l.itfQtfPt2&&3===l.itfQtfPt2.length){if(d){if(d.r2scaInvMatrix){let e=d.r2scaInvMatrix;m=new n.Matrix4(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1)}g.multiplyMatrices(u,m)}else g.multiplyMatrices(u,(new n.Matrix4).getInverse(u));if(s.useStoredResults&&d&&d.multiClearVectors&&d.multiClearVectors.length%6==0){let e,t,n,a=d.multiClearVectors;for(let o=0;o<d.multiClearVectors.length/6;++o){n=6*o,e=[a[n++],a[n++],a[n++]],t=[a[n++],a[n++],a[n++]],f=[.5*(e[0]+t[0]),.5*(e[1]+t[1]),.5*(e[2]+t[2])],Array.prototype.push.apply(h,f);let s=X(o,c.children[0]).children[1];s.setMatrix(g),s.addChild(i(f,e,b)),s.addChild(i(f,t,b));let u=p(Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])),!1);u&&r(s,[u],f,l.pos3D,3*o,A,b)}c.__pimQuantifierDone=!0}if((l.isNonPersistentPIM||s.useStoredResults)&&l.itfSystemType===R){let e=X(0,c.children[2]).children[1];e.setMatrix(g);let t=p(l.itfPenVol,!0),a=p(l.itfPenVec,!1),o=[];if(t&&o.push(t),a&&o.push(a),d&&d.clashOnlyPenVector&&6===d.clashOnlyPenVector.length){let t,n;f=[.5*((t=[(n=[d.clashOnlyPenVector[0],d.clashOnlyPenVector[1],d.clashOnlyPenVector[2]])[0]+d.clashOnlyPenVector[3],n[1]+d.clashOnlyPenVector[4],n[2]+d.clashOnlyPenVector[5]])[0]+n[0]),.5*(t[1]+n[1]),.5*(t[2]+n[2])],Array.prototype.push.apply(h,f),e.addChild(i(t,n,y)),r(e,o,f,l.pos3D,3*(l.pos3D.length/3-1),v,y)}else if(l.itfPenVec||l.itfPenVol){let t=d&&d.r2scaInvMatrix?(new n.Matrix4).getInverse(m):u,a=new n.Vector3(l.itfQtfPt1[0],l.itfQtfPt1[1],l.itfQtfPt1[2]).applyMatrix4(t),s=new n.Vector3(l.itfQtfPt2[0],l.itfQtfPt2[1],l.itfQtfPt2[2]).applyMatrix4(t);f=[.5*(s.x+a.x),.5*(s.y+a.y),.5*(s.z+a.z)],Array.prototype.push.apply(h,f),a=[a.x,a.y,a.z],s=[s.x,s.y,s.z],e.addChild(i(s,a,y)),r(e,o,f,l.pos3D,3*(l.pos3D.length/3-1),v,y)}}else if(l.itfSystemType===U&&!c.__pimQuantifierDone){let e=X(0,c.children[0]).children[1];e.setMatrix(g);let t=d&&d.r2scaInvMatrix?(new n.Matrix4).getInverse(m):u,a=new n.Vector3(l.itfQtfPt1[0],l.itfQtfPt1[1],l.itfQtfPt1[2]).applyMatrix4(t),o=new n.Vector3(l.itfQtfPt2[0],l.itfQtfPt2[1],l.itfQtfPt2[2]).applyMatrix4(t);f=[.5*(o.x+a.x),.5*(o.y+a.y),.5*(o.z+a.z)],Array.prototype.push.apply(h,f),a=[a.x,a.y,a.z],o=[o.x,o.y,o.z],e.addChild(i(f,a,b)),e.addChild(i(f,o,b));let s=p(l.itfMinDist||l.itfMinDistComputed,!1);s&&r(e,[s],f,l.pos3D,3*(l.pos3D.length/3-1),A,b)}c.__pimQuantifierDone=!0,s.useStoredResults||l.itfSystemType!==U||Object.keys(he).forEach(e=>he[e].children.forEach(e=>e.children.forEach(e=>e.children[1].setVisibility(s.quantifiers.minDist))))}}}}(),K=function(n,m,g){Array.isArray(n)&&ge&&(e?(Object.keys(he).forEach(function(e){-1===n.indexOf(e)&&Be(e)}),n.reduce(function(e,t){return e.then(function(){return new Promise(function(e){var n,a,o=re[t],s=Boolean(o&&(o.ifcLen1&&o.ifcLen1>0||o.ifcLen2&&o.ifcLen2>0));if(!(s||o&&T(ye,o.itfPath1)&&O(ye,o.itfPath1)&&T(ye,o.itfPath2)&&O(ye,o.itfPath2)))return;if(n=E(o.itfPath1,ye),o.featPath1&&(n.externalPath=n.externalPath.concat(o.featPath1.externalPath),n.internalPath=o.featPath1.internalPath),a=E(o.itfPath2,ye),o.featPath2&&(a.externalPath=a.externalPath.concat(o.featPath2.externalPath),a.internalPath=o.featPath2.internalPath),!(n&&n.checkExternalPath()&&a&&a.checkExternalPath())){if(!s)return;n=void 0,a=void 0}let l=he[t];l||(l=he[t]=new i(t),q.add(l),l.add(new i(U)),l.add(new i(V)),l.add(new i(R))),setTimeout(function(){(o.mRepRef?new Promise(e=>{ue[o.mRepRef]=null,r._readMetricGeomStream({repRefID:o.mRepRef,onComplete:function(t){t&&t.infos&&"OK"===t.infos.status&&t.buffer&&(ue[o.mRepRef]=JSON.parse(t.buffer)),e()}})}):Promise.resolve()).then(()=>{Q(t,n,a,m).then(()=>{z(t,n,a,m),delete ue[o.mRepRef],ge.getViewer().render(),e()})})},0)})})},Promise.resolve()).then(()=>{!g&&Ee.zoom&&je()})):require(["DS/Visualization/SceneGraphFactory","DS/Mesh/Mesh","DS/PIMwebViewController/PIMWebViewTools","DS/SceneGraphNodes/ArrowNode","DS/Manipulators/ScreenPlaneManipulator","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/CanvasNodeTexture","DS/Visualization/PathElement","DS/SceneGraphNodes/CanvasNode","DS/PIMwebViewController/PIMwebLeaderNode","DS/Visualization/ModelLoader"],function(i,r,y,C,b,I,P,v,S,w,D,M){e=i,t=r,o=C,l=I,c=P,a=y,u=v,f=w,d=b,s=D,p=M,h=S,He(n,m,g)}))};return K.updateColors=function(){y.set((Me.partsOverload||Me.colors).itfType[0]),C.set((Me.partsOverload||Me.colors).itfType[1]),b.set((Me.partsOverload||Me.colors).itfType[2])},K}();function qe(){let e=Object.keys(fe).length;de[0].enable(e>0),de[1].enable(e>0),100===U?(de[0].enable(!1),de[1].enable(!1)):de[0].setOpacity(U/100,!1),Object.keys(fe).forEach(function(e){fe[e][4]&&(fe[e][4].enable(100!==U),100!==U&&fe[e][4].setOpacity(.8,!0))})}function Xe(){Object.keys(fe).forEach(function(e){var t=re[e];if(!t)return;let n=fe[e][0],i=fe[e][1];var r;Ee.colorsState?0===(Me.partsOverload||Me.colors).type?Ee.colorsState&&(n&&n.setColor((Me.partsOverload||Me.colors).parts[0],!1),i&&i.setColor((Me.partsOverload||Me.colors).parts[1],!1)):("Clash"===t.itfSystemType?r=(Me.partsOverload||Me.colors).itfType[0]:"Contact"===t.itfSystemType?r=(Me.partsOverload||Me.colors).itfType[1]:"Clearance"===t.itfSystemType&&(r=(Me.partsOverload||Me.colors).itfType[2]),r&&(n&&n.setColor(r,!1),i&&i.setColor(r,!1))):(n&&n.setColor(null,!1),i&&i.setColor(null,!1));if(Ee.transparencyState)if(255===Me.partsOverload.transparency)n&&(n.setVisibility(!1,!1),n.setVisibilityFree(!0,!1)),i&&(i.setVisibility(!1,!1),i.setVisibilityFree(!0,!1));else{n&&(n.setVisibility(null,!1),n.setVisibilityFree(null,!1)),i&&(i.setVisibility(null,!1),i.setVisibilityFree(null,!1));let e=(255-Me.partsOverload.transparency)/255;n&&n.setOpacity(e,!0),i&&i.setOpacity(e,!0)}else n&&n.resetOpacity(),i&&i.resetOpacity()})}function Qe(e){let t=fe[e];t&&t.forEach(e=>e&&W.deleteOverride(e)),delete fe[e]}let ze=function(){let e,t=function(e,n,i){if("1"===i.getAttributeCategory())return i.getAnnotationUuid()===n?e.feat=i:i.children.some(t.bind(null,e,n))},n=(n,i)=>{let r=[],a=[];n.forEach(t=>(e.hasAlreadyBeenLoaded(t.repRefID)?r:a).push(t)),(a.length?new Promise(function(t){let i=[],o=function(a){r.push(a.partNode),(r.length===n.length||ke)&&(i.forEach(e.unsubscribe,e),t())};i.push(e.subscribe("onAnnotationSetLoadingFailed",o)),i.push(e.subscribe("onNoAnnotationSetLoaded",o)),i.push(e.subscribe("onAnnotationSetLoaded",o)),i.push(e.subscribe("onAnnotationSetLoadingCanceled",o)),ke&&i.push(e.subscribe("onAnnotationSetRemoved",o)),e.setActiveState(2),a.forEach(t=>e.loadFTAModel({idPath:[t.repRefID]}))}):Promise.resolve()).then(function(){!function(e,n){n(e.map(e=>{let n=ye.getNode({id:e.repRefID});return(n&&n.getChildren()||[]).some(function(i){if(!i.getRootAnnotationNode)return;let r={};if(i.getRootAnnotationNode("RootAttributes").children.some(t.bind(null,r,e.featID)),r.feat){let t=r.feat.getAnnotationTTRS();return(t.length&&i.getTTRSs()||[]).some(function(t){if(t.tpsID!==this)return;let i;if(n.children.some(e=>i=e.getPathElement&&e.setInternalSceneGraph&&e),i){let n=i.getPathElement(t.geoP,{externalPath:[i]});e.repRepPath=n&&n.length&&n[0]}return!0},t[0]),!0}}),e}))}(n,i)})};return function(t){return t.length?new Promise(function(i){e?n(t,i):require(["DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"].concat([]),function(r){e=r.getAnnotationModelLoader({context:ge}),n(t,i)})}):Promise.resolve()}}();function Ke(e){return new Promise(t=>{if(e=re[e]?e:Ne(e),!re.hasOwnProperty(e)||fe.hasOwnProperty(e))return void t();let n=re[e],i=[null,null,null,null,null],r=[!1,!1],a=[[],[]],o=[[],[]],s=[];if(n){delete n.featPath1,delete n.featPath2,[{itfPath:n.itfPath1,ifcLen:n.ifcLen1},{itfPath:n.itfPath2,ifcLen:n.ifcLen2}].forEach(function(e,t){if(e.itfPath&&e.itfPath.length){var n=e.itfPath.map(function(e){return e.physicalid});L(ye,n)?r[t]=n[n.length-1]:e.ifcLen&&e.ifcLen>0&&L(ye,n.slice(0,n.length-e.ifcLen))?r[t]=n[n.length-e.ifcLen-1]:r[t]=n;var l,c=n.slice(),u=function(e){if(!e)return null;var t,n,i;if(e.some(function(e,t){return e.isBundleFst&&(n=t),e.isBundleFst})&&n+2<e.length)for(i=[],n+=3,t=0;t<n;++t)i.push(e[t].physicalid);return i}(e.itfPath);c.unshift(De),l=[new g(c)],u&&(u.unshift(De),l.push(new g(u)),s.push(l[1])),i[t]=W.createIdPathOverride({idPathes:l}),a[t].push(l[0]);for(var f=c;f.length;)o[t].push(new g(f)),f=f.slice(0,f.length-1)}}),(i[0]||i[1])&&(fe[e]=i,s.length&&(i[4]=W.createIdPathOverride({idPathes:s})),i[0]&&(i[2]=W.createIdPathOverride({idPathes:o[0]}),i[2].setPickability("PICKABLE")),i[1]&&(i[3]=W.createIdPathOverride({idPathes:o[1]}),i[3].setPickability("PICKABLE")));var l=r.map(function(e){return e?"string"==typeof e?new Promise(function(t){ye.lockNodes({ids:[e]}),t(e)}):new Promise(function(t){ye.expand({paths:[e],withFrustumFilter:!1,onComplete:function(){if(L(ye,e)){var n=e[e.length-1];ye.lockNodes({ids:[n]}),t(n)}else t(!0)},onFailure:function(){t(!0)}},!1,!1,!1)}):Promise.resolve(!1)});Promise.all(l).then(function(e){!0!==e[0]&&!0!==e[1]||p.updateInterferences(_e([function(e,t){return t.forEach(function(t,n){!0===t&&R[n].forEach(function(t){e[t]=void 0})}),e}(n,e)]));let i=[],r=[];var a;"string"==typeof e[0]&&(n.itfFeat1?i.push({repRefID:e[0],featID:n.itfFeat1}):r.push(e[0])),"string"==typeof e[1]&&(n.itfFeat2?i.push({repRefID:e[1],featID:n.itfFeat2}):r.push(e[1])),(r.length||i.length)&&(r.forEach(ye.lockRepresentationMeshInRAM,ye),Promise.all([(a=r,a.length?new Promise(e=>{ye.setForceReferencesLoad({data:a.map(e=>({id:e,state:!0})),callback:e})}):Promise.resolve()),ze(i)]).then(e=>{(e[1]||[]).forEach(e=>{e.repRepPath&&(n.itfFeat1&&n.itfFeat1===e.featID?n.featPath1=e.repRepPath:n.itfFeat2&&n.itfFeat2===e.featID&&(n.featPath2=e.repRepPath))}),r.length&&ye.setForceReferencesLoad({data:r.map(e=>({id:e,state:!1}))}),t(!0)}),Xe(),qe(),ge.getViewer().render())})}else t()})}function Je(e){N&&(e?N.hide():N.show())}function Ze(e){if(e){if(N&&N.show(),F&&"itfLblSlide"===e.cellClickedIdx&&ae[e.idCellClicked].row.itfLblSlide)return e.idCellClicked=ae[e.idCellClicked].row.ctxChilds?ae[e.idCellClicked].row.ctxChilds:e.idCellClicked,void Ue("onApplicativeContextRequested",{id:"ITF",data:e.idCellClicked,forceDisplay:!0});Promise.all(e.idsSelected.map(Ke)).then(e=>{e.some(e=>e)&&(Ee.zoom||je(),He(Fe(),K||Me))}),F&&!G&&Ue("onApplicativeContextChanged",{id:"ITF"}),j=!1}}function Ye(e,t){if(e){var n=[];e.forEach(function(e){var t=(e=re[e]?e:Ne(e))?re[e]:null;t&&[t.itfPath1,t.itfPath2].forEach(function(e){e&&e.length&&n.push(e[e.length-1].physicalid)}),Qe(e)}),n.length&&ye.unlockNodes({ids:n}),n.forEach(ye.unlockRepresentationMeshInRAM,ye),t||(qe(),ge.getViewer().render(),je(),He(Fe(),K||Me)),F&&!G&&Ue("onApplicativeContextChanged",{id:"ITF"}),j=!1}}function $e(){if(v){var e,t=0,n=0,i=0;Object.keys(re).forEach(function(e){var r=re[e],a=r.itfUserType,o=r.itfSystemType;"Clash"===a?t++:"Contact"===a?n++:"Clearance"===a?i++:"Undefined"!==a&&a||("Clash"===o?t++:"Contact"===o?n++:"Clearance"===o&&i++)}),(t||n||i)&&(e=t?t+" "+w["Clash"+(t>1?"es":"")]:"",e+=e&&n?" ":"",e+=n?n+" "+w["Contact"+(n>1?"s":"")]:"",e+=e&&i?" ":"",e+=i?i+" "+w["Clearance"+(i>1?"s":"")]:""),e=e||w.noItf;var r=Object.keys(pe);if(r.length){r.length>1&&window.console.error("More than one simulation in session???");var a=c.getIsr(r[0]),o=a?a.getAttributes().label:void 0;e+=o?" - "+o:""}v.updatePanelTitle(e)}}function et(e){if(!Ce){e.id=re[e.id]?e.id:Ne(e.id);var n=re[e.id].itfModelId,i=c.getIsr(n),r=[],a="",o=function(n){if(n.some(function(t){return t.id===e.id})){r.forEach(function(e){i.unsubscribe(e)}),r.length=0;var o=n.map(function(n){var r=i.getInterferences(n.id)[0],o=re[n.id];return t.extend(o,r,!1),a.startsWith("M:",0)&&(o[e.param]=e.newValue),o});p&&(p.updateInterferences(_e(o)),$e())}};r.push(i.subscribe("itfUpdateSuccess",o)),r.push(i.subscribe("itfUpdateFailed",o)),a=e.param,i.updateInterference({id:e.id,param:e.param,newValue:e.newValue}),"itfUserType"===e.param&&(re[e.id].itfUserType=e.newValue,$e())}}function tt(){var e=[];let t,n,i,r,a;return t={type:"PushItem",title:w.itfCopyLink,callback:function(){},submenu:[{title:w.itfSimulation,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebCopyLinkSimulationHdr",ge.getCommandContext()).begin()}}},{title:w.itfSelectedInterference,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebCopyLinkSelectedItfHdr",ge.getCommandContext()).begin()}},state:Fe().length>1?"disabled":"enabled"}]},n={title:w.issueTitle,type:"PushItem",icon:b.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_DMUIssue.png",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("CATWebUXGenerateIssueHdr",ge.getCommandContext()).begin()}}},i={title:w.issueTemplateTitle,type:"PushItem",icon:b.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_DMUIssueTemplate.png",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("CATWebUXGenerateIssueTemplateHdr",ge.getCommandContext()).begin()}}},r={title:w.caTitle,type:"PushItem",icon:b.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_VALCA.png",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("CATWebUXGenerateCAHdr",ge.getCommandContext()).begin()}}},a={type:"PushItem",title:w.itfExportToCSV,callback:function(){},submenu:[{title:w.itfAllVisible,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebExportFilteredHdr",ge.getCommandContext()).begin()}}},{title:w.itfSelected,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebExportSelectedHdr",ge.getCommandContext()).begin()}}}]},Le||e.push(n),e.push(i),e.push(r),e.push(a),e.push(t),Ce&&"X3DPLAW_AP"===window.widget.getValue("appId")?[t]:F||Ce?[]:e}function nt(){if(N){var e=ge.getFrameWindow().getImmersiveFrame(),t=[WUXDockAreaEnum.TopDockArea,WUXDockAreaEnum.LeftDockArea,WUXDockAreaEnum.RightDockArea].map(function(t){var n=0,i=e.getDockingElement(t);return(i.getContainedVisibleWindows().length>0||i.interactiveDockAreaVisibleFlag)&&(n=i._collapserSize,i.collapseDockingZoneFlag||(n+=i.dockingZoneSize)),n});N.setPosition({top:String(t[0])+"px",left:String(.5*(e.getFreeZone().getSize().width-N.getSize().width)+t[1])+"px"})}}function it(e){return function(e,t,n){var i,a,o,s,l=[],u={},f={};if(!t||0===t.length||!e)return Promise.resolve(l);if(c.getIsr(t[0].itfModelId)){if(0===(o=c.getIsr(t[0].itfModelId).getIsrContexts().map(function(e){return e.prd.physicalid})).length)return Promise.resolve(l);if(o.filter(function(e){return-1===n.indexOf(e)}).length)return Promise.resolve(l)}for(i=0,a=t.length;i<a;++i){var d=t[i];if(d&&(d.itfPath1||d.itfPath2)&&!d.isNonPersistentPIM){var p,h;if(d.itfPath1&&d.itfPath1.length>=3){p=!0,d.itfLblShape1=d.itfPath1[d.itfPath1.length-1].label,d.itfLblShape1Owner=d.itfPath1[d.itfPath1.length-1].owner,d.itfLblShape1OwnerID=d.itfPath1[d.itfPath1.length-1].ownerID,d.itfLblMaturity1Shape=d.itfPath1[d.itfPath1.length-1].current,d.itfLblOrganization1Shape=d.itfPath1[d.itfPath1.length-1].organization,d.itfLblCollabSpace1Shape=d.itfPath1[d.itfPath1.length-1].project,d.itfLblRevision1Shape=d.itfPath1[d.itfPath1.length-1].revision,d.itfPath1.length>=4&&(d.itfLblInst1=d.itfPath1[d.itfPath1.length-4].label,d.itfLblInst1Owner=d.itfPath1[d.itfPath1.length-4].owner,d.itfLblInst1OwnerID=d.itfPath1[d.itfPath1.length-4].ownerID),d.itfLblRef1=d.itfPath1[d.itfPath1.length-3].pn?d.itfPath1[d.itfPath1.length-3].pn:d.itfPath1[d.itfPath1.length-3].label,d.itfLblRef1Owner=d.itfPath1[d.itfPath1.length-3].owner,d.itfLblRef1OwnerID=d.itfPath1[d.itfPath1.length-3].ownerID,d.itfLblMaturity1Ref=d.itfPath1[d.itfPath1.length-3].current,d.itfLblRevision1Ref=d.itfPath1[d.itfPath1.length-3].revision,d.itfLblOrganization1Ref=d.itfPath1[d.itfPath1.length-3].organization,d.itfLblCollabSpace1Ref=d.itfPath1[d.itfPath1.length-3].project,d.itfLblInst1Path=d.itfLblRef1Path="",d.itfLblInst1Path=d.itfPath1[0].pn?d.itfPath1[0].pn:d.itfPath1[0].label;for(var m=0;m<=d.itfPath1.length-3;m++)m%2?d.itfLblInst1Path+="\\"+d.itfPath1[m].label:(0!==m&&(d.itfLblRef1Path+="\\"),d.itfLblRef1Path+=d.itfPath1[m].pn?d.itfPath1[m].pn:d.itfPath1[m].label,d.itfPath1[m].isBundleFst&&m+2<d.itfPath1.length&&(d.itfLblFstInst1=d.itfPath1[m+1].label,d.itfLblFstRef1=d.itfPath1[m+2].label,s=d.itfLblFstType1=d.itfPath1[m+2].type,u[s]||(u[s]=[]),u[s].push(d)))}if(d.itfPath2&&d.itfPath2.length>=3){h=!0,d.itfLblShape2=d.itfPath2[d.itfPath2.length-1].label,d.itfLblShape2Owner=d.itfPath2[d.itfPath2.length-1].owner,d.itfLblShape2OwnerID=d.itfPath2[d.itfPath2.length-1].ownerID,d.itfLblMaturity2Shape=d.itfPath2[d.itfPath2.length-1].current,d.itfLblOrganization2Shape=d.itfPath2[d.itfPath2.length-1].organization,d.itfLblCollabSpace2Shape=d.itfPath2[d.itfPath2.length-1].project,d.itfLblRevision2Shape=d.itfPath2[d.itfPath2.length-1].revision,d.itfPath2.length>=4&&(d.itfLblInst2=d.itfPath2[d.itfPath2.length-4].label,d.itfLblInst2Owner=d.itfPath2[d.itfPath2.length-4].owner,d.itfLblInst2OwnerID=d.itfPath2[d.itfPath2.length-4].ownerID),d.itfLblRef2=d.itfPath2[d.itfPath2.length-3].pn?d.itfPath2[d.itfPath2.length-3].pn:d.itfPath2[d.itfPath2.length-3].label,d.itfLblRef2Owner=d.itfPath2[d.itfPath2.length-3].owner,d.itfLblRef2OwnerID=d.itfPath2[d.itfPath2.length-3].ownerID,d.itfLblMaturity2Ref=d.itfPath2[d.itfPath2.length-3].current,d.itfLblRevision2Ref=d.itfPath2[d.itfPath2.length-3].revision,d.itfLblOrganization2Ref=d.itfPath2[d.itfPath2.length-3].organization,d.itfLblCollabSpace2Ref=d.itfPath2[d.itfPath2.length-3].project,d.itfLblInst2Path=d.itfLblRef2Path="",d.itfLblInst2Path=d.itfPath2[0].pn?d.itfPath2[0].pn:d.itfPath2[0].label;for(var g=0;g<=d.itfPath2.length-3;g++)g%2?d.itfLblInst2Path+="\\"+d.itfPath2[g].label:(0!==g&&(d.itfLblRef2Path+="\\"),d.itfLblRef2Path+=d.itfPath2[g].pn?d.itfPath2[g].pn:d.itfPath2[g].label,d.itfPath2[g].isBundleFst&&g+2<d.itfPath2.length&&(d.itfLblFstInst2=d.itfPath2[g+1].label,d.itfLblFstRef2=d.itfPath2[g+2].label,s=d.itfLblFstType2=d.itfPath1[g+2].type,f[s]||(f[s]=[]),f[s].push(d)))}(p||h)&&l.push(d)}}return Object.keys(u).length||Object.keys(f).length?new Promise(function(e){r._getTypeNLS(Object.keys(u).concat(Object.keys(f))).then(function(t){Object.keys(t).forEach(function(e){u[e]&&u[e].forEach(function(n){n.itfLblFstType1=t[e]}),f[e]&&f[e].forEach(function(n){n.itfLblFstType2=t[e]})}),e(l)})}):Promise.resolve(l)}(ye,e,X).then(function(){p&&p.updateInterferences(_e(e))})}function rt(e){if(e&&e.item&&e.strType&&e.itf&&e.customAttributes){var t=[];e.customAttributes.forEach(n=>{e.item.attributes.slice(1).some(e=>e.name===n.curi)||t.push(n)}),t.length>0&&t.forEach(function(t){let n=t.curi.substring(t.curi.lastIndexOf(":")+1);e.itf[e.strType.concat(n)]=""}),e.item.attributes.slice(1).forEach(function(t){let n=t.name.substring(t.name.lastIndexOf(":")+1);e.itf[e.strType.concat(n)]=t.value,e.units&&Object.keys(e.units).forEach(i=>{t.name===e.units[i].Name&&(n=t.name.substring(t.name.lastIndexOf(":")+1),e.itf[e.strType.concat(n)]=t.value+" "+e.units[i].unit)}),p&&p.addCustomAttrKeyAndName(e.strType.concat(n))})}}var at,ot,st,lt,ct=(at=[],ot=0,st=function(e,t){ot--,ct(),t(e)},lt=function(e){var n,i=t.clone(e,!1);i.onComplete=function(t){st(t,e.onComplete)},i.onFailure=function(t){st(t,e.onFailure)},i.onTimeout=function(t){st(t,e.onTimeout||e.onFailure)},n=i,require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:n.ctxIDs,label:"ITFCustomAtttrFetch"+Date.now(),select_predicate:n.attrCuris,select_file:[],select_unit:n.unitSelectObj}),onComplete:n.onComplete,onFailure:n.onFailure})},function(e){e&&at.push(e),at.length&&ot<5&&(ot++,lt(at.shift()))});function ut(e){return new Promise(function(t){if(e&&0===e.length)t();else{var n=[],i=[],a=[];e.forEach(function(e){if(e&&e.mID&&e.itfPath1&&e.itfPath1.length>=3){e.isQueryValueFetched=!1,n.push(e.mID);let t=e.ifcLen1?e.ifcLen1:0;e.itfPath1&&e.itfPath1.length-t>=4&&(a.push(e.itfPath1[e.itfPath1.length-t-4].physicalid),i.push(e.itfPath1[e.itfPath1.length-t-3].physicalid));let r=e.ifcLen2?e.ifcLen2:0;e.itfPath2&&e.itfPath2.length-r>=4&&(a.push(e.itfPath2[e.itfPath2.length-r-4].physicalid),i.push(e.itfPath2[e.itfPath2.length-r-3].physicalid))}}),n.length>0||i.length>0||a.length>0?Promise.all([new Promise(function(e){$?e($):r._getCustomAttributesFromType({data:["ds6wg:PLMPIMMetricReference","ds6wg:VPMReference","ds6wg:VPMInstance"]}).then(function(t){$=void 0!==t&&Object.keys(t).length?t:void 0,e()})}),new Promise(function(e,t){if(ee)e(ee);else{let n=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/resources/dictionary/dimensions?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),i=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx");require("DS/WAFData/WAFData").authenticatedRequest(n+"&SecurityContext="+i,{method:"GET",type:"json",timeout:6e4,headers:{Accept:"application/json","content-type":"application/json","Accept-Language":window.widget.lang?window.widget.lang:window.widget.getValue("lang"),SecurityContext:i},onComplete:function(t){ee=void 0!==t&&Object.keys(t).length?t:void 0,e()},onFailure:function(e){t(e)},onTimeout:function(e){t(e)}})}})]).then(function(){var r={},o={},s=[],l=[];if(void 0!==$&&Object.keys($).length){Object.keys($).forEach(e=>{$[e].length>0&&($[e].forEach(function(e){""!==e.dimension&&ee&&ee.results&&ee.results.forEach(function(t){t&&t.Name===e.dimension&&""!==e.manipulationUnit&&t.Units&&t.Units.length>0&&t.Units.forEach(function(t){if(e.manipulationUnit===t.Name){var n={Name:"",unitLabel:"",unit:""};n.Name=e.curi,""!==t.label&&(n.unitLabel=t.label),""!==t.NLSName&&(n.unit=t.NLSName),r[e.curi]=n}})}),l.includes(e.curi)||l.push(e.curi)}),"PLMPIMMetricReference"===e?s=s.concat(n):"VPMReference"===e?s=s.concat(i):"VPMInstance"===e&&(s=s.concat(a)))}),r&&Object.keys(r).forEach(e=>{o[e]=r[e].unitLabel});var c=Math.floor((s.length-1)/500)+1,u=0,f=0;for(0===c&&t();u<c;)ct({ctxIDs:s.slice(500*u,500*(u+1)),attrCuris:l,unitSelectObj:o,type:"CustomAttributeQuery",onComplete:function(n){f++;var i=JSON.parse(n);e.forEach(function(e){i.results&&i.results.forEach(function(t){if(t&&t.attributes&&t.attributes.length>0){"isQueryValueFetched"in e&&(e.isQueryValueFetched=!0);let n=t.ifcLen1?t.ifcLen1:0,i=t.ifcLen2?t.ifcLen2:0;t.attributes[0].value===e.mID?rt({item:t,strType:"M:",itf:e,units:r,customAttributes:$.PLMPIMMetricReference}):e.itfPath1&&e.itfPath1.length-n>=4&&t.attributes[0].value===e.itfPath1[e.itfPath1.length-n-4].physicalid?rt({item:t,strType:"I1:",itf:e,units:r,customAttributes:$.VPMInstance}):e.itfPath2&&e.itfPath2.length-i>=4&&t.attributes[0].value===e.itfPath2[e.itfPath2.length-i-4].physicalid?rt({item:t,strType:"I2:",itf:e,units:r,customAttributes:$.VPMInstance}):e.itfPath1&&e.itfPath1.length-n>=4&&t.attributes[0].value===e.itfPath1[e.itfPath1.length-n-3].physicalid?rt({item:t,strType:"R1:",itf:e,units:r,customAttributes:$.VPMReference}):e.itfPath2&&e.itfPath2.length-i>=4&&t.attributes[0].value===e.itfPath2[e.itfPath2.length-i-3].physicalid&&rt({item:t,strType:"R2:",itf:e,units:r,customAttributes:$.VPMReference})}})}),u===f&&t()},onFailure:function(){u===++f&&t()}}),u++}else t()}):t()}})}function ft(e){if(_&&(!ke||0!==Object.keys(pe).length)){var t=[],n=e?e.map(function(e){return e.itfuid}):Object.keys(re),i=!0;n.forEach(function(e){re[e].itfLblSlide&&(re[e].itfLblSlide=0,t.push(e),re[e].itfNonUniqueSlide&&(re[e].itfNonUniqueSlide.length=0))});var r=Object.keys(pe);return r=r.length?r[0]:null,_.forEach(function(e){var a=e.state?e.state.context:null;if(!(a&&a.data&&a.data.length&&a.data[0].isr===r&&a.data[0].itfs))return window.console.error("Unexpected!"),void(_=null);a.data[0].itfs.forEach(function(e){re[e]&&n.indexOf(e)>-1?(re[e].itfLblSlide||(re[e].itfLblSlide=0),++re[e].itfLblSlide,re[e].itfNonUniqueSlide||(re[e].itfNonUniqueSlide=[]),re[e].itfNonUniqueSlide.push(a.data[0].itfs),-1===t.indexOf(e)&&t.push(e)):i=!1})}),i&&(_=null),t}}function dt(e){B&&W&&-1===B.getSceneGraphOverrideSetIndex(W)&&B.pushSceneGraphOverrideSet(W),e.forEach(function(e){var t=re[e.itfuid];t&&t.itfLblSlide&&(e.itfLblSlide=t.itfLblSlide),re[e.itfuid]=e}),ut(e).then(function(){it(e),ft(e),$e()})}function pt(){p&&p.removeInterferences(),re={},ae={},$e(),Object.keys(fe).forEach(Qe),qe(),He([]),Q&&Q.setActiveState(!1),ge.getViewer().render(),N&&N.hide()}function ht(e){var t=window.widget.getValue("xsceneStoredObjects"),n=[];t&&"string"==typeof t||(t='{"products":{},"filters":{}}'),t=JSON.parse(t),"boolean"==typeof e?(window.widget.setValue("ItfSimuInSession",JSON.stringify(pe)),Object.keys(pe).forEach(function(e){var i=pe[e];i.length?(t.itf||(t.itf={}),i.forEach(function(n){t.itf[n]=e}),n=n.concat(i)):(t.isr||(t.isr={}),t.isr[e]={},n.push(e),t.itf&&(n=n.concat(Object.keys(t.itf))))}),window.widget.setValue("xsceneStoredObjects",JSON.stringify(t))):(window.widget.deleteValue("ItfSimuInSession"),t.itf&&Object.keys(t.itf).forEach(function(i){t.itf[i]===e&&-1===n.indexOf(i)&&n.push(i)}),t.isr&&Object.keys(t.isr).indexOf(e)>=0&&n.push(e)),require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.publish({event:"ENXViews/LandingPage/refreshCustom",data:n})})}function mt(e){e&&pe[e]&&(p&&Ye(Fe(),!0),c.unlockIsr(e),delete pe[e],pt(),ht(e),Ue("onIsrRemoved",{isrLog:t.clone(pe,!0),removedIsr:e}),Ue("onDMUCtxtRemoved"))}function gt(){var e=[],t=c.getLoadedIsr();Object.keys(pe).forEach(function(n){e=e.concat(t[n].getIsrContexts()).map(e=>e.prd.physicalid),mt(n)}),e.length&&ge.removeRoots({pids:e})}function yt(){let e=require("DS/CATWebUXComponents/DMUCommandsManager").getCommand(ge.getExecutionContext?"PIMWebUXGenerateIssueHdr":"CATWebUXGenerateIssueHdr",ge.getCommandContext());e&&e.lockAvailability&&e.lockAvailability(Le)}function Ct(e){e&&p&&p.addCustoColumn(e)}function bt(){if(p){var e=Me.custAttr,n=t.clone($,!0);new Promise(function(e){if(void 0===n){r._getCustomAttributesFromType({data:["ds6wg:PLMPIMMetricReference","ds6wg:VPMReference","ds6wg:VPMInstance"]}).then(function(t){e(t)})}else e(n)}).then(function(t){if(e&&t&&Object.keys(t).length>0){p&&p.removeCustoColoumn();var n=[e.attrName,e.objectType];if(n.slice(1).every(e=>e.length===n[0].length))for(let n=0;n<e.attrName.length;n++){if(""===e.attrName[n].value)continue;let i=!1;Object.keys(t).forEach(r=>{if(t[r].length>0){var a,o=0;if("PLMPIMMetricReference"===r&&"Metric"===e.objectType[n].value){for(o=0;o<t[r].length;o++)if((a=t[r][o])&&a.curi){let t,r,o=a.curi.lastIndexOf(".")>-1?a.curi.lastIndexOf("."):a.curi.lastIndexOf(":"),s=a.dataType.substring(a.dataType.lastIndexOf("#")+1),l=a.curi.substring(o+1),c=a.curi.substring(a.curi.lastIndexOf(":")+1);if(l===e.attrName[n].value?(i=!0,t="M:".concat(c),r=a.label?a.label:l):c===e.attrName[n].value&&(i=!0,t="M:".concat(c),r=a.label?a.label:c),void 0!==t&&void 0!==r){Ct({dataIndex:t,text:r,editableFlag:"string"===s&&"ReadWrite"===a.userAccess&&void 0===a.rangeValues?1:0});break}}}else if("VPMReference"===r&&"Reference"===e.objectType[n].value){for(o=0;o<t[r].length;o++)if((a=t[r][o])&&a.curi){let t=a.curi.lastIndexOf(".")>-1?a.curi.lastIndexOf("."):a.curi.lastIndexOf(":"),r=a.curi.substring(t+1);if([{suffix:w.itfLblRef1,prefix:"R1:"},{suffix:w.itfLblRef2,prefix:"R2:"}].forEach(t=>{let o,s,l=a.curi.substring(a.curi.lastIndexOf(":")+1);r===e.attrName[n].value?(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):r.concat(" ".concat(t.suffix))):l===e.attrName[n].value&&(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):l.concat(" ".concat(t.suffix))),void 0!==o&&void 0!==s&&Ct({dataIndex:o,text:s,editableFlag:!1})}),i)break}}else if("VPMInstance"===r&&"Instance"===e.objectType[n].value)for(o=0;o<t[r].length;o++)if((a=t[r][o])&&a.curi){let t=a.curi.lastIndexOf(".")>-1?a.curi.lastIndexOf("."):a.curi.lastIndexOf(":"),r=a.curi.substring(t+1);if([{suffix:w.itfLblInst1,prefix:"I1:"},{suffix:w.itfLblInst2,prefix:"I2:"}].forEach(t=>{let o,s,l=a.curi.substring(a.curi.lastIndexOf(":")+1);r===e.attrName[n].value?(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):r.concat(" ".concat(t.suffix))):l===e.attrName[n].value&&(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):l.concat(" ".concat(t.suffix))),void 0!==o&&void 0!==s&&Ct({dataIndex:o,text:s,editableFlag:!1})}),i)break}}}),i||("Metric"===e.objectType[n].value?Ct({dataIndex:e.attrName[n].value,text:e.attrName[n].value,editableFlag:!1}):"Reference"===e.objectType[n].value?(Ct({dataIndex:"R1".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(w.itfLblRef1),editableFlag:!1}),Ct({dataIndex:"R2".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(w.itfLblRef2),editableFlag:!1})):"Instance"===e.objectType[n].value&&(Ct({dataIndex:"I1".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(w.itfLblInst1),editableFlag:!1}),Ct({dataIndex:"I2".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(w.itfLblInst2),editableFlag:!1})))}}})}}function It(e,t){var n=!1,i=!1,r=!1,a=!1,o=!1;if(e.forEach(function(e){"PIMwebPref"===e.name?e.preferences.forEach(function(e){if("PIMwebItfAutoLoad"===e.name)Me.itfAutoLoad="true"===e.value||"1"===e.value?1:0;else if("IDStoredResults"===e.name)Me.useStoredResults="true"===e.value||"1"===e.value?1:0,n=!0,Object.keys(he).forEach(Be),Object.keys(re).forEach(e=>delete re[e].pos3D);else if("IDQMinDist"===e.name)Me.quantifiers.minDist="idMinDist"===e.value,n=!0,Me.useStoredResults||Object.keys(he).forEach(e=>he[e].children.forEach(e=>e.children.forEach(e=>e.children[1].setVisibility(Me.quantifiers.minDist))));else if("IDGeometries"===e.name)Me.geometries.mode="idType"===e.value?1:2,n=!0;else if("IDGClash"===e.name)Me.geometries.clash="idCurve"===e.value?1:0,n=!0;else if("IDGContact"===e.name)Me.geometries.contact="idTriangle"===e.value?1:0,n=!0;else if("IDGClearance"===e.name)Me.geometries.clearance="idTriangle"===e.value?1:0,n=!0;else if("IDColorOverLoading"===e.name)Me.partsOverload.type="colorInstance"===e.value?0:1,i=!0;else if("IDColorInstance1"===e.name)Me.partsOverload.parts[0]=e.value,i=!0;else if("IDColorInstance2"===e.name)Me.partsOverload.parts[1]=e.value,i=!0;else if("IDColorItfClash"===e.name)Me.partsOverload.itfType[0]=e.value,i=!0;else if("IDColorItfContact"===e.name)Me.partsOverload.itfType[1]=e.value,i=!0;else if("IDColorItfClearance"===e.name)Me.partsOverload.itfType[2]=e.value,i=!0;else if("IDItfPartsTranspPercent"===e.name){let t=parseFloat(e.value);t<0?t=0:t>100&&(t=100),Me.partsOverload.transparency=Math.round(2.55*t),a=!0,i=!0}else if("PIMwebLoad"===e.name)Ae="pimAllParts"===e.value?"0":"1",a=!0;else if("ObjectType"===e.name.replace(/[0-9]/g,"")||"AttrName"===e.name.replace(/[0-9]/g,"")){o=!0;var t={name:e.name,value:e.value};"ObjectType"===e.name.replace(/[0-9]/g,"")?Me.custAttr.objectType.some(t=>t.name===e.name)?Me.custAttr.objectType.some(function(t){t.name===e.name&&(t.value=e.value)}):Me.custAttr.objectType.push(t):"AttrName"===e.name.replace(/[0-9]/g,"")&&(Me.custAttr.attrName.some(t=>t.name===e.name)?Me.custAttr.attrName.some(function(t){t.name===e.name&&(t.value=e.value)}):Me.custAttr.attrName.push(t))}}):"FrameGeneral"===e.name?e.preferences.forEach(function(e){if("ProjectionType"===e.name){a=!0;var t="Perspective"===e.value?0:1;let n=ge?ge.getViewer():null;n&&n.currentViewpoint&&n.currentViewpoint.setProjectionType(t)}}):"VisualizationRepository"===e.name?e.preferences.forEach(function(e){if("Gravity"===e.name){a=!0;var t="true"===e.value;let n=ge?ge.getViewer():null;n&&n.currentViewpoint&&n.currentViewpoint.control&&(n.currentViewpoint.getControl().setRotationRolling(!t),n.currentViewpoint.getControl().setRollingForTouchAvailable(!t))}}):ne&&"SelectionRepository"===e.name?e.preferences.forEach(function(e){"Select3DGeometry"===e.name?(a=!0,ne.setPicking("true"===e.value?0:1)):"SelectParentReferenceOr3DShape"===e.name&&(a=!0,ne.selectParentReference("select3DShape"!==e.value))}):"cke"===e.name?e.preferences.forEach(function(e){"Length"===e.name||"LengthCalcDisplay"===e.name||"Volume"===e.name||"VolumeCalcDisplay"===e.name?(n=!0,r=!0,"Length"===e.name?J.Length.unit=e.value:"LengthCalcDisplay"===e.name?J.Length.decimalPlaceRW=parseInt(e.value):"Volume"===e.name?J.Volume.unit=e.value:"VolumeCalcDisplay"===e.name&&(J.Volume.decimalPlaceRW=parseInt(e.value))):"TrailingZeros"===e.name&&(Te="true"===e.value,n=!0,Object.keys(he).forEach(e=>{delete he[e].__pimQuantifierDone,delete he[e].__pimGeomDone}))}):"TICSection"===e.name&&e.preferences.forEach(function(e){"TICTemplateIssue"===e.name&&(Le="true"===e.value,yt())})}),i&&(Xe(),He.updateColors(),ge.getViewer().render()),o&&bt(),r){if(p){p.setUnits({length:J.Length,volume:J.Volume});let e=Object.keys(re).map(e=>re[e]);e.length&&p.updateInterferences(_e(e))}Object.keys(he).forEach(e=>delete he[e].__pimQuantifierDone)}if((a||i||r||n)&&((n||j)&&He(Fe(),Me),j=!1,t)){var s=require("DS/DMUBaseUIControllers/DMUSlidesController").giveDMUSlidesController({context:ge.getFrameWindow()});if(s){var l=s.getActiveSlide();l&&(l.getSlideApplicativeContext().ITF.content.prefs=Me,l.getSlideApplicativeContext().ITF.content.prefs.displayOptions=Ee,s.setActiveSlide(l))}}}let Pt=async function(){let e,t=ge&&ge.getExecutionContext?ge.getExecutionContext():void 0;if(t){e=t.getComponent(WAfrStandardComponentKey.HandlerComponent);const n=[];n.push(e.setCheckState({id:"PIMInteferenceListHdr",state:"1"===localStorage.getItem("PIMwebItfListVisPref")}));let i=localStorage.getItem("PIMwebApplyDisplayPref")?JSON.parse(localStorage.getItem("PIMwebApplyDisplayPref")):{};n.push(e.setCheckState({id:"PIMDisplayClashCurveHdr",state:!("clash"in i)||1===i.clash})),ie.applyDisplay("clash","clash"in i?i.clash:1,!0),n.push(e.setCheckState({id:"PIMDisplayContactCurveHdr",state:!("contact"in i)||1===i.contact})),ie.applyDisplay("contact","contact"in i?i.contact:1,!0),n.push(e.setCheckState({id:"PIMDisplayClearanceCurveHdr",state:!("clearance"in i)||1===i.clearance})),ie.applyDisplay("clearance","clearance"in i?i.clearance:1,!0),n.push(e.setCheckState({id:"PIMDisplayQuantifiersHdr",state:!("quantifiers"in i)||1===i.quantifiers})),ie.applyDisplay("quantifiers","quantifiers"in i?i.quantifiers:1,!0),n.push(e.setCheckState({id:"PIMZoomOnInterferenceHdr",state:"zoom"in i&&1===i.zoom})),ie.applyDisplay("zoom","zoom"in i?i.zoom:0,!0),n.push(e.setCheckState({id:"PIMColorOverloadHdr",state:!("colorsState"in i)||1===i.colorsState})),ie.applyDisplay("colorsState","colorsState"in i?i.colorsState:1,!0),n.push(e.setCheckState({id:"PIMApplyTransparencyHdr",state:"transparencyState"in i&&1===i.transparencyState})),ie.applyDisplay("transparencyState","transparencyState"in i?i.transparencyState:0,!0),await Promise.all(n),localStorage.setItem("PIMwebApplyDisplayPref",JSON.stringify(i))}};function vt(){return new Promise(function(e){if(Oe)return e();ne||(ne=A.getSelectionManager({context:ge}));let n=[{Repository:"PIMwebPref",PreferenceNames:["PIMwebLoad","IDStoredResults","PIMwebItfAutoLoad","IDQMinDist","IDGeometries","IDGClash","IDGContact","IDGClearance","IDColorOverLoading","IDColorInstance1","IDColorInstance2","IDColorItfClash","IDColorItfContact","IDColorItfClearance","IDItfPartsTranspPercent","DefaultView"].concat(xe)},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]},{Repository:"cke",PreferenceNames:["Length","LengthCalcDisplay","Volume","VolumeCalcDisplay","TrailingZeros"]},{Repository:"TICSection",PreferenceNames:["TICTemplateIssue"]}];J=t.clone(we,!0),x.readPreferences(n).then(function(t){It(t.repositories),Oe=!0,e()}).catch(function(t){window.console.warn("Error Preferences ",t),e()})})}function St(){if(!N){var e=function(){var e={userValue:10,checkedButton:0},t=localStorage.getItem("PIMwebOpacityPref");if("string"==typeof t){var n=t.split("-"),i=Number(n[1]),r=Number(n[2]);"number"==typeof i&&(e.userValue=0<=i&&i<=100?i:e.userValue),"number"==typeof r&&(e.checkedButton=0<=r&&r<=2?r:e.checkedButton)}return e}();e.parent=ge.getFrameWindow().getUIFrame(),U=2===e.checkedButton?100:1===e.checkedButton?0:e.userValue,(N=new u(e)).onOpacityChange=function(e){!function(e){var t="0-"+String(e.userValue)+"-"+String(e.checkedButton);localStorage.setItem("PIMwebOpacityPref",t)}(e),U=e.newValue,qe(),ge.getViewer().render(),Ue("onOpacityChange",{id:"ITF",data:e})},ge.getFrameWindow().getImmersiveFrame().addEventListener("freeZoneResize",nt)}}function wt(){if(!p){var e=["dragenter","dragover","drop"],t=!1,n=[],i={};(Ve.columns?Ve.columns:[]).forEach(function(e){i[e.dataIndex]={dataIndex:e.dataIndex,text:e.text,editableFlag:e.editableFlag,visibleFlag:!0},n.push(e.dataIndex)}),(v=new V({pad3DViewer:ge,readOnly:Ce,cbDnD:{onDragStartCell:c,onDragOverCell:a,onDragEndCell:s,onDragEnterBlank:a,onDragLeaveBlank:a,onDragOverBlank:a,onDragStartColumnHeader:o,onDragOverColumnHeader:function(e){return e.stopPropagation(),t||e.preventDefault(),!t},onDragEndColumnHeader:s,onDragStartRowHeader:c,onDragOverRowHeader:a,onDragEndRowHeader:s},prefUnitValues:J,deforder:n.length>0?n:void 0,defCols:Object.keys(i).length>0?i:void 0})).onClose=function(){ie.hideGUX(),Ue("onItfListClosed")},(p=v.getTreeListViewer()).onSelect=Ze,p.onHideShowOpaSlider=Je,p.onUnselect=Ye,p.onCellEdit=et,p.onContextualEvent=tt,p.showSlideColumn(F),p.setListUIReadyOnlyFlag(Ie);var r=Object.keys(re).map(function(e){return re[e]});r.length&&it(r),$e(),Me.custAttr&&p&&bt()}function a(e){e.stopPropagation()}function o(){var t=ge.getViewer().canvas,n=ge.getFrameWindow().getImmersiveFrame();return e.forEach(function(e){t.addEventListener(e,a),n.addEventListener(e,a)}),!0}function s(){var n=ge.getViewer().canvas,i=ge.getFrameWindow().getImmersiveFrame();return t=!1,e.forEach(function(e){n.removeEventListener(e,a),i.addEventListener(e,a)}),!0}function c(e,n){if(!p||!n)return!1;t=!0;var i={protocol:"3DXContent",version:"1.1",data:{items:[]},source:window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3D_AP",widgetId:window.widget?window.widget.id:void 0},r=[];return Fe().forEach(function(e){var t=re[e];-1===r.indexOf(t.mID)&&(r.push(t.mID),i.data.items.push({envId:f.getPlatformId(),serviceId:"3DSpace",contextId:l.getSetting("pad_security_ctx")?l.getSetting("pad_security_ctx"):void 0,objectId:t.mID,objectType:t.mType,displayName:t.itfMetricName}))}),e.dataTransfer.setData("Text",JSON.stringify(i)),o(),!1}}function Dt(e){Me.itfAutoLoad&&setTimeout(function(){new Promise(function(e){p?e():(wt(),St(),setTimeout(e,100))}).then(function(){if(v.show(),N.show(),p.selectRowsByUID(e),ge.getExecutionContext)require(["DS/CATWebUXComponents/DMUCommandsManager"],function(e){e.getCommandCheckHeader("PIMInteferenceListHdr",ge.getCommandContext()).setState(!0)});else{let e=setInterval(function(){let t=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",ge.getCommandContext());t&&(t.setState(!0),clearInterval(e))},100)}})},0)}function Mt(e){H||(H={isrID:[],metricID:[]},Q&&Q.setActiveState(!1),setTimeout(function(){let n,i,r,a,o,s=!1,l=Object.keys(pe),u=0,f=!0,d=!1,g=!e.noNotif;if(l.length>1&&window.console.log("More than 1 interference simulation loaded. This must not be possible!!"),H.isrID.length>0){H.isrID.length>1&&g&&ge.displayNotification({msg:S.pimSingleIsr,eventID:"info"}),a=H.isrID[0];var y=H.metricID.length;if(pe[a]?0===pe[a].length&&(f=!1):(s=!0,gt(),(pe={})[a]=[]),f)n=function(e){e&&(d=!0,s&&c.lockIsr(e.isrID),$e()),0===u&&d&&(ge.unsubscribe(i),ge.unsubscribe(r),g&&ge.displayNotification({msg:S.itfCtrlMsgSuccess,eventID:"success"}),y&&g&&ge.displayNotification({msg:S[y>1?"pimMetricsIgnored":"pimMetricIgnored"],eventID:"info"}),ht(!0),H=null,Ue("onIsrAdded",{isrLog:t.clone(pe,!0),loadedIsr:a}),Ue("onDMUCtxtLoadingSuccess"))},setTimeout(Pt,1500),te||(te=vt()),te.then(function(){var t="1"===(1===e.loadMode?"1":0===e.loadMode?"0":Ae)?"InterferingPartsOnly":"AllParts";c.loadIsr({isrID:a,onProgress:function(e){if("AllParts"===t&&e.context)if(e.context.length){var s=e.context;if(pe[a]&&pe[a].length?pe[a].length=0:s=e.context.filter(function(e){return-1===X.indexOf(e.prd.physicalid)}),s.length>0){u+=s.length,i||r||(i=ge.subscribe({event:"onRootAdded"},function(){u=0,n()}),r=ge.subscribe({event:"onRootAlreadyExisting"},function(){u=0,n()}));var l=[],f=[];s.forEach(function(e){e.filter&&e.filter.physicalid&&"ENOStrRefinementSpecification"===e.filter.type?f.push({objectId:e.filter.physicalid}):e.prd&&e.prd.physicalid&&l.push({path:[e.prd.physicalid]})}),l.length&&ge.addRoots({objects:l},!0,!1),f.length&&ge.addFilter(f)}else g&&ge.displayNotification({msg:S.itfCtrlMsgCtxAlreadyLoaded,eventID:"info"})}else g&&ge.displayNotification({msg:S.itfCtrlMsgNoContext,eventID:"info"});var d,h=e.isrID?c.getIsr(e.isrID):null,m=h&&e.itfIDs?h.getInterferences(e.itfIDs):null;if("InterferingPartsOnly"===t&&e.interferingPathsReady&&m){ge.getAutomaticReframePolicy()&&(ge.setAutomaticReframePolicy(!1),d=1);var y=[];for(m.forEach(function(e){e.itfPath1&&y.push(e.itfPath1.map(function(e){return e.physicalid})),e.itfPath2&&y.push(e.itfPath2.map(function(e){return e.physicalid}))}),o=y.length-1;o>=0;--o)y[o].every(function(e){return ye.getNode({id:e})})&&y.splice(o,1);!(u+=y.length)||i||r||(i=ge.subscribe({event:"onRootAdded"},function(){u--,1===d&&(ge.reframe(),d=2),0===u&&(2===d&&ge.setAutomaticReframePolicy(!0),n())}),r=ge.subscribe({event:"onRootAlreadyExisting"},function(){0===--u&&n()})),u&&ge.addRoots({objects:y.map(function(e){return{path:e}})},!0,!1)}if("OnPremise"!==window.widget.getValue("x3dPlatformId")&&1===window.top.__PIM_CSIExecute){let t;Ie="running",p&&p.setListUIReadyOnlyFlag("pending"),Ce=!0;var C=require("DS/CATWebUXComponents/DMUCommandsManager");(t=C.getCommand("PIMwebUpdateItfHdr",ge.getCommandContext()))&&t.disable(),c.getIsrJobsList({onComplete:function(n){if(n.list.length>0){var i=n.list.find(t=>t.internalID===e.isrID);i?(Ie=i.status,"succeeded"===i.status||"cancelled"===i.status||"failed"===i.status?((t=C.getCommand("PIMwebUpdateItfHdr",ge.getCommandContext()))&&t.enable(),p&&p.setListUIReadyOnlyFlag(Ie),require(["DS/CoreEvents/Events"],function(e){e.publish({event:"onEnableContextSpecTab",data:i.status})}),Ce=!1):"pending"!==i.status&&"running"!==i.status||((t=C.getCommand("PIMwebUpdateItfHdr",ge.getCommandContext()))&&t.disable(),p&&p.setListUIReadyOnlyFlag(Ie),require(["DS/CoreEvents/Events"],function(e){e.publish({event:"onEnableContextSpecTab",data:i.status})}),Ce=!0)):(Ie="",(t=C.getCommand("PIMwebUpdateItfHdr",ge.getCommandContext()))&&t.enable(),p&&p.setListUIReadyOnlyFlag(Ie),require(["DS/CoreEvents/Events"],function(e){e.publish({event:"onEnableContextSpecTab",data:""})}),Ce=!1),m&&dt(m)}},onFailure:function(){Ie="queryFailed",p&&p.setListUIReadyOnlyFlag(Ie),window.console.log("Compute Job Status: Failure Message : ")}})}else m&&dt(m)},onComplete:n,onFailure:function(e){ge.unsubscribe(i),ge.unsubscribe(r),pe={},"Simulation"===e.step?g&&ge.displayNotification({msg:S.itfCtrlMsgNotFound,eventID:"warning"}):g&&ge.displayNotification({msg:S.itfCtrlMsgError,eventID:"warning"}),$e();var t={};t[a]=[],H=null,Ue("onIsrAddFailed",t),Ue("onDMUCtxtLoadingFailure")}})});else{g&&ge.displayNotification({msg:S.itfCtrlMsgSimuAlreadyLoaded,eventID:"info"});var C={};C[a]=[],H=null,Ue("onIsrAlreadyLoaded",C),Ue("onDMUCtxtAlreadyLoaded")}}else if(H.metricID.length>0){var b=0,I=[],P=0,v=H.metricID.length;l.length&&(f=!H.metricID.every(function(e){return l.some(function(t){return pe[t].indexOf(e)>-1})})),f?(n=function(e){if(e)s&&c.lockIsr(e.isrID),$e();else{if(0!==u)return;ge.unsubscribe(i),ge.unsubscribe(r),I.length?(g&&ge.displayNotification({msg:S[I.length>1?"pimMetricsLoadOK":"pimMetricLoadOK"],eventID:"success"}),ht(!0),Ue("onItfAdded",{isrLog:t.clone(pe,!0),loadedIsr:Object.keys(pe)[0],loadedMetrics:I}),Ue("onDMUCtxtLoadingSuccess")):v?(g&&ge.displayNotification({msg:S[v>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"}),Ue("onItfAlreadyLoaded"),Ue("onDMUCtxtAlreadyLoaded")):(Ue("onIsrItfNothingAdded"),Ue("onDMUCtxtNotAdded")),P&&g&&ge.displayNotification({msg:S[P>1?"pimIgnoredMetrics":"pimIgnoredMetric"],eventID:"info"}),b&&g&&ge.displayNotification({msg:S[b>1?"pimMetricsNoIsr":"pimMetricNoIsr"],eventID:"info"}),Dt(H.metricID),H=null}},c.loadIsrFromMetrics({metrics:H.metricID,onFilterIsr:function(e){function n(t){e.onComplete(t)}var i=Object.keys(e.isrIDs);if(0===i.length)return b=e.metricsWithoutIsr.length,v=0,void n([]);if(l.length&&i.indexOf(l[0])>-1){for(a=l[0],v=e.isrIDs[a].itfM.length,o=1;o<i.length;++o)i[o]!==a&&(P+=e.isrIDs[i[o]].itfM.length);if(0===pe[a].length)return void n([]);if(e.isrIDs[a].itfM.every(function(e){return pe[a].indexOf(e)>-1}))return void n([])}else{for(a=i[0],v=e.isrIDs[a].itfM.length,o=1;o<i.length;++o)v<e.isrIDs[i[o]].itfM.length?(a=i[o],P+=v,v=e.isrIDs[i[o]].itfM.length):P+=e.isrIDs[i[o]].itfM.length;if(l.length){var r,c=new m({onClick:function(){r.destroy(),gt(),n([a]),s=!0,pe[a]=[]}}),u=new m({onClick:function(){r.close()}});return void(r=new h({identifier:"PIMwebIsrRemovePanel",modalFlag:!0,title:S.pimIsrRemoveTitle,content:new t.Element("div",{html:"<p>"+(P?S.pimIsrRemoveMsg2:S.pimIsrRemoveMsg1)+"</p><p><b>"+e.isrIDs[a].label+"</b></p>"}),width:350,immersiveFrame:ge.getFrameWindow().getImmersiveFrame(),buttons:{Ok:c,Cancel:u}})).addEventListener("close",function(){P=v=0,n([])})}s=!0,pe[a]=[]}n([a])},onProgress:function(e){var t=e.isrID?c.getIsr(e.isrID):null,a=t&&e.itfIDs?t.getInterferences(e.itfIDs):null;if(e.interferingPathsReady){var s=[];for(a.forEach(function(e){e.itfPath1&&s.push(e.itfPath1.map(function(e){return e.physicalid})),e.itfPath2&&s.push(e.itfPath2.map(function(e){return e.physicalid}))}),o=s.length-1;o>=0;--o)s[o].every(function(e){return ye.getNode({id:e})})&&s.splice(o,1);!(u+=s.length)||i||r||(i=ge.subscribe({event:"onRootAdded"},function(){0===--u&&n()}),r=ge.subscribe({event:"onRootAlreadyExisting"},function(){0===--u&&n()})),u&&ge.addRoots({objects:s.map(function(e){return{path:e}})},!0,!1)}a&&dt(a),e.metrics&&e.metrics.forEach(function(t){-1===pe[e.isrID].indexOf(t)&&pe[e.isrID].push(t),-1===I.indexOf(t)&&I.push(t)})},onComplete:n,onFailure:function(e){ge.unsubscribe(i),ge.unsubscribe(r),e&&e.isrID&&pe[e.isrID]&&0===pe[e.isrID].length&&(pe={}),$e(),g&&ge.displayNotification({msg:S[v>1?"pimMetricsLoadKO":"pimMetricLoadKO"],eventID:"warning"}),H=null,Ue("onItfAddFailed"),Ue("onDMUCtxtLoadingFailure")}})):(g&&ge.displayNotification({msg:S[H.metricID.length>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"}),Ue("onItfAlreadyLoaded"),Ue("onDMUCtxtAlreadyLoaded"),Dt(H.metricID),H=null)}},0)),e.isrID&&(H.isrID=H.isrID.concat(e.isrID)),e.metricID&&(H.metricID=H.metricID.concat(e.metricID))}function xt(){v&&v.hide(),N&&N.hide()}function At(e,t){var n="";return e.forEach(function(e){n&&(n+=", "),"Issue"===t&&e.filter&&(n+=e.filter.label,n+=" ("),n+=e.prd.label,"Issue"===t&&e.filter&&(n+=")")}),n}function Tt(e){return new Promise(function(n){var i=c.getIsr(e.isr);let a=[];var o={reportedAgainst:[],contexts:[],assignees:[],attachments:[]},s="";if(e.itf.length){var l,u=re[e.itf[0]];o.title=u.itfMetricName,o.priority="Low",o.description=u.itfDescription?u.itfDescription:At(i.getIsrContexts(),e.cmdType),i.getIsrContexts().forEach(function(t){"CA"===e.cmdType?o.contexts.push(t.prd.physicalid):(s=ye?ye.getRootStats(t.prd.physicalid).serviceId:"3DSpace",o.contexts.push({physicalId:t.prd.physicalid,serviceId:s,objectType:t.prd.type}),t.filter&&o.contexts.push({physicalId:t.filter.physicalid,serviceId:s,objectType:t.filter.type}))}),e.itf.forEach(function(t){[re[t].itfPath1,re[t].itfPath2].forEach(function(t){var n,i;t&&t.length>2&&((n=t.some(function(e,t){return e.isBundleFst&&(i=t),e.isBundleFst})&&i+2<t.length?t[i+2]:t.some(function(e,t){return e.isIfcElt&&(i=t),e.isIfcElt})&&i>2?t[i-3]:t[t.length-3]).physicalid&&-1===a.indexOf(n.physicalid)&&("CA"===e.cmdType?o.reportedAgainst.push(n.physicalid):o.reportedAgainst.push({physicalId:n.physicalid,serviceId:s,objectType:n.type}),a.push(n.physicalid)),n.ownerID&&-1===o.assignees.indexOf(n.ownerID)&&o.assignees.push(n.ownerID))}),re[t].mID&&-1===o.attachments.indexOf(re[t].mID)&&o.attachments.push(re[t].mID)}),l="Issue"===e.cmdType?"GenerateIssue":"IssueTemplate"===e.cmdType?"GenerateIssueTemplate":"GenerateCA",r._sendUsageProbe(l,"NbMetric"+o.attachments.length),n(o)}else{var f,d,p,g,y,C,b;f=D.issueTitle,d=D.caTitle,p=D.issueOnIsr,g=D.caOnIsr,y=D.yes,C=D.no;var I,P=t.createElement("div");"Issue"===e.cmdType||"IssueTemplate"===e.cmdType?(b=f,I=p):(b=d,I=g),t.createElement("label",{text:I,styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(P);var v=new h({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:b,immersiveFrame:ge.getFrameWindow().getImmersiveFrame(),content:P,closeButtonFlag:!0,buttons:{Ok:new m({label:y,onClick:function(){var t=i.getAttributes();o.title=t.label,o.priority="Low",o.description=t.description?t.description:At(i.getIsrContexts(),e.cmdType),i.getIsrContexts().forEach(function(t){"CA"===e.cmdType?(-1===o.reportedAgainst.indexOf(t.prd.physicalid)&&o.reportedAgainst.push(t.prd.physicalid),-1===o.contexts.indexOf(t.prd.physicalid)&&o.contexts.push(t.prd.physicalid),o.assignees.indexOf(-1===t.prd.ownerID)&&o.assignees.push(t.prd.ownerID)):(s=ye?ye.getRootStats(t.prd.physicalid).serviceId:"3DSpace",o.reportedAgainst.some(e=>e.physicalId===t.prd.physicalid)||o.reportedAgainst.push({physicalId:t.prd.physicalid,serviceId:s,objectType:t.prd.type}),t.filter&&!o.reportedAgainst.some(e=>e.physicalId===t.filter.physicalid)&&o.reportedAgainst.push({physicalId:t.filter.physicalid,serviceId:s,objectType:t.filter.type}),o.contexts.some(e=>e.physicalId===t.prd.physicalid)||o.contexts.push({physicalId:t.prd.physicalid,serviceId:s,objectType:t.prd.type}),t.filter&&!o.contexts.some(e=>e.physicalId===t.filter.physicalid)&&o.contexts.push({physicalId:t.filter.physicalid,serviceId:s,objectType:t.filter.type}),o.assignees.indexOf(-1===t.prd.ownerID)&&o.assignees.push(t.prd.ownerID),t.filter&&o.assignees.indexOf(-1===t.filter.ownerID)&&o.assignees.push(t.filter.ownerID))}),-1===o.attachments.indexOf(i.getAttributes().physicalid)&&o.attachments.push(i.getAttributes().physicalid),v.destroy(),n(o)}}),Cancel:new m({label:C,emphasize:"primary",onClick:function(){v.destroy(),o.status="ticCancel",n(o)}})}});v.addEventListener("close",function(){v.destroy(),n()})}})}ge.getViewer().addNode(q=new i("PIMwebDecoration")),ge.getViewer().getIdPathMatcher()||ge.getViewer().setIdPathMatcher(new y({idToNodeCB:function(e){return ye.getNode({id:e})},nodeToIdCB:function(e){return e===ye.getRootBag()?De:s.getNodeID(e)},isNodeRepRefCB:function(e){return s.isRepReference(e)}})),B=ge.getViewer().getSceneGraphOverrideSetManager(),W=B.createSceneGraphOverrideSet({rootNode:ye.getRootBag(),rootId:De,name:"pimSgos"}),B.pushSceneGraphOverrideSet(W);var Ot=new g([De]);de.push(W.createIdPathOverride({idPathes:[Ot]})),de.push(W.createIdPathOverride({idPathes:[Ot],propagateUntilRepRefs:!0})),de[1].setPickability("IGNORED"),qe(),oe.push(ge.subscribe({event:"onRefreshBegin"},function(){me=t.clone(pe,!0)})),oe.push(ge.subscribe({event:"onRefreshCompleted"},function(){var e=Object.keys(me);if(1===e.length){var t={},n=e[0];Array.isArray(me[n])&&me[n].length?t.metricID=me[n]:t.isrID=n,Mt(t)}})),oe.push(ge.subscribe({event:"onBeginFilterApplied"},function(){Y=!0})),oe.push(ge.subscribe({event:"onFilterApplied"},function(){Y=!1})),oe.push(ge.subscribe({event:"onBeginFilterRemoved"},function(){Y=!0})),oe.push(ge.subscribe({event:"onFilterRemoved"},function(){Y=!1})),X=ge.getRoots().map(function(e){return s.getNodeID(e)}),Array.prototype.push.apply(X,ye.getHiddenRootIds()),oe.push(ge.subscribe({event:"onRootAdded"},function(e){-1===X.indexOf(e.id)&&X.push(e.id);var t=Object.keys(re).map(function(e){return re[e]});ut(t).then(function(){it(t),$e(),function(){var e=0;ge.getRoots().forEach(function(t){t.userData&&"R2V_FeatureState"===t.userData.type&&e++});var t=require("DS/CATWebUXComponents/DMUCommandsManager");let n;e===ge.getRoots().length?((n=t.getCommandCheckHeader("PIMInteferenceListHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommandCheckHeader("PIMDisplayClashCurveHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommandCheckHeader("PIMDisplayContactCurveHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommandCheckHeader("PIMDisplayClearanceCurveHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommandCheckHeader("PIMDisplayQuantifiersHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommandCheckHeader("PIMZoomOnInterferenceHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommandCheckHeader("PIMApplyTransparencyHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommandCheckHeader("PIMColorOverloadHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommand("PIMwebCreateItfHdr",ge.getCommandContext()))&&n.disable(),(n=t.getCommand("PIMwebEditItfHdr",ge.getCommandContext()))&&n.disable()):e>=1&&((n=t.getCommandCheckHeader("PIMInteferenceListHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommandCheckHeader("PIMDisplayClashCurveHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommandCheckHeader("PIMDisplayContactCurveHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommandCheckHeader("PIMDisplayClearanceCurveHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommandCheckHeader("PIMDisplayQuantifiersHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommandCheckHeader("PIMZoomOnInterferenceHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommandCheckHeader("PIMApplyTransparencyHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommandCheckHeader("PIMColorOverloadHdr",ge.getCommandContext()))&&n.enable(),(n=t.getCommand("PIMwebCreateItfHdr",ge.getCommandContext()))&&n.enable())}()})})),oe.push(ge.subscribe({event:"onRootRemoved"},function(e){if(!Y){var t=X.indexOf(e.id);-1!==t&&X.splice(t,1);var n=c.getLoadedIsr();Object.keys(n).forEach(function(t){n[t].getIsrContexts().map(function(e){return e.prd.physicalid}).indexOf(e.id)>-1&&mt(t)})}})),oe.push(ge.subscribe({event:"onEndDelete"},function(){function e(e,t){if(!e||!t)return!1;for(var n=1;n<t.length;n+=2)if(e===t[n].physicalid)return!0;return!1}return function(t){var n=[],i=t.pathToReparent?"string"==typeof t.pathToReparent?t.pathToReparent:s.getNodeID(t.pathToReparent):null;i&&(Object.keys(re).forEach(function(t){var r=re[t],a=!1;e(i,r.itfPath1)&&(r.itfLblInst1=r.itfLblInst1Owner=r.itfLblInst1OwnerID=r.itfLblInst1Path=r.itfLblRef1=r.itfLblRef1Owner=r.itfLblRef1OwnerID=void 0,r.itfLblRef1Path=r.itfLblShape1=r.itfLblShape1Owner=r.itfLblShape1OwnerID=void 0,a=!0),e(i,r.itfPath2)&&(r.itfLblInst2=r.itfLblInst2Owner=r.itfLblInst2OwnerID=r.itfLblInst2Path=r.itfLblRef2=r.itfLblRef2Owner=r.itfLblRef2OwnerID=void 0,r.itfLblRef2Path=r.itfLblShape2=r.itfLblShape2Owner=r.itfLblShape2OwnerID=void 0,a=!0),a&&(Be(t),n.push(r))}),n.forEach(function(e){re[e.itfuid]=e}),p&&(p.updateInterferences(_e(n)),$e()))}}())),ge.getApplicativeData().getLoadedItfData=function(){var e,t,n,i={loadMode:"1"===Ae?1:0,data:[]},r=Object.keys(pe||{});return 1!==r.length?i:(r=r[0],t=((t=(e=c.getIsr(r))?e.getIsrContexts():[])||[]).map(function(e){return e.prd?e.prd.physicalid:null}).filter(function(e){return e}),n=e?e.getAttributes():{},i.data.push({isrID:r,metricID:[].concat(pe[r]),label:n.label,prd:t,type:n.type}),i)},ge.getApplicativeData().removeIsrKeepContext=mt,this.load=Mt,this.clearIsr=gt,this.loadApplicativeContext=function(e){return ke=!0,new Promise(function(n){setTimeout(Pt,1500),te||(te=vt()),te.then(()=>{(function(e){return new Promise(function(t){var n=e.PIM?e.PIM:e,i=n.contextuals?n.contextuals:[];let r=[];i.forEach(function(e){e.path1Ids&&e.path1Ids.forEach(function(e){-1===r.indexOf(e)&&r.push(e)}),e.path2Ids&&e.path2Ids.forEach(function(e){-1===r.indexOf(e)&&r.push(e)})});for(var a=Math.floor((r.length-1)/700)+1,o=0,s=[];o<a;){let e=r.slice(700*o,700*(o+1));s.push(new Promise(function(t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"PIMNonPersistentData-"+Date.now(),select_predicate:["physicalid","ds6w:label","ds6w:responsible","owner","ds6w:type"],select_file:[]}),onComplete:function(e){let n=JSON.parse(e),i={resourceid:"resourceid",physicalid:"physicalid","ds6w:type":"type",owner:"ownerID","ds6w:responsible":"owner","ds6w:label":"label"};(n.results||[]).forEach(function(e){let t={};(e.attributes||[]).forEach(function(e){t[i[e.name]]=e.value}),Re.hasOwnProperty(t.physicalid)||(Re[t.physicalid]=t)}),t()},onFailure:function(){t()},onTimeout:function(){t()}})})),o++}0===s.length?t():Promise.all(s).then(function(){i.forEach(function(e){e.path1Ids&&e.path1Ids.forEach(function(t){e.itfPath1||(e.itfPath1=[]),e.itfPath1.push(Re.hasOwnProperty(t)&&Re[t]?Re[t]:{})}),e.path2Ids&&e.path2Ids.forEach(function(t){e.itfPath2||(e.itfPath2=[]),e.itfPath2.push(Re.hasOwnProperty(t)&&Re[t]?Re[t]:{})})}),Ue("onDMUCtxtLoadingSuccess"),t()})})})(Ve=t.clone(e.PIM?e.PIM:e)).then(function(){var e=Ve.contextuals?Ve.contextuals:[];setTimeout(function(){e&&dt(e),Ue("onDMUCtxtLoadingSuccess"),n()},1e3)})})})},this.cleanApplicativeContext=function(e,t){if((0===Object.keys(pe).length||t)&&(p&&Ye(Fe(),!0),pt(),v&&v.destroy(),v=null,t&&(pe={}),(p=null)&&p.removeInterferences(),Ve={},re={},ae={},e)){let e=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",ge.getCommandContext());e&&e.setState(!1)}ke=!1},this.removeIsr=mt,this.showGUX=function(){be=!0,le&&(St(),wt(),v.show(),nt())},this.hideGUX=function(){be&&(be=!1,xt())},this.isUIVisible=function(){return be},this.applyDisplay=function(e,t,n){-1!==Object.keys(Ee).indexOf(e)&&"number"==typeof t&&(Ee[e]=t?1:0,n||("clash"===e?Object.keys(he).forEach(e=>he[e].children[2].children.forEach(e=>e.children[0].setVisibility(t))):"contact"===e?Object.keys(he).forEach(e=>he[e].children[1].children.forEach(e=>e.children[0].setVisibility(t))):"clearance"===e?Object.keys(he).forEach(e=>he[e].children[0].children.forEach(e=>e.children[0].setVisibility(t))):"quantifiers"===e?Object.keys(he).forEach(e=>he[e].children.forEach(e=>e.children.forEach(e=>e.children[1].setVisibility(t)))):"zoom"===e?(Se=!0,je()):"colorsState"!==e&&"transparencyState"!==e||Xe(),ge.getViewer().render()))},this.exportAsCSV=function(e){return p.exportAsCSV(e)},this.getIsrContext=function(e){return new Promise(function(t){if(ge.getApplicativeData().getLoadedItfData){var n=ge.getApplicativeData().getLoadedItfData();if((n=n.data.length?n.data[0]:null)&&n.isrID===e){var i=[];return n.prd&&n.prd.length&&i.push(n.prd[0]),void t(i)}}r._navigateFromIsrToContext({isrID:e,onComplete:function(e){var n,i=JSON.parse(e);i&&i.result&&1===i.result.length?(n=i.result[0].outputs&&i.result[0].outputs.prd,t(n&&n.physicalid?[n.physicalid]:[])):t([])},onFailure:function(){t([])}})})},this.getLoadedIsr=function(){return Object.keys(pe).map(function(e){return{isrID:e,isr:c.getIsr(e)}})},this.getSelectedMetric=function(){var e=[];return Fe().forEach(function(t){e.push(re[t])}),e},this.getLengthUnit=function(){return{unit:J.Length.unit,decimalPlace:J.Length.decimalPlaceRW,TrailingZero:Te}},this.getSpecAndContextInfoFromCtrl=function(){let e=ge.getRoots().map(function(e){return s.getNodeID(e)})[0];var t=Ve.spec;return t.context={prd:{}},t.context.prd=Re[e],t.isEditable=!ke,t},this.getIsrComputationStatus=function(){return!!c.isUpdateSimulationAllowed()&&("pending"!==Ie&&"running"!==Ie)},this.getLoadedData=function(){return t.clone(pe,!0)},this.isPIMDataLoaded=function(){return ke},this.activateUI=function(){ce||(ce=!0,q&&(q.setVisibility(!0),q.setVisibilityFree(!1)),B&&W&&-1===B.getSceneGraphOverrideSetIndex(W)&&B.pushSceneGraphOverrideSet(W),ge.getViewer().render(),be&&ie.showGUX())},this.deactivateUI=function(){ce&&(ce=!1,q&&(q.setVisibility(!1),q.setVisibilityFree(!0)),B&&W&&B.removeSceneGraphOverrideSet(W),ge.getViewer().render(),xt())},this.isActivatedUI=(()=>ce),this.activate=function(e){if(!le){if(le=!0,setTimeout(Pt,1500),te||(te=vt()),F=e.mkpCtx||!1,_=null,ie.readOnly(e.readOnly),F||r._getIsrTypes().then(function(e){var t=function(e){f.multiTenantMgt([e],s.getRoots(ge),function(t){!t.isMultiTenant&&le&&Mt({isrID:[e.objectId]})})},n={_PLMPIMMetricReference:function(e){f.multiTenantMgt([e],s.getRoots(ge),function(t){!t.isMultiTenant&&le&&Mt({metricID:[e.objectId]})})},...M.getDelegation(ge)};e.forEach(function(e){n["_"+e]=t}),ge.setLoadingDelegations(n)}),ie.activateUI(),F||function(){var e,t,n;function i(e){if("number"!=typeof e)return!1;var t,n,i,r,a=p.getNumberOfRows(),o=e<0?a-1:e>=a?0:e;if(o<0||o>=a)return window.console.log("No interference in list for slide show"),!1;p.selectRows([o]);var s=Fe(!0);return 1===s.length&&(i="Undefined"===(n="Undefined"===(t=re[s[0]]?re[s[0]]:p?p.getRowInternalData(o):{}).itfUserType?t.itfSystemType:t.itfUserType)?"I_InterferenceCheck":"I_PIM_"+n,r=w.itfAnalysis+": ",r+=w["NotAnalyzed"===t.itfAnalysis?"NotAnalyzed"!==t.itfPrevAnalysis?"itfToReAnalyze":"itfToAnalyze":"itf"+t.itfAnalysis]+"\n",r+=w.itfPrevAnalysis+": "+(w["itf"+t.itfPrevAnalysis]||"-")+"\n",r+=w.itfDescription+": "+(t.itfDescription||"-"),Q.displaySlideInformation({primary:(t.itfCtxName?t.itfCtxName:t.itfName)+" ("+(o+1)+" / "+a+") ",secondary:w[n],hidden:r,icon:b.getWebappsAssetUrl("PIMwebUX","icons/32/")+i+".png"})),!0}Q||(Q=a.getSlideShowController({context:ge.getFrameWindow(),id:"PIMwebSlideShow",params:{activateRotation:!0}}),Pe.push(Q.subscribe("onPreviousSlideCB",function(){var e=p.getSelectedRows();i(e&&e.length?e.length>1?e[0]:e[0]-1:0)})),Pe.push(Q.subscribe("onNextSlideCB",function(){var e=p.getSelectedRows();i(e&&e.length?e.length>1?e[0]:e[0]+1:0)})),Pe.push(Q.subscribe("onFirstSlideCB",function(){i(0)})),Pe.push(Q.subscribe("onLastSlideCB",function(){i(p.getNumberOfRows()-1)})),Pe.push(Q.subscribe("onActiveStateModified",function(r){if(r.state&&0===Object.keys(pe).length)r.onBeginSlideShow(!1);else{r.state&&r.onBeginSlideShow(!0);var a=ge.getViewer();if(r.state?(e=ge.isDefaultContextualMenuVisible(),t=ge.isDefaultContextualBarVisible(),n=ge.isOpenWithMenuAvailable(),ge.setDefaultContextualBarVisibility(!1),ge.setDefaultContextualMenuVisibility(!1),ge.setOpenWithMenuAvailability(!1)):(ge.setDefaultContextualBarVisibility(e),ge.setDefaultContextualMenuVisibility(t),ge.setOpenWithMenuAvailability(n)),r.state){var o,s=Boolean(v);be?v.hide():(wt(),v.hide(),St(),a.render()),a.setPicking({activated:!1,trapSelection:!1}),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",ge.getCommandContext()).disable(),s?i((o=p.getSelectedRows())&&0!==o.length?1===o.length?o[0]:null:0):setTimeout(function(){i((o=p.getSelectedRows())&&0!==o.length?1===o.length?o[0]:null:0)},100)}else be?v.show():(N&&N.hide(),a.render()),v&&v.ensureSelectedLineVisibility(),a.setPicking({activated:!0,trapSelection:!0}),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",ge.getCommandContext()).enable()}})))}(),p&&p.showSlideColumn(F),e.noStatusBarCmd){var n=l.getLayout_options("frmWindow_opts").contextualMenuContent;ge.getFrameWindow().getContextualUIManager().register({subscriberId:"PIMweb3DPlayExperience",workbenchName:n.workbenchName,module:n.module,cmdPrefix:"",context:ge.getCommandContext(),merge:!0,onContextualMenuReady:function(e,t){if(!Q||!Q.getActiveState()){var i=require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("FlyWalkCmd",ge.getCommandContext());if((!i||!i.isRunning())&&"number"==typeof t.XmousePosition&&"number"==typeof t.YmousePosition&&ge.getViewer()){var r=ge.getViewer().pick({xPix:t.XmousePosition,yPix:t.YmousePosition},"mesh",!0).path,a=[],o=[];if(ge.getExecutionContext){0===r.length&&(d.isMobile()||o.push("VisuQMCommand"),n.emptiness.ambiences&&n.emptiness.ambiences.length&&o.push(...n.emptiness.ambiences));for(let e=0;e<o.length;e++)a.push({type:"WAfrDefaultHandlerItem",handlerId:o[e]});return a}return 0===r.length&&(d.isMobile()||a.push({name:"PIMwebDisplaySection",line:1,resourceFile:"PIMwebViewController/PIMwebViewController",hdr_list:["VisuQMCommand"]}),n.emptiness.ambiences&&n.emptiness.ambiences.length&&a.push({name:"PIMwebAmbiencesSection",line:1,resourceFile:"PIMwebViewController/PIMwebViewController",hdr_list:n.emptiness.ambiences})),{cmdList:a}}}}})}z||(z=P.givePreferenceManager({context:ge.getFrameWindow()}))&&(z.addPreferences(C.getPreferencesDefinition()),ve.push(z.subscribe("com.ds.mep:onPrefUpdate",function(e){var n=Ae;if(It(JSON.parse(e[1].preferences).repositories,!0),n!==Ae){var i=t.clone(pe),r=Object.keys(i);r&&1===r.length&&0===i[r[0]].length&&(gt(),Mt({isrID:r[0]}))}}))),ge.getExecutionContext||(Z=ge.getFrameWindow().getActionBar().onActionBarReady(yt))}},this.deactivate=function(){if(le){le=!1,F||ge.setLoadingDelegations({}),F=!1,Oe=!1,_=null,Se=!0,ie.deactivateUI(),Q&&Pe.forEach(Q.unsubscribe,Q),Pe=[],ne&&(A.unreferenceSelectionManager({context:ge}),ne=null),a.unreferenceSlideShowController({context:ge.getFrameWindow(),id:"PIMwebSlideShow"}),Q=te=null,z&&(z.removePreferences(["PIMwebPreferences"]),ve.forEach(z.unsubscribe,z),ve=[],z=null),ge.getExecutionContext||(ge.getFrameWindow().getActionBar().removeCallback(Z),Z=null);var e=[];Object.keys(re).forEach(function(t){re[t].itfLblSlide&&(re[t].itfLblSlide=0,e.push(re[t]))}),p&&(p.updateInterferences(_e(e)),p.showSlideColumn(!1)),ge.getFrameWindow().getContextualUIManager().unregister("PIMweb3DPlayExperience")}},this.isActivated=(()=>le),this.readOnly=function(e){Ce!==Boolean(e)&&(Ce=!Ce,v&&v.toggleReadOnly())},this.appInitFromTransition=function(t){return new e.Promise(function(e,n){var i,a,o=t.x3dContent,s=X,l=[];if(t.issues)a=require("DS/PADUtils/PADUtilsServices").getPlatformId(),o=null,l=t.issues.map(function(e){return{issueID:e.physicalid,attachments:e.attachments}});else if(o&&o.data&&o.data.items&&!s.length)for(i=0;i<o.data.items.length;++i){if("Issue"!==o.data.items[i].objectType){l=[];break}a||(a=o.data.items[i].envId),l.push({issueID:o.data.items[i].objectId})}l.length?require(["DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts"].concat([]),function(t,i,s){s.add("widget",window.widget),t.getSecurityContext=function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","")},t.getTenant=function(){return a},Promise.all([r._getIsrTypes(),t.initPlatformServices()]).then(function(t){r._sendUsageProbe("loadFromIssue",o?"x3dContent":"transition"),r._sendUsageProbe("loadFromIssue",o?"x3dContent":"transition"+l.length);var a=l.map(function(e){return new Promise(function(n){(e.attachments?new Promise(function(e){e({attachments:void 0})}):i.getDocumentsFrom(e.issueID)).then(function(e){var i={isr:[],metric:[]};(e&&Array.isArray(e.attachments)&&e.attachments||[]).forEach(function(e){e&&("PLMPIMMetricReference"===e.type?i.metric.push(e.id):t[0].indexOf(e.type)>-1&&i.isr.push(e.id))}),n(i)}).catch(function(){n({})})})});Promise.all(a).then(function(t){new Promise(function(e){var n,i,a=[];function s(e){return o?Promise.resolve(e):new Promise(function(t){r._navigateFromIsrToContext({isrID:e,onComplete:function(n){var i=JSON.parse(n),r=[];i&&i.result&&0!==i.result.length?(i.result.forEach(function(t){var n=e.indexOf(t.input_object.physicalid);if(-1!==n){r[n]=e[n];var i=t.outputs.prd&&t.outputs.prd.physicalid;i&&X&&-1!==X.indexOf(i)||(r[n]=null)}}),t(r)):t(r)},onFailure:function(){t([])}})})}!function o(l){l?l.isr&&l.metric&&(l.isr.length||l.metric.length)?!i&&l.isr.length?s(l.isr).then(function(t){t.some(function(e){return n=e}),n?e({isrIDToLoad:n,metricsToLoad:a}):(l.isr=[],o(l))}):l.metric.length?r._navigateFromMetricToIsr({metricIDs:l.metric,onComplete:function(e){var n=JSON.parse(e);if(n&&n.infos&&"OK"===n.infos.status&&n.result)if((n=n.result)&&Array.isArray(n)){for(var r={},l=0;l<n.length;l++)n[l].outputs.isr&&n[l].outputs.isr.length&&(r[n[l].outputs.isr[0].physicalid]||(r[n[l].outputs.isr[0].physicalid]=[]),r[n[l].outputs.isr[0].physicalid].push(n[l].input_object.physicalid));i?(r[i]&&(a=a.concat(r[i])),o(t.shift())):s(Object.keys(r)).then(function(e){e.some(function(e){return i=e}),i&&(a=a.concat(r[i])),o(t.shift())})}else o(t.shift());else o(t.shift())},onFailure:function(){o(t.shift())}}):o(t.shift()):o(t.shift()):e({isrIDToLoad:n,metricsToLoad:a})}(t.shift())}).then(function(t){var n,i=Object.keys(pe);t.isrIDToLoad?(n="_Isr",i.indexOf(t.isrIDToLoad)>-1&&i.forEach(mt),Mt({isrID:t.isrIDToLoad})):t.metricsToLoad&&t.metricsToLoad.length&&(n="_Metric"+t.metricsToLoad.length,i.forEach(mt),Mt({metricID:t.metricsToLoad})),r._sendUsageProbe("loadFromIssue",(o?"x3dContent":"transition")+(n||"_NoData")),e(n)})}).catch(n)}).catch(n)},n):e()}).then(function(e){e||t.onNoActionDone()}).catch(t.onNoActionDone).finally(function(){})},this.subscribe=function(e,t){return e&&t?se.subscribe({event:e},t):null},this.unsubscribe=function(e){if(null!=e)return se.unsubscribe(e)},this.destroy=function(){N&&N.destroy(),N=null,oe.forEach(function(e){ge.unsubscribe(e)}),A.unreferenceSelectionManager({context:ge}),ge=pe=null},this.applySlide=function(){var e;function n(e){if(le&&e){if(e.state||!ke){if(!e.state)return p&&p.selectRowsByUID([]),be&&xt(),void e.callback();if(be&&v&&v.show(),e.state.context&&e.state.context.data&&e.state.content){if(1!==e.state.context.data.length)return window.console.error("Invalid data stored in slide"),void e.callback();if(void 0===e.state.content.prefs.useStoredResults){let n=e.state.content.prefs.geometries,i=e.state.content.prefs.quantifiers;Number.isInteger(Me.geometries)?K=t.extend(t.clone(Me,!0),e.state.content.prefs):((K=t.clone(Me,!0)).useStoredResults=1,K.geometries={mode:1,clash:n,contact:n,clearance:n},K.quantifiers={minDist:!!i.minDist&&i.minDist}),Ee.clash=Ee.contact=Ee.clearance=0===n?0:1,Ee.quantifiers=!0===i.minDist?1:0}else if((K=t.extend(t.clone(Me,!0),e.state.content.prefs)).useStoredResults=void 0!==e.state.content.prefs.useStoredResults?e.state.content.prefs.useStoredResults:1,!Number.isInteger(Me.geometries)){let t=void 0!==e.state.content.prefs.geometriesDef?e.state.content.prefs.geometriesDef:e.state.content.prefs.geometries;K.geometries={mode:t.mode,clash:t.clash,contact:t.contact,clearance:t.clearance},K.quantifiers={minDist:!!e.state.content.prefs.quantifiers.minDist&&e.state.content.prefs.quantifiers.minDist}}var n=e.state.context.data[0],i=n.isr,r=n.itfs.filter(function(e){return re[e]});if(!pe[i]&&!ke)return window.console.error("Isr id stored in slide does not match currently loaded one"),void e.callback();e.state.content.itfs.forEach(function(e){if(r.indexOf(e.id)>-1)if(Array.isArray(e.pos3D)&&3===e.pos3D.length)re[e.id].pos3D=[].concat(e.pos3D);else if(Array.isArray(e.pos3Drel)&&3===e.pos3Drel.length){let t=re[e.id];if(t.itfQtfPt1&&t.itfQtfPt2){let n=[.5*(t.itfQtfPt2[0]+t.itfQtfPt1[0]),.5*(t.itfQtfPt2[1]+t.itfQtfPt1[1]),.5*(t.itfQtfPt2[2]+t.itfQtfPt1[2])];"Clash"===t.itfSystemType&&(n=[t.itfQtfPt1[0],t.itfQtfPt1[1],t.itfQtfPt1[2]]),re[e.id].pos3D=[n[0]+e.pos3Drel[0],n[1]+e.pos3Drel[1],n[2]+e.pos3Drel[2]]}}}),G=e.noCtxChangedEvt,new Promise(function(e){p?e():(wt(),v.hide(),St(),N.hide(),setTimeout(e,100))}).then(function(){if(e.state.content.prefs.displayOptions){let n=t.clone(Ee.zoom,!0);(Ee=t.clone(e.state.content.prefs.displayOptions,!0)).zoom=n}let n=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayClashCurveHdr",ge.getCommandContext());n&&(n.setState(1===Ee.clash),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayContactCurveHdr",ge.getCommandContext()).setState(1===Ee.contact),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayClearanceCurveHdr",ge.getCommandContext()).setState(1===Ee.clearance),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayQuantifiersHdr",ge.getCommandContext()).setState(1===Ee.quantifiers),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMApplyTransparencyHdr",ge.getCommandContext()).setState(1===Ee.transparencyState),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMColorOverloadHdr",ge.getCommandContext()).setState(1===Ee.colorsState)),p.selectRowsByUID(r)&&He(r,K,!0),setTimeout(function(){G=!1,j=!0,K=null,e.callback&&e.callback()},100)})}else e.callback()}}else e.callback()}return function(t){clearInterval(e),H?e=setInterval(function(){H||(clearInterval(e),n(t))},100):n(t)}}(),this.getDataForSlide=function(){let e,n=Fe(),i=Object.keys(pe),r=Me,a=t.clone,o=a(Ee);if(void 0!==(e={version:1,context:{data:[]},content:{prefs:{useStoredResults:r.useStoredResults,quantifiers:a(r.quantifiers),geometries:a(r.geometries),displayOptions:a(o)},itfs:[]}}).content.prefs.displayOptions.zoom&&delete e.content.prefs.displayOptions.zoom,(i=i.length?i[0]:ke?"1":null)||ke)return e.context.data=[{isr:i,itfs:n.map(function(t){return re[t].pos3D&&e.content.itfs.push({id:t,pos3D:re[t].pos3D}),t})}],e;window.console.error("No loaded isr in session")},this.getContextForMarkup=function(){let e=Object.keys(pe);if(!(e=e.length?e[0]:null))return;let t=c.getIsr(e).getIsrContexts();return t&&1===t.length&&t[0].prd?t[0].prd.physicalid:void 0},this.getTitleForSlide=function(){var e=Fe();if(e&&e.length&&e[0]&&re[e[0]])return re[e[0]].itfCtxName},this.updateSlideCount=function({slidesAppData:e}){if(!ke||0!==Object.keys(pe).length){_=e;var t=ft();t.length&&p&&p.updateInterferences(_e(t.map(function(e){return re[e]})))}},this.getOrderedSlides=function(e,t){if(e&&t)return e.filter(function(e){return e.context.data.some(function(e){return e.itfs.some(function(e){return t.indexOf(e)>-1})})})},this.allowReframe=function(e){return"boolean"==typeof e&&(Se=e),Se},this.getPimTicInfo=function(e,t){var n=Object.keys(pe);if(n=1===n.length?n[0]:null)return Tt({cmdType:e,itf:t?Fe():[],isr:n});window.console.error("No  isr in session")},this.onIssueSuccess=function(e){p&&"Issue"===e.type&&e.attachmentIDs.forEach(function(t){p.onIssueSuccess({itfuid:t},e.ticID)})},this.getMkpTicInfo=function(e,t,n){var i=Object.keys(pe),r={cmdType:e,itf:[]};if(!(i=1===i.length?i[0]:null))return window.console.error("No  isr in session"),void n();t.forEach(function(e){var t=e.state.context;t&&t.data&&1===t.data.length&&t.data[0].isr===i&&t.data[0].itfs.forEach(function(e){-1===r.itf.indexOf(e)&&r.itf.push(e)})}),r.isr=i,Tt(r).then(n)},this.getIsrPointingToMetric=function(e){var t={};if(!e||!e.length||!Array.isArray(e))return Promise.resolve(t);var n=Object.keys(pe),i=[].concat(e);return n.forEach(function(e){var n;for(n=i.length-1;n>=0;--n)pe[e].indexOf(i[n])>-1&&(t[i[n]]=[e],i.splice(n,1))}),i.length?new Promise(function(e){r._navigateFromMetricToIsr({metricIDs:i,onComplete:function(n){var r=JSON.parse(n);(r&&r.result||[]).forEach(function(e){-1!==i.indexOf(e.input_object.physicalid)&&(t[e.input_object.physicalid]=e.outputs.isr&&e.outputs.isr[0].physicalid?[e.outputs.isr[0].physicalid]:[])}),e(t)},onFailure:function(){e(t)}})}):Promise.resolve(t)}}}),N=[],F=function(e){var t;return N.some(function(n){return n.pad3DViewer===e&&(t=n)}),t},_=function(e){e&&N.some(function(t,n){var i;return t.itfCtrl===e?(i=!0,t.itfCtrl=null):t.mkpCtrl===e?(i=!0,t.mkpCtrl=null):t.loaderMkp===e&&(i=!0,t.loaderMkp=null),i&&t.ctrl.deactivate(),t.itfCtrl||t.mkpCtrl||t.loaderMkp||(t.ctrl.destroy(),t.pad3DViewer=t.ctrl=null,t=null,N.splice(n,1)),i})},j=function(e,t,n){t||(t={pad3DViewer:e,ctrl:new U({pad3DViewer:e})},N.push(t));var i=t.ctrl;return"itf"!==n||t.itfCtrl?"mkpUI"!==n||t.mkpCtrl?"loaderMkp"!==n||t.loaderMkp||(t.loaderMkp={load:function(e){if(i&&e&&e.data){var t={loadMode:e.data.loadMode};(e.data.metricID||e.data.isrID)&&(e.data.metricID?t.metricID=e.data.metricID:t.isrID=e.data.isrID,i.cleanApplicativeContext&&i.cleanApplicativeContext(!1,!1,!0),i.load(t))}},getIsrPointingToMetric:function(){return t.loaderMkp&&i?i.getIsrPointingToMetric.apply(null,arguments):void 0},getIsrContext:function(){return t.loaderMkp&&i?i.getIsrContext.apply(null,arguments):void 0},remove:function(){return t.loaderMkp&&i?i.removeIsr():void 0},subscribe:function(){return t.loaderMkp&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(e){return t.loaderMkp&&i?i.unsubscribe(e):void 0},dereference:function(){_(t.loaderMkp)}},Object.freeze(t.loaderMkp)):(t.mkpCtrl={setActiveState:function(e){return t.mkpCtrl&&i?i[e?"activateUI":"deactivateUI"]():void 0},getActiveState:function(){return t.mkpCtrl&&i?i.isActivatedUI():void 0},subscribe:function(){return t.mkpCtrl&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(e){return t.mkpCtrl&&i?i.unsubscribe(e):void 0},initializeAppContainer:function(e){if(!i||!t.mkpCtrl)return null;i.activate({readOnly:!0,mkpCtx:!0}),e.options&&e.options.authoring&&v.getGrantedRoles(function(e){i.readOnly(!e.some(function(e){return("RED"===e.id||"InternalDS"===e.id||"DMRMH"===e.id)&&("InternalDS"===e.id||(e.platforms||[]).indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)}))}),e.onApplicativeControllerInitialized()},onLeavingApp:function(){return t.mkpCtrl&&i?i.deactivate():void 0},getApplicativeContainerID:function(){return"ITF"},displayAppContainerState:function(){return t.mkpCtrl&&i?i.applySlide.apply(null,arguments):void 0},getCurrentAppContainerState:function(){return t.mkpCtrl&&i?i.getDataForSlide():void 0},getCurrentAppContainerStateTitle:function(){return t.mkpCtrl&&i?i.getTitleForSlide():void 0},updateAppContainer:function(e){return t.mkpCtrl&&i?i.updateSlideCount(e):void 0},getOrderedAppContainerStates:function(){return t.mkpCtrl&&i?i.getOrderedSlides.apply(null,arguments):void 0},setMinimalUIFlag:function(e){return t.mkpCtrl&&i?i[e?"hideGUX":"showGUX"]():void 0},getMinimalUIFlag:function(){return t.mkpCtrl&&i?!i.isUIVisible():void 0},setAppViewpointManipFlag:function(e){return t.mkpCtrl&&i?i.allowReframe(Boolean(e)):void 0},getAppViewpointManipFlag:function(){return t.mkpCtrl&&i?i.allowReframe():void 0},getAppContainerTICInfo:function(){return t.mkpCtrl&&i?i.getMkpTicInfo.apply(null,arguments):void 0},dereference:function(){_(t.mkpCtrl)},getContextRootID:function(){return t.mkpCtrl&&i?i.getContextForMarkup():void 0}},Object.freeze(t.mkpCtrl)):(t.itfCtrl={load:function(){return t.itfCtrl&&i?i.load.apply(null,arguments):void 0},activate:function(){return t.itfCtrl&&i?i.activate.apply(null,arguments):void 0},deactivate:function(){return t.itfCtrl&&i?i.deactivate.apply(null,arguments):void 0},showGUX:function(){return t.itfCtrl&&i?i.showGUX.apply(null,arguments):void 0},hideGUX:function(){return t.itfCtrl&&i?i.hideGUX.apply(null,arguments):void 0},clearIsr:function(){return t.itfCtrl&&i?i.clearIsr.apply(null,arguments):void 0},removeIsr:function(){return t.itfCtrl&&i?i.removeIsr.apply(null,arguments):void 0},subscribe:function(){return t.itfCtrl&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(){return t.itfCtrl&&i?i.unsubscribe.apply(null,arguments):void 0},applyDisplay:function(){return t.itfCtrl&&i?i.applyDisplay.apply(null,arguments):void 0},exportAsCSV:function(){return t.itfCtrl&&i?i.exportAsCSV.apply(null,arguments):void 0},getLoadedIsr:function(){return t.itfCtrl&&i?i.getLoadedIsr.apply(null,arguments):void 0},getSelectedMetric:function(){return t.itfCtrl&&i?i.getSelectedMetric.apply(null,arguments):void 0},getLengthUnit:function(){return t.itfCtrl&&i?i.getLengthUnit.apply(null,arguments):void 0},getSpecAndContextInfoFromCtrl:function(){return t.itfCtrl&&i?i.getSpecAndContextInfoFromCtrl.apply(null,arguments):void 0},getIsrComputationStatus:function(){return t.itfCtrl&&i?i.getIsrComputationStatus.apply(null,arguments):void 0},getLoadedData:function(){return t.itfCtrl&&i?i.getLoadedData.apply(null,arguments):void 0},isPIMDataLoaded:function(){return t.itfCtrl&&i?i.isPIMDataLoaded.apply(null,arguments):void 0},appInitFromTransition:function(){return t.itfCtrl&&i?i.appInitFromTransition.apply(null,arguments):void 0},getTICInfo:function(){return t.itfCtrl&&i?i.getPimTicInfo.apply(null,arguments):void 0},onIssueSuccess:function(){return t.itfCtrl&&i?i.onIssueSuccess.apply(null,arguments):void 0},dereference:function(){_(t.itfCtrl)}},Object.freeze(t.itfCtrl)),t},G=Object.create({}),W=Object.getPrototypeOf(G);return W.giveItfCtrl=function(e){var t=F(e?e.pad3DViewer:null);return t&&t.itfCtrl?t.itfCtrl:null},W.getItfCtrl=function(e){if(!e||!e.pad3DViewer)return null;var t=F(e.pad3DViewer);return t&&t.itfCtrl||(t=j(e.pad3DViewer,t,"itf")),t.itfCtrl},W.unreferenceApplicativeController=function(e){if(!e||!e.context)return null;var t=F(e.context);t&&t.mkpCtrl&&t.mkpCtrl.dereference()},W.giveApplicativeController=function(e){if(!e||!e.context)return null;var t=F(e.context);return t&&t.mkpCtrl?t.mkpCtrl:null},W.getApplicativeController=function(e){if(!e||!e.context)return null;var t=F(e.context);return t&&t.mkpCtrl||(t=j(e.context,t,"mkpUI")),t.mkpCtrl},W.giveLoaderForMarkup=function(e){if(!e||!e.context)return null;var t=F(e.context);return t&&t.loaderMkp?t.loaderMkp:null},W.getLoaderForMarkup=function(e){if(!e||!e.context)return null;var t=F(e.context);return t&&t.loaderMkp||(t=j(e.context,t,"loaderMkp")),t.loaderMkp},W.loadApplicativeContext=function(e,t){return new Promise(function(n){var i=F(t);i||(i&&i.itfCtrl||(i=j(t,i,"itf")),i=j(t,i,"mkpUI"));var r=i.ctrl;r&&(r.cleanApplicativeContext(!1,!0),r.loadApplicativeContext(e).then(()=>{r.activate({readOnly:!0,mkpCtx:!0});let e=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",t.getCommandContext());e?(e.disable(),e.setState(!0)):localStorage.setItem("PIMwebItfListVisPref","1"),n()}))})},W.cleanApplicativeContext=function(){return new Promise(function(e){N.some(function(e,t){e.ctrl.cleanApplicativeContext(!0);let n=e.ctrl.getLoadedData();0===Object.keys(n).length&&(e.ctrl.deactivate(),e.itfCtrl||e.mkpCtrl||e.loaderMkp||(e.ctrl.destroy(),e.ctrl=null,e=null,N.splice(t,1)))}),e()})},Object.freeze(G)}),define("DS/PIMwebViewController/PIMwebDefaultCmdV2",["DS/PADUtils/PADContext","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],function(e,t,n){"use strict";var i,r;return class{constructor(){i=e.get(),(r=t.givePreferenceManager({context:i.getFrameWindow()}))&&(r.setUnitsPreferencesDisplayFlag(!0),r.setDisplayPreferencesDisplayFlag(!0),r.set3DSelectionPreferencesDisplayFlag(!0),r.setMeasurePreferencesDisplayFlag(!0),r.setClippingPreferencesDisplayFlag(!0),r.setPreferredPreferenceContainersOrder(["PIMwebPrefLoad","PIMwebPrefDisplay","TICSection","MeasurePreferences","SectionPreferences"])),this.beginExecute=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!0),i.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0})},this.resumeExecute=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!0),i.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0}),this.done()},this.pauseExecute=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!1),this.done()},this.destroy=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!1),i=r=null}}}}),define("DS/PIMwebViewController/PIMwebLeaderNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/SceneGraphFactory"],function(e,t,n,i,r){"use strict";var a=new e.Matrix4;return t.extend({init:function(t){this._parent(),this.name="LeaderNode";var o,s=t.viewpoint,l=s.viewer.canvas,c=new e.Projector,u=t.fixPt,f=t.width,d=t.height,p=new e.Vector3(1,0,0),h=1,m=new e.Vector3(1,0,0),g=1,y=new e.LineBasicMaterial({side:e.DoubleSide,color:t.color,transparent:!0,opacity:1,force:!0,lineWidth:1});y.color=t.color;var C=r.createLineNode({points:[new e.Vector3(0,0,0),new e.Vector3(0,0,1)],material:y}),b=new i({constraintAxis:p,type:"Cylindrical",viewpoint:s});b.setMatrix((new e.Matrix4).setPosition(u)),b.addChild(C),this.addChild(b);var I=r.createLineNode({points:[new e.Vector3(0,0,0),new e.Vector3(0,0,1)],material:y}),P=new i({constraintAxis:m,type:"Cylindrical",viewpoint:s});function v(e){a.makeScale(1,1,h),C.setMatrix(a),b.cbChange(e),a.makeScale(1,1,g),I.setMatrix(a),P.cbChange(e)}function S(e){s===e.viewpoint&&"@onViewpointChange"===e.eventType&&v(e)}function w(e){var t=c.projectVector(e,s.getCamera());return{top:Math.round((0-t.y)*(l.offsetHeight/2)+l.offsetHeight/2),left:Math.round(t.x*(l.offsetWidth/2)+l.offsetWidth/2)}}P.addChild(I),this.addChild(P),this._onLinkedToSceneGraph=function(){o=n.subscribe({event:"/VISU/"},S)},this._onUnlinkedToSceneGraph=function(){n.unsubscribe(o)},this._getDynamicMatrix=function(e,t,n){return v(t),this.getMatrix()},this.updateLeader=function(t){var n,i=Number.MAX_VALUE,r=new e.Vector3(.5*f,.5*d,0),a=[new e.Vector3(.5*f,0,0),new e.Vector3(.5*f,d,0),new e.Vector3(-15,.5*d,0),new e.Vector3(f+15,.5*d,0)];a.forEach(function(e){e.applyMatrix4(t);var r=e.distanceTo(u);r<i&&(i=r,n=e)}),function(t,n){p.subVectors(t,u),h=p.length(),p.normalize(),b.setConstraintAxis(p),P.setMatrix((new e.Matrix4).setPosition(t)),m.subVectors(n,t),g=m.length(),m.normalize(),P.setConstraintAxis(m)}(n,r.applyMatrix4(t)),v({viewpoint:s});var o=w(u.clone());a.push(new e.Vector3(0,.5*d,0).applyMatrix4(t)),a.push(new e.Vector3(f,.5*d,0).applyMatrix4(t)),a.push(new e.Vector3(0,0,0).applyMatrix4(t)),a.push(new e.Vector3(f,0,0).applyMatrix4(t)),a.push(new e.Vector3(f,d,0).applyMatrix4(t)),a.push(new e.Vector3(0,d,0).applyMatrix4(t));var l=a.some(function(e){return e=w(e),Math.abs(e.top-o.top)<=15&&Math.abs(e.left-o.left)<=15});this.setVisibility(!l),this.setVisibilityFree(l)}}})}),define("DS/PIMwebViewController/PIMWebViewTools",["DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebToolsMeasure","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsFiniteGeometry","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Visualization/PrimitiveIterator"],function(e,t,n,i,r,a,o){"use strict";var s,l,c=1e-6,u=1024,f=200,d=4,p=.001,h=p*p,m=.001,g=function(){this.clash=[],this.contact=[],this.clearance1=[],this.clearance2=[],this.isClash=!1,this.status="OK"};function y(e,t){if(e.internalPath.length)return new o(e,t);let n=function e(t){if(t&&t.mesh3js)return t;for(let n=0;n<t.children.length;++n){let i=e(t.children[n]);if(i)return i}}(e.getLastElement());return n?new o(n,t):void 0}function C(e,t){let n=[],r=e?e.getNbPrimitives():0;for(let a=0;a<r;++a){if("FACE"!==e.getGeomType(a)||e.getConnectivityType(a)!==o.TRIANGLES)continue;let r,s,l,c,u=e.getLength(a),f=e.getOffset(a),d=e.getIndexArray(a),p=e.getPositionArray(a),h=[],m=[];if(d&&p){if(t&&!i.isIdentity(t))for(let e=0;e<u;++e)r=3*d[f+e],h[e]=i.transformPoint([p[r],p[r+1],p[r+2]],t);else for(let e=0;e<u;++e)r=3*d[f+e],h[e]=[p[r],p[r+1],p[r+2]];m[0]=m[3]=h[0][0],m[1]=m[4]=h[0][1],m[2]=m[5]=h[0][2];for(let e=1;e<u;++e)s=h[e][0],l=h[e][1],c=h[e][2],s<m[0]?m[0]=s:s>m[3]&&(m[3]=s),l<m[1]?m[1]=l:l>m[4]&&(m[4]=l),c<m[2]?m[2]=c:c>m[5]&&(m[5]=c);n.push({vertices:h,aabb:m})}else window.console.log("No info for primitive index: "+a)}return n}function b(e,t){for(var n,r=0,a=t.length;r<a;++r)if(n=t[r],i.areEqual(e,n.item||n))return!0;return!1}function I(e,n){for(var i,r=0,a=n.length;r<a;++r)if((i=n[r]).type===t.GeometryType.LINE&&b(i.item[0],e.item)&&b(i.item[1],e.item))return!0;return!1}function P(e,n){for(var r,a,o,s,l,u,f,d,p,h,m=[],g=0,y=e.length;g<y;++g)r=e[g],a=r,o=n,s=void 0,l=void 0,u=void 0,f=void 0,d=void 0,p=void 0,h=void 0,s=i.sub(o[2],o[0]),l=i.sub(o[1],o[0]),u=i.sub(a,o[0]),f=[i.dot(s,s),i.dot(s,l),i.dot(s,u),i.dot(l,l),i.dot(l,u)],h=(f[0]*f[4]-f[1]*f[2])*(d=1/(f[0]*f[3]-f[1]*f[1])),(p=(f[3]*f[2]-f[1]*f[4])*d)>=0&&h>=0&&p+h<=1+c&&m.push({type:t.GeometryType.POINT,item:r});return m}function v(e,t){let n=i.sub(e,t[0]),r=i.sub(e,t[1]),a=i.squaredLength(n),o=i.squaredLength(r);return a<c||o<c||!(i.squaredLength(i.cross(n,r))>a*o*m)&&i.dot(n,r)<0}function S(e,n,r){var a,o={},s=i.sub(e[1],e[0]),l=i.dot(r,s);return 0!==l?(a=(i.dot(r,n)-i.dot(r,e[0]))/l,Math.abs(a)>=0&&Math.abs(a)<=1&&(o={type:t.GeometryType.POINT,item:i.multiplyAndAdd(s,a,e[0])})):o={type:t.GeometryType.LINE,item:e},o}function w(e,n,r){var a=[],o=[];if(v(e[0],n)&&v(e[1],n))a.push({type:t.GeometryType.LINE,item:e});else if(v(n[0],e)&&v(n[1],e))a.push({type:t.GeometryType.LINE,item:n});else if(v(e[0],n)?o.push(e[0]):v(e[1],n)&&o.push(e[1]),v(n[0],e)?o.push(n[0]):v(n[1],e)&&o.push(n[1]),2===o.length)i.areEqual(o[0],o[1])?a.push({type:t.GeometryType.POINT,item:o[0]}):a.push({type:t.GeometryType.LINE,item:o});else if(1===o.length)r&&a.push({type:t.GeometryType.POINT,item:o[0]});else{var s=i.sub(e[1],e[0]),l=i.sub(n[1],n[0]),c=i.sub(n[0],e[0]),u=i.dot(s,s),f=i.dot(s,l),d=i.dot(l,l),p=i.dot(s,c),h=i.dot(l,c),m=u*d-f*f;if(0===m);else{var g=(f*h-d*p)/m,y=(u*h-f*p)/m;if(Math.abs(g)>=0&&Math.abs(g)<=1&&Math.abs(y)>=0&&Math.abs(y)<=1){var C=i.multiplyAndAdd(s,g,e[0]),b=i.multiplyAndAdd(l,y,n[0]);i.areEqual(C,b)&&v(C,e)&&v(C,n)&&a.push({type:t.GeometryType.POINT,item:C})}}}return a}function D(e,t){var n=[];return Array.prototype.push.apply(n,w([e[0],e[1]],t)),Array.prototype.push.apply(n,w([e[0],e[2]],t)),Array.prototype.push.apply(n,w([e[1],e[2]],t)),n}function M(e,n){var r=new g;return e.type===t.GeometryType.LINE&&e.type===n.type?r.clash=w(e.item,n.item):e.type===t.GeometryType.LINE&&n.type===t.GeometryType.SURFACE?r.clash=D(n.item,e.item):e.type===t.GeometryType.SURFACE&&n.type===t.GeometryType.LINE?r.clash=D(e.item,n.item):e.type===t.GeometryType.SURFACE&&n.type===t.GeometryType.SURFACE?r.clash=function(e,n){var r,a=[],o=P(e,n);if(3===o.length)return[{type:t.GeometryType.SURFACE,item:e}];var s=P(n,e);if(3===s.length)return[{type:t.GeometryType.SURFACE,item:n}];s.forEach(function(e){b(e.item,o)||o.push(e)});for(var l=[],c=[],u=[[e[0],e[1]],[e[1],e[2]],[e[2],e[0]]],f=[[n[0],n[1]],[n[1],n[2]],[n[2],n[0]]],d=function(e){if(!i.areEqual(e,s.item)&&b(e,o)){var n={type:t.GeometryType.LINE,item:[e,s.item]};I(n,a)||a.push(n)}},p=0;p<u.length;p++){c=[];for(var h=0;h<f.length;h++)0!==(s=w(u[p],f[h],!0)).length&&((s=s[0]).type===t.GeometryType.LINE?(c=[s],l.push({type:t.GeometryType.POINT,item:s.item[0]}),l.push({type:t.GeometryType.POINT,item:s.item[1]}),I(c[0],a)||a.push(c[0]),h=f.length):b(s.item,l)||(l.push(s),c.push(s),0!==o.length&&([u[p][0],f[h][0]].forEach(d),[u[p][1],f[h][1]].forEach(d))),2===c.length&&(r=[c[0].item,c[1].item],i.subAndSquaredLength(u[p][0],c[1].item)<i.subAndSquaredLength(u[p][0],c[0].item)&&(r=[c[1].item,c[0].item]),I((c=[{type:t.GeometryType.LINE,item:r}])[0],a)||a.push(c[0]),h=f.length))}2===o.length?I(r={type:t.GeometryType.LINE,item:[o[0].item,o[1].item]},a)||a.push(r):1===o.length&&0===a.length&&(a=[{type:t.GeometryType.POINT,item:o[0]}]);var m,g=[];if(l=[],a.length>1){var y,C=a.splice(0,1)[0];for(l.push(C.item[0],C.item[1]),m=C.item[1];!i.areEqual(l[0],m);){for(y=null,p=0;p<a.length&&!y;p++)i.areEqual(a[p].item[0],m)?y=a.splice(p,1)[0].item[1]:i.areEqual(a[p].item[1],m)&&(y=a.splice(p,1)[0].item[0]);y||(y=0!==a.length?a[0].item[0]:l[0]),m=y,l.push(m)}l.length>=3&&(g=[{type:t.GeometryType.SURFACE,item:l}])}else g=a;return g}(e.item,n.item):e.type===t.GeometryType.LINE&&n.type===t.GeometryType.POINT?v(n.item[0],e.item)&&(r.clash=[n]):e.type===t.GeometryType.POINT&&n.type===t.GeometryType.LINE&&v(e.item[0],n.item)&&(r.clash=[e]),r}function x(e,n,r,a,o){var s,l,c,u=[],f=[],d=[],h=[e,n,r];return c=i.dot(o,a),h.forEach(function(e){(l=i.dot(o,e)-c)>p?u.push(e):l<-p?f.push(e):d.push(e)}),3===d.length?s={type:t.GeometryType.SURFACE,item:[e,n,r],overThePlane:3}:2===d.length?s={type:t.GeometryType.LINE,item:d,overThePlane:2}:1===d.length&&1===u.length&&1===f.length?s={type:t.GeometryType.LINE,item:[d[0],S([u[0],f[0]],a,o).item],overThePlane:1}:1!==d.length||2!==u.length&&2!==f.length?1===u.length&&2===f.length?s={type:t.GeometryType.LINE,item:[S([u[0],f[0]],a,o).item,S([u[0],f[1]],a,o).item]}:2===u.length&&1===f.length&&(s={type:t.GeometryType.LINE,item:[S([f[0],u[0]],a,o).item,S([f[0],u[1]],a,o).item]}):s={type:t.GeometryType.POINT,item:[d[0]],overThePlane:1},s}function A(e,t){let n,i=[];for(n=0;n<3;n++)i[n]=e[n]>t[n]?e[n]:t[n];for(n=3;n<6;n++)i[n]=e[n]<t[n]?e[n]:t[n];return i}function T(e){let t;for(t=0;t<3;t++)if(e[t]>e[t+3])return 0;return 1}function O(e,t){if(1==(i=t,(n=e)[0]>=i[0]&&n[1]>=i[1]&&n[2]>=i[2]&&n[3]<=i[3]&&n[4]<=i[4]&&n[5]<=i[5]?1:0))return 2;var n,i;return T(A(e,t))}function L(e,t){let n=t.front;return n<3?e[n+3]<t[n]?0:e[n]>t[n]?2:1:e[n-3]>t[n]?0:e[n]<t[n]?2:1}function E(n,r,a,o){let c,p,h=new g,m=[],y=[],C=n.vertices.length,b=r.vertices.length;if(!T(m=A(n.aabb,r.aabb)))return h;!function(e){let t;for(t=0;t<3;t++)e[t]-=.001,e[t+3]+=.001}(m);let I=[],P=[],v=[],S=[];for(c=0;c<C;){let t=[n.vertices[c++],n.vertices[c++],n.vertices[c++]];O(y=e.computeAABBForTriangle(t[0],t[1],t[2]),m)>0&&(I.push({vertices:t,aabb:y}),v.push({index:I.length-1,borderProp:0}))}for(c=0;c<b;){let t=[r.vertices[c++],r.vertices[c++],r.vertices[c++]];O(y=e.computeAABBForTriangle(t[0],t[1],t[2]),m)>0&&(P.push({vertices:t,aabb:y}),S.push({index:P.length-1,borderProp:0}))}return m.depth=1,m.front=-1,p=" ",function e(n,r,a,o,c,p,h,m){let y,C,b,I,P,v,S,w,D,A=new g,T=[];if(h+="  ",o.length*c.length<f||o.length<=d||c.length<=d||n.depth>=u)for(P=0;P<o.length&&"OK"===A.status;P++)for(w=o[P].index,b=i.cross(i.sub(r[w].vertices[1],r[w].vertices[0]),i.sub(r[w].vertices[2],r[w].vertices[0])),v=0;v<c.length&&"OK"===A.status;v++){if(++s>1e6&&(s=0,performance.now()-l>p)){A.status="maxTime";break}D=c[v].index,o[P].borderProp>0&&o[P].borderProp&c[v].borderProp||(I=i.cross(i.sub(a[D].vertices[1],a[D].vertices[0]),i.sub(a[D].vertices[2],a[D].vertices[0])),y=x(r[w].vertices[0],r[w].vertices[1],r[w].vertices[2],a[D].vertices[0],I),C=x(a[D].vertices[0],a[D].vertices[1],a[D].vertices[2],r[w].vertices[0],b),y&&C&&(S=M(y,C))&&S.clash.length&&("Contact"===m?S.contact=[{type:t.GeometryType.SURFACE,item:r[w].vertices},{type:t.GeometryType.SURFACE,item:a[D].vertices}]:y.overThePlane>1||C.overThePlane>1?S.contact=[{type:t.GeometryType.SURFACE,item:r[w].vertices},{type:t.GeometryType.SURFACE,item:a[D].vertices}]:1===S.clash.length&&S.clash[0].type===t.GeometryType.POINT&&(S.contact=[{type:t.GeometryType.SURFACE,item:r[w].vertices},{type:t.GeometryType.SURFACE,item:a[D].vertices}]),!A.isClash&&S.clash.length&&0===S.contact.length&&(A.isClash=!0),A.concat(S)))}else for(T=function(e){let t,n,i,r,a,o=[],s=[],l=[],c=[];for(t=0;t<6;t++)s[t]=e[t],l[t]=e[t];for(t=0;t<3;t++)c[t]=e[t+3]-e[t];return c[0]>c[1]&&c[0]>c[2]?(n=(e[0]+e[3])/2,s[3]=n,r=3,l[0]=n,a=0):c[1]>c[0]&&c[1]>c[2]?(n=(e[1]+e[4])/2,s[4]=n,r=4,l[1]=n,a=1):(n=(e[2]+e[5])/2,s[5]=n,r=5,l[2]=n,a=2),i=e.depth,i<<=1,s.depth=i,s.front=r,l.depth=i,l.front=a,o[0]=s,o[1]=l,o}(n),P=0;P<2&&"OK"===A.status;P++){let t,n,i,s=[],l=[];for(v=0;v<o.length;v++)w=o[v].index,i=o[v].borderProp,(n=L(r[w].aabb,T[P]))>0&&(1===P&&1===n&&(i|=T[P].depth),s.push({index:w,borderProp:i}));if(s.length){for(v=0;v<c.length;v++)D=c[v].index,i=c[v].borderProp,(n=L(a[D].aabb,T[P]))>0&&(1===P&&1===n&&(i|=T[P].depth),l.push({index:D,borderProp:i}));l.length&&(t=e(T[P],r,a,s,l,p,h,m),A.concat(t))}}return A}(m,I,P,v,S,o," ",a)}function k(i,r,s,c,u){let f,d,p,m,I,P=new g,v=n.retrieveProductAABB;for(let e=i.externalPath.length-1;e>=0;--e){let t=i.externalPath[e];a.isRepReference(t)&&(f=t)}for(let e=r.externalPath.length-1;e>=0;--e){let t=r.externalPath[e];a.isRepReference(t)&&(d=t)}if(!f||!d)return;if(m=i.getWorldMatrix(),I=r.getWorldMatrix(),e.computeAABBSquaredDistance(v(f,m),v(d,I))>=h)return;let S=o._authorizedTeamsOnly_getKey(),w=C(y(i,S),m.elements),D=w.length,M=C(y(r,S),I.elements),x=M.length;for(let t=0;t<D&&"OK"===P.status;++t)for(let n=0;n<x&&"OK"===P.status;++n)if((p=e.computeAABBSquaredDistance(w[t].aabb,M[n].aabb))<h){let e=E(w[t],M[n],s,u);P.concat(e)}return P.time=performance.now()-l,"Clash"===c?P.contact.length=0:"Contact"===c&&(P.clash.length=0),P.clash.Segment=[],P.contact.Segment=[],P.clash.Surface=[],P.contact.Surface=[],P.clash.forEach(function(e){e.type===t.GeometryType.LINE?P.clash.Segment.push(e.item):e.type===t.GeometryType.SURFACE&&P.clash.Surface.push(e.item)}),P.contact.forEach(function(e){e.type===t.GeometryType.LINE?P.contact.Segment.push(e.item):e.type===t.GeometryType.SURFACE&&P.contact.Surface.push(e.item)}),function(e){for(var t,n,i,r=0;r<e.length;++r)for(n=e[r],t=r+1;t<e.length;++t)b((i=e[t])[0],n)&&b(i[1],n)&&b(i[2],n)&&(e.splice(t,1),--t)}(P.contact.Surface),P}function R(t,n,i,a){let o=new g;if(!(t.vertices&&t.vertices.length&&n.vertices&&n.vertices.length))return;let c=t.vertices.length/3,u=n.vertices.length/3;t.addedTriangles||(t.triangleAdded=[],t.triangleAABB=[],t.triangleAdded.length=t.triangleAABB.length=c),n.addedTriangles||(n.triangleAdded=[],n.triangleAABB=[],n.triangleAdded.length=n.triangleAABB.length=u);let f=t.vertices,d=n.vertices;for(let p=0;p<c;++p){t.triangleAABB[p]||(t.triangleAABB[p]=e.computeAABBForTriangle(f[3*p],f[3*p+1],f[3*p+2]));for(let c=0;c<u;++c){if(++s>1e6&&(s=0,performance.now()-l>a)){o.status="maxTime";break}n.triangleAABB[c]||(n.triangleAABB[c]=e.computeAABBForTriangle(d[3*c],d[3*c+1],d[3*c+2])),e.computeAABBSquaredDistance(t.triangleAABB[p],n.triangleAABB[c])<=i&&0===r.computeTwoTrianglesSquaredDistance(f[3*p],f[3*p+1],f[3*p+2],d[3*c],d[3*c+1],d[3*c+2],i).returnCode&&(t.triangleAdded[p]||(t.triangleAdded[p]=1,o.clearance1.push([f[3*p],f[3*p+1],f[3*p+2]])),n.triangleAdded[c]||(n.triangleAdded[c]=1,o.clearance2.push([d[3*c],d[3*c+1],d[3*c+2]])))}if("OK"!==o.status)break}return o}return g.prototype={constructor:g,concat:function(e){if(!e)return;let t,n;if("OK"!==e.status&&(this.status=e.status),0===this.clash.length)this.clash=e.clash;else if(e.clash.length>0)for(t=e.clash.length,n=0;n<t;++n)this.clash.push(e.clash[n]);if(0===this.contact.length)this.contact=e.contact;else if(e.contact.length>0)for(t=e.contact.length,n=0;n<t;++n)this.contact.push(e.contact[n]);if(0===this.clearance1.length)this.clearance1=e.clearance1;else if(this.clearance1.length>0)for(t=e.clearance1.length,n=0;n<t;++n)this.clearance1.push(e.clearance1[n]);if(0===this.clearance2.length)this.clearance2=e.clearance2;else if(this.clearance2.length>0)for(t=e.clearance2.length,n=0;n<t;++n)this.clearance2.push(e.clearance2[n])}},Object.freeze({computeGeometries:function(t){if(s=0,l=performance.now(),!(t&&t.path1&&t.path2&&t.itfType&&t.maxTime))return;let i;return p=t.metricTol||.001,h=p*p,"Clash"===t.itfType||"Contact"===t.itfType?i=k(t.path1,t.path2,t.itfSystemType,t.itfType,t.maxTime):"Clearance"===t.itfType&&(i=function(t){if(!t.clearanceValue||t.clearanceValue<=0)return;let i,r,s=t.clearanceValue*t.clearanceValue,c=new g,u=t.path1,f=t.path2;for(let e=u.externalPath.length-1;e>=0&&!i;--e){let t=u.externalPath[e];a.isRepReference(t)&&(i=t)}for(let e=f.externalPath.length-1;e>=0&&!r;--e){let t=f.externalPath[e];a.isRepReference(t)&&(r=t)}if(!i||!r)return;let d=u.getWorldMatrix(),p=f.getWorldMatrix(),h=n.retrieveProductAABB;if(e.computeAABBSquaredDistance(h(i,d),h(r,p))>s)return;let m=o._authorizedTeamsOnly_getKey(),b=C(y(u,m),d.elements),I=b.length,P=C(y(f,m),p.elements),v=P.length,S=[];for(let t=0;t<I;++t)for(let n=0;n<v;++n)e.computeAABBSquaredDistance(b[t].aabb,P[n].aabb)<=s&&S.push([t,n]);for(let e=0;e<S.length&&(c.concat(R(b[S[e][0]],P[S[e][1]],s,t.maxTime)),"OK"===c.status);++e);return c.time=performance.now()-l,c}(t)),i&&(i.time=performance.now()-l),i},computeMinDist:function(e){let t=n.measureBetweenWithParts(n.MeasuredType.PRODUCT,e.path1,e.path2);return t&&0===t.returnCode?{minDist:Math.sqrt(t.squaredDistance),pos1:t.aPosition1,pos2:t.aPosition2}:{minDist:0}}})}),define("DS/PIMwebViewController/PIMwebDefaultCmd",["DS/CATWebUXComponents/DMUCommand","DS/PADUtils/PADContext","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0});var r=t.get(),a=n.givePreferenceManager({context:r.getFrameWindow()});a&&(a.setUnitsPreferencesDisplayFlag(!0),a.setDisplayPreferencesDisplayFlag(!0),a.set3DSelectionPreferencesDisplayFlag(!0),a.setMeasurePreferencesDisplayFlag(!0),a.setClippingPreferencesDisplayFlag(!0),a.setPreferredPreferenceContainersOrder(["PIMwebPrefLoad","PIMwebPrefDisplay","TICSection","MeasurePreferences","SectionPreferences"])),this.beginExecute=this.resumeExecute=function(){if(!r)return;let e=i.giveSelectionManager({context:r});e&&e.setActiveState(!0),r.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0})},this.endExecute=this.pauseExecute=function(){if(!r)return;let e=i.giveSelectionManager({context:r});e&&e.setActiveState(!1)},this._destroy=function(){r&&(r=a=null,Object.getPrototypeOf(this)._destroy.apply(this,arguments))}}})}),define("DS/PIMwebViewController/PIMwebInteferenceListCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/PADUtils/PADContext"],function(e,t){"use strict";let n,i,r,a;var o=e.extend({init:function(e){this._parent(e);var r=this;require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(e){n=e.getItfCtrl({pad3DViewer:t.get()}),i=n.subscribe("onItfListClosed",function(){r&&r.setState(!1)}),r&&r.setState("1"===localStorage.getItem("PIMwebItfListVisPref"))}),this.onStateChange(function(){r.getState()?o.ShowCommandsList():o.HideCommandsList()}),this._destroy=function(){n&&n.subscribe(i),n=r=i=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}});return o.ShowCommandsList=function(e,s){s?r=s.executionContext.getComponent("Viewer"):r||s||(r=t.get()),s&&(a=s.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent)),s?require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(t){n=t.getItfCtrl({pad3DViewer:r}),i=n.subscribe("onItfListClosed",function(){o&&o.HideCommandsList(e,s),a&&a.setCheckState({id:"PIMInteferenceListHdr",state:"1"===localStorage.getItem("PIMwebItfListVisPref")})}),n.showGUX()}):setTimeout(function(){i=n.subscribe("onItfListClosed",function(){o&&o.HideCommandsList(e,s),a&&a.setCheckState({id:"PIMInteferenceListHdr",state:"1"===localStorage.getItem("PIMwebItfListVisPref")})}),n.showGUX(),e&&e()}),localStorage.setItem("PIMwebItfListVisPref","1")},o.HideCommandsList=function(e,i){!r&&i?r=i.executionContext.getComponent("Viewer"):r||i||(r=t.get()),n&&n.hideGUX(),localStorage.setItem("PIMwebItfListVisPref","0"),e&&e()},o}),define("DS/PIMwebViewController/PIMwebDisplayCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl"],function(e,t,n){"use strict";let i,r="colorsState";function a(e){let t=localStorage.getItem("PIMwebApplyDisplayPref");(t=t?JSON.parse(t):{})[r]=e?1:0,localStorage.setItem("PIMwebApplyDisplayPref",JSON.stringify(t))}let o=e.extend({init:function(e){this._parent(e);var o=this,s=r,l=1;"PIMDisplayClashCurveHdr"===o._id?(s="clash",l=1):"PIMDisplayContactCurveHdr"===o._id?(s="contact",l=1):"PIMDisplayClearanceCurveHdr"===o._id?(s="clearance",l=1):"PIMDisplayQuantifiersHdr"===o._id?(s="quantifiers",l=1):"PIMZoomOnInterferenceHdr"===o._id?(s="zoom",l=0):"PIMApplyTransparencyHdr"===o._id&&(s="transparencyState",l=0),this.setState(function(){let e=localStorage.getItem("PIMwebApplyDisplayPref");return e=e?JSON.parse(e):{},Boolean(e&&s in e?e[s]:l)}()),i=n.getItfCtrl({pad3DViewer:t.get()}),o&&i.applyDisplay(s,o.getState()?1:0,!0),require(["DS/PIMwebViewModel/PIMwebUtils"],function(e){e._sendUsageProbe("commandCheck","ColorOverloadOff")}),this.onStateChange(function(){if(!i||!o)return;let e=o.getState();i.applyDisplay(s,e?1:0,!1),a(e)}),this._destroy=function(){i=o=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}}),s=function(e,t,s){r=s,(i=n.getItfCtrl({pad3DViewer:t.executionContext.getComponent("Viewer")}))&&o&&(i.applyDisplay(r,1,!1),a(!0),require(["DS/PIMwebViewModel/PIMwebUtils"],function(e){e._sendUsageProbe("commandCheck","ColorOverloadOff")}),e())},l=function(e,t,s){r=s,(i=n.getItfCtrl({pad3DViewer:t.executionContext.getComponent("Viewer")}))&&o&&(i.applyDisplay(r,0,!1),a(!1),require(["DS/PIMwebViewModel/PIMwebUtils"],function(e){e._sendUsageProbe("commandCheck","ColorOverloadOff")}),o.clean(),e())};return o.DisplayColor=function(e,t){s(e,t,"colorsState")},o.ApplyTransparency=function(e,t){s(e,t,"transparencyState")},o.DisplayContactCurve=function(e,t){s(e,t,"contact")},o.DisplayClashCurve=function(e,t){s(e,t,"clash")},o.DisplayClearanceCurve=function(e,t){s(e,t,"clearance")},o.DisplayQuantifiers=function(e,t){s(e,t,"quantifiers")},o.ZoomOnInterference=function(e,t){s(e,t,"zoom")},o.ResetColor=function(e,t){l(e,t,"colorsState")},o.ResetTransparency=function(e,t){l(e,t,"transparencyState")},o.ResetContactCurve=function(e,t){l(e,t,"contact")},o.ResetClashCurve=function(e,t){l(e,t,"clash")},o.ResetClearanceCurve=function(e,t){l(e,t,"clearance")},o.ResetQuantifiers=function(e,t){l(e,t,"quantifiers")},o.ZoomOutInterference=function(e,t){l(e,t,"zoom")},o.clean=function(){i=null},o}),define("DS/PIMwebViewController/PIMwebCopyLinkCmd",["DS/CATWebUXCopyLink/CATWebUXCopyLinkCmdAdapt","DS/PIMwebViewController/PIMwebItfCtrl","DS/PADUtils/PADContext"],function(e,t,n){"use strict";var i;return e.extend({init:function(e){var r=n.get();e.pad3DViewer=r,this._parent(e),this.getParameters=function(e){var n=t.getItfCtrl({pad3DViewer:r}),a="PIMwebCopyLinkSelectedItfHdr"===e.cmdType?n.getSelectedMetric():n.getLoadedIsr();a&&1===a.length?e.onComplete({content:function(e){var t={data:{items:[]}};if(e&&e.selectedNode){var n={};"PIMwebCopyLinkSelectedItfHdr"===e.cmdType?(i=e.selectedNode.itfCtxName?e.selectedNode.itfCtxName:"",n.objectId=e.selectedNode.mID?e.selectedNode.mID:void 0,n.objectType=e.selectedNode.mType?e.selectedNode.mType:void 0):(i=e.selectedNode.isr&&e.selectedNode.isr.getAttributes()&&e.selectedNode.isr.getAttributes().label?e.selectedNode.isr.getAttributes().label:"",n.objectId=e.selectedNode.isrID?e.selectedNode.isrID:void 0,n.objectType=e.selectedNode.isr&&e.selectedNode.isr.getAttributes()&&e.selectedNode.isr.getAttributes().type?e.selectedNode.isr.getAttributes().type:void 0),t.data.items.push(n)}return t}({selectedNode:a[0],cmdType:e.cmdType}),label:i}):e.onFailure()}}})}),define("DS/PIMwebViewController/PIMwebExportAsCSVCmd",["DS/CATWebUXComponents/DMUCommand","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl","DS/PIMwebViewModel/PIMwebUtils"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1});var r="Visible";let a=e.args;if(a){let t=Object.keys(a),n=Object.values(a);e.arguments=[];for(let i=0;i<t.length-1;i++)e.arguments.push({ID:t[i],Value:n[i]})}e&&e.arguments&&e.arguments[0]&&e.arguments[0]&&(r=e.executionContext?"Type"===e.arguments[0].ID?e.arguments[0].Value:r:e.arguments[0].type);this.beginExecute=function(){var e,a,o,s,l,c=n.getItfCtrl({pad3DViewer:t.get()}),u=c.getLoadedIsr(),f=u[0]&&u[0].isr?u[0].isr.getAttributes().label:"",d=new Date;d=new Date(d.getTime()-60*d.getTimezoneOffset()*1e3).toISOString().slice(0,23),e=c.exportAsCSV({onlySelectedRows:"Selected"===r}),a=f+"_"+d+".csv",o=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(o),(l=document.createElement("a")).style.display="none",l.download=a,l.href=s,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(s),document.body.removeChild(l),i._sendUsageProbe("command","Visible"===r?"ExportVisibleItfToCSV":"ExportSelectedItfToCSV"),this.done()}}})}),define("DS/PIMwebViewController/PIMwebCreateEditIsrCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl","DS/PIMwebViewModel/PIMwebUtils","DS/PIMwebUX/PIMwebIsrPanelView","DS/Windows/Dialog","DS/Controls/Button","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/LevelSelector/LevelSelector","DS/PIMwebUX/PIMwebGroupDefinitionPanelView","DS/PADUtils/PADUtilsServices","DS/PIMwebViewModel/PIMwebIsrMgr","DS/Visualization/PathElement","DS/CoreEvents/Events","i18n!DS/PIMwebViewController/assets/nls/PIMwebCreateEditIsrCmd","css!DS/PIMwebViewController/assets/css/PIMwebIsrCreateEditUpdateCmd"],function(e,t,n,i,r,a,o,s,l,c,u,f,d,p,h,m,g,y,C){"use strict";return t.extend({init:function(t){let b=t,I=t.args;if(I){let e=Object.keys(I),t=Object.values(I);b=[];for(let n=0;n<e.length-1;n++)b.push({ID:e[n],Value:t[n]})}var P,v,S,w,D,M=this,x=!0,A=!0,T=!0,O=!0,L=!0;this._parent(t,{mode:"exclusive",isAsynchronous:!0});let E,k="Create",R="I3S",V=!1,U="Blab";var N,F,_,j,G,W,B,H,q,X,Q,z,K,J,Z=n.get(),Y={},$=[],ee=0,te=null,ne=null,ie=null,re=null,ae=!0,oe=!1;function se(){c.unsubscribe(Y.onAdd),c.unsubscribe(Y.onRemove),c.unsubscribe(Y.onEmpty),Y={}}function le(){se(),P&&(y.unsubscribe(j),y.unsubscribe(G),y.unsubscribe(W),y.unsubscribe(B),y.unsubscribe(q),y.unsubscribe(H),y.unsubscribe(X),J&&y.unsubscribe(J),J=void 0,P.destroy(),P=null,Z&&Z.getFrameWindow()&&Z.getFrameWindow().getContextualUIManager()&&Z.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic()),ne&&(ne.destroy(),ne=null),te&&(te.destroy(),te=null),M.done()}function ce(){P&&w&&("Create"!==k&&"Edit"!==k||P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0),w.disableAllTabs())}function ue(e,t,n){var i={context:{}};"Create"===k&&(i.title=e.isrTitle,i.name=e.isrName,Object.keys(E).forEach(function(t){E[t]===e.isrType&&(i.type=t)}),i.description=e.isrDesc,i.context.rootRefID=t.ProductContext.id),i.context.filterID=t.FilterContext&&t.FilterContext.id||"",i.groupMode=t.Config;for(var r=t.Groups.length,a=[],o=0;o<r;o++){var s={};if(s.mode=t.Groups[o].isFilter?"filter":"occurrence","filter"===s.mode)s.content=t.Groups[o].Elements[0].id;else{for(var l=[],c=t.Groups[o].Elements,u=0;u<c.length;u++){for(var f=[],d=c[u].pathElement.externalPath.length,p=c[u].pathElement.externalPath,h=1;h<d;h++)f.push(p[h].modelIdentification);l.push(f)}s.content=l}a.push(s)}i.groups=a,i.appendInterRep=n.CheckInterRep,i.computeInterRep=n.CompBetweenIntermediateReps;var m=[];!0===n.EngineeringCnx.EnggCnxChecked?m.push("on"):m.push("off"),!0===n.EngineeringCnx.CheckNoClash&&m.push("MCX_Check_NoClash"),!0===n.EngineeringCnx.CheckContact&&m.push("MCX_Check_Contact"),!0===n.EngineeringCnx.CheckClearance&&m.push("MCX_Check_Clearance"),!0===n.EngineeringCnx.NoCheck&&m.push("MCX_Ignore"),i.specMCX=m.join("|"),i.specStd="",!0===n.ComputationMode.Clash&&!1===n.ComputationMode.Contact&&!1===n.ComputationMode.Clearance?i.specStd="Clash":!0===n.ComputationMode.Clash&&!0===n.ComputationMode.Contact&&!1===n.ComputationMode.Clearance?i.specStd="ClashContact":!0===n.ComputationMode.Clash&&!0===n.ComputationMode.Contact&&!0===n.ComputationMode.Clearance&&(i.specStd="ClashContactClearance");var g=!0===n.KnowledgeRule.KnwRulesChecked?"on":"off";return n.KnowledgeRule.RuleSet&&(g+="|"+n.KnowledgeRule.RuleSet.id),i.specRule=g,i.electricalItfs=n.CheckElec,i.pathwayItfs=n.checkPathways,i.value_of_clearance=n.ComputationMode.ClearanceValMeter,n.ComputeQuantifer?(i.clashQuantifier=n.ComputeQuantifer.PenVector,i.clearQuantifier=n.ComputeQuantifer.MinDist,i.volumeQuantifier=n.ComputeQuantifer.PenVolume):n.StoredResults&&!oe&&function(e,t){t.clashQuantifier=1===e.StoredResults.ClashQuantifier||3===e.StoredResults.ClashQuantifier,t.clearQuantifier=1===e.StoredResults.ClearanceQuantifier,t.volumeQuantifier=2===e.StoredResults.ClashQuantifier||3===e.StoredResults.ClashQuantifier,t.clashGeometryStorage=e.StoredResults.ClashGeometry,t.contactGeometryStorage=e.StoredResults.ContactGeometry,t.clearanceGeometryStorage=e.StoredResults.ClearanceGeometry,t.clearanceAreaGeometryAccuracy=parseFloat(e.StoredResults.Accuracy.valMeter),t.geometryDetail=e.StoredResults.GeometryDetail}(n,i),i.checkFasteners=n.Fasteners.FstChecked,i.checkFasteneds=n.Fasteners.CheckItfWithFastenedParts,i.destroyOutOfScope=n.ReuseExistingItf.DeleteOutOfScopeItf,i.compare=n.ReuseExistingItf.RecomputeOnlyModItf,i}function fe(e){if(!M.isUpdateSimulationAllowed())return;const t=(new Date).toLocaleString();console.log("Compute Isr start time:"+t);var n=UWA.Promise.deferred();m.get3DSpaceUrlAndLoginTicket().then(function(t){const i=(new Date).toLocaleString();console.log("Compute Isr Login Ticket retrieved time:"+i);var r=localStorage.getItem("PIMCSIInputI3S"),a=(t.url&&t.url,t.loginTicket&&t.loginTicket,t.securityContext?t.securityContext:""),o=R||"I3S",s={version:1,type:"Parameters",content:{sSecurityCtxt:{type:"string",value:a},sIsrObjId:{type:"string",value:e.isrID},sWApp:{type:"string",value:o},sDbgVal:{type:"string",value:r},bReroot:{type:"bool",value:!1},bTrackStat:{type:"bool",value:!1}}};(l={data:{items:[{objectId:e.isrID,objectType:"SIMItfSimulation"}]}}).source=window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3S_AP",l.widgetId=window.widget?window.widget.id:void 0,l.data.items[0].envId=require("DS/PADUtils/PADUtilsServices").getPlatformId(),l.data.items[0].serviceId="3DSpace",l.data.items[0].contextId=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","");var l="content:X3DContentId="+encodeURIComponent(JSON.stringify(l)),c={data:{title:"Interference Simulation Computation",internalID:e.isrID,inputs:JSON.stringify(s),app:{appContent:l}},onComplete:function(t){const n=(new Date).toLocaleString();console.log("Compute Isr End time:"+n),window.console.log("Compute Job Submit: Job Id : "+t.jobID),window.console.log("Compute Job Submit: Message : "+t.message),setTimeout(function(){const t=(new Date).toLocaleString();console.log("Computed Isr Load Start time:"+t),U.load({isrID:e.isrID,noNotif:!0});const n=(new Date).toLocaleString();console.log("Computed Isr Load End time:"+n),window.console.log("Loading isr "+e.isrID+"complete")},42e4)},onFailure:function(e){window.console.log("Compute Job Submit: Failure Message : "+e),n.reject(e)}};const u=(new Date).toLocaleString();console.log("Compute Isr PIMwebIsrMgr call start time:"+u),m.computeIsr(c)})}function de(e){("Create"===k||ae&&"I3D"!==R&&!oe)&&P&&P.buttons&&P.buttons.Ok&&(""===e?(P.buttons.Ok.disabled=!0,D=!1,w&&(w.setIsrTabValidity(!1),w.setIsrTitleValidity(!1))):(D=!0,!0===x&&!0===A&&!0===T&&!0===O&&!0===L&&(M.isUpdateSimulationAllowed()?P.buttons.Ok.disabled="Create"!==k&&!U.getIsrComputationStatus():P.buttons.Ok.disabled=!1),w&&(w.setIsrTabValidity(!0),w.setIsrTitleValidity(!0))))}function pe(e){P&&P.buttons&&P.buttons.Ok&&("Create"!==k&&!ae||"I3D"===R||oe?ce():"GroupInfoSufficient"===e?(x=!0,!0===D&&!0===A&&!0===T&&!0===O&&!0===L&&(M.isUpdateSimulationAllowed()?P.buttons.Ok.disabled="Create"!==k&&!U.getIsrComputationStatus():P.buttons.Ok.disabled=!1),w&&w.setContextTabValidity(O)):"GroupInfoInsufficient"===e&&(x=!1,P.buttons.Ok.disabled=!0,w&&w.setContextTabValidity(!1)))}function he(e){("Create"===k||ae&&"I3D"!==R&&!oe)&&P&&P.buttons&&P.buttons.Ok&&("KnwRuleInfoSufficient"===e?(A=!0,!0===D&&!0===x&&!0===T&&!0===O&&!0===L&&(M.isUpdateSimulationAllowed()?P.buttons.Ok.disabled="Create"!==k&&!U.getIsrComputationStatus():P.buttons.Ok.disabled=!1),w&&w.setSpecTabValidity(T&&L)):"KnwRuleInfoInsufficient"===e&&(A=!1,P.buttons.Ok.disabled=!0,w&&w.setSpecTabValidity(!1)))}function me(e){("Create"===k||ae&&"I3D"!==R&&!oe)&&P&&P.buttons&&P.buttons.Ok&&("EngCnxInfoSufficient"===e?(T=!0,!0===D&&!0===x&&!0===A&&!0===O&&!0===L&&(M.isUpdateSimulationAllowed()?P.buttons.Ok.disabled="Create"!==k&&!U.getIsrComputationStatus():P.buttons.Ok.disabled=!1),w&&w.setSpecTabValidity(A&&L)):"EngCnxInfoInsufficient"===e&&(T=!1,P.buttons.Ok.disabled=!0,w&&w.setSpecTabValidity(!1)))}function ge(e){("Create"===k||ae&&"I3D"!==R&&!oe)&&P&&P.buttons&&P.buttons.Ok&&("SpecInfoSufficient"===e?(L=!0,!0===D&&!0===x&&!0===A&&!0===O&&!0===T&&(M.isUpdateSimulationAllowed()?P.buttons.Ok.disabled="Create"!==k&&!U.getIsrComputationStatus():P.buttons.Ok.disabled=!1),w&&w.setSpecTabValidity(A&&T)):"SpecInfoInsufficient"===e&&(L=!1,P.buttons.Ok.disabled=!0,w&&w.setSpecTabValidity(!1)))}function ye(e){("Create"===k||ae&&"I3D"!==R&&!oe)&&P&&P.buttons&&P.buttons.Ok&&("ContextInfoSufficient"===e?(O=!0,!0===D&&!0===x&&!0===A&&!0===T&&(M.isUpdateSimulationAllowed()?P.buttons.Ok.disabled="Create"!==k&&!U.getIsrComputationStatus():P.buttons.Ok.disabled=!1),w&&w.setContextTabValidity(x)):"ContextInfoInsufficient"===e&&(O=!1,P.buttons.Ok.disabled=!0,w&&w.setContextTabValidity(!1)))}function Ce(e){("Create"===k||ae&&"I3D"!==R&&!oe)&&P&&P.buttons&&P.buttons.Ok&&""!==e&&w&&w.setIsrTabTitle(e)}function be(){("Create"!==k&&!ae||"I3D"===R||oe)&&ce(),y.unsubscribe(Q)}function Ie(){("Create"!==k&&!ae||"I3D"===R||oe)&&ce(),y.unsubscribe(z)}function Pe(e){"succeeded"===e||""===e?P&&w&&("Create"!==k&&"Edit"!==k||P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!1),w.enableAllTabs()):ce(),y.unsubscribe(K)}function ve(){return v=new s({emphasize:"primary",label:"Create"!==k?C.editButton:C.createButton,onClick:function(e){const t=(new Date).toLocaleString();console.log("Create Command User Spec End time:"+t),e&&e.dsModel&&!e.dsModel.disabled&&(P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0),"Create"===k?function(){const e=(new Date).toLocaleString();console.log("Create Isr start time:"+e),w.writePIMwebIsrPrefs();var t={data:ue(w.getIsrInfo(),w.getContextInfo(),w.getSpecInfo()),onComplete:function(e){const t=(new Date).toLocaleString();console.log("Create  Isr End time:"+t),Z.displayNotification({msg:C.isrCreated,eventID:"success"});var n={};localStorage.getItem("PIMwebIsrSpecs")&&(n=JSON.parse(localStorage.getItem("PIMwebIsrSpecs"))),n.ExecuteIsr&&n.ExecuteIsr?M.isUpdateSimulationAllowed()?fe(e):(Z.displayNotification({msg:C.isrUpdateNotAllowed,eventID:"info"}),U.load({isrID:e.isrID,noNotif:!0})):U.load({isrID:e.isrID,noNotif:!0}),Z.getExecutionContext&&le(),M.cancel()},onFailure:function(){Z.displayNotification({msg:C.isrCreationFailed,eventID:"error"}),Z.getExecutionContext&&le(),M.cancel()}};m.createIsr(t)}():function(){w.writePIMwebIsrPrefs();var e={data:ue({isrPid:_},w.getContextInfo(),w.getSpecInfo()),onComplete:function(){Z.displayNotification({msg:C.isrEdited,eventID:"success"});var e={};localStorage.getItem("PIMwebIsrSpecs")&&(e=JSON.parse(localStorage.getItem("PIMwebIsrSpecs"))),e.ExecuteIsr&&e.ExecuteIsr?M.isUpdateSimulationAllowed()?fe({isrID:_}):(Z.displayNotification({msg:C.isrUpdateNotAllowed,eventID:"info"}),U.load({isrID:_,noNotif:!0})):U.load({isrID:_,noNotif:!0}),Z.getExecutionContext&&le(),M.cancel()},onFailure:function(){Z.displayNotification({msg:C.isrEditionFailed,eventID:"error"}),Z.getExecutionContext&&le(),M.cancel()}};re.setSpecAndContextInfo(e),Z.getExecutionContext&&le(),M.cancel()}())}}),S=new s({label:!ae||"I3D"===R||oe?C.closeButton:C.cancelButton,onClick:function(){Z.getExecutionContext&&le(),M.cancel()}}),(P=new o({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:"Create"!==k?C.editIsrPanelTitle:C.createIsrPanelTitle,resizableFlag:!0,immersiveFrame:Z.getFrameWindow().getImmersiveFrame(),buttons:!ae||"I3D"===R||oe?{Cancel:S}:{Ok:v,Cancel:S},width:530,minWidth:530,height:350,minHeight:350})).elements.container.getElementsByClassName("wux-windows-window-content")[0].setStyles({overflow:"hidden"}),V=!1,"Create"===k&&Object.keys(m.getLoadedIsr()).length&&(V=!0,v.emphasize="medium-attention",v.icon={iconName:"attention",fontIconFamily:WUXManagedFontIcons.Font3DS}),P.addEventListener("close",function(){Z.getExecutionContext&&le(),M.cancel()}),j=y.subscribe({event:"onTitleChange"},de),G=y.subscribe({event:"onGroupInfoChange"},pe),W=y.subscribe({event:"onKnwInfoChange"},he),B=y.subscribe({event:"onEngCnxInfoChange"},me),H=y.subscribe({event:"onSpecInfoChange"},ge),q=y.subscribe({event:"onContextInfoChange"},ye),X=y.subscribe({event:"onIsrTypeChange"},Ce),Q=y.subscribe({event:"onSpecTabComplete"},be),z=y.subscribe({event:"onContextTabComplete"},Ie),K=y.subscribe({event:"onEnableContextSpecTab"},Pe),{parent:P,isWeb:!0,type:k,pad3DViewer:Z,ctrl:M,isrAlreadyLoaded:V,lengthUnit:U.getLengthUnit()}}function Se(e){if(e.error)return Z.displayNotification({msg:e.error,eventID:"error"}),Z.getExecutionContext&&le(),void M.cancel();var t=new Promise(function(t){(function(e){return new Promise(function(t){e||(Z.getExecutionContext&&le(),M.cancel());var n={Groups:[]};if(!oe){e.context&&e.context.prd||(Z.displayNotification({msg:C.noIsrContext,eventID:"error"}),Z.getExecutionContext&&le(),M.cancel());var i=e.context.prd;if(n.ProductContext={id:i.physicalid,alias:i.label,type:i.type},e.context.filter){var r=e.context.filter;n.FilterContext={id:r.physicalid,alias:r.label,type:r.type}}}n.Config=e.groupMode;var a=e.groups.length;if(0===a)t(n);else{for(var o=[],s=Z.getRootBagPath().getLastElement(),l=0;l<a;l++){var c={};c.isFilter="filter"===e.groups[l].mode,c.Elements=[];var u={};if(c.isFilter)u.id=e.groups[l].content,o.push(u.id),c.Elements.push(u);else for(var f=e.groups[l].content,d=e.groups[l].content.length,p=0;p<d;p++){u={};var h=f[p].length;u.id=f[p][h-1],o.push(u.id);var m=[];m.push(s);for(var y=0;y<h;y++)m.push(Z.getController().getNode({id:f[p][y]}));var b=new g;b.setFromArray(m),u.pathElement=b,c.Elements.push(u)}n.Groups.push(c)}M.getLoadedVPMRefRootData(o).then(function(e){for(var i=e.map(function(e){return e.id}),r=0;r<a;r++)for(var o=n.Groups[r].Elements,s=o.length,l=0;l<s;l++){var c=i.indexOf(o[l].id);-1!==c&&(o[l].label=e[c].alias,o[l].icons=[e[c].icon])}t(n)})}})})(e).then(function(e){t(e)})}),n=new Promise(function(t){(function(e){return new Promise(function(t){var n={ComputationMode:{},Fasteners:{},EngineeringCnx:{},KnowledgeRule:{},ReuseExistingItf:{},ComputeQuantifer:{}};"Clash"===e.specStd?(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!1,n.ComputationMode.Clearance=!1):"ClashContact"===e.specStd?(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!0,n.ComputationMode.Clearance=!1):"ClashContactClearance"===e.specStd&&(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!0,n.ComputationMode.Clearance=!0),n.CheckInterRep=e.appendInterRep,n.CompBetweenIntermediateReps=e.computeInterRep,n.ComputationMode.ClearanceValMeter=parseFloat(e.value_of_clearance),n.Fasteners.FstChecked=e.checkFasteners,n.Fasteners.CheckItfWithFastenedParts=e.checkFasteneds,n.checkElec=!!e.electricalItfs&&e.electricalItfs,n.checkPathways=!!e.pathwayItfs&&e.pathwayItfs;var i=[];i=e.specMCX.split("|"),n.EngineeringCnx.EnggCnxChecked=-1!==i.indexOf("on"),n.EngineeringCnx.CheckNoClash=-1!==i.indexOf("MCX_Check_NoClash"),n.EngineeringCnx.CheckContact=-1!==i.indexOf("MCX_Check_Contact"),n.EngineeringCnx.CheckClearance=-1!==i.indexOf("MCX_Check_Clearance"),n.EngineeringCnx.NoCheck=-1!==i.indexOf("MCX_Ignore"),n.ReuseExistingItf.DeleteOutOfScopeItf=e.destroyOutOfScope,n.ReuseExistingItf.RecomputeOnlyModItf=e.compare,oe?(n.ComputeQuantifer.PenVector=e.clashQuantifier,n.ComputeQuantifer.MinDist=e.clearQuantifier,n.ComputeQuantifer.PenVolume=e.volumeQuantifier):(n.StoredResults={},e.clashQuantifier||e.volumeQuantifier?e.clashQuantifier&&!e.volumeQuantifier?n.StoredResults.ClashQuantifier=1:!e.clashQuantifier&&e.volumeQuantifier?n.StoredResults.ClashQuantifier=2:n.StoredResults.ClashQuantifier=3:n.StoredResults.ClashQuantifier=0,n.StoredResults.ClearanceQuantifier=e.clearQuantifier?1:0,n.StoredResults.ClashGeometry=e.clashGeometryStorage,n.StoredResults.ContactGeometry=e.contactGeometryStorage,n.StoredResults.ClearanceGeometry=e.clearanceGeometryStorage,n.StoredResults.Accuracy={},n.StoredResults.Accuracy.valMeter=parseFloat(e.clearanceAreaGeometryAccuracy),n.StoredResults.Accuracy.units="m",n.StoredResults.GeometryDetail=e.geometryDetail);var r=[];r=e.specRule.split("|"),n.KnowledgeRule.KnwRulesChecked=-1!==r.indexOf("on"),r.length>1?(n.KnowledgeRule.RuleSet={},M.getLoadedVPMRefRootData([r[1]]).then(function(e){n.KnowledgeRule.RuleSet=e[0],t(n)})):t(n)})})(e).then(function(e){t(e)})});Promise.all([n,t]).then(function(t){ae=e.isEditable;var n=ve();n.isNonPersistIsr=oe,M.isUpdateSimulationAllowed()?n.readOnly="Create"!==k&&!U.getIsrComputationStatus():n.readOnly=!ae||"I3D"===R||oe,n.specInfo=t[0],n.contextInfo=t[1],w=new a(n),D=x=A=T=O=L=!0;const i=(new Date).toLocaleString();console.log("Create Command Panel Displayed:"+i)})}function we(t){var n=m.getLoadedIsr(),i=Object.keys(n)[0],r={pid:i,onComplete:function(n){let r=n?1:0,a=Boolean(n.checkFasteners)||Boolean(n.pathwayItfs)||Boolean(n.electricalItfs)||"on"===n.specRule||"on"===n.specMCX,l=Boolean(n.volumeQuantifier)||2===n.clashGeometryStorage||3===n.clashGeometryStorage||2===n.clearanceGeometryStorage||3===n.clearanceGeometryStorage;r=a&&l?3:a||l?2:1;let c=e.createElement("div",{class:"pimCsiCompute"}),u=e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-4x ".concat("info"===t?"wux-ui-3ds-info  pimupdateInfocolor":"wux-ui-3ds-attention  pimupdatewarningcolor")});u.setStyles({"vertical-align":"middle"}),u.inject(c);let f=C.replace(r>1?C.isrUpdateSimulationTokens:C.isrUpdateSimulationToken,{label:r}).replace(/"/g,"");e.createElement("label",{text:f,styles:{"margin-bottom":"0px",padding:"25px 10px"}}).inject(c);var d=new o({immersiveFrame:void 0,modalFlag:!0,title:C.isrUpdateSimulation,content:c,activeFlag:!1,buttons:"info"!==t?{Ok:new s({label:C.cancelButton,onClick:function(e){d.destroy(),M.cancel()}})}:{Ok:new s({label:C.okButton,onClick:function(e){d.destroy(),fe({isrID:i}),M.cancel()}}),Cancel:new s({label:C.cancelButton,onClick:function(e){d.destroy(),M.cancel()}})}});d.addEventListener("close",function(){M.cancel()})},onFailure:function(e){Z.displayNotification({msg:C["No stream retrieved"===e?"isrCannotAccessIsrDefinition":"isrInfoRetrievalFailed"],eventID:"error"}),Z.getExecutionContext&&le(),M.cancel()}},a=m.getIsr(i);a&&a.getSpecAndContextInfo(r)}function De(){(Y={}).onAdd=c.onAdd(F),Y.onRemove=c.onRemove(F),Y.onEmpty=c.onEmpty(F)}function Me(e){var t=new s({emphasize:"primary",label:C.okButton,onClick:e.onOK}),n=new s({label:C.cancelButton,onClick:e.onCancel}),i=new o({modalFlag:!1,ensureHeightDefinitionOnHierarchy:!0,title:C.groupDefinitionPanelTitle,resizableFlag:!0,immersiveFrame:Z.getFrameWindow().getImmersiveFrame(),position:{my:"down right",at:"down right"},buttons:{Ok:t,Cancel:n},width:300,minWidth:300,height:100});return i.addEventListener("close",e.onClose),i}function xe(){d.destroyView(),te.destroy(),te=null,N=null,u.empty(),c.empty(),se(),P.show()}function Ae(){for(var e=0;e<$.length;e++)w.createGroupViewWithInfo([$[e]]);xe()}function Te(){w.addInfoInGroup(ie,$),xe()}this.beginExecute=function(){const e=(new Date).toLocaleString();if(console.log("Create Command Begin time:"+e),Z.getExecutionContext&&(J=y.subscribe({event:M.getId()+"/DISABLED"},le)),U=i.getItfCtrl({pad3DViewer:Z}),Z.getExecutionContext){let e=b;b.arguments=[];for(let t=0;t<e.length;t++){let n={};n[e[t].ID]=e[t].Value,b.arguments.push(n)}k=b.arguments[0].type}else b&&b.arguments&&b.arguments[0]&&b.arguments[0].type&&(k=b.arguments[0].type);"Create"!==k&&(R=Z.getExecutionContext?Z.getExecutionContext().getComponent("Widget").getSessionWidget().data.appId.includes("I3D")?"I3D":"I3S":b.arguments[0].app),r._sendUsageProbe("command","Create"===k?"CreateItf":"Edit"===k?"EditItf":"UpdateItf"),x=A=T=O=L=!0,oe=U.isPIMDataLoaded(),"Update"===k?U.getIsrComputationStatus()?we("info"):we("warning"):function(){if("Create"!==k){var e={};if(oe)U&&(e=U.getSpecAndContextInfoFromCtrl()),Se(e);else{var t=m.getLoadedIsr();if(!Object.keys(m.getLoadedIsr()).length)return Z.displayNotification({msg:C.noIsrInSession,eventID:"info"}),Z.getExecutionContext&&le(),M.cancel();if(Object.keys(m.getLoadedIsr()).length>1)return Z.displayNotification({msg:C.onlySingleIsrInSessionAllowed,eventID:"info"}),Z.getExecutionContext&&le(),M.cancel();if(!(_=Object.keys(t)[0]))return Z.getExecutionContext&&le(),M.cancel();if("Update"!==k){var n={pid:_,onComplete:function(e){Se(e)},onFailure:function(e){Z.displayNotification({msg:C["No stream retrieved"===e?"isrCannotAccessIsrDefinition":"isrInfoRetrievalFailed"],eventID:"error"}),Z.getExecutionContext&&le(),M.cancel()}};(re=m.getIsr(_))&&re.getSpecAndContextInfo(n)}else fe({isrID:_}),M.cancel()}}else{D=!1;var i=ve();M.isUpdateSimulationAllowed()&&(i.readOnly=!1),w=new a(i),P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0)}w&&w.checkContextInfoValidity(),"Create"===k||ae&&"I3D"!==R&&!oe||ce()}()},this.pauseExecute=function(){this.cancel()},this.cancelExecute=function(){le();const e=(new Date).toLocaleString();console.log("Create Command End time:"+e)},this._destroy=function(){U=null,Z&&Z.getFrameWindow()&&Z.getFrameWindow().getContextualUIManager()&&Z.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic(),M=null,Z=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)},this.searchProducts=function(){return new Promise(function(e){require("DS/PADServices/views/LandingPage").launchSearch({title:C.isrProductSearchPageTitle,precondition:'flattenedtaxonomies:"types/VPMReference"',showApplyButton:!0,ok:function(t){e(t.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],alias:e["ds6w:label"]}}))}})})},this.getLoadedRoots=function(){return Z.getRoots().map(function(e){return l.getNodeID(e)})},this.getAddedVPMRefRoots=function(){return new Promise(function(e){var t=[];let n=[],i=Z.getRoots();i.forEach(function(e){var t=l.getNodeType(e);n.push(r._checkParentType({typeToCheck:t,parentType:"VPMReference"}))}),Promise.all(n).then(function(n){i.forEach(function(e,i){n[i]&&t.push(l.getNodeID(e))}),e(t)})})},this.getLoadedVPMRefRootData=function(e){return new Promise(function(t){for(var n={},i=[].concat(e),r=Z.getController(),a=0;a<e.length;a++){var o=r.isFiltered(e[a]);o&&o.hasFilter&&o.filterId&&(n[e[a]]={filterId:o.filterId},i.push(o.filterId))}var s=[];r.getAttributes({ids:i,attributes:["ds6w:label","ds6w:type","type_icon_url"],callbacks:{onComplete:function(i){for(var r=0;r<e.length;r++)if(i[e[r]]){var a=i[e[r]]["ds6w:label"],o=i[e[r]]["ds6w:type"],l=i[e[r]].type_icon_url,c={id:e[r],type:o,alias:a,icon:l};n[e[r]]&&n[e[r]].filterId&&i[n[e[r]].filterId]&&(c.filterId=n[e[r]].filterId,c.filterAlias=i[c.filterId]["ds6w:label"],c.filterType=i[c.filterId]["ds6w:type"],c.filterIcon=i[c.filterId].type_icon_url),s.push(c)}t(s)},onFailure:function(){Z.displayNotification({msg:C.attrRetrievalFailed,eventID:"info"}),t(s)}}})})},this.searchFilters=function(e){return new Promise(function(t){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENONextGenFilterUX/utils/FilterPersistencyServices"],function(n,i){n.getPlatformServices({onComplete:function(){i.retrieveAllFilters([e]).then(function(e){if(e.length){var n=[];e.forEach(function(e){n.push(e.filterId)});var i=n.join(" OR physicalid:");i="(physicalid:"+i+")",h.inAppsSearch({precond:i,title:C.isrFilterSearchPageTitle,callback:function(e){t(e.selected_objects.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],alias:e["ds6w:label"],icons:[e.type_icon_url]}}))},cancel:function(){t()}})}else Z.displayNotification({msg:C.noFilterFound,eventID:"info"}),t()})},onFailure:function(){t()}})})})},F=function(){var e=c.get();if(e.length){for(var t=!0,n=0;n<e.length;n++)if(e[n].pathElement.externalPath[1].modelIdentification!==N){t=!1,Z.displayNotification({msg:C.noContextMatch,eventID:"info"});break}t&&function(e){if(e&&0!==e.length){var t=e[0].pathElement,n=e[0].event;if(n){M._levelSelectorContext=e[0].pathElement.clone();var i=[],r={positionX:n.currentPosition.x,positionY:n.currentPosition.y,uiFrame:Z.getFrameWindow().getUIFrame(),getLevels:function(e){for(var r=[],a=t;a;){if(l.isPLMNode(a.externalPath[a.externalPath.length-1])&&l.isReference(a.externalPath[a.externalPath.length-1])){var o=a.getLastElement(!0),s=l.getBIColor(o);null!==s?i.push({pathElement:a,canvasColor:s,event:n}):i.push({pathElement:a,event:n}),r.push(l.getNodeID(a.getLastElement(!0)))}a=a.getParentPath()}var c=["ds6w:label","type_icon_url"],u="";Z.getController().isColorizeActivated()&&Z.getController().isStandalone()&&(u=Z.getController().getBIColorMap().predicate,c.push(u)),Z.getController().getAttributes({ids:r,attributes:c,callbacks:{onComplete:function(t,n){for(var r=0;r<i.length;++r){var a=i[r],o=l.getNodeID(a.pathElement.getLastElement(!0));if(n[o]&&(a.name=n[o]["ds6w:label"],a.icon=n[o].type_icon_url,Z.getController().isColorizeActivated()&&Z.getController().isStandalone()&&""!==t)){var s=n[o][t];a.canvasColor=Z.getController().getColorValueForPredicate(s)}}e(i)}.bind(this,u),onFailure:function(){e(i)}}});for(var f=0;f<i.length;++f){var d=i[f],p=l.getNodeID(d.pathElement.getLastElement(!0));N===p&&(d.selection="notSelectable")}return i},onHover:function(e){u.empty(),f.empty(),e.event=n,u.add(e)},onLeave:function(){u.empty(),f.empty(),u.add({pathElement:M._levelSelectorContext,event:n})},onSelect:function(e){se(),u.empty(),c.empty(),e.event=n,u.add(e),c.add(e),d.destroyView();var t,r,a=i.filter(function(t){return t.pathElement===e.pathElement}),o=!1;if(ie){var s=ie.model.getRoots();for(t=0;t<s.length;t++)if(e.pathElement.isEqual(s[t].options.pathElement)){Z.displayNotification({msg:C.isrCtxGroupElementAlreadyAdded,eventID:"info"}),o=!0;break}}if(!o)for(r=0;r<$.length;r++)if(e.pathElement.isEqual($[r].pathElement)){Z.displayNotification({msg:C.isrCtxGroupElementAlreadyAdded,eventID:"info"}),o=!0;break}o||($.push({id:l.getNodeID(e.pathElement.getLastElement(!0)),label:a[0].name,icons:[a[0].icon],pathElement:e.pathElement}),ee++,ne.setEditorText(ee>0?ee.toString().concat(" ",ee>1?C.isrCtxGroupProductsSelected:C.isrCtxGroupProductSelected):C.isrCtxGroupNoSelection)),De()}};d.createView(r)}}}(e)}else d.destroyView()},this.addMoreGroups=function(e){!function(e){N=e,$=[],ie=null,ee=0,P.hide();var t={onOK:Ae,onCancel:xe,onClose:xe};te&&(te.destroy(),te=null);var n={parent:te=Me(t),editorText:C.isrCtxGroupNoSelection};ne=new p(n),te.show(),Z.getFrameWindow().getContextualUIManager().deactivateContextualBarOnLeftClic(),De()}(e)},this.addElementsInGroup=function(e,t){!function(e,t){N=e,ie=t,$=[],ee=t.isFilter?0:t.model.getRoots().length,P.hide();var n={onOK:Te,onCancel:xe,onClose:xe};te&&(te.destroy(),te=null),te=Me(n);var i=t.isFilter?C.isrCtxGroupFilterSelected:ee>0?ee.toString().concat(" ",ee>1?C.isrCtxGroupProductsSelected:C.isrCtxGroupProductSelected):C.isrCtxGroupNoSelection;ne=new p({parent:te,editorText:i}),te.show(),Z.getFrameWindow().getContextualUIManager().deactivateContextualBarOnLeftClic(),De()}(e,t)},this.onPostRowSelect=function(e){for(var t=0;t<e.length;t++)e[t]._options&&e[t]._options.pathElement&&(u.add({pathElement:e[t]._options.pathElement}),c.add({pathElement:e[t]._options.pathElement}))},this.onPostRowUnselect=function(e){for(var t=0;t<e.length;t++)e[t]._options&&e[t]._options.pathElement&&(u.remove({pathElement:e[t]._options.pathElement}),c.remove({pathElement:e[t]._options.pathElement}))},this.getCreationParams=function(){return new Promise(function(e){m.getCreationParams({type:"SIMItfSimulation",onComplete:function(t){e(t)},onFailure:function(){Z.displayNotification({msg:C.isrCreateParamInfoRetrievalFailed,eventID:"error"}),e()}})})},this.setAllNlsType=function(e){E=e},this.areAllTabsDisabled=function(){if(w)return w.areAllTabsDisabled()},this.isUpdateSimulationAllowed=function(){return m.isUpdateSimulationAllowed()}}})}),define("DS/PIMwebViewController/PIMwebRightSidePanelCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerRightSidePanel","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/PIMwebViewController/PIMwebItfCtrl"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){var a,o,s,l=[],c=[],u=t.get(),f=r.getItfCtrl({pad3DViewer:u}),d={get:function(){var e,t=i.get();return t.length&&t.some(function(e){return n.isAModelPath(e.pathElement)})?t:l.length?(u&&u.getApplicativeData().getLoadedItfData&&(e=(e=u.getApplicativeData().getLoadedItfData())&&e.data),e||[]):[]},onPostAdd:function(e){return a=e,1},onPostRemove:function(e){return o=e,2},onEmpty:function(e){return s=e,3},unsubscribe:function(e){1===e?a=null:2===e?o=null:3===e&&(s=null)}};function p(e){1===e&&a?a():2===e&&o?o():3===e&&s&&s()}l.push(i.onPostAdd(p.bind(this,1))),l.push(i.onPostRemove(p.bind(this,2))),l.push(i.onEmpty(p.bind(this,3))),c.push(f.subscribe("onIsrAdded",p.bind(this,1))),c.push(f.subscribe("onItfAdded",p.bind(this,1))),c.push(f.subscribe("onIsrRemoved",p.bind(this,1))),this.getXSO=function(){return d},this.getID=function(e){return e&&e.isrID?e.isrID:Object.getPrototypeOf(this).getID.apply(this,arguments)},this.getRelationID=function(e){return e&&e.isrID?void 0:Object.getPrototypeOf(this).getRelationID.apply(this,arguments)},this.getType=function(e){return e&&e.isrID?e.type:Object.getPrototypeOf(this).getType.apply(this,arguments)},this.destroy=function(){p(3),l.forEach(i.unsubscribe,i),l=[],f&&c.forEach(f.unsubscribe,f),c=[],f=null,a=o=s=null,Object.getPrototypeOf(this).destroy.apply(this,arguments)},this._parent(e),p(1)},isNodeValid:function(e){var t=this._parent(e);return!t&&e&&e.isrID&&(t=!0),t},getServiceId:function(e){var t="";return e&&!e.isrID&&(t=this._parent(e)),t}})}),define("DS/PIMwebViewController/PIMwebGenerateTICCmd",["DS/CATWebUXTIC/CATWebUXTICCmdAdapt","DS/CATWebUXComponents/DMUCommandsManager","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl"],function(e,t,n,i){"use strict";return e.extend({init:function(e){var r=this,a=[],o=n.get(),s=!1,l=!1;function c(){s||!l?r.disable():r.enable()}e.pad3DViewer=o,this._parent(e);var u=i.getItfCtrl({pad3DViewer:o});a.push(u.subscribe("onIsrAdded",function(){l=!0,c()})),a.push(u.subscribe("onItfAdded",function(){l=!0,c()})),a.push(u.subscribe("onIsrRemoved",function(){l=!1,c()})),u.getLoadedIsr().length&&r.enable(),this.getParameters=function(e){var n=u.getLoadedIsr();if(0!==n.length)if(n.length>1)e.onFailure("More than one isr. Specifications to rework!");else{var i=t.getCommandCheckHeader("PIMInteferenceListHdr",o.getCommandContext()),r=t.getCommandCheckHeader("CATWebUXSlideShowHdr",o.getCommandContext());u.getTICInfo(e.cmdType,i&&i.getState()||r&&r.getState()).then(function(t){t.onComplete=function(e){u.onIssueSuccess(e)},t?e.onComplete(t):e.onCancel()})}else e.onFailure("No isr. Execution of command must not be possible")},this.lockAvailability=function(e){s=e,c()},this._destroy=function(){a.forEach(u.unsubscribe,u),u=a=r=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})});