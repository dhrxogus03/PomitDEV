define("DS/DMUPlayMeasure/DMUMeasureImport",["UWA/Class","DS/DMUMeasurable/DMUMeasurable","DS/DMUBaseExperience/EXPUtils"],function(e,t,i){"use strict";return e.extend({init:function(e){this.importData=function(n,r,o){if(n&&r&&e){r.fillObjectAttributes(e,n,o);for(var a=n.measurables.length,s=0;s<a;s++){var l=new t({},!0).importData(n.measurables[s],i.strToType);e.setMeasurable(s+1,l)}r.registerForPostImport(e)}},this.afterImport=function(){e&&e.fireEvent("onDMUObjectInitialized",{dmuObject:e})}}})}),define("DS/DMUPlayMeasure/DMUMeasureNode3D",["UWA/Core","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUBaseUI/DMUToolsLeader","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMathsFiniteGeometry","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUToolsAvatars","DS/DMUBaseUIControllers/DMUWebPreferencesController","DS/DMUBaseExperience/EXPUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/Manipulators/PlaneTranslationManipulator","DS/Manipulators/LineTranslationManipulator","DS/Manipulators/RotationManipulator","DS/SceneGraphNodes/ArrowNode","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/DMUMarkerVisu/DMUMarkerVisuMeasureShapeNode","DS/DMUBaseExperience/EXPToolsVisualization","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseExperience/DMUToolsClipping","DS/Mesh/Mesh","DS/DMUMeasurable/DMUMeshMeasure","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUIServices/DMUObjectsServices","i18n!DS/CATWebUXPreferences/assets/nls/CATWebUXPreferences"],function(e,t,i,n,r,o,a,s,l,u,c,p,d,g,h,b,y,m,v,P,A,f,w,S,M,D,T,_,C,R,x,L,E,V){"use strict";return i.extend({init:function(i){this._parent(i);var N,k,I,F,O,B,U,z,G,H,J,q,X,W,Z,j,Y,Q,K,$,ee,te,ie,ne,re,oe,ae,se,le,ue,ce,pe,de,ge,he,be,ye,me,ve,Pe,Ae=this.getViewer(),fe=i.owner.getAttribute("cLineStyleColor"),we=i.owner.getAttribute("cFillStyleColor"),Se=new d.Color(16753920),Me=10*window.devicePixelRatio,De=!1,Te=!1,_e=!1,Ce=i.owner.getAttribute("iExtensionLinesManipulable"),Re=function(){_e=!(!i.owner.getAttribute("bShortDisplay")||i.owner.getAttribute("bDisplayUnit"))};Re();var xe={};xe.regularSolidLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio,pattern:R.LinePatternEnum.SOLID}),xe.regularDashedLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio,pattern:R.LinePatternEnum.DASHED}),xe.bBoxSolidLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio,pattern:R.LinePatternEnum.SOLID}),xe.avatarSolidLine=_.retrieveMaterialFromGAS({color:we,lineWidth:window.devicePixelRatio,pattern:R.LinePatternEnum.SOLID}),xe.avatarDashedLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio,pattern:R.LinePatternEnum.DASHED}),xe.avatarDottedLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio,pattern:R.LinePatternEnum.SMALLDOTTED}),xe.dotDashedLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio+1,pattern:R.LinePatternEnum.DOTDASHED}),xe.dotLine=_.retrieveMaterialFromGAS({color:fe,lineWidth:window.devicePixelRatio+1,pattern:R.LinePatternEnum.DOTTED}),xe.crossPoint=_.retrieveMaterialFromGAS({symbol:1,size:Me,withoutDPR:!0,color:new d.Color(0)});var Le,Ee,Ve,Ne,ke,Ie,Fe,Oe,Be,Ue,ze,Ge,He,Je,qe=!1,Xe=T.getReviewContext({viewer:Ae}),We=!1,Ze=!1,je=null,Ye=null,Qe=null,Ke=null,$e=!0,et=this,tt={},it=.001,nt=1,rt=String.fromCharCode(216);function ot(e,t,i,n,r,o){return void 0===e&&void 0===t&&void 0===i&&void 0===n&&void 0===r&&void 0===o?0:Math.abs(i*t-e*n+(r*n-i*o)+(e*o-r*t))/2}function at(){var e,t=M.get()[0];if(!t)return!1;if(t.event){var n=et.getLabelDimensions(),r={offsetWidth:w.convertModelToPixels({sizeInMM:n.offsetWidth}),offsetHeight:w.convertModelToPixels({sizeInMM:n.offsetHeight})},o=w.getViewerPositionFromPoint(Ae,n.position),a=new d.Vector2(Math.round(o.left-r.offsetWidth/2),Math.round(o.top-r.offsetHeight/2)),s=w.get2DSnappedPosition(t.event.getCurrentPosition(Ae.canvas)),l=a.clone();l.y=l.y+n.height/(Ee+1)*Le;var u=a.clone();u.y=u.y+n.height/(Ee+1)*Ee;var c=a.clone();c.x=c.x+n.width,c.y=c.y+n.height/(Ee+1)*Le;var p=a.clone();p.x=p.x+n.width,p.y=p.y+n.height/(Ee+1)*Ee;var g=i.owner.getAttribute("fBoxRotationAngle");g=-g;var h=i.owner.getAttribute("vLeaderBreakPoint3D");if(g){var b=w.getWindowPositionFromPoint(Ae,h,i.frmWindow);b=new d.Vector2(b.left,b.top);var y=function(e){var t=e.clone();t.x=e.x-b.x,t.y=e.y-b.y;var i,n=(i=t,new d.Vector2(i.x*Math.cos(g)-i.y*Math.sin(g),i.x*Math.sin(g)+i.y*Math.cos(g)));return t.x=n.x+b.x,t.y=n.y+b.y,t};l=y(l),u=y(u),c=y(c),p=y(p)}var m={x1:u.x,y1:u.y,x2:l.x,y2:l.y,x3:c.x,y3:c.y,x4:p.x,y4:p.y,x:s.x,y:s.y};if(!qe||i.owner.getAttribute("bShortDisplay")||ot((e=m).x1,e.y1,e.x,e.y,e.x2,e.y2)+ot(e.x2,e.y2,e.x,e.y,e.x3,e.y3)+ot(e.x3,e.y3,e.x,e.y,e.x4,e.y4)+ot(e.x4,e.y4,e.x,e.y,e.x1,e.y1)-(ot(e.x1,e.y1,e.x3,e.y3,e.x2,e.y2)+ot(e.x1,e.y1,e.x3,e.y3,e.x4,e.y4))>it)return!1}return!0}function st(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)}function lt(){$e=i.owner.isReadOnly()||!i.owner.isEditable()||function(){var e=C.isManipulationAllowed({viewer:Ae});if("boolean"==typeof e)return!e;var t=p.checkIfCommandIsRunning(Ae);if(t){var i=p.getCurrentCommand(Ae);"measureCmdHdr"!==i&&"measure3CmdHdr"!==i&&"measure2CmdHdr"!==i&&"measure2DCmdHdr"!==i||(t=!1)}return t}()}function ut(e){if(!$e){var t={pathElement:D.buildPathElement(et)};if(e&&e.event&&e.event.from&&e.event.from.length>0){var n=e.event.from[e.event.from.length-1].getCurrentPosition();i.owner.refreshAssistantTool&&i.owner.refreshAssistantTool({mousePosition:n},!0)}e&&e.event.from[0].event.ctrlKey?S.remove(t):S.empty(),S.add(t)}}function ct(){var e={fontStyle:{height:et.getPixelFontSize("fFontSize"),familyStyle:i.owner.getAttribute("sFontStyle"),familyName:i.owner.getAttribute("sFontName"),color:i.owner.getAttribute("cFontColor"),fontSize:i.owner.getAttribute("fFontSize")},fontStyleComment:{height:et.getPixelFontSize("fCommentFontSize"),familyStyle:i.owner.getAttribute("sCommentFontStyle"),familyName:i.owner.getAttribute("sCommentFontName"),color:i.owner.getAttribute("cFontColor")},fillStyle:{color:i.owner.getAttribute("cFillStyleColor"),opacity:i.owner.getAttribute("fOpacity")},lineStyle:{thickness:(E.getLineThickness(i.owner.getAttribute("fLineStyleThicknessIndex"))||i.owner.getAttribute("fLineStyleThickness"))*window.devicePixelRatio,pattern:i.owner.getAttribute("sLineStylePattern"),color:i.owner.getAttribute("cLineStyleColor")}},t=E.getLineThickness(i.owner.getAttribute("fLeaderStyleThicknessIndex"))||i.owner.getAttribute("fLeaderStyleThickness"),n=i.owner.getAttribute("cLeaderStyleColor"),r=i.owner.getAttribute("sLeaderStylePattern");return(void 0!==t||n||r)&&(e.leaderStyle={thickness:void 0!==t?t*window.devicePixelRatio:void 0,pattern:r,color:n}),e}function pt(e){var t="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;return" "+V.sx+": "+c.convertUnitValueToString("Length",e.x,Xe,!0,_e,t)+" "+V.sy+": "+c.convertUnitValueToString("Length",e.y,Xe,!0,_e,t)+" "+V.sz+": "+c.convertUnitValueToString("Length",e.z,Xe,!0,_e,t)}function dt(e){var t="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;return" "+V.dx+": "+c.convertUnitValueToString("Length",e.x,Xe,!0,_e,t)+" "+V.dy+": "+c.convertUnitValueToString("Length",e.y,Xe,!0,_e,t)+" "+V.dz+": "+c.convertUnitValueToString("Length",e.z,Xe,!0,_e,t)}function gt(e,t,i){var n="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,o=r.isZero(e)?0:e,a=c.convertUnitValueToString("Length",o,Xe,!0,_e,n);return Te&&(a=V.aproximateSymbol+a),t?a:i?V.curveLength+" "+a:V.length+" "+a}function ht(e,t,i){var n,o="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,a=r.isZero(e)?0:180*e/Math.PI,s=c.convertUnitValueToString("Angle",a,Xe,!0,_e,o);return t||(n=V.angle,i&&(n=V.halfAngle)),Te&&(s=V.aproximateSymbol+s),t?s:n+" "+s}function bt(e,t){var i=r.isZero(e)?0:e,n="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,o=c.convertUnitValueToString("Area",i,Xe,!0,_e,n);return Te&&(o=V.aproximateSymbol+o),t?o:V.area+" "+o}function yt(e,t){var i=r.isZero(e)?0:e,n="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,o=c.convertUnitValueToString("Volume",i,Xe,!0,_e,n);return Te&&(o=V.aproximateSymbol+o),t?o:V.volume+" "+o}function mt(e,t,i){var n,o=r.isZero(e)?0:e,a="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,s=c.convertUnitValueToString("Length",o,Xe,!0,_e,a);return n=void 0===i?V.radius:i?V.maxRadius:V.minRadius,Te&&(s=V.aproximateSymbol+s),t?V.symbolRadius+" "+s:n+" "+s}function vt(e,t,i){var n,o=r.isZero(e)?0:e,a="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,s=c.convertUnitValueToString("Length",o,Xe,!0,_e,a);return n=void 0===i?V.diameter:i?V.maxDiameter:V.minDiameter,Te&&(s=V.aproximateSymbol+s),t?rt+" "+s:n+" "+s}function Pt(e,t,i){var n=r.isZero(e)?0:e,o="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,a=c.convertUnitValueToString("Length",n,Xe,!0,_e,o);return Te&&(a=V.aproximateSymbol+a),i?a:t+" "+a}function At(e,t){var i="",n=!1,o="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;r.isZero(t.x)||(n=!0,i+=c.convertUnitValueToString("Length",t.x,Xe,!0,!0,o),i+=V.sx),r.isZero(t.y)||(t.y>0&&!0===n&&(i+="+"),n=!0,i+=c.convertUnitValueToString("Length",t.y,Xe,!0,!0,o),i+=V.sy),r.isZero(t.z)||(t.z>0&&!0===n&&(i+="+"),n=!0,i+=c.convertUnitValueToString("Length",t.z,Xe,!0,!0,o),i+=V.sz);var a=-(e.x*t.x+e.y*t.y+e.z*t.z);return a>0&&!0===n&&(i+="+"),i+=c.convertUnitValueToString("Length",a,Xe,!0,!0,o),i+="=0"}function ft(e,i,n){var r,o=!1;switch(null==i&&(o=!0),e){case t.ResultType.POINT:case t.ResultType.CENTER:r=n?i?V.labelPOI+" "+V.inLabel+" "+i:V.labelPOI:o?V.point:V.point+" "+V.inLabel+" "+i;break;case t.ResultType.LINE:r=o?V.line:V.line+" "+V.inLabel+" "+i;break;case t.ResultType.AXIS:r=V.infiniteline+" "+V.inLabel+" "+i;break;case t.ResultType.CIRCLE:r=o?V.circle:V.circle+" "+V.inLabel+" "+i;break;case t.ResultType.CURVE:r=o?V.curve:V.curve+" "+V.inLabel+" "+i;break;case t.ResultType.PLANE:r=V.plane+" "+V.inLabel+" "+i;break;case t.ResultType.CYLINDER:r=V.cylinder+" "+V.inLabel+" "+i;break;case t.ResultType.CONE:r=V.cone+" "+V.inLabel+" "+i;break;case t.ResultType.SPHERE:r=V.sphere+" "+V.inLabel+" "+i;break;case t.ResultType.SURFACE:r=V.surface+" "+V.inLabel+" "+i;break;case t.ResultType.PRODUCT:r=V.product+" "+i}return r}function wt(e,t,n,r,o,a){if(e){var s="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value;De||r.push(V.coordinates),r[r.length]=V.sx+": "+(Te?V.aproximateSymbol+c.convertUnitValueToString("Length",t.x,Xe,!0,_e,s):c.convertUnitValueToString("Length",t.x,Xe,!0,_e,s)),r[r.length]=V.sy+": "+(Te?V.aproximateSymbol+c.convertUnitValueToString("Length",t.y,Xe,!0,_e,s):c.convertUnitValueToString("Length",t.y,Xe,!0,_e,s)),r[r.length]=V.sz+": "+(Te?V.aproximateSymbol+c.convertUnitValueToString("Length",t.z,Xe,!0,_e,s):c.convertUnitValueToString("Length",t.z,Xe,!0,_e,s))}else{Ve=a?n?V.labelPOI+" "+V.inLabel+" "+n:V.labelPOI:n?V.point+" "+V.inLabel+" "+n:V.point,Ne=void 0,r[0]=V.coordinates+" "+pt(t);var l=i.owner.getAttribute("lCustomization");l&&l.length>0?(l[0].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),l[1].custoValue&&r.push(o.mode)):(r[0]=V.coordinates+" "+pt(t),r[1]=Ve.length>50?Ve.substring(0,50)+"...":Ve,r[2]=o.mode),Le=1,Ee=2}}function St(e,t,n,r,o,a){var s=i.owner.getAttribute("fVolume"),l=i.owner.getAttribute("fArea"),u=i.owner.getAttribute("fLength"),p=i.owner.getAttribute("vCog"),d=t.getOriginPoint(),g=i.owner.getAttribute("sProductDisplayType");if(e)!function(e,t,i,n,r,o,a){if("Volume"===e&&void 0!==t&&t>0||"Area"!==e&&void 0!==t&&t>0)o[0]=yt(t,De);else if("Area"===e&&void 0!==i&&i>0||void 0!==i&&i>0)o[0]=bt(i,De);else if(void 0===t&&void 0===i&&void 0!==a&&a>0)o[0]=gt(a,De);else if(void 0!==t||void 0!==i||void 0!==a||void 0===n&&void 0===r)void 0!==t&&(o[0]=yt(t,De));else{var s="true"===c.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]}).preferences[0].value,l=void 0!==n;De||o.push(V.coordinates),o[o.length]=V.sx+": "+c.convertUnitValueToString("Length",l?n.x:r.x,Xe,!0,_e,s),o[o.length]=V.sy+": "+c.convertUnitValueToString("Length",l?n.y:r.y,Xe,!0,_e,s),o[o.length]=V.sz+": "+c.convertUnitValueToString("Length",l?n.z:r.z,Xe,!0,_e,s)}}(g,s,l,p,d,o,u);else{Ve=r,Ne=void 0;var h=0,b=V.product,y=i.owner.getAttribute("lCustomization"),m=y.length;y&&y.length>0?("Area"===i.owner.getAttribute("sProductDisplayType")?void 0===l&&void 0===s||(o.push(bt(l)),y[0].custoValue&&s&&o.push(yt(s))):void 0===l&&void 0===s||(o.push(yt(s)),y[0].custoValue&&l&&o.push(bt(l))),void 0===s&&h++,void 0===l&&h++,void 0!==s||void 0!==l?y[1].custoValue&&o.push(V.cog+" "+pt(p)):void 0!==u&&u>0?(o.push(gt(u)),void 0!==n.beginPoint&&void 0!==n.endPoint&&(b=V.curve+" "+V.inLabel,h--,y[0].custoValue&&o.push(V.firstpoint+" "+pt(n.beginPoint)),h--,y[1].custoValue&&o.push(V.secondpoint+" "+pt(n.endPoint)))):void 0!==p?(o.push(pt(p)),b=V.point+" "+V.inLabel):void 0!==d?(o.push(pt(d)),b=V.point+" "+V.ofLabel):h++,Ve=b+" "+Ve,y[m-2].custoValue&&o.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),y[m-1].custoValue&&o.push(a.mode)):(void 0===s?h++:o[0]=yt(s),void 0===l?h++:o[1-h]=bt(l),void 0!==s||void 0!==l?o[2-h]=V.cog+" "+pt(p):void 0!==u&&u>0?(o[2-h]=gt(u),void 0!==n.beginPoint&&void 0!==n.endPoint&&(b=V.curve+" "+V.inLabel,o[2- --h]=V.startpoint+" "+pt(n.beginPoint),o[2- --h]=V.endpoint+" "+pt(n.endPoint))):void 0!==p?(o[2-h]=pt(p),b=V.point+" "+V.inLabel):void 0!==d?(o[2-h]=pt(d),b=V.point+" "+V.ofLabel):h++,Ve=b+" "+Ve,o[3-h]=Ve.length>50?Ve.substring(0,50)+"...":Ve,o[4-h]=a.mode),Le=3-h,Ee=4-h}}function Mt(e,t,n,r){var o,a,s,l,u,c,p,g,h=[],b=i.owner.getAttribute("sSurfaceDisplayType");if(e)switch(b){case"MinimumRadius":s=i.owner.getAttribute("fRadius"),h[0]=mt(s,De,!1);break;case"MinimumDiameter":l=2*i.owner.getAttribute("fRadius"),h[0]=vt(l,De,!1);break;case"MaximumRadius":u=i.owner.getAttribute("fMaxRadius"),h[0]=mt(u,De,!0);break;case"MaximumDiameter":c=2*i.owner.getAttribute("fMaxRadius"),h[0]=vt(c,De,!0);break;case"Length":p=i.owner.getAttribute("fHeight"),h[0]=gt(p,De);break;case"Area":g=i.owner.getAttribute("fArea"),h[0]=bt(g,De);break;case"Angle":0!==t&&(h[0]=ht(2*t,De,!1));break;default:0!==t&&(h[0]=ht(t,De,!0))}else{Ve=V.cone+" "+V.inLabel+" "+i.owner.getAttribute("oProduct1Name"),Ne=void 0,o=n.getPoints(),(a=new d.Vector3).subVectors(o.endPoint,o.beginPoint).normalize();var y=i.owner.getAttribute("lCustomization");if(y&&y.length>0){s=i.owner.getAttribute("fRadius"),u=i.owner.getAttribute("fMaxRadius"),l=2*i.owner.getAttribute("fRadius"),c=2*i.owner.getAttribute("fMaxRadius"),p=i.owner.getAttribute("fHeight"),g=i.owner.getAttribute("fArea");var m=n.getApex(),v=V.firstpoint+" "+pt(o.beginPoint),P=V.secondpoint+" "+pt(o.endPoint),A=gt(p,!1),f=mt(s,!1,!1),w=mt(u,!1,!0),S=vt(l,!1,!1),M=vt(c,!1,!0),D=V.direction+" "+pt(a),T=ht(2*t,!1,!1),_=ht(t,!1,!0),C=V.apex+" "+pt(m),R=bt(i.owner.getAttribute("fArea")),x=V.cog+" "+pt(i.owner.getAttribute("vCog")),L=Ve.length>50?Ve.substring(0,50)+"...":Ve,E=r.mode,N=void 0;switch(b){case"MinimumRadius":h[0]=f,N=w;break;case"MinimumDiameter":h[0]=S,N=M;break;case"MaximumRadius":h[0]=w,s>0&&(N=f);break;case"MaximumDiameter":h[0]=M,l>0&&(N=S);break;case"Length":h[0]=A;break;case"Area":h[0]=R;break;case"Angle":0!==t&&(h[0]=T);break;default:0!==t&&(h[0]=_)}"Length"===b?(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(D),y[3].custoValue&&h.push(T),y[4].custoValue&&h.push(_),y[5].custoValue&&h.push(C),s>0&&y[6].custoValue&&h.push(f),y[7].custoValue&&h.push(w),l>0&&y[8].custoValue&&h.push(S),y[9].custoValue&&h.push(M),y[10].custoValue&&h.push(R),y[11].custoValue&&h.push(x),y[12].custoValue&&h.push(L),y[13].custoValue&&h.push(E)):"Area"===b?(y[0].custoValue&&h.push(x),y[1].custoValue&&h.push(L),y[2].custoValue&&h.push(E)):"MinimumRadius"===b||"MaximumRadius"===b||"MinimumDiameter"===b||"MaximumDiameter"===b?(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(A),y[3].custoValue&&h.push(D),y[4].custoValue&&h.push(T),y[5].custoValue&&h.push(_),y[6].custoValue&&h.push(C),void 0!==N&&y[7].custoValue&&h.push(N),y[8].custoValue&&h.push(R),y[9].custoValue&&h.push(x),y[10].custoValue&&h.push(L),y[11].custoValue&&h.push(E)):(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(A),y[3].custoValue&&h.push(D),y[4].custoValue&&h.push(C),s>0&&y[5].custoValue&&h.push(f),y[6].custoValue&&h.push(w),l>0&&y[7].custoValue&&h.push(S),y[8].custoValue&&h.push(M),y[9].custoValue&&h.push(R),y[10].custoValue&&h.push(x),y[11].custoValue&&h.push(L),y[12].custoValue&&h.push(E))}else h[0]=ht(t,!1,!0),h[1]=V.startpoint+" "+pt(o.beginPoint),h[2]=V.endpoint+" "+pt(o.endPoint),h[3]=V.direction+" "+pt(a),h[4]=bt(i.owner.getAttribute("fArea")),h[5]=V.cog+" "+pt(i.owner.getAttribute("vCog")),h[6]=Ve.length>50?Ve.substring(0,50)+"...":Ve,h[7]=r.mode;Le=6,Ee=7}return h}function Dt(e,n,r,o){var a=[];o.exact=n.getMode()===l.Mode.EXACT,o.mode=o.exact?V.exactMode:V.approximateMode;var s=i.owner.getAttribute("oProduct1Name"),u=i.owner.getAttribute("sResultingType1"),c=n._bIsPOISelection;switch(Te&&o.exact&&(Te=!1),u){case t.ResultType.POINT:wt(e,i.owner.getAttribute("vPosition"),s,a,o,c);break;case t.ResultType.CENTER:wt(e,n.getCenter(),s,a,o);break;case t.ResultType.LINE:!function(e,t,n,r,o){if(e)0!==i.owner.getAttribute("fLength")&&(r[0]=gt(i.owner.getAttribute("fLength"),De));else{Ve=De&&void 0===n?V.line:V.line+" "+V.inLabel+" "+n,Ne=void 0;var a=new d.Vector3;a.subVectors(t.endPoint,t.beginPoint).normalize();var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(r[0]=gt(i.owner.getAttribute("fLength")),s[0].custoValue&&r.push(V.firstpoint+" "+pt(t.beginPoint)),s[1].custoValue&&r.push(V.secondpoint+" "+pt(t.endPoint)),s[2].custoValue&&r.push(V.direction+" "+pt(a)),s[3].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),s[4].custoValue&&r.push(o.mode)):(r[0]=gt(i.owner.getAttribute("fLength")),r[1]=V.startpoint+" "+pt(t.beginPoint),r[2]=V.endpoint+" "+pt(t.endPoint),r[3]=V.direction+" "+pt(a),r[4]=Ve.length>50?Ve.substring(0,50)+"...":Ve,r[5]=o.mode),Le=4,Ee=5}}(e,r,s,a,o);break;case t.ResultType.AXIS:!function(e,t,n,r,o){var a=new d.Vector3;if(a.subVectors(t.endPoint,t.beginPoint).normalize(),e)r[0]=De?pt(a):V.direction+" "+pt(a);else{Ve=V.infiniteline+" "+V.inLabel+" "+n,Ne=void 0,r[0]=V.direction+" "+pt(a);var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(s[0].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),s[1].custoValue&&r.push(o.mode)):(r[1]=Ve.length>50?Ve.substring(0,50)+"...":Ve,r[2]=o.mode),Le=1,Ee=2}}(e,r,s,a,o);break;case t.ResultType.CIRCLE:!function(e,t,n,r,o,a){var s,l=i.owner.getAttribute("fRadius"),u=t.getArcAngle();e||(s=i.owner.getAttribute("lCustomization")),i.owner.getAttribute("bArcLengthDisplay")?e?o[0]=Pt(u*l,V.arcLength,De):(o[0]=Pt(u*l,V.arcLength),s&&s.length>0?(Ve=V.arc+" "+V.inLabel+" "+r,Ne=void 0,s[0].custoValue&&o.push(V.firstpoint+" "+pt(n.beginPoint)),s[1].custoValue&&o.push(V.secondpoint+" "+pt(n.endPoint)),s[2].custoValue&&o.push(mt(l)),s[3].custoValue&&o.push(vt(2*l)),s[4].custoValue&&o.push(Ve),s[5].custoValue&&o.push(a.mode)):(Ve=V.arc,Ne=void 0,o[1]=V.startpoint+" "+pt(n.beginPoint),o[2]=V.endpoint+" "+pt(n.endPoint),o[3]=Ve,o[4]=a.mode),Le=3,Ee=4):e?i.owner.getAttribute("bRadiusDisplay")?o[0]=mt(l,De):o[0]=vt(2*l,De):(i.owner.getAttribute("bRadiusDisplay")?o[0]=mt(l):o[0]=vt(2*l),Ve=De&&void 0===r?u&&Math.abs(2*Math.PI-u)>it?V.arc:V.circle:V.circle+" "+V.inLabel+" "+r,Ne=void 0,s&&s.length>0?(s[0].custoValue&&o.push(V.center+" "+pt(i.owner.getAttribute("vCenter"))),s[1].custoValue&&o.push(Pt(u*l,V.arcLength)),s[2].custoValue&&o.push(Pt(2*Math.PI*l,V.circlePerimeter)),s[3].custoValue&&o.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),s[4].custoValue&&o.push(a.mode)):(o[1]=V.center+" "+pt(i.owner.getAttribute("vCenter")),o[2]=Pt(u*l,V.arcLength),o[3]=Pt(2*Math.PI*l,V.circlePerimeter),o[4]=Ve.length>50?Ve.substring(0,50)+"...":Ve,o[5]=a.mode),Le=4,Ee=5)}(e,n,r,s,a,o);break;case t.ResultType.CURVE:!function(e,t,n,r,o){if(e)0!==i.owner.getAttribute("fLength")&&(r[0]=gt(i.owner.getAttribute("fLength"),De,!0));else{Ve=void 0===n?V.curve:V.curve+" "+V.inLabel+" "+n,Ne=void 0,r[0]=gt(i.owner.getAttribute("fLength"),!1,!0);var a=i.owner.getAttribute("lCustomization");null!==t?(a&&a.length>0?(a[0].custoValue&&r.push(V.firstpoint+" "+pt(t.beginPoint)),a[1].custoValue&&r.push(V.secondpoint+" "+pt(t.endPoint)),a[2].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),a[3].custoValue&&r.push(o.mode)):(r[1]=V.startpoint+" "+pt(t.beginPoint),r[2]=V.endpoint+" "+pt(t.endPoint),r[3]=Ve.length>50?Ve.substring(0,50)+"...":Ve,r[4]=o.mode),Le=3,Ee=4):a&&a.length>0?(a[2].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),a[3].custoValue&&r.push(o.mode)):(r[1]=Ve.length>50?Ve.substring(0,50)+"...":Ve,r[2]=o.mode)}}(e,r,s,a,o);break;case t.ResultType.PLANE:!function(e,t,n,r,o){var a=i.owner.getAttribute("fArea");if(e)0!==a&&(r[0]=bt(a,De));else{Ve=V.plane+" "+V.inLabel+" "+n,Ne=void 0;var s=t.getPlane(),l=i.owner.getAttribute("lCustomization");l&&l.length>0?(r.push(bt(a)),l[0].custoValue&&r.push(V.cog+" "+pt(i.owner.getAttribute("vCog"))),l[1].custoValue&&r.push(V.equation+" "+At(s.origin,s.normal)),l[2].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),l[3].custoValue&&r.push(o.mode)):(r[0]=bt(a),r[1]=V.cog+" "+pt(i.owner.getAttribute("vCog")),r[2]=V.equation+" "+At(s.origin,s.normal),r[3]=Ve.length>50?Ve.substring(0,50)+"...":Ve,r[4]=o.mode),Le=3,Ee=4}}(e,n,s,a,o);break;case t.ResultType.CYLINDER:!function(e,t,n,r,o){var a,s,l=i.owner.getAttribute("fRadius"),u=i.owner.getAttribute("sSurfaceDisplayType");if(e)"Length"===u?(s=i.owner.getAttribute("fHeight"),r[0]=gt(s,De)):"Area"===u?(a=i.owner.getAttribute("fArea"),r[0]=bt(a,De)):0!==l&&(i.owner.getAttribute("bRadiusDisplay")?r[0]=mt(l,De):r[0]=vt(2*l,De));else{Ve=V.cylinder+" "+V.inLabel+" "+n,Ne=void 0,a=i.owner.getAttribute("fArea");var c=new d.Vector3;c.subVectors(t.endPoint,t.beginPoint).normalize();var p=i.owner.getAttribute("lCustomization");p&&p.length>0?"Length"===u?(s=i.owner.getAttribute("fHeight"),r[0]=gt(s),p[0].custoValue&&r.push(V.firstpoint+" "+pt(t.beginPoint)),p[1].custoValue&&r.push(V.secondpoint+" "+pt(t.endPoint)),p[2].custoValue&&r.push(V.direction+" "+pt(c)),p[3].custoValue&&r.push(mt(l)),p[4].custoValue&&r.push(vt(2*l)),p[5].custoValue&&r.push(bt(a)),p[6].custoValue&&r.push(V.cog+" "+pt(i.owner.getAttribute("vCog"))),p[7].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),p[8].custoValue&&r.push(o.mode)):"Area"===u?(a=i.owner.getAttribute("fArea"),r[0]=bt(a),p[0].custoValue&&r.push(V.cog+" "+pt(i.owner.getAttribute("vCog"))),p[1].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),p[2].custoValue&&r.push(o.mode)):0!==l&&(s=i.owner.getAttribute("fHeight"),i.owner.getAttribute("bRadiusDisplay")?r[0]=mt(l):r[0]=vt(2*l),p[0].custoValue&&r.push(V.firstpoint+" "+pt(t.beginPoint)),p[1].custoValue&&r.push(V.secondpoint+" "+pt(t.endPoint)),p[2].custoValue&&r.push(gt(s)),p[3].custoValue&&r.push(V.direction+" "+pt(c)),p[4].custoValue&&r.push(bt(a)),p[5].custoValue&&r.push(V.cog+" "+pt(i.owner.getAttribute("vCog"))),p[6].custoValue&&r.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),p[7].custoValue&&r.push(o.mode)):(i.owner.getAttribute("bRadiusDisplay")?r[0]=mt(l):r[0]=vt(2*l),r[1]=V.startpoint+" "+pt(t.beginPoint),r[2]=V.endpoint+" "+pt(t.endPoint),r[3]=V.direction+" "+pt(c),r[4]=bt(a),r[5]=V.cog+" "+pt(i.owner.getAttribute("vCog")),r[6]=Ve.length>50?Ve.substring(0,50)+"...":Ve,r[7]=o.mode),Le=6,Ee=7}}(e,r,s,a,o);break;case t.ResultType.SPHERE:!function(e,t,n,r){n[0]=V.sphere;var o=i.owner.getAttribute("fRadius"),a=i.owner.getAttribute("sSurfaceDisplayType"),s=i.owner.getAttribute("fArea");if(e)"Area"===a?n[0]=bt(s,De):i.owner.getAttribute("bRadiusDisplay")?n[0]=mt(o,De):n[0]=vt(2*o,De);else{Ve=V.sphere+" "+V.inLabel+" "+t,Ne=void 0;var l=i.owner.getAttribute("lCustomization");l&&l.length>0?"Area"===a?(n[0]=bt(s),l[0].custoValue&&n.push(V.cog+" "+pt(i.owner.getAttribute("vCog"))),l[1].custoValue&&n.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),l[2].custoValue&&n.push(r.mode)):(i.owner.getAttribute("bRadiusDisplay")?n[0]=mt(o):n[0]=vt(2*o),l[0].custoValue&&n.push(V.center+" "+pt(i.owner.getAttribute("vCenter"))),l[1].custoValue&&n.push(bt(s)),l[2].custoValue&&n.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),l[3].custoValue&&n.push(r.mode)):(i.owner.getAttribute("bRadiusDisplay")?n[0]=mt(o):n[0]=vt(2*o),n[1]=V.center+" "+pt(i.owner.getAttribute("vCenter")),n[2]=bt(s),n[3]=Ve.length>50?Ve.substring(0,50)+"...":Ve,n[4]=r.mode),Le=3,Ee=4}}(e,s,a,o);break;case t.ResultType.SURFACE:!function(e,t,n,r){if(e)0!==i.owner.getAttribute("fArea")&&(n[0]=bt(i.owner.getAttribute("fArea"),De));else{Ve=V.surface+" "+V.inLabel+" "+t,Ne=void 0;var o=i.owner.getAttribute("lCustomization");o&&o.length>0?(n.push(bt(i.owner.getAttribute("fArea"))),o[0].custoValue&&n.push(V.cog+" "+pt(i.owner.getAttribute("vCog"))),o[1].custoValue&&n.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),o[2].custoValue&&n.push(r.mode)):(n[0]=bt(i.owner.getAttribute("fArea")),n[1]=V.cog+" "+pt(i.owner.getAttribute("vCog")),n[2]=Ve.length>50?Ve.substring(0,50)+"...":Ve,n[3]=r.mode),Le=2,Ee=3}}(e,s,a,o);break;case t.ResultType.PRODUCT:St(e,n,r,s,a,o);break;case t.ResultType.CONE:a=Mt(e,i.owner.getAttribute("fSemiAngle"),n,o);break;default:a[0]="Unknow"}return a}function Tt(e,t,n,r,o){var a,s,u=[],c={},p=i.owner.getMeasurable(1),g=p.getPoints();if(De=!1,!1===i.owner.getAttribute("bDisplayMeasureType")&&(De=!0),Te=!1,e&&!0===i.owner.getAttribute("bDisplayApproximateSymbol")&&(Te=!0),"MeasureBetween"===t||"MeasureThickness"===t)u=function(e,t,n,r,o,a,s,u){var c=[];u.exact="MeasureThickness"!==je&&a.getMode()===l.Mode.EXACT&&s.getMode()===l.Mode.EXACT,u.mode=u.exact?V.exactMode:V.approximateMode;var p=V.minDistance;if(Te&&u.exact&&(Te=!1),"MeasureBetween"===e)switch(t){case"Distance":p=V.distance;break;case"MaximumDistance":p=V.maxDistance;break;case"LocalMinimumDistance":p=V.LocalMinimumDistance;break;case"LocalMaximumDistance":p=V.LocalMaximumDistance}var g=gt(o,!0);if(r)c[0]=De?g:"MeasureBetween"===e?p+" "+g:V.thickness+" "+g;else{var h=new d.Vector3,b=i.owner.getAttribute("vFirstExtensionPoint3D"),y=i.owner.getAttribute("vSecondExtensionPoint3D");h.subVectors(y,b);var m=h.clone().normalize(),v=i.owner.getAttribute("lCustomization");"MeasureBetween"===e?(Ve=ft(i.owner.getAttribute("sResultingType1"),i.owner.getAttribute("oProduct1Name"),a._bIsPOISelection),Ne=ft(i.owner.getAttribute("sResultingType2"),i.owner.getAttribute("oProduct2Name"),s._bIsPOISelection),"2D"===n&&(Ve===V.circle&&a._arcAngle&&Math.abs(2*Math.PI-a._arcAngle)>it&&(Ve=V.arc),Ne===V.circle&&s._arcAngle&&Math.abs(2*Math.PI-s._arcAngle)>it&&(Ne=V.arc)),v&&v.length>0?(c[0]=p+" "+g,7===v.length&&(v[0].custoValue&&c.push(V.firstpoint+" "+pt(b)),v[1].custoValue&&c.push(V.secondpoint+" "+pt(y)),v[2].custoValue&&c.push(V.components+" "+dt(h)),v[3].custoValue&&c.push(V.direction+" "+pt(m)),v[4].custoValue&&c.push("2D"!==n&&Ve.length>50?Ve.substring(0,50)+"...":Ve),v[5].custoValue&&c.push("2D"!==n&&Ne.length>50?Ne.substring(0,50)+"...":Ne),v[6].custoValue&&c.push(u.mode)),"2D"!==n&&(Le=5,Ee=7)):(c[0]=p+" "+g,c[1]=V.firstpoint+" "+pt(b),c[2]=V.secondpoint+" "+pt(y),c[3]=V.components+" "+dt(h),c[4]=V.direction+" "+pt(m),"2D"===n?(c[5]=Ve+" - "+Ne,c[6]=u.mode):(Le=5,Ee=7,c[5]=Ve.length>50?Ve.substring(0,50)+"...":Ve,c[6]=Ne.length>50?Ne.substring(0,50)+"...":Ne,c[7]=u.mode))):(Ve=V.thickness+" "+V.ofLabel,a._bIsPOISelection&&(Ve=V.labelPOI+" "+V.inLabel),Ve=Ve+" "+i.owner.getAttribute("oProduct1Name"),Ne=void 0,v&&v.length>0?(c[0]=V.thickness+" "+g,v[0].custoValue&&c.push(V.firstpoint+" "+pt(b)),v[1].custoValue&&c.push(V.secondpoint+" "+pt(y)),v[2].custoValue&&c.push(V.direction+" "+pt(m)),v[3].custoValue&&c.push(Ve.length>50?Ve.substring(0,50)+"...":Ve),v[4].custoValue&&c.push(u.mode)):(c[0]=V.thickness+" "+g,c[1]=V.startpoint+" "+pt(b),c[2]=V.endpoint+" "+pt(y),c[3]=V.direction+" "+pt(m),c[4]=Ve.length>50?Ve.substring(0,50)+"...":Ve,c[5]=u.mode),Le=4,Ee=5)}return c}(t,o,r,e,n,p,a=i.owner.getMeasurable(2),c);else if("MeasureItem"===t)u=Dt(e,p,g,c);else if("Measure3PointsCircle"===t){a=i.owner.getMeasurable(2);var h=i.owner.getMeasurable(3);if(c.exact=p.getMode()===l.Mode.EXACT&&a.getMode()===l.Mode.EXACT&&h.getMode()===l.Mode.EXACT,c.mode=c.exact?V.exactMode:V.approximateMode,s=i.owner.getAttribute("fRadius"),e)Te&&c.exact&&(Te=!1),i.owner.getAttribute("bRadiusDisplay")?u[0]=mt(s,De):u[0]=vt(2*s,De);else{var b=i.owner.getAttribute("lCustomization");b&&b.length>0?(i.owner.getAttribute("bRadiusDisplay")?u[0]=mt(s):u[0]=vt(2*s),void 0!==p&&void 0!==a&&void 0!==h&&void 0!==p.getSelPoint()&&void 0!==a.getSelPoint()&&void 0!==h.getSelPoint()&&(b[0].custoValue&&u.push(V.firstpoint+" "+pt(p.getSelPoint())),b[1].custoValue&&u.push(V.secondpoint+" "+pt(a.getSelPoint())),b[2].custoValue&&u.push(V.thirdpoint+" "+pt(h.getSelPoint()))),b[3].custoValue&&u.push(V.center+" "+pt(i.owner.getAttribute("vCenter"))),b[4].custoValue&&u.push(c.mode)):(u[0]=mt(s)+"  "+vt(2*s),u[1]=V.center+" "+pt(i.owner.getAttribute("vCenter")),u[2]=V.normal+" "+pt(i.owner.getAttribute("vNormal")),u[3]=V.circle,u[4]=c.mode)}}return u}function _t(e,n,r,o,a){var s=[],u={},c=i.owner.getMeasurable(1),p=i.owner.getMeasurable(2),d=i.owner.getMeasurable(3);return u.exact=c.getMode()===l.Mode.EXACT,u.mode=u.exact?V.exactMode:V.approximateMode,Te=!1,e&&!0===i.owner.getAttribute("bDisplayApproximateSymbol")&&(Te=!0),De=!1,i.owner.getAttribute("bDisplayMeasureType")||(De=!0),"MeasureBetween"===n||"Measure3PointsAngle"===n||"MeasureThickness"===n?s=function(e,t,n,r,o,a,s,u,c){var p=[];c.exact=o.getMode()===l.Mode.EXACT&&a.getMode()===l.Mode.EXACT,c.mode=c.exact?V.exactMode:V.approximateMode;var d=ht(n,!0);if(e)p[0]="2D"===u?d:De?d:V.angle+" "+d;else{var g=i.owner.getAttribute("lCustomization");if(p[0]=V.angle+" "+d,r&&"MeasureBetween"===t||"MeasureThickness"===t)Ve=ft(i.owner.getAttribute("sResultingType1"),i.owner.getAttribute("oProduct1Name")),Ne=ft(i.owner.getAttribute("sResultingType2"),i.owner.getAttribute("oProduct2Name")),g&&g.length>0?(g[0].custoValue&&p.push(V.center+" "+pt(i.owner.getAttribute("vAngleArcCenter").clone())),g[1].custoValue&&p.push("2D"!==u&&Ve.length>50?Ve.substring(0,50)+"...":Ve),g[2].custoValue&&p.push("2D"!==u&&Ne.length>50?Ne.substring(0,50)+"...":Ne),g[3].custoValue&&p.push(c.mode),"2D"!==u&&Ve&&(Le=1,Ee=2,Ne&&(Ee=3))):("2D"===u?p[1]=Ve+" - "+Ne:Ve&&(Le=1,Ee=2,p[1]=Ve.length>50?Ve.substring(0,50)+"...":Ve,Ne&&(p[2]=Ne.length>50?Ne.substring(0,50)+"...":Ne,Ee=3)),p.push(c.mode));else if("Measure3PointsAngle"===t)if(g&&g.length>0)void 0!==o&&void 0!==a&&void 0!==s&&void 0!==o.getSelPoint()&&void 0!==a.getSelPoint()&&void 0!==s.getSelPoint()&&(g[0].custoValue&&p.push(V.firstpoint+" "+pt(o.getSelPoint())),g[1].custoValue&&p.push(V.secondpoint+" "+pt(s.getSelPoint())),g[2].custoValue&&p.push(V.center+" "+pt(a.getSelPoint()))),g[3].custoValue&&p.push(c.mode);else{void 0!==o&&void 0!==a&&void 0!==s&&(c.exact=o.getMode()===l.Mode.EXACT&&a.getMode()===l.Mode.EXACT&&s.getMode()===l.Mode.EXACT);var h=i.owner.getAttribute("fProjectedAngleXY"),b=i.owner.getAttribute("fProjectedAngleYZ"),y=i.owner.getAttribute("fProjectedAngleZX");if(void 0!==h&&void 0!==b&&void 0!==y){var m=ht(h,!0),v=ht(b,!0),P=ht(y,!0);p.push(V.projectedAngle+" "+V.xy+": "+m+" "+V.yz+": "+v+" "+V.zx+": "+P),void 0!==o&&void 0!==a&&void 0!==s&&void 0!==o.getSelPoint()&&void 0!==a.getSelPoint()&&void 0!==s.getSelPoint()&&(p.push(V.firstpoint+" "+pt(o.getSelPoint())),p.push(V.secondpoint+" "+pt(a.getSelPoint())),p.push(V.thirdpoint+" "+pt(s.getSelPoint())))}p.push(c.mode)}}return p}(e,n,r,o,c,p,d,a,u):"MeasureItem"===n&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE?s=Mt(e,r,c,u):i.owner.isReadOnly()&&"MeasureItem"===n&&i.owner.getAttribute("sResultingType1")===t.ResultType.CIRCLE&&(e?s[0]=ht(r):(s[0]=ht(r),s[1]=V.circle+" "+V.inLabel+" "+i.owner.getAttribute("oProduct1Name"),s[2]=u.mode)),s}function Ct(e,t,i,n,o,a){if(t&&i){var s=i.clone(),l=a.leaderStyle&&void 0!==a.leaderStyle.thickness?a.leaderStyle.thickness:a.lineStyle.thickness,u={arrowWidth:l,headLength:Math.max(2*l+4,10),viewpoint:Ae.currentViewpoint,initialPoint:s.clone(),finalPoint:t.clone(),color:a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,arrowScale:2,head:1},c=w.getDistanceFromPixel(Ae,t,5),p=n.clone().normalize().multiplyScalar(c);if(s=t.clone().add(p),u.initialPoint=s.clone(),!r.areEqual(u.initialPoint,u.finalPoint,"Vector3")){var d=e.getChildByName("arrow1Node");d?(d.updateInitialPosition(u.initialPoint),d.updateFinalPosition(u.finalPoint),d.updateColor(u.color),d.setArrowWidth(u.arrowWidth),d.setHeadSize(u.headLength),d.setHeadType(u.head)):((d=new v(u)).name="arrow1Node",e.add(d))}var g=o.clone().normalize().multiplyScalar(c);if(s=i.clone().sub(g),u.initialPoint=s,u.finalPoint=i,!r.areEqual(u.initialPoint,u.finalPoint,"Vector3")){var h=e.getChildByName("arrow2Node");h?(h.updateInitialPosition(u.initialPoint),h.updateFinalPosition(u.finalPoint),h.updateColor(u.color),h.setArrowWidth(u.arrowWidth),h.setHeadSize(u.headLength),h.setHeadType(u.head)):((h=new v(u)).name="arrow2Node",e.add(h))}}}function Rt(e,t,i,n,o,a,s,l,u,c,p){if(t&&i){var d=4,g=!1,h="MeasureThickness"===je,b=t.clone().add(i).multiplyScalar(.5),y=a?b.clone():i.clone(),m=s.leaderStyle&&void 0!==s.leaderStyle.thickness?s.leaderStyle.thickness:s.lineStyle.thickness;void 0===l||!0!==l&&!h||(d=Math.max(2*m+4,10),g=!0);var P={arrowWidth:m,headLength:d,viewpoint:Ae.currentViewpoint,initialPoint:y.clone(),finalPoint:t.clone(),color:s.leaderStyle&&s.leaderStyle.color?s.leaderStyle.color:s.lineStyle.color,head:0};if(!r.areEqual(P.initialPoint,P.finalPoint,"Vector3")){var A=e.getChildByName("lineNode");A?(A.updateInitialPosition(P.initialPoint),A.updateFinalPosition(P.finalPoint),A.updateColor(P.color),A.setArrowWidth(P.arrowWidth),A.setHeadSize(P.headLength),A.setHeadType(P.head)):((A=new v(P)).name="lineNode",e.add(A))}var f,S=t.clone().sub(i),M=S.length(),D=M<d,T=D?1:d/M;if(h)T=-T;else if(!0!==g){if(void 0!==n){var _=n.clone().sub(t),C=i.clone().sub(t),R=n.clone().sub(i),x=t.clone().sub(i);f=!o||_.clone().dot(C.clone())>0&&R.clone().dot(x.clone())>0}!1===u||f&&!D||(T=-T)}if(void 0===c||!0===c){if(P.head=1,S.multiplyScalar(T),h){var L=25*m;L=w.getDistanceFromPixel(Ae,t.clone(),L),S.normalize().multiplyScalar(L)}if(P.initialPoint=t.clone().sub(S),!r.areEqual(P.initialPoint,P.finalPoint,"Vector3")){var E=e.getChildByName("dimArrow1Node");E?(E.updateInitialPosition(P.initialPoint),E.updateFinalPosition(P.finalPoint),E.updateColor(P.color),E.setArrowWidth(P.arrowWidth),E.setHeadSize(P.headLength),E.setHeadType(P.head)):((E=new v(P)).name="dimArrow1Node",e.add(E))}if(!p&&(P.initialPoint=y.clone().add(S),P.finalPoint=y,!r.areEqual(P.initialPoint,P.finalPoint,"Vector3"))){var V=e.getChildByName("dimArrow2Node");V?(V.updateInitialPosition(P.initialPoint),V.updateFinalPosition(P.finalPoint),V.updateColor(P.color),V.setArrowWidth(P.arrowWidth),V.setHeadSize(P.headLength),V.setHeadType(P.head)):((V=new v(P)).name="dimArrow2Node",e.add(V))}}}}function xt(e,t,i,n,o,a){var s=new h;if(e&&t&&i&&n){var l=t.clone(),u=n.clone();o&&(l.add(e).multiplyScalar(.5),u.add(i).multiplyScalar(.5));var c={arrowWidth:a.leaderStyle&&void 0!==a.leaderStyle.thickness?a.leaderStyle.thickness:a.lineStyle.thickness,viewpoint:Ae.currentViewpoint,initialPoint:i.clone(),finalPoint:e.clone(),color:a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,head:0};r.areEqual(c.initialPoint,c.finalPoint,"Vector3")||st(s,new v(c)),c.initialPoint=u,c.finalPoint=l,r.areEqual(c.initialPoint,c.finalPoint,"Vector3")||st(s,new v(c))}return s}function Lt(e,t,i){var n=new P({position:e.clone(),name:"anchor1",type:"Spherical"});n.setMatrix((new d.Matrix4).setPosition(e.clone()));var r=g.createCircleNode({radius:4,segments:8,fill:!1,color:t});r.setShadow(!1);var o=new A({name:"myFixedSizeNode",ratio:1});st(o,r),st(n,o);var a=g.createCircleNode({radius:4,segments:8,fill:!0,color:i});a.setShadow(!1);var s=new A({name:"myFixedSizeNode",ratio:1});return st(s,a),st(n,s),n}function Et(e,t,i){var n,r=t.getPoints(),o=a.computePointSegmentDistance(i.toArray(),r.beginPoint.toArray(),r.endPoint.toArray());0===o.returnCode&&o.relationship!==l.Relationship.COINCIDENT&&(n=new d.Vector3(o.aPosition[0],o.aPosition[1],o.aPosition[2])),n&&(s.areEqual(n.toArray(),i.toArray())?n=void 0:st(e,u.createLineNode(n,i,xe.regularDashedLine)))}function Vt(e,n,r,o,a){if(null!==n&&e.remove(n),r){var s,l,c,p,d,b,y,m,v;switch(o){case t.ResultType.LINE:break;case t.ResultType.AXIS:l=(s=r.getPoints()).beginPoint.clone().sub(s.endPoint),c=30,p=w.getDistanceFromPixel(Ae,s.beginPoint,c),l.normalize().multiplyScalar(p),m=s.beginPoint.clone().add(l),v=s.endPoint.clone().sub(l),n=u.createLineNode(m,v,a);break;case t.ResultType.CIRCLE:n=new h;var P=r.getRadius();"2D"===i.owner.getAttribute("sMeasureOnGeometryType")&&r.get2DScale&&(P=r.get2DScale()*P),y=r.getCenter();var A=!1;if(!0===i.owner.getAttribute("bArcLengthDisplay"))A=!1;else if(0===i.owner.getAttribute("iRadiusResultDisplayType"))st(n,u.createCircleNode(P,y,r.getAxis(),a));else{!1===i.owner.getAttribute("bRadiusDisplay")?st(n,u.createCircleNode(P,y,r.getAxis(),a)):A=!0,xe.crossPoint.force=!0,st(n,g.createPointsNode({positions:y.clone().toArray(),material:xe.crossPoint}))}if(A){s=r.getPoints();var f=r.getArcMidPoint();d=f.clone().sub(s.beginPoint),b=f.clone().sub(s.endPoint);var S=s.beginPoint,M=s.endPoint;b.length()<d.length()&&(S=s.endPoint,M=s.beginPoint);var D=y.clone().sub(S),T=y.clone().sub(M),_=y.clone().sub(f);_.normalize().negate().multiplyScalar(P);var C=u.createArcNode(P,y,D,_,xe.regularSolidLine),R=u.createArcNode(P,y,_,T,xe.regularSolidLine);st(n,C),st(n,R)}break;case t.ResultType.CYLINDER:n=new h,s=r.getPoints();var x=i.owner.getAttribute("vFirstExtensionPoint3D");void 0===Ce&&(x=r.getSelPoint().clone()),d=x.clone().sub(s.beginPoint),b=x.clone().sub(s.endPoint),y=s.beginPoint,b.length()<d.length()&&(y=s.endPoint);var L=s.endPoint.clone().sub(s.beginPoint);st(n,u.createCircleNode(r.getRadius(),y,L,a)),l=s.beginPoint.clone().sub(s.endPoint),c=30,p=w.getDistanceFromPixel(Ae,y,c),l.normalize().multiplyScalar(p),m=s.beginPoint.clone().add(l),v=s.endPoint.clone().sub(l),st(n,u.createLineNode(m,v,xe.dotDashedLine));break;case t.ResultType.CONE:n=new h;var E,V=(s=r.getPoints()).endPoint,N=r.getApex(),k=r.getSemiAngle(),I=r.getAxis(),F=N.clone(),O=i.owner.getAttribute("sSurfaceDisplayType"),B=r.vSlat.clone(),U=N.clone().sub(V).length()*Math.tan(k),z=u.createCircleNode(U,V,I,a);if(st(n,z),m=r.vExtensionPoint1,v=r.vExtensionPoint2,m&&v||(l=s.beginPoint.clone().sub(s.endPoint),c=30,p=w.getDistanceFromPixel(Ae,s.beginPoint,c),l.normalize().multiplyScalar(p),r.vExtensionPoint1=s.beginPoint.clone().add(l),r.vExtensionPoint2=s.endPoint.clone().sub(l),m=r.vExtensionPoint1.clone(),v=r.vExtensionPoint2.clone()),st(n,u.createLineNode(m,v,xe.dotDashedLine)),"Angle"===O)st(n,u.createLineNode(i.owner.getAttribute("vSecondExtensionPoint3D"),F,xe.regularSolidLine));else if("MinimumRadius"===O||"MinimumDiameter"===O){var G=N.clone().sub(s.beginPoint),H=N.clone().sub(s.endPoint),J=s.beginPoint.clone();G.length()>H.length()&&(J=s.endPoint.clone()),U=N.clone().sub(J).length()*Math.tan(k),st(n,z=u.createCircleNode(U,J,I,a)),E=r.getMaxRadius()/Math.sin(k),B=B.normalize().multiplyScalar(E),F=N.clone().add(B)}else"MaximumRadius"!==O&&"MaximumDiameter"!==O||(E=r.getMinRadius()/Math.sin(k),B=B.normalize().multiplyScalar(E),F=N.clone().add(B));st(n,u.createLineNode(i.owner.getAttribute("vFirstExtensionPoint3D"),F,xe.regularSolidLine));break;case t.ResultType.SPHERE:n=new h,void 0===r.normal&&i.owner._buildConstructionPointsForConeCylSphere(),st(n,u.createCircleNode(r.getRadius(),r.getCenter(),r.normal,a))}n&&st(e,n)}}function Nt(e,i,n,r,o){var c;if(Vt(e,i,n,r,r===t.ResultType.AXIS||r===t.ResultType.CIRCLE?xe.avatarDashedLine:xe.avatarSolidLine),r===t.ResultType.AXIS||r===t.ResultType.LINE){var p=n.getPoints(),g=a.computePointSegmentDistance(o.toArray(),p.beginPoint.toArray(),p.endPoint.toArray());0===g.returnCode&&g.relationship!==l.Relationship.COINCIDENT&&(c=new d.Vector3(g.aPosition[0],g.aPosition[1],g.aPosition[2]))}else c=n.getSelPoint();c&&(s.areEqual(c.toArray(),o.toArray())?c=void 0:st(e,u.createLineNode(c,o,xe.regularDashedLine)))}function kt(){var e=!1;if("MeasureBetween"===je&&"Angle"!==i.owner.getAttribute("sDistanceType")||"MeasureThickness"===je){var n=i.owner.getAttribute("fDistance");e=void 0!==n&&!r.isZero(n)}else if("MeasureItem"===je){var o=i.owner.getAttribute("sResultingType1");e="Length"===i.owner.getAttribute("sSurfaceDisplayType")&&(o===t.ResultType.CONE||o===t.ResultType.CYLINDER)||(o===t.ResultType.LINE||o===t.ResultType.CIRCLE)}else"Measure3PointsCircle"===je&&(e=!0);return e}function It(){if(kt()&&(Ge.manipulator&&Ge.manipulator.activate(Ge.token),He.manipulator&&He.manipulator.activate(He.token)),Fe){var e=et.getRepManipulator();e&&e.activate()}Oe.manipulator&&Oe.manipulator.activate(Oe.token),Be.manipulator&&Be.manipulator.activate(Be.token)}function Ft(){if(kt()&&(Ge.manipulator&&Ge.manipulator.deactivate(Ge.token),He.manipulator&&He.manipulator.deactivate(He.token)),Fe){var e=et.getRepManipulator();e&&e.deactivate()}Oe.manipulator&&Oe.manipulator.deactivate(Oe.token),Be.manipulator&&Be.manipulator.deactivate(Be.token)}function Ot(){kt()&&(Ge.manipulator&&(Ge.manipulator.axis=i.owner.getAttribute("vExtensionDirection3D").clone()),Fe.manipulator&&(Fe.manipulator.axis=i.owner.getAttribute("vSecondPoint3D").clone().sub(i.owner.getAttribute("vFirstPoint3D"))),Oe.manipulator&&Ze&&(Oe.manipulator.axis=i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2"))),Be.manipulator&&Ze&&(Be.manipulator.axis=i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2"))))}function Bt(e){if(!i.owner.isReadOnly()&&i.owner.isEditable()){var n,r,o=kt();(e||void 0!==Qe&&o!==Qe)&&(Ge.manipulator&&(Ge.manipulator.unlink(Ge.token),Ge.manipulator=null,Ge.token=null),He.manipulator&&(He.manipulator.unlink(He.token),He.manipulator=null,He.token=null),Oe.manipulator&&(Oe.manipulator.unlink(Oe.token),Oe.manipulator=null,Oe.token=null),Be.manipulator&&(Be.manipulator.unlink(Be.token),Be.manipulator=null,Be.token=null),kt()&&(Ge.manipulator=new y({axis:i.owner.getAttribute("vExtensionDirection3D").clone()}),Ge.manipulator.setExclusive(!0),Ge.token=Ge.manipulator.linkToNode(Ge),Ge.manipulator.subscribe("BeginManipulate",function(){lt(),$e||(n=i.owner.getAttribute("vFirstPoint3D").clone(),r=i.owner.getAttribute("vSecondPoint3D").clone())}),Ge.manipulator.subscribe("Manipulate",function(e){if(!$e){i.owner.setAttribute("vFirstPoint3D",n.clone().add(e.translationVector)),i.owner.setAttribute("vSecondPoint3D",r.clone().add(e.translationVector));var t=i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(i.owner.getAttribute("vLeaderBreakPoint3D"));i.owner.setAttribute("vLeaderPointingPoint3D",i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5)),i.owner.setAttribute("vLeaderBreakPoint3D",i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(t)),Ot(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}),Ge.manipulator.subscribe("EndManipulate",ut),"2D"!==i.owner.getAttribute("sMeasureOnGeometryType")&&0!==Ce&&function(){var e,t,n,r=i.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D"));He.manipulator=new m({axis:r}),He.manipulator.setExclusive(!0),He.manipulator.setCenter(i.owner.getAttribute("vFirstExtensionPoint3D").clone()),He.token=He.manipulator.linkToNode(He),He.manipulator.subscribe("BeginManipulate",function(){lt(),$e||(e=i.owner.getAttribute("vFirstPoint3D").clone(),t=i.owner.getAttribute("vSecondPoint3D").clone(),n=new d.Matrix4)}),He.manipulator.subscribe("Manipulate",function(r){if(!$e){var o=(new d.Matrix4).copy(n),a=(new d.Matrix4).makeRotationAxis(r.axis,r.angle),s=(new d.Matrix4).setPosition(r.center),l=(new d.Matrix4).getInverse(s).multiply(o),u=(new d.Matrix4).copy(a).multiply(l),c=(new d.Matrix4).copy(s).multiply(u);i.owner.setAttribute("vFirstPoint3D",e.clone().applyMatrix4(c)),i.owner.setAttribute("vSecondPoint3D",t.clone().applyMatrix4(c)),i.owner.setAttribute("vExtensionDirection3D",i.owner.getAttribute("vFirstPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D")));var p=i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(i.owner.getAttribute("vLeaderBreakPoint3D"));i.owner.setAttribute("vLeaderPointingPoint3D",i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5)),i.owner.setAttribute("vLeaderBreakPoint3D",i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(p)),Ot(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}),He.manipulator.subscribe("EndManipulate",ut)}()),function(){var e,n,r=Ze?i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2")):new d.Vector3;Oe.manipulator=new b({axis:r}),Oe.manipulator.setExclusive(!0),Oe.token=Oe.manipulator.linkToNode(Oe.getBackNode());var o=Oe.manipulator;o.subscribe("BeginManipulate",function(){lt(),$e||(n=i.frmWindow.getViewerFrame().style.cursor,i.frmWindow.getViewerFrame().setStyle("cursor","move"),e=i.owner.getAttribute("vAngleBreakPoint").clone())}),o.subscribe("Manipulate",function(n){if(!$e){var r,o,a,s=e.clone().add(n.translationVector),l=s.clone().sub(i.owner.getAttribute("vAngleArcCenter")),u=i.owner.getAttribute("vAngleVector1"),c=i.owner.getAttribute("vAngleVector2"),p=u.clone().cross(c),d=p.clone().cross(u).dot(l),g=p.clone().cross(c).dot(l),h=i.owner.getAttribute("fQuadrant"),b=i.owner.getAttribute("bComplementaryAngle"),y=0,m=0;if(0>d&&(y+=2),0<g&&(y+=1),null==b)(!(r="MeasureItem"===je&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE)||r&&0===y)&&(i.owner.setAttribute("fQuadrant",y),i.owner.setAttribute("vAngleBreakPoint",s),i.owner.setAttribute("vAnglePointingPoint",s),o=u.clone(),1!==y&&3!==y||o.negate(),a=c.clone(),2!==y&&3!==y||a.negate(),r||i.owner.setAttribute("fAngle",o.angleTo(a)));else{var v=!1;if(et.bExtendAngleArc=!1,h===y||b)h===y&&b&&(et.bExtendAngleArc=!0);else switch(h){case 0:3===y?v=!0:(et.bExtendAngleArc=!0,m=3);break;case 1:2===y?v=!0:(et.bExtendAngleArc=!0,m=2);break;case 2:1===y?v=!0:(et.bExtendAngleArc=!0,m=1);break;case 3:0===y?v=!0:(et.bExtendAngleArc=!0,m=0)}if((!(r="MeasureItem"===je&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE)||r&&0===y)&&(v&&i.owner.setAttribute("fQuadrant",y),i.owner.setAttribute("vAngleBreakPoint",s),i.owner.setAttribute("vAnglePointingPoint",s),o=u.clone(),1!==h&&3!==h||o.negate(),a=c.clone(),2!==h&&3!==h||a.negate(),et.bExtendAngleArc&&h!==m&&!b)){var P=l.angleTo(o),A=l.angleTo(a),f=o.angleTo(a),w=Math.abs(Math.PI-f)/2;P>w&&A>w&&i.owner.setAttribute("fQuadrant",m)}}Ot(),i.owner.refreshAssistantTool&&i.owner.refreshAssistantTool({mousePosition:null},!1),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}),o.subscribe("EndManipulate",function(e){$e||i.frmWindow.getViewerFrame().setStyle("cursor",n),ut(e)})}(),function(){var e,n,r,o,a,s=Ze?i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2")):new d.Vector3;Be.manipulator=new b({axis:s}),Be.manipulator.setExclusive(!0),Be.token=Be.manipulator.linkToNode(Be);var l=Be.manipulator;l.subscribe("BeginManipulate",function(t){lt(),$e||(r=i.frmWindow.getViewerFrame().style.cursor,i.frmWindow.getViewerFrame().setStyle("cursor","move"),n=t.intersection.position.clone(),e=i.owner.getAttribute("vAngleBreakPoint").clone(),o=i.owner.getAttribute("fQuadrant"))}),l.subscribe("Manipulate",function(r){if(!$e){var s,l,u,c=n.clone().add(r.translationVector),p=i.owner.getAttribute("vAngleArcCenter"),d=c.distanceTo(p),g=c.clone().sub(p),h=e.clone().sub(p);h.normalize().multiplyScalar(d);var b,y=i.owner.getAttribute("vAngleVector1"),m=i.owner.getAttribute("vAngleVector2"),v=y.clone().cross(m),P=v.clone().cross(y).dot(g),A=v.clone().cross(m).dot(g),f=i.owner.getAttribute("fQuadrant"),w=i.owner.getAttribute("bComplementaryAngle"),S=0,M=0;if(0>P&&(S+=2),0<A&&(S+=1),null==w)(!(s="MeasureItem"===je&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE)||s&&0===S)&&(i.owner.setAttribute("fQuadrant",S),l=y.clone(),1!==S&&3!==S||l.negate(),u=m.clone(),2!==S&&3!==S||u.negate(),s||i.owner.setAttribute("fAngle",l.angleTo(u)),o!==S?(i.owner.setAttribute("vAngleBreakPoint",c),i.owner.setAttribute("vAnglePointingPoint",c)):(b=p.clone().add(h),i.owner.setAttribute("vAngleBreakPoint",b),i.owner.setAttribute("vAnglePointingPoint",b)));else{var D=!1;if(a=!1,f===S||w)f===S&&w&&(a=!0);else switch(f){case 0:3===S?D=!0:(a=!0,M=3);break;case 1:2===S?D=!0:(a=!0,M=2);break;case 2:1===S?D=!0:(a=!0,M=1);break;case 3:0===S?D=!0:(a=!0,M=0)}if(!(s="MeasureItem"===je&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE)||s&&0===S){if(D&&i.owner.setAttribute("fQuadrant",S),l=y.clone(),1!==f&&3!==f||l.negate(),u=m.clone(),2!==f&&3!==f||u.negate(),a&&f!==M&&!w){var T=g.angleTo(l),_=g.angleTo(u),C=l.angleTo(u),R=Math.abs(Math.PI-C)/2;T>R&&_>R&&i.owner.setAttribute("fQuadrant",M)}o!==i.owner.getAttribute("fQuadrant")&&h.negate(),b=p.clone().add(h),i.owner.setAttribute("vAngleBreakPoint",b),i.owner.setAttribute("vAnglePointingPoint",b)}}Ot(),i.owner.refreshAssistantTool&&i.owner.refreshAssistantTool({mousePosition:null},!1),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}),l.subscribe("EndManipulate",function(e){$e||i.frmWindow.getViewerFrame().setStyle("cursor",r),ut(e)})}(),Qe=o)}}function Ut(e,t){var n,r=!1,a=!0;switch(t){case"bool":r=void 0===(n=i.owner.getAttribute("b"+e))||void 0!==tt[e]&&n===tt[e];break;case"int":r=void 0===(n=i.owner.getAttribute("i"+e))||void 0!==tt[e]&&n===tt[e];break;case"float":r=void 0===(n=i.owner.getAttribute("f"+e))||void 0!==tt[e]&&n===tt[e];break;case"string":void 0===(n=i.owner.getAttribute("s"+e))&&tt[e]&&(n=tt[e]),r=void 0===n||void 0!==tt[e]&&n===tt[e];break;case"Color":r=void 0===(n=i.owner.getAttribute("c"+e))||void 0!==tt[e]&&n.equals(tt[e]);break;case"Vector3":null!=(n=i.owner.getAttribute("v"+e))&&(n=n.clone()),r=null==n||void 0!==tt[e]&&n.equals(tt[e]);break;case"AABB":r=void 0===(n=i.owner.getAttribute(e))||void 0!==tt[e]&&o.areEqualAABB(n,tt[e]);break;default:r=!1,a=!1}return!r&a&&(tt[e]=n),r}function zt(e){var t={value:0,scale:1};switch(e){case"None":t.value=0;break;case"Cross":t.value=1;break;case"Plus":t.value=2;break;case"Concentric":t.value=3;break;case"Coincident":t.value=4;break;case"FullCircle":t.value=5;break;case"FullSquare":t.value=6;break;case"Star":t.value=7;break;case"Dot":t.value=8,t.scale=.6;break;case"SmallDot":t.value=9,t.scale=.4}return t}function Gt(){if(Je&&i.owner)if(We||!Ze){Je.setVisibility(!0);var e=ct(),r=1;let p=i.owner.getMeasurable(1);var o=i.owner.getAttribute("vLeaderPointingPoint3D"),a=i.owner.getAttribute("vLeaderBreakPoint3D"),s=!kt();if("MeasureBetween"===je||"MeasureThickness"===je)r=0;else if("Measure3PointsCircle"===je)r=0,i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER&&(o=i.owner.getAttribute("vFirstExtensionPoint3D").clone());else if("MeasureItem"===je){var l=function(e,n,r){var o={vLeaderPointingPoint:n,headType:r};if(void 0!==o.headType&&void 0!==o.vLeaderPointingPoint){var a=i.owner.getAttribute("sSurfaceDisplayType"),s=!0;switch(i.owner.getAttribute("sResultingType1")){case t.ResultType.CYLINDER:case t.ResultType.SPHERE:if(void 0===Ce){var l=i.owner._buildConstructionPointsForConeCylSphere();o.vLeaderPointingPoint=l.oPos1}"Area"===a?o.headType=1:(o.headType=0,s=!1);break;case t.ResultType.LINE:o.headType=0;break;case t.ResultType.CIRCLE:o.headType=0,i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER&&void 0!==e.getSelPoint()&&(o.vLeaderPointingPoint=e.getSelPoint());break;case t.ResultType.PLANE:case t.ResultType.SURFACE:o.headType=2;break;case t.ResultType.POINT:case t.ResultType.CENTER:o.headType=4;break;case t.ResultType.PRODUCT:o.headType=3;break;case t.ResultType.CONE:s=!1,"Length"===a||"MinimumRadius"===a||"MinimumDiameter"===a||"MaximumRadius"===a||"MaximumDiameter"===a?o.headType=0:"Area"===a&&(o.headType=1,s=!0)}if(s){var u=i.owner.getAttribute("sLeaderEndType");if(void 0!==u){switch(u){case"No end":u=0;break;case"Arrow":u=1;break;case"Bubble":u=2;break;case"Square":u=3;break;case"Cross":u=4}o.headType=u}}return o}}(p,o,r);void 0!==l&&void 0!==l.headType&&void 0!==l.vLeaderPointingPoint&&(r=l.headType,o=l.vLeaderPointingPoint)}if(i.owner.getAttribute("sResultingType1")===t.ResultType.CONE&&Je.removeChildren(),i.owner.getAttribute("sTextGraphicRepresentationID")?i.owner.getTesselatedRep(i.owner.getAttribute("sTextGraphicRepresentationID")):i.owner.getAttribute("sTextGraphicRepresentation")){var u=Fe.getDimensions();u.position=a.clone();var c=function(e,t){if(e&&e.position&&e.offsetWidth&&e.offsetHeight){e.position.clone();var i=e,n=w.convertModelToPixels({sizeInMM:i.offsetWidth}),r=w.convertModelToPixels({sizeInMM:i.offsetHeight}),o=w.getViewerPositionFromPoint(Ae,i.position),a=new d.Vector2(Math.round(o.left-n/2),Math.round(o.top-r/2)),s=new d.Vector2(Math.round(o.left+n/2),Math.round(o.top-r/2)),l=new d.Vector2(Math.round(o.left+n/2),Math.round(o.top+r/2)),u=new d.Vector2(Math.round(o.left-n/2),Math.round(o.top+r/2)),c=w.get3DPositionFromScreenCoordinates({coords:a,viewer:Ae}),p=w.get3DPositionFromScreenCoordinates({coords:s,viewer:Ae}),g=w.get3DPositionFromScreenCoordinates({coords:l,viewer:Ae}),h=w.get3DPositionFromScreenCoordinates({coords:u,viewer:Ae}),b=t,y=[];y.push(b.clone().toArray()),y.push(e.position.clone().toArray());var m=[];m.push(c.clone().toArray()),m.push(p.clone().toArray());var v=[];v.push(p.clone().toArray()),v.push(g.clone().toArray());var P=[];P.push(g.clone().toArray()),P.push(h.clone().toArray());var A=[];A.push(h.clone().toArray()),A.push(c.clone().toArray());var f=x._computeTwoCurvesSquaredDistance(1,m,1,y),S=Math.sqrt(f.squaredDistance),M=x._computeTwoCurvesSquaredDistance(1,v,1,y),D=Math.sqrt(M.squaredDistance),T=x._computeTwoCurvesSquaredDistance(1,P,1,y),_=x._computeTwoCurvesSquaredDistance(1,A,1,y),C=Math.sqrt(_.squaredDistance),R=Math.sqrt(T.squaredDistance);return S<C?S<D?S<R?new d.Vector3(f.aPosition1[0],f.aPosition1[1],f.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2]):D<R?new d.Vector3(M.aPosition1[0],M.aPosition1[1],M.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2]):C<D?C<R?new d.Vector3(_.aPosition1[0],_.aPosition1[1],_.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2]):D<R?new d.Vector3(M.aPosition1[0],M.aPosition1[1],M.aPosition1[2]):new d.Vector3(T.aPosition1[0],T.aPosition1[1],T.aPosition1[2])}}(u,o.clone());c&&(a=c),"MeasureItem"===je&&i.owner.getAttribute("sResultingType1")===t.ResultType.POINT&&(r=1),s=!1}n.modifyLeaderNode(Ae,Je,s,a,o,void 0,e.leaderStyle&&void 0!==e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness,e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:e.lineStyle.color,null,r,Object.assign(Fe.getDimensions(),{rotationAngle:i.owner.getAttribute("fBoxRotationAngle")}),i.frmWindow)}else Je.removeChildren()}function Ht(e,n,o,s){var c,p=i.owner.getAttribute("vAngleArcCenter"),g=i.owner.getAttribute("vAnglePointingPoint"),h=i.owner.getAttribute("vAngleBreakPoint"),b=i.owner.getAttribute("vAngleVector1"),y=i.owner.getAttribute("vAngleVector2");if("MeasureItem"===je&&n===t.ResultType.CONE&&null==g&&(i.owner._buildConstructionPointsForConeCylSphere(),p=e.getApex().clone(),g=e.arcCenter.clone(),b=e.vAxis.clone(),y=e.vSlat.clone()),p&&g&&b&&y){var m=b.clone(),v=i.owner.getAttribute("fAngle"),P=!1;if(v)(r.isZero(v)?0:180*v/Math.PI)>180&&(P=!0);var A=i.owner.getAttribute("fQuadrant");"MeasureItem"===je&&n===t.ResultType.CONE&&null==A&&(A=0),1!==A&&3!==A||m.negate();var f=y.clone();2!==A&&3!==A||f.negate(),c=g.clone().sub(p).length();var S=p.clone().add(m.clone().normalize().multiplyScalar(c)),M=p.clone().add(f.clone().normalize().multiplyScalar(c)),D=(new d.Vector3).crossVectors(m.clone(),f.clone()),T=(new d.Vector3).crossVectors(D.clone().normalize(),m.clone()),_=(new d.Vector3).crossVectors(D.clone().normalize(),f.clone());if(P&&(T.negate(),_.negate()),function(e,t,n,r,o,a,s,l,c,p,d,g){if(Ze){var h=a.clone(),b=o.clone();if(et.bExtendAngleArc&&((h=e.clone().sub(r)).normalize().multiplyScalar(n),l.distanceTo(e)<c.distanceTo(e)&&(b=a.clone())),Be.removeChildren(),st(Be,u.createArcNode(n,r,b,h,xe.regularSolidLine,s)),Ct(Ge,l,c,p,d,g),void 0!==e&&void 0!==t&&!t.equals(e)){var y=u.createLineNode(t,e,xe.regularSolidLine);st(He,y)}var m=i.owner.getAttribute("bComplementaryAngle");null==m&&"2D"===i.owner.getAttribute("sMeasureOnGeometryType")&&"MeasureBetween"===je&&(Et(He,i.owner.getMeasurable(1),r),Et(He,i.owner.getMeasurable(2),r))}}(h,g,c,p,m,f,P,S,M,T,_,s),"MeasureItem"===je&&n===t.ResultType.CONE)!function(e,t,n,r,o){var a,s,l,c,p,g=e.vExtensionPoint1,h=e.vExtensionPoint2;g&&h||(s=(a=e.getPoints()).beginPoint.clone().sub(a.endPoint),l=w.getDistanceFromPixel(Ae,a.beginPoint,30),s.normalize().multiplyScalar(l),e.vExtensionPoint1=a.beginPoint.clone().add(s),e.vExtensionPoint2=a.endPoint.clone().sub(s),g=e.vExtensionPoint1.clone(),h=e.vExtensionPoint2.clone());var b=[];b.push(g.clone().toArray()),b.push(h.clone().toArray());var y=x._computePointCurveSquaredDistance(n.clone().toArray(),1,b),m=Math.sqrt(y.squaredDistance);c=new d.Vector3(y.aPosition1[0],y.aPosition1[1],y.aPosition1[2]),p=new d.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]),t=m>it?p:c;var v=i.owner.getAttribute("sSurfaceDisplayType");if(st(He,"Angle"===v?u.createLineNode(r,n,xe.regularSolidLine):u.createLineNode(t,n,xe.regularSolidLine)),"MinimumRadius"!==v&&"MinimumDiameter"!==v&&"MaximumRadius"!==v&&"MaximumDiameter"!==v){st(He,u.createLineNode(r,o,xe.regularSolidLine));var P=e.getApex();y=x._computePointCurveSquaredDistance(P.clone().toArray(),1,b),(m=Math.sqrt(y.squaredDistance))>it&&(p=new d.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]),st(He,u.createLineNode(P,p,xe.regularSolidLine)))}}(e,void 0,S,p,M);else if(n===t.ResultType.AXIS||o===t.ResultType.AXIS)!function(e,n,r,o,a,s,l){var c,p,g,h,b=[];if(n===t.ResultType.AXIS){void 0!==e.vExtensionPoint1&&void 0!==e.vExtensionPoint2||(p=(c=e.getPoints()).beginPoint.clone().sub(c.endPoint),g=30,h=w.getDistanceFromPixel(Ae,c.beginPoint,g),p.normalize().multiplyScalar(h),e.vExtensionPoint1=c.beginPoint.clone().add(p),e.vExtensionPoint2=c.endPoint.clone().sub(p)),b.push(e.vExtensionPoint1.clone().toArray()),b.push(e.vExtensionPoint2.clone().toArray());var y=x._computePointCurveSquaredDistance(s.clone().toArray(),1,b);Math.sqrt(y.squaredDistance)>it?st(He,u.createLineNode(s,a,xe.regularSolidLine)):(0===Ce&&(y=x._computePointCurveSquaredDistance(a.clone().toArray(),1,b),o=Math.sqrt(y.squaredDistance)>it?new d.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]):a),st(He,u.createLineNode(o,a,xe.regularSolidLine)))}else st(He,u.createLineNode(s,a,xe.regularSolidLine));if(r===t.ResultType.AXIS){var m=i.owner.getMeasurable(2);void 0!==m.vExtensionPoint1&&void 0!==m.vExtensionPoint2||(p=(c=m.getPoints()).beginPoint.clone().sub(c.endPoint),g=30,h=w.getDistanceFromPixel(Ae,c.beginPoint,g),p.normalize().multiplyScalar(h),m.vExtensionPoint1=c.beginPoint.clone().add(p),m.vExtensionPoint2=c.endPoint.clone().sub(p));var v=[];v.push(m.vExtensionPoint1.clone().toArray()),v.push(m.vExtensionPoint2.clone().toArray());var P,A=x._computePointCurveSquaredDistance(s.clone().toArray(),1,v);Math.sqrt(A.squaredDistance)>it?st(He,u.createLineNode(s,l,xe.regularSolidLine)):(0===Ce&&(A=x._computePointCurveSquaredDistance(l.clone().toArray(),1,v),P=Math.sqrt(A.squaredDistance)>it?new d.Vector3(A.aPosition2[0],A.aPosition2[1],A.aPosition2[2]):l),st(He,u.createLineNode(P,l,xe.regularSolidLine)))}else st(He,u.createLineNode(s,l,xe.regularSolidLine))}(e,n,o,void 0,S,p,M);else if(Ze){var C,R=i.owner.getMeasurable(2),E=p,V=p,N=i.owner.getAttribute("lFirstExtensionPoints");N&&0===(C=a.computePointSegmentDistance(S.toArray(),N[0].toArray(),N[1].toArray())).returnCode&&(E=new d.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2])),i.owner.isReadOnly()&&c<m.length()&&(S=p.clone().add(m.clone().normalize().multiplyScalar(m.length()))),st(He,u.createLineNode(E,S,xe.regularSolidLine));var k=i.owner.getAttribute("lbExtensionRequired");if(k&&2===k.length&&k[0])if(e.getType()===l.GeometryType.PLANE)st(He,u.createLineNode(E,e.getSelPoint(),xe.regularDashedLine));else{var I=e.getPoints().beginPoint;0===(C=L.computePointLineDistance(E.toArray(),I.toArray(),b.toArray())).returnCode&&(I=new d.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2])),st(He,u.createLineNode(E,I,xe.regularDashedLine))}(N=i.owner.getAttribute("lSecondExtensionPoints"))&&0===(C=a.computePointSegmentDistance(M.toArray(),N[0].toArray(),N[1].toArray())).returnCode&&(V=new d.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2])),i.owner.isReadOnly()&&c<f.length()&&(M=p.clone().add(f.clone().normalize().multiplyScalar(f.length()))),st(He,u.createLineNode(V,M,xe.regularSolidLine)),k&&2===k.length&&k[1]&&R.getType()===l.GeometryType.PLANE&&st(He,u.createLineNode(V,R.getSelPoint(),xe.regularDashedLine))}}}function Jt(e,t){return e&&t&&(t===l.GeometryType.LINE||t===l.GeometryType.CYLINDER||t===l.GeometryType.CONE)}function qt(e,n,r,o,a){var s=a;if(n===t.ResultType.AXIS&&r===t.ResultType.AXIS&&void 0!==o&&o<it&&i.owner.getAttribute("fDistance")){var l=i.owner.getAttribute("vExtensionDirection3D"),u=e.getPoints(),c=l.angleTo(u.beginPoint.clone().sub(u.endPoint));(c<it||Math.abs(c-Math.PI)<it)&&(s=!0)}return s}function Xt(e,n,o){var a,s,l,c,p,g,b,y,m=i.owner.getMeasurable(2),v=o.getType(),P=m.getType(),A="Distance"===i.owner.getAttribute("sDistanceType"),f=Jt(A,v),S=Jt(A,P),M=i.owner.getAttribute("vFirstPoint3D"),D=i.owner.getAttribute("vSecondPoint3D"),T=i.owner.getAttribute("vFirstExtensionPoint3D"),_=i.owner.getAttribute("vSecondExtensionPoint3D"),C=i.owner.isReadOnly()?i.owner.getAttribute("lFirstExtensionPoints"):void 0,R=i.owner.isReadOnly()?i.owner.getAttribute("lSecondExtensionPoints"):void 0,L=!1;if(L=qt(o,e,n,i.owner.getAttribute("fAngle"),L),qt(L),e===t.ResultType.AXIS||f){void 0!==o.vExtensionPoint1&&void 0!==o.vExtensionPoint2||(s=o.getPoints(),o.vExtensionPoint1=s.beginPoint.clone(),o.vExtensionPoint2=s.endPoint.clone(),e===t.ResultType.AXIS&&(l=s.beginPoint.clone().sub(s.endPoint),c=30,p=w.getDistanceFromPixel(Ae,s.beginPoint,c),l.normalize().multiplyScalar(p),o.vExtensionPoint1=s.beginPoint.clone().add(l),o.vExtensionPoint2=s.endPoint.clone().sub(l)));var E=[];E.push(o.vExtensionPoint1.clone().toArray()),E.push(o.vExtensionPoint2.clone().toArray());var V=x._computePointCurveSquaredDistance(T.clone().toArray(),1,E),N=Math.sqrt(V.squaredDistance);g=new d.Vector3(V.aPosition1[0],V.aPosition1[1],V.aPosition1[2]),b=new d.Vector3(V.aPosition2[0],V.aPosition2[1],V.aPosition2[2]),N>it?e!==t.ResultType.AXIS?(a=u.createLineNode(g.clone(),b.clone(),xe.regularDashedLine),st(He,a)):(L||(a=u.createLineNode(g.clone(),b.clone(),xe.dotLine),st(He,a)),(y=[]).push(T.clone().toArray()),L?y=E:r.areEqual(b,o.vExtensionPoint1,"Vector3")?y.push(o.vExtensionPoint2.clone().toArray()):y.push(o.vExtensionPoint1.clone().toArray()),V=x._computePointCurveSquaredDistance(M.clone().toArray(),1,y),T=Math.sqrt(V.squaredDistance)>it?new d.Vector3(V.aPosition2[0],V.aPosition2[1],V.aPosition2[2]):M):e===t.ResultType.AXIS&&0===Ce&&(V=x._computePointCurveSquaredDistance(M.clone().toArray(),1,E),T=Math.sqrt(V.squaredDistance)>it?new d.Vector3(V.aPosition2[0],V.aPosition2[1],V.aPosition2[2]):M)}if(n===t.ResultType.AXIS||S){void 0!==m.vExtensionPoint1&&void 0!==m.vExtensionPoint2||(s=m.getPoints(),m.vExtensionPoint1=s.beginPoint.clone(),m.vExtensionPoint2=s.endPoint.clone(),n===t.ResultType.AXIS&&(l=s.beginPoint.clone().sub(s.endPoint),c=30,p=w.getDistanceFromPixel(Ae,s.beginPoint,c),l.normalize().multiplyScalar(p),m.vExtensionPoint1=s.beginPoint.clone().add(l),m.vExtensionPoint2=s.endPoint.clone().sub(l)));var k=[];k.push(m.vExtensionPoint1.clone().toArray()),k.push(m.vExtensionPoint2.clone().toArray());var I=x._computePointCurveSquaredDistance(_.clone().toArray(),1,k),F=Math.sqrt(I.squaredDistance);g=new d.Vector3(I.aPosition1[0],I.aPosition1[1],I.aPosition1[2]),b=new d.Vector3(I.aPosition2[0],I.aPosition2[1],I.aPosition2[2]),F>it?n!==t.ResultType.AXIS?(a=u.createLineNode(g.clone(),b.clone(),xe.regularDashedLine),st(He,a)):(L||(a=u.createLineNode(g.clone(),b.clone(),xe.dotLine),st(He,a)),(y=[]).push(_.clone().toArray()),L?y=k:r.areEqual(b,m.vExtensionPoint1,"Vector3")?y.push(m.vExtensionPoint2.clone().toArray()):y.push(m.vExtensionPoint1.clone().toArray()),I=x._computePointCurveSquaredDistance(D.clone().toArray(),1,y),_=Math.sqrt(I.squaredDistance)>it?new d.Vector3(I.aPosition2[0],I.aPosition2[1],I.aPosition2[2]):D):n===t.ResultType.AXIS&&0===Ce&&(I=x._computePointCurveSquaredDistance(D.clone().toArray(),1,k),_=Math.sqrt(I.squaredDistance)>it?new d.Vector3(I.aPosition2[0],I.aPosition2[1],I.aPosition2[2]):D)}st(He,function(e,t,n,o,a,s,l,c){var p=new h;if(e&&t&&n&&o){var g=t.clone(),b=o.clone();a&&(g.add(e).multiplyScalar(.5),b.add(n).multiplyScalar(.5));var y=!0,m=!0;if(i.owner.isReadOnly()){var v=g.clone().sub(e.clone()).normalize(),P=e.clone().sub(n.clone()).normalize(),A=v.cross(P),f=(new d.Plane).setFromNormalAndCoplanarPoint(A.normalize().clone(),e.clone());if(l&&l.length>0){var w=l[0];n=f.projectPoint(l[0]);for(var S=e.distanceTo(n),M=1;M<l.length;M++){var D=f.projectPoint(l[M]);e.distanceTo(D)<S&&(w=l[M],n=D.clone())}if(2===l.length){var T=l[0].distanceTo(l[1]),_=e.distanceTo(l[0])+e.distanceTo(l[1])-T;r.isZero(_)&&(y=!1)}if(y){var C=u.createLineNode(n.clone(),w.clone(),s);r.areEqual(w,n,"Vector3")||st(p,C)}}if(c&&c.length>0){var R=c[0];b=f.projectPoint(c[0]);for(var x=t.distanceTo(b),L=1;L<c.length;L++){var E=f.projectPoint(c[L]);t.distanceTo(E)<x&&(R=c[L],b=E.clone())}if(2===c.length){var V=c[0].distanceTo(c[1]),N=t.distanceTo(c[0])+t.distanceTo(c[1])-V;r.isZero(N)&&(m=!1)}if(m){var k=u.createLineNode(b.clone(),R.clone(),s);r.areEqual(R,b,"Vector3")||st(p,k)}}}if(y){var I=u.createLineNode(n.clone(),e.clone(),s);r.areEqual(n,e,"Vector3")||st(p,I)}if(m){var F=u.createLineNode(b.clone(),g.clone(),s);r.areEqual(b,g,"Vector3")||st(p,F)}}return p}(M,D,T,_,!1,xe.regularSolidLine,C,R))}function Wt(e){var t=e.leaderStyle&&void 0!==e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness;return Math.max(2*t+4,Me)}function Zt(e,n,r,o){var a,s=i.owner.getAttribute("vFirstExtensionPoint3D"),l=i.owner.getAttribute("vSecondExtensionPoint3D");n===t.ResultType.CURVE&&(s=(a=e.getPoints()).beginPoint.clone(),l=a.endPoint.clone());var u={value:5,scale:1};o=Wt(r);var c=i.owner.getAttribute("sExtremityType");void 0!==c&&(u=zt(c));var p=r.lineStyle.color,h=u.value;8!==h&&9!==h||(h=5);var b=_.retrieveMaterialFromGAS({size:o,withoutDPR:!0,scale:u.scale,symbol:h,color:new d.Color(p)});b.force=!0,st(ze,g.createPointsNode({positions:s.toArray(),material:b})),st(ze,g.createPointsNode({positions:l.toArray(),material:b}))}function jt(e,n,o,s){var c,p="MeasureItem"===je,h="MeasureBetween"===je,b="MeasureThickness"===je;p&&n!==t.ResultType.LINE&&n!==t.ResultType.CIRCLE&&n!==t.ResultType.CONE&&n!==t.ResultType.CYLINDER||(B&&Q&&le&&K||Ge.removeChildren(),He.removeChildren(),Be.removeChildren(),Ft(),h&&(xe.regularSolidLine.lineWidth=s.leaderStyle&&void 0!==s.leaderStyle.thickness?s.leaderStyle.thickness:s.lineStyle.thickness),c=i.owner.isReadOnly()&&Ze&&n===t.ResultType.CIRCLE,h||b||p&&(n===t.ResultType.CONE||c)?((h||p&&(n===t.ResultType.CONE&&"Length"!==i.owner.getAttribute("sSurfaceDisplayType")&&"Area"!==i.owner.getAttribute("sSurfaceDisplayType")||c))&&Ht(e,n,o,s),kt()&&!c&&function(e,n,r,o){var a="MeasureBetween"===je||"MeasureItem"===je&&(e===t.ResultType.CONE||e===t.ResultType.CYLINDER)&&"Length"===i.owner.getAttribute("sSurfaceDisplayType");Rt(Ge,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,o,a),"MeasureBetween"===je?Xt(e,n,r):st(He,xt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,o))}(n,o,e,s)):p?function(e,n){switch(e){case t.ResultType.LINE:Rt(Ge,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,n,!0),st(He,xt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n));break;case t.ResultType.CIRCLE:if(0!==i.owner.getAttribute("iRadiusResultDisplayType")){var o=i.owner.getAttribute("vArcMidPoint"),a=i.owner.getAttribute("vFirstExtensionPoint3D");r.areEqual(o,a,"Vector3")||i.owner._buildConstructionData(),Rt(Ge,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,i.owner.getAttribute("bRadiusDisplay"),n,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")),st(He,xt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("bRadiusDisplay")?i.owner.getAttribute("vSecondPoint3D"):i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n))}break;case t.ResultType.CYLINDER:"Length"===i.owner.getAttribute("sSurfaceDisplayType")&&(Rt(Ge,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,n,!0),st(He,xt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n)))}}(n,s):"Measure3PointsCircle"===je?i.owner.getAttribute("iRadiusResultDisplayType")!==t.RadiusResultDisplayType.CENTER&&(Rt(Ge,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,i.owner.getAttribute("bRadiusDisplay"),s,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")),st(He,xt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),i.owner.getAttribute("bRadiusDisplay"),s))):"Measure3PointsAngle"===je&&function(e,t){var n=i.owner.getAttribute("vAngleVector1").clone(),o=i.owner.getAttribute("vAngleVector2").clone(),s=i.owner.getAttribute("fQuadrant"),c=!1,p=i.owner.getAttribute("fAngle");p&&(r.isZero(p)?0:180*p/Math.PI)>180&&(c=!0),void 0!==s&&(1!==s&&3!==s||n.negate(),2!==s&&3!==s||o.negate());var h=i.owner.getAttribute("vAnglePointingPoint"),b=i.owner.getAttribute("bHasALeader"),y=i.owner.getAttribute("vAngleBreakPoint"),m=xe.regularSolidLine;if(void 0!==b&&void 0!==h&&void 0!==y&&!0===b){m=xe.regularSolidLine;var v=u.createLineNode(i.owner.getAttribute("vAnglePointingPoint"),i.owner.getAttribute("vAngleBreakPoint"),m);st(He,v),xe.crossPoint.force=!0;var P=g.createPointsNode({positions:h.clone().toArray(),material:xe.crossPoint}),A=g.createPointsNode({positions:y.clone().toArray(),material:xe.crossPoint});st(He,P),st(He,A)}var f=i.owner.getAttribute("vAngleArcCenter"),w=i.owner.getAttribute("vAnglePointingPoint").clone().sub(f).length(),S=f.clone().add(n.clone().normalize().multiplyScalar(w)),M=f.clone().add(o.clone().normalize().multiplyScalar(w)),D=o.clone(),T=n.clone();if(et.bExtendAngleArc){var _=i.owner.getAttribute("vAngleBreakPoint");(D=_.clone().sub(f)).normalize().multiplyScalar(w),S.distanceTo(_)<M.distanceTo(_)&&(T=o.clone())}Be.removeChildren(),st(Be,u.createArcNode(w,f,T,D,m,c));var C=i.owner.getMeasurable(2);if(C){var R,x=a.computePointSegmentDistance(S.toArray(),e.getSelPoint().toArray(),C.getSelPoint().toArray());0===x.returnCode&&x.relationship!==l.Relationship.COINCIDENT&&(R=new d.Vector3(x.aPosition[0],x.aPosition[1],x.aPosition[2]),st(He,u.createLineNode(R,S,xe.regularSolidLine)));var L=(new d.Vector3).crossVectors(n.clone(),o.clone()),E=(new d.Vector3).crossVectors(L.clone().normalize(),n.clone()),V=(new d.Vector3).crossVectors(L.clone().normalize(),o.clone());c&&(E.negate(),V.negate()),Ct(Ge,S,M,E,V,t),0===(x=a.computePointSegmentDistance(M.toArray(),i.owner.getMeasurable(3).getSelPoint().toArray(),C.getSelPoint().toArray())).returnCode&&x.relationship!==l.Relationship.COINCIDENT&&(R=new d.Vector3(x.aPosition[0],x.aPosition[1],x.aPosition[2]),st(He,u.createLineNode(R,M,xe.regularSolidLine)))}}(e,s),It())}function Yt(e,n,o,a,s){var c,p=i.owner.getMeasurable(2);if(p){if("MeasureBetween"===je&&function(e,n,o,a){var s,l,c,p,d,h=i.owner.getAttribute("vFirstExtensionPoint3D"),b=i.owner.getAttribute("vSecondExtensionPoint3D");if(!r.areEqual(h,b,"Vector3")){var y,m,v=n,P=o,A=void 0!==i.owner.getAttribute("fAngle")&&r.isZero(i.owner.getAttribute("fAngle"));v===t.ResultType.PLANE&&P===t.ResultType.PLANE&&A?a&&(a.force=!0,y=g.createPointsNode({positions:h.clone().toArray(),material:a}),st(ze,y),m=g.createPointsNode({positions:b.clone().toArray(),material:a}),st(ze,m)):v===t.ResultType.AXIS&&P===t.ResultType.AXIS&&A||!i.owner.getAttribute("fDistance")||a&&(a.force=!0,y=g.createPointsNode({positions:h.clone().toArray(),material:a}),st(ze,y),m=g.createPointsNode({positions:b.clone().toArray(),material:a}),st(ze,m))}n===t.ResultType.AXIS&&(c=(l=e.getPoints()).beginPoint.clone().sub(l.endPoint),p=30,d=w.getDistanceFromPixel(Ae,l.beginPoint,p),c.normalize().multiplyScalar(d),e.vExtensionPoint1=l.beginPoint.clone().add(c),e.vExtensionPoint2=l.endPoint.clone().sub(c),st(Ue,u.createLineNode(e.vExtensionPoint1,e.vExtensionPoint2,xe.dotDashedLine))),o===t.ResultType.AXIS&&(c=(l=(s=i.owner.getMeasurable(2)).getPoints()).beginPoint.clone().sub(l.endPoint),p=30,d=w.getDistanceFromPixel(Ae,l.beginPoint,p),c.normalize().multiplyScalar(d),s.vExtensionPoint1=l.beginPoint.clone().add(c),s.vExtensionPoint2=l.endPoint.clone().sub(c),st(Ue,u.createLineNode(s.vExtensionPoint1,s.vExtensionPoint2,xe.dotDashedLine)))}(e,n,o,s),n===t.ResultType.AXIS||n===t.ResultType.PLANE?Ze||"MeasureBetween"===je||Nt(Ue,ke,e,n,i.owner.getAttribute("vFirstExtensionPoint3D")):n===t.ResultType.CURVE&&e.getType()===l.GeometryType.LINE?"MeasureBetween"!==je&&Nt(Ue,ke,e,t.ResultType.LINE,i.owner.getAttribute("vFirstExtensionPoint3D")):n===t.ResultType.LINE&&o===t.ResultType.LINE&&"Distance"===i.owner.getAttribute("sDistanceType")&&Nt(Ue,Ie,p,o,i.owner.getAttribute("vSecondExtensionPoint3D")),o===t.ResultType.AXIS||o===t.ResultType.PLANE?Ze||"MeasureBetween"===je||Nt(Ue,Ie,p,o,i.owner.getAttribute("vSecondExtensionPoint3D")):o===t.ResultType.CURVE&&p.getType()===l.GeometryType.LINE&&"MeasureBetween"!==je&&Nt(Ue,Ie,p,t.ResultType.LINE,i.owner.getAttribute("vSecondExtensionPoint3D")),We&&"MeasureBetween"!==je){var b="MeasureThickness"===je?xe.avatarDottedLine:xe.regularDashedLine,y=(m=i.owner.getAttribute("vFirstExtensionPoint3D"),v=i.owner.getAttribute("vSecondExtensionPoint3D"),P=a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,f=a.fillStyle.color,S=b,D=new h,T=!0,0===i.owner._bCreateMeasureInShowSpace&&(T=!1),m&&(null!==D._nAnchor1SpriteNode&&D.remove(D._nAnchor1SpriteNode),D._nAnchor1SpriteNode=Lt(m,P,f),D._nAnchor1SpriteNode.setVisibility(T),st(D,D._nAnchor1SpriteNode)),v&&(null!==D._nAnchor2SpriteNode&&D.remove(D._nAnchor2SpriteNode),D._nAnchor2SpriteNode=Lt(v,P,f),D._nAnchor2SpriteNode.setVisibility(T),st(D,D._nAnchor2SpriteNode)),m&&v&&(void 0===M||!0===M)&&st(D,u.createLineNode(m,v,S)),D);st(ze,y)}else Ze||"MeasureBetween"===je||((c=Lt(i.owner.getAttribute("vFirstExtensionPoint3D"),a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,a.fillStyle.color)).setVisibility(0!==i.owner._bCreateMeasureInShowSpace),st(ze,c));var m,v,P,f,S,M,D,T;if("MeasureThickness"===je){var _=a.lineStyle.thickness;_=Math.max(2*_+4,10),_/=8;var C=new h,R=new A({ratio:7}),x=u.createCircleNode(_,new d.Vector3(0,0,0),new d.Vector3(0,0,1),xe.regularSolidLine),L=new A({ratio:7}),E=u.createCircleNode(_,new d.Vector3(0,0,0),new d.Vector3(0,0,1),xe.regularSolidLine),V=r.computeTransformationBetweenTwoLines(new d.Vector3,new d.Vector3(0,0,1),e.getSelPoint(),e.getSelNormal());R.setMatrix(V.transformation),R.addChild(x),V=r.computeTransformationBetweenTwoLines(new d.Vector3,new d.Vector3(0,0,1),i.owner.getAttribute("vSecondExtensionPoint3D"),e.getSelNormal()),L.setMatrix(V.transformation),L.addChild(E),C.addChild(R),C.addChild(L),st(Ue,C)}}}function Qt(e,n,r,o,a){var s,l,u,c,p,b,y;function m(){l&&o&&(o.force=!0,u=g.createPointsNode({positions:l,material:o}),st(ze,u))}switch(n){case t.ResultType.POINT:l=e.getSelPoint().toArray(),m();break;case t.ResultType.CENTER:l=e.getCenter().toArray(),m();break;case t.ResultType.AXIS:Vt(Ue,ke,e,n,xe.dotDashedLine);break;case t.ResultType.CIRCLE:!function(e,t,n,r){var o,a,s,l,u,c,p,h,b,y=i.owner.getAttribute("iRadiusResultDisplayType");if(Vt(Ue,ke,e,t,xe.regularSolidLine),i.owner.getAttribute("bArcLengthDisplay"))c=(b=e.getPoints()).beginPoint.clone(),p=b.endPoint.clone(),o={value:5,scale:1},r=Wt(n),void 0!==(a=i.owner.getAttribute("sExtremityType"))&&(o=zt(a)),s=n.lineStyle.color,8!==(l=o.value)&&9!==l||(l=5),(u=_.retrieveMaterialFromGAS({size:r,withoutDPR:!0,scale:o.scale,symbol:l,color:new d.Color(s)})).force=!0,st(ze,g.createPointsNode({positions:c.toArray(),material:u})),st(ze,g.createPointsNode({positions:p.toArray(),material:u}));else if(0===y){var m=e.getSelPoint(),v=i.owner.getAttribute("vCenter").clone();h=v.clone();var P=!0;if(!1===i.owner.getAttribute("bRadiusDisplay")){var A=v.clone().sub(m);h=v.clone().add(A),P=!1}m||(m=i.owner.getAttribute("vLeaderPointingPoint3D")),Rt(ze,m.clone(),h.clone(),void 0,!1,!1,n,!0,!1,!0,P)}}(e,n,r,a);break;case t.ResultType.CURVE:case t.ResultType.LINE:Zt(e,n,r,a);break;case t.ResultType.PLANE:Vt(Ue,ke,e,n,xe.regularSolidLine);break;case t.ResultType.CYLINDER:"Length"===(y=i.owner.getAttribute("sSurfaceDisplayType"))?Zt(e,n,r,a):"Area"!==y&&(Vt(Ue,ke,e,n,xe.regularSolidLine),c=i.owner.getAttribute("vFirstPoint3D"),p=i.owner.getAttribute("vSecondPoint3D"),b=i.owner.getAttribute("vLeaderBreakPoint3D"),void 0===Ce&&(c=(s=i.owner._buildConstructionPointsForConeCylSphere()).oPos1,p=s.oPos2,b=c.clone()),y&&"Radius"!==y&&"Diameter"!==y&&"MinimumRadius"!==y&&"MinimumDiameter"!==y&&"MaximumRadius"!==y&&"MaximumDiameter"!==y||Rt(ze,c,p,b,!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")));break;case t.ResultType.CONE:"Length"===(y=i.owner.getAttribute("sSurfaceDisplayType"))?Zt(e,n,r,a):"Area"!==y&&(Vt(Ue,ke,e,n,xe.regularSolidLine),"MinimumRadius"!==y&&"MinimumDiameter"!==y&&"MaximumRadius"!==y&&"MaximumDiameter"!==y||Rt(ze,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")));break;case t.ResultType.SPHERE:Vt(Ue,ke,e,n,xe.regularSolidLine),c=i.owner.getAttribute("vFirstPoint3D"),p=i.owner.getAttribute("vSecondPoint3D"),b=i.owner.getAttribute("vLeaderBreakPoint3D"),void 0===Ce&&(c=(s=i.owner._buildConstructionPointsForConeCylSphere()).oPos1,p=s.oPos2,b=c.clone()),Rt(Ue,c,p,b,!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay"));break;case t.ResultType.SURFACE:Vt(Ue,ke,e,n,xe.regularSolidLine);break;case t.ResultType.PRODUCT:var v=i.owner.getPointedReferences();v&&v.length||(ke=function(e,t,i){for(var n=new h,r=[],o=Number.MAX_VALUE,a=0;a<3;a++)r[a]=e[a+3]-e[a],o=Math.min(o,r[a]);o/=10;var s=[];s[0]=new d.Vector3(o,0,0),s[1]=new d.Vector3(0,o,0),s[2]=new d.Vector3(0,0,o);var l=[],u=[],c=new d.Vector3(e[0],e[1],e[2]);for(l[0]=0;l[0]<2;l[0]++)for(l[1]=0;l[1]<2;l[1]++)for(l[2]=0;l[2]<2;l[2]++){var p=4*l[0]+2*l[1]+l[2];u[p]=[],u[p][0]=new d.Vector3(l[0]*r[0],l[1]*r[1],l[2]*r[2]).add(c);for(var b=0;b<3;b++)u[p][b+1]=s[b].clone().multiplyScalar(1-2*l[b]).add(u[p][0]);var y=[u[p][1],u[p][0],u[p][2],u[p][0],u[p][3]],m=g.createLineNode({points:y,material:t});m.setShadow(!1),st(n,m)}var v=[u[0][0],u[4][0],u[6][0],u[2][0],u[0][0],u[1][0],u[5][0],u[4][0],u[5][0],u[7][0],u[6][0],u[7][0],u[3][0],u[2][0],u[3][0],u[1][0]],P=g.createLineNode({points:v,material:i});return P.setShadow(!1),st(n,P),n}(i.owner.getAttribute("aabb"),xe.bBoxSolidLine,xe.regularDashedLine),st(Ue,ke))}}function Kt(e,n,r,o){Ue.removeChildren(),ze.removeChildren();var a,s={value:0,scale:1},l=o.lineStyle.color,c=Wt(o),p=i.owner.getAttribute("sPointType");if(void 0!==p&&(s=zt(p)),0===s.value)a=null;else{var h=s.value;8!==h&&9!==h||(h=5),a=_.retrieveMaterialFromGAS({size:c,scale:s.scale,withoutDPR:!0,symbol:h,color:new d.Color(l)})}"MeasureBetween"===je||"MeasureThickness"===je?Yt(e,n,r,o,a):"MeasureItem"===je?Qt(e,n,o,a,c):"Measure3PointsCircle"===je?function(e,n,r){var o=i.owner.getMeasurable(2),a=i.owner.getMeasurable(3),s=u.createCircleNode(i.owner.getAttribute("fRadius"),i.owner.getAttribute("vCenter"),i.owner.getAttribute("vNormal"),xe.regularSolidLine);if(st(Ue,s),n&&(n.force=!0,st(ze,g.createPointsNode({positions:e.getSelPoint().clone().toArray(),material:n})),st(ze,g.createPointsNode({positions:o.getSelPoint().clone().toArray(),material:n})),st(ze,g.createPointsNode({positions:a.getSelPoint().clone().toArray(),material:n}))),i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER){var l=i.owner.getAttribute("vCenter").clone();!1===i.owner.getAttribute("bRadiusDisplay")&&(l=i.owner.getAttribute("vSecondExtensionPoint3D").clone()),Rt(ze,i.owner.getAttribute("vFirstExtensionPoint3D").clone(),l.clone(),void 0,!1,!1,r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay"))}}(e,a,o):"Measure3PointsAngle"===je&&function(e,t){var n=i.owner.getMeasurable(2),r=i.owner.getMeasurable(3);st(Ue,u.createLineNode(e.getSelPoint(),n.getSelPoint(),xe.regularSolidLine)),st(Ue,u.createLineNode(r.getSelPoint(),n.getSelPoint(),xe.regularSolidLine)),t&&(t.force=!0,st(ze,g.createPointsNode({positions:e.getSelPoint().clone().toArray(),material:t})),st(ze,g.createPointsNode({positions:n.getSelPoint().clone().toArray(),material:t})),st(ze,g.createPointsNode({positions:r.getSelPoint().clone().toArray(),material:t})))}(e,a)}function $t(e){var t=!1;switch(e){case"AnchorAndAvatar":t=!(B&&U&&z&&Q&&ue&&J&&W&&le&&ae&&se&&K);break;case"DimensionGroup":t=!(B&&U&&H&&z&&J&&q&&X&&W&&K&&Z&&j&&Y&&Q&&$&&ee&&te&&ie&&ne&&re&&oe&&le);break;case"LableContent":t=!(B&&O&&ce&&J&&$&&U&&z&&G&&pe&&de&&ge&&he&&be&&me&&ve&&Q&&Pe);break;case"Leader":t=!(B&&G&&j&&Y&&U&&Q&&le)}return t}this.getPixelFontSize=function(e){var t;return i.owner.getAttribute("iFontSize")&&(t=w.convertPixelToModel({sizeInPixels:i.owner.getAttribute("iFontSize")*(4/3),viewer:Ae})),t||(t=i.owner.getAttribute(e)),w.convertModelToPixels({sizeInMM:t,viewer:Ae})},this.getTooltip=function(){var t=[];if(!i.owner.getAttribute("sTextGraphicRepresentationID")&&!i.owner.getAttribute("sTextGraphicRepresentation")&&Ve)return Ve.length&&Ve.length>50&&(qe=!0),t.push(Ve),Ne&&(t.push("\n"+Ne),!qe&&Ne.length&&Ne.length>50&&(qe=!0)),function(t){var i;if(at()){if(t&&t.length){i=e.createElement("div");for(var n=0;n<t.length;n++)e.createElement("p",{styles:{margin:"2px",padding:0}}).inject(i).setText(t[n])}return i}}(t)},this.processPathForTrimedText=function(e){var t=e;if(i.owner.getAttribute("bShortDisplay")||!Ve||i.owner.getAttribute("sTextGraphicRepresentationID")||i.owner.getAttribute("sTextGraphicRepresentation")||i.owner.getAttribute("stextGraphicRepresentationAngle"))return t;if(Ve.length&&Ve.length>50||Ne&&Ne.length&&Ne.length>50){var n=t.pathElement.hash();n+="000/",t.pathElement._hash=n}return t},this.getBoxPosition=function(){var e=Fe.getDimensions();return{top:-e.offsetHeight/2,left:-e.offsetWidth/2}},this.update=function(e,n){if(null!==tt&&-1!==i.owner.getAttribute("sSelectedType1")){Ce=i.owner.getAttribute("iExtensionLinesManipulable"),Re(),je=i.owner.getAttribute("sType"),n&&(Ye=void 0);var o=i.owner.getMeasurable(1);if(o){var a,s,l=ct(),u=i.owner.getAttribute("sResultingType1"),c=i.owner.getAttribute("sResultingType2");Ke||(Ke=!1),N=Ut("UnitLength","string"),k=Ut("UnitAngle","string"),I=Ut("UnitArea","string"),F=Ut("UnitVolume","string"),O=N&&k&&I&&F,(B=void 0!==Ye&&Ye===je)||(Ye=je),U=Ut("LineStyleColor","Color")&&Ut("LeaderStyleColor","Color"),z=Ut("FillStyleColor","Color"),G=Ut("LineStyleThicknessIndex","float")&&Ut("LineStyleThickness","float"),H=Ut("LeaderStyleThicknessIndex","float")&&Ut("LeaderStyleThickness","float"),J=Ut("Distance","float"),q=Ut("FirstPoint3D","Vector3"),X=Ut("SecondPoint3D","Vector3"),W=Ut("FirstExtensionPoint3D","Vector3"),Z=Ut("SecondExtensionPoint3D","Vector3"),j=Ut("LeaderBreakPoint3D","Vector3"),Y=Ut("LeaderPointingPoint3D","Vector3"),Q=Ut("RadiusDisplay","bool"),K=Ut("ArcLengthDisplay","bool"),$=Ut("Angle","float"),ee=Ut("AngleBreakPoint","Vector3"),te=Ut("Quadrant","float"),ie=Ut("AngleArcCenter","Vector3"),ne=Ut("AnglePointingPoint","Vector3"),re=Ut("AngleVector1","Vector3"),oe=Ut("AngleVector2","Vector3"),ae=Ut("PointType","string"),se=Ut("ExtremityType","string"),le=!0,("MeasureItem"===je&&i.owner.getAttribute("sResultingType1")===t.ResultType.CIRCLE||"Measure3PointsCircle"===je)&&(le=Ut("RadiusResultDisplayType","int")),G&&H||(ae=!1,se=!1),ue=Ut("aabb","AABB"),ce=Ut("ShortDisplay","bool"),pe=Ut("IsFilled","bool"),de=Ut("HasBorder","bool"),ge=Ut("HasALeader","bool"),he=Ut("FontColor","Color"),be=Ut("FontName","string"),(void 0!==(ye=et.getPixelFontSize("fFontSize"))||void 0!==tt.FontSize&&ye===tt.FontSize)&&(tt.FontSize=ye),me=Ut("FontSize","float"),ve=Ut("Opacity","float"),Pe=Ke===i.owner.isInEdition(),Ke||(z=!1,U=!1),Ke=i.owner.isInEdition(),function(e){if(!B){var n,o=i.owner.getAttribute("sSurfaceDisplayType");"MeasureItem"===je?e!==t.ResultType.CONE||"Angle"!==o&&"HalfAngle"!==o||(n=i.owner.getAttribute("fSemiAngle")):n=i.owner.getAttribute("fAngle"),Ze=void 0!==n&&!r.isZero(n);var a=i.owner.getAttribute("fDistance");We="MeasureItem"===je&&e!==t.ResultType.CONE||"MeasureItem"===je&&!Ze&&e===t.ResultType.CONE||"Measure3PointsCircle"===je||"MeasureThickness"===je||void 0!==a&&!(r.isZero(a)&&Ze),"MeasureBetween"===je&&void 0!==i.owner.getAttribute("sDistanceType")&&("Angle"===i.owner.getAttribute("sDistanceType")&&Ze?We=!1:(Ze=!1,We=!0))}}(u),Bt(!!e||!B),function(e){if(!U||!z){var t=e.lineStyle.color;xe.regularSolidLine.color=!0===i.owner._bPrevisualized&&"MeasureThickness"===je?Se:e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:t,xe.regularDashedLine.color=e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:t,xe.bBoxSolidLine.color=xe.regularDashedLine.color,xe.avatarSolidLine.color=e.fillStyle.color,xe.avatarDashedLine.color=e.fillStyle.color,xe.avatarDottedLine.color=!0===i.owner._bPrevisualized&&"MeasureThickness"===je?Se:t,xe.dotDashedLine.color=t,xe.dotLine.color=t,xe.crossPoint.color=t}if(!G||!H){var n=e.leaderStyle&&e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness;xe.regularSolidLine.setLineWidth(n)}}(l),$t("DimensionGroup")&&jt(o,u,c,l),$t("AnchorAndAvatar")&&Kt(o,u,c,l),$t("LableContent")&&(j=!1,function(e,n){Fe.setVisibility(We),0===i.owner._bCreateMeasureInShowSpace?We?Fe.setVisibility(!We):(Fe.setVisibility(We),Fe.setVisibilityFree(!We)):1===i.owner._bCreateMeasureInShowSpace&&(Fe.setVisibility(We),Fe.setVisibilityFree(!We)),!We&&Ze&&Pe||(Ft(),Fe.modify({content:Tt(i.owner.getAttribute("bShortDisplay"),je,i.owner.getAttribute("fDistance"),i.owner.getAttribute("sMeasureOnGeometryType"),i.owner.getAttribute("sDistanceType")),commentContent:i.owner.getAttribute("sCommentOnMeasure"),position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:n,inEdition:i.owner.isInEdition(),boxRotationAngle:i.owner.getAttribute("fBoxRotationAngle"),tessRep:i.owner.getAttribute("sTextGraphicRepresentationID")?i.owner.getTesselatedRep(i.owner.getAttribute("sTextGraphicRepresentationID")):i.owner.getAttribute("sTextGraphicRepresentation")}),It()),Oe.setVisibility(Ze),0===i.owner._bCreateMeasureInShowSpace?(Ze?Oe.setVisibility(!Ze):Oe.setVisibility(Ze),Oe.setVisibilityFree(!Ze)):1===i.owner._bCreateMeasureInShowSpace&&(Oe.setVisibility(Ze),Oe.setVisibilityFree(!Ze)),Ze&&(Ft(),Oe.modify({content:_t(i.owner.getAttribute("bShortDisplay"),je,"MeasureItem"===je&&e===t.ResultType.CONE?i.owner.getAttribute("fSemiAngle"):i.owner.getAttribute("fAngle"),!We,i.owner.getAttribute("sMeasureOnGeometryType")),position:i.owner.getAttribute("vAngleBreakPoint"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:n,boxRotationAngle:i.owner.getAttribute("fBoxRotationAngle"),tessRep:i.owner.getAttribute("stextGraphicRepresentationAngle")}),It())}(u,l)),B&&j||!We&&Ze||(Ft(),Fe.modify({position:i.owner.getAttribute("vLeaderBreakPoint3D")}),It()),B&&ee||Ze&&(Ft(),Oe.modify({position:i.owner.getAttribute("vAngleBreakPoint")}),It()),$t("Leader")&&Gt(),a=!i.owner.getAttribute("bCollapsedDisplay"),s=1===i.owner._bCreateMeasureInShowSpace?a:!a,Ue.setVisibility(s),Ge.setVisibility(s),He.setVisibility(s),Je.setVisibility(s),Fe&&Fe.isVisible()&&!a&&Fe.setVisibility(a),Oe&&Oe.isVisible()&&!a&&Oe.setVisibility(a),Fe&&1===i.owner._bCreateMeasureInShowSpace&&Fe.setVisibilityFree(!Fe.isVisible()),Oe&&1===i.owner._bCreateMeasureInShowSpace&&Oe.setVisibilityFree(!Oe.isVisible()),et.setName(i.owner.getAttribute("sName")),et._updateVisibility()}}},this.updateRepresentation=function(e){if(kt()){var t=e.position.clone(),n=i.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D")),r=n.lengthSq();if(r>1e-6){var o=t;if(0===Ce){var a=(new d.Plane).setFromCoplanarPoints(i.owner.getAttribute("vFirstExtensionPoint3D").clone(),i.owner.getAttribute("vFirstPoint3D").clone(),i.owner.getAttribute("vSecondPoint3D").clone()),s=w.getViewpointInfo(Ae.currentViewpoint),u=L.computeLinePlaneDistance(o.clone().toArray(),s.sight.toArray(),i.owner.getAttribute("vFirstPoint3D").clone().toArray(),a.normal.toArray());o=u&&0===u.returnCode&&u.relationship===l.Relationship.INTERSECTING?new d.Vector3(u.aPosition[0],u.aPosition[1],u.aPosition[2]):a.projectPoint(t)}var c=n.dot(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(o))/r,p=n.multiplyScalar(-c).add(i.owner.getAttribute("vFirstExtensionPoint3D")),g=o.clone().sub(p);i.owner.setAttribute("vFirstPoint3D",i.owner.getAttribute("vFirstExtensionPoint3D").clone().add(g)),i.owner.setAttribute("vSecondPoint3D",i.owner.getAttribute("vSecondExtensionPoint3D").clone().add(g)),i.owner.setAttribute("vLeaderBreakPoint3D",o);var h=i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5);i.owner.setAttribute("vLeaderPointingPoint3D",h)}}else i.owner.setAttribute("vLeaderBreakPoint3D",e.position);i.owner.setAttribute("fBoxRotationAngle",e.rotationAngle),Ot(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})},this.getLabelParams=function(){var e={},t=Ze&&!We?Oe.getDimensions():Fe.getDimensions();return e.position=Ze&&!We?i.owner.getAttribute("vAngleBreakPoint"):i.owner.getAttribute("vLeaderBreakPoint3D"),e.rotationAngle=i.owner.getAttribute("fBoxRotationAngle")?i.owner.getAttribute("fBoxRotationAngle"):0,e.width=t.width,e.height=t.height,e},this.hasTessellatedRepresentation=function(){return i.owner.getAttribute("stextGraphicRepresentationAngle")&&i.owner.getAttribute("stextGraphicRepresentationAngle").length||i.owner.getAttribute("sTextGraphicRepresentationID")||i.owner.getAttribute("sTextGraphicRepresentation")&&i.owner.getAttribute("sTextGraphicRepresentation").length},this.getRepNode=function(){return{avatar:Ue,anchor:ze,dimensionArrow:Ge,dimensionExtension:He,leader:Je,box:Ze&&!We?Oe.getLabelNode():Fe.getLabelNode()}},this.getLabelDimensions=function(){var e=Ze&&!We?Oe.getDimensions():Fe.getDimensions();return e.position=Ze&&!We?i.owner.getAttribute("vAngleBreakPoint"):i.owner.getAttribute("vLeaderBreakPoint3D"),e},this.onViewerEventCB=function(e){"beginExplodeCmd"!==e.eventType&&"endExplodeCmd"!==e.eventType&&"onPreferenceModified"!==e.eventType||et.update(null,!0),"MeasureThickness"===je&&"@onViewpointChange"===e.eventType&&tt.LeaderStyleThickness?(tt.bSameFirstPoint3D=-1,et.update()):(kt()||Ze||"Arrow"===i.owner.getAttribute("sLeaderEndType"))&&"@onWindowResized"===e.eventType&&i.owner.getParent()&&i.owner.getParent().getType&&"DMUTemporaryBag"===i.owner.getParent().getType()&&(Ze||(tt.LeaderBreakPoint3D=-1),et.update(!1,Ze))};var ei=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){ei(),et=xe=tt=ke=Ie=Fe=Oe=Ue=null,ze=Ge=He=Be=Je=Ae=null},this._updateVisibility=function(e,t){var n=i.owner.isMeasureDisplayed();if(0===i.owner.getAttribute("bCreateMeasureInShowSpace"))n=!!i.owner.getAttribute("bCollapsedDisplay")||!n;else if(n){n=!i.owner.getAttribute("bCollapsedDisplay")}void 0!==e&&(nt=e),n=n&&nt>0,et.setVisibility(n);let r=t&&nt<1;Ue&&Ue.setVisibility(!r&&n),ze&&ze.setVisibility(!r&&n),Ge&&Ge.setVisibility(!r&&n),He&&He.setVisibility(!r&&n),Je&&Je.setVisibility(!r&&n),We&&Fe&&Fe.setVisibility(n),Ze&&Oe&&Oe.setVisibility(n),(0===Ae.getVisibleSpace()&&!n||1===Ae.getVisibleSpace()&&n)&&nt>0&&Gt(),n&&nt>0&&(Fe&&Fe.setOpacity(nt),Oe&&Oe.setOpacity(nt)),Ae.render()},Fe=new f({window:i.frmWindow,content:[""],position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:ct()}),et.linkManipulatorToNode(Fe.getBackNode()),st(this,Fe),st(this,Oe=new f({window:i.frmWindow,content:[""],position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:ct()})),st(this,Ue=new h),st(this,ze=new h),st(this,Ge=new h),st(this,He=new h),st(this,Be=new h),st(this,Je=new h),this.updateNonManipulableNodePickability=function(e){let t=e?R.PICKABLE:R.PICKTHROUGH;Je.setPickable(t),ze.setPickable(t),Ue.setPickable(t),He.setPickable(t)},this.update(!0),this.cleanAngleCache=function(){et.bExtendAngleArc=!1}}})}),define("DS/DMUPlayMeasure/DMUMeasure",["DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUMeasurable","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUBaseExperience/EXPToolsVisualization","DS/CoreEvents/ModelEvents","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUToolsInterference","DS/DMUBaseUIControllers/DMUMarkupsController","DS/DMUPlayMeasure/DMUMeasureNode3D","DS/DMUPlayMeasure/DMUMeasureImport","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADSettingsMgt","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,n,r,o,a,s,l,u,c,p,d,g,h,b,y,m,v,P,A){"use strict";var f=[{name:"sType",type:"string",JSONname:"Specifications.Type"},{name:"sSelectedType1",type:"int",JSONname:"Specifications.SelectedType1",defaultValue:-1},{name:"sSelectedType2",type:"int",JSONname:"Specifications.SelectedType2"},{name:"sResultingType1",type:"int",JSONname:"Results.ResultingType1",defaultValue:-1},{name:"sResultingType2",type:"int",JSONname:"Results.ResultingType2"},{name:"oProduct1Name",type:"string",JSONname:"Results.Product1Name"},{name:"oProduct2Name",type:"string",JSONname:"Results.Product2Name"},{name:"fDistance",type:"float",JSONname:"Results.Distance"},{name:"fAngle",type:"float",JSONname:"Results.Angle"},{name:"bComplementaryAngle",type:"bool",JSONname:"Results.ComplementaryAngle"},{name:"lbExtensionRequired",type:"listObject",JSONname:"Results.ExtensionRequired"},{name:"lFirstExtensionPoints",type:"ListVector3",JSONname:"Results.FirstExtensionPoints"},{name:"lSecondExtensionPoints",type:"ListVector3",JSONname:"Results.SecondExtensionPoints"},{name:"fProjectedAngleXY",type:"float",JSONname:"Results.ProjectedAngleXY"},{name:"fProjectedAngleYZ",type:"float",JSONname:"Results.ProjectedAngleYZ"},{name:"fProjectedAngleZX",type:"float",JSONname:"Results.ProjectedAngleZX"},{name:"vPosition",type:"Vector3",JSONname:"Results.Position"},{name:"vCenter",type:"Vector3",JSONname:"Results.Center"},{name:"vNormal",type:"Vector3",JSONname:"Results.Normal"},{name:"vCog",type:"Vector3",JSONname:"Results.Cog"},{name:"fLength",type:"float",JSONname:"Results.Length"},{name:"fRadius",type:"float",JSONname:"Results.Radius"},{name:"fArea",type:"float",JSONname:"Results.Area"},{name:"vApex",type:"Vector3",JSONname:"Results.Apex"},{name:"fSemiAngle",type:"float",JSONname:"Results.SemiAngle"},{name:"fVolume",type:"float",JSONname:"Results.Volume"},{name:"bHasALeader",type:"bool",JSONname:"Properties3DText.HasALeader",defaultValue:!0},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderBreakPoint3D",defaultValue:new u.Vector3},{name:"vLeaderPointingPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderPointingPoint3D",defaultValue:new u.Vector3},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties3DText.BoxRotationAngle"},{name:"bShortDisplay",type:"bool",JSONname:"PropertiesMeasure.Shortdisplay",defaultValue:!0},{name:"vFirstPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstPoint3D"},{name:"vSecondPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondPoint3D"},{name:"vFirstExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstExtensionPoint3D"},{name:"vSecondExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondExtensionPoint3D"},{name:"vExtensionDirection3D",type:"Vector3",JSONname:"PropertiesMeasure.ExtensionDirection3D"},{name:"bRadiusDisplay",type:"bool",JSONname:"PropertiesMeasure.Radiusdisplay",defaultValue:!1},{name:"bCollapsedDisplay",type:"bool",JSONname:"PropertiesMeasure.Collapseddisplay",defaultValue:!1},{name:"vAngleBreakPoint",type:"Vector3",JSONname:"PropertiesMeasure.AngleBreakPoint"},{name:"fQuadrant",type:"float",JSONname:"PropertiesMeasure.Quadrant"},{name:"vAngleArcCenter",type:"Vector3",JSONname:"PropertiesMeasure.AngleArcCenter"},{name:"vAnglePointingPoint",type:"Vector3",JSONname:"PropertiesMeasure.AnglePointingPoint"},{name:"vAngleVector1",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector1"},{name:"vAngleVector2",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector2"},{name:"aabb",type:"AABB",JSONname:"PropertiesMeasure.aabb"},{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.Visible",defaultValue:!0},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.IsFilled",defaultValue:!0},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.HasBorder",defaultValue:!1},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize",defaultValue:3.5},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal"},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new u.Color("#ffffff")},{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",defaultValue:new u.Color("#368ec4")},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"fLineStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thicknessIndex"},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.color",defaultValue:new u.Color("#3d3d3d")},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern"},{name:"fLeaderStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thicknessIndex"},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color"},{name:"cAvatarStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.AvatarStylecolor"},{name:"sCommentOnMeasure",type:"string",JSONname:"Comment.TextContents"},{name:"sCommentFontStyle",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyStyle"},{name:"sCommentFontName",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyName"},{name:"fCommentFontSize",type:"float",JSONname:"Comment.GraphicProperties.FontStyle.fontSize"},{name:"iRadiusResultDisplayType",type:"int",JSONname:"PropertiesMeasure.iRadiusResultDisplayType",defaultValue:0},{name:"vArcMidPoint",type:"Vector3",JSONname:"PropertiesMeasure.vArcMidPoint"},{name:"iExtensionLinesManipulable",type:"int",JSONname:"PropertiesMeasure.iExtensionLinesManipulable"},{name:"sLeaderEndType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sLeaderEndType"},{name:"sPointType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sPointType"},{name:"sExtremityType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sExtremityType"},{name:"sTextGraphicRepresentation",type:"string",JSONname:"Properties3DText.textGraphicRepresentation"},{name:"sTextGraphicRepresentationID",type:"string",JSONname:"Properties3DText.textGraphicRepresentationID"},{name:"stextGraphicRepresentationAngle",type:"string",JSONname:"Properties3DText.textGraphicRepresentationAngle"},{name:"sMeasureOnGeometryType",type:"string",JSONname:"Specifications.MeasureOnGeometryType"},{name:"sDistanceType",type:"string",JSONname:"Results.DistanceType"},{name:"bArcLengthDisplay",type:"bool",JSONname:"PropertiesMeasure.ArcLengthDisplay",defaultValue:!1},{name:"bDisplayMeasureType",type:"bool",JSONname:"PropertiesMeasure.DisplayMeasureType",defaultValue:!0},{name:"bDisplayUnit",type:"bool",JSONname:"PropertiesMeasure.DisplayUnit",defaultValue:!0},{name:"sSurfaceDisplayType",type:"string",JSONname:"Results.SurfaceDisplayType"},{name:"sProductDisplayType",type:"string",JSONname:"Results.ProductDisplayType"},{name:"fHeight",type:"float",JSONname:"Results.Height"},{name:"fMaxRadius",type:"float",JSONname:"Results.MaxRadius"},{name:"lCustomization",type:"listObject",JSONname:"Results.Customization",defaultValue:[]},{name:"sComputationMode",type:"string",JSONname:"Results.ComputationMode"},{name:"bDisplayApproximateSymbol",type:"bool",JSONname:"PropertiesMeasure.DisplayApproximateSymbol",defaultValue:!1},{name:"lSelectedProducts",type:"listStrings",JSONname:"PropertiesMeasure.selectedProducts"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness"},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height"}];return e.extend({init:function(e,i,n){this._parent(e,i),this._frmWindow&&(this._executionContext=this._frmWindow.getExecutionContext?this._frmWindow.getExecutionContext():this._frmWindow.getContextualUIManager&&this._frmWindow.getContextualUIManager()?this._frmWindow.getContextualUIManager()._executionContext:void 0),this.addParameters(f),this._type="DMUMeasure",this._typeApps=n;var s="DS/DMUMeasure/DMUMeasureContextualBar",l=this;let u=i;this._bCreateMeasureInShowSpace=this._viewer.getVisibleSpace(),this._isInCreationState=!1,this.initAuthoringData=function(){if(-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&(-1===c.getAuthoringFeatureTypes().indexOf("Measure")||l.getContextualCommandList||require([s],function(e){var t=new e;l.getContextualCommandList=t.getContextualCommandList,l.getSharedContextualCommandList=t.getSharedContextualCommandList,l.getSharedHeaderTypes=t.getSharedHeaderTypes,l.getCmdHdrsFor2DGeometries=t.getCmdHdrsFor2DGeometries,l.getSharedContextualMenuCommandList=t.getSharedContextualMenuCommandList,t.applyStateToContextHdr&&(l.applyStateToContextHdr=t.applyStateToContextHdr),t.getPointTypeHdr&&(l.getPointTypeHdr=t.getPointTypeHdr),t.getExtremityTypeHdr&&(l.getExtremityTypeHdr=t.getExtremityTypeHdr),t.setCheckCmdHdrState&&(l.setCheckCmdHdrState=t.setCheckCmdHdrState),t.register({frmWindow:l._frmWindow});var i=1===b.get().length?b.get()[0].pathElement.clone():null;i&&i.getLastElement(!0).getDMUType&&i.getLastElement(!0)===l.getNode()&&(b.empty(),b.add({pathElement:i}))}),!l.getPropertiesObject&&"ProgressiveVisuLoading"!==n)){require(["DS/DMUMeasure/DMUMeasureProperties"],function(e){var t=new e(l);l.getPropertiesObject=function(){return t}})}},this.removeAuthoringData=function(){-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&require([s],function(e){var t=new e;l.getContextualCommandList=null,l.getSharedContextualCommandList=null,l.getSharedHeaderTypes=null,l.getSharedContextualMenuCommandList=null,l.applyStateToContextHdr=null,l.getPointTypeHdr=null,l.getExtremityTypeHdr=null,l.setCheckCmdHdrState=null,t.unregister({frmWindow:l._frmWindow})})};var p=new h(l);this.importData=p.importData,this.afterImport=p.afterImport,this.initAuthoringData();var m=d.getDMUMarkupsController({context:this._viewer,frmWindow:this._frmWindow});m&&m.registerMarker(this),this.getType=function(){return"DMUMeasure"},this.getMeasureType=function(){return this._sType},this.setNode(new g({owner:this,frmWindow:this._frmWindow,getType:this.getType})),this.getPixelFontSize=function(){if(l.getNode())return l.getNode().getPixelFontSize()};var v=this.refreshNode;this.refreshNode=function(e){l._doNotRefresh||!l.getNode()||i.isImporting&&(!i.isImporting||i.isImporting())||(l.getNode().update(!1,e),v())},this.getManipulationData=function(){return this.getNode().getLabelParams()},this.isMeasureDisplayed=function(){return l.isVisible()&&l.getActiveFlag()&&l.isDisplayed()&&l.getAttribute("bVisible")},this.getTesselatedRep=function(e){let t=u?u.getAttribute("oLinksManager"):void 0;return t?t.getTesselatedRepByID(e):void 0},this.getPrefNameForDistanceType=function(){var e="";if(this._sMeasurable1&&this._sMeasurable2){for(var i="DMUMeasureDistanceType",n=[],r=0;r<2;r++){var s=this.getAttribute("sSelectedType"+(r+1));if(this._objAction||s!==t.ViewedType.POINT&&s!==t.ViewedType.CENTER){var u="_sMeasurable"+(r+1);switch(this[u].getType()){case 0:case 1:n[r]="Point";break;case 2:n[r]="Curve";break;case 3:n[r]="Line";break;case 4:n[r]="Circle",Math.abs(2*Math.PI-this[u].getArcAngle())>.001&&(n[r]="Arc");break;case 5:n[r]="Surface";break;case 6:n[r]="Plane";break;case 7:n[r]="Cylinder";break;case 8:n[r]="Cone";break;case 9:n[r]="Sphere";break;case 10:n[r]="Product"}}else n[r]="Point"}var c="";if(this.getAttribute("sSelectedType1")!==t.ViewedType.POINT&&this.getAttribute("sSelectedType1")!==t.ViewedType.CENTER&&this.getAttribute("sSelectedType2")!==t.ViewedType.POINT&&this.getAttribute("sSelectedType2")!==t.ViewedType.CENTER){var p,d,g=0;l._sMeasurable1._type===a.GeometryType.LINE&&l._sMeasurable2._type===a.GeometryType.LINE?(p=l._sMeasurable1.getAxis(),d=l._sMeasurable2.getAxis(),g=p.angleTo(d),(o.isZero(0-g)||o.isZero(Math.PI-g))&&(c="Parallel")):l._sMeasurable1._type===a.GeometryType.LINE&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.LINE?(l._sMeasurable1._type===a.GeometryType.LINE?(p=l._sMeasurable1.getAxis(),d=l._sMeasurable2._normal):(p=l._sMeasurable1._normal,d=l._sMeasurable2.getAxis()),g=p.angleTo(d),(o.isZero(.5*Math.PI-g)||o.isZero(1.5*Math.PI-g))&&(c="NormalPerpendicular")):l._sMeasurable1._type===a.GeometryType.LINE&&(l._sMeasurable2._type===a.GeometryType.CYLINDER||l._sMeasurable2._type===a.GeometryType.CONE)||(l._sMeasurable1._type===a.GeometryType.CYLINDER||l._sMeasurable1._type===a.GeometryType.CONE)&&l._sMeasurable2._type===a.GeometryType.LINE?(p=l._sMeasurable1.getAxis(),d=l._sMeasurable2.getAxis(),g=p.angleTo(d),(o.isZero(0-g)||o.isZero(Math.PI-g))&&(c="Parallel")):l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.CYLINDER&&l._sMeasurable2._type===a.GeometryType.CYLINDER||l._sMeasurable1._type===a.GeometryType.CYLINDER&&l._sMeasurable2._type===a.GeometryType.CONE||l._sMeasurable1._type===a.GeometryType.CONE&&l._sMeasurable2._type===a.GeometryType.CONE||l._sMeasurable1._type===a.GeometryType.CONE&&l._sMeasurable2._type===a.GeometryType.CYLINDER?(l._sMeasurable1.normal?p=l._sMeasurable1.normal:l._sMeasurable1._normal?p=l._sMeasurable1._normal:l._sMeasurable1.getAxis&&(p=l._sMeasurable1.getAxis()),l._sMeasurable2.normal?d=l._sMeasurable2.normal:l._sMeasurable2._normal?d=l._sMeasurable2._normal:l._sMeasurable2.getAxis&&(d=l._sMeasurable2.getAxis()),g=p.angleTo(d),(o.isZero(0-g)||o.isZero(Math.PI-g))&&(c="Parallel")):(l._sMeasurable1._type===a.GeometryType.CYLINDER&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.CONE&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.CYLINDER||l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.CONE)&&(l._sMeasurable1.normal?p=l._sMeasurable1.normal:l._sMeasurable1._normal?p=l._sMeasurable1._normal:l._sMeasurable1.getAxis&&(p=l._sMeasurable1.getAxis()),l._sMeasurable2.normal?d=l._sMeasurable2.normal:l._sMeasurable2._normal?d=l._sMeasurable2._normal:l._sMeasurable2.getAxis&&(d=l._sMeasurable2.getAxis()),g=p.angleTo(d),(o.isZero(.5*Math.PI-g)||o.isZero(1.5*Math.PI-g))&&(c="Parallel"))}e=i+n[0]+n[1]+c+"Preferences",localStorage.getItem(i+n[0]+n[1]+c+"Preferences")||(e=i+n[1]+n[0]+c+"Preferences")}return e},this.setDistanceType=function(){var e=this.getPrefNameForDistanceType();if(""!==e){var t=localStorage.getItem(e);this.setAttribute("sDistanceType",t)}};var P=this.updateRepresentation;this.updateRepresentation=function(e,t){P(e,t),this.refreshAssistantTool(e,t)},this._parentsetAttributes=this.setAttributes,this.setAttributes=function(e){var t=[];if(e&&e.length)for(var i=0;i<e.length;i++)if("lCustomization"===e[i].name){var n=e[i].value,r=n.length,o=[],a=this.getAttribute("lCustomization"),s=0,l=0;for(s=0;s<a.length;s++)o.push(a[s]);var u=o&&o.length?o.length:0;if(0===u){var c=this.getCustoListAsPerMainValue(this.getMainValueType()),p=c&&c.length?c.length:0;for(s=0;s<p;s++)o.push({custoName:c[s],custoValue:1})}if(u=o&&o.length?o.length:0)for(s=0;s<r;s++)for(l=0;l<u;l++)n[s].custoName===o[l].custoName&&(o[l].custoValue=n[s].custoValue);o.length>0&&t.push({name:"lCustomization",value:o})}else t.push({name:e[i].name,value:e[i].value});t.length>0&&this._parentsetAttributes(t)},l.measureCmdCBToken=[],l._eventController=c.giveEventsController({viewer:e}),l._eventController&&(l.measureCmdCBToken.push(l._eventController.addEvent("onSetPickThroughtRequest",()=>{r.setPickability(l,!1)})),l.measureCmdCBToken.push(l._eventController.addEvent("onUnsetPickThroughRequest",()=>{r.setPickability(l,!0)}))),this.getPointedReferences=(()=>l.getAttribute("lSelectedProducts")),this.getListPointedReferencesPath=(()=>{let e=[];var t=this.getPointedReferences();if(t&&t.length){var i=this.getParent().getAttribute("oLinksManager");if(i)for(var n=0;n<t.length;n++)if("null"!==t[n]){var r=i.getOccurrencePathElement(t[n]);r&&e.push({pathElement:r})}}return e}),this.selectPointedReferencesPath=(()=>{var e=this.getListPointedReferencesPath();e&&e.length&&(b.add(e),y.add(e))})},setAttribute:function(e,t){"fFontSize"===e?this.setAttribute("iFontSize",null):"fLineStyleThicknessIndex"===e?this._parent("fLineStyleThickness",null):"fLeaderStyleThicknessIndex"===e&&this._parent("fLeaderStyleThickness",null),this._parent(e,t)},update2DArcDisplay:function(){if(this.getAttribute("sResultingType1")===t.ResultType.CIRCLE){var e=this._sMeasurable1.getArcAngle();this.getAttribute("bArcLengthDisplay")&&e&&Math.abs(2*Math.PI-e)>.001?(this.setAttribute("sLeaderEndType","Arrow"),this.setAttribute("sExtremityType","FullCircle")):(this._sLeaderEndType&&(this._sLeaderEndType=void 0),this._sExtremityType&&(this._sExtremityType=void 0))}},updateGlobalRadiusPreference:function(e){var i;switch(i=!0===e?"DisplayRadius":"DisplayDiameter",this.getAttribute("sResultingType1")){case t.ResultType.CIRCLE:"2D"===this.getAttribute("sMeasureOnGeometryType")&&Math.abs(2*Math.PI-this._sMeasurable1._arcAngle)>.001?localStorage.setItem("DMUMeasureArcRadiusPreferences",i):localStorage.setItem("DMUMeasureCircleRadiusPreferences",i);break;case t.ResultType.CYLINDER:localStorage.setItem("DMUMeasureCylinderRadiusPreferences",i);break;case t.ResultType.SPHERE:localStorage.setItem("DMUMeasureSphereRadiusPreferences",i)}},updateFeatureAndDistanceTypePreference:function(e){if(e){this.setAttribute("sDistanceType",e);var t=this.getPrefNameForDistanceType();""!==t&&localStorage.setItem(t,e)}switch(this._local2DDistancePref){case"DMUMeasBetween2CirclesDistancePref":localStorage.setItem("DMUMeasBetween2CirclesDistancePref",e);break;case"DMUMeasBetweenCircleArcDistancePref":localStorage.setItem("DMUMeasBetweenCircleArcDistancePref",e);break;case"DMUMeasBetweenCircleAnygeomDistancePref":localStorage.setItem("DMUMeasBetweenCircleAnygeomDistancePref",e);break;case"DMUMeasBetween2ArcsDistancePref":localStorage.setItem("DMUMeasBetween2ArcsDistancePref",e);break;case"DMUMeasBetweenArcAnygeomDistancePref":localStorage.setItem("DMUMeasBetweenArcAnygeomDistancePref",e);break;case"DMUMeasBetween2ParallelLinesDistancePref":localStorage.setItem("DMUMeasBetween2ParallelLinesDistancePref",e);break;case"DMUMeasBetween2LinesDistancePref":localStorage.setItem("DMUMeasBetween2LinesDistancePref",e);break;case"DMUMeasBetween2AnyGeomsDistancePref":localStorage.setItem("DMUMeasBetween2AnyGeomsDistancePref",e)}},updateFeatureAndSurfaceDisplayTypePreference:function(e){if(e)switch(this.setAttribute("sSurfaceDisplayType",e),this._sResultingType1){case t.ResultType.CYLINDER:localStorage.setItem("DMUMeasSurfaceDisplayCylinderPref",e);break;case t.ResultType.CONE:localStorage.setItem("DMUMeasSurfaceDisplayConePref",e);break;case t.ResultType.SPHERE:localStorage.setItem("DMUMeasSurfaceDisplaySpherePref",e)}this.updateMainValueDisplayAsPerPref()},updateFeatureAndProductDisplayTypePreference:function(e){e&&(this.setAttribute("sProductDisplayType",e),localStorage.setItem("DMUMeasProductDisplayPref",e)),this.updateMainValueDisplayAsPerPref()},updateGlobalRadiusResultDisplayPreference:function(e){var i,n;"MeasureItem"===this.getAttribute("sType")&&this.getAttribute("sResultingType1")===t.ResultType.CIRCLE?(n="DMUMeasureRadiusResultDisplayPreferences",i="TANGENT",0===e&&(i="CENTER")):"Measure3PointsCircle"===this.getAttribute("sType")&&(n="DMUMeasure3PointsCircleRadiusResultDisplayPreferences",i="TANGENT",0===e&&(i="CENTER")),void 0!==i&&void 0!==n&&localStorage.setItem(n,i)},updateAngleValues:function(){var e=this.getAttribute("vAngleArcCenter"),t=this.getAttribute("vAnglePointingPoint"),i=this.getAttribute("vAngleVector1"),n=this.getAttribute("vAngleVector2"),r=this.getAttribute("fQuadrant"),o=this.getAttribute("bComplementaryAngle"),a=i.clone();1!==r&&3!==r||a.negate();var s=n.clone();2!==r&&3!==r||s.negate();var l=t.clone().sub(e).length(),u=a.clone().add(s);o&&u.negate(),t=u.normalize().multiplyScalar(l).add(e),this.setAttribute("vAnglePointingPoint",t),this.setAttribute("vAngleBreakPoint",t),this.getNode().cleanAngleCache(),this.updateAssistantToolPosition()},updateAssistantToolPosition:function(){if(this.refreshAssistantTool&&this._isInCreationState){var e,t=this.getNode().getLabelDimensions(),i=s.getViewerPositionFromPoint(this._viewer,t.position);if(this._bShortDisplay)i=s.get2DSnappedPosition(new u.Vector2(i.left,i.top));else{e=30;var n=s.convertModelToPixels({sizeInMM:t.offsetHeight});i=s.get2DSnappedPosition(new u.Vector2(i.left,i.top+n/2))}this.refreshAssistantTool({mousePosition:i,pixel:e},!0)}},updateGrpahicPropertyAsPerPref:function(){if(void 0===this._partialMeasure){var e=["Solid","Dotted","Dashed","Dot Dashed","Phantom","Small Dots","JIS Axis"].indexOf(this._preferences.find(e=>"Measure_GraphicProperties_LineType"===e.name).value)+1,t=["1","2","3","4","5","6","7","8","16","32","64"].indexOf(this._preferences.find(e=>"Measure_GraphicProperties_LineThickness"===e.name).value);0!==t&&this.setAttribute("fLineStyleThicknessIndex",t),this.setAttribute("fLeaderStyleThicknessIndex",t),this.setAttribute("sLineStylePattern",e.toString()),this.setAttribute("sLeaderStylePattern",e.toString());var i=this._preferences.find(e=>"Measure_GraphicProperties_TextBold"===e.name).value,n=this._preferences.find(e=>"Measure_GraphicProperties_TextItalic"===e.name).value;i&&n?this.setAttribute("sFontStyle","bold italic"):i?this.setAttribute("sFontStyle","bold"):n?this.setAttribute("sFontStyle","italic"):this.setAttribute("sFontStyle","normal"),this.setAttribute("bIsFilled",this._preferences.find(e=>"Measure_GraphicProperties_Fill"===e.name).value),this.setAttribute("cFillStyleColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_FillColor"===e.name).value)),this.setAttribute("fOpacity",1-this._preferences.find(e=>"Measure_GraphicProperties_FillTransparency"===e.name).value/100),this.setAttribute("bHasBorder",this._preferences.find(e=>"Measure_GraphicProperties_LineBorder"===e.name).value),this.setAttribute("cLineStyleColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_LineColor"===e.name).value)),this.setAttribute("cLeaderStyleColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_LineColor"===e.name).value)),this.setAttribute("cFontColor",new u.Color(this._preferences.find(e=>"Measure_GraphicProperties_TextColor"===e.name).value))}this.setAttribute("fFontSize",1e3*this._preferences.find(e=>"Measure_GraphicProperties_TextSize"===e.name).value)},updateMainValueDisplayAsPerPref:function(){var e,t;(t=this.getMainValueType())&&("MainValue"===(e=this.getMeasureFilterPref(t)).displayType?this.setAttribute("bShortDisplay",!0):this.setAttribute("bShortDisplay",!1),this.setAttribute("bDisplayMeasureType",e.measType),this.setAttribute("bDisplayUnit",e.unit),this.setAttribute("bDisplayApproximateSymbol",e.approx),this._sMainValueType=t,this.setCustomizationToMeasure(e.custo))},getMeasureFilterPref:function(e){var t,i,n,r,o,a=[],s=[],l=0,u=this.getCustoListAsPerMainValue(e);switch(e){case"Axis":case"Coordinates":this._preferences.forEach(e=>{e.name.includes("Coordinates_")&&(s[l++]=e)}),"Axis"===e&&(e="Coordinates");break;case"Line_Length":this._preferences.forEach(e=>{e.name.includes("Line_Length_")&&(s[l++]=e)});break;case"Curve_Length":this._preferences.forEach(e=>{e.name.includes("Curve_Length_")&&(s[l++]=e)});break;case"Arc_Length":this._preferences.forEach(e=>{e.name.includes("Arc_Length_")&&(s[l++]=e)});break;case"Cylinder_Length":this._preferences.forEach(e=>{e.name.includes("Cylinder_Length_")&&(s[l++]=e)});break;case"Cone_Length":this._preferences.forEach(e=>{e.name.includes("Cone_Length_")&&(s[l++]=e)});break;case"Distance":this._preferences.forEach(e=>{e.name.includes("Distance_")&&(s[l++]=e)});break;case"Min_Distance":"LocalMinimumDistance"===this.getAttribute("sDistanceType")?(this._preferences.forEach(e=>{e.name.includes("Local_Min_Distance_")&&(s[l++]=e)}),e="Local_Min_Distance"):this._preferences.forEach(e=>{e.name.includes("Min_Distance_")&&(s[l++]=e)});break;case"Max_Distance":"LocalMaximumDistance"===this.getAttribute("sDistanceType")?(this._preferences.forEach(e=>{e.name.includes("Local_Max_Distance_")&&(s[l++]=e)}),e="Local_Max_Distance"):this._preferences.forEach(e=>{e.name.includes("Max_Distance_")&&(s[l++]=e)});break;case"Angle_Btw2Selections":this._preferences.forEach(e=>{e.name.includes("Angle_Btw2Selections_")&&(s[l++]=e)});break;case"Angle_By3Pts":this._preferences.forEach(e=>{e.name.includes("Angle_By3Pts_")&&(s[l++]=e)});break;case"Cone_Angle":this._preferences.forEach(e=>{e.name.includes("Cone_Angle_")&&(s[l++]=e)});break;case"Half_Angle":this._preferences.forEach(e=>{e.name.includes("Half_Angle_")&&(s[l++]=e)});break;case"Radius":this._preferences.forEach(e=>{e.name.includes("Radius_")&&(s[l++]=e)});break;case"Cylinder_Radius":this._preferences.forEach(e=>{e.name.includes("Cylinder_Radius_")&&(s[l++]=e)});break;case"Sphere_Radius":this._preferences.forEach(e=>{e.name.includes("Sphere_Radius_")&&(s[l++]=e)});break;case"Min_Radius":this._preferences.forEach(e=>{e.name.includes("Min_Radius_")&&(s[l++]=e)});break;case"Max_Radius":this._preferences.forEach(e=>{e.name.includes("Max_Radius_")&&(s[l++]=e)});break;case"Radius_By3Pts":this._preferences.forEach(e=>{e.name.includes("Radius_By3Pts_")&&(s[l++]=e)});break;case"Diameter":this._preferences.forEach(e=>{e.name.includes("Diameter_")&&(s[l++]=e)});break;case"Cylinder_Diameter":this._preferences.forEach(e=>{e.name.includes("Cylinder_Diameter_")&&(s[l++]=e)});break;case"Sphere_Diameter":this._preferences.forEach(e=>{e.name.includes("Sphere_Diameter_")&&(s[l++]=e)});break;case"Min_Diameter":this._preferences.forEach(e=>{e.name.includes("Min_Diameter_")&&(s[l++]=e)});break;case"Max_Diameter":this._preferences.forEach(e=>{e.name.includes("Max_Diameter_")&&(s[l++]=e)});break;case"Diameter_By3Pts":this._preferences.forEach(e=>{e.name.includes("Diameter_By3Pts_")&&(s[l++]=e)});break;case"Surface_Area":this._preferences.forEach(e=>{e.name.includes("Surface_Area_")&&(s[l++]=e)});break;case"PlanarSurface_Area":this._preferences.forEach(e=>{e.name.includes("PlanarSurface_Area_")&&(s[l++]=e)});break;case"Product_Area":this._preferences.forEach(e=>{e.name.includes("Product_Area_")&&(s[l++]=e)});break;case"Volume":this._preferences.forEach(e=>{e.name.includes("Volume_")&&(s[l++]=e)});break;case"Thickness":this._preferences.forEach(e=>{e.name.includes("Thickness_")&&(s[l++]=e)})}for(t=0;t<s.length;t++)if(s[t].name===e+"_DisplayType")i=s[t].value;else if(s[t].name===e+"_MeasureType")n=s[t].value;else if(s[t].name===e+"_Unit")o=s[t].value;else if(s[t].name===e+"_ApproximatedValueSymbol")r=s[t].value;else for(l=0;l<u.length;l++)s[t].name.toLowerCase()===(e+"_"+u[l]).toLowerCase()&&(a[l]=s[t].value);return{displayType:i,measType:n,unit:o,approx:r,custo:a}},getMainValueType:function(){var e;if("MeasureItem"===this._sType){var i=this.getAttribute("sResultingType1");switch(i){case t.ResultType.AXIS:e="Axis";break;case t.ResultType.POINT:case t.ResultType.PICKINGPT:case t.ResultType.CENTER:e="Coordinates";break;case t.ResultType.CURVE:e="Curve_Length";break;case t.ResultType.LINE:e="Line_Length";break;case t.ResultType.CIRCLE:e=this.getAttribute("bArcLengthDisplay")?"Arc_Length":this.getAttribute("bRadiusDisplay")?"Radius":"Diameter";break;case t.ResultType.CYLINDER:case t.ResultType.SPHERE:var n=this.getAttribute("sSurfaceDisplayType");e="Cylinder_",i===t.ResultType.SPHERE&&(e="Sphere_"),i===t.ResultType.CYLINDER&&"Length"===n?e+="Length":"Area"===n?e="Surface_Area":this.getAttribute("bRadiusDisplay")?e+="Radius":e+="Diameter";break;case t.ResultType.PLANE:e="PlanarSurface_Area";break;case t.ResultType.SURFACE:e="Surface_Area";break;case t.ResultType.CONE:e="Half_Angle";var r=this.getAttribute("sSurfaceDisplayType");"HalfAngle"===r?e="Half_Angle":"Angle"===r?e="Cone_Angle":"Length"===r?e="Cone_Length":"MaximumRadius"===r?e="Max_Radius":"MaximumDiameter"===r?e="Max_Diameter":"MinimumRadius"===r?e="Min_Radius":"MinimumDiameter"===r?e="Min_Diameter":"Area"===r&&(e="Surface_Area");break;case t.ResultType.PRODUCT:e="Volume";var o=this.getAttribute("fVolume");"Area"!==this.getAttribute("sProductDisplayType")&&0!==o&&void 0!==o||(e="Product_Area")}}else if("MeasureBetween"===this._sType){switch(this.getAttribute("sDistanceType")){case"Angle":e="Angle_Btw2Selections";break;case"Distance":e="Distance";break;case"MinimumDistance":case"LocalMinimumDistance":e="Min_Distance";break;case"MaximumDistance":case"LocalMaximumDistance":e="Max_Distance";break;default:"Min_Distance"}}else if("MeasureThickness"===this._sType)e="Thickness";else if("Measure3PointsCircle"===this._sType)e=this.getAttribute("bRadiusDisplay")?"Radius_By3Pts":"Diameter_By3Pts";else if("Measure3PointsAngle"===this._sType){e="Angle_By3Pts","Angle"===this.getAttribute("sDistanceType")||(e=this.getAttribute("bRadiusDisplay")?"Radius_By3Pts":"Diameter_By3Pts")}return e},getMeasurable:function(e){return this["_sMeasurable"+e]},setMeasurable:function(e,t){var i=this;if(this["_sMeasurable"+e])for(var n=this["_sMeasurableNode"+e],o=this["_sMeasurableToken"+e],a=0;a<n.length;a++)n[a].modelEvents.unsubscribe(o[a]);if(this["_sMeasurable"+e]=t,t){var s=[],u=[],c=t.getPathElement(),p=t.getLevel(),d=p?r.truncatePathElement(c,p).externalPath:c.externalPath,g={event:"move"};this.updateAfterEvent=function(){i.update()};for(var h=0;h<d.length;h++){var b=d[h];r.isInstance(b)&&(void 0===b.modelEvents&&(b.modelEvents=new l),s.push(b),u.push(b.modelEvents.subscribe(g,this.updateAfterEvent)))}this["_sMeasurableNode"+e]=s,this["_sMeasurableToken"+e]=u}},remove:function(){let e=this;var t=d.giveDMUMarkupsController({context:this._viewer});if(t&&t.unregisterMarker(this),d.unreferenceDMUMarkupsController({context:this._viewer}),e._eventController&&e.measureCmdCBToken&&e.measureCmdCBToken.forEach(t=>{e._eventController.removeEvent(t)}),this._parent(),this._paneltop&&this._paneltop.destroy(),this.setMeasurable(1,void 0),this.setMeasurable(2,void 0),this.setMeasurable(3,void 0),this._lockedNodes){var i=c.getContextViewer({viewer:this._viewer});i.getController&&i.getController().unlockNodes({ids:this._lockedNodes}),this.clearLockedNodes()}e._isInCreationState&&!e._bPrevisualized&&(this._eventController||(this._eventController=c.giveEventsController({viewer:this._viewer})),this._eventController&&this._eventController.fireEvent("onMeasureDeleteWhileActiveCmd"))},update:function(){this._doNotRefresh=!0;var e,s,l=[],d=[],g=[],h={},b="NA",y="NA",P="NA",f=!1,w=this;function S(e){return e&&!e.isNaN()&&e.min&&e.max&&!e.min.equals(e.max)}if("2D"===this.getAttribute("sMeasureOnGeometryType")&&(f=!0),"MeasureItem"===this._sType){var M=(h=n.measureItem(this._sMeasurable1,this.getAttribute("sSelectedType1"),!1,function(e){if(!e||!e.getBoundingBox||!e.getBoundingBox)return;var t=e.getBoundingBox(void 0,w._viewer,"visibleSpace"),i=e.getBoundingBox(void 0,w._viewer,"invisibleSpace");let n=e.getWorldMatrix();return S(t)&&S(i)?t.mergeWithBox(i):S(i)&&(t=i),n&&t.applyMatrix4(n),t})).position;this._sResultingType1===t.ResultType.CIRCLE&&0===this.getAttribute("iRadiusResultDisplayType")&&(M=h.arcMidPoint.clone()),g.push({attribute:"vLeaderPointingPoint3D",value:M}),g.push({attribute:"vLeaderBreakPoint3D",value:M}),this._oProduct1=h.product,l.push(this._oProduct1),d.push(this._sMeasurable1._pathElement);var D=this.getAttribute("sSurfaceDisplayType");s="Approximate";var T=this.getMeasurable(1);switch(T&&T.getMode()===a.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this._sResultingType1){case t.ResultType.POINT:case t.ResultType.PICKINGPT:case t.ResultType.CENTER:b="Cross",y="None",g.push({attribute:"vPosition",value:h.position});break;case t.ResultType.LINE:case t.ResultType.AXIS:case t.ResultType.CURVE:this._sMeasurable1._type===a.GeometryType.CIRCLE?g.push({attribute:"fLength",value:h.arcLength}):g.push({attribute:"fLength",value:h.length}),this._sResultingType1!==t.ResultType.LINE&&this._sResultingType1!==t.ResultType.CURVE||(P="FullCircle"),this._sResultingType1!==t.ResultType.AXIS&&this._sResultingType1!==t.ResultType.CURVE||(b="Arrow");break;case t.ResultType.CIRCLE:g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"vCenter",value:h.center}),g.push({attribute:"vNormal",value:h.normal}),g.push({attribute:"vArcMidPoint",value:h.arcMidPoint});var _=this._sMeasurable1.getArcAngle();f&&this.getAttribute("bArcLengthDisplay")&&_&&Math.abs(2*Math.PI-_)>.001&&(b="Arrow",P="FullCircle");break;case t.ResultType.PLANE:b="Bubble",g.push({attribute:"vOrigin",value:h.origin}),g.push({attribute:"vNormal",value:h.normal}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog});break;case t.ResultType.CYLINDER:g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog}),g.push({attribute:"fHeight",value:h.height}),this._vPoint1=h.point1,this._vPoint2=h.point2,this._vAxis=h.point2.clone().sub(h.point1);var C=this._vPoint1.clone().add(this._vPoint2).multiplyScalar(.5);g.push({attribute:"vCenter",value:C}),this._sMeasurable1.center=C.clone(),this._sMeasurable1.normal=this._vAxis.clone(),e=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(e),"Length"===D?P="FullCircle":"Area"===D&&(b="Bubble");break;case t.ResultType.CONE:g.push({attribute:"vApex",value:h.apex}),g.push({attribute:"fSemiAngle",value:h.semiAngle}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog}),g.push({attribute:"fRadius",value:h.minRadius}),g.push({attribute:"fMaxRadius",value:h.maxRadius}),g.push({attribute:"fHeight",value:h.height}),this._vPoint1=h.point1,this._vPoint2=h.point2,this._vAxis=h.axis,g.push({attribute:"vCenter",value:this._vPoint2.clone()}),e=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(e),"Length"===D?P="FullCircle":"Area"===D&&(b="Bubble");break;case t.ResultType.SPHERE:g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"vCenter",value:h.center}),g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog});break;case t.ResultType.SURFACE:b="Bubble",g.push({attribute:"fArea",value:h.area}),g.push({attribute:"vCog",value:h.cog});break;case t.ResultType.PRODUCT:b="Square";this._removeAttribute(["fVolume","fArea","vCog","aabb","fLength"]),h.volume&&h.volume>0?g.push({attribute:"fVolume",value:h.volume}):g.push({attribute:"sProductDisplayType",value:"Area"}),h.area&&h.area>0&&g.push({attribute:"fArea",value:h.area}),h.cog&&g.push({attribute:"vCog",value:h.cog}),h.aabb&&g.push({attribute:"aabb",value:h.aabb}),h.length&&h.length>0&&g.push({attribute:"fLength",value:h.length})}"NA"!==b&&g.push({attribute:"sLeaderEndType",value:b}),"NA"!==y&&g.push({attribute:"sPointType",value:y}),"NA"!==P&&g.push({attribute:"sExtremityType",value:P}),this.set(g),this._buildConstructionData(h)}else if("MeasureBetween"===this._sType){if(f){var R=this.getAttribute("sSelectedType1"),x=this.getAttribute("sSelectedType2"),L=this.getAttribute("sDistanceType");"Distance"!==L&&(R===t.ViewedType.POINT&&x===t.ViewedType.POINT||this.getAttribute("sResultingType1")===t.ResultType.POINT&&this.getAttribute("sResultingType2")===t.ResultType.POINT)&&(L="Distance",this.setAttribute("sDistanceType",L)),h=n.measureBetween2DGeometries(L,this._sMeasurable1,R,this._sMeasurable2,x)}else h=n.measureBetween(this._sMeasurable1,this.getAttribute("sSelectedType1"),this._sMeasurable2,this.getAttribute("sSelectedType2"),!1,this.getAttribute("sDistanceType"),v.isEnvActivated("measurebetweenCylConeOldAlgo",!0));if(void 0!==h.aPosition1&&void 0!==h.aPosition2){h.product1&&(this._oProduct1=h.product1,this._oProduct1.externalPath&&this._oProduct1.getLength()>0?l.push(this._oProduct1.getLastElement()):l.push(this._oProduct1)),d.push(this._sMeasurable1._pathElement),h.product2&&(this._oProduct2=h.product2,this._oProduct2.externalPath&&this._oProduct2.getLength()>0?l.push(this._oProduct2.getLastElement()):l.push(this._oProduct2)),d.push(this._sMeasurable2._pathElement),this._duration=h.duration,g.push({attribute:"fDistance",value:void 0!==h.distance?h.distance:0});var E=void 0!==h.angle?h.angle:0;g.push({attribute:"fAngle",value:E}),void 0===E||o.isZero(E)||(g.push({attribute:"fQuadrant",value:0}),g.push({attribute:"bComplementaryAngle",value:!1})),g.push({attribute:"sSelectedType1",value:h.type1}),g.push({attribute:"sSelectedType2",value:h.type2}),o.isZero(E)?this.getAttribute("sResultingType1")===t.ResultType.PLANE&&this.getAttribute("sResultingType2")===t.ResultType.PLANE?y="FullCircle":this.getAttribute("sResultingType1")===t.ResultType.AXIS&&this.getAttribute("sResultingType2")===t.ResultType.AXIS||(y="Cross"):f&&"Angle"!==this.getAttribute("sDistanceType")&&(y="Cross"),e=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(e),"NA"!==y&&g.push({attribute:"sPointType",value:y}),s="Approximate",this._sMeasurable1.getMode()===a.Mode.EXACT&&this._sMeasurable2.getMode()===a.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this.set(g),this._buildConstructionData(h)}}else if("MeasureThickness"===this._sType){var V,N,k=this._sMeasurable1.getSelPoint(),I=this._sMeasurable1.getSelNormal(),F=[];if(null!=I&&null!=k){V=I.clone().negate(),N=I.clone().normalize().multiplyScalar(.1).add(k);var O=p.computeRayProductInterferences(N.toArray(),V.toArray(),[this._sMeasurable1.getPathElement()]);0===O.returnCode&&(F=O.aIntersections)}var B,U=F&&F.length>0&&F[0].primitive?THREEDS.SubElement.getFromSGNode(F[0].primitive):void 0;B=!!U&&3===U.getBodyDimension()&&F[1]?function(e,t){var n=new u.Matrix4;t&&t.getWorldMatrix?n.getInverse(t.getWorldMatrix()):(n.makeBasis(new u.Vector3(1,0,0),new u.Vector3(0,1,0),new u.Vector3(0,0,1)),n.setPosition(new u.Vector3(0,0,0)));var r=e.point.clone();r.applyMatrix4(n);var o={type:a.GeometryType.POINT,primitive:e.primitive,position:r};return new i({canonic:o,pathElement:t})}(F[1],this._sMeasurable1.getPathElement()):this._sMeasurable1.clone(),this.setMeasurable(2,B),g.push({attribute:"sSelectedType1",value:t.ViewedType.POINT}),g.push({attribute:"sSelectedType2",value:t.ViewedType.POINT}),g.push({attribute:"sResultingType1",value:t.ResultType.POINT}),g.push({attribute:"sResultingType2",value:t.ResultType.POINT}),h=n.measureBetween(this._sMeasurable1,t.ViewedType.POINT,this._sMeasurable2,t.ViewedType.POINT),this._oProduct1=h.product1,l.push(this._oProduct1),d.push(this._sMeasurable1._pathElement),this._oProduct2=h.product2,l.push(this._oProduct2),d.push(this._sMeasurable2._pathElement),g.push({attribute:"fDistance",value:void 0!==h.distance?h.distance:0}),g.push({attribute:"fAngle",value:0}),s="Approximate",g.push({attribute:"sComputationMode",value:s}),this.set(g),this._buildConstructionData(h)}else"Measure3PointsCircle"===this._sType?(e=["sLeaderEndType","sExtremityType"],this._removeAttribute(e),y="Cross",g.push({attribute:"sPointType",value:y}),h=n.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3),g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"fAngle",value:h.angle}),g.push({attribute:"vCenter",value:h.center.clone()}),g.push({attribute:"vNormal",value:h.normal.clone()}),s="Approximate",this._sMeasurable1.getMode()===a.Mode.EXACT&&this._sMeasurable2.getMode()===a.Mode.EXACT&&this._sMeasurable3.getMode()===a.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this.set(g),h.position=h.center.clone(),this._buildConstructionData(h)):"Measure3PointsAngle"===this._sType&&(e=["sLeaderEndType","sExtremityType"],this._removeAttribute(e),y="Cross",g.push({attribute:"sPointType",value:y}),h=n.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3),g.push({attribute:"fQuadrant",value:0}),g.push({attribute:"bComplementaryAngle",value:!1}),g.push({attribute:"fRadius",value:h.radius}),g.push({attribute:"fAngle",value:h.angle}),g.push({attribute:"vCenter",value:h.center.clone()}),g.push({attribute:"vNormal",value:h.normal.clone()}),s="Approximate",this._sMeasurable1.getMode()===a.Mode.EXACT&&this._sMeasurable2.getMode()===a.Mode.EXACT&&this._sMeasurable3.getMode()===a.Mode.EXACT&&(s="Exact"),g.push({attribute:"sComputationMode",value:s}),this.set(g),h.position=this._sMeasurable2.getSelPoint(),this._buildConstructionData(h));if(this._doNotRefresh=!1,!f&&l.length>0){var z=[0,1];if(l.length>0&&"3dPlay"!==w._typeApps){var G=d.length,H=!1,J=c.getContextViewer({viewer:this._viewer});if(J&&J.getRoots&&J.getRoots().length>0){var q=J.getController();q&&q.getRootStats(r.getNodeID(J.getRoots()[0]))&&(m.getSetting("enopad3dviewer_lightNodeModel")?H=!0:m.getSetting("enopad3dviewer_dynamicRepLoading")&&(H=!0))}for(var X=0;X<G;X++)if(r.isAPOIPath(d[X])){var W=A.getPOIInformationFromPathElement(d[X]);W&&void 0!==W.relatedPath&&r.getRefInstNames({path:W.relatedPath,callback:function(e){void 0!==e.name&&(w["_oProduct"+(z[e.forPathNum]+1)+"Name"]=e.name,w.refreshNode(!(w._bPrevisualized&&"MeasureThickness"===w._sType)))},context:J,pathNum:X,fromNode:!H})}else r.getRefInstNames({path:d[X],callback:function(e){void 0!==e.name&&(w["_oProduct"+(z[e.forPathNum]+1)+"Name"]=e.name,w.refreshNode(!(w._bPrevisualized&&"MeasureThickness"===w._sType)))},context:J,pathNum:X,fromNode:!H})}}this.updateMainValueDisplayAsPerPref(),this.updateGrpahicPropertyAsPerPref(),this.refreshNode(!(this._bPrevisualized&&"MeasureThickness"===this._sType))},addLockedNode:function(e){void 0===this._lockedNodes&&(this._lockedNodes=[]),this._lockedNodes.push(e)},getLockedNodes:function(){return this._lockedNodes},isNodeLocked:function(e){var t=!1;return this._lockedNodes&&-1!==this._lockedNodes.indexOf(e)&&(t=!0),t},clearLockedNodes:function(){this._lockedNodes=[]},updatePrdIDAsPerSelectedLevel:function(){var e=this.getParent().getAttribute("oLinksManager"),t=this._sMeasurable1.getPathElement(),i=this._sMeasurable1.getLevel(),n=i?r.truncatePathElement(t,i):t;if(n){var o=e.getOccurrence({pathElement:n},!0);o&&o.id&&this.setAttribute("lSelectedProducts",[o.id])}},_buildConstructionData:function(e){var i,n,r,l,c,p,d,g,h,b,y,m,v,A,f,w,S,M,D,T=30,_=[];if(this.setAttribute("lSelectedProducts",void 0),"MeasureItem"===this._sType){var C=this.getAttribute("sSurfaceDisplayType");switch(this._sResultingType1){case t.ResultType.POINT:case t.ResultType.PICKINGPT:this._buildConstructionPointsForLeader(1.4*T,e.position);break;case t.ResultType.CENTER:this._buildConstructionPointsForLeader(1.4*T,e.center);break;case t.ResultType.LINE:this._buildConstructionPointsForDimension(T,e.point1,e.point2);break;case t.ResultType.AXIS:this._buildConstructionPointsForLeader(T,e.point1.clone().add(e.point2).multiplyScalar(.5));break;case t.ResultType.CIRCLE:var R=[];if(n=this.getAttribute("fRadius"),r=this.getAttribute("vNormal"),T=.2*n,c=s.getViewpointInfo(this._viewer.currentViewpoint),l=(new u.Vector3).crossVectors(r,c.sight),i=this.getAttribute("vCenter"),0!==this.getAttribute("iRadiusResultDisplayType"))l=this.getAttribute("vArcMidPoint").clone().sub(i);if(l.length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),b=(new u.Vector3).crossVectors(r,l).normalize(),Math.abs(r.angleTo(c.sight)-Math.PI/2)<Math.PI/10?((b=r.clone().normalize()).dot(c.up)<0&&b.negate(),y=b.clone().multiplyScalar(T)):y=b.clone().multiplyScalar(T+n),0!==this.getAttribute("iRadiusResultDisplayType")&&(y=b.clone().multiplyScalar(T+n)),R.push({attribute:"iExtensionLinesManipulable",value:0}),m=i.clone().add(l),v=i.clone().sub(l),g=m.clone().add(y),h=v.clone().add(y),0===this.getAttribute("iRadiusResultDisplayType")){var x=this._sMeasurable1.getSelPoint().clone().sub(i.clone());x=x.normalize();var L=n+s.getDistanceFromPixel(this._viewer,this._sMeasurable1.getSelPoint().clone(),70);x=x.multiplyScalar(L),A=i.clone().add(x)}else A=g.clone().add(h).multiplyScalar(.5);R.push({attribute:"vLeaderBreakPoint3D",value:A}),R.push({attribute:"vLeaderPointingPoint3D",value:A}),R.push({attribute:"vFirstPoint3D",value:g}),R.push({attribute:"vSecondPoint3D",value:h}),R.push({attribute:"vFirstExtensionPoint3D",value:m}),R.push({attribute:"vSecondExtensionPoint3D",value:v}),R.push({attribute:"vExtensionDirection3D",value:b}),this.set(R);break;case t.ResultType.CURVE:this._buildConstructionPointsForLeader(T,e.position);break;case t.ResultType.PLANE:case t.ResultType.SURFACE:void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(T,e.position):this._buildConstructionPointsForLeader(T,this.getAttribute("vCog"));break;case t.ResultType.CYLINDER:n=this.getAttribute("fRadius"),i=this.getAttribute("vCenter"),c=s.getViewpointInfo(this._viewer.currentViewpoint),(l=(new u.Vector3).crossVectors(this._vAxis,c.sight)).length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),p=i.clone().add(l),d=i.clone().sub(l),"Length"===C?this._buildConstructionPointsForDimension(T,this.getAttribute("vPoint1"),this.getAttribute("vPoint2")):"Area"===C?void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(T,e.position):this._buildConstructionPointsForLeader(T,this.getAttribute("vCog")):this._buildConstructionPointsForLeader(T,p,d);break;case t.ResultType.CONE:var E=this.getAttribute("vApex"),V=this.getAttribute("fSemiAngle");i=this.getAttribute("vCenter"),n=E.clone().sub(this._vPoint2).length()*Math.tan(V),c=s.getViewpointInfo(this._viewer.currentViewpoint),(l=(new u.Vector3).crossVectors(this._vAxis,c.sight)).length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),p=i.clone().add(l),d=i.clone().sub(l),"Length"===C?this._buildConstructionPointsForDimension(T,this.getAttribute("vPoint1"),this.getAttribute("vPoint2")):"Area"===C?void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(T,e.position):this._buildConstructionPointsForLeader(T,this.getAttribute("vCog")):this._buildConstructionPointsForLeader(T,p,d);break;case t.ResultType.SPHERE:n=this.getAttribute("fRadius"),i=this.getAttribute("vCenter"),l=(c=s.getViewpointInfo(this._viewer.currentViewpoint)).right.clone().normalize().multiplyScalar(n),p=i.clone().add(l),d=i.clone().sub(l),this._buildConstructionPointsForLeader(T,p,d);break;case t.ResultType.PRODUCT:this._buildConstructionPointsForLeader(T,this.getAttribute("vLeaderPointingPoint3D")),this.updatePrdIDAsPerSelectedLevel()}}else if("MeasureBetween"===this._sType||"MeasureThickness"===this._sType){if(this._sResultingType1===t.ResultType.PLANE&&this._sResultingType2===t.ResultType.PLANE)if(0===this.getAttribute("fDistance")&&0!==this.getAttribute("fAngle"))g=e.position2.clone(),h=e.position1.clone();else{var N=e.position2.clone().sub(e.position1);h=(g=e.position1.clone()).clone().add(N)}else g=e.position1.clone(),h=e.position2.clone();var k,I,F=this.getAttribute("sDistanceType");if("Distance"!==F&&"MinimumDistance"!==F&&"MaximumDistance"!==F||!e.extensionDirection?"Angle"!==F&&_.push({attribute:"iExtensionLinesManipulable",value:1}):_.push({attribute:"iExtensionLinesManipulable",value:0}),"Distance"===F){let t=this._sMeasurable1.getAxis(),i=this._sMeasurable2.getAxis();if(this._sMeasurable1.getType()!==a.GeometryType.CIRCLE&&t&&this._sMeasurable2.getType()!==a.GeometryType.CIRCLE&&i){let n=e.angle;if((void 0===n||isNaN(n))&&(n=t.angleTo(i)),!isNaN(n)&&(o.isZero(n)||o.isZero(Math.PI-n)))if(I=this._sMeasurable2.getSelPoint(),this._sMeasurable2._type===a.GeometryType.CYLINDER||this._sMeasurable2._type===a.GeometryType.CONE){let e=this._sMeasurable2.getPoints(),t=this._sMeasurable2.getAxis();c=s.getViewpointInfo(this._viewer.currentViewpoint);var O=P.computeTwoLinesDistance(I.toArray(),c.sight.toArray(),this._sMeasurable2.getPoints().beginPoint.toArray(),t.toArray()).aPosition2;O?k=new u.Vector3(O[0],O[1],O[2]):(O=P.computePointLineDistance(I.toArray(),e.endPoint.toArray(),t.toArray()).aPosition)&&(k=new u.Vector3(O[0],O[1],O[2]))}else k=this._sMeasurable2.getSelPoint()}}if(this._buildConstructionPointsForDimension(T,g,h,e.extensionDirection,{dimensionPosition:k,secondSelPoint:I}),"MeasureBetween"===this._sType){var B,U;if(void 0!==(D=this.getAttribute("fAngle"))&&!o.isZero(D)){var z;m=this.getAttribute("vFirstExtensionPoint3D"),B=(v=this.getAttribute("vSecondExtensionPoint3D")).clone();var G,H,J=this._sMeasurable1.getSelPoint(),q=this._sMeasurable2.getSelPoint();if(this._sSelectedType1===t.ViewedType.INFPLANE&&this._sSelectedType2!==t.ViewedType.INFPLANE||this._sSelectedType2===t.ViewedType.INFPLANE&&this._sSelectedType1!==t.ViewedType.INFPLANE){var X=this._sMeasurable1,W=this._sMeasurable2;this._sSelectedType2===t.ViewedType.INFPLANE&&(X=this._sMeasurable2,W=this._sMeasurable1);var Z=X.getPlane(),j=(new u.Plane).setFromNormalAndCoplanarPoint(Z.normal,Z.origin),Y=j.projectPoint(W.getPoints().beginPoint),Q=j.projectPoint(W.getPoints().endPoint).sub(Y);if(Q.length()>0){var K=P.computePointLineDistance(X.getSelPoint().toArray(),B.toArray(),Q.toArray());0===K.returnCode&&(G=new u.Vector3(K.aPosition[0],K.aPosition[1],K.aPosition[2]),this._sSelectedType2===t.ViewedType.INFPLANE?q=G:J=G)}}c=s.getViewpointInfo(this._viewer.currentViewpoint),this.computeAngleVector=function(e,i,n,r){var a,s,l,p,d=i.getPoints();if(e===t.ViewedType.CYCOSP||e===t.ViewedType.AXIS){var g=i.getAxis(),h=P.computeTwoLinesDistance(r.toArray(),c.sight.toArray(),i.getPoints().beginPoint.toArray(),g.toArray());0===h.returnCode&&(r=new u.Vector3(h.aPosition2[0],h.aPosition2[1],h.aPosition2[2]))}return a=r.clone().sub(n),o.isZero(a.length())&&(s=(a=d.beginPoint.clone().sub(n)).length(),p=(l=d.endPoint.clone().sub(n)).length(),(o.isZero(s)||p<s&&!o.isZero(p))&&(a=l)),a},f=this.computeAngleVector(this._sSelectedType1,this._sMeasurable1,m,J),w=this.computeAngleVector(this._sSelectedType2,this._sMeasurable2,v,q),D=f.angleTo(w),M=w.length();var $=(new u.Vector3).crossVectors(f.clone(),w.clone());this._sMeasurable2.getType()!==a.GeometryType.LINE&&(z=P.computeLinePlaneDistance(this._sMeasurable2.getSelPoint().toArray(),c.sight.toArray(),B.toArray(),$.toArray()))&&0===z.returnCode&&z.relationship===a.Relationship.INTERSECTING&&(M=new u.Vector3(z.aPosition[0],z.aPosition[1],z.aPosition[2]).distanceTo(B),w.normalize().multiplyScalar(M)),f.normalize().multiplyScalar(M),U=(S=f.clone().add(w)).normalize().multiplyScalar(M).add(B);var ee,te=[],ie=[],ne=!1,re=!1;e.relationship!==a.Relationship.NONE||this._sSelectedType1!==t.ViewedType.CYCOSP&&this._sMeasurable1.getType()!==a.GeometryType.LINE?0===(z=this._sMeasurable1.getLimitPoints($,B)).returnCode?(te=[z.firstLimit,z.secondLimit],_.push({attribute:"lFirstExtensionPoints",value:te})):(ee=this._sMeasurable1.getSelPoint(),this._sMeasurable1.getType()===a.GeometryType.PLANE&&0===(z=P.computePointLineDistance(ee.toArray(),B.clone().toArray(),f.toArray())).returnCode&&(te=[ee=new u.Vector3(z.aPosition[0],z.aPosition[1],z.aPosition[2]),ee],_.push({attribute:"lFirstExtensionPoints",value:te}),ne=!0)):(G=this._sMeasurable1.getPoints().beginPoint,H=this._sMeasurable1.getPoints().endPoint,0===(z=P.computePointLineDistance(G.toArray(),B.clone().toArray(),f.toArray())).returnCode&&(G=new u.Vector3(z.aPosition[0],z.aPosition[1],z.aPosition[2])),0===(z=P.computePointLineDistance(H.toArray(),B.clone().toArray(),f.toArray())).returnCode&&(H=new u.Vector3(z.aPosition[0],z.aPosition[1],z.aPosition[2])),te=[G,H,void 0],_.push({attribute:"lFirstExtensionPoints",value:te}),ne=!0),0===(z=this._sMeasurable2.getLimitPoints($,B)).returnCode?(ie=[z.firstLimit,z.secondLimit],_.push({attribute:"lSecondExtensionPoints",value:ie})):(ee=this._sMeasurable2.getSelPoint(),this._sMeasurable2.getType()===a.GeometryType.PLANE&&0===(z=P.computePointLineDistance(ee.toArray(),B.clone().toArray(),w.toArray())).returnCode&&(te=[ee=new u.Vector3(z.aPosition[0],z.aPosition[1],z.aPosition[2]),ee],_.push({attribute:"lSecondExtensionPoints",value:te}),re=!0)),_.push({attribute:"lbExtensionRequired",value:[ne,re]})}_.push({attribute:"fAngle",value:D}),_.push({attribute:"vAngleArcCenter",value:B}),_.push({attribute:"vAnglePointingPoint",value:U}),_.push({attribute:"vAngleBreakPoint",value:U}),_.push({attribute:"vAngleVector1",value:f}),_.push({attribute:"vAngleVector2",value:w}),this.set(_)}}else if("Measure3PointsCircle"===this._sType)n=this.getAttribute("fRadius"),r=this.getAttribute("vNormal"),i=this.getAttribute("vCenter"),_.push({attribute:"fAngle",value:0}),T=.2*n,c=s.getViewpointInfo(this._viewer.currentViewpoint),(l=(new u.Vector3).crossVectors(r,c.sight)).length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),y=(b=(new u.Vector3).crossVectors(r,l).normalize()).clone().multiplyScalar(T+n),m=i.clone().add(l),v=i.clone().sub(l),g=m.clone().add(y),h=v.clone().add(y),A=0===this.getAttribute("iRadiusResultDisplayType")?m.clone():this.getAttribute("bRadiusDisplay")?h.clone().sub(g).multiplyScalar(.25).add(g):g.clone().add(h).multiplyScalar(.5),_.push({attribute:"vExtensionDirection3D",value:b}),_.push({attribute:"vFirstExtensionPoint3D",value:m}),_.push({attribute:"vSecondExtensionPoint3D",value:v}),_.push({attribute:"vFirstPoint3D",value:g}),_.push({attribute:"vSecondPoint3D",value:h}),_.push({attribute:"vLeaderBreakPoint3D",value:A}),_.push({attribute:"vLeaderPointingPoint3D",value:A.clone()}),this.set(_);else if("Measure3PointsAngle"===this._sType){_.push({attribute:"fDistance",value:0}),f=this._sMeasurable1.getSelPoint().sub(this._sMeasurable2.getSelPoint()),w=this._sMeasurable3.getSelPoint().sub(this._sMeasurable2.getSelPoint()),S=f.clone().add(w),M=w.length();var oe=S.normalize().multiplyScalar(M).add(this._sMeasurable2.getSelPoint());D=f.angleTo(w),_.push({attribute:"fAngle",value:D}),_.push({attribute:"vAngleVector1",value:f}),_.push({attribute:"vAngleVector2",value:w}),_.push({attribute:"vAngleArcCenter",value:this._sMeasurable2.getSelPoint()}),_.push({attribute:"vAnglePointingPoint",value:oe.clone()}),_.push({attribute:"vAngleBreakPoint",value:oe.clone()}),_.push({attribute:"vLeaderBreakPoint3D",value:oe.clone()}),_.push({attribute:"vLeaderPointingPoint3D",value:oe.clone()}),_.push({attribute:"vFirstExtensionPoint3D",value:oe.clone()}),_.push({attribute:"vSecondExtensionPoint3D",value:oe.clone()}),_.push({attribute:"vFirstPoint3D",value:oe.clone()}),_.push({attribute:"vSecondPoint3D",value:oe.clone()}),this.set(_)}},_buildConstructionPointsForConeCylSphere:function(){var e,i,n,r,o,a,l,c={oPos1:void 0,oPos2:void 0};if(this._sResultingType1===t.ResultType.CONE){var p=this._sMeasurable1.getApex(),d=this._sMeasurable1.getSemiAngle(),g=this.getAttribute("sSurfaceDisplayType");n=this._sMeasurable1.getPoints(),e="MinimumRadius"===g||"MinimumDiameter"===g?n.beginPoint:n.endPoint;var h=p.clone().sub(e).length()*Math.tan(d)/Math.sin(d);void 0===(l=this._sMeasurable1.getSelPoint())&&(e=this.getAttribute("vCenter"),a=p.clone().sub(e).length()*Math.tan(d),o=s.getViewpointInfo(this._viewer.currentViewpoint),(r=(new u.Vector3).crossVectors(this._vAxis,o.sight)).length()>.001?r.normalize().multiplyScalar(a):r=o.right.clone().normalize().multiplyScalar(a),l=e.clone().add(r));var b=l.clone().sub(p);b=b.normalize().multiplyScalar(h),c.oPos1=p.clone().add(b),this._sMeasurable1.vSlat=b,this._sMeasurable1.vAxis=e.clone().sub(p);var y=p.clone().sub(n.beginPoint).length()*Math.tan(d);if(y>.001){var m=y/Math.sin(d);this._sMeasurable1.arcRadius=m+Math.abs(h-m)/2}else this._sMeasurable1.arcRadius=h/2;i=c.oPos1.clone().sub(e),c.oPos2=e.clone().sub(i);var v,P=c.oPos2.clone().sub(p);this._sMeasurable1.vSlat1=P,v="Angle"===g?this._sMeasurable1.vAxis.clone():b.clone().add(this._sMeasurable1.vAxis),this._sMeasurable1.arcCenter=v.normalize().multiplyScalar(this._sMeasurable1.arcRadius).add(p.clone())}else if(this._sResultingType1===t.ResultType.CYLINDER){void 0===(l=this._sMeasurable1.getSelPoint())&&(a=this.getAttribute("fRadius"),o=s.getViewpointInfo(this._viewer.currentViewpoint),(r=(new u.Vector3).crossVectors(this._vAxis,o.sight)).length()>.001?r.normalize().multiplyScalar(a):r=o.right.clone().normalize().multiplyScalar(a),l=r),n=this._sMeasurable1.getPoints();var A=l.clone().sub(n.beginPoint),f=l.clone().sub(n.endPoint);e=n.beginPoint,f.length()<A.length()&&(e=n.endPoint);var w=n.beginPoint.clone().sub(n.endPoint);i=(i=(new u.Plane).setFromNormalAndCoplanarPoint(w.normalize(),e).projectPoint(l).clone().sub(e)).clone().normalize().multiplyScalar(this._sMeasurable1.getRadius()),c.oPos1=e.clone().add(i),c.oPos2=e.clone().sub(i)}else if(this._sResultingType1===t.ResultType.SPHERE){var S=(o=s.getViewpointInfo(this._viewer.currentViewpoint)).up.clone();S=S.negate(),e=this._sMeasurable1.getCenter();var M=this._sMeasurable1.getRadius(),D=this._sMeasurable1.getSelPoint();void 0===D&&(D=e.clone().add(o.right.clone().normalize().multiplyScalar(M))),i=(i=D.clone().sub(e)).normalize().multiplyScalar(M);var T=(new u.Vector3).crossVectors(S,i.clone().normalize());this._sMeasurable1.normal=T,c.oPos1=e.clone().add(i),c.oPos2=e.clone().sub(i)}return c},_buildConstructionPointsForLeader:function(e,i,n){var r=[],a=s.getDistanceFromPixel(this._viewer,i,e,this._frmWindow),l=s.getViewpointInfo(this._viewer.currentViewpoint).up.clone().multiplyScalar(a);if(this._sResultingType1===t.ResultType.CONE||this._sResultingType1===t.ResultType.CYLINDER||this._sResultingType1===t.ResultType.SPHERE){if(this._sResultingType1===t.ResultType.SPHERE||"Area"!==this.getAttribute("sSurfaceDisplayType")){var u=this._buildConstructionPointsForConeCylSphere();i=u.oPos1,n=u.oPos2}if(this._sResultingType1===t.ResultType.CONE&&"Area"!==this.getAttribute("sSurfaceDisplayType")){var c=this.getAttribute("fSemiAngle");if(void 0!==c&&!o.isZero(c)){var p=this._sMeasurable1.vAxis.clone();"Angle"===this.getAttribute("sSurfaceDisplayType")&&(p=this._sMeasurable1.vSlat1.clone()),r.push({attribute:"fQuadrant",value:0}),r.push({attribute:"vAngleArcCenter",value:this._sMeasurable1.getApex().clone()}),r.push({attribute:"vAnglePointingPoint",value:this._sMeasurable1.arcCenter.clone()}),r.push({attribute:"vAngleBreakPoint",value:this._sMeasurable1.arcCenter.clone()}),r.push({attribute:"vAngleVector1",value:p}),r.push({attribute:"vAngleVector2",value:this._sMeasurable1.vSlat.clone()})}}}r.push({attribute:"vFirstExtensionPoint3D",value:i.clone()}),r.push({attribute:"vFirstPoint3D",value:i.clone()});var d=i.clone();void 0!==n?(r.push({attribute:"vSecondExtensionPoint3D",value:n.clone()}),r.push({attribute:"vSecondPoint3D",value:n.clone()})):d=i.clone(),!this._sMeasurable1.arcCenter||this._sResultingType1!==t.ResultType.CONE||"Angle"!==this.getAttribute("sSurfaceDisplayType")&&"HalfAngle"!==this.getAttribute("sSurfaceDisplayType")||(d=this._sMeasurable1.arcCenter.clone()),r.push({attribute:"vLeaderPointingPoint3D",value:d}),r.push({attribute:"vLeaderBreakPoint3D",value:this._sResultingType1===t.ResultType.CONE?d:d.clone().add(l)}),this.set(r)},_buildConstructionPointsForDimension:function(e,t,i,r,l){let c,p=l?l.dimensionPosition:void 0,d=l?l.secondSelPoint:void 0;var g=[];let h=t.clone(),b=i.clone();var y,m,v,A=s.getDistanceFromPixel(this._viewer,h,e,this._frmWindow),f=o.areEqual(h,b,"Vector3"),w=s.getViewpointInfo(this._viewer.currentViewpoint);let S=!1,M=!1;var D,T,_;if(r){var C=(y=r.clone().normalize()).angleTo(w.sight.clone().negate());C>Math.PI/2&&(C=Math.abs(C-Math.PI));var R=(D=b,T=y,_=h.clone().sub(D).normalize(),(new u.Vector3).crossVectors(_,T)),x=R.angleTo(w.sight.clone().negate());x>Math.PI/2&&(x=Math.abs(x-Math.PI)),x>C&&(y=R,M=!0),p&&(S=!0),g.push({attribute:"iExtensionLinesManipulable",value:0})}else y=f?w.up.clone():function(e,t,i){var n=e.clone().sub(t).normalize(),r=(new u.Vector3).crossVectors(n,i);return o.isZero(r.length())&&(r=w.up.clone()),r}(h,b,w.sight);let L;if(y.normalize(),S)if(this._sMeasurable2&&(L=this._sMeasurable2.getSightRay()),L||(L=n.getSightDirfor3DPoint(this._viewer,d.clone()))||(L=w.sight.clone()),M&&!f){let e=b.clone().sub(h.clone()),t=(new u.Vector3).crossVectors(e.normalize(),y),i=P.computeLinePlaneDistance(d.toArray(),L.toArray(),b.toArray(),t.toArray());if(i&&0===i.returnCode&&(c=new u.Vector3(i.aPosition[0],i.aPosition[1],i.aPosition[2]),0===(i=P.computePointLineDistance(c.toArray(),b.toArray(),e.toArray())).returnCode&&i&&0===i.returnCode&&i.distance)){let e=new u.Vector3(i.aPosition[0],i.aPosition[1],i.aPosition[2]),t=(y=c.clone().sub(e)).length();y.normalize(),isNaN(t)||(A=t)}}else{let e=(y=p.clone().sub(b.clone())).length();y.normalize(),isNaN(e)||(A=e)}var E,V,N=y.clone().multiplyScalar(A);if(!S&&N.dot(w.up)<0&&N.negate(),f?(m=h.clone(),v=b.clone(),V=(E=m.clone().add(v).multiplyScalar(.5)).clone().add(N)):(m=h.clone().add(N),v=b.clone().add(N),V=(E=m.clone().add(v).multiplyScalar(.5)).clone()),S&&d){let e=v.clone().sub(m);if(M&&c){let t=c.clone().sub(E).length();t>e.length()/2&&(V=E.clone().add(e.clone().normalize().multiplyScalar(t)))}else{L||(L=n.getSightDirfor3DPoint(this._viewer,d.clone()))||(L=w.sight.clone());var k=P.computeTwoLinesDistance(v.toArray(),L.toArray(),d.toArray(),L.toArray());if(k&&0===k.returnCode&&(k.relationship===a.Relationship.PARRALLEL||k.relationship===a.Relationship.COINCIDENT)){let t=new u.Vector3(k.aPosition2[0],k.aPosition2[1],k.aPosition2[2]).clone().sub(E).length();t>e.length()/2&&(V=E.clone().add(e.clone().normalize().multiplyScalar(t)))}}}g.push({attribute:"vExtensionDirection3D",value:y}),g.push({attribute:"vFirstExtensionPoint3D",value:h.clone()}),g.push({attribute:"vSecondExtensionPoint3D",value:b.clone()}),g.push({attribute:"vFirstPoint3D",value:m}),g.push({attribute:"vSecondPoint3D",value:v}),g.push({attribute:"vLeaderBreakPoint3D",value:V}),g.push({attribute:"vLeaderPointingPoint3D",value:E}),this.set(g)},onViewerEventCB:function(e){if(this.getNode()&&this.getNode().onViewerEventCB){if("beginExplodeCmd"===e.eventType||"endExplodeCmd"===e.eventType){var t=this._viewer.getVisibleSpace();this._bCreateMeasureInShowSpace===t&&this.setVisibleFlag("endExplodeCmd"===e.eventType)}this.getNode().onViewerEventCB(e)}},isPartialMeasure:function(){return this._partialMeasure},setPartialMeasure:function(e){if(this._partialMeasure!==e){this._partialMeasure=e;var t=[];if(t.push({name:"sFontStyle",value:"normal"}),t.push({name:"bIsFilled",value:!0}),t.push({name:"bHasBorder",value:!1}),t.push({name:"fLineStyleThicknessIndex",value:0}),t.push({name:"sLineStylePattern",value:"1"}),t.push({name:"fLeaderStyleThicknessIndex",value:0}),t.push({name:"sLeaderStylePattern",value:"1"}),this._partialMeasure){var i=1;t.push({name:"cFillStyleColor",value:new u.Color("#ff8a2e")}),t.push({name:"cLineStyleColor",value:new u.Color("#8f4c00")}),t.push({name:"cLeaderStyleColor",value:new u.Color("#8f4c00")}),"partialCmd"===this._partialMeasure?(i=.4,t.push({name:"cFontColor",value:new u.Color("#e5e5e5")})):t.push({name:"cFontColor",value:new u.Color("#ffffff")}),t.push({name:"fOpacity",value:i})}else t.push({name:"cFontColor",value:new u.Color("#ffffff")}),t.push({name:"cFillStyleColor",value:new u.Color("#368ec4")}),t.push({name:"cLineStyleColor",value:new u.Color("#3d3d3d")}),t.push({name:"cLeaderStyleColor",value:new u.Color("#3d3d3d")}),t.push({name:"fOpacity",value:1});this.setAttributes(t),this.refreshNode()}},_removeAttribute:function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)this.getAttribute(e[t])&&(delete this["_"+e[t]],null)},refreshAssistantTool:function(e,t){var i;this._isInCreationState&&this._assistantTool&&(t?(e.position&&(i=e.position.clone()),e.mousePosition&&(e.mousePosition.y=e.mousePosition.y+(e.pixel?e.pixel:45),i=s.getNearPositionFrom2DCoordinates(e.mousePosition,this._viewer)),this._assistantTool.updatePosition(i),this._vAssistantPosition=i,this._assistantTool.setVisibleFlag(!0)):this._assistantTool.setVisibleFlag(!1))},movePosDownByPixels:function(e){if(e&&e.position&&e.pixels){var t=s.getDistanceFromPixel(this._viewer,e.position.clone(),e.pixels),i=this._viewer.currentViewpoint.getUpDirection();return i=(i=i.normalize()).multiplyScalar(-t),(new u.Vector3).addVectors(e.position.clone(),i)}},getCustoListAsPerMainValue:function(e){var t=[],i=this._sMeasurable1.getPoints();switch(e){case"Coordinates":case"Axis":t.push("selection","computationMode");break;case"Curve_Length":t.push("point1","point2","selection","computationMode");break;case"Line_Length":t.push("point1","point2","direction","selection","computationMode");break;case"Arc_Length":t.push("point1","point2","radius","diameter","selection","computationMode");break;case"Cylinder_Length":t.push("point1","point2","direction","radius","diameter","area","centerOfGravity","selection","computationMode");break;case"Cone_Length":t.push("point1","point2","direction","angle","halfAngle","apex","minRadius","maxRadius","minDiameter","maxDiameter","area","centerOfGravity","selection","computationMode");break;case"Distance":case"Min_Distance":case"Max_Distance":t.push("point1","point2","components","direction","selection1","selection2","computationMode");break;case"Angle_Btw2Selections":t.push("center","selection1","selection2","computationMode");break;case"Angle_By3Pts":t.push("point1","point2","center","computationMode");break;case"Cone_Angle":case"Half_Angle":t.push("point1","point2","length","direction","apex","MinimumRadius","MaximumRadius","MinimumDiameter","MaximumDiameter","area","centerOfGravity","selection","computationMode");break;case"Radius":case"Diameter":t.push("center","arcLength","circlePerimeter","selection","computationMode");break;case"Cylinder_Radius":case"Cylinder_Diameter":t.push("point1","point2","length","direction","area","centerOfGravity","selection","computationMode");break;case"Sphere_Radius":case"Sphere_Diameter":t.push("center","area","selection","computationMode");break;case"Radius_By3Pts":case"Diameter_By3Pts":t.push("point1","point2","point3","center","computationMode");break;case"Min_Radius":case"Max_Radius":case"Min_Diameter":case"Max_Diameter":var n;t.push("point1","point2","length","direction","angle","halfAngle","apex"),"Min_Radius"===e?n="MaximumRadius":"Max_Radius"===e?n="MinimumRadius":"Min_Diameter"===e?n="MaximumDiameter":"Max_Diameter"===e&&(n="MinimumDiameter"),t.push(n),t.push("area","centerOfGravity","selection","computationMode");break;case"Surface_Area":t.push("centerOfGravity","selection","computationMode");break;case"PlanarSurface_Area":t.push("centerOfGravity","equation","selection","computationMode");break;case"Product_Area":void 0===this.getAttribute("fArea")&&void 0!==this.getAttribute("fLength")?(void 0!==i.beginPoint&&void 0!==i.endPoint&&t.push("point1","point2"),t.push("selection","computationMode")):void 0!==this.getAttribute("fArea")?t.push("volume","centerOfGravity","selection","computationMode"):t.push("selection","computationMode");break;case"Volume":t.push("area","centerOfGravity","selection","computationMode");break;case"Thickness":t.push("point1","point2","direction","selection","computationMode")}return t},setCustomizationToMeasure:function(e){var t,i=this.getCustoListAsPerMainValue(this._sMainValueType),n=[],r=i.length;if("true"===localStorage.getItem("CATWebUXMePreferenceImplementation"))for(t=0;t<r;t++)n[t]={custoName:i[t],custoValue:e[t]};else for(t=0;t<r;t++)n[t]={custoName:i[t],custoValue:!0};this.setAttribute("lCustomization",n)}})});