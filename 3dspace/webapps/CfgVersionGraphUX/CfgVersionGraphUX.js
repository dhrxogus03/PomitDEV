define("DS/CfgVersionGraphUX/scripts/CfgTreeNodeModel",["DS/LifecycleDAGModel/DAGNodeModelBase"],function(e){"use strict";var t=function(t,i,n,o,s,a,r,d,l,p,h){if(t)if(t instanceof e)for(var c in this.options={},t.options)"children"!==c&&(this.options[c]=t.options[c]);else this.options={id:t,versionType:a,name:i,label:n,children:[],revision:o,creationDate:p,grid:{range:l,revision:o,current:s,creationDate:p,description:h?h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""},data:{frozen:d}};else this.options={isEmpty:!0};e.call(this,this.options)};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.isLeaf=function(){return!0===this.options.grid.__isLeaf__},t.prototype.isActive=function(){return!0===this.options.grid.__isActive__},t.prototype.clone=function(){return new t(this)},t.prototype.sortFunction=function(e,t){return!t&&(t=e=this),e.options.grid.creationDate>t.options.grid.creationDate},t.prototype.getLastLeaf=function(){for(var e=this;e.hasChildren();e=e.getLastChild());return e},t.prototype._getID=function(){return this.isEmpty()?this._id:this.options.id},t.prototype.isEmpty=function(){return!0===this.options.isEmpty},t.prototype.refreshNodeData=function(t){for(var i in(t=t||{})instanceof e&&(t=t.options.grid),this.options.grid)if(!(i.startsWith("__")&&i.endsWith("__")||"object"==typeof t[i])){if("title"===i){var n=t.title||t.label;n&&this.options.label!==n&&this.setAttribute("title",this.options.label=n)}t[i]&&t[i]!==this.options.grid[i]&&this.setAttribute(i,t[i])}},t.prototype.getAttribute=function(e){return this.options.grid[e]},t}),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraphColumnManager",["DS/GraphListView/ColumnManagerBase","i18n!DS/CfgVersionGraphUX/assets/nls/CfgVersionGraphNLS"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.setDefaultColumns([{text:"",dataIndex:"bi_color",width:10,isSortable:!1,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:t.CFG_Label_Graph,dataIndex:"__GRAPH__",width:160,style:{overflow:"scroll"},isSortable:!0,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:"<span style='font-weight:bold' class='fonticon fonticon-infinity'/>",dataIndex:"range",width:35,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!1},{text:t.CFG_Label_Title,dataIndex:"tree",width:140,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!1},{text:t.CFG_Label_Revision,dataIndex:"revision",width:85,isSortable:!0,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_State,dataIndex:"current",width:85,isSortable:!1,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_CreationDate,dataIndex:"creationDate",width:"auto",isSortable:!0,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_Description,dataIndex:"description",width:"auto",isSortable:!1,isDraggable:!1,isEditable:!1}],!0)}})}),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraphModelManager",["DS/CfgVersionGraphUX/scripts/CfgTreeNodeModel"],function(e){"use strict";return UWA.Class.extend({setModel:function(e){this._treeDocument=e,this._treeDocument.empty(),this._nodeArray=this._treeDocument._nodeList},createModel:function(t,i="asc"){this._treeDocument.prepareUpdate();for(var n=0;n<t.length;n++){var o=t[n].id,s=new Date(t[n].originated);const i=t[n].description;var a=t[n].name,r=t[n].revision,d=t[n].label,l=t[n].current,p=t[n].input,h=t[n].data.frozen,c=new e(o,a,d,r,l,p,!0,h,"",s,i);0===n?this._treeDocument.addChildNode(c,0,null,void 0,void 0,!0):t[n].parentid?this._treeDocument.addChildNode(c,0,this.getTreeNodeParent(t[n].parentid),void 0,void 0,!0):this._treeDocument.addChildNode(c,0,null,void 0,void 0,!0),t[n].children&&t[n].children.length>0&&this.addChild(t[n].children)}return this._treeDocument._isLoaded=!0,"asc"===i&&this._treeDocument._nodeList.reverse(),this._treeDocument.pushUpdate(),this._treeDocument},addChild:function(t){for(var i=0;i<t.length;i++){var n=this.getTreeNodeParent(t[i].parentid),o=t[i].id,s=new Date(t[i].originated);const _=t[i].description;var a=t[i].name,r=t[i].revision,d=t[i].label,l=t[i].current,p=t[i].input,h=t[i].data.frozen,c=new e(o,a,d,r,l,p,!0,h,"",s,_);"Derivation"===c.options.versionType?this._treeDocument.addChildNode(c,1,n,void 0,void 0,!0):this._treeDocument.addChildNode(c,0,n,void 0,void 0,!0),t[i].children&&t[i].children.length>0&&this.addChild(t[i].children),this._treeDocument.prepareAddDelete(),this._treeDocument.pushAddDelete()}},getTreeNodeParent:function(e){var t=null;if(this._treeDocument.getNodeByID){var i=this._treeDocument.getNodeByID(e);i&&(t=i)}else this._nodeArray.forEach(function(i){i.options.id==e&&(t=i)});return t}})}),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraph",["UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/Tweakers/GeneratedToolbar","DS/GraphListView/GraphListView","DS/CfgVersionGraphUX/scripts/CfgVersionGraphModelManager","DS/CfgVersionGraphUX/scripts/CfgVersionGraphColumnManager","DS/CfgBaseUX/scripts/CfgToggle","DS/CfgBaseUX/scripts/CfgData","DS/CfgEvolutionUX/CfgEvolutionUtils","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgVersionGraphUX/assets/nls/CfgVersionGraphNLS","css!DS/CfgVersionGraphUX/CfgVersionGraphUX.css"],function(e,t,i,n,o,s,a,r,d,l,p,h,c){"use strict";return o.extend({_options:void 0,CfgExpressionBox:!1,CfgExpressionBoxMaximized:!1,CfgSelectedNode:null,CfgSelectedModel:null,VersionGraphModelMgr:null,MainContainer:null,CfgToolbarContainer:null,VersionGraphContainer:null,ExpJson:{xml:"",json:[],iDescriptionTag:[]},IsExpressionModified:!1,getVersionGraph:function(){return this.MainContainer},get:function(){return this.ExpJson},init:function(t){this.MainContainer=e.createElement("div",{class:"versionGraphMainContainer",styles:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}}),this.VersionGraphContainer=e.createElement("div",{class:"versionGraphContainer",html:'<div class="version-subway-canvas"></div>',styles:{width:"100%",border:"1px solid #D4D4D4",height:"calc(100% - 40px)",borderRadius:"5px"}}),this.ExpJson={xml:"",json:[],description:[]},this._options=e.extend({container:this.VersionGraphContainer.getElement(".version-subway-canvas"),columnManager:new a(t),allowUnsafeHTMLContent:!0,defaultCellHeight:48,enableListSelection:!1,highlightNodesOnSelect:!0,highlightParentEdgesOnNodeSelect:!0,graphSortingColumnID:["creationDate","revision"],selection:{canMultiSelect:!0,isDraggable:!1,unselectAllOnEmptyArea:!1,nodes:!t.isReadOnly},onDragStartCell:function(e,t){"__GRAPH__"===!t.dataIndex&&"function"==typeof fn?fn(e,t):e.preventDefault()}},t),this._parent(this._options),this._options.displayCompactMode=null!=this._options.displayCompactMode&&null!=this._options.displayCompactMode&&1==this._options.displayCompactMode,this._options.isReadOnly=null!=this._options.isReadOnly&&null!=this._options.isReadOnly&&1==this._options.isReadOnly,this.highlightNodesOnSelect=!0,this.graphSpinner=new i({className:"evolutionSpinner"}).inject(this._options.container),this.graphSpinner.spin(),this.CfgToolbarContainer=e.createElement("div",{class:"graphToolbarContainer"});var o={displayCompactMode:this._options.displayCompactMode,toggleID:"cfgInfiniteToggle",toggleLabel:c.Infinity_SelectionMode,toggleTooltip:c.Infinity_Tooltip,width:"auto"};this.infiniteToggle=new r(o),this.infiniteToggleContainer=this.infiniteToggle.render(),this.expressionToolbarContainer=e.createElement("div",{class:"expressionToolbarContainer"});const s={entries:[{id:"cfgBookIcon",tooltip:c.CFG_Expression_View,dataElements:{typeRepresentation:"functionIcon",value:e=>this.bookIconCB(e)},icon:{iconName:"book-open wux-ui-3ds",fontIconFamily:1,className:"cfgBookActive"},position:"far",domId:"cfgBookIcon"}]};var l=n.prototype.createTreeDocument(s);this.expressionToolbar=new n({direction:"horizontal",items:l}),this.expressionToolbar.inject(this.expressionToolbarContainer),this.infiniteToggleContainer.inject(this.CfgToolbarContainer),this.expressionToolbarContainer.inject(this.CfgToolbarContainer),this._manager.onCellRequest(function(e){if(1==e.nodeModel._options.data.frozen?(e.view.addClassName("disablerow"),d._hasFrozenNodeInExpression=!0):e.view.removeClassName("disablerow"),"creationDate"===e.dataIndex){let t=e.nodeModel.options.grid[e.dataIndex].toLocaleString(),i=e.cellView.getContent();i.setHTML(t),i.tooltipInfos&&(i.tooltipInfos.shortHelp=t)}}),"FILTER"!=this._options.use&&this.infiniteToggle.setToggleState(!0),this.CfgExpressionBox=!0;e.createElement("div",{styles:{height:"100%"},html:[this.CfgToolbarContainer,this.VersionGraphContainer]}).inject(this.MainContainer),t={effArea:"",effExpHeaderTitle:c.CFG_Expression,viewContainer:this.MainContainer,defaultExpressionContainerHeight:70,inputData:"",displayCompactMode:this._options.displayCompactMode,minimizeTooltip:c.CFG_Minimize_EBox,maximizeTooltip:c.CFG_Max_EBox};this.cfgExpressionViewObj=new p(t),this.cfgExpressionViewObj.render(),this.applyCompactComfortableMode(),1==this._options.isReadOnly&&this.hideToolbarAndExpressionBox(),this.graphSpinner.show()},applyCompactComfortableMode:function(){1==this._options.displayCompactMode?this._manager.touchMode=!1:this._manager.touchMode=!0},render:function(e,t="asc"){this.allNodesArray=e,this.sortOrder=t;var i=this;if(this.VersionGraphModelMgr=new s,this.VersionGraphModelMgr.setModel(this.getModel()),this.VersionGraphModelMgr.createModel(e,this.sortOrder),this.activate(!0),this.VersionGraphContainer.querySelector(".wux-tree-treelistview").setAttribute("style","height:100% !important;"),this._manager.forceMultiSelection(!0),null!=i._options.psJson&&i._options.psJson.length>0){var n="<span style='font-weight:bold' class='fonticon fonticon-infinity'/>";this._manager.prepareUpdateView(),i._model.getAllDescendants().forEach(function(e){if(null!=i._options.psJson)for(var t=i._options.psJson,o=t.length,s=0;s<o;s++){var a=t[s],r=a.start.isRoot;if(e.options.name==a.start.name&&e.options.revision==a.start.revision)if(1==r){(!a.start.IsExcluded||a.start.IsExcluded&&"false"===a.start.IsExcluded)&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}})),e.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}))});if(1==e.isRoot())for(var d=i._model.getAllDescendants(),l=d.length,p=0,h=0;h<l;h++){var c=d[h];r=c.isRoot();1==p&&1==r&&(c.select(),c.__LISTVIEWCOPY__.select(),c.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}),c.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}))})),1==r&&e.options.name==c.options.name&&e.options.revision==c.options.revision&&(p=1)}if(0!=a.end.length)for(o=a.end.length,s=0;s<o;s++){var _=a.end[s];i._model.getAllDescendants().forEach(function(e){if(e.options.name==_.name&&e.options.revision==_.revision){e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),e.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}))});if(1==e.isRoot())for(var t=i._model.getAllDescendants(),n=t.length,o=0,s=0;s<n;s++){var a=t[s],r=a.isRoot();1==o&&1==r&&(a.unselect(),a.__LISTVIEWCOPY__.unselect(),a.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),a.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}))})),1==r&&e.options.name==a.options.name&&e.options.revision==a.options.revision&&(o=1)}"false"==_.IsExcluded||0==_.IsExcluded?(e.select(),e.__LISTVIEWCOPY__.select()):(e.unselect(),e.__LISTVIEWCOPY__.unselect())}})}}else e.select(),e.__LISTVIEWCOPY__.select()}else{var g=tree.getManager().getDocument().getAllDescendants();g.length>0&&(g[g.length-1].select(),g[g.length-1].__LISTVIEWCOPY__.select())}}),i._manager.pushUpdateView(),this._updateGraphSelection()}null!=i._options.displayexpression&&i._options.displayexpression.length>0&&("TRUE"==i._options.displayexpression?i._options.displayexpression=h.TRUE:"FALSE"==i._options.displayexpression&&(i._options.displayexpression=h.FALSE),i.cfgExpressionViewObj.updateExpression(i._options.displayexpression),i.ExpJson.xml=i._options.xmlExpression,i.ExpJson.description=i._options.xmlDesc,i.ExpJson.json=i._options.psJson,i._model&&(i.CfgSelectedNode=i._model.getXSO().get())),this.graphSpinner.hide()},updateExpression:function(e){this.CfgSelectedNode=e.getTreeDocument().getXSO().get(),this.CfgSelectedModel=this._model,this.ExpJson=l.GetEvolutionExpressionAndJson(this.CfgSelectedModel,this._options.mode),"XREVISION"===this._options.mode?(this.cfgExpressionViewObj.updateExpression(l.getEvolutionDisplayExpression(e.options.label,this._options.mode,this.ExpJson)),d.xRevisionEvents.publish({event:"EvolutionExpressionUpdate"})):this.cfgExpressionViewObj.updateExpression(l.getEvolutionDisplayExpression(this._options.ModelLabel,this._options.mode,this.ExpJson))},onSelectListView:function(e){var t=e.data.nodeModel.__MASTER__;if(1!=t.__LISTVIEWCOPY__.options.data.frozen&&!this._model.getXSO().isIn(t)){var i=this,n="<span style='font-weight:bold' class='fonticon fonticon-infinity'/>";this._manager.prepareUpdateView(),t.select(),1==this.infiniteToggle.getToggleState()&&(t.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}),i.graphSpinner.show(),t.getAllDescendants().forEach(function(e){i._model.getXSO().isIn(e)||e._isTrueRoot()||e.isEmpty()||0!=e.__LISTVIEWCOPY__.options.data.frozen||(e.select(),e.__LISTVIEWCOPY__&&(e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}})))}),i.graphSpinner.hide()),this.IsExpressionModified=!0,this.updateExpression(t),this._manager.pushUpdateView(),this._updateGraphSelection()}},onUnselectListView:function(e){var t=e.data.nodeModel.__MASTER__;if(1!=t.__LISTVIEWCOPY__.options.data.frozen&&this._model.getXSO().isIn(t)){var i=this;this._manager.prepareUpdateView(),t.unselect(),1==this.infiniteToggle.getToggleState()?(t.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),i.graphSpinner.show(),t.getAllDescendants().forEach(function(e){!i._model.getXSO().isIn(e)||e._isTrueRoot()||e.isEmpty()||0!=e.__LISTVIEWCOPY__.options.data.frozen||(e.unselect(),e.__LISTVIEWCOPY__&&(e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}})))}),i.graphSpinner.hide()):t.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),this.IsExpressionModified=!0,this.updateExpression(t),this._manager.pushUpdateView(),this._updateGraphSelection()}},_addEventListeners:function(){this._addEvent("LISTVIEWMODEL","select",this.onSelectListView.bind(this)),this._addEvent("LISTVIEWMODEL","unselect",this.onUnselectListView.bind(this)),this._addEvent("MASTER","prepareAddDelete",this.prepareUpdateView.bind(this)),this._addEvent("MASTER","pushAddDelete",this.pushUpdateViewAndUpdateGraph.bind(this)),this._addEvent("MASTER","empty",this.empty.bind(this)),this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this)),this._addEvent("MASTER","attributeChanged",this.onNodeAttributeChange.bind(this)),this._addEvent("LISTVIEWMANAGER","sort",this.onSort.bind(this)),this._addEvent("LISTVIEWMANAGER","dblClick",function(e){var t=e.nodeModel.__MASTER__;"function"==typeof this.options.onNodeDoubleClick&&this.options.onNodeDoubleClick(t)}.bind(this)),this._addEvent("LISTVIEWMANAGER","attributeChanged",this.onNodeAttributeChange.bind(this)),this._addEvent("LISTVIEWMANAGER","UPDATE_VIEW_COMPLETED",this.onUpdateViewComplete.bind(this)),this._isActivated=!0},onNodeAttributeChange:function(e){"__isActive__"===(e.data||e).changedAttribute&&this.onUpdateViewComplete()},onUpdateViewComplete:function(){for(var e,t=this._manager,i=0,n=this._treeDoc.getAllDescendants(),o=n.length;i<o;i+=1)t[(e=n[i]).isActive()?"addRowClass":"removeRowClass"](e._getRowID(),"version-explorer-subway-listview-active-version")},onSort:function(e){this._manager;"revision"===e.columnDataIndex||"creationDate"===e.columnDataIndex?(this.options.ascending="asc"===e.sortOrder,this._clearGraph(),this._updateGraph()):"__GRAPH__"===e.columnDataIndex&&(this.sortOrder="asc"===this.sortOrder?"desc":"asc",this.render(this.allNodesArray,this.sortOrder))},hideToolbarAndExpressionBox:function(){this.cfgExpressionViewObj.hideShowExpressionContainer(),this.CfgToolbarContainer.hide(),this.VersionGraphContainer.setStyles({height:"100%"})},bookIconCB:function(e){!1===this.CfgExpressionBox?(this.expressionToolbar.updateNodeModel("cfgBookIcon",{icon:{className:"cfgBookActive"}}),this.CfgExpressionBox=!0,this.cfgExpressionViewObj.hideShowExpressionContainer()):(this.expressionToolbar.updateNodeModel("cfgBookIcon",{icon:{className:"cfgBookInActive"}}),this.CfgExpressionBox=!1,this.cfgExpressionViewObj.hideShowExpressionContainer())}})});