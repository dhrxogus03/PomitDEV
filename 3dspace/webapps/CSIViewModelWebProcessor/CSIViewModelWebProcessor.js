define("DS/CSIViewModelWebProcessor/CSIVMClientAttributesHelper",["DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","CSIMathematics/CSIMathematicsDeclareTypes","DS/CSIViewModelWebInterfaces/CSIVMClientVisFilter","DS/CSIViewModelWebInterfaces/CSIVMClientISODataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientPLMDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClient2DTo3DDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientBillboardDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientFixedSizeDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientSemanticAttributeDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientVis3DGroupeNodeRepDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientCAT3DProjectionBagRepDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientLodDataParameter"],function(e,t,i,r,a,n,o,s,d,l,c,p,h){"use strict";let I={createAttributes:function(i){if(!i)return;let r=i.readObject(t.valuePositionMatrix,"CATMathTransformation"),a=i.readObjectArray(t.valueFilters,"CSIViewModelVisFilter"),n=i.readObject(t.valueISO,"CSIViewModelISOData"),o=i.readObject(t.valuePLM,"CSIViewModelPLMData"),s=i.readObject(t.value2DTo3D,"CSIViewModel2DTo3DData"),d=i.readObject(t.valueBillboard,"CSIViewModelBillboardData"),l=i.readObject(t.valueFixedSize,"CSIViewModelFixedSizeData"),c=i.readObject(t.valueSemantic,"CSIViewModelSemanticData"),p=i.readObject(t.valueVis3DNodeGroupRep,"CSIViewModelVis3DNodeGroupRepData"),h=i.readObject(t.valueLod,"CSIViewModelLodData"),I=i.readObject(t.value3DProjection,"CSIViewModel3DProjectionData");return new e.prototype.Attributes(r,a,n,o,s,d,l,c,p,h,I)},declareTypes:function(e){i.declareTypes(e,"CATMathTransformation"),r.prototype.declareType(),a.prototype.declareType(),n.prototype.declareType(),o.prototype.declareType(),s.prototype.declareType(),d.declareType(),l.prototype.declareType(),c.declareType(),h.declareType(),p.declareType()}};return I}),define("DS/CSIViewModelWebProcessor/CSIVMClientVisuContextParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientSupportParameters","DS/CSIViewModelWebInterfaces/CSIVMClientViewMode","DS/CSIViewModelWebInterfaces/CSIVMClientAmbiance","DS/CSIViewModelWebInterfaces/CSIVMClientViewpoints","DS/CSIViewModelWebInterfaces/CSIVMClientPLMViewMode","DS/CSIViewModelWebInterfaces/CSIVMClientVisContextData"],function(e,t,i,r,a,n,o,s,d,l){"use strict";const c={getUUID:()=>null,getViewType:()=>r.ViewType.View3D,getView3DType:()=>r.prototype.View3DType.View3D_Main};class p{constructor(e){e||(e={}),this._ambiance=e.Ambiance,this._viewpoints=e.Viewpoints,this._viewMode=e.ViewMode,this._supportParameters=e.SupportParameters,this._plmViewMode=e.PLMViewMode,this._lineDefinitions=e.LineDefinitions,this._visContextData=e.VisContextData}getAmbiance(){return this._ambiance}getViewpoints(){return this._viewpoints}getViewMode(){return this._viewMode}getSupportParameters(){return this._supportParameters}getPLMViewMode(){return this._plmViewMode}getLineDefinitions(){return this._lineDefinitions}getVisContextData(){return this._visContextData}process(e){const i=e.getProcessor(),r=i.createTransaction(c),a=i.createOperation({_type:t.prototype.OperationType.VisuContextUpdate,_VisuContext:this});return this._visContextData&&i.onVisContextData(this._visContextData),r.doOperation(a),r.executeEnd(),r}static serialize(){return!1}static unserialize(e){if(null==e)return null;const t={Ambiance:e.readObject(i.Ambiance,"CSIAmbiance"),Viewpoints:e.readObject(i.Viewpoints,"CSIViewpoints"),SupportParameters:e.readObject(i.SupportParameters,"CSISupportParameters"),ViewMode:e.readObject(i.ViewMode,"CSIViewMode"),PLMViewMode:e.readObject(i.PLMViewMode,"CSIPLMViewMode"),LineDefinitions:e.readString(i.LineDefinitions)};if(null!=e.exists(i.VisContextData)){const r=e.readParameters(i.VisContextData,"Parameters");t.VisContextData={};const a=r.begin(),n=r.end();for(;!a.equal(n);){const e=a.getName();t.VisContextData[e]=r.readObject(e,"CSIVisContextData"),a.next()}}return new p(t)}declareType(){e.declareType({type:"CSIVisuContextMessage",serialize:p.serialize,unserialize:p.unserialize}),a.prototype.declareType(),n.prototype.declareType(),o.prototype.declareType(),s.prototype.declareType(),d.prototype.declareType(),l.prototype.declareType()}}return p}),define("DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientDrawGroupParameter"],function(e,t,i){"use strict";function r(e,t,i,r,a){this._context=e,this._batchParent=r,this._noContext=a,this._targetsIds=t||[],this._targetsGeomTypes=i||[]}let a=i.prototype.geomTypeValues,n=function(){return!1},o=function(e){return new r(e.readObject(t.targetsContext,"CSIViewTreeObjectParam"),e.readUint32Array(t.targets),function(e){let t=[];return 1&e&&t.push(a.face),2&e&&t.push(a.boundary_Edge),4&e&&t.push(a.sharp_Edge),8&e&&t.push(a.smooth_Edge),16&e&&t.push(a.boundary_Point),32&e&&t.push(a.sharp_Point),64&e&&t.push(a.smooth_Point),128&e&&t.push(a.surfacic_Point),256&e&&t.push(a.free_Point),512&e&&t.push(a.wire_Edge),1024&e&&t.push(a.infinite_Face),8192&e&&t.push(a.unknown),16384&e&&t.push(a.hidden_Seam_Edge),32768&e&&t.push(a.hidden_Seam_Point),65536&e&&t.push(a.unknown_0D),131072&e&&t.push(a.unknown_1D),262144&e&&t.push(a.unknown_2D),524288&e&&t.push(a.unknown_3D),1048576&e&&t.push(a.high_curvature_edge),t}(e.readUint32(t.targetTag)),e.readObject(t.batchParent,"CSIViewTreeObjectParam"),e.readBool(t.targetsNoContext))};return r.prototype.declareType=function(){e.declareType({type:"CSIViewModelTargetsInContext",serialize:n,unserialize:o})},r}),define("DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenId",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(e,t){"use strict";function i(e,t,i){this._shortId=e,this._idPath=t,this._batchParent=i}let r=function(){return!1},a=function(e){return new i(e.readInt32(t.shortId),e.readString(t.idPath),e.readObject(t.batchParent,"CSIViewTreeObjectParam"))};return i.prototype.declareType=function(){e.declareType({type:"CSIViewModelGPTokenId",serialize:r,unserialize:a})},i}),define("DS/CSIViewModelWebProcessor/CSIVMClientSemanticDataHelper",["DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientError","DS/CSIViewModelWebInterfaces/CSIVMClientEltState"],function(e,t,i,r){"use strict";let a={createSemanticData:function(i){if(!i)return;let r={};return r[t.valueAlias]=i.readString(t.valueAlias),r[t.valueTypeId]=i.readString(t.valueTypeId),r[t.valueSubTypeId]=i.readString(t.valueSubTypeId),r[t.valueIconName]=i.readString(t.valueIconName),r[t.valueIconModule]=i.readString(t.valueIconModule),r[t.valueEditCommandName]=i.readString(t.valueEditCommandName),r[t.valueErrors]=i.readObjectArray(t.valueErrors,"CSIViewModelError"),r[t.valueStates]=i.readObjectArray(t.valueStates,"CSIViewModelEltState"),new e.prototype.SemanticData(r)}};return a}),define("DS/CSIViewModelWebProcessor/CSIVMClientIdPatternParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(e,t){"use strict";function i(e){this._id=e.id||0,this._idSpace=e.idSpace||"",this._idContext=e.idContext||"",this._shared=!!e.shared}i.prototype.getId=function(){return this._id},i.prototype.getIdSpace=function(){return this._idSpace},i.prototype.getIdContext=function(){return this._idContext},i.prototype.getShared=function(){return this._shared},i.prototype.process=function(e){return e.getProcessor().getModel().getOrCreateIdPattern(this._idSpace,this._idContext,this._shared)};let r=function(){return!1},a=function(e){return new i({id:e.readInt32(t.id),idSpace:e.readString(t.idSpace),idContext:e.readString(t.idContext),shared:e.readBool(t.shared)})};return i.prototype.declareType=function(){e.declareType({type:"CSIViewModelIdPattern",serialize:r,unserialize:a})},i}),define("DS/CSIViewModelWebProcessor/CSIVMClientTransactionOnIdent",["DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientStateMode","DS/VisualizationProfiler/VisuProfiler"],function(e,t,i,r,a){"use strict";return class{constructor(e){this._model=void 0,this._nameSpace=void 0,this._createdObjects={},this._createCells=[],this._reusedObjects={},this._shortIdsToDualIds={},this._IdsObjIsEmpty=!1,this._treeKey=void 0,this._viewTransac=void 0,this._Processor=void 0,this._errManager=void 0,this._createdObjectsOtherTrees=e}setData(e,t,i,r){this._model=e,this._nameSpace=e.getOrCreateNameSpace(t),this._createdObjects={},this._createCells=[],this._reusedObjects={},this._shortIdsToDualIds={},this._IdsObjIsEmpty=!0,this._treeKey=t,this._viewTransac=i,this._Processor=r,this._errManager=e.getErrorManager()}getTreatedObject(e){let t=this._createdObjects[e];if(void 0===t){let t=this._createdObjectsOtherTrees[e];if(t&&2==t.length){let[i,r]=t;return this._model.addSharedObjectToNamespace(r,i,this._nameSpace),this._createdObjects[e]=r,r}}return void 0===t&&(t=this._reusedObjects[e]),t}decodeGlobalId(e){let t=Object.assign({},e,{namespace:this._nameSpace,State:r.Permanent,isOptimizedPath:!1,onNewObjectInNamespace:(e,t,i)=>{this._createdObjects[e.getGlobalId()]=e}},e);return this._model.decodeGlobalId(t)}completeOperationWithObjects(t){this._errManager.addContext({name:"completeOperationWithObjects",arguments:arguments});let i=t.getType(),a=void 0,n=void 0,o=void 0;if(null!=t._IdOperatedObject){if(null!=t._IdOperatedObject._ShortId)a=this.getTreatedObject(t._IdOperatedObject._ShortId);else if(null!=t._IdOperatedObject._GlobalId){let n=this.decodeGlobalId({Node:null,Id:t._IdOperatedObject._GlobalId});if(i==e.prototype.OperationType.ApplyGP||i==e.prototype.OperationType.AddExistingCell){null!=n&&0!=n.length||(n=this.decodeGlobalId({Node:null,Id:t._IdOperatedObject._GlobalId,State:r.TempoOrPermanent}));let e=n[n.length-1];if(e.isLeaf(this._treeKey)&&e.getIdPattern()._shared&&n.length>1){let i=n[n.length-2];i.getIdPattern()._idContext==e.getIdPattern()._idContext?(a=i,t._OperatedSubElements.push(e.getAssociatedViewElt(this._treeKey))):a=e}else a=e}else null!=n&&0!=n.length&&(a=n[n.length-1])}if(void 0!==t._IdOperatedSubElements){let i=a.getMappedChildren(this._treeKey,r.TempoOrPermanent),n=t._IdOperatedSubElements.length;if(null!=i){let e,r,a;for(e=0;e<n;++e)r=t._IdOperatedSubElements[e],void 0!==(a=i.get(r))&&t._OperatedSubElements.push(a.getAssociatedViewElt(this._treeKey))}n&&!t._OperatedSubElements.length&&(t._type=e.prototype.OperationType.UnknownType),t._IdOperatedSubElements=void 0}if(null==a)throw new Error(`[${2===this._treeKey._viewType?`3DSync ( ${this._treeKey._view3DType})`:"SpecTree"}] we did not find the operatedObject with treekey ${JSON.stringify(this._treeKey)} with operation= ${JSON.stringify(t)}`);t._OperatedObject=a.getAssociatedViewElt(this._treeKey),t._IdOperatedObject=void 0}let s=void 0;if(null!=t._ShortIdOperand&&i==e.prototype.OperationType.AddExistingNode&&((s=this.getTreatedObject(t._ShortIdOperand))?t._OperandObject=s.getAssociatedViewElt(this._treeKey):console.error("Could not find object associated to short id",t._ShortIdOperand),t._ShortIdOperand=void 0,t._GlobalIdOperand=void 0),null!=t._GlobalIdOperand){let a=this.decodeGlobalId({Node:null,Id:t._GlobalIdOperand});i!=e.prototype.OperationType.AddExistingCell&&i!=e.prototype.OperationType.RemoveExistingCell||null!=a&&0!=a.length||(a=this.decodeGlobalId({Node:null,Id:t._GlobalIdOperand,State:r.TempoOrPermanent})),null!=a&&0!=a.length&&(s=a[a.length-1]),null!=s?t._OperandObject=s.getAssociatedViewElt(this._treeKey):(t._OperandObject=void 0,console.error(`[${2===this._treeKey._viewType?"3DSync":"SpecTree"}] Failed to decode global Id ${t._GlobalIdOperand}`)),t._GlobalIdOperand=void 0}if(null!=t._ExistingCells){let e,i,a=t._ExistingCells._context.getShortId(),n=t._ExistingCells._context.getIdPath(),o=[];if(t._ExistingCells._noContext)for(let e in t._ExistingCells._targetsIds){let i=this._nameSpace.getObjectsFromCtx("CGMGeom",t._ExistingCells._targetsIds[e]);o.push.apply(o,i)}else if(null!=a)e=this.getTreatedObject(a),i=r.TempoOrPermanent,o=e.getChildrenWithId(this._treeKey,i,t._ExistingCells._targetsIds);else if(null!=n){let a=this.decodeGlobalId({Node:null,Id:n});null!=a&&0!=a.length||(a=this.decodeGlobalId({Node:null,Id:n,State:r.TempoOrPermanent})),e=a[a.length-1],i=r.Permanent,o=e.getChildrenWithId(this._treeKey,i,t._ExistingCells._targetsIds)}if(null!=t._ExistingCells._batchParent){let e=void 0,i=t._ExistingCells._batchParent.getShortId(),r=t._ExistingCells._batchParent.getIdPath();if(null!=i)e=this.getTreatedObject(i);else if(null!=r){let t=this.decodeGlobalId({Node:null,Id:r});null!=t&&0!=t.length&&(e=t[t.length-1])}t._BatchParentCellObject=e.getAssociatedViewElt(this._treeKey)}let s=o.length;if(s!=t._ExistingCells._targetsIds.length&&i===r.Permanent&&(s=(o=e.getChildrenWithId(this._treeKey,r.Tempo,t._ExistingCells._targetsIds)).length),s!=t._ExistingCells._targetsIds.length)throw new Error(`we did not find all the existing cells we were looking for with operation= ${JSON.stringify(t)}`);if(0===s)t._OperandSubElements=void 0;else for(let e=0;e<s;++e)t._OperandSubElements.push(o[e].getAssociatedViewElt(this._treeKey))}if(null!=t._IdPreviousObject){let e=void 0;if(null!=t._IdPreviousObject._ShortId)e=this.getTreatedObject(t._IdPreviousObject._ShortId);else if(null!=t._IdPreviousObject._GlobalId){let i=this.decodeGlobalId({Node:null,Id:t._IdPreviousObject._GlobalId});null!=i&&0!=i.length&&(e=i[i.length-1])}t._PreviousObject=e.getAssociatedViewElt(this._treeKey),t._IdPreviousObject=void 0}if(null!=t._IdBatchParentObject){if(null!=t._IdBatchParentObject._ShortId)n=this.getTreatedObject(t._IdBatchParentObject._ShortId);else if(null!=t._IdBatchParentObject._GlobalId){let e=this.decodeGlobalId({Node:null,Id:t._IdBatchParentObject._GlobalId});null!=e&&0!=e.length&&(n=e[e.length-1])}t._BatchParentObject=n.getAssociatedViewElt(this._treeKey)}if(null!=t._IdBatchParentSharedObject){if(null!=t._IdBatchParentSharedObject._ShortId)o=this.getTreatedObject(t._IdBatchParentSharedObject._ShortId);else if(null!=t._IdBatchParentSharedObject._GlobalId){let e=this.decodeGlobalId({Node:null,Id:t._IdBatchParentSharedObject._GlobalId});null!=e&&0!=e.length&&(n=e[e.length-1])}t._BatchParentSharedObject=o.getAssociatedViewElt(this._treeKey)}if(null!=t._GeometricalData&&(null!=t._GeometricalData._idPathInitializers||null!=t._GeometricalData._shortIdInitializers)){let e=0,i=0,a=[];if(null!=t._GeometricalData._shortIdInitializers)for(i=t._GeometricalData._shortIdInitializers.length,e=0;e<i;e++){let i=t._GeometricalData._shortIdInitializers[e];if(null!=i){let e=this.getTreatedObject(i);a.push(e.getAssociatedViewElt(this._treeKey))}}if(null!=t._GeometricalData._idPathInitializers)for(i=t._GeometricalData._idPathInitializers.length,e=0;e<i;e++){let i=t._GeometricalData._idPathInitializers[e];if(null!=i){let e=void 0,t=this.decodeGlobalId({Node:null,Id:i});null!=t&&0!=t.length||(t=this.decodeGlobalId({Node:null,Id:i,State:r.TempoOrPermanent})),null!=t&&0!=t.length&&(e=t[t.length-1]),a.push(e.getAssociatedViewElt(this._treeKey))}}t._GeometricalData._initializers=a}if(null!=t._Groups){if(null==a)throw new Error(`object to which we want to add groups is undefined  with operation= ${JSON.stringify(t)}`);let e,i=0,n=0;for(i=0;i<t._Groups.length;i++){(e=t._Groups[i])._groupedElements=[];let o=a.getChildrenWithId(this._treeKey,r.Tempo,e._localIDs);for(n=0;n<o.length;n++)e._groupedElements.push(o[n].getAssociatedViewElt(this._treeKey))}}if(null==a&&void 0!==t._IdOperatedSubElements&&null!=t._BatchParentObject){let i,r,a,n,o=t._IdOperatedSubElements.length;for(i=0;i<o;++i)for(a=t._IdOperatedSubElements[i],n=this._nameSpace.getObjectsFromCtx("CGMGeom",a),r=0;r<n.length;r++)void 0!==n[r]&&t._OperatedSubElements.push(n[r].getAssociatedViewElt(this._treeKey));o&&!t._OperatedSubElements.length&&(t._type=e.prototype.OperationType.UnknownType),t._IdOperatedSubElements=void 0}this._errManager.cleanContext(arguments)}doOperation(e){a.begin("CSIVMClientTransactionOnIdent::doOperation"),this._errManager.addContext({name:"doOperation",arguments:arguments}),t.isPerformanceTracesActivated()&&t.startPerfo("CSIVMClientTransactionOnIdent.doOperation"),this.completeOperationWithObjects(e);let i=this._Processor.checkCompletedOperation(e);void 0!==i&&(i._TreeKey=this._treeKey,a.begin("CSIVMClientTransactionOnIdent::doOperationInternal"),this._viewTransac.doOperation(i),this.internalDoOperation(i),a.end("CSIVMClientTransactionOnIdent::doOperationInternal")),t.isPerformanceTracesActivated()&&t.endPerfo("CSIVMClientTransactionOnIdent.doOperation"),a.end("CSIVMClientTransactionOnIdent::doOperation"),this._errManager.cleanContext(arguments)}executeEnd(){let e=void 0;return null!=this._viewTransac.executeEnd&&(e=this._viewTransac.executeEnd()),e}internalDoOperation(i){this._errManager.addContext({name:"internalDoOperation",arguments:arguments}),t.isPerformanceTracesActivated()&&t.startPerfo("CSIVMClientTransactionOnIdent.internalDoOperation");let a=i.getType();if(a===e.prototype.OperationType.RemoveAll)this._nameSpace.clear(this._treeKey);else{let t=void 0;if(void 0!==i._IdNewObject){let r,n=this._nameSpace.getObjects(i._IdNewObject._IdPattern,i._IdNewObject._LocalId),o=n.length;if(o){if(void 0!==i._OperatedObject)if(i._OperatedObject.getIdentificationObject().getIdPattern()._idContext!==i._IdNewObject._IdPattern._idContext&&i._OperatedObject.getIdentificationObject().getIdPattern()._idContext===i._IdNewObject._IdPattern._idSpace)r=i._OperatedObject.getIdentificationObject();else{let e=i._OperatedObject.getIdentificationObject().getFirstParentsDefiningNameSpaceOfThis();e.length&&(r=e[0])}if(r)for(let e=0;e<o&&void 0===t;e++)n[e].getFirstParentsDefiningNameSpaceOfThis().indexOf(r)>=0&&(t=n[e]);else{if(o>1)throw new Error(`Several objects with same ID without any Parent defining a NameSpace to allow such a situation with operation= ${JSON.stringify(i)}`);t=n[0]}}void 0!==t?(t.getViewData(this._treeKey)&&console.log("we try to create a view of an object which already has a representation in this view. This situation is only valid in case of unbatching"),this._reusedObjects[i._IdNewObject._ShortId]=t):(t=this._nameSpace.createObject(i._IdNewObject._IdPattern,i._IdNewObject._LocalId),this._createdObjects[i._IdNewObject._ShortId]=t,this._createdObjectsOtherTrees[i._IdNewObject._ShortId]=[this._nameSpace,t],i._IdNewObject._LocalIdDual&&(this._shortIdsToDualIds[i._IdNewObject._ShortId]=i._IdNewObject._LocalIdDual,this._IdsObjIsEmpty=!1),a===e.prototype.OperationType.CreateRoot||a===e.prototype.OperationType.CreateRootBatch||a===e.prototype.OperationType.CreateSemanticRoot?t.setRoot():a===e.prototype.OperationType.AddBody&&t.activateChildrenMapping()),i._CreatedObject.setIdentificationObject(t),t.associateViewElt(this._treeKey,i._CreatedObject)}switch(a){case e.prototype.OperationType.AddBatchNode:case e.prototype.OperationType.CreateRootBatch:{let e=void 0;i._OperatedObject&&(e=i._OperatedObject.getIdentificationObject());let r=null,a=null,n=i._BatchCellIdPattern;for(let e=0;e<i._CreatedObjectsWithID.length;e++)r=void 0,a=i._CreatedObjectsWithID[e],void 0===r&&(r=this._nameSpace.createObject(n,a.ident),this._createCells.push(r)),a.object.setIdentificationObject(r),r.associateViewElt(this._treeKey,a.object);e&&e.addChild(this._treeKey,t)}break;case e.prototype.OperationType.AddNode:case e.prototype.OperationType.AddBody:case e.prototype.OperationType.AddCustomNode:case e.prototype.OperationType.AddSemanticNode:{let e=i._OperatedObject.getIdentificationObject();if(e.addChild(this._treeKey,t),void 0!==i._GeometricalData&&void 0!==i._GeometricalData._initializers)for(let e=0;e<i._GeometricalData._initializers.length;e++){let a=i._GeometricalData._initializers[e].getIdentificationObject().getChildren(this._treeKey,r.Tempo);void 0!==a&&t.addChildren(this._treeKey,a)}let a=null,n=null,o=i._IdNewObject._IdPattern;for(let t=0;t<i._CreatedObjectsWithID.length;t++)a=void 0,n=i._CreatedObjectsWithID[t],void 0===a&&(a=this._nameSpace.createObject(o,n.ident),this._createCells.push(a)),n.object.setIdentificationObject(a),a.associateViewElt(this._treeKey,n.object),e.addChild(this._treeKey,a)}break;case e.prototype.OperationType.AddCells:{let e=0,t=i._OperatedObject.getIdentificationObject(),r=null,a=null,n=[],o=!1;void 0!==i._MultipleViewElts&&(e=i._MultipleViewElts.length);for(let s=0;s<i._CreatedObjectsWithID.length;s++){if(r=void 0,a=i._CreatedObjectsWithID[s],o=!1,e>0)for(let t=0;t<e&&!o;t++)i._MultipleViewElts[t]===a.ident&&(o=!0);if(o){let e=this._nameSpace.getObjects(i._IdPattern,a.ident),n=e.length;if(n){let a,o=t.getFirstParentsDefiningNameSpaceOfThis();if(o.length&&(a=o[0]),a)for(let t=0;t<n&&void 0===r;t++)e[t].getFirstParentsDefiningNameSpaceOfThis().indexOf(a)>=0&&(r=e[t]);else{if(n>1)throw new Error(`Several cells with same ID without any Parent defining a NameSpace to allow such a situation with operation= ${JSON.stringify(i)}`);r=e[0]}}void 0!==r&&(r=r.addObject())}void 0===r&&(r=this._nameSpace.createObject(i._IdPattern,a.ident),this._createCells.push(r)),a.object.setIdentificationObject(r),r.associateViewElt(this._treeKey,a.object),n.push(r)}t.addChildren(this._treeKey,n)}break;case e.prototype.OperationType.AddExistingNode:case e.prototype.OperationType.AddExistingCell:{let e=i._OperatedObject.getIdentificationObject(),t=i._OperandObject.getIdentificationObject();e.addChild(this._treeKey,t)}break;case e.prototype.OperationType.RemoveExistingNode:case e.prototype.OperationType.RemoveExistingCell:{let e=i._OperatedObject.getIdentificationObject(),t=i._OperandObject.getIdentificationObject();e.removeChild(this._treeKey,t)}break;case e.prototype.OperationType.AddExistingCells:{let e=i._OperatedObject.getIdentificationObject(),t=i._OperandSubElements,r=[];for(let e=0;e<t.length;++e)r.push(t[e].getIdentificationObject());e.addChildren(this._treeKey,r)}break;case e.prototype.OperationType.RemoveExistingCells:{let e=i._OperatedObject.getIdentificationObject(),t=i._OperandSubElements,r=[],a=t.length;for(let e=0;e<a;++e)r.push(t[e].getIdentificationObject());e.removeChildren(this._treeKey,r)}}}t.isPerformanceTracesActivated()&&t.endPerfo("CSIVMClientTransactionOnIdent.internalDoOperation"),this._errManager.cleanContext(arguments)}commit(){if(this._errManager.addContext({name:"commit",arguments:arguments}),this._viewTransac.commit(),this._nameSpace.commit(this._treeKey),this._nameSpace.isEmpty()){let e=this._Processor.getModel();void 0!==e&&e.removeNameSpace(this._nameSpace)}this._errManager.cleanContext(arguments)}abort(){this._errManager.addContext({name:"abort",arguments:arguments});let e=0,t=this._createCells.length;for(e in this._createdObjects)this._nameSpace.removeObject(this._createdObjects[e]);for(e=0;e<t;++e)this._nameSpace.removeObject(this._createCells[e]);this._nameSpace.abort(this._treeKey),this._viewTransac.abort(),this._errManager.cleanContext(arguments)}computeDuality(){if(this._errManager.addContext({name:"computeDuality",arguments:arguments}),!this._IdsObjIsEmpty){let e=this._Processor.getModel();if(void 0!==e){let t,r,a,n,o,s=this._treeKey.getViewType(),d=[];s===i.ViewType.ViewSpecTree||s===i.ViewType.ViewSpecTree2?d.push(i.ViewType.View3D):s===i.ViewType.View3D&&d.push(i.ViewType.ViewSpecTree,i.ViewType.ViewSpecTree2);let l,c=d.length;for(t in this._shortIdsToDualIds)if(void 0!==(a=this._createdObjects[t]))for(r=this._shortIdsToDualIds[t],l=0;l<c&&(o=d[l],void 0===(n=a.getDualObject(o))||n.getDualObject(s)!==a);++l)if(void 0!==(n=e.getDualObject(o,a.getIdPattern(),r))){a.setDualObject(o,n),n.setDualObject(s,a);break}}}}}}),define("DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels"],function(e,t){"use strict";function i(e){this._shortId=e.shortId||null,this._idPath=e.idPath||null}i.prototype.getShortId=function(){return this._shortId},i.prototype.getIdPath=function(){return this._idPath};let r=function(){return!1},a=function(e){return new i({shortId:e.readInt32(t.shortId),idPath:e.readString(t.idPath)})};return i.prototype.declareType=function(){e.declareType({type:"CSIViewTreeObjectParam",serialize:r,unserialize:a})},i}),define("DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext","DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenId"],function(e,t,i,r,a){"use strict";function n(e){this._id=e.id||0,this._shortIds=e.shortIds,this._globalIds=e.globalIds,this._targetsInContext=e.targetsInContext}n.prototype.process=function(e,t){let r=e.getGraphicProperties(),a=e.getProcessor(),n=0,o=0;if(void 0!==this._shortIds)for(o=this._shortIds.length,n=0;n<o;n++){let e=a.createOperation({_type:i.prototype.OperationType.ApplyGP,_IdOperatedObject:{_ShortId:this._shortIds[n]._shortId},_GraphicProperties:r[this._id],_IdBatchParentObject:void 0!==this._shortIds[n]._batchParent?{_GlobalId:this._shortIds[n]._batchParent.getIdPath(),_ShortId:this._shortIds[n]._batchParent.getShortId()}:void 0});t.doOperation(e)}if(void 0!==this._globalIds)for(o=this._globalIds.length,n=0;n<o;n++){let e=a.createOperation({_type:i.prototype.OperationType.ApplyGP,_IdOperatedObject:{_GlobalId:this._globalIds[n]._idPath},_GraphicProperties:r[this._id],_IdBatchParentObject:void 0!==this._globalIds[n]._batchParent?{_GlobalId:this._globalIds[n]._batchParent.getIdPath(),_ShortId:this._globalIds[n]._batchParent.getShortId()}:void 0});t.doOperation(e)}if(void 0!==this._targetsInContext)for(o=this._targetsInContext.length,n=0;n<o;n++){let e=a.createOperation({_type:i.prototype.OperationType.ApplyGP,_IdOperatedObject:null!=this._targetsInContext[n]._context?{_GlobalId:this._targetsInContext[n]._context.getIdPath(),_ShortId:this._targetsInContext[n]._context.getShortId()}:void 0,_GraphicProperties:r[this._id],_IdBatchParentObject:void 0!==this._targetsInContext[n]._batchParent?{_GlobalId:this._targetsInContext[n]._batchParent.getIdPath(),_ShortId:this._targetsInContext[n]._batchParent.getShortId()}:void 0,_IdOperatedSubElements:this._targetsInContext[n]._targetsIds,_OperatedGeomTypes:this._targetsInContext[n]._targetsGeomTypes});t.doOperation(e)}};let o=function(){return!1},s=function(e){return new n({id:e.readUint32(t.idGP),shortIds:e.readObjectArray(t.shortIds,"CSIViewModelGPTokenId"),globalIds:e.readObjectArray(t.globalIds,"CSIViewModelGPTokenId"),targetsInContext:e.readObjectArray(t.targetsInContext,"CSIViewModelTargetsInContext")})};return n.prototype.declareType=function(){e.declareType({type:"CSIViewModelGPTokenParam",serialize:o,unserialize:s}),r.prototype.declareType(),a.prototype.declareType()},n}),define("DS/CSIViewModelWebProcessor/CSIVMClientTreeTokenParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeObjectParameter","DS/CSIViewModelWebInterfaces/CSIVMClientGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientInfiniteGeometryParameter","DS/CSIViewModelWebInterfaces/CSIVMClientBoundingSphereParameter","DS/CSIViewModelWebInterfaces/CSIVMClientCustomDataParameter","DS/CSIViewModelWebInterfaces/CSIVMClientVisDataUpdateParameter","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebInterfaces/CSIVMClientGroup","DS/CSIViewModelWebProcessor/CSIVMClientTargetsInContext","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisRepViewModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisCircularScissorFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisPolygonalScissorFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingVolumesFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisAnnotation","DS/CSIViewModelWebInterfaces/CSIVMClientVis2DModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisLayerFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisZModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisGASInheritFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisClippingSphereFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisAlphaFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisCurveClippingFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisViewportFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisFurtiveFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisPolygonOffsetFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisDynamicModeFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisHighlightFilter","DS/CSIViewModelWebInterfaces/CSIVMClientVisParameter","DS/CSIViewModelWebProcessor/CSIVMClientAttributesHelper","DS/CSIViewModelWebProcessor/CSIVMClientSemanticDataHelper","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/EKEventsWeb/EKEvents","DS/VisualizationProfiler/VisuProfiler"],function(e,t,i,r,a,n,o,s,d,l,c,p,h,I,_,u,C,S,b,m,O,y,V,f,g,w,P,M,D,T,v,j,E,x,G){"use strict";let W=function(){return!1},A=function(e){let i=e.readString(t.value),r={value:t.valueTab[i],localIdInt:e.readUint32(t.localIdInt),localIdString:e.readString(t.localIdString),localIdIntDual:e.readUint32(t.localIdIntDual),localIdStringDual:e.readString(t.localIdStringDual),shortId:e.readInt32(t.shortId),idPath:e.readString(t.idPath),idPattern:e.readInt32(t.idPattern),batchCellIdPattern:e.readInt32(t.batchCellIdPattern),parent:e.readObject(t.parent,"CSIViewTreeObjectParam"),batchParent:e.readObject(t.batchParent,"CSIViewTreeObjectParam"),batchParentShared:e.readObject(t.batchParentShared,"CSIViewTreeObjectParam"),previous:e.readObject(t.previous,"CSIViewTreeObjectParam"),index:e.readInt32(t.index),geometry:e.readObject(t.valueGeometry,"CSIGeometryParam"),geometries:e.readObjectArray(t.valueGeometries,"CSIGeometryParam"),infiniteGeometry:e.readObject(t.valueInfiniteGeometry,"CSIInfiniteGeometryParam"),infiniteGeometries:e.readObjectArray(t.valueInfiniteGeometries,"CSIInfiniteGeometryParam"),visGeometry:e.readObject(t.valueVisGeometry,"CSIVisParam"),multipleViewElts:e.readUint32Array(t.valueMultipleViewElts),bs:e.readObject(t.valueBoundingSphere,"CSIBoundingSphereParam"),customData:e.readObject(t.valueCustomData,"CSICustomDataParam"),inits_idPath:e.readStringArray(t.valueIdPathInitializers),inits_shortId:e.readInt32Array(t.valueShortIdInitializers),groups:e.readObjectArray(t.valueGroups,"CSIViewModelGroup"),attributes:e.readObject(t.valueAttribute,"Parameters"),dimension:e.readInt8(t.valueDimension),useParentForPixelCulling:e.readBool(t.valueUseParentForPixelCulling),terminalRepWithPrimitivesWithoutGas:e.readBool(t.valueTerminalRepWithPrimitivesWithoutGas),hasInfiniteGeometry:e.readUint8(t.valueHasInfiniteGeometry),hasGeomDecorations:e.readBool(t.valueHasGeomDecorations),existingCells:e.readObject(t.targetsInContext,"CSIViewModelTargetsInContext"),VisDataUpdate:e.readObject("updateRawBuffer","CSIVisDataUpdate")};return new N(r)};class N{constructor(e){this._value=e.value||d.prototype.OperationType.UnknownType,this._localIdInt=e.localIdInt,this._localIdString=e.localIdString,this._localIdIntDual=e.localIdIntDual,this._localIdStringDual=e.localIdStringDual,this._shortId=e.shortId,this._idPath=e.idPath,this._idPattern=e.idPattern,this._batchCellIdPattern=e.batchCellIdPattern,this._parent=e.parent,this._batchParent=e.batchParent,this._batchParentShared=e.batchParentShared,this._previous=e.previous,this._index=e.index,this._geometries=e.geometries&&e.geometries.length?e.geometries:e.geometry?[e.geometry]:void 0,this._infiniteGeometries=e.infiniteGeometries&&e.infiniteGeometries.length?e.infiniteGeometries:e.infiniteGeometry?[e.infiniteGeometry]:void 0,this._visGeometry=e.visGeometry,this._bs=e.bs,this._inits_idPath=e.inits_idPath,this._inits_shortId=e.inits_shortId,this._customData=e.customData,this._VisDataUpdate=e.VisDataUpdate,this._groups=e.groups,this._attributes=e.attributes,this._dim=e.dimension,this._useParentForPixelCulling=e.useParentForPixelCulling,this._terminalRepWithPrimitivesWithoutGas=e.terminalRepWithPrimitivesWithoutGas,this._multipleViewElts=e.multipleViewElts,this._hasInfiniteGeometry=e.hasInfiniteGeometry>0||void 0!==this._infiniteGeometries,this._hasGeomDecorations=e.hasGeomDecorations,this._existingCells=e.existingCells}process(e,t){let i;G.begin("CSIVMClientTreeTokenParameter::processTreeUpdate"),E.isEKPerfoTracesActivated()&&(i=x.Trace.traceStart(E.getEKPerfoProvider(),"web__csivmclienttreetokenparameter_process")),t._errManager.addContext({name:"process",arguments:arguments});let r,a,n,o,s,l,c,p,h,I,_,u,C,S=e.getProcessor(),b=e.getIdPatterns(),m=this._visGeometry,O=this._VisDataUpdate;this._value==d.prototype.OperationType.ModifyCustomNode||this._value==d.prototype.OperationType.ApplyAttributes||this._value==d.prototype.OperationType.ModifyBody||this._value==d.prototype.OperationType.ModifyBatch||this._value==d.prototype.OperationType.ModifyBoundingElement?n={_GlobalId:this._idPath}:this._value!=d.prototype.OperationType.RemoveAll&&(this.isNotRoot()?(n={_ShortId:this._parent.getShortId(),_GlobalId:this._parent.getIdPath()},c=this._idPath,p=this._shortId):this._value==d.prototype.OperationType.AddBatchNode?this._value=d.prototype.OperationType.CreateRootBatch:this._value=d.prototype.OperationType.CreateRoot,this._previous&&(h={_ShortId:this._previous.getShortId(),_GlobalId:this._previous.getIdPath()}),this._value==d.prototype.OperationType.AddCells&&(s=b[this._idPattern]),(this._localIdInt||this._localIdString)&&this._idPattern&&this._shortId&&(o={_LocalId:this._localIdInt||this._localIdString,_LocalIdDual:this._localIdIntDual||this._localIdStringDual,_IdPattern:b[this._idPattern],_ShortId:this._shortId})),this._value!=d.prototype.OperationType.AddExistingCells&&this._value!=d.prototype.OperationType.AddExistingNode&&this._value!=d.prototype.OperationType.AddGroups&&this._value!=d.prototype.OperationType.AddBody||this._batchParent&&(I={_ShortId:this._batchParent.getShortId(),_GlobalId:this._batchParent.getIdPath()}),this._value==d.prototype.OperationType.AddExistingNode&&this._batchParentShared&&(_={_ShortId:this._batchParentShared.getShortId(),_GlobalId:this._batchParentShared.getIdPath()}),(this._geometries||this._infiniteGeometries||this._inits_idPath||this._inits_shortId||this._bs||this._dim)&&(this._value==d.prototype.OperationType.AddBatchNode||this._value==d.prototype.OperationType.CreateRootBatch?(l=b[this._batchCellIdPattern],this._geometries&&(r=new d.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._geometries,this._dim,e.getViewVersion(),!1,this._hasGeomDecorations,this._useParentForPixelCulling,this._terminalRepWithPrimitivesWithoutGas)),this._infiniteGeometries&&(a=new d.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._infiniteGeometries,this._dim,e.getViewVersion(),!0,this._hasGeomDecorations,this._useParentForPixelCulling,this._terminalRepWithPrimitivesWithoutGas))):(r=new d.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._hasInfiniteGeometry>0?this._infiniteGeometries:this._geometries,this._dim,e.getViewVersion(),this._hasInfiniteGeometry,this._hasGeomDecorations,this._useParentForPixelCulling,this._terminalRepWithPrimitivesWithoutGas),void 0!==this._geometries&&void 0!==this._infiniteGeometries&&(a=r,r=new d.prototype.GeometricalData(this._bs,this._inits_idPath,this._inits_shortId,this._geometries,this._dim,e.getViewVersion(),!1,this._hasGeomDecorations,this._useParentForPixelCulling,this.terminalRepWithPrimitivesWithoutGas)))),null!=this._customData&&this._customData.getBinFormat()==this._customData.binFormatValues.sem&&(u=j.createSemanticData(this._customData.getData()),this._value==d.prototype.OperationType.AddCustomNode?this._value=d.prototype.OperationType.AddSemanticNode:this._value==d.prototype.OperationType.CreateRoot?this._value=d.prototype.OperationType.CreateSemanticRoot:this._value==d.prototype.OperationType.ModifyCustomNode&&(this._value=d.prototype.OperationType.ModifySemanticNode)),void 0!==this._attributes&&(C=v.createAttributes(this._attributes));let y=S.createOperation({_type:this._value,_GeometricalData:r,_InfiniteGeometricalData:a,_VisData:m,_VisDataUpdate:O,_CustomData:this._customData,_SemanticData:u,_IdOperatedObject:n,_IdNewObject:o,_IdPreviousObject:h,_IdBatchParentObject:I,_IdBatchParentSharedObject:_,_IdPattern:s,_BatchCellIdPattern:l,_ShortIdOperand:p,_GlobalIdOperand:c,_MultipleViewElts:this._multipleViewElts,_Groups:this._groups,_Index:this._index,_Attributes:C,_ExistingCells:this._existingCells});t.doOperation(y),t._errManager.cleanContext(arguments),i&&i.End(),G.end("CSIVMClientTreeTokenParameter::processTreeUpdate")}isNotRoot(){return this._parent&&(null!=this._parent.getShortId()||null!=this._parent.getIdPath())}static declareType(){e.declareType({type:"CSIViewTreeTokenParam",serialize:W,unserialize:A}),s.prototype.declareType(),i.prototype.declareType(),r.prototype.declareType(),a.declareType(),T.prototype.declareType(),n.prototype.declareType(),o.prototype.declareType(),l.prototype.declareType(),c.prototype.declareType(),p.prototype.declareType(),h.prototype.declareType(),I.prototype.declareType(),_.prototype.declareType(),u.prototype.declareType(),C.prototype.declareType(),S.prototype.declareType(),b.prototype.declareType(),m.prototype.declareType(),O.prototype.declareType(),y.prototype.declareType(),V.prototype.declareType(),f.prototype.declareType(),g.prototype.declareType(),w.prototype.declareType(),P.prototype.declareType(),M.prototype.declareType(),D.prototype.declareType(),v.declareTypes(e)}}return N}),define("DS/CSIViewModelWebProcessor/CSIVMClientTreeUpdateParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeTokenParameter","DS/CSIViewModelWebProcessor/CSIVMClientAppliedGPTokenParameter","DS/VisualizationProfiler/VisuProfiler"],function(e,t,i,r,a){"use strict";function n(e,t,i){this._treeKey=e||{},this._tokens=t||[],this._appliedGP=i||[]}n.prototype.getTreeKey=function(){return this._treeKey},n.prototype.getTokens=function(){return this._tokens},n.prototype.process=function(e,t){let i=e.getProcessor();this._treeKey=this._treeKey.process(e),i.abort(this._treeKey);let r=i.createTransactionOnIdent(this._treeKey,e.getCreatedObjectsOtherTrees()),n=0,o=null;for(a.begin("CSIVMClientTreeUpdateParameter::processTokens"),n=0;n<this._tokens.length;n++)try{(o=this._tokens[n]).process(e,r)}catch(e){t(e,this._treeKey)}for(a.end("CSIVMClientTreeUpdateParameter::processTokens"),a.begin("CSIVMClientTreeUpdateParameter::appliedGP"),n=0;n<this._appliedGP.length;n++)try{(o=this._appliedGP[n]).process(e,r)}catch(e){t(e,this._treeKey)}a.end("CSIVMClientTreeUpdateParameter::appliedGP");try{r.executeEnd()}catch(e){t(e,this._treeKey)}return r};let o=function(){return!1},s=function(e){a.begin("CSIVMClientTreeUpdateParameter::unserialize");let i=e.readObject(t.csiTreeKey,"CSIViewTreeKey");a.begin("CSIVMClientTreeUpdateParameter::unserializeTreeTokens");let r=e.readObjectArray(t.tokens,"CSIViewTreeTokenParam");a.end("CSIVMClientTreeUpdateParameter::unserializeTreeTokens"),a.begin("CSIVMClientTreeUpdateParameter::unserializeAppliedGP");let o=e.readObjectArray(t.appliedGP,"CSIViewModelGPTokenParam");return a.end("CSIVMClientTreeUpdateParameter::unserializeAppliedGP"),a.end("CSIVMClientTreeUpdateParameter::unserialize"),new n(i,r,o)};return n.prototype.declareType=function(){e.declareType({type:"CSIViewTreeUpdateParam",serialize:o,unserialize:s}),i.declareType(),r.prototype.declareType()},n}),define("DS/CSIViewModelWebProcessor/CSIVMClientViewParameter",["DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebInterfaces/CSIVMClientParameterVersion","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebProcessor/CSIVMClientTreeUpdateParameter","DS/CSIViewModelWebProcessor/CSIVMClientIdPatternParameter","DS/CSIViewModelWebInterfaces/CSIVMClientGraphicPropertyParameter","DS/CSIViewModelWebInterfaces/CSIVMClientMaterialMessageParameter","DS/CSIViewModelWebProcessor/CSIVMClientVisuContextParameter","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","CSIMathematics/CSIDeclareMathematics","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/EKEventsWeb/EKEvents","DS/VisualizationProfiler/VisuProfiler"],function(e,t,i,r,a,n,o,s,d,l,c,p,h,I){"use strict";let _=!1,u=!1;function C(e){this._viewStatus=e.viewStatus||this.viewStatusPermanent,this._viewVersion=e.viewVersion,u||(this._viewVersion!==t.currentVersion&&(console.error("****************************************"),console.error("           WARNING: 3DSync Issues       "),console.error("****************************************"),console.error(`Your server 3DSync code is currently build on version ${this._viewVersion}`),console.error(`Your web 3DSync code is currently on version ${t.currentVersion}`),console.error("This mismatch between version can create many unexpected behavior")),u=!0),this._idPatterns=e.idPatterns||{},this._graphicProperties=e.gas||{},this._treeUpdates=e.treeUpdates||[],this._visuContext=e.visuContext||{},this._texturesToBeRemovedFromCache=e.texturesToBeRemovedFromCache||void 0,this._createdObjectsOtherTrees={}}C.prototype.getViewStatus=function(){return this._viewStatus},C.prototype.getViewVersion=function(){return this._viewVersion},C.prototype.getIdPatterns=function(){return this._idPatterns},C.prototype.getGraphicProperties=function(){return this._graphicProperties},C.prototype.getTreeUpdates=function(){return this._treeUpdates},C.prototype.getVisuContext=function(){return this._visuContext},C.prototype.getCreatedObjectsOtherTrees=function(){return this._createdObjectsOtherTrees},C.prototype.getProcessor=function(){return this._processor},C.prototype.process=function(e,t){if(this._processor=e,this.getViewStatus()===i.viewStatuses.Commit)e.commit(void 0,t);else if(this.getViewStatus()===i.viewStatuses.Abort)e.abort(void 0,t);else{let r;if(p.isEKPerfoTracesActivated()&&(r=h.Trace.traceStart(p.getEKPerfoProvider(),"web__csivmclientviewparameter_processvisucontext")),I.begin("CSIVMClientViewParameter::processVisuContext"),null!=this._visuContext&&null!=this._visuContext.process)try{this._visuContext.process(this)}catch(e){t(e,"VîsuContext")}I.end("CSIVMClientViewParameter::processVisuContext"),r&&r.End(),I.begin("CSIVMClientViewParameter::processIdPatterns");for(let e in this._idPatterns)try{let i=this._idPatterns[e];this._idPatterns[e]=i.process(this)}catch(e){t(e,"idPatterns")}I.end("CSIVMClientViewParameter::processIdPatterns"),I.begin("CSIVMClientViewParameter::processAllTree");let a,n,o,s,d=[];for(n=this._treeUpdates.length,a=0;a<n;++a)try{s=(o=this._treeUpdates[a]).process(this,t),d.push(s)}catch(e){t(e,o._treeKey)}if(I.end("CSIVMClientViewParameter::processAllTree"),I.begin("CSIVMClientViewParameter::processCommit"),this.getViewStatus()===i.viewStatuses.Permanent)for(n=this._treeUpdates.length,a=0;a<n;++a){o=this._treeUpdates[a];try{this._processor.commit(o._treeKey)}catch(e){t(e,o._treeKey)}}for(I.end("CSIVMClientViewParameter::processCommit"),I.begin("CSIVMClientViewParameter::computeDuality"),n=d.length,a=0;a<n;++a)try{(s=d[a]).computeDuality()}catch(e){t(e,"compute Duality")}I.end("CSIVMClientViewParameter::computeDuality"),this.cleanTextureCache(e)}return[]},C.prototype.cleanTextureCache=function(e){if(this._texturesToBeRemovedFromCache&&this._texturesToBeRemovedFromCache.length>0){const t={getUUID:()=>null,getViewType:()=>d.ViewType.View3D,getView3DType:()=>d.prototype.View3DType.View3D_Main},i=e.createTransaction(t),r=e.createOperation({_type:l.prototype.OperationType.RemoveTextureFromCache,_TextureUids:this._texturesToBeRemovedFromCache});i.doOperation(r),i.executeEnd()}};let S=function(){return!1},b=function(e){I.begin("CSIVMClientViewParameter::unserializeTreeUpdates");const t=e.readObjectArray(i.treeUpdates,"CSIViewTreeUpdateParam");I.end("CSIVMClientViewParameter::unserializeTreeUpdates"),I.begin("CSIVMClientViewParameter::unserializeVisuContext");const r=e.readObject(i.VisuContextMessage,"CSIVisuContextMessage");let a,n;I.end("CSIVMClientViewParameter::unserializeVisuContext"),I.begin("CSIVMClientViewParameter::unserializeOther");let o={viewStatus:e.readUint8(i.viewStatus),viewVersion:e.readUint32(i.viewVersion),gas:{},treeUpdates:t,visuContext:r,texturesToBeRemovedFromCache:e.readUint32Array(i.textureUids),idPatterns:{}},s=e.readObjectArray(i.idPatterns,"CSIViewModelIdPattern"),d=e.readObjectArray(i.graphicProperties,"CSIViewModelGraphicProperty"),l=e.readObject(i.materialMessage,"CSIViewModelMaterialMessage");if(s)for(a=0;a<s.length;a++){let e=s[a];o.idPatterns[e.getId()]=e}if(d){let e,t;if(void 0!==l){let i=l.getMaterialJSON();void 0!==i&&(e=i.getJSON()),t=l.getMaterialBuffers()}for(a=0;a<d.length;a++){let i=d[a];if(void 0!==i){let r=i.getMaterial();if(void 0!==r){let i=r.getMaterialDefinition();if(void 0!==i)for(void 0===i.JSON&&(i.JSON=e),void 0===i.Buffers&&(i.Buffers=t),n=0;n<i.Indices.length;n++)i.Indices[n]--}o.gas[i.getId()]=i}}}return I.end("CSIVMClientViewParameter::unserializeOther"),new C(o)};return C.prototype.declareType=function(){_||(c(e),e.declareType({type:"CSIViewParam",serialize:S,unserialize:b}),r.prototype.declareType(),a.prototype.declareType(),n.prototype.declareType(),o.prototype.declareType(),s.prototype.declareType(),_=!0)},C.prototype.declareType(),C}),define("DS/CSIViewModelWebProcessor/CSIVMClientProcessor",["DS/CSIViewModelWebImplement/CSIVMClientModel","DS/CSICommandBinder/CSICommandBinder","DS/CSIViewModelWebProcessor/CSIVMClientTransactionOnIdent","DS/CSIViewModelWebInterfaces/CSIVMClientOperation","DS/CSIViewModelWebProcessor/CSIVMClientViewParameter","DS/CSIViewModelWebInterfaces/CSIViewModelWebEnv","DS/EKEventsWeb/EKEvents","DS/VisualizationProfiler/VisuProfiler"],function(e,t,i,r,a,n,o,s){"use strict";let d=0,l=function(i){let r=this;d=0,this._cbOnFatalError,this._cbOnVMUpdate={},this._cbOnVisContextData={},this._delegateMap={},this._model=i,void 0===i&&(this._model=new e),this._curTransactionMap={},a.prototype.declareType(),this.onServerMessageWithOutCallback=function(e,t){let i;n.isEKPerfoTracesActivated()&&(i=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_readviewparam")),s.begin("CSIVMClientProcessor::ReadParameter");let a=e.readObject("view","CSIViewParam"),d=e.readUint8("operationType"),l=!0===e.readBool("commandHasSucceeded")?"S_OK":"E_FAIL";const c=e.readBool("reloadMsg");s.end("CSIVMClientProcessor::ReadParameter");const p=c&&!this.getModel().isEmpty();i&&i.End();let h={Operation:d,rc:l,hasUpdatedView:!1};if(a&&!p){let e;n.isEKPerfoTracesActivated()&&(e=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_processviewparam")),s.begin("CSIVMClientProcessor::ProcessViewParam"),h.hasUpdatedView=!0,a.process(r,t),s.end("CSIVMClientProcessor::ProcessViewParam"),e&&e.End()}return h},this.answerCallback=function(e,t){let i=void 0;for(let a in r._cbOnVMUpdate)null!=(i=r._cbOnVMUpdate[a])&&i(e,t)},this.onServerMessage=function(e){let t,i;if(n.isEKPerfoTracesActivated()){const i={msg_size:e.getInputStreamSize()};t=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_onservermessage",i)}let a=[];try{i=r.onServerMessageWithOutCallback(e,(e,t)=>a.push([e,t]))}catch(e){a.push([e,null])}if(t&&t.End(),a.length){for(let[e,t]of a)r._cbOnFatalError?r._cbOnFatalError(e,t):console.error("Warning: Uncaught 3DSync error. The current transaction most likely was abnormally aborted. Please consider add ErrorManagement with  CSIVMClientManager.addCBOnFatalError\n\n",e);return!1}return r.answerCallback(i,e),i},t.getDefaultResponse().onAnswerDomain("view",this.onServerMessage)};return l.prototype.getModel=function(){return this._model},l.prototype.setNotifier=function(e,t){return this._delegateMap[e]=t,t},l.prototype.getNotifier=function(e){return this._delegateMap[e]},l.prototype.addCBOnVMUpdate=function(e){return this._cbOnVMUpdate[d]=e,++d},l.prototype.addCBOnVisContextData=function(e){return this._cbOnVisContextData[d]=e,++d},l.prototype.onVisContextData=function(e){for(let t of Object.values(this._cbOnVisContextData))t&&t(e)},l.prototype.addCBOnFatalError=function(e){return this._cbOnFatalError=e,e},l.prototype.removeCBOnVMUpdate=function(e){this._cbOnVMUpdate[e-1]&&(this._cbOnVMUpdate[e-1]=void 0,delete this._cbOnVMUpdate[e-1])},l.prototype.createTransaction=function(e){let t=void 0;return t=this._delegateMap[e.getViewType()].createTransaction(e)},l.prototype.createTransactionOnIdent=function(e,t){let r=new i(t),a=this.createTransaction(e);return r.setData(this._model,e,a,this),this._curTransactionMap[e.getUUID()]=r,r},l.prototype.getTransactionOnIdent=function(e){return this._curTransactionMap[e.getUUID()]},l.prototype.deleteTransactionOnIdent=function(e){delete this._curTransactionMap[e.getUUID()]},l.prototype.getOrCreateTransactionOnIdent=function(e,t){let i=this.getTransactionOnIdent(e);return null==i&&(i=this.createTransactionOnIdent(e,t)),i},l.prototype.commit=function(e,t){let i;if(n.isEKPerfoTracesActivated()&&(i=o.Trace.traceStart(n.getEKPerfoProvider(),"web__csivmclientprocessor_commit")),null==e){for(let e in this._curTransactionMap){this._curTransactionMap[e].commit(t)}this._curTransactionMap={}}else{let i=this.getTransactionOnIdent(e);null!=i&&(i.commit(t),this.deleteTransactionOnIdent(e))}i&&i.End()},l.prototype.abort=function(e,t){if(null==e){for(let e in this._curTransactionMap){this._curTransactionMap[e].abort(t)}this._curTransactionMap={}}else{let i=this.getTransactionOnIdent(e);null!=i&&(i.abort(t),this.deleteTransactionOnIdent(e))}},l.prototype.createOperation=function(e){let t=void 0,i=e._type>1?[{_IdOperatedObject:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Index:!1,_Attributes:!1},{_IdOperatedObject:!0,_GeometricalData:!1,_VisData:!1,_IdNewObject:!0,_Attributes:!1,_IdBatchParentObject:!1},{_IdOperatedObject:!0,_GeometricalData:!1,_InfiniteGeometricalData:!1,_IdPattern:!1,_MultipleViewElts:!1},{_IdOperatedObject:!0,_CustomData:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Index:!1,_Attributes:!1},{_IdOperatedObject:!0,_ShortIdOperand:!1,_GlobalIdOperand:!1,_IdPreviousObject:!1,_Index:!1,_IdBatchParentObject:!1,_IdBatchParentSharedObject:!1},{_IdOperatedObject:!0,_GlobalIdOperand:!0},{_IdOperatedObject:!0,_GlobalIdOperand:!0,_IdPreviousObject:!1},{_IdOperatedObject:!0,_GlobalIdOperand:!0},{},{_IdOperatedObject:!0,_CustomData:!0},{_IdOperatedObject:!0,_Groups:!0,_IdBatchParentObject:!1},{_IdOperatedObject:!1,_GraphicProperties:!0,_IdOperatedSubElements:!1,_OperatedGeomTypes:!1,_IdBatchParentObject:!1},{_IdNewObject:!0,_Attributes:!1},{_IdOperatedObject:!0,_SemanticData:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Attributes:!1},{_IdOperatedObject:!0,_SemanticData:!0},{_IdNewObject:!0,_SemanticData:!0,_Attributes:!1},{_IdOperatedObject:!0,_Attributes:!0},{_IdOperatedObject:!0,_GeometricalData:!1,_VisData:!1,_VisDataUpdate:!1},{_IdOperatedObject:!0,_ExistingCells:!0,_IdBatchParentObject:!1},{_IdOperatedObject:!0,_ExistingCells:!0},{_SceneEnvData:!0},{_IdOperatedObject:!0,_IdNewObject:!0,_IdPreviousObject:!1,_Index:!1,_Attributes:!1,_GeometricalData:!1,_InfiniteGeometricalData:!1,_BatchCellIdPattern:!1},{_IdOperatedObject:!0,_GeometricalData:!1,_InfiniteGeometricalData:!1},{_IdNewObject:!0,_Attributes:!1,_GeometricalData:!1,_InfiniteGeometricalData:!1,_BatchCellIdPattern:!1},{_TextureUids:!0},{_VisuContext:!0},{_IdOperatedObject:!0,_GeometricalData:!0}][e._type-2]:void 0;null!=i&&((t=new r)._type=e._type);for(let a in i){if(1==i[a]&&null==e[a]){let e=Object.fromEntries(Object.entries(r.prototype.OperationType).map(e=>[e[1],e[0]]))[t._type];throw new Error(`operation ${e} doesn't satisfy integrity constraints missing : ${a} `)}null!=e[a]&&(t[a]=e[a])}return t},l.prototype.checkCompletedOperation=function(e){let t=e,i=[{_OperatedObject:!0,_IdNewObject:!0},{_OperatedObject:!0,_GeometricalData:!0,_IdNewObject:!0},{_OperatedObject:!0,_GeometricalData:!0,_IdPattern:!1},{_OperatedObject:!0,_CustomData:!0,_IdNewObject:!0},{_OperatedObject:!0,_OperandObject:!0},{_OperatedObject:!0,_OperandObject:!0},{_OperatedObject:!0,_OperandObject:!0},{_OperatedObject:!0,_OperandObject:!0},{},{_OperatedObject:!0,_CustomData:!0},{_OperatedObject:!0,_Groups:!0},{_OperatedObject:!1,_GraphicProperties:!0},{_IdNewObject:!0},{_OperatedObject:!0,_SemanticData:!0,_IdNewObject:!0},{_OperatedObject:!0,_SemanticData:!0},{_IdNewObject:!0,_SemanticData:!0},{_OperatedObject:!0,_Attributes:!0},{_OperatedObject:!0,_GeometricalData:!1,_InfiniteGeometricalData:!1,_VisData:!1,_VisDataUpdate:!1},{_OperatedObject:!0,_OperandSubElements:!0},{_OperatedObject:!0,_OperandSubElements:!0},{_SceneEnvData:!0},{_OperatedObject:!0,_IdNewObject:!0},{_OperatedObject:!0},{_IdNewObject:!0},{_TextureUids:!0},{_VisuContext:!0},{_OperatedObject:!0,_GeometricalData:!0}];if(e._type<2)t=void 0;else{let r=i[e._type-2];for(let i in r)if(1==r[i]&&null==e[i]){t=void 0;break}}return t},l.prototype.clear=function(){this.abort(),this._model&&this._model.clear(),this._model=new e},l}),define("DS/CSIViewModelWebProcessor/CSIVMClientManager",["DS/CSIViewModelWebInterfaces/CSIVMClientManagerList","DS/CSIViewModelWebProcessor/CSIVMClientProcessor","DS/CSICommandBinder/CSICommandBinder","DS/CSICommandBinder/CSIParameters","DS/CSIViewModelWebInterfaces/CSIVMClientRequestWithView","DS/CSIViewModelWebInterfaces/CSIVMClientTreeKey","DS/CSIViewModelWebInterfaces/CSIVMClientDelegateInterface","DS/CSIViewModelWebInterfaces/CSIVMClientParameterLabels","DS/CSIViewModelWebInterfaces/CSIVMClientDebugTools","DS/VisualizationProfiler/VisuProfiler"],function(e,t,i,r,a,n,o,s,d,l){"use strict";const c={newModelIdentification:!0,defaultAnimationLoop:!0,useQualityManager:!0,useViewPanel:!0,visuFaceMaterialsAsPBR:!0,multiViewer:!0,sgOrder:!0},p=Object.assign({isA2X:!0},c);class h extends Error{}function I(i){Object.defineProperty(this,"_processor",{value:new t,configurable:!1,writable:!1}),this._impl=this,e.Add(this)}function _(e,t){let i,r;if(t&&t.node&&t.serverNodeId)i=t.node,r=t.serverNodeId;else if(this._cbOnCSICommunicationRequest){const e=this.getCSICommunicationComponent();e&&(i=e.node,r=e.serverNodeId)}return i&&r||console.error(`No way to communicate with CSI, cannot send request: ${e}`),new Promise(n=>{const o=new a({node:i,serverNodeId:r,command:{command:e,version:1,defaultCallback:n}},e=>this.getProcessor().onServerMessage(e));o.begin(),o.send(t.commandParameters),o.end()}).then(e=>{const i=e.readBool("commandHasSucceeded");return i||console.error(`Request ${command} returned RC=E_FAIL`),t.onAnswer&&t.onAnswer({status:i}),e})}return I.prototype.OperationType={BEGIN:5,DO:6,END:7,EXECUTE:4,CANCEL:3},I.prototype.getModel=function(){return this._processor.getModel()},I.prototype.getProcessor=function(){return this._processor},I.prototype.setNotifier=function(e,t){this._processor.setNotifier(e,t),e===n.ViewType.View3D&&t instanceof o&&t.setManager(this)},I.prototype.getNotifier=function(e){return this._processor.getNotifier(e)},I.prototype.addCBOnVMUpdate=function(e){return this._processor.addCBOnVMUpdate(e)},I.prototype.addCBOnFatalError=function(e){return this._processor.addCBOnFatalError(e)},I.prototype.removeCBOnVMUpdate=function(e){return this._processor.removeCBOnVMUpdate(e)},I.prototype.addCBOnVisContextData=function(e){return this._processor.addCBOnVisContextData(e)},I.prototype.createTreeKey=function(e,t,i){return this.getModel().getOrCreateTreeKey(e,t,i)},I.prototype.createCSIVMRequestWithView=function(e){let t=this.getProcessor();if(!(void 0===e||void 0===e.node||void 0===e.serverNodeId||void 0===e.command||e.command&&""===e.command.command))return new a(e,t.onServerMessage.bind(t))},I.prototype._sendFunctionCall=function(e){if(null==e||null==e.name)throw new Error("Not a valid command");return null==e.parameters&&(e.parameters=new i.Parameters),null!=this._sceneID&&e.parameters.writeUint32(s.sceneID,this._sceneID),new Promise((t,i)=>{let r={};Object.assign(r,e,{version:1,onSuccess:t,onError:i}),this.getCSICommunicationComponent().call(r)}).then(t=>{if(!t.readBool("commandHasSucceeded"))throw new h(`Request ${e.name} with sceneID=${this._sceneID} returned RC=E_FAIL`);return e.onSuccess&&e.onSuccess(t),t}).catch(t=>{if(t instanceof i.Parameters)throw console.error(`Request ${e.name} with sceneID=${this._sceneID} has failed.`),e.onError&&e.onError(t),new Error(t.readString("error"));throw t})},I.prototype.reload=function(e,t=!1,r=!0){e||(e={}),this._processor.clear();let a=new i.Parameters;return a.writeBool("noBroadCast",t),a.writeBool("clearCache",r),null!=this._sceneID?this._sendFunctionCall({name:"csiSceneServiceReloadFunction",parameters:a}):(e.commandParameters=a,_.bind(this)("CSIReloadViewCommand",e))},I.prototype.getTexturesFromUids=async function(e){if(void 0!==e&&e.textureUids.length>0){this._onGetTextureFromUidsAnswer=e.onAnswer;let t=new i.Parameters;t.writeUint32Array(s.textureUids,e.textureUids);let a=await this._sendFunctionCall({name:"csiSceneGetTexturesFromUidsFunction",parameters:t});(function(e){if(e instanceof r&&void 0!==this._onGetTextureFromUidsAnswer){let t={};t.status=e.readBool("commandHasSucceeded");let i=e.readObjectArray("textureBuffers","CSIViewModelNamedBinaryBuffer")||[],r=e.readUint32Array(s.textureUids)||[];if(t.buffers={},i.length!=r.length)t.status=!1;else for(let e=0;e<i.length;++e)t.buffers[r[e]]=i[e];this._onGetTextureFromUidsAnswer(t)}}).bind(this)(a)}},I.prototype.clearServerTextureCache=async function(e){if(void 0!==e){let t=await this._sendFunctionCall({name:"csiSceneClearTextureCacheFunction"});e.onAnswer&&e.onAnswer(t)}},I.prototype.forceSend3DNoShowData=function(e){return null!=this._sceneID?this._sendFunctionCall({name:"csiSceneServiceForceSend3DNoShowDataFunction"}):_.bind(this)("CSIForceSend3DNoShowDataViewCommand",e)},I.prototype.setCBOnCSICommunicationRequest=function(e){if(!e instanceof Function)throw new Error("setCBOnCSICommunicationRequest need a function as input.");this._cbOnCSICommunicationRequest=e,l.setCSIContext(this.getCSICommunicationComponent())},I.prototype.getCSICommunicationComponent=function(){if(null==this._cbOnCSICommunicationRequest)throw new Error("setCBOnCSICommunicationRequest not called before");let e=this._cbOnCSICommunicationRequest();const t=e.node,i=e.serverNodeId;return null==t||null==i?e:Object.assign({},{subscribe:(e,r)=>t.subscribeToEvent(i,e,r),subscribeWithSubject:(e,r,a)=>t.subscribeToEventWithSubject(i,e,r,a),subscribeToEventWithSubject:(e,r,a)=>t.subscribeToEventWithSubject(i,r,e,a),unsubscribe:e=>t.unsubscribeFromEvent(e),unsubscribeFromEvent:e=>t.unsubscribeFromEvent(e),call:e=>{let r={};Object.assign(r,e,{destinationNodeId:i}),t.call(r)}},e)},I.prototype.CallbackOnEvent=function(e){if(void 0!==e){let t=e.readParameters("domains","Parameters");if(void 0!==t){let e=t.readParameters("view","Parameters");if(void 0!==e){this._processor.onServerMessage(e)}}}},I.prototype.setSceneID=function(e){if(null!=this._sceneID)throw new Error("FORBIDDEN SCENE ID MODIFICATION");if(isNaN(e))throw new Error("INVALID SCENE ID");const t=this.getCSICommunicationComponent();this._subscribeID=t.subscribeWithSubject("CSISceneViewUpdate",e.toString(),this.CallbackOnEvent.bind(this)),this._sceneID=e},I.prototype.resetSceneID=function(){if(this.getCSICommunicationComponent().unsubscribe(this._subscribeID),void 0!==this._sceneID)return e.Remove(this),this._sendFunctionCall({name:"csiSceneServiceStopSynchroFunction"}).then(()=>{this._sceneID=void 0,this._subscribeID=void 0})},I.prototype.initScene=async function(t){null===e.Find(this)&&e.Add(this);let i=await this._sendFunctionCall({name:"csiSceneServiceInitSynchroFunction"});return this._HasViewMessageCallBack=i.readBool("hasViewMessageCallBack"),i},I.prototype.getCIDSupportType=async function(e){let t=new i.Parameters;return t.writeUint32(s.sceneID,e),(await this._sendFunctionCall({name:"csiSceneServiceGetCIDSupportTypeFunction",parameters:t})).readUint8("cidSupportType")},I.prototype.initSpecTree=async function(){let e=0;for(;e++<5;){let e=new i.Parameters;try{return void await this._sendFunctionCall({name:"csiSceneServiceInitSpecTreeFunction",parameters:e})}catch(e){if(!(e instanceof h))throw e;console.warn("InitSpecTree returned with rc=E_FAIL, try again later..."),await new Promise(e=>setTimeout(e,100))}}throw new Error("InitSpecTree failed after 5 attempts")},I.prototype.stopSpecTree=function(){if(this._sceneID)return this._sendFunctionCall({name:"csiSceneServiceStopSpecTreeFunction"})},I.createClientManager=function(){return new I},I.getViewerOptions=function(e=!1){return e?p:c},I.prototype.initializeViewer=function(e){e.displayPoints(!0),e.displaySurfacicPoints(!0),e.setPicking({activated:!0,trapSelection:!0,trapPrimitive:!1,primitive:!0}),e.setPrePicking({activated:!0,primitive:!0}),e.setCSIViewModelManager&&e.setCSIViewModelManager(this),e.currentViewpoint.setDefaultController(!0,"COMBINED"),e.setSectionCapping(!0),e.setCSIViewModelManager(this),e.setFillXSOMode(!1),e.setVisuEnv("None")},I});