define("DS/ENOXTaggerOnIndexComponent/ENOXTaggerOnIndexComponent",["UWA/Core","DS/TagNavigatorProxy/TagNavigatorProxy","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI"],function(e,t,i,a,r){"use strict";var n={},o={},s={},l="",c={};i.getPlatformServices({onComplete:function(e){e.forEach(function(e){c[e.platformId]=e})},onFailure:function(){UWA.log("Error in i3DXCompassPlatformServices.getPlatformServices")}});var u={setTagProxy:function(e,t,i,a,r){n||(n={});n[e]&&(n[e].unsetTags(),o[e]={}),this._callSetupProxy(e,t,i,a,r)},_callSetupProxy:function(i,f,g,d,v){var h=[];if(g.length>227){for(var p=Math.floor(g.length/227),y=0;y<p;y++){var P=g.slice(227*y,227*(y+1));h.push(P)}if(g.length%227>0){P=g.slice(227*p);h.push(P)}}else h.push(g);var x=0,m=function(){h.length>x&&function(i,f,g,d,v,h){var p="",y="",P=f.idDataIndex?f.idDataIndex:"physicalid";if(f.queryWithResourceId)p=v;else if(v&&Array.isArray(v)&&v.length==g.length)for(var x=0;x<g.length;x++)x>0&&(p+=" OR "),p+=v[x];else{for(p+=P+":(",x=0;x<g.length;x++)x>0&&(p+=" OR "),p+='"'+g[x]+'"';p+=")"}var m=widget.getUrl()+"-"+r.getUser().login+"-"+Date.now();if("function"===e.typeOf(f.onTagFilterChange)&&(n[i]||(n[i]=t.createProxy({id:i,widgetId:widget.id,filteringMode:"WithFilteringServices",colorize:!!f.colorize&&f.colorize,MyFriends:f.MyFriends,tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"}),UWA.is(f.onSetTagProxy,"function")&&f.onSetTagProxy()),n[i].addEvent("onFilterSubjectsChange",f.onTagFilterChange),f.colorize&&!0===f.colorize&&(n[i].addEvent("colorize",f.onTagColor),n[i].addEvent("unColorize",f.onTagUncolor))),s[i]||(s[i]={subjectPrefix:f.subjectPrefix||""}),0!=g.length){y={query:p,order_by:"asc",order_field:"ds6w:modified",label:m,locale:null!=widget&&null!=widget.lang?widget.lang:"en",nresults:g.length,start:0,tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",with_synthesis:!0,select_predicate:["ds6w:created"]},f.queryWithResourceId&&(f.resourceid_in?y.resourceid_in=g:f.resourceid_not_in&&(y.resourceid_not_in=g)),f.searchOptions&&f.searchOptions.source&&(y.source=f.searchOptions.source);var T=widget.getValue("x3dPlatformId");l=c[T]?c[T]["3DSearch"]+"/search":"",a.authenticatedRequest(l,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify(y),onComplete:function(e){var t,a,r,l,c,u,f=(a={},r=e.results,l="",c={},u=[],r&&r.forEach(function(e){t=e.attributes,l="",c={},u=[];for(var i=0;i<t.length;i++)if("internal"==t[i].format)"resourceid"==t[i].name&&(l=t[i].value);else if("ds6w_facet"==t[i].format){if("explicit"===t[i].field&&t[i].sixw)continue;c={object:"date"==t[i].type?(r=t[i].value,n=void 0,o=void 0,n=new Date,o="",r&&("string"==typeof r&&(r=(r=(r=r.replace(/\&#x2f;/g,"/")).replace(/\&#x3a;/g,":")).replace(/\u200E/g,"")),o=(n=new Date(r)).getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()),o):t[i].value,sixw:t[i].name,field:t[i].field,dispValue:"date"==t[i].type?"NONE_NEEDED":t[i].dispValue?t[i].dispValue:t[i].value,type:t[i].type},u.push(c)}var r,n,o;a[l]=u}),a);if(n[i]){var g=s[i].subjectPrefix||"";if(d)for(var v in f){var p=d[v]||d[g+v];if(p)for(var y=0;y<p.length;y++)f[v].push(p[y])}for(var v in o[i]||(o[i]={}),f)o[i][g+v]=f[v];UWA.is(h,"function")&&h()}},onFailure:function(e){console.log("Tagger service Error : "),console.log(e)}})}else n[i]&&(o[i]={},u.publishTags(i))}(i,f,h[x],d,v,function(){x++,h.length>x?m():u.publishTags(i)})};m()},getTagProxy:function(e){return n[e]?n[e]:null},publishTags:function(e){n[e]&&!0===n[e]._attributes.isAlive&&n[e].setSubjectsTags(o[e])},filterTags:function(e,t){var i=s[e].subjectPrefix||"";if(n[e]&&!0===n[e]._attributes.isAlive&&o[e]){var a={};if(t&&t.length>0)for(var r=0;r<t.length;r++)o[e].hasOwnProperty(i+t[r])&&(a[i+t[r]]=o[e][i+t[r]]);n[e].setSubjectsTags(a)}},focusOnSubjects:function(e,t){var i=s[e].subjectPrefix||"";if(n[e]&&!0===n[e]._attributes.isAlive&&o[e]){var a=[],r={};if(t&&t.length>0)for(var l=0;l<t.length;l++)if(o[e].hasOwnProperty(i+t[l])){var c=i+t[l];a.push(c),r[c]="3DSpace"}n[e].focusOnSubjects(a,!0,r)}},unfocus:function(e){n[e]&&n[e].unfocus()},setLocalFilter:function(e,t){if(UWA.is(t,"object")&&n[e]&&!0===n[e]._attributes.isAlive){let i=!1;n[e].setLocalFilter(t,i)}},killTagProxy:function(e){n[e]&&(n[e].deactivate(),n[e].unsetTags(),n[e].die(),n[e]=void 0,o[e]=void 0,delete n[e],delete o[e])},killAllTagProxy:function(){var e=this;Object.keys(n).forEach(function(t){e.killTagProxy(t)})},activate:function(e,t){let i=this;n[e]&&n[e].activate(),t&&t.deactivateOthers&&Object.keys(n).forEach(function(t){t&&t!==e&&i.deactivate(t)})},deactivate:function(e){n[e]&&(n[e].deactivate(),n[e].unfocus())},deactivateAll:function(){let e=this;Object.keys(n).forEach(function(t){e.deactivate(t)})},unsetTags:function(e){n[e]&&n[e].unsetTags()}};return u});