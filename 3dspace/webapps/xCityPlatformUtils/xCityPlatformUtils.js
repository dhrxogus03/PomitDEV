define("DS/xCityPlatformUtils/xCityPlatformIntegration",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,r,n){"use strict";var o,i,a=["globe","3DSearch","3DSwym","3DDashboard"],s="";function l(){return e.is(s,"string")&&""!==s||(s=widget.getValue("x3dPlatformId")),s}function u(e){return-1===e.indexOf("?")?e+"?tenant="+s:e+"&tenant="+s}function c(e){return new t(function(t,r){n.getServiceUrl({serviceName:e,platformId:l(),onComplete:t,onFailure:r})})}function d(e,r){return new t(function(t,o){n.getGrantedRoles(function(n){for(var o=l(),i=0;i<n.length;i++){var a=n[i];if(a.id){if("InternalDS"===a.id)return t(!0);if((a.id===e||a.id===r)&&a.platforms&&-1!==a.platforms.indexOf(o))return t(!0)}}return t(!1)})})}var f={url3DSpace:"",url3DDrive:"",url3DSearch:"",url3DSwym:"",url3DDashboard:"",urlGlobe:"",servicesUrl:{},addressesDocId:"",userData:{},earthContributorRoleGranted:!1,addTenantId:u,getTenantId:l,setTenantId:function(e){s=e},isOnPremise:function(){return"OnPremise"===l()},retrieveServicesUrl:function(e){var r=a;return this.isOnPremise()||r.push("3DDrive"),"GEOCTV_AP"!==widget.getValue("appId")?r.push("3DSpace"):e&&!0===e&&r.push("3DSpace"),new t(function(e,t){n.getPlatformServices({platformId:l(),onComplete:e,onFailure:t})}).then(function(e){if(!e)return t.reject(new Error("Unable to retrieve URL of required services."));for(var n=r.length,o=0;o<n;o++){var i=r[o],a=e[i];a&&(f.servicesUrl[i]=a)}for(var s=0;s<n;s++){var l=r[s];if(!f.servicesUrl[l])return t.reject(new Error("Unable to retrieve URL of "+l+" service."));"3DSpace"===l?f.url3DSpace=f.servicesUrl[l]:"3DDrive"===l?f.url3DDrive=f.servicesUrl[l]:"3DSearch"===l?f.url3DSearch=f.servicesUrl[l]:"3DSwym"===l?f.url3DSwym=f.servicesUrl[l]:"3DDashboard"===l?f.url3DDashboard=f.servicesUrl[l]:"globe"===l&&(f.urlGlobe=f.servicesUrl[l])}return t.resolve()})},retrieveServiceUrl:function(r){return c(r).then(function(n){return e.is(n,"string")&&""!==n?(f["url"+r]=n,f.servicesUrl[r]=n,t.resolve(n)):t.reject(new Error("Unable to retrieve "+r+" service URL."))})},retrieveGlobeUrl:function(){return c("globe").then(function(r){return e.is(r,"string")&&""!==r?(f.urlGlobe=r,f.servicesUrl.globe=r,t.resolve(r)):t.reject(new Error("Unable to retrieve Globe service URL."))})},retrieveUserData:function(){return new t(function(e,t){n.getUser({platformId:l(),onComplete:e,onFailure:t})}).then(function(e){return e?(f.userData=e,t.resolve(f.userData)):t.reject(new Error("Unable to retrieve user data."))})},retrieveAddressesDocument:function(r){var n=e.is(r,"object")?r.get("title"):"",o=n?n+"_BAP":"";return this.search("[ds6w:label]:(*BAP) AND [ds6w:type]:Document",void 0,"3dspace").then(function(e){var r,n,i=new Error("Unable to retrieve document containing buildings addresses: geocoding will not be operational.");if(e.infos.nresults){for(var a,s=0;s<e.results.length;s++){a=e.results[s];for(var l,u=0;u<a.attributes.length;u++){var c,d;"resourceid"==(l=a.attributes[u]).name&&(c=l.value),"ds6w:label"==l.name&&(d=l.value)}var v=!1,p=!1;if(c&&d&&(r||(v="BAP"==d),((p=d==o)||v)&&(r=c,n=d)),p)break}return r&&n?(f.addressesDocId=r,t.resolve(r)):t.reject(i)}return t.reject(i)})},search:function(n,o,i){return t.resolve(f.url3DSearch).then(function(r){return e.is(r,"string")&&""!==r?(f.url3DSearch=r,t.resolve(r)):t.reject(new Error("Unable to retrieve 3DSearch service URL."))}).then(function(a){return function(e,n,o,i){return o||(o=10),i||(i=[]),new t(function(t,a){var s={with_indexing_date:!0,with_nls:!1,label:"xCityGeocoding"+Date.now(),select_predicate:["ds6w:label"],query:n,specific_source_parameter:{"3dspace":{additional_query:' AND NOT (flattenedtaxonomies:"types/Person" OR flattenedtaxonomies:"types/Security Context") AND NOT (owner:"ENOVIA_CLOUD" OR owner:"Service Creator" OR owner:"Corporate" OR owner:"User Agent" OR owner:"SLMInstallerAdmin")'}},order_by:"desc",order_field:"relevance",nresults:o,start:"0",source:i,tenant:l()},u={method:"POST",type:"json",headers:{"Content-Type":"application/json"},data:JSON.stringify(s),onComplete:t,onFailure:a};r.authenticatedRequest(e,u)})}(a+"/search",n,o,i).then(function(r){return e.is(r,"object")&&e.is(r.infos,"object")?t.resolve(r):t.reject(new Error("Unable to retrieve 3DSearch service response."))})})},getCoordinateFromGeoloc:function(e,t){for(var r=e.coordinates,n=e.originShift,o=r,i=0;i<o.length;i++)o[i]-=n[i];if(2===o.length){o.push(0);var a=xCity.getGroundHeight(o);o[2]=a}return{className:"Coordinate",shifted:!1,projection:e.projection,id:t,position:o,altitudeMode:"absolute",rotation:[0,0,-180*e.azimuth/Math.PI]}},retrieveModelGeolocAttributes:function(e,n,o,i){var a,s=this;return"DesignSight"===i?this.retrieveProductFromRelationsData(e,n,o).then(function(t){if(t&&t.objectsByPatterns&&t.objectsByPatterns.simulation_to&&Array.isArray(t.objectsByPatterns.simulation_to)&&t.objectsByPatterns.simulation_to.length>0)return n=t.objectsByPatterns.simulation_to[0].id,s.retrieveModelGeolocAttributes(e,n,o)}):function(e,n,o){return new t(function(t,i){var a=u(e+"/resources/v1/collabServices/attributes/op/read"),s=[];s.push(n);var l={lIds:s,plmparameters:"true",attributes:"true",navigateToMain:"false",debug_properties:""},c={method:"POST",headers:{"Content-Type":"application/json",SecurityContext:o},type:"json",proxy:"passport",data:JSON.stringify(l),onComplete:t,onFailure:i};r.authenticatedRequest(a,c)})}(e,n,o).then(function(e){var r=e.results[0];a={physicalId:n,objectType:r.type,displayName:r.computed.label.value[0],iconUrl:r.type_icon_url};var o=!1,i=r.data.find(function(e){return"attribute[GeolocationCoordinate.V_GL_ActiveGeolocation]"===e.selectable});void 0!==i&&("true"===i.value[0].toLowerCase()&&(o=!0));if(!0===o){a.azimuth=r.data.find(function(e){return"attribute[GeolocationCoordinate.V_GL_Azimuth]"===e.selectable}).value[0];var s,l=r.data.find(function(e){return"attribute[GeolocationCoordinate.V_GL_ReferencedCRSIdentifier]"===e.selectable}).value[0];if(a.projection="EPSG:"+l.split(":")[l.split(":").length-1],void 0!==r.extensions.GeolocationCartesian3D)u=r.data.find(function(e){return"attribute[GeolocationCartesian1D.V_GL_FirstAxisCoordinate]"===e.selectable}).value[0],c=r.data.find(function(e){return"attribute[GeolocationCartesian2D.V_GL_SecondAxisCoordinate]"===e.selectable}).value[0],s=r.data.find(function(e){return"attribute[GeolocationCartesian3D.V_GL_ThirdAxisCoordinate]"===e.selectable}).value[0],a.coordinates=[parseFloat(u),parseFloat(c),parseFloat(s)],u=r.data.find(function(e){return"attribute[GeolocationCartesian1D.V_GL_FirstAxisOriginShift]"===e.selectable}).value[0],c=r.data.find(function(e){return"attribute[GeolocationCartesian2D.V_GL_SecondAxisOriginShift]"===e.selectable}).value[0],s=r.data.find(function(e){return"attribute[GeolocationCartesian3D.V_GL_ThirdAxisOriginShift]"===e.selectable}).value[0],a.originShift=[parseFloat(u),parseFloat(c),parseFloat(s)],a.coordinates[0]=Number(a.coordinates[0].toFixed(3)),a.coordinates[1]=Number(a.coordinates[1].toFixed(3)),a.coordinates[2]=Number(a.coordinates[2].toFixed(3)),a.originShift[0]=Number(a.originShift[0].toFixed(3)),a.originShift[1]=Number(a.originShift[1].toFixed(3)),a.originShift[2]=Number(a.originShift[2].toFixed(3));else if(void 0!==r.extensions.GeolocationCartesian2D){var u,c;u=r.data.find(function(e){return"attribute[GeolocationCartesian1D.V_GL_FirstAxisCoordinate]"===e.selectable}).value[0],c=r.data.find(function(e){return"attribute[GeolocationCartesian2D.V_GL_SecondAxisCoordinate]"===e.selectable}).value[0],a.coordinates=[parseFloat(u),parseFloat(c)],u=r.data.find(function(e){return"attribute[GeolocationCartesian1D.V_GL_FirstAxisOriginShift]"===e.selectable}).value[0],c=r.data.find(function(e){return"attribute[GeolocationCartesian2D.V_GL_SecondAxisOriginShift]"===e.selectable}).value[0],a.originShift=[parseFloat(u),parseFloat(c)],a.coordinates[0]=Number(a.coordinates[0].toFixed(3)),a.coordinates[1]=Number(a.coordinates[1].toFixed(3)),a.originShift[0]=Number(a.originShift[0].toFixed(3)),a.originShift[1]=Number(a.originShift[1].toFixed(3))}}return t.resolve(a)})},checkEarthContributorRole:function(){return d("GEX").then(function(r){return e.is(r,"boolean")&&""!==r?!0!==r?t.reject(new Error("Earth Contributor role is not granted")):(f.earthContributorRoleGranted=r,t.resolve(f.earthContributorRoleGranted)):t.reject(new Error("Unable to check Earth Contributor role"))})},checkCityMobilityAnalystRole:function(){return d("CMO","CMOIC").then(function(r){return e.is(r,"boolean")&&""!==r?(f.cityMobilityAnalystRoleGranted=r,t.resolve(f.cityMobilityAnalystRoleGranted)):t.reject(new Error("Unable to check City Mobility Analyst role"))})},checkCityReferentialRole:function(){return d("CRM","CRMIC").then(function(r){return e.is(r,"boolean")&&""!==r?(f.cityReferentialRoleGranted=r,t.resolve(f.cityReferentialRoleGranted)):t.reject(new Error("Unable to check City Referential role"))})},checkIndustryInnovatorRole:function(){return d("CSV").then(function(r){return e.is(r,"boolean")&&""!==r?(f.industryInnovatorRoleGranted=r,t.resolve(f.industryInnovatorRoleGranted)):t.reject(new Error("Unable to check Collaborative Industry Innovator role"))})},checkCityPlannerRole:function(){return d("UXV").then(function(r){return e.is(r,"boolean")&&""!==r?(f.cityPlannerRoleGranted=r,t.resolve(f.cityPlannerRoleGranted)):t.reject(new Error("Unable to check City Planner role"))})},retrieveProductFromRelationsData:function(e,n,a){return function(e,n,a){return o||(o="RelationsRequest"+widget.id),i||(i=widget.id+"-"+Date.now()),new t(function(t,n){var s=u(e+"/resources/enorelnav/v2/navigate/setPreferences"),l={widgetId:i,relations:["use-auto-by-type-relations"],allRelationsMode:!0,publicationsMode:!1,computeWithInstances:!0,attributesForView:["ds6w:label","ds6wg:revision","ds6w:status","ds6w:type","ds6w:modified","ds6w:responsible","ds6w:project","ds6w:dataSource","ds6w:identifier"],label:o,lang:widget.lang,ghostMode:!1},c={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:a},type:"json",data:JSON.stringify(l),onComplete:t,onFailure:n};r.authenticatedRequest(s,c)}).then(function(s){if(s.status&&"OK"===s.status)return new t(function(t,s){var l=u(e+"/resources/enorelnav/v2/navigate/getEcosystem"),c=[];c.push(n);var d={ids:c,responseMode:"objectsByPatterns",label:o,widgetId:i},f={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:a},type:"json",data:JSON.stringify(d),onComplete:t,onFailure:s};r.authenticatedRequest(l,f)});console.log("status not ok ",s)})}(e,n,a)}};return f}),define("DS/xCityPlatformUtils/xCitySearchInContext",["UWA/Core","UWA/Promise","UWA/Utils/InterCom","DS/xCityPlatformUtils/xCityPlatformIntegration"],function(e,t,r,n){"use strict";return{search:function(t){if(!t.widgetId)throw new Error("Invalid widget identifier");if(!t.criteria)throw new Error("Invalid search criteria");var o=function(t){var r={default_search_criteria:t.criteria,app_socket_id:"socket:"+t.widgetId,widget_id:t.widgetId,tenant:n.getTenantId(),title:"",role:"",mode:"furtive",default_with_precond:!0,precond:"",show_precond:!1,multiSel:!1,idcard_activated:!1,select_result_max_idcard:!1,itemViewClickHandler:"",search_delegation:"3dsearch"};return r=e.merge(t||{},r)}(t),i=new r.Socket(o.app_socket_id,{dispatchRetryInterval:5});i.subscribeServer("SearchComServer"),i.dispatchEvent("RegisterContext",o),i.dispatchEvent("InContextSearch",o);var a=function(){i.dispatchEvent("UnregisterContext",{widget_id:o.widget_id}),i.unsubscribeServer("SearchComServer"),i.removeListener("Selected_Objects_search",s),i.removeListener("onCloseTransient",l),i.disconnect()},s=function(e){"function"==typeof t.onSelect&&t.onSelect.call(null,e),a()},l=function(){"function"==typeof t.onClose&&t.onClose.call(null),a()};i.addListener("Selected_Objects_search",s),i.addListener("onCloseTransient",l)},generate3DXContent:function(t){var r=t.id;if(!e.is(r,"string")||""===r)throw new Error("Invalid item identifier in search result");var o=t.sourceid_value.split(":"),i=o[0],a=o[1];if(!e.is(i,"string")||""===i)throw new Error("Invalid source service in search result");return a||(a=n.getTenantId()),{protocol:"3DXContent",version:"2.0",data:{items:[{envId:a,serviceId:i,objectId:r,objectType:t["ds6w:type_value"],displayName:t["ds6w:label"],displayIcon:t.type_icon_url_value,displayPreview:t.preview_url_value}]}}}}}),define("DS/xCityPlatformUtils/xCityCredentials",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration"],function(e,t,r,n){"use strict";var o={trigram:"",preferredCredentials:"",availableCredentials:[],computeCredentials:function(){var i;return(i=n.url3DSpace,new t(function(e,t){var o=i+"/resources/modeler/pno/person?current=true&select=collabspaces&select=preferredcredentials",a=n.addTenantId(o),s={method:"GET",type:"json",onComplete:e,onFailure:function(){t(new Error("Unable to retrieve P&O information from 3DSpace"))}};r.authenticatedRequest(a,s)})).then(function(r){if(!(r&&e.is(r.name,"string")&&e.is(r.collabspaces,"array")&&e.is(r.preferredcredentials,"object")))return t.reject(new Error("Unable to fetch credentials related to the current user from server."));if(o.trigram=r.name,o.availableCredentials=function(e){for(var t=[],r=0;r<e.length;r++)for(var n=e[r],o=n.name,i=n.title?n.title:o,a=n.couples,s=0;s<a.length;s++){var l=a[s],u=l.role.name,c=l.organization.name;if("VPLMAdmin"!==u&&"VPLMProjectAdministrator"!==u&&"VPLMExperimenter"!==u){var d=[];d.push(u,c,o);var f=d.join(".");t.push({labelItem:i,valueItem:f})}}return t}(r.collabspaces),0===o.availableCredentials.length)return n.isOnPremise()?t.resolve():t.reject(new Error("Unable to access any collaborative space, create new collaborative space or request access to administrator."));if(e.equals(r.preferredcredentials,{}))return o.preferredCredentials=o.availableCredentials[0].valueItem,t.resolve();var i=r.preferredcredentials.role.name,a=r.preferredcredentials.organization.name,s=r.preferredcredentials.collabspace.name;if(o.name=r.name,""===i||""===a||""===s)return t.reject(new Error("Invalid preferred credentials found for current user."));var l=[];return l.push(i,a,s),o.preferredCredentials=l.join("."),t.resolve()})}};return o}),define("DS/xCityPlatformUtils/xCityDocumentManagement",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/DocumentManagement/DocumentManagement","DS/DocumentManagement/DriveDocumentManagement","DS/DocumentManagement/DocumentFoundationAjax","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityPlatformUtils/xCityCredentials"],function(e,t,r,n,o,i,a,s){"use strict";if("webworkerstitle"!==self.document.title){var l=n._checkinToFCS;function u(e,t,r,o){var i={id:e,type:"Document",policy:"Document Release",fileInfo:t},l={tenant:r.tenant||a.getTenantId(),tenantUrl:r.tenantUrl||a.url3DSpace,securityContext:r.credentials||s.preferredCredentials,onProgress:o.onProgress,onComplete:o.onComplete,onFailure:o.onFailure};return n.modifyDocument(i,l)}return{createDocument:function(e,r){return new t(function(t,o){r=r||{};var i={title:e.title,description:e.description||"",type:"Document",policy:"Document Release"};e.file&&(i.fileInfo={file:e.file});var s={tenant:r.tenant||a.getTenantId(),tenantUrl:r.tenantUrl||a.url3DSpace,securityContext:r.credentials,onComplete:t,onFailure:o};n.createDocument(i,s)})},updateDocument:function(e,r,n,o){return n=n||{},o?u(e,r,n,o):new t(function(t,i){u(e,r,n,o={onComplete:t,onFailure:i})})},retrieveDocumentUrl:function(r,o,i){return function(e,r,o){return new t(function(t,i){var l={tenant:a.getTenantId(),tenantUrl:"3DDrive"===o?a.url3DDrive:a.url3DSpace,serviceId:"3DDrive"===o?"3DDrive":"3DSpace",securityContext:s.preferredCredentials,onComplete:t,onFailure:i},u=r||null;n.downloadDocument(e,u,!1,l)})}(r,o,i).then(function(r){return e.is(r,"string")&&""!==r?t.resolve(r):t.reject(new Error("Unable to retrieve document from server"))})},getDocuments:function(e,r,l){return r=r||{},new t("3DDrive"===l?function(t,r){window.enoviaServer||i.setupEnoviaServer();var n={tenant:a.getTenantId(),tenantUrl:a.url3DDrive,securityContext:s.preferredCredentials,onComplete:t,onFailure:r};o.getDocuments(e[0],n)}:function(t,o){var i={tenant:r.tenant||a.getTenantId(),tenantUrl:r.tenantUrl||a.url3DSpace,securityContext:r.credentials||s.preferredCredentials,onComplete:t,onFailure:o};n.getDocuments(e,i)})},getDocumentsInFolder:function(r,n){var l;return"3DDrive"===n&&(l=new t(function(t,n){window.enoviaServer||i.setupEnoviaServer();var l={tenant:a.getTenantId(),tenantUrl:a.url3DDrive,securityContext:s.preferredCredentials,onComplete:t,onFailure:n};void 0===o.getDocumentsInFolder&&(o.getDocumentsInFolder=function(t,r){var n,a=e.clone(r||{},!1);if(t){var s=e.clone(a.additionalHeaders||{},!1);s["content-type"]="application/json";var l={url:a.tenantUrl+o.URL+t+o.TENANT_SUFFIX+a.tenant,type:"get",dataType:"json",noSecurityContext:!0,callback:function(t){t?e.is(a.onComplete,"function")&&a.onComplete(t):e.is(a&&a.onFailure,"function")&&a.onFailure()},headers:s};n=i.ajaxRequest(l)}return n}),o.getDocumentsInFolder(r[0]+"/contents",l)})),l},downloadDocument:function(e){return n=e,new t(function(e,t){var o={method:"GET",type:"json",headers:{"content-type":"application/json"},proxy:"passport",timeout:0,onComplete:e,onFailure:t};r.authenticatedRequest(n,o)});var n},downloadBinaryDocument:function(e){return n=e,new t(function(e,t){var o={method:"GET",type:"arraybuffer",headers:{"content-type":"application/octet-stream"},proxy:"passport",timeout:0,onComplete:e,onFailure:t};r.authenticatedRequest(n,o)});var n},downloadTextDocument:function(e){return n=e,new t(function(e,t){var o={method:"GET",headers:{"content-type":"text/plain"},proxy:"passport",timeout:0,onComplete:e,onFailure:t};r.authenticatedRequest(n,o)});var n},downloadTilesFile:function(e){return new t(function(t,r){var o={tenant:a.getTenantId(),tenantUrl:a.url3DSpace,securityContext:s.preferredCredentials,onComplete:t,onFailure:r};n.downloadDocument(e,{title:"tiles.ctds"},!1,o)})},retrieveDocumentsInFolder:function(r,n){return this.getDocumentsInFolder([r],n).then(function(r){if("3DDrive"===n)return e.is(r,"object")?e.is(r.items,"array")?t.resolve(r.items):t.reject(new Error("Invalid value for attribute 'items' found in response")):t.reject(new Error("Invalid response type (should be an object)"))})},retrieveSelectedFilesUrl:function(e){var n=`${a.url3DDrive}/resources/3ddrive/v1/bos/download?`;return n+=`ids=${e.reduce((e,t)=>`${e}%2C${t}`)}`,new t(function(e,t){window.enoviaServer||i.setupEnoviaServer();var o={method:"GET",type:"json",headers:{"content-type":"application/json"},proxy:"passport",timeout:0,onComplete:e,onFailure:t};r.authenticatedRequest(n,o)})},retrieveDocumentTypes:function(r,n){return this.getDocuments([r],{},n).then(function(o){if("3DDrive"===n){if(!e.is(o,"object"))return t.reject(new Error("Invalid response type (should be an object)"));if(!e.is(o.id,"string")||""===o.id)return t.reject(new Error("Invalid value for attribute 'id' found in response"));if(!e.is(o.extension,"string")||""===o.extension)return t.reject(new Error("Invalid value for attribute 'extension' found in response"));var i={physicalId:o.id,title:o.title,types:[o.extension],filesId:[o.id],folderId:o.parentid,serviceId:n};return t.resolve(i)}if(!e.is(o,"object"))return t.reject(new Error("Invalid response type (should be an object)"));if(!e.is(o.success,"boolean")||!0!==o.success)return t.reject(new Error("Invalid value for attribute 'success' found in response"));var a=o.data;if(!e.is(a,"array")||0===a.length)return t.reject(new Error("Invalid value for attribute 'data' found in response"));if(a=a[0],!e.is(a,"object"))return t.reject(new Error("Invalid value for attribute 'data[0]' found in response"));var s=a.id;if(!e.is(s,"string")||s!==r)return t.reject(new Error("Invalid value for attribute 'data[0].id' found in response"));var l=a.type;if(!e.is(l,"string")||"Document"!==l)return t.reject(new Error("Invalid value for attribute 'data[0].type' found in response"));var u=a.dataelements;if(!e.is(u,"object"))return t.reject(new Error("Invalid value for attribute 'data[0].dataelements' found in response"));var c=a.relateddata;if(!e.is(c,"object"))return t.reject(new Error("Invalid value for attribute 'data[0].relateddata' found in response"));var d=c.files;if(!e.is(d,"array"))return t.reject(new Error("Invalid value for attribute 'data[0].relateddata.files' found in response"));var f=[],v=[],p=[];if(0===d.length)return t.reject(new Error("Unable to find any file in this document"));for(var m,h,b,D,C=0;C<d.length;C++){if(m=d[C],!e.is(m,"object"))return t.reject(new Error("Invalid value for attribute 'data[0].relateddata.files["+C+"]' found in response"));if(h=m.dataelements,!e.is(h,"object"))return t.reject(new Error("Invalid value for attribute 'data[0].relateddata.files["+C+"].dataelements' found in response"));if(v.push(m.id),p.push(h.title),b=h.fileType,e.is(b,"string")&&(b=b.trim()),!b||0===b.length){if(D=h.title,!e.is(D,"string")||""===D)return t.reject(new Error("Invalid value for attribute 'data[0].relateddata.files["+C+"].dataelements.title' found in response"));var y=D.lastIndexOf(".");if(-1===y)continue;b=D.substring(y+1)}b&&f.push(b)}if(0===f.length)return t.reject(new Error("Unable to extract extension from filename"));i={physicalId:a.id,title:u.title,types:f,filesId:v,filesName:p,collabSpace:u.collabspace,serviceId:"3DSpace"};return t.resolve(i)})},deleteDocument:function(e,r){return new t(function(t,o){var i={tenant:(r=r||{}).tenant||a.getTenantId(),tenantUrl:r.tenantUrl||a.url3DSpace,securityContext:r.credentials,onComplete:t,onFailure:o};n.deleteDocument(e,i)})},deleteDocumentAsync:function(e,t){var n=t.credentials,o=t.tenant,i=t.tenantUrl+"/resources/v1/modeler/documents/"+e.documentId+"?SecurityContext=ctx%3A%3A"+n+"&tenant="+o,a={csrf:e.csrf};r.authenticatedRequest(i,{method:"DELETE",data:JSON.stringify(a),async:!1})},addFileToDocument:function(t,r,o){n._checkinToFCS=function(t){var r=l.apply(this,arguments);return e.is(t.onUpload,"function")&&t.onUpload(r),r},r=r||{};var i={id:t.documentId,fileInfo:{file:t.file}},s={tenant:r.tenant||a.getTenantId(),tenantUrl:r.tenantUrl||a.url3DSpace,securityContext:r.credentials,onProgress:o.onProgress,onComplete:o.onComplete,onFailure:o.onFailure,onUpload:o.onUpload};return n.addFileToDocument(i,s)},deleteFileFromDocument:function(e,t,r,o){var i={tenant:(o=o||{}).tenant||a.getTenantId(),tenantUrl:o.tenantUrl||a.url3DSpace,securityContext:o.credentials,onComplete:r.onComplete,onFailure:r.onFailure};return n.deleteFile(e,t,i)}}}return{}});