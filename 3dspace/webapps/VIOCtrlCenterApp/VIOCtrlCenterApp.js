/*!  COPYRIGHT DASSAULT SYSTEMES 2023   */
function VIOApp(e){"use strict";var t={initialize:function(e){return this.widget=e.widget,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this},onLoad:function(){this.widget.setValue("tenantAware",!0),this.__buildDOM(),require(["DS/VIOCtrlCenterApp/components/AppCtrlCmp"],e=>{this.appCtrl=new e({appConf:"DS/VIOCtrlCenterApp/assets/conf/app.json",target:this.elements.mainBody}),this.appCtrl.initialize().then(()=>{require("DS/VIOCtrlCenterApp/utils/AppUtils").publish({event:"DS/VIOAppMgt/InitDone"})})})},onRefresh:function(){this.appCtrl&&this.appCtrl.refresh()},__buildDOM:function(){if(!this.elements){this.elements={};var e=this.elements.mainBody=UWA.createElement("div");this.elements.mainBody.classList.add("vioctrl-root"),this.elements.mainBody.classList.add("vio-appMainBody"),this.elements.mainBody.style.position="absolute",this.elements.mainBody.style.height="100%",this.elements.mainBody.style.width="100%",this.elements.mainBody.style["overflow-y"]="auto",this.widget.setBody(e)}}};return t.initialize(e),t}function timeout(e){return new Promise(t=>setTimeout(t,e))}define("DS/VIOCtrlCenterApp/views/ViewUtils",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp","DS/Utilities/Dom","DS/Controls/ModalContainer","DS/Controls/Loader"],function(e,t,n,s){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.elements={},this.currentTarget=null,this)}return i.prototype.spanRequired=function(){var e=t.createElement("span",{class:"eno-required"});return e.innerText="*",e},i.prototype.mask=function(e,t){null!==this.currentTarget&&this.currentTarget!==e&&this.unmask(this.currentTarget),this.currentTarget=e,void 0===this.elements.loader&&(this.elements.loader=new s({})),this.elements.loader.on(t),n.createModal(e,this.elements.loader.getContent())},i.prototype.unmask=function(e){this.currentTarget===e&&(this.currentTarget=null,this.elements.loader.off(),n.removeModal(e))},new i}),define("DS/VIOCtrlCenterApp/utils/PlatformURL",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e){"use strict";var t=null;function n(e){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.initialize=async function(){return new Promise(function(n,s){null===t?e.getPlatformServices({onComplete:function(e){t=e,n()},onFailure:function(e){s(e)}}):n()})},n.prototype.getPlatformId=function(){return"undefined"!=typeof widget&&null!==widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},n.prototype.getTenantInfo=function(e){for(var n={},s=0;s<t.length;s++)if(t[s].platformId===e){n=t[s];break}return n},n.prototype.getPlatformURL=function(e){if(!1===Array.isArray(t))throw new Error("Platform services not initialize yet");var n=this.getPlatformId(),s=this.getTenantInfo(n);return void 0===s[e]?(console.error("No "+e+" URL available for the tenant ["+n+"]"),null):s[e]},n.prototype.getGrantedRoles=async function(){return new Promise(t=>{e.getGrantedRoles(e=>{t(e)})})},n.prototype.getAppInfo=function(t){return new Promise(n=>{e.getAppInfo({appId:t,onComplete:e=>{n(e)}})})},new n}),define("DS/VIOCtrlCenterApp/utils/AppUtils",["DS/Utilities/UUID","DS/CoreEvents/ModelEvents","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,n,s){"use strict";var i=null;function o(){return"object"==typeof o.instance?o.instance:(o.instance=this,this.mapCmp=new Map,this.mdlEvts=new t,this.notifManager=n,s.setNotificationManager(this.notifManager),s.setStackingPolicy(5),this)}return o.prototype.getUUID=function(){return e.v4()},o.prototype.getExecutionContext=function(){return this.ec},o.prototype.setComponent=function(e,t){this.mapCmp.set(e,t)},o.prototype.getComponent=function(e){return this.mapCmp.get(e)},o.prototype.publish=function(e){if(this.mdlEvts)return this.mdlEvts.publish(e)},o.prototype.subscribe=function(e,t){if(this.mdlEvts)return this.mdlEvts.subscribe(e,t)},o.prototype.unsubscribe=function(e){if(this.mdlEvts)return this.mdlEvts.publish(e)},o.prototype.displayNotif=async function(e){if(this.notifManager){e=UWA.extend({level:"info",message:"default Message",sticky:!1},e),this.notifManager.addNotif(e)}},o.prototype.getURLParameter=function(e){return null===i&&((i=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null)||(i=location.search.length?location.search:null)),i?decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(i)||[null,""])[1].replace(/\+/g,"%20"))||null:null},o.prototype.loadAMD=async function(e){return new Promise(t=>{require([e],e=>{t(e)})})},o.prototype.loadAMDs=async function(e){return new Promise((t,n)=>{require(e,()=>{t({loadedAMDs:e})},n=>{console.error("Cannot load following AMDs:\n"+JSON.stringify(n.requireModules,null,2));var s=[];for(let t=0;t<n.requireModules.length;t++){var i=n.requireModules[t].replace("pluginDS!","");const o=e.indexOf(i);o>-1&&e.splice(o,1),s.push(i)}t({loadedAMDs:e,notLoadedAMDs:s})})})},new o}),define("DS/VIOCtrlCenterApp/utils/AppCntProxy",["i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp.json","DS/PlatformAPI/PlatformAPI","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/utils/PlatformURL"],function(e,t,n,s){"use strict";function i(e){return"object"==typeof i.instance?i.instance:(i.instance=this,this.notInitialize=!0,this.appInfos={currentUser:void 0,widgetId:void 0,x3dAppId:void 0,x3dSharedId:void 0,settings:{}},this)}i.prototype.initialize=async function(e){if(!0===this.notInitialize){delete this.notInitialize,this.appCntProxy=widget,this.appInfos.lang=this.appCntProxy.lang,this.appInfos.widgetId=this.appCntProxy.id,this.appInfos.x3dAppId=this.appCntProxy.getValue("x3dAppId")?this.appCntProxy.getValue("x3dAppId"):this.appCntProxy.getValue("appId"),this.appInfos.x3dSharedId=this.appCntProxy.getValue("x3dSharedId")?this.appCntProxy.getValue("x3dSharedId"):this.getAppId(),this.appInfos.currentUser=t.getUser(),this.appInfos=UWA.extend(this.appInfos,e,!0),this.appCntProxy.addEvent("endEdit",e=>{e&&!1===e.submitted||n.publish({event:"DS/ENXPreference/update",data:{preferences:this.appCntProxy.getPreferences()}})}),this.__launchResize=!0,this.appCntProxy.addEvent("onResize",async()=>{!0===this.__launchResize&&(this.__launchResize=!1,setTimeout(()=>{n.publish({event:"DS/App/resize",data:{}})},200),setTimeout(()=>{this.__launchResize=!0},750))}),await Promise.all([this.__initGrantedRoles(),s.initialize()]),this.appCntProxy.addEvents({endEdit:this.__onEndEditPref.bind(this)});let o=r();for(var i of o.keys()){let e=o.get(i);this.setSetting(i,a(e))}}},i.prototype.getLang=function(){return this.appInfos.lang},i.prototype.getUser=function(){return this.appInfos.currentUser},i.prototype.getUserLogin=function(){var e=this.getUser(),t="";return void 0!==e&&(t=e.login),t},i.prototype.getUserName=function(){var e=this.getUser(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t},i.prototype.getWidgetId=function(){return this.appInfos.widgetId||"undefined"==typeof widget||null===widget||(this.appInfos.widgetId=widget.id),this.appInfos.widgetId},i.prototype.getAppId=function(){return this.appInfos.x3dAppId},i.prototype.getSharedId=function(){return this.appInfos.x3dSharedId},i.prototype.getRequestLabel=function(){return this.getUserLogin()+"-"+this.getAppId()+"-"+Date.now()},i.prototype.setSetting=function(e,t){this.appInfos.settings[e]=t},i.prototype.getSetting=function(e){return this.appInfos.settings[e]},i.prototype.getProperty=function(e){return this.appInfos[e]},i.prototype.getPreference=function(e,t){let n;return n=!0===t||!0===this.getSetting("enx-storepref-locally")?localStorage.getItem(e):this.getValue(e)},i.prototype.setPreference=function(e,t,n){t=!0===n||!0===this.getSetting("enx-storepref-locally")?localStorage.setItem(e,t):this.setValue(e,t)},i.prototype.setPlatformId=function(e){this.setValue("x3dPlatformId",e),this.setValue(ENOXWidgetPreferences.getPlatformPreferenceKey(),e),ENOXWidgetPreferences.addPlatformSelectionPreferenceToWidget({roles:this.appInfos.roles.available,mustHaveAll:!1})},i.prototype.__onEndEditPref=function(){},i.prototype.__initGrantedRoles=async function(){return new Promise(e=>{s.getGrantedRoles().then(t=>{this.grantedRoles=t,e()})})};var o=null,r=()=>{if(null===o){o="";let e=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null;e?(e=new URL(e),o=e.search):o=location.search,o=new URLSearchParams(o)}return o},a=e=>{switch(e=e.toLowerCase()){case"true":e=!0;break;case"false":e=!1}return e};return new i}),define("DS/VIOCtrlCenterApp/components/AppCtrlCmp",["DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/utils/AppCntProxy"],function(e,t){"use strict";class n{constructor(e){this.options=e||{},this.options=Object.assign({currentView:null},this.options)}}return n.prototype.initialize=async function(){let n=await e.loadAMD("text!"+this.options.appConf),s=JSON.parse(n);await t.initialize(s),e.setComponent("AppCtrl",this);let i=t.getProperty("components");for(let t=0;t<i.length;t++){let n=i[t],s=new(await e.loadAMD(n.amd))(this.options);await s.initialize()}},n.prototype.refresh=async function(){await e.getComponent("AppModel").refresh(),await e.getComponent("AppView").refresh()},n}),define("DS/VIOCtrlCenterApp/ws/AppsMngtWS",["DS/VIOCtrlCenterApp/utils/PlatformURL"],function(e){"use strict";function t(){}return t.prototype.getCredits=async function(t){var n=e.getPlatformURL("3DCompass")+"/resources/AppsMngt/credits?platform="+e.getPlatformId()+"&offset=0&os=windows&sort_direction=asc&limit=100";return this.executeRequest(n,{method:"GET",headers:{Accept:"application/json","Accept-Language":"en"}},"myapps/credits/get")},t}),define("DS/VIOCtrlCenterApp/ws/VisMgtWS",["DS/VIOCtrlCenterApp/utils/PlatformURL","DS/VIOCtrlCenterApp/utils/AppCntProxy"],function(e,t){"use strict";function n(){}return n.prototype.getConsumption=async function(n){let s={period:n.period,contentLength:t.getProperty("nbRecord")},i=e.getPlatformURL("3dvisucontentjobmgmt")+"/api/v1/admin/license/usage",o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(s)},r=await this.executeRequest(i,o,"visjob/registeredrep");if(r.info)return r;{var a={evolutions:{total:[],used:[]}};let e,t;for(let n=0;n<r.Usages.length;n++){let s=r.Usages[n],i=new Date(s.date).getTime();a.evolutions.total.push([i,s.available]),a.evolutions.used.push([i,s.used]),n===r.Usages.length-1&&(t=s.available,e=s.used)}let s=Math.min(new Date(n.period.end).getTime(),(new Date).getTime());return a.evolutions.total.push([s,t]),a.evolutions.used.push([s,e]),a}},n.prototype.getRegisteredRep=async function(){let t=e.getPlatformURL("3dvisucontentjobmgmt")+"/api/v1/admin/registeredrep";return this.executeRequest(t,{method:"GET",headers:{Accept:"application/json"}},"visjob/registeredrep")},n}),define("DS/VIOCtrlCenterApp/ws/WSAccess",["i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/WAFData/WAFData","DS/VIOCtrlCenterApp/ws/AppsMngtWS","DS/VIOCtrlCenterApp/ws/VisMgtWS","DS/VIOCtrlCenterApp/utils/AppUtils"],function(e,t,n,s,i){"use strict";function o(){return"object"==typeof o.instance?o.instance:(o.instance=this,this)}function r(e){return"string"==typeof e&&"{"===e.charAt(0)?JSON.parse(e):e}return o.prototype=Object.assign(o.prototype,n.prototype),o.prototype=Object.assign(o.prototype,s.prototype),o.prototype.__executeRequest=function(e,n,s){return t.authenticatedRequest(e,n)},o.prototype.executeRequest=async function(t,n,s){return new Promise((i,o)=>{n.onComplete=function(e){var t={success:!0};e&&(t=r(e)),i(t)},n.onFailure=function(e,t){t&&(t=r(t)),o(t)},n.onTimeout=function(t,n){n&&(n=r(n)),AppsUtils.displayNotif({level:"error",message:e.errors.requesttimeout,sticky:!0}),o(n)},"POST"!==n.method||"string"==typeof n.data||n.data instanceof Blob||n.data instanceof FormData||(n.data=JSON.stringify(n.data)),this.__executeRequest(t,n,s)})},new o}),define("DS/VIOCtrlCenterApp/views/NoToken",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/ws/WSAccess","DS/Utilities/Dom"],function(e,t,n,s,i){"use strict";const o="notoken";function r(e){this.options=Object.assign({model:null},e),this.elements={},this.elements.container=i.createElement("div",{class:o+"-main "})}return r.prototype.initialize=async function(){return this.__buildUX()},r.prototype.getDOM=function(){return this.elements.container},r.prototype.__buildUX=async function(){this.elements.content=i.createElement("div",{class:o+"-content"}),this.elements.container.appendChild(this.elements.content),this.elements.noVIOContent=i.createElement("div",{class:o+"-no-vio-content"}),this.elements.noVIOContent.title=t.noTokenTooltip,this.elements.content.appendChild(this.elements.noVIOContent);let e=i.createElement("div",{class:o+"-no-vio"});this.elements.noVIOContent.appendChild(e),e.innerText=t.noToken;let r=i.createElement("div",{class:o+"-no-vioIcon "});r.appendChild(i.generateIcon({iconName:"tokens-delete",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"3x",className:o+"-icon "})),this.elements.noVIOContent.appendChild(r);let a=await s.getRegisteredRep(),l=UWA.Element.create("div",{class:o+"-registeredrep"}),p=UWA.Element.create("h1",{class:o+"-rep-label"});p.innerText=t.registeredrepLabelNoToken,l.appendChild(p);let d=UWA.Element.create("h2",{class:o+"-rep-value"});d.innerText=new Intl.NumberFormat(n.getLang(),{}).format(a.registeredRep),l.appendChild(d),this.elements.content.appendChild(l)},r}),define("DS/VIOCtrlCenterApp/components/AppViewCmp",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/views/ViewUtils","DS/VIOCtrlCenterApp/ws/WSAccess"],function(e,t,n,s,i,o){"use strict";class r{constructor(e){this.options=e||{},this.options=Object.assign({},this.options),this.elements={},this.elements.views={}}}return r.prototype.initialize=async function(){let e=this.options.target;this.elements.container=UWA.Element.create("div",{class:"vio-ctrl-app"}),e.appendChild(this.elements.container);let n=s.getComponent("AppModel");if(!0===n.isTokenAvailable()){i.mask(this.elements.container,t.loadingApp);let e=await s.loadAMD("DS/VIOCtrlCenterApp/views/Summary");this.elements.summary=new e({model:n}),this.elements.container.appendChild(this.elements.summary.getDOM());let o=await s.loadAMD("DS/VIOCtrlCenterApp/views/TokensHistory");this.elements.tokensHistory=new o({model:n}),this.elements.container.appendChild(this.elements.tokensHistory.getDOM()),await Promise.all([this.elements.summary.initialize(),this.elements.tokensHistory.initialize()]),this.elements.tokensHistory.redraw(),i.unmask(this.elements.container)}else{let e=new(await s.loadAMD("DS/VIOCtrlCenterApp/views/NoToken"))({model:n});this.elements.container.appendChild(e.getDOM()),this.elements.container.classList.add("notoken"),await e.initialize()}s.subscribe({event:"DS/App/resize"},this.refresh.bind(this)),s.setComponent("AppView",this)},r.prototype.refresh=async function(){let e=s.getComponent("AppModel");if(this.elements.tokensHistory&&this.elements.tokensHistory.destroy(),this.elements.container.innerHTML="",!0===e.isTokenAvailable()){i.mask(this.elements.container,t.loadingRefresh);let n=await s.loadAMD("DS/VIOCtrlCenterApp/views/Summary");this.elements.summary=new n({model:e}),this.elements.container.appendChild(this.elements.summary.getDOM());let o=await s.loadAMD("DS/VIOCtrlCenterApp/views/TokensHistory");this.elements.tokensHistory=new o({model:e}),this.elements.container.appendChild(this.elements.tokensHistory.getDOM()),await Promise.all([this.elements.summary.initialize(),this.elements.tokensHistory.initialize()]),this.elements.tokensHistory.redraw(),i.unmask(this.elements.container)}else{let t=new(await s.loadAMD("DS/VIOCtrlCenterApp/views/NoToken"))({model:e});this.elements.container.appendChild(t.getDOM()),this.elements.container.classList.add("notoken"),await t.initialize()}},r}),define("DS/VIOCtrlCenterApp/components/AppModelCmp",["i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/ws/WSAccess"],function(e,t,n,s){"use strict";class i{constructor(e){this.options=e||{},this.options=Object.assign({tokensAvailable:!1},this.options)}}return i.prototype.initialize=async function(){try{let e=await s.getCredits(),i=t.getProperty("token2track"),o=null,r=0;do{let t=e.data[r];t&&t.id===i?(o=t,this.options.tokensAvailable=!!o.total):r++}while(null===o&&r<e.data.length);this.options.tokenInfos=o||{},n.setComponent("AppModel",this)}catch(e){console.warn("## AppModelCmp.initialize: getCredits fails")}},i.prototype.refresh=async function(){try{let e=await s.getCredits(),n=t.getProperty("token2track"),i=null,o=0;do{let t=e.data[o];t&&t.id===n?(i=t,this.options.tokensAvailable=!!i.total):o++}while(null===i&&o<e.data.length);this.options.tokenInfos=i||{}}catch(e){console.warn("## AppModelCmp.refresh: getCredits fails")}},i.prototype.isTokenAvailable=function(){return this.options.tokensAvailable},i.prototype.getLabel=function(){return this.options.tokenInfos.label,this.options.tokenInfos.label.length?this.options.tokenInfos.label:this.options.tokenInfos.name},i.prototype.getFreeToken=function(){return this.options.tokenInfos.free},i.prototype.getTotalToken=function(){return this.options.tokenInfos.total},i.prototype.getUsedToken=function(){return this.options.tokenInfos.used},i.prototype.getExpireDate=function(){return this.options.tokenInfos.expireLong},i}),define("DS/VIOCtrlCenterApp/views/TokensHistory",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppUtils","DS/VIOCtrlCenterApp/ws/WSAccess","DS/Utilities/Dom","DS/VENHighChart/UIHighCharts","DS/Controls/DatePicker"],function(e,t,n,s,i,o,r){"use strict";const a="tokens-history",l=function(e,t){const n=new Date(e);return n.setFullYear(e.getFullYear()-t),n},p=function(e){let t=e.toLocaleString("en").split(","),n=t[0].split("/"),s=t[1].contains("AM")?"T00:00:00.000Z":"T23:59:59.000Z";return n[2]+"-"+("0"+n[0]).slice(-2)+"-"+("0"+n[1]).slice(-2)+s};function d(e){this.options=e||{},this.options.currentLayout=e.defaultLayout?e.defaultLayout:"chart",this.options.beginDate=new Date,this.options.beginDate.setDate(this.options.beginDate.getDate()-30),this.options.beginDate.setHours(0,0,0),this.options.endDate=new Date,this.options.endDate.setHours(23,59,59),this.options=Object.assign({model:null},this.options),this.elements={},this.elements.container=i.createElement("div",{class:a+"-main"})}return d.prototype.initialize=async function(){await this.__buildUX()},d.prototype.destroy=function(){this.elements.dateFromPicker.destroy(),this.elements.dateToPicker.destroy(),this.elements.container.innerHTML=""},d.prototype.getDOM=function(){return this.elements.container},d.prototype.redraw=function(){this.elements.consumptionCharts&&(this.elements.consumptionCharts.reflow(),this.switchConsumptionView(this.options.currentLayout))},d.prototype.__buildUX=async function(){this.elements.header=i.createElement("h2",{class:a+"-hdr"});let e=i.createElement("div",{class:a+"-hdr-title"});this.elements.header.appendChild(e),e.innerText=t.tokensHistory,await this.__setupHighchartsOpts(),this.elements.usage=i.createElement("div",{class:a+"-content"}),this.elements.usageCmd=i.createElement("div",{class:a+"-usageCmd"}),this.__buildUsageInterval(),this.elements.usage.appendChild(this.elements.usageCmd),this.elements.container.appendChild(this.elements.header),this.elements.container.appendChild(this.elements.usage);let n=i.createElement("div",{class:a+"-chart"}),s=this.elements.lineChart=i.createElement("div",{class:a+"-lineChart"});this.elements.consumption=i.createElement("div",{class:a+"-consumption"}),s.appendChild(this.elements.consumption),n.appendChild(s),this.elements.usage.appendChild(n),this.__addConsumptionEvo()},d.prototype.__addConsumptionEvo=async function(){let e=this.options.model.getTotalToken();if(this.options.evolution=await s.getConsumption({period:{begin:p(this.options.beginDate),end:p(this.options.endDate)},precision:100,tempTotal:e}),this.options.evolution.info){this.elements.consumption.innerHTML="";let e=i.createElement("div",{class:a+"-nodata"}),n=i.createElement("div",{class:a+"-nodata-msg"});n.innerText=t.noDataConsumed,e.appendChild(n),this.elements.consumption.appendChild(e)}else this.elements.consumption.innerHTML="",this.switchConsumptionView(this.options.currentLayout)},d.prototype.__setupHighchartsOpts=async function(){return new Promise((e,n)=>{var s=0,i=setInterval(()=>{void 0!==o&&(o.setOptions,1)?(o.setOptions({lang:{months:t.months,shortMonths:t.shortMonths,weekdays:t.weekdays},title:{align:"left",style:{fontSize:"14px",fontWeight:"bold"}},credits:{enabled:!1},exporting:{enabled:!1},legend:{labelFormat:"{y} {name}",layout:"proximate",align:"right",legendSymbol:"lineMarker",style:{fontSize:"10px"}}}),clearInterval(i),e()):100===++s&&(clearInterval(i),n())},100)})},d.prototype.switchConsumptionView=function(e){let s=this.options.evolution,i=s.evolutions.used?Math.max(n.getComponent("AppModel").getTotalToken(),s.evolutions.used[s.evolutions.used.length-1][1]):n.getComponent("AppModel").getTotalToken(),r=this.elements.lineChart.getBoundingClientRect();switch(e){case"chart":let n={chart:{type:"areaspline",height:r.height-40,width:r.width-40,renderTo:this.elements.consumption},title:{text:null},tooltip:{shared:!0},xAxis:{type:"datetime",labels:{format:"{value:%Y-%b-%e %H:%M}"}},yAxis:{visible:!0,max:i,title:{text:t.tokens}},plotOptions:{line:{marker:{enabled:!1,radius:2,states:{hover:{radius:4}}}},areaspline:{fillOpacity:1,marker:{enabled:!1,states:{hover:{enabled:!0,radius:4}}},lineWidth:1,states:{hover:{lineWidth:1}},threshold:null,size:"100%"}},series:[{type:"areaspline",color:"#78BEFA",name:t.used,data:s.evolutions.used},{type:"line",color:"#EA4F37",name:t.total,data:s.evolutions.total}]};this.elements.consumptionCharts=new o.Chart(n)}},d.prototype.__buildUsageInterval=function(){let e=i.createElement("div",{class:a+"-fromLabel"});e.innerText=t.fromLabel,this.elements.usageCmd.appendChild(e);let n=i.createElement("div",{class:a+"-fromDate"});this.elements.usageCmd.appendChild(n);let s=this.options.endDate?new Date(this.options.endDate):new Date;s.setHours(0,0,0);let o=l(new Date,1);o.setHours(0,0,0);let p=this.elements.dateFromPicker=new r({value:this.options.beginDate,minValue:o,maxValue:s});p.addEventListener("change",e=>{this.options.beginDate=e.dsModel.value,this.options.beginDate.setHours(0,0,0),this.__addConsumptionEvo()}),n.appendChild(p.getContent());let d=i.createElement("div",{class:a+"-toLabel"});d.innerText=t.toLabel,this.elements.usageCmd.appendChild(d);let c=i.createElement("div",{class:a+"-toDate"});this.elements.usageCmd.appendChild(c);let h=l(new Date,1);h.setHours(23,59,59);let u=this.elements.dateToPicker=new r({value:this.options.endDate,minValue:h,maxValue:new Date});u.addEventListener("change",e=>{this.options.endDate=e.dsModel.value,this.elements.dateFromPicker.maxValue=new Date(this.options.endDate),this.options.endDate.setHours(23,59,59),this.elements.dateFromPicker.maxValue.setHours(0,0,0),this.__addConsumptionEvo()}),c.appendChild(u.getContent())},d}),define("DS/VIOCtrlCenterApp/views/Summary",["css!DS/VIOCtrlCenterApp/VIOCtrlCenterApp.css","i18n!DS/VIOCtrlCenterApp/assets/nls/VIOCtrlCenterApp","DS/VIOCtrlCenterApp/utils/AppCntProxy","DS/VIOCtrlCenterApp/ws/WSAccess","DS/Utilities/Dom","DS/Controls/ProgressBar","DS/Controls/TooltipModel"],function(e,t,n,s,i,o,r){"use strict";const a="summary";function l(e){this.options=Object.assign({model:null},e),this.elements={},this.elements.container=i.createElement("div",{class:a+"-main "}),this.options.usage=100*this.options.model.getUsedToken()/this.options.model.getTotalToken()}return l.prototype.initialize=async function(){return this.__buildUX()},l.prototype.getDOM=function(){return this.elements.container},l.prototype.__buildUX=async function(){this.elements.hdr=i.createElement("h2",{class:a+"-hdr"}),this.elements.hdrTitle=i.createElement("h2",{class:a+"-hdr-title"}),this.elements.hdrTitle.innerText=t.summaryTitle,this.elements.hdr.appendChild(this.elements.hdrTitle),this.elements.hdrIcon=i.createElement("h2",{class:a+"-hdr-icon"}),this.elements.hdrIcon.tooltipInfos=new r({shortHelp:t.tokenUsageInfos}),this.elements.hdrIcon.appendChild(i.generateIcon({iconName:"clock-attention",fontIconFamily:WUXManagedFontIcons.Font3DS,className:a+"-hdr-icon "})),this.elements.hdr.appendChild(this.elements.hdrIcon),this.elements.container.appendChild(this.elements.hdr),this.elements.content=i.createElement("div",{class:a+"-content"}),this.elements.container.appendChild(this.elements.content);let e="info";this.options.usage>91?e="high-attention":this.options.usage>70&&(e="warning"),this.elements.statusContent=i.createElement("div",{class:a+"-status-content"}),this.elements.content.appendChild(this.elements.statusContent);let l=i.createElement("div",{class:a+"-status"});this.elements.statusContent.appendChild(l),l.innerText=t.tokenStatus;let p=i.createElement("div",{class:a+"-statusIcon "+e+"Status"});p.appendChild(i.generateIcon({iconName:100===this.options.usage?"tokens-delete":"tokens",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x",className:a+"-icon "})),this.elements.statusContent.appendChild(p);let d=i.createElement("div",{class:a+"-exp-date"}),c=new Date(this.options.model.getExpireDate());d.innerText=t.replace(t.expDate,{expDate:c.toLocaleDateString(n.getLang(),{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),this.elements.statusContent.appendChild(d),this.elements.infosContent=i.createElement("div",{class:a+"-infos-content"}),this.elements.content.appendChild(this.elements.infosContent);let h=i.createElement("div",{class:a+"-infos"});this.elements.infosContent.appendChild(h),h.innerText=t.tokenUsage,this.elements.usageBar=new o({displayStyle:"lite",value:this.options.usage,touchMode:!0,emphasize:e}),this.elements.usageBar.getContent().addClassName(a+"-usagebar"),this.elements.infosContent.appendChild(this.elements.usageBar.getContent());let u=i.createElement("div",{class:a+"-usageInfos"}),m=i.createElement("div",{class:a+"-usageToken"}),g=i.createElement("div",{class:a+"-usageUsed"});g.innerText=this.options.model.getUsedToken();let C=i.createElement("div",{class:a+"-usageSlash"});C.innerText="/";let f=i.createElement("div",{class:a+"-usageTotal"});f.innerText=this.options.model.getTotalToken(),m.appendChild(g),m.appendChild(C),m.appendChild(f),u.appendChild(m);let y=100*this.options.model.getUsedToken()/this.options.model.getTotalToken(),I=i.createElement("div",{class:a+"-used-percent"});I.innerText=t.replace(t.percentUsed,{percentUsed:y}),u.appendChild(I);let A=100*this.options.model.getFreeToken()/this.options.model.getTotalToken(),D=i.createElement("div",{class:a+"-rem-percent"});D.innerText=t.replace(t.percentRemaining,{remaining:this.options.model.getFreeToken(),percentRem:A}),u.appendChild(D),this.elements.infosContent.appendChild(u);let v=await s.getRegisteredRep(),w=UWA.Element.create("div",{class:a+"-registeredrep"}),S=UWA.Element.create("h1",{class:a+"-rep-label"});S.innerText=t.registeredrepLabel,w.appendChild(S);let O=UWA.Element.create("h2",{class:a+"-rep-value"});O.innerText=new Intl.NumberFormat(n.getLang(),{}).format(v.registeredRep),w.appendChild(O),this.elements.content.appendChild(w)},l});