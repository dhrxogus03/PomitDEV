define("DS/MPFBidding/TimelineUser",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFView/InitialsDotV2","DS/MPFError/BadArgumentError"],function(e,t,i,n,s){"use strict";return t.extend({className:"mpf-timeline-user",setup:function({name:t,date:r,logo:o,isDSOperator:a}={}){if(i.requiredOfType(t,"string","options.name must be a string"),!e.is(r))throw new s("options.date must be defined");this.name=t,this.date=r,this.logo=o;const c=a||"Dassault Systemes"===t;this.logoContainer=new n({image:this.logo,title:this.name,icon:c&&"3ds",backgroundColor:c&&"#005686"})},render:function(){return this.container.setContent([this.logoContainer.render(),{tag:"div",class:"mpf-caption-container",html:[this.name&&{tag:"div",class:"mpf-name-container",text:this.name,title:this.name},{tag:"div",class:"mpf-date-container",text:this.date.toLocaleDateString()},{tag:"div",class:"mpf-time-container",text:this.date.toLocaleTimeString()}]}]),this},destroy:function(){this.logoContainer.destroy(),this.logoContainer=null,this._parent(),this.container=null}})}),define("DS/MPFBidding/TimelineDocumentLink",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/MPFCartItemDocModel/CartItemDocModel","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError"],function(e,t,i,n,s,r){"use strict";return t.extend({className:"mpf-timeline-document-link",domEvents:{click:"_openDocument"},setup:function(t){if(s.requiredOfPrototype(t.doc,n,"options.doc must be a CartItemDocModel"),this.doc=t.doc,!e.is(this.doc.get("id")))throw new r("CartItemDocModel must have an id. New models are not accepted.")},render:function(){const e=this.doc.getDocName();return this.container.setContent([{tag:"span",class:"fonticon fonticon-doc"},{tag:"span",class:"mpf-document-name",text:e,title:e}]),this},destroy:function(){this.doc=null,this._parent(),this.container=null},_openDocument:function(){let t=this.doc.getDocUrl();e.is(t,"string")&&t.length>0?window.open(t,"_blank"):(i.mask(this.container.getElement(".mpf-document-name")),this.doc.fetchPromise().then(e=>{i.unmask(this.container.getElement(".mpf-document-name")),(t=e.getDocUrl())?window.open(t,"_blank"):this._dispatchOpeningDocFailure("Document URL not found")}).catch(e=>{i.unmask(this.container.getElement(".mpf-document-name")),this._dispatchOpeningDocFailure(e)}))},_dispatchOpeningDocFailure:function(e){console.error("Opening document failed"),console.error(e),this.dispatchEvent("openingDocFailed",{error:e,document:this.doc})}})}),define("DS/MPFBidding/TimelineTitleHelper",["UWA/Core","UWA/Class","DS/MPFCartModel/TimelineItemModel","i18n!DS/MPFBidding/assets/nls/Bidding"],function(e,t,i,n){"use strict";const s=t.extend();return s.createTitle=function(t,s){let r,o;const a={};if(t)switch(r=s?n.get("phaseX"+t,{number:s}):n.get(t),t){case i.Titles.SUBMITTED:o="fonticon-right order-status-pending",a.paddingRight="2px";break;case i.Titles.ACCEPTED:o="fonticon-thumbs-up order-status-confirmed";break;case i.Titles.CONFIRMED:o="fonticon-check order-status-confirmed";break;case i.Titles.PROCESSING:o="fonticon-clock order-status-updated";break;case i.Titles.READY:o="fonticon-forward order-status-confirmed",a.paddingBottom="1px";break;case i.Titles.SHIPPED:o="fonticon-trolley order-status-confirmed";break;case i.Titles.REJECTED:o="fonticon-ignore order-status-cancelled";break;case i.Titles.DELIVERED:o="fonticon-home order-status-confirmed",a.paddingLeft="1px";break;case i.Titles.CANCELLED:o="fonticon-wrong order-status-cancelled";break;case i.Titles.INVOICE_UPLOADED:case i.Titles.PO_UPLOADED:case i.Titles.DELIVERABLE_UPLOADED:o="fonticon-upload order-status-confirmed";break;case i.Titles.PAYMENT_RECEIVED:r=s?n.get("phaseXPaymentReceived",{number:s}):n.get("PaymentReceived"),o="fonticon-thumbs-up order-status-confirmed";break;case i.Titles.PENDING_PO:o="fonticon-clock order-status-pending";break;case i.Titles.PHASES_MODIFIED:case i.Titles.MODIFIED:o="fonticon-refresh order-status-updated",a.fontSize="16px",a.paddingTop="1px";break;case i.Titles.ADDED:o="fonticon-doc-add order-status-confirmed",a.fontSize="18px";break;case i.Titles.DELETED:o="fonticon-doc-delete order-status-cancelled",a.fontSize="18px"}if(e.is(r,"string")&&r.length>0){const t=[];return t.push(e.createElement("div",{text:r,title:r})),e.is(o)&&t.push(e.createElement("span",{class:"fonticon "+o+" order-status-icon",styles:a})),t}return null},s}),define("DS/MPFBidding/TimelineMessage",["UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/MPFBidding/TimelineDocumentLink","DS/MPFCartModel/TimelineItemModel","DS/MPFCartItemDocModel/CartItemDocModel","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCancelReasonCompiler","i18n!DS/MPFBidding/assets/nls/Bidding"],function(e,t,i,n,s,r,o,a,c){"use strict";return t.extend({className:"mpf-timeline-message",setup:function(e){o.requiredOfPrototype(e.timelineItem,s,"options.timelineItem must be a TimelinItemModel"),o.requiredOfPrototype(e.serviceView,t,"options.serviceView must be a UWA/Class/View"),this.timelineItem=e.timelineItem,this.cartItemDocFactory=e.cartItemDocFactory,this.serviceView=e.serviceView,this.annotations3dView=e.annotations3dView,this.title=e.title,this.message=this.timelineItem.getMessage(),this.alert=this._createAlert(),this.docEntries=[]},render:function(){return this.container.setContent([this._createTitleContainer(),this.alert,{tag:"div",class:"mpf-message-and-infos",html:[this._createMessageContainer(),this._createDocsAndServiceView()]}]),this},destroy:function(){this.stopListening();for(let e=0;e<this.docEntries.length;e++)this.docEntries[e].destroy(),this.docEntries[e]=null;this.serviceView.destroy(),this.docEntries=null,this.timelineItem=null,this._parent(),this.container=null},_createAlert:function(){return new i({autoHide:!0,hideDelay:3e3})},_createTitleContainer:function(){const t=e.is(this.title)?"mpf-title-container":"mpf-title-container hidden";return e.createElement("div",{class:t,html:this.title})},_createMessageContainer:function(){return e.createElement("div",{class:"mpf-message-container",text:this._getMessage()})},_getMessage:function(){let t=this.timelineItem.getMessage().message;const i=t.match(/&lt;/gim);e.is(i)&&i.forEach(function(e){t=t.replace(e,"<")});const n=t.match(/&gt;/gim);return e.is(n)&&n.forEach(function(e){t=t.replace(e,">")}),a.parse(t)},_createDocsAndServiceView:function(){const t=[this.annotations3dView.render(),this.serviceView.render()];if(this.cartItemDocFactory){const e=this.cartItemDocFactory.createCollection(null,this._filterMarketplaceDocuments());t.push(this._createDocumentContainer(e))}return e.createElement("div",{class:"mpf-docs-and-service-view",html:t})},_filterMarketplaceDocuments:function(){const e=[],t=this.timelineItem.getMessage().documentIDs||{};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const n=t[i];if(0!==n.indexOf("3dannotation_")){const t={};t.id=i,t[r.Fields.DOC_NAME]=n,e.push(t)}}return e},_createDocumentContainer:function(t){return this.docEntries=t.map(function(e){const t=new n({doc:e}).render();return this.listenTo(t,"openingDocFailed",this._onOpeningDocFailed.bind(this)),t},this),e.createElement("div",{class:"mpf-document-container",html:this.docEntries})},_onOpeningDocFailed:function(){this.alert.add({className:"error",message:c.get("openingDocumentFailed")}).show()}})}),define("DS/MPFBidding/TimelineEntry",["UWA/Core","UWA/Class/View","DS/MPFCartModel/TimelineItemModel","DS/MPFServices/ObjectService","DS/MPFBidding/TimelineUser","DS/MPFBidding/TimelineMessage","css!DS/MPFBidding/MPFBidding"],function(e,t,i,n,s,r){"use strict";return t.extend({className:"mpf-timeline-entry",setup:function(s){n.requiredOfPrototype(s.timelineItem,i,"options.timelineItem should be a TimelineItemModel"),n.requiredOfPrototype(s.serviceView,t,"options.serviceView must be an instance of UWA/Class/View"),this.timelineItem=s.timelineItem,this.cartItemDocFactory=s.cartItemDocFactory,this.serviceView=s.serviceView,this.annotations3dView=s.annotations3dView,e.is(s.title)&&(this.title=s.title),e.is(s.additionalClassName,"string")&&this.container.addClassName(s.additionalClassName),this.timelineMessage=this._createTimelineMessage(),this.timelineUser=this._createTimelineUser()},render:function(){return this.container.setContent([this.timelineUser.render(),this.timelineMessage.render()]),this},destroy:function(){this.timelineMessage.destroy(),this.timelineUser.destroy(),this.timelineMessage=null,this.timelineUser=null,this.timelineItem=null,this._parent(),this.container=null},_createTimelineMessage:function(){return new r({title:this.title,timelineItem:this.timelineItem,cartItemDocFactory:this.cartItemDocFactory,serviceView:this.serviceView,annotations3dView:this.annotations3dView})},_createTimelineUser:function(){const t=this.timelineItem.get("message"),i=e.is(t.author.shopName,"string")?t.author.shopName:t.author.firstName+" "+t.author.lastName;return new s({name:i,date:t.creation,logo:t.author.logo,isDSOperator:t.author.isDSOperator})}})}),define("DS/MPFBidding/TimelineContainer",["UWA/Core","UWA/Class/View","DS/MPFView/EmptyView","DS/MPFServices/ObjectService","DS/MPFBidding/TimelineTitleHelper","DS/MPFCartModel/TimelineItemCollection","DS/MPFBidding/TimelineEntry","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,s,r,o,a){"use strict";return t.extend({className:"mpf-bidding-timeline-container",setup:function(e){n.requiredOfPrototype(e.timelineItems,r,"options.timelineItems must be a TimelineItemCollection"),n.requiredOfType(e.currentUserId,"string","options.currentUserId must be a string"),this.timelineItems=e.timelineItems,this.currentUserId=e.currentUserId,this.cartItemDocFactory=e.cartItemDocFactory,this.serviceViewFactory=e.serviceViewFactory,this.annotations3dViewFactory=e.annotations3dViewFactory,this.rendered=!1,this.uiItems=this._createUIItems(),this.listenTo(this.timelineItems,"onAnyEvent",this._onModelChange),a.subscribe("MPCartTimeline",this._refreshTimelineOnEvent.bind(this))},render:function(){const e=[];for(let t=0;t<this.uiItems.length;t++)e.push(this.uiItems[t].render());return this.container.setContent(e),this.rendered=!0,this},refreshTimeline:function(){this.timelineItems&&this.timelineItems.fetchPromise()},destroy:function(){a.unsubscribe("MPCartTimeline"),this.stopListening();for(let e=0;e<this.uiItems.length;e++)this.uiItems[e].destroy(),this.uiItems[e]=null;this.timelineItems=null,this._parent(),this.uiItems=null,this.container=null},_onModelChange:function(){this.uiItems=this._createUIItems(),this.rendered&&this.render()},_createUIItems:function(){const e=[];for(let t=0;t<this.timelineItems.length;t++){const i=this.timelineItems.at(t);let n="";const r=i.getMessage();r.author&&r.author.id&&r.author.id===this.currentUserId&&(n+="right");const a=s.createTitle(i.getTitle(),i.getPhaseNumber()),c=this._createServiceView(i),l=this._createAnnotations3dView(i);e.push(new o({timelineItem:i,additionalClassName:n,title:a,cartItemDocFactory:this.cartItemDocFactory,serviceView:c,annotations3dView:l}))}return e},_createServiceView:function(t){let n;return n=e.is(this.serviceViewFactory,"function")?this.serviceViewFactory({timelineItem:t}):i.getInstance()},_createAnnotations3dView:function(t){let n;return n=e.is(this.annotations3dViewFactory,"function")?this.annotations3dViewFactory({timelineItem:t}):i.getInstance()},_refreshTimelineOnEvent:function(e){e&&"refresh"===e.event&&this.refreshTimeline()}})});