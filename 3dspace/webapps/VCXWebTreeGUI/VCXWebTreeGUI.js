define("DS/VCXWebTreeGUI/VCXWebTreeNodeView",["DS/Tree/TreeNodeView","DS/Core/PointerEvents","DS/CoreEvents/Events"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e),this.getViewNode=(e=>e&&e.classList.contains("wux-layouts-treeview-node")?e:e.getParent()),this.touchHoldActive=!1},updateInternalParameters:function(){this._parent(),this.getCellInfos().isHeader},_observeEvents:function(){var e,o=this,i=0,r=300;this.elements.container.addEvent(t.POINTERUP,function(n){void 0!==e&&clearTimeout(e),e=setTimeout(function(){i=0},r),i++,1===n.which&&((1===i||t.isTouchEvent(n)&&0===n.detail)&&o.getGridEngine()._modelEvents.publish({event:"nodeclick",data:o.getCellInfos()}),2===i&&o.getGridEngine()._modelEvents.publish({event:"nodeDblClick",data:o.getCellInfos()}))});var s,a=0;function l(e,t){var i=null;if(e&&(e.changedTouches&&1===e.changedTouches.length||0===e.button||2===e.button)){var l=e.target;l&&l.classList.contains("nodeTouchZone")?i=l:l.children.length&&(l=l.children[0])&&l.classList.contains("nodeTouchZone")&&(i=l)}var c=o.getGridEngine().options.selection.canMultiSelect&&(e.ctrlKey||o.getGridEngine().isInMultiSelection()||i),d=o.getGridEngine().options.selection.canMultiSelect&&e.shiftKey&&o.getGridEngine().options.selection.enableListSelection;if(!(1!==e.which&&3!==e.which||e.target.classList.contains("wux-layouts-treeview-expander")||function e(t,n){var o=t;return o?(" "+o.className+" ").replace(/[\n\t]/g," ").indexOf(" "+n+" ")>-1?o:e(o.parentNode,n):void 0}(e.target,"wux-controls-toggle"))){var h=o.getCellInfos();void 0!==s&&clearTimeout(s),s=setTimeout(function(){a=0},r),a++;var u=o.getGridEngine(),g=u.getDocument();if(!1===h.isHeader&&!1===u.options.selection.cells){var C=h.nodeModel;if(1===a&&u.options.selection.nodes)if(u.options.selection.toggle)C.isSelected()?o.__unselectNode(C):o.__selectNode(C,!c);else if(C.getTreeDocument().getXSO().get().length>1&&!c&&!d&&!C.getTreeDocument().getXSO().isIn(C))o.__selectNode(C,!c);else if(u.getNodesXSO().get().length>1&&!c&&C.getTreeDocument().getXSO().isIn(C))u._modeIsListSel||o.__selectNode(C,!c);else if(d){var m,p=g.getXSO().get();m=0===p.length?g.getChildren()[0]:!0===u._getParent().options.enableActiveUI?u.getActiveNode()===p[p.length-1]?p[0]:u.getActiveNode():p[0];var T=C;console.warn("select from",m._getRowID(),"to",T._getRowID()),m._getRowID()<T._getRowID()?g.withTransactionUpdate(function(){g.getXSO().empty();for(var e=m._getRowID();e<=T._getRowID();e++){var t=u.getTreeNodeModelFromRowID(e);o.__selectNode(t,!1)}}):g.withTransactionUpdate(function(){g.getXSO().empty();for(var e=m._getRowID();e>=T._getRowID();e--){var t=u.getTreeNodeModelFromRowID(e);o.__selectNode(t,!1)}})}else h.columnID<2&&(C.isSelected()?c?(o._unselectOnPointerUp=!0,o.__unselectNode(C)):(o._unselectOnPointerUp=!1,0===C.getTreeDocument().getXSO().get().length&&o.__selectNode(C)):o.__selectNode(C,!c))}n.publish({event:"VCXActiveCardMATERIAL",data:null});const i=/^label_.*ID$/i,l=o.getViewNode(e.target);(l.children.length>3&&!i.test(l.children[2].getAttribute("data-rec-id"))||"noChildren"!==l.children[0].getAttribute("data-wux-state"))&&n.publish({event:"/VCX/ContextualBar",data:{rightClick:3===e.which?0:t?2:1,coordinates:{x:e.clientX,y:e.clientY},noRatio:!0}})}}function c(e){if(e.stopPropagation(),"touchend"===e.type&&e.preventDefault(),o.getGridEngine()._giveFocus(),1===e.which||"touchend"===e.type){var t=o._cellModel.getCellContent();t.getChildren()&&"noExpandState"!==o._expandState&&"expandingState"!==o._expandState&&(t.isExpanded()&&"partiallyExpandedState"!==t._expandState?t.collapse():(o._setExpanderState("expandingState"),t.expand()))}}this.elements.container.addEvent(t.POINTERUP,e=>{null==this.getCellInfos()||"tree"!==this.getCellInfos().dataIndex&&"touchSelectionBar"!==this.getCellInfos().dataIndex||(this.touchHoldActive?this.touchHoldActive=!1:l(e))}),this.elements.container.addEvent(t.HOLD,e=>{null==this.getCellInfos()||"tree"!==this.getCellInfos().dataIndex&&"touchSelectionBar"!==this.getCellInfos().dataIndex||(this.touchHoldActive=!0,l(e,!0))}),this.elements.container.addEvent("contextmenu",e=>{l(e,!1)}),this.elements.expanderContainer.addEvent("mouseup",c),this.elements.expanderContainer.addEvent("touchend",c)}})}),define("DS/VCXWebTreeGUI/VCXITreeNode",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/VCXWebTreeGUI/VCXWebTabFrameCtrl",["UWA/Class","UWA/Core","DS/VCXGUIInfrastructure/VCXTabPageFrame","i18n!DS/VCXWebTreeGUI/assets/nls/VCXWebTreeGUI","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,o,i){"use strict";return e.extend({init:function(e){this._experienceBase=e,this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager")},createTabFrameAndSlidingViews:function(e){if(e&&e.sidePanelInfos&&e.slidingViewsTitles&&e.slidingViewsContainerIDs){this.panelCreationOptions=e,this.options={},this._vcxGuiManager.immersiveFrame&&(this.options.immersiveFrame=this._vcxGuiManager.immersiveFrame),this.options._uiLayer=this._vcxGuiManager._uiLayer,this.options.classBaseNameCSS=e.sidePanelInfos.classBaseNameCSS,this.options.appID=e.appID,this.options.sidePanel={title:e.sidePanelInfos.title,icon:e.sidePanelInfos.icon,side:e.sidePanelInfos.side,controller:this,usecallback:this.onresizePanel,currentDockArea:e.sidePanelInfos.dockArea},this.options.slidingViews={displayTabAtStart:e.slidingViewToDisplayAtStart,disableSlindingMenu:e.disableSlindingMenu,_vcxuiSequencesMaster:{}},this.options.slidingViews.views=[];for(var i=0;i<e.slidingViewsTitles.length;++i){var r=new t.Element("div",{id:e.slidingViewsContainerIDs[i]});this.options.slidingViews._vcxuiSequencesMaster[i+1]={},this.options.slidingViews._vcxuiSequencesMaster[i+1][e.slidingViewsTitles[i]]=r,this.options.slidingViews.views.push({title:e.slidingViewsTitles[i],content:{html:this.options.slidingViews._vcxuiSequencesMaster[1][e.slidingViewsTitles[i]]}})}this.options._experienceBase=this._experienceBase,this.options._i18n=o,this._tabPageFrame=new n(this.options),this.onCreateToolBarButtons(),this.updateToolbar();var s=this;this._onVisibleStateChange=function(e){s._tabPageFrame&&s._tabPageFrame.onResizeCB()},this._tabPageFrame._panelMaster.addEventListener("activate",this._onVisibleStateChange)}else console.warn("Unable to create tabFrame...")},unInitialize:function(){this._tabPageFrame&&this._tabPageFrame._panelMaster.removeEventListener("activate",this._onVisibleStateChange),this.getFrame()&&this.getFrame().unInitialize(),this.uiPanelClass&&this.uiPanelClass.unInitialize()},onresizePanel:function(e){e.updateToolbar()},getFrame:function(){return this._tabPageFrame},updateToolbar:function(){this.getFrame().getToolbar().updateToolbar()},onCreateToolBarButtons:function(){var e=this.getFrame().getToolbar(),t=this._vcxGuiManager._experienceBase.getManager("VCXExperience");if(t.updateLogData&&!0===t.updateLogData.showDialog&&e.addMainItemFixed("VCXShowUpdateViewCmd","","vcxToolbarButton wux-ui-3ds-update","VCXWebAuthoringCommands/VCXWebAuthoringCommands",i),this._selectLeavesFromSelectedNodes){var n=[];n[0]=this,n[1]=this._selectLeavesFromSelectedNodes,e.addMainItemFixed(n,"","vcxToolbarButton fonticon-tree-view-flattened-leaves","VCXWebTreeGUI/VCXWebTreeGUI",o,null,"VCXTreeToolbarSelectLeaves")}if(this._collapseAll){var r=[];r[0]=this,r[1]=this._collapseAll,e.addMainItemFixed(r,"","vcxToolbarButton fonticon-collapse-all","VCXWebTreeGUI/VCXWebTreeGUI",o,null,"VCXTreeToolbarCollapseAll")}if(this._changeSelectionVisibility){var s=[];s[0]=this,s[1]=this._changeSelectionVisibility,e.addMainItemFixed(s,"",["vcxToolbarButton","wux-ui-3ds wux-ui-3ds-eye","wux-ui-3ds wux-ui-3ds-checkbox-on"],"VCXWebTreeGUI/VCXWebTreeGUI",o,null,"VCXTreeToolbarChgSelectionVis")}},_getCurrentViewTreeCtrl:function(){var e={Assembly:{1:this._vcxGuiManager._vcxWebAssemblyTreeCtrl,2:this._vcxGuiManager._vcxWebSelectionSetsTreeCtrl,3:this._vcxGuiManager._vcxWebHotspotsTreeCtrl},Design:{1:this._vcxGuiManager._vcxWebDressupTreeCtrl}},t=this.getFrame()&&this.getFrame().options.sidePanel.title;if(t){if(e[t]){var n=this.getFrame()._slidingViews.getCurrentViewID();return[e[t][n]]}}else if(this.uiPanelClass&&this.uiPanelClass.tabViews&&e[this.getTreeId()]){if(this.uiPanelClass.tabViews.length){for(let[t,n]of this.uiPanelClass.tabViews.entries())if(n.isCurrent)return[e[this.getTreeId()][t]]}else if(this.tabCtrls)return this.tabCtrls;return[e[this.getTreeId()][1]]}return[]},getTreeId(){throw new Error("Not implemented")},_collapseAll:function(){var e=this._getCurrentViewTreeCtrl();for(const t of e){if(!t)return void console.warn("No tree found to collapse the nodes. Command aborted.");if(t._expandUntilNVisibleNodes){t.tree.getManager()._numberOfVisibleNodesInDocument>5&&(t.tree.getDocument().collapseAll(),t._expandUntilNVisibleNodes(5))}else t.tree.getDocument().collapseAll()}},_changeSelectionVisibility:function(){var e=this._getCurrentViewTreeCtrl();if(0!==e.length)for(const l of e){var t,n=l.tree.getDocument().getXSO().get();if(0===n.length)return;for(var o=0;o<n.length;++o){var i=n[o],r=l._getTreeNodeExtensionFromTreeNodeModel(i);if(r){var s=r.GetVisibility();if(s===l.EVisibilityState.Indeterminate){l.EVisibilityState.Indeterminate;break}t=void 0===t||s===t?s:-1}}var a=t===l.EVisibilityState.Hidden?l.EVisibilityState.Visible:l.EVisibilityState.Hidden;l.tree.getDocument().withTransactionUpdate(function(){for(var e=a===l.EVisibilityState.Hidden?"hidden":"visible",t=0;t<n.length;++t){var o=n[t],i=l._getTreeNodeExtensionFromTreeNodeModel(o);i&&i.SetVisibility(a)&&(o.options.visibilityState=e)}}),l.tree.getManager().updateView()}else console.warn("No tree found to change selection visibility. Command aborted.")}})}),define("DS/VCXWebTreeGUI/VCXWebDressupTabFrameCtrl",["DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/WebappsUtils/WebappsUtils","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","i18n!DS/VCXWebTreeGUI/assets/nls/VCXWebTreeGUI"],function(e,t,n,o,i){"use strict";return e.extend({init:function(e){this._parent(e);var t={sidePanelInfos:{classBaseNameCSS:"vcx-dressuptree-",title:"Design",icon:{iconName:"collection",fontIconFamily:WUXManagedFontIcons.Font3DS},side:"left",dockArea:WUXDockAreaEnum.LeftDockArea},slidingViewsTitles:["Design"],slidingViewsContainerIDs:["dressupTreeContainer"],slidingViewToDisplayAtStart:1,disableSlindingMenu:1};let r={title:i["VCXDesign.PanelTitle"],icon:"collection",immersiveFrame:this._vcxGuiManager.immersiveFrame,identifier:"dressupPanelV2",currentDockArea:localStorage.getItem("VCXNewFrame")?WUXDockAreaEnum.LeftDockArea:void 0},s=[{id:"defaultDressupHeader",title:i["VCXDesign.PanelTitle"],default:!0,commands:[{type:"command",icon:"eye-off",commandID:"VCXHideDressupsCmd",i18n:i.VCXHideDressupsCmd,hidden:!1},{type:"callback",icon:"annotation-eye-off",callback:this._changeSelectionVisibility.bind(this),i18n:i.VCXTreeToolbarChgSelectionVis,hidden:!1},{type:"callback",icon:"collapse-all",callback:this._collapseAll.bind(this),i18n:i.VCXTreeToolbarCollapseAll,hidden:!1}]}];e.getManager("VCXContextManager").isSupported("SceneControlV2")?(localStorage.getItem("VCXNewFrame")?this.uiPanelClass=new o(r,e.getManager("VCXContextManager").getContext()):this.uiPanelClass=new n(r,e.getManager("VCXContextManager").getContext()),this.uiPanelClass.generateHeaders(s)):this.createTabFrameAndSlidingViews(t)},getTreeId:()=>"Design",onCreateToolBarButtons:function(){this._parent(),this.getFrame().getToolbar().addMainItemFixed("VCXHideDressupsCmd","",["vcxToolbarButton","wux-ui-3ds wux-ui-3ds-eye-off",""],"VCXWebTreeGUI/VCXWebTreeGUI",i,null,"VCXTreeToolbarHideDressups")}})}),define("DS/VCXWebTreeGUI/VCXWebAssemblyTabFrameCtrl",["DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebTreeGUI/assets/nls/VCXWebTreeGUI"],function(e,t,n,o,i,r){"use strict";return t.extend({init:function(e){this._parent(e);var t=1,i=e.getManager("VCXContextManager");i&&(i.getOpenSMG()||i.getOpenSMGXML())&&(t=0);var s={sidePanelInfos:{classBaseNameCSS:"vcx-assemblytree-",title:"Assembly",icon:{iconName:"3dpart",fontIconFamily:WUXManagedFontIcons.Font3DS},side:"left",dockArea:WUXDockAreaEnum.LeftDockArea},slidingViewsTitles:["Assembly","SelectionSets","Hotspots"],slidingViewsContainerIDs:["AssemblyContainer","SelectionSetsAssemblyContainer","HotspotsAssemblyContainer"],slidingViewToDisplayAtStart:1,disableSlindingMenu:t};this._experienceBase.getManager("VCXContextManager");s.slidingViewsTitles=[r["VCXAssembly.PanelTitle"],r.SelectionSets,r.Hotspots];let a={title:r["VCXAssembly.PanelTitle"],icon:"3dpart",immersiveFrame:this._vcxGuiManager.immersiveFrame,identifier:"assemblyPanelV2",currentDockArea:localStorage.getItem("VCXNewFrame")?WUXDockAreaEnum.LeftDockArea:void 0},l=[{id:"defaultDressupHeader",title:r["VCXAssembly.PanelTitle"],default:!0,commands:[{type:"callback",icon:"folder-add",callback:this._createNewSelectionSet.bind(this),i18n:r.VCXTreeToolbarNewSelectionSet,hidden:!1},{type:"callback",icon:"fl-diagram-eye",callback:this._changeSelectionVisibility.bind(this),i18n:r.VCXTreeToolbarChgSelectionVis,hidden:!1},{type:"callback",icon:"collapse-all",callback:this._collapseAll.bind(this),i18n:r.VCXTreeToolbarCollapseAll,hidden:!1},{type:"callback",icon:"tree-view-flattened-leaves",callback:this._selectLeavesFromSelectedNodes.bind(this),i18n:r.VCXTreeToolbarSelectLeaves,hidden:!1}]}];e.getManager("VCXContextManager").isSupported("SceneControlV2")?(localStorage.getItem("VCXNewFrame")?this.uiPanelClass=new o(a,e.getManager("VCXContextManager").getContext()):this.uiPanelClass=new n(a,e.getManager("VCXContextManager").getContext()),this.uiPanelClass.generateHeaders(l)):this.createTabFrameAndSlidingViews(s)},getTreeId:function(){return"Assembly"},setSubTrees:function(e){this.tabCtrls=e},_selectLeavesFromSelectedNodes:function(){var t=this._getCurrentViewTreeCtrl();if(0!==t.length){var n=[];for(const e of t){for(var o=e.tree.getDocument().getSelectedNodes(),i=[],r=0;r<o.length;++r){var s=e._getTreeNodeExtensionFromTreeNodeModel(o[r]);s&&i.push(s)}for(var a=this._traverseForTreeNodeExtLeaves(i),l=0;l<a.length;++l){var c=a[l].GetObject();n.push(c)}}var d=new e(this._experienceBase.getManager("VCXSelectionManager"));d.SetComponentsSelection(n),this._experienceBase.getManager("VCXCommandManager").Push(d)}else console.warn("No tree found to collapse the nodes. Command aborted.")},_createNewSelectionSet:function(){this._experienceBase.getManager("VCXSelectionSetManager").createSelectionSetFromSelection()},_traverseForTreeNodeExtLeaves:function(e){for(var t=0,n=[],o=[],i=0;i<e.length;++i){var r=e[i],s=r.GetChildren();if(0===s.length)n.push(r);else for(t=0;t<s.length;++t)o.push(s[t])}if(0!==o.length){var a=[];for(t=0;t<o.length;++t)a.push(o[t]);var l=this._traverseForTreeNodeExtLeaves(a);n=n.concat(l)}return n}})}),define("DS/VCXWebTreeGUI/VCXWebStylesTabFrameCtrl",["DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/WebappsUtils/WebappsUtils"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e);var n={sidePanelInfos:{classBaseNameCSS:"vcx-stylestree-",title:"Styles",icon:t.getWebappsAssetUrl("VCXWebTreeGUI","icons/32/I_VCX_Tree_Dressup_TabIcon.png"),side:"left",dockArea:WUXDockAreaEnum.LeftDockArea},slidingViewsTitles:["Styles"],slidingViewsContainerIDs:["stylesTreeContainer"],slidingViewToDisplayAtStart:1,disableSlindingMenu:1};this.createTabFrameAndSlidingViews(n)}})}),define("DS/VCXWebTreeGUI/VCXWebTreeCtrl",["UWA/Core","UWA/Class","UWA/Utils/Client","DS/Core/Core","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Tree/Tree","DS/TreeModel/TreeDocument","DS/Tree/TreeNodeView","DS/TreeModel/TreeNodeModel","DS/Utilities/Array","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VCXWebSystem/VCXHardwareServices","DS/VCXWebTreeGUI/VCXWebTreeNodeView","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebPlatform/VCX3DSpaceServices"],function(e,t,n,o,i,r,s,a,l,c,d,h,u,g,C,m,p,T){"use strict";var f=t.extend({init:function(e){this._experienceBase=e,this._vcxGuiManager=e.getManager("VCXGUIManager"),this._multiSelBeforeForcing=null,this._eventTokens={},this._tabFrameCtrl=null,this._slidingViewIndex=-1,this._newSelection=null,this._newSelectionDoneWorkers=0,this.sizeCommandsCol=1},setTabFrameCtrl:function(e){this._tabFrameCtrl=e},getTabFrameCtrl:function(){return this._tabFrameCtrl},setSlidingViewIndex:function(e){this._slidingViewIndex=e},getSlidingViewIndex:function(){return this._slidingViewIndex},getTreeTitle:function(){},createTree:function(){var t=this,n={useAsyncPreExpand:!0,cellClass:m,shouldBeEditable:function(){return!1},shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1},onPreExpandCB:this._onPreExpandCB.bind(this),selection:{rowHeaders:!1,columnHeaders:!1,unselectAllOnEmptyArea:!0,enableListSelection:!0,toggle:!1,preSelection:!0},onCellClickCB:e=>this._onCellClickCb(e)},o=new a({useAsyncPreExpand:n.useAsyncPreExpand,shouldBeEditable:n.shouldBeEditable,shouldAcceptDrag:n.shouldAcceptDrag,shouldAcceptDrop:n.shouldAcceptDrop});"function"==typeof n.onPreExpandCB&&o.onPreExpand(n.onPreExpandCB);var l=[this._getTouchSelectionBarTreeColInfos(),this._getTreeMainColInfos(n),this._getPastilleColInfos(n),this._getCommandsColInfos(n)];this.tree=new s({treeDocument:o,height:"auto",defaultCellHeight:27,defaultCellWidth:32,apiVersion:2,cellClass:n.cellClass,selection:n.selection,columns:l,allowUnsafeHTMLContent:!0,shouldAcceptDrag:e=>{var t=e.nodeModel,n=this._getTreeNodeExtensionFromTreeNodeModel(t);if(n)return n.GetObject()&&(n.GetObject().IsKindOf("Model_VPMReference_Spec")||n.GetObject().IsKindOf("CXPExperience_Spec"))},data:{typeTree:this._type}}),this.tree.getManager().onCellClick(n.onCellClickCB),this.tree.getContent().addClassName("default-treeview-theme"),this.getTreeTitle()&&this.tree.getContent().addClassName(this.getTreeTitle().replace(/\s+/g,"").toLowerCase()+"-treeview-theme");let c=this._experienceBase.getManager("VCXContextManager").getPlayerMode();this._experienceBase.getManager("VCXContextManager").getProdHighMode()?this.tree.getContent().addClassName("xhighlight-treeview-theme"):c&&this.tree.getContent().addClassName("composer-treeview-theme"),this._setTreeRootsAndFirstNodes&&this._setTreeRootsAndFirstNodes(),this._setCustomEvtsSubscriptions&&this._setCustomEvtsSubscriptions(),this.tree.getDocument().getXSO().onEmpty(function(){if(t.tree.getDocument().prepareUpdate(),t._experienceBase.getManager("VCXSelectionManager").HasActors()){var e=new h(t._experienceBase.getManager("VCXSelectionManager"));e.SetSelection(),t._experienceBase.getManager("VCXCommandManager").Do(e)}t.tree.getDocument().pushUpdate()});var u=function(e){return e&&(e.changedTouches&&1===e.changedTouches.length||0===e.button)},g=null,C=function(e){if(u(e)){var n;n=e.changedTouches&&e.changedTouches[0]?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY};var o,i=document.elementFromPoint(n.x,n.y);if(!t.tree.getContent().contains(i))return;for(o=i;o!==t.tree.getContent()&&!o.classList.contains("wux-datagrid-cell");)o=o.parentElement;if(!o)return;if(o!==t.tree.getContent()&&o.dsView){var r=o.dsView.getCellInfos();if(g.lastTreeCellDSViewTouched&&g.lastTreeCellDSViewTouched.getCellInfos().rowID!==r.rowID){var s=g.lastTreeCellDSViewTouched.getCellInfos(),a=s.view;g.xsoHasBeenEmptied||(t.tree.getDocument().withTransactionUpdate(function(){var e=t.tree.getManager().getTreeNodeModelFromRowID(s.rowID);t.tree.getDocument().unselectAll(),e.selectionChangeIsFromUI(),e.select()}),g.xsoHasBeenEmptied=!0);var l=g.initialPointerDownCoordinates.y<a.getBoundingClientRect().bottom&&a.getBoundingClientRect().bottom<=n.y||g.initialPointerDownCoordinates.y>a.getBoundingClientRect().top&&a.getBoundingClientRect().top>=n.y,c=s.rowID,d=r.rowID,h=g.firstTreeCellDSViewTouched.getCellInfos().rowID,C=0,m=null,p=d<c?-1:1;if(!l){var T=-1===p?Math.max(h,d):Math.min(h,d);for(C=c;p*(T-C)>0;C+=p)(m=t.tree.getManager().getTreeNodeModelFromRowID(C))&&(m.selectionChangeIsFromUI(),m&&m.unselect&&m.unselect())}for(C=h;p*(d-C)>=0;C+=p)(m=t.tree.getManager().getTreeNodeModelFromRowID(C))&&!m.isSelected()&&m.select&&(m.selectionChangeIsFromUI(),m.select())}g.lastTreeCellDSViewTouched=o.dsView}}},p=function e(){null!==t._multiSelBeforeForcing&&(t.tree.getManager().forceMultiSelection(t._multiSelBeforeForcing),t._multiSelBeforeForcing=null),g=null,t.tree.getDocument().pushUpdate(),document.body.removeEventListener(r.POINTERMOVE,C,!1),document.body.removeEventListener(r.POINTERUP,e,!1)};this.tree.getContent().addEventListener(r.POINTERDOWN,function(e){if(u(e)){g={initialPointerDownCoordinates:null,firstTreeCellDSViewTouched:null,lastTreeCellDSViewTouched:null,xsoHasBeenEmptied:!1,multiSelBeforeForcing:null};let a={};var n;e.changedTouches&&e.changedTouches[0]?(n={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},a.x=e.changedTouches[0].clientX,a.y=e.changedTouches[0].clientY):(n={x:e.clientX,y:e.clientY},a.x=e.clientX,a.y=e.clientY),g.initialPointerDownCoordinates=n;var o=e.target,i=null;if(o&&o.classList.contains("nodeTouchZone")?i=o:o.children.length&&(o=o.children[0])&&o.classList.contains("nodeTouchZone")&&(i=o),i&&("boolean"!=typeof t._multiSelBeforeForcing&&(t._multiSelBeforeForcing=t.tree.getManager()._modeIsMultiSel,t.tree.getManager().forceMultiSelection(!0)),t.tree.getDocument().prepareUpdate(),t.tree.getContent().contains(i))){for(var s=i;s!==t.tree.getContent()&&!s.classList.contains("wux-datagrid-cell");)s=s.parentElement;s!==t.tree.getContent()&&s.dsView&&(g.firstTreeCellDSViewTouched=s.dsView,document.body.addEventListener(r.POINTERMOVE,C,!1),document.body.addEventListener(r.POINTERUP,p,!1))}}},!1),this._eventTokens._evtSelectionEmptyToken=i.subscribe({event:"VCX_SELECTION_EMPTY"},function(){t.tree.getManager().unselectAll()}),this._eventTokens._evtPreHLEmptyToken=i.subscribe({event:"VCX_PREHIGHLIGHT_EMPTY"},function(){var e=t.tree.getDocument().getAllDescendants();t.tree.getDocument().getPXSO().empty(),d.optimizedForEach(e,function(e){t._switchTreeNodePreHighlight(e,!1)})}),this._eventTokens._evtPreHLRemoveToken=i.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},function(e){if(e&&Array.isArray(e))for(var n=0;n<e.length;++n){var o=e[n]&&e[n].pathElement;o&&t._removePreHLFromPathElement(o)}}),this._eventTokens._evtPreHLAddToken=i.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},function(e){if(e&&Array.isArray(e))for(var n=0;n<e.length;++n){var o=e[n]&&e[n].pathElement;o&&t._addPreHLFromPathElement(o)}}),this.tree.getDocument().getPXSO().onAdd(function(e){t.onChangeTreePSO(e,!0)}),this.tree.getDocument().getPXSO().onRemove(function(e){t.onChangeTreePSO(e,!1)}),this._eventTokens._evtOnChgSelAddToken=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(e){t._onChangeSelectionCB(e,!0)}),this._eventTokens._evtOnChangeSelRemoveToken=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(e){t._onChangeSelectionCB(e,!1)}),this._eventTokens._evtOnChangeSelRemoveFromTreeToken=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE_FROM_TREE_ASSY_SEL"},function(e){t._onChangeSelectionCB(e,!1)}),this._eventTokens._evtOnChangePropertiesToken=i.subscribe({event:"VCX_PROPERTIES_CHANGED"},function(e){if(e&&e.GetListModifiables){var n=[];e.GetListModifiables(n);for(var o=0;o<n.length;++o){var i=n[o],r=i&&e.GetPropertySet(i),s=r&&r.GetProperty("Actor.Name");if(s){var a=s.GetPropertyValue().GetValue();t._updateTreeNodeNameFromHashing(i,a)}}}});let T=e.Element("div",{class:"vcx-parent-tree"});return this.tree.inject(T),T},onChangeTreePSO:function(e,t){var n=e&&this._getTreeNodeExtensionFromTreeNodeModel(e),i=n&&n.QueryInterface("W3AISGNodeHolder"),r=i&&i.getPathElement();if(r){var s={pathElement:r},a=o.Selection.PSOManager.isIn(s);if(!a&&t){for(var l=o.Selection.PSOManager.get(),c=!1,d=0;d<l.length;++d){var h=l[d];if(u.BuildCleanedPathElement(h.pathElement).isEqual(r)){c=!0;break}}c||o.Selection.PSOManager.add(s)}else a&&!t&&o.Selection.PSOManager.remove(s)}this.tree.getManager().updateView()},unInitialize:function(){for(var e in this._eventTokens)this._eventTokens.hasOwnProperty(e)&&this._eventTokens[e]&&i.unsubscribe(this._eventTokens[e]);if(this.tree){var t=this.tree.getDocument();t._cleanBindingOnDocument?t._cleanBindingOnDocument():t._cleanBindings&&t._cleanBindings();var n=t.getRoots();this._deleteChildrenAndSelves(n),t.empty();var o=this.tree.getManager();o._alreadyRendered=!0,o._computeModelSize=(()=>{}),o.actualizeScrollerPosition=(()=>{}),o.updateView=(()=>{}),o.unloadDocument(),this.tree.destroy(),t.options=t.defaultOptions,o.options=o.defaultOptions,this.tree.options=this.tree.defaultOptions,this.tree=null}this._experienceBase=null,this._vcxGuiManager=null,this._eventTokens={},this._tabFrameCtrl=null,this._newSelection=null,this._selectStack=null},unstackSelect(){if(this._selectStack){var e=this;if(!this.isThisTreeInView())return;this.tree.getDocument().withTransactionUpdate(function(t){for(var n in e._selectStack){if(void 0!==e._selectStack[n].preSelect){let t=e._selectStack[n].TreeModel;t.options.isPreHighlighted!==e._selectStack[n].preSelect&&t.updateOptions({isPreHighlighted:e._selectStack[n].preSelect})}void 0!==e._selectStack[n].select&&(e._selectStack[n].select?e._selectStack[n].TreeModel.select():e._selectStack[n].TreeModel.unselect())}e._selectStack=null})}},_deleteChildrenAndSelves:function(e){for(var t=0;t<e.length;++t){var n=e[t],o=n.getChildren();o&&o.length>0&&(this._deleteChildrenAndSelves(o),n.removeChildren()),n.options=n.defaultOptions}},isThisTreeInView:function(){return this.getTabFrameCtrl()._getCurrentViewTreeCtrl().includes(this)},expandTreeWithComponent:function(e){var t=this;if(e){var n=e.QueryInterface("VCXITreeNode");n?this.tree.getDocument().withTransactionUpdate(function(){t._revExpandFromTreeNodeExt(n)}):console.log("Couldn't fetch treeNode extension")}else console.log("A component is needed in argument of this method..")},selectTreeNodesFromComponentList:function(e){var t=this;this.tree.getDocument().withTransactionUpdate(function(){for(var n=0;n<e.length;++n){var o=e[n];t.expandTreeWithComponent(o)}});for(var n=0;n<e.length;++n)for(var o=e[n].QueryInterface("VCXITreeNode").GetTreeNodesModelsFromTree(t._type),i=0;i<o.length;++i)if(o[i]&&o[i]){let e=o[i];this.initializeStackForElem(e),this._selectStack[e._getID()].select=!0}},unselectTreeNodesFromComponentList:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(!this.isComponentMatchingThisTree(n))continue;var o=n.QueryInterface("VCXITreeNode"),i=o&&o.GetTreeNodesModelsFromTree(this._type);let s=o.QueryInterface("VCXIModelNavigable");if(s){let e=s.getParent();null==e||e.QueryInterface("VCXIModifiable")||e.QueryInterface("VCXISelectBehavior")||this.unselectTreeNodesFromComponentList([e.GetObject()])}if(Array.isArray(i))for(var r=0;r<i.length;++r)if(i[r]){let e=i[r];this.initializeStackForElem(e),this._selectStack[e._getID()].select=!1}}},_createTreeNodeModel:function(e,t,n,o,i){if(e){var r=t,s=e.QueryInterface("VCXIModifiable");if(s){var a=s.GetProperty("Actor.Name");a&&(r=a.GetPropertyValue().GetValue())}var l=new c({label:r,children:n?[]:null,data:{vcxTreeNode:e}});e.SetNewTreeNodeModel(l,this._type),e.getTreeNodeComponentIcon();var d=o||this._onSelectionEvtOnTreeNodeCB;l.onSelect(d.call(this));var h=i||this._onSelectionEvtOnTreeNodeCB;return l.onUnselect(h.call(this)),l}console.warn("A VCXTreeNode extension is necessary as parameter of this method")},_destroyTreeNodeModel:function(e){this._getTreeNodeExtensionFromTreeNodeModel(e).UnsetTreeNodeModel(e,this._type),e.remove()},_revExpandFromTreeNodeExt:function(e){var t=e.GetTreeNodesModelsFromTree(this._type);if(0===t.length){for(var n=[],o=e;o&&!o.hasTreeNodeModels(this._type);){if(!(o=o.GetParent()))return;n.push(o)}for(;0!==n.length;)for(var i=n.pop().GetTreeNodesModelsFromTree(this._type),r=0;r<i.length;++r)i[r].isExpanded()||i[r].expand()}else for(var s=0;s<t.length;++s)t[s].isVisible()||t[s].reverseExpand()},_getParentTreeNodeModelFromTreeNodeExt:function(e,t){var n=e.GetParent();if(n){var o=n.GetTreeNodesModelsFromTree(this._type);if(0===o.length&&!0===t){var i=this._getParentTreeNodeModelFromTreeNodeExt(n,!0);if(!i)return void console.log("Couldn't find a parent treeNodeModel in the tree "+this._type+" for the component :",n.GetObject());i.expand(),o=n.GetTreeNodesModelsFromTree(this._type)}if(!(o.length>1))return o[0]}else console.log("Couldn't find treeNode extension for component parent...")},_addTreeNodesFromComponentsList:function(e){this._modifyTreeNodesFromComponentsList(e,!0)},_removeTreeNodesFromComponentsList:function(e){this._modifyTreeNodesFromComponentsList(e,!1)},_modifyTreeNodesFromComponentsList:function(e,t){if("boolean"==typeof t){var n=this,o=t?this._addTreeNodeFromComponent:this._removeTreeNodeFromComponent;this.tree.getDocument().withTransactionUpdate(function(){for(var t=0;t<e.length;++t){var i=e[t];n.isComponentMatchingThisTree(i)&&o.call(n,i)}})}},_addTreeNodeFromComponent:function(e){var t=e&&e.QueryInterface("VCXITreeNode");if(t)if(t.GetParent())if((o=e.QueryInterface("VCXITreeNode").GetTreeNodesModelsFromTree(this._type)).length>0&&this._uniqueTreeNodePerComponent)console.log("TreeNodeModels should be unique per component in this tree, and there's already"+o.length+"treenodes here.\nAddition of treeNode aborted.:",e);else{var n=this._getParentTreeNodeModelFromTreeNodeExt(t,!0);if(n){Array.isArray(n.options.children)||n.updateOptions({children:[]}),n.isVisible()||n.reverseExpand(),n.expand();var o,i=(o=e.QueryInterface("VCXITreeNode").GetTreeNodesModelsFromTree(this._type))[0];if(!(1===o.length&&(this._uniqueTreeNodePerComponent||i.getParent()===n)||i&&i.getParent()===n)){var r=this._createTreeNodeModel(t,t.GetName(),t.GetChildren().length>0);n.addChild(r)}}}else console.warn("The component parent must have a treeNode interface.\nAbort addition of treeNode in tree.");else console.warn("The component must have a treeNode interface. Abort addition of treeNode in tree.")},_removeTreeNodeFromComponent:function(e){var t=e.QueryInterface("VCXITreeNode").GetTreeNodesModelsFromTree(this._type);if(0!==t.length)for(t.length>1&&this._uniqueTreeNodePerComponent&&console.log("TreeNodeModels should be unique per component in this tree. Before removal, there are "+t.length+" treeNodes for the component:",e);0!==t.length;){var n=t.pop();this._destroyTreeNodeModel(n)}},_onSelectionEvtOnTreeNodeCB:function(e){var t=this;return function(e){var n=e.target,o=(n.isSelectionChangeFromUI(),e.event);t._checkForSelectionParentAuto(o,n),t._selectComponent(o,n)}},_selectComponent:function(e,t){var n="select"===e?"add":"unselect"===e?"remove":"",o=this._experienceBase.getManager("VCXSelectManager");if(!(o&&o.isEventCallbackBlocked&&o.isEventCallbackBlocked(n,"SELECTION"))){var i=this._getTreeNodeExtensionFromTreeNodeModel(t),r=i&&i.GetObject();r?"select"===e?this._addTreeNodeCompToSelection(r):"unselect"===e&&this._removeTreeNodeCompFromSelection(r):console.warn("Component associated to specified selectedTreeNodeModel couldn't be found...")}},_areChildrenAllSelected:function(e){for(var t=e&&e.getChildren(),n=t&&t.length>0,o=0;o<t.length&&n;++o)n=n&&t[o].isSelected();return n},_checkForSelectionParentAuto:function(e,t){var n="select"===e,o=!t.isRoot()&&t.getParent();if(o){var i=this._getTreeNodeExtensionFromTreeNodeModel(o),r=(i&&i.QueryInterface("VCXIModifiable"),i&&i.QueryInterface("VCXISelectBehavior"));if(r&&1===r.GetSelectMode()){var s=o.isSelected();n&&(s=(s=!s)&&this._areChildrenAllSelected(o)),s&&(o[e](),this._checkForSelectionParentAuto(e,o))}}},_addTreeNodeCompToSelection:function(e){var t=this._experienceBase.getManager("VCXSelectionManager");e.QueryInterface("VCXIModifiable");if(!t.isIn(e)){var n=new h(t);1!==this.tree.getDocument().getXSO().get().length||this.tree.getManager().isInMultiSelection()?n.AddToSelection(e):n.SetSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(n);t=this._experienceBase.getManager("VCXSelectionManager"),new h(t),t.GetComponentsFromCurrentSelection()}},_removeTreeNodeCompFromSelection:function(e){var t=this._experienceBase.getManager("VCXSelectionManager");e.QueryInterface("VCXIModifiable");if(t.isIn(e)){var n=new h(t);n.RemoveFromSelection(e),this._experienceBase.getManager("VCXCommandManager").Do(n)}},_switchTreeNodePreHighlight:function(e,t,n){var o=t?n?2:1:0;this.initializeStackForElem(e),this._selectStack[e._getID()].preSelect=o},_updateTreeNodeNameFromHashing:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").ModifiableServer,o=n&&n.GetModifiableFromHashing(e),i=o&&o.QueryInterface("VCXITreeNode"),r=i&&i.GetTreeNodesModelsFromTree();if(Array.isArray(r))for(var s=0;s<r.length;++s){var a=r[s];a&&a.updateOptions({label:t})}},_getFirstVisibleTreeNodesFromComponent:function(e){var t=this._type,n={visible:{},hiding:{}},o=e.QueryInterface("VCXITreeNode"),i=o&&o.GetTreeNodesModelsFromTree(t);if(Array.isArray(i)){if(1===i.length&&i[0].isVisible())return n.visible[i[0]._getID()]=i[0],n;var r=e.QueryInterface("VCXIModelNavigable");if(r.getParent())for(;e&&Array.isArray(i)&&1!==i.length&&r;)i=(o=(e=(r=r.getParent())&&r.GetObject())&&e.QueryInterface("VCXITreeNode"))&&o.GetTreeNodesModelsFromTree(this._type);if(e)if(i&&1===i.length){for(var s=i[0];s&&!s.isVisible();){var a=this._getTreeNodeExtensionFromTreeNodeModel(s),l=a&&a.GetParent();i=l.GetTreeNodesModelsFromTree(this._type),Array.isArray(i)&&1===i.length||console.warn("There should be only one treeNodeModel per component within dressups and assembly trees"),s=l&&l.GetTreeNodesModelsFromTree(this._type)[0]}if(s)return n.hiding[s._getID()]=s,n;console.warn("_getFirstVisibleTreeNodesFromComponent: Something has gone wrong, no treeNode ancestor of the component treeNode has been found.")}else console.warn("Something's wrong with the recovery of a treeNodeModel within AssemblyTree. There should be only one instead of "+(i&&i.length)+".");else console.log("No component ancestor has been found..")}else console.warn("Something's wrong with the recovery of treeNode extension or treeNodesModels...")},_switchPreHLFromPathElement:function(e,t){var n=u.BuildCleanedPathElement(e),o=this._experienceBase.ComponentsMap.GetComponentFromPathElement(n);if(o&&this.isComponentMatchingThisTree(o)){var i=this._getFirstVisibleTreeNodesFromComponent(o);if(i){var r="";for(r in i.visible)this._switchTreeNodePreHighlight(i.visible[r],t,!1);for(r in i.hiding)i.hiding.hasOwnProperty(r)&&this._switchTreeNodePreHighlight(i.hiding[r],t,!0)}}},initializeStackForElem:function(e){let t=e._getID();this._selectStack||(this._selectStack={}),this._selectStack[t]||(this._selectStack[t]={TreeModel:e})},_addPreHLFromPathElement:function(e){this._switchPreHLFromPathElement(e,!0)},_removePreHLFromPathElement:function(e){this._switchPreHLFromPathElement(e,!1)},_onChangeSelectionCB:function(e,t){var n;if(t?("select",n=this.selectTreeNodesFromComponentList):("unselect",n=this.unselectTreeNodesFromComponentList),Array.isArray(e)&&e.length>0&&e[0].GetType){for(var o=[],i=0;i<e.length;++i){var r=e[i];r&&this.isComponentMatchingThisTree(r)&&o.push(r)}0!==o.length&&n.call(this,o)}else console.log("Current event should have an array of components as 'componentsList' parameter.")},_getTouchSelectionBarTreeColInfos:function(){var e=this;return{dataIndex:"touchSelectionBar",width:C.isTouchCompliantDevice()?20:15,isColumnDraggable:!1,onCellRequest:function(t){e._onTouchSelectionBarCellRequest(t)}}},_getTreeMainColInfos:function(e){return{dataIndex:"tree",isColumnDraggable:!0,onDragStartCell:async(e,t)=>{var n=t.nodeModel,o=this._getTreeNodeExtensionFromTreeNodeModel(n);if(!o)return;let i=o.GetObject().IsKindOf("CXPExperience_Spec"),r=await p.GetTenantId(),s=await T.GetPreferredSecurityContext(),a=i?this._experienceBase.getManager("VCXEWSManager").getExperiencePhysicalProduct():await o.QueryInterface("CATI3DXAssetProperties").getPhysicalId(),l={protocol:"3DXContent",version:"1.0",source:"XCTXPR_AP",widget_id:widget.id,data:{items:[{envId:r,serviceId:"3DSpace",contextId:s.role+"."+s.organization+"."+s.collabspace,objectId:a,objectType:i?"HighlightPresentation3DCom":"VPMReference",displayName:o.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),displayType:i?"Highlight Presentation":"Physical Product",displayIcon:""}]}};e.dataTransfer.items.add(JSON.stringify(l),"text/plain")},onCellRequest:e=>this.onCellRequest(e,"tree")}},_getPastilleColInfos:function(e){let t="pastille";return{text:t,dataIndex:t,width:6,onCellRequest:e=>this.onCellRequest(e,t),isColumnDraggable:!1}},_getCommandsColInfos:function(e){let t="commands";return{text:t,dataIndex:t,width:32,onCellRequest:e=>this.onCellRequest(e,t),isColumnDraggable:!1}},_onPreExpandCB:function(e){var t=e.target,n=this._getTreeNodeExtensionFromTreeNodeModel(t);if(!n)return console.warn("Something's wrong: there should be a treeNodeExtension associated with the treeNodeModel: "+t),void t.preExpandDone();if(t.hasChildren()||0===n.GetChildren().length)t.preExpandDone();else{for(var o=n.GetChildren(),i=[],r=0;r<o.length;++r){var s=o[r];if(this.isComponentMatchingThisTree(s.GetObject()))if(s){var a=s.GetChildren(),l=this._createTreeNodeModel(s,s.GetName(),0!==a.length);i.push(l)}else console.log("VCXITreeNode extension missing...")}t.addChild(i),t.preExpandDone()}},_onTouchSelectionBarCellRequest:function(t){var n=t.cellView.getContent();if(null!==this._experienceBase){var o=C.isTouchCompliantDevice()?20:15,i=n.getBoundingClientRect(),s=100===i.width?o:i.width,a=i.height,l=e.createElement("div",{class:"nodeTouchZone",styles:{position:"absolute",top:"0px",left:"0px",width:2*s+"px",height:a+"px",marginLeft:-Math.floor(s/2)+"px"}});l.inject(n);var c=this;l.addEventListener(r.POINTERDOWN,function(){"boolean"!=typeof c._multiSelBeforeForcing&&(c._multiSelBeforeForcing=c.tree.getManager()._modeIsMultiSel,c.tree.getManager().forceMultiSelection(!0));document.addEventListener(r.POINTERUP,function e(t){"touchend"===t.type&&t.preventDefault(),"boolean"==typeof c._multiSelBeforeForcing&&(c.tree.getManager().forceMultiSelection(c._multiSelBeforeForcing),c._multiSelBeforeForcing=null),document.removeEventListener(r.POINTERUP,e,!1)},!1)},!1)}},onCellRequest:function(t,n){var o=t.nodeModel,i=this._getTreeNodeExtensionFromTreeNodeModel(o);if(i)if(this.cleanCell(t),this.getCommonIcon(t,i),"tree"===n)this.getTreeIcon(t,i);else if("commands"===n){let n=this.getCommandsIcon(t,i);if(!n)return;for(n.length>this.sizeCommandsCol&&(this.sizeCommandsCol=n.length,this.tree.getManager().setColumnWidth("commands",32*this.sizeCommandsCol));n.length<this.sizeCommandsCol;){n=[new e.Element("div",{class:"vcxcommandtreecontainer"})].concat(n)}t.cellView.getContent().setContent(n)}else"pastille"===n&&this.getPastilleIcon(t,i)},getCommonIcon:function(e,t){return t.getCommonIcon(e,this._type)},getTreeIcon:function(e,t){return t.getTreeIcon(e,this._type)},getCommandsIcon:function(e,t){return t.getCommandsIcon(e,this._type)},getPastilleIcon:function(e,t){return t.getPastilleIcon(e,this._type)},cleanCell:function(e){e.cellView.onClickCell&&delete e.cellView.onClickCell},_onCellClickCb:function(e){e.cellView&&e.cellView.onClickCell&&e.cellView.onClickCell()},removeClassName:function(e,t){e.hasClassName(t)&&e.removeClassName(t)},addClassName:function(e,t){e.hasClassName(t)||e.addClassName(t)}});return f.prototype._getTreeNodeExtensionFromTreeNodeModel=function(e){return e&&e.options&&e.options.data&&e.options.data.vcxTreeNode},f.prototype.EVisibilityState={Indeterminate:-1,Hidden:0,Visible:1,Ghost:2},f}),define("DS/VCXWebTreeGUI/VCXWebAssemblyTreeCtrl",["DS/CoreEvents/Events","DS/TreeModel/TreeNodeModel","DS/VCXWebTreeGUI/VCXWebTreeCtrl"],function(e,t,n){"use strict";return n.extend({init:function(e){this._parent(e),this._type="VCXWebAssemblyTreeCtrl",this._uniqueTreeNodePerComponent=!0},getTreeTitle:function(){return"Assembly"},getOrCreateTreeNodesModelFromComponent:function(e){if(!e)return null;const t=e.QueryInterface("VCXIModelNavigable"),n=e.QueryInterface("VCXITreeNode");let o=n.GetTreeNodesModelsFromTree(this._type);if(!o||!o.length){var i=t.getChildren().length>0;const e=this._createTreeNodeModel(n,void 0,i);this.getOrCreateTreeNodesModelFromComponent(t.getParent())[0].addChild(e),o.push(e)}return o},_setTreeRootsAndFirstNodes:function(){var e=this._experienceBase.getManager("VCXContextManager").getRootComponent(),t=e.QueryInterface("VCXITreeNode"),n=e.QueryInterface("VCXIModelNavigable");if(t&&n){var o="Root",i=e.QueryInterface("VCXIModifiable");if(i){var r=i.GetProperty("Actor.Name");r&&(o=r.GetPropertyValue().GetValue())}var s=n.getChildren().length>0,a=this._createTreeNodeModel(t,o,s);this.tree.getDocument().addRoot(a),s&&this._expandUntilNVisibleNodes(5)}else console.warn("Experience component need at least a navigable and a treeNode interfaces.")},_setCustomEvtsSubscriptions:function(){var t=this;this._eventTokens._evtOnAddAssetToken=e.subscribe({event:"VCX_ASSETS_ADDED"},function(e){Array.isArray(e)?t._addTreeNodesFromComponentsList(e):console.log("VCX_ASSETS_ADDED event data has been changed...")}),this._eventTokens._evtOnRemoveAssetToken=e.subscribe({event:"VCX_ASSETS_REMOVED"},function(e){if(WUX.Selection.HSOManager.empty(!0),WUX.Selection.CSOManager.empty(!0),WUX.Selection.PSOManager.empty(!0),Array.isArray(e)){for(var n=[],o=0,i=0;i<e.length;i++){e[i].QueryInterface("VCXIModelNavigable").traverse(function(e){e&&(n.push(e.GetObject()),o++)})}console.log("VCX_ASSETS_REMOVED : nbnodes removed ="+o),t._removeTreeNodesFromComponentsList(e)}else console.log("VCX_ASSETS_REMOVED event data has been changed...")})},_expandUntilNVisibleNodes:function(e,t){var n=null,o=[];if(t)n=[t];else{var i=this.tree&&this.tree.getDocument().getRoots();if(!i||Array.isArray(i)&&0===i.length)return;for(var r=0,s=i.length;r<s;++r)i[r].isVisible()&&o.push(i[r]);n=i}for(;o.length<e&&Array.isArray(n)&&0!==n.length;){for(var a=[],l=0;l<n.length;++l){n[l].isExpanded()||n[l].expand();var c=n[l].getChildren();Array.isArray(c)&&(o=o.concat(c),a=a.concat(c))}n=a.slice()}},isComponentMatchingThisTree:function(e){return e.IsKindOf("VCXComponentOccurrenceExt")||e.IsKindOf("CIDItem_Spec")||e.IsKindOf("Abstract3DExperienceObject_Spec")}})}),define("DS/VCXWebTreeGUI/VCXWebDressupTreeCtrl",["DS/CoreEvents/Events","DS/TreeModel/TreeNodeModel","DS/VCXWebTreeGUI/VCXWebTreeCtrl"],function(e,t,n){"use strict";return n.extend({init:function(e){this._parent(e),this._type="VCXWebDressupTreeCtrl",this._uniqueTreeNodePerComponent=!0,this._hideEmptyDrspGrps=!1},getTreeTitle:function(){return"Design"},_setTreeRootsAndFirstNodes:function(){for(var e=this,t=this.tree.getDocument(),n=this._getDressupRoot().QueryInterface("VCXIModelNavigable"),o=n&&n.getChildren(),i=0;i<o.length;++i){var r=o[i],s=r.QueryInterface("VCXITreeNode");if(this.isComponentMatchingThisTree(r.GetObject())){var a=r.getChildren().filter(function(t){return e.isComponentMatchingThisTree(r.GetObject())});let n=0!==a.length;n&&1===a.length&&!s.isUniqueChildExpandable()&&(n=!1);var l=this._createTreeNodeModel(s,s.GetName(),n);t.addRoot(l),s.getTreeNodeDisplay()||l.hide()}}},_setCustomEvtsSubscriptions:function(){var t=this;this._eventTokens._evtDressupsAddedToken=e.subscribe({event:"VCX_DRESSUPS_ADDED"},function(e){t._addTreeNodesFromComponentsList(e)}),this._eventTokens._evtDressupsRemovedToken=e.subscribe({event:"VCX_DRESSUPS_PREREMOVED"},function(e){t._removeTreeNodesFromComponentsList(e)})},_getDressupRoot:function(){return this._experienceBase.getManager("VCXDressupManager")},isComponentMatchingThisTree:function(e){return this._experienceBase.getManager("VCXDressupManager").shouldComponentBeDisplayedInTree(e)},_getCommandsColInfos:function(e,t){let n=this._parent(e,t);return 2===t&&(n.isHidden=!0),n}})}),define("DS/VCXWebTreeGUI/VCXWebHotspotsTreeCtrl",["DS/CoreEvents/Events","DS/VCXWebTreeGUI/VCXWebTreeCtrl"],function(e,t){"use strict";return t.extend({init:function(e){this._parent(e),this._type="VCXWebHotspotsTreeCtrl",this._uniqueTreeNodePerComponent=!1},getTreeTitle:function(){return"Hotspots"},_setTreeRootsAndFirstNodes:function(){var e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentGroupHotspot");this._addTreeNodesFromComponentsList(e,!0);for(var t=[],n=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentHotspot"),o=0;o<n.length;o++)n[o].GroupID||t.push(n[o]);t.length&&this._addTreeNodesFromComponentsList(t,!0)},_setCustomEvtsSubscriptions:function(){var t=this;this._eventTokens._evtHotspotsAddedToken=e.subscribe({event:"VCX_HOTSPOTS_ADDED"},function(e){t._addTreeNodesFromComponentsList(e)}),this._eventTokens._evtHotspotsRemovedToken=e.subscribe({event:"VCX_HOTSPOTS_REMOVED"},function(e){t._removeTreeNodesFromComponentsList(e)})},_addTreeNodeFromComponent:function(e,t){var n=this.tree.getDocument(),o=e&&e.QueryInterface("VCXITreeNode");if(o){var i=this._createTreeNodeModel(o,o.GetName(),o.GetChildren().length>0,this._onSelectHotspotTreeNodeCB,this._onUnSelectHotspotTreeNodeCB);i.updateOptions({hotspotRole:1}),t?t.addChild(i):n.addChild(i);var r=o.GetChildren();if("VCXComponentGroupHotspot"!==o.GetObject().GetType()){var s=[];for(l=0;l<r.length;++l){if(c=r[l]){var a=this._createTreeNodeModel(c,c.GetName(),!1);a.updateOptions({hotspotRole:2}),s.push(a)}else console.log("VCXITreeNode extension missing...")}i.addChild(s)}else for(var l=0;l<r.length;++l){var c;if(c=r[l]){var d=c.GetObject();this._addTreeNodeFromComponent(d,i)}else console.log("VCXITreeNode extension missing...")}}else console.warn("The root component must have a treeNode interface. Abort addition of treeNode in tree.")},_onSelectHotspotTreeNodeCB:function(){return this._toggleHotspotActivationOnSelection(!0)},_onUnSelectHotspotTreeNodeCB:function(){return this._toggleHotspotActivationOnSelection(!1)},_toggleHotspotActivationOnSelection:function(e){var t=this;return function(n){var o=t._getTreeNodeExtensionFromTreeNodeModel(n.target);if(o){var i=o.GetObject(),r=(o.QueryInterface("VCXIModifiable"),t._experienceBase.getManager("VCXAPIManager"));(e?r.SelectHotspot:r.DeselectHotspot).call(r,i.GetID())}}},onCellRequest:function(e,t){this._parent(e,t);var n=e.cellView.getContent();if(e.nodeModel.options.hasOwnProperty("hotspotRole")){1===e.nodeModel.options.hotspotRole&&(this.addClassName(n,"vcxHotspot"),this.removeClassName(n,"vcxHotspotActor")),2===e.nodeModel.options.hotspotRole&&(this.addClassName(n,"vcxHotspotActor"),this.removeClassName(n,"vcxHotspot"))}},isComponentMatchingThisTree:function(e){return e.IsKindOf("VCXComponentGroupHotspot")||e.IsKindOf("VCXComponentHotspot")||e.IsKindOf("VCXWebComponentOccurrence")},_getFirstVisibleTreeNodesFromComponent:function(e){var t=this._type,n={visible:{},hiding:{}},o=e.QueryInterface("VCXITreeNode"),i=o&&o.GetTreeNodesModelsFromTree(t);if(Array.isArray(i)){if(!(i.length>this.tree.getRoots().length)){for(var r=0;r<i.length;++r){var s=i[r];s.isVisible()?n.visible[s._getID()]=s:n.hiding[s._getID()]||(n.hiding[s._getID()]=s)}return n}console.log("There shouldn't be more treeNodeModel associated to the component than the number of roots.")}else console.warn("Something's wrong with the recovery of treeNode extension or treeNodesModels...")}})}),define("DS/VCXWebTreeGUI/VCXWebSelectionSetsTreeCtrl",["DS/CoreEvents/Events","DS/VCXWebTreeGUI/VCXWebTreeCtrl","DS/Controls/Button"],function(e,t,n){"use strict";return t.extend({init:function(e){this._parent(e),this._type="VCXWebSelectionSetsTreeCtrl",this._uniqueTreeNodePerComponent=!1},getTreeTitle:function(){return"Selection Sets"},_setTreeRootsAndFirstNodes:function(){var e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXGroupSelectionSet_Spec");this._addTreeNodesFromComponentsList(e,!0);var t=[],n=this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec");n=n.concat(this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentSelectionSet"));for(var o=0;o<n.length;o++)n[o].GroupID||t.push(n[o]);this._addTreeNodesFromComponentsList(t,!0)},_setCustomEvtsSubscriptions:function(){var t=this;this._eventTokens._evtSelSetsAddedToken=e.subscribe({event:"VCX_GROUPSELECTIONSETS_ADDED"},function(e){t._addTreeNodesFromComponentsList(e)}),this._eventTokens._evtSelSetsAddedToken2=e.subscribe({event:"VCX_SELECTIONSETS_ADDED"},function(e){t._updateActorListsTreeNodes(e)}),this._eventTokens._evtSelSetsRemovedToken=e.subscribe({event:"VCX_SELECTIONSETS_REMOVED"},function(e){t._removeTreeNodesFromComponentsList(e)}),this._eventTokens._evtSelectionSetsRemovedToken=e.subscribe({event:"VCX_SELECTIONSETS_UPDATED"},function(e){t._updateActorListsTreeNodes(e)})},_addTreeNodeFromComponent:function(e,t){var n=this.tree.getDocument(),o=e&&e.QueryInterface("VCXITreeNode");if(o){var i=this._createTreeNodeModel(o,o.GetName(),o.GetChildren().length>0,this._onSelectSelSetTreeNodeCB,this._onUnSelectSelSetTreeNodeCB);i.updateOptions({selectionSetRole:1}),t?t.addChild(i):n.addRoot(i);var r=o.GetChildren();if("VCXGroupSelectionSet_Spec"!==o.GetObject().GetType()){var s=[];for(l=0;l<r.length;++l){if(c=r[l]){var a=this._createTreeNodeModel(c,c.GetName(),!1);a.updateOptions({selectionSetRole:2}),s.push(a)}else console.log("VCXITreeNode extension missing...")}i.addChild(s),this._onChangeSelectionCB(r.filter(e=>this._experienceBase.getManager("VCXSelectionManager").isIn(e.GetObject())).map(e=>e.GetObject()),!0)}else for(var l=0;l<r.length;++l){var c;if(c=r[l]){var d=c.GetObject();this._addTreeNodeFromComponent(d,i)}else console.log("VCXITreeNode extension missing...")}}else console.warn("The root component must have a treeNode interface. Abort addition of treeNode in tree.")},onChangeTreePSO:function(e,t){var n=e&&this._getTreeNodeExtensionFromTreeNodeModel(e);if(n&&"VCXSelectionSet_Spec"===n.GetObject().componentType)return e.getChildren()&&e.getChildren().forEach(e=>{this.onChangeTreePSO(e,t)}),this._parent(e,t);this._parent(e,t)},_updateActorListsTreeNodes:function(e){if(e){let t=e.QueryInterface("VCXITreeNode"),n=t.GetTreeNodesModelsFromTree(this._type);if(n&&1===n.length){let e=n[0],o=t.GetChildren(),i=e.getChildren();i||(i=[]),i=[...i];let r=[];for(let e of o){let t=e.GetTreeNodesModelsFromTree(this._type),n=!1;for(let e of t){let t=i.indexOf(e);if(-1!==t){n=!0,i.splice(t,1);break}}n||r.push(e)}r.length&&(e.addChild(r.map(e=>{var t=this._createTreeNodeModel(e,e.GetName(),!1);return t.updateOptions({selectionSetRole:2}),t})),this._onChangeSelectionCB(r.map(e=>e.GetObject()),!0));for(let e of i)this._destroyTreeNodeModel(e)}}},_onSelectSelSetTreeNodeCB:function(){return this._toggleSelSetActivationOnSelection(!0)},_onUnSelectSelSetTreeNodeCB:function(){return this._toggleSelSetActivationOnSelection(!1)},_toggleSelSetActivationOnSelection:function(e){var t=this;return function(n){var o=n.target;if(o.isSelectionChangeFromUI()){var i=t._getTreeNodeExtensionFromTreeNodeModel(o);if(i){var r=i.GetObject(),s=t._experienceBase.getManager("VCXAPIManager");(e?s.ActivateSelectionSet:s.DeactivateSelectionSet).call(s,r.GetID())}}}},getCommonIcon:function(e,t){this._parent(e,t);var n=e.cellView.getContent();if(e.nodeModel.options.hasOwnProperty("selectionSetRole")){1===e.nodeModel.options.selectionSetRole&&(this.addClassName(n,"vcxSelSet"),this.removeClassName(n,"vcxSelSetActor")),2===e.nodeModel.options.selectionSetRole&&(this.addClassName(n,"vcxSelSetActor"),this.removeClassName(n,"vcxSelSet"))}},getCommandsIcon:function(e,t){let n=this._parent(e,t);return 2===e.nodeModel.options.selectionSetRole&&"VCXSelectionSet_Spec"!==t.GetObject().GetType()&&this._experienceBase.getManager("VCXSelectionSetManager").isAuthoring&&(n=[this._getRemoveFromSelectionSet(e)].concat(n)),n},_getRemoveFromSelectionSet:function(e){var t=new UWA.Element("div",{class:"vcxcommandtreecontainer"}),o=new n({displayStyle:"lite",icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS},minWidth:32,minHeight:32,iconSize:"18px"});return o.getContent().addClassName("vcxvisibilityremoveselectionset"),o.addEventListener("buttonclick",()=>this._onClickRemoveIcon(e)),o.inject(t),t},_onClickRemoveIcon:function(e){let t=e.nodeModel.getParent();var n=e.nodeModel&&this._getTreeNodeExtensionFromTreeNodeModel(e.nodeModel);if(n&&t&&t.options&&t.options.data&&t.options.data.vcxTreeNode){let e=t.options.data.vcxTreeNode;n.GetObject()._experienceBase.getManager("VCXSelectionSetManager").removeActorsFromSelectionSet([n.GetObject().GetID()],e.GetObject())}},_getFirstVisibleTreeNodesFromComponent:function(e){var t=this._type,n={visible:{},hiding:{}},o=e.QueryInterface("VCXITreeNode"),i=o&&o.GetTreeNodesModelsFromTree(t);if(!Array.isArray(i))return void console.warn("Something's wrong with the recovery of treeNode extension or treeNodesModels...");let r=this._experienceBase.getManager("VCXContextManager").getProdHighMode();if(!(r&&this.tree.getRoots().length>0&&this.tree.getRoots()[0].getChildren()&&i.length>this.tree.getRoots()[0].getChildren().length||!r&&i.length>this.tree.getRoots().length)){for(var s=0;s<i.length;++s){var a=i[s];a.isVisible()?n.visible[a._getID()]=a:n.hiding[a._getID()]||(n.hiding[a._getID()]=a)}return n}console.log("There shouldn't be more treeNodeModel associated to the component than the number of roots.")},isComponentMatchingThisTree:function(e){return e.IsKindOf("VCXGroupSelectionSet_Spec")||e.IsKindOf("VCXSelectionSet_Spec")||e.IsKindOf("VCXWebComponentOccurrence")}})}),define("DS/VCXWebTreeGUI/VCXWebStylesTreeCtrl",["DS/CoreEvents/Events","DS/VCXWebTreeGUI/VCXWebTreeCtrl"],function(e,t){"use strict";return t.extend({init:function(e){this._parent(e),this._type="VCXWebStylesTreeCtrl",this._uniqueTreeNodePerComponent=!0},_setTreeRootsAndFirstNodes:function(){var e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentStyle");this._addTreeNodesFromComponentsList(e,!0)},_setCustomEvtsSubscriptions:function(){var t=this;this._eventTokens._evtStylesAddedToken=e.subscribe({event:"VCX_STYLE_ADDED"},function(e){t._addTreeNodesFromComponentsList(e)})},_addTreeNodeFromComponent:function(e){var t=this.tree.getDocument(),n=e&&e.QueryInterface("VCXITreeNode");if(n){var o=this._createTreeNodeModel(n,n.GetName(),n.GetChildren().length>0);t.addChild(o)}else console.warn("The root component must have a treeNode interface. Abort addition of treeNode in tree.")},isComponentMatchingThisTree:function(e){return e.IsKindOf("VCXComponentStyle")}})});