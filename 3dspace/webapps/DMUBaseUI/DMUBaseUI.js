define("DS/DMUBaseUI/DMUToolsUsers",["require","exports","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/Visualization/ThreeJS_DS","DS/PADUtils/PADSettingsMgt","UWA/Core"],function(e,t,n,o,r,i,a){"use strict";let s=[],c=[],l=[16007990,15277667,10233776,6765239,4149685,2201331,240116,48340,38536,5025616,9159498,13491257,16771899,16761095,16750592,16733986,7951688,6323595];return class{static getUserLogin(){return o.getUserLogin()}static getUserName(e,t){return new Promise(r=>{if(!e)return void r("");if(e===o.getUserLogin()){const e=o.getUserName();return t&&t(e),r(e)}let a=s.find(function(t){return t.login===e});if(a&&a.name)return t&&t(a.name),r(a.name);let c=function(t){(a=s.find(t=>t.login===e))?a.name=t:s.push({login:e,name:t})};n.authenticatedRequest(o.get3DSpaceUrl()+"/resources/modeler/pno/person/"+e+"?tenant="+o.getPlatformId(),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:i.getSetting("pad_security_ctx")},timeout:6e4,onComplete:function(n){let o=JSON.parse(n),i=e;o&&o.firstname&&(i=o.firstname,i+=o.lastname?" "+o.lastname:""),c(i),t&&t(i),r(i)},onFailure:function(){c(e),r(e)},onTimeout:function(){c(e),r(e)}})})}static getUserColor(e){if(!e)return;if(e===o.getUserLogin())return new r.Color(7913210);let t,n=s.find(function(t){return t.login===e});if(n&&n.color)return n.color;let i,a=function(e){let t=Math.min(e,255).toString(16);return 1===t.length&&(t="0"+t),t},c=[];for(i=0;i<e.length;i++)c[i%3]?c[i%3]=Math.floor(((e.charCodeAt(i)-48)/74*255+c[i%3])/2):c[i%3]=Math.floor((e.charCodeAt(i)-48)/74*255);let d=parseInt(a(c[0])+a(c[1])+a(c[2]),16);if(l&&l.length){let o=l[0];return l.forEach(function(e){o=Math.abs(e-d)<Math.abs(o-d)?e:o}),t=new r.Color(o),n?n.color=t:s.push({login:e,color:t}),l.splice(l.indexOf(o),1),n?n.color=t:s.push({login:e,color:t}),t}let u=(t=new r.Color).getHSL();return u.s=Math.max(u.s,.5),u.l=u.l<.5?.5:u.l>.7?.7:u.l,t.setHSL(u.h,u.s,u.l),n?n.color=t:s.push({login:e,color:t}),t}static getImage(e,t){if(e&&t){for(let n=0;n<c.length;n++)if(c[n].url===e)return void t(c[n].stream);n.authenticatedRequest(e,{proxy:"none",type:"blob",timeout:18e4,onComplete:function(n){let o=new FileReader;o.onload=function(){c.push({url:e,stream:o.result}),t(o.result)},o.readAsDataURL(n)},onFailure:function(){t(e,!0)},onTimeout:function(){t(e,!0)}})}}static getUserImageURL(e){if(!e)return;let t=s.find(function(t){return t.login===e});if(t&&t.imageUrl)return t.imageUrl;let n=o.getPlatformURL("3DSwym")+"/api/user/getpicture/login/"+e+"/format/mini";return t?t.imageUrl=n:s.push({login:e,imageUrl:n}),n}static formatDate(e){return e?a.String.parseRelativeTime(e.toString()):""}}}),define("DS/DMUBaseUI/DMUContextualBarAdapter",["UWA/Class","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({getSharedContextualCommandList:function(){return[]},getContextualCommandList:function(){return null},getSharedContextualMenuCommandList:function(){return[]},getContextualMenuCommandList:function(){return[]},getSharedHeaderTypes:function(){return{}},register:function(e){if(e){var n=t.getManager({name:"DMUUserExperienceManager",context:e.frmWindow});n&&(e.contextualBar&&n.registerContextualBar(e.contextualBar),e.contextualMenu&&n.registerContextualMenu(e.contextualMenu))}},unregister:function(e){if(e){var n=t.getManager({name:"DMUUserExperienceManager",context:e.frmWindow});n&&(e.contextualBar&&n.unregisterContextualBar(e.contextualBar),e.contextualMenu&&n.unregisterContextualMenu(e.contextualMenu))}}})}),define("DS/DMUBaseUI/DMUToolsLeader",["DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseExperience/EXPToolsVisualization","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/ArrowNode","DS/DMUBaseExperience/EXPToolsMaterial"],function(e,t,n,o,r,i){"use strict";let a={attachment:{CENTER:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4},_computeNewPoints:function(e,t,r,i,s,c){var l={};l.vBreak=t.clone(),l.vAttach=t.clone();var d,u,h=i&&void 0!==i.width?s.offsetWidth*i.width:15,p=i&&void 0!==i.height?s.offsetHeight*i.height:0;s.offsetHeight?u=s.offsetHeight/2:s.style&&s.style.pixelHeight&&(u=s.style.pixelHeight/2),s.offsetWidth?d=s.offsetWidth/2:s.style&&s.style.pixelWidth&&(d=s.style.pixelWidth/2);var m=n.getWindowPositionFromPoint(e,t,c);m=new o.Vector2(m.left,m.top);var g=n.getWindowPositionFromPoint(e,r,c);g=new o.Vector2(g.left,g.top);var f,D,v,S,M=(new o.Vector2).subVectors(g,m),w=d+h,C=u+p,P=s.rotationAngle?s.rotationAngle:0;if(M=new o.Vector2(M.x*Math.cos(P)-M.y*Math.sin(P),M.x*Math.sin(P)+M.y*Math.cos(P)),Math.abs(M.y)<u&&Math.abs(M.x)<d)return l.vBreak=null,l.vAttach=null,l;if(M.x>0){var y=(new o.Vector2).addVectors(m,new o.Vector2(w*Math.cos(P),-w*Math.sin(P)));M.y>0?(v=(new o.Vector2).addVectors(m,new o.Vector2(-C*Math.sin(P+Math.PI),-C*Math.cos(P+Math.PI))),g.distanceToSquared(y)<g.distanceToSquared(v)?(D=y,f=a.attachment.RIGHT):(D=v,f=a.attachment.BOTTOM)):(S=(new o.Vector2).addVectors(m,new o.Vector2(-C*Math.sin(P),-C*Math.cos(P))),g.distanceToSquared(y)<g.distanceToSquared(S)?(D=y,f=a.attachment.RIGHT):(D=S,f=a.attachment.TOP))}else{var U=(new o.Vector2).addVectors(m,new o.Vector2(w*Math.cos(P+Math.PI),-w*Math.sin(P+Math.PI)));M.y>0?(v=(new o.Vector2).addVectors(m,new o.Vector2(-C*Math.sin(P+Math.PI),-C*Math.cos(P+Math.PI))),g.distanceToSquared(U)<g.distanceToSquared(v)?(D=U,f=a.attachment.LEFT):(D=v,f=a.attachment.BOTTOM)):(S=(new o.Vector2).addVectors(m,new o.Vector2(-C*Math.sin(P),-C*Math.cos(P))),g.distanceToSquared(U)<g.distanceToSquared(S)?(D=U,f=a.attachment.LEFT):(D=S,f=a.attachment.TOP))}if(l.vBreak=a._computeProjection(e,t,D.x,D.y),f===a.attachment.RIGHT||f===a.attachment.LEFT){f===a.attachment.LEFT&&(P+=Math.PI);var T=new o.Vector2(d*Math.cos(P),d*Math.sin(P));l.vAttach=a._computeProjection(e,t,m.x+T.x,m.y-T.y)}else if(f===a.attachment.TOP||f===a.attachment.BOTTOM)if(p){f===a.attachment.TOP&&(P+=Math.PI);var x=new o.Vector2(-u*Math.sin(P),u*Math.cos(P));l.vAttach=a._computeProjection(e,t,m.x-x.x,m.y+x.y)}else l.vAttach=l.vBreak.clone();return l},_computeProjection:function(e,r,i,a){var s=n.getViewpointInfo(e.currentViewpoint).sight.negate(),c=n.getLineFromWindowPosition(e,i,a),l=t.computeLinePlaneDistance(c.position.toArray(),c.direction.toArray(),r.toArray(),s.toArray());return new o.Vector3(l.aPosition[0],l.aPosition[1],l.aPosition[2])}};return Object.freeze({modifyLeaderNode:function(t,n,o,s,c,l,d,u,h,p,m,g){var f=!1,D={};if(D.vBreak=s.clone(),D.vAttach=s.clone(),o&&(D=a._computeNewPoints(t,s,c,l,m,g)),null===D.vBreak&&null===D.vAttach)return f;var v=i.getDashType(h),S={arrowWidth:d,headLength:Math.max(2*d+4,10),viewpoint:t.currentViewpoint,arrowDashType:v,arrowScale:2,color:u},M=!e.areEqual(D.vBreak,c,"Vector3"),w=n.getChildByName("attach"),C=Math.max(2*d+4,10);w?M?(D.vBreak.distanceTo(w._initialPoint)&&w.updateInitialPosition(D.vBreak),c.distanceTo(w._finalPoint)&&w.updateFinalPosition(c),u!==w.materialArrow.color&&w.updateColor(u),d!==w.materialArrow.lineWidth&&w.setArrowWidth(d),C!==w._headLength&&w.setHeadSize(C),p!==w._head&&w.setHeadType(p),v!==w.savedPattern&&(w.savedPattern=v,w.setArrowPattern(v)),2!==w.materialArrow.scale&&w.setArrowPatternScale(2),f=!0):(n.removeChild(w),f=!0):M&&(S.initialPoint=D.vBreak.clone(),S.finalPoint=c.clone(),S.head=p,(w=new r(S)).setPickParent(!0),w.name="attach",n.addChild(w),f=!0);var P=M&&!e.areEqual(D.vBreak,D.vAttach,"Vector3"),y=n.getChildByName("step");return y?P?(D.vBreak.distanceTo(y._initialPoint)&&y.updateInitialPosition(D.vBreak),D.vAttach.distanceTo(y._finalPoint)&&y.updateFinalPosition(D.vAttach),u!==y.materialArrow.color&&y.updateColor(u),d!==y.materialArrow.lineWidth&&y.setArrowWidth(d),C!==y._headLength&&y.setHeadSize(C),0!==y._head&&y.setHeadType(0),v!==y.savedPattern&&(y.savedPattern=v,y.setArrowPattern(v)),2!==y.materialArrow.scale&&y.setArrowPatternScale(2),f=!0):(n.removeChild(y),f=!0):P&&(S.initialPoint=D.vBreak.clone(),S.finalPoint=D.vAttach.clone(),S.head=0,(y=new r(S)).setPickParent(!0),y.name="step",n.addChild(y),f=!0),f}})}),define("DS/DMUBaseUI/DMUToolsContextualBar",["require","exports","DS/PADUtils/PADUtilsServices"],function(e,t,n){"use strict";return class{static isCloud(){return n.isCloud()}}}),define("DS/DMUBaseUI/DMUReviewDnDComponent",["UWA/Core","DS/PADUtils/PADSettingsMgt","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/WebappsUtils/WebappsUtils","DS/Utilities/TouchUtils","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ButtonGroup","i18n!DS/DMUBaseUI/assets/nls/DMUBaseUI"],function(e,t,n,o,r,i,a,s,c){"use strict";let l;function d(e,t){var n=[{id:e.member[0].specificationReport.member[0]["@id"],type:"Specification Report"}];t.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:n.map(function(t){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:t.reviewId?t.reviewId:t.id,objectType:"PointCloud"!==t.type?t.type:"R2V_FeatureState",displayName:t.displayName,serviceId:"PointCloud"!==t.type?void 0:"r2vsurvey",subContext:{id:e.member[0]["@id"],type:e.member[0].typeactualName,label:e.member[0].V_Name}}})}}})}function u(e,t,n){var o={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:[{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.member[0]["@id"],objectType:e.member[0].typeactualName,displayType:e.member[0].typedisplayName,displayName:e.member[0].V_Name,serviceId:"3DSpace"}]}};n.addRootNodesFromContent({json3DXContent:o,dispatch:!0,inContext:t})}function h(t,h,p){var m=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/resources/v1/modeler/dsspec/dsspec:PhysicalProduct/"+h+"?$mask=dsspec:SpecAndRelatedInfoObjectMask";require("DS/PADUtils/utilsWS/WSUtils").executeRequest(m,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(h){let m=JSON.parse(h);m&&m.member&&m.member.length>0&&m.member[0]&&m.member[0].specificationReport&&m.member[0].specificationReport.member&&m.member[0].specificationReport.member.length>0&&m.member[0].specificationReport.member[0]?n.readPreferences([{Repository:"DMURepository",PreferenceNames:["ProductLoadingMode"]}]).then(function(n){let h=n.repositories[0].preferences;"AskOpeningMode"===(l=h.length&&h[0].name&&"ProductLoadingMode"===h[0].name?h[0].value:"AskOpeningMode")?function(t){var n,l,d,u=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),h=window.document.getElementsByClassName("DMULoadingPanel");u.length&&(u[0].dsModel.off(),u[0].dsModel.destroy(),u=null);h.length&&h[0].destroy();var p=e.createElement("div",{class:"DMUDisplayChooserDiv"});p.setStyles({height:"100%",display:"flex"});var m=o.getWebappsAssetUrl("DMUReviewCommonWebApp","icons/");(d=new a({label:c.ProductDefinition,type:"radio",checkFlag:"product"===localStorage.getItem("defaultSelectedTypeData"),icon:{iconPath:m+"I_DMU_CATASDAPAppIcon.png",iconSize:{height:"100px",width:"100px"}},onClick:function(){localStorage.setItem("defaultSelectedTypeData","product")}})).getContent().setStyles({margin:"auto","margin-right":"5px",display:"grid"}),d.getContent().addClassName("prdLoadingButton"),(l=new a({label:c.RSDefinition,type:"radio",checkFlag:"releaseSnapshot"===localStorage.getItem("defaultSelectedTypeData"),icon:{iconPath:m+"I_DMU_SpecificationManagement.png",iconSize:{height:"100px",width:"100px"}},onClick:function(){localStorage.setItem("defaultSelectedTypeData","releaseSnapshot")}})).getContent().setStyles({margin:"auto","margin-left":"5px",display:"grid"}),l.getContent().addClassName("rsLoadingButton");var g=new s({}).inject(p);g.getContent().addClassName("contexTypeBtnGroup"),g.getContent().setStyles({display:"flex",height:"100%",width:"100%"}),g.addChild(d),g.addChild(l);var f=new a({emphasize:"primary",label:c.openButtonLabel,onClick:function(){var e=this.getParents().find(e=>e.hasClassName("modalContextTypeChooser"));if(e){var o=e.getElementsByClassName("contexTypeBtnGroup");if(o.length&&o[0].dsModel){var r=o[0].dsModel.getButton(0).checkFlag;t.onOkClickCB(!0===r?"product":"SRDocument",n)}}}}),D=new a({label:c.cancelButtonLabel,onClick:function(){n.close&&n.close(),n.destroy&&n.destroy(),t.viewer._dropZoneContainer.show("drop")}});(n=new i({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:c.panelLoading,resizableFlag:!1,immersiveFrame:t.viewer.getFrameWindow().getImmersiveFrame(),position:r.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:f,Cancel:D},content:p})).getContent().addClassName("modalContextTypeChooser"),n.width=l.getContent().getSize().width+d.getContent().getSize().width+30,n.addEventListener("close",function(){n.destroy&&n.destroy(),t.viewer._dropZoneContainer.show("drop")})}({viewer:t,onOkClickCB:function(e,n){n.close&&n.close(),n.destroy&&n.destroy(),"SRDocument"===e?d(m,t):u(m,p,t)}}):"OpenReleaseSnapshot"===l?d(m,t):u(m,p,t)}).catch(function(e){window.console.warn("Could not get server value, default value set instead.",e)}):u(m,p,t)},onFailure:function(){}})}return{callSpecReportData:function(e,t,n){t&&t.data&&t.data.items&&t.data.items.length&&"VPMReference"===t.data.items[0].objectType?h(e,t.data.items[0].objectId,n):e.addRootNodesFromContent({json3DXContent:t,dispatch:!1})},initViewerDnd:function(e,n){t.getSetting("activate_newDropInvite")||require(["DS/PADUtils/views/PADDnDInvite"],function(o){function r(t){t.preventDefault(),e.addWidgetBorder(),t.shiftKey?e._dropZoneContainer.show("add_as_object"):e._dropZoneContainer.show("add_in_context")}function i(){e.clearWidgetBorder(),0!==e.getRoots().length||e._checkHiddenRoots()?e._dropZoneContainer.hide():e._dropZoneContainer.show("drop")}async function a(t){if(t.preventDefault(),t.stopPropagation(),e.elements.container.contains(t.target)){e._dropZoneContainer.hide();var o=!0;t.shiftKey&&(o=!1);var r,i=require("DS/PADUtils/PADUtilsServices").deserializeDroppedData({dataTransfer:t.dataTransfer});i&&i.data.items&&i.data.items.length&&(r=i.data.items[0].objectType),(await n(r)).includes("VPMReference")?h(e,i.data.items[0].objectId,o):e.addRootNodesFromContent({json3DXContent:i,dispatch:!0,inContext:o}),e.clearWidgetBorder()}}function s(t){t.preventDefault(),e.clearWidgetBorder(),t.shiftKey?e._dropZoneContainer.show("add_as_object"):e._dropZoneContainer.show("add_in_context")}function c(t){null!==t.relatedTarget&&t.relatedTarget.classList.contains("paddnd_invite_container")||(e._dropZoneContainer.hide(),0===e.getRoots().length&&e._dropZoneContainer.show(),e.clearWidgetBorder())}e._dropZoneContainer=new o({renderTo:e.elements.container,mode:"inviteWithFilter",filterActive:t.getSetting("enopad3dviewer_FilterAvailable"),dropOnInvite:function(e){a(e)}}),e._dndCB[0]=r,e._dndCB[1]=i,e._dndCB[2]=a,e._dndCB[3]=s,e._dndCB[4]=c,e.elements.container.addEventListener("dragenter",s),e.elements.container.addEventListener("dragover",r),e.elements.container.addEventListener("dragleave",c),e.elements.container.addEventListener("dragend",i),e.elements.container.addEventListener("drop",a)})}}}),define("DS/DMUBaseUI/DMUNode3D",["DS/Visualization/Node3D","DS/Mesh/MeshUtils"],function(e,t){"use strict";return e.extend({init:function(e){this._parent();var n=e||{},o=this;this.getDMUType=function(){return"function"==typeof n.getType?n.getType():""},this.getViewer=function(){return n.frmWindow?n.frmWindow.getViewer():null},this.setReadOnly=function(e){o.setPickable(e?t.PICKTHROUGH:t.PICKABLE)},this.mergeParams=function(e,t){for(var n=function(e){return null!=e&&e.clone?e.clone():e},o=Object.keys(t),r=0;r<o.length;r++)if("graphicProperties"!==o[r])e[o[r]]=n(t[o[r]]);else for(var i=Object.keys(t[o[r]]),a=0;a<i.length;a++)if("fontStyle"===i[a]||"fillStyle"===i[a]||"fillStyle"===i[a])for(var s=Object.keys(t[o[r]][i[a]]),c=0;c<s.length;c++)e[o[r]][i[a]][s[c]]=n(t[o[r]][i[a]][s[c]]);else e[o[r]][i[a]]=n(t[o[r]][i[a]]);return e}},remove:function(){this.removeDMUNode3DOverload&&this.removeDMUNode3DOverload(),this._parent()}})}),define("DS/DMUBaseUI/DMUManipulableNode3D",["DS/DMUBaseUI/DMUNode3D"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.setNoZ(!0);var t,n,o=this;this.setRepManipulator=function(e){e&&(t&&t.destroy(),(t=e)&&n&&t.linkToNode(n))},this.getRepManipulator=function(){return t},this.linkManipulatorToNode=function(e){n=e},this.removeDMUNode3DOverload=function(){t&&(t.destroy(),t=null),n=null,o.removeChildren&&o.removeChildren()}},remove:function(){this.removeDMUNode3DOverload&&this.removeDMUNode3DOverload(),this._parent()}})}),define("DS/DMUBaseUI/DMUNode2D",["DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUBaseExperience/EXPToolsVisualization","DS/Visualization/ThreeJS_DS"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e);var o=this;this.setExcludeFromBounding(!0);var r=1;this.setMaximalProportionalZoneWidth=function(e){r=e},this.getProportionalFactor=function(e){var t=o.getViewer().SCREEN_WIDTH/2,n=o.getViewer().SCREEN_HEIGHT/2,i=t/n;if(e&&i<r){var a=Math.pow((r-i)/r,3);return Math.round(i/r*n*a+n*(1-a))}return n},this.convertPixelsInProportionalCoord=function(e,t){return e/o.getProportionalFactor(t)/window.devicePixelRatio},this.convertProportionalCoordInPixels=function(e,t){return e*o.getProportionalFactor(t)*window.devicePixelRatio},this.convertCoordsInPixels=function(e){var t=o.getViewer().SCREEN_WIDTH/2,r=o.getProportionalFactor(e.fitOnX);return"center"===e.windowAnchor?new n.Vector2(t+e.coords.x*r,(1-e.coords.y)*r+(o.getViewer().SCREEN_HEIGHT/2-r)):new n.Vector2(e.coords.x*r,e.coords.y*r)},this.get3DPositionFromScreenCoordinates=function(e){if(e.coords){var i=(new n.Vector2).copy(e.coords),a=o.getProportionalFactor();let u=o.getViewer().SCREEN_HEIGHT/2;if(e.proportionalPosition&&"center"===e.windowAnchor){var s=o.getViewer().SCREEN_WIDTH/2,c=s/u,l=r*u>s?i.x/r*c:i.x;if(i.x=s+l*a,i.y=(1-i.y)*a+(u-a),e.width&&"center"===e.anchor){var d=e.width/2;i.x-d<0&&(i.x=d),i.x+d>2*s&&(i.x=2*s-d)}}let h=o.getViewer().getSceneBoundingSphere();return t.getPositionFromIntersection(o.getViewer(),i,h?h.center:new n.Vector3)}return new n.Vector3(1,0,0)}}})});