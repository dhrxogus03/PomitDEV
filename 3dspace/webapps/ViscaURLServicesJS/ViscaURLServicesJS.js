define("DS/ViscaURLServicesJS/VisuRepServices",["DS/WAFData/WAFData"],function(e){"use strict";var t=function(){};t.RepType=Object.freeze({AV1:"av1",RR:"rr",PR:"pr"});return t.prototype.GetStaticUrls=function(r,i,n){if("object"==typeof r&&"object"==typeof i&&Array.isArray(n)){var o="function"==typeof r.onCompleteCB,a=[],s=function(){var s={async:o,timeout:r.timeout,authentication:"passport",proxy:"passport",method:"POST",data:JSON.stringify({label:"VisuRepServices-"+r.user+"-"+Date.now(),physicalid:n,select_predicate:["physicalid","cgrwms","3dthbwms"],select_file:[i.type==t.RepType.AV1?"cgr":"thumbnail_3d"],fcs_url_mode:"REDIRECT"}),headers:{"Content-type":"application/json",SecurityToken:r.user+"|"+r.securityCtx+"|preferred",SecurityContext:r.securityCtx},onComplete:function(e,t){if("string"==typeof e&&0!==e.length){var i=JSON.parse(e);if("object"==typeof i&&Array.isArray(i.results)){var n=[];i.results.forEach(function(e){if(Array.isArray(e.attributes)){var t={};e.attributes.forEach(function(e){"physicalid"==e.name?t.boid=e.value:"cgr"==e.name||"thumbnail_3d"==e.name?t.url=e.value:"string"==typeof t.version||"cgrwms"!=e.name&&"3dthbwms"!=e.name||(t.version=e.value)}),"string"==typeof t.boid&&"string"==typeof t.url&&n.push(t)}}),o?r.onCompleteCB(n):a=n}else r.onFailureCB()}else r.onFailureCB()},onFailure:function(){r.onFailureCB&&r.onFailureCB()},onPassportError:function(){r.onFailureCB&&r.onFailureCB()},onTimeout:function(){r.onFailureCB&&r.onFailureCB()}};e.authenticatedRequest(r.spaceUrl+"/cvservlet/fetch/v2?tenant="+r.tenant,s)};if(i.type!=t.RepType.AV1&&"string"==typeof r.viscaUrl){var l=[];n.forEach(function(e){l.push({source:i.source,boid:e,type:i.type})});var u={async:o,timeout:r.timeout,authentication:"passport",proxy:"passport",method:"POST",data:JSON.stringify({files:l}),headers:{"Content-type":"application/json",SecurityContext:r.securityCtx},onComplete:function(e,t){if("string"==typeof e&&0!==e.length){var i=JSON.parse(e);if("object"==typeof i&&Array.isArray(i.urls)){var n=[];i.urls.forEach(function(e){n.push({boid:e.boid,url:e.url,version:e.version})}),n.length>0?o?r.onCompleteCB(n):a=n:s()}else s()}else s()},onFailure:function(){s()},onPassportError:function(){s()},onTimeout:function(){s()}};e.authenticatedRequest(r.viscaUrl+"/api/v1/urls",u)}else s();return o?void 0:a}r.onFailureCB&&r.onFailureCB()},t}),define("DS/ViscaURLServicesJS/ViscaURLServices",function(){"use strict";var e=function(){};function t(e){for(var t=e.split("&"),r={},i=0;i<t.length;i++){var n=t[i].split("=");"s"===n[0]?r.source=n[1]:"t"===n[0]?r.tenant=n[1]:"id"===n[0]?r.boid=n[1]:"f"===n[0]?r.filename=n[1]:"fmt"===n[0]?r.format=n[1]:"e"===n[0]?r.element=Number(n[1]):"v"===n[0]?r.version=n[1]:"ts"===n[0]?r.timestamp=n[1]:"type"===n[0]?r.type=n[1]:"sgn"===n[0]&&(r.signature=n[1])}return r}function r(e){if("Range"==e.name&&0==e.value.indexOf("bytes=")){var t=e.value.indexOf("-");if(t>0){const n="bytes=".length;var r=e.value.substring(n,t),i=e.value.substring(t+1);return Number(i)-Number(r)}}return-1}function i(e){var t=e;if("number"!=typeof t.element)return t;if(t.elements=[t.element],delete t.element,"number"!=typeof t.index)return t;if(t.indices=[t.index],delete t.index,Array.isArray(t.headers)&&1==t.headers.length){var i=r(t.headers[0]);i>=0&&(t.contentSize=i)}return t}return e.prototype.CreateURLsRequestBody=function(e,t){if(void 0!==e&&0!==e.length){for(var r={},i={files:[]},n=0;n<e.length;n++){if(void 0===e[n])return;i.files.push(e[n])}return"object"==typeof t&&"boolean"==typeof t.fallback&&t.fallback&&(i.fallback=!0),r.body=JSON.stringify(i),r}},e.prototype.IsURLFetchCompatible=function(e){return!e.toLowerCase().includes("&type=av")},e.prototype.CreateBatchURLAndBody=function(e,r){if(void 0!==e&&0!==e.length){for(var i={},n={files:[]},o=0;o<e.length;o++){if(void 0===e[o])return;var a=e[o].toLowerCase().search("api/v1/rep?");if(-1===a)return;0===o&&(i.url=e[o].substring(0,a)+"api/v1/reps");var s=t(e[o].substring(a+"api/v1/rep?".length,e[o].length));n.files.push(s)}return"object"==typeof r&&"boolean"==typeof r.allowPartial&&r.allowPartial&&(n.allowPartial=!0),"object"==typeof r&&"boolean"==typeof r.fallback&&r.fallback&&(n.fallback=!0),"object"==typeof r&&"string"==typeof r.emptyFallback&&r.emptyFallback.length>0&&(n.emptyFallback=emptyFallback),"object"==typeof r&&"boolean"==typeof r.checkVersion&&r.checkVersion&&(n.checkVersion=!0),i.body=JSON.stringify(n),i}},e.prototype.MergeBatchAnswer=function(e,t){if("object"==typeof e&&Array.isArray(e.files)){for(var n="number"==typeof t?t:0,o=[],a=0;a<e.files.length;a++){var s=e.files[a];if("object"==typeof s&&"string"==typeof s.url&&(Array.isArray(o[s.url])||(o[s.url]=[]),s.index=a,o[s.url].push(s),o[s.url][0].source!=s.source||o[s.url][0].boid!=s.boid))return}var l={files:[]};for(var u in o)f(o[u]);return l}function f(e){if(!Array.isArray(e)||0==e.length)return;const t="bytes=".length;for(var o=i(e[0]),a=1;a<e.length;a++)if("number"!=typeof o.contentSize||0!=n&&o.contentSize>=n)l.files.push(o),o=i(e[a]);else if(Array.isArray(e[a].headers)&&1==e[a].headers.length){var s=r(e[a].headers[0]);s<0?l.files.push(e[a]):0!=n&&o.contentSize+s>n?(l.files.push(o),o=i(e[a])):(o.contentSize+=s,o.elements.push(e[a].element),o.indices.push(e[a].index),o.headers[0].value+=","+e[a].headers[0].value.substring(t))}else l.files.push(e[a]);l.files.push(o)}},e.prototype.CreateFetchURLAndBody=function(e,r,i){if(void 0!==e&&0!==e.length&&void 0!==r&&r.length===e.length){for(var n={},o={files:[]},a=0;a<e.length;a++){if(void 0===e[a])return;var s=e[a].toLowerCase().search("api/v1/rep?");if(-1===s)return;0===a&&(n.url=e[a].substring(0,s)+"api/v1/fetch");var l=t(e[a].substring(s+"api/v1/rep?".length,e[a].length));l.correlationID=r[a],o.files.push(l)}return"object"==typeof i&&"number"==typeof i.splitTargetedSize&&i.splitTargetedSize>0&&(o.splitTargetedSize=i.splitTargetedSize),"object"==typeof i&&"boolean"==typeof i.allowPartial&&i.allowPartial&&(o.allowPartial=!0),"object"==typeof i&&"boolean"==typeof i.checkVersion&&i.checkVersion&&(o.checkVersion=!0),n.body=JSON.stringify(o),n}},e});