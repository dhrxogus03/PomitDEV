define("DS/3DPlayDMUExperience/3DPlayDMUExperience",["DS/3DPlayExperienceModule/PlayExperience3D","DS/Visualization/ThreeJS_DS","DS/DMUReadPersistence/DMUReviewPersistenceServices","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/EXPImportServices","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/CATWebUXComponents/CATWebUXUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUReadPersistence/DMULoadingContextController","DS/3DPlay/3DPlay","i18n!DS/3DPlayDMUExperience/assets/nls/3DPlayDMUExperience"],function(e,t,n,r,o,i,a,s,l,c,d,p,u,D,m,C,g,f,w,x,y,M,V,S){"use strict";var P;return e.extend({init:function(e){var v,h,b,U,R,A,I,T,k,W,E,F,O=new n,L=!1,j=this,_=!0,B=!1,X=!1,N={},G="";let q,H,J=null,z=!1,K="Perspective",Q=!1,Y=!1,Z="selectParentReference",$=!1;function ee(e){var t={lastCommand:[],currentCommand:null,defaultCommand:null},n=j.pad3DViewer.getCommandContext();n?p._commandsState[n]=t:p._commandsState=t,p.resetDefaultCommand(n),p._isCommandEnding=!1,p._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(e){var t=n&&p[e]?p[e][n]:p[e];t&&Object.keys(t).forEach(function(e){var n=t[e];n&&n._destroy&&n._destroy(),delete t[e]})});var r=j.pad3DViewer.getFrameWindow().getActionBar(),o=r.onActionBarReady(function(){r.removeCallback(o),setTimeout(e.actionBarReadyCb,500)});j.pad3DViewer.loadActionBar({file:e.file,module:e.module})}function te(e,t){var n=function(){if(j.pad3DViewer){var e,n=p.getCommandCheckHeader("WebDocumentBookmarksPanelCmdHdr",j.pad3DViewer.getCommandContext());if(n){let e=localStorage.getItem("DMUBookmarksPanelDisplayed");"true"!==e&&("false"===e||"Requirement"!==t&&"Requirement Specification"!==t)||n.setState(!0),h&&h.documentHasBookmarks()?n.enable():n.disable()}if((n=p.getCommand("WebDocumentRotatePagesLeftCmdHdr",j.pad3DViewer.getCommandContext()))&&(h&&"Document"===h.getDocumentType()?n.enable():n.disable()),(n=p.getCommand("WebDocumentRotatePagesRightCmdHdr",j.pad3DViewer.getCommandContext()))&&(h&&"Document"===h.getDocumentType()?n.enable():n.disable()),(n=p.getCommand("DMUNextCommentCmdHdr",j.pad3DViewer.getCommandContext()))&&(I&&I.hasComments()?n.enable():n.disable()),(n=p.getCommand("DMUPreviousCommentCmdHdr",j.pad3DViewer.getCommandContext()))&&(I&&I.hasComments()?n.enable():n.disable()),s.getReviewContext({context:j.pad3DViewer})&&s.getReviewContext({context:j.pad3DViewer}).getCurrentSessionMarkup()&&(e=s.getReviewContext({context:j.pad3DViewer}).getCurrentSessionMarkup()),e){var r=e.getSlides(),o=e.getAttribute("sCurrentSlideId"),i=u.giveDMUSlidesController({context:j.frmWindow});if(j.autoReframe=!1,i)if("string"==typeof o){for(var a=0;a<r.length;a++)if(r[a].getAttribute("sID")===o){i.setActiveSlide(r[a]);break}}else r.length&&i.setActiveSlide(r[0])}}};G!==e?("ITF"===e?ee({file:"3DPlayDMUAndITFSection.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"Document"===e?ee({file:"3DPlayDMUExperienceDocument.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"3D"===e?ee({file:"3DPlayDMUExperience.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"2D"===e?ee({file:"3DPlayDMUDrawingExperience.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}):"MSR"===e&&ee({file:"3DPlayDMUMSRExperience.xml",module:"3DPlayDMUExperience",actionBarReadyCb:n}),G=e):n()}function ne(e){U||(U=C.getDMUApplicativeContextManager({context:j.pad3DViewer})).initApplicativeContainer(e,{onReady:function(e){e&&e.length&&e.forEach(function(e){"POI"!==e.getApplicativeContainerID()&&e.setActiveState(!0)})}})}function re(){if(B&&X){var e;j.pad3DViewer.getRootBagPath().getChildrenPathes()[0]&&(e=y.getNodeType(j.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0)));var t=j.pad3DViewer.getApplicativeData().getLoadedItfData&&j.pad3DViewer.getApplicativeData().getLoadedItfData().data.length?"ITF":"Drawing"===e||"DIFLayout"===e||"DIFSheet"===e?"2D":"Document"===e||"Requirement"===e||"Requirement Specification"===e?"Document":"DesignSight"===e?"MSR":"3D";ne(t),"Document"!==t||"DXF"!==b.getLoadMarkupCtxType()&&"DWG"!==b.getLoadMarkupCtxType()||(t="2D"),te(t),"Document"===t&&j.pad3DViewer.getViewpoint().setDefaultController(!0,"CATIA"),(E=w.getSelectionManager({context:j.pad3DViewer})).setActiveState(!0),(W=g.getPreferenceManager({context:j.pad3DViewer.getFrameWindow()}))&&(W.setUnitsPreferencesDisplayFlag(!0),W.setDisplayPreferencesDisplayFlag(!0),W.set3DSelectionPreferencesDisplayFlag(!0),W.set2DSelectionPreferencesDisplayFlag(!0),W.setMeasurePreferencesDisplayFlag(!0),W.setClippingPreferencesDisplayFlag(!0),W.addPreferences([{nls:S.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:S.preferences.SlideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}},{nls:S.preferences.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:S.preferences.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#FF0000"},getDefaultValue:function(){return"#FF0000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:S.preferences.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#00FF00"},getDefaultValue:function(){return"#00FF00"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:S.preferences.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:S.preferences.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]}]}]),W.setPreferredPreferenceContainersOrder(["MarkupPreferences","MeasurePreferences","SectionPreferences","ComparePreferences"]),J=W.subscribe("com.ds.mep:onPrefUpdate",function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let n=0;n<t.repositories[e].preferences.length;n++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[n].name?(Z=t.repositories[e].preferences[n].value,E&&E.selectParentReference("select3DShape"!==Z)):"Select3DGeometry"===t.repositories[e].preferences[n].name?(Q="true"===t.repositories[e].preferences[n].value,E&&E.setPicking(Q?0:1)):"Select2DGeometry"===t.repositories[e].preferences[n].name?(Y="true"===t.repositories[e].preferences[n].value,E&&j.pad3DViewer.getViewer().get2DMode()&&E.setPicking(Y?0:1)):"ProjectionType"===t.repositories[e].preferences[n].name?(K=t.repositories[e].preferences[n].value,j.pad3DViewer&&j.pad3DViewer.getViewer()&&j.pad3DViewer.getViewer().currentViewpoint&&j.pad3DViewer.getViewer().currentViewpoint.setProjectionType(K)):"Gravity"===t.repositories[e].preferences[n].name&&(z="true"===t.repositories[e].preferences[n].value,j.pad3DViewer&&j.pad3DViewer.getViewer()&&j.pad3DViewer.getViewer().currentViewpoint&&j.pad3DViewer.getViewer().currentViewpoint.control&&(j.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!z),j.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!z)))}),f.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape","Select2DGeometry"]}]).then(e=>{let t=e.repositories;for(let e=0;e<t.length;e++)if("VisualizationRepository"===t[e].name)z="true"===t[e].preferences[0].value;else if("FrameGeneral"===t[e].name)K=t[e].preferences[0].value;else if("SelectionRepository"===t[e].name){let n=t[e].preferences;for(let e=0;e<n.length;e++)"Select3DGeometry"===n[e].name?Q="true"===n[e].value:"Select2DGeometry"===n[e].name?Y=n[e].value:"SelectParentReferenceOr3DShape"===n[e].name&&(Z=n[e].value)}j.pad3DViewer.getViewer().get2DMode()?E&&E.setPicking(Y?0:1):("boolean"==typeof z&&(j.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!z),j.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!z)),"Perspective"!==K&&"Parallel"!==K||j.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===K?0:1),E&&E.setPicking(Q?0:1),E&&E.selectParentReference("select3DShape"!==Z))}).catch(e=>{j.pad3DViewer.getViewer().get2DMode()?(E&&E.setPicking(Y?0:1),window.console.warn("Could not get server value, default value set instead.",e)):("boolean"==typeof z&&(j.pad3DViewer.getViewer().currentViewpoint.getControl().setRotationRolling(!z),j.pad3DViewer.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!z)),"Perspective"!==K&&"Parallel"!==K||j.pad3DViewer.getViewer().currentViewpoint.setProjectionType("Perspective"===K?0:1),E&&E.setPicking(Q?0:1),E&&E.selectParentReference("select3DShape"!==Z),window.console.warn("Could not get server value, default value set instead.",e))}))}}function oe(){if(!X){if(X=!0,s.getReviewContext({context:j.pad3DViewer})&&s.getReviewContext({context:j.pad3DViewer}).getCurrentSessionMarkup()){var e;j.pad3DViewer.getRootBagPath().getChildrenPathes()[0]&&(e=y.getNodeType(j.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0)));var t=j.pad3DViewer.getApplicativeData().getLoadedItfData&&j.pad3DViewer.getApplicativeData().getLoadedItfData().data.length?"ITF":"Drawing"===e||"DIFLayout"===e||"DIFSheet"===e?"2D":"Document"===e||"Requirement"===e||"Requirement Specification"===e?"Document":"DesignSight"===e?"MSR":"3D";if(b||(b=M.getLoadingContextController({context:j.pad3DViewer})),"DXF"!==b.getLoadMarkupCtxType()&&"DWG"!==b.getLoadMarkupCtxType()||(t="2D"),ne(t),te(t,e),"Document"===t&&(j.pad3DViewer.getViewpoint().setDefaultController(!0,"CATIA"),h||(h=c.getManager({name:"DMU2DSheetManager",context:j.frmWindow})),I||(I=D.giveDMUCommentsController({context:j.frmWindow,commandContext:j.pad3DViewer.getCommandContext()})),!h.isADocumentDisplayed())){let n=s.giveEventsController({viewer:j.pad3DViewer.getViewer()}),r=n.addEvent("on2DDocumentLoadSuccess",()=>{n.removeEvent(r),te(t,e)})}A||(A=new d({context:j.pad3DViewer})).subscribe("onActiveStateModified",function(e){_=!e.state}),L||(o.setSlidePreferences({context:j.frmWindow,preferences:{displayNominal:!0}}),L=!0)}re()}}function ie(e){if(!B&&void 0!==e.reviewId){let t;(t="Markup"===e.reviewType?O.getDnDReviewAndJSONFile:O.getMarkupStream)({markupId:e.reviewId,markupType:e.reviewType,markupOwner:e.owner,relatedSubContext:e.subContext},function(t){var n,a={},l=null,c=null,p=async function(){var n=s.getReviewContext({viewer:j.pad3DViewer.getViewer()});n||(n=await r.createReviewContext({context:j.pad3DViewer}));var a=new i({viewer:j.frmWindow.getViewer(),experience:n,appType:"3dPlay"});a.importDataModel(t.jsonObj,function(r){a.postImport();const i=r[0].getMarkupContent?r[0].getMarkupContent():r[0];i&&i.setMaturityState(e.reviewState),n.setCurrentSessionMarkup(i),n.setReadOnly(!0),n.refreshNode(),b||(b=M.getLoadingContextController({context:j.pad3DViewer})),n.setReviewCtxInformation({contextId:e.physicalid,subContextId:e.subContext&&e.subContext.id?e.subContext.id:void 0,subContext:e.subContext,contextType:b?b.getLoadMarkupCtxType():F,reviewId:t.reviewPid,reviewName:e.displayname,reviewType:t.reviewType,modifiable:t.modifiable,owner:t.owner,tempObjectInfo:b?b.getTempObjectInformations():void 0}),B=!0,o.setSlidePreferences({context:j.frmWindow,preferences:{panelTitle:e.displayname}}),re()})};t.jsonObj.Contexts?(e.refresh&&p(),b||(b=M.getLoadingContextController({context:j.pad3DViewer})),"Document"===e.dtype||"Specification Report"===e.dtype?(t.jsonObj.Contexts[0].documentVersionInfos&&(n=t.jsonObj.Contexts[0].documentVersionInfos),a.objectId=e.physicalid,a.objectType="Document",e.subContext&&e.subContext.id&&(a.subContext=e.subContext),a.documentType=t.jsonObj.Contexts[0].documentType,a.fileId=n?n.fileId:"",a.cbOK=async function(){await p()},a.appInfo="X3DPLAW_AP",b.load({data:a})):(c=t.jsonObj.Contexts[0].listData,l=t.jsonObj.Contexts[0].loadingInfos,c&&0!==c.length?(a.objectId=c,a.objectType="PLMPIMMetricReference",a.loadMode=l,a.appInfo="X3DPLAW_AP",a.cbOK=function(){p()},b.load({data:a})):(a.objectId=e.physicalid,a.objectType="SIMItfSimulation",a.loadMode=l,a.appInfo="X3DPLAW_AP",a.cbOK=function(){p()},b.load({data:a})))):"Requirement"===e.dtype||"Requirement Specification"===e.dtype?(b||(b=M.getLoadingContextController({context:j.pad3DViewer})),a.objectId=e.physicalid,a.objectType=e.dtype,a.cbOK=function(){p()},a.appInfo="X3DPLAW_AP",b.load({data:a})):p();A||(A=new d({context:j.pad3DViewer})).subscribe("onActiveStateModified",function(e){_=!e.state}),L||(o.setSlidePreferences({context:j.frmWindow,preferences:{displayNominal:!0}}),L=!0)},function(){v&&v.destroy(),v=new a({body:j.frmWindow.getUIFrame(),type:"error",message:S.noMarkup})})}}P=null,this.internalLoad=function(e){if(H||window.require(["DS/PADUtils/PADCommandProxy"],e=>{H=e.create({events:{onSelect:function(e){let t=s.giveEventsController({viewer:j.pad3DViewer.getViewer()});t&&t.fireEvent("onCrossWidgetSelection",e)}}})}),s.removeReviewContext({context:j.pad3DViewer}),R=e?JSON.stringify(e):null,e){var t=e.asset.physicalid,n=e.asset.type;if(t){var r=function(){v&&v.destroy(),v=new a({body:j.frmWindow.getUIFrame(),type:"error",message:S.loadError})};let o;(o="Markup"===e.asset.type?O.getProductByMarkerId:O.getMarkupInfos)(e.asset,function(o){var i,a,d,p=e.asset;if(o&&o.MarkupContext&&o.MarkupContext.contexts&&o.MarkupContext.contexts.length&&o.MarkupContext.contexts.length>1)for(var u=0;u<o.MarkupContext.contexts.length;u++)"Specification Report"===o.MarkupContext.contexts[u].type?(i=o.MarkupContext.contexts[u].id,d=o.MarkupContext.contexts[u].type):a={id:o.MarkupContext.contexts[u].id,type:o.MarkupContext.contexts[u].type,label:o.MarkupContext.contexts[u].name};"r2vsurvey"===o.MarkupContext.serviceID?(p.physicalid=o.MarkupContext.contextIds&&o.MarkupContext.contextIds.length>0?o.MarkupContext.contextIds[0]:o.MarkupContext.contextId,p.dtype="R2VFeatureState"):(p.physicalid=i||o.MarkupContext.contexts[0].id,p.dtype=d||o.MarkupContext.contexts[0].type,a&&a.id&&(p.subContext=a)),p.dtype=o.MarkupContext.serviceID&&"r2vsurvey"===o.MarkupContext.serviceID?"R2VFeatureState":o.MarkupContext.contexts[0].type,p.reviewId=t,p.reviewType=n,p.reviewState=o.currentState,p.owner=o.owner,F=p.dtype;var C,g,f=function(){T||(T=j.pad3DViewer.subscribe({event:"onRootAdded"},function(e){var t;t={physicalid:e.id,dtype:y.getNodeType(e.path.getLastElement(!0)),onComplete:function(){$||($=!0,j.onModelLoadingCompleted(),oe(),ie(p))},onFailure:function(){$||($=!0,j.onModelLoadingCompleted(),j.clearView(),r())}},h&&require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(e,n){e&&n&&h.load2DDocument({phyID:t.physicalid,serverUrl:e.get3DSpaceUrl(),securityContext:n.getSetting("pad_security_ctx"),dataType:t.dtype,is2DCompareActive:$,parentNode:j.pad3DViewer.getRootBagPath().getChildrenPathes()[j.pad3DViewer.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),onLoadingStarted:function(){$||j.onModelLoadingStarted(!0)},onComplete:t.onComplete,onFailure:t.onFailure})})})),k||(k=j.pad3DViewer.subscribe({event:"onRootRemoved"},function(e){h&&h.clean2DDocument(e)})),(h=c.getManager({name:"DMU2DSheetManager",context:j.frmWindow}))||(h=new l({ctxViewer:j.pad3DViewer}),c.addManager({name:"DMU2DSheetManager",context:j.frmWindow,manager:h})),j.pad3DViewer.addRoots({objects:[{path:[p.physicalid]}]})};C=p.dtype,g=function(e){e&&e.length&&-1!==e.indexOf("SIMItfSimulation")?ie(p):e&&e.length&&-1!==e.indexOf("DesignSight")?function(){b||(b=M.getLoadingContextController({context:j.pad3DViewer}));var e={};e.objectId=p.physicalid,e.objectType=p.dtype,b.load({data:e}),ie(p)}():e&&e.length&&(-1!==e.indexOf("Drawing")||-1!==e.indexOf("CATDrawing"))?f():-1!==e.indexOf("DIFLayout")||-1!==e.indexOf("DIFSheet")?function(){b||(b=M.getLoadingContextController({context:j.pad3DViewer}));var e={};e.objectId=p.physicalid,e.objectType=p.dtype,b.load({data:e}),ie(p)}():e&&e.length&&(e.includes("Document")||e.includes("Requirement")||e.includes("Requirement Specification")||e.includes("Specification Report"))?function(){T||(T=j.pad3DViewer.subscribe({event:"onRootAdded"},function(){oe()})),(h=c.getManager({name:"DMU2DSheetManager",context:j.frmWindow}))||(h=new l({ctxViewer:j.pad3DViewer}),c.addManager({name:"DMU2DSheetManager",context:j.frmWindow,manager:h})),I||(I=D.getDMUCommentsController({context:j.frmWindow,commandContext:j.pad3DViewer.getCommandContext()}));let e=s.giveEventsController({viewer:j.pad3DViewer.getViewer()});q||(q=e.addEvent("onFireCrossWidgetSelection",e=>{H&&H.select(e)})),ie(p)}():e&&e.length&&-1!==e.indexOf("R2VFeatureState")?(T||(T=j.pad3DViewer.subscribe({event:"onRootAdded"},function(){j.onModelLoadingCompleted(),oe(),ie(p)})),j.pad3DViewer.addR2Vs({objects:[{displayName:"r2vName",objectId:p.physicalid,objectType:"R2V_FeatureState",path:[{resourceid:p.physicalid,type:"R2V_FeatureState"}],serviceId:"r2vsurvey"}],reframe:!1,displayNotif:!0,dispatch:!0})):(T||(T=j.pad3DViewer.subscribe({event:"onRootAdded"},function(){j.onModelLoadingCompleted(),oe(),ie(p)})),"ENOStrRefinementSpecification"===F?j.pad3DViewer.addFilter([{objectId:p.physicalid}]):j.pad3DViewer.addRoots({objects:[{path:[p.physicalid]}]}))},m.getParentTypes(C).then(function(e){g([C].concat(e))}).catch(function(){g([C])})},r)}}},this.internalClear=function(e){if(H&&(H.destroy(),H=null),q){let e=s.giveEventsController({viewer:j.pad3DViewer.getViewer()});e&&e.removeEvent(q),q=null}if(W){W.removePreferences(["MarkupPreferences"]);var t=Object.keys(N);for(let e=0;e<t.length;e++)W.unsubscribe(N[t[e]]);N={}}if(j.pad3DViewer&&T&&j.pad3DViewer.unsubscribe(T),T=null,j.pad3DViewer&&k&&j.pad3DViewer.unsubscribe(k),k=null,J&&(W.unsubscribe(J),J=null),A&&(A.clean(),A=null),U&&C.unreferenceDMUApplicativeContextManager({context:j.pad3DViewer}),e){if(g.unreferencePreferenceManager({context:j.pad3DViewer.getFrameWindow()}),W=null,w.unreferenceSelectionManager({context:j.pad3DViewer}),E=null,s.removeReviewContext({context:j.pad3DViewer}),h&&h.clean2DDocument(),I&&I.cleanCommentsPanel(),D.unreferenceDMUCommentsController({context:j.frmWindow}),j.pad3DViewer.getRootBagPath().getChildrenPathes()[0]){var n=y.getNodeID(j.pad3DViewer.getRootBagPath().getChildrenPathes()[0].getLastElement(!0));j.pad3DViewer.getController().removeRoots({pids:[n]})}c.removeManager({name:"DMU2DSheetManager",context:j.frmWindow})}B=!1,X=!1,$=!1,h=I=U=null},this.internalDispose=function(e){const t=j.pad3DViewer&&j.pad3DViewer.getCommandContext(),n=V.getExperience(t);n&&n.executeScriptingFunction("showAll"),R=null,j.frmWindow.getContextualUIManager().unregister("3DPlayDMUExperience"),o.removeSlidePreferences({context:j.frmWindow}),j.internalClear&&j.internalClear("ENOR3D_AP"!==e),O=null,L=!1},this.internalRefresh=function(){R&&(j.internalClear(!0),j.internalLoad(JSON.parse(R),!0))},this.internalPostCreate=function(){j.frmWindow.getContextualUIManager().register({subscriberId:"3DPlayDMUExperience",workbenchName:"3DPlayDMUExperience",context:j.pad3DViewer.getCommandContext(),cmdPrefix:"",fileName:"3DPlayDMUExperience.xml",module:"3DPlayDMUExperience",onContextualMenuReady:function(e,n){var r=[];if(_&&n&&n.XmousePosition){var o=new t.Vector2(n.XmousePosition,n.YmousePosition),i=j.frmWindow.getViewer().getMousePosition(o);0===j.frmWindow.getViewer().pick(i,"mesh",!0).path.length&&(x.isMobile()||(r=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuQMCommand"]}]),r=r.concat([{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}]))}return{cmdList:r}}})},e.commandApplication=!1,e.workbenchs=e.workbenchs||[],e.options.pad3DViewer||e.workbenchs.push({name:"3DPlayDMUExperience",module:"3DPlayDMUExperience"}),this._parent(e),this.subscribe("ASSET/LOADINGFINISHED",oe,!0)},clearView:function(){this.internalClear&&this.internalClear(!0),this._parent()},onPostCreate:function(){this.pad3DViewer.getViewer().setPrePicking({activated:!0,displayHL:!0}),window.widget.setMetas({helpPath:"3DPlayDMUExperience/assets/help"}),window.widget.dispatchEvent("onPlayExperienceReady",[{pad3DViewer:this.pad3DViewer}]),this.internalPostCreate&&this.internalPostCreate()},dispose:function(e){window.widget.setMetas({helpPath:void 0}),this.internalDispose&&this.internalDispose(P),P=null,this._parent(e)},refresh:function(){return this.internalRefresh&&this.internalRefresh(),!0},loadAsset:function(e){e&&e.asset&&e.asset.physicalid&&this.internalLoad&&(this.clearView(),this.internalLoad(e))},acceptSwitch:function(e){var t=!1;return e&&e.options&&e.options.id&&("ENOR3D_AP"!==(P=e.options.id)&&"CATC3D_AP"!==P&&"CATA3I_AP"!==P||(t=!0)),t}})});