define("DS/DELPPWImplementModule/ImplementModule",["UWA/Core"],function(e){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","ModelBehavior","SelectionBehavior","ProductImplementBehavior","AssignProductBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ViewBehavior","LinkBehavior"],creator:function(t,n,i,o,l,c,m,s,a,r,p){var d,g,S,I,u,h,f,P,L,A,v,C,R,b,k,T,D,E,O,N,U,w,V,F,y,M,B,W,_,j,x=null,H=null,K=null,X=null,q={};return S=function(t,n){if(q={},!e.is(t))throw new Error("Command ID is null");q.cmdId=t,q.onOKCallBack=n,q.onCancelCallback=N,q.newObjType=H,q.isInstancePossible=null},u=function(n,o){var l;if(H=null,d=null,K=null,e.is(o,"array")&&0<o.length&&o.forEach(function(t){e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string")&&("ReferenceType"===t.ID&&(H=t.Value),"V_DimensionType"===t.ID&&(K=t.Value))},this),!e.is(H))throw l=i.getNLSValue("Error.CommandConfigNotValid",{cmdName:n}),t.warn(l),new Error(l);d=H.split("/")[1]},h=function(t){var n,l,c=!1,m=i.getNLSValue("ImplementUI.SelectedMultiObjectsForProvide");if(!0===t.bUpdateImplemented?x.updateImplemented(t.selNodes):!0===t.bUpdateImplementing&&x.updateImplementing(t.selNodes),e.is(d)&&(n=x.getImplementingID(),e.is(n))){let e=null;l={parent:o.getReferenceModel(n),child:d},({isInstancePossible:c,errorMessage:e}=o.computeIsInstancePossible(l)),x.showDCFormForAssign(c),c||x.getImplementedIDs().length>1&&x.showErrorMultipleImplementedSelected(m)}},f=function(e){!0===e.bUpdateImplemented&&(x.updateImplemented(e.selNodes),x.showDCFormForCreate(!0))},P=function(e){var t=!0,n=r.getActiveView();return!1===e.changed.isSelected&&e.sourceId!==n&&(t=!1),t},I=function(){e.is(x)&&(x.isVisible()&&x.destroyUI(),x=void 0)},L=function(t,n){if(q={},!e.is(t))throw new Error("Command ID is null");q.cmdId=t,q.moduleOptions=g,q.onOKCallBack=n,q.onCancelCallback=N},v=function(t){var n,l,m,s,a,r,p=!1,d=i.getNLSValue("ImplementUI.Implementing"),g=function(){A()},S=function(e){X.updateImplementedRevnList(l,e,!0,p)},I=function(e){X.showMessages(e,"error")};e.is(t)&&(a=function(){s=o.getInstancesFromCollection(m),e.is(s)&&s.length>0&&(p=!0),X.updateImplementingLabel(m),(n=c.getScopeLinksOfImplementing(m)).length<=0?X.showMessages(i.getNLSValue("ImplementBehavior.Validation.NoScopeExist"),"error"):(l=n[0].get("to"),r=function(t){e.is(t)?X.showMessages(t,"error"):o.getMajorRevisions(l,S,I)},c.prereqChecksForReconnectScope(q.cmdId,m,d,r,g))},m=o.getReferenceId(t),o.needToQueryForChildren(m)?o.getDescendantsFromServer([m],a,{expandLevel:1,forceDBMode:!0}):a())},A=function(){e.is(X)&&(X.isVisible()&&X.destroyUI(),X=void 0)},N=function(){I(),A()},U=function(n){var i=n.implementingId,o=n.implementedIDs[0],l=n.implementingPaths[0],m=n.implementedPaths[0];(e.is(i)&&e.is(o)||e.is(l)&&e.is(m))&&c.validateBrokenScopeLinkPromise(i,o).then(({isScopeLinkBroken:e,implementedRefId:t,implementingRefId:n})=>{if(e){const e={logMessage:"Reconnect Scope For Broken Link"};c.reconnectScope(t,n,e)}else c.createScopeLink([{implementingPID:i,implementedPID:o,implementingAbsPath:l,implementedAbsPath:m}])}).catch(()=>{t.log("Error occured while validating broken scope link")}),I()},y=function(t){const{implementingPaths:n,implementedPaths:i,cmdAction:o,implementedIDs:l}=t,[m]=n,[s]=i,[a]=l;e.is(m)&&e.is(s)&&c.managePartialScopeLink({implementingAbsPath:m,implementedAbsPath:s,implementedPID:a,implementingPID:t.implementingId,cmdAction:o}),I()},V=function(t){var n,i,l;e.is(t)&&(n=t.implementingId),o.isInstance(n)?(l=n,i=o.getReferenceIdFromInstance(l)):i=n,m.assignProduct({mbomReferenceId:i,mbomInstanceId:l,bodyInstanceIds:t.implementedIDs,bodyAbsolutePaths:t.implementedPaths,mbomAbsolutePaths:t.implementingPaths,newMfgAttributes:t.newObjAttributes,isInstancePossible:t.isInstancePossible,securityContextOverride:t.securityContextOverride}),I()},F=function(t){var n=i.getNLSValue(q.cmdTitle,{type:i.getNLSValue(d||"",null,"Type")}),o=t.implementedIDs,l=t.newObjAttributes,c={securityContextOverride:t.securityContextOverride};e.is(l[0].V_Type,"string")||(l[0].V_Type=H),m.createMfgItemAndScopeLink(o,l,n,c),I()},w=function(t){var n={logMessage:e.is(q.cmdTitle)?i.getNLSValue(q.cmdTitle):"Reconnect Scope command"};e.is(t)&&("ReconnectScope"===q.cmdId?c.reconnectScope(t.implementedId,t.implementingId,n,A):"ReviseAndReconnectScope"===q.cmdId&&c.reviseAndReconnectScope(t.implementedId,t.implementingId,n,A))},C=function(){N(),p.getRelations().then(function(e){e.isRelationsLoaded&&(H=null,d=null,S("CreateScopeLink",U),q.cmdTitle="ImplementUI.CreateScope",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!0,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!1,x=n.create("ImplementUI",q),h(x.getSelectionsWithPaths()))})},M=function(){N(),p.getRelations().then(function(e){e.isRelationsLoaded&&(H=null,d=null,S("CreatePartialScopeLink",y),q.cmdTitle="ImplementUI.CreatePartialScope",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!0,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!1,q.cmdAction=c.PartialScopeAction.CREATE_PARTIALSCOPE,x=n.create("ImplementUI",q),h(x.getSelectionsWithPaths()))})},W=function(){N(),p.getRelations().then(function(e){e.isRelationsLoaded&&(H=null,d=null,S("StretchPartialScopeLink",y),q.cmdTitle="ImplementUI.StretchPartialScope",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!0,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!1,q.cmdAction=c.PartialScopeAction.STRETCH_PARTIALSCOPE,x=n.create("ImplementUI",q),h(x.getSelectionsWithPaths()))})},B=function(){var n,o,m=[],s=i.getNLSValue("ImplementUI.Implementing");if(N(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,{path:i,id:l}=t[0],s=e.is(i)&&i.length>0?i:l;c.isPartialScoped(s)&&(e.is(s,"array")&&s.length>0?m=s:o=s)}if(e.is(m,"array")&&m.length>0)c.managePartialScopeLink({implementingAbsPath:m,cmdAction:c.PartialScopeAction.DELETE_PARTIALSCOPE});else if(e.is(o)){const e=c.getPartialScopeLinks(o)[0].get("to");c.managePartialScopeLink({implementingPID:o,implementedPID:e,cmdAction:c.PartialScopeAction.DELETE_PARTIALSCOPE})}else t.warn(i.getNLSValue("Error.PartialScopeDeletion",{objectName:s}))},_=function(){var n,o,m=[],s=i.getNLSValue("ImplementUI.Implementing");if(N(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,{path:i,id:l}=t[0],s=e.is(i)&&i.length>0?i:l;c.isPartialScoped(s)&&(e.is(s,"array")&&s.length>0?m=s:o=s)}if(e.is(m,"array")&&m.length>0)c.managePartialScopeLink({implementingAbsPath:m,cmdAction:c.PartialScopeAction.SWITCH_TO_FULLSCOPE});else if(e.is(o)){const e=c.getPartialScopeLinks(o)[0].get("to");c.managePartialScopeLink({implementingPID:o,implementedPID:e,cmdAction:c.PartialScopeAction.SWITCH_TO_FULLSCOPE})}else t.warn(i.getNLSValue("Error.SwitchPartialScope",{objectName:s}))},D=function(e){N(),p.getRelations().then(function(t){t.isRelationsLoaded&&(u("AssignProductUI",e.arguments),S("AssignProductUI",V),q.cmdTitle="ImplementUI.AssignImplemented",q.implementingSection=!0,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!1,q.modalFlag=!1,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!0,x=n.create("ImplementUI",q),h(x.getSelectionsWithPaths()))})},E=function(){var t,n,i=l.getSelectionsWithPaths()[1],o=[];N(),i.forEach(function(i){t=i.path,n=e.is(t)&&t.length>0?t:i.id,o.push(n)}),m.unassignProduct(o)},O=function(t){N(),u("CreateMfgItemAndScope",t.arguments),S("CreateMfgItemAndScope",F),q.cmdTitle="ImplementUI.CreateImplementingAndScope",q.implementingSection=!1,q.implementedSection=!0,q.optionsSection=!1,q.checkForImplementingScope=!1,q.modalFlag=!0,q.multiSelectionOfImplementing=!1,q.multiSelectionOfImplemented=!0,e.is(K)&&(q.cmdTitle="ImplementUI.ContinuousProvidedMaterialAndScope",q.newObjDimensionType=K),x=n.create("ImplementUI",q),f(x.getSelectionsWithPaths())},R=function(){var n,o,m,s=[],a=i.getNLSValue("ImplementUI.Implementing");N(),n=l.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0&&n.forEach(function(t){o=t.path,m=e.is(o)&&o.length>0?o:t.id,c.isScoped(m)&&s.push(m)}),s.length>0?c.deleteScopeLink(s):t.warn(i.getNLSValue("Error.ScopeDeletion",{objectName:a}))},b=function(t,i){N(),L(t,w),q.cmdTitle=e.is(i)?i:"",q.implementedRevTreeListCSSStyle="implementedSection-container",q.optionsSection=!1,q.modalFlag=!1,X=n.create("ImplementedRevChooserUI",q),v(l.getSelections()[1][0])},k=function(){b("ReconnectScope","Dialog.ReconnectScope.Title")},T=function(){b("ReviseAndReconnectScope","Dialog.ReviseAndReconnectScope.Title")},j=function n(){var m,s,a,r=l.getSelectionsWithPaths()[1][0].id,p=o.getReferenceModel(r);e.is(p)?(m=p.get("PID"),(s=c.getScopeLinksOfImplementing(m)).length<=0?t.warn(i.getNLSValue("Error.NoProductScopeExists.Title")):(a=s[0].get("to"),e.is(void 0)&&t.warn(a),c.createEngMadeFromItem(a,p))):t.debug(n+": Reference Model not found for pid:"+r)},{listenTo:function(){return{select:this.onSelect,CreateScopeLink:C,DeleteScopeLink:R,ReconnectScope:k,ReviseAndReconnectScope:T,AssignProduct:D,UnassignProduct:E,CreateMfgItemAndScope:O,CreatePartialScopeLink:M,DeletePartialScopeLink:B,StretchPartialScopeLink:W,SwitchToFullScopeLink:_,DELCreateEngineeringMadeFromItem:j}},onStart:function(e){g=e},onStop:function(){I(),A()},onSelect:function(t){var n;if(e.is(x)&&x.isVisible()){if(e.is(t)){if(!1===P(t))return;e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&(n=x.getSelectionsWithPaths())}e.is(n)&&n.selNodes.length>0&&(!0===q.implementingSection?h(n):f(n))}else e.is(X)&&X.isVisible()&&e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&v(l.getSelections()[1][0])}}}}});