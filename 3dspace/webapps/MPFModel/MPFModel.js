define("DS/MPFModel/ModelValidator",["UWA/Core","UWA/Class","UWA/Class/Model","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError","DS/MPFConstraintModel/ConstraintModel","DS/MPFDataProxy/NoDataProxy"],function(t,e,r,s,i,n,o){"use strict";const a=Object.freeze({REQUIRED:"required",INVALID:"invalid"}),c=e.extend({init:function(t){s.requiredOfPrototype(t.model,r,"options.model must be a UWA/Model"),this.model=t.model,this.keyAttribute=t.keyAttribute,t.model.constraints&&t.model.constraints.size&&t.model.constraints.size()>0&&(this.keyAttribute||this.model.constraints.first().idAttribute?this.constraints=this.model.constraints:console.warn("No idAttribute for model found and no keyAttribute defined - constraints cannot be used!")),this.validations={},t.validations&&this._registerValidations(t.validations)},validate:function(e){this.constraints&&this._updateConstraints(e);const r=[];if(t.is(e,"string"))this._validateAttribute(e,this.model.get(e),r);else if(Array.isArray(e))for(let s=0;s<e.length;s++)t.is(e[s],"string")&&this._validateAttribute(e[s],this.model.get(e[s]),r);else if(t.is(e,"object")){const t=Object.keys(e);for(let s=0;s<t.length;s++)this._validateAttribute(t[s],e[t[s]],r)}else{const t=Object.keys(this.validations);for(let e=0;e<t.length;++e)this._validateAttribute(t[e],this.model.get(t[e]),r)}if(r.length>0)return r},_validateAttribute:function(e,r,s){const i=this.validations[e];if(Array.isArray(i))for(let e=0;e<i.length;e++){const n=i[e];if(this._checkConditions(n.getConditions())){const e=t.is(r,"string")&&""===r.trim();n.isRequired()&&(!t.is(r)||n.isString()&&e)?s.push(this._getValidationError(a.REQUIRED,n)):!t.is(r)||e||n.isCorrectType(r)&&n.patternIsFoundIn(r)||s.push(this._getValidationError(a.INVALID,n))}}},_checkConditions:function(t){for(let e=0;e<t.length;e++){const r=t[e];if(Array.isArray(r)&&r.length>=2)if(r.length>2&&!0===r[2]){if(this.model.get(r[0])===r[1])return!1}else if(this.model.get(r[0])!==r[1])return!1}return!0},_getValidationError:function(e,r){const s={field:r.getAttribute(),errorType:e};if(e===a.REQUIRED){const e=r.getRequiredError();t.is(e)?s.message=e:(console.warn('No "required" error message defined for attribute "'+s.field+'"!'),s.message=s.field+" is required")}else if(e===a.INVALID){const e=r.getInvalidError();t.is(e)?s.message=e:(console.warn('No "invalid" error message defined for attribute "'+s.field+'"!'),s.message=s.field+" is invalid")}return s},_updateConstraints:function(e){let r;const s=this.keyAttribute||this.constraints.first().idAttribute;if(t.is(e,"object")&&e[s]?r=this.constraints.get(e[s])?this.constraints.get(e[s]):this.constraints.get("DEFAULT"):this.model.has(s)?r=this.constraints.get(this.model.get(s))?this.constraints.get(this.model.get(s)):this.constraints.get("DEFAULT"):(r=this.constraints.get("DEFAULT"),console.warn("Model does not have the key attribute corresponding to the idAttribute defined in the constraints -> default used for validation")),this._deleteReplaceableConstraints(),t.is(r,"object")){const t=r.keys(),e=!0;for(let s=0;s<t.length;s++){const i=t[s],n=r.get(i);if(Array.isArray(n))for(let t=0;t<n.length;t++)this._addConstraintModel(n[t],e);else this._addConstraintModel(n,e)}}},_deleteReplaceableConstraints:function(){const t=Object.keys(this.validations);for(let e=0;e<t.length;e++){const r=t[e],s=this.validations[r];if(Array.isArray(s)&&s.length>0)for(let t=s.length-1;t>=0;t--)s[t].isReplaceable&&s.splice(t,1)}},_addConstraintModel:function(t,e){if(n.prototype.isPrototypeOf(t)){t.isReplaceable=!0===e;const r=t.getAttribute();Array.isArray(this.validations[r])?this.validations[r].push(t):this.validations[r]=[t]}},_registerValidations:function(e){for(let r=0;r<e.length;r++){const s=e[r];if(t.is(s[n.Fields.ATTRIBUTE])){const t=new n(s,{dataProxy:o.getInstance()});this._addConstraintModel(t)}}}});return c.ErrorTypes=a,c}),define("DS/MPFModel/CollectionFetchOptions",[],()=>{"use strict";return Object.freeze({START:"start",SIZE:"size",SEARCH:"search",COMPANY:"company",ONLINEINSTANCE:"online-instance"})}),define("DS/MPFModel/ModelChangeTracker",["UWA/Core","UWA/Class"],function(t,e){"use strict";const r='"DS/MPFModel/ModelChangeTracker" is deprecated. Please use the new tracker via the MPFModel functions "hasPendingChanges" and "getPendingChanges" and "clearPendingChanges".';return e.extend({init:function(){this.changes={}},track:function(e,{ignoreDeprecation:s}={}){if(s||console.warn(r),!t.is(e,"object"))throw new Error("change must be an object");t.extend(this.changes,e)},getChanges:function(){return console.warn(r),this._deepCloneData(this.changes)},_deepCloneData(t){if(t instanceof e)return this._deepCloneData(t.omit());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const s=t[r];e.push(this._deepCloneData(s))}return e}if(t&&"object"==typeof t){const e={},r=Object.keys(t);for(let s=0;s<r.length;s++){const i=r[s],n=t[r[s]];e[i]=this._deepCloneData(n)}return e}return t},isEmpty:function(){let t;for(t in console.warn(r),this.changes)if(Object.prototype.hasOwnProperty.call(this.changes,t))return!1;return!0},reset:function(){this.changes={}}})}),define("DS/MPFModel/ModelCache",["UWA/Class"],function(t){"use strict";return t.singleton({init:function(){this._cache={}},has:function(t){var e,r;return!1,"string"===(e=typeof t)||"number"===e?r=t:"object"===e&&(r=t.id),this._cache.hasOwnProperty(r)},add:function(t){var e,r,s,i;return e=!1,s=t._type||"global",this._cache.hasOwnProperty(s)||(this._cache[s]={}),r=this._cache[s],(i=t.id)&&(r.hasOwnProperty(i)?r[i].lastAccess=(new Date).toISOString():(r[i]=this._createCacheEntry(t),e=!0)),e},get:function(t,e){var r,s;return t||(t="global"),this._cache.hasOwnProperty(t)&&(s=this._cache[t]).hasOwnProperty(e)&&(r=s[e].model),r},remove:function(t,e){var r,s;return t||(t="global"),this._cache.hasOwnProperty(t)&&(s=this._cache[t],r=this.get(t,e),delete s[e]),r},clear:function(){this._cache={}},_createCacheEntry:function(t){var e;return{created:e=(new Date).toISOString(),lastAccess:e,model:t}}})}),define("DS/MPFModel/ModelChangeTrackerV2",["UWA/Class/Model","UWA/Class/Collection"],function(t,e){"use strict";return class{constructor(t={},{trackNestedAttibutes:e=!1}={}){this.trackNestedAttibutes=e,this.trackNestedAttibutes?this._originalAttributes=this._deepCloneData(t):this._originalAttributes={...t}}getChanges(t){if("object"!=typeof t)throw new Error("attributes must be an object");const e={};return Object.keys(t).forEach(r=>{t[r]!==this._originalAttributes[r]&&(e[r]=t[r])}),this._deepCloneData(e)}getNestedChanges(t,e=this._originalAttributes){if("object"!=typeof t)throw new Error("attributes must be an object");const r={};return Object.keys(t).forEach(s=>{const i=t[s];if(Array.isArray(i)){const t=this._getArrayChanges(i,e[s]);t&&(r[s]=t)}else if("object"==typeof i){const t=this.getNestedChanges(i,e[s]);Object.keys(t).length>0&&(r[s]=t)}else i!==e[s]&&(r[s]=i)}),r}_getArrayChanges(t,e){if(!Array.isArray(t))throw new Error("First argument must be an array");const r=[];if(t.forEach((t,s)=>{Array.isArray(t)?r.push(this._getArrayChanges(t,e[s])):"object"==typeof t?r.push(this.getNestedChanges(t,e[s])):r.push(t!==e[s]?t:void 0)}),r.filter(t=>!!t).length>0)return t}hasChanges(t){if("object"!=typeof t)throw new Error("attributes must be an object");const e=this.getChanges(t);return Object.keys(e).length>0}reset(t){if("object"!=typeof t)throw new Error("attributes must be an object");Object.keys(t).forEach(e=>{this.trackNestedAttibutes?this._originalAttributes[e]=this._deepCloneData(t[e]):this._originalAttributes[e]=t[e]})}_deepCloneData(r){if(r instanceof t)return this._deepCloneData(r.omit());if(r instanceof e)return this._deepCloneData(r.toArray());if(Array.isArray(r)){const t=[];for(let e=0;e<r.length;e++){const s=r[e];t.push(this._deepCloneData(s))}return t}if(r&&"object"==typeof r){const t={},e=Object.keys(r);for(let s=0;s<e.length;s++){const i=e[s],n=r[e[s]];t[i]=this._deepCloneData(n)}return t}return r}}}),define("DS/MPFModel/MPFCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/MPFError/BadArgumentError","DS/MPFUtils/MPFUtils"],(t,e,r,s,i)=>{"use strict";return r.extend({setup(e,r){if(!t.is(r))throw new Error("options object param is required");if(!t.is(r.dataProxy))throw new Error("options.dataProxy param is required");this._parent(e,r),this.dataProxy=r.dataProxy,this.modelDataProxy=r.modelDataProxy||r.dataProxy,this.parentResourceId=r.parentResourceId||null,this.cache=r.cache,this.isFetching=!1,this.lastOptionsHash=0},sync(t,e,r){return(r=r||{}).url=this.dataProxy.url(e,t,r),r.ajax=this.dataProxy.request.bind(this.dataProxy),r.isCollectionSyncOperation=!0,this._parent(t,e,r)},fetch(t={}){t.dataProxy=this.dataProxy;const e=t.onComplete;return t.onComplete=function(t,r,s){const i=s&&s.responseHeaders&&s.responseHeaders["MP-Total-Model-Count"];i&&(this.totalModelCount=i),t.forEach(function(t){t.clearPendingChanges()}),e(t,r,s)},this._parent(t)},fetchPromise(t={}){const r=this,s=i.objectHashCode(t);return this.isFetching&&s===this.lastOptionsHash||(this.isFetching=!0,this.lastOptionsHash=s,this.deferredFetch=e.deferred(),t.onComplete=function(){r.isFetching=!1,r.deferredFetch.resolve(r)},t.onFailure=function(t,e,s){r.isFetching=!1,r.deferredFetch.reject({collection:t,response:e,options:s})},this.fetch(t)),this.deferredFetch.promise},getTotalModelCount(){return this.totalModelCount},create(t,e){return(e=e||{}).dataProxy=this.dataProxy,e.cache=this.cache,this._parent(t,e)},setParentResourceId(t){if(!t)throw new s("resourceId must be defined");this.parentResourceId=t},clone(){return new this.constructor(this._models,{dataProxy:this.dataProxy,modelDataProxy:this.modelDataProxy,parentResourceId:this.parentResourceId,cache:this.cache})},_prepareModel(t,e){let r=!1;return this.cache&&(r=this.cache.get(this.model._type,t.id)),r||(r=this._parent(t,e),this.cache&&this.cache.add(r)),r}})}),define("DS/MPFModel/MPFModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/MPFModel/ModelChangeTracker","DS/MPFModel/ModelChangeTrackerV2","DS/MPFUtils/MPFUtils","DS/MPFError/BadArgumentError","DS/MPFError/ValidationError","DS/MPFError/SyncError"],function(t,e,r,s,i,n,o,a,c){"use strict";function h(t,e,r){r=!0===r;const s={};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const n=e.get(i);n?s[n]=t[i]:r&&(s[i]=t[i])}return s}function l(t){const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&null!==t[r]&&(e[r]=t[r]);return e}const d=r.extend({init:function(e,r){if(!t.is(r))throw new Error("options object param is required");if(!t.is(r.dataProxy))throw new Error("options.dataProxy param is required");return this.cache=r.cache,this.dataProxy=r.dataProxy,this.changeTracker=new s,this._parent(e,r)},setup:function(t,e){this._parent(t,e),this.mapper=e.mapper,this.parentResourceId=e.parentResourceId||null,this.changeTrackerV2=new i(this.omit(),{trackNestedAttibutes:e.trackNestedAttibutes}),this.listenTo(this,"onSync",()=>{this.changeTracker.reset({ignoreDeprecation:!0}),this.changeTrackerV2.reset(this.omit())})},sync:function(t,e,r={}){const s=r.dataProxy||this.dataProxy;return r.url=s.url(e,t,r),r.ajax=s.request.bind(s),this._parent(t,e,r)},fetch:function(t={}){const e=this;let r,s;if(this.cache&&!1!==t.cache)if(s=this.cache.get(this.id))t&&"function"==typeof t.onComplete&&t.onComplete(s,null,t),r={cancel(){}};else{const s=t.onComplete;t.onComplete=function(t,r,i){"function"==typeof s&&(e.cache.add(t,r,i),s(t))},r=this._parent(t)}else r=this._parent(t);return r},fetchPromise:function(t={}){return new Promise((e,r)=>{this.fetch({...t,onComplete:()=>{e(this)},onFailure:(t,e,s)=>{r(new c({model:t,response:e,options:s}))}})})},save:function(e,r,s){t.is(e)&&"object"!==t.typeOf(e)||(s=r);const i=(s=s||{}).onComplete;s.onComplete=((t,e,r)=>(this.cache&&!1!==r.cache&&(this.cache.has(t)||this.cache.add(t)),i&&i(t,e,r),this.dispatchEvent("onSave",{ok:!0,model:t,message:"model succesfully saved"})));const n=s.onFailure;return s.onFailure=((t,e,r)=>(n&&n(t,e,r),this.dispatchEvent("onSave",{ok:!1,model:t,message:"unable to save model"}))),t.is(r)||(r=s),this._parent(e,r,s)},savePromise:function(e,r,s){return t.is(e)&&"object"!==t.typeOf(e)||(s=r),s=s||{},new Promise((i,n)=>{s.onComplete=(()=>{i(this)}),s.onFailure=((t,e,r)=>{n(new c({model:t,response:e,options:r}))}),t.is(r)||(r=s),!1!==this.save(e,r,s)||n(new c({model:this,response:new a("Validation before save failed"),options:s}))})},set:function(e,r,s){let i;return t.is(e,"object")?(i=e,s=r||{}):((i={})[e]=r,s||(s={})),!0!==s.isCollectionSyncOperation&&!1!==s.track?this.changeTracker.track(i,{ignoreDeprecation:!0}):this.changeTrackerV2&&this.changeTrackerV2.reset(i),this._parent(i,s)},getPendingChanges:function(t){return this.changeTrackerV2.getChanges(t||this.omit())},getNestedChanges(t){return this.changeTrackerV2.getNestedChanges(t||this.omit())},hasPendingChanges:function(t){return this.changeTrackerV2.hasChanges(t||this.omit())},clearPendingChanges:function(t){return this.changeTracker.reset({ignoreDeprecation:!0}),this.changeTrackerV2.reset(t||this.omit())},toJSON:function(t){let e;const r=this._parent(t);return e=l(e=this.mapper?h(r,this.mapper,!1):this._parent(r))},parse:function(t){let e;return(e=this.mapper?h(t,this.mapper.inverse(),!0):t)||{}},clone:function(){return new this.constructor(this._attributes,{dataProxy:this.dataProxy,cache:this.cache,mapper:this.mapper})},setParentResourceId:function(t){if(!t)throw new o("resourceId must be defined");this.parentResourceId=t},destroyPromise:function(t={}){return new Promise((e,r)=>{t.onComplete=(()=>{e(this)}),t.onFailure=r,this.destroy(t)})},validate:n.doNothing});return d.mapObjectKey=h,d.removeNullAttributes=l,d});