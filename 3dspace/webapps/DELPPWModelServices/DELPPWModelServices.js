define("DS/DELPPWModelServices/ModelUtils",["UWA/Core","UWA/Class","UWA/Date","UWA/Promise","DS/CfgBaseUX/scripts/CfgUtility","DS/DELPPWNavigationServices/SwitchDBModeManager"],function(e,n,t,i,o,s){"use strict";var r=n.singleton({name:"ModelUtils",_widgetTrigram:"NOT_DEFINED",_userGrantedRoles:[],init:function(n){var t="uwa";e.is(widget.environment)&&e.is(widget.environment.name)&&(t=widget.environment.name),"uwa"===t?this.setStandAlone(!0):this.setStandAlone(!1),this._parent(n)},getWidgetTrigram:function(){return r._widgetTrigram},setWidgetTrigram:function(e){r._widgetTrigram=e},getNavigateOnDatabasePreference:function(){var e=!1;return"Database"===widget.getValue("navigateOnIndex")&&(e=!0),e},getNavigateOnDatabase:function(){var e=!1;return!0===s.isDbMode()&&(e=!0),e},getNavigateOnIndex:function(){var e=!1;return"Index"===widget.getValue("navigateOnIndex")&&!0!==s.isDbMode()&&(e=!0),e},getNavigateOnIndexedDB:function(){return widget.getBool("navigateOnIndexedDB")},isNavigateOnDemand:function(){var e=!1;return"IndexRelationsOnDemand"===widget.getValue("navigateOnIndex")&&!0!==s.isDbMode()&&(e=!0),e},getOneDelmiaAggregationMode:function(){return widget.getBool("oneDelmiaAggregationMode")},getPrefSeparator:function(){return widget.getValue("separator")},getPrefExpandLevel:function(){return widget.getBool("fetchAllLevel")?-1:2},getCVServletLabel:function(){return this.getWidgetTrigram()+"-"+(new t).toISOString()},getTimeoutPreference:function(){var e=widget.getInt("timeout");return 1e3*(0!==e?e:600)},isStandAlone:function(){return r._standalone},setStandAlone:function(e){r._standalone=e},setUserGrantedRoles:function(n){e.is(n,"array")&&(r._userGrantedRoles=n)},getExecuteByBlockPromise:function(n){var t=n||{},o=e.is(t.callback,"function")?t.callback:function(){},s=e.is(t.context)?t.context:null,r=e.is(t.globalArray,"array")?t.globalArray:[],a=e.is(t.blockSize,"number")&&Math.abs(Math.floor(t.blockSize))>0?Math.abs(Math.floor(t.blockSize)):500,c=e.is(t.delay,"number")?Math.abs(Math.floor(t.delay)):5,l=Math.floor(r.length/a)+1,u=null,d=0,f=function(e){return function(e,n){return new i(function(t,i){var r=function(){t(n+1)};e.length>0?setTimeout(function(){o.call(s,e,r,i)},c):t(n+1)})}(r.slice(e*a,(e+1)*a),e)};for(d=0;d<l;d++)u=e.is(u)?u.then(f):f(0);return u},checkCFGLicenseAvailablePromise:function(){return new i(function(n,t){var i=!1;e.is(o.rolesAvailable)?o.rolesAvailable(function(t){e.is(t.isCFGRoleAvail,"boolean")&&(i=t.isCFGRoleAvail),n(i)}):t('"CfgUtility.rolesAvailable" method not available')})},isLicenseAvailable:function(n){return!!(e.is(r._userGrantedRoles,"array")&&r._userGrantedRoles.indexOf("InternalDS")>=0)||e.is(r._userGrantedRoles,"array")&&r._userGrantedRoles.indexOf(n)>=0},isMFNLicenseAvailable:function(){return this.isLicenseAvailable("MFN")},isMGALicenseAvailable:function(){return this.isLicenseAvailable("MGA")},isRMELicenseAvailable:function(){return this.isLicenseAvailable("RME")}});return r}),define("DS/DELPPWModelServices/BehaviorUtil",["UWA/Core","UWA/Class","DS/DELPPWLoggerModel/LoggerUtils","DS/PlatformAPI/PlatformAPI"],function(e,n,t,i){"use strict";var o=n.singleton({name:"BehaviorUtil",isFacet:!1,_isNLSTestEnabled:null,_isMdlAccessTestEnabled:null,init:function(e){e=e||{},this._parent(e)},_getVariable:function(n,o,s){var r=!!e.is(s)&&s,a=e.is(o,"string")&&o.length>0?o:"boolean",c=e.is(n,"string")&&n.length>0?n:"app.MFN.default",l=i.getApplicationConfiguration(c),u=localStorage.getItem(c),d=!1;if(e.is(l,"string")?(r=l,d=!0,t.debug(this.name,"From server ("+c+", "+a+"): "+r)):e.is(u,"string")&&(r=u,d=!0,t.debug(this.name,"From client ("+c+", "+a+"): "+r)),d)switch(a){case"boolean":r="true"===r}return r},isNewDragNDrop:function(){return!o._getVariable("app.MFN.isOldDragNDrop")},shouldLoadRootOnly:function(){return o._getVariable("app.feature.loadRootOnly")},isCloud:function(){var e=!1;return e=!o.isFacet&&o._getVariable("app.build.isCloud"),e},useRootStorage:function(){return o._getVariable("app.feature.useRootStorage")},getDefaultTimeout:function(){return o._getVariable("app.feature.defaultTimeout","string")},isSwipeableMenuPrefDisplayed:function(){return o._getVariable("app.MFNMGA.isSwipeableMenuPrefDisplayed")},isNavigateOnIndexedDBPrefDisplayed:function(){return o._getVariable("app.MFNMGA.isNavigateOnIndexedDBPrefDisplayed")},isDialogDisplayedAtDDinCaseOfMove:function(){return o._getVariable("app.MFNMGA.isDialogDisplayedAtDDinCaseOfMove")},isViewPersistanceOn:function(){return o._getVariable("app.feature.isViewPersistanceOn")},isSuppressHideShow3DColumn:function(){return o._getVariable("app.feature.suppressHideShow3DColumn")},setIsFacet:function(e){o.isFacet=e},getIsFacet:function(){return o.isFacet},isExpandFetchFetchEnabled:function(){return o._getVariable("app.MFNMGA.enableEFF","boolean",!0)},isCreateMBOMv2:function(){return o._getVariable("app.MFN.enableCreateMBOMv2","boolean")},isForceIndexModeEnabled:function(){return o._getVariable("app.MFNMGA.enableFIM","boolean",!0)},isNLSTestEnabled:function(){var n;return e.is(o._isNLSTestEnabled,"boolean")?n=o._isNLSTestEnabled:(n=o._getVariable("app.MFNMGA.TestNLS","boolean"),o._isNLSTestEnabled=n),n},isMdlAccessTestEnabled:function(){return e.is(o._isMdlAccessTestEnabled,"boolean")||(o._isMdlAccessTestEnabled=o._getVariable("app.MFNMGA.MdlAccessTest","boolean")),o._isMdlAccessTestEnabled},getNavigateSize:function(){return o._getVariable("app.feature.private.navigateSplitSize","string")},getNavigateFetchSize:function(){return o._getVariable("app.feature.private.navigateFetchSplitSize","string")},isInsertButtonInInsertCmdDisplayed:function(){return o._getVariable("app.feature.private.insertButtonInInsertCmdDisplayed")},shouldLoadRelationsOnDemand:function(){return o._getVariable("app.MGA.relationsOnDemand")},shouldLoadOOTBProcedures:function(){return o._getVariable("app.loadOOTBProcedures")},isDescHighlightFromEBOMEnabled:function(){return o._getVariable("app.MFN.descHighlightFromEBOM","boolean")},isChangeRequiredSyncronizationEnabled:function(){return o._getVariable("app.MFN.changeRequiredSyncronization","boolean")},isResultingProductSyncronizationEnabled:function(){return o._getVariable("app.MFN.ResultingProductSyncronization","boolean")},isCacheFullyOptimized:function(){return o._getVariable("app.MFNMGA.isCacheFullyOptimized","boolean")},isMFNConvertedToCST:function(){return o._getVariable("app.MFNMGA.isMFNConvertedToCST","boolean")},isDeleteOfProductImplementLinkAllowed:function(){return o._getVariable("app.MFN.allowDeleteOfProductImplementLink","boolean")},isUsagePointManagementEnabled:function(){return o._getVariable("app.SVR.isUsagePointEnabled","boolean")}});return o}),define("DS/DELPPWModelServices/MfgProcessBIUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWWebServices/WebserviceUtils"],function(e,n,t,i){"use strict";return n.singleton({name:"MfgProcessBIUtils",init:function(e){this._parent(e),this.biModelCollection=new t,this._systemArray=[],this._itemArray=[],this._itemConfigFilter={},this._sysConfigFilter={}},getMfgItemAssignmentStatus:function(){var n;return e.is(this.biModelCollection)&&(n=this.biModelCollection.where({type:"ItemAssignmentStatus"})),n},getSystemUpdateStatus:function(){var n;return e.is(this.biModelCollection)&&(n=this.biModelCollection.where({type:"SystemUpdateStatus"})),n},getBrokenMfgProcessStatus:function(n,t){var i;(n=n||{}).silent=!0,this._fetchStatus(n,function(n){e.is(n)&&(i=n.where({type:"SystemUpdateStatus",status:"DirectlyImpacting"}),t(i))})},_fetchStatus:function(e,n){var t=this;new Promise(function(n){t.isBIComputed()?n():t.fetchBIComputation(e,function(){n()})}).then(function(){n(t.biModelCollection)},function(){n([])})},fetchBIComputation:function(n,t){var o,s,r=this,a=function(t){e.is(n.onFailure,"function")&&n.onFailure.call(t)};n=n||{},s=!e.is(n.silent,"boolean")||n.silent,r._systemArray=e.is(n.rootSystems)?n.rootSystems:r._systemArray,r._itemArray=e.is(n.rootItems)?n.rootItems:r._itemArray,r._itemConfigFilter=e.is(n.itemConfigFilter)?n.itemConfigFilter:r._itemConfigFilter,r._sysConfigFilter=e.is(n.sysConfigFilter)?n.sysConfigFilter:r._sysConfigFilter,r._systemArray.length<=0||r._itemArray.length<=0?a():(o={expandLevel:-1,ordered:!0,systemIds:r._systemArray,sysConfigFilter:r._sysConfigFilter,itemIds:r._itemArray,itemConfigFilter:r._itemConfigFilter},i.webServiceRequest({url:"dsmfg/private/V0/invoke/MfgProcess/BI",method:"POST",onComplete:function(e){r._addToBIModelCollection(e,{silent:s}),t instanceof Function&&t()},onFailure:a,onTimeout:a,data:e.Json.encode(o),headers:{Accept:"application/json",SecurityContext:i.getSecurityContext(),"Content-Type":"application/ds-json"}}))},_addToBIModelCollection:function(e,n){var t,i,o,s;for(t in e)if(e.hasOwnProperty(t))for(o in i=e[t])i.hasOwnProperty(o)&&((s=i[o]).id=o,s.type=t,this.biModelCollection.add(s,n))},isBIComputed:function(){return this.biModelCollection.size()>0},resetBIModelCollection:function(){!0===this.isBIComputed()&&this.biModelCollection.reset()},setBIModelEvents:function(e){this.biModelCollection.addEvents(e)},removeBIModelEvents:function(){this.biModelCollection.removeEvents()}})}),define("DS/DELPPWModelServices/Navigation/NavigateOnLocalStore",["UWA/Core","DS/DELPPWModelServices/Navigation/NavigationBase","DS/DELPPWIRPCModel/Model/ReferenceModel","DS/DELPPWIRPCModel/Model/ConnectionModel","DS/DELPPWIRPCModel/Model/InstanceModel"],function(e,n,t,i,o){"use strict";return n.extend({init:function(e){this._parent(e)},getDescendants:function(n,s){var r,a,c,l=[n],u=[n.PID];c=function(){var n,t,i,o,r,a,c=0;u.forEach(function(l){n=self.references.get(l),e.is(n)&&(t=[],i=self.connections.where({to:n.id}),o=self.connections.where({from:n.id}),i.forEach(function(e){t.push({modelID:e.get("from"),connectionID:e.id,connectionTypeName:e.get("type")})}),o.forEach(function(e){t.push({modelID:e.get("to"),connectionID:e.id,connectionTypeName:e.get("type")})}),n.setDisplayModel({connectionModelInfo:t},{silent:!0}),a=function(){++c===u.length&&e.is(s.callback,"function")&&s.callback()},r=function(n){var t,i,o=[];n.forEach(function(n){var i=e.Json.decode(n);t=i.irpcID,o.push(i.docID)}),i=self.references.get(t),self._addDocuments(o,i,a)},self.IndexedDBUtils.where(self.IndexedDBUtils.documentsConnectionsStore,"irpcID",n.get("PID"),r,a))})},r=function(n){var i,r,d,f,g=[],p=0,m=function(){l=l.filter(function(e){return e.PID!==n.PID}),e.is(s.callback,"function")&&0===l.length?c():e.is(s.callback,"function")&&a(l[0])},h=function(n){p++,d=n.displayModel,delete n.displayModel,i=new t(n),u.push(i.id),self.references.get(i.get("PID"))||self.references.add(i),i.setDisplayModel(d,{silent:!0}),l.push(i._attributes),f=g[i.id],e.is(f)&&(r=f.model,self.instances.get(r.get("PID"))||self.instances.add(r,{silent:!0}),r.setDisplayModel(f.displayAttributes,{silent:!0})),p===Object.keys(g).length&&m()};self.IndexedDBUtils.where(self.IndexedDBUtils.instancesStore,"isAggregatedBy",n.PID,function(n){var t,i;n.forEach(function(n){var s=e.Json.decode(n);i=s.displayModel,delete s.displayModel,(t=new o(s)).setAdditionalInfo({queriedForConnections:!0}),g[t.get("isInstanceOf")]={model:t,displayAttributes:i},self.IndexedDBUtils.get(self.IndexedDBUtils.referencesStore,t.get("isInstanceOf"),h)})},m)},(a=function(n){var o,s,a,c=[],d=function(e){a=e.displayModel,delete e.displayModel,o=new t(e),u.push(o.id),self.references.get(o.get("PID"))||self.references.add(o),o.setDisplayModel(a,{silent:!0}),c.forEach(function(e){e.get("to")===o.id&&self.connections.add(e)}),l.push(o._attributes)};self.IndexedDBUtils.where(self.IndexedDBUtils.connectionsStore,"from",n.PID,function(t){t.forEach(function(n){s=new i(e.Json.decode(n)),c.push(s),self.IndexedDBUtils.get(self.IndexedDBUtils.referencesStore,s.get("to"),d)}),r(n)},function(){r(n)})})(n)}})}),define("DS/DELPPWModelServices/BIUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWWebServices/WebserviceUtils"],function(e,n,t,i){"use strict";return n.singleton({name:"BIUtils",init:function(e){this._parent(e),this.biModelCollection=new t,this._mbomArray=[],this._embomArray=[],this._mbomConfigFilter={},this._ebomConfigFilter={},this._pseudoBIStatusIdSet=new Set},getBrokenMfgItemStatus:function(n,t){var i;(n=n||{}).silent=!0,this._fetchStatus(n,function(n){e.is(n)&&(Array.isArray(n)?(i=n.filter(n=>{const t=n._attributes;let i=!1;return e.is(t.type)&&"MfgItemsUpdateStatus"===t.type&&e.is(t.isBroken,"boolean")&&!0===t.isBroken&&(i=!0),i}),t(i)):(i=n.where({type:"MfgItemsUpdateStatus",isBroken:!0}),t(i)))})},getPhantomNodeItems:function(){return this.biModelCollection.filter(n=>{const t=n.get("status");let i=!1;return e.is(t,"string")&&(i=t.toLowerCase().includes("intermediate")),i})},getProductAssignmentStatus:function(){var n;return e.is(this.biModelCollection)&&(n=this.biModelCollection.where({type:"ProductsAssignmentStatus"})),n},getMfgItemUpdateStatus:function(){var n;return e.is(this.biModelCollection)&&(n=this.biModelCollection.where({type:"MfgItemsUpdateStatus"})),n},_fetchStatus:function(n,t){const i=this;let o=n||{};(function(n){const t=!!e.is(n.forceBIComputation,"boolean")&&n.forceBIComputation;return new Promise(e=>{t||!i.isBIComputed()?i.fetchBIComputation(n,function(n){e(n)}):e([])})})(o).then(function(n){const s=!!e.is(o.areRootsBroken,"boolean")&&o.areRootsBroken;t(s?n:i.biModelCollection)}).catch(function(){t([])})},fetchBIComputation:function(n,t){var o,s,r,a,c=this,l=function(t){e.is(n.onFailure,"function")&&n.onFailure.call(t)};n=n||{},s=!e.is(n.silent,"boolean")||n.silent,c._mbomArray=e.is(n.rootMBOM)?n.rootMBOM:c._mbomArray,c._embomArray=e.is(n.rootEBOM)?n.rootEBOM:c._embomArray,c._mbomConfigFilter=e.is(n.rootMBOMConfigFilter)?n.rootMBOMConfigFilter:{},c._ebomConfigFilter=e.is(n.rootEBOMConfigFilter)?n.rootEBOMConfigFilter:{},r=!!e.is(n.areRootsBroken,"boolean")&&n.areRootsBroken,a=e.is(n.prefix)?n.prefix:null,c._mbomArray.length<=0||c._embomArray.length<=0?l():(o={expandLevel:-1,ordered:!0,mbomIds:c._mbomArray,ebomIds:c._embomArray,engConfigFilter:c._ebomConfigFilter,mfgConfigFilter:c._mbomConfigFilter,areRootsBroken:r},i.webServiceRequest({url:"dsmfg/private/V0/invoke/BI",method:"POST",onComplete:function(e){const n=c._addToBIModelCollection(a,e,{silent:s,merge:!0});t instanceof Function&&t(n)},onFailure:l,onTimeout:l,data:e.Json.encode(o),headers:{Accept:"application/json",SecurityContext:i.getSecurityContext(),"Content-Type":"application/ds-json"}}))},_addToBIModelCollection:function(n,t,i){const o=e=>(...n)=>n.join(e),s=o(","),r=o("/"),a=n=>e.is(n.isRef)&&!0===n.isRef,c=(e,n=null)=>{const t=e.length;return t>0?e[t-1]:n},l=this;let u,d,f;e.is(n)&&({mfgAggByPath:u,mfgOccPath:d,mfgInstanceLID:f}=n);let g=[];for(const o of Object.keys(t))for(const[p,m]of Object.entries(t[o])){let t=p,h=e.clone(m);if(e.is(n)&&"MfgItemsUpdateStatus"===o){if(e.is(h.aggregatedByPath)){const e=c(d.split(","));h.aggregatedByPathTillRoot=s(u,r(e,f),h.aggregatedByPath)}a(h)||(t=s(d,p))}h.id=t,h.type=o,e.is(n)&&l._pseudoBIStatusIdSet.add(h.id),g.push(l.biModelCollection.add(h,i))}return g},isBIComputed:function(){return this.biModelCollection.size()>0},resetBIModelCollection:function(){!0===this.isBIComputed()&&(this.clearPseudoBIStatus(),this.biModelCollection.reset())},clearPseudoBIStatus:function(){if(this.isBIComputed()&&this._pseudoBIStatusIdSet.size>0){const e={silent:!0};for(const n of this._pseudoBIStatusIdSet)this.biModelCollection.remove(n,e);this._pseudoBIStatusIdSet.clear()}},getProductStatus:function(e,n){if("ProductImplementLinkOcc"===n){if(0===e.length)return"NotAssigned";if(1===e.length)return"AssignedDirectly";if(1<e.length)return"AssignedMoreThanOnce"}else if("ProductImplementLink"===n){if(0===e.length)return"NotAssigned";if(1===e.length)return"AssociatedWithScope";if(1<e.length)return"AssignedMoreThanOnce"}},getProcessStatus:function(n,t){if(e.is(t)){if("ProductImplementLinkOcc"===n)return"ImplGood";if("ProductImplementLink"===n)return"ScopeGood"}return"NotApplicable"},setBIModelEvents:function(e){this.biModelCollection.addEvents(e)},removeBIModelEvents:function(){this.biModelCollection.removeEvents()},getBIModelCollection:function(){return this.biModelCollection},getBIModel:function(e){return this.biModelCollection.get(e)}})}),define("DS/DELPPWModelServices/DocumentObjAttributesUtils",["UWA/Core","UWA/Class"],function(e,n){"use strict";var t=n.singleton({name:"DocumentObjAttributesUtils",_logger:null,init:function(e){if(!(e=e||{}).webServiceUtils||!e.logger)throw new Error("webServiceUtils or logger options not defined");this._webServiceUtils=e.webServiceUtils,this._logger=e.logger,this._iUIConfigDocValuesURL="DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIDocumentDisplayAttributeConfig",this._readXMLConfiguration(),this.attrDisplayMap={}},_readXMLConfiguration:function(){t._webServiceUtils.getXMLValues(this._iUIConfigDocValuesURL,function(n){var i,o;if(e.is(n.DisplayAttributeDescriptionList))for(i=Array.isArray(n.DisplayAttributeDescriptionList.Document)?n.DisplayAttributeDescriptionList.Document:[n.DisplayAttributeDescriptionList.Document],o=0;o<i.length;o++)t.attrDisplayMap[i[o].coloumnName]=i[o].Attribute},function(e){t._logger.log(e.message)})},getDocumentAttributes:function(n,i){var o,s=t.attrDisplayMap[i],r=n[0].get("dataelements"),a="";if(e.is(s))for(Array.isArray(s)||(s=[s]),o=0;o<s.length;o++)e.is(r[s[o].name])&&""!==r[s[o].name]&&(a=a+r[s[o].name]+" ");else a=r.title;return a}});return t}),define("DS/DELPPWModelServices/Navigation/IndexedDBUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/ModelUtils","DS/DELPPWLoggerModel/LoggerUtils"],function(e,n,t,i){"use strict";var o=n.singleton({name:"IndexedDBUtils",referencesStore:"references",instancesStore:"instances",connectionsStore:"connections",documentsStore:"documents",documentsConnectionsStore:"documentsConnections",_db:null,_version:1,_storeNames:["references","instances","connections","documents","documentsConnections"],_keyPath:"pid",_columns:{references:["data"],instances:["isInstanceOf","isAggregatedBy","data"],connections:["from","to","data"],documents:["data"],documentsConnections:["docID","irpcID","data"]},init:function(n){var i,s;n=n||{},this._parent(n),e.is(o._db)||((i=indexedDB.open(t.getWidgetTrigram(),o._version)).onupgradeneeded=function(e){o._db=e.target.result,o._storeNames.forEach(function(e){s=o._db.createObjectStore(e,{keyPath:o._keyPath}),o._columns[e].forEach(function(e){s.createIndex(e,e,{unique:"data"===e})})})},i.onsuccess=function(e){o._db=e.target.result})},get:function(n,t,o,s){var r,a,c="indexedDB/get";r=i.printCurrentDateTime(c+" start - "),(a=this._db.transaction([n]).objectStore(n).get(t)).onsuccess=function(n){i.printDuration(r,c),e.is(n.target.result)?e.is(o)&&o(e.Json.decode(n.target.result.data)):e.is(s)&&s()},a.onerror=function(){i.printDuration(r,c),e.is(s)&&s()}},put:function(n,t,s,r){var a,c,l,u,d="indexedDB/put";a={pid:t,data:e.Json.encode(s)},c=e.is(s._attributes)?s._attributes:s,Object.prototype.hasOwnProperty.call(c,"isInstanceOf")?(a.isInstanceOf=c.isInstanceOf,Object.prototype.hasOwnProperty.call(c,"isAggregatedBy")&&(a.isAggregatedBy=c.isAggregatedBy)):Object.prototype.hasOwnProperty.call(c,"from")&&Object.prototype.hasOwnProperty.call(c,"to")?(a.from=c.from,a.to=c.to):Object.prototype.hasOwnProperty.call(c,"docID")&&Object.prototype.hasOwnProperty.call(c,"irpcID")&&(a.docID=c.docID,a.irpcID=c.irpcID),e.is(o._db)&&(u=i.printCurrentDateTime(d+" start - "),(l=o._db.transaction([n],"readwrite").objectStore(n).put(a)).onsuccess=function(){i.printDuration(u,d),e.is(r)&&r(s)},l.onerror=function(){i.printDuration(u,d)})},remove:function(n,t,s){var r,a,c="indexedDB/delete";o._db&&(r=i.printCurrentDateTime(c+" start - "),(a=o._db.transaction([n],"readwrite").objectStore(n).delete(t)).onsuccess=function(){i.printDuration(r,c),e.is(s,"function")&&s()},a.onerror=function(){i.printDuration(r,c)})},where:function(n,t,i,o,s){var r,a=this._db.transaction([n]).objectStore(n).index(t),c=[],l=!1;a.openCursor(IDBKeyRange.only(i)).onsuccess=function(n){var t=n.target.result;e.is(t)?(l=!0,c.push(n.target.result.value),t.continue()):l?e.is(o,"function")&&(r=c.map(function(e){return e.data}),o(r)):e.is(s,"function")&&s()}},getStoreName:function(e){var n="NONAME";return"DocumentConnectionModel"===e.name?n=o.documentsConnectionsStore:"Document"===e.get("type")?n=o.documentsStore:e.isReference()?n=o.referencesStore:e.isInstance()?n=o.instancesStore:e.isConnection()&&(n=o.connectionsStore),n},getModel:function(n,t,i){var s=o.getStoreName(n);e.is(s)?o.get(s,n.id,t,i):i()},storeModel:function(n,t){var i=o.getStoreName(n);e.is(n.get("attributesValue"))&&delete n._attributes.attributesValue,e.is(i)&&o.put(i,n.id,n,t)},removeModel:function(n,t){var i=o.getStoreName(n);e.is(i)&&o.remove(i,n.id,t)}});return o}),define("DS/DELPPWModelServices/CollectionUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWModelServices/ModelUtils","DS/DELPPWIRPCModel/Collections/ReferenceCollection","DS/DELPPWIRPCModel/Collections/InstanceCollection","DS/DELPPWIRPCModel/Collections/ConnectionCollection","DS/DELPPWDocumentModel/DocumentCollection","DS/DELPPWIRPCModel/Model/ReferenceModel","DS/DELPPWIRPCModel/Model/InstanceModel","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWLoggerModel/LoggerUtils","DS/PlatformAPI/PlatformAPI","DS/DELPPWModelServices/BehaviorUtil"],function(e,n,t,i,o,s,r,a,c,l,u,d,f,g){"use strict";var p=n.singleton({name:"CollectionUtils",options:{},pprTypes:{system:"SYSTEM",operation:"OPERATION",process:"PROCESS",resource:"RESOURCE",product:"PRODUCT",part:"PART"},ConnectionDir:{DIRECT:"direct",INVERSE:"inverse"},_init:function(n){var t={};this.options=n,e.is(n.dicoUtils)&&(t.dictionary=n.dicoUtils),this.references=new o([],t),this.instances=new s([],t),this.connections=new r([],t),this.documents=new a([],t),this.instances.referenceCollection=this.references,this.connections.referenceCollection=this.references,this.connections.instanceCollection=this.instances,e.is(n)&&e.is(n.useER,"boolean")&&this.useERObjects(n.useER)},init:function(e){e=e||{},this._parent(e),this._init(e)},reset:function(n){var t,i=n||{},o=!e.is(i.silent,"boolean")||i.silent;e.is(this.references)&&(t=this.references.reset({},{silent:o}),e.is(t)&&this.references.remove(t,{silent:o})),e.is(this.instances)&&(t=this.instances.reset({},{silent:o}),e.is(t)&&this.instances.remove(t,{silent:o})),e.is(this.connections)&&(t=this.connections.reset({},{silent:o}),e.is(t)&&this.connections.remove(t,{silent:o})),e.is(this.documents)&&(t=this.documents.reset({},{silent:o}),e.is(t)&&this.documents.remove(t,{silent:o}))},subscribeToModelChanges:function(e){var n=[];return n.push(this.references.subscribeToModelChanges(e)),n.push(this.connections.subscribeToModelChanges(e)),n.push(this.instances.subscribeToModelChanges(e)),n},unSubscribeToModelChanges:function(e){this.references.unSubscribeToModelChanges(e[0]),this.connections.unSubscribeToModelChanges(e[1]),this.instances.unSubscribeToModelChanges(e[2])},setReferenceCollectionEvents:function(e){this.references.addEvents(e)},setConnectionsCollectionEvents:function(e){this.connections.addEvents(e)},setInstanceCollectionEvents:function(e){this.instances.addEvents(e)},setDocumentCollectionEvents:function(e){this.documents.addEvents(e)},removeCollectionEvents:function(){this.references.removeEvents(),this.connections.removeEvents(),this.instances.removeEvents()},removeDocumentCollectionEvents:function(){this.documents.removeEvents()},updateModel:function(n,t){var i=this;(t=t||{}).onCompleteMsg=e.is(t.onCompleteMsg)?t.onCompleteMsg:"Updated Model succesfully",t.onFailureMsg=e.is(t.onFailureMsg)?t.onFailureMsg:"Updating Model failed",n.save(null,{proxy:"passport",headers:u.getHeaders(),data:e.Json.encode(t.data),onComplete:function(n,o){if(e.is(o.attributesValue)){let e=n.changedAttributes();Object.keys(n._attributes).forEach(function(e){!e.contains(".")||e in o.attributesValue||n.unset(e)}),n._changed=e}d.debug(i.name,t.onCompleteMsg+" : %s",JSON.stringify(n)),e.is(t.isFacet)&&t.isFacet&&f.publish("DS/PADUtils/PADCommandProxy/refresh",{data:{authored:{modified:[n.id]}}}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n,o)},onFailure:function(o,s){d.debug(i.name,t.onFailureMsg+" : %s",JSON.stringify(n)),e.is(t.onFailure,"function")&&t.onFailure.call(null,n,s)},wait:!0,parse:!0})},massUpdateModels:function(n,t,i){var o=this;(i=i||{}).onCompleteMsg=e.is(i.onCompleteMsg)?i.onCompleteMsg:"MassUpdate: Model has been updated successfully",i.onFailureMsg=e.is(i.onFailureMsg)?i.onFailureMsg:"MassUpdate has failed",(!e.is(i.data)||e.is(i.data)&&0===Object.keys(i.data).length)&&(d.debug(o.name,i.onFailureMsg+" as keyValues with pids have not been provided"),e.is(i.onFailure,"function"))?i.onFailure.call(null):u.webServiceRequest({url:"dsmfg/private/V0/MfgElement/"+n,method:"PUT",data:e.Json.encode(i.data),onComplete:function(t){var s={silentMode:!1,onComplete:function(){e.is(i.onComplete,"function")&&i.onComplete.call(null,t)}};e.is(t)&&("instance"===n?s.stackedInstances=t:s.stackedReferences=t,o.addToCollections(s))},onFailure:function(n,t){d.debug(o.name,i.onFailureMsg),e.is(i.onFailure,"function")&&i.onFailure.call(null,t)}})},fetch:function(n,t){var i,o,s,r=this;e.is(n)?(t=t||{},o=!!e.is(t.silent,"boolean")&&t.silent,s=!e.is(t.parse,"boolean")||t.parse,i={proxy:"passport",type:"json",headers:u.getHeaders(),onComplete:function(n,i,o){d.debug(r.name,"fetch completed: %o",i),e.is(t.onComplete,"function")&&t.onComplete.apply(null,[n,o])},onFailure:function(n,i,o){var s=e.is(i)?e.Json.isJson(i)?e.Json.decode(i):i:{};d.debug(r.name,"fetch failed with error: %o",s),e.is(t.onFailure,"function")&&t.onFailure.apply(null,[s,o])},onTimeout:function(n,i,o){var s=e.is(i)?e.Json.isJson(i)?e.Json.decode(i):i:{};d.debug(r.name,"fetch timed out with error: %o",s),e.is(t.onTimeout,"function")&&t.onTimeout.apply(null,[s,o])},parse:s,silent:o},n.fetch(i)):d.debug(r.name,"Invalid model object to fetch.")},createRef:function(n,t){var o,s=this,r=n||{},a=t||{},c=!!e.is(a.silent,"boolean")&&a.silent,l=u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return r.oneDelmiaAggregationMode=i.getOneDelmiaAggregationMode(),e.is(a.securityContextOverride,"string")&&(l.SecurityContext=a.securityContextOverride),o={proxy:"passport",headers:l,data:e.Json.encode(r),onComplete:function(n){e.is(a.onComplete,"function")&&a.onComplete.call(null,n)},onFailure:function(n,t){var i=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};d.debug(s.name,"Creation failed: %o",n),e.is(a.onFailure,"function")&&a.onFailure.call(null,n,i)},silent:c,wait:!0,parse:!0},this.references.create(null,o)},fetchReferences:function(n,t){var i,o,s,r,a=this;t=t||{},o=!e.is(t.silent,"boolean")||t.silent,s=!e.is(t.parse,"boolean")||t.parse,r=!!e.is(t.remove,"boolean")&&t.remove,i={data:n,proxy:"passport",headers:u.getHeaders(),onComplete:function(n,i,o){var s=[];d.debug(a.name,"fetch references completed: %o",i),e.is(i,"array")&&i.forEach(function(e){s.push(n.get(e.PID))}),e.is(t.onComplete,"function")&&t.onComplete.apply(null,[s,o])},onFailure:function(n,i,o){var s=e.is(i)?e.Json.isJson(i)?e.Json.decode(i):i:{};d.debug(a.name,"fetch references failed with error: %o",s),e.is(t.onFailure,"function")&&t.onFailure.apply(null,[s,o])},wait:!0,parse:s,silent:o,remove:r},a.references.fetch(i)},addRef:function(n,t){var i,o=t||{};return n&&(o=e.merge(o,{merge:!0,parse:!0}),i=p.references.add(n,o)),i},fetchRef:function(n,t){var i=this,o={dictionary:e.is(this.options)&&e.is(this.options.dicoUtils)?this.options.dicoUtils:null},s=new c(n,o);return s.fetch({proxy:"passport",headers:u.getHeaders(),onComplete:function(n){d.debug(i.name,"Fetch completed: %o",n),i.references.add(n,{silent:!!e.is(t.silent)&&t.silent,merge:!0}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n){d.debug(i.name,"Fetch failed: %o",n),e.is(t.onFailure,"function")&&t.onFailure.call(null,n)},wait:!0,parse:!0}),s},fetchRefList:function(n,t){var i,o,s=[],r=[],a=[],c=function(n){o=e.is(n.instances)?n.instances:n.references,s=o.map(function(e){return e.attributesValue}),i={onComplete:t.onComplete,onFailure:t.onFailure},e.is(n.instances)?i.stackedInstances=s:i.stackedReferences=s,p.addToCollections(i)},l=function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)};n.forEach(function(e){p.isInstance(e)?a.push(e):r.push(e)}),a.length>0&&(i={url:"dsmfg/private/V0/MfgElement/instance/getInstances",method:"POST",data:e.Json.encode(a),options:t,onComplete:c,onFailure:l},u.webServiceRequest(i)),r.length>0&&(i={url:"dsmfg/private/V0/MfgElement/reference/getReferences",method:"POST",data:e.Json.encode(r),options:t,onComplete:c,onFailure:l},u.webServiceRequest(i))},fetchInstancesAndTheirReferences:function(n,t){u.webServiceRequest({url:"dsmfg/private/V0/MfgElement/instance/getInstancesAndTheirReferences",method:"POST",data:e.Json.encode(n),onComplete:function(e){var n,i,o=function(e){return e.attributesValue};n=e.instances.map(o),i=e.references.map(o),p.addToCollections({stackedReferences:i,stackedInstances:n,onComplete:t.onComplete,onFailure:t.onFailure,silentMode:t.silentMode})},onFailure:function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)}})},updateRef:function(e,n){var t=p.references.get(e);(n=n||{}).onCompleteMsg="Updated Reference succesfully",n.onFailureMsg="Updating Reference failed",this.updateModel(t,n)},updateRefs:function(e,n){(n=n||{}).onCompleteMsg="MassUpdate: Reference has been updated successfully",n.onFailureMsg="MassUpdate of References has failed",this.massUpdateModels("reference",e,n)},deleteRef:function(n,t){var i,o=this,s=p.references.get(n);if(t=t||{},i=!!e.is(t.deep)&&t.deep,!e.is(s))return d.debug(this.name,"Refrence does not exists"),void(e.is(t.onFailure)&&t.onFailure());s.destroy({proxy:"passport",data:e.Json.encode({deep:i}),headers:u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(i,s){var r=e.is(s)?s:{};d.debug(o.name,"Deleting of Refrence failed: %s with error:",n,JSON.stringify(r)),e.is(t.onFailure)&&t.onFailure(i,r)},onComplete:function(s,r){var a,c,l,u=e.is(r)?r:{},f=e.is(u.deletedObjects)?u.deletedObjects:[];if(i&&e.is(f))for(c=0;c<f.length;c++)a=f[c],l=p.instances.get(a),e.is(l)&&p.instances.remove(a),l=p.references.get(a),e.is(l)&&p.references.remove(a);d.debug(o.name,"Deleting of Refrence completed: %s ",n),e.is(t.onComplete)&&t.onComplete(s,u)}})},removeRef:function(e,n){this.references.remove(e,n)},addInst:function(n,t){if(e.is(n))return e.is(t)||(t={}),t=e.merge(t,{merge:!0,parse:!0}),p.instances.add(n,t);d.debug(this.name,"refData is not defined")},createInst:function(n,t){var o,s=this,r=n||{},a=t||{},c=!!e.is(a.silent,"boolean")&&a.silent,l=u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return e.is(a.securityContextOverride,"string")&&(l.SecurityContext=a.securityContextOverride),r.oneDelmiaAggregationMode=i.getOneDelmiaAggregationMode(),o={proxy:"passport",headers:l,data:e.Json.encode(r),onComplete:function(n){p.manageLinearProductFlowsOnCreateInstance(n),e.is(a.onComplete,"function")&&a.onComplete.call(null,n)},onFailure:function(n,t){var i=e.is(t)?e.Json.isJson(t)?e.Json.decode(t):t:{};i=e.is(i.error)?i.error:i,d.debug(s.name,"Instance Creation failed: %o",n),e.is(a.onFailure,"function")&&a.onFailure.call(null,n,i)},wait:!0,parse:!0,silent:c},this.instances.create(null,o)},fetchInst:function(n,t){var i=this,o={dictionary:e.is(this.options)&&e.is(this.options.dicoUtils)?this.options.dicoUtils:null},s=new l(n,o);return e.is(t)||(t={}),s.fetch({proxy:"passport",headers:u.getHeaders(),onComplete:function(n){d.debug(i.name,"Fetch completed: %o",n),i.instances.add(n,{silent:!!e.is(t.silent)&&t.silent,merge:!0,parse:!0}),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n){d.debug(i.name,"Fetch failed: %o",n),e.is(t.onFailure,"function")&&t.onFailure.call(null,n)},wait:!0,parse:!0}),s},updateInst:function(e,n){var t=p.instances.get(e);(n=n||{}).onCompleteMsg="Updated Instance succesfully",n.onFailureMsg="Updating Instance failed",this.updateModel(t,n)},updateInsts:function(e,n){(n=n||{}).onCompleteMsg="MassUpdate: Instance has been updated successfully",n.onFailureMsg="MassUpdate of Instances has failed",this.massUpdateModels("instance",e,n)},deleteInst:function(n,t){var i=this,o=p.instances.get(n);if(t=t||{},!e.is(o))return d.debug(this.name,"Instance does not exists"),void(e.is(t.onFailure)&&t.onFailure());p.manageLinearProductFlowsOnDeleteInstance(o),o.destroy({proxy:"passport",headers:u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,s){var r=e.is(s)?e.Json.isJson(s)?e.Json.decode(s):s:{};d.debug(i.name,"Deleting of Instance failed: %s with error:",n,r),e.is(t.onFailure)&&t.onFailure(o,r.error)},onComplete:function(){d.debug(i.name,"Deleting of instance completed: %s ",n),e.is(t.onComplete)&&t.onComplete()}})},removeInstance:function(e,n){return this.instances.remove(e,n)},removeConnection:function(e,n){return this.connections.remove(e,n)},createConn:function(n,t){var i,o=this,s=u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0,minorVersion:"2.0"}),r=u.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml");return e.is(r,"string")&&(n.xmlLinkAuthoringConfig=r),e.is(t)||(t={}),e.is(t.securityContextOverride,"string")&&(s.SecurityContext=t.securityContextOverride,delete t.securityContextOverride),i=e.extend({proxy:"passport",headers:s,data:e.Json.encode(n),onComplete:function(n){d.debug(o.name,"Creation completed: %o",n),e.is(t.onComplete,"function")&&t.onComplete.call(null,n)},onFailure:function(n,i){var s;d.debug(o.name,"Creation failed: %o",n),e.is(i)&&e.is(i.message,"string")&&(s=i.message,d.debug(o.name,s)),e.is(t.onFailure,"function")&&t.onFailure.call(null,n,s)},wait:!0,parse:!0},t,!0),this.connections.create(null,i)},addConn:function(n,t){if(e.is(n))return e.is(t)||(t={}),t=e.merge(t,{merge:!0,parse:!0}),p.connections.add(n,t);d.debug(self.name,"connData is not defined")},updateConn:function(e,n){var t=p.connections.get(e);(n=n||{}).onCompleteMsg="Updated Connection succesfully",n.onFailureMsg="Updating Connection failed",this.updateModel(t,n)},updateConnectionsCache:function(e,n,t){this.connections.removeImpactInfo(e,t.oldPID),this.connections.removeImpactInfo(n.oldPID,t.oldPID),this.connections.addImpactInfo(e,t.newPID),this.connections.addImpactInfo(n.newPID,t.newPID)},deleteConn:function(n,t){var i=this,o=p.connections.get(n);if(t=t||{},!e.is(o))return d.debug(this.name,"Connection does not exists"),void(e.is(t.onFailure)&&t.onFailure());o.destroy({proxy:"passport",headers:u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,s){var r;d.debug(i.name,"Deleting of connection failed: %s ",n),e.is(s)&&e.is(s.message,"string")&&(r=s.message,d.debug(i.name,r)),e.is(t.onFailure)&&t.onFailure(o,s)},onComplete:function(o,s){var r;s&&(r=s.deletedConnections?s.deletedConnections:[],Array.isArray(r)&&r.length>0&&r.forEach(function(e){p.removeConnection(e)})),d.debug(i.name,"Deleting of connection completed: %s ",n),e.is(t.onComplete)&&t.onComplete(s)}})},addDocument:function(e){return this.documents.add(e)},getDocument:function(e){return this.documents.get(e)},removeDocument:function(e){return this.documents.remove(e)},getTypes:function(){return this.pprTypes},getInstancesFromCollection:function(e){return this.instances.getChildren(e)},getInstanceFromCollection:function(e){return this.instances.get(e)},isReference:function(n){return e.is(this.references.get(n))},isInstance:function(n){return e.is(this.instances.get(n))},getParentInstancesFromCollection:function(e){return this.instances.getInstancesForGivenReference(e)},getAllReferences:function(){return this.references.toArray()},getReferenceFromCollection:function(e){return this.references.get(e)},getReferencesArrayFromCollection:function(n){var t=[];return e.is(n,"array")&&n.forEach(function(n){var i=p.getReferenceFromCollection(n);e.is(i)&&t.push(i)}),t},getReferenceModel:function(n){var t,i=this.getReferenceFromCollection(n);return e.is(i)||(t=this.getInstanceFromCollection(n),e.is(t)&&(i=this.getReferenceModelFromInstance(t))),i},getConnectionFromCollection:function(e){return this.connections.get(e)},findSomeConnection:function(e,n){return this.connections.filter(e,n)},hasConnection:function(n){var t=!1,i=this.connections.findWhere(n);return e.is(i)&&(t=!0),t},findConnections:function(e){return this.connections.where(e)},findReferences:function(e){return this.references.where(e)},findInstances:function(e){return this.instances.where(e)},getReferenceModelFromInstance:function(e){var n=e.get("isInstanceOf");return this.references.get(n)},getAggregatingReferenceModelFromInstance:function(e){var n=e.get("isAggregatedBy");return this.references.get(n)},getImpactedConnections:function(n,t,i){var o=[];return i=i||{},i=e.merge(i,{from:!0,to:!0}),o=(o=(o=o.concat(this.connections.getImpactedConnections(n,i.fromXEN,i.relationTypes))).concat(this.connections.getImpactedConnections(t,i.fromXEN,i.relationTypes))).filter(function(t){var o,s=t.get("type"),r=(t.getAttribute("from"),!1);return o=function(e){r=!0,i.relationTypes?r=i.relationTypes.indexOf(e)>=0:(i.excludeRelationTypes&&(r=-1===i.excludeRelationTypes.indexOf(e)),i.excludeTimeConstraintType&&!0===i.excludeTimeConstraintType&&["DELLmiTimeConstraintCnx","DELLmiMaterialPathCnxCust","LinearProductFlowCnx"].indexOf(e)>-1&&(r=!1))},i.fromXEN?e.is(t.id)&&(3===t.id.split("|").length&&(s=t.id.split("|")[0]),t.get("from.attributesValue").PID===n&&o(s)):o(s),r})},needToQueryForConnections:function(n,t){var i,o=!1;return i=e.is(t,"string")?(i=n?n.get(t):this.getInstanceFromCollection(t))||this.getReferenceFromCollection(t):t,e.is(i)&&(i.getAdditionalInfo("queriedForConnections")||(o=!0)),o},_needToQueryForConnectionsByDir:function(n,t,i){var o,s,r=!1;switch(i){case this.ConnectionDir.DIRECT:s="directConnectionsFetched";break;case this.ConnectionDir.INVERSE:s="inverseConnectionsFetched";break;default:s="queriedForConnections"}return o=e.is(t,"string")?(o=n?n.get(t):this.getInstanceFromCollection(t))||this.getReferenceFromCollection(t):t,e.is(o)&&(o.getAdditionalInfo(s)||(r=!0)),r},needToQueryForDirectConnections:function(e,n){return this._needToQueryForConnectionsByDir(e,n,this.ConnectionDir.DIRECT)},needToQueryForInverseConnections:function(e,n){return this._needToQueryForConnectionsByDir(e,n,this.ConnectionDir.INVERSE)},needToQueryForChildren:function(n){var t=!1,i=e.is(n,"string")?this.references.get(n):n;return e.is(i)&&(i.getAdditionalInfo("queriedForChildren")||(t=!0)),t},refreshAll:function(n,i,o,s){var r,a,l=s||{},f=e.is(l.context)?l.context:null,g=i.concat(o,n),m=[],h=0,C=0;d.log(this.name,"refreshAll, Body roots PID: "+n),d.log(this.name,"refreshAll, Table roots PID: "+i),d.log(this.name,"refreshAll, Auxiliary view roots PID: "+o),new t(function(e){0!==g.length?g.forEach(function(n){var t,i=function(){h+C===g.length&&e()};(t=new c({PID:n})).fetch({proxy:"passport",type:"json",headers:u.getHeaders(),onComplete:function(e){h++,p.references.add(e),i()},onFailure:function(){C++,i()}}),m.push(t)}):e()}).then(function(){p.references.reset(m,{silent:!0}),r=p.instances.reset({},{silent:!0}),e.is(r)&&p.instances.remove(r,{silent:!0}),a=p.connections.reset({},{silent:!0}),e.is(a)&&p.connections.remove(a,{silent:!0}),e.is(l.onComplete,"function")&&l.onComplete.call(f,h,C)})},_removeDuplicate:function(n){return e.is(n,"array")&&(n.sort(),n=n.filter(function(e,n,t){return!n||e!==t[n-1]})),n},expandOnBackbone:function n(t,i){var o=p.getInstancesFromCollection(t),s=[];e.is(o,"array")&&e.is(i)&&o.forEach(function(n){var t=n.get("isInstanceOf");e.is(i.referencesPID,"array")&&-1===i.referencesPID.indexOf(t)&&i.referencesPID.push(t),e.is(i.instancesPID,"array")&&-1===i.instancesPID.indexOf(n.id)&&i.instancesPID.push(n.id),-1===s.indexOf(t)&&s.push(t)}),s.forEach(function(e){n(e,i)})},addToCollections:function(n){var t,o=n||{},s={instancesAndReferences:[],connections:[],documents:e.is(o.documentIdMap)?o.documentIdMap:{}},r=o.stackedReferences?o.stackedReferences:[],a=o.stackedInstances?o.stackedInstances:[],c=o.stackedConnections?o.stackedConnections:[],l=o.deletedObjects?o.deletedObjects:[],u=o.deletedConnections?o.deletedConnections:[],d=o.references?o.references:p.references,f=o.instances?o.instances:p.instances,g=o.connections?o.connections:p.connections,m=e.is(o.onComplete,"function")?o.onComplete:null,h=e.is(o.onFailure,"function")?o.onFailure:null,C=e.is(o.onTimeout,"function")?o.onTimeout:null,y=!e.is(o.silentMode,"boolean")||o.silentMode,I=e.is(o.context)?o.context:this,b=function(e,n){var t=d.add(e,{silent:y,merge:!0,parse:!0});s.instancesAndReferences.push.apply(s.instancesAndReferences,t),n()},v=function(n,t){n.forEach(function(n){var t,i=n.attributesValue||n;(function n(t,i){var o,s,r;if(i===t)return!0;if(r=p.getReferenceFromCollection(i),e.is(r))for(o=p.getParentInstancesFromCollection(r.get("PID")),s=0;s<o.length;s++)if(n(t,o[s].get("isAggregatedBy")))return!0;return!1})(i.isInstanceOf,i.isAggregatedBy)||(t=f.add(n,{silent:y,merge:!0,parse:!0}),s.instancesAndReferences.push(t))}),t()},D=function(n,t){var i;n.forEach(function(n){i=p.getInstanceFromCollection(n),e.is(i)&&p.removeInstance(n,{silent:y})}),t()},P=function(n,t){var i;n.forEach(function(n){i=p.getConnectionFromCollection(n),e.is(i)&&p.removeConnection(n)}),t()},M=function(){e.is(m,"function")?m.call(I,s):e.is(h,"function")?h.call(I):e.is(C,"function")&&C.call(I)};(t={callback:function(e,n){var t=g.add(e,{silent:y,merge:!0,parse:!0});s.connections.push.apply(s.connections,t),n()},globalArray:c,context:g},i.getExecuteByBlockPromise(t)).then(function(){var e;(e={callback:b,globalArray:r,context:d},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:v,globalArray:a,context:f},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:D,globalArray:l,context:f},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:P,globalArray:u,context:g},i.getExecuteByBlockPromise(e)).then(M)})})})})},getFilteredInstancesFromCollection:function(n,t){var i;return i=this.getInstancesFromCollection(n),e.is(t)&&(t=(t=JSON.stringify(t)).replace(/physicalid:\\"([A-Z]|[0-9])+\\"/g,""),i=i.filter(function(n){var i=!1,o=n.getAdditionalInfo("filterQuery");return e.is(o)&&(i=(o=(o=JSON.stringify(o)).replace(/physicalid:\\"([A-Z]|[0-9])+\\"/g,""))===t),i})),i},traverseInstanceModels:function(n,t){var i,o,s=function(e,n){p.getInstancesFromCollection(e).forEach(function(e){n.push(e)})};if(e.is(t,"function"))for(s(n,i=[]);i.length>0;)t(o=i.pop()),s(o.get("isInstanceOf"),i);else d.log(this.name,"callback cbProcessModel not provided")},removeFilterFromCollection:function(n){p.traverseInstanceModels(n,function(n){var t=n.getAdditionalInfo("filterQuery");e.is(t)&&n.setAdditionalInfo({filterQuery:null})})},transformToRIROccurrencePath:function(n){var t,i,o=[],s=[];return Array.isArray(n)?(o=n).length>0&&(i=p.getInstanceFromCollection(o[0]),e.is(i)&&(t=i.get("isAggregatedBy"))):t=n,s=e.is(t)?[t]:[],o.forEach(function(n){s.push(n),i=p.getInstanceFromCollection(n),e.is(i)&&s.push(i.get("isInstanceOf"))}),s},transformRIRToAbsolutePath:function(e){var n,t=[];for(n=0;n<e.length;n++)n%2==1&&t.push(e[n].resourceid);return t},syncChangeRequired:function(n,t,i,o){var s=[];n.forEach(function(e){s.push("pid:"+e.id)}),u.webServiceRequest({url:"modeler/change/changecontrol",method:"PUT",headers:t,context:this,data:e.Json.encode({ObjectsListForSetChangeControl:s}),onComplete:function(e){i(e)},onFailure:function(){o()}})},syncMaturity:function(n,i,o,s,r){var a=[];n.forEach(function(e){a.push({id:e.id,identifier:e.id,type:e.get("type"),source:"3DSpace",relativePath:"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+e.id,nextState:"RELEASED"})}),u.webServiceRequest({url:"v1/modeler/dslc/maturity/changeState",method:"POST",headers:i,context:this,data:e.Json.encode({data:a}),onComplete:function(e){o&&g.isChangeRequiredSyncronizationEnabled()?new t(function(e,t){p.syncChangeRequired(n,i,e,t)}).then(function(){s(e)}):s(e)},onFailure:function(){r()}})},getCurrentStates:function(n,t,i){const o=n.map(e=>({physicalid:e}));u.webServiceRequest({url:"lifecycle/maturity/state",method:"POST",headers:t,context:this,data:e.Json.encode({data:o}),onComplete:function(n){var t=new Map;e.is(n)&&e.is(n.data,"array")?(n.data.forEach(function(e){t.set(e.physicalid,e.current)}),i(t)):i(null)},onFailure:function(){i(null)},onTimeout:function(){i(null)}})},getSequencingMode:function(n,t){var i=p.getSequencingModeAttrName(n);u.webServiceRequest({url:"dsmfg/private/V0/invoke/getSequencingMode?pid="+n,method:"GET",context:this,onComplete:function(o){var s;if(e.is(o)&&e.is(o,"object")&&e.is(o[i],"string")){let r=o[i];s=p.references.get(n),e.is(s)&&s.set(i,r),e.is(t.onComplete,"function")&&t.onComplete(r)}else e.is(t.onFailure,"function")&&t.onFailure()},onFailure:function(){e.is(t.onFailure,"function")&&t.onFailure()},onTimeout:function(){e.is(t.onTimeout,"function")&&t.onTimeout()}})},setOOTBRole:function(n,t,i){u.webServiceRequest({url:"dsmfg/private/V0/invoke/setOOTBRole",method:"PUT",data:e.Json.encode({pid:n,role:t}),context:this,onComplete:function(){e.is(i.onComplete,"function")&&i.onComplete()},onFailure:function(){e.is(i.onFailure,"function")&&i.onFailure()}})},setSequencingMode:function(n,t,i){var o=p.getSequencingModeAttrName(n);u.webServiceRequest({url:"dsmfg/private/V0/invoke/setSequencingMode",method:"PUT",data:e.Json.encode({pid:n,mode:t}),context:this,onComplete:function(){var s,r,a,c,l,u;if(s=p.references.get(n),e.is(s)&&s.set(o,t),r=p.getInstancesFromCollection(n),(a=r.map(function(e){return e.get("PID")})).length>0)if("Linear"===t)for(c of(p.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&a.includes(e.getAttribute("from"))}).forEach(function(e){p.removeConnection(e.get("PID"))}),p.sortInstancesByTreeOrder(r),r.map(function(e){return e.get("PID")})))e.is(u)?(l=u,u=c,p.addLinearProductFlow(l,u)):u=c;else p.findSomeConnection(function(e){return"LinearProductFlowCnx"===e.get("type")&&a.includes(e.getAttribute("from"))}).forEach(function(e){p.removeConnection(e.get("PID"))});e.is(i.onComplete,"function")&&i.onComplete()},onFailure:function(){e.is(i.onFailure,"function")&&i.onFailure()},onTimeout:function(){e.is(i.onTimeout,"function")&&i.onTimeout()}})},getLinearProductFlowPID:function(e,n){return"LinearProductFlowCnx|"+e+"|"+n},getLinearProductFlowFromCollection:function(e,n){return p.getConnectionFromCollection(p.getLinearProductFlowPID(e,n))},addLinearProductFlow:function(e,n){p.addConn({PID:p.getLinearProductFlowPID(e,n),from:[e],to:[n],type:"LinearProductFlowCnx"})},removeLinearProductFlow:function(e,n){p.removeConnection(p.getLinearProductFlowPID(e,n))},sortInstancesByTreeOrder:function(n){n.sort(function(n,t){var i=n.get("V_TreeOrder"),o=t.get("V_TreeOrder");return(e.is(i)?i:0)-(e.is(o)?o:0)})},getSequencingModeAttrName:function(n){var t,i=e.is(n)?p.references.get(n):null;if(e.is(i)){const e=i.keys(),n=["DELLmiPPRSystemReference","DELLmiHeaderOperationReference","DELLmiGeneralOperationReference","DELLmiPPRHeaderProcessReferenceAbstract"];for(let i=0;i<n.length;i++){const o=n[i]+".V_SequencingMode";if(e.indexOf(o)>=0){t=o;break}}return t}},manageLinearProductFlowsOnCreateInstance:function(n){var t,i,o,s,r,a,c,l,u=n.get("isAggregatedBy"),d=p.references.get(u),f=p.getSequencingModeAttrName(u);e.is(d)&&e.is(f)&&(l=d.get(f)),"Linear"===l&&(t=p.getInstancesFromCollection(u),p.sortInstancesByTreeOrder(t),i=n.get("PID"),a=(o=t.findIndex(function(e){return e.get("PID")===i}))>0,c=o<t.length-1,a&&(s=t[o-1].get("PID"),r=i,p.addLinearProductFlow(s,r)),c&&(s=i,r=t[o+1].get("PID"),p.addLinearProductFlow(s,r)),a&&c&&(s=t[o-1].get("PID"),r=t[o+1].get("PID"),p.removeLinearProductFlow(s,r)),p.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&(e.getAttribute("from")===i||e.getAttribute("to")===i)}).forEach(function(e){p.removeConnection(e.get("PID"))}))},manageLinearProductFlowsOnDeleteInstance:function(e){var n,t,i,o,s,r,a,c=e.get("isAggregatedBy"),l=p.references.get(c),u=p.getSequencingModeAttrName(c);"Linear"===l.get(u)&&(n=p.getInstancesFromCollection(c),p.sortInstancesByTreeOrder(n),t=e.get("PID"),r=(i=n.findIndex(function(e){return e.get("PID")===t}))>0,a=i<n.length-1,r&&(o=n[i-1].get("PID"),s=t,p.removeLinearProductFlow(o,s)),a&&(o=t,s=n[i+1].get("PID"),p.removeLinearProductFlow(o,s)),r&&a&&(o=n[i-1].get("PID"),s=n[i+1].get("PID"),p.addLinearProductFlow(o,s)))},detachExtn:function(n,t){var i,o,s=t.mdlType,r={url:"dsmfg/private/V0/MfgElement/"+t.mdlType+"/detachExtn/"+n,method:"PUT",context:this,data:e.Json.encode(t.data),onComplete:function(r){switch(s){case"instance":i=p.instances.get(n);break;case"reference":i=p.references.get(n);break;case"connection":i=p.connections.get(n);break;default:i=null}i&&(t.data.forEach(e=>{e in r.attributesValue||(o=i.unset(e))}),o&&e.is(t.onComplete,"function")&&t.onComplete())},onFailure:function(){e.is(t.onFailure,"function")&&t.onFailure()}};r=e.merge(r,t),u.webServiceRequest(r)}});return p}),define("DS/DELPPWModelServices/EGraphUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWGraphModel/GraphCollection"],function(e,n,t,i){"use strict";const o=[{img:"ProcessImplementLink",linkType:"scope",displayed:!0},{img:"PartialProcessImplementLink",linkType:"partialscopeOnHeaderOperation",displayed:!0},{img:"ProcessImplementLinkOcc",linkType:"implement",displayed:!0},{img:"DELLmiProductionSystemOutputCnxToMBOM",linkType:"output",displayed:!0},{img:"MfgProcessAlternate",linkType:"alternate",displayed:!0},{img:"HistorizationLinkRefRef",linkType:"origin",displayed:!0},{img:"DELAsmProcessCanUseCnx",linkType:"capableResources",displayed:!0},{img:"SecondaryCandidateResourceLink",linkType:"secondaryCapableResources",displayed:!0},{img:"DELLmiTimeConstraintCnx",linkType:"productFlow",displayed:!0},{img:"CapableResourcesStructureLink",linkType:"capableResourcesStructure",displayed:!0},{img:"DELAssetsStructureLink",linkType:"capableResourceAssetStructure",displayed:!0}],s=[{name:"scope",typeAssociated:"ProductImplementLink"},{name:"scope",typeAssociated:"ProcessImplementLink"},{name:"partialscopeOnHeaderOperation",typeAssociated:"PartialProcessImplementLink"},{name:"implement",typeAssociated:"ProcessImplementLinkOcc"},{name:"origin",typeAssociated:"HistorizationLinkRefRef"},{name:"alternate",typeAssociated:"MfgProcessAlternate"},{name:"output",typeAssociated:"DELLmiProductionSystemOutputCnxToMBOM"},{name:"capableResources",typeAssociated:"DELAsmProcessCanUseCnx"},{name:"secondaryCapableResources",typeAssociated:"SecondaryCandidateResourceLink"},{name:"productFlow",typeAssociated:"DELLmiTimeConstraintCnx"},{name:"productFlow",typeAssociated:"DELLmiMaterialPathCnxCust"},{name:"productFlow",typeAssociated:"LinearProductFlowCnx"},{name:"capableResourcesStructure",typeAssociated:"CapableResourcesStructureLink"},{name:"capableResourceAssetStructure",typeAssociated:"DELAssetsStructureLink"}];var r=function(e,n){var t={PID:"",links:[],childOccurencePath:"",index:0};return t.PID=e.get("isInstanceOf"),t.instancePID=e.get("PID"),t.childOccurencePath=n.concat([e.get("PID")]).toString(),t};return n.singleton({name:"EGraphUtils",init:function(e){e=e||{},this._parent(e)},setup:function(n){var t;t=(n=n||{}).supportedLinks||[],this.linkTypeName=new e.Class.Collection([],{}),s.forEach(e=>{t.includes(e.typeAssociated)&&this.linkTypeName.add(e)}),this.creatableTypesOfLink=new e.Class.Collection([],{}),o.forEach(e=>{t.includes(e.img)&&this.creatableTypesOfLink.add(e)})},addInstances:function(n,i,o,s,r){var a,c,l,u,d=null,f=null,g=0,p=null,m=null,h=null,C=null;if(e.is(i)){if(d=i,f=i,g=n.findWhere({referencePID:i.get("PID")}).get("X")+1,e.is(i.id))for(C=t.getInstancesFromCollection(i.id),t.sortInstancesByTreeOrder(C),u=C.length-1;u>=0;u--)l=C[u],h=t.getReferenceModelFromInstance(l),e.is(h)&&-1!==this.getType(h.get("PPRTYPE"))&&(a=e.is(r)?r+","+l.id:l.id,s.unshift([h,g,d.id,a,l.id]));e.is(s[0],"array")&&s[0].length>=5&&(e.is(s[0][0])&&(p=e.is(s[0][0].id)?s[0][0].id:null,m=s[0][3]),n.add({PID:m,X:s[0][1],Type:o,isAggregatedBy:s[0][2],childOccurencePath:s[0][3],instancePID:s[0][4],referencePID:p,LINKS:this.getReferenceReferenceLinks(p)}),f=s[0][0],c=s[0][3],s.shift(),this.addInstances(n,f,o,s,c))}},getInstanceInstanceLink:function(n){var i,o,s,r,a,c,l,u,d,f,g=[],p=this;Array.prototype.push.apply(g,t.connections.where({type:"ProcessImplementLinkOcc"})),Array.prototype.push.apply(g,t.connections.where({type:"DELLmiMaterialPathCnxCust"})),Array.prototype.push.apply(g,t.connections.where({type:"DELLmiTimeConstraintCnx"})),Array.prototype.push.apply(g,t.connections.where({type:"LinearProductFlowCnx"})),Array.prototype.push.apply(g,t.connections.where({type:"DEFAULT"})),g.forEach(function(g){if(i=g.get("from").toString(),o=g.get("to").toString(),"DELLmiTimeConstraintCnx"===g.get("type")||"LinearProductFlowCnx"===g.get("type")||"DELLmiMaterialPathCnxCust"===g.get("type"))for(s=n.filter(function(e){return(u=e.get("PID")).length-u.indexOf(i)-i.length==0}),a=n.filter(function(e){return(u=e.get("PID")).length-u.indexOf(o)-o.length==0}),l=new e.Class.Collection([],{}),d=0;d<s.length;d++)for(r=s[d].get("PID").split(",")[0],r=t.getInstanceFromCollection(r),f=0;f<a.length;f++)c=a[f].get("PID").split(",")[0],c=t.getInstanceFromCollection(c),r.get("isAggregatedBy")===c.get("isAggregatedBy")&&(l.add({PID:g.get("PID"),from:s[d].get("PID"),to:a[f].get("PID"),type:g.get("type")}),l.add(s[d].get("LINKS")._models),p.isConnectionTypeAllowed(l._models[0]._attributes.type)&&s[d].set({LINKS:l}));else s=n.filter(function(e){return e.id.contains(i)}),a=n.filter(function(e){return e.id.contains(o)}),s.length>0&&a.length>0&&((l=new e.Class.Collection([],{})).add({PID:g.get("PID"),from:i,to:o,type:g.get("type")}),l.add(s[0].get("LINKS")._models),p.isConnectionTypeAllowed(l._models[0]._attributes.type)&&s[0].set({LINKS:l}))})},getReferenceReferenceLinks:function(n){var i,o,s=new e.Class.Collection([],{}),r=t.connections.where({from:n});for(i=0;i<r.length;i++)"DELAsmProcessCanUseCnx"===(o=r[i]).get("type")&&t.connections.where({from:o.get("PID")}).forEach(function(e){(e=e.clone()).set("from",n),r.push(e)}),this.isConnectionTypeAllowed(o.get("type"))&&t.references.where({PID:o.get("to")}).length>0&&s.add(o);return s},getType:function(e){switch(e){case"PRODUCT":return 0;case"PROCESS":case"SERVICE":case"CONSTRUCTION":return 1;case"SYSTEM":case"OPERATION":return 2;case"RESOURCE":return 3;default:return-1}},isConnectionTypeAllowed:function(n){var t,i;return(i=this.linkTypeName.findWhere({typeAssociated:n}))&&(t=this.creatableTypesOfLink.findWhere({linkType:i._attributes.name})),!!e.is(t)&&t._attributes.displayed},setLinkDisplayStatus:function(e,n){this.creatableTypesOfLink.findWhere({linkType:e}).set("displayed",n)},getCreatableTypesOfLink:function(){return this.creatableTypesOfLink},getEGraphData:function(e){var n,o,s=new i,r=[],a=this;return e.forEach(function(e){n=t.getReferenceFromCollection(e),o=a.getType(n.get("PPRTYPE")),s.add({PID:n.id,X:0,Type:o,isAggregatedBy:null,referencePID:n.id,LINKS:a.getReferenceReferenceLinks(n.id)}),a.addInstances(s,n,o,r)}),this.getInstanceInstanceLink(s),s},getProductFlowData:function(n,i){var o,s,a=t.references,c=t.connections,l=t.instances.where({isAggregatedBy:n}),u=new e.Class.Collection([],{}),d=this;return l.forEach(function(n){var t=a.findWhere({PID:n.get("isInstanceOf")}).get("PPRTYPE");t=e.is(t)?t:"",2===d.getType(t)&&(s=r(n,i),c.filter(function(e){var t=e.get("from");return t[t.length-1]===n.get("PID")}).forEach(function(n){o=l.find(function(e){var t=n.get("to");return t[t.length-1]===e.get("PID")}),e.is(o)&&a.where({PID:o.get("isInstanceOf")}).forEach(function(e){s.links.push([e.get("PID"),n])})}),u.push(s))}),u},isProductFlowLooped:function(n){var t,i,o,s,r,a,c=[],l=new e.Class.Collection([],{}),u=new e.Class.Collection([],{}),d=0;for(i=function(e){return e.get("links").length>0},t=n.filter(i),c=t;c.length>0;)s=o,o=c[0],l.add(o),o.get("links").forEach(function(t){a=l.findWhere({PID:t[0]}),e.is(a)||(r=n.findWhere({PID:t[0]}),e.is(r)&&r.set({index:o.get("index")+1})),u.add({from:o.get("PID"),to:t[0]}),u.where({from:o.get("PID"),to:t[0]}).length>5*n.length?(u.reset(),e.is(s)&&s.set({loopNode:!0}),d++):e.is(a)&&c.splice(1,0,n.findWhere({PID:t[0]}))}),c.shift();return d},getProductFlowGraphInstance:function(e,n){return r(e,n)}})});