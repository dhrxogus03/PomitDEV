/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/ENXNav/models/AdditionalRelDummyInfo",[],function(){function e(e,t){-1===e.indexOf(t)&&e.push(t)}function t(e){switch(e){case"hasDO":case"hasSync":return"NA";default:return" "}}function o(e){this.options=e,this._relationNodes=[],this._otherKeys=[]}return o.prototype={addRelationNode:function(e){this._relationNodes.push(e)},addOtherKeys:function(t){for(let o=0;o<t.length;o++)e(this._otherKeys,t[o])},applyMerger:function(o){if(this._relationNodes.length){let n=[],i=Object.keys(o.pids),s=Object.keys(o.relids);for(let t=0;t<i.length;t++){let s=Object.keys(o.pids[i[t]]);for(let t=0;t<s.length;t++)e(n,s[t])}for(let t=0;t<s.length;t++){let i=Object.keys(o.relids[s[t]]);for(let t=0;t<i.length;t++)e(n,i[t])}for(let t=0;t<this._otherKeys.length;t++)e(n,this._otherKeys[t]);let r={grid:{}};for(let e=0;e<n.length;e++){let o=n[e],i=t(o);r.grid[o]=i}for(let e=0;e<this._relationNodes.length;e++){this._relationNodes[e].updateOptions(r)}}}},o}),define("DS/ENXNav/models/Algos",[],function(){return{extractGridChanges:function(e,t){var o={grid:{}},n=!1;let i=[];for(var s=Object.keys(e.grid),r=0;r<s.length;r++){var a=s[r];i.push(a);var l=e.grid[a];l!==t.grid[a]&&(n=!0),o.grid[a]=l}return{updatedProps:i,hasChanged:n,finalResults:o}}}}),define("DS/ENXNav/mixins/xNavChangeActionV2",["UWA/Class","DS/PADUtils/views/PADAlert","DS/PADUtils/PADChangeActionHandler","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalModelEvents","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,n,i,s){return e.extend({loadChangeV2:function(e){var t=this;t.beginBlockingTransaction(s.retrieveChangeAction);this.getPADTreeDocument().getRoots();var i=e.objects.map(function(e){return e.objectId});o.getInfos(i,function(o){t.beginBlockingTransaction(s.loadChangeAction);var i=-1,r=function(){if(++i<o.length){var s=o[i];t._processCAV2(s,r)}else{t.endBlockingTransaction(),t._checkIfEmptyV2(),e.callback&&e.callback();var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!0===n.getSetting("changeControlDlgOpen")?(t._commandProxy.changeControlDlgOpen({isOpen:!1,widget:"2D"}),UWA.is(a.setFromDrop,"function")&&a.setFromDrop(o,function(){console.log("Change set on Singleton from 2D")})):n.setSetting("changeControlDlgOpen",!0)}};r()},function(e){t.endBlockingTransaction(),t._checkIfEmptyV2()})},_checkIfEmptyV2:function(){0===this.options.model.getRoots().length&&this.dispatchEvent("onEmptyView")},_processCAV2:function(e,n){var i=this;o.determineExecution(e,{addAndFind:function(e){var r=o.extractIds(e.changeaction.context),a=o.extractRealizedAndProposed(e),l=i.getPADTreeDocument().getRoots(),d=l.map(function(e){return e.getID()});l.length&&i.dropInvitContainer.hide(i.dropInvitContainer.active_invite);var c=r.filter(function(e){return-1===d.indexOf(e)});c.length!==r.length&&(t.displayNotification({msg:s.root_already_loaded}),0===c.length&&n&&n()),c.length>0&&i.performCAFindInContextV2({rootIds:c,findIds:a},n)},add:function(e){var o=n||void 0,r=i.getPADTreeDocument().getRoots(),a=r.map(function(e){return e.getID()});r.length&&i.dropInvitContainer.hide(i.dropInvitContainer.active_invite);var l=e.filter(function(e){return-1===a.indexOf(e)});0===l.length?(t.displayNotification({msg:s.root_already_loaded}),n&&n()):i.add({content:"idslist",pids:l,callback:o})},wasEmpty:function(){i.dropInvitContainer.options.active_invite&&i.dropInvitContainer.hide(),n&&n()}})},performCAFindInContextV2:function(e,o){var n=this,r=e.rootIds,a=e.findIds;n.getPADTreeDocument();let l="";for(let e=0;e<a.length;e++)e>0&&(l+=" OR "),l+="physicalid:"+a[e];new Promise(function(e,t){n.add({content:"idslist",pids:r,broadcast:!1,callback:function(){e()}})}).then(function(){for(var e=[],a=0;a<r.length;a++){var d=new Promise(function(e,t){let o=r[a],s=n.options.model.getNodesById(o);i.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:s,searchFts:l,searchFtsOriginal:l,noPager:!0,doNotBroacast:!0}}),i.getModelEvents().subscribeOnce({event:"ENXViews/Model/FindInCtx/complete"},function(o){o.foundNodes&&0===o.foundNodes.length&&t(),e(o)})});e.push(d),d.then(function(e){if(0===e.foundNodes.length){t.displayNotification({msg:s.find_in_context_no_result,eventID:"info"});var o=require("DS/PADUtils/PADUtilsServices"),i={pids:[rootId],tenant:o.getPlatformId()};n._commandProxy.drop(i)}}).catch(function(e){console.error(e)})}Promise.all(e).then(function(){o&&o()}).catch(function(e){o&&o()})})}})}),define("DS/ENXNav/commands/view/_xNavCollapseAll",[],function(){"use strict";return{execute:function(e){require(["DS/Utilities/Data"],function(t){var o=e.model,n=o.getSelectedNodes();o.prepareUpdate(),t.forEach(n,function(e){e.hasChildren()&&e.collapseAll()},10,function(){o.pushUpdate()})})}}}),define("DS/ENXNav/commands/view/xNavRightSidePanel",["DS/PADUtils/commands/RightSidePanel","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o){"use strict";return e.extend({getXSO:function(){return t.get().options.model.getXSO()},getID:function(e){return e.getID()},getTriptych:function(){return t.get().elements.padshell},onTriptychReady:function(e){var n=o.subscribe({event:"on2DTriptychReady"},function(i){e.call(t.get().elements.padshell),o.unsubscribe(n)})},isNodeValid:function(e){return!0!==e.isGroupingNode&&!1===e.isSupplemental()}})}),define("DS/ENXNav/commands/ExpandAllGroups",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/ExpandAllGroups",data:{}})}})}),define("DS/ENXNav/views/xNavGraphView",["css!DS/ENXNav/ENXNav","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/etree/syncwidget","css!egraph/views","css!etree/syncviews","css!DS/etree/overviewui.css"],function(e,t,o,n,i,s,r,a){"use strict";return o.extend(n,i,{_treegraph:null,defaultOptions:{fittingArea:{paddingLeft:15,paddingRight:0,paddingTop:0,paddingBottom:80},layout:s.LayoutMode.LAYERED,viewport:null},init:function(e){this._parent(e),this._buildSkeleton(),this.getOption("renderTo")&&!0===e.isActiveView&&this.render().inject(this.getOption("renderTo"))},getThumbnailState:function(e){return this._treegraph.getThumbnailState(e)},setGroupThumbnailState:function(e){for(var t=e.expanded?s.ThumbnailState.COLLAPSED:s.ThumbnailState.EXPANDED,o=0;o<e.nodes.length;o++){var n=e.nodes[o];this._treegraph.setThumbnailState(n,t)}},setAllThumbnailsState:function(e){this._treegraph.setAllThumbnailsState(e)},getContainer:function(){return this.elements.container},render:function(){return this},setModel:function(e){this.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this._treegraph.setSize(),this._treegraph.setModel(e),null!==e.options.viewport.graph&&void 0!==e.options.viewport.graph&&this._treegraph.setViewport(e.options.viewport.graph)},unsetModel:function(){var e=this._treegraph.getModel();e&&(e.options.viewport.graph=this._treegraph.getViewport()),this.options.isActiveView=!1,this._treegraph.setModel(null),this.getOption("renderTo").removeChild(this.elements.container)},setSize:function(){this._treegraph.setSize()},reframeOn:function(){this._treegraph.reframeOn()},reframeAll:function(){this._treegraph.reframeAll()},toggleOverview:function(){this._treegraph.swapOverviewVisibility()},toggleLayout:function(e){switch(e){case"LayoutRight":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_LEFT);break;case"LayoutDown":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_TOP);break;case"LayoutLeft":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_RIGHT);break;case"LayoutUp":this._treegraph.setRootPosition(s.OrientationMode.ROOT_ON_BOTTOM);break;default:this._treegraph.swapLayoutOrientation()}},_buildSkeleton:function(){t.is(this.elements.container)||(this.elements.container=UWA.createElement("div",{class:"xnav_graph"}),this._treegraph=new s.SyncEGraphTree(this.elements.container,this.options),this._treegraph.createOverview(),this._treegraph.setAutogroups&&this._treegraph.setAutogroups(!0),this._treegraph.setFittingArea(this.options.fittingArea),UWA.is(this._treegraph.setHTML5DnD,"function")&&(this._treegraph.setHTML5DnD(!0),this._treegraph.setMultiSelectionDrag(!0)))},updateView:function(){this._treegraph.updateUnlock()}})}),define("DS/ENXNav/mixins/_xNavBIFilter",["i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Class","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession","DS/PADUtils/views/PADAlert","DS/Utilities/Utils","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/settings/AppSettings","DS/PADUtils/Utility","DS/ENOXParser/modules/ColorMapParser","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/utilsWS/CVServletServices","DS/ENOXParser/modules/TwoDParser","DS/PADServices/utils/Batches","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/private/TreeDocUpdate","DS/PADServices/utils/PromiseHook","DS/ENOXInterWdgCom/LinkManager","DS/PADServices/utils/PConfigUtils","DS/PADServices/utils/GlobalUtils"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f,v,m,b,_,D,S,x,y){"use strict";const N="rgba(255, 255, 255, 0.3)",C={colorInstance:N},P={};function w(e,t,o,n){let i=e.get(t);i?(i.nodes.push(o),e.set(t,i)):(i={nodes:[o],isByResId:n},e.set(t,i))}return s.softInit(),o.extend({_biFilter:null,_biSlave3D:!0,_id2removeFromFilterProxy:[],_filterAlreadyTreatedRoot:[],_isRootAddedFromFilter:!1,initializeBI:function(){var e=this;n.addEvent("onX3dPlatformId",function(e){this._biFilter&&this._biFilter.updateTenant(e)}.bind(this)),n.addEvent("onPad_security_ctx",function(e){this._biFilter&&this._biFilter.setDefaultSecurityContext&&this._biFilter.setDefaultSecurityContext(e)}.bind(this)),this._createProxy(),g.subscribe({event:"__removePConfigSupportInAuthForMultiRoot"},this.removeNGFilter.bind(this)),s.subscribe({event:"authoringStateModified"},function(t){if(e._biFilter&&!0===t.authored&&e.options.model.getRoots().length){var o=[],s=[],r=[],a=e.options.model.getRoots();if(x.keepFilterForRoot(a))a=e.removeFilterIdsForPConf(a);for(let t=0;t<a.length;t++){a[t].keepFilterBadge=!1;let n=e.HasFilter(a[t].getID());n&&!0===n.hasFilter&&!1===a[t].options.isReadOnly&&(o.push(a[t].getID()),a[t].options.filtered=!0),n&&!0===n.hasFilter&&!0===a[t].options.isReadOnly&&(a[t].keepFilterBadge=!0),n&&!1===n.hasFilter&&s.push(a[t].getID()),r.push(a[t].getID())}if(n.getSetting("resetFiltersOnIndexModeSwitch")||(e._biFilter.resetNGFilterUI({widgetId:i.getWidgetId(),NGFUXId:e.getNGFUXID(),appId:i.getAppId(),rootIds:o}),e.removeNGFilter(o),e._biFilter.removeRoots(r)),n.getSetting("resetFiltersOnIndexModeSwitch")){for(let t=0;t<o.length;t++)e.xNavPersistFilterSpec.filterSpec.has(o[t])?e.xNavPersistFilterSpec.validFilterIdCopy.push(o[t]):e.xNavPersistFilterSpec.unresolvedSpec.push(o[t]),o.length-1===t&&e.removeNGFilter(o);e.xNavPersistFilterSpec.validFilterId=o,e._biFilter.removeRoots(r)}}else e._biFilter&&!1===t.authored&&e.options.model.getRoots().length&&(e._biFilter.setTagsWithExpandSynthesis&&e._filterAlreadyTreatedRoot.length>0&&e._biFilter.setTagsWithExpandSynthesis(e._filterAlreadyTreatedRoot),n.getSetting("resetFiltersOnIndexModeSwitch")&&setTimeout(function(){for(let t=0;t<e.xNavPersistFilterSpec.validFilterId.length;t++){let o=e.xNavPersistFilterSpec.validFilterId[t];if(e.xNavPersistFilterSpec.filterSpec.has(o)&&e._filterAlreadyTreatedRoot.includes(o)){let t={rootId:o,specification:e.xNavPersistFilterSpec.filterSpec.get(o),eventName:"setFilterSpec-"+o,applyFilter:1,displayFilter:0};e._biFilter.setPublicFilterSpecification(t)}}},1e3))})},removeFilterIdsForPConf:function(t){var o=this,i=[];return t.forEach(function(t){if(!1===t.options.isReadOnly){var s=[];s.push({physical_id_path:t.getID()});var a=o._biFilter.getFilterSpec(t.getID(),{V2:{prefixPathArray:s,appQueryObj:{keep:'((typecode:0 OR typecode:1) AND (ds6w_58_globaltype:"ds6w:Document" OR ds6w_58_globaltype:"ds6w:Part"))  OR (typecode:2 AND NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency"))'}}});x.validateFIlters(a).isValid?(t.keepFilterBadge=!0,t.validFilter=!0,!0===n.getSetting("keepFilterAuthoring")&&(o.options.model.prodConfigSupportInAuth=!0)):o._biFilter.hasFilter(t.getID()).hasFilter&&(i.push(t),r.displayNotification({msg:e.invalidFilterInAuth,eventID:"warning"}))}}),i},keepFilterForDroppedRoot:function(e){var t=this.options.model.getRoots();return!0===n.getSetting("keepFilterAuthoring")&&(!0===n.getSetting("multiRootFilterAuthoring")||0===t.length&&e&&e.length<=1)},getFilterProxy:function(){return this._biFilter},removeRootFromFilterProxy:function(e){var t=this;this._biFilter&&(this.__doRemoveOnBI=this.__doRemoveOnBI?this.__doRemoveOnBI:a.debounce(function(){t._id2removeFromFilterProxy.length&&!S.isWidgetSynchronizing()&&(t._biFilter.resetNGFilterUI({widgetId:i.getWidgetId(),NGFUXId:t.getNGFUXID(),appId:i.getAppId(),rootIds:t._id2removeFromFilterProxy}),t._id2removeFromFilterProxy=[]),g.publish({event:"DS/InternalWdgtCom/NGFilterReset"})},250),-1===t._id2removeFromFilterProxy.indexOf(e.rootId2remove)&&t._id2removeFromFilterProxy.push(e.rootId2remove),this._filterAlreadyTreatedRoot.indexOf(e.rootId2remove)>-1&&this._filterAlreadyTreatedRoot.splice(this._filterAlreadyTreatedRoot.indexOf(e.rootId2remove),1),this.__doRemoveOnBI())},addFilter:function(o){var i=this;if(!0===s.determineAuthoredFlag()&&!1===i.keepFilterForDroppedRoot(o.filter_objects)){r.displayNotification({msg:e.filterInAuthoring,eventID:"warning",key:"enxNav-addFilter"});var a=g.getModelEvents();0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer&&(i.dropInvitContainer.hide(),a.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}))}else{if(!this._biFilter)return void(this._filterLoadQueue=o);var l=require("DS/PADServices/utils/Storage"),d=l.buildKey("ENXNav","pendingFilters");if(o.fromProxy){var p,u=l.sess.get(d);if(u&&(p=u.filter_objects),UWA.equals(p,o.filter_objects))return;var h={filter_objects:o.filter_objects};l.sess.setWithExpire(d,h,3500)}else{h={filter_objects:o.filter_objects};l.sess.setWithExpire(d,h,3500)}if(this.beginBlockingTransaction(t.retrieveFilter),o.filter_objects){var f="fromDropOnFilter"===o.behavior,v="fromDrop"===o.behavior,m=o.filter_objects.length>1,b=function(t){if(t.success.length&&(!0===(f=t.success[0].fromDropOnFilter?t.success[0].fromDropOnFilter:f)&&(o.behavior="fromDropOnFilter"),i._isRootAddedFromFilter=!0,i.add({content:"filters",rootsWithFilters:t.success,broadcast:!0!==o.fromWP&&(UWA.is(o.broadcast,"boolean")?o.broadcast:f),loadWithFilter:f,fromProxy:o.fromProxy,callback:function(a,l){if(a){for(var d=l&&l.alreadyLoadedRoots?l.alreadyLoadedRoots:[],c=!1,p=0;p<a.length;p++)if(-1===d.indexOf(a[p].rootId))if(c=!0,"fromDropOnFilter"===o.behavior){if(s.isAuthoring())i.disableFilterWaiting(),r.displayNotification({msg:e.noFilterOnAuthoring,eventID:"warning",key:"enxNav-NoFilterOnAuthoring"}),i.disableFilterWaiting();else if(!0!==o.fromProxy){var u=a[p].rootId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.setOpenFilterNow(u),t.begin(),i._filterRootIds=[u],i._filterPanelOpen=!0)})}else if(!0===o.fromProxy){u=a[p].rootId;i._filterRootIds=[u],i._filterPanelOpen=!0}}else{var h=UWA.clone(a[p].filter);if(h.filterId=a[p].filterId,h){if(h.filterRootIds=[a[p].rootId],void 0===h.CVQuery)if(h.union)h.CVQuery={union:h.union},delete h.union;else{for(var g=0;g<h.union.expand.length;g++){var f=h.union.expand[g];f.root_path_physicalid[0][0]===a[p].rootId&&(h.sequence_filter=f.sequence_filter,h.config_filter=f.config_filter)}var v=[[a[p].rootId]];h.root_path_physicalid&&(v=h.root_path_physicalid),h.CVQuery={root_path_physicalid:v,sequence_filter:h.sequence_filter,config_filter:h.config_filter,expand_iter:"-1"},delete h.sequence_filter,delete h.config_filter}i.applyFilter(h),n.getSetting("resetFiltersOnIndexModeSwitch")&&i.xNavPersistFilterSpec.addEventForEachFilter(h.filterRootIds)}else console.error("No filter pass")}!1===c&&"fromDropOnFilter"===o.behavior&&i.disableFilterWaiting(),i._isRootAddedFromFilter=!1}if(o.callback){var m=[];t.success.forEach(function(e){m.push(e.rootId)}),o.callback(m)}}})),t.failure.length){for(var a=0;a<t.failure.length;a++){var l={msg:t.failure[a].msg,eventID:t.failure[a].eventID};r.displayNotification(l)}i._commandProxy.retrieveFilterFailure(t),0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer&&i.dropInvitContainer.hide(),0===t.success.length&&(("fromDropOnFilter"===o.behavior||void 0===o.behavior&&o.filter_objects.length>0)&&(i.disableFilterWaiting(),i.endBlockingTransaction()),o.callback&&o.callback(t))}v&&i.endBlockingTransaction()};if(m){var _=o.callback,D=c.createStepper(o.filter_objects,null,function(e,t){i._biFilter.retrieveFilters({filterObjects:[e],filterIds:[e.objectId],fromDropOnFilter:f,callback:function(e){o.callback=function(){_&&_.apply(null,arguments),D()},b(e)}})},function(){});D()}else this._biFilter.retrieveFilters({filterObjects:o.filter_objects,fromDropOnFilter:f,callback:b})}}},HasFilter:function(e){return this._biFilter&&UWA.is(this._biFilter.HasFilter,"function")?this._biFilter.HasFilter(e):void 0},GetFilterSpec:function(e,t){return this._biFilter&&UWA.is(this._biFilter.GetFilterSpec,"function")?this._biFilter.GetFilterSpec(e,t):void 0},RetrievePrdFromFilterId:function(e){return this._biFilter&&UWA.is(this._biFilter.RetrievePrdFromFilterId,"function")?this._biFilter.RetrievePrdFromFilterId(e):void 0},getCtxForSharing:function(){return this._biFilter&&UWA.is(this._biFilter.getCtxForSharing,"function")?this._biFilter.getCtxForSharing():void 0},onSynthesisModeOnInstance:function(e){this._biFilter&&(!0===e?this._biFilter.setSynthesisMode("flat"):this._biFilter.setSynthesisMode("occurrence"),this.getPADTreeDocument().colorizeActivated&&(this.onUnColorize(),setTimeout(()=>{this.onColorize(null,!0)},10)))},onApplyNGFilter:function(t){if(s.determineAuthoredFlag())t&&!t.empty&&r.displayNotification({msg:e.filterInAuthoring2,eventID:"warning",key:"EnxNav-applyNGFilterFilterInAuthoring"});else{var o=t||null;o=UWA.is(o,"string")?JSON.parse(o):o,n.getSetting("resetFiltersOnIndexModeSwitch")||this.applyFilter(o);if(void 0!==t.filterRootIds&&n.getSetting("resetFiltersOnIndexModeSwitch")){var i="true"==y.getURLParameter("keepCollapsedFilter");if(this.xNavPersistFilterSpec.validFilterIdCopy.length>0){let e=this.xNavPersistFilterSpec.validFilterIdCopy.findIndex(e=>e===t.filterRootIds[0]);-1!=e&&this.xNavPersistFilterSpec.validFilterIdCopy.splice(e,1);let n=!1;0===this.xNavPersistFilterSpec.validFilterIdCopy.length&&(n=!0),i?this.applyFilter(o):this.resetFilterAndRefresh(t.filterRootIds,n)}else this.applyFilter(o),this.xNavPersistFilterSpec.addEventForEachFilter(t.filterRootIds)}}},resetFilterAndRefresh:function(e,t){var o=this.getPADTreeDocument();if(e.length){let n=e.reduce(function(e,t){return e.concat(o.getNodesById(t))},[]);new Promise(function(e,t){o.withTransactionUpdate(function(){for(var e=0;e<n.length;e++){var t=n[e],o=t.getState();u.node.setFilterBadge(t),t.options.filtered=!0,t.hasChildren()&&t._isExpanded?t.setState({state:"expanded"}):t.setState({state:"collapsed"}),"collapsed"===o?(t.removeChildren(),t.options.children=[],t.setState({state:"collapsed"})):t.processDescendants({processNode:function(){var e=this.getState();let t=void 0!==this.options.expandedState||("expanded"===e||"partiallyExpanded"===e);this.hasChildren()&&t?this.setState({state:"expanded"}):this.setState({state:"collapsed"}),"collapsed"===e&&(this.removeChildren(),this.options.children=[],this.setState({state:"collapsed"}))}})}}),e()}).then(function(e){t&&o.refresh()},function(e){console.log("reject - error while update")})}},onSaveNGFilter:function(e){var t=this;(e=e&&UWA.is(e,"string")?JSON.parse(e):e)&&e.rootId&&this.options.model.withTransactionUpdate(function(){let o=t.options.model.searchRootById(e.rootId);o&&(o.options.filterId=e.filterId)})},removeNGFilter:function(e){var t=this.getPADTreeDocument();if(delete t._hideChildrenFilter,e.length){let o=e.reduce(function(e,o){return e.concat(t.getNodesById(o))},[]);t.withTransactionUpdate(function(){for(var e=0;e<o.length;e++){var n=o[e];if(n.options.filtered){delete n.options.filtered,n.options.CVQuery=null,n.options.sequence_filter=null,n.options.config_filter=null,u.node.clearBadges(n);var i=n.getState();n.setState({state:"partiallyExpanded"}),n.options.padstate="partiallyExpanded",u.node.clearChildComputed(t),"collapsed"===i?(n.removeChildren(),n.options.children=[],n.setState({state:"partiallyExpanded"})):(n.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();this.options.childComputed=!1,"collapsed"===e&&(this.removeChildren(),this.options.children=[]),null!==this.options.children&&void 0!==this.options.children||(this.options.children=[]),this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded"}}}),null===n.options.children&&(n.options.children=[]))}}})}},onSetTagsWithExpandSynthesis:function(){if(this._biFilter&&!0!==this.addInProgressFlag&&!this._wait4Filter){var e=this;this.__debounceSetTags=this.__debounceSetTags?this.__debounceSetTags:a.debounce(()=>{setTimeout(function(){let t=function(e,t){for(var o=[],n=e.length,i=0;i<n;i+=t)o.push(e.slice(i,i+t));return o}(e.options.model.getRoots(),1e3),o=c.createStepper(t,null,function(t){let n=[];for(let o=0;o<t.length;o++){let i=t[o].getID();-1===e._filterAlreadyTreatedRoot.indexOf(i)&&(e._filterAlreadyTreatedRoot.push(i),n.push(i))}e._biFilter.setTagsWithExpandSynthesis&&n.length>0&&e._biFilter.setTagsWithExpandSynthesis(n),setTimeout(o,100)},function(){});o()})},250),this.__debounceSetTags()}},onColorize:function(e,o){let i=this,s=function(){!0===i._biSlave3D&&b._colorize3D(b)};var r=!1,a=setTimeout(()=>{r=!0,this.beginBlockingTransaction(t.applyColor)},750);let d=function(){!0===r?i.endBlockingTransaction():clearTimeout(a)},g="",f={};if(e){this.getPADTreeDocument().colorizeActivated=!0;let t=new p(e);this.colorMapAll=t.data,g=this.predicateKind=t.data.predicateKind,f=this.colorMap=t.data.colorMap}else o?(f=this.colorMap=this.colorMapAll.colorMap,g=this.predicateKind=this.colorMapAll.predicateKind):console.warn("xNavFilter:onColorize: Invalid Input");let v=[],m=[],b=this.options.model,_=n.getSetting("synthesisModeOnInstance"),D=f.predicate+"-alreadyRetrieved",S=f.predicate+"-Instance",x=f.predicate+"-Instance-alreadyRetrieved",y=[f.predicate],A=function(e){let t=e.model,o=e.colorMap,n=e.predicateKind,i=e.nodes2Update,s=e.nodes43DSlave,r=e.synthesisFlag,a=e.namePred,d=e.instPred,p=e.instRetrieved,g=(e.thisPtr,e.nodeArray),f=new Map,v=u.divideAndConquer(g,{},{notRoots:function(e){let t=!e.isRoot();return l.addBIColumn(o.predicate,!0),t},everything:function(e){return!0}});return t.withTransactionUpdate(function(){var e=[];h.iterate(v.everything,function(r){var l=r.getPLMValue(o.predicate);if(null!==l){var d=c.getBIColor(n,o,l),p={color:d,isBeingCut:!1,grid:{bi_color:d}};r.ghostMode=!1,d===N&&(e.push(r),p.isBeingCut=!0,r.ghostMode=!0),r.updateOptions(p),t.options.shouldBeSelected(r),s.push(r)}else if(!0!==r.getReferenceValue(a)){r.options.grid[a]=!0;let e=r.getID();i.push(e),w(f,e,r,!0)}else e.push(r)}),r&&h.iterate(v.notRoots,function(e){var t=e.getPLMValue(d);if(null!==t){var r={colorInstance:c.getBIColor(n,o,t)};e.ghostMode=!1,e.updateOptions(r),s.push(e)}else if(!0!==e.getReferenceValue(p)){e.options.grid[p]=!0;let t=e.getRelationID();i.push(t),w(f,t,e,!1)}});for(let t=0;t<e.length;t++)e[t].options.color===N&&e[t].options.colorInstance===N&&(e[t].ghostMode=!0,delete e[t].options.color,delete e[t].options.colorInstance,e[t].updateOptions({isBeingCut:!0}))}),f}({nodeArray:b.getAllDescendants().filter(function(e){return e.isVisible()&&!0!==e.isGroupingNode&&!0!==e.isRelationsObjectNode}),thisPtr:this,model:b,predicateKind:g,colorMap:f,nodes2Update:v,nodes43DSlave:m,synthesisFlag:_,namePred:D,instPred:S,instRetrieved:x});if(m.length&&s(),v.length){let e=[],t=b.updateNodesAttributesValue(v,y);h.iterate(t,function(t){t.then(function(t){e.push(new Promise(function(e,o){!function(e){let t=e.model,o=e.nodeIds,n=e.colorMap,i=e.predicateKind,s=(e.synthesisFlag,e.namePred,e.instPred),r=e.nodes43DSlave,a=e.finalNodeMap,l=o.map(function(e){let t=a.get(e);return t.plmValue=t.nodes[0].getPLMValue(n.predicate),t}).filter(function(e){return null!==e}),d=u.divideAndConquer(l,P,{references:function(e){return e.isByResId},instances:function(e){return!1===e.isByResId}});t.withTransactionUpdate(function(){var e=[];h.iterate(d.references,function(o){let s=o.plmValue;if(null!==s){var a=c.getBIColor(i,n,s),l={color:a,isBeingCut:!1,grid:{bi_color:a}};h.iterate(o.nodes,function(o){o.ghostMode=!1,a===N&&e.push(o),o.updateOptions(l),t.options.shouldBeSelected(o),r.push(o)})}else l={grid:{bi_color:N}},h.iterate(o.nodes,function(o){delete o.options.color,e.push(o),o.updateOptions(l),t.options.shouldBeSelected(o),r.push(o)})}),h.iterate(d.instances,function(t){h.iterate(t.nodes,function(t){let o=s?t.getReferenceValue(s):null;if(null!==o){var r=c.getBIColor(i,n,o),a={colorInstance:r};r===N&&(delete t.options.colorInstance,e.push(t)),t.updateOptions(a)}else t.updateOptions(C)})});for(let t=0;t<e.length;t++)e[t].isRoot()?e[t].options.color&&e[t].options.color!==N||(e[t].ghostMode=!0,delete e[t].options.color,e[t].updateOptions({isBeingCut:!0})):e[t].options.color&&e[t].options.color!==N||e[t].options.colorInstance&&e[t].options.colorInstance!==N||(e[t].ghostMode=!0,delete e[t].options.color,delete e[t].options.colorInstance,e[t].updateOptions({isBeingCut:!0}))})}({model:b,nodeIds:t.localIds,colorMap:f,predicateKind:g,synthesisFlag:_,namePred:D,instPred:S,nodes43DSlave:m,finalNodeMap:A}),e()}))})}),Promise.all(t).then(function(){Promise.all(e).then(function(){s(),d()})})}else d()},onUnColorize:function(){this.getPADTreeDocument().colorizeActivated=!1;var e=this;e.options.model.withTransactionUpdate(function(){var t={color:"rgba(255, 255, 255, 0.3)",colorInstance:"rgba(255, 255, 255, 0.3)",isBeingCut:!1,grid:{bi_color:"rgba(255, 255, 255, 0.3)"}};e.options.model.getAllDescendants().forEach(function(o){o.isGroupingNode||(delete o.options.color,!0===n.getSetting("synthesisModeOnInstance")&&delete o.colorInstance,o.ghostMode=!1,o.updateOptions(t),e.getPADTreeDocument().options.shouldBeSelected(o))})}),l.removeBIColumn(this.colorMap.predicate),delete this.colorMap,delete this.predicateKind,this.options.views.treelistview&&!0!==this.options.views.treelistview.getManager().isColumnHidden("bi_color")&&this.options.views.treelistview.getManager().hideColumn("bi_color"),!0===e._biSlave3D&&void 0!==e._commandProxy&&e._commandProxy.padFilterBI({filterBIUnColorize:!0})},onBroadcastColor:function(){var e=this,t=[];!0===e._biSlave3D&&UWA.is(e.colorMap)&&(e.options.model.getAllDescendants().forEach(function(o){o.isVisible()&&!0!==o.isGroupingNode&&(null!==o.getPLMValue(e.colorMap.predicate)?t.push(o):-1!==e.options.model.getRoots().indexOf(o)&&t.push(o))}),t.length&&e.colorizeSlave3D(t))},onFilterClose:function(e){if("dataFilterPanelCtn"===e.tag){var t=e||{};if(void 0===t.rootIds){t.rootIds=[];for(var o=this.options.model.getRoots(),n=0;n<o.length;n++)t.rootIds.push(o[n].getID())}this.disableFilterWaiting(t)}},onGroupingEvent:function(e){if(e.fromApplyFilter?e=this.options.groups:this.options.groups=e,this.options.fromGroupingEvent=!0,!0!==this.__grpInProgress){this.__grpInProgress=!0,e.fromGroupingEvent=!0,g.publish({event:"ENXModel/Model/ApplyGrouping",data:e});var t=g.subscribe({event:"ENXModel/Model/ApplyGrouping/Done"},e=>{g.unsubscribe(t),this.options.fromGroupingEvent&&(this._biFilter.setGroupingStatus(e),delete this.options.fromGroupingEvent),delete this.__grpInProgress})}},onSelectEvent:function(o){var n=s.determineAuthoredFlag();if(n)return r.displayNotification({msg:e.taggerSelectAuth,eventID:"warning",key:"enxNav-selectFromTaggerAuth"}),void this._biFilter.setSelectStatus({status:!0});let i={eventData:o,authored:n,doNotBroacast:!0};g.publish({event:"ENXViews/Model/SelectFromTagger",data:i});var a=g.subscribe({event:"ENXViews/Model/SelectFromTagger/Failure"},function(o){if(g.unsubscribe(l),g.unsubscribe(a),o&&o.reason)switch(o.reason){case"requestFailure":r.displayNotification({title:t.select_from_tagger_errorTitle,subtitle:t.select_from_tagger_error,eventID:"error",key:"enxNav-selectFromTagger-failure"});break;case"requestTimeout":r.displayNotification({title:t.select_from_tagger_errorTitle,subtitle:t.select_from_tagger_error,eventID:"error",key:"enxNav-selectFromTagger-timeout"});break;case"tooManyResults":r.displayNotification({msg:e.replace(e.tooManyResultSelectInApp,{maxResult:d.getSetting("maxPathsForSearch")}),eventID:"warning",key:"enxNav-selectFromTaggerTooManyResults"});break;case"noResults":r.displayNotification({msg:e.tagger_select_no_result,eventID:"info"})}}),l=g.subscribe({event:"ENXViews/Model/SelectFromTagger/Success"},function(t){g.unsubscribe(l),g.unsubscribe(a),t&&t.nbSelected&&r.displayNotification({msg:e.replace(e.get("tagger_select_success"),{nbSelected:t.nbSelected}),eventID:"info"})})},_createProxy:function(){var e=this;require(["DS/ENOFilterBIUX/FilterBIComponentProxy","DS/PADServices/utils/GlobalUtils"],function(t,o){var s=!0!==n.getSetting("activateGrouping")&&"true"!==o.getURLParameter("activateGrouping")||!0===d.getSetting("grpBSD")?void 0:{},r={tenant:i.getPlatformId(),processingMode:"appProcessing",colorize:!0,selection:{},widgetId:i.getWidgetId(),NGFUXId:e.getNGFUXID(),appId:i.getAppId(),volumeFilterAvailable:0,ExpandSynthesisON:!0,appQueryParam:{},synthesis_priority:1,shareFilterSpec:!0,enableGrouping:s};UWA.is(e.onFilterFilteringEvent,"function")&&(r.events={addFilterChangeListener:e.onFilterFilteringEvent.bind(e)}),n.getSetting("activateGraph")?r.appQueryParam={graph:n.getSetting("structureGraph")}:r.appQueryParam={"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency","Reference Document"]},e._biFilter=new t(r),S.setPreviousNGFUXID(e.getNGFUXID()),e._biFilter.resetNGFilterUI({widgetId:r.widgetId}),e._biFilter.addEvent("NGFilter_Close",e.onFilterClose,e),e._biFilter.addEvent("FilterBIColorize",e.onColorize,e),e._biFilter.addEvent("FilterBIUnColorize",e.onUnColorize,e),!0!==d.getSetting("grpBSD")&&e._biFilter.addEvent("FilterBIGroupingEvent",e.onGroupingEvent,e),e._biFilter.addEvent("FilterBISelectionEvent",e.onSelectEvent,e),e.options.model.getModelEvents().subscribe({event:"onRootAdded"},e.onSetTagsWithExpandSynthesis.bind(e)),g.subscribe({event:"ENXModel/Root/AllAdded"},e.onSetTagsWithExpandSynthesis.bind(e)),g.subscribe({event:"ENXNav/FilterBIGroupingEvent"},e.onGroupingEvent.bind(e)),e.options.model.getModelEvents().subscribe({event:"broadcastColor"},e.onBroadcastColor.bind(e));var a={expandServices:"expand",expandIntent:"partialPaths",NGFUXId:e.getNGFUXID(),appId:i.getAppId(),lightCBMsg:!0};if(e._biFilter.setNGFilterOptions(a),e._biFilter.addEvent("ApplyNGFilter",e.onApplyNGFilter,e),e.options.isDeEnabled&&e._biFilter.addEvent("SaveNGFilter",e.onSaveNGFilter,e),"function"==typeof e.options.model.setFBIProxyOptions?e.options.model.setFBIProxyOptions({FBIProxy:e._biFilter}):"function"==typeof e.options.model.setFilterBIProxy?e.options.model.setFilterBIProxy(e._biFilter):e.options.model._isVolumeFilter=!0,!0===n.getSetting("synthesisModeOnInstance")?e._biFilter.setSynthesisMode("flat"):e._biFilter.setSynthesisMode("occurrence"),n.addEvent("onSynthesisModeOnInstance",e.onSynthesisModeOnInstance.bind(e)),e._filterLoadQueue){var l=e._filterLoadQueue;delete e._filterLoadQueue,e.addFilter(l)}e._biFilter.setDefaultSecurityContext&&e._biFilter.setDefaultSecurityContext(n.getSetting("pad_security_ctx")),!0===d.getSetting("splitActivation")&&e._biFilter.setHighDepthTagsAvailability(!0),null!==o.getURLParameter("redirectQueryToSGI")&&"function"==typeof e._biFilter._addURLParam&&e._biFilter._addURLParam({services:"progressive",param:"redirectQueryToSGI=true"}),"function"==typeof e._biFilter.activateNewOther&&!0===d.getSetting("grpBSD")&&e._biFilter.activateNewOther(!0),g.publish({event:"ENXModel/Root/FBIProxy",data:{HasFilter:e._biFilter.HasFilter.bind(e._biFilter),getCtxForSharing:e._biFilter.getCtxForSharing.bind(e._biFilter)}})})},colorizeSlave3D:function(e){for(var t,o=this,n=[],i=[],s=[],r=function(e){var t;-1===n.indexOf(e)&&((t=o.options.model.getNodesById(e)).length?(n.push(e),s.push({color:t[0].options.color?t[0].options.color:"rgba(255, 255, 255, 0.3)",pid:e,ghostMode:t[0].ghostMode})):(t=o.options.model.getNodesByRelId(e)).length?(n.push(e),s.push({color:t[0].options.color?t[0].options.color:"rgba(255, 255, 255, 0.3)",pid:e,ghostMode:t[0].ghostMode})):console.error("Unknown node with id ["+e+"]"))},a=0;a<e.length;a++){var l=e[a];if(-1===n.indexOf(l.getID())&&(n.push(l.getID()),s.push({color:l.options.color?l.options.color:"rgba(255, 255, 255, 0.3)",pid:l.getID(),ghostMode:l.ghostMode,metaType:"reference"})),!1===l.isRoot()&&-1===n.indexOf(l.getRelationID())&&(n.push(l.getRelationID()),s.push({color:l.options.colorInstance?l.options.colorInstance:"rgba(255, 255, 255, 0.3)",pid:l.getRelationID(),ghostMode:l.ghostMode,metaType:"instance"})),"collapseState"===l._expandState||"partiallyExpandedState"===l._expandState){var d=l.getOccurencePath(l.options.resourceid);i.push(d.map(function(e){return r(e),n.indexOf(e)}))}else{var c=l.getOccurencePath(l.options.resourceid);i.push(c.map(function(e){return r(e),n.indexOf(e)}))}}t={nodes:s,path:i},void 0!==o._commandProxy&&0!==t.nodes.length&&o._commandProxy.padFilterBI({filterBIColorize:t})},_checkIfFilterAvailable:function(t,o){var n=this;return new Promise(function(i){var a=[],l={rootsWithFilter:void 0,objectsWithoutFilterDrop:t},d=UWA.clone(t);if(t.paths)for(let e=0;e<t.paths.length;e++)1===t.paths[e].length&&a.push(t.paths[e][0]);else t.rootIds&&(a=[].concat(t.rootIds));for(var c=n.options.model.getRoots(),p=[],u=0;u<c.length;u++){var h=a.indexOf(c[u].getID());-1!==h&&(a.splice(h,1),p.push(c[u].getID()))}if(p.length){r.displayNotification({msg:e.root_already_loaded});for(var g=0;g<p.length;g++){var f=p[g];if(l.objectsWithoutFilterDrop.paths)for(let e=0;e<l.objectsWithoutFilterDrop.paths.length;e++)if(1===l.objectsWithoutFilterDrop.paths[e].length&&l.objectsWithoutFilterDrop.paths[e][0]===f){l.objectsWithoutFilterDrop.paths.splice(e,1);break}l.objectsWithoutFilterDrop.rootIds&&-1!==l.objectsWithoutFilterDrop.rootIds.indexOf(f)&&l.objectsWithoutFilterDrop.rootIds.splice(l.objectsWithoutFilterDrop.rootIds.indexOf(f),1),l.objectsWithoutFilterDrop.pids&&-1!==l.objectsWithoutFilterDrop.pids.indexOf(f)&&l.objectsWithoutFilterDrop.pids.splice(l.objectsWithoutFilterDrop.pids.indexOf(f),1)}}if(a.length){var v=s.determineAuthoredFlag(),m=!1;n._biFilter.areRootsSharable(a,o).then(function(t){for(var s=0;s<t.length;++s)if(!0===t[s].hasFilter){if(!1!==v&&(!0!==v||!0!==n.keepFilterForDroppedRoot(a))){m=!0;break}if(l.rootsWithFilter||(l.rootsWithFilter=d,l.rootsWithFilter.biProxyCtx=o,l.rootsWithFilter.filteredRoots=[]),l.rootsWithFilter.filteredRoots.push(t[s].rootId),l.objectsWithoutFilterDrop.paths)for(let e=0;e<l.objectsWithoutFilterDrop.paths.length;e++)if(1===l.objectsWithoutFilterDrop.paths[e].length&&l.objectsWithoutFilterDrop.paths[e][0]===t[s].rootId){l.objectsWithoutFilterDrop.paths.splice(e,1);break}l.objectsWithoutFilterDrop.rootIds&&-1!==l.objectsWithoutFilterDrop.rootIds.indexOf(t[s].rootId)&&l.objectsWithoutFilterDrop.rootIds.splice(l.objectsWithoutFilterDrop.rootIds.indexOf(t[s].rootId),1),l.objectsWithoutFilterDrop.pids&&-1!==l.objectsWithoutFilterDrop.pids.indexOf(t[s].rootId)&&l.objectsWithoutFilterDrop.pids.splice(l.objectsWithoutFilterDrop.pids.indexOf(t[s].rootId),1)}l.objectsWithoutFilterDrop.pids&&0===l.objectsWithoutFilterDrop.pids.length&&(l.objectsWithoutFilterDrop=void 0),v&&m&&r.displayNotification({msg:e.dropFilteredRootAuth,eventID:"warning",key:"enxNav-dropFilteredRootAuth"}),i(l)})}else l.objectsWithoutFilterDrop.pids&&0===l.objectsWithoutFilterDrop.pids.length&&(l.objectsWithoutFilterDrop=void 0),i(l)})},_addDroppedRootsWithFilter:function(o){var i=this;return new Promise(function(a){i.beginBlockingTransaction(t.retrieveFilter);var l=o.filteredRoots,d=o.biProxyCtx,c="fromDropOnFilter"===o.behavior||!0===o.loadWithFilter;(function(a){return a.reduce((a,l)=>a.then(()=>(function(a){return new Promise(function(l){var p=setTimeout(function(){r.displayNotification({msg:e.noShareFilterTimeout,eventID:"warning",key:"EnxNav-noShareFilterTimeout"});var t=UWA.clone(o);delete t.biProxyCtx,delete t.filteredRoots,t.content="idslist",t.callback=function(){console.log("Root without filter added")},i.add(t),l()}.bind(a),5e3);i._biFilter.shareFilterSpec({fromRootId:a,fromSourceCtx:d,fromDropOnFilter:c,callback:function(a){if(clearTimeout(p),a.success.length&&(i._isRootAddedFromFilter=!0,i.add({content:"filters",rootsWithFilters:a.success,broadcast:UWA.is(o.broadcast,"boolean")?o.broadcast:c,loadWithFilter:c,behavior:o.behavior,fromProxy:o.fromProxy,noNotif:!0,callback:function(a,l){if(a){for(var d=l&&l.alreadyLoadedRoots?l.alreadyLoadedRoots:[],c=!1,p=0;p<a.length;p++)if(-1===d.indexOf(a[p].rootId))if(c=!0,"fromDropOnFilter"===o.behavior)if(s.isAuthoring())i.disableFilterWaiting(),r.displayNotification({msg:e.noFilterOnAuthoring,eventID:"warning",key:"EnxNav-noFilterOnAuthoringBIFilter"}),i.disableFilterWaiting();else if(!0!==o.fromProxy){var u=a[p].rootId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.setOpenFilterNow(u),t.begin(),i._filterRootIds=[u],i._filterPanelOpen=!0)})}else!0===o.fromProxy&&(u=a[p].rootId,i._filterRootIds=[u],i._filterPanelOpen=!0);else{var h=UWA.clone(a[p].filter);if(h){if(h.filterRootIds=[a[p].rootId],void 0===h.CVQuery)if(h.union)h.CVQuery={union:h.union},delete h.union;else{for(var f=0;f<h.union.expand.length;f++){var v=h.union.expand[f];v.root_path_physicalid[0][0]===a[p].rootId&&(h.sequence_filter=v.sequence_filter,h.config_filter=v.config_filter)}var m=[[a[p].rootId]];h.root_path_physicalid&&(m=h.root_path_physicalid),h.CVQuery={root_path_physicalid:m,sequence_filter:h.sequence_filter,config_filter:h.config_filter,expand_iter:"-1"},delete h.sequence_filter,delete h.config_filter}var b=g.subscribe({event:"ENXModel/SyncModel"},function(e){e&&"applyFilter"===e.what&&(b=g.unsubscribe(b),r.displayNotification({eventID:"success",msg:t.addRootWithFilterSuccessNotif}))});i.applyFilter(h),n.getSetting("resetFiltersOnIndexModeSwitch")&&i.xNavPersistFilterSpec.addEventForEachFilter(h.filterRootIds)}else console.error("No filter pass")}!1===c&&"fromDropOnFilter"===o.behavior&&i.disableFilterWaiting(),i._isRootAddedFromFilter=!1}}})),a.failure.length){for(var d=0;d<a.failure.length;d++){var u={msg:a.failure[d].msg,eventID:a.failure[d].eventID};r.displayNotification(u)}0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer&&i.dropInvitContainer.hide()}l()}})})})(l)),Promise.resolve())})(l).then(function(){i.endBlockingTransaction(),a()})})}})}),define("DS/ENXNav/mixins/_xNavRefresh",["UWA/Class","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var o=e.extend({});return!0===t.getSetting("refresh_v2")&&(o.prototype.refresh=function(e){e=void 0===e||e,require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("Uncut");t&&t.begin()}),e&&this._commandProxy.refreshModel();let t=this.getPADDGVView();t&&(t.options.shouldClearSort=!1,t.removeFilterView(),t.refreshStatusBar()),this.getPADTreeDocument().refresh()}),o}),define("DS/ENXNav/commands/FocusOnGroups",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/FocusOnGroups",data:{}})}})}),define("DS/ENXNav/commands/view/_xNavSelectLeaves",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();require(["DS/ENXNav/commands/view/_xNavSelectCmdsUtils"],function(e){var n=e._filterParentsOnly(o);t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[];n.forEach(function(e){e.processDescendants({processNode:function(){this.isVisible()&&(!1===this.hasChildren()?i.push(this):"collapsed"===this.getState()&&i.push(this))}})}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()})}}}),define("DS/ENXNav/commands/OpenCommands",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t){"use strict";const o=new Map([["OpenContent","searchContent"],["OpenProducts","availableproducts"],["OpenFilters","availablefilters"]]);return e.extend({execute:function(){var e=this;require(["DS/PADServices/utils/GlobalModelEvents"],function(t){let n=o.get(e.options.ID);n&&t.publish({event:"welcome-panel-action-selected",data:{id:n}})})}})}),define("DS/ENXNav/commands/view/_xNavSelectCmdsUtils",[],function(){"use strict";return{_filterParentsOnly:function(e){for(var t=[],o=e.length-1;o>=0;o--){var n=e[o];!1===this._isAParentSelected(n,e)&&t.push(n)}return t},_isAParentSelected:function(e,t){for(var o=!1,n=0;n<t.length&&!1===o;n++)e.getID()!==t[n].getID()&&(o=e.isDescendantOf(t[n]));return o}}}),define("DS/ENXNav/views/customize_views/positionMatrix",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","text!DS/ENXNav/assets/templates/positionMatrixTooltip.html","DS/Handlebars/Handlebars","DS/PADServices/views/ENXModal","DS/Controls/Button"],function(e,t,o,n,i,s){"use strict";var r=n.compile(o);function a(e,t,o){var n=e.split(","),i={className:o,x1:Number(n[0]).toFixed(t).toString(10).substring(0,t+3),x2:Number(n[1]).toFixed(t).toString(10).substring(0,t+3),x3:Number(n[2]).toFixed(t).toString(10).substring(0,t+3),y1:Number(n[3]).toFixed(t).toString(10).substring(0,t+3),y2:Number(n[4]).toFixed(t).toString(10).substring(0,t+3),y3:Number(n[5]).toFixed(t).toString(10).substring(0,t+3),z1:Number(n[6]).toFixed(t).toString(10).substring(0,t+3),z2:Number(n[7]).toFixed(t).toString(10).substring(0,t+3),z3:Number(n[8]).toFixed(t).toString(10).substring(0,t+3),t1:Number(n[9]).toFixed(t).toString(10).substring(0,t+3),t2:Number(n[10]).toFixed(t).toString(10).substring(0,t+3),t3:Number(n[11]).toFixed(t).toString(10).substring(0,t+3)};return r(i)}return{getTypeRepresentation:function(){return{"positionMatrix-Instance":{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-position",fontIconFamily:1}}},blankPositionMatrix:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:1}}}}},"positionMatrix-Instance":{getCellTooltip:function(e,o){let n;if(-1===e.rowID)n={shortHelp:t.columnsDef.instanceMatrix,updateModel:!1};else{let o=e.nodeModel.getReferenceValue("positionMatrix-Instance");if(o&&"Position Matrix"!==o){let e=a(o,6);n={title:t.columnsDef.instanceMatrix,shortHelp:e,allowUnsafeHTMLShortHelp:!0,wrapThreshold:315,updateModel:!1}}}return n},buildColumn:function(e){return Object.assign({dataIndex:"positionMatrix-Instance",kind:"functionIcon",width:40,minWidth:40,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!1}},getCellTypeRepresentation:function(e){if(e.nodeModel&&"Position Matrix"!==e.nodeModel.getReferenceValue("positionMatrix-Instance"))return e.nodeModel.getReferenceValue("positionMatrix-Instance")?"positionMatrix-Instance":"blankPositionMatrix"},getCellValueForExport:function(e){var o="";return-1===e.rowID?o=t.columnsDef.instanceMatrix:e&&e.nodeModel&&e.nodeModel.getReferenceValue("positionMatrix-Instance")&&(o=e.nodeModel.options.grid["positionMatrix-Instance"]),o}},e)},actionOnClick:function(e,t){if(e.nodeModel){let n=e.nodeModel.getReferenceValue("positionMatrix-Instance");if(void 0!==n&&"Position Matrix"!==n){let r=a(n,16,"large"),l=document.querySelector(".enx-appMainBody"),d=e.cellView.getContent().getBoundingClientRect(),c={of:l,my:"top left",at:"top left",offsetX:d.x,offsetY:d.y};var o=new i({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.getPADDGVView().options.dgv.getColumnOrGroup(e.columnID).text,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:r,position:c,buttons:{Close:new s({onClick:function(){o.close()}})},events:{onClickOutsideContent:function(){o.close()}}})}}}}}}),define("DS/ENXNav/commands/_xNavGraphCmds",[],function(){"use strict";var e=null;return{execute:function(t){var o=t.xnav_app.options.views.graphview;switch(t.command_id){case"ReframeAll":o.reframeAll();break;case"ReframeOn":o.reframeOn();break;case"ToggleOverview":o.toggleOverview();break;case"LayoutDown":case"LayoutRight":case"LayoutUp":case"LayoutLeft":o.toggleLayout(t.command_id);break;case"SwapThumbState":require(["DS/etree/syncwidget"],function(t){null===e&&(e=t.ThumbnailState.EXPANDED);var n=!1;e===t.ThumbnailState.EXPANDED?(e=t.ThumbnailState.COLLAPSED,n=!0):e===t.ThumbnailState.COLLAPSED&&(e=t.ThumbnailState.EXPANDED,n=!0),!0===n&&o.setAllThumbnailsState(e)})}}}}),define("DS/ENXNav/models/RefreshHandler",["UWA/Core","UWA/Class"],function(e,t){return t.extend({init:function(e){this.options=e,this.treeDocument=e.treeDocument},complete:function(e){this._clearAllHidden(this.treeDocument),this.treeDocument.getXSO().empty()},_clearAllHidden:function(e){!function(e,t){for(var o=e.getRoots(),n=0;n<o.length;n++){var i=o[n];t(i),i.processDescendants({processNode:function(e){t(this)}})}}(e,function(e){!0===e.options.isPADHiddenBackEnd?delete e.options.isPADHiddenBackEnd:e.options.isPADHidden=!1})}})}),define("DS/ENXNav/commands/view/_xNavSelectAll",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getRoots();if(o.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t._selected_paths=[];var n=[];o.forEach(function(e){e.select(),e.processDescendants({processNode:function(){this.isVisible()&&n.push(this)}})}),t.multiselect(n),t.pushUpdate(),t.pushBroadcastSelect()}}}}),define("DS/ENXNav/models/mixins/TreeDocProxy",["DS/PADServices/utils/CommandProxy","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/Numbers","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","i18n!DS/PADServices/assets/nls/PADServices"],function(e,t,o,n,i,s,r,a,l){"use strict";function d(){}return d.prototype={_cmdProxy:null,_pagerview:null,initProxy:function(){this._cmdProxy=e.create({events:{onSelect:this._onSelectProxy.bind(this),onFocus:this._onFocus.bind(this),onFocusChange3D:this._onFocusChange3D.bind(this),onShow:this._onShow.bind(this),onHide:this._onHide.bind(this),onUpdate2DPosMatrix:this._onUpdate2DPosMatrix.bind(this),onSendFilterInfo:this._onSendFilterInfo.bind(this),onReframeSelection:this._onReframeSelection.bind(this),onUpdateViewPoint:this._onUpdateViewPoint.bind(this)}})},_onReframeSelection:function(){this.closePager()},_onFocus:function(e,t){var o=this;if("focus"===e.intent&&!0!==e.findInCtx&&("graphview"===o.options.active_view||"datagridview"===o.options.active_view)){let t=function(){let e=!1;if(widget.getValue("enableProdConfig")&&o.isEditor()&&a.getSetting("activateExcludeOccProxy"))for(let t=0;t<o._selection.length;t++){let n=o._selection[t],i=o.getNodeByOccurencePath(n);if(i&&!o.pathsAreEqual(n,i.getOccurencePath())){o.pathIsInExcludes(i,n)&&(e=!0)}}return e};require(["DS/PADUtils/views/PADPager","DS/ENOXInterWdgCom/LinkManager"],function(i,s){o._doNotBroadcastSelect=!0,o._selectedIdx=0;var r=!1;if(o._selection=[],e.paths.forEach(function(t){var i=o.getNodeByOccurencePath(t);if(i){var a=(l=i.getRoot()).options.filtered;a&&(i.options.retrievedFromFocus=!0);let d=i.getParent();for(;d&&("expanded"!==d.getState()&&d.setState(n.NODE_STATES.PARTIALLY_EXPANDED),!d.isRoot());)a&&(d.options.retrievedFromFocus=!0),d=d.getParent();if(i.getID()===t[t.length-1]&&!0!==i.options.isPADHidden)o._selection.push(t);else if(i.getID()===t[0]&&!0!==i.filtered)o._selection.push(t),r=!0;else if(-1!==t.indexOf(i.getID())){var l;(l=i.getRoot()).options.filtered&&s.isLinkedWithPartnerApp(e.sharedID)?(o._selection.push(t),r=!0):l.options.filtered||(o._selection.push(t),r=!0)}}}),o.originalSelection=o._selection,o._selection.length>1){let e=Promise.resolve();null===o._pagerview&&(e=o.displayPager()),t()?(o._doNotBroadcastSelect=!0,o._checkColorize3D()):o.insertBranches(o._selection,{node_state:"partiallyExpanded",from:"select",onComplete:function(){o._doNotBroadcastSelect=!0,o._checkColorize3D()}}),!0===r&&o._cmdProxy.padExpand({paths:o._selection,expand_level:"1",updatePager:!0}),e.then(()=>{o._reframeOn({idx:o._selectedIdx})})}else{o.closePager(),t()?(o._doNotBroadcastSelect=!0,o._checkColorize3D()):o.insertBranches(o._selection,{node_state:"partiallyExpanded",from:"select",onComplete:function(){o._doNotBroadcastSelect=!0,o._checkColorize3D()}}),!0===r&&o._cmdProxy.padExpand({paths:o._selection,expand_level:"1",updatePager:!0}),o._reframeOn({idx:o._selectedIdx})}})}},_onFocusChange3D:function(e){e.sharedID===t.getSharedId()&&this._focusChange(e)},_focusChange:function(e){this._selection&&("previous"==e.event&&(this._selectedIdx--,this._reframeOn()),"next"==e.event&&(this._selectedIdx++,this._reframeOn()))},_reframeOn:function(){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var e=this._selectedIdx%this._selection.length;if(this._pagerview){var t=e+1+"/"+this._selection.length;this._pagerview.setLabel(t)}var o=this.getNodeByOccurencePath(this._selection[e]);o&&(this._focusOn=!0,o.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:o}),this._selection.length>1&&this._pagerview.show(),this._focusOn=!1)},_onShow:function(e){var t=[];this.withTransactionUpdate(function(){for(var o=0;o<e.paths.length;o++){var n=this.getNodeByOccurencePath(e.paths[o]);if(n){n.updateOptions({isPADHidden:!1}),t=t.concat(n)}}}.bind(this)),o.publish({event:"ENXModel/hideShowState",target:t,data:{toggle:"show",fromUI:e.fromUI}}),o.publish({event:"ENXModel/HideShowTriggered",data:{name:"show"}})},_onHide:function(e){var t=this,n=[];this._doNotBroadcastSelect=!0;let i=!1,s=[];if(widget.getValue("enableProdConfig")&&a.getSetting("activateExcludeOccProxy")&&this.isEditor()&&e.paths.length){let o=e.paths.map(function(e){return{path:e,node:t.getNodeByOccurencePath(e)}});for(let e=0;e<o.length;e++){let t=o[e],n=t.node.getOccurencePath();if(this.pathsAreEqual(n,t.path))s.push(t.path);else{this.pathIsInExcludes(t.node,t.path)&&(i=!0)}}}i?(s.forEach(function(e){var o=t.getNodeByOccurencePath(e);if(o){o.updateOptions({isPADHidden:!0}),n=n.concat(o)}}),t._doNotBroadcastSelect=!1,o.publish({event:"ENXModel/hideShowState",target:n,data:{toggle:"hide",fromUI:e.fromUI}}),o.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})):this.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){t.withTransactionUpdate(function(){e.paths.forEach(function(e){var o=t.getNodeByOccurencePath(e);if(o){o.updateOptions({isPADHidden:!0}),n=n.concat(o)}})}),t._doNotBroadcastSelect=!1,o.publish({event:"ENXModel/hideShowState",target:n,data:{toggle:"hide",fromUI:e.fromUI}}),o.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})}})},_onUpdate2DPosMatrix:function(e){if(!this.getXSO().isEmpty()){this.prepareUpdate();for(var o=0;o<e.instances.length;o++)for(var n=this.getNodesByRelId(e.instances[o].instance),i=0;i<n.length;i++){var d=e.instances[o].hasPositioningMatrix.join(),c={relationId:e.instances[o].instance,grid:{"positionMatrix-Instance":s.checkNotIdentity(d)?d:null}};n[i].updateOptions(c)}t.displayNotif({message:l.infos.pastePositionSucceeded,level:"info"}),this.pushUpdate(),a.getSetting("activateAutoSwitchAuthoringToIndex")&&r.determineAuthoredFlag()&&r.setAuthoringState(!0)}},_onUpdateViewPoint:function(e){this._viewPointTimer&&clearTimeout(this._viewPointTimer),this._pendingViewPoint&&(this._pendingViewPoint({success:!0,viewpoint:e}),delete this._pendingViewPoint)},_onSendFilterInfo:function(){this._cmdProxy.receiveFilterInfo({filterAvailable:!0})},displayPager:function(){this._selectedIdx=0;let e=this;return new Promise(function(t,o){"graphview"===e.options.active_view||"datagridview"===e.options.active_view?require(["DS/PADUtils/views/PADPager"],function(o){null===e._pagerview?(e._pagerview=new o({renderTo:document.body,injectNow:!0,callbacks:{onSelectAll:function(){e._doNotBroadcastSelect=!0,e.restoreSelection(!0),e._doNotBroadcastSelect=!1},onPrevious:function(){e._focusChange({event:"previous"})},onNext:function(){e._focusChange({event:"next"})},onClose:function(){e.closePager(),e._focusOn=!1,e.searchProgress=!1}}}),t()):t()}):t()})},closePager:function(){this._pagerview&&(this._pagerview.hide(),this._focusOn=!1,delete this._pagerview)},reframeOn:function(e){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var t=this._selectedIdx%this._selection.length;if(this._pagerview){var o=t+1+"/"+this._selection.length;this._pagerview.setLabel(o)}var n=this.getNodeByOccurencePath(this._selection[t]);n&&(this._focusOn=!0,e&&!0===e.noSelect||n.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:n}),this._pagerview&&this._selection.length>1&&this._pagerview.show(),this._focusOn=!1)},_getLastViewpoint:function(e){let t=this;this._pendingViewPoint=e,this._viewPointTimer=setTimeout(function(){t._pendingViewPoint&&(t._pendingViewPoint({success:!1}),delete t._pendingViewPoint)},500),this._cmdProxy.requestViewPoint()}},d}),define("DS/ENXNav/models/mixins/TreeDocSupport",["DS/PADServices/utils/Iterator","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,n,i,s){function r(e,t){if(Array.isArray(e)&&Array.isArray(t)){var o=e.length;if(o===t.length){for(var n=0;n<o;n++)if(e[n]!==t[n])return!1;return!0}return!1}return!1}function a(){}return a.prototype={pathsAreEqual:function(e,t){return r(e,t)},pathIsInExcludes:function(e,t){let o=e.getRoot().getExcludedOccurrences().filter(e=>e.length===t.length),n=!1;for(let e=0;e<o.length;e++){let i=o[e];if(r(t,i)){n=!0;break}}return n}},a}),define("DS/ENXNav/views/xNavResponsiveTilesView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/ApplicationFrame/CommandsManager","DS/CollectionView/ResponsiveTilesCollectionView"],function(e,t,o,n,i,s){"use strict";return e.extend(o,n,{name:"xNavResponsiveTileView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0),o=this.options.grid=new s(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){i.getCommand("Copy").begin()}),o.onCellsPaste(function(e){i.getCommand("Paste").begin()}),o.onCellsCut(function(e){i.getCommand("Cut").begin()}),UWA.is(o.onCellsEscape,"function")&&o.onCellsEscape(function(e){i.getCommand("Uncut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})}})}),define("DS/ENXNav/models/mixins/TreeDocOccurenceIdx",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Meas","DS/PADServices/utils/Iterator","DS/PADServices/utils/PADTrackerManager","DS/PADServices/ws/WSAccess","DS/ENOXParser/ParserCV","DS/ENOXInterWdgCom/LinkManager","DS/Selection/HSOManager","DS/PADUtils/Utility","DS/TreeModel/TreeNodeModel"],function(e,t,o,n,i,s,r,a,l,d,c,p,u){"use strict";let h;const g="expanded",f="collapsed";function v(){}function m(){if(h)return h;{const e=require("DS/PADUtils/PADContext");return h=e.get()}}function b(){let e=m();return!(!e||!e.colorMap)}v.prototype.initModelMap=function(){this.isOccModel=!0,this.__nodesMaps=new Map,this.subscribe({event:"addChild"},this.__manageNode.bind(this)),this.subscribe({event:"preRemoveChild"},this.__manageNode.bind(this))},v.prototype.getNodeFromPath=function(e){const t=this.__nodesMaps.get(e[0]);return t?t.get(e.join("/")):void 0},v.prototype.__manageNode=function(e){let t,o;if(e.data.nodeModel.getNodeSource()!==u.NODE_SOURCE.GROUPING)switch(!0===e.data.nodeModel.isRelationsObjectNode?(t=[e.data.nodeModel.getID()],o=this.__nodesMaps.get(e.data.nodeModel.getRoot().getID())):(t=e.data.nodeModel.getOccurencePath(),o=this.__nodesMaps.get(t[0])),e.event){case"addChild":if(o||(o=new Map,this.__nodesMaps.set(t[0],o)),o.get(t.join("/"))||o.set(t.join("/"),e.data.nodeModel),e.data.nodeModel.isRoot()&&this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:this.getRoots().length,added_node:e.data.nodeModel}}),e.data.nodeModel.hasChildren()){const t=e.data.nodeModel.getChildren();for(let e=0;e<t.length;e++){if(t[e].getNodeSource()===u.NODE_SOURCE.GROUPING);else{const n=t[e].options.occPath?t[e].options.occPath:t[e].getOccurencePath();o.get(n.join("/"))||this.__manageNode({event:"addChild",data:{nodeModel:t[e]}})}}}break;case"preRemoveChild":if(o){const n=e.data.nodeModel;if("function"==typeof this.cleanGroupingForNodes&&!0!==n.options.isGroupingNode&&this.cleanGroupingForNodes({node:n}),n.isRoot())o.clear(),this.__nodesMaps.delete(t[0]);else{let e=t.join("/"),i=[],s=n.getParent();if(!0===n.isRelationsObjectNode){for(;!0===s.isRelationsObjectNode||n.getNodeSource()===u.NODE_SOURCE.GROUPING;)s=s.getParent();e=(t=s.getOccurencePath()).join("/"),1===t.length&&(e+="/");for(const e of o.keys())e===n.getID()&&i.push(e);if(n.options.isGroupingNode)for(const t of o.keys())t.startsWith(e)&&i.push(t)}else{1===t.length&&(e+="/");for(const t of o.keys())t.startsWith(e)&&i.push(t)}for(const e of i)o.delete(e)}}break;default:console.error("TreeDocOccurenceIdx::__manageNode# Unknown event: "+e.event)}},v.prototype.add=async function(n){let s=i.addOrGetSection("add");console.groupCollapsed("TreeDocOccurenceIdx::add# Nb Ids="+n.pids.length),this._directSelection=!0;let r=n.pids.filter(function(e,t){return n.pids.indexOf(e)===t}),c={alreadyLoadedRoots:[]},p=this.getRoots(),u=r.length;for(let e=0;e<p.length;e++){let t=r.indexOf(p[e].options.resourceid);-1!==t&&(r.splice(t,1),c.alreadyLoadedRoots.push(p[e].options.resourceid))}let h=()=>{r.length!==u&&(d.isWidgetSynchronizing()||o.displayNotif({message:e.infos.rootAlreadyLoaded}),n.callback&&(c.noNotif=!0,n.callback(c)),console.groupEnd())};if(0===r.length)h();else if(r.length>0){s.start("Add.fetchRoots",{stats:!0});try{let i=await a.fetch({pids:r,autoAttSelection:!0});i="string"==typeof i?JSON.parse(i):i,s.end("Add.fetchRoots"),i.results&&0!==i.results.length?i.results.length>r.length?(o.displayNotif({message:e.errors.tooManyResults,level:"error",key:"xNavDoc-add-too-many-results"}),n.callback&&n.callback("error")):(s.start("ParserCV.parseAddOcc",{stats:!0}),this.invalidateViewPort(),this._parseLoadModel=!0,await l.parseAddOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:i}),this._parseLoadModel=!1,s.end("ParserCV.parseAddOcc"),this.isGroupingApplied()&&this.__applyGroupingTagger({groups:this.getActiveGrouping(),fromGroupingEvent:!0}),n.callback&&n.callback(c)):t.getSetting("activateFUN148764")?await o.getLastDataIndexTime().then(t=>{o.displayNotif({message:e.replace(e.errors.objectNotFoundInDBFUN148764,{lastIndexed:t}),level:"error",key:"xNavDoc-add-obj-not-found"}),n.callback&&n.callback("error")}):(o.displayNotif({message:e.errors.objectNotFoundInDB,level:"error",key:"xNavDoc-add-obj-not-found"}),n.callback&&n.callback("error"))}catch(t){o.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-addOcc"}),n.callback&&n.callback("error")}finally{s.end("Add.roots"),h()}}},v.prototype.displayMemoryUsage=function(e){if(console.groupCollapsed("Memory Usage"),e&&e.usedJSHeapSize&&e.totalJSHeapSize&&e.jsHeapSizeLimit){const t=2;console.log(`usedJSHeapSize : ${e.usedJSHeapSize.toFixed(t)} MB`),console.log(`totalJSHeapSize : ${e.totalJSHeapSize.toFixed(t)} MB`),console.log(`jsHeapSizeLimit : ${e.jsHeapSizeLimit.toFixed(t)} MB`)}},v.prototype.addPaths=async function(n){let s=i.addOrGetSection("addPaths");if(!n.paths)throw new Error("TreeDocOccurenceIdx::addPaths## Invalid parameters, no paths");console.groupCollapsed("TreeDocOccurenceIdx::addPaths# Nb Paths="+n.paths.length),r.addCommandHit("addPaths",""+n.paths.length);let d={alreadyLoadedRoots:[]};s.start("performAddPath",{stats:!0}),s.start("progressiveExpand",{stats:!0}),this._parseLoadModel=!0,await l.insertTempPaths({treeDoc:this,FBIProxy:this.options.FBIProxy,paths:n.paths,nodeModelClass:this.options.nodeModelClass,nls:e.parser,state:n.state?n.state:"partiallyExpanded"}),this._parseLoadModel=!1;let c=!1,p=e=>{let t=this.getNodeFromPath(e);if(t&&!0===t.options.waiting4validation){let o=t.getParent();t.remove(),c=!0;let n=e.slice(0,e.length-2);null===o.options.children&&(o.options.children=[],o.setState({state:"collapsed"})),p(n)}},u=!1,h=t=>{if(!1===u){u=!0;for(let e=0;e<n.paths.length;e++)p(n.paths[e]);c&&(t&&t.removedByFilter?o.displayNotif({message:e.errors.cannotInsertBranchFiltered,eventID:"info",key:"xNavDoc-addPaths-cannot-add-branch-filtered"}):o.displayNotif({message:e.errors.cannotInsertBranch,level:"error",key:"xNavDoc-addPaths-cannot-add-branch"}))}},g=!1;for(let e=0;e<n.paths.length;e++){if(!0===this.options.FBIProxy.HasFilter(n.paths[e][0]).hasFilter){g=!0;break}}let f={pathIds:n.paths,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};try{let e=await a.expandv2(f);if(e="string"==typeof e?JSON.parse(e):e,s.end("progressiveExpand"),e.errors&&e.errors.length||e.results&&0===e.results.length){if(h({removedByFilter:g}),n.callback){let e={success:!1};n.callback(e,d)}}else{let t={success:!1};s.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0;let o=await l.parsePathsOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:e,nodeModelClass:this.options.nodeModelClass,state:n.state?n.state:"partiallyExpanded"});this._parseLoadModel=!1,s.end("ParserCV.parseExpandOcc");for(let e=0;e<o.rootIds.length;e++){let t=this.getNodeFromPath([o.rootIds[e]]);this.getModelEvents().publish({event:"onRootAdded",data:{nb_root:this.getRoots().length,added_node:t}})}t.success=!0,n.callback&&n.callback(t,d)}}catch(e){if(console.log(" -- Request exception"),n.callback){let e={success:!1};n.callback(e,d)}}finally{s.end("performAddPath"),h()}},v.prototype.onPreExpandChecker=async function(e){let t=e.data,o=t.nodeModel,i=!!t.expandAll&&t.expandAll;if(!0===o.isGroupingNode){if(!0===this.__findInProgress)return void e.target.preExpandDone({preventExpandAll:!0});await this.__expandGrpNode(e),e.target.preExpandDone({preventExpandAll:!0,state:"expanded"})}else{if(this._parseLoadModel)return void n.subscribeOnce({event:"ENXModel/parseEnded"},function(){this.preExpandDone({preventExpandAll:!1})}.bind(e.target));if(i){let t=document.getElementsByClassName("enx-appMainBody");if(t&&1===t.length){t=t[0];let n=o.isRoot()?o:o.getRoot();require(["DS/ENXNav/views/private/ExpandChecker"],o=>{o.check({targetDiv:t,roots:[n]}).then(t=>{!0===t.performExpandAll?this.__expandCB(e):e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})})})}else this.__expandCB(e)}else this.__expandCB(e)}},v.prototype.__expandCB=async function(s){const d=i.addOrGetSection("expandOcc");let c=Date.now(),p=s.data,h=p.nodeModel,v=!!p.expandAll&&p.expandAll,m=p.numberOfLevelsToExpand?p.numberOfLevelsToExpand.toString():t.getSetting("expand_iter");if(h.getNodeSource()===u.NODE_SOURCE.GROUPING)return void s.target.preExpandDone({preventExpandAll:!0,state:"expanded"});v&&(m="-1"),console.groupCollapsed(`TreeDocOccurenceIdx::__expandCB# [${h.getLabel()}] with level (${m})`),r.addCommandHit("ExpandOcc","ExpandCB-"+m=="-1"?"all":m),v&&(h._expandAllPending=!0,n.publish({event:"ENXNav/parser/expandAll/begin"}));let _=h.options.filtered,D=!1;"partiallyExpanded"!==h.options.padstate||_||(D=!0);let S=m,x=parseInt(m,10),y=!0;const N=v?-1:h.getDepth()+x;y=await async function e(t,o){let n=i.addOrGetSection("checkModelForExpand");n.start("validateExistingTree",{stats:!0});const s=t.getDepth();let r=!0;const a=-1===o||s<o;const l=t.options.childComputed;async function d(n){if(n){const n=t.getChildren();for(let i=0;n&&i<n.length;i++){const s=await e(n[i],o);s?(t.setState({state:"expanded"}),r=!0):r=!1}}else r=!1,t.setState({state:"collapsed"})}if(a&&l){t.setState({state:"expanded"});const e=-1===o||s+1<=o;await async function d(e){if(e){const e=t.getChildren();for(let n=0;e&&n<e.length;n++){const s=await async function e(t,o){let n=i.addOrGetSection("checkModelForExpand");n.start("validateExistingTree",{stats:!0});const s=t.getDepth();let r=!0;const a=-1===o||s<o;const l=t.options.childComputed;async function d(n){if(n){const n=t.getChildren();for(let i=0;n&&i<n.length;i++){const s=await e(n[i],o);s?(t.setState({state:"expanded"}),r=!0):r=!1}}else r=!1,t.setState({state:"collapsed"})}if(a&&l){t.setState({state:"expanded"});const e=-1===o||s+1<=o;await d(e)}else if(function(e){const t="ds6w:globalType";return!e.options.isIFCShape&&("ds6w:Document"===e.options.grid[t]||e.options.padgrid&&"ds6w:Document"===e.options.padgrid[t])}(t)){if(r=!1,t&&t.getParent()){const e=t.getParent(),n=e.getState();1===e.getChildren().length&&-1===o?e.setState({state:f}):n!==g?"Rendering Representation"===t.options.type?(r=!0,e.setState({state:g})):e.setState({state:f}):n===g&&"Drawing"===t.options.type&&(r=!0)}}else s===o?r=!1:t&&void 0===l&&(r=!0);n.end("validateExistingTree");n.end();return r}(e[n],o);s?(t.setState({state:"expanded"}),r=!0):r=!1}}else r=!1,t.setState({state:"collapsed"})}(e)}else if(function(e){const t="ds6w:globalType";return!e.options.isIFCShape&&("ds6w:Document"===e.options.grid[t]||e.options.padgrid&&"ds6w:Document"===e.options.padgrid[t])}(t)){if(r=!1,t&&t.getParent()){const e=t.getParent(),n=e.getState();1===e.getChildren().length&&-1===o?e.setState({state:f}):n!==g?"Rendering Representation"===t.options.type?(r=!0,e.setState({state:g})):e.setState({state:f}):n===g&&"Drawing"===t.options.type&&(r=!0)}}else s===o?r=!1:t&&void 0===l&&(r=!0);n.end("validateExistingTree");n.end();return r}(h,N);if(!1===y)s.target.preExpandDone({preventExpandAll:!0}),this._selectOccurence(),b()&&this._colorize3D(that),delete h._expandAllPending,v&&n.publish({event:"ENXNav/parser/expandAll/complete"}),d.end("performExpand-"+x),console.groupEnd();else{let i=h;const p=i.getAllDescendants().length;let u=0;h.isRoot()||(i=h.getRoot());const g=h.getOccurencePath();u=g.length-1;const f={pathIds:[g],data:{expandLevel:m},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0,isIFCShape:function(e,t){let o=t.options.isIFCShape;return!o&&t.isSupplemental()&&(t.options.isIFCShape=!0,o=!0),o}(0,h)};d.start("performExpand-"+x,{stats:!0}),d.start("progressiveExpand",{stats:!0});try{let u=await a.expandv2(f);if(u="string"==typeof u?JSON.parse(u):u,d.end("progressiveExpand"),u.results&&(0===u.results.length?(_?o.displayNotif({message:e.infos.findInCtxNoResult,level:"info"}):o.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-expand-generic-error"}),v&&n.publish({event:"ENXNav/parser/expandAll/complete"}),s.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})):(!0===D&&this._cmdProxy.padExpand({paths:[h.getOccurencePath()],expand_level:x}),d.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0,await l.parseExpandOcc({treeDoc:this,expandedNodes:[h],FBIProxy:this.options.FBIProxy,wsResponse:u,nodeModelClass:this.options.nodeModelClass,expandLevel:x,expandLevelRequest:parseInt(S,10),filter:i.options.filtered}),this._parseLoadModel=!1,d.end("ParserCV.parseExpandOcc"),v&&n.publish({event:"ENXNav/parser/expandAll/complete"}),s.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),n.publish({event:"ENXModel/parseEnded"}),this._selectOccurence(),t.getSetting("debug_2D")&&(d.start("memoryUsage",{stats:!0}),this.displayMemoryUsage(function(){if(window.performance&&performance.memory){const e=1048576,t=t=>t/e;return{usedJSHeapSize:t(performance.memory.usedJSHeapSize),totalJSHeapSize:t(performance.memory.totalJSHeapSize),jsHeapSizeLimit:t(performance.memory.jsHeapSizeLimit)}}return console.warn("performance.memory is not available on this browser."),null}()),d.end("memoryUsage")))),u.errors){let t=!1,i="",r="",a=[];for(let e=0;e<u.errors.length;e++)if("UNKNOWN_META"===u.errors[e].code)if(t=!0,void 0!==u.errors[e].unknownmetas)a=a.concat(u.errors[e].unknownmetas),r=u.errors[e].unknownmetas;else{let t=u.errors[e].reason,o="com.exalead.expand.progressive.ProgressiveExpandException: [",n=t.indexOf(o)+o.length;i=t.substring(n,t.length-1),r=i,i=i.replace(/,\s+/g,","),a=a.concat(i.split(","))}!0===t?(n.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,h.setState({state:"collapsed"}),n.publish({event:"ENXNav/parser/expandAll/complete"});let t=require("DS/PADServices/utils/PlatformURL");o.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:r,envId:t.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),n.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:a}})):(s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,h.setState({state:"collapsed"}),o.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:h.getLabel(),expandLevel:"-1"===m?"all":m}),level:"error",key:"xNavDoc-expand-api-error"}),n.publish({event:"ENXNav/parser/expandAll/complete"}))}}catch(t){if(d.end("progressiveExpand"),t.timeoutOccurs)return s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,n.publish({event:"ENXNav/parser/expandAll/complete"}),void o.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-request-timeout"});s.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete h._expandAllPending,h.setState({state:"collapsed"}),v&&n.publish({event:"ENXNav/parser/expandAll/complete"}),o.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:h.getLabel(),expandLevel:"-1"===m?"all":m}),level:"error",key:"xNavDoc-expand-parse-error"})}finally{d.end("progressiveExpand"),d.end("performExpand-"+x);let e=r.getPADTracker({eventCategory:"performance",eventAction:"expand"}),t=Date.now();e.setEventData({eventLabel:"expandOcc",eventValue:t-c,txKey:i.getID()});let o=i.getAllDescendants().length;e.setDims({dims:{pd2:"-1"===m?"ExpandAll":"1"===m?"Expand1":"ExpandN"},vals:{pv2:o-p,pv3:o}}),e.trackPageEvent(),console.groupEnd()}}},v.prototype.expandMultiSelect=async function(d){let c=!!d.expandAll&&d.expandAll,p=d.numberOfLevelsToExpand?d.numberOfLevelsToExpand.toString():t.getSetting("expand_iter"),u=d.nodes2Expand;c&&(p="-1"),console.groupCollapsed(`TreeDocOccurenceIdx::expandMultiSelect# Nb Nodes [${u.length}] with level (${p})`),r.addCommandHit("ExpandOcc","MultiSelect-"+p=="-1"?"all":p);let h=[];for(let e=0;e<u.length;e++)h.push(u[e]);if(0===h.length)this.prepareUpdate(),b()&&this._colorize3D(this),this.pushUpdate(),d.callback&&d.callback(),console.groupEnd();else{let r=0,u=[],g=[],f=[];this.prepareUpdate(),h.forEach(e=>{e.setState({state:"expanding"})}),this.pushUpdate(),this.prepareUpdate(),s.iterate(h,function(e){let t=e;t.isRoot()||(t=t.getRoot());let o=e.getOccurencePath();t&&-1===f.indexOf(t.getID())&&(f.push(t.getID()),g.push(t)),r=Math.max(o.length-1,r),u.push(o)});let v=i.addOrGetSection("expandOcc"),m={pathIds:u,data:{expandLevel:p},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};v.start("performExpand-"+p,{stats:!0}),v.start("progressiveExpand",{stats:!0});try{let t=await a.expandv2(m);if(t="string"==typeof t?JSON.parse(t):t,v.end("progressiveExpand"),t.results&&(0===t.results.length?(o.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-expand-generic-error"}),c&&n.publish({event:"ENXNav/parser/expandAll/complete"})):(v.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0,await l.parseExpandOcc({treeDoc:this,expandedNodes:h,FBIProxy:this.options.FBIProxy,wsResponse:t,nodeModelClass:this.options.nodeModelClass,expandLevel:parseInt(p)}),this._parseLoadModel=!1,v.end("ParserCV.parseExpandOcc"),c&&n.publish({event:"ENXNav/parser/expandAll/complete"}),v.end("performExpand-"+p),this._selectOccurence())),t.errors){let i=!1,s="",r="",a=[];for(let e=0;e<t.errors.length;e++)if("UNKNOWN_META"===t.errors[e].code)if(i=!0,void 0!==t.errors[e].unknownmetas)a=a.concat(t.errors[e].unknownmetas),r=t.errors[e].unknownmetas;else{let o=t.errors[e].reason,n="com.exalead.expand.progressive.ProgressiveExpandException: [",i=o.indexOf(n)+n.length;s=o.substring(i,o.length-1),r=s,s=s.replace(/,\s+/g,","),a=a.concat(s.split(","))}if(!0===i)n.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{for(let e=0;e<g.length;e++)delete g[e]._expandAllPending,g[e].setState({state:"collapsed"});n.publish({event:"ENXNav/parser/expandAll/complete"});const t=require("DS/PADServices/utils/PlatformURL");o.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:r,envId:t.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),n.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:a}});else{for(let e=0;e<g.length;e++)delete g[e]._expandAllPending,g[e].setState({state:"collapsed"});o.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-multiExpand-error-1"}),n.publish({event:"ENXNav/parser/expandAll/complete"})}}}catch(t){v.end("progressiveExpand"),v.end("performExpand-"+d.expandLevel),o.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-multiExpand-error-2"})}finally{d.callback&&d.callback(),n.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}}),s.iterate(h,function(e){e.setState({state:"expanded"})}),this.pushUpdate(),console.groupEnd()}}},v.prototype.findInCtx=async function(s){console.groupCollapsed("TreeDocOccurenceIdx::findInCtx# searchFTS:"+s.searchFtsOriginal);let r=i.addOrGetSection("findInCtxOcc"),d=()=>{s.doNotBroacast&&(this._doNotBroadcastSelect=!0,this._inBatchingForUpdate=!0)},c=()=>{s.doNotBroacast&&(this._doNotBroadcastSelect=!1,this._inBatchingForUpdate=!1)},p=s.nodes.length>1,u=[],h=[];this.closePager(),this._selection=[],this.searchProgress=!0,d(),this.prepareBroadcastSelect(),this.getXSO().empty(),c();let g=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest();this.prepareUpdate();var f=[];for(let i=0;i<s.nodes.length;i++){let v=s.nodes[i],m=v.getState(),b=function(){v.setState({state:m})};v.setState({state:"expanding"});let _={FBIProxy:this.options.FBIProxy,data:{rootPhID:v.getOccurencePath(),select_bo:g.select_object,select_rel:g.select_relation,compute_select_bo:g.select_file,ftsString:s.searchFts,rscIdToSearch:s.rscId,max_count_path:t.getSetting("maxPathsForSearch")},iterativeFilter:s.iterativeFilter,filterRel:s.no_type_filter_rel,withOccResponse:!0};-1===_.data.select_rel.indexOf("ds6w:type")&&_.data.select_rel.push("ds6w:type"),-1===_.data.select_rel.indexOf("ro.plminstance.v_treeorder")&&_.data.select_rel.push("ro.plminstance.v_treeorder"),r.start("findInCtx",{stats:!0});try{let i=await a.findInCtxV2(_);if(i="string"==typeof i?JSON.parse(i):i,r.end("findInCtx"),i.results&&i.results.length){r.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0,d(),await l.parseExpandOcc({treeDoc:this,expandedNodes:[v],FBIProxy:this.options.FBIProxy,wsResponse:i,nodeModelClass:this.options.nodeModelClass,state:"partiallyExpanded",isFindInCtx:!0}),c(),this._parseLoadModel=!1,r.end("ParserCV.parseExpandOcc");let n=this.getXSO().get();n.length>t.getSetting("maxPathsForSearch")&&(n.pop(),o.displayNotif({message:e.replace(e.warnings.tooManyResultFound,{maxResult:t.getSetting("maxPathsForSearch")}),level:"warning",key:"FindInCtx-tooManyResult"}));let s=h.slice(),a=n.filter(function(e){return-1===s.indexOf(e)});h=h.concat(a),this._selection.length&&p&&(u=[...this._selection],this._selection.length=0),a.forEach(e=>{this._selection.push(e.getOccurencePath())}),u=[...u,...this._selection],this.originalSelection=p?u:this._selection,v.setState({state:"partiallyExpanded"})}else this._parseLoadModel=!1,console.log("Find in Ctx failed - No Results"),b()}catch(e){this._parseLoadModel=!1,console.log("Find in Ctx failed"),b()}finally{n.publish({event:"ENXModel/SyncModel",data:{what:"FindInCtx"}}),s.doNotBroacast||that.pushBroadcastSelect();for(let e=0;e<u.length;e++){let t=this.getNodeByOccurencePath(u[e]);t&&f.indexOf(t)<0&&f.push(t)}this._selection=u,!0!==s.noPager&&this._selection.length&&this.displayPager().then(()=>{d(),this.reframeOn({idx:this._selectedIdx}),c()})}}0===f.length?o.displayNotif({message:e.infos.findInCtxNoResult,level:"info"}):(d(),this.unselectAll(),c()),n.publish({event:"ENXViews/Model/FindInCtx/complete",data:{foundNodes:f}}),this.searchProgress=!1,console.groupEnd(),this.pushUpdate()},v.prototype.refresh=async function(s){console.groupCollapsed("TreeDocOccurenceIdx::refresh");let d=i.addOrGetSection("measRefresh"),c=[];const p=(e=>{let t=[];const o=e.getRoots();for(let e=0;e<o.length;e++){t.push(o[e]);let n=o[e].getLeaves(),i=[],s=[],r=[];for(let e=0;e<n.length;e++)if(!0===n[e].isRelationsObjectNode){let t=!0===n[e].isGroupingNode?n[e]:n[e].getParent();for(;!0===t.getParent().isGroupingNode;)t=n[e].getParent();-1===r.indexOf(t.getID())&&(s.push(t),r.push(t.getID()))}else i.push(n[e]);s.length&&this.withTransactionUpdate(()=>{for(let e=0;e<s.length;e++)!0!==s[e].isRoot()&&s[e].remove()}),t=t.concat(i)}return t})(this);let u=[],h=0;for(let e=0;e<p.length;e++)if(p[e].isRoot())u.push([p[e].getID()]);else{let t=p[e].options.occPath;h<(t.length-1)/2&&(h=(t.length-1)/2),u.push(t)}d.start("Refresh.refresh",{stats:!0});let g=!1,f=e=>{if(-1===c.indexOf(e.join("/"))){let t=this.getNodeFromPath(e);if(t){let o=t.getParent();t.remove(),!o||"ds6w:Document"!==o.options.globaltype||o.options.children&&0!==o.options.children.length||(o.options.children=null,o.setState({state:"noChildren"})),g=!0;let n=e.slice(0,e.length-2);f(n)}}},v=()=>{this.withTransactionUpdate(()=>{d.start("Refresh.removeNotUpdPaths",{stats:!0});for(let e=0;e<u.length;e++)f(u[e]);d.end("Refresh.removeNotUpdPaths"),!0===g?o.displayNotif({message:e.warnings.removeNodeDuringRefresh,level:"warning"}):(u.length>0||c.length>0)&&o.displayNotif({message:e.infos.refreshOK,level:"info"}),n.publish({event:"ENXModel/refresh/complete"}),d.end("Refresh.refresh");let t=d.meas("Refresh.refresh");if(t){let e=r.getPADTracker({eventCategory:"performance",eventAction:"refresh"});if(e){const o=t.duration,n=t.startTime;e.addMultivaluedEventData("2d_app_refresh",{call_refresh_start:n,call_refresh_duration:o}),e.trackPageEvent()}}console.groupEnd()})};n.publish({event:"ENXModel/refresh/begin"});let m=s&&s.roots;if(m||(m=this.getRoots()),0===m.length)return void v();const b=m.map(function(e){return e.getOccurencePath()});if(this.unselectAll(),0===h){d.start("Refresh.roots",{stats:!0}),d.start("Refresh.fetchRoots",{stats:!0});const n=m.map(function(e){return e.getID()});try{let i=await a.fetch({pids:n,autoAttSelection:!0});i="string"==typeof i?JSON.parse(i):i,d.end("Refresh.fetchRoots"),d.start("ParserCV.parseRefreshOcc",{stats:!0}),this._parseLoadModel=!0;let s=await l.parseRefreshOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:i});if(this._parseLoadModel=!1,d.end("ParserCV.parseRefreshOcc"),!0!==t.getSetting("grpBSD")&&this.isGroupingApplied()){console.log("Reapply grouping");for(let e=0;e<b.length;e++){let t=b[e].join("/"),o=this.options.mappedNodes.get(t);this.applyGroupingOnNode(o.grpParams)}}c=s.refreshPaths}catch(t){o.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-refreshOcc"})}finally{v(),d.end("Refresh.roots")}}else{d.start("Refresh.paths",{stats:!0});let n={pathIds:b,data:{expandLevel:h},FBIProxy:this.options.FBIProxy,timeout:t.getSetting("webapi_timeout"),select_relation:["ro.plminstance.v_treeorder"],withOccResponse:!0};d.start("progressiveExpand",{stats:!0});try{let t=await a.expandv2(n);t="string"==typeof t?JSON.parse(t):t,d.end("progressiveExpand"),d.start("ParserCV.parseRefreshOcc",{stats:!0}),this._parseLoadModel=!0;const i=await l.parseRefreshOcc({treeDoc:this,FBIProxy:this.options.FBIProxy,wsResponse:t});this._parseLoadModel=!1,d.end("ParserCV.parseRefreshOcc"),c=i.refreshPaths}catch(t){o.displayNotif({message:e.errors.genericWSFailure,level:"error",key:"xNavDoc-refreshOcc-expand"})}finally{d.end("Refresh.paths"),v()}}},v.prototype.expandZeroForFilterRoots=async function(e){console.groupCollapsed("TreeDocOccurenceIdx::expandZeroForFilterRoots# Nb Nodes ["+e.filteredRoots.length+"]"),console.groupEnd()},v.prototype.insertBranches=async function(t,o){console.groupCollapsed("TreeDocOccurenceIdx::insertBranches Nb Paths="+t.length);let n=i.addOrGetSection("insertBranches");if(o&&"select"===o.from){let e=[];for(let o=0;o<t.length;o++)this.searchRootById(t[o][0])&&e.push(t[o]);if(1===e.length&&this.getNodeFromPath(e[0])||1===e.length&&this.getNodesById(e[0][e[0].length-1]).indexOf(this.getSelectedNodes()[0])>=0)return this._selectOccurence(),void console.groupEnd();if(t&&t.length>0&&t[0].length>0){if(!this.searchRootById(t[0][0]))return void console.groupEnd();await this.addPaths({paths:t,state:o.node_state})}else await this.addPaths({paths:t,state:o.node_state})}else{n.start("ParserCV.parseExpandOcc",{stats:!0}),this._parseLoadModel=!0;await l.insertTempPaths({treeDoc:this,FBIProxy:this.options.FBIProxy,paths:t,nodeModelClass:this.options.nodeModelClass,nls:e.parser,state:o.node_state});this._parseLoadModel=!1,n.end("ParserCV.insertTempPaths")}console.groupEnd(),o.onComplete()},v.prototype.dispatchColorize=function(e,o,n,i,s,r){const a=this;return new Promise(function(l,d){let c=[],u=[],h=n.predicate+"-Instance";const g=!0===t.getSetting("synthesisModeOnInstance"),f=!1===r.getConfig("readOnlyApp");e.withTransactionUpdate(function(){for(let t=0;t<o.length;t++){const s=o[t];if(!0!==s.isGroupingNode){const t=s.getPLMValue(n.predicate);if(null!==t){const o=p.getBIColor(i,n,t);let r={color:o,isBeingCut:!1,grid:{bi_color:o}};s.ghostMode=!1,o===_&&(delete s.options.color,s.ghostMode=!0,r.isBeingCut=!0),s.updateOptions(r),e.options.shouldBeSelected(s),u.push(s)}else if(f)c.push(s.getID());else{const t={color:_,grid:{bi_color:_}};s.updateOptions(t),e.options.shouldBeSelected(s)}if(g&&!1===s.isRoot()){let e=s.getPLMValue(h);if(null!==e){const t={colorInstance:p.getBIColor(i,n,e)};s.updateOptions(t),a.safeRemove(c,s.getID())}else if(f)-1===u.indexOf(s)&&c.push(s.getID());else{const e={colorInstance:_};s.updateOptions(e)}}if(s.options.color===_&&s.options.colorInstance===_){const e={isBeingCut:!0,grid:{bi_color:_}};delete s.options.color,delete s.options.colorInstance,s.ghostMode=!0,s.updateOptions(e)}}}}),0===c.length?(!0===e.fromTransactionEnd&&delete e.fromTransactionEnd,!0===s&&e._colorize3D(e),l()):e.updateNodesAttrValue(c,[n.predicate],function(t){e.withTransactionUpdate(function(){for(let t=0;t<c.length;t++){const o=e.getNodesById(c[t]);if(o.length>0){const t=o[0].getPLMValue(n.predicate);if(null!==t){const s=p.getBIColor(i,n,t),r={color:s,isBeingCut:!1,grid:{bi_color:s}};for(let t=0;t<o.length;t++)o[t].ghostMode=!1,s===_&&(delete o[t].options.color,o[t].ghostMode=!0,r.isBeingCut=!0),o[t].updateOptions(r),e.options.shouldBeSelected(o[t])}else{const t={grid:{bi_color:_}};for(let n=0;n<o.length;n++)delete o[n].options.color,t.isBeingCut=!0,o[n].ghostMode=!0,o[n].updateOptions(t),e.options.shouldBeSelected(o[n])}}}}),!0===s&&e._colorize3D(e),l()})})},v.prototype.safeRemove=function(e,t){let o=e.indexOf(t);-1!==o&&e.splice(o,1)},v.prototype.compareSpecific=function(e,t){const o=e.length,n=t.length;let i=!1;if(o===n){let o=!1;for(let i=0;i<n;i++){const n=t[i];if(-1===e.indexOf(n)){o=!0;break}}return o||(i=!0),i}return!1},v.prototype.updateColorForNodes=function(e,t,o){const n=require("DS/PADUtils/Configuration"),i=this,s=e.length<1e3?100:200;i.dispatchColorize(i,e,t,o,!0,n).then(function(){setTimeout(function(){const s=i.getAllDescendants();i.compareSpecific(e,s)||i.dispatchColorize(i,i.getAllDescendants(),t,o,!0,n).then(function(){console.log("Colorization done")})},s)})},v.prototype.selectFromTagger=async function(e){console.groupCollapsed("TreeDocOccurenceIdx::selectFromTagger");let o,s=i.addOrGetSection("measSelectFromTagger"),r=[];const d=()=>{e.doNotBroacast&&(this._doNotBroadcastSelect=!1,this._inBatchingForUpdate=!1)};(()=>{e.doNotBroacast&&(this._doNotBroadcastSelect=!0,this._inBatchingForUpdate=!0)})(),this.getXSO().empty(),c.empty();let p=[],u=this.getRoots(),h=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest();for(let i=0;i<u.length;i++){let r=u[i];p.push(new Promise(async d=>{const c={rootPhID:r.getOccurencePath(),select_bo:h.select_object,select_rel:["ro.plminstance.v_treeorder"].concat(h.select_relation),compute_select_bo:h.select_file,max_count_path:t.getSetting("maxPathsForSearch"),boundingbox:!1,taggerSelect:e.eventData};s.start("selectFromTagger-Root-"+i,{stats:!0}),o=r.getState();try{let e=await a.selectFromTagger({data:c,FBIProxy:this.options.FBIProxy});s.end("selectFromTagger-Root-"+i),e="string"==typeof e?JSON.parse(e):e,s.start("ParserCV.parseExpandOcc-Root-"+i,{stats:!0}),this._parseLoadModel=!0,await l.parseExpandOcc({treeDoc:this,expandedNodes:[r],FBIProxy:this.options.FBIProxy,wsResponse:e,nodeModelClass:this.options.nodeModelClass,state:"expanded",selectPaths:!0}),this._parseLoadModel=!1,s.end("ParserCV.parseExpandOcc-Root-"+i),d()}catch(e){this.options.FBIProxy.setSelectStatus({status:!0}),r.setState({state:o}),"TIMEOUT"===e.message?n.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestTimeout"}}):n.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestFailure"}}),d()}}))}Promise.all(p).then(()=>{if(this.options.FBIProxy.setSelectStatus({status:!0}),d(),(r=this.getXSO().get()).length>t.getSetting("maxPathsForSearch"))n.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"tooManyResults"}});else if(0===r.length)n.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"noResults"}});else{this._selected_paths=[];for(let e=0;e<r.length;e++)this._selected_paths.push(r[e].getOccurencePath());this._selectOccurence(),n.publish({event:"ENXViews/Model/SelectFromTagger/Success",data:{nbSelected:r.length}})}})},v.prototype._checkColorize3D=function(){b()&&this._colorize3D(this)},v.prototype._colorize3D=function(e){if(!0!==this._collapseRepDuringExpandAll){let t=this,o=[],n={},i=[],s=[];t.getRoots().forEach(function(n){if(n.options.color||(n.options.color=_),n.options.color)if(o.push(n.options.resourceid),s.push({color:n.options.color?n.options.color:_,pid:n.options.resourceid,ghostMode:n.ghostMode}),"collapseState"===n._expandState||"partiallyExpandedState"===n._expandState)if(null!==n.getChildren()&&n.getChildren().length>0)t._colorChildren(n,o,s,i,e);else{const e=n.getOccurencePath(n.options.resourceid);i.push(e.map(function(e){return o.indexOf(e)}))}else{const e=n.getOccurencePath(n.options.resourceid);i.push(e.map(function(e){return o.indexOf(e)}))}}),n={nodes:s,path:i},void 0!==t._cmdProxy&&0!==n.nodes.length&&t._cmdProxy.padFilterBI({filterBIColorize:n})}},v.prototype._colorChildren=function(e,t,o,n,i){let s=this;e.getChildren().forEach(function(e){if(t.push(e.options.resourceid),t.push(e.options.relationid),o.push({color:e.options.color?e.options.color:_,pid:e.options.resourceid,ghostMode:e.ghostMode,metaType:"reference"}),o.push({color:e.options.colorInstance?e.options.colorInstance:_,pid:e.options.relationid,ghostMode:e.ghostMode,metaType:"instance"}),"collapseState"===e._expandState||"partiallyExpandedState"===e._expandState)if(e.hasChildren())s._colorChildren(e,t,o,n,i);else{const o=e.getOccurencePath(e.options.resourceid);n.push(o.map(function(e){return t.indexOf(e)}))}else{const o=e.getOccurencePath(e.options.resourceid);n.push(o.map(function(e){return t.indexOf(e)}))}})};const _="rgba(255, 255, 255, 0.3)";return v}),define("DS/ENXNav/mixins/_xNavDnD",["UWA/Class","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADDropTooltip","DS/PADUtils/Utility","DS/ApplicationFrame/CommandsManager","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,o,n,i,s,r,a,l,d){"use strict";return e.extend({setDnD_onGraph:function(){this.options.views.graphview.getContainer().addEventListener("dragover",this.onDragOverGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("drop",this.onDropBlankGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragenter",this.onDragLeaveGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragleave",this.onDragLeaveGraph.bind(this)),this.options.views.graphview.getContainer().addEventListener("dragend",this.onDragLeaveGraph.bind(this))},doDnDDragStart:function(e,o,n){var i=t.dropdata_from_selected_nodes(o);return this._updateWithBIProxyInfos(o,i),e.setData("Text",JSON.stringify(i)),!0},shouldAcceptDnDDrop:function(e,t,o,n){var i={shiftKey:2===n.modifiers};return this._add_drop_invite(i),!0},doDnDDrop:function(e,t,o,n){var i={dataTransfer:e,preventDefault:function(){},stopPropagation:function(){},shiftKey:n.modifiers};this._onDropContent(i)},onDragOverGraph:function(e){return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),this.options.views.graphview.getContainer().addClassName("bordered"),!0},onDragLeaveGraph:function(e){return this.options.views.graphview.getContainer().removeClassName("bordered"),this.onDragLeaveBlank(e)},onDropBlankGraph:function(e){this.options.views.graphview.getContainer().removeClassName("bordered")},onDragEnterBlank:function(e,t){return this.onDragOverBlank(e,t)},onDragOverBlank:function(e,t){return e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&(this._add_drop_invite(e),!0)},onDragEndBlank:function(e,t){return this.onDragLeaveBlank(e,t)},onDragLeaveBlank:function(e,t){if(!this._isDroppableInBody())return!1;var o=e.relatedTarget,n=!o||o instanceof SVGPathElement?"":o.className;if(!(!n||-1===n.indexOf("paddnd_invite_")))return e.preventDefault(),e.stopPropagation(),!1;if(this.dropInvitContainer){var i=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;if(0===this.options.model.getRoots().length&&0===i)this.dropInvitContainer.show("drop");else{if(this.dropInvitContainer.isEventInside(e))return e.preventDefault(),e.stopPropagation(),!1;this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)}}return!0},onDropBlank:function(e,t){return this._onDropContent(e),!0},onDragEnterCell:function(e,t){return this.onDragOverBlank(e,t)},onDragEndCell:function(e,t){return this.onDragLeaveCell(e,t)},onDragStartCell:function(e,o){(t.isTouchDevice()||t.isSurface())&&(this._dnd_startCell=!0,this._dnd_start_target=e.target);var n=o.nodeModel;if(!n.isGroupingNode){var i=this.options.model.getXSO().get().slice(0);if(i[0]!==n){var s=i.indexOf(n),r=i[0];i[0]=n,i[s]=r}var a=t.dropdata_from_selected_nodes(o.draggedNodes);return this.options.isDeEnabled&&this.hasActiveDesignExp()&&a&&a.data.items&&a.data.items.length&&o.draggedNodes.forEach(e=>{if(e.options.filtered){let t=a.data.items.find(t=>t.objectId==e.options.resourceid);t&&(t.filterId=e.options.filterId,t.isFiltered=!0,t.filterTitle=e.options.filterTitle)}}),this._updateWithBIProxyInfos(o.draggedNodes,a),e.dataTransfer.setData("Text",JSON.stringify(a)),e.stopPropagation(),!1}e.preventDefault()},onDragOverCell:function(e,t){return e.dataTransfer&&("copyMove"!==e.dataTransfer.effectAllowed&&"copy"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect="copy",e.preventDefault())),!!this._isDroppableInBody()&&(this.dropInvitContainer&&"find_in_ctx"===t.dataIndex&&this.dropInvitContainer.show("find"),e.preventDefault(),!0)},onDragLeaveCell:function(e,o){if((t.isTouchDevice()||t.isSurface())&&this._dnd_startCell&&(this._dnd_leaveCell=!0),this.dropInvitContainer){var n=e.relatedTarget,i=n?n.className:" ";if(!(!i||-1===i.indexOf("paddnd_invite_"))||this.dropInvitContainer.isEventInside(e))return e.stopPropagation(),e.preventDefault(),!1;this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)}return!0},onDropCell:function(e,i){if(this.onDragLeaveCell(e),e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),(t.isTouchDevice()||t.isSurface())&&(this._dnd_leaveCell||this._dnd_startCell)&&(this._dnd_leaveCell=!1,this._dnd_startCell=!1,a.elementIsOrIsWithin(e.target,this._dnd_start_target)))return this._dnd_start_target=null,void(this.dropInvitContainer&&this.dropInvitContainer.hide(this.dropInvitContainer.active_invite));function s(){return r}if("top"!==i.dropPosition&&"bottom"!==i.dropPosition){var r=[];"find_in_ctx"===i.dataIndex&&n.retrieveAuthorizedObjects({dnd_event:e,isFindInCtx:!0,callback:function(e){var t=0;for(t=0;t<e.authorized_objects.length;t++)r.push([e.authorized_objects[t].objectId]);r.length&&(i.nodeModel.options.partialPreExpand=s,i.nodeModel.expand())}})}else o.displayNotification({msg:d.drop_between_lines,eventID:"warning",key:"enxNav-dropBetweenLines"});return!1},onDragEnterColumnHeader:function(e,t){},onDragEndColumnHeader:function(e,t){return delete sessionStorage.isNotDroppableInBody,this.onDragLeaveColumnHeader(e,t)},onDragOverColumnHeader:function(e,t){return this._isDroppableInBody()&&(this._add_drop_invite(e),e.preventDefault()),!0},onDragLeaveColumnHeader:function(e,t){var o=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;return this.dropInvitContainer&&(0===this.options.model.getRoots().length&&0===o?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide(this.dropInvitContainer.active_invite)),!0},onDropColumnHeader:function(e,o){if("bi_color"==o.dataIndex)return!1;var n=!0;switch(t.retrieveDroppedDataType(e)){case"3DXContent":this.options.model.unselectAll(),this._onDropContent(e),n=!1;break;default:this.dropInvitContainer&&(0===this.options.model.getRoots().length?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide())}return n},onDragStartColumnHeader:function(e,t){return sessionStorage.isNotDroppableInBody="true",!0},_add_drop_invite:function(e){this.dropInvitContainer&&(e.shiftKey?this.dropInvitContainer.show("add_as_object"):(this.dropInvitContainer.show("add_in_context"),this.dropInvitContainer&&this.dropInvitContainer.elements&&this.dropInvitContainer.elements.container&&this.dropInvitContainer.elements.container.filterDiv&&(this.dropInvitContainer.elements.container.filterDiv.style.display="none",this.dropInvitContainer.elements.container.classList.remove("withFilterOpen"))))},_onDropContent:function(e){var i=this;if(e.preventDefault(),!0!==this.options.layout.dndEvo&&e.stopPropagation(),this.dropInvitContainer&&e.dataTransfer.files&&e.dataTransfer.files.length>0)return 0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide(),!1;function s(n){if(0===n.authorized_objects.length)i.dropInvitContainer&&(0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide()),!0===n.unsupportedDropNotified&&(0===n.authorized_objects.length&&0===n.unauthorized_objects.length?o.displayNotification({msg:d.root_already_loaded}):o.displayNotification({msg:d.invalidDropOperation,eventID:"error",key:"enxNav-onDropContent-invalid-drop"}));else{var s=e.shiftKey||!0===i.options.layout.dndEvo?"WITHOUT_CONTEXT":"WITH_CONTEXT",r=i.options.model.getRoots();t.multiTenantMgt(n.authorized_objects,r,function(e){e.isMultiTenant?e.isMultiTenant&&e.invalidTenant&&i.dropInvitContainer&&(0===i.options.model.getRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide()):n.authorizedWithKind?(n.authorizedWithKind.Product&&n.authorizedWithKind.Product.length>0&&i.add({content:"3DXContent",authorized_objects:n.authorizedWithKind.Product,callback:void 0,behavior:s,isDrop:!0,biProxyCtx:n.source_data.biProxyCtx}),n.authorizedWithKind.Filter&&n.authorizedWithKind.Filter.length>0&&i.addFilter({content:"3DXContent",filter_objects:n.authorizedWithKind.Filter,broadcast:!0,callback:void 0,behavior:"fromDrop"}),n.authorizedWithKind.Change&&n.authorizedWithKind.Change.length>0&&i.loadChangeV2&&i.loadChangeV2({content:"3DXContent",objects:n.authorizedWithKind.Change,callback:void 0,behavior:s}),n.authorizedWithKind.DesignEnv&&n.authorizedWithKind.DesignEnv.length>0&&(require("DS/PADServices/utils/GlobalModelEvents").publish({event:"ENXModel/DesignEnv/add",data:{designEnv:n.authorizedWithKind.DesignEnv,pseModel:i.options.model,resolve:function(e){i.dropInvitContainer&&i.dropInvitContainer.hide()}}}),i.dispatchEvent("onAddDesignEnv",{designEnvIds:n.authorizedWithKind.DesignEnv.map(e=>e.objectId)}))):i.add({content:"3DXContent",authorized_objects:n.authorized_objects,callback:void 0,behavior:s})})}}return e.dataTransfer.params?s(e.dataTransfer.params):n.retrieveAuthorizedObjects({notifPerObjects:!0,displayNotif:!1,dnd_event:e,callback:s,version:"2.0"}),!1},dropOnInvite:function(e){if(this._onDropContent(e),this.dropInvitContainer){var t=this.options.model.detachedRoots?this.options.model.detachedRoots.length:0;0===this.options.model.getRoots().length&&0===t?this.dropInvitContainer.show("drop"):this.dropInvitContainer.hide(this.dropInvitContainer.active_invite),"treelistview"===this.options.active_view&&this.getPADTreeListView().getManager().getScroller().getContent().removeClassName("wux-ui-state-drag-over")}},_isDroppableInBody:function(){return null===sessionStorage.isNotDroppableInBody||"true"!==sessionStorage.isNotDroppableInBody},_updateWithBIProxyInfos:function(e,t){var o=!1;for(let t=0;t<e.length&&!1===o;t++)e[t].isRoot()&&!0===e[t].options.filtered&&(o=!0);if(this._biFilter&&o){var n=this._biFilter.getCtxForSharing();n&&(t.biProxyCtx=n)}}})}),define("DS/ENXNav/utils/FindInCtx",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";function o(){return"object"==typeof o.instance?o.instance:(o.instance=this,this)}return o.prototype.launchFindWithDialog=function(t){var o=this;require(["DS/ENXNav/views/private/SearchView"],function(n){new n({placeholder:e.searchview.searchPlaceholder,target:t.dgvView?t.dgvView:t.renderTo,position:t.position,events:{onSearch:function(e){o.launchFind({nodes:[t.node],searchFts:e.searchFts,rscId:e.rscId})}}})})},o.prototype.launchFind=function(e){require(["DS/PADServices/utils/PredefinedQueryUtils"],function(o){e.searchFts?o.isPredefinedQry(e.searchFts).then(function(o){t.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFts:o,searchFtsOriginal:e.searchFts,rscId:e.rscId,doNotBroacast:e.doNotBroacast}})}):t.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFtsOriginal:e.searchFts,rscId:e.rscId,doNotBroacast:e.doNotBroacast}})})},new o}),define("DS/ENXNav/views/private/externalColumnsViews/UtilsColumns",["DS/PADServices/utils/Dimensions","DS/PADServices/settings/AppSettings"],function(e,t){"use strict";var o=null;const n=-1;function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this)}return i.prototype.getURLParameter=function(e){return null===o&&((o=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null)||(o=location.search.length?location.search:null)),o&&decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(o)||[null,""])[1].replace(/\+/g,"%20"))||null},i.prototype.createCSSClass=function(e,t,o){if(null===document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.id=e;let i=o||"."+e;n.innerHTML=i+t,document.getElementsByTagName("head")[0].appendChild(n)}},i.prototype.launchIfEnabled=function(e,t){let o=e.getCommand(t);o&&o.isEnabled()&&o.begin()},i.prototype.executeGenericTooltip=function(o,i){let s;return s=o.rowID===n?i.getCellDefaultTooltip(o):function(o,n){let i;if(!0===t.getSetting("activateUnits")){let t,s="tree"===n?o.nodeModel.getLabel():o.nodeModel.getReferenceValue(n);i={shortHelp:t="object"==typeof s&&s.inputValue?s.inputValue+" "+e.getNLSForUnit(s.inputUnit):s,updateModel:!1}}else i={shortHelp:o.nodeModel.options.grid[n],updateModel:!1};return i}(o,o.dataIndex)},new i}),define("DS/ENXNav/commands/tools/_xNavColumnParam",[],function(){"use strict";return{execute:function(e){require(["DS/PADServices/views/AttributesCustomization","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2"],function(t,o,n){let i=o.getModelEvents(),s=[];if(e.dgv&&e.dgv.options.dgvLayout){let t=e.dgv.options.dgvLayout.getOrderedColumnsIndexes();for(let o=0;o<t.length;o++){let n=e.dgv.options.dgv.getColumnOrGroup(t[o]);s.push(n)}}else s=e.tree.options.columns;let r=e.dgv?e.dgv.options.viewMode:e.tree.options.viewMode,a=!!e.dgv,l=e.dgv?e.dgv.options.dgvLayout.rowsHeader:void 0,d=n.getDefaultTypesAndExtensions();e.dgv.columnOrdering=!0,new t({modelEvents:i,viewMode:r,appColumns:s,baseTypes:n.getBaseTypes(),baseInstanceTypes:n.getBaseInstanceTypes(),selectedTypes:n.getSelectedTypes(),selectedExtensions:n.getSelectedExtensions(),defaultTypes:d.defaultTypes,defaultExtensions:d.defaultExtensions,withDgv:a,dgvInfo:e.dgv,rowHeaderActivated:l,attributesToIgnore:n.getAttributesToIgnore()});let c=[];c.push(i.subscribe({event:"ENXViews/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&(e.tree&&e.tree.removeColumnCB(t.removedColumns),e.dgv&&e.dgv.removeColumnCB(t.removedColumns)),t.addedColumns&&(e.tree&&e.tree.addColumnCB(UWA.clone(t.addedColumns)),e.dgv&&e.dgv.addColumnCB(UWA.clone(t.addedColumns)));break;case"visibilityColumn":e.tree&&e.tree.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag),e.dgv&&e.dgv.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag);break;case"exportColumn":e.tree&&e.tree.changeExportCB(t.modifiedColumn,t.exportFlag),e.dgv&&e.dgv.changeExportCB(t.modifiedColumn,t.exportFlag);break;case"moveColumn":e.tree&&e.tree.moveColumnCB(t),e.dgv&&e.dgv.moveColumnCB(t);break;case"changeTitle":e.tree&&e.tree.changeTitleCB(t.modifiedColumn,t.newTitle),e.dgv&&e.dgv.changeTitleCB(t.modifiedColumn,t.newTitle);break;case"pinChange":e.dgv.changePinCB(t.modifiedColumn,t.pin);break;case"rowsHeaderModification":e.dgv.changeDgvLayout({rowsHeader:t.rowsHeader});break;case"changeColor":e.tree&&e.tree.changeColorCB(t.modifiedColumns,{"background-color":t["background-color"],color:t.color}),e.dgv&&e.dgv.changeColorCB(t.modifiedColumns,{"background-color":t["background-color"],color:t.color});break;case"changeViewMode":e.tree&&e.tree.compactMode(t),e.dgv&&e.dgv.compactMode(t);break;case"close":e.xnav_app.options.isDeEnabled&&e.xnav_app.hasActiveDesignExp()&&e.xnav_app.getPseService().addOrRemoveCompareFunction(e.dgv,"add"),t.selectedExtensions&&t.selectedTypes&&n.updateSelectedParams({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}),e.dgv?e.dgv.saveCustoView(t.applyOnlyToThisApp):e.tree&&e.tree.saveCustoView(t.applyOnlyToThisApp),c.forEach(function(e){i.unsubscribe(e)});break;case"reset":n.resetSelectedParams(),e.dgv&&e.dgv.reset(t.parameters),e.tree&&e.tree.reset(t.parameters),c.forEach(function(e){i.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+t.what)}}))})}}}),define("DS/ENXNav/commands/GroupsLayoutCompact",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/GroupsLayout",data:{mode:"compact"}})}})}),define("DS/ENXNav/views/private/ExpandChecker",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/PADUtils/PADSettingsMgt","DS/Controls/Toggle","DS/PADServices/utils/GlobalUtils"],function(e,t,o,n){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.storageKey=n.getAppId()+"-NoCheckExpanAll",this)}return i.prototype.check=function(o){var n=this;return new Promise(function(i){for(var s=function(e){i({performExpandAll:e})},r=!1,a=0;a<o.roots.length;a++){var l=o.roots[a];l.hasSynthesis()&&(t.getSetting("maxNumberOfLeaves")<=l.getSynthesis("leafSynthesis")?(r=!0,console.log("Too many leaves (>"+t.getSetting("maxNumberOfLeaves")+")")):t.getSetting("maxNumberOfOcc")<=l.getSynthesis("occSynthesis")?(r=!0,console.log("Too many occurences (>"+t.getSetting("maxNumberOfOcc")+")")):t.getSetting("maxNumberOfObj")<=l.getSynthesis("flatSynthesis")&&(r=!0,console.log("Too many objects (>"+t.getSetting("maxNumberOfObj")+")")))}r?"TRUE"!==localStorage.getItem(n.storageKey)?require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(t,i){n.modalStop=new t({target:o.targetDiv,title:e.expandChecker.title,content:n.buildContent(),modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,width:"auto",height:"auto",position:{my:"center",at:"center"},buttons:{No:new i({domId:"enxnav-expand-checker-no",touchMode:!0,onClick:function(){s(!1),n.modalStop.close()}}),Yes:new i({domId:"enxnav-expand-checker-yes",touchMode:!0,onClick:function(){var e=n.toggleAskAgain.checkFlag;localStorage.setItem(n.storageKey,e?"TRUE":null),s(!0),n.modalStop.close()}})}})}):s(!0):s(!0)})},i.prototype.buildContent=function(){var t=new UWA.Element("div",{class:"enx-expandchecker-content"});new UWA.Element("div",{class:"enx-expandchecker-text"}).inject(t).setHTML(e.expandChecker.content);var n=new UWA.Element("div",{class:"enx-expandchecker-checker"}).inject(t),i=this.toggleAskAgain=new o({type:"checkbox",label:e.expandChecker.askAgain}).inject(n);return i.getContent().addClassName("enx-expandchecker-toggle"),i.addEventListener("change",function(e){e.dsModel.checkFlag?this.helpCheckerDiv.removeAttribute("hidden"):this.helpCheckerDiv.setAttribute("hidden","")}.bind(this)),(this.helpCheckerDiv=new UWA.Element("div",{class:"enx-expandchecker-checkerhelp"}).inject(t)).setText(e.expandChecker.checkerhelp),this.helpCheckerDiv.setAttribute("hidden",""),t},new i}),define("DS/ENXNav/commands/_xNavActionBar",["UWA/Core","DS/ApplicationFrame/ActionBar","DS/RuntimeView/NLSManager","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt"],function(e,t,o,n,i,s){"use strict";function r(s){this.options={action_bar:{file:null,module:null,context:null,hidden:null,language:"en"},renderTo:null,callback:{onactionbarcb:null}},n.set(s.xnav_app),this.options=e.extend(this.options,s,!0),o.DEFAULT_LANGUAGE=this.options.action_bar.language;var r=new t(this.options.action_bar),a=this;if(UWA.is(this.options.callback.onactionbarcb,"function")){if(UWA.is(r.onActionBarDisplay,"function"))var l=r.onActionBarDisplay(function(){r._modelEvents.unsubscribe(l),a.options.callback.onactionbarcb.call(null,"onActionBarDisplay")});var d=r.onActionBarReady(function(){r._modelEvents.unsubscribe(d),a.options.callback.onactionbarcb.call(null,"onActionBarReady")})}"ENOPS_app"===r.options.module?r.elements.container.addClassName("xnav_actionbar_ENOPS"):r.elements.container.addClassName("xnav_actionbar"),r.elements.container.addEventListener("click",function(e){const t=e.currentTarget.getAttribute("data-open");a.options.action_bar.hidden?a.options.action_bar.hidden!==t&&(a.options.action_bar.hidden=t,i.publish({event:"ENXViews/ActionBar/statusChanged",data:{dataOpen:t}})):(a.options.action_bar.hidden=t,i.publish({event:"ENXViews/ActionBar/statusChanged",data:{dataOpen:t}}))}),!0===r._preferences.getIsCollapsedPreference()?a.options.action_bar.hidden=!1:a.options.action_bar.hidden=!0,r.inject(this.options.renderTo),this.options.xnav_ab=r,i.subscribe({event:"ENXViews/ActionBar/hide"},function(){a.options.xnav_ab.close()}),i.subscribe({event:"ENXViews/ActionBar/status"},function(){i.publish({event:"ENXViews/ActionBar/statusChanged",data:{dataOpen:a.options.action_bar.hidden.toString()}})})}return r.prototype={mergeGraphSection:function(){this.options.xnav_ab.loadModel({merge:!0,file:"GraphViewAB.xml",module:"ENXNav"})}},r}),define("DS/ENXNav/mixins/xNavWidgetLink",["UWA/Class","DS/ENOXInterWdgCom/LinkManager","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/GlobalUtils","DS/PADUtils/PADPromise","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/settings/AppSettings","DS/PADUtils/PADUtilsServices","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt"],function(e,t,o,n,i,s,r,a,l,d,c,p){return e.extend({setupWidgetLink:function(){if(!window.__karma__||p.getSetting("widgetlink-odt")){this._initialPathes=new Map,this.addEvent("onAddPaths",function(e){for(let t=0;t<e.addedPaths.length;t++){let o=e.addedPaths[t][0];this._initialPathes.get(o)?this._initialPathes.get(o).push(e.addedPaths[t]):this._initialPathes.set(o,[e.addedPaths[t]])}}),this.addEvent("onAddFilters",function(e){for(let t=0;t<e.rootIds.length;t++){let o=e.rootIds[t];this._initialPathes.get(o)?this._initialPathes.get(o).push(e.rootIds[t]):this._initialPathes.set(o,[[e.rootIds[t]]])}});var e=this;r.subscribeOnce({event:"ENXModel/Root/FBIProxy"},()=>{e.getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},function(t){e._initialPathes.delete(t.data.pid)})}),t.subscribe("DS/ExternalWdgtCom/LoadData",this._onLoadData.bind(this)),t.subscribe("DS/ExternalWdgtCom/RemoveAll",this._onRemoveAll.bind(this)),t.subscribe("DS/ExternalWdgtCom/RemoveRoot",this._onRemoveRoots.bind(this)),t.subscribe("DS/ExternalWdgtCom/GetInfosForSync",this._onGetInfosForSync.bind(this)),t.subscribe("DS/ExternalWdgtCom/SyncContent",this._onSyncContent.bind(this)),t.subscribe("DS/ExternalWdgtCom/EndSync",this._endSync.bind(this))}else console.warn("We are in karma test environment, thus preventing the use of WidgetLink.")},_onUnLink:function(e){},_onLink:function(e){},_isEventSourceCorrect:function(e,o,n){let i=!0;if(e&&"Widgets"===o){t.getLinked().filter(t=>t.id===e).length>0&&(console.warn("Please use WidgetLink instead of PlatformAPI to publish this "+n+" event if your widget "+e+" is linked to a Product Structure app"),i=!1)}return i},_onLoadData:function(e,o){if(this._isEventSourceCorrect(e.fromWidgetId,o.channel,"LoadData")){e.dropData.broadcast=!1,e.dropData.behavior="WITHOUT_CONTEXT",t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/LoadData");var i=e.dropData;if(!a.getSetting("loadWithFilterSpec"))return this.openDroppedObjects(i);if(!i.filter)return this.openDroppedObjects(i);{let e=0,t=[];const o=e=>{for(let e=0;e<t.length;++e)this._biFilter.removeEvent(t[e]);if(0===e.status&&null!==e.error)n.displayNotif({eventID:e.error.level,title:e.error.title,msg:e.error.message,key:"openWdgLnkWithFilter"});else{if("APPLY"===i.filter.intent){const e=this.options.model.getModelEvents().subscribe({event:"onRootAdded"},()=>{this.options.model.getModelEvents().unsubscribe(e),r.getModelEvents().publish({event:"ENXViews/WelcomePanel/closeLandingPage"})});return}i.withFilter=!0,this.openDroppedObjects(i)}},a=i.unserializedData.data.items;for(let n=0;n<a.length;++n){var s=`DroppedFilterSpec2D-${n}`;t.push(s),this._biFilter.addEvent(s,t=>{++e===a.length&&o(t)}),this._biFilter.setPublicFilterSpecification({rootId:a[n].objectId,rootAlias:a[n].displayName,specification:i.filter.specification,applyFilter:"APPLY"===i.filter.intent?1:0,displayFilter:"WAIT"===i.filter.intent?1:0,eventName:s})}}}},_onRemoveAll:function(e,o){this._isEventSourceCorrect(e.fromWidgetId,o.channel,"RemoveAll")&&(t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/RemoveAll"),this.empty(!1))},_onRemoveRoots:function(e,o){this._isEventSourceCorrect(e.fromWidgetId,o.channel,"RemoveRoot")&&(t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/RemoveRoot"),delete e.fromWidgetId,this._onRemoveRoot(e))},_onGetInfosForSync:function(e){if(e&&e.fromLinkManager){t.setWidgetSynchronizing(!0);let o=this.getRoots(),n=[];o&&o.length>0&&(n=o.map(e=>{const t=e.getID();e=this.options.model.searchRootById(t);return{rootID:t,pathes:this._initialPathes.get(t),serviceID:null,filterId:this._biFilter.HasFilter(t).filterId,type:e.options.type}}));let i,s=widget.getValue("x3dSharedId");i=!0===a.getSetting("explorerOcc")?require("DS/PADServices/utils/HideShowCtrl"):require("DS/PADServices/utils/HideShowController");let r={id:widget.id,sharedID:s,content:n,hiddenPaths:i.getHiddenPathsAsArray(),shownPaths:i.getShownPathsAsArray()};if(!e||!e.get)return r;t.publish("DS/ExternalWdgtCom/GetInfosForSync",r)}},_onSyncContent:function(e){var o=this;this.disableUX(),e.srcWidgetID!==widget.id?t._initiatorLinks.set(e.srcWidgetID,!1):t._initiatorLinks.set(e.fromWidgetId,!0);let n=!1;if(t.setSourceWidgetId(e.srcWidgetID),t.addWidgetLinkHit("event-2d","DS/ExternalWdgtCom/SyncContent"),e.srcWidgetID===widget.id&&"function"==typeof this._biFilter.linkWith)return t._nbWdgtsToSync=e.nbWdgtsToSync,e.rootsToSync.length>0&&r.subscribeOnce({event:"ENXModel/refresh/complete"},function(){e.hiddenPaths&&e.hiddenPaths.length>0&&o.onHide({paths:e.hiddenPaths}),e.shownPaths&&e.shownPaths.length>0&&o.onShow({paths:e.shownPaths})}),void this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:function(){n||(o.refresh(!1),t._onFinishSync(),n=!0),console.log("Linked BIProxy of "+widget.id+" with "+e.srcWidgetID)}});let s=t.createView(t=>t.id===e.srcWidgetID),a=null,l=new Promise(function(e,t){a=e});this.options.model.getRoots().length>0?r.subscribeOnce({event:"DS/InternalWdgtCom/NGFilterReset"},function(){a()}):a();var p=function(){if(console.log("Linked BIProxy of "+widget.id+" with "+e.srcWidgetID),!n){n=!0;let r=[];e.rootsToSync.forEach(e=>{r.push({rootId:e.rootID,pathes:e.pathes,filterId:e.filterId,type:e.type})}),o.empty(!1,!1,!0);let a=r.map(function(e){return{type:e.type}});if(r.length>0){var t=i.getPromises();Promise.all(t).then(function(){l.then(function(){c.isTypesAuthorized(a,function(t,n){let i=r.filter(function(e){return t.includes(e.type)});if(i.length>0){let t=[];for(let e=0;e<i.length;e++){let n=i[e];n.filterId,t.push(new Promise(function(e){o.add({paths:n.pathes,content:"pathslist",callback:function(){e()}})}))}Promise.all(t).then(function(){e.hiddenPaths&&e.hiddenPaths.length>0&&o.onHide({paths:e.hiddenPaths}),e.shownPaths&&e.shownPaths.length>0&&o.onShow({paths:e.shownPaths}),s.publish("DS/ExternalWdgtCom/FinishedSync"),r.forEach(function(e){if(o._biFilter.HasFilter(e.rootId).hasFilter){var t=o.options.model.searchRootById(e.rootId);t&&d.node.setFilterBadge(t)}})})}else s.publish("DS/ExternalWdgtCom/FinishedSync",{notSupportedError:widget.id})},!0,!1,"2.0")})})}else s.publish("DS/ExternalWdgtCom/FinishedSync")}};"function"==typeof this._biFilter.linkWith?this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:p}):r.subscribe({event:"ENXModel/Root/FBIProxy"},()=>{this._biFilter.linkWith({srcWgtId:e.srcWidgetID,callback:p})})},_unLinkBIProxy:function(e){"function"==typeof this._biFilter.unlink&&(this._biFilter.unlink({widgetId:widget.id,srcWgtId:e,NGFUXId:t.getPreviousNGFUXID(),callback:()=>{console.log("Unlinked BIProxy of"+widget.id+" from "+e)}}),t.setPreviousNGFUXID(this.getNGFUXID(!0)))},_linkBIProxy:function(e){"function"==typeof this._biFilter.linkWith&&this._biFilter.linkWith({srcWgtId:e,callback:()=>{console.log("Linked BIProxy of "+widget.id+" with "+e)}})},_endSync:function(e){var o=this,r=i.getPromises();Promise.all(r).then(function(){t.setWidgetSynchronizing(!1),o.enableUX(),e&&e.isInitiator||"undefined"!=typeof widget&&e&&!e.widgetsWithErrors.includes(widget.id)&&n.displayNotif({level:"success",message:s.syncSuccessNotif,sticky:!1})})}})}),define("DS/ENXNav/commands/view/_xNavSelectInversion",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getRoots(),n=t.getSelectedNodes();require(["DS/ENXNav/commands/view/_xNavSelectCmdsUtils"],function(e){var i=[],s=[];o.length&&(t.prepareBroadcastSelect(),t.prepareUpdate(),o.forEach(function(t){t.isSelected()&&s.push(t),t.processDescendants({processNode:function(){this.isSelected()?s.push(this):e._isAParentSelected(this,n)?s.push(this):i.push(this)}})}),n.forEach(function(e){if(!e.isRoot()){let t=e.getParent();for(;t&&(s.push(t),!t.isRoot());)t=t.getParent()}}),t.multiselect(i),t.multiunselect(s),t.pushUpdate(),t.pushBroadcastSelect())})}}}),define("DS/ENXNav/commands/xNavActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n,i,s){"use strict";var r=["ExpandAll","CollapseAll","ExpandN","SelectChildren","SelectParent","SelectSiblings","SelectLeaves","ReframeOn"],a=["ReframeAll","ReframeOn","ToggleOverview","LayoutDown","LayoutRight","LayoutUp","LayoutLeft","SwapThumbState"],l=["RootPanel","Home","Print","PrintOptions","ExportCSV","ExportCSVOptions","CleanAll"],d=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],c=["ExpandAll","CollapseAll","ExpandN"],p=["Print","ExportCSV","CleanAll"],u=["ColumnVisibility"],h=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],g=["ProductToPart"],f=["ProductToPart"],v=[];!0===i.getSetting("grpBSD")&&(v=["ExpandAll","CollapseAll","ExpandN"]);var m=["RelationIPExplorer"];function b(e,t){return-1!==e.indexOf(t)}return e.extend({init:function(e){this._parent(e);var n=this,i=(c=t.get()).options.model?c.options.model:c.getPADTreeDocument();if(o.isMobileDevice()&&-1!==h.indexOf(this.options.ID))this.disable();else if(-1!==r.indexOf(this.options.ID)&&-1!==a.indexOf(this.options.ID))this._check_view(!0),c.addEvent("onToggleView",function(){n._check_view(!0)}),i.getXSO().onPostAdd(function(){n._check_view(!0)}),i.getXSO().onPostRemove(function(){n._check_view(!0)}),i.getXSO().onEmpty(function(){n._check_view(!0)});else if(-1!==r.indexOf(this.options.ID))this._check_select(),i.getXSO().onPostAdd(this._check_select.bind(this)),i.getXSO().onPostRemove(this._check_select.bind(this)),i.getXSO().onEmpty(this._check_select.bind(this));else if(-1!==a.indexOf(this.options.ID))this._check_view(),c.addEvent("onToggleView",this._check_view.bind(this));else if(-1!==l.indexOf(this.options.ID)){this._check_roots();var s=this._check_roots.bind(this);i.addEventListener("addChild",s),i.addEventListener("removeChild",s),b(d,this.options.ID)&&(this._check_roots(),c.addEvent("onRootsVisibility",this._check_roots.bind(this)))}else if(p.indexOf(this.options.ID)&&-1!==p.indexOf(this.options.ID)){this._parent(e);var c;i=(c=t.get()).options.model?c.options.model:c.getPADTreeDocument();this.disable(),c.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}else if(b(u,this.options.ID))this._check_if_treeview(),UWA.is(c.addEvent,"function")&&c.addEvent("onToggleView",this._check_if_treeview.bind(this));else if(-1!==g.indexOf(this.options.ID)){var v=-1!==f.indexOf(this.options.ID);this._check_mono_select(v),v&&t.get().addEvent("editModeModified",function(){n._check_mono_select(v)}),i.getXSO().onPostAdd(function(){n._check_mono_select(v)}),i.getXSO().onPostRemove(function(){n._check_mono_select(v)}),i.getXSO().onEmpty(function(){n._check_mono_select(v)})}else-1!==m.indexOf(this.options.ID)&&(this.__checkDisableSupplemental(),i.getXSO().onPostAdd(this.__checkDisableSupplemental.bind(this)),i.getXSO().onPostRemove(this.__checkDisableSupplemental.bind(this)),i.getXSO().onEmpty(this.__checkDisableSupplemental.bind(this)))},execute:function(){var e=this,o=t.get(),i=o.options.model?o.options.model:o.getPADTreeDocument();switch(this.options.ID){case"treelistview":case"graphview":case"tileview":case"thumbnailview":case"treeview":require(["DS/ENXNav/commands/_xNavSwitchView"],function(t){t.execute({command_id:e.options.ID,xnav_app:o})});break;case"ExpandAll":require(["DS/ENXNav/commands/view/_xNavExpandAll"],function(e){e.execute({xnav_app:o,model:i})});break;case"CollapseAll":require(["DS/ENXNav/commands/view/_xNavCollapseAll"],function(e){e.execute({xnav_app:o,model:i})});break;case"ExpandN":require(["DS/ENXNav/commands/view/_xNavExpandN"],function(t){t.execute({xnav_app:o,model:i,position:e.options.position}),delete e.options.position});break;case"SelectAll":require(["DS/ENXNav/commands/view/_xNavSelectAll"],function(e){e.execute({xnav_app:o,model:i})});break;case"SelectChildren":require(["DS/ENXNav/commands/view/_xNavSelectChildren"],function(e){e.execute({xnav_app:o,model:i})});break;case"SelectInversion":require(["DS/ENXNav/commands/view/_xNavSelectInversion"],function(e){e.execute({xnav_app:o,model:i})});break;case"SelectParent":require(["DS/ENXNav/commands/view/_xNavSelectParent"],function(e){e.execute({xnav_app:o,model:i})});break;case"SelectSiblings":require(["DS/ENXNav/commands/view/_xNavSelectSiblings"],function(e){e.execute({xnav_app:o,model:i})});break;case"SelectLeaves":require(["DS/ENXNav/commands/view/_xNavSelectLeaves"],function(e){e.execute({xnav_app:o,model:i})});break;case"CleanAll":require(["DS/ENXNav/commands/view/_xNavCleanAll"],function(e){e.execute({xnav_app:o})});break;case"ProductToPart":require(["DS/ENXNav/commands/ProductToPart"],function(t){t.execute({command_id:e.options.ID,xnav_app:o,model:i})});break;case"ReframeAll":case"ReframeOn":case"ToggleOverview":case"LayoutDown":case"LayoutRight":case"LayoutUp":case"LayoutLeft":case"SwapThumbState":require(["DS/ENXNav/commands/_xNavGraphCmds"],function(t){t.execute({command_id:e.options.ID,xnav_app:o,model:i})});break;case"RelationIPExplorer":require(["DS/ENXNav/commands/tools/_xNavRelationIPExplorer"],function(t){t.execute({command_id:e.options.ID,xnav_app:o,model:i})});break;case"ColumnVisibility":require(["DS/ENXNav/commands/tools/_xNavColumnParam"],function(t){var n=o.options.views?o.options.views.treelistview:o.getPADTreeListView(),i=o.options.views?o.options.views.datagridview:void 0;t.execute({command_id:e.options.ID,cmd:e,xnav_app:o,tree:n,dgv:i})});break;default:throw new Error("Unknown command")}if(!0===this.options.fromCtx)delete this.options.fromCtx;else{var s=n.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});s.setEventData({eventLabel:this.options.ID}),s.trackPageEvent()}},_check_roots:function(){t.get().getPADTreeDocument().getRoots().length>0?this.enable():this.disable()},_check_added_roots:function(e){t.get().getPADTreeDocument();0===e.data.nb_root?this.disable():this.enable()},_check_select:function(){var e=t.get().getPADTreeDocument(),o=t.get().getPADTreeDocument().getXSO().get();!0===!!o.length?b(v,this.options.ID)&&(!0===e.isGroupingApplied()&&o.length>1||!0===o[0].getReferenceValue("groupApplied"))?this.disable():b(c,this.options.ID)&&!function(e){for(var t=0,o=0;o<e.length;o++){var n=e[o],i=n.getChildren();"Drawing"!==n.options.type?null!==i&&t++:i&&i.length&&t++}return t>0}(o)?this.disable():this.enable():this.disable(),s.getModelEvents().publish({event:"ENXModel/ReadWriteTriggered",data:!!o.find(e=>e.options.isReadOnly)})},_check_mono_select:function(e){if(e&&!0!==t.get().getEditMode())this.disable();else{var o=t.get().getPADTreeDocument().getXSO().get();1===o.length&&!0!==o[0].isRelationsObjectNode?this.enable():this.disable()}},__checkDisableSupplemental:function(e){let o=!0;var n=t.get().getPADTreeDocument().getXSO().get();for(let e=0;e<n.length;e++)if(!0===n[e].isSupplemental()){o=!1;break}o?this.enable():this.disable()},_check_edit_mode:function(){1==t.get().getEditMode()&&this.disable()},_check_view:function(e){if(!0===e){var o=!!t.get().getPADTreeDocument().getXSO().get().length;"graphview"===t.get().options.active_view&&!0===o?this.enable():this.disable()}else{switch(t.get().options.active_view){case"tileview":case"thumbnailview":t.get().getPADTreeDocument()._pagerview&&t.get().getPADTreeDocument()._pagerview.hide();break;case"treelistview":case"graphview":t.get().getPADTreeDocument()._pagerview&&t.get().getPADTreeDocument()._pagerview.show()}"graphview"===t.get().options.active_view?this.enable():this.disable()}},_check_if_treeview:function(){if(i.getSetting("readOnlyDashboard"))this.disable();else switch(t.get().getPADTreeDocument().options.active_view){case"treelistview":case"datagridview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}}})}),define("DS/ENXNav/views/private/externalColumnsViews/responsible",["css!DS/ENXNav/ENXNav.css","text!DS/ENXNav/assets/templates/responsibleTooltip.html","DS/PADServices/utils/AttributesMgtV2","DS/i3DXCompassServices/i3DXCompassServices","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/ApplicationFrame/CommandsManager","DS/Handlebars/Handlebars","DS/PADUtils/Configuration","DS/PADUtils/PADContext"],function(e,t,o,n,i,s,r,a,l,d){"use strict";var c=a.compile(t),p=null,u=function(e,t){let o;return p&&(o=p+"/api/user/getpicture/login/"+e,t&&(o+="/format/"+t)),o},h={"ds6w:responsible":{getCellTooltip:function(e,t){let o;if(-1===e.rowID)o=t.getCellDefaultTooltip(e);else{var n=e.nodeModel?e.nodeModel.options.grid.owner:void 0;if(n&&p){o={shortHelp:c({responsible:e.nodeModel.getReferenceValue("ds6w:responsible"),url:u(n,"normal")}),allowUnsafeHTMLShortHelp:!0,updateModel:!1}}else o={shortHelp:e.nodeModel.getReferenceValue("ds6w:responsible")}}return o},buildColumn:function(e){o.addBIColumn("owner",!1);var t=!0;return!l.getConfig("readOnlyApp")&&(t=!1),Object.assign({dataIndex:"ds6w:responsible",kind:"user",minWidth:150,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"user"},getCellValue:function(e){var o=e.nodeModel&&e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:void 0,n=o?u(o):void 0;let i;i=n?{iconPath:"url("+n+")",className:"dgv-user-thumbnail"}:{iconName:"topbar-user",fontIconFamily:1};var s=e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0;if(s){let o={icon:i,label:s};return!1===t&&(o.module="DS/ENXNav/views/private/externalColumnsViews/responsible",o.func="launchCmd",o.argument={nodeModel:e.nodeModel}),o}},getCellValueForExport:function(e){return e&&e.nodeModel?e.nodeModel.options.grid["ds6w:responsible"]:void 0}},e)}},launchCmd:function(e){if(!0===d.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{var e=r.getCommand("ActionBar_TransferOwnership");e&&e.begin()},t)}}};return new Promise(e=>{p?e(!0):void 0===p?e(!1):n.getServiceUrl({serviceName:"3DSwym",platformId:s.getPlatformId(),onComplete:t=>{e(void 0!==(p=t))},onFailure:()=>{p=void 0,e(!1)}})}),h}),define("DS/ENXNav/mixins/xNavLeftSidePanel",["DS/PADServices/views/ENXLeftSidePanel","DS/PADServices/utils/GlobalModelEvents","DS/Utilities/Utils","DS/TreeModel/TreeNodeModel"],function(e,t,o,n){"use strict";function i(){}return i.prototype.createRootListSlidder2=function(){var i=this;return this.leftsidepanel=new e,this.options.model.onNodeModelUpdate(function(e){var i=[],s=[];e.data.nodeModel.isRoot()&&e.data.nodeModel.getNodeSource()!==n.NODE_SOURCE.GROUPING&&(-1===s.indexOf(e.data.nodeModel.getID())&&(s.push(e.data.nodeModel.getID()),i.push(e.data.nodeModel)),this.__debounceRootSync=this.__debounceRootSync?this.__debounceRootSync:o.debounce(()=>{0;for(let e=0;e<i.length;e++)t.publish({event:"ENXModel/Root/sync",data:i[e]})},350),this.__debounceRootSync())}),t.subscribe({event:"ENXModel/Root/select"},this._onTileSelect.bind(this)),t.subscribe({event:"ENXModel/Root/addTile"},this.openDroppedObjects.bind(this)),t.subscribe({event:"ENXModel/Root/removeTile"},this._onRemoveTile.bind(this)),t.subscribe({event:"ENXModel/DesignEnv/added"},function(){i.openPanel("left")}),this.leftsidepanel.getContent()},i.prototype._onTileSelect=function(e){if(!UWA.is(e.tile_ids,"array"))throw new Error("Invalid input param, no params.tile_ids defined");var t=this;t.options.model.withBroadcastSelect(function(){t.options.model.unselectAll(),e.tile_ids.forEach(function(o){var n=t.options.model.searchRootById(o);n&&!0!==n.isFiltered()?(n.select(),1===e.tile_ids.length&&t.options.model.getModelEvents().publish({event:"onCenterGraph",data:n})):console.log("Cannot find ["+o+"] in the TreeDocument")})})},i.prototype._onRemoveTile=function(e){if(!e.all){if(!UWA.is(e.tile_id))throw new Error("Invalid input parameter");var t=this.options.model.searchRootById(e.tile_id);return UWA.is(t)&&this.options.model.removeRoot(t),!1}this.options.model.empty()},i}),define("DS/ENXNav/views/customize_views/_xNavDGVUtils",["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/HideShowController","i18n!DS/ENXNav/assets/nls/ENXNav"],function(e,t,o,n,i){"use strict";function s(e){e.typeRepresentation=void 0===e.typeRepresentation?"string":e.typeRepresentation;const t=e.dataIndex;e.filterOptions={mapPossibleValues:function(e){return new Promise(function(n){setTimeout(function(){let i={};i[t]=e,o.retrieveNLS({nlsData:i}).then(function(e){if(e&&Object.keys(e).length>0){const o=Object.values(e[t]);n(o)}else n({})})},0)})}}}function r(e){}return r.prototype.buildColumns=function(t){return new Promise(function(t,n){var i=[],s=0,r=e.getColumnsOrder(void 0);e.updateAttributesWithKind(void 0).then(function(){for(s=0;s<r.length;s++){var n=e.getColumn(r[s],void 0);if(n){let e=null;n.ds6w&&this.options.columnViews[n.ds6w]?e=this.options.columnViews[n.ds6w].AMD[n.ds6w].buildColumn(n):n.dataIndex&&this.options.columnViews[n.dataIndex]&&(e=this.options.columnViews[n.dataIndex].AMD[n.dataIndex].buildColumn(n)),null===e&&(e=this.buildColumnFromSetting(n)),null!==e&&i.push(e)}}var a=UWA.clone(i);o.updateColumnsWithNLS(a,function(e){var o={};o.columns=a,"success"===e.status&&(o.columns=e.columns),t(o)})}.bind(this)).catch(n)}.bind(this))},r.prototype.buildColumnFromSetting=function(t){var o=Object.assign({minWidth:50,editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},t);if(!UWA.is(o.dataIndex)&&"actualIndex"!==o.dataIndex){if(!UWA.is(o.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(t)+"]");o.dataIndex=o.ds6w}!UWA.is(o.ds6w)&&!0!==o.isAdditionalColumn&&e.isAttributeColumn(o.dataIndex)&&"asset-type"!=o.dataIndex&&(o.ds6w=o.dataIndex,UWA.is(o.kind)||(o.kind=null),"actualIndex"!==o.dataIndex&&console.warn(o.dataIndex+" column attribute missing ds6w"));switch(-1!==["hide_show","find_in_ctx","actualIndex"].indexOf(o.dataIndex)&&(o.customisation=UWA.extend(o.customisation,{exportable:{lock:!0,value:!1}})),o.kind&&("timestamp"===o.kind||"dateTime"==o.kind?o.typeRepresentation="datetime":o.typeRepresentation||(o.typeRepresentation=o.kind)),o.typeRepresentation||(o.typeRepresentation="string"),o.dataIndex){case"thumbnail":o.ds6w=void 0,o.alignment="center",o.typeRepresentation="image";break;case"tree":o.getCellKPIColor=function(e){if(!e.isHeader&&e.nodeModel){if(e.nodeModel.options.color)return e.nodeModel.options.color;if(e.nodeModel.options.grid.bi_color)return e.nodeModel.options.grid.bi_color}};break;case"ds6w:label-Instance":o.getCellKPIColor=function(e){if(!e.isHeader&&e.nodeModel&&e.nodeModel.options.colorInstance)return e.nodeModel.options.colorInstance},o.getCellValueForExport=function(e){var t="";return-1===e.rowID?t=i.instanceName:e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid["ds6w:label-Instance"]&&(t=e.nodeModel.options.grid["ds6w:label-Instance"]),t}}return"rel"===o.ds6wFrom&&(o.icon={iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}),"boolean"!==o.typeRepresentation||o.getCellValue||(o.getCellValue=function(e){if(e.nodeModel){let i=this.getColumnOrGroup(e.columnID);var t=e.nodeModel.getReferenceValue(i.dataIndex);return n=!1,"boolean"==typeof(o=t)?n=o:"string"==typeof o?n="true"===o.toLowerCase():void 0===o&&(n=void 0),t=n}var o,n}),o},r.prototype.buildColumnsFromStorage=function(t){var o=this;return new Promise(function(n,i){var s=[],r=0;t=function(e){for(var t=[],o=!1,n=0;n<e.length;n++)"instanceName"===e[n].dataIndex?e[n].dataIndex="ds6w:label-Instance":"instanceMatrix"===e[n].dataIndex&&(e[n].dataIndex="positionMatrix-Instance"),"findinctx"===e[n].dataIndex&&(o=!0),t.push(e[n]);return!1===o&&t.push({dataIndex:"findinctx",alignment:"center",typeRepresentation:"findInCtx",width:40,minWidth:40,maxWidth:40,hasNLS:!1,noTitleColumn:!0,pinned:"right",kind:"functionIcon",visibleFlag:!1,getCellSemantics:function(e){return!0===e.nodeModel.isRelationsObjectNode?null:{}},customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}}),t}(t),e.updateAttributesWithKind(void 0,t).then(function(t){e.updateAttributesWithKind().then(function(){var i=[];for(r=0;r<t.length;r++)i.push(new Promise(function(n){var i=t[r].dataIndex;e.addAvailableColumn(i,t[r]).then(function(e){var t=null;e.ds6w&&o.options.columnViews[e.ds6w]?t=o.options.columnViews[e.ds6w].AMD[e.ds6w].buildColumn(e):e.dataIndex&&o.options.columnViews[e.dataIndex]&&(t=o.options.columnViews[e.dataIndex].AMD[e.dataIndex].buildColumn(e)),null===t&&(t=o.buildColumnFromSetting(e)),t&&s.push(t),n()})}));Promise.all(i).then(function(){var e=UWA.clone(s);n(e)})})})})},r.prototype.getTypeRepresentations=function(){return JSON.stringify(this.options.typeRepresentations)},r.prototype._exportAsCmd=function(e){if("csv"===e.exportAs){var o=this.getColumnsForExport(),n=this.options.dgv.getAsCSV({columnKeys:o,addLevelInformation:!0});t.downloadfile(n,t.getAppId()+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")}else this.options.dgv.openPrintableViewWindow(!0)},r.prototype.__addFilterModel=function(e){return new Promise(t=>{this.options.filterModel={};for(const t of e.columns){const e=this.options.columnsDefaultfilterDefinition;!0!==t.neverVisible&&!0!==t.isAdditionalColumn&&-1===e.excluded.indexOf(t.dataIndex)&&(-1!==e.set.indexOf(t.dataIndex)?(this.options.filterModel[t.dataIndex]={filterId:"set"},-1!==e.keyWithTranslation.indexOf(t.dataIndex)&&s(t)):"tree"===t.dataIndex?this.options.filterModel.label={filterId:"stringRegexp",filterModel:{}}:"string"===t.typeRepresentation?this.options.filterModel[t.dataIndex]={filterId:"stringRegexp",filterModel:{}}:"boolean"===t.typeRepresentation&&(this.options.filterModel[t.dataIndex]={filterId:"set"}))}t()})},r}),define("DS/ENXNav/commands/view/_xNavExpandAll",["DS/PADUtils/Utility","DS/PADUtils/PADSettingsMgt","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o){"use strict";return{execute:function(t){var n,i=t.model.getSelectedNodes().filter(function(e){return e.isVisible()}).sort(function(e,t){return e._getRowID()>t._getRowID()}),s=[];let r=i.filter(function(e){return e.getChildren()}),a=r.map(function(e){return e.getRoot()}).filter(function(e,t,o){return o.indexOf(e)===t});n=a;var l=function(){let n=5;s.length>2e3&&(n=1e3);var i,r,a,l=function(e,t){for(var o=[],n=e.length,i=n-1,s=[],r=0;r<n;r++)s.push(e[r]),0===r||(r+1)%t!=0&&r!==i||(o.push(s),s=[]);return o}(s,n);i=t.model,t.xnav_app,(r=l).length,o.loadingText,(a=e.createStepper(r,i,function(e,t){t.expandMultiSelect({nodes2Expand:e,expandAll:!0,tagger:!1,callback:function(){a()}})},function(){i.notifyTagger()}))()};(s=r).length>1?require(["DS/ENXNav/views/private/ExpandChecker"],function(e){var t=document.getElementsByClassName("enx-appMainBody");t&&1===t.length?(t=t[0],e.check({targetDiv:t,roots:n}).then(function(e){!0===e.performExpandAll&&l()})):l()}):1===s.length&&s[0].expandAll()}}}),define("DS/ENXNav/views/xNavResponsiveThumbnailsView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/ApplicationFrame/CommandsManager"],function(e,t,o,n,i,s){"use strict";return e.extend(o,n,{name:"xNavResponsiveThumbnailView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0),o=this.options.grid=new i(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),this._originalApplyAttributes=o._applyAttributesOnCell.bind(o),o._applyAttributesOnCell=this._applyAttributesOnCell.bind(this),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){s.getCommand("Copy").begin()}),o.onCellsPaste(function(e){s.getCommand("Paste").begin()}),o.onCellsCut(function(e){s.getCommand("Cut").begin()}),UWA.is(o.onCellsEscape,"function")&&o.onCellsEscape(function(e){s.getCommand("Uncut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})},_applyAttributesOnCell:function(e){var t=e;void 0===e.nodeModel&&(t.nodeModel=this.options.grid._getModelAt(e.cellID),t.cellView=this.options.grid._getViewAt(e.cellID)),t.nodeModel.options.isBeingCut?t.cellView.getContent().addClassName("pad-state-is-being-cut"):t.cellView.getContent().removeClassName("pad-state-is-being-cut"),this._originalApplyAttributes(e)}})}),define("DS/ENXNav/utils/xNavKindProcessor",["UWA/Class"],function(e){return e.singleton({loadKinds:function(e,t,o,n,i){t.authorizedWithKind?(t.authorizedWithKind.Product&&t.authorizedWithKind.Product.length>0&&e.add({content:"3DXContent",authorized_objects:t.authorizedWithKind.Product,callback:i,behavior:o,initLoad:!0}),t.authorizedWithKind.Filter&&t.authorizedWithKind.Filter.length>0&&e.addFilter({content:"3DXContent",filter_objects:t.authorizedWithKind.Filter,callback:i,behavior:o,initLoad:!0}),t.authorizedWithKind.Change&&t.authorizedWithKind.Change.length>0&&e.loadChangeV2&&e.loadChangeV2({content:"3DXContent",objects:t.authorizedWithKind.Change,callback:i,behavior:o,initLoad:!0})):e.add({content:"3DXContent",authorized_objects:t.authorized_objects,behavior:o,kindProcessor:!0})}})}),define("DS/ENXNav/commands/RemoveGroupColor",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/RemoveGroupColor",data:{}})}})}),define("DS/ENXNav/commands/view/_xNavSelectSiblings",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var n=[],i=[];o.forEach(function(e){var t=e.getParent(),o=JSON.stringify(e.getOccurencePath());n.push(o),t.getChildren().forEach(function(e){var t=JSON.stringify(e.getOccurencePath());-1===n.indexOf(t)&&o!==t&&(i.push(e),n.push(t))})}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()}}}),define("DS/ENXNav/views/private/externalColumnsViews/cadMaster",["DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeNodeModel"],function(e,t){"use strict";const o=new Map,n=["CATIAV5","SOLIDWORKS","NX","CREO","SOLIDEDGE","ALTIUM","INVENTOR","AUTOCAD","CAAUPSAPP","CADENCEALLEGRO","3DEXPERIENCE","EPLAN","SURPAC","CADENCEPULSE","XPEDITIONEDM","ZUKENDSCR","ICAD","SUPPLEMENTAL"];for(var i=0;i<n.length;i++)o.set(n[i],e.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+n[i]+".png"));return{"ds6w:cadMaster":{getCellTooltip:function(e,t){let o;return o=-1===e.rowID?t.getCellDefaultTooltip(e):{shortHelp:e.nodeModel.getReferenceValue("ds6w:cadMaster"),updateModel:!1}},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:cadMaster",kind:"image",width:40,minWidth:40,editableFlag:!1,typeRepresentation:"image",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(e){var n;if(!0!==e.isHeader&&e&&e.nodeModel&&e.nodeModel.options.grid)return e.nodeModel.options.grid["ds6w:cadMaster"]?n=o.get(e.nodeModel.options.grid["ds6w:cadMaster"]):e.nodeModel.isRelationsObjectNode||e.nodeModel.getNodeSource()===t.NODE_SOURCE.GROUPING||(n=o.get("3DEXPERIENCE")),n?{iconPath:n,iconSize:{height:"22px"}}:""},getCellValueForExport:function(e){if(-1===e.rowID)return null;var t="";return e&&e.nodeModel&&e.nodeModel.options.grid&&e.nodeModel.options.grid["ds6w:cadMaster"]&&(t=e.nodeModel.options.grid["ds6w:cadMaster"]),t}},e)}}}}),define("DS/ENXNav/views/xNavInitError",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,o,n,i){"use strict";return n.extend(i,{name:"pad_bigerror",init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"pad_error_all"}),this.elements.errormsg=UWA.createElement("span",{class:"pad_error_msg"}),this.elements.errormsg.innerHTML=e.msg,this.elements.errormsg.inject(this.elements.container)}})}),define("DS/ENXNav/mixins/EventHooks",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/views/PADProgressBar","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o,n,i){function s(e){var o=t.getCommand("ExpandAll");o&&(e?o.enable():o.disable())}return e.extend({setupEventHooks:function(e){let t=this;o.subscribe({event:"ENXNav/parser/expandAll/begin"},function(){s(!1),t.beginBlockingTransaction(i.expand.expandPending)}),o.subscribe({event:"ENXNav/parser/expandAll/complete"},function(){s(!0),t.endBlockingTransaction()}),o.subscribe({event:"ENXModel/refresh/begin"},function(){t.beginBlockingTransaction(i.refresh_ongoing)}),o.subscribe({event:"ENXModel/refresh/complete"},function(e){t.endBlockingTransaction(),e&&e.skipSyncModel||setTimeout(function(){o.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})},100)}),o.subscribe({event:"ENXModel/Model/ApplyGrouping"},function(e){(e.fromGroupingEvent||e.fromApplyFilter||e.fromLayoutChange)&&e.groups.length&&t.beginBlockingTransaction(i.groupingNode.applyGrouping)}),o.subscribe({event:"ENXModel/Model/ApplyGrouping/Done"},function(e){e.fromEvent&&t.endBlockingTransaction()}),o.subscribe({event:"ENXModel/Model/ApplyGrouping/Active"},function(e){t.options.groupingActivated=e.active})}})}),define("DS/ENXNav/commands/CmdUtils",["DS/PADUtils/PADContext","DS/ApplicationFrame/CommandsManager","DS/PADServices/utils/GlobalModelEvents","DS/etree/syncwidget"],function(e,t,o,n){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.context=e.get(),this.model=this.context.options.model,this.availabilities={managedCommands:[],selection:{sensitiveToselection:[],monoselection:[],onlyRoot:[],atleastonehidden:[],atleastonevisible:[],lessExpandedThumbs:[],moreExpandedThumbs:[]},notInView:{sensitiveToView:[],dgv:[],graph:[],thumbs:[],tiles:[]},noGrp:[],onlyInCtxMenu:[]},this.model.getXSO().onPostAdd(this._checkCommands.bind(this)),this.model.getXSO().onPostRemove(this._checkCommands.bind(this)),this.model.getXSO().onEmpty(this._checkCommands.bind(this)),o.subscribe({event:"ENXModel/HideShowTriggered"},this._checkCommands.bind(this)),o.subscribe({event:"ENXModel/Model/ApplyGrouping/Active"},this._checkCommands.bind(this)),this.context.addEvent("onToggleView",this._checkCommands.bind(this)),this)}return i.prototype.checkAvailability=function(){this._checkCommands()},i.prototype.selectionMgt=function(e,t){-1===this.availabilities.managedCommands.indexOf(e)&&this.availabilities.managedCommands.push(e),this.availabilities.selection.sensitiveToselection.push(e),!0===(t=t||{}).monoselection&&this.availabilities.selection.monoselection.push(e),!0===t.onlyRoot&&this.availabilities.selection.onlyRoot.push(e),!0===t.atleastonehidden&&this.availabilities.selection.atleastonehidden.push(e),!0===t.atleastonevisible&&this.availabilities.selection.atleastonevisible.push(e),!0===t.lessExpanded&&this.availabilities.selection.lessExpandedThumbs.push(e),!0===t.moreExpanded&&this.availabilities.selection.moreExpandedThumbs.push(e),!0===t.noGrp&&this.availabilities.noGrp.push(e)},i.prototype.viewMgt=function(e,t){-1===this.availabilities.managedCommands.indexOf(e)&&this.availabilities.managedCommands.push(e),this.availabilities.notInView.sensitiveToView.push(e),!0===(t=t||{}).nodgv&&this.availabilities.notInView.dgv.push(e),!0===t.nograph&&this.availabilities.notInView.graph.push(e),!0===t.nothumbs&&this.availabilities.notInView.thumbs.push(e),!0===t.notiles&&this.availabilities.notInView.tiles.push(e)},i.prototype._checkCommands=function(){for(var e=this.model.getXSO().get(),o=!0,n=!0,i=!0,s=0;s<e.length;s++){var r=!!e[s].options.isPADHidden;e[s].isRoot()||(o=e[s].isRoot()),r?i=!1:n=!1}var a=this.context.getCurrentView();for(s=0;s<this.availabilities.managedCommands.length;s++){var l=this.availabilities.managedCommands[s],d=t.getCommand(l,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);d&&this._checkCmdView(l,d,a,o,n,i,e.length,e)}},i.prototype._checkCmdView=function(e,t,o,n,i,s,r,a){if(-1!==this.availabilities.notInView.sensitiveToView.indexOf(e))switch(o){case"datagridview":-1===this.availabilities.notInView.dgv.indexOf(e)?this._checkCmdSelection(e,t,n,i,s,r,a):t.disable();break;case"graphview":-1===this.availabilities.notInView.graph.indexOf(e)?-1!==this.availabilities.selection.lessExpandedThumbs.indexOf(e)||-1!==this.availabilities.selection.moreExpandedThumbs.indexOf(e)?this._checkCmdThumb(e,t,n,i,s,r):this._checkCmdSelection(e,t,n,i,s,r,a):t.disable();break;case"thumbnailview":-1===this.availabilities.notInView.thumbs.indexOf(e)?this._checkCmdSelection(e,t,n,i,s,r,a):t.disable();break;case"tileview":-1===this.availabilities.notInView.tiles.indexOf(e)?this._checkCmdSelection(e,t,n,i,s,r,a):t.disable()}else this._checkCmdSelection(e,t,n,i,s,r,a)},i.prototype._checkCmdThumb=function(e,t,o,i,s,r,a){a=this.model.getXSO().get();var l=function(e,t){for(var o=t.length,i=0,s=0,r=0;r<o;r++){var a=t[r];e.getThumbnailState(a)===n.ThumbnailState.EXPANDED?i++:s++}return i>s}(this.context.options.views.graphview,a);-1===this.availabilities.selection.lessExpandedThumbs.indexOf(e)?l?t.disable():this._checkCmdSelection(e,t,o,i,s,r):-1===this.availabilities.selection.moreExpandedThumbs.indexOf(e)&&(l?this._checkCmdSelection(e,t,o,i,s,r):t.disable())},i.prototype._checkCmdSelection=function(e,t,o,n,i,s,r){if(-1!==this.availabilities.selection.sensitiveToselection.indexOf(e))if(-1!==this.availabilities.noGrp.indexOf(e)&&(this.model.isGroupingApplied()&&s>1||r[0]&&!0===r[0].getReferenceValue("groupApplied")))t.disable();else if(s)if(!1===o&&-1!==this.availabilities.selection.onlyRoot.indexOf(e))t.disable();else{var a=!0;-1!==this.availabilities.selection.atleastonevisible.indexOf(e)&&(a=!1,!1===n?this._checkCmdVisibility(e,t,n,i):t.disable()),-1!==this.availabilities.selection.atleastonehidden.indexOf(e)&&(a=!1,!1===i?this._checkCmdVisibility(e,t,n,i):t.disable()),a&&(1===s?this._checkCmdVisibility(e,t,n,i):-1===this.availabilities.selection.monoselection.indexOf(e)?this._checkCmdVisibility(e,t,n,i):t.disable())}else t.disable();else this._checkCmdVisibility(e,t,n,i)},i.prototype._checkCmdVisibility=function(e,t,o,n){var i=!0;-1!==this.availabilities.selection.atleastonevisible.indexOf(e)&&(i=!1,!1===o?t.enable():t.disable()),-1!==this.availabilities.selection.atleastonehidden.indexOf(e)&&(i=!1,!1===n?t.enable():t.disable()),i&&t.enable()},new i}),define("DS/ENXNav/commands/_xNavSwitchView",[],function(){"use strict";return{execute:function(e){e.xnav_app.toggleView(e.command_id)}}}),define("DS/ENXNav/commands/view/_xNavSelectChildren",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();require(["DS/ENXNav/commands/view/_xNavSelectCmdsUtils"],function(e){var n=e._filterParentsOnly(o);t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var i=[];n.forEach(function(e){i.push(e),e.processDescendants({processNode:function(){i.push(this)}})}),t.multiselect(i),t.pushUpdate(),t.pushBroadcastSelect()})}}}),define("DS/ENXNav/utils/OpenWithMenuBuilder",["DS/i3DXCompassPlatformServices/OpenWith","UWA/Promise","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/PADTrackerManager"],function(e,t,o,n){function i(){}var s;return i.prototype={openWithApps:function(i,s){return new t(function(t,r){o.contentOpenWith(i,function(o){var i=new e;i.set3DXContent(o,!0),UWA.is(i.retrieveCompatibleApps,"function")?i.retrieveCompatibleApps(function(e){var o=[],i=[];if(e.forEach(function(e){i.push({type:"PushItem",title:e.text,fonticon:e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:e.icon?e.icon:"",action:{callback:function(){var t=n.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});t?(t.setEventData({eventLabel:"Ctx-openWith-"+e.name}),t.trackPageEvent()):console.warn("tracker not defined"),e.handler()}}})}),i.length>0){var r={type:"PushItem",icon:s.iconOpenWith,title:s.nlsOpenWith,submenu:i};o.push(r),o.push({type:"SeparatorItem"})}t(o)}):t([])})})}},s||(s=new i),s}),define("DS/ENXNav/commands/GroupsLayoutPath",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/GroupsLayout",data:{mode:"structured"}})}})}),define("DS/ENXNav/utils/TwoDAppEvents",["DS/PADServices/utils/GlobalModelEvents"],function(e){const t="ENX2DApp/Model/Expand",o="ENX2DApp/Model/addRoot",n="ENX2DApp/Model/addChild",i="ENX2DApp/Model/removeRoot",s="ENX2DApp/View/clearSort",r="ENX2DApp/View/refresh",a="ENXViews/WelcomePanel/closeLandingPage";function l(){}let d;return l.prototype={expand:function(o){e.publish({event:t,data:o})},addRoot:function(t){e.publish({event:o,data:t})},addChild:function(t){e.publish({event:n,data:t})},removeRoot:function(t){e.publish({event:i,data:t})},clearSort:function(t){e.publish({event:s,data:t})},refresh:function(t){e.publish({event:r,data:t})},onClearSort:function(t){e.subscribe({event:s},t)},onExpand:function(o){e.subscribe({event:t},o)},onAddRoot:function(t){e.subscribe({event:o},t)},onAddChild:function(t){e.subscribe({event:n},t)},onRemoveRoot:function(t){e.subscribe({event:i},t)},onRefresh:function(t){e.subscribe({event:r},t)},onLandingPageClosed:function(t){e.subscribe({event:a},t)}},d||(d=new l),d}),define("DS/ENXNav/commands/ColorizeGroup",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(){t.publish({event:"ENXModel/Model/ColorizeGroup",data:{}})}})}),define("DS/ENXNav/utils/OFW",["UWA/Core","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/settings/AppSettings","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser"],function(e,t,o,n,i,s,r,a){const l={version:"2.2",results:[],structures:[],viewpoint:[]},d="resetTypes",c="setTypes",p="setTypesCallback",u="setObject",h="launchApp",g="launchAppCallback";var f,v=!1;var m,b=0;function _(e,t,o){let n=e.search({match:function(e){let n=e.nodeModel.options;return o?n.relationid===t:n.resourceid===t},shouldStop:function(){return!1},useTransaction:!1});if(n.length)return n[0]}function D(e,o,n,i,s){b++,i.id=""+b;let r=!1,a=!0,l=i.resourceid;if(i.isInstance){l=i.relationid;let e=_(n,l,!0);e&&(a=!e.options.isPADHidden)}else{let e=_(n,l,!1);e&&(r=e.isSelected(),a=!e.options.isPADHidden)}var d={id:i.id,phid:l,CADOrigin:i.grid["ds6w:cadMaster"]?i.grid["ds6w:cadMaster"]:i.grid["ds6w:cadmaster"]},c={id:i.id,show:a,select:r,children:[]};if(s)o.results.push(d),s.children.push(c);else{o.results.push(d);var p={structure:[c]};o.structures.push(p)}i.children&&t.iterate(i.children,function(t){D(e,o,n,t,c)})}function S(e,t,o,n){b++,e.id=""+b;let i=e.resourceid;var s={id:e.id,phid:i,CADOrigin:"3DEXPERIENCE"};let r=t.getNodeByOccurencePath(o);if(!r&&n){let e=t.getNodesById(o[0]);for(let t=0;t<e.length&&!r;t++)!0===e[t].isRelationsObjectNode&&(r=e[t])}let a=!1,l=!0;if(r){(function(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var n=0;n<o;n++)if(e[n]!==t[n])return!1;return!0}return!1}return!1}(r.getOccurencePath(),o)||n)&&(s.CADOrigin=r.options.grid["ds6w:cadMaster"],e.isEndOfPath&&(a=r.isSelected()),l=!r.options.isPADHidden)}return{entry:s,struct:{id:e.id,show:l,select:a,children:[]}}}function x(){}return x.prototype={setTypesForOFW:function(e){if(!v){var t=this;s.subscribe(p,function(n){if(n.widgetId===o.getWidgetId()){var i=e.getSelectedNodesForOFW();if(i.length){var r;try{var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");r=a.get()}catch(e){console.warn("CfgAuthoringContext throw an error")}var p,u=e.options.context;if(u&&u.options.isDeEnabled&&u.hasActiveDesignExp()){l&&l.version&&(l.version="2.5");var g={phid:u.getActiveDesignExp().getID()}}if("ENOUC5C_AP"===n.appId&&1===i.length&&i[0].relatedCADDocs&&(p=i[0].relatedCADDocs.getSelectedNodes()),!t._checkDirectOpen(n,i,p,r)){let o=Promise.resolve();if("function"==typeof e.isGroupingApplied&&e.isGroupingApplied()){let t=[];for(let e=0;e<i.length;e++)!0===i[e].isGroupingNode&&t.push(i[e]);t.length&&(o=new Promise(t=>{e.focusOnGroups().then(()=>{let o=e.getSelectedNodesForOFW();i=[];for(let e=0;e<o.length;e++)!0!==o[e].isGroupingNode&&i.push(o[e]);t()})}))}o.then(function(){var o="SWXCSWK_AP"!==n.appId&&"ENOUSWC_AP"!==n.appId;t.buildDataForSetTypes(i,e,o).then(function(o){e._getLastViewpoint(function(i){if(i.success&&o.viewpoint.push(i.viewpoint),r&&(o.workUnder=r),u&&u.options.isDeEnabled&&g&&(o.designExp=g),"function"==typeof e.isGroupingApplied&&e.isGroupingApplied()){let t=e.getGroupingForOpen();e.isOccModel?(o.grouping=t.grouping,o.groupByBS=t.groupByBS):o.grouping=t}p&&t._appendCADDocs(o,p);var a=JSON.stringify(o),l={appId:n.appId,widgetId:n.widgetId,fileName:"-file",fileContent:a};s.publish(h,l)})})})}}else{s.publish(d);var v={appId:n.appId,widgetId:n.widgetId};s.publish(h,v,function(e){s.publish(c,f)})}}}),v=!0}f||(f={widgetId:o.getWidgetId()}),s.publish(c,f)},buildDataForSetTypes:function(o,n,i){i=void 0===i||i;var s=e.clone(l);return new Promise(function(e,l){let d={};if(t.iterate(o,function(e){var t=e.getRoot().getID();d[t]||(d[t]={paths:[],isFiltered:!1}),!0===e.isRelationsObjectNode?(d[e.options.resourceid]||(d[e.options.resourceid]={paths:[],isFiltered:!1}),d[e.options.resourceid].paths.push([e.options.resourceid]),d[e.options.resourceid].isRelationsObjectNode=!0,i=!1):d[t].paths.push(e.getOccurencePath())}),i){var c=[];let t=Object.keys(d);t=function(e,t){if(e.length>1){let o=t.map(function(e){return e.getID()}),n=o.slice();return e.length<o.length&&(n=n.filter(function(t){return e.includes(t)})),n}return e}(t,n.getRoots());for(var p=0;p<t.length;p++)c=c.concat(d[t[p]].paths);b=0,(u=c,h=t,g=n,new Promise(function(e,t){let o=Promise.resolve();void 0===r.expandv2&&(o=r.initialize({addDefaults:!0})),o.then(()=>{if(void 0===g.options.FBIProxy)return void console.log("OFW: Missing parameter FBIProxy on the given treedocument");let o={pathIds:u,data:{expandLevel:"-1"},FBIProxy:g.options.FBIProxy,timeout:3e4};("function"==typeof g._getExpandFunc?g._getExpandFunc(g._getAuthoringFlag()):r.expandv2.bind(r))(o).then(function(t){let o="string"==typeof t?JSON.parse(t):t;a.ofwPrep({wsResponse:o,expandLevel:-1,rootIds:h}).then(function(t){e(t)})}).catch(t)})})).then(function(t){for(let e=0;e<t.length;e++)D(o,s,n,t[e]);e(s)})}else{let o={};t.iterateObj(d,function(e,i){let r,a=e.paths,l=e.isRelationsObjectNode;t.iterate(a,function(e){let i=e.length-1;t.iterate(e,function(t,a){let d=o[t];void 0===d&&(d=S({resourceid:t,isEndOfPath:a===i},n,e,l),s.results.push(d.entry),o[t]=d),r?r.children.push(d.struct):s.structures.push({structure:[d.struct]}),r=d.struct})})}),e(s)}var u,h,g})},_checkDirectOpen:function(t,r,a,l){if((!a||0===a.length)&&"ENOUC5C_AP"===t.appId&&1===r.length&&r[0].isRoot()&&!r[0].options.filtered&&(!e.is(l)||""===l.change.id)&&!0===i.getSetting("directOpenPCS")){var d={objectId:r[0].getID(),envId:n.getPlatformId(),contextId:o.getSecurityContext(),serviceId:"3DSpace"};s.publish(u,d),s.subscribe(g,function(e){e.appId===t.appId&&e.widgetId===t.widgetId&&s.publish(u,{objectId:"",envId:n.getPlatformId(),contextId:"",serviceId:"3DSpace"})});var p={appId:t.appId,widgetId:t.widgetId};return s.publish(h,p,function(e){s.publish(c,f)}),!0}return!1},_appendCADDocs:function(e,t){let o,n,i;for(n=(new Date).valueOf(),o=0;o<t.length;o++)"XCADNonPSBaseRepReference"!==t[o].options.type&&"Drawing"!==t[o].options.type||(n++,i=""+t[o].options.physicalid,e.results.push({id:""+n,phid:i}),e.structures.push({structure:[]}),e.structures[e.structures.length-1].structure.push({id:""+n,show:!0,select:!1,children:[]}))}},m||(m=new x),m}),define("DS/ENXNav/utils/xNavCustoStorageOptim",["UWA/Core","DS/PADUtils/PADSettingsMgt"],function(e,t){"use strict";var o={dataIndex:void 0,text:void 0,isDraggable:!0,width:150,minWidth:10,maxWidth:999,visibleFlag:!0,isHidden:!1,isSortable:void 0,type:void 0,isAdditionalColumn:void 0,xnav_options:{name:void 0,dataIndex:void 0,tree:void 0,hardcoded:void 0,exportable:{lock:!1,value:!0},layout:{removable:void 0,hidden:void 0,width:150,minWidth:void 0,maxWidth:void 0},kind:void 0}},n={dataIndex:void 0,text:void 0,isDraggable:!0,width:150,minWidth:10,maxWidth:999,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,kind:void 0,isAdditionalColumn:void 0,customisation:{layout:{width:200,minWidth:100,maxWidth:300,removable:!0,pinEditable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};function i(e,t){var o={};if(void 0===t)o=e;else for(var n=Object.getOwnPropertyNames(e),s=0;s<n.length;s++)if(UWA.is(e[n[s]],"object")){var r=i(e[n[s]],t[n[s]]);Object.getOwnPropertyNames(r).length>0&&(o[n[s]]=r)}else e[n[s]]!==t[n[s]]&&"text"!==n[s]&&"label"!==n[s]&&(o[n[s]]=e[n[s]]);return o}function s(e,t,o){var n={};if(void 0===e)n=t;else{for(var i=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e),a=0;a<i.length;a++)if(UWA.is(t[i[a]],"object")){if("bi_color"!==o){var l=s(e[i[a]],t[i[a]],o);Object.getOwnPropertyNames(l).length>0&&(n[i[a]]=l)}}else void 0===e[i[a]]?n[i[a]]=t[i[a]]:n[i[a]]=e[i[a]];for(var d=0;d<r.length;d++)void 0===n[r[d]]&&(n[r[d]]=e[r[d]])}return n}return{convertCusto4Preference:function(e,s,r){var a={custoOptimized:!0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:t.getSetting("lang")};"treelistview"===r?a.custoFromTree=!0:"datagridview"===r&&(a.custoFromDGV=!0);for(var l=0;l<e.columns.length;l++){var d=e.columns[l],c=o;if("datagridview"===r&&(c=n),"ContextualMenuColumn"!==d.dataIndex){var p=i(d,c);s&&s[d.dataIndex]&&(p.text=d.text),a.columnsOptimized.push(p)}else a.ctxMenuColumn={pinned:d.pinned,columnIdx:d.columnIdx,visibleFlag:d.visibleFlag}}return a},convertPreference2Custo:function(i,r){var a={viewMode:i.viewMode,defaultCellHeight:i.defaultCellHeight,rowsHeader:i.rowsHeader,selectedTypes:i.selectedTypes,selectedExtensions:i.selectedExtensions,columns:[],ctxMenuColumn:i.ctxMenuColumn};i.custoFromTree||"treelistview"===r?a.custoFromTree=!0:"datagridview"===r&&(a.custoFromDGV=!0),i.lang&&i.lang!==t.getSetting("lang")&&function(e){for(var t=0;t<e.columnsOptimized.length;t++){var o=e.columnsOptimized[t];o.xnav_options&&o.xnav_options.titleModified&&(delete o.text,delete o.xnav_options.titleModified)}}(i);for(var l=0;l<i.columnsOptimized.length;l++){var d=i.columnsOptimized[l],c=o;"datagridview"===r&&(c=n);var p=s(d,e.clone(c),d.dataIndex);p.typeRepresentation&&p.typeRepresentation.startsWith("enum")&&delete p.typeRepresentation,a.columns.push(p)}let u=a.columns.map(function(e){return e.dataIndex});if(u.filter(function(e,t,o){return o.indexOf(e)===t}).length!==u.length){let e={},t=a.columns.reduce(function(t,o){let n=o.dataIndex;return e[n]||(e[n]=!0,t=t.concat(o)),t},[]);a.columns=t}return a}}}),define("DS/ENXNav/commands/view/_xNavRootInfoPanel",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=o.get(),this._change_state_from_close=!1;var t=this;t._context.elements.padshell&&t._context.elements.padshell._modelEvents&&t.addCallback(),t=this,this.onStateChange(function(){t._change_state_from_close?t._change_state_from_close=!1:t._context.togglePanel("left")})},addCallback:function(){var e=this;!1===this._callbackAdd&&(this._context.elements.padshell._modelEvents.subscribe({event:"triptych-hide-panel"},function(t){"left"===t&&(e._change_state_from_close=!0,e.setState(!1,!1))}),n.subscribe({event:"ENXViews/Triptych/onOverlayClick"},function(t){t&&"left"===t&&!0===e.getState()&&(e._change_state_from_close=!0,e.toggleState(!1,!1))}),e._callbackAdd=!0)}})}),define("DS/ENXNav/commands/tools/_xNavRelationIPExplorer",[],function(){"use strict";return{execute:function(e){require(["DS/PADUtils/PADUtilsServices","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(t,o){t.setObject_on_compass({nodes_2_open:e.xnav_app.options.model.getSelectedNodes()}),t.launchApp({appId:"ENORIPE_AP",widgetId:t.getWidgetId()})})}}}),define("DS/ENXNav/commands/view/_xNavCleanAll",[],function(){"use strict";return{execute:function(e){e.xnav_app.empty()}}}),define("DS/ENXNav/mixins/DesignExpLeftSidePanel",["DS/PADServices/utils/GlobalModelEvents"],function(e){function t(){}return t.prototype={createRootListSlidder2:function(){let t=this._parent();var o=this,n=this.leftsidepanel.elements;return e.subscribe({event:"ENXModel/DesignEnv/add"},function(t){require(["DS/DesignEnvironmentUX/DesignEnvironment"],function(i){if(void 0===n.designenvpanel){new i({designEnvCtx:t.designEnv,globalModelEvent:e,pseModel:t.pseModel,isReadOnlyInWeb:t.isReadOnlyInWeb,modelEvent:e.getModelEvents()});e.subscribeOnce({event:"ENXModel/DesignEnv/leftSidePanel/loadTab"},function(e){n.designenvpanel=e.designenvpanel,s(),n.rootLst.setVisible(!1)})}else{o.wasDETabCreated=!0,n.leftsidetabbar._historySelection.find(e=>"designenv"==e.value)||s(),r()}function s(){o.leftsidepanel.addTab({label:n.designenvpanel.getTabLabel(),key:"designenv",isSelected:!0,icon:{iconName:"user-cog",fontIconFamily:WUXManagedFontIcons.Font3DS},container:n.designenvpanel,content:n.designenvpanel.getDEContainer()})}function r(){n.designenvpanel.options.isDeEnabled=!(!self||!self.widget)&&self.widget.isDeEnabled,n.designenvpanel.options.is3dExcite=!(!self||!self.widget)&&self.widget.is3dExcite,n.designenvpanel.addDesignEnv(t.designEnv).then(function(o){t.resolve&&t.resolve(o),n.leftsidetabbar.getButtonFromValue("designenv").checkFlag=!0,e.publish({event:"ENXModel/DesignEnv/added"}),n.leftsidetabbar._setTabVisibility("designenv",!0)})}e.subscribeOnce({event:"ENXModel/DesignEnv/leftSidePanel/content"},r)})}),e.subscribe({event:"ENXModel/DesignEnv/removeColumn"},function(){n.designenvpanel&&n.designenvpanel.core.pseCommonService.addOrRemoveEvents("remove")}),e.subscribe({event:"ENXModel/DesignEnv/close"},function(t){n.leftsidetabbar._setTabVisibility("designenv",!1),n.designenvpanel.core.pseCommonService.removeItemsOnPreference(!0),n.designenvpanel.core.pseCommonService.addOrRemoveEvents("remove"),e.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:[t.designExp.getID()],fromWLSync:!1}}),e.publish({event:"ENXModel/ReadWriteTriggered",data:!1}),n.designenvpanel.core.contextManager.removeActiveDesignExp()}),t}},t}),define("DS/ENXNav/views/customize_views/commands",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/HideShowController","DS/PADServices/views/ENXModal","DS/Controls/Button","DS/Utilities/Dom","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/HideShowCtrl","DS/PADServices/settings/AppSettings"],function(e,t,o,n,i,s,r,a,l){"use strict";var d=o;return"true"!==r.getURLParameter("explorerOcc")&&!0!==l.getSetting("explorerOcc")||(d=a),{getTypeRepresentation:function(){return{findInCtx:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"find dgv-find",fontIconFamily:1}}}}},hide_show:{getCellTooltip:function(e){let o={shortHelp:t.columnsDef.hide_show,updateModel:!1};return-1!==e.rowID&&(o=d.determineTooltip(e.nodeModel,t)),o},buildColumn:function(e){return Object.assign({dataIndex:"hide_show",kind:"functionIcon",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",customisation:{exportable:{lock:!0,value:!1}},getCellSemantics:function(e){return d.determineIcon(e.nodeModel)}},e)},actionOnClick:function(e,t){var o=e.nodeModel;void 0!==o.options.isPADHidden&&!0===o.options.isPADHidden||o.options.isHiddenState===d.STATES.HIDDEN?t.onShow({paths:[o.getOccurencePath()],fromUI:!0}):t.onHide({paths:[o.getOccurencePath()],fromUI:!0})}},findinctx:{getCellTooltip:function(e){return{shortHelp:t.columnsDef.find,updateModel:!1}},buildColumn:function(e){return Object.assign({dataIndex:"findinctx",kind:"findInCtx",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"findInCtx",alignment:"center",customisation:{exportable:{lock:!0,value:!1}}},e)},actionOnClick:function(e,t){require(["DS/ApplicationFrame/CommandsManager"],function(t){var o=e.cellView.getContent().getBoundingClientRect(),n=t.getCommand("FindCmd",null);n&&(o&&(n.options.position=o),n.options.fromCtx=!0,n.begin())})}},thumbnail:{getCellTooltip:function(e){let o=null;return o=-1===e.rowID?{shortHelp:t.columnsDef.thumbnail,updateModel:!1}:{title:t.columnsDef.thumbnail,shortHelpImage:e.nodeModel.getReferenceValue("thumbnail"),shortHelpImageDimension:{x:120,y:100}}},buildColumn:function(e){return Object.assign(e,{dataIndex:"thumbnail",kind:"image",width:50,minWidth:50,editableFlag:!1,typeRepresentation:"image",alignment:"center",hasNLS:!1,noTitleColumn:!0,customisation:{exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}}})},actionOnClick:function(e,o){if(e.nodeModel){let o=e.nodeModel.getReferenceValue("thumbnail");if(void 0!==o){let a=s.createElement("div",{class:"enx-thumbnail-pop-up"});a.style.backgroundImage="url('"+o+"')";let l=document.querySelector(".enx-appMainBody"),d=e.cellView.getContent().getBoundingClientRect(),c={of:l,my:"top left",at:"top left",offsetX:d.x,offsetY:d.y};var r=new n({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.columnsDef.thumbnail,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:a,position:c,buttons:{Close:new i({onClick:function(){r.close()}})},events:{onClickOutsideContent:function(){r.close()}}})}}}}}}),define("DS/ENXNav/models/SmartNodeOptions",["DS/PADServices/utils/Iterator","DS/PADServices/utils/NlsCache"],function(e,t){const o=["label","display","type","icons","relcount","thumbnail","isPADHidden","isHiddenState","grid","padgrid","ensureNLS"];var n=new Map([["label","value"],["display","value"],["type","value"],["relcount","value"],["thumbnail","value"],["isPADHidden","value"],["isHiddenState","value"],["grid","object"],["padgrid","object"],["icons","array"],["ensureNLS","value"]]);var i=new Map([["array",function(e,t){return function(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var n=0;n<o;n++)if(typeof e[n]!=typeof t[n]&&"object"==typeof e[n]){if(void 0!==e[n]&&void 0!==t[n]&&e[n].iconPath!==t[n].iconPath)return!1}else if(e[n]!==t[n])return!1;return!0}return!1}return!1}(e,t)?{change:!0,value:t}:{change:!1}}],["value",function(e,t){return e!==t?{change:!0,value:t}:{change:!1}}],["object",function(o,n){let i=!1;if(!o&&!n)return!1;if(o&&!n)return!1;let s={};return e.iterateObj(n,function(e,n){let r=o[n];if(r){if(e!==r){let o=t.hasChange(n,r,e);o.found?o.hasChange&&(i||(i=!0),s[n]=e):(i||(i=!0),s[n]=e)}}else i||(i=!0),s[n]=e}),{change:i,value:s}}]]);function s(e){this.node=e}return s.prototype={update:function(t){if(!t)return void console.error("You passed NULL");let s=this.node.options,r={},a=!1,l=0,d=!1;e.iterateObj(s,function(e,s){if(-1!==o.indexOf(s)){let o=function(e,t,o){let s=n.get(e);return i.get(s)(t,o)}(s,e,t[s]);if(o.change){r[s]=o.value;let e=r[s];null==e||"thumbnail"===s&&0===e.length?delete r[s]:("ensureNLS"===s&&(a=!0),d=!0,l++)}}}),d&&(this.doUpdate=d,this.specifics=r,a&&1===l&&(this.doUpdate=!1))},execute:function(){this.doUpdate&&this.node.updateOptions(this.specifics)}},s}),define("DS/ENXNav/views/private/LevelSelector",["i18n!DS/ENXNav/assets/nls/ENXNav","UWA/Core","DS/Utilities/Utils","DS/Controls/Abstract","DS/Controls/SpinBox","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,o,n,i,s,r){"use strict";return n.inherit({name:"LevelSelector",markForRecordFlag:!0,publishedProperties:{expandLevel:{defaultValue:"1",type:"string",category:"Appearance"},onLevelSelectorSet:{defaultValue:void 0,type:"function"},onLevelSelectorClose:{defaultValue:void 0,type:"function"}},buildView:function(){var o=this;this.elements.container.addClassName("enx-controls-levelselector"),this.elements.levelSelContainer=new t.Element("div",{class:"enx-controls-levelselector-container"}).inject(this.elements.container),this.elements.spinBox=new i({value:1,minValue:1,stepValue:1,pageStepValue:1,typingFilter:!0,decimals:0}).inject(this.elements.levelSelContainer),this.elements.spinBox.getContent().addClassName("enx-controls-levelselector-spinbox"),r.addEventOnElement(this,this.elements.spinBox.getContent(),"keydown",function(e){var n=t.Event.whichKey(e);"return"===n?o._levelSelected():"esc"===n&&o.close()}),this.elements.separator=new t.Element("div",{class:"enx-controls-levelselector-separator",html:"|"}).inject(this.elements.levelSelContainer),this.elements.checkSelBtn=new t.Element("div",{class:"enx-controls-levelselector-checkSel-btn",title:e.levelselector.checkLevel}).inject(this.elements.levelSelContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),r.addEventOnElement(this,this.elements.checkSelBtn,s.POINTERHIT,function(e){o._levelSelected(),e.stopPropagation()})},close:function(){this.visibleFlag=!1,this.onLevelSelectorClose&&this.onLevelSelectorClose()},_levelSelected:function(){var e=this.elements.spinBox.value;this.onLevelSelectorSet&&this.onLevelSelectorSet(e)}})}),define("DS/ENXNav/commands/view/_xNavSelectParent",[],function(){"use strict";return{execute:function(e){e.xnav_app;var t=e.model,o=t.getSelectedNodes();if(o.length){t.prepareBroadcastSelect(),t.prepareUpdate(),t.unselectAll(),t.prepareBroadcastSelect();var n=[];o.forEach(function(e){var t=e.getParent();t.options._isTrueRoot||n.push(t)}),t.multiselect(n),t.pushUpdate(),t.pushBroadcastSelect()}}}}),define("DS/ENXNav/views/private/Search",["i18n!DS/ENXNav/assets/nls/ENXNav","UWA/Core","DS/Utilities/Utils","DS/Controls/Abstract","DS/Controls/LineEditor","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,o,n,i,s,r){"use strict";return n.inherit({name:"Search",markForRecordFlag:!0,publishedProperties:{findStr:{defaultValue:"",type:"string",category:"Appearance"},disableSelectProxy:{defaultValue:!1,type:"boolean"},onSearchRequest:{defaultValue:void 0,type:"function"},onSearchIdRequest:{defaultValue:void 0,type:"function"},onSearchClose:{defaultValue:void 0,type:"function"},placeholder:{defaultValue:"",type:"string",category:"Appearance"}},buildView:function(){var o=this;this.elements.container.addClassName("enx-controls-search"),this.elements.findContainer=new t.Element("div",{class:"enx-controls-search-container"}).inject(this.elements.container),this.elements.findEditor=new i({selectAllOnFocus:!0,sizeInCharNumber:22,displayClearFieldButtonFlag:!0,displayStyle:"lite"}).inject(this.elements.findContainer),this.elements.findEditor.getContent().addClassName("enx-controls-search-editor"),r.addEventOnElement(this,this.elements.findEditor.getContent(),"keydown",function(e){var n=t.Event.whichKey(e);"return"===n?o.elements.findEditor.valueToCommit===o.findStr&&o._launchSearch():"esc"===n&&o.elements.findEditor.valueToCommit===o.findStr&&o.close()}),this.elements.separator=new t.Element("div",{class:"enx-controls-search-separator",html:"|"}).inject(this.elements.findContainer),this.elements.checkSelBtn=new t.Element("div",{class:"enx-controls-checkSel-btn",title:e.searchview.check}).inject(this.elements.findContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),this.elements.checkSelBtn.setAttributeNode(document.createAttribute("disabled")),this._applySelectProxy(this.disableSelectProxy),this.elements.searchBtn=new t.Element("div",{class:"enx-controls-search-btn",title:e.searchview.searchBtn}).inject(this.elements.findContainer),r.generateIcon("search-filter",{target:this.elements.searchBtn}),this.elements.searchBtn.setAttributeNode(document.createAttribute("disabled"))},_launchSearch:function(e,t){var n=this;this.findStr=this.elements.findEditor.valueToCommit;var i=function(){n.onSearchRequest&&n.onSearchRequest(n.findStr,n.matchCase,e)},s=o.debounce(i,500);t?s():i()},_launchSearchId:function(){this.onSearchIdRequest&&this.rscIdToSearch&&(this.onSearchIdRequest(this.rscIdToSearch),delete this.rscIdToSearch)},_applyProperties:function(e){this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("disableSelectProxy")&&this._applySelectProxy(e.disableSelectProxy)},_applySelectProxy:function(){if(this.disableSelectProxy)this._cmdProxy&&(this._cmdProxy.destroy(),this._cmdProxy=null),this.elements.checkSelBtn.style.display="none";else{var t=this;require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTypesMgt"],function(o,n){this._cmdProxy=o.create({events:{onSelect:function(i,s){var r=function(o){function i(e){t.rscIdToSearch=e.rscId,t.elements.findEditor.value=e["ds6w:label"],t.elements.checkSelBtn.removeAttribute("disabled")}if(1===o.paths.length){var s=o.paths[0],r=s[s.length-1],a=[];a.push({type:o.attributes[r].type}),n.isTypesAuthorized(a,function(n){if(n.length>0){var s={rscId:r,"ds6w:type":o.attributes[r].type,"ds6w:label":o.attributes[r].label};void 0===s["ds6w:label"]?(t.elements.findEditor.value=e.searchview.loadingLabel,t.loadingInProgress=!0,require(["DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/ParserUtils","DS/PADServices/utils/GlobalUtils"],function(o,n,r,a){(o.fetch?Promise.resolve():n.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){var n={pids:[s.rscId],data:{select_predicate:["ds6w:label","ds6w:type"],select_file:[]}};o.fetch(n).then(function(o){var n="string"==typeof o?JSON.parse(o):o;if(n.results&&1===n.results.length){var l=n.results[0],d=r.parseAttributes(l.attributes);s["ds6w:label"]=d.label,delete t.loadingInProgress,i(s)}else a.displayNotif({message:e.searchview.cannotRetrieveLabel,level:"error",key:"Search-cannotRetrieveLabel"})}).catch(function(){a.displayNotif({message:e.searchview.cannotRetrieveLabel,level:"error",key:"Search-cannotRetrieveLabel"})})})})):i(s)}})}else t.rscIdToSearch="",t.elements.findEditor.value=""};s.appid!==o.appId()&&(t.timeoutSelect?(clearTimeout(t.timeoutSelect),t.timeoutSelect=setTimeout(function(){r(i),delete t.timeoutSelect},200)):t.timeoutSelect=setTimeout(function(){r(i)},200))}}}),this.elements.checkSelBtn.style.display=""}.bind(this))}},_applyFindStr:function(e){this.findStr!==e&&(this.elements.findEditor.valueToCommit!==this.findStr&&(this.elements.findEditor.value=this.findStr),this.findStr.length&&!0!==this.loadingInProgress?this.elements.searchBtn.removeAttribute("disabled"):(this.elements.searchBtn.setAttributeNode(document.createAttribute("disabled")),this.elements.checkSelBtn.setAttributeNode(document.createAttribute("disabled"))))},_applyPlaceholder:function(){this.elements.findEditor&&(this.elements.findEditor.placeholder=this.placeholder)},handleEvents:function(){var e=this;r.addEventOnElement(this,this.elements.findEditor,"uncommittedChange",function(t){e.findStr=e.elements.findEditor.valueToCommit}),r.addEventOnElement(this,this.elements.checkSelBtn,s.POINTERHIT,function(t){e._launchSearchId(),t.stopPropagation()}),r.addEventOnElement(this,this.elements.searchBtn,s.POINTERHIT,function(t){e._launchSearch(),t.stopPropagation()}),r.addEventOnElement(this,this.elements.findContainer,s.POINTERHIT,function(t){e._giveFocus()})},setCurrentValue:function(e){this.currentValue=e},close:function(){this.visibleFlag=!1,this.onSearchClose&&this.onSearchClose()},focus:function(){this._giveFocus()},_giveFocus:function(){this._parent(),this.elements.findEditor&&document.activeElement!==this.elements.findEditor._myInput&&this.elements.findEditor._giveFocus()}})}),define("DS/ENXNav/commands/FilterDropObjects",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(e,t,o,n){"use strict";return e.extend({execute:function(e,i){var s=t.get(),r=s.options.model?s.options.model:s.getPADTreeDocument(),a=!(!i||!i.fromWP)&&i.fromWP,l=!(!i||!i.fromProxy)&&i.fromProxy,d=!a&&!l,c=e.biProxyCtx;require(["DS/PADUtils/PADTypesMgt","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSession"],function(t,p,u,h){t.retrieveAuthorizedObjects({notifPerObjects:!0,displayNotif:!1,unserializedData:e,callback:function(e){var t=e.authorizedWithKind.Product?e.authorizedWithKind.Product.length:0;if(t+=e.authorizedWithKind.Filter?e.authorizedWithKind.Filter.length:0,0===e.authorized_objects.length&&0===t||0===t){if(e.authorizedWithKind.DesignEnv&&e.authorizedWithKind.DesignEnv.length){let e=require("i18n!DS/ENXNav/assets/nls/ENXNav.json");p.displayNotification({msg:e.design_exp_unable_to_filter,eventID:"error"})}}else{var g=r.getRoots();o.multiTenantMgt(e.authorized_objects,g,function(t){if(t.isMultiTenant)t.isMultiTenant&&t.invalidTenant;else{var o="WITHOUT_CONTEXT";i&&i.behavior&&(o=i.behavior);var r=[];e.authorizedWithKind&&(e.authorizedWithKind.Product&&e.authorizedWithKind.Product.length>0&&(1===e.authorized_objects.length?r.push(new Promise(function(t){s.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,loadWithFilter:1===e.authorizedWithKind.Product.length,biProxyCtx:c,dropOnFilter:!0,callback:function(o){if(h.isAuthoring())s.disableFilterWaiting(),p.displayNotification({msg:u.filterInAuthoring,eventID:"warning",key:"enxNav-filterInAuthoring"}),t();else if("error"!==o)if(!0!==l)if(1===e.authorized_objects.length){var n=e.authorizedWithKind.Product[0].objectId;require(["DS/ApplicationFrame/CommandsManager"],function(e){var o=e.getCommand("DefineFilter");o&&(o.setOpenFilterNow(n),o.begin(),s._filterRootIds=[n],s._filterPanelOpen=!0),t()})}else t();else!0===l&&(s._filterRootIds=[n],s._filterPanelOpen=!0);else s.disableFilterWaiting(),t()},behavior:o,broadcast:d})})):r.push(new Promise(function(t){s.add({content:"3DXContent",authorized_objects:e.authorizedWithKind.Product,biProxyCtx:c,callback:function(){t()},behavior:o,broadcast:d,fromWP:a})}))),e.authorizedWithKind.Filter&&e.authorizedWithKind.Filter.length>0)&&(o=1===e.authorizedWithKind.Filter.length?"fromDropOnFilter":void 0,(e.authorizedWithKind.Filter.length>1||e.authorized_objects.length>1)&&(o="fromDrop"),r.push(new Promise(function(t){s.addFilter({content:"3DXContent",filter_objects:e.authorizedWithKind.Filter,callback:t,behavior:o,broadcast:d,fromWP:a,fromProxy:l})}))),Promise.all(r).then(function(){n.getSetting("welcomeonempty")&&require("DS/PADServices/utils/GlobalModelEvents").getModelEvents().publish({event:"ENXViews/WelcomePanel/closeLandingPage"})})}})}},version:"2.0"})})}})}),define("DS/ENXNav/commands/tools/xNavFilterCmds",["DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADContext","DS/PADUtils/PADSession","DS/ENOXInterWdgCom/LinkManager"],function(e,t,o,n,i,s){"use strict";var r;return o.getSetting("activateFUN087933")&&(r=e.extend({_openFilterPanelNow:!1,_selectionId:-1,init:function(e){this._parent(e);var t=this;n.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},function(e){!0!==e.data.skipFilterProxy&&n.get()._biFilter&&!s.isWidgetSynchronizing()&&n.get()._biFilter.removeRoot(e.data.pid),0===n.get().getPADTreeDocument().getRoots().length&&t.disable()}),n.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},function(e){i.determineAuthoredFlag()||t.enable()}),n.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoots"},function(e){n.get()._biFilter&&n.get()._biFilter.removeRoots(e.data.pids)}),i.subscribe({event:"authoringStateModified"},function(e){e.authored||0===n.get().getPADTreeDocument().getRoots().length?t.disable():t.enable()})},setOpenFilterNow:function(e){this._openFilterPanelNow=!0,this._selectionId=e},hasSelection:function(){var e=this.getSelection();return!!(e&&e.path.length>0)},getAppParams:function(){return{widgetId:t.getWidgetId(),NGFUXId:n.get().getNGFUXID(!0),appId:t.getAppId(),shareFilterSpec:!0}},getSelectorManager:function(){return n.get().getPADTreeDocument().getXSO()||null},getRoots:function(){if(!1!==this._openFilterPanelNow){this._openFilterPanelNow=!1;var e=[],t=n.get().options.model.getNodesById(this._selectionId)[0],o={};return t.isRoot()?o=t:(o=t.getRoot()).select(),e.push({id:o.getID(),label:o.getLabel(),filtered:o.options.sequence_filter||o.options.config_filter?1:0}),e}return n.get().getPADTreeDocument().getRoots().map(function(e){return{id:e.getID(),label:e.getLabel(),filtered:e.options.sequence_filter||e.options.config_filter?1:0,revision:e.getReferenceValue("ds6wg:revision")}})},getSelection:function(){var e={path:[],label:[],revision:[],directSelection:n.get().getPADTreeDocument().isDirectSelection()};return n.get().getPADTreeDocument().getSelectedNodes().forEach(function(t){e.path.push(t.getOccurencePath()),e.label.push([t.getLabel()]),e.revision.push([t.getReferenceValue("ds6wg:revision")])}),e}})),r}),define("DS/ENXNav/views/private/externalColumnsViews/designExpColumn",["i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e){"use strict";return{"asset-type":{getCellTooltip:function(e,t){let o={shortHelp:"",updateModel:!1};return e&&t&&t.hasActiveDesignExp()&&(o=t.getPseService().getCellTooltip(e)),o},buildColumn:function(t){var o=this;return Object.assign({dataIndex:"asset-type",columnIdx:0,hasNLS:!1,visibleFlag:!1,label:e.columnsDef.DesignExpItemColumn,typeRepresentation:"image",noTitleColumn:!1,alignment:"center",pinned:"left",customisation:{exportable:{lock:!0,value:!1},layout:{removable:!1}},compareFunction:function(){if(arguments[2]){let e=arguments[2].getTreeDocument();e&&e.options.context.hasActiveDesignExp()&&(e.options.context.getPseService().deSortModel={isSorted:!0,sort:-1==this.reverseFactor?"desc":"asc"})}return arguments[2].options.sortIdentifier-arguments[3].options.sortIdentifier},width:40,text:e.columnsDef.DesignExpItemColumn,getCellValue:function(e){return o.ctx||(o.ctx=this._properties.treeDocument.value.options.context),{iconPath:o.ctx.hasActiveDesignExp()?o.ctx.getPseService().getAssetTypeCellValue(e):"",iconSize:{height:"65%"},className:["ContextModified","WIPModified"].includes(e.nodeModel.options.deType)?"de-clickable-icon":""}},getCellTypeRepresentation:function(){return"image"}},t)},actionOnClick:function(e,t){e&&e.nodeModel&&t.hasActiveDesignExp()&&t.getPseService().confirmCellAction(e)}}}}),define("DS/ENXNav/views/private/externalColumnsViews/lockRO",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PlatformAPI/PlatformAPI"],function(e,t,o){"use strict";var n=null;function i(e){return"string"==typeof e?"TRUE"===e.toUpperCase():e}function s(){return null==n&&(n=o.getUser()),n}const r={NOT_LOCKED:0,LOCKED_BY_ME:1,LOCKED_BY_OTHER:2};function a(e,t){let o=r.NOT_LOCKED;var n,i,a,l;if(t?(n=void 0!==e.nodeModel.options.grid["ds6w:reserved-Instance"]?e.nodeModel.options.grid["ds6w:reserved-Instance"]:void 0,i=e.nodeModel.options.grid["ds6w:reservedBy-Instance"]?e.nodeModel.options.grid["ds6w:reservedBy-Instance"]:"",void 0===n||e.nodeModel.options.relationid.length||(n=void 0)):(n=void 0!==e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:void 0,i=e.nodeModel.options.grid["ds6w:reservedBy"]?e.nodeModel.options.grid["ds6w:reservedBy"]:""),void 0!==n&&(Array.isArray(i)&&(i=i.join(",")),"boolean"==typeof n?n:"TRUE"===n.toUpperCase())){var d=(a=s(),l="",void 0!==a&&(l=a.login),l),c=function(){var e=s(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t}(),p=!0;i.trim().length>0&&((p=i.toUpperCase().trim()===d.toUpperCase().trim()||!1)||(p=i.toUpperCase().trim()===c.toUpperCase().trim()||!1)),o=p?r.LOCKED_BY_ME:r.LOCKED_BY_OTHER}return o}function l(e){var o=e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:"";if(void 0!==o)return("boolean"==typeof o?o:"TRUE"===o.toUpperCase())?t.columnsDef.tooltipReserved:t.columnsDef.tooltipUnreserved}return{"ds6w:reserved":{getCellTooltip:function(e,o){let n="";if(-1===e.rowID)n=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){if(i(e.nodeModel.getReferenceValue("ds6w:reserved"))){let o=a(e);r.LOCKED_BY_ME===o?n={shortHelp:t.tooltipLockedByMeRO}:r.LOCKED_BY_OTHER===o&&(n={shortHelp:t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy")})})}else n={shortHelp:t.tooltipUnLockedRO}}return n},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved",kind:"icon",minWidth:50,editableFlag:!1,typeRepresentation:"icon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(-1===e.rowID)return null;let t="",o=a(e);return r.LOCKED_BY_ME===o?t="enx_dgv_lock_by_me":r.LOCKED_BY_OTHER===o&&(t="enx_dgv_lock_other"),t},getCellValue:function(e){if(-1===e.rowID)return null;let t="",o=a(e);return r.LOCKED_BY_ME===o?t="key":r.LOCKED_BY_OTHER===o&&(t="lock"),t},getCellValueForExport:function(e){return-1===e.rowID?null:l(e)},getCellGroupingKey:function(e){let o=a(e),n="";return n=r.LOCKED_BY_ME===o?t.tooltipLockedByMeRO:r.LOCKED_BY_OTHER===o?t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy")}):t.tooltipUnLockedRO,this.getColumnOrGroup("ds6w:reserved").text+": "+n}},e)}},"ds6w:reserved-Instance":{getCellTooltip:function(e,o){let n="";if(-1===e.rowID)n=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){if(i(e.nodeModel.getReferenceValue("ds6w:reserved-Instance"))){let o=a(e);r.LOCKED_BY_ME===o?n={shortHelp:t.tooltipLockedByMeRO}:r.LOCKED_BY_OTHER===o&&(n={shortHelp:t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy-Instance")})})}else n={shortHelp:t.tooltipUnLockedRO}}return n},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved-Instance",kind:"icon",minWidth:50,editableFlag:!1,typeRepresentation:"icon",alignment:"center",icon:{iconName:"flow-cascade dgv-header-icon",fontIconFamily:1},customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(-1===e.rowID)return null;let t="",o=a(e,!0);return r.LOCKED_BY_ME===o?t="enx_dgv_lock_by_me":r.LOCKED_BY_OTHER===o&&(t="enx_dgv_lock_other"),t},getCellValue:function(e){if(-1===e.rowID)return null;let t="",o=a(e,!0);return r.LOCKED_BY_ME===o?t="key":r.LOCKED_BY_OTHER===o&&(t="lock"),t},getCellValueForExport:function(e){return-1===e.rowID?null:l(e)},getCellGroupingKey:function(e){let o=a(e),n="";return n=r.LOCKED_BY_ME===o?t.tooltipLockedByMeRO:r.LOCKED_BY_OTHER===o?t.replace(t.tooltipLockedOtherRO,{lockedUser:e.nodeModel.getReferenceValue("ds6w:reservedBy")}):t.tooltipUnLockedRO,this.getColumnOrGroup("ds6w:reserved-Instance").text+t.groupingNode.fromInstance+n}},e)}}}}),define("DS/ENXNav/commands/view/_xNavExpandN",[],function(){"use strict";return{execute:function(e){require(["DS/ENXNav/views/private/ExpandLevelSelector"],function(t){new t({position:e.position,events:{onLevelSelectorSet:function(t){var o=e.model,n=o.getSelectedNodes();n.length>1?o.expandMultiSelect({nodes2Expand:n,numberOfLevelsToExpand:t}):1===n.length&&n[0].expandNLevels({numberOfLevelsToExpand:t})}}})})}}}),define("DS/ENXNav/utils/LocalStorageForAppState",["DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PersistBlob"],function(e,t,o){function n(){this._appKey=e.buildKey(t.getUserLogin()+"."+t.getAppId(),"AppState",!0),this._blob=new o({key:this._appKey,version:1,storageWrapper:e.local})}let i;return n.prototype={get:function(e){let t=this._getAll();if(t)return t[e]},set:function(e,t){let o=this._getAll();o||(o={}),o[e]=t,this._setAll(o)},del:function(e){let t=this._getAll();t||(t={}),delete t[e],this._setAll(t)},_getAll:function(){return e.local.get(this._appKey)},_setAll:function(t){e.local.set(this._appKey,t)}},i||(i=new n),i}),define("DS/ENXNav/commands/ShowIn3DCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{atleastonehidden:!0})},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes(),t=[];e.length>=1&&e.forEach(function(e){t.push(e.getOccurencePath())}),o.get().onShow({paths:t})}})}),define("DS/ENXNav/commands/FocusOnCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID)},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes(),t=require("DS/PADUtils/PADUtilsServices"),n=[];e.length>=1&&e.forEach(function(e){n.push(e.getOccurencePath())}),o.get()._commandProxy.focus({intent:"focus",paths:n,widget:"2D",sharedID:t.getSharedId(),appID:t.getAppId()})}})}),define("DS/ENXNav/commands/FindCmd",["i18n!DS/ENXNav/assets/nls/ENXNav","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/TreeModel/TreeNodeModel","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalUtils","DS/PADServices/settings/AppSettings"],function(e,t,o,n,i,s,r,a,l,d,c,p,u){"use strict";return n.extend({init:function(e){this._parent(e),o.viewMgt(this.options.ID,{nograph:!0,notiles:!0,nothumbs:!0}),!0===u.getSetting("grpBSD")&&o.selectionMgt(this.options.ID,{noGrp:!0})},execute:function(){var o=this;require(["DS/ENOXFindUX/FindView","DS/ENOXFindUX/ENOXFindUtils"],function(n,u){o.findView=null;var h,g,f=o.dgv=i.get().getPADDGVView()?i.get().getPADDGVView().options.dgv:void 0,v=o.model=i.get().getPADTreeDocument(),m=o.getArguments();if(1!==m.length)return;if(o.targetDiv=document.querySelector("."+m[0].Value),!o.targetDiv)return;null!==o.findView&&o.findView.closePanel(),l.subscribe({event:"ENXModel/refresh/begin"},o._resetFindResult.bind(o)),l.subscribeOnce({event:"ENXViews/Model/FindInCtx/ui/close"},function(){!0!==v.isOccModel&&a.node.clearChildComputed(v)}),l.subscribe({event:"ENXModel/toggleView"},o.end.bind(o)),l.subscribe({event:"ENXModel/Root/remove"},o._handleRemovalOfRoot.bind(o));var b=v.getSelectedNodes();0===b.length?h=e.find.title:1===b.length?(h=e.replace(e.find.title1Node,{label:b[0].getLabel()}),g=b[0].options.resourceid):h=e.replace(e.find.titleNNodes,{nbNodes:b.length});let _=o.options.position;delete o.options.position;let D,S=f.layout.getVisibleOrderedColumnsIndexes(),x=[],y=[];for(D=0;D<S.length;D++){var N=f.getColumnOrGroup(S[D]);!0!==d.isAttributeColumn(N.dataIndex)||"matrixtxt"===N.ds6w||"string"!==N.typeRepresentation&&"tag"!==N.typeRepresentation&&"url"!==N.typeRepresentation||!N.ds6w||-1!==x.indexOf(N.ds6w)||(x.push(N.ds6w),y.push(N))}let C=c.buildKey("ENXFindCmd","selectedColKey",!0),P=c.local.get(C),w=c.buildKey("ENXFindCmd","selectedMatchKey",!0),A=c.local.get(w),I=c.buildKey("ENXFindCmd","selectedNavigateModeKey",!0),E=c.local.get(I),O=c.buildKey("ENXFindCmd","includeType3dShapeKey",!0),M=c.local.get(O),F=c.buildKey("ENXFindCmd","includeTypeInstanceKey",!0),R=c.local.get(F),T=[];if(P)T=JSON.parse(P);else for(D=0;D<y.length;D++)T.push(y[D].ds6w);o.findView=new n({placeholder:e.find.placeholder,title:h,renderTo:o.targetDiv,position:_,listenSelect:!0,authorizedTypes:["VPMReference","VPMRepReference"],associatedNodeResourceId:g,availableCols:{withChooser:!0,selectedCols:T,allCols:y,selectedMatch:A,selectedNavigateMode:E,includeType3dShape:M,includeTypeInstance:R},events:{onSearch:function(e){var n;f&&f.closeFind(),(n=b&&b.length?b:o.model.getRoots())&&n.length&&e.searchFts.length?(o._selectMatch=e.selectMatch,c.local.set(w,o._selectMatch),o._selectNavigateMode=e.selectNavigateMode,c.local.set(I,o._selectNavigateMode),o._includeType3dShape=e.includeType3dShape,c.local.set(O,o._includeType3dShape),o._includeTypeInstance=e.includeTypeInstance,c.local.set(F,o._includeTypeInstance),o._selectedPredicates=e.selectedPredicates,c.local.set(C,JSON.stringify(o._selectedPredicates)),v.__findInProgress=!0,o._launchFind({nodes:n,searchFts:e.searchFts,rscId:e.rscId,selectedPredicates:e.selectedPredicates}).then(function(t){o.foundNodes=t.foundNodes;let n=0;if(f){f.findWidget=o.findView,f.getNodeModelToProcessForFind=function(e,o){return t.foundNodes};let s=o._selectNavigateMode?"row":"substring";f.findNavigationMode=s;let r=void 0;if(Array.isArray(e.findInContentSelected)&&e.findInContentSelected.length){r=[];let t=f.layout.getVisibleOrderedColumnsIndexes(),o=[];for(let e=0;e<t.length;e++){var i=f.getColumnOrGroup(t[e]);!0===d.isAttributeColumn(i.dataIndex)&&"matrixtxt"!==i.ds6w&&("string"===i.typeRepresentation||"tag"===i.typeRepresentation||"url"===i.typeRepresentation)&&i.ds6w&&i.text&&o.push(i.text)}for(let t=0;t<e.findInContentSelected.length;t++)r.push(e.findInContentSelected[t]),-1!==o.indexOf(e.findInContentSelected[t]+" ")&&r.push(e.findInContentSelected[t]+" ")}f.onFindRequest({findStr:e.searchFts?e.searchFts.trim():e.searchFts,matchCase:!1,navigationMode:s,findInContentSelected:r}),n=f.matchingStringCount,"row"===f.findNavigationMode&&(n=f._matchingRowsCount),o._selectNodeFromMatchCell(),delete v.__findInProgress}o.findView.setMatchingStringCount(n)})):(o.foundNodes=[],o.findView.setMatchingStringCount(0),n&&n.length||!e.searchFts.length||p.displayNotif({message:t.find_in_context_no_result,eventID:"info"}))},onSelect:function(){if(o.foundNodes&&o.foundNodes.length){var e=o.model;e.prepareUpdate();for(var t=0;t<o.foundNodes.length;t++)o.foundNodes[t].select();e.pushUpdate()}},onClose:function(){f&&f.closeFind(),o.dgv.getNodeModelToProcessForFind=void 0,f.findWidget=null,o.findView=null,l.publish({event:"ENXViews/Model/FindInCtx/ui/close"})},onListenSelect:function(t,n){if(null!==o.findView){var i=o.findView;if((void 0===i.options.strString||0===i.options.strString.length)&&1===t.paths.length){var a=t.paths[0],l=a[a.length-1],d={};t.attributes&&(d=t.attributes[l]);let e=Object.assign({rscId:l},d);u.getTypeTaxonomies({typesToSearch:[{rscId:e.rscId,type:e.type}]}).then(o=>{var n=o[e.type]?o[e.type]:o.XP_VPMReference_Ext,r=!1;if(i.options.authorizedTypes)for(let e=0;e<i.options.authorizedTypes.length;e++)if(-1!==n.indexOf(i.options.authorizedTypes[e])){r=!0;break}r?(e.label=t.attributes[e.rscId].label,UWA.is(e.label)?c(e):require(["DS/PADUtils/PADWSAccess"],function(t){var o=s.getWebAPI_Options("fetch");t.fetch({enopad_webapis:s.getSetting("enopad_webapis"),data:o,pids:[e.rscId],onComplete:function(t){var o=UWA.is(t,"string")?JSON.parse(t):t;if(o.results&&1===o.results.length){var n,i=o.results[0],s=null,r=i.attributes.length;for(n=0;n<r&&!s;n++)"ds6w:label"===i.attributes[n].name&&(s=i.attributes[n].value);e.label=s,c(e)}else e.label=null,c(e)},onFailure:function(){e.label=null,c(e)}})})):console.log("FindView## type ["+e.type+"] not authorized")})}}function c(t){var i,s=o.findView,a=s.options.autocompleteModel.search({match:function(e){return e.nodeModel.getReferenceValue("rscId")===t.rscId}});if(0===a.length){var l=s.options.autocompleteModel.getRoots();l.length===n&&(s.options.autocompleteModel.removeRoot(l[n-1]),l=s.options.autocompleteModel.getRoots());var d=t.label;d||(d=e.find.selectNodeWithoutLabel);var c=new r({label:d,grid:{rscId:t.rscId},icons:[{iconName:"3d-object",fontIconFamily:1}]});0===l.length?s.options.autocompleteModel.addRoot(c):s.options.autocompleteModel.insertBefore(c,l[0]),i=c,s.__storeAutocompleteModel()}else i=a[0];s.elements.wuxautocomplete._editor.value=i.getLabel(),s.elements.findBtn.disabled=!1}},onFindPreviousResult:o._goToPreviousMatchingCell.bind(o),onFindNextResult:o._goToNextMatchingCell.bind(o),onResetFindResult:o._resetFindResult.bind(o)}})})},_resetFindResult:function(){this.dgv&&this.dgv.closeFind(),this.foundNodes=[],null!==this.findView&&this.findView.setMatchingStringCount(void 0)},_handleRemovalOfRoot:function(e){var t=this.model.getRoots();if(this.findView)if(t.length){if(this.findView.options.associatedNodeResourceId){this.model.getNodesById(this.findView.options.associatedNodeResourceId).length||this.end()}}else this.end()},end:function(){this.findView&&(this.model._doNotBroadcastSelect=!1,this.findView.closePanel()),this._parent()},_should3DFocusChange:function(){var e=this.dgv._matchingAllNodeModelsArray[this.dgv._currentMatchingCellIDIndex].options.resourceid;return e!==this._currentResId&&(this._currentResId=e,!0)},_goToPreviousMatchingCell:function(){this.dgv.goToPreviousMatchingCell(),this._selectNodeFromMatchCell()},_goToNextMatchingCell:function(){this.dgv.goToNextMatchingCell(),this._selectNodeFromMatchCell()},_selectNodeFromMatchCell:function(){if(this._selectMatch){let e=this.dgv.getNodeModelAt(this.dgv._getMatchingCellID(this.dgv._currentMatchingCellIDIndex));!0!==e.isSelected()&&e.select(!0)}},_launchFind:function(e){var t=this;return new Promise(function(o){require(["DS/PADServices/utils/PredefinedQueryUtils"],function(n){var i=!0;if(e.searchFts?n.isPredefinedQry(e.searchFts,{version:2}).then(function(o){var n=o.realQry;!1===o.isPredefinedQry&&(n=t._buildQryRestrictedToColumns(n)),t._includeType3dShape&&t._includeTypeInstance||(n=t._filterTypeFromSearch(n)),l.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,searchFts:n,searchFtsOriginal:e.searchFts,rscId:e.rscId,noPager:!0,doNotBroacast:!0}})}):e.rscId?l.publish({event:"ENXViews/Model/FindInCtx",data:{nodes:e.nodes,rscId:e.rscId,noPager:!0,doNotBroacast:!0}}):i=!1,i)var s=l.subscribe({event:"ENXViews/Model/FindInCtx/complete"},function(e){l.unsubscribe(s),o(e)})})})},_filterTypeFromSearch:function(e){let t="";return`(${e}) AND ${t=this._includeType3dShape||this._includeTypeInstance?this._includeType3dShape?"(([ds6w:type]:VPMReference OR [ds6w:type]: 3DShape) AND (NOT([ds6w:type]:VPMInstance)))":"(([ds6w:type]:VPMInstance OR [ds6w:type]:VPMReference) AND (NOT([ds6w:type]: 3DShape)))":"(([ds6w:type]:VPMReference) AND (NOT([ds6w:type]: 3DShape AND [ds6w:type]:VPMInstance)))"}`},_buildQryRestrictedToColumns:function(e){var t="";e.includes(" ")&&(e=`"${e}"`);for(let o=0;o<this._selectedPredicates.length;o++){this._selectedPredicates[o].endsWith("-Instance")&&(this._selectedPredicates[o]=this._selectedPredicates[o].replace("-Instance","")),0!==o&&(t+=" OR "),t=t+("["+this._selectedPredicates[o]+"]")+":*"+e+"*"}return t}})}),define("DS/ENXNav/commands/ExpandThumbsCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{moreExpanded:!0}),e.viewMgt(this.options.ID,{nodgv:!0,notiles:!0,nothumbs:!0})},execute:function(){var t=o.get(),n=t.getSelectedNodes();t.options.views.graphview.setGroupThumbnailState({nodes:n,expanded:!1}),e.checkAvailability()}})}),define("DS/ENXNav/views/private/externalColumnsViews/lifecycleCols",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","DS/PlatformAPI/PlatformAPI","DS/PADUtils/Configuration","DS/PADServices/utils/MaturityUtils","DS/ApplicationFrame/CommandsManager","DS/PADUtils/PADContext"],function(e,t,o,n,i,s,r,a){"use strict";var l=null;function d(e){if("string"==typeof e)return"TRUE"===e.toUpperCase()}function c(){return null==l&&(l=n.getUser()),l}function p(e,t){var o,n,i,s,r=!1;if(t?(o=void 0!==e.nodeModel.options.grid["ds6w:reserved-Instance"]?e.nodeModel.options.grid["ds6w:reserved-Instance"]:void 0,n=e.nodeModel.options.grid["ds6w:reservedBy-Instance"]?e.nodeModel.options.grid["ds6w:reservedBy-Instance"]:"",void 0===o||e.nodeModel.options.relationid.length||(o=void 0)):(o=void 0!==e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:void 0,n=e.nodeModel.options.grid["ds6w:reservedBy"]?e.nodeModel.options.grid["ds6w:reservedBy"]:""),void 0!==o){Array.isArray(n)&&(n=n.join(","));var a=e.nodeModel.options.grid["ds6w:displayName"]?e.nodeModel.options.grid["ds6w:displayName"]:"";r="boolean"==typeof o?o:"TRUE"===o.toUpperCase();var l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock";if(l)if(r){var d=(i=c(),s="",void 0!==i&&(s=i.login),s),p=function(){var e=c(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t}(),u=!0;n.trim().length>0?(u=n.toUpperCase().trim()===d.toUpperCase().trim()||!1)||(u=n.toUpperCase().trim()===p.toUpperCase().trim()||!1):a.trim().length>0&&(u=p.toUpperCase().trim()===a.toUpperCase().trim()||!1),l=u?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other"}else l="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open lc_dgv_unlock";return{icon:{iconClasses:l},label:a}}}function u(e){var o=e.nodeModel.options.grid["ds6w:reserved"]?e.nodeModel.options.grid["ds6w:reserved"]:"";if(void 0!==o)return("boolean"==typeof o?o:"TRUE"===o.toUpperCase())?t.columnsDef.tooltipReserved:t.columnsDef.tooltipUnreserved}var h=[];return{"ds6w:reserved":{getCellTooltip:function(e,o){let n="";if(-1===e.rowID)n=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){n=("boolean"!=typeof e.cellModel?d(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.tooltipReserved}:{shortHelp:t.columnsDef.tooltipUnreserved}}return n},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved",kind:"functionIcon",minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellSemantics:function(e){if(!e.isHeader)return p(e,!1)},getCellValueForExport:function(e){return-1===e.rowID?null:u(e)}},e)},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{let t=e.nodeModel.getReferenceValue("ds6w:reserved");var o="ActionBar_ReserveCmd";!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(o="ActionBar_UnreserveCmd");var n=r.getCommand(o);n&&n.isEnabled()?n.begin():setTimeout(function(){n&&n.isEnabled()&&n.begin()},600)},t)}}},"ds6w:reserved-Instance":{getCellTooltip:function(e,o){let n="";if(-1===e.rowID)n=o.getCellDefaultTooltip(e);else if(void 0!==e.cellModel){n=("boolean"!=typeof e.cellModel?d(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.tooltipReserved}:{shortHelp:t.columnsDef.tooltipUnreserved}}return n},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:reserved-Instance",kind:"functionIcon",minWidth:50,editableFlag:!1,typeRepresentation:"functionIcon",alignment:"center",icon:{iconName:"flow-cascade dgv-header-icon",fontIconFamily:1},customisation:{exportable:{lock:!1,value:!0}},getCellSemantics:function(e){if(!e.isHeader)return p(e,!0)},getCellValueForExport:function(e){return-1===e.rowID?null:u(e)}},e)},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{let t=e.nodeModel.getReferenceValue("ds6w:reserved-Instance");var o="ActionBar_ReserveCmd";!0===("boolean"==typeof t?t:"TRUE"===t.toUpperCase())&&(o="ActionBar_UnreserveCmd");var n=r.getCommand(o);n&&n.isEnabled()?n.begin():setTimeout(function(){n&&n.isEnabled()&&n.begin()},600)},t)}}},"ds6wg:PLMReference.V_isLastVersion":{getCellTooltip:function(e,o){let n;return n=-1===e.rowID?o.getCellDefaultTooltip(e):e.cellModel?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}},buildColumn:function(e){return Object.assign({dataIndex:"ds6wg:PLMReference.V_isLastVersion",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"]){var t=e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:isLastRevision":{getCellTooltip:function(e,o){let n;return n=-1===e.rowID?o.getCellDefaultTooltip(e):e.cellModel?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:isLastRevision",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"]){var t=e.nodeModel.options.grid["ds6wg:PLMReference.V_isLastVersion"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:isLastRevisionPerState":{getCellTooltip:function(e,o){let n;if(-1===e.rowID)n=o.getCellDefaultTooltip(e);else{n=("boolean"!=typeof e.cellModel?d(e.cellModel):e.cellModel)?{shortHelp:t.columnsDef.lastRevision}:{shortHelp:t.columnsDef.notlastRevision}}return n},buildColumn:function(e){return Object.assign({dataIndex:"ds6w:isLastRevisionPerState",kind:"boolean",typeRepresentation:"boolean",minWidth:50,editableFlag:!1,alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel&&void 0!==e.nodeModel.options.grid["ds6w:isLastRevisionPerState"]){var t=e.nodeModel.options.grid["ds6w:isLastRevisionPerState"];return("boolean"==typeof t?t:"TRUE"===t.toUpperCase())?"lc_dgv-lastversion-check":"lc_dgv-lastversion-wrong"}}},e)}},"ds6w:status":{buildColumn:function(e){return s.addCSSMaturityClasses(void 0,"wux-controls-label"),Object.assign({dataIndex:"ds6w:status",kind:"tag",minWidth:50,editableFlag:!1,typeRepresentation:"tag",className:"lc-maturity-state",alignment:"center",customisation:{exportable:{lock:!1,value:!0}},getCellClassName:function(e){if(e.nodeModel){var t,o=e.nodeModel.getReferenceValue("ds6w:status-original")?e.nodeModel.getReferenceValue("ds6w:status-original"):e.nodeModel.getReferenceValue("ds6w:status");if(o){if(!1===o.contains(".")){let t=e.nodeModel.getReferenceValue("ds6w:policy-original")?e.nodeModel.getReferenceValue("ds6w:policy-original"):e.nodeModel.getReferenceValue("ds6w:policy");t&&(o=t+"."+o)}t=s.getAndCreateMaturityClass(o,"wux-controls-label")}return t}}},e)},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{o.launchIfEnabled(r,"MaturityHdr")},t)}},updateAttributesDelayed:function(e,t,o){let n=[];for(let t=0;t<e.length;t++){var i=e[t].getReferenceValue("ds6w:status-original")?e[t].getReferenceValue("ds6w:status-original"):e[t].getReferenceValue("ds6w:status");if(i){let o;o=!1===i.contains(".")?e[t].getReferenceValue("ds6w:policy-original")?e[t].getReferenceValue("ds6w:policy-original"):e[t].getReferenceValue("ds6w:policy"):i.split(".")[0],-1===h.indexOf(o)&&n.push(o)}}n.length&&s.addCSSMaturityClasses(n,"wux-controls-label")}},"ds6wg:revision":{buildColumn:function(e){var t=null;let o=!0,n="string";return!i.getConfig("readOnlyApp")&&(o=!1,n="url"),(t=Object.assign({dataIndex:"ds6wg:revision",kind:n,minWidth:50,editableFlag:!1,typeRepresentation:"url",customisation:{exportable:{lock:!1,value:!0}},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.isGroupingNode?"string":"url"},getCellValue:function(e){var t=e&&e.nodeModel?e.nodeModel.options.grid["ds6wg:revision"]:void 0;return t?{label:t,func:function(){console.log("Revision Column Value: "+t)}}:void 0},getCellValueForExport:function(e){return e&&e.nodeModel?e.nodeModel.options.grid["ds6wg:revision"]:void 0}},e)).kind=n,t},actionOnClick:function(e,t){if(!0===a.get().getEditMode()&&e.nodeModel){let t=0;!1===e.nodeModel.isSelected()&&(e.nodeModel.select(),t=250),setTimeout(()=>{var e=r.getCommand("HistoryHdr");e&&e.begin()},t)}}}}}),define("DS/ENXNav/commands/Download",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADContext","DS/PADServices/utils/GlobalUtils","DS/ENXNav/commands/CmdUtils"],function(e,t,o,n,i){"use strict";return e.extend({init:function(e){this._parent(e),i.selectionMgt(this.options.ID,{})},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes();require(["DS/DocumentManagement/DocumentManagement","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/ModelEvents","DS/DocumentCommands/DocumentCommandsV2"],function(t,o,i,s){let r=e.map(e=>e.getID());r=r.filter((e,t)=>r.indexOf(e)===t),o.getPlatformServices({platformId:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",onComplete:function(e){t.getDocuments(r,{tenant:e.platformId,tenantUrl:e["3DSpace"],additionalURLParams:"$fields=isDocumentType",onComplete:function(t){if(t.success){var o=new i;o.subscribe({event:"docv2-show-notification"},function(e){var t={title:e.title,subtitle:e.subtitle,message:e.message,className:e.lable};n.displayNotif(t)}),new s({fetchSecurityContext:function(){},getSelectedNodes:function(){return t.data},getDocumentFromNodeModel:function(e){return e},platformUrls:e,isFromContextMenu:!0,events:o}).commands.Download.execute()}},onFailure:function(e){console.log(e)}})}})})}})}),define("DS/ENXNav/models/RefreshMask",["DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/PromiseCompletion","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o){return{}}),define("DS/ENXNav/commands/CloseSelectedCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{onlyRoot:!0})},execute:function(){var e=o.get().getPADTreeDocument(),t=e.getSelectedNodes();let n=t.length;e.withTransactionUpdate(function(){if(n>1)e.removeRootsQuiet(t);else for(var o=0;o<t.length;o++)e.removeRoot(t[o])})}})}),define("DS/ENXNav/views/private/SearchView",["css!DS/ENXNav/ENXNav.css","DS/ENXNav/views/private/Search","DS/PADServices/views/ENXModal","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n){"use strict";function i(e){return this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.__buildView(),this}return i.prototype.getContent=function(){return this.elements.container},i.prototype.__buildView=function(){var e=this;this.elements.findContainer=new t({placeholder:this.options.placeholder,onSearchRequest:function(t,o){e.options.events.onSearch&&e.options.events.onSearch({searchFts:t,matchCase:o}),e.close()},onSearchIdRequest:function(t){e.options.events.onSearch&&e.options.events.onSearch({rscId:t}),e.close()},onSearchClose:function(){e.close()}});var i=this.options.position.x-250;i<0&&(i=this.options.position.x);var s=this.options.target.getBoundingClientRect(),r=this.options.position.y+30;r>s.bottom-75&&(n.publish({event:"ENXViews/ActionBar/hide"}),r>s.bottom&&(r=this.options.position.y-40));var a=document.querySelector(".enx-appMainBody");e.elements.modalFts=new o({target:a,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",content:this.elements.findContainer.getContent(),position:{of:this.options.target,my:"top left",at:"top left",offsetX:i,offsetY:r},events:{onClickOutsideContent:function(){e.close()}}}),e.elements.modalFts.getContent().addClassName("enx-searchviewModal"),e.elements.modalFts.getContent().querySelector(".wux-windows-window-content").setStyle("padding","3px")},i.prototype.close=function(){this.options.events.onClose&&this.options.events.onClose(),this.elements.modalFts.close()},i}),define("DS/ENXNav/views/private/externalColumnsViews/classification",["css!DS/ENXNav/ENXNav.css","i18n!DS/ENXNav/assets/nls/ENXNav.json","text!DS/ENXNav/assets/templates/bookmarksTemplate.html","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","UWA/Utils","DS/Handlebars/Handlebars","DS/PADServices/views/ENXModal","DS/Controls/Button"],function(e,t,o,n,i,s,r,a){"use strict";var l=s.compile(o);function d(e,t){return l({className:t,bookmarks:e})}return{"ds6w:bookmarks":{getCellTooltip:function(e,t){let o=null;if(-1===e.rowID)o=t.getCellDefaultTooltip(e);else{let n=e.nodeModel.getReferenceValue("ds6w:bookmarks");if(n){let s=d(n=i.splat(n));o={title:t.getColumnOrGroup(e.columnID).text,shortHelp:s,allowUnsafeHTMLShortHelp:!0,wrapThreshold:315,updateModel:!1}}}return o},buildColumn:function(e){return Object.assign(e,{dataIndex:"ds6w:bookmarks",width:100,minWidth:40,editableFlag:!1,kind:"url",typeRepresentation:"url",customisation:{exportable:{lock:!1,value:!0}},getCellValue:function(e){var o=e.nodeModel?e.nodeModel.options.grid["ds6w:bookmarks"]:void 0,n=void 0;return o&&(n=1===(o=i.splat(o)).length?{label:o[0]}:{label:t.replace(t.columnsDef.bookmarks,{nbBookmarks:o.length})}),n},getCellValueForExport:function(e){var t="";if(-1===e.rowID)t=e.cellModel;else if(e.nodeModel){var o=e.nodeModel?e.nodeModel.options.grid["ds6w:bookmarks"]:void 0;o&&(t=(o=i.splat(o)).join(","))}return t}})},actionOnClick:function(e,t){if(e.nodeModel){let n=e.nodeModel.getReferenceValue("ds6w:bookmarks");if(void 0!==n){let s=d(n=i.splat(n)),l=document.querySelector(".enx-appMainBody"),c=e.cellView.getContent().getBoundingClientRect(),p={of:l,my:"top left",at:"top left",offsetX:c.x,offsetY:c.y};var o=new r({target:l,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!0,title:t.getPADDGVView().options.dgv.getColumnOrGroup(e.columnID).text,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:s,position:p,buttons:{Close:new a({onClick:function(){o.close()}})},events:{onClickOutsideContent:function(){o.close()}}})}}}}}}),define("DS/ENXNav/commands/CopyLink",["DS/ApplicationFrame/Command","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/commands/CmdUtils"],function(e,t,o){"use strict";return e.extend({init:function(e){this._parent(e),o.selectionMgt(this.options.ID,{monoselection:!0})},execute:function(){t.publish({event:"ENXModel/Model/CopyLink",data:{}})}})}),define("DS/ENXNav/commands/tools/ExportAs",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/Utility","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/views/ProgressDialog","DS/PADUtils/views/PADAlert","DS/PADUtils/PADSettingsMgt","i18n!DS/PADServices/assets/nls/PADServices","DS/UIKIT/Mask","DS/ENXNav/utils/LocalStorageForAppState"],function(e,t,o,n,i,s,r,a,l,d,c,p,u){"use strict";var h;return t.extend({init:function(e){this._parent(e);var t=o.get();t.options.model?t.options.model:t.getPADTreeDocument();this._checkIfTreeView(),UWA.is(t.addEvent,"function")&&t.addEvent("onToggleView",this._checkIfTreeView.bind(this)),n.isMobileDevice()&&this.disable()},_checkIfTreeView:function(){switch(o.get().getPADTreeDocument().options.active_view){case"treelistview":case"datagridview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}},execute:function(){this.disable(),this._setCancelProcess(!1);for(var e=this.getArguments(),t="csv",o=0;o<e.length;o++)"ExportAs"===e[o].ID?t=e[o].Value:"TargetDiv"===e[o].ID&&(this.targetDiv=document.querySelector("."+e[o].Value));var n=this;r.getModelEvents().subscribeOnce({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete"},function(e){e.cancelPrintOrExport||r.publish({event:"ENXViews/DatagridView/ExportAs",data:{exportAs:t}}),n.enable()}),this._populateBeforeExport(t)},_populateBeforeExport:function(t){var n,g=this,f=o.get().getPADTreeDocument(),v=this._getAllVisibleNodes(f),m=[],b=d.getSetting("printobjectslimit");if("Print"===g._id&&v.length>b)return l.displayNotification({msg:e.replace(e.PrinteLargeDataLimit,{maxResult:b}),eventID:"warning",key:"EnxNav-printeLargeDataLimit"}),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!0}}),void g.enable();if(v.length>1e3&&!u.get("continueOrSkip"))n=this.__askStopOrContinue();else{let e=u.get("dontAskDecision");n=!0===e||!1===e?Promise.resolve(e):Promise.resolve(!1)}n.then(function(n){if(h)g.enable();else if(!0===n)console.log("Launch real Export/Print without update"),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!1}});else{this._progressDiag=new a({target:g.targetDiv,title:e["ExportAs-"+t],width:260,progressBar:{displayStyle:"normal"}}),this._progressDiag.setProgress(0),this._progressDiag.setProgress(5);var l=function(e,t){for(var o=[],n=e.length,i=0;i<n;i+=t)o.push(e.slice(i,i+t));return o}(v,500);f.setUseChangeTransactionMode(!0);var d=o.get().getPADDGVView().getColumnsForExport(),u=85/l.length,b=1,_=!1;console.log("Nb Batches:"+l.length+"\n Step:"+u),r.subscribeOnce({event:"ENXViews/ExportAs/CancelExportOrPrint"},function(){p.mask(g._progressDiag.options.target,c.documentsList.masks.cancelExport),g.disable(),_=!0}),m.push(new Promise(function(e,t){var o=i.createStepper(l,{model:f},function(t,n){s.updateNLSforexport(f,t).then(function(){_?e():n.model.fillAdditionalColumns(t,d,"ExportAs").then(function(){var e=Math.floor(b*u)+5;console.log("Progress:"+e+"\n"),g._progressDiag.setProgress(e),b++,o()})})},e);o()})),Promise.all(m).then(function(){p.unmask(g._progressDiag.options.target),_?r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!0}}):(f.setUseChangeTransactionMode(!1),console.log("Launch real Export/Print"),g._progressDiag.setProgress(100),r.publish({event:"ENXViews/DatagridView/FillAsyncForExportAs/Complete",data:{cancelPrintOrExport:!1}})),setTimeout(function(){g._progressDiag.close(),delete g._progressDiag},200),g.enable()}),g.enable()}}.bind(this))},__askStopOrContinue:function(){var t=this,o=!1,n=!1;return new Promise(function(i){require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(s,r){t.modalStop=new s({domId:"enx-exportAsCmd",target:t.targetDiv,title:e.ExportAsContinueTitle,width:310,content:e.replace(e.ExportAsContinueContent,{nbNodes:1e3}),buttons:{No:new r({domId:"enx-exportAsCmd-skip",label:e.ExportSkip,onClick:function(){o=!0,i(!0),t.modalStop.options.checkboxInfos.checkFlag&&(u.set("continueOrSkip",!0),u.set("dontAskDecision",!0)),t.modalStop.close()}}),Yes:new r({domId:"enx-exportAsCmd-continue",label:e.ExportContinue,onClick:function(){n=!0,i(!1),t.modalStop.options.checkboxInfos.checkFlag&&(u.set("continueOrSkip",!0),u.set("dontAskDecision",!1)),t.modalStop.close()}})},checkboxInfos:{label:e.DonotShowAgain,checkFlag:!1},closeCB:function(){o||n||t._setCancelProcess(!0),i(!0)}}),document.querySelector(".wux-windows-window-content").style.background="white"})})},_getAllVisibleNodes:function(e){var t=[],o=e.getRoots();return o.length&&o.forEach(function(e){e.isVisible()&&(t.push(e),e.processDescendants({processNode:function(){this.isVisible()&&t.push(this)}}))}),t},_setCancelProcess:function(e){h=e}})}),define("DS/ENXNav/commands/FindInCtxCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{monoselection:!0})},execute:function(){var e=this;require(["DS/ENXNav/utils/FindInCtx"],function(t){var n=o.get().getSelectedNodes(),i=e.getArguments();1===i.length&&(e.targetDiv=document.querySelector("."+i[0].Value),t.launchFindWithDialog({position:e.options.position,renderTo:e.targetDiv,node:n[0]}))})}})}),define("DS/ENXNav/commands/CollapseThumbsCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t,o){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{lessExpanded:!0}),e.viewMgt(this.options.ID,{nodgv:!0,notiles:!0,nothumbs:!0})},execute:function(){var t=o.get(),n=t.getSelectedNodes();t.options.views.graphview.setGroupThumbnailState({nodes:n,expanded:!0}),e.checkAvailability()}})}),define("DS/ENXNav/views/private/ExpandLevelSelector",["css!DS/ENXNav/ENXNav.css","DS/ENXNav/views/private/LevelSelector","DS/PADServices/views/ENXModal","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n){"use strict";function i(e){return this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.__buildView(),this}return i.prototype.getContent=function(){return this.elements.container},i.prototype.__buildView=function(){var e=this;this.elements.levelSelectorContainer=new t({onLevelSelectorSet:function(t){"function"==typeof e.options.events.onLevelSelectorSet&&e.options.events.onLevelSelectorSet(t),e.close()},onLevelSelectorClose:function(){e.close()}});var n={of:this.options.target,my:"bottom center",at:"bottom center",offsetX:0,offsetY:-80};if(this.options.position&&this.options.position.x){var i=this.options.position.x-250;i<0&&(i=this.options.position.x);var s=this.options.position.y+30;n={of:this.options.target,my:"top left",at:"top left",offsetX:i,offsetY:s}}var r=document.querySelector(".enx-appMainBody");e.elements.modalFts=new o({target:r,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",content:this.elements.levelSelectorContainer.getContent(),position:n,events:{onClickOutsideContent:function(){e.close()}}}),e.elements.modalFts.getContent().addClassName("enx-ExpandLevelSelectorModal"),e.elements.modalFts.getContent().querySelector(".wux-windows-window-content").setStyle("padding","3px")},i.prototype.close=function(){this.options.events&&this.options.events.onClose&&this.options.events.onClose(),this.elements.modalFts.close()},i}),define("DS/ENXNav/models/xNavNodeModel",["DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/ENXNav/views/private/externalColumnsViews/UtilsColumns","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADServices/utils/AttributesMgtV2","DS/ENOXParser/modules/common/Helpers","DS/PADServices/settings/AppSettings"],function(e,t,o,n,i,s,r){"use strict";function a(e){e._getFilterInfo||(e._getFilterInfo=d.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=d.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=d.prototype._removeChildrenFilterInfo.bind(e),e.filterInChild=d.prototype.filterInChild.bind(e),e.filterOutChild=d.prototype.filterOutChild.bind(e))}var l={label:"",icons:[],grid:{},padgrid:{},resourceid:"",type:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,isReadOnly:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,contextualMenu:[{type:"SeparatorItem"}],synthesis:{},excludedOccurences:[],uniqueIdentifier:null};function d(o){if(!0===o.isGroupingNode)return function(o){this.options=UWA.clone(c),!0===r.getSetting("grpBSD")&&(this.options.icons=[t.getWebappsAssetUrl("ENXNav","icons/22/I_OrganizeBSD.png")]);this.options=UWA.extend(this.options,o),e.call(this,this.options),this.isGroupingNode=!0,this.isRelationsObjectNode=!0}.call(this,o);if(this.options=UWA.clone(l),o&&o.grid){this.options.subLabel=o.grid["ds6w:responsible"],this.options.description=o.grid["ds6w:identifier"],this.options.thumbnail=o.thumbnail?o.thumbnail:t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png");var s=o.grid["ds6w:reserved"]?o.grid["ds6w:reserved"]:o.padgrid&&o.padgrid["ds6w:reserved"]?o.padgrid["ds6w:reserved"]:null;if(null!==s)if("boolean"==typeof s?s:"TRUE"===s.toUpperCase())this._isLockedByMe(o)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[n.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[n.tooltip_reserved]);else this.options.statusbarIcons=["lock-open"],this.options.statusbarIconsTooltips=[n.tooltip_unreserved]}o&&UWA.is(o.relcount)&&0===o.relcount&&(o.children=null),this.options.acceptNodeDropAt=function(e,t){return this.isRoot()?0===t:-1===t||1===t},this.options=UWA.extend(this.options,o),this.options.relationOrder||(this.options.relationOrder=-1),this.options.grid||(this.options.grid={}),this.options.grid.instanceName&&(console.warn("xNavNodeModel: Please use ds6w:label-Instance instead of instanceName"),this.options.grid["ds6w:label-Instance"]=this.options.grid.instanceName,delete this.options.grid.instanceName);for(var a=this.options,d=i.getColumnsOrder(),p=Object.keys(a.grid),u=0;Array.isArray(d)&&u<d.length;u++)"tree"!==d[u]&&-1===p.indexOf(d[u])&&(a.grid[d[u]]=void 0),a.grid[d[u]]&&!isNaN(a.grid[d[u]])&&(this.isNumber(a.grid[d[u]])?a.grid[d[u]]=parseInt(a.grid[d[u]],10):this.isFloating(a.grid[d[u]])&&(a.grid[d[u]]=parseFloat(a.grid[d[u]])));var h=i.getAdditionalColumns();for(u=0;Array.isArray(h)&&u<h.length;u++)a.grid&&void 0===a.grid[h[u]]&&(a.grid[h[u]]="");a.getAttributeValueForFiltering=function(t){return a.grid[t+"-original"]?a.grid[t+"-original"]:e.prototype.getAttributeValue.call(this,t)}.bind(this),e.call(this,this.options)}var c={kind:"groupingNode",label:"",resourceid:"",icons:[{iconName:"group"}],grid:{},children:[],thumbnail:null,useAsyncPreExpand:!0,parentNode:null,contentRetrieved:!1,ds6w:"",grp:"",uql:null,grpSelected:!1};return d.prototype=Object.create(e.prototype),d.prototype.isSupplemental=function(){return!0===this.options.supplementalNode},d.prototype.queueNls=function(){let e=this;require(["DS/PADServices/utils/DictionaryAccess"],function(t){t.updateNLS(e)})},d.prototype.reverseExpand=function(t){var o=t||{},n={ids:[],relids:[]};if(o.state&&"partiallyExpanded"===o.state)for(var i=this;i&&!i.isRoot();)!0===i.options.waiting4validation&&(-1===n.ids.indexOf(i.getID())&&n.ids.push(i.getID()),-1===n.relids.indexOf(i.getRelationID())&&n.relids.push(i.getRelationID())),(i=i.getParent()).isExpanded()||i.setState({state:o.state});else e.prototype.reverseExpand.call(this);return n},d.prototype.isFloating=function(e){return"number"==typeof e&&!Number.isInteger(e)},d.prototype.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},d.prototype.getFarthestParent=function(){for(var e=this;e&&!e.isRoot();)if(!(e=e.getParent())){e=this;break}return e},d.prototype.getOccurencePath=function(t){if(this.getParent()&&(!0===this.options.isGroupingNode||this.getNodeSource()===e.NODE_SOURCE.GROUPING))return this.getParent().getOccurencePath(t);if(UWA.is(t,"function")&&t(this),!this.isRoot()&&this.getParent()){for(var o=this.getParent();o.getNodeSource()===e.NODE_SOURCE.GROUPING;)o=o.getParent();var n=o.getOccurencePath(t);return this.options.relationid&&n.push(this.options.relationid),this.options.resourceid&&!this.options.resourceid.includes("fakeNode")&&n.push(this.options.resourceid),n}return[this.options.resourceid]},d.prototype.getOccurencePathWithType=function(){if(!0===this.options.isGroupingNode)return this.getParent().getOccurencePathWithType();if(!this.isRoot()&&this.getParent()){var e=this.getParent().getOccurencePathWithType();return e.push({resourceid:this.options.relationid,type:this.options.relationtype}),e.push({resourceid:this.options.resourceid,type:this.options.type}),e}return[{resourceid:this.options.resourceid,type:this.options.type}]},d.prototype.getNodeByPath=function(e,t,o,n){("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1);var i=e.indexOf(this.options.resourceid),s=function(){if(t!==o&&(this.isExpanded()||this.childComputed||void 0!==n&&!1!==n)){var i=e[t+1],s=this.getChildren();if(s&&0!==s.length){for(var r=null,a=0;a<s.length&&null===r;a++){var l=s[a];!0===l.isGroupingNode?r=l.getNodeByRelIDInGroup(i):i===l.options.relationid&&(r=l)}return null===r?this:r.getNodeByPath(e,t+2,o,n)}return this}return this}.bind(this);return this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]?s():void 0!==typeof i&&-1!==i?(e=e.slice(i,e.length),s()):void 0},d.prototype.getFirstNodeInPath=function(e,t,o){var n={node:null,find_in_ctx_path:[]};if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t===o||!this.isExpanded())return n.node=this,t!==o&&(n.find_in_ctx_path=e.slice(t,e.length)),n;var i=e[t+1],s=this.getChildren();if(0===s.length)return n.node=this,n.find_in_ctx_path=e.slice(t,o-t+1),n;for(var r=!0,a=0;a<s.length;a++){var l=s[a];if(i===l.options.relationid)return r=!1,l.getFirstNodeInPath(e,t+2,o)}if(!0===r)return n.node=this,n.find_in_ctx_path=e.slice(t,o-t+1),n}},d.prototype.getID=function(){return this.options.resourceid},d.prototype.getRelationID=function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},d.prototype.setRelationID=function(e,t){this.options.relationid=e,this.options.relationtype=t},d.prototype.setUniqueIdentifier=function(e){this.options.uniqueIdentifier=e},d.prototype.getUniqueIdentifier=function(){return this.options.uniqueIdentifier},d.prototype.getNodesById=function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},d.prototype.getChildById=function(e){var t,o=this.getChildren();if(o)for(var n=0;n<o.length;n++)if(o[n].getID()===e){t=o[n];break}return t},d.prototype.getChildByIds=function(e,t){if(!0===this.options.isGroupingNode)return function(e,t,o){var n,i=e.getChildren();for(let e=0;i&&e<i.length;e++){var s=i[e];if(!0===s.isGroupingNode){if(void 0!==(n=s.getChildByIds(t,o)))break}else if(void 0===t){if(s.getID()===o){n=s;break}}else if(s.getRelationID()===t){n=s;break}}return n}(this,e,t);var o,n=this.getChildren();if(n)for(var i=0;i<n.length&&void 0===o;i++){var s=n[i];if(!0===s.isGroupingNode){var r=s.getChildren();for(let n=0;r&&n<r.length&&void 0===o;n++){var a=r[n];if(!0===a.isGroupingNode){if(void 0!==(o=a.getChildByIds(e,t)))break}else if(void 0===e){if(a.getID()===t){o=a;break}}else if(a.getRelationID()===e){o=a;break}}}else if(void 0===e){if(s.getID()===t){o=s;break}}else if(s.getRelationID()===e){o=s;break}}return o},d.prototype.getChildNodesByRelId=function(e){let t=this.getChildren(),o=null;if(t&&t.length)for(let n=0;null===o&&n<t.length;n++){let i=t[n];i.getRelationID()===e&&(o=i)}return o?[o]:[]},d.prototype.getNodesByRelId=function(e){var t={listOfFoundNodes:[],foundId:void 0};return this._getNodesByRelId(e,t),t.listOfFoundNodes},d.prototype._removeFilterInfo=function(){delete this.options._filterInfo},d.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},d.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},d.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},d.prototype.filterOut=function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(a(e),e.filterOutChild(this))},d.prototype.filterIn=function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var o=t.parentBeforeFiltering;a(o),o.filterInChild(this)}if(Boolean(e)){var n,i=this._getChildrenFilterInfo();(n=i&&i.childrenBeforeFiltering?i.childrenBeforeFiltering:this.getChildren())&&n.forEach(function(t){t.filterIn(e)})}},d.prototype.filterOutChild=function(e){var t=this.getChildren();if(t.indexOf(e)<0)throw"Not a child";var o=this._getChildrenFilterInfo(!0);if(!o.childrenBeforeFiltering){o.childrenBeforeFiltering=t&&t.length>0?t.slice(0):[];UWA.is(this._expandState)&&(o.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}e._getFilterInfo(!0).parentBeforeFiltering=this,UWA.is(this.removeChild,"function")?this.removeChild(e):this.removeRoot(e,!0,!0),UWA.is(this.setState,"function")&&this.setState({state:o.expandStateBeforeFiltering}),o.filteredOutChildren||(o.filteredOutChildren=[]),o.filteredOutChildren.push(e)},d.prototype.filterInChild=function(e){var t=this._getChildrenFilterInfo();if(t){var o=t.childrenBeforeFiltering;if(o){var n=o.indexOf(e);if(n>=0){var i=e._getFilterInfo();if(i&&i.parentBeforeFiltering===this){var s,r=this.getChildren();if(r)for(var a=0;a<r.length;a++){var l=r[a];if(o.indexOf(l)>n){s=l;break}}delete i.parentBeforeFiltering,void 0!==e.options.isRootAttached?!0===e.options.isRootAttached&&this.insertBefore(e,s):this.insertBefore(e,s),UWA.is(this.setState,"function")&&this.setState({state:t.expandStateBeforeFiltering}),e._removeFilterInfo();var d=t.filteredOutChildren.indexOf(e);t.filteredOutChildren.splice(d,1),0===t.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}}},d.prototype._getNodesById=function(e,t){var o=!1;if(this.getID()===e)t.listOfFoundNodes.push(this),o=!0;else{var n=this.getChildren();if(n)for(var i=0;n&&i<n.length;i++)o="function"==typeof n[i]._getNodesById&&n[i]._getNodesById(e,t)||o}return o},d.prototype._getNodesByRelId=function(e,t){var o=this.options.relationid,n=this.getID();if(o===e)t.listOfFoundNodes.push(this),t.foundId=n;else if(n!==t.foundId){var i=this.getChildren();if(i)for(var s=0;s<i.length;s++)!0!==i[s].isGroupingNode?i[s]._getNodesByRelId(e,t):i[s]._getNodesByRelIdInGroup(e,t)}},d.prototype._getNodesByRelIdInGroup=function(e,t){this.getID();var o=this.getChildren();if(o)for(var n=0;n<o.length;n++)!0!==o[n].isGroupingNode?o[n]._getNodesByRelId(e,t):o[n]._getNodesByRelIdInGroup(e,t)},d.prototype.updateFromFetch=function(e,t){this.updateAttributes(e.attributes,t)},d.prototype.updateAttributes=function(e,t){if(!UWA.is(e,"array")||!UWA.is(t,"array"))throw new Error("Invalid argument(s)");var o=t,n=t.tree?t.tree:i.getTreeColumn(),s={};e.forEach(function(e){UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(s.type=e.value),e.name===n?s.label=e.value:"type_icon_url"===e.name?(s.icons=[],s.icons.push(e.value)):"preview_url"===e.name||"thumbnail_2d"===e.name?(s.thumbnail=e.value,s.grid||(s.grid={}),s.grid.thumbnail="url("+e.value+")"):-1!==o.indexOf(e.name)?(s.grid||(s.grid={}),s.grid[e.name]=e.value):-1!==o.indexOf(e.name)||"ds6w:reservedBy-Instance"!==e.name&&"ds6w:reservedBy"!==e.name||(s.grid||(s.grid={}),s.grid[e.name]=e.value)}),this.updateOptions(s)},d.prototype.updateNlsAttributes=function(e){var t={};for(var o in e)for(var n in t.grid||(t.grid={}),e[o])this.options.grid[o]===n&&(t.grid[o]=e[o][n]);t.grid=UWA.extend(this.options.grid,t.grid,!0),this.updateOptions(t)},d.prototype.getFirstCommonAncestor=function(e){if(this===e)return e;for(var t,o,n=this.getPath(),i=e.getPath(),s=Math.min(n.length,i.length),r=0;r<s;r++)if(n[r]!==i[r]){t=r;break}return t>0?o=n[t-1]:void 0===t&&(o=n[s-1]),o},d.prototype.isDescendantOf=function(e){if(!0===this.options.isGroupingNode)return this.getParent().isDescendantOf(e);var t;if(t=e instanceof d?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var o=this.getParent();if(o)return o.isDescendantOf(t)}return!1},d.prototype.getDepth=function(){for(var e=this,t=0;!e.isRoot();){var o=e.getParent();if(null===o)break;!0!==o.isGroupingNode&&t++,e=o}return t},d.prototype.getLeaves=function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},d.prototype.getAttribute=function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},d.prototype.updateOptions=function(o){if(o.grid){this.options.thumbnail||o.thumbnail||(o.thumbnail=t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),o.subLabel=o.grid["ds6w:responsible"]?o.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",o.description=o.grid["ds6w:identifier"]?o.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"";var i=void 0!==o.grid["ds6w:reserved"]?o.grid["ds6w:reserved"]:o.padgrid&&void 0!==o.padgrid["ds6w:reserved"]?o.padgrid["ds6w:reserved"]:null;if(null!==i)if("boolean"==typeof i?i:"TRUE"===i.toUpperCase())this._isLockedByMe(o)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[n.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[n.tooltip_reserved]);else o.statusbarIcons=["lock-open"],o.statusbarIconsTooltips=[n.tooltip_unreserved]}if(this.options.edit&&(o.edit=this.options.edit),o.grid){let e=Object.keys(this.options.grid);for(let t=0;t<e.length;t++)e[t].contains("-original")&&o.grid[e[t].replace("-original","")]&&delete this.options.grid[e[t]]}if(this.options.deType&&o.display){let e=this.getTreeDocument().options.context;e.hasActiveDesignExp()&&e.getPseService().updateModifiedAssetTitle(o.display,o.resourceid)}let s=this.getTreeDocument(),r=!1;this.isRoot()&&o.label&&o.label!==this.options.label&&(r=!0),e.prototype.updateOptions.call(this,o),r&&function(e){var t=e.getRoots();e.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.length,added_node:t[t.length-1]}})}(s)},d.prototype.childValidationChecker=function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])}))})}},d.prototype._isLockedByMe=function(e){var t=!0,o=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"";Array.isArray(o)&&(o=o.join(","));var n=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",i=require("DS/PADUtils/PADUtilsServices"),s=i.getUserLogin()?i.getUserLogin():"",r=i.getUserName()?i.getUserName():"";t=!0;return o.trim().length>0?(t=o.toUpperCase().trim()===s.toUpperCase().trim()||!1)||(t=o.toUpperCase().trim()===r.toUpperCase().trim()||!1):n.trim().length>0&&(t=r.toUpperCase().trim()===n.toUpperCase().trim()||!1),t},d.prototype.childValidationChecker=function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])}))})}},d.prototype.getPLMValue=function(e){var t=null;return i.getTreeColumn()===e?t=this.getLabel():void 0!==this.options.grid[e]?t=this.options.grid[e]:this.options.padgrid&&void 0!==this.options.padgrid[e]&&(t=this.options.padgrid[e]),t},d.prototype.hasSynthesis=function(){return!0===this.options.filtered?void 0!==this.options.synthesis.filteredSynthesis:void 0!==this.options.synthesis.global},d.prototype.setSynthesis=function(e){!0===this.options.filtered?this.options.synthesis.filteredSynthesis=e:this.options.synthesis.global=e},d.prototype.getSynthesis=function(e){return!0===this.options.filtered?this.options.synthesis.filteredSynthesis[e]:this.options.synthesis.global[e]},d.prototype.setExcludedOccurrences=function(e){this.options.excludedOccurences=e;let t=this.getTreeDocument();e&&e.length&&t.isEditor()&&t.bubbleStaticMapMessageOnce()},d.prototype.getExcludedOccurrences=function(){return this.options.excludedOccurences},d.prototype.cleanUpPathes=function(){if(this.options.excludedOccurences&&this.options.excludedOccurences.length)for(let e=0;e<this.options.excludedOccurences.length;e++){let t=this.options.excludedOccurences[e],o=t[t.length-1],n=this.getNodesById(o);for(let e=0;e<n.length;e++)s.array.compare(t,n[e].getOccurencePath())&&n[e].remove()}},d.prototype.getGroupID=function(){return this.getGroups().join("/")},d.prototype.getGroupObjID=function(){return!0===this.getParent().isGroupingNode?this.getParent().getGroupObjID():this.getParent().getID()},d.prototype.getPredicate=function(){return this.options.ds6w},d.prototype.getGroups=function(){var e;!0===this.options.merged?e=this.options.grp:e=require("UWA/Utils").splat(this.options.grp);return e},d.prototype.getFilterUQL=function(){if(null===this.options.uql){var e=this.getGroups().join("/");this.options.uql="["+this.options.ds6w+"]=("+e+")"}return this.options.uql},d.prototype.getNodeByRelIDInGroup=function(e){var t=null,o=this.getChildren();for(let n=0;n<o.length&&null===t;n++)!0===o[n].isGroupingNode?t=o[n].getNodeByRelIDInGroup(e):o[n].getRelationID()===e&&(t=o[n]);return t},d.prototype.isGrpSelected=function(){var e=this.options.grpSelected;if(!1===e){var t=this.getParent();!0===t.isGroupingNode&&(e=t.isGrpSelected())}return e},d.prototype.getCellTooltip=function(e){var t,i=e.nodeModel.getTreeDocument(),s=!1;if(i&&"structured"===i.getGroupLayout()&&(s=!0),this.options.dispText)t={shortHelp:this.options.dispText,updateModel:!1};else if(!0===s||!0===this.options.isOther)t={shortHelp:this.getLabel(),updateModel:!1};else{let i=this.getTreeDocument();if(i&&i.isGroupingApplied())t=0===(t=this.getGroups().join("/")).length?{shortHelp:this.getLabel(),updateModel:!1}:{title:this.options.bsIntent?n.replace(n.organizeBS.groupBy,{label:this.options.bsIntent.predicate.label}):void 0,updateModel:!1};else{let n=e.cellView.collectionView;t=o.executeGenericTooltip(e,n)}}return t},d}),define("DS/ENXNav/models/_xNavCVParser",["i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/HideShowController","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADProbes","DS/PADUtils/PADCommandProxy","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADPredicatesNls","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Utils"],function(e,t,o,n,i,s,r,a,l,d,c,p){"use strict";var u={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}};Object.freeze(u);var h,g,f,v="ds6w:Document",m=r.create(),b={},_={};function D(e,t){var o=!1;if(UWA.is(e,"object")&&UWA.is(t,"array")){var n=0,i=t.length,s=e.getID();do{s===t[n].getID()&&(o=!0),n++}while(!1===o&&n<i)}return o}function S(e,t){for(var o={},n=e||{},i=Object.getOwnPropertyNames(n),s=0;s<i.length;s++)t[i[s]]?t[i[s]]!==e[i[s]]&&(o[i[s]]=e[i[s]]):o[i[s]]=e[i[s]];return o}function x(e,t,o){var n=!1,i=null,s={};t.label!==e.options.label&&(s.label=t.label,!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(s.label+="(treeorder="+t.relationOrder+")"),n=!0);if(function(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var n=0;n<o;n++)if(typeof e[n]!=typeof t[n]&&"object"==typeof e[n]){if(void 0!==e[n]&&void 0!==t[n]&&e[n].iconPath!==t[n].iconPath)return!1}else if(e[n]!==t[n])return!1;return!0}return!1}return!1}(t.icons,e.options.icons)||(s.icons=t.icons,n=!0),t.thumbnail!==e.options.thumbnail&&(s.thumbnail=t.thumbnail,n=!0),t.display!==e.options.display&&(s.display=t.display,n=!0),t.type!==e.options.type&&(s.type=t.type,n=!0),t.relcount!==e.options.relcount){s.relcount=t.relcount,n=!0;var r=e.getChildren();0===s.relcount&&null!==r&&(s.children=null,i=u.NO_CHILDREN),s.relcount>0&&null===r&&(s.children=[],i=u.COLLAPSED)}null!==i||"expanding"!==e.getState()||o&&!1===o.changeState||(i=u.EXPANDED),t.relationOrder!==e.options.relationOrder&&(s.relationOrder=t.relationOrder,n=!0),!UWA.is(t.isPADHidden,"boolean")&&!UWA.is(t.isPADHiddenBackEnd,"boolean")||t.isPADHidden===e.options.isPADHidden&&e.options.isPADHidden===t.isPADHiddenBackEnd||(s.isPADHidden=t.isPADHidden,s.isPADHiddenBackEnd=t.isPADHiddenBackEnd,s.isPADHiddenBackEndReference=t.isPADHiddenBackEndReference,s.isPADHiddenBackEndInstance=t.isPADHiddenBackEndInstance,s.isPADHiddenBackEndOcc=t.isPADHiddenBackEndOcc,s.hsStatusOn=t.hsStatusOn,n=!0),void 0!==t.isHiddenState&&t.isHiddenState!==e.options.isHiddenState&&(s.isHiddenState=t.isHiddenState,n=!0),e.isRoot()&&(t.grid||(t.grid={}),t.grid.instanceName||(t.grid.instanceName=""));var a=S(t.grid,e.options.grid);if(UWA.equals(a,{})||(s.grid=a,n=!0),t.padgrid){var l=S(t.padgrid,e.options.padgrid);UWA.equals(l,{})||(s.padgrid=l,n=!0)}n&&(o&&!0===o.deleteTempOptions&&(delete e.options.waiting4validation,delete e.options.alternText),e.updateOptions(s),e._manageNLS=!0,o&&o.needRequestNls&&e.isVisible()&&d.updateNLS(e)),i&&e.setState(i)}function y(e,t,n,i,s,r,a,l){var d=e.getID(),c=[];if(!0===r&&N(e),n.nodes[d]){var p=UWA.clone(n.nodes[d]);UWA.is(p.isPADHiddenBackEnd,"boolean")&&(p.isPADHidden=p.isPADHiddenBackEnd,p.isPADHiddenBackEnd=p.isPADHiddenBackEnd,p.isPADHiddenBackEndReference=p.isPADHiddenBackEnd,p.hsStatusOn="reference",e.options.isPADHidden=void 0);var u=e.getRelationID(),h=n.nodes[u];h&&(p.relationOrder=h.relationOrder,p.grid=UWA.extend(h.grid,p.grid),UWA.is(h.isPADHiddenBackEnd,"boolean")&&(p.isPADHidden=h.isPADHiddenBackEnd,p.isPADHiddenBackEnd=h.isPADHiddenBackEnd,p.isPADHiddenBackEndInstance=h.isPADHiddenBackEnd,p.hsStatusOn="instance",e.options.isPADHidden=void 0)),o.defaultHiddenState(p),l&&l.needRequestNls?x(e,p,l):x(e,p),o.gatherParentsIfHidden(c,e),o.calculateParents(c);for(var g=e.getChildren(),f=0;g&&f<g.length;f++){var v=g[f].getRelationID(),m=a&&n.nodes[v]&&n.nodes[v].did?a[n.nodes[d].did][n.nodes[v].did]:void 0;l&&l.needRequestNls?y(g[f],e,n,i,s,r,m,l):y(g[f],e,n,i,s,r,m)}void 0!==a&&UWA.is(a[n.nodes[d].did].isPADHiddenBackEndOcc,"boolean")&&(e.options.hsStatusOn="occurence",e.options.isPADHidden=a[n.nodes[d].did].isPADHiddenBackEndOcc,e.options.isPADHiddenBackEnd=a[n.nodes[d].did].isPADHiddenBackEndOcc,e.options.isPADHiddenBackEndOcc=a[n.nodes[d].did].isPADHiddenBackEndOcc)}else{for(var b,_=!1,D=0;D<i.length&&!1===_;D++)(_=i[D].node.isDescendantOf(e))&&(b=i[D].root);if(!0===_){var S=e.getLeaves();if(S.length)for(var C=0;C<S.length;C++){var P=S[C];(t=P.getParent()).removeChild(P),s.push({node:t,root:b})}else t.removeChild(e)}}}function N(e){e.getState()===u.EXPANDED.state&&e.setState(u.PARTIALLY_EXPANDED)}function C(e){return UWA.is(e,"string")?"true"===e.toLowerCase():UWA.is(e,"boolean")?e:void 0}function P(e,t,o,n,i){o===t.length?e[n]=i:e[t[o]]&&P(e[t[o]],t,o+1,n,i)}function w(e,t,o){e[t]?e[t].push(o):(e[t]=[],e[t].push(o))}function A(e,t){if(void 0!==e&&Date.now()-t>e)throw{type:"TimeoutError"}}return b.buildStructure=function(e){var t={nodes:{},did_to_resourceid:{},structure:{}},o=[],n=[],i=[];e.results.forEach(function(e){if(e.attributes){var s={};e.attributes.forEach(function(e){"resourceid"===e.name||"physicalid"===e.name?s.resourceid=e.value:"did"===e.name&&(s.did=e.value)}),t.nodes[s.resourceid]=s,s.did&&(t.did_to_resourceid[s.did]=s.resourceid)}if(e.path){var r=e.path,a=r.length,l=r[0];if(3===a){r[1];var d=r[2];-1===n.indexOf(d)&&n.push(d)}-1===i.indexOf(l)&&i.push(l),o.push(r)}});var s=[],r=[],a={};try{i.forEach(function(e){0===n.length||-1===n.indexOf(e)?s.push(e):r.push(e),a[e]={children:[]},o.forEach(function(t){3===t.length&&e===t[0]&&a[e].children.push(t)})})}catch(e){console.error(e)}var l={};try{var d=function(e,o){var n=o[1],i=o[2],s=t.did_to_resourceid[n],r=t.did_to_resourceid[i];if(e&&void 0===e[s]&&(e[s]={},e[s][r]={},a[i])){var l=a[i].children;l&&l.forEach(function(t){d(e[s][r],t)})}};s.forEach(function(e){var o=t.did_to_resourceid[e],n={};a[e].children.forEach(function(e){d(n,e)}),l[o]=n})}catch(e){console.error(e)}return l},b.parse_expand=function(e,t,o,n,i){var r=s.createProbe("parse_expand"),a={nodes:{},did_to_resourceid:{},structure:{}},l=require("DS/PADUtils/PADSettingsMgt");void 0===f&&(f=l.getSetting("activateDGV"));let d=e.length;for(let s=0;s<d;s++){let r=e[s];if(r.attributes){var c=_.parse_attributes(r.attributes,t,o);a.nodes[c.resourceid]=c,UWA.is(c.did)&&(a.did_to_resourceid[c.did]=c.resourceid)}else if(r.path){var p;if(!1===n){p=r.path.length;var u=function(e){if(e){for(var t=Object.getOwnPropertyNames(e),o=0;o<t.length;o++)a.nodes[t[o]]&&(e[a.nodes[t[o]].did]=e[t[o]],delete e[t[o]],UWA.is(e[a.nodes[t[o]].did],"object")&&u(e[a.nodes[t[o]].did]),void 0===e.order&&(e.order=[]),e.order.push(a.nodes[t[o]].did));void 0===e.order&&(e.order=[])}};u(i),a.structure=i}else{var h=a.structure;p=r.path.length,1===Math.abs(p%2)?r.path.forEach(function(e,t){h.hasOwnProperty(e)||(h[e]={},p===t+1&&(h[e].pathLeaf=!0),0===Math.abs(t%2)&&(h[e].order=[])),h.order&&-1===h.order.indexOf(e)&&h.order.push(e),h=h[e]}):!0}}else if(r.icon__default_thumbnail_2d)r.icon__default_thumbnail_2d.forEach(function(e){e.did.forEach(function(t){var o=a.did_to_resourceid[t],n=a.nodes[o];n.icons&&0!==n.icons.length||(n.icons||(n.icons=[]),!0===f?n.icons.push({iconPath:"url("+e.icon+")"}):n.icons.push(e.icon)),n.thumbnail&&0!==n.thumbnail.length||(n.thumbnail=e.thumbnail_2d,n.grid||(n.grid={}),n.grid.thumbnail=!0===f?e.thumbnail_2d:"url("+e.thumbnail_2d+")")})});else if(r.pgp_overload)for(var g=Object.getOwnPropertyNames(r.pgp_overload),v=0;v<g.length;v++){var m=g[v],b=(m=m.replace(/[\[\]']+/g,"")).split(",").map(function(e){return e.trim()});r.pgp_overload[g[v]]["PGPShowExtension.V_PGP_Show"]&&P(a.structure,b,0,"isPADHiddenBackEndOcc",!C(r.pgp_overload[g[v]]["PGPShowExtension.V_PGP_Show"]))}else r.status&&"EXPAND_WAS_CUT_MAX_OUTPUT_PATHS"===r.status&&(a.status={expandTooLarge:!0})}return r.end(),a},_.internalsForTestAccess=function(e){return b.buildStructure(e)},_.parse_attributes=function(e,t,o){var n=require("DS/PADUtils/PADSettingsMgt");void 0===h&&(h=!0===n.getSetting("pgpFromServer")||!0===n.getSetting("supportPgpBasedOnDescription"))&&(g=n.getSetting("pgpFromServer")?["bo.pgpshowextension.v_pgp_show","ro.pgpshowextension.v_pgp_show"]:["ro.plminstance.V_description"]),void 0===f&&(f=n.getSetting("activateDGV"));for(var i={},s=void 0,r=0;void 0===s&&r<e.length;r++)"ds6w:globaltype"===e[r].name.toLowerCase()&&(s=e[r].value);if("ds6w:Instance"!==s&&""!==s&&void 0!==s){let r=e.length;for(let m=0;m<r;m++){let r=e[m];if("type"===r.name)r.name="ds6w:type";else if(-1!==r.name.indexOf("/")){var a=r.name.split("/");r.name=a[a.length-1]}if(UWA.is(r.value)&&UWA.is(r.value.replace,"function")&&(r.value=r.value.replace(/\n/g," ")),"ds6w:type"===r.name&&(i.type=r.value),"FALSE"!==r.value&&"TRUE"!==r.value||(r.value="TRUE"===r.value),r.value&&UWA.is(r.value,"string")&&-1!==r.value.indexOf("[")&&-1!==r.value.indexOf("]")){r.value=JSON.parse(r.value);var d=/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(\.\d+)?(([+-]\d\d:\d\d)|Z)?$/i,c=[];Array.isArray(r.value)&&r.value.length>0&&(r.value.forEach(function(e){if(d.test(e)){var t=e.slice(0,10).replace(/-/g,"/");c.push(t)}}),c.length>0&&(r.value=c))}if(""===r.value){var u=require("DS/PADServices/utils/AttributesMgtV2").getColumn(r.name);!u||"boolean"!=u.kind&&"boolean"!=u.typeRepresentation||(r.value=void 0)}if("resourceid"===r.name||"physicalid"===r.name)i.resourceid=r.value;else if("did"===r.name)i.did=r.value;else if("TreeOrder"===r.name||"ro.plminstance.V_treeorder"===r.name)i.relationOrder=parseFloat(r.value),isNaN(i.relationOrder)&&(i.relationOrder=-1);else if("matrixtxt"===r.name)l.checkNotIdentity(r.value)&&(i.grid||(i.grid={}),i.grid["positionMatrix-Instance"]=r.value);else if("type_icon_url"===r.name)i.icons||(i.icons=[]),!0===f?i.icons.push({iconPath:"url("+r.value+")",className:"dgv-icons"}):i.icons.push(r.value);else if("preview_url"===r.name||"thumbnail_2d"===r.name)i.thumbnail=r.value,i.grid||(i.grid={}),i.grid.thumbnail=!0===f?r.value:"url("+r.value+")";else if("svg"===r.name){var v=r.value;v&&v.length>0&&(i.grid||(i.grid={}),i.grid.svg||(i.grid.svg=[]),i.grid.svg.push({format:r.name,id:r.value}))}else if("relcount"===r.name)i.relcount=parseInt(r.value),0===i.relcount&&(i.children=null);else if("ds6w:kind"===r.name)i.grid||(i.grid={}),i.grid["ds6w:kind"]||(i.grid["ds6w:kind"]=[]),i.grid["ds6w:kind"].push(r.value);else if(o&&r.name===o&&"ds6w:Instance"!==s)i.label=r.value,i.display=i.label;else if(t&&-1!==t.indexOf(r.name))i.grid||(i.grid={}),void 0!==i.grid[r.name]?(i.grid[r.name]=p.splat(i.grid[r.name]),i.grid[r.name].push(r.value)):i.grid[r.name]=r.value;else if(i.padgrid||(i.padgrid={}),h&&-1!==g.indexOf(r.name.toLowerCase()))i.isPADHiddenBackEnd=!C(r.value);else{i.grid||(i.grid={});let e=r.dispValue?r.dispValue:r.value;void 0!==i.grid[r.name]?(i.grid[r.name]=p.splat(i.grid[r.name]),i.grid[r.name].push(e)):i.grid[r.name]=e,i.padgrid[r.name]=e}n.getSetting("activateFUN085903")&&"ds6w:globalType"===r.name&&(i.grid||(i.grid={}),i.grid.globaltype=r.value)}}else{let o=e.length;for(let s=0;s<o;s++){let o=e[s];if("ds6w:type"===o.name&&(i.type=o.value),"resourceid"===o.name||"physicalid"===o.name)i.resourceid=o.value;else if("did"===o.name)i.did=o.value;else if("TreeOrder"===o.name||"ro.plminstance.V_treeorder"===o.name)i.relationOrder=parseFloat(o.value),isNaN(i.relationOrder)&&(i.relationOrder=-1);else if("matrixtxt"===o.name)l.checkNotIdentity(o.value)&&(i.grid||(i.grid={}),i.grid["positionMatrix-Instance"]=o.value);else if(t&&-1!==t.indexOf(o.name+"-Instance"))i.grid||(i.grid={}),void 0!==i.grid[o.name+"-Instance"]?(i.grid[o.name+"-Instance"]=p.splat(i.grid[o.name+"-Instance"]),i.grid[o.name+"-Instance"].push(o.value)):i.grid[o.name+"-Instance"]=o.value;else if(i.padgrid||(i.padgrid={}),h&&-1!==g.indexOf(o.name.toLowerCase()))i.isPADHiddenBackEnd=!C(o.value);else{i.grid||(i.grid={});let e=o.dispValue?o.dispValue:o.value;void 0!==i.grid[o.name+"-Instance"]?(i.grid[o.name+"-Instance"]=p.splat(i.grid[o.name+"-Instance"]),i.grid[o.name+"-Instance"].push(e)):i.grid[o.name+"-Instance"]=e,i.padgrid[o.name+"-Instance"]=e}n.getSetting("activateFUN085903")&&"ds6w:globalType"===o.name&&(i.grid||(i.grid={}),i.grid.globaltypeInstance=o.value)}}return i.relationOrder||(i.relationOrder=-1),i.grid||(i.grid={}),i},_.update_instances=function(e){var t=[];e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(o){if(o.attributes){for(var i="",s=0;s<o.attributes.length;s++){var r=o.attributes[s];if("resourceid"===r.name){i=r.value;break}}e.newRelIds&&-1!==e.newRelIds.indexOf(i)&&e.treedocument.getRoots().forEach(function(s){var r=s.getNodesByRelId(i);r.length&&r.forEach(function(s){var r=function(t,o){var i=_.parse_attributes(o.attributes,n.getAvailableColumns(),n.getTreeColumn());return UWA.is(e.treedocument.filterAttributesForUpdate,"function")&&(i=e.treedocument.filterAttributesForUpdate({node:t,node_opts:i})),i&&0===i.relcount&&(i.children=null),i}(s,o),a=s.getLabel();delete r.resourceid,r&&"VPMInstance"===r.type&&delete r.type,r.display=a,r.label=a,r.instanceMatrix&&(r.relationid=i,r.grid.instanceMatrix=r.instanceMatrix);var l=s.getState();s.updateOptions(r),d.updateNLS(s),l===u.EXPANDED&&s.setState({state:u.PARTIALLY_EXPANDED}),t.push(s)})})}})}),e.editCfg?e.treedocument.refreshCfgValues({relids:e.newRelIds}):t.length&&e.treedocument.fillAttributesAsync4VisibleNodes(t)},_.process={fetch:function(e){s.createProbe("process_fetch");if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");require("DS/PADUtils/PADSettingsMgt");e.treedocument.withTransactionUpdate(function(){var s=[],r=[],a=function(e){for(var t=[],o=[],n={},i=e.length,s=0;s<i;s++)for(var r=e[s],a=r.attributes,l=a.length,d=0;d<l;d++){var c=a[d],p=c.name,u=p.split("/");if("ds6w:type"===(p=u[u.length-1])||"type"===p){var h=c.value;-1===o.indexOf(h)?(o.push(h),t.push({type:h,displayType:c.dispValue}),w(n,h,r)):w(n,h,r)}}return{types:t,resultsByType:n}}(e.response.results);0===a.types.length&&console.error("No types to validate"),i.isTypesAuthorized(a.types,function(i){i.forEach(function(i){var r=a.resultsByType[i];UWA.is(r,"array")&&r.forEach(function(i){if(UWA.is(i.attributes,"array")){var r=_.parse_attributes(i.attributes,n.getAvailableColumns(),n.getTreeColumn());UWA.is(r.isPADHiddenBackEnd,"boolean")&&(r.isPADHidden=r.isPADHiddenBackEnd,r.isPADHiddenBackEndReference=r.isPADHiddenBackEnd,r.hsStatusOn="reference"),o.defaultHiddenState(r);var a=new t(r);if(e.rootsWithFilters){var l=function(e,t){for(var o,n=0;n<t.length;n++)if(e===t[n].rootId&&t[n].filter){(o=t[n].filter).filterId=t[n].filterId,o.filterName=t[n].filterName;break}return UWA.is(o,"string")?JSON.parse(o):o}(a.getID(),e.rootsWithFilters);l&&(a.options.config_filter=l.config_filter,a.options.sequence_filter=l.sequence_filter,a.options.filterId=l.filterId,a.options.filterName=l.filterName)}if(e.config_filter&&e.config_filter[r.resourceid]&&(a.options.config_filter=e.config_filter[r.resourceid]),a.options.config_filter||a.options.sequence_filter)if(!0===f){if(a.options.icons&&a.options.icons.length){var c=UWA.clone(a.options.icons[0]);c.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},a.updateOptions({icons:[c]})}}else{a.setBadges({bottomRight:"filter"})}e.treedocument.addRoot(a),s.push(a);var p=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(p+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:p,added_node:a}}),d.updateNLS(a)}else e.onFailure&&e.onFailure(new Error("Invalid result format - attributes isn't an array"))})}),e.onComplete&&e.onComplete({toselect:s,hidden:r})},!0)})},expand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.root_nodes,"array")&&!0!==e.root2Create||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.starting_from_root=void 0===e.starting_from_root||e.starting_from_root;var i=require("DS/PADServices/utils/GlobalModelEvents"),r=Date.now(),a=e.treedocument.isGroupingApplied();A(e.parseTimeout,r);var l=[],c=require("DS/PADUtils/PADSettingsMgt"),p=c.getSetting("activateFUN085903")&&(-1===e.expand_level||e.expand_level>1),h=(c.getURLParameter("filter3DPartRep"),!0===c.getSetting("alwaysExpandPath")||c.getSetting("pgpFromServer")),g=s.createProbe("transactionWithUpdate_expand"),f=e.selectPathLeaf;e.treedocument.prepareBroadcastSelect(),e.treedocument.withTransactionUpdate(function(){var g;if("refresh"===e.mode&&!1===e.response.full_path)if(e.needNewStructure)g=b.buildStructure(e.response);else{g={};for(var _=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var o=t.getChildren(),n=0;o&&n<o.length;n++)_(e[t.getRelationID()][t.getID()],o[n])}},S=e.treedocument.getRoots(),y=0;y<S.length;y++){g[S[y].getID()]={};for(var N=S[y].getChildren(),C=0;N&&C<N.length;C++)_(g[S[y].getID()],N[C])}}var P=b.parse_expand(e.response.results,n.getAvailableColumns(),n.getTreeColumn(),e.response.full_path,g);A(e.parseTimeout,r);var w,I="expanded",E=!1,O=!1,M=!1,F=e.expand_level;switch(e.mode){case"find_in_ctx":I="partiallyExpanded",E=!0,F=-1,w=[],p=!1;break;case"insert":I="partiallyExpanded",O=!0,f="boolean"!=typeof f||f,p=c.getSetting("activateFUN085903");break;case"refresh":F=-1,M=!0,p=!1;break;case"filter":!0,p=!1}var R=!1;P.status&&(i.publish({event:"ENXModel/Expand/expandStatus",data:{mode:e.mode,status:P.status}}),!0===P.status.expandTooLarge&&(R=!0,I="partiallyExpanded","function"==typeof e.setExpandStatus&&e.setExpandStatus({expandTooLarge:!0})));var T=function(t){for(var o=[],n=0;e.root_nodes&&n<e.root_nodes.length;n++){if(e.root_nodes[n].getID()===t){o=[e.root_nodes[n]];break}var i=e.root_nodes[n].getNodesById(t);void 0!==i&&i.length>0&&(o=o.concat(i))}return o},k=function(e,t){var o=!1;t&&t.length>0&&(t=(t=t.trim().split("*").join("")).toLowerCase());try{var n=[];n.push(e.options.label),n.push(e.options.subLabel),n.push(e.options.description),n.push(e.options.type),n.push(e.options.grid["ds6w:cadMaster"]),n.push(e.options.grid["ds6wg:revision"]),e.options.grid["ds6w:status"]&&(-1!==e.options.grid["ds6w:status"].toLowerCase().indexOf("work")?(n.push("In Work"),n.push("IN_WORK")):n.push(e.options.grid["ds6w:status"])),n.push(e.options.grid.globaltype),e.options.grid["ds6w:description"]&&n.push(e.options.grid["ds6w:description"]),e.options.grid["ds6w:label-Instance"]&&n.push(e.options.grid["ds6w:label-Instance"]),e.options.relationtype&&n.push(e.options.relationtype);for(var i=0;i<n.length;i++)if(n[i]&&n[i].length>0&&-1!==n[i].trim().toLowerCase().indexOf(t)){o=!0;break}}catch(e){console.error(e)}return o},U=e.findInCtx_query,B=[],V=function(n,i,s,l,d){var c=i.getChildren(),g=M&&null!==c?[].concat(c):void 0,b=[],_=!1,S=[];A(e.parseTimeout,r);var y=!1;!0===n.pathLeaf&&(U&&0!==U.length?(y=k(i,U),f&&y&&i.select(),UWA.is(e.addedPaths,"function")&&w.push(i.getOccurencePath())):(f&&i.select(),UWA.is(e.addedPaths,"function")&&w.push(i.getOccurencePath())));var N,C,F,T=n.order;if(T.length>0){var L,G=-1,X=[];if(c&&c.length>0)for(L=0;L<c.length;L++)X.push(c[L].options.relationOrder),c[L].options.relationOrder>G&&(G=c[L].options.relationOrder);-1===G&&(_=!0);var W=i.hasChildren();for(!1===W&&i.options._childrenFilterInfo&&i.options._childrenFilterInfo.filteredOutChildren.length&&(W=!0),L=0;L<T.length;L++){var j=T[L];if(void 0!==P.did_to_resourceid[j]){var H=P.did_to_resourceid[j],z=P.nodes[H].type,q=P.nodes[H].relationOrder,K=P.nodes[H],J=Object.getOwnPropertyNames(n[j])[0],Q=P.did_to_resourceid[J],Y=null;W&&(Y=i.getChildByIds(H,Q));var $=!1;if(UWA.is(Y,"object")){if(!0===M||!0===Y.options.waiting4validation){var Z=UWA.clone(P.nodes[Q]);Z.relationOrder=q,Z.grid=UWA.extend(K.grid,Z.grid);var ee=!1;Y.options.isPADHidden=void 0,UWA.is(Z.isPADHiddenBackEnd,"boolean")&&(Z.isPADHidden=Z.isPADHiddenBackEnd,Z.isPADHiddenBackEndReference=Z.isPADHiddenBackEnd,Z.hsStatusOn="reference",ee=!0),UWA.is(K.isPADHiddenBackEnd,"boolean")&&(Z.isPADHidden=K.isPADHiddenBackEnd,Z.isPADHiddenBackEndInstance=K.isPADHiddenBackEnd,Z.hsStatusOn="instance",ee=!0),void 0!==Y.options.isPADHiddenBackEndOcc&&(Z.isPADHidden=Y.options.isPADHiddenBackEndOcc,ee=!0),!1===ee&&(Z.isPADHidden=void 0,Z.isPADHiddenBackEnd=void 0,Z.isPADHiddenBackEndReference=void 0,Z.isPADHiddenBackEndInstance=void 0,Z.hsStatusOn=void 0),delete Y.options.waiting4validation,delete Y.options.alternText;var te={};!0===M&&(Z.isPADHiddenBackEndInstance||Z.isPADHiddenBackEndReference||o.defaultHiddenState(Z),te.needRequestNls=!0),!0===h&&D(Y,e.realExpandedNodes)&&(te.changeState=!1),x(Y,Z,te),!0===Y.options.isPADHidden&&m.hide({paths:[Y.getOccurencePath()]}),b.push(Y);let t=!1,n=Y.getReferenceValue("ds6w:kind");!n||-1===n.indexOf("3DPart")||Y.getReferenceValue("ds6w:globalType")!==v&&Y.getReferenceValue("ds6w:globaltype")!==v||(t=!0),!0===t?(Y.setState({state:"noChildren"}),Y.options.children=null):("noChildren"===Y.getState()||"expanded"===Y.getState()&&(Y.options.children&&0===Y.options.children.length||null===Y.options.children))&&(Y.setState({state:"collapsed"}),Y.options.children=[])}g&&(C=Y,F=void 0,-1!==(F=(N=g).indexOf(C))&&N.splice(F,1))}else{$=!0;var oe=UWA.clone(P.nodes[Q]);oe.relationid=H,oe.relationtype=z,oe.relationOrder=q,oe.grid=UWA.extend(K.grid,oe.grid,!0),UWA.is(oe.isPADHiddenBackEnd,"boolean")&&(oe.isPADHidden=oe.isPADHiddenBackEnd,oe.isPADHiddenBackEndReference=oe.isPADHiddenBackEnd,oe.hsStatusOn="reference"),UWA.is(K.isPADHiddenBackEnd,"boolean")&&(oe.isPADHidden=K.isPADHiddenBackEnd,oe.isPADHiddenBackEndInstance=K.isPADHiddenBackEnd,oe.hsStatusOn="instance"),o.defaultHiddenState(oe),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(oe.label+="(treeorder="+q+")"),Y=new t(oe);var ne=null,ie=!1;if(a&&i.isRoot()){var se="refresh"!==e.mode&&e.stateGrouping!==u.COLLAPSED.state;if(ne=e.treedocument.getGroupingNode(i,Y),e.realExpandedNodes&&!0===e.realExpandedNodes[0].isGroupingNode&&e.realExpandedNodes[0].getGroupID()!==ne.getGroupID()){if(!0!==ne.options.isOther){console.warn("Ignore node ["+Y.getLabel()+"] because it doesn't belong to the expected classification node");continue}ie=!0}else!0===se&&e.treedocument.setGrpPartialExpandState(ne)}if(d&&d[Y.options.relationid]){var re=d[Y.options.relationid];if(re.before){var ae=null;if((Ne=i.getChildren())&&Ne.length)for(var le=0;le<Ne.length;le++){var de=Ne[le].options.relationid;if(de&&de===re.before){ae=Ne[le],X.splice(le,0,q);break}}ne?ne.insertBefore(Y,ae):i.insertBefore(Y,ae)}else ne?ne.addChild(Y):i.addChild(Y),G=q,X.push(q)}else if(q>=G)ne?ne.addChild(Y):i.addChild(Y),G=q,X.push(q);else{ae=null;if(Ne=i.getChildren()){le=0;for(var ce=Ne.length;le<ce;le++)if(X[le]>q){ae=Ne[le],X.splice(le,0,q);break}}ne?ne.insertBefore(Y,ae):i.insertBefore(Y,ae)}o.gatherParentsIfHidden(S,Y),B=B.concat(S),Y.options.grid.globaltype===v&&(Y.setState({state:"noChildren"}),Y.options.padstate="noChildren",Y.childComputed=!R),!0===_&&b.push(Y),Y._manageNLS=!0,!0===ie&&ne.setState(u.PARTIALLY_EXPANDED)}o.calculateParents(S);var pe=-1===l?l:l-1;(pe>0||-1===pe)&&($||Y.getTreeDocument())?V(n[j][J],Y,s,pe):O&&Y.select()}else console.error("Invalid CV id ["+j+"]")}var ue=D(i,e.realExpandedNodes),he=function(e,t,o){var n=!1;if(e&&Array.isArray(t)){var i=0,s=t.length,r=!1;do{if(e.isDescendantOf(t[i])){if(-1===o)n=!0;else{var a=e.getOccurencePath(),l=a.indexOf(t[i].getID());(a.length-l)%2<=o&&(n=!0)}r=!0}i++}while(!1===r&&i<s)}return n}(i,e.realExpandedNodes,s),ge=i.getState(),fe=i.getRoot();if(E||O?i.childComputed=!1:!0===h&&!1===ue&&!1===he&&("filter"!==fe.options.badges.bottomRight||fe.options.icons&&fe.options.icons[0].badges&&"filter"!==fe.options.icons[0].badges.bottomRight)&&R?i.childComputed=!1:i.childComputed=!R&&("expandingState"!==ge&&"expandState"!==ge&&"partiallyExpanded"!==ge),!0!==M){let e=i.getReferenceValue("ds6w:kind");p&&e&&-1!==e.indexOf("3DPart")&&1===i.getChildren().length?(i.setState({state:"collapsed"}),i.options.padstate="collapsed"):!0===h?(ue||he||O||E)&&(i.setState({state:I}),i.options.padstate=I):(i.setState({state:I}),i.options.padstate=I)}}else if(!0!==M){var ve=i.getDepth();s&&(-1===s||s>ve)?E||O?(i.childComputed=!1,O?i.select():U&&0!==U.length?i.isSelected()||(y=k(i,U))&&i.select():i.select()):!0===h?-1===s?null!=c&&0!==c.length||(i.childComputed=!R,i.options.children=null,i.setState({state:"noChildren"}),i.options.padstate="noChildren",i._expandState="noExpandState"):T.length&&(i.setState({state:I}),i.options.padstate=I):(i.childComputed=!R,i.options.children=null,i.setState({state:"noChildren"}),i.options.padstate="noChildren",0!==ve&&-1!==s||(i._expandState="noExpandState")):null!==i.options.relcount&&0===i.options.relcount&&(i.setState({state:"noChildren"}),i.options.padstate="noChildren",i.childComputed=!R,i.options.children=null,O&&i.select(),E&&(U&&0!==U.length?i.isSelected()||(y=k(i,U))&&i.select():i.select()))}if(null!=g&&g.length>0&&g.forEach(function(e){null!=e&&!0===M&&!0!==e.isGroupingNode&&i.removeChild(e)}),b.length>0&&!0!==e.treedocument.isGroupingApplied()&&!0!==M){var me=!1;if(!e.noCheckOrder)for(var be=0;be<b.length;be++)for(var _e=b[be].getParent().getChildren(),De=1;De<_e.length;De++){var Se=_e[De-1],xe=_e[De];if(Se.options.relationOrder>xe.options.relationOrder){me=!0,console.warn("Wrong order between "+Se.getLabel()+" with order "+Se.options.relationOrder+" and "+xe.getLabel()+" with order "+xe.options.relationOrder);break}}if(me)for(var ye=0;ye<b.length;ye++){var Ne,Ce=b[ye],Pe=Ce.getParent(),we=Ce.getBrothers();if((Ne=Pe.getChildren()).length>1)for(var Ae=0;Ae<we.length;Ae++)if(we[Ae].options.relationOrder>Ce.options.relationOrder){var Ie=Ne.indexOf(Ce);if(Ne.indexOf(we[Ae])<Ie){var Ee=Pe.removeChild(Ce);Pe.insertBefore(Ee,we[Ae]);break}}}}UWA.is(n.isPADHiddenBackEndOcc,"boolean")&&(i.options.hsStatusOn="occurence",i.options.isPADHidden=n.isPADHiddenBackEndOcc,i.options.isPADHiddenBackEndOcc=n.isPADHiddenBackEndOcc,o.defaultHiddenState(i.options),o.gatherParentsIfHidden(S,i),B=B.concat(S),o.calculateParents(S))},L=Object.getOwnPropertyNames(P.structure),G=UWA.clone(e.root_nodes?e.root_nodes:[],!1),X=s.createProbe("treat_expand");if(e.occurencePaths&&e.occurencePaths.length>0)e.occurencePaths.forEach(function(t){var o,n=e.treedocument.getNodeByOccurencePath(t);if(e.pathOrdering&&(o=e.pathOrdering),n){var i=P.nodes[n.getID()];UWA.is(i.isPADHiddenBackEnd,"boolean")&&(i.isPADHidden=i.isPADHiddenBackEnd,i.isPADHiddenBackEndReference=i.isPADHiddenBackEnd,i.hsStatusOn="reference");for(var s,r=Object.keys(P.did_to_resourceid),a=0;a<r.length;a++)if(P.did_to_resourceid[r[a]]===n.getID()){s=r[a];break}var l=P.structure[s];V(l,n,F,F,o),x(n,i)}});else if(L.length>0)for(var W=0;W<L.length;W++){var j=L[W];if(P.did_to_resourceid.hasOwnProperty(j)){var H=T(P.did_to_resourceid[j]);if(0===H.length&&!0===e.root2Create){var z=P.nodes[P.did_to_resourceid[j]];UWA.is(z.isPADHiddenBackEnd,"boolean")&&(z.isPADHidden=z.isPADHiddenBackEnd,z.isPADHiddenBackEndReference=z.isPADHiddenBackEnd,z.hsStatusOn="reference");var q=new t(z);e.treedocument.addRoot(q),q._manageNLS=!0;var K=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(K+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:K,added_node:q}}),H.push(q)}0!==H.length?(H.forEach(function(t){if(void 0!==t){var n=G.indexOf(t);n>-1&&G.splice(n,1);var i=P.nodes[P.did_to_resourceid[j]];t.options.isPADHidden=void 0,UWA.is(i.isPADHiddenBackEnd,"boolean")&&(i.isPADHidden=i.isPADHiddenBackEnd,i.isPADHiddenBackEndReference=i.isPADHiddenBackEnd,i.hsStatusOn="reference"),!0===M&&(delete i.relationOrder,i.isPADHiddenBackEndReference||o.defaultHiddenState(i));var s,r=P.structure[j];V(r,t,F,F),!0===h&&D(t,e.realExpandedNodes)&&(s={changeState:!1}),x(t,i,s),!0===M&&("noChildren"===t.getState()||"expanded"===t.getState()&&(t.options.children&&0===t.options.children.length||null===t.options.children))&&(t.setState({state:"collapsed"}),t.options.children=[]),d.updateNLS(t)}}),o.calculateParents(B,!0),UWA.is(e.addedPaths,"function")&&e.addedPaths(w),UWA.is(e.hideToggleNodes,"function")&&e.hideToggleNodes(l),i.publish({event:"ENXModel/Expand/parseDone"})):console.error("Invalid root id: "+j)}}e.treedocument.pushBroadcastSelect(),X.end()}),g.end()},insert_temporary_branches:function(o){if(!UWA.is(o.treedocument,"object")||!UWA.is(o.branches,"array"))throw new Error("Invalid input parameters");var n=[],i=[],s=[],r=[],l=[],d=o.treedocument,p=o.node_state?o.node_state:"partiallyExpanded",u=o.branches;return d.withTransactionUpdate(function(){u.forEach(function(u){var h,g=null,v=o.treedocument.getRoots(),m=o.treedocument.getDetachedRoots(),b=0;for(h=0;h<v.length&&null===g;h++)if(u[0]===v[h].getID()){r.push(u[0]);var _=(g=v[h]).getNodeByPath(u,void 0,void 0,!0);_&&(g=_,b=u.indexOf(g.getID()))}for(h=0;h<m.length&&null===g;h++)if(u[0]===m[h].getID()){r.push(u[0]);var D=(g=m[h]).getNodeByPath(u,void 0,void 0,!0);if(D)if(g=D,b=u.indexOf(g.getID()),!0===o.temporary_root)require("DS/PADUtils/views/PADAlert").displayNotification({msg:e.detachRootFound,eventID:"info"})}if(!0===o.temporary_root&&null===g){var S={resourceid:u[0],label:c.loadingText,icons:[{iconPath:"url("+a.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")"}],thumbnail:a.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:c.loadingText,waiting4validation:!0};if(g=new t(S),o.config_filter&&o.config_filter[u[0]]&&(g.options.config_filter=o.config_filter[u[0]]),g.options.config_filter||g.options.sequence_filter)if(!0===f){if(g.options.icons&&g.options.icons.length){var x=UWA.clone(g.options.icons[0]);x.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},g.updateOptions({icons:[x]})}}else{g.setBadges({bottomRight:"filter"})}d.addRoot(g),-1===n.indexOf(u[0])&&n.push(u[0]);var y=d.getRoots().length;UWA.is(d.detachedRoots,"array")&&(y+=d.detachedRoots.length),d.getModelEvents().publish({event:"onRootAdded",data:{nb_root:y,added_node:g}})}if(g)if(g.getID()===u[u.length-1]){if(!0!==o.forceCollapsed&&null!==g.getRoot()){var N=g.reverseExpand({state:p});N.ids.length&&(n=n.concat(N.ids)),N.relids.length&&(l=l.concat(N.relids))}}else for(var C=b+1;C<u.length;C+=2){var P=u[C],w=u[C+1],A={resourceid:w,relationid:P,label:c.loadingText,icons:[{iconPath:"url("+a.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")"}],thumbnail:a.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:c.loadingText,waiting4validation:!0},I=new t(A),E=g.getState();d.isGroupingApplied()&&g.isRoot()&&I.hide(),g.addChild(I),"collapsed"===E?(p!==E&&(g.setState({state:p}),g.options.padstate=p),g.childValidationChecker()):"partiallyExpanded"===E&&(g.setState({state:E}),g.options.padstate=E,-1===i.indexOf(w)&&i.push(w),-1===s.indexOf(P)&&s.push(P)),g=I,-1===n.indexOf(w)&&n.push(w),-1===l.indexOf(P)&&l.push(P)}})}),{ids_to_fetch:n,relationids:l,rootsAlreadyLoaded:r,visibleNodesIds:i,visibleNodesRelIds:s}},refresh_nodes:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.refresh_parameters,"object"))throw new Error("Invalid input parameters");var o=[],i=[],s=function(t,o){var i=_.parse_attributes(o.attributes,n.getAvailableColumns(),n.getTreeColumn());return UWA.is(e.treedocument.filterAttributesForUpdate,"function")&&(i=e.treedocument.filterAttributesForUpdate({node:t,node_opts:i})),i&&0===i.relcount&&(i.children=null),i},r=require("DS/PADUtils/PADSettingsMgt");return e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(a){for(var l="",c=0;c<a.attributes.length;c++){var p=a.attributes[c];if("resourceid"===p.name){l=p.value;break}}if(""===l)throw new Error("Resourceid not found in fetch result for "+JSON.stringify(a));if(e.refresh_parameters.created&&-1!==e.refresh_parameters.created.indexOf(l)){var u=_.parse_attributes(a.attributes,n.getAvailableColumns(),n.getTreeColumn()),h=new t(u);e.treedocument.addRoot(h),d.updateNLS(h);e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&e.treedocument.detachedRoots.length,e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:h}}),i.push(h),o.push(h.getID())}else if(e.refresh_parameters.modified&&(-1!==e.refresh_parameters.modified.indexOf(l)||e.ids_modified&&-1!==e.ids_modified.indexOf(l))){e.treedocument.getRoots().forEach(function(e){var t=e.getNodesById(l);if(t.length)t.forEach(function(e){e.updateOptions(s(e,a)),d.updateNLS(e),null===e.options.children&&e.setState({state:"noChildren"}),i.push(e)});else{var o=e.getNodesByRelId(l);o.length&&o.forEach(function(e){var t=s(e,a);delete t.resourceid,e.updateOptions(t),d.updateNLS(e),i.push(e)})}});var g=e.treedocument.searchRootById(l);g&&(g.updateOptions(s(g,a)),d.updateNLS(g),0===g.options.relcount&&g.setState({state:"noChildren"}),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:g}}),i.push(g))}else e.refresh_parameters.relationids&&-1!==e.refresh_parameters.relationids.indexOf(l)&&e.treedocument.getRoots().forEach(function(e){e.getNodesByRelId(l).forEach(function(e){var t=_.parse_attributes(a.attributes,n.getAvailableColumns(),n.getTreeColumn()),o=e.getLabel();!0===r.getSetting("tree_order_in_label")&&(o+="(treeorder="+t.relationOrder+")"),e.updateOptions({label:o,relationOrder:t.relationOrder}),d.updateNLS(e);var s=e.getParent(),l=e.getBrothers(),c=s.getChildren();if(c.length>1)for(var p=0;p<l.length;p++)if(l[p].options.relationOrder>e.options.relationOrder){var u=c.indexOf(e);if(c.indexOf(l[p])<u){var h=s.removeChild(e);s.insertBefore(h,l[p]);break}}i.push(e)})})})}),i.length&&e.treedocument.fillAttributesAsync4VisibleNodes(i),o},validateAndUpdateBranches:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");var t=s.createProbe("transactionWithUpdate_validateBranch"),i=e.selectPathLeaf,r=e.forcePartiallyExpanded;e.treedocument.withTransactionUpdate(function(){var t=b.parse_expand(e.response.results,n.getAvailableColumns(),n.getTreeColumn(),e.response.full_path),a=function(t){for(var o=null,n=e.treedocument.getRoots(),i=e.treedocument.getDetachedRoots(),s=0;s<n.length;s++)if(n[s].getID()===t){o=[n[s]];break}for(var r=0;r<i.length&&null===o;r++)if(i[r].getID()===t){o=[i[r]];break}return o},l=[],c=function(e,n,s){var a=n.getChildren(),p=(null!==a&&[].concat(a),[]);!0===e.pathLeaf&&i&&n.select();var u=e.order;if(u.length>0){for(var h=-1,g=[],f=0;null!==a&&f<a.length;f++)g.push(a[f].options.relationOrder),a[f].options.relationOrder>h&&(h=a[f].options.relationOrder);for(var v=0;v<u.length;v++){var m=u[v];if(t.did_to_resourceid.hasOwnProperty(m)){var b=t.did_to_resourceid[m],_=(t.nodes[b].type,t.nodes[b].relationOrder),D=t.nodes[b],S=Object.getOwnPropertyNames(e[m])[0],y=t.did_to_resourceid[S],N=n.getChildByIds(b,y);if(!UWA.is(N,"object")){console.error("All nodes should have been created");break}var C=UWA.clone(t.nodes[y]);C.grid=UWA.extend(D.grid,C.grid),UWA.is(C.isPADHiddenBackEnd,"boolean")&&(C.isPADHidden=C.isPADHiddenBackEnd,C.isPADHiddenBackEndReference=C.isPADHiddenBackEnd,C.hsStatusOn="reference"),UWA.is(D.isPADHiddenBackEnd,"boolean")&&(C.isPADHidden=D.isPADHiddenBackEnd,C.isPADHiddenBackEndInstance=D.isPADHiddenBackEnd,C.hsStatusOn="instance"),o.defaultHiddenState(C),x(N,C,{deleteTempOptions:!0}),N.isVisible()&&(N._manageNLS=!0,d.updateNLS(N)),!0===r&&"expanded"===N.getState()&&N.setState({state:"partiallyExpanded"});var P=N.getLabel();!0===require("DS/PADUtils/PADSettingsMgt").getSetting("tree_order_in_label")&&(P+="(treeorder="+opts_2_modified.relationOrder+")"),N.updateOptions({label:P,relationOrder:_}),o.gatherParentsIfHidden(p,N),l=l.concat(p);var w=N.getParent(),A=N.getBrothers(),I=w.getChildren();if(I.length>1)for(var E=0;E<A.length;E++)if(A[E].options.relationOrder>N.options.relationOrder){var O=I.indexOf(N);if(I.indexOf(A[E])<O){var M=w.removeChild(N);w.insertBefore(M,A[E]);break}}o.calculateParents(p,!1,!0),c(e[m][S],N,-1)}else console.error("Invalid CV id ["+m+"]")}}UWA.is(e.isPADHiddenBackEndOcc,"boolean")&&(n.options.hsStatusOn="occurence",n.options.isPADHidden=e.isPADHiddenBackEndOcc)},p=Object.getOwnPropertyNames(t.structure),u=s.createProbe("treat_expand");if(p.length>0)for(var h=0;h<p.length;h++){var g=p[h];if(t.did_to_resourceid.hasOwnProperty(g)){var f=a(t.did_to_resourceid[g]);void 0!==f?f.forEach(function(o){if(void 0!==o){var n=t.nodes[t.did_to_resourceid[g]];o.options.isPADHidden=void 0,UWA.is(n.isPADHiddenBackEnd,"boolean")&&(n.isPADHidden=n.isPADHiddenBackEnd,n.isPADHiddenBackEndReference=n.isPADHiddenBackEnd,n.hsStatusOn="reference"),x(o,n,{deleteTempOptions:!0}),o.childComputed=!0,d.updateNLS(o),!0===r&&"expanded"===o.getState()&&o.setState({state:"partiallyExpanded"});var i=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(i+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:i,added_node:o}});var s=t.structure[g];c(s,o,-1)}}):console.error("Invalid root id: "+g)}}o.calculateParents(l,!0,!0),u.end()}),t.end()},validateMultiExpand:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.selectPathLeaf;var t=e.forcePartiallyExpanded,o={nodes2relaunch:[]};e.treedocument.withTransactionUpdate(function(){var i;if(!1===e.forcePartiallyExpanded){i={};for(var s=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var o=t.getChildren(),n=0;o&&n<o.length;n++)s(e[t.getRelationID()][t.getID()],o[n])}},r=e.treedocument.getRoots(),a=0;a<r.length;a++){i[r[a].getID()]={};for(var l=r[a].getChildren(),d=0;l&&d<l.length;d++)s(i[r[a].getID()],l[d])}}for(var c=b.parse_expand(e.response.results,n.getAvailableColumns(),n.getTreeColumn(),e.response.full_path,i),p=(r=e.treedocument.getRoots(),0);p<r.length;p++){var u=r[p],h=u.getID();if(c.nodes[h]){var g=c.nodes[h];UWA.is(g.isPADHiddenBackEnd,"boolean")&&(g.isPADHidden=g.isPADHiddenBackEnd,g.isPADHiddenBackEnd=g.isPADHiddenBackEnd,g.isPADHiddenBackEndReference=g.isPADHiddenBackEnd,g.hsStatusOn="reference");var f={needRequestNls:!0};if(x(u,g,f),!0===t&&N(u),l=u.getChildren()){l=l.slice();for(var v=0;l&&v<l.length;v++){var m=c.structure[c.nodes[h].did],_=l[v].getRelationID(),D=m&&c.nodes[_]&&c.nodes[_].did?m[c.nodes[_].did]:void 0;y(l[v],u,c,e.treatedNodes,o.nodes2relaunch,t,D,f)}}}else for(var S=0;S<e.treatedNodes.length;S++)if(e.treatedNodes[S].root.getID()===u.getID()&&!e.isFilter){if(e.treatedNodes[S].node.getID()===u.getID()){e.treedocument.removeRoot(u);break}var C=e.treatedNodes[S].node.getParent();C&&(C.removeChild(e.treatedNodes[S].node),o.nodes2relaunch.push({node:C,root:u}))}}e.onComplete(o)})}},_}),define("DS/ENXNav/commands/ProductToPart",["i18n!DS/ENXNav/assets/nls/ENXNav","DS/Controls/Button","DS/Controls/ComboBox","DS/PADServices/utils/PlatformURL","DS/PADServices/ws/WSAccess","DS/WebappsUtils/WebappsUtils","DS/ENXNav/models/_xNavCVParser","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSession","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/views/PADAlert","DS/PADUtils/PADContext"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h){"use strict";return{execute:function(e){this.targetDiv=document.querySelector(".pse-root");var t=this;if(t.elements={},t.parameters=e,t.selectedProductID=t.parameters.model.getSelectedNodes()[0].options.resourceid,t.displayTitle=e.model.getSelectedNodes()[0].options.display,1==e.model.getSelectedNodes().length&&null!=e.model.getSelectedNodes()[0].options.grid["ds6w:cadMaster"]){var o=e.model.getSelectedNodes()[0].options.grid["ds6w:cadMaster"];t._buildContent(o).then(function(o){t._chooseTemplate(o).then(function(o){o&&(e.model.isOccModel?e.model.productToPart(o):t._productToPart(o))})})}},_buildContent:function(t){var r=this;return r.selectedCAD=t,new Promise(function(t){(i.getTemplates?Promise.resolve():n.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){i.getTemplatesV2().then(function(n){if("success"===n.status&&n.result)var i=function(e,t){for(var o=new a({shouldBeSelected:function(e){return e.options.selectable}}),n=t[0].attributes.volatileAttributes[0].rangeGroup,i=n.filter(function(e,t,o){return o.indexOf(e)==t&&"3DEXPERIENCE"!==e}).sort(),r=t[0].attributes.volatileAttributes[0].range,d=t[0].attributes.volatileAttributes[0].rangeNLS,c=0;c<i.length;c++)if("3DEXPERIENCE"==e||e==i[c].split(" ").join("")){var p=new l({label:i[c],selectable:!1});o.addRoot(p);for(var u=0;u<n.length;u++)n[u]===i[c]&&o.addRoot(new l({label:"      "+d[u],template:r[u],icons:[{iconPath:s.getWebappsAssetUrl("PADServices","icons/cadmasters/I_CADMaster"+n[u].toUpperCase().split(" ").join("")+".png")}],selectable:!0}))}return o.expandAll(),o}(r.selectedCAD,n.result);r.elements.container=document.createElement("div"),r.elements.container.classList.add("product-to-part-container"),r.elements.text=document.createElement("div"),r.elements.text.classList.add("prod-to-part-label"),r.elements.text.innerText=e.productToPartCmd.templateLabel,r.elements.container.appendChild(r.elements.text);var d=r.elements.comboBox=new o({enableSearchFlag:!1,elementsTree:i});d.getContent().classList.add("prod-to-part-combobox"),d.inject(r.elements.container),r.elements.text=document.createElement("div"),r.elements.text.classList.add("prod-to-part-description-text"),r.elements.text.innerText=e.productToPartCmd.descriptionText,r.elements.container.appendChild(r.elements.text),t(d)})})}.bind(this))},_chooseTemplate:function(t){var o=this;return o.combobox=t,new Promise(function(t){require(["DS/PADServices/views/ENXModal","DS/Controls/Button"],function(n,i){o.modalStop=new n({target:o.targetDiv,title:e.productToPartCmd.title+"  -  "+o.displayTitle,resizableFlag:!1,height:"auto",width:"auto",touchMode:!0,position:{my:"center",at:"center"},content:o.elements.container,buttons:{Cancel:new i({label:e.productToPartCmd.cancel,touchMode:!0,onClick:function(){t(!1),o.modalStop.close()}}),Ok:new i({label:e.productToPartCmd.convert,touchMode:!0,onClick:function(){var e={template:o.combobox.elementsTree.getAllDescendants()[o.combobox.selectedIndex].options.template,pid:[o.selectedProductID]};t(e),o.modalStop.close()}})},closeCB:function(){}})})})},_productToPart:function(t){var o=this;o.data=t,(i.productToPart?Promise.resolve():n.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})).then(function(){i.productToPart({enopad_webapis:!0,data:{intent:"explore_2D",select_predicate:["ds6w:type"],select_file:["icon","thumbnail_2d"]},pids:o.data.pid,template:o.data.template,onComplete:function(t){o.parameters.model.invalidateViewPort();var i=UWA.is(t,"string")?JSON.parse(t):t;i.results&&1===i.results.length?1==i.results.length&&o.parameters.model.wrapInTransaction(function(){c.setAuthoringState(!0,p.PADSession_disabling_index_from_server),r.process.fetch({treedocument:o.parameters.model,response:i,onComplete:function(t){u.displayNotification({eventID:"info",msg:e.productToPartCmd.successNotif});var i=h.get(),s=t.toselect[0].getOccurencePath();t&&t.toselect&&t.toselect.length>0&&i.dispatchEvent("onAddPaths",{addedPaths:[s]});var r={tenant:n.getPlatformId(),pids:s};i._commandProxy.drop(r),o.parameters.model.unselectAll(),o.parameters.model.getNodeByOccurencePath(s).select()},onFailure:function(e){console.error(e)}})}):(u.displayNotification({msg:p.object_not_found_in_db,eventID:"error",key:"enxNav-productToPart-object-not-found-in-db"}),parameters.callback&&parameters.callback("error"))},onTimeout:function(){u.displayNotification({msg:p.timeout,eventID:"error",key:"enxNav-productToPart-timeout"}),o.parameters.callback&&o.parameters.callback("error")},onFailure:function(t,o){var n=e.productToPartCmd.err_generic_server;if((o=UWA.is(o,"string")?JSON.parse(o):o)&&o.attributeMap&&o.attributeMap.error_code)switch(o.attributeMap.error_code.value){case 3:n=e.productToPartCmd.err_product_under_change;break;case 4:n=e.productToPartCmd.err_product_with_conf}u.displayNotification({msg:n,eventID:"error",key:"enxNav-productToPart-err-product"}),t.callback&&t.callback("error")}})})}}}),define("DS/ENXNav/models/mixins/TreeDocShared",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/Batches","DS/PADServices/utils/Iterator","DS/ENOXParser/modules/TwoDParser","DS/ENXNav/models/SmartNodeOptions","DS/ENOXParser/modules/common/Helpers","DS/PADServices/ws/WSAccess"],function(e,t,o,n,i,s,r){function a(){}return a.prototype={updateNodesAttributesValue:function(o,i){for(var a=this,l=require("DS/PADServices/utils/AttributesMgtV2"),d=0;d<i.length;d++)l.addBIColumn(i[d],e.getSetting("synthesisModeOnInstance"));var c=i.slice();-1===c.indexOf("ds6w:globaltype")&&c.push("ds6w:globaltype");var p={select_predicate:c,select_file:[]};let u=e.getSetting("webapi_timeout");u<=3e4&&o.length>=1e3&&(u=6e4);return t.waiting(o,1e3,1e3,function(e,t){return new Promise(function(o,i){p.physicalid=e;let l=function(){console.log(`>> complete ${t}`),o({batchId:t,localIds:e})};r.fetch({data:p,enopad_webapis:!1,pids:e,noCompletion:!0,timeout:u}).then(function(t){var o=s.data.jsonParse(t);n.parseMultiFetch({treeDoc:a,results:o.results,refresh_parameters:{modified:e}}).then(function(){setTimeout(l,50)})}).catch(function(e){console.error(e),i({err:e})})})})},additionalColumnUpdateByModule:function(e,t){let n=this;if(!t.pids&&!t.relids)return void console.error("no to refresh");let r=new Map;t.pids&&o.iterate(t.pids,function(e){r.set(e,n.getNodesById(e))});let a=new Map;t.relids&&o.iterate(t.relids,function(e){a.set(e,n.getNodesByRelId(e))});let l=this.getVisibleAdditionalColumns(),d=null;if(o.iterate(l,function(t){t.module.getName()===e&&(d=t.module)}),d){let l={pids:t.pids,relids:t.relids};function c(e){o.iterate(e,function(e){o.iterate(e.nodeArray,function(t){let o=new i(t);o.update(e.attrUpdate),o.execute()})})}l.pids||(l.pids=[]),l.relids||(l.relids=[]),new Promise(function(t,o){console.time(e),d.updateAttributes(l,function(o){console.timeEnd(e);let n=s.data.jsonParse(o);t(n)})}).then(function(e){n.setUseChangeTransactionMode(!0),n.withTransactionUpdate(function(){if(e.pids&&t.pids){c(t.pids.map(function(t){return{attrUpdate:{grid:e.pids[t]},nodeArray:r.get(t)}}))}if(e.relids&&t.relids){c(t.relids.map(function(t){return{attrUpdate:{grid:e.relids[t]},nodeArray:a.get(t)}}))}}),n.setUseChangeTransactionMode(!1)})}}},a}),define("DS/ENXNav/models/mixins/TreeDocAccess",["DS/TreeModel/TreeDocument","DS/ENXNav/utils/TwoDAppEvents"],function(e,t){"use strict";const o=[];function n(){}return n.prototype={forceSyncModel4TreeListView:function(){},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesById(e);t=t.concat(n)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),o=0;o<t.length;o++){var n=t[o].getNodeByPath(e,void 0,void 0,!0);if(n)return n}},removeRootsQuiet:function(e,t){let o=this,n=void 0===t||!t,i=e.map(function(e){return e.getID()});if(this.wrapInTransaction(function(){o._doNotBroadcastSelect=!0;for(let t=0;t<e.length;t++){let n=e[t];o._skipFilterProxy=!0,o.removeRoot(n),o._skipFilterProxy=!1}o._doNotBroadcastSelect=!1}),n){this.getModelEvents().publish({event:"onRemoveRoots",data:{pids:i}});let e=this.getRoots(),t=(this.detachedRoots?this.detachedRoots.length:0)+e.length;if(t){let o=e[0];this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:o,nb_root:t}})}}},removeRoot:function(e,o,n){if(this._doNotBroadcastSelect=!0,this.invalidateViewPort(),this._parent(e),t.removeRoot(),this._doNotBroadcastSelect=!1,!UWA.is(o,"boolean")||!o){var i=this.getRoots().length;if(this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:e.getID(),remainingRoots:i}}),i>0){var s=null;this.getRoots().length>0&&(s=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:s,nb_root:i}})}}},searchRootById:function(e){for(var t,o=this.getRoots(!0),n=0;n<o.length;n++)if(o[n].options.resourceid===e){t=o[n];break}return t},getNodesByRelId:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesByRelId(e);t=t.concat(n)}),t},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(o){!function e(t,o,n,i){if(t.getID()===o[n])if(n===o.length-1)i.push(t);else{var s=t.getChildren();s&&s.length>0&&(n+=1,s.forEach(function(t){e(t,o,n,i)}))}}(o,e,0,t)}),t},deleteNodes:function(e,t){var o=this;o.withTransactionUpdate(function(){var n={detach:{deleted:[]}};e.forEach(function(e){if(e.isRoot())o.removeRoot(e);else{var t=e.getParent(),i=t.getState();e.remove(),n.detach.deleted.push(e.getID()),"partiallyExpanded"!==i||t.options.children||(t.options.children=[],t.setState({state:"collapsed"}))}}),!0===t&&o._cmdProxy.padRefresh(n)})},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var n=0;n<t.length;n++){var i=o.getNodeByPath(t[n],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},getDetachedRoots:function(){return o},getVisibleNodes:function(){let e=[];return this.processDescendants({processNode:function(){this.isHidden()||e.push(this)}}),e},wrapInTransaction:function(e){try{e()}catch(e){}}},n}),define("DS/ENXNav/models/mixins/TreeDocSelect",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/CompassUtils","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/CommandProxy","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/utils/OFW"],function(e,t,o,n,i,s,r,a){"use strict";function l(e,t){if(e instanceof Array&&t instanceof Array){var o=e.length;if(o===t.length){for(var n=0;n<o;n++)if(e[n]!==t[n])return!1;return!0}return!1}return!1}function d(){}return d.prototype={_broadcastSelect:!0,_selected_paths:!0,initSelectCB:function(){var e=this,t=function(){r.publish({event:"ENXModel/NodeModelUpdate"}),e._doNotBroadcastSelect||(e._directSelection=!0,e._selected_paths=[],e._cmdProxy.select(e._buildSelectData()),!0===e._broadcastSelect&&!0===e.options.authorize_setStructure&&(o.setObject({nodes:e.getXSO().get()}),a.setTypesForOFW(e))),0===e.getSelectedNodes().length&&null!==e._pagerview&&!0!==e._focusOn&&!0!==e._reframeFocus&&(e._pagerview.hide(),delete e._pagerview,e._reframeFocus=!1)};this.getXSO().onPostAdd(function(){t()}),this.getXSO().onPostRemove(t),this.getXSO().onEmpty(function(){!1===e._emptyFromProxy?e._pagerview?(e.searchProgress||!0===e._focusOn||e.closePager(),!0!==e._focusOn&&e.closePager()):e._inBatchingForUpdate||(e._doNotBroadcastSelect=!1):e._emptyFromProxy=!1,t()}),this.getXSO().onPreEmpty(function(){!1===e._emptyFromProxy&&(e._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(t){27===t.keyCode&&(e.getXSO().empty(),e.restoreSelection())})},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(o.setObject({nodes:this.getSelectedNodes()}),a.setTypesForOFW(this))},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){this._cmdProxy.select(this._buildSelectData()),this.broadcastSelect(!0),this._doNotBroadcastSelect=!1},restoreSelection:function(e){if(this.originalSelection){let t=this,o=function(){t._selected_paths=t.originalSelection,t._selectOccurence("FocusOn")};e?o():this.withBroadcastSelect(o)}},isDirectSelection:function(){return this._directSelection},_onSelectProxy:function(e,o){let i=this;if(!this._insertFlag&&!0!==e.searchDone){if(1==e.focusOn&&e.sharedID&&e.sharedID!==n.getSharedId()||(d=e.paths).filter(function(e){return e.length%2==1}).length!==d.length)return;var r=!1,a=e.paths;let c=!1;this._selected_paths=UWA.clone(a);var l=function(){try{this._doNotBroadcastSelect=!0,this._selected_paths.length?this._selectOccurence("",!0,!0):o.appid===s.appId()&&(this._emptyFromProxy=!0,this.unselectAll(),this._directSelection=!1);var e=[];let g=widget.getValue("enableProdConfig")&&t.getSetting("activateExcludeOccProxy")&&this.isEditor();for(var n=0;n<this._selected_paths.length;n++){var l=this.getNodeByOccurencePath(this._selected_paths[n]);if(l){let t=l.getOccurencePath();if(this.pathsAreEqual(t,this._selected_paths[n]))e.push(this._selected_paths[n]);else if(g){this.pathIsInExcludes(l,this._selected_paths[n])&&(c=!0)}}}if(e.length===a.length&&e.length>0)for(var d=0;d<e.length&&!r;d++){var p=e[d],u=p.length;if(u>2){var h=i.getNodesById(p[u-1]);h&&h.length>0&&(r=!0)}}this._selected_paths=e}finally{setTimeout(function(){this._doNotBroadcastSelect=!1}.bind(this),500)}}.bind(this);l(),!1===c&&!0!==e.doNotSetOnCompass&&a.length&&o.appid===s.appId()&&!0!==this._hideChildrenFilter&&!r&&(this._selected_paths=a,this.insertBranches(e.paths,{node_state:"collapsed",from:"select",forceCollapsed:!0,novalidation:!0,skipDrop:!0,onComplete:function(){l()}}))}var d},_selectOccurence:function(e,t,o){var n=this.getRoots(),i=this._selected_paths,s=0;if(i.length>0){var r=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var a=[];for(s=0;s<n.length;s++){let e=n[s];for(let t=0;t<i.length;t++){var l=e.getNodeByPath(i[t]);if(l&&(r=!0,a.push(l),!l.isVisible())){for(var d=l.getParent();!d.isVisible();)d=d.getParent();d&&-1===a.indexOf(d)&&a.push(d)}}}var c=!1;if(!0!==t||!0===r){var p=this.getSelectedNodes();for(s=0;s<p.length;s++){var u=p[s];a.indexOf(u)<0&&(this._checkIfCurrentSelectionIsStillValid.call(this,u)||(u.unselect(),c=!0))}}var h=a.filter(function(e){return!e.isSelected()});c=h.length>0,this.multiselect(h),!0===o&&c&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_checkIfCurrentSelectionIsStillValid:function(e){let t=!1,o=this._selection;if(!o)return t;for(let n=0;n<o.length;n++){if(l(o[n],e.getOccurencePath())){t=!0;break}}return t},_buildSelectData:function(){var e=[],t=this._selected_paths;t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var n=0;n<t.length;n++){var i=o.getNodeByPath(t[n],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();this.isGroupingApplied()&&(e=e.filter(function(e){return!0!==e.isGroupingNode}));var o,s={paths:[],tenant:i.getPlatformId()};s.attributes={},s.version="1.1";o=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(s),s.paths=e.map(function(e){return e.getOccurencePath(o)});var r=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");try{s.changeControl=r.get()}catch(e){console.warn("No Change")}return this._currentApp=n.getSharedId(),s.sharedID=this._currentApp,null===this._pagerview&&!0!==this._focusOn?s.focusOn=!1:s.focusOn=!0,this.options.context&&this.options.context.hasActiveDesignExp()&&this.options.context.getPseService().app.core.contextManager.handleDesignExpItemsSelection(s),s},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var n=0;n<t.length;n++){var i=o.getNodeByPath(t[n],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},multiselect:function(e){var t=this,o=t.getXSO();this.prepareUpdate(),e=e.filter(function(e){return t.options.shouldBeSelected(e)}),o.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},notifyTagger:function(){this.getModelEvents().publish({event:"setPathTags",context:this})},__copyLink:async function(){let t=i.getPlatformURL("3DDashboard"),s="#app:"+n.getAppId()+"/content:X3DContentId=",r=o.buildX3DContent(this.getSelectedNodes());var a=t+s+encodeURIComponent(JSON.stringify(r));await n.copyTexttoCLipboard(a)?n.displayNotif({message:e.replace(e.msg_success_copyLink,{label:this.getSelectedNodes()[0].getLabel()}),level:"success"}):n.displayNotif({title:e.msg_error_copyLinkTitle,message:e.msg_error_copyLink,level:"error",key:"xNavDoc-copy-link-error"})}},d}),define("DS/ENXNav/models/mixins/TreeDocAdditionals",["UWA/Core","DS/PADServices/settings/AppSettings","DS/PADServices/utils/Iterator","DS/ENXNav/models/AdditionalRelDummyInfo"],function(e,t,o,n){const i=["SyncModelRefresh","SyncModelNodes","OnReady","OnSyncModel","OnScrollEnd","ExportAs"],s=["ENODOFormatStatus_Col","ENOXCADSyncStatus_Col"];function r(e,t,o,n,r,a){let l=Array.isArray(n);if(!0!==e.isRelationsObjectNode)for(var d=0;d<o.length;d++){var c=o[d],p=c.getManagedColumnNames(),u={};let D=!1;for(var h=0;h<p.length;h++)u[p[h]]=e.options.grid[p[h]];var g="function"==typeof c.getAutoReloadNames?c.getAutoReloadNames():[];for(h=0;h<g.length;h++)u[g[h]]=e.options.grid[g[h]];var f=Object.keys(u);if(l){for(var v={},m=0;m<f.length;m++)-1!==n.indexOf(f[m])&&(v[f[m]]=u[f[m]],D=!0);u=v}else f.length&&(D=!0);if(!0===D&&c.toBeUpdated(u,a)&&i.includes(a)){void 0===t[c.getName()]&&(t[c.getName()]={pids:[],relids:[],pairs:{}});var b=e.getID();-1===t[c.getName()].pids.indexOf(b)&&t[c.getName()].pids.push(b);var _=e.getRelationID();_&&-1===t[c.getName()].relids.indexOf(_)&&(t[c.getName()].relids.push(_),t[c.getName()].pairs[b]=_)}else i.includes(a)&&s.includes(c.getName())&&r.addOtherKeys(p)}else r.addRelationNode(e)}function a(o,n,i){var s=i;return e.is(o.filterAttributesForUpdate,"function")&&(s=o.filterAttributesForUpdate({node:n,node_opts:s})),-1===s.relationOrder&&(s.relationOrder=n.options.relationOrder),!0===t.getSetting("tree_order_in_label")&&s.label&&(s.label+="(treeorder="+s.relationOrder+")"),s}function l(e){this.name=e,console.time(this.name)}function d(){}return l.prototype={end:function(){console.timeEnd(this.name)}},d.prototype={fillAttributesAsync4VisibleNodes:function(e,t,o){this.fillAttributesAsync(e,o)},fillAttributesAsync:function(e,t){if(this._pendingNodes||(this._pendingNodes=[]),this._pendingAttr)return void(this._pendingNodes=this._pendingNodes.concat(e));e=e.concat(this._pendingNodes),this._pendingNodes.length=0,this._pendingAttr=!0;let o=this;var n=function(){o._pendingAttr=!1},i=function(){o.fillAttributesAsync([],t)};this.fillAdditionalColumns(e,null,t).then(function(t){var s,r;n(),t&&t.updates&&(o._pendingNodes=(s=o._pendingNodes,r=e,s.filter(function(e){return-1===r.indexOf(e)})),o._pendingNodes.length&&setTimeout(i,0))}).catch(n)},fillAdditionalColumns:function(t,i,s){let d=this;return new Promise(function(c,p){let u=new n;if(t.length)if(d.options.additionalColumnsModules&&d.options.additionalColumnsModules.length){let n=!1;"ExportAs"===s&&(n=!0);var h=d.getVisibleAdditionalColumns(n);h.length?require(["DS/ENXNav/models/Algos"],function(n){var p={};new Promise(function(e){for(var o=0;o<t.length;o++)r(t[o],p,d.options.additionalColumnsModules,i,u,s);e()}).then(function(){for(var t=[],i=0;i<h.length;i++){var s=h[i],r=s.module.getName();if(p[r]){let o=new l(r+"...updateAttributes");var g=new Promise(function(t){s.module.updateAttributes(p[r],function(n){var i=e.is(n,"string")?JSON.parse(n):n;t(i),o.end()},d)});t.push(g)}}t.length?Promise.all(t).then(function(t){let i=function(t){var o={},n=!1,i=!1;let s=[];for(var r=0;r<t.length;r++){let i=t[r],a=Object.keys(i.pids),l=Object.keys(i.relids),d=a.length>0&&0===l.length;s.push(d),!n&&d&&(n=d),e.extend(o,i,!0)}return s.filter(function(e){return!1===e}).length!==s.length&&(i=!0),{merger:o,hasPidOnlyUpdate:n,isMixed:i}}(t),s=i.merger,r=i.hasPidOnlyUpdate,l=i.isMixed;d.setUseChangeTransactionMode(!0),d.withTransactionUpdate(function(){var e=0,t=Object.keys(s.pids),i=Object.keys(s.relids),c=[];if(i)for(var p=0;p<i.length;p++){if((f=d.getNodesByRelId(i[p]))&&f.length)for(e=0;e<f.length;e++){let r=f[e];var u=n.extractGridChanges(a(d,f[e],{grid:s.relids[i[p]]}),r.options);u.hasChanged&&r.updateOptions(u.finalResults);var h=r.getID();if(-1!==t.indexOf(h)&&(c.push(h),l)){let e=s.pids[h];o.iterate(u.updatedProps,function(t){delete e[t]})}}else console.warn("Should not happen. The node should be found")}if(r||c.length&&o.iterate(c,function(e){var o=t.indexOf(e);-1!==o&&t.splice(o,1)}),t&&t.length>0)for(var g=0;g<t.length;g++){var f;if((f=d.getNodesById(t[g]))&&f.length)for(e=0;e<f.length;e++){var v=n.extractGridChanges(a(d,f[e],{grid:s.pids[t[g]]}),f[e].options);v.hasChanged&&f[e].updateOptions(v.finalResults)}else console.warn("Should not happen. The node should be found")}}),u.applyMerger(s),d.setUseChangeTransactionMode(!1),c({updates:!0})}):c()})}):c()}else c();else c()})}},d}),define("DS/ENXNav/models/_xNavGrouping",["i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","text!DS/PADServices/assets/init/DefaultColorStream.json","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/models/_xNavCVParser","DS/ENOXParser/modules/TwoDParser","UWA/Class","UWA/Utils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PADTrackerManager","DS/Utilities/UUID","DS/ENOXInterWdgCom/LinkManager"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f,v,m){"use strict";function b(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)"collapsed"===t.getState()&&t.setState({state:"partiallyExpanded"}),t=t.getParent()}function _(e,t){return e&&e.hasOwnProperty(t)?e[t]:e.grid[t]}function D(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)t.expand(),t=t.getParent()}function S(e){var t=e.getChildren();for(let e=0;e<t.length;e++)!0===t[e].isGroupingNode?S(t[e]):t[e].select()}function x(e){var t=[],o=e.getChildren();for(let e=0;e<o.length;e++)!0===o[e].isGroupingNode?t=t.concat(x(o[e])):t.push(o[e]);return t}function y(e){let t=null;for(;e.getParent()&&null===t;)(e=e.getParent()).isGroupingNode?t=e:y(e);return t}var N="true"!==g.getURLParameter("noFlatGrouping"),C=0;const P=JSON.parse(o),w=180*(3-Math.sqrt(5));var A=r.extend({});return A.prototype.getGroupLayout=function(){return N?"compact":"structured"},A.prototype.isGroupingApplied=function(){return this.options.isGroupingApplied},A.prototype.isGroupColorApplied=function(){return!!this.options.coloredGroups},A.prototype.getGroupingNode=function(e,t,o){var n,i=e.getID(),s=this.options.mapGrpNodes[i];if(s){var r=this.__getKeyFromNode(t);r||(r="other"),this.options.mergedMap[r]&&(r=this.options.mergedMap[r]),(n=s[r])||(n=s.other?s.other:this.__createOtherNode(s,e,"",[])),o&&b(n)}return n},A.prototype.getGroupingNodeV2=function(e,t,o){var n;let i=!1;var s=this.options.mapGrpNodes[e];if(s){var r=this.__getKeyFromNodeV2(t);r||(r="other"),this.options.mergedMap[r]&&(r=this.options.mergedMap[r]),(n=s[r])||("other"!==r&&(i=!0),s.other?(n=s.other,this.isEditor()&&n.isHidden()&&(n.show(),"collapsed"===n.getState()&&n.setState({state:"expanded"}))):n=this.__createOtherNode(s,this.getNodesById(e)[0],"",[])),o&&b(n)}let a={shouldBeNewGroup:!1,groupNode:n,actualGroupKey:r};return i&&(a.shouldBeNewGroup=!0),a},A.prototype.setGrpPartialExpandState=function(e){b(e)},A.prototype.cleanGrouping=function(){this.options.mapGrpNodes={},this.options.isGroupingApplied=!1,this.options.groupPredicates=[],this.options.selectedTags=[],this.options.realSelectedTags=[],this.options.mergedMap={},this.options.groupingFilterInProgress=!1;for(var e=this.getRoots(),t=0;t<e.length;t++)e[t].options.childComputed=!1},A.prototype.cleanGroupingForRoots=function(e){let t=e.rootIds?e.rootIds:[];for(let e=0;e<t.length;e++)delete this.options.mapGrpNodes[t[e]]},A.prototype.getGroupingForOpen=function(){let e=void 0;if(this.options.isGroupingApplied){e=[];for(let t=0;t<this.options.groups.length;t++){let o=[];for(let e=0;e<this.options.groups[t].object.length;e++)o.push(this.options.groups[t].object[e].object);e.push({predicate:this.options.groups[t].predicate,tags:o})}e.length>0&&f.addCommandHit("openWithGrouping",this.options.groups[0].predicate)}return e},A.prototype.clearCachedHiddenNodes=function(){delete this.options.hiddenNodes},A.prototype.__applyGrouping=function(e){var t=this;return this.isGroupColorApplied()&&this.__removeColorGroupCmd(),!0===this.options.groupingFilterInProgress?(console.debug("Grouping with filter in progress"),Promise.resolve()):new Promise(o=>{var n=e.fromGroupingEvent||e.fromApplyFilter||e.fromLayoutChange;if(n)if(e.roots){let o=[];for(let t=0;t<e.roots.length;t++)o.push(e.roots[t]);t.cleanGroupingForRoots({rootIds:o})}else t.cleanGrouping();this.options.groupingFilterInProgress=!0,this.options.hiddenNodes=new Map;let i=Array.isArray(e.roots)&&e.roots.length?e.roots:this.getRoots();for(let e=0;e<i.length;e++){let t=i[e],o=t.getAllDescendants().filter(e=>0===e.options.isHiddenState);o.length>0&&this.options.hiddenNodes.set(t,o)}t.__collapseAllRoots({roots:e.roots,noGroupUpdate:e.noGroupUpdate}).then(i=>{var s=[];if(e.groups.length){t.options.groups=e.groups;for(let e=0;e<t.options.groups.length;e++)for(let o=0;o<t.options.groups[e].object.length;o++)if(Array.isArray(t.options.groups[e].object[o].object)){var r="",a=t.options.groups[e].object[o].object;for(let e=0;e<a.length;e++)r+=a[e],-1===t.options.selectedTags.indexOf(r)&&t.options.selectedTags.push(r),r+="/";let n=t.options.groups[e].object[o].object.join("/");t.options.realSelectedTags.push(n)}else{let n=[t.options.groups[e].object[o].object];if(Array.isArray(t.options.groups[e].object[o].merged))for(let i=0;i<t.options.groups[e].object[o].merged.length;i++)n.push(t.options.groups[e].object[o].merged[i].object),t.options.mergedMap[t.options.groups[e].object[o].merged[i].object]=t.options.groups[e].object[o].object;t.options.selectedTags=t.options.selectedTags.concat(n),t.options.realSelectedTags=t.options.realSelectedTags.concat(n)}t.options.selectedTags=t.options.selectedTags.filter(function(e,o){return t.options.selectedTags.indexOf(e)===o}),t.options.realSelectedTags=t.options.realSelectedTags.filter(function(e,o){return t.options.realSelectedTags.indexOf(e)===o});var l=Promise.resolve();if(!0!==e.noGroupUpdate&&(l=t.__retrieveGrps(e)),i.length){var p=t.__fetchChildren({lstRemoveChildren:i,groupingPromise:l,noGroupUpdate:e.noGroupUpdate}).then(()=>{t.options.isGroupingApplied=!0});s.push(p)}else t.options.isGroupingApplied=!0;s.push(l)}else{for(let e=0;e<t.options.groupPredicates.length;e++)d.removeBIColumn(t.options.groupPredicates[e]);t.options.groupPredicates=[]}Promise.allSettled(s).then(()=>{c.publish({event:"ENXModel/Model/ApplyGrouping/Done",data:{fromEvent:n,status:!0}}),t.options.groupingFilterInProgress=!1,o()})})})},A.prototype.__groupsLayoutCmd=function(e){let t=!0;switch(e.mode){case"structured":t=!1;break;default:case"compact":t=!0}t!==N&&(N=t,this.__applyGrouping({groups:this.options.groups,fromLayoutChange:!0}))},A.prototype.__collapseAllRoots=function(e){var t=this;return new Promise(o=>{var n=Array.isArray(e.roots)&&e.roots.length?e.roots:t.getRoots();this.prepareUpdate();var i=[];for(let t=0;t<n.length;t++){var s=n[t];if(s){var r=s.getState(),a=[],l=0;let t=s.getChildren();for(;t.length-l;){var d=!0;if(!0===t[l].isRelationsObjectNode&&(d=!1,!0!==e.noGroupUpdate&&!0===t[l].isGroupingNode&&(d=!0)),d){var c=s.removeChild(t[l]);a.push({rootID:s.getID(),node:c})}else l++}!0!==e.noGroupUpdate&&(s.setState({state:"collapsed"}),s.options.padstate="collapsed",s.childComputed=!1),"expanded"!==r&&"partiallyExpanded"!==r||(i=i.concat(a))}}this.pushUpdate({updateType:WUXModelUpdateTypes.Removal}),o(i)})},A.prototype.__retrieveGrps=function(e){var t=this;return new Promise(o=>{var n=Array.isArray(e.roots)?e.roots:t.getRoots();n=Array.isArray(e.roots)?e.roots:t.getRoots();let i=[];for(let o=0;o<n.length;o++)i.push(t.__retrieveGrpsOnNode(n[o],e));Promise.allSettled(i).then(o)})},A.prototype.__retrieveGrpsOnNode=function(e,t){var o=this;return new Promise((n,i)=>{var s;console.log("Apply grouping on node "+e.getLabel()),s=p.getGroupingNodes?Promise.resolve():u.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});var r=o.options.groupPredicates=[];for(let e=0;e<t.groups.length;e++)r.push(t.groups[e].predicate),d.addBIColumn(t.groups[e].predicate,!0);s.then(()=>{var s={filterBI:o.options.filterBI?o.options.filterBI:o.options.FBIProxy._biFilter,data:{},pathIds:[e.getOccurencePath()],grouping:t,is2D:!0,filter_facets:r};p.getGroupingNodes(s).then(i=>{o.__buildGrpsOnNode(e,i,t.groups).then(n)}).catch(i)})})},A.prototype.__buildGrpsOnNode=function(e,t,o){var n=this;return new Promise(i=>{t="string"==typeof t?JSON.parse(t):t;var s={},r=n.options.mapGrpNodes[e.getID()]={},a=[],l=!1;for(let i=0;i<t.results.length;i++)if(t.results[i].synthesis){var d=t.results[i].synthesis&&t.results[i].synthesis.facets?t.results[i].synthesis.facets:[];let h=o[0].object.map(e=>e.object);if((d=d.slice().sort(function(e,t){return h.indexOf(e.object)-h.indexOf(t.object)})).length)for(let t=0;t<d.length;t++){var c=d[t];if(c.sixw){var p=c.sixw.split("/"),u=p[p.length-1];-1!==n.options.groupPredicates.indexOf(u)&&(!0===N?n.__buildFlatGrping(c,e,s,a,r,o):n.__buildStructuredGrping(c,e,s,a,r,o))}}else t.results[i].synthesis.name.contains("Other")&&t.results[i].synthesis.value>0&&(l=!0)}if(!0===l||n.isEditor()){let t=n.__createOtherNode(r,e,u,a);l||t.hide()}e.setState({state:"expanded"}),i()})},A.prototype.__createOtherNode=function(t,o,i,s){var r=new n({isGroupingNode:!0,resourceid:"xnav-groupingNode-other-"+v.v4(),label:e.groupingNode.other,grid:{groupValue:e.groupingNode.other},parentNode:o,isOther:!0,ds6w:i,grp:s,groupingIntent:this.options.groups});return r.onPreExpand(this._expandGrpNode.bind(this)),t.other=r,o.addChild(r),r},A.prototype.__buildStructuredGrping=function(e,t,o,i,s){var r=e.sixw.split("/"),l=r[r.length-1],d=a.splat(e.object),c=t,p="",u="";for(let e=0;e<d.length&&(p+=d[e],-1!==this.options.selectedTags.indexOf(p)||!0===c.isGroupingNode&&c.isGrpSelected());e++){if(this.options.mergedMap[p]&&(u=p,p=this.options.mergedMap[p]),o[p])c=o[p],this.options.mergedMap[u]&&(c.options.merged=!0,c.options.grp=c.options.grp.concat(d),i.push(d));else{var g=new n({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+d[e]+"-"+v.v4(),label:d[e],grid:{groupValue:d[e]},parentNode:c,ds6w:l,grp:d.slice(0,e+1),groupingIntent:this.options.groups});i.push(d.slice(0,e+1)),h.updateNLSGroupingNode(g),g.onPreExpand(this._expandGrpNode.bind(this)),c.addChild(g),(-1!==this.options.realSelectedTags.indexOf(p)||!0===c.isGroupingNode&&c.isGrpSelected())&&(-1!==this.options.realSelectedTags.indexOf(p)&&(g.options.grpSelected=!0,!0===c.isGroupingNode&&(c.options.contentRetrieved=!0,D(c))),s[p]=g),o[p]=g,c=g}p+="/"}},A.prototype.__buildFlatGrping=function(e,t,o,i,s,r){var l=e.sixw.split("/"),d=l[l.length-1],c=a.splat(e.object),p=t,u=c.join("/");this.options.mergedMap[u]&&(u=this.options.mergedMap[u]);var g,f=null;for(let e=0;r&&e<r.length;e++){let t=r[e];if(t.object)for(let e=0;e<t.object.length&&null===f;e++)t.object[e].object===u&&(f=t.object[e])}if(-1!==this.options.realSelectedTags.indexOf(u)||!0===p.isGroupingNode&&p.isGrpSelected())if(o[u])(g=o[u]).options.merged=!0,g.options.grp=g.options.grp.concat(c),i.push(c);else{var m=c[c.length-1];g=new n({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+m+"-"+v.v4(),label:f?f.dispText:m,dispText:f?f.dispText:void 0,grid:{groupValue:m},parentNode:p,ds6w:d,grp:c,groupingIntent:this.options.groups}),i.push(c),h.updateNLSGroupingNode(g),g.onPreExpand(this._expandGrpNode.bind(this)),p.addChild(g),g.options.grpSelected=!0,s[u]=g,o[u]=g}else if(function(e,t){for(var o=null,n=e.length-1;n>=0;n--){var i=e.slice(0,n);if(-1!==t.indexOf(i.join("/"))){o=i;break}}return o}(c,this.options.realSelectedTags)){var b=e.object.slice(0,e.object.length-1);if(!(p=s[b.join("/")])){var _=UWA.clone(e);_.object=b,p=this.__buildFlatGrping(_,t,o,i,s)}g=this.__buildFlatGrping(e,p,o,i,s)}return g},A.prototype.grpGetOtherNode=function(e){let t=this.options.mapGrpNodes[e.getID()].other;if(t)return t.isHidden()&&t.show(),t},A.prototype.grpCheckOtherNodeHide=function(e){let t=this.options.mapGrpNodes[e.getID()].other;t&&!t.hasChildren()&&t.hide()},A.prototype.grpIsOtherVisible=function(e){let t=this.options.mapGrpNodes[e.getID()].other;if(t)return!t.isHidden()},A.prototype.grpIsBsdGroupingApplied=function(){if(!this._isBsdGroupingCalculated){let e=this.options.groupPredicates,t=this._bsdPredicates=function(e){return e.filter(e=>e.startsWith("ds6w:browsingStructure"))}(e);this._isBsdGroupingApplied=t.length>0,this._isBsdGroupingCalculated=!0}return this._isBsdGroupingApplied},A.prototype.grpCreateGroupNode=function(e){let t=e.groupValue,o=e.bsdPredicate,n=e.parentNode,i=this.createNodeModel({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+t+"-"+v.v4(),label:t,grid:{groupValue:t},ds6w:o,grp:this.options.grps,groupingIntent:this.options.groups});return n.addChild(i),i.onPreExpand(this._expandGrpNode.bind(this)),i},A.prototype._expandGrpNode=function(e){var o=this;return new Promise(n=>{var i=e.data,r=i.nodeModel,a=!!i.expandAll&&i.expandAll,c=i.state?i.state:"expanded";if(r._uiOnlyExpand)return delete r._uiOnlyExpand,void n();var u=[];if(!0===r.options.contentRetrieved){if(r.setState({state:c}),e.target&&e.target.preExpandDone({preventExpandAll:!0}),a){let e=r.getChildren();for(let t=0;t<e.length;t++)!0===e[t].isGroupingNode&&u.push(o._expandGrpNode({data:{nodeModel:e[t],expandAll:!0,state:c}}))}Promise.all(u).then(n)}else{var h=parseInt("1"),f=d.createOutputsRequest(),v=l.getWebAPI_Options("navigate"),m=!1,b=[];b[0]={},b[0].predicate=r.options.groupingIntent[0].predicate,b[0].predLevel=r.options.groupingIntent[0].predLevel,b[0].other=r.options.isOther;var _,D,S=r.getGroups();if(r.options.isOther){var x=[];for(let e=0;e<S.length;e++)x.push({object:S[e]});0==x.length&&(m=!0),b[0].object=x}else r.options.merged?b[0].object=r.options.groupingIntent[0].object:b[0].object=[{object:S}];if(m?(_={pathIds:[r.getParent().getOccurencePath()],FBIProxy:o.options.FBIProxy,data:{expandLevel:h},select_relation:["ro.plminstance.v_treeorder"]},D=p.expandv2(_)):(_={filterBI:o.options.filterBI?o.options.filterBI:o.options.FBIProxy._biFilter,expandLevel:h,data:{select_bo:f.select_object,select_rel:f.select_relation,compute_select_bo:f.select_file},pathIds:[r.getOccurencePath()],iterativeFilter:v["q.iterative_filter_query_bo"],filterRel:v.no_type_filter_rel,groupingFilter:b},D=p.expandGroupingNodeV2(_)),o.prepareUpdate(),a){let e=r.getChildren();for(let t=0;t<e.length;t++)!0===e[t].isGroupingNode&&u.push(o._expandGrpNode({data:{nodeModel:e[t],expandAll:!0,state:c}}))}var y=new Promise(function(e,n){D.then(function(n){try{var i=UWA.is(n,"string")?JSON.parse(n):n;if(!0===i.timeoutOccurs)r.setState({state:"collapsed"}),g.displayNotif({message:t.find_in_context_timeout,level:"error",key:"expandGroup-timeout"});else{var a=r,d=l.getSetting("parse_timeout");d&&parseInt(d);s.parseExpandLoadModel({treeDoc:o,expandedNodes:[a],FBIProxy:o.options.FBIProxy._biFilter,wsResponse:i,nodeModelClass:o.options.nodeModelClass,expandLevel:h})}}catch(e){e.type&&"TimeoutError"===e.type?g.displayNotif({message:t.parseTimeout,level:"warning",key:"expandGroup-parse-timeout"}):g.displayNotif({message:t.generic_service_failure,level:"error",key:"expandGroup-generic-error"})}finally{if(!0!==i.timeoutOccurs&&(r.options.contentRetrieved=!0,r.setState({state:c}),!0===a.options.filtered)){var p=UWA.clone(a.options.icons[0]);p.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},a.updateOptions({icons:[p]})}e()}}).catch(function(e){r.setState({state:"collapsed"}),n()})});u.push(y),Promise.all(u).then(()=>{o.pushUpdate(),e.target&&e.target.preExpandDone({preventExpandAll:!0}),n()})}})},A.prototype.__getKeyFromNode=function(e){var t=null;if(this.options.groupPredicates.length>1)throw new Error("Too many grouping predicates");for(let i=0;i<this.options.groupPredicates.length;i++){var o=e.getReferenceValue(this.options.groupPredicates[i]+"-Instance"),n=e.getReferenceValue(this.options.groupPredicates[i]);o?"boolean"==typeof n?(!1!==o&&"FALSE"!==o||!0!==n||(o=!0),t=o.toString().toUpperCase()):t=o:t="boolean"==typeof n?n.toString().toUpperCase():n,t&&!0===Array.isArray(t)&&(1===t.length?t=t[0]:console.warn("Node ["+e.getLabel()+"] is defined in several group. Will be displayed in Other group"))}return t},A.prototype.__getKeyFromNodeV2=function(e){var t=null;if(this.options.groupPredicates.length>1)throw new Error("Too many grouping predicates");for(let i=0;i<this.options.groupPredicates.length;i++){var o=_(e,this.options.groupPredicates[i]+"-Instance"),n=_(e,this.options.groupPredicates[i]);o?"boolean"==typeof n?(!1!==o&&"FALSE"!==o||!0!==n||(o=!0),t=o.toString().toUpperCase()):t=o:t="boolean"==typeof n?n.toString().toUpperCase():n,t&&!0===Array.isArray(t)&&(1===t.length?t=t[0]:console.warn("Node ["+actualNode.getLabel()+"] is defined in several group. Will be displayed in Other group"))}return t},A.prototype.getGroupingNodesList=function(e){return this.options.mapGrpNodes&&this.options.mapGrpNodes[e]?Object.values(this.options.mapGrpNodes[e]):[]},A.prototype.__expandAllGroups=function(e){var t=this.options.mapGrpNodes[e.getID()];if(t){var o=Object.keys(t);this.withTransactionUpdate(()=>{for(let n=0;n<o.length;n++){(!0===e.isGroupingNode?e.options.parentNode.getID():e.getID())===t[o[n]].getGroupObjID()&&(t[o[n]].expandAll(),t[o[n]].options.contentRetrieved=!0,t[o[n]].setState({state:"expanded"}))}})}},A.prototype.__fetchChildren=function(e){var t=this;return new Promise(o=>{e.groupingPromise.then(()=>{var n=[],i={},s=[],r=[];for(let o=0;o<e.lstRemoveChildren.length;o++){let c=e.lstRemoveChildren[o].node;if(!0!==c.isGroupingNode&&!0!==c.isRelationsObjectNode){var a=!1;for(let e=0;!1===a&&e<t.options.groupPredicates.length;e++){var l=c.getReferenceValue(t.options.groupPredicates[e]);l?console.log("Predicate value ["+l+"] found on node "+c.getLabel()):(n.push(c.getID()),i[c.getID()]=c,a=!0);var d=c.getReferenceValue(t.options.groupPredicates[e]+"-Instance");d?console.log("Predicate value on instance ["+d+"] found on node "+c.getLabel()):(n.push(c.getRelationID()),a=!0,i[c.getRelationID()]=c)}a&&(s.push(c),r.push(e.lstRemoveChildren[o].rootID))}}var c=Promise.resolve();n.length?(console.log("Fetch the predicates values for the grouping on "+n.length+" objects"),c=new Promise(e=>{var o={pids:n,data:{select_predicate:t.options.groupPredicates.concat(["ds6w:globalType"]),select_file:[]}};p.fetch(o).then(t=>{t="string"==typeof t?JSON.parse(t):t;for(let e=0;e<t.results.length;e++){var o,n=t.results[e],s={},r=!1,a="ds6w:Part"!==s["ds6w:globalType"]&&"ds6w:Document"!==s["ds6w:globalType"];for(let e=0;e<n.attributes.length;e++)"resourceid"===n.attributes[e].name?o=i[n.attributes[e].value]:"ds6w:globalType"===n.attributes[e].name?a="ds6w:Part"!==n.attributes[e].value&&"ds6w:Document"!==n.attributes[e].value:(s[n.attributes[e].name]=n.attributes[e].value,r=!0);if(!0===r&&o){var l={grid:{}},d=Object.keys(s);for(let e=0;e<d.length;e++)a?l.grid[d[e]+"-Instance"]=s[d[e]]:l.grid[d[e]]=s[d[e]];o.updateOptions(l)}}e()})})):console.log("No Id to fetch"),c.then(()=>{for(let o=0;o<s.length;o++){var n=s[o],i=t.searchRootById(r[o]),a=t.getGroupingNode(i,n);a&&(n.show(),a.addChild(n),!0!==e.noGroupUpdate&&(a.options.contentRetrieved=!0))}o()})})})},A.prototype.__expandAllGroupsCmd=function(){var t=this;return new Promise(o=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.expandAllGroupsCmd,context:t});let n=t.getSelectedNodes();var i=[];t.withTransactionUpdate(()=>{for(let e=0;e<n.length;e++)!0===n[e].isGroupingNode&&i.push(t._expandGrpNode({data:{nodeModel:n[e],expandAll:!0,state:"expanded"}}))}),Promise.all(i).then(()=>{t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),o()})})},A.prototype.focusOnGroups=function(){return this.__focusOnGroupsCmd()},A.prototype.__focusOnGroupsCmd=function(){var t=this;return new Promise(o=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.focusOnGroupsCmd,context:t});let n=t.getSelectedNodes(),i=[];var s=[];t.withTransactionUpdate(()=>{for(let e=0;e<n.length;e++)if(!0===n[e].isGroupingNode){i.push(n[e]);let o="expanded"===n[e].getState()?"expanded":"collapsed";s.push(t._expandGrpNode({data:{nodeModel:n[e],expandAll:!0,state:o}}))}}),Promise.all(s).then(()=>{t.withBroadcastSelect(()=>{for(let e=0;e<i.length;e++)S(i[e]);t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),o()})})})},A.prototype.__colorizeGroupCmd=function(){var t=this;return new Promise(o=>{t.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.colorizeGroupCmd,context:t});let n=t.getSelectedNodes(),i=[];var s=[];t.withTransactionUpdate(()=>{for(let e=0;e<n.length;e++)if(!0===n[e].isGroupingNode){i.push(n[e]);let o="expanded"===n[e].getState()?"expanded":"collapsed";s.push(t._expandGrpNode({data:{nodeModel:n[e],expandAll:!0,state:o}}))}}),Promise.all(s).then(()=>{var e=[];for(let t=0;t<i.length;t++){var n=x(i[t]);e.push({groupNode:i[t],groupedPhysNode:n})}t.__buildEnrich3DColorize({colorizedGroups:e}).then(function(e){t._cmdProxy.enrich3D(e),t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),o()})})})},A.prototype.__buildEnrich3DColorize=function(e){var t=this;return new Promise(function(o,n){var i;if(e.colorizedGroups){t.options.coloredGroups||(t.options.coloredGroups={});for(let o=0;o<e.colorizedGroups.length;o++){var s=e.colorizedGroups[o];if(!t.options.coloredGroups[s.groupNode.getID()]){var r=Object.keys(t.options.coloredGroups),a=s.groupedPhysNode.map(e=>e.getOccurencePath());if(void 0!==typeof a&&a.length>0){let e=t.__getNextColor();s.groupNode.updateOptions({color:e});var l=s.groupNode.getLabel(),d=(r=Object.keys(t.options.coloredGroups))?r.length+1:1;t.options.coloredGroups[s.groupNode.getID()]={coloredGprNode:s.groupNode,groupLabel:l,paths:a,style:s.style?s.style:{color:e,opacity:1,forceInherit:!0,label:l,id:d}}}}}}else delete t.options.coloredGroups;if(t.options.coloredGroups){var c=t.options.coloredGroups,p=(r=Object.keys(c),c[r[0]].coloredGprNode.getPredicate());h.retrieveDS6WNLS([p]).then(function(e){var n=e&&e[p]?e[p].label:p;i={deleteOnUnlink:!0,cumulativeMode:!0,graphicProperties:{kinds:[{AMD:"DS/ENOPAD3DViewer/views/PADLayerGroupingView",kind:"grouping"}],layers:[]}};var s={label:n,kind:"grouping",type:"grouping",id:r[0],styles:[{color:"#FFFFFF",opacity:.5,forceInherit:!1,label:"no match",id:0}],colorMap:[{resourceid:c[r[0]].paths[0][0],style:0}]};for(let e=0;e<r.length;e++){let o=c[r[e]];s.styles.push(o.style);for(let e=0;e<o.paths.length;e++){let n=o.paths[e],i=y(t.getNodeByOccurencePath(n)),r=i.options.color;!i||i.getID()!==o.coloredGprNode.getID()&&r||s.colorMap.push({path:n,style:o.style.id})}}i.graphicProperties.layers.push(s),o(i)})}})},A.prototype.__getNextColor=function(){let e;if(this.options.usedColor||(this.options.usedColor=[]),this.options.usedColor.length+1<P.colorStream.length)e=P.colorStream[this.options.usedColor.length],this.options.usedColor.push(e);else{e=function(e,t,o){o/=100;const n=t*Math.min(o,1-o)/100,i=t=>{const i=(t+e/30)%12,s=o-n*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*s).toString(16).padStart(2,"0")};return`#${i(0)}${i(8)}${i(4)}`}(C*w,100,75),C++}return e},A.prototype.__removeColorGroupCmd=function(){let e=Object.keys(this.options.coloredGroups);m.publish("DS/ENO/enrich3D",{deleteLayers:[e[0]]});for(let t=0;t<e.length;t++)this.options.coloredGroups[e[t]].coloredGprNode.updateOptions({color:null});C=0,delete this.options.coloredGroups,delete this.options.usedColor},A}),define("DS/ENXNav/utils/CtxMenuUtils",["i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ApplicationFrame/CommandsManager","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWebInWinServices","DS/ENXNav/utils/OpenWithMenuBuilder","DS/etree/syncwidget"],function(e,t,o,n,i,s,r,a){"use strict";var l={};return l.buildMenu=function(e){var t;switch(e.view){case"datagridview":t=l.buildDGVCtx(e);break;case"treelistview":t=l.buildTreeLstCtx(e);break;case"graphview":t=l.buildGraphCtx(e);break;case"tilesthumbview":t=l.buildOtherViewCtx(e);break;default:t=Promise.resolve([])}return t},l.buildDGVCtx=function(t){return new Promise(function(o){var n=[],s=t.params.cellInfos,r=t.context,a=t.params;if(s){var d=t.params.collectionView.getColumnOrGroup(s.columnID);if(-1===s.rowID){var c={pin:!0,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1,view:"datagridview"};if("tree"===d.dataIndex&&(c.pin=!1),n=t.params.collectionView.buildDefaultContextualMenu(t.params,c),d.customisation&&d.customisation.layout&&!1===d.customisation.layout.removableFromView||n.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},title:e.PAD_CMDColumnHide,action:{context:{collectionView:t.params.collectionView,dataIndex:d.dataIndex},callback:function(e){e.context.collectionView.layout.setColumnVisibleFlag(e.context.dataIndex,!1,{isUserInteraction:!1})}}}),!0===i.getSetting("activateGroupByCtx")){var p=[],u=t.params.collectionView.layout.getVisibleOrderedColumnsIndexes();p.push({type:"PushItem",title:"None",action:{context:{dataIndex:"none",collectionView:t.params.collectionView},callback:function(e){e.context.collectionView.groupRows({dataIndexesToGroup:[]})}}});for(var h=0;h<u.length;h++){var g=t.params.collectionView.layout.getDataIndexFromColumnIndex(u[h]),f=t.params.collectionView.layout.getColumnOptionValue(g,"text");f&&p.push({type:"PushItem",title:f,action:{context:{dataIndex:g,collectionView:t.params.collectionView},callback:function(e){e.context.collectionView.groupRows({dataIndexesToGroup:[e.context.dataIndex]})}}})}n.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-group-add"},title:e.PAD_CMDColumnGroupby,submenu:p})}n.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-cog"},title:e.PAD_CMDColumnCusto,action:{context:t.context,callback:function(e){l.launchCommand({context:e.context,command:"ColumnVisibility"})}}}),l.addAdditionalColumnsCtx({context:r,menu:n,node:v,cellInfos:s,params:t.params,view:"datagridview"}).then(function(e){o(e.menu)})}else{var v=s.nodeModel;if(v)if(!1===v.isSelected()&&v.select(!0),!0===v.isRelationsObjectNode)!0===v.isRelationsObjectGroupingNode?o(null):l.addNONPSCtx({context:r,menu:n,node:v}).then(function(e){o(e.menu)});else{var m={available:!1};"positionMatrix-Instance"===d.dataIndex&&UWA.is(l.psePositionCtxCmd,"function")&&(m=l.psePositionCtxCmd(r,a)),!0===m.available?(n=m.menu,o(n)):l.addOpenWithMenu({context:r,menu:n,node:v,cellInfos:s,params:t.params,view:"datagridview"}).then(l.addTreeMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){o(e.menu)})}else o(n)}}else o(n)})},l.buildTreeLstCtx=function(t){return new Promise(function(o){var i=[],s=t.context,r=t.params,a=t.params.treeview;if(a.isHeader){var d=a.manager,c=a.dataIndex,p=a.manager._instance._parentObject.thumbnail_size,u={type:"PushItem",icon:"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_FitToColumn.png")+")",title:e.PAD_CMDColumnToFit,action:{context:c,callback:function(e){"thumbnail"===e.context?function(e,t,o){for(var n=e.getColumnIDFromDataIndex(t),i=e.getContent().querySelectorAll('.wux-datagrid-cell[virtual-column-id="'+n+'"]'),s=0,r=0;r<i.length;r++){var a=i[r].clientWidth;a>s&&(s=a)}if(s>o){var l=function(){e.prepareUpdateView(),e.setColumnWidth(n,o),e.pushUpdateView()};e.onPostUpdateViewOnce(l),l()}}(d,e.context,p):d.sizeColumnToFit(e.context)}}};i.push(u),l.addAdditionalColumnsCtx({context:s,menu:i,params:t.params,view:"treelistview"}).then(function(e){o(e.menu)})}else{var h=a.cellView?a.cellView.getCellInfos():null,g=a.nodeModel?a.nodeModel:a.cellModel;if(g){!1===g.isSelected()&&g.select(!0);var f={available:!1};h&&"positionMatrix-Instance"===h.dataIndex&&UWA.is(l.psePositionCtxCmd,"function")&&(f=l.psePositionCtxCmd(s,r)),!0===f.available?(i=f.menu,o(i)):l.addOpenWithMenu({context:s,menu:i,node:g,cellInfos:h,params:t.params,view:"treelistview"}).then(l.addTreeMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){o(e.menu)})}else o(i)}})},l.buildGraphCtx=function(e){return new Promise(function(t){var o=[],n=e.context,i=e.params.graphview.node;i?(!1===i.isSelected()&&i.select(!0),!0===i.isRelationsObjectNode?!0===i.isRelationsObjectGroupingNode?t(null):l.addNONPSCtx({context:n,menu:o,node:i}).then(function(e){t(e.menu)}):l.addOpenWithMenu({context:n,menu:o,node:i,params:e.params}).then(l.addGraphMenu).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){t(e.menu)})):t(o)})},l.buildOtherViewCtx=function(e){return new Promise(function(t){var o=[],n=e.context,i=e.params.cellInfos?e.params.cellInfos.nodeModel?e.params.cellInfos.nodeModel:e.params.cellInfos.cellModel:null;i?(!1===i.isSelected()&&i.select(!0),!0===i.isRelationsObjectNode?!0===i.isRelationsObjectGroupingNode?t(null):l.addNONPSCtx({context:n,menu:o,node:i}).then(function(e){t(e.menu)}):l.addOpenWithMenu({context:n,menu:o,node:i,params:e.params}).then(l.addCommonMenu).then(l.addAdditionalColumnsCtx).then(function(e){t(e.menu)})):t(o)})},l.addOpenWithMenu=function(t){return new Promise(function(o){var n=t.context.getPADTreeDocument().getSelectedNodes();n.length>0&&r.openWithApps(n,{iconOpenWith:{iconName:"open",fontIconFamily:1},nlsOpenWith:e.OpenWith}).then(function(e){t.menu=t.menu.concat(e),o(t)})})},l.addTreeMenu=function(e){return new Promise(function(t){UWA.is(l.pseTreeMenu,"function")&&l.pseTreeMenu(e.context,e.menu,e.node,e.cellInfos,e.view),t(e)})},l.addGraphMenu=function(t){return new Promise(function(o){var i=t.context,s=i.getPADTreeDocument().getSelectedNodes(),r=function(e,t){for(var o=t.length,n=0,i=0,s=0;s<o;s++){var r=t[s];e.getThumbnailState(r)===a.ThumbnailState.EXPANDED?n++:i++}return n>i}(i.options.views.graphview,s);t.menu.push({icon:r?"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_Collapse-thumbnail.png")+")":"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_Expand-thumbnail.png")+")",title:r?e.PAD_CMDCollapseThumb:e.PAD_CMDExpandThumb,type:"PushItem",action:{this:i,context:{nodes:s,expanded:r},callback:function(e){this.options.views.graphview.setGroupThumbnailState(e.context)}}}),o(t)})},l.addCommonMenu=function(r){return new Promise(function(a){var d=r.menu,c=r.context,p=r.node,u=o.getCommand("OpenInCADHdr",c.options.action_bar_opts&&c.options.action_bar_opts.context?c.options.action_bar_opts.context:null);u&&u.isAvailable()&&(d.push({title:t.PAD_CMDOpenInCAD,icon:"url("+n.getWebappsAssetUrl("PADUtils","icons/32/I_OpenInCAD.png")+")",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"OpenInCADHdr"})}}}),d.push({type:"SeparatorItem"}));var h=!!p.options.isPADHidden,g=!0,f=!0,v=c.options.model.getSelectedNodes();if(v.length>1)for(var m=v[0].options.isPADHidden,b=0;b<v.length;b++)m!==v[b].options.isPADHidden&&(g=!1),v[b].isRoot()||(f=!1);else p.isRoot()||(f=!1);if(!s.isWebInWinContext()){var _={type:"PushItem",icon:"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_SsmCtxHideShow.png")+")",title:e.PAD_CMDShow,action:{callback:function(e){var t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(p.getOccurencePath()),c._commandProxy.show({paths:t})}}},D={type:"PushItem",icon:"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_HideShow.png")+")",title:e.PAD_CMDHide,action:{callback:function(e){var t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(p.getOccurencePath()),c._commandProxy.hide({paths:t})}}};!0===g?h?d.push(_):d.push(D):(d.push(_),d.push(D)),!0===i.getSetting("FocusCtxCommandAvailable")&&d.push({type:"PushItem",title:e.PAD_CMDFocusOn,icon:"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_FocusOn.png")+")",action:{callback:function(){var e=require("DS/PADUtils/PADUtilsServices"),t=[];v.length>1?v.forEach(function(e){t.push(e.getOccurencePath())}):t.push(p.getOccurencePath()),c._commandProxy.focus({intent:"focus",paths:t,widget:"2D",sharedID:e.getSharedId(),appID:e.getAppId()})}}}),d.push({type:"SeparatorItem"})}if(1===v.length){var S=c.render(),x=r.params.infos?r.params.infos.position:r.params.info?r.params.info.position:{x:0,y:0};d.push({type:"PushItem",title:e.PAD_CMDFindInCtx,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search-filter",family:WUXManagedFontIcons.Font3DS},action:{context:{position:x,renderTo:S,node:p},callback:function(e){require(["DS/ENXNav/utils/FindInCtx"],function(t){t.launchFindWithDialog(e.context)})}}})}"noExpandState"!==p._expandState&&(d.push({title:e.PAD_CMDExpandAll,icon:"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",state:!0===p._expandAllPending?"disabled":"enabled",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"ExpandAll"})}}}),d.push({title:e.PAD_CMDCollapseAll,icon:"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",type:"PushItem",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"CollapseAll"})}}})),d.push({title:e.PAD_CMDProperties,icon:"url("+n.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",state:c.getEditMode?c.getEditMode()?"enabled":"disabled":"enabled",action:{context:c,callback:function(e){l.launchCommand({context:e.context,command:"ActionBar_Attributes"})}}}),UWA.is(l.ccpMenu,"function")&&l.ccpMenu(c,d,p),f&&(d.push({type:"SeparatorItem"}),!0!==i.getSetting("removeDetachRoot")&&d.push({title:e.detachRoot,icon:"url("+n.getWebappsAssetUrl("ENXNav","icons/32/I_HideShow.png")+")",type:"PushItem",action:{callback:function(){for(var e=c.options.model.getSelectedNodes(),t=0;t<e.length;t++)c.toggleRoot(e[t])}}}),d.push({type:"PushItem",title:e.removeRoot,icon:{iconName:"open wux-ui-3ds-flip-vertical",fontIconFamily:1},action:{callback:function(e){for(var t=c.options.model.getSelectedNodes(),o=0;o<t.length;o++)c.options.model.removeRoot(t[o])}}})),a(r)})},l.addAdditionalColumnsCtx=function(e){return new Promise(function(t){var o=e.context;if(o.options.additionalColumnsModules&&o.options.additionalColumnsModules.length){for(var n=[],i=[],s=[],r=0;r<o.options.additionalColumnsModules.length;r++)if(o.options.additionalColumnsModules[r].getAdditionalCtxMenu){var a=new Promise(function(t){o.options.additionalColumnsModules[r].getAdditionalCtxMenu({treeDocument:o.getPADTreeDocument(),ctxParams:e.params,view:e.view,callback:function(e,o){e&&-1===s.indexOf(e)&&(s.push(e),UWA.is(o,"object")&&(i.push({type:"SeparatorItem"}),i.push(o))),t()}})});n.push(a)}Promise.all(n).then(function(){e.menu=e.menu.concat(i),t(e)})}else t(e)})},l.addNONPSCtx=function(t){return new Promise(function(o){var i=t.context;t.menu=[{title:e.PAD_CMDProperties,icon:"url("+n.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",state:i.getEditMode?i.getEditMode()?"enabled":"disabled":"enabled",action:{context:i,callback:function(e){l.launchCommand({context:e.context,command:"ActionBar_Attributes"})}}}],o(t)})},l.launchCommand=function(e){var t=o.getCommand(e.command,e.context.action_bar_opts&&e.context.action_bar_opts.context?e.context.action_bar_opts.context:null);t&&t.begin()},l}),define("DS/ENXNav/views/ViewLoader",["UWA/Class","UWA/Promise","DS/ENXNav/utils/CtxMenuUtils"],function(e,t,o){"use strict";var n={treelistview:"treelistview",graphview:"graphview",tileview:"tileview",thumbnailview:"thumbnailview",datagridview:"datagridview"};Object.freeze(n);var i=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],s=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],r=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],a=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],l=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDragStartRowHeader","onDragEndRowHeader","onDragEnterRowHeader","onDragLeaveRowHeader","onDragRowHeader","onDragOverRowHeader","onDropRowHeader","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return e.extend({init:function(e){this.options=e},loadView:function(e,t){var o=this;this.options.component.options.views[e]?t():this.buildOptions(e,t).then(function(n){o.requireView(e,n,t)})},requireView:function(e,t,o){var i=this,s=this.options.amd[e],r=function(){i.postLoad(e),e!==n.treelistview&&o&&o()};require([s],function(o){var s=i.options.component;s.options.views[e]=new o(t),e===n.datagridview?s.options.views[e].initialize().then(function(){r()}):r()})},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case n.graphview:var o=!1;t.options.views.graphview.isActiveView&&(o=!0,t.options.views.graphview.setModel(t.options.model)),t.setDnD_onGraph(),!0===t.options.layout.keyboard_inputs&&t.setKeyboardListenerOnGraph&&t.setKeyboardListenerOnGraph(),t.options.isReady.graphview=!0,o&&t.options.views.graphview.reframeAll();break;case n.treelistview:break;case n.thumbnailview:t.options.views.thumbnailview.isActiveView&&t.options.views.thumbnailview.setModel(t.options.model),t.options.isReady.thumbnailview=!0;break;case n.datagridview:t.options.views.datagridview.isActiveView&&(t.options.views.datagridview.setModel(t.options.model),t.options.views.datagridview.options.dgv.onDragStartRowHeader=function(e,o){t.onDragStartRowHeader(e,o)},t.options.views.datagridview.options.dgv.onDropRowHeader=function(e,o){t.onDropRowHeader(e,o)}),t.options.isReady.datagridview=!0;break;case n.tileview:t.options.views.tileview.isActiveView&&t.options.views.tileview.setModel(t.options.model),t.options.isReady.tileview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e,t){switch(e){case n.treelistview:return this._buildTreeListViewOptions(t);case n.graphview:return this._buildGraphViewOptions();case n.tileview:return this._buildTileViewOptions();case n.thumbnailview:return this._buildThumbnailViewOptions();case n.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(e,t){var o=t,n={};return e.forEach(function(e){UWA.is(o.options.views_cb[e],"function")?n[e]=o.options.views_cb[e]:UWA.is(o[e],"function")&&(n[e]=o[e].bind(o))}),n},_buildTreeListViewOptions:function(e){var s=this;return new t(function(t,r){var a=s.options.component,l={x3dAppId:s.options.x3dAppId,renderTo:s.options.renderTo};l.active_view=UWA.clone(a.options.active_view),l.isActiveView=l.active_view===n.treelistview,l.view_customization=a.options.layout.view_customization,l.specific_columns=a.options.layout.specific_columns;var d=s.mapCallbacks(i,a);l=UWA.extend(l,d,!0),UWA.is(a.getOnContextualEvent)?l.onContextualEvent=a.getOnContextualEvent():l.onContextualEvent={this:a,callback:function(e){return o.buildMenu({view:"treelistview",context:this,params:e})}},l.events={onComplete:function(){a.options.views.treelistview=this,"treelistview"===a.options.active_view&&a.options.views.treelistview.setModel(a.options.model),a.options.isReady.treelistview=!0,e&&e()},onCustoViewChange:function(e){a.dispatchEvent("onCustoViewChange",e)},onTenantChange:function(e){a.dispatchEvent("onTenantChange",e)},onSaveAsTemplate:function(e){a.dispatchEvent("onSaveAsTemplate",e)}},a.options.additionalColumnsModules&&(l.additionalColumnsModules=a.options.additionalColumnsModules),t(l)})},_buildGraphViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="graphview"===i.active_view;var r=e.mapCallbacks(s,n);i=UWA.extend(i,r,!0),UWA.is(n.getOnContextualEvent)?i.onContextualEvent=n.getOnContextualEvent():i.onContextualEvent={this:n,callback:function(t){return e._onContextualMenuEvent({view:"graphview",context:this,params:t})}},t(i)})},_buildTileViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="tileview"===i.active_view;var s=e.mapCallbacks(r,n);i=UWA.extend(i,s,!0),UWA.is(n.getOnContextualEvent)?i.onContextualEvent=n.getOnContextualEvent():i.onContextualEvent={this:n,callback:function(t){return e._onContextualMenuEvent({view:"tilesthumbview",context:this,params:t})}},t(i)})},_buildThumbnailViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="thumbnailview"===i.active_view;var s=e.mapCallbacks(a,n);i=UWA.extend(i,s,!0),UWA.is(n.getOnContextualEvent)?i.onContextualEvent=n.getOnContextualEvent():i.onContextualEvent={this:n,callback:function(t){return e._onContextualMenuEvent({view:"tilesthumbview",context:this,params:t})}},t(i)})},_builddatagridViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,context:n};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="datagridview"===i.active_view,i.view_customization=n.options.layout.view_customization,i.callbacks=e.mapCallbacks(l,n),n.options.additionalColumnsModules&&(i.additionalColumnsModules=n.options.additionalColumnsModules),i.onTenantChange=function(e){n.dispatchEvent("onTenantChange",e)},t(i)})},_onContextualMenuEvent:function(e){return new t(function(n){var i=o,s=t.resolve();e.context.isDynamicCtx()&&(s=new t(function(e){require(["DS/ENXNav/utils/CtxMenuUtilsV2"],function(t){i=t,e()})})),s.then(function(){i.buildMenu({view:e.view,context:e.context,params:e.params}).then(n)})})}})}),define("DS/ENXNav/features/xNavPersistPanel",["DS/ENXNav/utils/LocalStorageForAppState","DS/ENXNav/utils/TwoDAppEvents","DS/ApplicationFrame/CommandsManager"],function(e,t,o){function n(){t.onLandingPageClosed(this._restoreSidePanelsOriginalState.bind(this))}return n.prototype={setup:function(e){e&&(this.triptych=e,this._sidePanelState={left:{},right:{}},this.triptych._modelEvents.subscribe({event:"triptych-resized"},this._onPanelResized.bind(this)),this.triptych._modelEvents.subscribe({event:"triptych-panel-hidden"},this._onPanelHidden.bind(this)),this.triptych._modelEvents.subscribe({event:"triptych-panel-visible"},this._onPanelVisible.bind(this)))},_onPanelResized:function(t){this._sidePanelState[t.side].width=t.width,e.set("sidePanelState",this._sidePanelState)},_onPanelVisible:function(t){this._sidePanelState[t].isOpen=!0,e.set("sidePanelState",this._sidePanelState)},_onPanelHidden:function(t){this._sidePanelState[t].isOpen=!1,e.set("sidePanelState",this._sidePanelState)},_restoreSidePanelsOriginalState:function(){var t=o.getCommandCheckHeader("RootPanel"),n=o.getCommandCheckHeader("RightSidePanel"),i=e.get("sidePanelState");i&&(t&&i.left.isOpen&&!this.triptych._isLeftOpen&&(t.toggleState(),i.left.width&&this.triptych._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:i.left.width}})),n&&i.right.isOpen&&!this.triptych._isRightOpen&&(n.toggleState(),i.right.width&&this.triptych._modelEvents.publish({event:"triptych-set-size",data:{side:"right",size:i.right.width}})))}},Object.defineProperties(n.prototype,{name:{get:function(){return"persistPanels"}}}),n}),define("DS/ENXNav/features/xNavPersistFilterSpec",["DS/PADUtils/PADUtilsServices","DS/ENXNav/utils/TwoDAppEvents"],function(e,t){function o(e){this.context=e.context,this.filterSpec=new Map,this.filterSpecDE=new Map,this.validFilterId=[],this.validFilterIdCopy=[],this.unresolvedSpec=[]}return o.prototype={addEventForEachFilter:function(e){var t=this;for(let o=0;o<e.length;o++)setTimeout(function(){t.context._biFilter.removeEvent("getFilterSpec-"+e[o]),t.context._biFilter.addEvent("getFilterSpec-"+e[o],t.processPublicationFilterSpec.bind(t,e[o])),o===e.length-1&&t.retrieveFilterSpecFromBIFilter(e)},100)},retrieveFilterSpecFromBIFilter:function(t){var o=this;for(let n=0;n<t.length;n++)setTimeout(function(){let i={rootId:t[n],NGFUXId:o.context.getNGFUXID(!0),widgetId:e.getWidgetId(),eventName:"getFilterSpec-"+t[n]};o.context._biFilter.hasEvent("getFilterSpec-"+t[n])&&o.context._biFilter.getPublicFilterSpecification(i)},200)},processPublicationFilterSpec:function(e,t){1===t.status&&t.publicSpec?(this.context.xNavPersistFilterSpec.filterSpec.set(e,t.publicSpec),this.context.shouldAddSpecForDE&&(this.context.xNavPersistFilterSpec.filterSpecDE.set(e,t.publicSpec),this.context.shouldAddSpecForDE=!1)):0===t.status&&null!==t.error&&console.warn(t.error.title,t.error.message)}},Object.defineProperties(o.prototype,{name:{get:function(){return"persistFilterSpec"}}}),o}),define("DS/ENXNav/XNavComponent",["css!DS/ENXNav/ENXNav","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/UIKIT/Mask","DS/Utilities/Utils","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","DS/PADUtils/views/PADFilterCancel","DS/ENXNav/mixins/_xNavDnD","DS/ENXNav/mixins/xNavLeftSidePanel","DS/ENXNav/mixins/_xNavBIFilter","DS/ENXNav/mixins/_xNavRefresh","DS/ENXNav/mixins/xNavChangeActionV2","DS/ENXNav/mixins/EventHooks","DS/ENXNav/mixins/xNavWidgetLink","DS/ENXNav/utils/FindInCtx","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/views/PADAlert","DS/PADUtils/PADPromise","DS/PADUtils/PADSession","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADPredicatesNls","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/Storage","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/ENXNav/features/xNavPersistPanel","DS/ENXNav/features/xNavPersistFilterSpec","DS/ENOXInterWdgCom/LinkManager","DS/ENOXTriptych/js/ENOXTriptych","DS/PADUtils/PADWSAccess","DS/PADServices/utils/PConfigUtils"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f,v,m,b,_,D,S,x,y,N,C,P,w,A,I,E,O,M,F,R,T,k){"use strict";function U(e,t){var o=this;require(["DS/ENXNav/views/ViewLoader"],function(n){var i={component:o,x3dAppId:o.options.x3dAppId,renderTo:e.renderTo,amd:{treelistview:o.options.amd_custo.TreeListView,graphview:o.options.amd_custo.TreeGraph,tileview:o.options.amd_custo.TileGridView,thumbnailview:o.options.amd_custo.ThumbnailGridView,datagridview:o.options.amd_custo.DataGridView}};o.loader=new n(i),o.loader.loadView(o.options.active_view,function(){"graphview"===o.options.active_view&&o.options.views.graphview.reframeOn(),t()})})}function B(e,t){e.push(t.map(function(e){return e.resourceid}))}function V(e){var t=this,o=require("DS/PADServices/ws/WSAccess"),n={data:{rootPhID:e.getID()},maxLeaves:C.getSetting("maxNumberOfLeaves"),is2D:!0,filterBI:t._biFilter};o.getRootStats(n).then(function(o){try{var n,i="string"==typeof o?JSON.parse(o):o,s={};if(i.results)for(var r=0;r<i.results.length;r++)if(i.results[r].resourceid)n=i.results[r].resourceid;else if(i.results[r].synthesis){var a=i.results[r].synthesis.name;switch(i.results[r].synthesis.name){case"ProgressiveExpand_FlatSynthesis":a="flatSynthesis";break;case"ProgressiveExpand_OccSynthesis":a="occSynthesis";break;case"ProgressiveExpand_LeafSynthesis":a="leafSynthesis"}s[a]=i.results[r].synthesis.value}var l=E.getPADTracker({eventCategory:"usage",eventAction:"synthesis"});if(l){let t=e.getLabel();l.addMultivaluedEventData("synthesis",{flatSynthesis:s.flatSynthesis,occSynthesis:s.occSynthesis,leafSynthesis:s.leafSynthesis,withFilter:!0===e.options.filtered||void 0},{labelKey:t,txKey:e.getID(),filtered:!0===e.options.filtered?"filtered":"noFilter"}),l.trackPageEvent()}else console.warn("tracker not defined");var d=t.options.model.getNodesById(n);1===d.length&&d[0].isRoot()&&d[0].setSynthesis(s)}catch(e){}}).catch(function(e){console.error(e)})}function L(e){if(C.getSetting("activateExcludeOccurrences")&&e&&!0!==e.getTreeDocument().isOccModel){const t={serviceId:"3DSpace",data:{select_bo:["physicalid"],select_rel:["physicalid"],root_path_physicalid:[[e.getID()]],rootPhID:e.getID()},FBIProxy:this._biFilter,intent:"explore_2D",onComplete:function(t){try{if(t&&!t.contains("error")){let o=JSON.parse(t),n=[];for(let e=0;e<o.results.length;++e)if(n.push(o.results[e].Path),o.results[e].matching_lengths)for(let t=0;t<o.results[e].matching_lengths.length;++t)n.push(o.results[e].Path.slice(0,o.results[e].matching_lengths[t]));e.setExcludedOccurrences(n),e.cleanUpPathes()}else console.error("Error while getting excluded occurrences")}catch(e){console.error(e)}},onCancel:void 0,onFailure:function(e){console.log("getExcludedOcc##Failure")},onTimeout:function(){console.log("getExcludedOcc##Timeout")}};T.getStaticMappingExcludedOccurrences(t)}}return i.extend(s,r,u,g,f,v,h,m,b,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,active_view:"datagridview",action_bar_opts:null,configuration:{toolbarActivated:!1,dynamicCtxActivated:!1},layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,statusInfo:!0,drop_invite:"dynamic",dndEvo:!1,keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},amdTreeView:"datagridview"},amd_custo:{TreeDocument:"DS/ENXNav/models/xNavDocument",TreeListView:"DS/ENXNav/views/xNavTreeListView",TreeGraph:"DS/ENXNav/views/xNavGraphView",TileGridView:"DS/ENXNav/views/xNavResponsiveTilesView",ThumbnailGridView:"DS/ENXNav/views/xNavResponsiveThumbnailsView",DataGridView:"DS/ENXNav/views/xNavDataGridView"},views:{treelistview:null,graphview:null,tileview:null,thumbnailview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1,tileview:!1,thumbnailview:!1}},_probes:{},_displayOnceReadOnlyNotif:!0,init:function(e){this._parent(e),this.options=n.extend(this.options,e,!0),this.options.layout.dndEvo="true"===w.getURLParameter("dndDivEvo"),document.body.setStyle("overflow","hidden"),this.elements.container=n.createElement("div",{class:"xnav_component"}),this.options.flags={},!0===C.getSetting("activateSynthesisOnRoot")&&C.setSetting("maxPathCount",void 0);var t=this;require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADProbes","DS/PADUtils/PADWebInWinServices"],function(e,i,s,r){t._probes.probe_init=s.createProbe("init_xnavcomponent"),t.options.loadGraphSection=C.getSetting("loadGraphSection"),r.initialize({widget:widget}),widget&&widget.lang&&C.setSetting("lang",widget.lang),e.app_initialization(function(r){r&&!0===r.success?function(){t._commandProxy=i.create({events:{onDrop:function(o,n){e.updatePlatformId(o.tenant);var i=!0!==o.already_added_in_PS;n.originWidgetId&&(i=!0!==o.already_added_in_PS||n.originWidgetId!==e.getWidgetId()&&!0===C.getSetting("activateFUN076708")),o.paths||o.pids||o.filters||(i=!1),i&&t.add({content:void 0===o.paths?"idslist":"pathslist",paths:void 0===o.paths?void 0:o.paths,pids:void 0===o.pids?void 0:o.pids,filters:o.filters,loadWithFilter:o.loadWithFilter,callback:null,broadcast:!1})},onDropFilter3D:function(e,o){t.addFilter({content:"3DXContent",filter_objects:e.droppedFilters,broadcast:void 0===e.broadcast||e.broadcast,callback:void 0,behavior:"fromDrop",fromProxy:!0})},onRemove:function(e){F.isWidgetSynchronizing()||t._onRemoveRoot(e)},onCleanAll:function(){t.empty(!1)},onFilterCancel:function(e){"3D"===e.widget&&t.confirmModal.cancelModal&&(t.confirmModal.cancelModal.fromProxy=!0,t.confirmModal.cancelModal.modals.current.destroy())},onRefreshModel:function(){n.is(t.refresh,"function")&&t.refresh(!1)},onApplyFilter:function(e){e.doNotBroacast=!0,t.applyFilter(e)},onSlaveBIToggle:function(e){t._biSlave3D=e.isSlave},onSearchInApp:t.onSearch.bind(t)}}),t.setupEventHooks(),!0===C.getSetting("activateWidgetLink")&&"undefined"!=typeof widget&&t.setupWidgetLink(),t._probes.probe_model=s.createProbe("init_xnav_model"),function(e){var t=this,o={},i=x.getPromises(),s=i.slice(),r=new Promise(function(i){Promise.all(s).then(function(){require([t.options.amd_custo.TreeDocument],function(s){if((o=function(e){var t=this,o={};return e.forEach(function(e){n.is(t.options.views_cb[e],"function")?o[e]=t.options.views_cb[e]:n.is(t[e],"function")&&(o[e]=t[e].bind(t))}),o}.call(t,["doDnDDragStart","shouldAcceptDnDDrop","doDnDDrop"])).authorize_setStructure=t.options.authorize_setStructure,o.insert_replace=t.options.insert_replace,o.renderTo=t.options.renderTo,o.insert_replace=t.options.insert_replace,t.options.additionalColumnsModules){o.additionalColumnsModules=t.options.additionalColumnsModules;for(var r=require("DS/PADServices/utils/AttributesMgtV2"),a=0;a<t.options.additionalColumnsModules.length;a++)r.addAsyncAttributes(t.options.additionalColumnsModules[a].getManagedColumnNames())}o.context=t,t.options.model=new s(o),t.options.model.getModelEvents().subscribe({event:"titleRecalc"},function(e){var o=t.getWidgetTitle();t.options.widget.setTitle(o)});var d=[];let c=!1;var p=l.debounce(function(){c||t._commandProxy.remove({pids:d});var e=t.options.model,o=e.getRoots().length;t.dropInvitContainer&&(o||t.dropInvitContainer.show("drop")),0===o&&t.options.views.datagridview&&t.options.views.datagridview.removeSort(),t._onRemoveRoot({pids:d,fromWLSync:c}),e&&e._pagerview&&(e._pagerview.hide(),e._pagerview=null),d=[];var n=t.getWidgetTitle();t.options.widget.setTitle(n)},250);t.options.model.getModelEvents().subscribe({event:"onRemoveRoot"},function(e){c=F.isWidgetSynchronizing(),t.dropInvitContainer&&(e.data.remainingRoots||t.dropInvitContainer.show()),d.push(e.data.pid),p()}),t.options.model.getModelEvents().subscribe({event:"onCenterGraph"},function(e){let o=t.options.model,n=!1;"2.0"===o.version&&(o._parseLoadModel=!0,n=!0),t.options.views.datagridview.options.dgv.ensureNodeModelVisible(e.data,!1,!0,.2),n&&(o._parseLoadModel=!1),t.options.views.graphview&&t.options.views.graphview.reframeOn()}),t.options.model.getModelEvents().subscribe({event:"onRootAdded"},function(e){t.dropInvitContainer&&(0!==e.data.nb_root?t.dropInvitContainer.hide():t.dropInvitContainer.show("drop"));var o=!1;if(0===e.data.nb_root&&(o=!0),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:o}),n.is(widget)&&!0===t.getOption("layout").title_update){var i=t.getWidgetTitle();if(t.options.widget.setTitle(i),i){var s={TitleInfo:i};F.isWidgetSynchronizing()||t._commandProxy.padRefresh(s)}}let r=e.data;if(r.isremove=!1,I.publish({event:"ENXModel/Root/manage",data:r}),t.getOption("layout").store_roots_in_pref&&t.dispatchEvent("onSaveRoots"),e.data.added_node&&!1===t.options.layout.withWelcomePanel){var a=e.data.added_node.getID();t.dispatchEvent("onAddPaths",{addedPaths:[[a]]})}var l=e.data.added_node,d=void 0;l&&(d=l.isRoot()?l:l.getRoot()),!0===C.getSetting("activateSynthesisOnRoot")&&0!==e.data.nb_root&&!1===y.isAuthoring()&&!0!==e.data.isremove&&d&&(!0===d.options.waiting4validation&&!0!==d.options.parseV2||!1!==d.hasSynthesis()||V.call(t,d)),!0!==t._wait4Filter&&L.call(t,d),I.publish({event:"ENXModel/NodeModelUpdate"})}),t.options.model.addEventListener("beginBlockingTransaction",function(e){t.beginBlockingTransaction(e.data)}),t.options.model.addEventListener("endBlockingTransaction",function(){t.endBlockingTransaction()}),t.initializeBI(),document.addEventListener("keyup",function(e){27===e.keyCode&&(t.options.model.originalSelection?(delete t.options.model.originalSelection,t.options.model._pagerview&&(t.options.model._pagerview.hide(),t.options.model._pagerview=null)):(t.options.model.unselectAll(),t.uncut&&t.uncut.call(t)))}),document.addEventListener("keypress",function(e){if(!0===t.options.layout.keyboard_inputs){var o=t.options.model;require(["UWA/Event"],function(t){var n=t.whichKey(e);"ctrl+a"===n&&o.withBroadcastSelect(function(){o.selectAll()})})}}),t.options.isReady.model=!0,t._probes.probe_model.end(),e&&e(),i()})})});r.name="build",i.push(r)}.call(t),t._probes.probe_view=s.createProbe("init_xnav_views"),function(){var e=this,t=new n.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});t.inject(this.options.widget.body);var o=require("DS/Windows/ImmersiveFrame"),i=require("DS/WebUAUtils/WebUAUtils"),s=new o;s.inject(t),this.options.widget.immersiveFrame=s,i.setPanelHelpMode({immersiveFrame:s}),this.options.widget.body.container=n.createElement("div",{}).inject(s.getFreeZone(),"top");var r=n.createElement("div",{class:"xnav_viewmain"}),a=(n.createElement("div",{class:"xnavToolbar"}).inject(r),n.createElement("div",{class:"xnavContent"}).inject(r));let l=Promise.resolve(),d=this.elements.container;var c=x.getPromises(),p=c.slice();p.push(l);var u=new Promise(function(t,o){Promise.all(p).then(function(o){var i=[],s=new Promise(function(t,o){if(e.options.action_bar_opts){var n=require("DS/PADUtils/PADProbes");e._probes.probe_actionbar=n.createProbe("init_xnav_actionbar"),require(["DS/ENXNav/commands/_xNavActionBar"],function(o){try{e.elements.actionbar=new o({xnav_app:e,action_bar:e.options.action_bar_opts,renderTo:d,callback:{onactionbarcb:function(o){e.options.isReady.actionbar=!0,!0===e.options.isReady.actionbar&&e._probes.probe_actionbar&&e._probes.probe_actionbar.end(),"onActionBarReady"===o&&("graphview"===e.options.active_view&&!0===e.options.loadGraphSection&&(e.elements.actionbar.mergeGraphSection(),e.options.graphABLoaded=!0),e.postActionBar()),!0===e.options.configuration.dynamicCtxActivated?require(["DS/ENXNav/utils/xNavCmdsMap"],function(o){e.options.cmdsMap=new o({context:e,toolbarActivated:!1,cmdsDefinition:e.options.configuration.commands}),e.options.cmdsMap.initialize({}).then(t).catch(function(e){console.error("xNavComponent: Cannot initialize command Map"),console.error(e)})}):t()}}})}catch(o){console.error("XNavComponent:: Cannot initialize ActionBar"),e.options.isReady.actionbar=!0,t()}})}else e.options.isReady.actionbar=!0,t()});s.name="action bar",i.push(s);var l=d;if(!0!==e.options.layout.dndEvo&&require(["DS/PADUtils/views/PADDnDInvite"],function(t){e.dropInvitContainer=new t({renderTo:d,mode:e.options.layout.drop_invite,dropOnInvite:n.is(e.dropOnInvite,"function")?e.dropOnInvite.bind(e):void 0})}),!0===e.options.layout.statusInfo){var c=new Promise(function(t){require(["DS/PADUtils/views/PADStatusInfos"],function(o){e.elements.padstatus=new o({withProgress:!0,events:{onShow:function(){var t=require("DS/PADUtils/PADUtilsServices");e.elements.padstatus.setStatus(o.buildStatus({Tenant:t.getPlatformId(),tree_content:{nbObjectsInTree:e.options.model.getAllDescendants().length,nbObjectsSelected:e.options.model.getSelectedNodes().length}}))}}}),t()})});c.name="status Infos",i.push(c)}var p=new Promise(function(t,o){if(!0===e.options.layout.padshell){var i,s=n.clone(e.options.layout.triptychOpts);s.container=d,i=n.createElement("div",{class:"xnav_viewright rightSidePanel"}),e.elements.padshell=new R,e.elements.padshell.init(s,e.createRootListSlidder2(),r,i),C.getSetting("persistSidePanel")&&(e._xNavPersistPanel=new O,e._xNavPersistPanel.setup(e.elements.padshell)),e.xNavPersistFilterSpec=new M({context:e}),e.elements.padshell.togglePanel=function(t){"left"===t?e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"})},e.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},function(e){I.publish({event:"ENXViews/Triptych/onOverlayClick",data:e})}),e.elements.padshell.openPanel=function(t){e.elements.padshell._modelEvents.publish({event:"triptych-show-panel",data:t})},I.publish({event:"on2DTriptychReady"}),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),U.call(e,{renderTo:a},t)}else U.call(e,{renderTo:d},t)});if(p.name="slidder",i.push(p),!0===e.options.authorizeChangeControl){var u=new Promise(function(t,o){Promise.all(i).then(function(o){require(["require","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy"],function(o,n,i){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(o){var s;s=e.elements.padshell?e.elements.padshell.getMainPanelContainer():e.elements.container.querySelector(".xnav_body"),o.initialize2(s,i.appId(),"hide",C.getSetting("changeControlPosition"),function(t){e.dispatchEvent("onAuthoringCtxAvailable",t)}),n.authoringCtxAvailable(),t()},function(e){t()})})})});u.name="promiseAuthorizeChnage",i.push(u)}var h=new Promise(function(o,n){Promise.all(i).then(function(n){!0===e.options.isReady[e.options.active_view]&&e._probes.probe_view.end(),e.elements.padstatus&&(!0===e.options.layout.padshell?e.elements.padstatus.inject(e.elements.padshell.getMainPanelContainer()):e.elements.padstatus.inject(l)),require(["DS/ApplicationFrame/CommandsManager"],function(t){var o="datagridview"===e.options.active_view||"treelistview"===e.options.active_view?"treeview":e.options.active_view,n=t.getCommand(o);n?n.begin():console.warn("Command ["+o+"] not found")}),t(),o()})});h.name="promiseResolve",i.push(h)})});u.name="buildSkeleton",c.push(u)}.call(t);var r=x.getPromises(),a=r.slice(),d=new Promise(function(e){Promise.all(a).then(function(){t.options.model.getVisibleAdditionalColumns=function(e){var o=[],i=t.options.views.datagridview;if(t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length)for(var s=0;s<t.options.additionalColumnsModules.length;s++){var r=[],a=t.options.additionalColumnsModules[s],l=a.getManagedColumnNames();if(i)for(var d=0;d<l.length;d++)!0===e?n.is(i.isColumnExportable,"function")&&i.isColumnExportable(l[d])&&r.push(l[d]):n.is(i.isColumnHidden,"function")&&!i.isColumnHidden(l[d])&&r.push(l[d]);(r.length||!0===a.alwaysUpdate)&&o.push({module:a,columns:r})}return o},I.subscribe({event:"ENXModel/SyncModel"},function(e){if("datagridview"!==t.options.active_view){for(var o=!0,n=0;n<t.options.additionalColumnsModules.length&&o;n++)"function"==typeof t.options.additionalColumnsModules[n].hasStructureModelUpdate&&(o=!1);if(!1===o){var i=t.options.model.getAllDescendants();C.getSetting("expandv2")?t.options.model.fillAttributesAsync(i,"SyncModelNodes"):t.options.model.fillAttributesAsync4VisibleNodes(i,void 0,"SyncModelNodes")}}else{var s=t.options.views.datagridview.options.dgv,r="OnSyncModel";if(!0===e.refresh&&(r="SyncModelRefresh",s.requestDelayedModelData&&s.requestDelayedModelData(r)),e.what)switch(e.what){case"applyFilter":s.requestDelayedModelData&&s.requestDelayedModelData(r)}}}),t._dispatchReady(),t.isDynamicCtx()&&require(["DS/ENXNav/commands/CmdUtils"],function(e){e.checkAvailability()}),I.subscribe({event:"ENXModel/Expand/expandStatus"},function(e){e.status&&!0===e.status.expandTooLarge&&("find_in_ctx"===e.mode?S.displayNotification({msg:o.replace(o.tooManyResultFound,{maxResult:C.getSetting("maxPathsForSearch")}),eventID:"warning"}):S.displayNotification({msg:o.expandTooLarge,eventID:"warning"}))}),I.subscribe({event:"ENXModel/Expand/parseDone"},t._checkGraphCmdAvailability.bind(t)),e()})});d.name="dispatchReady",r.push(d)}():t._initialize_failure(function(){t.dispatchEvent("onReady",{error:!0})})})}),I.subscribe({event:"DesignEnv/updatePSEModel"},function(e){e(t.options.model)})},render:function(){return this.elements.container},onSearch:function(e){0===this.options.model.getRoots().length?this.displayNotification({msg:t.find_in_context_no_result,eventID:"info"}):this.options.model.isGroupingApplied()?this.displayNotification({title:t.noFindWithGroupingTitle,msg:t.noFindWithGrouping,eventID:"info"}):_.launchFind({nodes:this.options.model.getRoots(),searchFts:e.query,doNotBroacast:!0})},openStoredObjects:function(e){if(e.unserializedData&&e.unserializedData.data.items.length>0){var o=require("DS/PADUtils/PADUtilsServices").getPlatformId();return o&&e.unserializedData.data.items.forEach(function(e){e.envId=o}),this.openSearchedObjects(e)}var i=A.buildKey("ENXNav","pendingOpen",!0),s=this;return new Promise(function(o){var r=A.sess.get(i);if(r&&(delete r.fromProxy,delete r.expiresAt,n.equals(r,e)))return A.sess.del(i),void o();A.sess.setWithExpire(i,e,2e3);var a=x.getPromises(),l=[];if(e.designEnvs&&e.designEnvs.length){var d=new Promise(function(t){Promise.all(a).then(function(){s.add({content:"designEnv",designEnv:e.designEnvs,broadcast:!1,loadWithFilter:e.withFilter,callback:function(){t()}})})});d.name="AddDesignEnv",l.push(d)}if(e.products&&Object.getOwnPropertyNames(e.products).length){var c=new Promise(function(o){Promise.all(a).then(function(){s.add({content:"structure",structure:e.products,id_to_detach:e.id2detach,broadcast:!0===e.broadcast,loadWithFilter:e.withFilter,callback:function(){!0===e.withFilter&&(y.isAuthoring()?(S.displayNotification({msg:t.filterInAuthoring,eventID:"warning"}),s.disableFilterWaiting()):!0!==e.fromProxy?require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&(t.begin(),s._filterPanelOpen=!0)}):!0===e.fromProxy&&(s._filterRootIds=Object.getOwnPropertyNames(e.products),s._filterPanelOpen=!0)),o()}})})});c.name="AddRoots",l.push(c)}if(e.filters){var p=require("DS/PADUtils/PADUtilsServices"),u=Object.getOwnPropertyNames(e.filters);u.length&&Promise.all(l).then(function(){var t=new Promise(function(t){Promise.all(a).then(function(o){for(var n=[],i=0;i<u.length;i++)n.push({envId:p.getPlatformId(),serviceId:"3DSpace",objectId:u[i],objectType:"ENOStrRefinementSpecification"});s.addFilter({filter_objects:n,multipleFilters:e.multipleFilters,broadcast:!1,callback:function(e){e.failure&&e.failure.length>0&&s.endBlockingTransaction(),t()}})})});t.name="AddFilters",l.push(t)})}Promise.all(l).then(function(){o()})})},openSearchedObjects:function(e){var o=this;return new Promise(function(i){function s(n){!0===e.withFilter&&(y.isAuthoring()?(S.displayNotification({msg:t.noFilterOnAuthoring,eventID:"warning"}),o.disableFilterWaiting()):!0!==e.fromProxy&&require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommand("DefineFilter");t&&t.begin()})),i(n)}var r=n.extend({notifPerObjects:!0,displayNotif:!1,callback:function(n){if(0===n.authorized_objects.length){var i={error:"noAuthObj"};!0===n.unsupportedDropNotified&&(S.displayNotification({msg:t.no_authorized_object,eventID:"error",key:"enxNav-openSearchedObjects-unsupported-drop"}),i.what="unsupportedDropNotified"),s(i)}else{var r=e.behavior?e.behavior:"WITH_CONTEXT";if(n.authorizedWithKind){if(n.authorizedWithKind.Product&&n.authorizedWithKind.Product.length>0){var a={content:"3DXContent",authorized_objects:n.authorizedWithKind.Product,callback:s,behavior:r,isDrop:!0,broadcast:!1};e.withFilter&&(a.loadWithFilter=!0),o.add(a)}n.authorizedWithKind.Filter&&n.authorizedWithKind.Filter.length>0&&o.addFilter({content:"3DXContent",filter_objects:n.authorizedWithKind.Filter,callback:s,behavior:void 0,broadcast:!1})}}},version:"2.0"},e);N.retrieveAuthorizedObjects(r)})},openDroppedObjects:function(e){var i=this;return new Promise(function(s){var r=require("DS/PADUtils/PADUtilsServices");function a(t){if(1!=e.isDesignExpCall){var o=I.getModelEvents();if(e.isOpenFromFiltersPage)o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"});else if(0===i.options.model.getRoots().length&&0===i.options.model.getDetachedRoots().length)if(e.unserializedData.data.items.length>0){for(var n=!1,r=0;r<e.unserializedData.data.items.length;r++)if("Change Action"===e.unserializedData.data.items[r].objectType){n=!0;break}n&&(o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}),n=!1)}else o.publish({event:"ENXViews/WelcomePanel/activate"});else o.publish({event:"ENXViews/WelcomePanel/closeLandingPage"});s(t)}else s(t)}if(C.getSetting("readOnlyDashboard")&&i._displayOnceReadOnlyNotif&&(S.displayNotification({msg:o.msg_readonly_dashboard,eventID:"warning"}),i._displayOnceReadOnlyNotif=!1),"FILTER"===e.behavior){if(i.options.isDeEnabled){let t=e.unserializedData.data.items;if(t.forEach((e,o)=>"Workspace"==e.objectType&&t.splice(o,1)&&(i.options.donNotOpenDE=!0)),i.options.donNotOpenDE&&(S.displayNotification({msg:o.design_exp_unable_to_filter,eventID:"error"}),i.options.donNotOpenDE=!1,!t.length))return!1}require(["DS/ApplicationFrame/CommandsManager"],function(t){var o=t.getCommand("FilterDropObjects");o?(e.fromWP=!0,o.execute(e.unserializedData,e)):console.error("XNavComponent## FilterDropObjects command is undefined"),s(o?void 0:{error:"noCommandAvailable"})})}else{var l=n.extend({notifPerObjects:!0,displayNotif:!1,callback:function(o){if(0===o.authorized_objects.length){var s={error:"noAuthObj"};!0===o.unsupportedDropNotified&&(S.displayNotification({msg:t.invalidDropOperation,eventID:"error",key:"enxNav-openDroppedObjects-unsupported-drop"}),s.what="unsupportedDropNotified"),a(s)}else{var l=e.behavior?e.behavior:"WITH_CONTEXT",d=i.options.model.getRoots(),c=!!n.is(e.broadcast,"boolean")&&e.broadcast;r.multiTenantMgt(o.authorized_objects,d,function(t){if(t.isMultiTenant)t.isMultiTenant&&t.invalidTenant&&a({error:"invaidTenant"});else{var n=[];o.authorizedWithKind?(o.authorizedWithKind.Product&&o.authorizedWithKind.Product.length>0&&n.push(new Promise(function(t){i.add({content:"3DXContent",authorized_objects:o.authorizedWithKind.Product,callback:t,behavior:l,isDrop:!0,broadcast:c,biProxyCtx:o.source_data.biProxyCtx,loadWithFilter:!0===e.withFilter||void 0})})),o.authorizedWithKind.Filter&&o.authorizedWithKind.Filter.length>0&&Promise.all(n).then(function(){n.push(new Promise(function(e){i.addFilter({content:"3DXContent",filter_objects:o.authorizedWithKind.Filter,callback:e,behavior:"fromDrop",broadcast:c})}))}),o.authorizedWithKind.Change&&o.authorizedWithKind.Change.length>0&&Promise.all(n).then(function(){n.push(new Promise(function(e){i.loadChangeV2?i.loadChangeV2({content:"3DXContent",objects:o.authorizedWithKind.Change,callback:e,behavior:l,broadcast:c}):e({})}))}),o.authorizedWithKind.DesignEnv&&o.authorizedWithKind.DesignEnv.length>0&&(Promise.all(n).then(function(){n.push(new Promise(function(e){I.publish({event:"ENXModel/DesignEnv/add",data:{designEnv:o.authorizedWithKind.DesignEnv,pseModel:i.options.model,resolve:e}})}))}),i.dispatchEvent("onAddDesignEnv",{designEnvIds:o.authorizedWithKind.DesignEnv.map(e=>e.objectId)}))):n.push(new Promise(function(e){i.add({content:"3DXContent",authorized_objects:o.authorized_objects,callback:e,behavior:l,broadcast:c,biProxyCtx:o.source_data.biProxyCtx})})),Promise.all(n).then(a)}})}},version:"2.0"},e);N.retrieveAuthorizedObjects(l)}})},add:async function(e){var o=e||{},i=[],s=[],r=[];switch(e.content){case"idslist":i=(o=e).pids;break;case"pathslist":for(var a=0;a<e.paths.length;a++){var l=e.paths[a][0];-1===i.indexOf(l)&&i.push(l)}break;case"3DXContent":(o=await async function(e){var t={pids:[],is3DContent:void 0!==e.initLoad&&e.initLoad},o=e.behavior?e.behavior:"WITH_CONTEXT";e.isDrop&&e.isDrop&&(t.skipDrop=!1);async function i(e){return new Promise(t=>{N.isTypesAuthorized([e],o=>{-1!==o.indexOf(e.type)?t(!0):t(!1)},!1)})}for(var s=[],r=[],a=[],l=0;l<e.authorized_objects.length;l++){var d=e.authorized_objects[l];if(s.push(d.objectId),"fromx3dContentId"===o&&Array.isArray(d.path)&&Array.isArray(d.path)){let e=await i(d.path[0]);B(r,e?d.path:[d.path[d.path.length-1]])}"WITH_CONTEXT"===o&&(n.is(d.path,"array")||(o="WITHOUT_CONTEXT")),"WITH_CONTEXT"===o&&r.push(d.path.map(function(e){return e.resourceid})),"FILTER"===o&&Array.isArray(d.path)&&B(r,d.path),d.folderId&&-1===a.indexOf(d.folderId)&&a.push(d.folderId)}"fromx3dContentId"===o&&(t.paths=r);if("WITH_CONTEXT"===o){t.paths=r;for(var c=0;c<t.paths.length;c++)t.pids.push(t.paths[c][0])}else t.pids=s;t.broadcast=!n.is(e.broadcast,"boolean")||e.broadcast,a.length&&(t.folderIds=a);return t}(e)).callback=e.callback,i=o.pids;break;case"designEnv":return I.publish({event:"ENXModel/DesignEnv/add",data:{designEnv:e.designEnv,pseModel:this.options.model}}),void this.dispatchEvent("onAddDesignEnv",{designEnvIds:e.designEnv.map(e=>e.objectId)});case"structure":(o=function(e){var t={pids:[],paths:[],id_to_detach:e.id_to_detach,broadcast:e.broadcast},o=e.structure,n=[],i=function(e,o){var s,r=Object.keys(e),a=r.length;for(s=0;s<a;s++){let a=r[s],g=e[a],f="string"==typeof g;var l,d=Object.keys(g),c=d.length;if(0===c||f){var p;(p=void 0===o?[]:o.slice()).push(r[s]);var u=p.join(",");-1===n.indexOf(u)&&(n.push(u),t.paths.push(p))}else for(l=0;l<c;l++){var h;(h=void 0===o?[]:o.slice()).push(r[s]),i(e[r[s]],h)}}};return i(o),t}(e)).callback=e.callback;for(var d=0;d<o.paths.length;d++){var c=o.paths[d][0];-1===i.indexOf(c)&&i.push(c)}if(0===o.paths.length&&0===o.pids.length)return void(o.callback&&o.callback());break;case"filters":var p=!1,u=-1;if(void 0===o.pids&&(o.pids=[]),e.rootsWithFilters&&e.rootsWithFilters.length>0){for(var h=0;h<e.rootsWithFilters.length;h++){var g=e.rootsWithFilters[h].rootId,f=e.rootsWithFilters[h].filterId,v=e.rootsWithFilters[h].filterName;if(-1!==i.indexOf(g)){p=!0,u=h;break}i.push(g),o.pids.push(g),f&&-1===s.indexOf(f)&&s.push(f),v&&-1===r.indexOf(v)&&r.push(v)}p&&-1!==u&&e.rootsWithFilters.splice(u)}!0===p&&S.displayNotification({msg:t.filterMultipleSameRoot,eventID:"warning"}),o.rootsWithFilters=e.rootsWithFilters,o.callback=e.callback;break;default:throw new Error("Not supported content")}!0===e.loadWithFilter&&!0!==this._wait4Filter&&(this.disableUX(),o.loadWithFilter=!0,this._wait4Filter=!0,this._filterRootIds=i,this._filterPanelOpen=!0);var m=this;o.rootIds=i,o.filterIds=s,o.filterNames=r,o.behavior=!0===e.dropOnFilter?"fromDropOnFilter":o.behavior;var b=x.getPromises(),_=b.slice(),D=new Promise(function(t,n){Promise.all(_).then(function(){var n=Promise.resolve({rootsWithFilter:void 0,objectsWithoutFilterDrop:o});e.biProxyCtx&&(n=m._checkIfFilterAvailable(o,e.biProxyCtx)),n.then(function(e){m.addInProgressFlag=!0;var o=[],n=!1;e.rootsWithFilter&&(o.push(m._addDroppedRootsWithFilter(e.rootsWithFilter)),n=!0),e.objectsWithoutFilterDrop&&(o.push(new Promise(function(t){m._internalAdd(e.objectsWithoutFilterDrop,t)})),n=!0),Promise.all(o).then(function(){!1===n&&!0===m._wait4Filter&&(m.enableUX(),m._wait4Filter=!1),m.addInProgressFlag=!1,I.publish({event:"ENXModel/Root/AllAdded"}),t()}),m.dropInvitContainer&&m.dropInvitContainer.hide(),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:!0})})})});D.name="add",b.push(D)},_internalAdd:function(e,t){var i=this;a.mask(this.elements.container);var s=e.callback,r=function(t,o){if(!1!==t.broadcast){var n={pids_hidden:t.id_to_detach},s=!0;if(!0===e.loadWithFilter&&!1===y.isAuthoring()&&o.alreadyLoadedRoots&&o.alreadyLoadedRoots.length&&(n.loadWithFilter=!0,t.rootIds.length===o.alreadyLoadedRoots.length)){for(var r=!0,a=0;a<t.rootIds.length&&r;a++)-1===o.alreadyLoadedRoots.indexOf(t.rootIds[a])&&(r=!1);!0===r&&(s=!1)}if(!0===s){t.rootsWithFilters&&!0!==n.loadWithFilter?n.rootsWithFilters=t.rootsWithFilters:t.paths?n.paths=t.paths:n.pids=t.pids;var l=require("DS/PADUtils/PADUtilsServices");if(n.tenant=l.getPlatformId(),t.is3DContent)return;t.loadWithFilter&&(n.loadWithFilter=!0),F.isWidgetSynchronizing()||i._commandProxy.drop(n)}}},l=function(t){i.options.model.prepareBroadcastSelect();var o=e.paths;if(!n.is(e.paths,"array")){o=[];for(var s=0;s<e.rootIds.length;s++)o.push([e.rootIds[s]])}i.options.model.pushBroadcastSelect()};function d(o){"graphview"===i.options.active_view&&i.options.views.graphview&&(i.options.views.graphview.reframeOn(),i.options.views.graphview.reframeAll()),i.dropInvitContainer&&(0===i.options.model.getRoots(void 0).length&&0===i.options.model.getDetachedRoots().length?i.dropInvitContainer.show("drop"):i.dropInvitContainer.hide());let a=!1;0===i.options.model.getRoots(void 0).length&&(a=!0),I.publish({event:"DS/ENXDropInvite/displayEmptyInvite",data:a}),n.is(s,"function")&&("error"==o?s(o):s.call(null,e.rootsWithFilters?e.rootsWithFilters:null,o)),r(e,o),l(e),t()}function c(e){"error"!==e&&(!0!==e.noNotif&&S.displayNotification({eventID:"success",msg:o.addRootSuccessNotif}),C.getSetting("readOnlyDashboard")&&i._displayOnceReadOnlyNotif&&(S.displayNotification({msg:o.msg_readonly_dashboard,eventID:"warning"}),i._displayOnceReadOnlyNotif=!1))}var p=!0,u=!!n.is(e.folderIds,"array");if(n.is(e.paths,"array")){if(u&&1===e.paths.length){for(var h=[],g=0;g<e.paths.length;g++)e.paths[g].length>1&&h.push(e.paths[g]);h.length||(p=!1)}if(p){var f=!0;for(g=0;g<e.paths.length&&f;g++)e.paths[g].length>1&&(f=!1)}}if(n.is(e.paths,"array")&&p&&!1===f&&e.paths.length){a.unmask(i.elements.container);var v=this.options.model.getRoots(),m=[];v&&v.length>0&&v.forEach(function(e){e.options.isRootAttached&&m.push(e.options.resourceid)}),this.options.model.addPaths({paths:e.paths,callback:function(t,o){if(t.success)n.is(e.id_to_detach,"array")&&e.id_to_detach.length>0&&e.id_to_detach.forEach(function(e){var t=i.options.model.searchRootById(e);n.is(t)&&i.toggleRoot({context:t})}),i.dispatchEvent("onAddPaths",{addedPaths:e.paths}),c(e);else if(n.is(t.idleRootIds,"array")){var s=[];if(t.idleRootIds.forEach(function(e){-1===m.indexOf(e)&&s.push(e)}),s.length>0){var r={};r.pids=s,i._onRemoveRoot(r),m.length>0&&m.filter(function(e){return this.indexOf(e)<0},s);var a=i.getWidgetTitle();i.options.widget.setTitle(a)}}d(o)}})}else this.options.model.add({pids:e.rootIds,rootsWithFilters:e.rootsWithFilters,callback:function(t){if("error"!=t)if(n.is(e.paths,"array")){var o=i.options.model;let n=e.paths;if(t.alreadyLoadedRoots&&t.alreadyLoadedRoots.length)for(let e=0;t.alreadyLoadedRoots&&e<t.alreadyLoadedRoots.length;e++){let o=n.indexOf(t.alreadyLoadedRoots[e]);-1!==o&&n.splice(o,1)}o.insertBranches(n,{onComplete:function(){if(o.prepareBroadcastSelect(),o.pushBroadcastSelect(),"graphview"===i.options.active_view&&i.options.views.graphview.reframeOn(),0===n.length){for(var s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);n=s}i.dispatchEvent("onAddPaths",{addedPaths:n}),"datagridview"===i.options.active_view&&i.options.views.datagridview.reapplySortModel(),c(t)}})}else{if(!0===i.options.layout.withWelcomePanel){if(t&&"error"!==t)if(e.filterIds.length>0)t&&t.alreadyLoadedRoots&&0===t.alreadyLoadedRoots.length&&i.dispatchEvent("onAddFilters",{filterIds:e.filterIds,rootIds:e.rootIds,filterNames:e.filterNames});else{for(var s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);i.dispatchEvent("onAddPaths",{addedPaths:s})}}else{for(s=[],r=0;r<e.rootIds.length;r++)s.push([e.rootIds[r]]);i.dispatchEvent("onAddPaths",{addedPaths:s})}t&&"error"!==t?c(t):I.publish({event:"ENXViews/WelcomePanel/activate"})}a.unmask(i.elements.container),d(t)}})},empty:function(e,t,o){var n=this,i=[],s=!1!==e;if(!0===t){n.options.model.getRoots().forEach(function(e){i.push(e.getID())}),I.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:{item2remove:i,noDispatch:o}})}else{var r=x.getPromises(),a=r.slice(),l=new Promise(function(e,t){Promise.all(a).then(function(t){var r=n.options.model;if(r&&r.unselectAll(),!0===s&&n._commandProxy.cleanAll(),r){if(r.getRoots(!0).forEach(function(e){i.push(e)}),r.getDetachedRoots().forEach(function(e){i.push(e)}),r._skipFilterProxy=!0,r.wrapInTransaction(function(){r.withTransactionUpdate(function(){i.forEach(function(e){I.publish({event:"ENXModel/Root/remove",data:{all:!0}})})})}),r._skipFilterProxy=!1,!o){let e=i.map(function(e){return e.getID()});r.getModelEvents().publish({event:"onRemoveRoots",data:{pids:e}})}r._pagerview&&(r._pagerview.hide(),r._pagerview=null),n.options.widget.getValue("saved_filter_ids")&&n.options.widget.setValue("saved_filter_ids","[]"),e()}})});l.name="empty",r.push(l)}},toggleView:function(e){var t=e;"treeview"===e&&(e=this.options.layout.amdTreeView);let o=require("DS/PADServices/settings/AppSettings").getSetting("activateStatusBar");if(e!==this.options.active_view){var n=this;this.loader.loadView(e,function(){if(n.options.views[n.options.active_view].unsetModel(),n.options.active_view=e,n.options.model.applyActiveView(n.options.active_view),n.options.views[n.options.active_view].setModel(n.options.model),"graphview"===n.options.active_view){if(!0===o&&n.elements.actionbar.options.xnav_ab.elements.container.removeClassName("xnav_actionbar_withstatusbar"),n.options.views.graphview.reframeOn(),!0===n.options.loadGraphSection){var i=n.elements.actionbar.options.xnav_ab.onActionBarReady(function(){n.elements.actionbar.options.xnav_ab._modelEvents.unsubscribe(i),n.elements.actionbar.options.xnav_ab.goToNthSection(n.elements.actionbar.options.xnav_ab.getSectionID("XSCViews")),require("DS/ApplicationFrame/CommandsManager").getCommand(t).begin()});n.elements.actionbar.options.xnav_ab.loadModel({merge:!0,file:"GraphViewAB.xml",module:"ENXNav"}),n.options.graphABLoaded=!0}}else if(!0===n.options.loadGraphSection&&!0===n.options.graphABLoaded){var s=n.elements.actionbar.options.xnav_ab.onActionBarReady(function(){n.elements.actionbar.options.xnav_ab._modelEvents.unsubscribe(s),n.elements.actionbar.options.xnav_ab.goToNthSection(n.elements.actionbar.options.xnav_ab.getSectionID("XSCViews")),require("DS/ApplicationFrame/CommandsManager").getCommand(t).begin()});!0===o&&n.elements.actionbar.options.xnav_ab.elements.container.addClassName("xnav_actionbar_withstatusbar"),n.elements.actionbar.options.xnav_ab.loadModel(n.options.action_bar_opts),n.options.graphABLoaded=!1}n.dispatchEvent("onToggleView",n.options.active_view),I.publish({event:"ENXModel/toggleView",data:{view:n.options.active_view}})})}},postActionBar:function(){},beginBlockingTransaction:function(e){a.mask(this.elements.container,e)},endBlockingTransaction:function(){a.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize(),this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},hasActiveDesignExp(){let e=this.leftsidepanel.elements.designenvpanel;return!(!e||!e.core.contextManager.getActiveDesignEnv())},getActiveDesignExp(){return this.leftsidepanel.elements.designenvpanel.core.contextManager.getActiveDesignEnv()},getPseService(){return this.leftsidepanel.elements.designenvpanel.core.pseCommonService},getRoots:function(){return this.options.model.getRoots()},getPADDGVView:function(){return this.options.views.datagridview},getPADTreeListView:function(){return console.warn("getPADTreeListView Deprecated: use getPADDGVView instead"),this.getPADDGVView()},getProxy:function(){return this._commandProxy},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getMainHTMLClass:function(){return".xnav_body"},applyFilter:function(e){"2.0"===this.options.model.version?this.applyFilterV2(e):this.applyFilterV1(e)},applyFilterV1:function(e){this.enableUX();var t=this;!0===this._wait4Filter&&(this._wait4Filter=!1),this._filterPanelOpen=!1;var o=n.clone(e,!0),i=this.options.model.getRoots(),s=!1;t.options.ordering=t.options.ordering?t.options.ordering:[],null!==e&&!1===e.empty&&(s=!0,0===t.options.ordering.length&&i.forEach(function(e){var o=e.getID();-1===t.options.ordering.indexOf(o)&&t.options.ordering.push(o)}));var r,a=[];if(null===e)for(e={},r=0;r<i.length;r++)a.push(i[r].getID());else e.root_physicalid&&a.push(e.root_physicalid);!0===e.hideChildren?this.options.model._hideChildrenFilter=!0:delete this.options.model._hideChildrenFilter;var l=!1,d=C.getSetting("activateDGV");if(void 0!==e.filterRootIds){t=this;this.options.model.withTransactionUpdate(function(){for(r=0;r<e.filterRootIds.length;r++){var o=t.options.model.searchRootById(e.filterRootIds[r]);if(o)if(!0===e.empty){if(delete o.options.filtered,delete o.options.filterTitle,o.options.CVQuery=null,o.options.sequence_filter=null,o.options.config_filter=null,!0===d){if(o.options.icons&&o.options.icons.length)(c=n.clone(o.options.icons[0])).badges={bottomRight:null},o.updateOptions({icons:[c]})}else o.setBadges({bottomRight:""});var i=o.getState();o.setState({state:"partiallyExpanded"}),o.options.padstate="partiallyExpanded",o.childComputed=!1,"collapsed"===i?o.options.children=[]:(o.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded",null===this.options.children&&(this.options.children=[]),this.childComputed=!1,"collapsed"===e&&(this.options.children=[])}}}),null===o.options.children&&(o.options.children=[])),I.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter"}})}else{if(l=!0,o.options.filtered=!0,o.options.filterTitle=e.filterTitle,o.options.filterId=e.filterId?e.filterId:o.options.filterId,o.options.CVQuery=e.CVQuery,e.CVQuery&&e.CVQuery.union&&e.CVQuery.union.expand)for(var s=0;s<e.CVQuery.union.expand.length;s++){var a=e.CVQuery.union.expand[s].root_path_physicalid;1===a.length&&-1!==a[0].indexOf(o.getID())&&(o.options.sequence_filter=e.CVQuery.union.expand[s].sequence_filter,o.options.config_filter=e.CVQuery.union.expand[s].config_filter)}else o.options.sequence_filter=null,o.options.config_filter=null;if(o.collapseAll(),o.removeChildren(!1),o.options.children=[],o.setState({state:"collapsed"}),o.options.padstate="collapsed",o.childComputed=!1,!0===d){var c;if(o.options.icons&&o.options.icons.length)void 0===(c=n.clone(o.options.icons[0]))&&(c={}),c.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},o.updateOptions({icons:[c]})}else{o.setBadges({bottomRight:"filter"})}}}I.publish({event:"ENXModel/UpdateAdditionalColumns",data:{nodesToUpdate:{pids:e.filterRootIds},treedocument:t.options.model}})})}else console.warn("xNavComponent: No filterRootIds properties");l&&!0===C.getSetting("expandAllwithApplyFilter")&&(!0===C.getSetting("structureAppearCollapseAfterApplyFilter")&&(e.structCollapse=!0),e.tagFilterCase=s,this.options.model.applyFilter(e)),!0!==e.doNotBroacast&&this._commandProxy.applyFilter(o)},applyFilterV2:async function(e){var o=this,i=n.clone(e,!0);let s=async e=>new Promise(t=>{o.add({content:"idslist",pids:[e.rootId],callback:t})});var r;!0===this._wait4Filter&&(this._wait4Filter=!1),this.enableUX(),I.publish({event:"ENXModel/Root/AllAdded"}),this._filterPanelOpen=!1;!0===e.hideChildren?this.options.model._hideChildrenFilter=!0:delete this.options.model._hideChildrenFilter;var a=[];void 0!==e.filterRootIds?this.options.model.withTransactionUpdate(async function(){for(r=0;r<e.filterRootIds.length;r++){var n=o.options.model.searchRootById(e.filterRootIds[r]);if(void 0===n&&(await s({rootId:e.filterRootIds[r]}),n=o.options.model.searchRootById(e.filterRootIds[r])),n){if(y.determineAuthoredFlag()&&!0===C.getSetting("keepFilterAuthoring")){var i,l=o._biFilter.getFilterSpec(n.getID(),{V2:{}});(i=k.validateFIlters(l))&&i.isValid?(n.keepFilterBadge=!0,n.validFilter=!0,o.options.model.prodConfigSupportInAuth=!0):S.displayNotification({msg:t.invalidFilterInAuth,eventID:"warning"})}if(a.push(n),!0===e.empty){n.options.icons&&n.options.icons.length&&D.node.clearBadges(n);var d=n.getState();n.setState({state:"partiallyExpanded"}),delete n.options.filtered,delete n.options.filterTitle,n.options.childComputed=!1,"collapsed"===d?(n.removeChildren(),n.options.children=[],n.setState({state:"partiallyExpanded"})):(n.processDescendants({processNode:function(){if(!0!==this.isRelationsObjectNode){var e=this.getState();null!==this.options.children&&void 0!==this.options.children||(this.options.children=[]),this.options.childComputed=!1,"collapsed"===e&&(this.removeChildren(),this.options.children=[]),this.setState({state:"partiallyExpanded"}),this.options.padstate="partiallyExpanded"}}}),null===n.options.children&&(n.options.children=[])),o.hasActiveDesignExp()&&o.getPseService().handleFilterModifications(e,"removed"),!0===o.options.model.grpBSDActivated&&o.options.model.removeGrouping({selectedNode:n})}else{n.options.filtered=!0,(o.options.isDeEnabled||o.hasActiveDesignExp())&&(o.hasActiveDesignExp()&&(!o.hasActiveDesignExp()||n.options.filterId&&o.getPseService().isContext(n.options.resourceid)||o.getPseService().isFromActionClick)||(o.shouldAddSpecForDE=!0,o.xNavPersistFilterSpec.addEventForEachFilter([n.options.resourceid])),n.options.filterTitle=e.filterTitle,n.options.filterId=e.filterId?e.filterId:n.options.filterId,o.hasActiveDesignExp()&&(o.pseService=o.getPseService(),n.options.isReadOnly=!!o.pseService.isContext(n.options.resourceid),o.pseService.isLastFilterLoaded(n))),n.collapseAll(),n.removeChildren(!1),n.options.children=[];let t=o.options.model.getXSO(),i=t.get().filter(function(e){return!e.getTreeDocument()});t.remove(i),n.options.children=[],n.setState({state:"collapsed"}),n.options.padstate="collapsed",n.options.childComputed=!1,n.options.icons&&n.options.icons.length&&D.node.setFilterBadge(n),V.call(o,n),L.call(o,n),o.hasActiveDesignExp()&&o.getPseService().handleFilterModifications(e,"applied",n)}}}}):console.warn("xNavComponent: No filterRootIds properties"),a.length&&(e.tagFilterCase=!1,this.options.model.isGroupingApplied()&&(!0===this.options.model.grpBSDActivated?a.forEach(async e=>{await this.options.model.removeGrouping({node:e})}):(this.options.model.cleanGroupingForRoots({rootIds:e.filterRootIds}),this.options.model.__applyGrouping({roots:e.roots,groups:this.options.model.options.groups,fromApplyFilter:!0}))),this.options.model.expandZeroForFilterRoots({filteredRoots:a})),!0!==e.doNotBroacast&&this._commandProxy.applyFilter(i)},getSecurityContext:function(){return{SecurityContext:w.getSecurityContext()}},disableUX:function(){var e=this;e._disablingInProgress=!0,e.elements.container.blockUX||require(["DS/UIKIT/Modal"],function(t){!0===e._disablingInProgress&&(delete e._disablingInProgress,e.elements.container.blockUX=new t({className:"disableMainUX",closable:!1,body:"",visible:!0}),e.elements.container.blockUX.inject(document.body))})},enableUX:function(){this.elements.container.blockUX&&(this.elements.container.blockUX.destroy(),delete this.elements.container.blockUX),!0===this._disablingInProgress&&delete this._disablingInProgress},disableFilterWaiting:function(e){var t=this,o=e||{};this.enableUX(),e&&"left"===e.panel&&(!0===this._wait4Filter&&(this._wait4Filter=!1,I.publish({event:"ENXModel/Root/AllAdded"}),!0===this._filterPanelOpen&&(this._filterPanelOpen=!1,this.confirmModal=new p({callback:function(o){if(!1===t.confirmModal.cancelModal.fromProxy){!1===o&&t._onRemoveRoot({pids:t._filterRootIds});var n={widget:"2D",result:o};t._commandProxy.filterCancel(n)}if(!1!==o)for(let o=0;o<e.rootIds.length;o++){var i=t.options.model.searchRootById(e.rootIds[o]);L.call(t,i)}}}))),this._commandProxy.disableFilterWaiting(o))},togglePanel:function(e,t){(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},openPanel:function(e){this.elements.padshell.openPanel(e)},destroy:function(){var e=require("DS/PADUtils/PADUtilsServices");this._commandProxy.padDestroy({widgetId:e.getWidgetId()}),this._commandProxy.destroy(),this.options.model._commandProxy&&this.options.model._commandProxy.destroy(),this.options.model._cmdProxy&&this.options.model._cmdProxy.destroy()},_dispatchReady:function(e){if(!0===this.options.isReady.model&&!this._dragLeave){let e=this.getContent(),t=this;e.addEventListener("dragleave",function(e){t.dropInvitContainer&&t.dropInvitContainer.hide(),0===t.options.model.getRoots().length&&t.dropInvitContainer.show("drop")}),this._dragLeave=!0}this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady.actionbar&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady",{addInView:e}),this._probes.probe_init.end(),this._dispatchReady_NotDone=!1)},displayNotification:function(e){S.displayNotification(e)},_initialize_failure:function(e){var t=this;require(["DS/ENXNav/views/xNavInitError"],function(n){var i=o.initialization_error;t.elements.bigerror=new n({msg:i}),t._just_error_content(),t.displayNotification({title:o.initialization_errorTitle,msg:i,eventID:"error",key:"enxNav-initialisation-error"}),e()})},_just_error_content:function(){this.elements.bigerror&&this.elements.container.setContent(this.elements.bigerror)},getCurrentView:function(){return this.options.active_view},updateCurrentView:function(){this.options.views[this.options.active_view].updateView()},getPropertiesFacet:function(){return this.options.layout.propertiesFacet?this.options.layout.propertiesFacet:[]},isPartiallyExpanded:function(e,t){var o=!1;if("partiallyExpanded"===e.getState())o=!0;else{var n=e.getRoot();if(n.options._filterInfo&&JSON.stringify(n.options._filterInfo)!==JSON.stringify({}))o=!0;else if(void 0!==n.options.sequence_filter||void 0!==n.options.config_filter)o=!0;else if(n.options._childrenFilterInfo){var i=n.options._childrenFilterInfo.filteredOutChildren;i&&i.length>0&&(o=!0)}}t&&t(o)},updateAttributesDelayed:function(e){var t=this,o=l.debounce(function(e){var o=e.displayNodesArray;if(void 0===o&&e&&e.collectionView&&e.collectionView.model){var n=e.collectionView;o=void 0!==e.startNodeIndex&&void 0!==e.endNodeIndex?n.model.slice(e.startNodeIndex,e.endNodeIndex+1):n.model}if(o.length){for(var i=[],s=0;s<o.length;s++)o[s]._canBeGrouped()&&i.push(o[s]);t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length&&t.options.model.fillAttributesAsync4VisibleNodes(i,void 0,e.context),t.colorMap&&t.options.model.updateColorForNodes(i,t.colorMap,t.predicateKind);let n=t.getPADDGVView().getColumnViewsForUpdate();n&&D.node.updateSpecificColumnViews(i,n,e.context);for(var r=0,a=i.length;r<a;r++)!0!==i[r]._manageNLS&&!0!==i[r].options.ensureNLS||P.updateNLS(i[r])}},200);"OnResize"!==e.context&&!0!==this.options.model.__groupingInProgress&&o(e)},getWidgetTitle:function(){var e=require("DS/PADUtils/PADUtilsServices"),o=e.getPlatformId(),n=e.getTenantsPreference(),i=this.getRoots(),s="";if(0===i.length)s="";else if(1===i.length){s=i[0].getLabel(),n.length>1&&(s+=" - "+o)}else s=i.length+t.multi_root_tile,n.length>1&&(s+=" - "+o);return s},_checkGraphCmdAvailability:function(){var e=this.options.model.getAllDescendants().length,t=require("DS/ApplicationFrame/CommandsManager"),o=C.getSetting("maxNodesInGraph")?C.getSetting("maxNodesInGraph"):3e3,n=t.getCommand("graphview");if(n)if(e>o){if("graphview"===this.options.active_view)t.getCommand("treeview").begin();n.disable()}else n.enable()},_onRemoveRoot:function(e){var t=this,o=x.getPromises(),n=o.slice(),i=new Promise(function(o,i){Promise.all(n).then(function(n){e.pids.forEach(function(e){t.removeRootFromFilterProxy({rootId2remove:e})}),I.publish({event:"ENXModel/Root/remove",data:{pids:e.pids,noDispatch:!0}}),0===t.options.model.getRoots().length&&t.dispatchEvent("onEmptyView"),t.getOption("layout").store_roots_in_pref&&t.dispatchEvent("onDeleteRoots",{str_removeIds:JSON.stringify(e.pids),fromWLSync:e.fromWLSync}),t._checkGraphCmdAvailability(),o()})});return i.name="removeroot",o.push(i),!1},isToolbarActivated:function(){return!1},isDynamicCtx:function(){return this.options.configuration.dynamicCtxActivated},getDynamicCtxDef:function(){return new Promise(function(e){require(["text!"+this.options.configuration.ctxMenuOpts.definition],function(t){var o=JSON.parse(t);e(o.ctxMenu)})}.bind(this))},onShow:function(e){this._commandProxy.show(e);var t=this.options.model,o=[];t.withTransactionUpdate(function(){for(var n=0;n<e.paths.length;n++){var i=t.getNodeByOccurencePath(e.paths[n]);if(i){i.updateOptions({isPADHidden:!1}),o=o.concat(i)}}I.publish({event:"ENXModel/hideShowState",target:o,data:{toggle:"show"}}),I.publish({event:"ENXModel/HideShowTriggered",data:{name:"show"}})}.bind(t))},onHide:function(e){this._commandProxy.hide(e);var t=this.options.model,o=[];t._doNotBroadcastSelect=!0,t.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){t.withTransactionUpdate(function(){e.paths.forEach(function(e){var n=t.getNodeByOccurencePath(e);if(n){n.updateOptions({isPADHidden:!0}),o=o.concat(n)}}),I.publish({event:"ENXModel/hideShowState",target:o,data:{toggle:"hide"}}),I.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})})}}),t._doNotBroadcastSelect=!1},getNGFUXID:function(e){let t,o=require("DS/PADUtils/PADUtilsServices");return t=C.getSetting("activateWidgetLink")?F.getSourceWidgetId()&&e?F.getSourceWidgetId():o.getWidgetId():o.getSharedId()}})}),define("DS/ENXNav/models/mixins/TreeDocGrouping",["i18n!DS/ENXNav/assets/nls/ENXNav","text!DS/PADServices/assets/init/DefaultColorStream.json","DS/ENXNav/models/xNavNodeModel","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils","DS/PADServices/ws/WSAccess","DS/PADServices/settings/AppSettings","DS/ENOXParser/ParserCV","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PADTrackerManager","UWA/Utils","DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADUtilsServices","DS/PlatformAPI/PlatformAPI","DS/WebappsUtils/WebappsUtils","DS/ENXNav/mixins/_xNavBIFilter"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f,v,m,b){"use strict";const _="structured",D="compact",S=JSON.parse(t);var x=!0;function y(){}y.prototype.initGrpV2=function(){this.options.mappedNodes=new Map,this.options.coloredNodes=new Map,this.grpBSDActivated=d.getSetting("grpBSD"),!0===this.grpBSDActivated?v.subscribe("groupByBSSelection.Select",this.organizeWithBS.bind(this)):(n.subscribe({event:"ENXModel/Model/GroupsLayout"},this.__groupsLayoutCmd.bind(this)),n.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGroupingTagger.bind(this))),n.subscribe({event:"ENXModel/Model/ExpandAllGroups"},this.__expandAllGroupsCmd.bind(this)),n.subscribe({event:"ENXModel/Model/FocusOnGroups"},this.__focusOnGroupsCmd.bind(this)),n.subscribe({event:"ENXModel/Model/ColorizeGroup"},this.__colorizeGroupCmd.bind(this)),n.subscribe({event:"ENXModel/Model/RemoveGroupColor"},this.__removeColorGroupCmd.bind(this))},y.prototype.isGroupingApplied=function(){return this.options.mappedNodes.size>0||void 0!==this.options.activeGroupingTagger},y.prototype.isGroupColorApplied=function(){return!!this.options.coloredNodes.size},y.prototype.getGroupLayout=function(){return x?D:_},y.prototype.getActiveGrouping=function(e){let t=[];return void 0!==this.options.activeGroupingTagger&&(t=this.options.activeGroupingTagger.groups),t},y.prototype.getGroupForNode=function(e){let t,o=this.options.mappedNodes.get(e.node.getOccurencePath().join("/"));return o&&(o.grpParams?t=this.__getGroupForNode(e.state,o,e.child):o.predicate&&(t=this.__getBSForNode(e.state,o,e.child))),t},y.prototype.applyGroupingOnNode=function(e){return new Promise(async(t,o)=>{console.groupCollapsed("TreeDocGrouping:applyGroupingOnNode## "+e.node.getLabel());try{let n=e.node.getOccurencePath(),i=n.length,s=n.join("/");console.log("Node level ["+i+"] occPath="+s),console.debug("Group definition: "+JSON.stringify(e.grouping,null,2)),this.options.mappedNodes.set(s,{grpParams:e}),Array.isArray(e.grouping.groups)&&e.grouping.groups.length?u.addCommandHit("applyGroupingOnNode",e.grouping.groups[0].predicate):u.addCommandHit("removeGroupingOnNode",""),!0===this.options.groupingFilterInProgress?console.debug(" = Grouping with filter in progress"):(this.options.groupingFilterInProgress=!0,e.grouping.groups.length?(await this.__buildTagLst(s,e.grouping.groups),await this.__retrieveGrpOnNode(e)):(console.debug("== No groups applied"),this.removeGrouping({selectedNode:e.node})),this.options.groupingFilterInProgress=!1),t()}catch(e){console.error(e),o(e)}console.groupEnd()})},y.prototype.cleanGroupingForRoots=function(e){let t=e.rootIds?e.rootIds:[];for(let e=0;e<t.length;e++)delete this.options.mappedNodes.get(t[e]).mapGrpNodes},y.prototype.cleanGroupingForNodes=function(e){let t=e.node.getOccurencePath().join("/");this.options.mappedNodes.get(t)&&this.options.mappedNodes.delete(t)},y.prototype.__applyGrouping=function(e){n.publish({event:"ENXNav/FilterBIGroupingEvent",data:e})},y.prototype.removeGrouping=async function(e){var t=e.selectedNode;!0===t.getReferenceValue("groupApplied")?this.withTransactionUpdate(()=>{t.hasChildren()&&t.removeChildren(),t.updateOptions({grid:{groupApplied:void 0,bsApplied:void 0},children:[]}),t.setState({state:"collapsed"}),this.options.mappedNodes.delete(t.getOccurencePath().join("/"))}):this.options.mappedNodes.get(t.getOccurencePath().join("/"))&&(this.options.mappedNodes=new Map)},y.prototype.getGroupingForOpen=function(){let e,t={};if(this.options.mappedNodes.size){if(t.grouping=[],!0===this.grpBSDActivated)this.options.mappedNodes.forEach((o,n,i)=>{let s=n.split("/"),r=this.getNodeByOccurencePath(s);if(console.log("Node group by BS: "+r.getLabel()),r.isRoot()){let n=Object.getOwnPropertyNames(o.mapBSNodes);for(let e=0;e<n.length;e++)n[e]=n[e].split("/");e=o.predicate.name,t.grouping.push({predicate:o.predicate.name,tags:n})}});else{let o=this.options.mappedNodes.entries().next().value[1].grpParams.grouping.groups;console.log("Tags Groups:\n"+JSON.stringify(o,null,2));for(let n=0;n<o.length;n++){let i=[];for(let e=0;e<o[n].object.length;e++)i.push(o[n].object[e].object);e=o[0].predicate,t.grouping.push({predicate:o[n].predicate,tags:i})}}Object.keys(t).length&&(console.debug("Grp open:\n "+JSON.stringify(t)),u.addCommandHit("openWithGrouping",e))}return t},y.prototype.organizeWithBS=async function(e){let t=this.getSelectedNodes()[0];if(void 0===t)return;let o={node:t,predicate:0===e.predicate.length?void 0:{name:e.predicate,label:e.label}};console.groupCollapsed("TreeDocGrouping:organizeWithBS## "+o.node.getLabel());let n=o.node.getOccurencePath(),i=n.length,s=n.join("/");console.log("Node level ["+i+"] occPath="+s),console.debug("BS to organize with: ["+JSON.stringify(o.predicate)+"]"),this.options.mappedNodes.set(s,{predicate:o.predicate}),!0===this.options.groupingFilterInProgress?console.debug(" = Grouping with filter in progress"):(this.options.groupingFilterInProgress=!0,void 0!==o.predicate?(u.addCommandHit("organizeWithBS",o.predicate.name),await this.__retrieveBSOnNode(o)):(u.addCommandHit("removeOrganize",""),console.debug("== No BS applied"),this.removeGrouping({selectedNode:o.node})),this.options.groupingFilterInProgress=!1),console.groupEnd()},y.prototype.__retrieveBSOnNode=async function(t){var o=t.node;console.log("== Retrieve BS on node "+o.getLabel()),o.hasChildren()&&o.removeChildren(),o.setState({state:"expanding"}),l.getBSDGroupOnInstances||await i.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});let n=o.getOccurencePath().join("/"),r=this.options.mappedNodes.get(n).predicate;s.addBIColumn(r.name,!0);var d={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,data:{},pathIds:[o.getOccurencePath()],predicate:r.name,is2D:!0};let c=await l.getBSDGroupOnInstances(d);(c="string"==typeof c?JSON.parse(c):c).errors&&a.displayNotif({message:e.organizeBS.errorRetrieveBS,level:"error",key:"xNavDoc-organizeBS"}),c.results&&await this.__buildBSOnNode(o,c,r)},y.prototype.__buildBSOnNode=async function(t,o,n){let i=t.getOccurencePath().join("/"),s=this.options.mappedNodes.get(i);var r={},l=[];s.mapBSNodes=r;let d=!1;for(let e=0;e<o.results.length;e++)if(o.results[e].synthesis){var p=o.results[e].synthesis&&o.results[e].synthesis.facets?o.results[e].synthesis.facets:[];if(p.length){d=!0;for(let e=0;e<p.length;e++){var u=p[e];u.sixw&&this.__buildBSStructure(u,t,r,s)}}}else l.push(o.results[e]);t.withTransactionUpdate(async()=>{if(!1===d?(a.displayNotif({title:e.replace(e.organizeBS.groupBy,{label:s.predicate.label}),message:e.replace(e.organizeBS.noBSGroup,{label:t.getLabel()})}),this.options.mappedNodes.delete(i),t.setState({state:"collapsed"})):(t.updateOptions({grid:{bsApplied:s.predicate.name}}),t.updateOptions({grid:{groupApplied:!0}}),this.options.mappedNodes.set(i,s),t.setState({state:"expanded"})),l.length){let e=t.getRoot();await c.parseExpandOcc({treeDoc:this,expandedNodes:[t],FBIProxy:this.options.FBIProxy,wsResponse:o,nodeModelClass:this.options.nodeModelClass,expandLevel:1,expandLevelRequest:parseInt(1),filter:e.options.filtered})}})},y.prototype.__buildBSStructure=function(e,t,n,i){var s=e.sixw.split("/"),a=s[s.length-1],l=h.splat(e.object),d=t,c="";for(let e=0;e<l.length;e++){if(n[c+=l[e]])d=n[c];else{var p=new o({isGroupingNode:!0,resourceid:"xnav-BSDNode-"+l[e]+"-"+d.getID(),label:l[e],grid:{groupValue:l[e]},parentNode:d,ds6w:a,grp:l.slice(0,e+1),bsIntent:i});r.updateNLSGroupingNode(p),d.addChild(p),n[c]=p,d=p}c+="/"}},y.prototype.__expandBSGrpNode=async function(e){var t=e.data,o=t.nodeModel,n=!!t.expandAll&&t.expandAll,i=t.state?t.state:"expanded",r=parseInt("1");let a=s.createOutputsRequest();if(!0!==o.getReferenceValue("groupExpanded")){let e={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,expandLevel:r,data:{select_bo:a.select_object,select_rel:a.select_relation,compute_select_bo:a.select_file},pathIds:[o.getOccurencePath()],bsGrp:{predicate:o.options.ds6w,nodePath:o.options.grp},withOccResponse:!0};try{let t=o.getRoot(),n=await l.expandBSNode(e);n="string"==typeof n?JSON.parse(n):n,await c.parseExpandOcc({treeDoc:this,expandedNodes:[o],FBIProxy:this.options.FBIProxy,wsResponse:n,nodeModelClass:this.options.nodeModelClass,expandLevel:1,expandLevelRequest:parseInt(1),filter:t.options.filtered}),o.updateOptions({grid:{groupExpanded:!0}})}catch(e){console.log("== Failed to expand BS node "+o.getLabel())}}if(n){let e=[],t=o.getChildren();for(let o=0;o<t.length;o++)!0===t[o].isGroupingNode&&e.push(this.__expandBSGrpNode({data:{nodeModel:t[o],expandAll:!0,state:i}}));await Promise.all(e)}o.setState({state:"expanded"})},y.prototype.__getBSForNode=function(e,t,o){let n,i=t.predicate,s=o.getReferenceValue(i.name+"-Instance");if(void 0!==s&&void 0!==t.mapBSNodes[s]&&(n=t.mapBSNodes[s]),n){n.setState({state:e||"partiallyExpanded"});let t=n.getParent();for(;t.isGroupingNode;)"collapsed"===t.getState()&&t.setState({state:e||"partiallyExpanded"}),t=t.getParent()}return n},y.prototype.__expandGrpNode=async function(e){return void 0!==e.data.nodeModel.options.bsIntent?this.__expandBSGrpNode(e):this.__expandTagGrpNode(e)},y.prototype.__expandAllGroupsCmd=async function(){return new Promise(t=>{this.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.expandAllGroupsCmd,context:this});let o=this.getSelectedNodes();var n=[];this.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)!0===o[e].isGroupingNode&&n.push(this.__expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:"expanded"}}))}),Promise.all(n).then(()=>{this.getModelEvents().publish({event:"endBlockingTransaction",context:this}),t()})})},y.prototype.__retrieveGrpOnNode=async function(e){var t=e.node;console.log("== Retrieve groups on node "+t.getLabel()),t.hasChildren()&&t.removeChildren(),t.setState({state:"expanding"}),l.getGroupingNodes||await i.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});let o=t.getOccurencePath().join("/"),n=this.options.mappedNodes.get(o).grpParams.grouping.groups;var r=[];for(let e=0;e<n.length;e++)r.push(n[e].predicate),s.addBIColumn(n[e].predicate,!0);var a={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,data:{},pathIds:[t.getOccurencePath()],grouping:{groups:n},is2D:!0,filter_facets:r};let d=await l.getGroupingNodes(a);d="string"==typeof d?JSON.parse(d):d,await this.__buildGrpsOnNode(t,d,n)},y.prototype.__expandTagGrpNode=async function(e){var t=e.data,o=t.nodeModel,n=!!t.expandAll&&t.expandAll,i=t.state?t.state:"expanded",r=parseInt("1");let a=s.createOutputsRequest(),d=p.getWebAPI_Options("navigate");var u=[];if(u[0]={},u[0].predicate=o.options.groupingIntent[0].predicate,u[0].predLevel=o.options.groupingIntent[0].predLevel,u[0].other=o.options.isOther,!0!==o.getReferenceValue("groupExpanded")){var h=o.getGroups();if(o.options.isOther){var g=[];for(let e=0;e<h.length;e++)g.push({object:h[e]});0==g.length&&(u[0].other=!0,g.push(o.options.groupingIntent[0].object[0].object)),u[0].object=g}else o.options.merged?u[0].object=o.options.groupingIntent[0].object:u[0].object=[{object:h}];let e={filterBI:this.options.filterBI?this.options.filterBI:this.options.FBIProxy._biFilter,expandLevel:r,data:{select_bo:a.select_object,select_rel:a.select_relation,compute_select_bo:a.select_file},pathIds:[o.getOccurencePath()],iterativeFilter:d["q.iterative_filter_query_bo"],filterRel:d.no_type_filter_rel,groupingFilter:u,withOccResponse:!0};try{let t=o.getRoot(),n=await l.expandGroupingNodeV2(e);n="string"==typeof n?JSON.parse(n):n,await c.parseExpandOcc({treeDoc:this,expandedNodes:[o],FBIProxy:this.options.FBIProxy,wsResponse:n,nodeModelClass:this.options.nodeModelClass,expandLevel:1,expandLevelRequest:parseInt(1),filter:t.options.filtered}),o.updateOptions({grid:{groupExpanded:!0}})}catch(e){console.log("== Failed to expand grouping node "+o.getLabel())}}if(n){let e=[],t=o.getChildren();for(let o=0;o<t.length;o++)!0===t[o].isGroupingNode&&e.push(this.__expandTagGrpNode({data:{nodeModel:t[o],expandAll:!0,state:i}}));await Promise.all(e)}o.setState({state:"expanded"})},y.prototype.__getGroupForNode=function(e,t,o){let n,i=t.grpParams.grouping.groups[0].predicate,s=o.getReferenceValue(i);void 0===s&&(s=o.getReferenceValue(i+"-Instance")),void 0===s||s.indexOf(",")>0?(t.mapGrpNodes.other||this.__createOtherNode(t.mapGrpNodes,t.grpParams.node,i,[],t.grpParams.grouping.groups,t),n=t.mapGrpNodes.other):void 0===s||void 0===t.mapGrpNodes[s]?(t.mapGrpNodes.other||this.__createOtherNode(t.mapGrpNodes,t.grpParams.node,i,[],t.grpParams.grouping.groups,t),n=t.mapGrpNodes.other):n=t.mapGrpNodes[s],n.setState({state:e||"partiallyExpanded"});let r=n.getParent();for(;r.isGroupingNode;)"collapsed"===r.getState()&&r.setState({state:e||"partiallyExpanded"}),r=r.getParent();return n},y.prototype.__applyGroupingTagger=async function(e){let t=this.getRoots(),o=[];!0===e.fromGroupingEvent&&(e.groups.length>0?this.options.activeGroupingTagger=e:delete this.options.activeGroupingTagger);for(let n=0;n<t.length;n++){let i={node:t[n],grouping:JSON.parse(JSON.stringify(e))};o.push(await this.applyGroupingOnNode(i))}Promise.all(o).then(()=>{n.publish({event:"ENXModel/Model/ApplyGrouping/Done",data:{fromEvent:!0,status:!0}})})},y.prototype.__buildTagLst=async function(e,t){var o=[],n=[],i=[];for(let e=0;e<t.length;e++)for(let a=0;a<t[e].object.length;a++)if(Array.isArray(t[e].object[a].object)){var s="",r=t[e].object[a].object;for(let e=0;e<r.length;e++)s+=r[e],-1===o.indexOf(s)&&o.push(s),s+="/";let i=t[e].object[a].object.join("/");n.push(i)}else{let s=[t[e].object[a].object];if(Array.isArray(t[e].object[a].merged))for(let o=0;o<t[e].object[a].merged.length;o++)s.push(t[e].object[a].merged[o].object),i[t[e].object[a].merged[o].object]=t[e].object[a].object;o=o.concat(s),n=n.concat(s)}o=o.filter((e,t)=>o.indexOf(e)===t),n=n.filter((e,t)=>n.indexOf(e)===t);let a=this.options.mappedNodes.get(e);a.selectedTags=o,a.realSelectedTags=n,a.mergedMap=i,this.options.mappedNodes.set(e,a)},y.prototype.__buildGrpsOnNode=async function(e,t,o){let n=e.getOccurencePath().join("/"),i=this.options.mappedNodes.get(n);var s={},r=i.mapGrpNodes={},a=[],l=[];for(let n=0;n<t.results.length;n++)if(t.results[n].synthesis){var d=t.results[n].synthesis&&t.results[n].synthesis.facets?t.results[n].synthesis.facets:[];let l=o[0].object.map(e=>e.object);if((d=d.slice().sort(function(e,t){return l.indexOf(e.object)-l.indexOf(t.object)})).length)for(let t=0;t<d.length;t++){var c=d[t];if(c.sixw){var p=c.sixw.split("/"),u=p[p.length-1];!0===x?this.__buildFlatGrping(c,e,s,a,r,o,i):this.__buildStructuredGrping(c,e,s,a,r,o,i)}}else t.results[n].synthesis.name.contains("OtherSynthesis")&&t.results[n].synthesis.value>0&&this.__createOtherNode(r,e,u,a,o,i)}else l.push(t.results[n]);e.withTransactionUpdate(()=>{e.setState({state:"expanded"}),e.updateOptions({grid:{groupApplied:!0}}),this.options.mappedNodes.set(n,i)})},y.prototype.__buildStructuredGrping=function(e,t,n,i,s,a,l){var d=e.sixw.split("/"),c=d[d.length-1],p=h.splat(e.object),u=t,g="",f="";l.mergedMap[g]&&(g=l.mergedMap[g]);var v=l.realSelectedTags,m=l.selectedTags;for(let e=0;e<p.length&&(g+=p[e],-1!==m.indexOf(g)||!0===u.isGroupingNode&&u.isGrpSelected());e++){if(l.mergedMap[g]&&(f=g,g=l.mergedMap[g]),n[g])u=n[g],l.mergedMap[f]&&(u.options.merged=!0,u.options.grp=u.options.grp.concat(p),i.push(p));else{var b=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+p[e]+"-"+u.getID(),label:p[e],grid:{groupValue:p[e]},parentNode:u,ds6w:c,grp:p.slice(0,e+1),groupingIntent:a});i.push(p.slice(0,e+1)),r.updateNLSGroupingNode(b),u.addChild(b),(-1!==v.indexOf(g)||!0===u.isGroupingNode&&u.isGrpSelected())&&(-1!==v.indexOf(g)&&(b.options.grpSelected=!0,!0===u.isGroupingNode&&(u.options.contentRetrieved=!0,A(u))),s[g]=b),n[g]=b,u=b}g+="/"}},y.prototype.__buildFlatGrping=function(e,t,n,i,s,a,l){var d=e.sixw.split("/"),c=d[d.length-1],p=h.splat(e.object),u=t,g=p.join("/");l.mergedMap[g]&&(g=l.mergedMap[g]);var f,v=l.realSelectedTags,m=null;for(let e=0;a&&e<a.length;e++){let t=a[e];if(t.object)for(let e=0;e<t.object.length&&null===m;e++)t.object[e].object===g&&(m=t.object[e])}if(-1!==v.indexOf(g)||!0===u.isGroupingNode&&u.isGrpSelected())if(n[g])(f=n[g]).options.merged=!0,f.options.grp=f.options.grp.concat(p),i.push(p);else{var b=p[p.length-1];f=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-"+b+"-"+u.getID(),label:m?m.dispText:b,dispText:m?m.dispText:void 0,grid:{groupValue:b,count:e.count},parentNode:u,ds6w:c,grp:p,groupingIntent:a}),i.push(p),r.updateNLSGroupingNode(f),u.addChild(f),f.options.grpSelected=!0,s[g]=f,n[g]=f}else if(function(e,t){for(var o=null,n=e.length-1;n>=0;n--){var i=e.slice(0,n);if(-1!==t.indexOf(i.join("/"))){o=i;break}}return o}(p,v)){var _=e.object.slice(0,e.object.length-1);if(!(u=s[_.join("/")])){var D=UWA.clone(e);D.object=_,u=this.__buildFlatGrping(D,t,n,i,s,a,l)}f=this.__buildFlatGrping(e,u,n,i,s,a,l)}return f},y.prototype.__groupsLayoutCmd=async function(e){let t;switch(e.mode){case _:t=!1;break;default:case D:t=!0}if(t!==x&&(x=t,this.options.mappedNodes.size)){let e=[];for(let[t,o]of this.options.mappedNodes)if(-1===e.indexOf(t)){e.push(t);let n=o.grpParams.node,i=o.grpParams.grouping;await this.removeGrouping({selectedNode:n});let s={node:n,grouping:i};await this.applyGroupingOnNode(s)}}},y.prototype.__createOtherNode=function(t,n,i,s,r,a){var l=new o({isGroupingNode:!0,resourceid:"xnav-groupingNode-other-"+ +n.getID(),label:e.groupingNode.other,grid:{groupValue:e.groupingNode.other},parentNode:n,isOther:!0,ds6w:i,grp:s,groupingIntent:r});return t.other=l,n.addChild(l),l},y.prototype.__focusOnGroupsCmd=async function(){return new Promise(t=>{this.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.focusOnGroupsCmd,context:this});let o=this.getSelectedNodes(),n=[];var i=[];this.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)if(!0===o[e].isGroupingNode){n.push(o[e]);let t="expanded"===o[e].getState()?"expanded":"collapsed";i.push(this.__expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:t}}))}}),Promise.all(i).then(()=>{this.withBroadcastSelect(()=>{for(let e=0;e<n.length;e++)n[e].unselect(),C(n[e]);this.getModelEvents().publish({event:"endBlockingTransaction",context:this}),u.addCommandHit("focusOnGroupsCmd",n.length),t()})})})},y.prototype.__colorizeGroupCmd=async function(){return new Promise(t=>{this.getModelEvents().publish({event:"beginBlockingTransaction",data:e.groupingNode.colorizeGroupCmd,context:this});let o=this.getSelectedNodes(),n=[];var i=[];this.withTransactionUpdate(()=>{for(let e=0;e<o.length;e++)if(!0===o[e].isGroupingNode){n.push(o[e]);let t="expanded"===o[e].getState()?"expanded":"collapsed";i.push(this.__expandGrpNode({data:{nodeModel:o[e],expandAll:!0,state:t}}))}}),Promise.all(i).then(()=>{var e=[];for(let t=0;t<n.length;t++){var o=P(n[t]);e.push({groupNode:n[t],groupedPhysNode:o})}this.__buildEnrich3DColorize({colorizedGroups:e}).then(e=>{g.publish("DS/ENO/enrich3D",e),this.getModelEvents().publish({event:"endBlockingTransaction",context:this}),u.addCommandHit("focusOnGroupsCmd",n.length),t()})})})},y.prototype.__buildEnrich3DColorize=function(t){return new Promise((o,n)=>{var i;if(t.colorizedGroups){this.options.coloredGroups||(this.options.coloredGroups={});for(let e=0;e<t.colorizedGroups.length;e++){var s=t.colorizedGroups[e];if(!this.options.coloredNodes.get(s.groupNode.getID())){var a=Object.keys(this.options.coloredGroups),l=s.groupedPhysNode.map(e=>e.getOccurencePath());if(void 0!==typeof l&&l.length>0){let e=this.__getNextColor();s.groupNode.updateOptions({color:e});var d=s.groupNode.getLabel(),c=this.options.coloredNodes.size?this.options.coloredNodes.size+1:1;this.options.coloredNodes.set(s.groupNode.getID(),{coloredGprNode:s.groupNode,groupLabel:d,paths:l,style:s.style?s.style:{color:e,opacity:1,forceInherit:!0,label:d,id:c}})}}}}else this.options.coloredNodes.clear();if(this.options.coloredNodes.size){a=Array.from(this.options.coloredNodes.keys());var p=this.options.coloredNodes.get(a[0]).coloredGprNode.getPredicate();r.retrieveDS6WNLS([p]).then(t=>{var n=t&&t[p]?t[p].label:p;i={deleteOnUnlink:!0,cumulativeMode:!0,originWidgetId:f.getWidgetId(),graphicProperties:{kinds:[{AMD:"DS/ENOPAD3DViewer/views/PADLayerGroupingView",kind:"grouping"}],layers:[]}};var s={label:n,kind:"grouping",type:"grouping",id:a[0],styles:[{color:"#FFFFFF",opacity:.5,forceInherit:!1,label:e.groupingNode.nomatch,id:0}],colorMap:[{resourceid:this.options.coloredNodes.get(a[0]).paths[0][0],style:0}]};for(let e=0;e<a.length;e++){let t=this.options.coloredNodes.get(a[e]);s.styles.push(t.style);for(let e=0;e<t.paths.length;e++){let o=t.paths[e],n=w(this.getNodeByOccurencePath(o)),i=n.options.color;!n||n.getID()!==t.coloredGprNode.getID()&&i||s.colorMap.push({path:o,style:t.style.id})}}i.graphicProperties.layers.push(s),o(i)})}})};var N=0;function C(e){var t=e.getChildren();for(let e=0;e<t.length;e++)!0===t[e].isGroupingNode?C(t[e]):t[e].select()}function P(e){var t=[],o=e.getChildren();for(let e=0;e<o.length;e++)!0===o[e].isGroupingNode?t=t.concat(P(o[e])):t.push(o[e]);return t}function w(e){let t=null;for(;e.getParent()&&null===t;)(e=e.getParent()).isGroupingNode?t=e:w(e);return t}function A(e){for(var t=e;t&&!t.isRoot()&&!0===t.isGroupingNode;)t.expand(),t=t.getParent()}return y.prototype.__getNextColor=function(){let e;if(this.options.usedColor||(this.options.usedColor=[]),this.options.usedColor.length+1<S.colorStream.length)e=S.colorStream[this.options.usedColor.length],this.options.usedColor.push(e);else{e=function(e,t,o){o/=100;const n=t*Math.min(o,1-o)/100,i=t=>{const i=(t+e/30)%12,s=o-n*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*s).toString(16).padStart(2,"0")};return`#${i(0)}${i(8)}${i(4)}`}(N*goldenAngle,100,75),N++}return e},y.prototype.__removeColorGroupCmd=function(){let e=Array.from(this.options.coloredNodes.keys());g.publish("DS/ENO/enrich3D",{deleteLayers:[e[0]]});for(let t=0;t<e.length;t++)this.options.coloredNodes.get(e[t]).coloredGprNode.updateOptions({color:null});N=0,this.options.coloredNodes.clear(),delete this.options.usedColor},y}),define("DS/ENXNav/models/xNavTreeDocOcc",["DS/TreeModel/TreeDocument","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/models/mixins/TreeDocSelect","DS/ENXNav/models/mixins/TreeDocProxy","DS/ENXNav/models/mixins/TreeDocAccess","DS/ENXNav/models/mixins/TreeDocShared","DS/ENXNav/models/mixins/TreeDocSupport","DS/ENXNav/models/mixins/TreeDocAdditionals","DS/ENXNav/models/mixins/TreeDocOccurenceIdx","DS/ENXNav/models/mixins/TreeDocGrouping","DS/PADUtils/PADTransactionManager","DS/PADServices/utils/GlobalModelEvents"],function(e,t,o,n,i,s,r,a,l,d,c,p){"use strict";function u(){}return u.prototype=Object.assign(u.prototype,n.prototype),u.prototype=Object.assign(u.prototype,o.prototype),u.prototype=Object.assign(u.prototype,i.prototype),u.prototype=Object.assign(u.prototype,s.prototype),u.prototype=Object.assign(u.prototype,r.prototype),u.prototype=Object.assign(u.prototype,a.prototype),u.prototype=Object.assign(u.prototype,d.prototype),u.prototype=Object.assign(u.prototype,l.prototype),u.prototype=Object.assign(u.prototype,{setFBIProxyOptions:function(e){this.options.FBIProxy=e.FBIProxy},applyActiveView:function(e){this.options.active_view=e},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},_shouldAcceptDrop:function(e){var t=e.dropPosition;return"top"!==t&&"bottom"!==t},_shouldAcceptDrag:function(e,t){return!0},createNodeModel:function(e){return new this.options.nodeModelClass(e)}}),e.extend(c,u,{init:function(e){this.version="2.0";var o=e||{};o.shouldBeSelected=function(e){return!0!==e.isRelationsObjectGroupingNode},UWA.is(o.shouldAcceptDrop)||(o.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),UWA.is(o.shouldAcceptDrag)||(o.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),o.nodeModelClass=t,o.showModelChanges=!1,this._parent(o),this.options.viewport={},this.initProxy(),this.initSelectCB(),p.subscribe({event:"ENXViews/Model/FindInCtx"},this.findInCtx.bind(this)),this.onPreExpand(this.onPreExpandChecker.bind(this)),p.subscribe({event:"ENXViews/Model/SelectFromTagger"},this.selectFromTagger.bind(this)),this.getModelEvents().subscribe({event:"addChild"},function(e){var t=e.data.nodeModel,o=e.parent.getChildren();t.options.grid.actualIndex=o.indexOf(t)}),this.initGrpV2(),this.initModelMap(),p.subscribe({event:"ENXModel/Model/CopyLink"},this.__copyLink.bind(this)),this.onNodeModelUpdate(()=>{p.publish({event:"ENXModel/NodeModelUpdate"})})},isEditor:function(){return!1}})}),define("DS/ENXNav/models/NodeUtils",["DS/PADServices/utils/Iterator","DS/ENXNav/models/SmartNodeOptions","DS/PADServices/utils/HideShowController","DS/PADServices/utils/Generics","DS/ENOXParser/modules/common/Constants"],function(e,t,o,n,i){function s(e,t){t.doUpdate&&e.push(t)}function r(a,l,d,c){d.isHiddenStateFrom!==o.FROMS.PGP&&(d.isHiddenState=o.STATES.SHOWN,d.isPADHidden=!1);let p=!1;c||(p=!0,c=[]);let u=d;if(p&&u.grid){let e=Object.keys(u.grid).filter(e=>e.includes("-Instance"));if(e.length){u=n.clone(d);for(let t=0;t<e.length;t++)delete u.grid[e[t]]}}let h=new t(l),g=l.options;if(g.grid&&g.grid["positionMatrix-Instance"]&&u.grid&&!u.grid["positionMatrix-Instance"]&&(u.grid["positionMatrix-Instance"]=null),h.update(u),s(c,h),d.children){let o=[];d.children.length>1&&d.children.sort(function(e,t){return e.relationOrder>t.relationOrder?1:e.relationOrder<t.relationOrder?-1:0}),e.iterate(d.children,function(n){var d=l.getChildNodesByRelId(n.relationid);d.length?function(o,n,i,a,l,d,c){e.iterate(n,function(e){if(e){let n=new t(e);n.update(o),s(c,n),r(a,e,o,c),i.push(e)}})}(n,d,o,a,0,0,c):function(e,t,o,n,s,a){e.children||(e.children=[],e.expandState=i.NODE_STATES.COLLAPSED.state);let l=n.addChild(e);r(o,l,e,a),t.push(l)}(n,o,a,l,0,c)});var f=l.getChildren();let n=[];f&&(n=f.filter(function(e){return-1===o.indexOf(e)})),e.iterate(n,function(e){l.removeChild(e)})}else l.hasChildren()&&l.removeChildren(!1);p&&a.withTransactionUpdate(()=>{a.withTransactionUpdate(()=>{e.iterate(c,function(e){e.execute()})})}),l.getExcludedOccurrences().length>0&&l.cleanUpPathes()}return{calculateRefresh:function(e){let t=-1;return e.processDescendants({processNode:function(){let e=this.getDepth();e>t&&(t=e)}}),t},setStateAndPad:function(e,t){e.setState(t),e.options.padgrid.state=t.state},refreshForRoot:function(e,o){let n=new t(e);n.update(o),n.execute()},recursiveUpdateForRefresh:r}}),define("DS/ENXNav/models/_xNavDocumentRefresh",["UWA/Class","UWA/Promise","DS/ENXNav/models/_xNavCVParser","DS/ENXNav/models/RefreshHandler","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWSAccess","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADProgressBar","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o,n,i,s,r,a,l,d,c){"use strict";var p=e.extend({});if(!0===s.getSetting("refresh_v2")){p.prototype.refresh=function(e){var t=c.refresh_ongoing,o=(e=e||{}).roots||this.getRoots();if((o=o.concat(this.getDetachedRoots())).length>0){var n=this;n._directSelection=!0,l.on(t),this.doRefreshCV(o).then(function(t){var o;l.off(),o=o||{msg:c.refresh_ok},void 0===e.cb?a.displayNotification(o):e.cb(o),setTimeout(function(){i.publish({event:"ENXModel/SyncModel",data:{refresh:!0}})},100)}).then(function(){n.getModelEvents().publish({event:"titleRecalc"})})}}}return p.prototype.doRefreshCV=function(e,o){var n=this;return new t(function(i,s){for(var r,a={},l={},d=[],c=0,p=0,u=0;u<e.length;u++)!0===e[u].options.filtered&&(l["BlockFilter_"+p]=[],l["BlockFilter_"+p].push({node:e[u],root:e[u]}),d.push(e[u].getID()),p++);for(u=0;u<e.length;u++){var h=e[u];!0!==e[u].options.filtered&&(0===u?r=a["Block_"+c]=[]:u>0&&u%8==0&&(r=a["Block_"+ ++c]=[]),!0===e[u].hasChildren()?e[u].processDescendants({processNode:function(){!1===this.hasChildren()&&r.push({node:this,root:h})}}):a["Block_"+c].push({node:h,root:h}))}for(var g=[],f=Object.getOwnPropertyNames(a),v=0,m=0;m<f.length;m++){(D=new t(function(t){v++;var i=a[f[m]],s=0;1===Math.floor(v/5)&&(s=2e3),setTimeout(function(){n._validateExpand(i,t,o,e)},s)})).name="Validate branch from root of "+f[m],g.push(D)}var b=Object.getOwnPropertyNames(l),_=0;for(m=0;m<b.length;m++){var D;(D=new t(function(e){_++;var t=l[b[m]],o=0;1===Math.floor(_/5)&&(o=2e3),setTimeout(function(){n._validateWithMultiExpandFiltered(t,e,!1)},o)})).name="Validate branch from root of "+b[m],g.push(D)}var S=new t(function(e){t.all(g).then(function(){[],[],i()})});S.name="Synchronisation of Validation",g.push(S)})},p.prototype._validateExpand=function(e,t,i,l){var d=this,p=new n({app_context:s.app_context,treeDocument:this}),u=[];if(null!=l&&l.forEach(function(e){for(var t=[e];t.length;){var o=t.pop();null!=o&&!0!==o.isRelationsObjectNode&&(u.push(o.getOccurencePath()),t=t.concat(o.getChildren()))}}),0!==u.length){d.prepareUpdate();var h=UWA.extend({intent:"explore_2D"},s.getWebAPI_Options("navigate"),!0),g=s.getSetting("enopad_webapis"),f={root_path_physicalid:u,expand_iter:"1",deepRefresh:!0,intent:h.intent,select_bo:h.select_bo,select_rel:h.select_rel,compute_select_bo:h.compute_select_bo,enopad_webapis:g,find_in_ctx:!1};r.refresh({data:f,onComplete:function(e){var n=UWA.is(e,"string")?JSON.parse(e):e;n.full_path=!0,o.process.expand({treedocument:d,root_nodes:l,starting_from_root:n.full_path,response:n,mode:"refresh",expand_level:1,security_counts_HTML:null}),p.complete(!0),t(),d.pushUpdate()},onFailure:function(o){for(var n=e.map(function(e){return e.root}).filter(function(e,t,o){return o.indexOf(e)==t}),i=!0,s=0;s<n.length;s++){var r=n[s],l=c.replace(c.refresh_node_failure,{name:r.getLabel()});a.displayNotification({msg:l,eventID:"warning",key:"enxNav-refresh"}),i=!1}i&&a.displayNotification({msg:c.refresh_failure,eventID:"error",key:"enxNav-refresh-failure"}),p.complete(!1),t(),d.pushUpdate()}})}},p.prototype._validateRefresh=function(e,t,i,l){var d=this,p=new n({app_context:s.app_context,treeDocument:this}),u=[];null!=l&&l.forEach(function(e){for(var t=[],o=[e];o.length;){var n=o.pop();null!=n&&(t.push(n.getOccurencePath()),o=o.concat(n.getChildren()))}u.push(t)});var h=UWA.extend({intent:"explore_2D"},s.getWebAPI_Options("navigate"),!0),g=s.getSetting("enopad_webapis");d.prepareUpdate();var f={session:u,intent:h.intend,debug:!1,include_param_Attributes:!0,select_bo:h.select_bo,select_rel:h.select_rel,compute_select_bo:h.compute_select_bo,enopad_webapis:g,find_in_ctx:!1,type_filter_bo:s.getSetting("type_filter_bo")};r.refresh({data:f,onComplete:function(e){var n=UWA.is(e,"string")?JSON.parse(e):e;o.process.expand({treedocument:d,root_nodes:l,starting_from_root:n.full_path,response:n,mode:"refresh",expand_level:1,security_counts_HTML:null}),p.complete(!0),t(),d.pushUpdate()},onFailure:function(o){for(var n=e.map(function(e){return e.root}).filter(function(e,t,o){return o.indexOf(e)==t}),i=!0,s=0;s<n.length;s++){var r=n[s],l=c.replace(c.removeNodeWithRefresh,{name:r.getLabel()});a.displayNotification({msg:l,eventID:"warning",key:"enxNav-refresh"}),i=!1,d.removeRoot(r,!1)}i&&a.displayNotification({msg:c.refresh_failure,eventID:"error",key:"enxNav-refresh-failure"}),p.complete(!1),t(),d.pushUpdate()}})},p.prototype._validateWithMultiExpandFiltered=function(e,t,i){for(var l=this,p=UWA.extend({intent:"explore_2D"},s.getWebAPI_Options("navigate"),!0),u=s.getSetting("enopad_webapis"),h={select_bo:p.select_bo,select_rel:p.select_rel,compute_select_bo:p.compute_select_bo,union:{expand:[]}},g=new n({app_context:s.app_context,treeDocument:this}),f=[],v=[],m=0;m<e.length;m++){var b,_=e[m],D=_.root;-1===f.indexOf(D.getID())?(f.push(D.getID()),v.push(D),b={root_path_physicalid:[],no_type_filter_rel:p.no_type_filter_rel,"q.iterative_filter_query_bo":p["q.iterative_filter_query_bo"]},D&&D.options.sequence_filter&&(b.sequence_filter=D.options.sequence_filter),D&&D.options.config_filter&&(b.config_filter=D.options.config_filter),b.expand_iter="-1",h.union.expand.push(b)):b=h.union.expand[f.indexOf(D.getID())],b.root_path_physicalid.push(_.node.getOccurencePath())}l.prepareUpdate(),r.multiexpand({enopad_webapis:u,data:h,onComplete:function(n){try{var s=UWA.is(n,"string")?JSON.parse(n):n;o.process.validateMultiExpand({treedocument:l,response:s,forcePartiallyExpanded:"boolean"!=typeof i||i,treatedNodes:e,isFilter:!0,onComplete:function(e){e.nodes2relaunch.length?l._validateWithMultiExpandFiltered(e.nodes2relaunch,t,i):(g.complete(!0),t())}})}catch(e){a.displayNotification({msg:d.generic_service_failure,eventID:"error",key:"enxNav-generic-service-failure"})}finally{v.forEach(function(e){e.childComputed=!0;var t=UWA.clone(e.options.icons[0]);t.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},e.updateOptions({icons:[t]})}),l.pushUpdate()}},onFailure:function(){for(var o=e.map(function(e){return e.root}).filter(function(e,t,o){return o.indexOf(e)==t}),n=!0,i=0;i<o.length;i++){var s=o[i],r=c.replace(c.removeNodeWithRefresh,{name:s.getLabel()});a.displayNotification({msg:r,eventID:"warning",key:"enxNav-refresh"}),n=!1,l.removeRoot(s,!1)}n&&a.displayNotification({msg:c.refresh_failure,eventID:"error",key:"enxNav-refresh-failure"}),g.complete(!1),t(),l.pushUpdate()}})},p}),define("DS/ENXNav/models/xNavDocument",["UWA/Core","DS/Logger/Logger","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/TreeModel/TreeDocument","DS/ENXNav/models/_xNavGrouping","DS/ENXNav/models/_xNavDocumentRefresh","DS/ENXNav/models/xNavNodeModel","DS/ENXNav/models/_xNavCVParser","DS/PADServices/utils/HideShowController","DS/ENXNav/models/AdditionalRelDummyInfo","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPredicatesNls","DS/PADUtils/views/PADAlert","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADTransactionManager","DS/PADUtils/PADSession","DS/PADUtils/PADProbes","DS/PADUtils/views/PADPager","DS/PADUtils/Utility","DS/PADServices/utils/GlobalModelEvents","DS/ENXNav/models/mixins/TreeDocShared","DS/ApplicationFrame/CommandsManager","DS/ENXNav/utils/TwoDAppEvents","DS/ENOXParser/modules/common/Helpers","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f,v,m,b,_,D,S,x,y,N,C,P){"use strict";function w(e){e.preExpandDone({preventExpandAll:!1,state:"collapsed"})}function A(e){var t=x.getCommand("ExpandAll");t&&(e?t.enable():t.disable())}function I(e){e.hasChildren()&&e.setState({state:"partiallyExpanded"})}function E(e){for(var t=0;t<e.length;t++){var o=e[t];I(o),o.childComputed=!1,o.processDescendants({processNode:function(e){I(this),this.childComputed=!1}})}}var O={add_objects_when_select:void 0,authorizeChangeControl:void 0,CfgAuthoringContext:void 0};function M(){}return M.prototype=Object.assign(M.prototype,S.prototype),i.extend(f,r,s,M,{_broadcastSelect:!0,_selected_paths:[],id:"mainNodeModel",_insertFlag:!1,_pagerview:null,_selection:[],_selectedIdx:null,_focusOn:!1,_reframeFocus:!1,_currentApp:null,_emptyFromProxy:!1,_isVolumeFilter:!1,init:function(i){var s=i||{},r=this;if(s.shouldBeSelected=function(e){return!0!==e.isRelationsObjectGroupingNode},this._logger=t.getLogger("DS/ENXNav/models/xNavDocument"),e.is(s.shouldAcceptDrop)||(s.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),e.is(s.shouldAcceptDrag)||(s.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),r.renderTo=i.renderTo?i.renderTo:document.body,s.nodeModelClass=a,this._parent(s),this.options.viewport={graph:null,tree:null},this.onPreExpand(this.innerExpandChecker.bind(this)),this.isAdditionalColumnsVisible=function(){return!1},this.forceSyncModel4TreeListView=function(){},this.addEvent("onTransactionEnd",function(e,t){t||(r.getModelEvents().publish({event:"setPathTags",context:r}),r.fromTransactionEnd=!0)}),this.onPostCollapse(this._colorize3D.bind(this)),!e.is(s.remove_broadcast)||!0===s.remove_broadcast){r._commandProxy=g.create({events:{onSelect:function(t,i){if(!r._insertFlag&&!0!==t.searchDone){if(1==t.focusOn&&t.sharedID&&t.sharedID!==n.getSharedId())return;var s=!1,a=t.paths;r._selected_paths=e.clone(a);var l=function(){try{r._doNotBroadcastSelect=!0,r._selected_paths.length?r._selectOccurence("",!0,!0):i.appid===g.appId()&&(r._emptyFromProxy=!0,r.unselectAll(),r._directSelection=!1);for(var e=[],t=0;t<r._selected_paths.length;t++){r.getNodeByOccurencePath(r._selected_paths[t])&&e.push(r._selected_paths[t])}if(e.length===a.length&&e.length>0)for(var o=0;o<e.length&&!s;o++){var n=e[o].length;if(n>2){var l=r.getNodesById(e[o][n-3]);l&&l.length>0&&(s=!0)}}r._selected_paths=e}finally{setTimeout(function(){r._doNotBroadcastSelect=!1},500)}};l(),!0!==t.doNotSetOnCompass&&!0===o.getSetting("add_objects_when_select")&&a.length&&i.appid===g.appId()&&!0!==r._hideChildrenFilter&&!s&&(r._selected_paths=a,r.insertBranches(t.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){let e=t.paths;for(let t=0;t<e.length;t++){let o=e[t],n=r.getNodesById(o[0]);n.length&&(n[0].childComputed=!1)}l()}}))}},onChangeControlDlgOpen:function(e){"3D"===e.widget&&o.setSetting("changeControlDlgOpen",e.isOpen)},onReframeSelection:function(){null!==r._pagerview&&(r._pagerview.hide(),delete r._pagerview)},onFocus:r._onFocus.bind(r),onFocusChange3D:function(e){e.sharedID===n.getSharedId()&&r.focusChange(e)},onShow:function(e){r._logger.log("_commandProxy.onShow");var t=[];r.withTransactionUpdate(function(){e.paths.forEach(function(e){var o=r.getNodeByOccurencePath(e);if(o){o.updateOptions({isPADHidden:!1}),t.push(o)}})}),D.publish({event:"ENXModel/hideShowState",target:t,data:{toggle:"show",nobroadcast:!e.from2D}}),D.publish({event:"ENXModel/HideShowTriggered",data:{name:"show"}})},onHide:function(e){var t=[];r._doNotBroadcastSelect=!0,r.insertBranches(e.paths,{node_state:"collapsed",forceCollapsed:!0,novalidation:!0,onComplete:function(){r.withTransactionUpdate(function(){e.paths.forEach(function(e){var o=r.getNodeByOccurencePath(e);if(o){o.updateOptions({isPADHidden:!0}),t.push(o)}})}),D.publish({event:"ENXModel/hideShowState",target:t,data:{toggle:"hide",nobroadcast:!e.from2D}})}}),r._doNotBroadcastSelect=!1,D.publish({event:"ENXModel/HideShowTriggered",data:{name:"hide"}})},onUpdate2DPosMatrix:function(e){if(!r.getXSO().isEmpty()){r.prepareUpdate();for(var t=0;t<e.instances.length;t++)for(var o=r.getNodesByRelId(e.instances[t].instance),i=0;i<o.length;i++){var s=e.instances[t].hasPositioningMatrix.join(),a={relationId:e.instances[t].instance,grid:{"positionMatrix-Instance":n.checkNotIdentity(s)?s:null}};o[i].updateOptions(a)}h.displayNotification({msg:C.pastePositionSucceeded,eventID:"info"}),r.pushUpdate()}},onUpdateViewPoint:function(e){r._viewPointCallback&&(r._viewPointCallback(e),r._viewPointCallback=null,this._viewPointTimer&&(clearTimeout(this._viewPointTimer),this._viewPointTimer=null))},onSendFilterInfo:function(){var e={filterAvailable:!1};!0===r._isVolumeFilter&&(e={filterAvailable:!0}),r._commandProxy.receiveFilterInfo(e)},onPadRefresh:function(e){if(!0===o.getSetting("activateFUN076708")){var t=function(t){var o=Object.getOwnPropertyNames(t);for(var n in o)"insertExisting"===o[n]?e.origin&&"CCP"===e.origin||r._viewInsertExisting(t.insertExisting):"detach"===o[n]?r._viewDetach(t.detach):"reParent"===o[n]?r._viewReParent(t.reParent):"replaceInstances"===o[n]?r.splitInstance(t.replaceInstances):"updateRevision"===o[n]&&r.updateRevision(t)};e.transactions?e.transactions.forEach(function(e){t(e)}):t(e)}}}});var l=function(){var e=r.getSelectedNodes();if(r.isGroupingApplied()){var t=[];for(let o=0;o<e.length;o++)!0!==e[o].isGroupingNode&&t.push(e[o]);e=t}r._doNotBroadcastSelect||(r._directSelection=!0,r._selected_paths=[],!0!==r.searchProgress&&!0!==r._focusOn&&!0!==r._insertOnFocus&&r._commandProxy.select(r._buildSelectData()),!0===r._broadcastSelect&&!0===r.options.authorize_setStructure&&(n.setObject_on_compass({nodes_2_open:e}),!1===o.getSetting("settypes")?n.setStructure_4_open_in_cv5({nodes_2_open:e,selected_paths:r._selected_paths}):n.setTypesForOFW(r))),0===e.length&&null!==r._pagerview&&!0!==r._focusOn&&!0!==r._reframeFocus&&(r._pagerview.hide(!0),delete r._pagerview,r._reframeFocus=!1)};this.getXSO().onPostAdd(function(){l(),r._focusOn=!1}),this.getXSO().onPostRemove?this.getXSO().onPostRemove(l):this.getXSO().onRemove(l),this.getXSO().onEmpty(function(){!1===r._emptyFromProxy?(!0!==r._forceDoNotBroadcastSelect?r._doNotBroadcastSelect=!1:delete r._forceDoNotBroadcastSelect,!0!==r._focusOn&&r.closePager()):r._emptyFromProxy=!1,l()}),this.getXSO().onPreEmpty(function(){!1===r._emptyFromProxy&&(r._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(e){27===e.keyCode&&(r.getXSO().empty(),r.restoreSelection())})}o.getSetting("activateFUN104935")&&this.getModelEvents().subscribe({event:"addChild"},function(e){var t=e.data.nodeModel,o=e.parent.getChildren();t.options.grid.actualIndex=o.indexOf(t)}),D.subscribe({event:"ENXViews/Model/FindInCtx"},this._findInCtx.bind(this)),D.subscribe({event:"ENXViews/Model/remove"},l),D.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGrouping.bind(this)),D.subscribe({event:"ENXModel/Model/ExpandAllGroups"},this.__expandAllGroupsCmd.bind(this)),D.subscribe({event:"ENXModel/Model/FocusOnGroups"},this.__focusOnGroupsCmd.bind(this)),D.subscribe({event:"ENXModel/Model/GroupsLayout"},this.__groupsLayoutCmd.bind(this)),n.subscribeCfgModifyEvent({handler:function(e){var t=e.commandName,o=e.response.results,n=[];switch(t){case"cfgExtendEvolutionEffectivity":(o=e.response.resources).forEach(function(e){"SUCCESS"===e.status&&e.identifier&&n.push(e.identifier)}),n.length&&r.refreshCfgValues({relids:n});break;case"cfgEditEvolution":case"cfgPasteEvolution":o.forEach(function(e){e.existing&&"SUCCESS"===e.status&&n.push(e.existing.pid)}),n.length&&r.refreshCfgValues({relids:n});break;case"cfgEditConfigurationContext":r.additionalColumnUpdateByModule("CfgConfigurationContextColumn",{pids:e.data.pids});break;default:var i,s=[];o.forEach(function(e){"SUCCESS"===e.status&&(e.new?(i={oldId:e.existing.pid,newId:e.new.pid},s.push(i)):n.push(e.existing.pid))}),s.length&&r.splitInstance({couples:s,editVariant:!0}),n.length&&r.refreshCfgValues({relids:n})}}}),D.subscribe({event:"ENXModel/Model/CopyLink"},this.__copyLink.bind(this))},broadcastSelect:function(e){this._broadcastSelect=e,!0===this._broadcastSelect&&!0===this.options.authorize_setStructure&&(n.setObject_on_compass({nodes_2_open:this.getSelectedNodes()}),!1===o.getSetting("settypes")?n.setStructure_4_open_in_cv5({nodes_2_open:this.getSelectedNodes(),selected_paths:this._selected_paths}):n.setTypesForOFW(this))},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){!0!==this.searchProgress&&this._commandProxy.select(this._buildSelectData()),this.broadcastSelect(!0),this._doNotBroadcastSelect=!1},setFilterBIProxy:function(e){this.options.filterBI=e},add:function(t){var n=this;n._directSelection=!0;var i=[],s={alreadyLoadedRoots:[]};e.is(t.pids,"array")&&t.pids.forEach(function(e){-1===i.indexOf(e)&&i.push(e)});for(var r=this.getRoots(),a=i.length,d=0;d<r.length;d++){var c=i.indexOf(r[d].options.resourceid);-1!==c&&(i.splice(c,1),s.alreadyLoadedRoots.push(r[d].options.resourceid))}if(n.detachedRoots&&n.detachedRoots.length>0)for(var u=0;u<n.detachedRoots.length;u++){var g=n.detachedRoots[u],f=i.indexOf(g.options.resourceid);f>-1&&(i.splice(f,1),s.alreadyLoadedRoots.push(g.options.resourceid))}if(i.length!==a&&h.displayNotification({msg:C.root_already_loaded}),i.length>0){var m=o.getWebAPI_Options("fetch");-1===m.select_predicate.indexOf("ds6w:type")&&m.select_predicate.push("ds6w:type"),-1===m.select_predicate.indexOf("ds6w:created")&&m.select_predicate.push("ds6w:created"),-1===m.select_predicate.indexOf("ds6w:modified")&&m.select_predicate.push("ds6w:modified");var b=v.isAuthoring();console.time("add-fetch"),p.fetch({enopad_webapis:o.getSetting("enopad_webapis"),data:m,pids:i,onComplete:function(r){console.timeEnd("add-fetch"),n.invalidateViewPort();var a=!1,d=e.is(r,"string")?JSON.parse(r):r;if(!d.results||d.results.length<i.length)if(!1===o.getSetting("enopad_webapis"))h.displayNotification({msg:C.object_not_found_in_db,eventID:"error",key:"enxNav-add-object-not-found-in-db"}),!a&&t.callback&&t.callback("error");else if(b)h.displayNotification({msg:C.object_not_found_in_db,eventID:"error",key:"enxNav-add-object-not-found-in-db"}),!a&&t.callback&&t.callback.call(null,s);else if(d.infos&&d.infos.sources&&d.infos.sources.length>0&&d.infos.sources[0].error){var c=d.infos.sources[0],p=c.error.errorMessage||"An error has occurred in "+c.name;h.displayNotification({msg:p,eventID:"error",key:"enxNav-add-error"}),!a&&t.callback&&t.callback.call(null,s)}else v.setAuthoringState(!0,C.PADSession_disabling_index_object_not_found),n.add(t),a=!0;else d.results.length>i.length?(h.displayNotification({msg:C.tooManyResults,eventID:"error",key:"enxNav-add-too-many-results"}),!a&&t.callback&&t.callback.call(null,s)):n.wrapInTransaction(function(){d.authoringMode&&!0===d.authoringMode&&v.setAuthoringState(!0,C.PADSession_disabling_index_from_server),l.process.fetch({treedocument:n,response:d,config_filter:t.config_filter,rootsWithFilters:t.rootsWithFilters,onComplete:function(){if(y.addRoot(),!a&&t.callback&&(t.callback.call(null,s),D.publish({event:"ENXModel/SyncModel",data:{what:"add"}})),n.isGroupingApplied()){for(var e=[],o=[],r=0;r<i.length;r++)if(-1===o.indexOf(i[r])){o.push(i[r]);var l=n.searchRootById(i[r]);l&&e.push(l)}n.__applyGrouping({roots:e,groups:n.options.groups})}},onFailure:function(e){console.error(e)}})})},onFailure:function(){h.displayNotification({msg:C.generic_service_failure,eventID:"error",key:"enxNav-add-generic-service-failure"}),t.callback&&t.callback("error")}})}else t.callback&&t.callback.call(null,s)},addPaths:function(t){var n=o.getWebAPI_Options("navigate");-1===n.select_bo.indexOf("ds6w:created")&&n.select_bo.push("ds6w:created"),-1===n.select_bo.indexOf("ds6w:modified")&&n.select_bo.push("ds6w:modified");var i=e.extend({root_path_physicalid:t.paths,expand_iter:"0",intent:"explore_2D"},n,!0),s={alreadyLoadedRoots:[]},r=this;r._directSelection=!0,i["q.iterative_filter_query_bo"]&&!0!==o.getSetting("globalTypeFiltering")&&delete i["q.iterative_filter_query_bo"];var a,d,c={};this.isGroupingApplied()&&(a=!0,d="collapsed"),c=!0===t.fromIndexFailure?t.ids:l.process.insert_temporary_branches({temporary_root:!0,treedocument:this,branches:t.paths,node_state:d,forceCollapsed:a}),s.alreadyLoadedRoots=c.rootsAlreadyLoaded;var u=t.paths.length;function g(){var o=function(){for(var o=[],n=0;n<t.paths.length;n++){if(-1===o.indexOf(t.paths[n][0])){var i=r.searchRootById(t.paths[n][0]);e.is(i)&&!0===i.options.waiting4validation&&o.push(t.paths[n][0])}for(var s=0;s<t.paths[n].length;s+=2){var a=t.paths[n][s],l=r.getNodesById(a);e.is(l,"array")&&l.forEach(function(t){if(!0===t.options.waiting4validation){var o=t.getParent();if(t.remove(),o&&!o.hasChildren()&&"noChildren"!==o.getState()&&e.is(o.setState,"function"))try{o.setState({state:"collapsed"}),o.options.children=[]}catch(e){console.error(e)}}})}}return o}();if(h.displayNotification({msg:C.allObjectCannotBeFound,eventID:"error",key:"enxNav-addPaths-all-object-not-found"}),t.callback){var n={};n.idleRootIds=o,n.success=!1,t.callback.call(r,n)}}function f(o){for(var n=[],i=0;i<t.paths.length;i++){if(-1===n.indexOf(t.paths[i][0])){var s=r.searchRootById(t.paths[i][0]);e.is(s)&&!0===s.options.waiting4validation&&n.push(t.paths[i][0])}for(var a=0;a<t.paths[i].length;a+=2){var l=t.paths[i][a],d=r.getNodesById(l);e.is(d,"array")&&d.forEach(function(t){if(!0===t.options.waiting4validation){var o=t.getParent();if(t.remove(),o&&!o.hasChildren()&&"noChildren"!==o.getState()&&e.is(o.setState,"function"))try{o.setState({state:"collapsed"}),o.options.children=[]}catch(e){console.error(e)}}})}}if(o&&o.removedByFilter?h.displayNotification({msg:C.cannot_insert_branch_filtered,eventID:"info"}):h.displayNotification({msg:C.cannot_insert_branch,eventID:"error",key:"enxNav-addPaths-cannot-insert-branch"}),t.callback){var c={};c.idleRootIds=n,c.success=!1,t.callback.call(r,c,"error")}}if(0===c.ids_to_fetch.length&&0===c.relationids.length){if(h.displayNotification({msg:C.root_already_loaded}),t.callback){t.callback.call(r,{sucess:!0},s)}}else{let n=s.alreadyLoadedRoots.map(function(e){return r.getNodesById(e)[0]}).filter(function(e){return!0===e.options.filtered}),a=n.length>0;if(a)for(let e=0;e<n.length;e++){let t=n[e];t.options&&t.options.sequence_filter&&(i.sequence_filter=t.options.sequence_filter),t.options&&t.options.config_filter&&(i.config_filter=t.options.config_filter)}var m=v.isAuthoring();console.time("addPaths"),p.navigate({enopad_webapis:o.getSetting("enopad_webapis"),data:i,onComplete:function(n){var i,d,p;try{console.timeEnd("addPaths");var h=e.is(n,"string")?JSON.parse(n):n;if(h.results)if(h.results.length>0&&!h.error){if(i=r.startTransaction("expand"),h.authoringMode&&!0===h.authoringMode&&v.setAuthoringState(!0,C.PADSession_disabling_index_from_server),l.process.validateAndUpdateBranches({treedocument:r,response:h,forcePartiallyExpanded:!0}),a)for(let e=0;e<roots.length;e++)N.node.setFilterBadge(roots[e]);if(y.addRoot(),(d=h.results,p=0,d.forEach(function(e){e.attributes&&p++}),p)<u)return t.fromIndexFailure?void g():!0!==o.getSetting("authoringModeNotSupported")&&!1===v.isAuthoring()?(v.setAuthoringState(!0,C.PADSession_disabling_index_object_not_found),t.fromIndexFailure=!0,t.ids=c,void r.addPaths(t)):void g();if(t.callback){var b={success:!0};if(t.callback.call(r,b,s),D.publish({event:"ENXModel/SyncModel",data:{what:"addPaths"}}),r.isGroupingApplied()){for(var _=[],S=[],x=t.paths,P=0;P<x.length;P++)if(-1===S.indexOf(x[P][0])){S.push(x[P][0]);var w=r.searchRootById(x[P][0]);w&&_.push(w)}r.__applyGrouping({roots:_,groups:r.options.groups})}}}else{if(a)return void f({removedByFilter:!0});!0!==o.getSetting("authoringModeNotSupported")&&!1===m?(v.setAuthoringState(!0,C.PADSession_disabling_index_object_not_found),t.fromIndexFailure=!0,t.ids=c,r.addPaths(t)):f()}else f()}catch(e){f()}finally{i&&i.end()}},onFailure:function(e){!0!==o.getSetting("authoringModeNotSupported")&&!1===v.isAuthoring()?(v.setAuthoringState(!0,C.PADSession_disabling_index_object_not_found),t.fromIndexFailure=!0,t.ids=c,r.addPaths(t)):f()}})}},innerExpandChecker:function(e){var t=e.data,n=t.nodeModel;if(!!t.expandAll&&t.expandAll&&!0===o.getSetting("activateSynthesisOnRoot")){var i=document.getElementsByClassName("enx-appMainBody");if(i&&1===i.length){i=i[0];var s=n.isRoot()?n:n.getRoot(),r=this;require(["DS/ENXNav/views/private/ExpandChecker"],function(t){t.check({targetDiv:i,roots:[s]}).then(function(t){!0===t.performExpandAll?r.xnav_expand(e):e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})})})}else this.xnav_expand(e)}else this.xnav_expand(e)},xnav_expand:function(t){var n=t.data,i=n.nodeModel,s=!!n.expandAll&&n.expandAll,r=null,a=!1,d="default",c=n.numberOfLevelsToExpand?n.numberOfLevelsToExpand.toString():o.getSetting("expand_iter");if(!0!==i.isGroupingNode&&void 0===i.options.fakeNodesTable){s&&(i._expandAllPending=!0,A(!1),this.isGroupingApplied()&&this.__expandAllGroups(i)),this.invalidateViewPort(),s&&(c="-1");var u=parseInt(c),g=o.getSetting("activateFUN085903")&&(-1===u||u>1),f=this;if((r=t.target.options.partialPreExpand)&&(a=!0,d="find_in_ctx",this.getXSO().empty()),i.childComputed&&!1===a){var m=i.getDepth();if(function(e,t,o){function n(e){if(e.childComputed&&e.hasChildren()){var t=e.getChildren();if(1===t.length){let o=!1,n=e.getReferenceValue("ds6w:kind");return!n||-1===n.indexOf("3DPart")||"ds6w:Document"!==t[0].getReferenceValue("ds6w:globalType")&&"ds6w:Document"!==t[0].getReferenceValue("ds6w:globaltype")||(o=!0),o}}}var i=function(e,t,o){if(-1===t||o<t){if(e.childComputed||!0===e.isGroupingNode){if(e.hasChildren()){for(var s=e.getChildren(),r=!0,a=0;a<s.length&&!0===r;a++){var l=s[a];if(!(l.childComputed&&g&&n(l))&&(l.childComputed&&"noExpandState"!==l._expandState&&(l.getDepth()<t||-1===t)?l.setState({state:"expanded"}):!0===l.isGroupingNode&&(l.setState({state:"expanded"}),-1!==t&&t++),l.childComputed&&"noChildren"===l.options.padstate&&!l.hasChildren()&&l.setState({state:"noChildren"}),void 0===(r=i(l,t,o+1))))throw new Error("Undefined no_expand_needed flag")}return r}return!0}return!(-1===t||t>o)}return!0};return i(e,t,o)}(i,s?parseInt(c):m+parseInt(c),m))return t.target.preExpandDone({preventExpandAll:!0}),f._selectOccurence(),delete i._expandAllPending,void A(!0)}var b=e.extend({root_physicalid:i.getID(),expand_iter:c,intent:"explore_2D"},o.getWebAPI_Options("navigate"),!0);!0!==o.getSetting("globalTypeFiltering")&&(b["q.iterative_filter_query_bo"]&&delete b["q.iterative_filter_query_bo"],!0===o.getSetting("dynamic_authorized_types")?b.no_type_filter_bo=o.getSetting("no_type_filter_bo"):b.type_filter_bo=o.getSetting("type_filter_bo")),!0===a?(a=!0,t.target.options.partialPreExpand=null,b.find_path_filter=[{option:["cut"],path_physicalid:r()}],delete b.expand_iter,v.isUsingIndex()||h.displayNotification({msg:P.find_in_ctx_after_authoring,eventID:"warning",key:"enxNav-findInCtxAfterAuthoring"})):t.target.options.findInCtxFTS&&(a=!0,d="find_in_ctx",this.getXSO().empty(),b.find_in_context=[{"q.query":t.target.options.findInCtxFTS}],t.target.options.findInCtxFTS,delete t.target.options.findInCtxFTS,delete b.expand_iter,v.isUsingIndex()||h.displayNotification({msg:P.find_in_ctx_after_authoring,eventID:"warning",key:"enxNav-findInCtxAfterAuthoring"}));var _=i,S=!1,x=!1,N=0;i.isRoot()||(_=i.getRoot()),_.options&&_.options.sequence_filter&&(b.sequence_filter=_.options.sequence_filter,x=!0),_.options&&_.options.config_filter&&(b.config_filter=_.options.config_filter,x=!0);var I=!0===o.getSetting("alwaysExpandPath")||x||o.getSetting("pgpFromServer");if(I){var O=i.getOccurencePath();N=O.length-1,b.paths=[O],delete b.root_physicalid}a?(S=!1,b.max_output_paths=300):S=o.getSetting("enopad_webapis"),f.prepareUpdate(),p.navigate({find_in_ctx:a,enopad_webapis:S,data:b,onComplete:function(n){var s,r=!1;try{s=f.startTransaction("expand");var p=!1,u=e.is(n,"string")?JSON.parse(n):n;if(0===u.results.length)a?h.displayNotification({msg:C.find_in_context_no_result,eventID:"info"}):h.displayNotification({msg:C.generic_service_failure,eventID:"error",key:"enxNav-xnav_expand-generic-service-failure"});else{"partiallyExpanded"!==i.options.padstate||a||f._commandProxy.padExpand({paths:[i.getOccurencePath()],expand_level:c});var g=i,v=parseInt(c);I&&(g=_,-1!==v&&(v+=N));var m=o.getSetting("parse_timeout"),b=m?parseInt(m):void 0;console.time(">> expand_parse"),l.process.expand({treedocument:f,root_nodes:[g],response:u,mode:d,expand_level:v,selectPathLeaf:a,noCheckOrder:!0,parseTimeout:b,realExpandedNodes:[i],setExpandStatus:function(e){p=e.expandTooLarge}}),y.expand(),console.timeEnd(">> expand_parse"),r=!0}}catch(e){e.type&&"TimeoutError"===e.type?(h.displayNotification({msg:C.parseTimeout,eventID:"warning",key:"enxNav-xnav_expand-parse-timeout"}),E([i])):h.displayNotification({msg:C.generic_service_failure,eventID:"error",key:"enxNav-xnav_expand-generic-service-failure"})}finally{if(a){for(var S=f.getXSO().get(),x={paths:[],reframe:!0,expand_level:-1},P=0;P<S.length;P++)x.paths.push(S[P].getOccurencePath());x.paths.length>0&&f._commandProxy.padExpand(x)}else r&&(i.childComputed=!0,f._selectOccurence());var w;s&&s.end(),a?0===i.options.relcount?(i.options.children=null,w="noChildren"):w="partiallyExpanded":!0===p&&(w="partiallyExpanded"),delete i._expandAllPending,A(!0),t.target.preExpandDone({preventExpandAll:!0,state:w}),D.publish({event:"ENXModel/SyncModel",data:{what:"expand"}}),f.pushUpdate()}},onFailure:function(){w(t.target),delete i._expandAllPending,A(!0),h.displayNotification({msg:C.generic_service_failure,eventID:"error",key:"enxNav-xnav_expand-generic-service-failure"}),f.pushUpdate()},onTimeout:function(){w(t.target),delete i._expandAllPending,A(!0),h.displayNotification({msg:C.timeout,eventID:"error",key:"enxNav-xnav_expand-timeout"}),f.pushUpdate()}})}},applyFilter:function(t){for(var i=this,s=[],r=0;r<t.filterRootIds.length;r++){var a=i.searchRootById(t.filterRootIds[r]);a&&(a.options.CVQuery=t.CVQuery,s.push(a))}if(void 0!==t.CVQuery.union||void 0!==t.CVQuery.intersection||void 0!==t.CVQuery.minus){var d=e.clone(t.CVQuery);if(d.union&&d.union.expand&&d.union.expand.length>1){for(var c=[],u=0;u<d.union.expand.length;u++){d.union.expand[u].volume_filter&&c.push(u)}for(var g=0;g<c.length;g++)d.union.expand.splice(c[g],1)}var f=o.getWebAPI_Options("navigate");d.select_bo=f.select_bo,d.select_rel=f.select_rel,d.compute_select_bo=f.compute_select_bo;var v=!1;if(!0===t.structCollapse){v=!0;var m=P.applyingFilter;i.getModelEvents().publish({event:"beginBlockingTransaction",data:m,context:i})}d.label=n.getRequestLabel();var b=Promise.resolve();i.isGroupingApplied()&&(i.cleanGroupingForRoots({rootIds:t.filterRootIds}),b=i.__applyGrouping({roots:s,groups:i.options.groups,fromApplyFilter:!0})),b.then(()=>{i.prepareUpdate(),p.multiexpand({enopad_webapis:!1,data:d,onComplete:function(t){var o;try{o=i.startTransaction("expand");var n=e.is(t,"string")?JSON.parse(t):t;void 0===n.results||0===n.results.length?h.displayNotification({msg:C.sequence_filter_error,eventID:"info"}):l.process.expand({treedocument:i,root_nodes:s,response:n,mode:"filter",expand_level:-1,selectPathLeaf:!1,realExpandedNodes:s,noCheckOrder:!0})}catch(e){h.displayNotification({msg:C.generic_service_failure,eventID:"error",key:"enxNav-applyFilter-generic-service-failure"})}finally{s.forEach(function(t){t.childComputed=!0;var o=e.clone(t.options.icons[0]);if(o.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},t.updateOptions({icons:[o]}),!0===v&&t.collapseAll(),!0===i.isGroupingApplied()){t.setState({state:"expanded"});let e=t.getChildren();for(let t=0;t<e.length;t++){e[t].options.contentRetrieved=!0}}}),i._selectOccurence(),o&&o.end(),i.pushUpdate(),i.options.groupingFilterInProgress=!1,D.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter"}}),i.getModelEvents().publish({event:"endBlockingTransaction",context:i})}},onFailure:function(e,t){i.getModelEvents().publish({event:"endBlockingTransaction",context:i}),e&&console.error(e),h.displayNotification({msg:C.generic_service_failure,eventID:"error",key:"enxNav-applyFilter-generic-service-failure"}),i.pushUpdate(),i.getModelEvents().publish({event:"setTags",data:{facets:{}}})}})})}},expandMultiSelect:function(t){var n=!!t.expandAll&&t.expandAll,i=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():o.getSetting("expand_iter"),s=o.getSetting("enopad_webapis");let r={};t.entryMsg?(r.parseTimeout=t.entryMsg+" "+C.parseTimeout,r.timeout=t.entryMsg+" "+C.timeout,r.failure=t.entryMsg+" "+C.generic_service_failure):(r.parseTimeout=C.parseTimeout,r.timeout=C.timeout,r.failure=C.generic_service_failure),this.invalidateViewPort(),n&&(i="-1");var a=this,d=!0===o.getSetting("alwaysExpandPath")||isNGFilter||o.getSetting("pgpFromServer");a.prepareUpdate();for(var c=[],u=0;u<t.nodes2Expand.length;u++){var g=t.nodes2Expand[u];if(g.childComputed){var f=g.getDepth();this._expandChildren(g,n?parseInt(i):f+parseInt(i),f)||c.push(g)}else c.push(g)}if(0===c.length)a._colorize3D(a),a.forceSyncModel4TreeListView(),a.pushUpdate(),t.callback&&t.callback();else{var v=0,m=[],b=[],_=[];this.withTransactionUpdate(function(){for(var e=0;e<c.length;e++){c[e].setState({state:"expanding"});var t=c[e];if(t.isRoot()||(t=c[e].getRoot()),!0===d){var o=c[e].getOccurencePath();-1===_.indexOf(t.getID())&&(_.push(t.getID()),b.push(t)),v=Math.max(o.length-1,v),m.push(o)}else m.push([c[e].getID()]),-1===_.indexOf(c[e].getID())&&(_.push(c[e].getID()),b.push(c[e]))}}),a.pushUpdate();var S=[],x=new Promise(function(n){a.prepareUpdate();var u=e.extend({paths:m,expand_iter:i,intent:"explore_2D"},o.getWebAPI_Options("navigate"),!0);p.navigate({find_in_ctx:!1,enopad_webapis:s,data:u,timeout:o.getSetting("expand_multisel_timeout"),onComplete:function(s){var p;try{!1!==t.tagger&&(p=a.startTransaction("expand"));var u=e.is(s,"string")?JSON.parse(s):s;if(0===u.results.length)h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-no-results"});else{var g=parseInt(i);!0===d&&-1!==g&&(g+=v);var f=o.getSetting("parse_timeout"),m=f?parseInt(f):void 0;l.process.expand({treedocument:a,root_nodes:b,response:u,mode:"default",expand_level:g,selectPathLeaf:!1,noCheckOrder:!0,parseTimeout:m,realExpandedNodes:c})}}catch(e){e.type&&"TimeoutError"===e.type?(h.displayNotification({msg:r.parseTimeout,eventID:"error",key:"enxNav-expandMultiSelect-parse-timeout"}),E(b)):h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-failure"})}finally{a.pushUpdate(),!0===d?c.forEach(function(e){e.isRoot()&&(e.childComputed=!0)}):b.forEach(function(e){e.childComputed=!0}),a._selectOccurence(),p&&p.end(),n()}},onTimeout:function(){for(let e=0;e<b.length;e++)w(b[e]);h.displayNotification({msg:r.timeout,eventID:"error",key:"enxNav-expandMultiSelect-timeout"}),a.pushUpdate(),n()},onFailure:function(){for(let e=0;e<b.length;e++)w(b[e]);h.displayNotification({msg:r.failure,eventID:"error",key:"enxNav-expandMultiSelect-failure"}),a.pushUpdate(),n()}})});S.push(x);var y=Promise.all(S);t.callback&&y.then(t.callback),y.then(function(){D.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}})})}},_findInCtx:function(t){var i=this;require(["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils"],function(s,r,a,d){i.searchProgress=!0,i._selection=[],i.rootFound=[],i.prepareUpdate(),i.prepareBroadcastSelect(),i.getXSO().empty(),v.determineAuthoredFlag()&&d.displayNotif({message:P.find_in_ctx_after_authoring,level:"warning",key:"xNavDocument-find-in-ctx-after-auth"});var c,p=s.createOutputsRequest(),u=o.getWebAPI_Options("navigate");c=r.findInCtx?Promise.resolve():a.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});t.nodes.length;let h=[];var g=function(e){return new Promise(function(o,n){e<t.nodes.length?f(e).then(function(){g(e+1).then(o).catch(n)}):o()})},f=function(s){return new Promise(function(a,c){var g=t.nodes[s];g.setState({state:"expanding"});var f={filterBI:i.options.filterBI,data:{select_bo:p.select_object,select_rel:p.select_relation,compute_select_bo:p.select_file},pathIds:[g.getOccurencePath()],iterativeFilter:u["q.iterative_filter_query_bo"],filterRel:u.no_type_filter_rel,ftsString:t.searchFts,rscIdToSearch:t.rscId,max_output_paths:o.getSetting("maxPathsForSearch")};f.data.select_rel.push("ds6w:type");r.findInCtx(f).then(function(s){try{var r=e.is(s,"string")?JSON.parse(s):s;if(!0===r.timeoutOccurs)w(g),delete g._expandAllPending,A(!0),g.setState({state:"collapsed"}),d.displayNotif({message:C.find_in_context_timeout,level:"error",key:"xNavDocument-find-in-ctx-timeout"});else{var c=g;c.isRoot()||(c=c.getRoot());var p=o.getSetting("parse_timeout"),u=p?parseInt(p):void 0;let t=null;if(c.options.filtered){t=c.getIcons()[0].badges}if(l.process.expand({treedocument:i,root_nodes:[c],response:r,mode:"find_in_ctx",expand_level:-1,selectPathLeaf:!0,noCheckOrder:!0,parseTimeout:u,realExpandedNodes:[g],setExpandStatus:function(e){e.expandTooLarge}}),t){var f=e.clone(c.options.icons[0]);void 0===f&&(f={}),f.badges=t,c.updateOptions({icons:[f]})}}}catch(e){e.type&&"TimeoutError"===e.type?(d.displayNotif({message:C.parseTimeout,level:"warning",key:"xNavDocument-find-in-ctx-parse-timeout"}),E([g])):d.displayNotif({message:C.generic_service_failure,level:"error",key:"xNavDocument-find-in-ctx-generic-error"})}finally{if(!0!==r.timeoutOccurs){var v,m=i.getXSO().get();if((m=m.filter(function(e){return-1===h.indexOf(e)})).forEach(function(e){var t,o;o=e,-1===(t=h).indexOf(o)&&t.push(o),1===e.getOccurencePath().length?-1===i.rootFound.indexOf(e.getOccurencePath()[0])&&(i.rootFound.push(e.getOccurencePath()[0]),i._selection.push(e.getOccurencePath())):i._selection.push(e.getOccurencePath())}),!0!==t.noPager&&(i.originalSelection=i._selection),i._selection.length>1?(i._doNotBroadcastSelect=!0,!0!==t.doNotBroacast&&i._commandProxy.focus({intent:"focus",paths:i._selection,widget:"2D",sharedID:n.getSharedId(),appID:n.getAppId()}),i._forceDoNotBroadcastSelect=!0,i.unselectAll(),!0!==t.noPager&&(i.displayPager(),i.reframeOn({idx:i._selectedIdx}))):i._pagerview?(i._pagerview.hide(),delete i._pagerview):!0===t.noPager&&i.unselectAll(),!0!==t.doNotBroacast){for(var b={paths:[],reframe:!0,expand_level:-1},_=0;_<m.length;_++)b.paths.push(m[_].getOccurencePath());i._commandProxy.padExpand(b)}0===g.options.relcount?(g.options.children=null,v="noChildren"):v="partiallyExpanded",delete g._expandAllPending,g.setState({state:v}),A(!0)}D.publish({event:"ENXModel/SyncModel",data:{what:"FindInCtx"}}),a()}}).catch(function(e){w(g),delete g._expandAllPending,A(!0),g.setState({state:"collapsed"}),c()})})};c.then(function(){g(0).then(function(){i.searchProgress=!1}).catch(function(e){console.log("Find in Context finished with error"),i.searchProgress=!1}).finally(function(){0===i._selection.length&&d.displayNotif({message:C.find_in_context_no_result,level:"info"}),i.pushUpdate();for(var e=[],t=0;t<i._selection.length;t++){var o=i.getNodeByOccurencePath(i._selection[t]);o&&e.push(o)}D.publish({event:"ENXViews/Model/FindInCtx/complete",data:{foundNodes:e}})})})})},fillAttributesAsync4VisibleNodes:function(t,n,i){var s=this,r=function(){n&&n()},a=function(){s.fillAttributesAsync4VisibleNodes([],n,i)};if(this._pendingNodes||(this._pendingNodes=[]),this._pendingAttr)return void(this._pendingNodes=this._pendingNodes.concat(t));t=t.concat(this._pendingNodes),this._pendingNodes.length=0,this._pendingAttr=!0;let l=new c({});var d=function(t,n){var i=n;return e.is(s.filterAttributesForUpdate,"function")&&(i=s.filterAttributesForUpdate({node:t,node_opts:i})),-1===i.relationOrder&&(i.relationOrder=t.options.relationOrder),!0===o.getSetting("tree_order_in_label")&&i.label&&(i.label+="(treeorder="+i.relationOrder+")"),i};function p(e,t){if(!0!==e.isRelationsObjectNode){for(var o=0;o<s.options.additionalColumnsModules.length;o++)if("SyncModelNodes"!==i||"function"==typeof s.options.additionalColumnsModules[o].hasStructureModelUpdate){for(var n=s.options.additionalColumnsModules[o],r=n.getManagedColumnNames(),a={},d=0;d<r.length;d++)a[r[d]]=e.options.grid[r[d]];var c="function"==typeof n.getAutoReloadNames?n.getAutoReloadNames():[];for(d=0;d<c.length;d++)a[c[d]]=e.options.grid[c[d]];if(!n.toBeUpdated(a,i)||"SyncModelRefresh"!==i&&"SyncModelNodes"!==i&&"OnReady"!==i&&"OnSyncModel"!==i&&"OnScrollEnd"!==i){if("SyncModelRefresh"===i||"SyncModelNodes"===i||"OnReady"===i||"OnSyncModel"===i||"OnScrollEnd"===i){let e=n.getName();"ENODOFormatStatus_Col"!==e&&"ENOXCADSyncStatus_Col"!==e||l.addOtherKeys(r)}}else{void 0===t[n.getName()]&&(t[n.getName()]={pids:[],relids:[],pairs:{}});var p=e.getID();-1===t[n.getName()].pids.indexOf(p)&&t[n.getName()].pids.push(p);var u=e.getRelationID();u&&-1===t[n.getName()].relids.indexOf(u)&&(t[n.getName()].relids.push(u),t[n.getName()].pairs[p]=u)}}}else l.addRelationNode(e)}if(this.options.additionalColumnsModules&&this.options.additionalColumnsModules.length){var u=this.getVisibleAdditionalColumns();u.length?require(["UWA/Promise","DS/ENXNav/models/Algos"],function(o,n){var i={};new o(function(e){for(var o=m.createProbe("VisitNodes For additional columns"),n=0;n<t.length;n++)p(t[n],i);e(),o.end()}).then(function(){for(var c=[],p=0;p<u.length;p++){var h=u[p],g=h.module.getName();if(i[g]){var f=new o(function(t){h.module.updateAttributes(i[g],function(o){var n=e.is(o,"string")?JSON.parse(o):o;t(n)},s)});c.push(f)}}c.length?o.all(c).then(function(o){for(var i={},c=!1,p=0;p<o.length;p++){let t=o[p];if(!c){let e=Object.keys(t.pids),o=Object.keys(t.relids);c=e.length>0&&0===o.length}e.extend(i,o[p],!0)}s.setUseChangeTransactionMode(!0),s.withTransactionUpdate(function(){var e=0,t=Object.getOwnPropertyNames(i.pids),o=Object.getOwnPropertyNames(i.relids),r=[];if(o)for(var a=0;a<o.length;a++){if((h=s.getNodesByRelId(o[a]))&&h.length)for(e=0;e<h.length;e++){var l=n.extractGridChanges(d(h[e],{grid:i.relids[o[a]]}),h[e].options);l.hasChanged&&h[e].updateOptions(l.finalResults);var p=h[e].getID();-1!==t.indexOf(p)&&r.push(p)}else console.warn("Should not happen. The node should be found")}if(c||r.length>0&&r.forEach(function(e){var o=t.indexOf(e);-1!==o&&t.splice(o,1)}),t&&t.length>0)for(var u=0;u<t.length;u++){var h;if((h=s.getNodesById(t[u]))&&h.length)for(e=0;e<h.length;e++){var g=n.extractGridChanges(d(h[e],{grid:i.pids[t[u]]}),h[e].options);g.hasChanged&&h[e].updateOptions(g.finalResults)}else console.warn("Should not happen. The node should be found")}}),l.applyMerger(i),s.setUseChangeTransactionMode(!1),r();var u=s._pendingNodes.filter(function(e){return-1===t.indexOf(e)});s._pendingNodes=u,s._pendingAttr=!1,s._pendingNodes.length&&setTimeout(a,0)}):(s._pendingAttr=!1,r())})}):(s._pendingAttr=!1,r())}},fillAttributesAsync4VisibleNodes_rearch:function(e){if(this._pendingNodes||(this._pendingNodes=[]),this._pendingAttr)this._pendingNodes=this._pendingNodes.concat(e);else{e=e.concat(this._pendingNodes),this._pendingNodes.length=0,this._pendingAttr=!0;var t=this;this.fillAdditionalColumns(e).then(function(){t._pendingAttr=!1})}},fillAdditionalColumns:function(t,o){var n=this,i=Array.isArray(o),s=function(e,t){var o=t;return-1===o.relationOrder&&(o.relationOrder=e.options.relationOrder),o};function r(e,t){if(!0!==e.isRelationsObjectNode)for(var s=0;s<n.options.additionalColumnsModules.length;s++){for(var r=n.options.additionalColumnsModules[s],a=r.getManagedColumnNames(),l={},d=!1,c=0;c<a.length;c++)l[a[c]]=e.options.grid[a[c]];var p="function"==typeof r.getAutoReloadNames?r.getAutoReloadNames():[];for(c=0;c<p.length;c++)l[p[c]]=e.options.grid[p[c]];var u=Object.keys(l);if(i){for(var h={},g=0;g<u.length;g++)-1!==o.indexOf(u[g])&&(h[u[g]]=l[u[g]],d=!0);l=h}else u.length&&(d=!0);if(!0===d&&!0===r.toBeUpdated(l)){void 0===t[r.getName()]&&(t[r.getName()]={pids:[],relids:[],pairs:{},ocps:[]});var f=e.getID();-1===t[r.getName()].pids.indexOf(f)&&t[r.getName()].pids.push(f);var v=e.getRelationID();v&&-1===t[r.getName()].relids.indexOf(v)&&(t[r.getName()].relids.push(v),t[r.getName()].pairs[f]=v)}}}return new Promise(function(o,a){if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length){var l=n.getVisibleAdditionalColumns(i);l.length?require(["DS/ENXNav/models/Algos"],function(i){var a={};new Promise(function(e){for(var o=m.createProbe("VisitNodes For additional columns"),n=0;n<t.length;n++)r(t[n],a);e(),o.end()}).then(function(){for(var t=[],r=0;r<l.length;r++){var d=l[r],c=d.module.getName();if(a[c]){var p=new Promise(function(t){d.module.updateAttributes(a[c],function(o){var n=e.is(o,"string")?JSON.parse(o):o;t(n)},n)});t.push(p)}}t.length?Promise.all(t).then(function(t){for(var r={},a=!1,l=0;l<t.length;l++){let o=t[l];if(!a){let e=Object.keys(o.pids),t=Object.keys(o.relids);a=e.length>0&&0===t.length}e.extend(r,t[l],!0)}n.setUseChangeTransactionMode(!0),n.withTransactionUpdate(function(){var e=0,t=Object.getOwnPropertyNames(r.pids),o=Object.getOwnPropertyNames(r.relids),l=[];if(o)for(var d=0;d<o.length;d++){if((h=n.getNodesByRelId(o[d]))&&h.length)for(e=0;e<h.length;e++){var c=i.extractGridChanges(s(h[e],{grid:r.relids[o[d]]}),h[e].options);c.hasChanged&&h[e].updateOptions(c.finalResults);var p=h[e].getID();-1!==t.indexOf(p)&&l.push(p)}else console.warn("Should not happen. The node should be found")}if(a||l.length>0&&l.forEach(function(e){var o=t.indexOf(e);-1!==o&&t.splice(o,1)}),t&&t.length>0)for(var u=0;u<t.length;u++){var h;if((h=n.getNodesById(t[u]))&&h.length)for(e=0;e<h.length;e++){var g=i.extractGridChanges(s(h[e],{grid:r.pids[t[u]]}),h[e].options);g.hasChanged?h[e].updateOptions(g.finalResults):g.finalResults.grid&&void 0!==g.finalResults.grid.v6_specdoc_to&&h[e].updateOptions(g.finalResults)}else console.warn("Should not happen. The node should be found")}}),n.setUseChangeTransactionMode(!1),o()}):o()})}):o()}})},updateColorForNodes:function(e,t,n){var i=this,s=require("DS/PADUtils/Configuration"),r=function(e,r){return new Promise(function(a){var l=[];i.withTransactionUpdate(function(){for(var r=0;r<e.length;r++){var a=e[r];if(!0!==a.isGroupingNode){var d;if(null!==(d=a.getPLMValue(t.predicate))){var c={color:p=_.getBIColor(n,t,d),isBeingCut:!1,grid:{bi_color:p}};a.ghostMode=!1,"rgba(255, 255, 255, 0.3)"===p&&(delete a.options.color,a.ghostMode=!0,c.isBeingCut=!0),a.updateOptions(c),i.options.shouldBeSelected(a)}else if(!1===s.getConfig("readOnlyApp"))l.push(a.getID());else{c={color:"rgba(255, 255, 255, 0.3)",isBeingCut:!0,grid:{bi_color:"rgba(255, 255, 255, 0.3)"}};delete a.options.color,a.ghostMode=!0,a.updateOptions(c),i.options.shouldBeSelected(a)}if(!0===o.getSetting("synthesisModeOnInstance"))if(!1===a.isRoot())if(null!==(d=a.getPLMValue(t.predicate+"-Instance"))){var p;c={colorInstance:p=_.getBIColor(n,t,d)};a.updateOptions(c)}else if(!1===s.getConfig("readOnlyApp"))l.push(a.getID());else{c={colorInstance:"rgba(255, 255, 255, 0.3)"};a.updateOptions(c)}}}}),0===l.length?(!0===i.fromTransactionEnd&&delete i.fromTransactionEnd,!0===r&&i._colorize3D(i),a()):i.updateNodesAttrValue(l,[t.predicate],function(e){i.withTransactionUpdate(function(){for(let d=0;d<l.length;d++){var e=i.getNodesById(l[d]);if(e.length>0){var o=e[0].getPLMValue(t.predicate);if(null!==o)for(var s=_.getBIColor(n,t,o),r={color:s,isBeingCut:!1,grid:{bi_color:s}},a=0;a<e.length;a++)e[a].ghostMode=!1,"rgba(255, 255, 255, 0.3)"===s&&(delete e[a].options.color,e[a].ghostMode=!0,r.isBeingCut=!0),e[a].updateOptions(r),i.options.shouldBeSelected(e[a]);else for(r={grid:{bi_color:"rgba(255, 255, 255, 0.3)"}},a=0;a<e.length;a++)delete e[a].options.color,r.isBeingCut=!0,e[a].ghostMode=!0,e[a].updateOptions(r),i.options.shouldBeSelected(e[a])}}}),!0===r&&i._colorize3D(i),a()})})},a=e.length<1e3?100:200;r(e).then(function(){setTimeout(function(){r(i.getAllDescendants(),!0)},a)})},updateSpecificColumnViews:function(e,t,o){let n=Object.keys(t);for(let i=0;i<n.length;i++)t[n[i]].updateAttributesDelayed(e,o,this)},refreshCfgValues:function(t){var o=this;if(t.relids&&t.relids){var n=[];t.relids.forEach(function(e){var t=o.getNodesByRelId(e);t&&t.length&&t.forEach((e,t)=>{n.push(e.getID())})});var i,s={relids:t.relids,pids:n};if(o.options.additionalColumnsModules&&o.options.additionalColumnsModules.length){var r=o.getVisibleAdditionalColumns();if(r.length){for(var a=[],l=0;l<r.length;l++){var d=r[l];if("CfgEffectivityColumns"===d.module.getName()){i=d.module,console.count("Cfg_updateAttributes_A");var c=new Promise(function(t,n){i.updateAttributes(s,function(o){var i=e.is(o,"string")?JSON.parse(o):o;console.log("updateAttributes_A response==>",i),t(i),n("Error in Cfg_updateAttributes")},o)});a.push(c)}}a.length?Promise.all(a).then(function(e){o.setUseChangeTransactionMode(!0),o.withTransactionUpdate(function(){t.relids.forEach(function(t){var n=o.getNodesByRelId(t);n&&n.length&&n.forEach(o=>{e&&e.length&&e.forEach(e=>{if(e.relids){var n=e.relids[t];n&&o.updateOptions({grid:n})}})})})}),o.setUseChangeTransactionMode(!1)}).catch(e=>{console.log("An Error Occured")}):console.info("No cfg to update")}else console.info("No cfg Columns Module")}else console.info("No cfg Module")}else console.error("no relids to refresh")},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesById(e);t=t.concat(n)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),o=0;o<t.length;o++){var n=t[o].getNodeByPath(e,void 0,void 0,!0);if(n)return n}},getRoots:function(t){var o=this._parent();if(Boolean(t)&&e.is(this._getChildrenFilterInfo,"function")){var n=this._getChildrenFilterInfo();if(n&&e.is(n.childrenBeforeFiltering,"array")){var i=o;o=n.childrenBeforeFiltering.slice(0),i.forEach(function(e){o.indexOf(e)<0&&o.push(e)})}}return o},getDetachedRoots:function(){var e=[];return this.hasOwnProperty("detachedRoots")&&this.detachedRoots.forEach(function(t){-1===e.indexOf(t)&&e.push(t)}),e},removeRoot:function(t,o,n){var i=this;if(this.wrapInTransaction(function(){i._doNotBroadcastSelect=!0;var o=i.hasOwnProperty("detachedRoots")?i.detachedRoots.indexOf(t):-1;if(o>=0)i.detachedRoots.splice(o,1);else{if(i.invalidateViewPort(),i.getRoots().indexOf(t)>=0&&i._parent(t),(!e.is(n,"boolean")||!n)&&e.is(i._getChildrenFilterInfo,"function")){var s=i._getChildrenFilterInfo();if(s&&e.is(s.childrenBeforeFiltering,"array")){var r=s.childrenBeforeFiltering.indexOf(t);r>=0&&s.childrenBeforeFiltering.splice(r,1)}if(s&&e.is(s.filteredOutChildren,"array")){var a=s.filteredOutChildren.indexOf(t);a>=0&&s.filteredOutChildren.splice(a,1)}}y.removeRoot()}i._doNotBroadcastSelect=!1}),!e.is(o,"boolean")||!o){var s=this.getRoots().length;e.is(this.detachedRoots,"array")&&(s+=this.detachedRoots.length),this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:t.getID(),remainingRoots:s}});var r=void 0;this.getRoots().length>0?r=this.getRoots()[0]:e.is(this.detachedRoots,"array")&&this.detachedRoots.length>0&&(r=this.detachedRoots[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:r,nb_root:s}})}},attachRoot:function(e,t){var o=this.hasOwnProperty("detachedRoots")?this.detachedRoots.indexOf(e):-1;if(o<0)throw new Error("Invalid state");this.detachedRoots.splice(o,1);var n=this;this.wrapInTransaction(function(){e.options.isRootAttached=!0,void 0===t?n.addChild(e):n.insertBefore(e,t),n.invalidateViewPort()})},detachRoot:function(e){if((this.hasOwnProperty("detachedRoots")?this.detachedRoots.indexOf(e):-1)>=0)throw new Error("Invalid state");var t=this,o=null;this.wrapInTransaction(function(){e.options.isRootAttached=!1;var n=t.getRoots();if(n.length>0)for(var s=0;s<n.length;s++)if(n[s].options.resourceid===e.options.resourceid){o=n[s],i.prototype.removeRoot.call(t,o);break}t.hasOwnProperty("detachedRoots")||(t.detachedRoots=[]),t.detachedRoots.push(e)})},searchRootById:function(e){var t,o=this.getRoots(!0);this.hasOwnProperty("detachedRoots")&&(o=o.concat(this.detachedRoots));for(var n=0;n<o.length;n++)if(o[n].options.resourceid===e){t=o[n];break}return t},restoreSelection:function(e){var t=this;if(t.originalSelection){let o=function(){t._selected_paths=t.originalSelection,t._selectOccurence("FocusOn")};e?o():t.withBroadcastSelect(o)}},insertBranches:function(e,t){var n,i=!!this.isGroupingApplied()||t.forceCollapsed;n=l.process.insert_temporary_branches({treedocument:this,branches:e,node_state:t.node_state,forceCollapsed:i,novalidation:t.novalidation});var s=t.onComplete,r=this;this.isGroupingApplied()&&(t.onComplete=function(t){for(var o=[],n=[],i=0;i<e.length;i++)if(-1===n.indexOf(e[i][0])){n.push(e[i][0]);var a=r.searchRootById(e[i][0]);a&&o.push(a)}r.__applyGrouping({roots:o,groups:r.options.groups,noGroupUpdate:!0}),"function"==typeof s&&s(t)}),!0===t.novalidation&&!0===t.forceCollapsed&&e.length>20&&!0!==o.getSetting("forcePathValidationOnSelect")?n.visibleNodesIds.length>0?this.refreshNodeById({modified:n.visibleNodesIds,relationids:n.visibleNodesRelIds,onComplete:t.onComplete?t.onComplete:void 0}):t.onComplete&&t.onComplete.call(!0):n.ids_to_fetch.length>0||n.relationids.length>0?n.ids_to_fetch.length>0||n.relationids.length>0?this.validateBranches_with_Expand(e,t):t.onComplete&&t.onComplete.call(!0):n.ids_to_fetch.length>0?this.refreshNodeById({modified:n.ids_to_fetch,relationids:n.relationids,onComplete:t.onComplete?t.onComplete:void 0}):t.onComplete&&t.onComplete.call(!0)},refreshNodeById:function(t){var n=[],i=this,s=[],r=[],a=[],d=[],c=function(){n.forEach(function(t){var o=i.getNodesById(t);e.is(o,"array")&&o.forEach(function(e){var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])})});var t=C.cannot_insert_branch,o="enxNav-refreshNodeById-cannot-insert-branch";0!==r.length&&(t=C.cannot_access_after_changeowner,o="enxNav-refreshNodeById-cannot-access-after-changeowner"),h.displayNotification({msg:t,eventID:"error",key:o})};if(e.is(t.created)&&(n=n.concat(t.created)),e.is(t.modified)&&e.is(t.modified,"array")&&this.withTransactionUpdate(function(){t.modified.forEach(function(t){if(e.is(t,"object")){var o=t.physicalid;if(e.is(t.attributes,"array")){var l=require("DS/PADServices/utils/AttributesMgtV2");i.getNodesById(o).forEach(function(e){e.updateAttributes(t.attributes,l.getAvailableColumns()),e._manageNLS=!0,!0})}else{if(-1===n.indexOf(o))(c=i.getNodesById(o))&&c.length>0&&(n.push(o),s.push(o));"ownerChanged"===t.key&&r.push(o)}}else{var c,p;if(-1===n.indexOf(t))if((c=i.getNodesById(t))&&c.length>0&&!0!==c[0].isRelationsObjectNode)n.push(t),s.push(t);else(c=i.getNodesByRelId(t)).length>0&&c.forEach(function(e){d.push(e),(p=e.options.relationid)&&a.push(p)})}})}),n.length>0){var u=o.getWebAPI_Options("fetch");u.include_param_Attributes=!1,t.relationids&&t.relationids.length>0&&(n=n.concat(t.relationids)),p.fetch({enopad_webapis:o.getSetting("enopad_webapis"),data:u,pids:n,onComplete:function(o){i.invalidateViewPort();var r=e.is(o,"string")?JSON.parse(o):o;r.results.length!==n.length&&(console.error("Inconsistent number of results"),c()),i.wrapInTransaction(function(){var o=l.process.refresh_nodes({treedocument:i,response:r,refresh_parameters:t,ids_modified:s});if(e.is(o,"array")&&o.length>0){var n={pids:o,already_added_in_PS:!0};i._commandProxy.drop(n);for(var a=[],d=0;d<o.length;d++){var c=i.getNodesById(o[d]);c.length&&a.push(c[0])}var p=a.map(function(e){return e.getOccurencePath()});t.onAddPaths&&t.onAddPaths(p)}D.publish({event:"ENXModel/Nodes/modified",data:{modifiedIds:s,fetchAnswer:r}})}),void 0!==t.onComplete&&t.onComplete()},onFailure:function(){c()}})}else if(a.length>0){var g={lIds:a,attributes:"true"},f={},v={};p.read({data:g,onComplete:function(t){var o=e.is(t,"string")?JSON.parse(t):t;o.results&&(o.results.forEach(function(e){var t=e.physicalID,o={instanceName:[],modified:[]};e.data.forEach(function(e){e.path&&"PLMInstance.PLM_ExternalID"===e.path?o.instanceName=e.value:e.path&&!e.path.includes("PLMInstance")&&(o["ds6wg:"+e.path+"-Instance"]=e.value,v["ds6wg:"+e.path+"-Instance"]=e.value)}),e.basicData.forEach(function(e){"modified"===e.name&&(o.modified=e.value)}),f[t]=o}),d&&d.length>0&&i.wrapInTransaction(function(){d.forEach(function(e){var t={grid:{}};for(var o in t.grid["ds6w:modified"]=f[e.options.relationid].modified[0],t.grid["ds6w:label-Instance"]=f[e.options.relationid].instanceName[0],v)f[e.options.relationid]&&f[e.options.relationid][o][0]&&(t.grid[o]=f[e.options.relationid][o][0]);e.updateOptions(t)})}))},onFailure:function(e){console.error("failure with error",e)}})}},getNodesByRelId:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesByRelId(e);t=t.concat(n)}),t},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(o){!function e(t,o,n,i){if(t.getID()===o[n])if(n===o.length-1)i.push(t);else{var s=t.getChildren();s&&s.length>0&&(n+=1,s.forEach(function(t){e(t,o,n,i)}))}}(o,e,0,t)}),t},deleteNodes:function(e,t){var o=this;this.wrapInTransaction(function(){o.withTransactionUpdate(function(){var n={detach:{deleted:[]}};o._doNotBroadcastSelect=!0,e.forEach(function(e){if(e.isRoot())o.removeRoot(e);else{var t=e.getParent(),i=t.getState();e.remove(),n.detach.deleted.push(e.getID()),"partiallyExpanded"!==i||t.options.children||(t.options.children=[],t.setState({state:"collapsed"}))}}),o._doNotBroadcastSelect=!1,!0===t&&o._commandProxy.padRefresh(n)})})},_shouldAcceptDrop:function(e){var t=e.dropPosition;return"top"!==t&&"bottom"!==t},_shouldAcceptDrag:function(e,t){return!0!==e.isGroupingNode},_selectOccurence:function(e,t,o){var n=this.getRoots(),i=this._selected_paths;if(i.length>0){var s=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var r=[];n.forEach(function(e){for(var t=0;t<i.length;t++){var o=e.getNodeByPath(i[t]);if(o&&(s=!0,r.push(o),!o.isVisible())){for(var n=o.getParent();!n.isVisible();)n=n.getParent();n&&-1===r.indexOf(n)&&r.push(n)}}});var a=!1;if(!0!==t||!0===s)for(var l=this.getSelectedNodes(),d=0;d<l.length;d++){var c=l[d];r.indexOf(c)<0&&(c.unselect(),a=!0)}var p=r.filter(function(e){return!e.isSelected()});a=p.length>0,this.multiselect(p),!0===o&&a&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_buildSelectData:function(){var e=[],t=this._selected_paths;void 0===O.add_objects_when_select&&(O.add_objects_when_select=o.getSetting("add_objects_when_select"),O.authorizeChangeControl=o.getSetting("authorizeChangeControl"),O.CfgAuthoringContext=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"));var i=this.getSelectedNodes();if(this.isGroupingApplied()){var s=[];for(let e=0;e<i.length;e++)!0!==i[e].isGroupingNode&&s.push(i[e]);i=s}!0===O.add_objects_when_select&&t.length&&i.length?this.getRoots().forEach(function(o){for(var n=0;n<t.length;n++){var i=o.getNodeByPath(t[n],void 0,void 0,!0);i&&e.push(i)}}):e=i;var r,a={paths:[],tenant:n.getPlatformId()};a.attributes={},a.version="1.1";if(r=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(a),a.paths=e.map(function(e){return e.getOccurencePath(r)}),O.authorizeChangeControl)try{a.changeControl=O.CfgAuthoringContext.get()}catch(e){console.warn("No Change")}return this._currentApp=n.getSharedId(),a.sharedID=this._currentApp,null===this._pagerview&&!0!==this._focusOn?a.focusOn=!1:a.focusOn=!0,a},_colorChildren:function(e,t,o,n,i){var s=this;e.getChildren().forEach(function(e){if(t.push(e.options.resourceid),t.push(e.options.relationid),o.push({color:e.options.color?e.options.color:"rgba(255, 255, 255, 0.3)",pid:e.options.resourceid,ghostMode:e.ghostMode}),o.push({color:e.options.color?e.options.color:"rgba(255, 255, 255, 0.3)",pid:e.options.relationid,ghostMode:e.ghostMode}),"collapseState"==e._expandState||"partiallyExpandedState"==e._expandState)if(e.hasChildren())s._colorChildren(e,t,o,n,i);else{var r=e.getOccurencePath(e.options.resourceid);n.push(r.map(function(e){return t.indexOf(e)}))}else{var a=e.getOccurencePath(e.options.resourceid);n.push(a.map(function(e){return t.indexOf(e)}))}})},_colorize3D:function(e){if(!0!==this._collapseRepDuringExpandAll&&1==this.colorizeActivated){var t,o=this,n=[],i=[],s=[];o.getRoots().forEach(function(t){if(t.options.color||(t.options.color="rgba(255, 255, 255, 0.3)"),t.options.color)if(n.push(t.options.resourceid),s.push({color:t.options.color?t.options.color:"rgba(255, 255, 255, 0.3)",pid:t.options.resourceid,ghostMode:t.ghostMode}),"collapseState"==t._expandState||"partiallyExpandedState"==t._expandState)if(null!==t.getChildren())o._colorChildren(t,n,s,i,e);else{var r=node.getOccurencePath(t.options.resourceid);i.push(r.map(function(e){return n.indexOf(e)}))}else{var a=t.getOccurencePath(t.options.resourceid);i.push(a.map(function(e){return n.indexOf(e)}))}}),t={nodes:s,path:i},void 0!==o._commandProxy&&0!==t.nodes.length&&o._commandProxy.padFilterBI({filterBIColorize:t})}},_getLastViewpoint:function(e){var t=this;this._viewPointCallback=e,this._commandProxy.requestViewPoint(),this._viewPointTimer=setTimeout(function(){t._viewPointCallback&&(t._viewPointCallback(null),t._viewPointCallback=null)},500)},applyActiveView:function(e){this.options.active_view=e},validateBranches_with_Expand:function(t,n){var i=e.extend({root_path_physicalid:e.clone(t),expand_iter:"0",intent:"explore_2D"},o.getWebAPI_Options("navigate"),!0),s=this;function r(){for(var o=0;o<t.length;o++)for(var i=0;i<t[o].length;i+=2){var r=t[o][i],a=s.getNodesById(r);e.is(a,"array")&&a.forEach(function(e){if(!0===e.options.waiting4validation)if(!0===e.isRoot())s.removeRoot(e);else{var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])}})}h.displayNotification({msg:C.cannot_insert_branch,eventID:"error",key:"enxNav-validateBranches-cannot-insert-branch"}),n.onFailure&&n.onFailure()}p.navigate({enopad_webapis:o.getSetting("enopad_webapis"),data:i,onComplete:function(t){var o;try{o=s.startTransaction("expand");var i=e.is(t,"string")?JSON.parse(t):t;n&&n.onFocus&&(s._insertOnFocus=!0),l.process.validateAndUpdateBranches({treedocument:s,response:i}),delete s._insertOnFocus,n.onComplete&&n.onComplete()}catch(e){r()}finally{o&&o.end()}},onFailure:function(e){r()}})},_onFocus:function(e,t){var n=this;if(!0===o.getSetting("focusonPublic")&&"focus"===e.intent&&!0!==e.findInCtx&&("treelistview"===n.options.active_view||"graphview"===n.options.active_view||"datagridview"===n.options.active_view)){var i=[];n._doNotBroadcastSelect=!0;var s=!1;if(n._selection=[],e.paths.forEach(function(e){var t=n.getNodeByOccurencePath(e);if(t)if(t.getID()===e[e.length-1]&&!0!==t.options.isPADHidden)n._selection.push(e);else if(t.getID()===e[0]&&"filter"!==t.getBadges().bottomRight)n._selection.push(e),s=!0;else if(-1!==e.indexOf(t.getID())){!0!==t.getRoot().options.filtered&&(n._selection.push(e),s=!0)}}),n.originalSelection=n._selection,n._selection.length>1){n.displayPager();var r=n.startTransaction("focusOn"),a=0,l=0;n.withTransactionUpdate(function(){n._selection.forEach(function(e){a++,l++,i.push(e),a!==n._selection.length&&300!==l||(l=0,n._reframeFocus=!0,n.insertBranches(i,{onFocus:!0,onComplete:function(){n._doNotBroadcastSelect=!0,n._colorize3D(this),n._reframeFocus=!1,n.getNodeByOccurencePath(n._selection[n._selectedIdx]).select()}}),i=[]),a===n._selection.length&&r.end()}),!0===s&&n._commandProxy.padExpand({paths:n._selection,expand_level:"1",updatePager:!0}),n._insertOnFocus=!0,n.reframeOn({idx:n._selectedIdx}),delete n._insertOnFocus})}else n._pagerview&&(n._pagerview.hide(),delete n._pagerview),n.insertBranches(n._selection,{onComplete:function(e){n._doNotBroadcastSelect=!0,!0===e&&n._colorize3D(this)}}),!0===s&&n._commandProxy.padExpand({paths:n._selection,expand_level:"1",updatePager:!0}),n.reframeOn({idx:n._selectedIdx})}},focusChange:function(e){this._selection&&null!==this._pagerview&&("previous"==e.event&&(this._selectedIdx--,this.reframeOn()),"next"==e.event&&(this._selectedIdx++,this.reframeOn()))},displayPager:function(){var e=this;e._selectedIdx=0,null===e._pagerview&&(e._pagerview=new b({renderTo:document.body,injectNow:!0,callbacks:{onSelectAll:function(){e._doNotBroadcastSelect=!0,e.restoreSelection(!0),e._doNotBroadcastSelect=!1},onPrevious:function(){e.focusChange({event:"previous"})},onNext:function(){e.focusChange({event:"next"})},onClose:function(){e.closePager(),e._focusOn=!1,e.searchProgress=!1}}}))},closePager:function(){this._pagerview&&(this._pagerview.hide(),delete this._pagerview)},reframeOn:function(e){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);var t=this._selectedIdx%this._selection.length;if(this._pagerview){var o=t+1+"/"+this._selection.length;this._pagerview.setLabel(o)}var n=this.getNodeByOccurencePath(this._selection[t]);n&&(this._focusOn=!0,e&&!0===e.noSelect||n.select(!0),this.getModelEvents().publish({event:"onCenterGraph",data:n}),this._pagerview&&this._selection.length>1&&this._pagerview.show())},getSelectedNodesForOFW:function(){var e=[],t=this._selected_paths;t&&t.length&&this.getXSO().get().length?this.getRoots().forEach(function(o){for(var n=0;n<t.length;n++){var i=o.getNodeByPath(t[n],void 0,void 0,!0);i&&e.push(i)}}):e=this.getXSO().get();return e},updateInstance:function(e){console.count("updateInstances")},_viewInsertExisting:function(t){if(!(t.modified&&t.inserted&&t.created))throw new Error("Invalid input parameters "+JSON.stringify(t));var n,i=[];for(n=0;n<t.modified.length;n++)i.push(this.getNodesById(t.modified[n]));var s=o.getWebAPI_Options("fetch"),r=this;p.fetch({enopad_webapis:o.getSetting("enopad_webapis"),data:s,pids:t.inserted,onComplete:function(o){r.invalidateViewPort();var s=e.is(o,"string")?JSON.parse(o):o;!s.results||s.results.length<t.inserted.length?h.displayNotification({msg:C.object_not_found_in_db,eventID:"error",key:"enxNav-viewInsertExisting-object-not-found-on-db"}):s.results.length>t.inserted.length?h.displayNotification({msg:C.tooManyResults,eventID:"error",key:"enxNav-viewInsertExisting-too-many-results"}):r.wrapInTransaction(function(){var e=require("DS/PADServices/utils/AttributesMgtV2");for(n=0;n<s.results.length;n++){var o=l.parse_attributes(s.results[n].attributes,e.getAvailableColumns(),e.getTreeColumn()),r=t.inserted.indexOf(o.resourceid);o.relationid=t.created[r],void 0===o.children&&(o.children=[]);var d=new a(o),c=i[r];c&&c.forEach(function(e){e.getChildById(o.resourceid)||(e.addChild(d),e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded",u.updateNLS(d))})}})},onFailure:function(){h.displayNotification({msg:C.generic_service_failure,eventID:"error",key:"enxNav-viewInsertExisting-generic-service-failure"}),t.callback&&t.callback.call()}})},_viewDetach:function(e){if(!e.deleted)throw new Error("Invalid input parameters "+JSON.stringify(e));var t=this;this.withTransactionUpdate(function(){for(var o=0;o<e.deleted.length;o++){t.getNodesByRelId(e.deleted[o]).forEach(function(e){e.getParent().removeChild(e)})}})},_viewReParent:function(e){this._viewInsertExisting(e),this._viewDetach(e)},_viewReplaceInstance:function(e){if(!e.couples)throw new Error("Invalid input parameters "+JSON.stringify(e));var t=this;this.withTransactionUpdate(function(){for(var o=0;o<e.couples.length;o++){t.getNodesByRelId(e.couples[o].oldId).forEach(function(t){t.options.relationid=e.couples[o].newId})}})},_viewSplitInstance:function(t){var o=this;function n(e){if(!e.hasChildren())return e.getDepth();var t=1;return e.getChildren().forEach(function(e){var o=n(e);o>t&&(t=o)}),t}var i,s,r,l,d,c,p,u,h=[],g=[],f=[];this._insertFlag=!0,this.withTransactionUpdate(function(){try{for(var v=0;v<t.couples.length;v++){var m=o.getNodesByRelId(t.couples[v].oldId);if(m&&m.length>0)for(var b=0;b<m.length;b++)if(i=m[b]){if((u=i.getOccurencePath())&&u.length&&h.push(u),i.isExpanded()){var _=n(i)-i.getDepth();_=parseInt(_),f.push(_)}if(g.push(i.getRelationID()),r=i.getParent()){l=r.getChildren(),s=i.options.relationtype,d=l.indexOf(i)+1,c=e.clone(i.options,!1);var D=e.clone(i.options.grid,!1);c.grid=D,c.children&&(c.children=[]),c.relationid=t.couples[v].newId,(p=new a(c)).setRelationID(t.couples[v].newId,s),g.push(t.couples[v].newId),d===l.length?r.addChild(p):t.editVariant?r.insertBefore(p,i):r.insertBefore(p,l[d]),r.isExpanded()||r.options.padstate&&"partiallyExpanded"===r.options.padstate||(r.setState({state:"partiallyExpanded"}),r.options.padstate="partiallyExpanded"),p.isSelected()||p.select(),(u=p.getOccurencePath())&&u.length&&h.push(u)}}}}catch(e){console.error("error >>:",e)}finally{console.info("splitInstance done")}}),o.invalidateViewPort(),t.editVariant&&o.updateInstance({occurencePaths:h,expandStates:f,newRelIds:g,editCfg:!0}),t.cb&&t.cb({occurencePaths:h,expandStates:f,newRelIds:g})},splitInstance:function(t){var o=this;t.editVariant||t.cb||(t.cb=function(t){e.is(o.updateInstance,"function")&&o.updateInstance(t)}),this._viewSplitInstance(t)},multiselect:function(e){var t=this,o=t.getXSO();this.prepareUpdate(),e=e.filter(function(e){return t.options.shouldBeSelected(e)}),o.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},_expandChildren:function(e,t,n){var i=o.getSetting("activateFUN085903")&&(-1===t||t>1);function s(e){if(e.childComputed&&e.hasChildren()){var t=e.getChildren();if(1===t.length)return"ds6w:Document"===t[0].options.grid.globaltype}}var r=function(e,t,o){if(-1===t||o<t){if(e.childComputed){if(e.getState("collapsed")&&e.setState({state:"expanded"}),e.hasChildren()){for(var n=e.getChildren(),a=!0,l=0;l<n.length&&!0===a;l++){var d=n[l];if(!(d.childComputed&&i&&s(d))&&(d.childComputed&&"noExpandState"!==d._expandState&&(d.getDepth()<t||-1===t)&&d.setState({state:"expanded"}),void 0===(a=r(d,t,o+1))))throw new Error("Undefined no_expand_needed flag")}return a}return!0}return!(-1===t||t>o)}return!0};return r(e,t,n)},updateNodesAttrValue:function(t,n,i){for(var s=this,r=require("DS/PADServices/utils/AttributesMgtV2"),a=0;a<n.length;a++)r.addBIColumn(n[a],o.getSetting("synthesisModeOnInstance"));var d=n.slice();-1===d.indexOf("ds6w:globaltype")&&d.push("ds6w:globaltype");var c={select_predicate:d,select_file:[]},u=[];if(t.length>=1e3){var h=Math.trunc(t.length/1e3);t.length%1e3>0&&h++;for(var g=t.slice(0,t.length-1),f=0;f<h;f++)u.push(g.splice(0,g.length>=1e3?1e3:g.length))}else u.push(t);var v;(v=u,v.reduce((t,o)=>t.then(()=>(function(t){return new Promise(o=>{p.fetch({enopad_webapis:!1,data:c,pids:t,noCompletion:!0,onComplete:function(n){var i=e.is(n,"string")?JSON.parse(n):n;l.process.refresh_nodes({treedocument:s,response:i,refresh_parameters:{modified:t}}),o()},onFailure:function(e){console.error(e),o()}})})})(o)),Promise.resolve())).then(()=>{i&&i({allNodesProcessed:!0})})},isDirectSelection:function(){return this._directSelection},hasHiddenGroupingNodes:function(){return this._hiddenGroupingNodes&&this._hiddenGroupingNodes.length},_addGroupingNodes:function(e){var t=e.groupingNode;t&&(this._groupingNodes||(this._groupingNodes=[]),this._groupingNodes.push(t))},_showGroupingNodes:function(){if(this._groupingNodes){var e=this;this.withTransactionUpdate(function(){for(let t=0;t<e._groupingNodes.length;t++)e._groupingNodes[t].show()})}a.groupingNodeHidden=!1},_hideGroupingNodes:function(){if(this._groupingNodes){var e=this;this.withTransactionUpdate(function(){for(let t=0;t<e._groupingNodes.length;t++)e._groupingNodes[t].hide()})}a.groupingNodeHidden=!0},__copyLink:function(){require(["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/CompassUtils"],(e,t,o)=>{let n=e.getPlatformURL("3DDashboard"),i="#app:"+t.getAppId()+"/content:X3DContentId=",s=o.buildX3DContent(this.getSelectedNodes());var r=n+i+encodeURIComponent(JSON.stringify(s));t.copyTexttoCLipboard(r)?t.displayNotif({message:P.replace(P.msg_success_copyLink,{label:this.getSelectedNodes()[0].getLabel()}),level:"success"}):t.displayNotif({title:P.msg_error_copyLinkTitle,message:P.msg_error_copyLink,level:"error",key:"xNavDocument-copy-link-error"})})}})}),define("DS/ENXNav/views/customize_views/_xNavDGVParametrization",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/Utilities/Utils","DS/ENXNav/utils/xNavCustoStorageOptim","DS/ENXNav/utils/CtxMenuUtils","DS/PADUtils/Configuration","DS/PADUtils/Utility","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/ENXNav/utils/TwoDAppEvents","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/settings/AppSettings","DS/UIKIT/Mask","DS/CollectionView/CollectionViewStatusBar","DS/WebappsUtils/WebappsUtils","DS/PADServices/ws/WSAccess","DS/Core/PointerEvents"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f,v,m,b){"use strict";var _;function D(e){for(var t={},o=0;o<e.length;o++){var n=e[o];t[n.dataIndex]=void 0!==n.visibleFlag&&!n.visibleFlag}return t}function S(e){this.exportFlags={};for(let t=0;t<e.length;t++){let o=e[t];o.customisation&&o.customisation.exportable&&(this.exportFlags[o.dataIndex]=o.customisation.exportable.value)}}function x(e){return-1===e.rowID?e.cellModel:s.convertDateTime(e.cellModel)}function y(e,t){let o,n=0,i=!1;for(n=0;n<e.length;n++)if((o=e[n]).dataIndex===t){i=!0;break}return i?{index:n,column:o}:null}function N(e){}S.prototype={reapply:function(e){for(let t=0;t<e.length;t++){let o=e[t];o.customisation&&o.customisation.exportable&&void 0!==this.exportFlags[o.dataIndex]&&(o.customisation.exportable.value=this.exportFlags[o.dataIndex])}}},N.prototype.buildDGVOpts=function(e){var t=this;return e=e||{},new Promise(function(n){var s,r=function(o){var s=UWA.clone(i.getConfig("dgvOptions")),r=s&&s.dgv?s.dgv:{};if(o=UWA.extend(r,o),t.options.additionalColumnsModules){let n=o.columns.reduce(function(e,t,o){return t.isAdditionalColumn&&e.push({column:t,dataIndex:t.dataIndex,currentIndex:o}),e},[]);var d=[],c=D(o.columns);let i=new S(o.columns);for(var p=0;p<t.options.additionalColumnsModules.length;p++)UWA.is(t.options.additionalColumnsModules[p].getAdditionalColumnsUXDGV,"function")&&(t.options.additionalColumnsModules[p].getAdditionalColumnsUXDGV(o.columns),d=d.concat(t.options.additionalColumnsModules[p].getManagedColumnNames())),UWA.is(t.options.additionalColumnsModules[p].setupCallback,"function")&&t.options.additionalColumnsModules[p].setupCallback({treeDocModelEvents:t.options.context.getPADTreeDocument().getModelEvents(),globalModelEvents:u.getModelEvents()}),o.columns=o.columns.filter(function(e){return void 0!==e});if(d.length){let t=n.filter(function(e){return-1===d.indexOf(e.dataIndex)});if(t.length)for(let e=t.length-1;e>=0;e--){let n=t[e];o.columns.splice(n.currentIndex,1)}!0===e.reset?c=D(o.columns):i.reapply(o.columns),function(e,t,o){for(var n=0;n<e.length;n++){var i=e[n];-1!==t.indexOf(i.dataIndex)&&(i.isAdditionalColumn=!0),void 0!==o[i.dataIndex]&&(i.visibleFlag=!o[i.dataIndex])}}(o.columns,d,c),i.reapply(o.columns),function(e){for(var t=0;t<e.length;t++){var o=e[t],n=o.customisation;n&&n.layout&&void 0!==n.layout.hidden&&o.visibleFlag!==!n.layout.hidden&&(n.layout.hidden=!o.visibleFlag)}}(o.columns)}}let h=o.columns.filter(function(e){return"dateTime"===e.kind});for(let e=0;e<h.length;e++){h[e].getCellValueForExport=x}if(o.onContextualEvent=t._onContextualEvent.bind(t),o.onDelayedModelDataRequest=t.options.context.updateAttributesDelayed.bind(t.options.context),o.getCellTooltip=t._getCellTooltip.bind(t),t.options.callbacks){var f=Object.keys(t.options.callbacks);for(p=0;p<f.length;p++)o[f[p]]=t.options.callbacks[f[p]]}u.getModelEvents().subscribe({event:"container-to-unmask"},function(e){_=e.container}),l.updateColumnsWithNLS(o.columns,function(e){"success"===e.status&&(o.columns=e.columns);var i=!1;for(let e=o.columns.length-1;e>=0;e--)if("actualIndex"===o.columns[e].dataIndex){i=!0;break}!1===i&&o.columns.push({dataIndex:"actualIndex",kind:"integer",neverVisible:!0,visibleFlag:!1}),a.updateAttributesList(o.columns).then(()=>{let e=Promise.resolve();!0===t.options.activateFilterView&&(e=t.__addFilterModel(o)),e.then(()=>{t.completeDGVOptions(o).then(n)})}),_&&g.unmask(_)})};t.options.typeRepresentations={},t.__initColumnViews().then(()=>{if(t.options.view_customization&&!0!==e.reset&&!0===t.options.view_customization.custoFromDGV){if(!0===t.options.view_customization.custoOptimized&&(t.options.view_customization=o.convertPreference2Custo(t.options.view_customization,"datagridview")),s=t.options.view_customization,t.options.context&&t.options.context.options.isDeEnabled){let e=s.columns.find(e=>"asset-type"==e.dataIndex);e&&e.visibleFlag&&!t.options.context.hasActiveDesignExp()&&(e.visibleFlag=!1)}t.__roleRelatedColumns(s).then(function(){t.buildColumnsFromStorage(s.columns).then(function(e){s.columns=e,r(s)})})}else s={},t.buildColumns("datagridview").then(function(e){t.__roleRelatedColumns(e).then(function(){s.columns=e.columns,r(s)})})})})},N.prototype.__buildRoleMap=function(){let e=new Map;return new Promise(function(t,o){require(["DS/PADUtils/PADUtilsServices"],function(o){o.getGrantedRoles(function(o){for(let t=0;t<o.length;t++){let n=o[t];e.set(n.id,n)}t(e)})})})},N.prototype.__roleRelatedColumns=function(e){let t=this;return new Promise(function(o,n){let s=i.getConfig("roleBased"),r=[],a=[];s?(c.iterateObj(s.attributes,function(e,t){e.enabled&&(e.dataIndex=t,r.push(e))}),r.length?t.__buildRoleMap().then(function(t){c.iterate(r,function(e){a.push(function(e,t,o){return new Promise(function(n,i){let s=!1;c.iterate(o.roles,function(t){!s&&e.has(t)&&(s=!0)}),n({dataIndex:t,enabled:s,data:o})})}(t,e.dataIndex,e))}),Promise.allSettled(a).then(function(t){let n=t.map(function(e){return e.value});c.iterate(n,function(t){if(t.enabled){if(!y(e.columns,t.dataIndex)){let o=t.data;o.dataIndex=t.dataIndex,o.ds6w=o.dataIndex,e.columns.push(o)}}else{let o=y(e.columns,t.dataIndex);o&&e.columns.splice(o.index,1)}}),o()})}):o()):o()})},N.prototype.__initColumnViews=function(){return new Promise(e=>{this.options.columnViews={};var t=i.getConfig("columnViews"),o=[];if(t)for(let e=0;e<t.length;e++)-1===o.indexOf(t[e].AMD)&&o.push(t[e].AMD);o.length?p.loadAMDs(o).then(o=>{let n=[];for(let e=0;e<t.length;e++)if(-1!==o.loadedAMDs.indexOf(t[e].AMD)){let o=require(t[e].AMD);-1===n.indexOf(t[e].AMD)&&"function"==typeof o.getTypeRepresentation&&(this.options.typeRepresentations=Object.assign(this.options.typeRepresentations,o.getTypeRepresentation()),n.push(t[e].AMD)),this.options.columnViews[t[e].dataIndex]={AMD:o}}e()}):e()})},N.prototype.completeDGVOptions=function(e){return Promise.resolve(e)},N.prototype.completeCB=function(){return Promise.resolve()},N.prototype.getColumnViewsForUpdate=function(){var e;let t=this.options.columnViews?Object.keys(this.options.columnViews):[];for(let o=0;o<t.length;o++)if("function"==typeof this.options.columnViews[t[o]].AMD[t[o]].updateAttributesDelayed){!0===this.options.dgv.layout.getColumnVisibleState(t[o])&&(e||(e={}),e[t[o]]=this.options.columnViews[t[o]].AMD[t[o]])}return e},N.prototype.addColumnCB=function(e){var t=this;this.options.dgv.prepareUpdateView();var o=[];e.forEach(function(e){o.push(new Promise(function(o){a.addAvailableColumn(e.dataIndex,e).then(function(e){var n=null;e.ds6w&&t.options.columnViews[e.ds6w]?n=t.options.columnViews[e.ds6w].AMD[e.ds6w].buildColumn(e):e.dataIndex&&t.options.columnViews[e.dataIndex]&&(n=t.options.columnViews[e.dataIndex].AMD[e.dataIndex].buildColumn(e)),null===n&&(n=t.buildColumnFromSetting(e)),n&&("real"!=n.kind&&"real"!=n.typeRepresentation||(n.kind="float",n.typeRepresentation="float"),"dateTime"===n.kind&&(n.getCellValueForExport=x),"asset-type"===n.dataIndex?t.options.dgv.addColumnOrGroup(n,n.columnIdx?n.columnIdx:0):t.options.dgv.addColumnOrGroup(n),t.options.dgvLayout.layoutDensity!==t.options.viewMode&&(t.options.dgvLayout.layoutDensity=t.options.viewMode)),o()})}))}),Promise.all(o).then(()=>{this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)})},N.prototype.removeColumnCB=function(e){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=UWA.is(e,"string")?JSON.parse(e):e,n=t.options.dgv.getColumnOrGroup(o.dataIndex);n&&void 0!==n.dataIndex&&(t.options.dgv.removeColumnOrGroup(o.dataIndex),a.removeAvailableColumn(o.dataIndex))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),t.options.dgvLayout.layoutDensity!==t.options.viewMode&&(t.options.dgvLayout.layoutDensity=t.options.viewMode)},N.prototype.removeColumns=function(e){this.options.dgv.prepareUpdateView(),e.forEach(e=>{var t=this.options.dgv.getColumnOrGroup(e);t&&void 0!==t.dataIndex&&(this.options.dgv.removeColumnOrGroup(e),a.removeAvailableColumn(e))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},N.prototype.changeTitleCB=function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(this.options.dgv.prepareUpdateView(),o.text=t,o.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},N.prototype.changeVisibilityCB=function(e,t){this.options.dgvLayout.getColumnIndex(e)>=0&&this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!1})},N.prototype.changePinCB=function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!1})},N.prototype.moveColumnCB=function(e){e.move2perform&&(e.move2perform.from&&(e.move2perform.fromID=this.options.dgvLayout.getColumnIndex(e.move2perform.from),e.move2perform.toID=this.options.dgvLayout.getColumnIndex(e.move2perform.to)),this.options.dgvLayout.moveColumn(e.move2perform.fromID,e.move2perform.toID,{isUserInteraction:!1}))},N.prototype.changeDgvLayout=function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},N.prototype.changeExportCB=function(e,t){this.options.dgv.prepareUpdateView();var o=this.options.dgv.getColumnOrGroup(e);o&&(o.customisation||(o.customisation={}),o.customisation.exportable||(o.customisation.exportable={}),!1===o.customisation.exportable.lock&&(o.customisation.exportable.value=t)),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},N.prototype.compactMode=function(e){this.options.dgvLayout.layoutDensity=e.viewMode,this.options.viewMode=e.viewMode},N.prototype.saveCustoView=function(e,t){var o=this;this._prepareOptsToStore({onComplete:function(n){var i=e?"onCustoViewChange":"onSaveAsTemplate";o.options.context.dispatchEvent(i,n),!0===t&&o.options.context.dispatchEvent("onSaveAsTemplate",n)}})},N.prototype.reset=function(e){var t=this;delete t.options.view_customization,this.buildDGVOpts({reset:!0}).then(function(o){var n=i.getConfig("dgvOptions")?i.getConfig("dgvOptions"):{};t.options.dgv.prepareUpdateView(),n.dgvLayout&&(n.dgvLayout.cellHeight&&(t.options.dgvLayout.cellHeight=n.dgvLayout.cellHeight),n.viewMode&&(t.options.dgvLayout.layoutDensity=n.viewMode)),t.options.dgvLayout.deleteDataGridViewPreferences(),t.options.dgvLayout.rowsHeader=n.rowsHeader,t.options.dgvLayout.columns=o.columns,t.options.dgv.columns=o.columns,t.options.viewMode=n.viewMode,t.options.context.options.isDeEnabled&&t.options.context.hasActiveDesignExp()&&t.changeVisibilityCB("asset-type",!0),t.options.dgvLayout.applyColumns(),t.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),t.saveCustoView(e)})},N.prototype.removeSort=function(e){this.options.dgv.prepareUpdateView(),this.options.dgv.sortModel=null,this.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)},N.prototype.clearSort=function(e){d.clearSort("begin"),this.options.dgv.prepareUpdateView(),this.options.dgv.sortModel=null,this.options.dgv.sortModel=[{dataIndex:"actualIndex",sort:"asc"}],this.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0),this.options.dgv.sortModel=null,d.clearSort("end")},N.prototype.isClearSortEnabled=function(e){if(!this.options.dgv)return!1;var t=this.options.dgv.sortModel;return null!==t&&(t.length>=1?"actualIndex"!==t[0].dataIndex:void 0)},N.prototype._onContextualEvent=function(e){var t=this;return new Promise(function(o){var i=n,s=Promise.resolve();t.options.context.isDynamicCtx()&&(s=new Promise(function(e){require(["DS/ENXNav/utils/CtxMenuUtilsV2"],function(t){i=t,e()})})),s.then(function(){require(["DS/PADUtils/PADUtilsServices"],function(e){(e.isTouchDevice()||e.isSurface())&&i.context&&i.context.dropInvitContainer&&i.context.dropInvitContainer.hide()}),i.buildMenu({view:"datagridview",context:t.options.context,params:e}).then(o)})})},N.prototype._getCellTooltip=function(t){if(-1===t.columnID)return this.options.dgv.getCellDefaultTooltip(t);var o=null,n=this.options.dgv.getColumnOrGroup(t.columnID),i=n.dataIndex;return t.dataIndex=i,this.options.columnViews[i]&&this.options.columnViews[i].AMD&&this.options.columnViews[i].AMD[i].getCellTooltip&&(o=this.options.columnViews[i].AMD[i].getCellTooltip(t,"asset-type"==i?this.options.context:this.options.dgv)),null===o&&(-1===t.rowID?o="rel"===n.ds6wFrom?{shortHelp:e.replace(e.instanceColHeader,{label:n.text}),updateModel:!1}:this.options.dgv.getCellDefaultTooltip(t):"ContextualMenuColumn"===i?o={shortHelp:e.columns.ContextualMenuColumn,updateModel:!1}:"thumbnail"===i?o={shortHelp:e.tooltip_thumbnail,updateModel:!1}:(o=null,this.options.additionalColumnsModules&&(o=null,o=function(e,t){let o=null;if(t.cellModel&&t.nodeModel.options){let n=e.filter(function(e){return!!e.provideDisplayTooltip}).filter(function(e){return-1!==e.getManagedColumnNames().indexOf(t.dataIndex)});return c.iterate(n,function(e){null!==(o=e.provideDisplayTooltip(t))&&"object"!=typeof o&&(o={shortHelp:o,updateModel:!1})}),o}return null}(this.options.additionalColumnsModules,t)),null===o&&t.nodeModel&&"function"==typeof t.nodeModel.getCellTooltip&&(o=t.nodeModel.getCellTooltip(t))),null===o&&(o=this.options.dgv.getCellDefaultTooltip(t))),o},N.prototype.selectSingleInstance=function(e){this.options.dgv.treeDocument.getSelectedNodes().length>=1&&this.options.dgv.treeDocument.unSelectAll(),e.nodeModel.select()},N.prototype.eventHandlerOnGridView=function(e){var t=this;return new Promise(function(o){e.addEventListener("change",function(e,t){t&&t.nodeModel&&-1!==t.columnID&&(t.nodeModel.isSelected()?t.nodeModel.unselect():t.nodeModel.select())}),e.addEventListener("columnOrderChange",function(e){t.saveCustoView(!0,!0)}),e.addEventListener("userPreferencesChange",function(e){t.saveCustoView(!0,!0)}),e.addEventListener("click",function(e,o){if(void 0!==o&&-1!==o.rowID){var n=e.dsModel.layout.getDataIndexFromColumnIndex(o.columnID);if(t.options.columnViews[n]&&t.options.columnViews[n].AMD&&t.options.columnViews[n].AMD[n].actionOnClick&&o.nodeModel&&!o.nodeModel.isGroupingNode)t.options.columnViews[n].AMD[n].actionOnClick(o,t.options.context);else if(t.options.clickEvent[n])t.options.clickEvent[n](o);else if(t.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(o.columnID,"isAdditionalColumn"))for(var i=0;i<t.options.additionalColumnsModules.length;i++){let e=t.options.additionalColumnsModules[i],r=e.getOnCellClickCB;if(r){var s=r.call(e,n);if(s){s(o);break}}}}}),t.completeCB(e).then(o)})},N.prototype._prepareOptsToStore=function(e){var n=this;t.debounce(function(e){n.options.dgvLayout.columns=n.options.dgv.columns;for(var t=n.options.dgvLayout.getOrderedColumnsIndexes(),i=[],s={},r=0;r<t.length;r++){var l=n.options.dgv.getColumnOrGroup(t[r]);l.columnIdx=r,i.push(l),l.customisation&&!0===l.customisation.titleModified&&(s[l.dataIndex]=!0)}n.options.dgv.columns=i;var d={viewMode:n.options.viewMode,rowsHeader:n.options.dgvLayout.rowsHeader,columns:i,selectedTypes:a.getSelectedTypes(),selectedExtensions:a.getSelectedExtensions()},c=o.convertCusto4Preference(d,s,"datagridview");e.onComplete(c)},500)(e)},N.prototype.__buildStatusBar=function(){let t=[{type:f.STATUS.CUSTOM,position:"near",id:"modelStatusId",dataElements:{typeRepresentation:"string",value:""}}];if(!0===h.getSetting("activateSGI")&&r.isCloud()){var o=h.getSetting("redirectQueryToSGI");let n={type:f.STATUS.CUSTOM,position:"far",id:"switchSGIId",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"warning-symbol-biohazard",fontIconFamily:1,className:"enx-sgi-status enx-status-bar-cmd "+(!0===o?"activated":"")},tooltip:{shortHelp:e.toggleSGI},value:async()=>{g.mask(this.options.dgv.getContent());try{o=!o;let e=require("DS/PADServices/ws/WSAccess");await e.setMePreferences({repositories:[{name:"ProductExplorerRepository",preferences:[{name:"ENOSCEN_SGI_REDIRECT",value:""+o}]}]})}catch(e){console.log("Cannot set the preference")}finally{g.unmask(this.options.dgv.getContent())}}}};t.unshift(n)}this.options.dgv.buildStatusBar(t),this.options.dgv.elements.statusBar.getContent().addClassName("enx-status-bar")};const C=[0,WUXModelUpdateTypes.Selection];return N.prototype.toggleStatusBarListener=function(o){var n=this.options.dgv.treeDocument;if(this.options.dgv.elements.statusBar&&n)if(!0===o)this.___nodeModified=this.___nodeModified?this.___nodeModified:t.debounce(t=>{if(!0===Array.isArray(t)||-1!==C.indexOf(t.options.updateType)){let t,o=n.getAllDescendants().length,i=n.getSelectedNodes().length;t=i>0?e.replace(e.statusModelSelected,{modelLength:o.toLocaleString(),selected:i.toLocaleString()}):1===o?e.replace(e.statusModel1,{modelLength:o}):o>1?e.replace(e.statusModelN,{modelLength:o.toLocaleString()}):"",this.options.dgv.elements.statusBar.getNodeModelByID("modelStatusId").updateOptions({grid:{data:t}})}},250),this.listenerStatusBar=[],this.listenerStatusBar.push(n.getXSO().onPostAdd(this.___nodeModified.bind(this))),this.listenerStatusBar.push(n.getXSO().onPostRemove(this.___nodeModified.bind(this))),this.listenerStatusBar.push(n.onUpdate(this.___nodeModified.bind(this)));else{this.options.dgv.elements.statusBar.getNodeModelByID("modelStatusId").updateOptions({grid:{data:""}});for(let e=0;e<this.listenerStatusBar.length;e++)n.unsubscribe(this.listenerStatusBar[e]);this.listenerStatusBar=[]}},N}),define("DS/ENXNav/utils/CtxMenuUtilsV2",["i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ApplicationFrame/CommandsManager","DS/ENXNav/utils/OpenWithMenuBuilder","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/PADTrackerManager","DS/PADServices/settings/AppSettings","UWA/Utils","DS/ENOXInterWdgCom/LinkManager","DS/PADServices/utils/GrantedRolesCache"],function(e,t,o,n,i,s,r,a,l,d){"use strict";function c(){return"object"==typeof c.instance?c.instance:(c.instance=this,this)}return c.prototype.initializeCmdMap=function(e){return new Promise(function(t){this.context=e.context,this.menuMap=e.commandMap,this.context.getDynamicCtxDef().then(function(e){this.toolbarDefinition=e,this._enrichCtxDefinition().then(t)}.bind(this))}.bind(this))},c.prototype.buildMenu=function(e){return new Promise(function(t){var o;switch(e.view){case"datagridview":o=this._buildDGVCtx(e);break;case"graphview":o=this._buildCtxCmdMenuInView(e);break;default:o=Promise.resolve([])}o.then(function(e){t(e)})}.bind(this))},c.prototype._buildDGVCtx=function(e){var t=this;return new Promise(function(o){var n=e.params.cellInfos;if(n)if(-1===n.rowID)t._buildHeaderMenu(e).then(o);else if("positionMatrix-Instance"===e.params.collectionView.getColumnOrGroup(n.columnID).dataIndex&&"function"==typeof t.psePositionCtxCmd){var i=t.psePositionCtxCmd(e.context,e.params);i.isRoot?t._buildCtxCmdMenuInView(e).then(function(t){e.menu=t,o(e.menu)}):o(i.menu)}else t._buildCtxCmdMenuInView(e).then(function(t){e.menu=t,o(e.menu)});else o([])})},c.prototype._buildHeaderMenu=function(t){var o=this;return new Promise(function(n){var s=t.params.cellInfos,a=t.params.collectionView.getColumnOrGroup(s.columnID);let l=t.params.collectionView.buildDefaultContextualMenu(t.params,{pin:!0,sizeColumnToFit:!0,firstColumnsVisibility:!1,columnsManagement:!1,view:"data-gridview"});if(a.customisation&&a.customisation.layout&&!1===a.customisation.layout.removableFromView||l.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},title:e.headerDGVCtxMenu.columnHide,action:{context:{collectionView:t.params.collectionView,dataIndex:a.dataIndex},callback:function(e){e.context.collectionView.layout.setColumnVisibleFlag(e.context.dataIndex,!1,{isUserInteraction:!1})}}}),i.getSetting("activateFUN104935")){t.params.collectionView;var d=t.context.options.views.datagridview;l.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-clear"},state:d.isClearSortEnabled()?"enabled":"disabled",title:e.headerDGVCtxMenu.clearSort,action:{context:{ourdgv:d},callback:function(e){e.context.ourdgv.clearSort()}}})}if(i.getSetting("readOnlyDashboard"))for(const t of l)(t.icon&&t.icon.iconName&&"pin"===t.icon.iconName||t.title===e.headerDGVCtxMenu.columnHide)&&(t.state="disabled");var c=t.params.data.listenerPosition?t.params.data.listenerPosition:{x:0,y:0};if(o.context.position=c,o._addCommandMenu({cmdId:"ColumnVisibility",menu:l}),!0===r.getSetting("grpBSD")&&!1!==a.groupableFlag)if(t.params.collectionView.groupingApplied===a.dataIndex)l.unshift({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-group-delete"},title:e.headerDGVCtxMenu.columnUnGroup,action:{context:{collectionView:t.params.collectionView,dataIndex:a.dataIndex,model:t.context.getPADTreeDocument()},callback:function(e){delete e.context.collectionView.groupingApplied,e.context.model.getModelEvents().subscribeOnce({event:"groupNodes"},()=>{setTimeout(()=>{delete e.context.model.__groupingInProgress},250)}),e.context.model.__groupingInProgress=!0,e.context.collectionView.groupRows({dataIndexesToGroup:[]})}}});else{let o=e.replace(e.headerDGVCtxMenu.columnGroup,{columnName:a.text});"rel"===a.ds6wFrom&&(o=e.replace(e.headerDGVCtxMenu.columnGroupInst,{columnName:a.text})),l.unshift({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-group-add"},title:o,action:{context:{collectionView:t.params.collectionView,dataIndex:a.dataIndex,model:t.context.getPADTreeDocument()},callback:function(e){e.context.collectionView.groupingApplied=e.context.dataIndex,e.context.model.getModelEvents().subscribeOnce({event:"groupNodes"},()=>{setTimeout(()=>{delete e.context.model.__groupingInProgress},250)}),e.context.model.__groupingInProgress=!0,e.context.collectionView.groupRows({dataIndexesToGroup:[e.context.dataIndex]})}}})}o._addAdditionalColumnsCtxHdr({menu:l,cellInfos:s,params:t.params,view:"datagridview"}).then(function(e){n(e.menu)})})},c.prototype._addCommandMenu=function(e){var o,n=this.menuMap.get(e.cmdId),i=this;if(n&&("string"==typeof n.activationSetting&&!0!==r.getSetting(n.activationSetting)&&(n.deactivated=!0),!0!==n.deactivated)){let r=!0;if(void 0!==n.widgetLinkFeatures){let e=l.getLinkedWithMatchingFeatures(n.widgetLinkFeatures);void 0!==e&&0!==e.length||(r=!1)}if(r){var s=!0;if(!1===n.isEnabled&&(n.toggle||!0===n.enforceAvailability)&&(s=!1),n.availableInView&&this.context.options.active_view!==n.availableInView&&(s=!1),!0===s){var a=t.getCommand(n.id,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);if(a&&"function"==typeof a.isCommandAvailable&&!a.isCommandAvailable(e))return;var d=void 0;d=!0===n.isEnabled?"enabled":"disabled",a&&"function"==typeof a.currentState&&(d=a.currentState()),!0===n.selected&&(d+="|selected");var c=!0;if(a){var p=a.getArguments();let t=p.length;if(t){var u,h;for(let e=0;e<t;e++){let t=p[e];switch(t.ID){case"ShowInViews":u=t.Value.split(",");break;case"ShowInColumns":h=t.Value.split(",")}}if(u&&(c=-1!==u.indexOf(e.view)),h&&e.params.collectionView){let t=e.params.collectionView.getColumnOrGroup(e.params.cellInfos.columnID).dataIndex;c=-1!==h.indexOf(t)}}}!0===c&&(o={type:e.type?e.type:n.type?n.type:"PushItem",id:n.id,title:n.label,HelpResourceFile:n.HelpResourceFile,icon:n.icon,state:d,accelerator:n.accelerator,action:{context:{cmdId:n.id,updateDefault:e.updateDefault,params:e.params},callback:function(e){e.context.updateDefault&&e.context.updateDefault.withDefaultCmd&&e.context.updateDefault.withDefaultCmd!==e.context.cmdId&&(e.context.updateDefault.withDefaultCmd=e.context.cmdId),i._launchCommand({command:e.context.cmdId,params:e.context.params})}}},e.menu.push(o))}}}return o},c.prototype._launchCommand=function(e){var o=t.getCommand(e.command,this.context.action_bar_opts&&this.context.action_bar_opts.context?this.context.action_bar_opts.context:null);if(o){this.context.position&&(o.options.position=this.context.position,delete this.context.position),e.params&&"function"==typeof o.setViewParams&&o.setViewParams(e.params);var n=s.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});n?(n.setEventData({eventLabel:o.options.ID+"-Ctx"}),n.trackPageEvent()):console.warn("tracker not defined"),o.options.fromCtx=!0,o.begin()}},c.prototype._addNONPSCtx=function(e){var t=this;return new Promise(function(o){var n,i=[],s=e.params&&e.params.data&&e.params.data.listenerPosition?e.params.data.listenerPosition:{x:0,y:0};t.context.position=s;e.params&&("graphview"===e.view?n=e.params.graphview.node:e.params.cellInfos&&(n=e.params.cellInfos.nodeModel)),!0!==n.isRelationsObjectGroupingNode&&t._addOpenWithMenu(0).then(function(n){n.openWithMenu.length&&(i=i.concat(n.openWithMenu)),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ActionBar_Attributes",menu:i}),t.context.getPADTreeDocument().getSelectedNodes().filter(e=>{return"Document"!==(e.options.grid["ds6w:type-original"]?e.options.grid["ds6w:type-original"]:e.options.grid["ds6w:type"])}).length||t._addCommandMenu({view:e.view,params:e.params,cmdId:"Download",menu:i}),o(i)})})},c.prototype._addGroupingCtx=function(e){var t=this;return new Promise(function(o){var n=[],i=e.params&&e.params.data&&e.params.data.listenerPosition?e.params.data.listenerPosition:{x:0,y:0};t.context.getPADTreeDocument().getSelectedNodes();if(t.context.position=i,t._addCommandMenu({view:e.view,params:e.params,cmdId:"FocusOnGroups",menu:n}),n.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ColorizeGroup",menu:n}),t.context.getPADTreeDocument().isGroupColorApplied()&&t._addCommandMenu({view:e.view,params:e.params,cmdId:"RemoveGroupColor",menu:n}),n.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"ExpandAllGroups",menu:n}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"CollapseAll",menu:n}),!0!==r.getSetting("grpBSD"))switch(t.context.getPADTreeDocument().getGroupLayout()){case"compact":n.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"GroupsLayoutPath",menu:n});break;case"structured":n.push({type:"SeparatorItem"}),t._addCommandMenu({view:e.view,params:e.params,cmdId:"GroupsLayoutCompact",menu:n})}o(n)})},c.prototype._buildCtxCmdMenuInView=function(e){var t=this;return new Promise(function(o){var n;e.params&&("graphview"===e.view?n=e.params.graphview.node:e.params.cellInfos&&(n=e.params.cellInfos.nodeModel)),n?(!1===n.isSelected()&&n.select(!0),!0===n.isRelationsObjectNode?!0!==n.isGroupingNode?t._addNONPSCtx(e).then(o):t._addGroupingCtx(e).then(o):t._buildCtxCmdMenu(e).then(o)):o([])})},c.prototype._buildCtxCmdMenu=function(o){var n=this;return new Promise(function(i){var s=[],a=[],l={x:0,y:0};o.params&&(o.params.data&&o.params.data.listenerPosition?l=o.params.data.listenerPosition:o.params.info&&o.params.info.position&&(l=o.params.info.position)),n.context.position=l;var c=t.getCommand("OpenInCADHdr",n.context.options.action_bar_opts&&n.context.options.action_bar_opts.context?n.context.options.action_bar_opts.context:null);c&&c.isAvailable()&&(s.push({title:e.PAD_CMDOpenInCAD,icon:{iconName:"open",fontIconFamily:1},type:"PushItem",action:{context:n.context,callback:function(e){n._launchCommand({context:e.context,command:"OpenInCADHdr"})}}}),s.push({type:"SeparatorItem"}));var p=o.dynamicCtxMenu?o.dynamicCtxMenu:n.toolbarDefinition;setTimeout(()=>{for(var e=0;e<p.length;e++)if("string"==typeof p[e])"OpenWith"===p[e]?a.push(n._addOpenWithMenu(e).then(function(e){if(e.openWithMenu.length){var t=e.menuPosition;if(s.length!==p.length){for(var o=!1,n=0,i=0,r=0;r<p.length&&!1===o;r++)"OpenWith"===p[r]?o=!0:"object"==typeof p[r]?p[r].id!==s[i].id?n+=1:i+=1:p[r]!==s[i].id?n+=1:i+=1;t-=n}s.splice.apply(s,[t,0].concat(e.openWithMenu))}})):"SeparatorItem"===p[e]?s.push({type:"SeparatorItem"}):n._addCommandMenu({view:o.view,params:o.params,cmdId:p[e],menu:s});else if("object"==typeof p[e]){var t;if(o.params&&("graphview"===o.view?t=o.params.graphview.node:o.params.cellInfos&&(t=o.params.cellInfos.nodeModel)),"cmd"===p[e].type){if(!0===p[e].rootOnly&&!0!==t.isRoot())continue;n._addCommandMenu({view:o.view,params:o.params,cmdId:p[e].cmd,menu:s})}else{if(!0===p[e].childOnly&&!0===t.isRoot())continue;var l={type:"PushItem",id:p[e].id,title:p[e].title,icon:p[e].icon,HelpResourceFile:p[e].HelpResourceFile,submenu:[]};let i="enabled"!==r.getSetting("staticMappingServer");for(var c=0;c<p[e].cmds.length;c++){var u=null,h=!1;let t=p[e].cmds[c];!i||"UPSAuthInsertProductConfiguration"!==t&&"UPSAuthReplaceProductConfiguration"!==t||(h=!0);u=null;h||(u=n._addCommandMenu({view:o.view,params:o.params,cmdId:p[e].cmds[c],menu:l.submenu,updateDefault:p[e],type:"RadioItem"})),"UPSAuthInsertProductConfiguration"!==t&&"UPSAuthReplaceProductConfiguration"!==t||!1===d.isEnabled("CFG")&&l.submenu&&l.submenu[c]&&(l.submenu[c].state="disabled"),u&&u.id===p[e].withDefaultCmd&&(l.icon=u.icon,l.title=u.title,l.HelpResourceFile=u.HelpResourceFile,l.tooltip=u.title,l.state=u.state,l.action={context:{cmdId:u.id},callback:function(e){n._launchCommand({command:e.context.cmdId})}},u.state="selected")}if(l.submenu.length>=1){if(p[e].withDefaultCmd&&"disabled"===l.state){var g=null;for(c=0;c<l.submenu.length;c++)"enabled"===l.submenu[c].state&&(g=l.submenu[c]),l.submenu[c].id===p[e].withDefaultCmd&&(l.submenu[c].state="disabled");null!==g&&(l.icon=g.icon,l.title=g.title,l.HelpResourceFile=g.HelpResourceFile,l.tooltip=g.title,l.state=g.state,l.action={context:{cmdId:g.id},callback:function(e){n._launchCommand({command:e.context.cmdId})}},g.state="selected")}s.push(l)}}}Promise.all(a).then(function(){i(s)})},300)})},c.prototype._addOpenWithMenu=function(t){var n=this;return new Promise(function(i){var s=n.context.getPADTreeDocument().getSelectedNodes();let r=!0;for(let e=0;e<s.length&&r;e++)"function"==typeof s[e].isSupplemental&&!0===s[e].isSupplemental()&&(r=!1);s.length>0&&r?o.openWithApps(s,{iconOpenWith:{iconName:"open-menu-dot",fontIconFamily:1},nlsOpenWith:e.OpenWith}).then(function(e){i({openWithMenu:e,menuPosition:t})}):i({openWithMenu:[],menuPosition:t})})},c.prototype._enrichCtxDefinition=function(){var e=this;return new Promise(function(t){for(var o=function(t){return new Promise(function(o){t.icon&&t.icon.module&&t.icon.path&&(t.icon=n.getWebappsAssetUrl(t.icon.module,t.icon.path)),(t.HelpResourceFile&&!0!==t.deactivated?new Promise(function(o){e.retrieveHlpRsc(t.HelpResourceFile).then(function(e){this.label=e[this.id+".Title"],this.title=e[this.id+".Title"],o()}.bind(t))}):Promise.resolve()).then(o)})},i=e.toolbarDefinition,s=[],r=0;r<i.length;r++)i[r],s.push(o(i[r]));Promise.all(s).then(t)})},c.prototype._addAdditionalColumnsCtxHdr=function(e){var t=this;return new Promise(function(o){var n=t.context;if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length){for(var i=[],s=[],r=[],l=0;l<n.options.additionalColumnsModules.length;l++)if("function"==typeof n.options.additionalColumnsModules[l].getAdditionalCtxMenu){var d=new Promise(function(t){n.options.additionalColumnsModules[l].getAdditionalCtxMenu({treeDocument:n.getPADTreeDocument(),ctxParams:e.params,view:e.view,callback:function(e,o){e&&-1===r.indexOf(e)&&(r.push(e),o&&(o=a.splat(o)).length>0&&(s.push({type:"SeparatorItem"}),s=s.concat(o))),t()}})});i.push(d)}Promise.all(i).then(function(){e.menu=e.menu.concat(s),o(e)})}else o(e)})},c.prototype.retrieveHlpRsc=function(e){return new Promise(function(t){var o=e.split("/"),n="i18n!"+o[0],i=o.splice(1,1);n+="/assets/help/"+i.join("/"),require([n],t,()=>{console.error("Cannot load "+n),t()})})},new c}),define("DS/ENXNav/models/mixins/TreeDocPopulate",["i18n!DS/PADServices/assets/nls/PADServices","i18n!DS/ENXNav/assets/nls/ENXNav.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PromiseHook","DS/PADServices/utils/PromiseCompletion","DS/PADServices/ws/WSAccess","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Helpers","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/PADServices/utils/Generics","DS/PADServices/utils/Batches","DS/PADServices/utils/private/TreeDocUpdate","DS/ENOXParser/modules/common/Constants","DS/PADUtils/utilsWS/CVServletServices","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/Utility","DS/PADUtils/PADSettingsMgt","DS/ENXNav/utils/TwoDAppEvents","DS/PADUtils/PADSession","DS/Selection/HSOManager","DS/ENOXInterWdgCom/LinkManager","DS/PADServices/utils/PADTrackerManager","DS/PADServices/utils/PConfigUtils","DS/Utilities/UUID"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f,v,m,b,_,D,S,x,y,N,C,P,w){"use strict";const A="rgba(255, 255, 255, 0.3)",I=/ResponseCode with value \"(\d+)\"/g;function E(e,t){this._completion=new a({before:function(){e._parseLoadModel=!0},after:function(){e._parseLoadModel=!1},promise:t})}function O(e){if(e.options.childComputed){var t=e.getChildren();if(t&&1===t.length)return t[0].options.globaltype===v.GLOBALTYPE_DOC}}function M(e,t,n,s){let r=e&&e.message||"";if(r.includes("NetworkError:")){let e=I.exec(r);if(e){let r=parseInt(e[1]);if(r>=300&&r<=400){let e=t.map(function(e){return n.searchRootById(e)});!function(e,t,n){for(let e=0;e<t.length;e++)t[e].remove();let s={detach:{deleted:t.map(e=>e.getID())}};e._cmdProxy.padRefresh(s);let r=o.cannot_insert_branch;n&&(r=o.cannot_access_after_changeowner),i.displayNotif({message:r,level:"error",key:"xNavDoc-refresh-removeRoots"}),e.isEditor()&&e._triggerTitleUpdate()}(n,e,s)}}}}function F(e,t,o,n){e.isRoot()&&e.options.filtered;return function e(t,o,n,i){if(-1===o||n<o){if(t.options.childComputed||!0===t.isGroupingNode){if(t.hasChildren()){for(var s=t.getChildren(),r=!0,a=0;a<s.length&&!0===r;a++){var l=s[a];if(!(l.options.childComputed&&i&&O(l))&&(l.options.childComputed&&"noExpandState"!==l._expandState&&(l.getDepth()<o||-1===o)?l.getState()!==v.NODE_STATES.EXPANDED.state&&l.setState(v.NODE_STATES.EXPANDED):!0===l.isGroupingNode&&(l.setState(v.NODE_STATES.EXPANDED),-1!==o&&o++),l.options.childComputed&&"noChildren"===l.options.padstate&&!l.hasChildren()&&l.setState(v.NODE_STATES.NOCHILDREN),void 0===(r=e(l,o,n+1,i))))throw new Error("Undefined no_expand_needed flag")}return r}return!0}return!(!t.options.type||"Document"!==t.options.type)||!(-1===o||o>n)}return!0}(e,t,o,n)}function R(e,t){let o=e.indexOf(t);-1!==o&&e.splice(o,1)}function T(e,t,o,n,i,s){return new Promise(function(r,a){var l=[];let d=[],c=o.predicate+"-Instance",p=!0===D.getSetting("synthesisModeOnInstance"),u=!1===s.getConfig("readOnlyApp");e.withTransactionUpdate(function(){for(var i=0;i<t.length;i++){var s=t[i];if(!0!==s.isGroupingNode){var r;if(null!==(r=s.getPLMValue(o.predicate))){var a={color:h=_.getBIColor(n,o,r),isBeingCut:!1,grid:{bi_color:h}};s.ghostMode=!1,h===A&&(delete s.options.color,s.ghostMode=!0,a.isBeingCut=!0),s.updateOptions(a),e.options.shouldBeSelected(s),d.push(s)}else if(u)l.push(s.getID());else{a={color:A,grid:{bi_color:A}};s.updateOptions(a),e.options.shouldBeSelected(s)}if(p)if(!1===s.isRoot())if(null!==(r=s.getPLMValue(c))){var h;a={colorInstance:h=_.getBIColor(n,o,r)};s.updateOptions(a),R(l,s.getID())}else if(u)-1===d.indexOf(s)&&l.push(s.getID());else{a={colorInstance:A};s.updateOptions(a)}if(s.options.color===A&&s.options.colorInstance===A){a={isBeingCut:!0,grid:{bi_color:A}};delete s.options.color,delete s.options.colorInstance,s.ghostMode=!0,s.updateOptions(a)}}}}),0===l.length?(!0===e.fromTransactionEnd&&delete e.fromTransactionEnd,!0===i&&e._colorize3D(e),r()):e.updateNodesAttrValue(l,[o.predicate],function(t){e.withTransactionUpdate(function(){for(var t=0;t<l.length;t++){var i=e.getNodesById(l[t]);if(i.length>0){var s=i[0].getPLMValue(o.predicate);if(null!==s)for(var r=_.getBIColor(n,o,s),a={color:r,isBeingCut:!1,grid:{bi_color:r}},d=0;d<i.length;d++)i[d].ghostMode=!1,r===A&&(delete i[d].options.color,i[d].ghostMode=!0,a.isBeingCut=!0),i[d].updateOptions(a),e.options.shouldBeSelected(i[d]);else for(a={grid:{bi_color:A}},d=0;d<i.length;d++)delete i[d].options.color,a.isBeingCut=!0,i[d].ghostMode=!0,i[d].updateOptions(a),e.options.shouldBeSelected(i[d])}}}),!0===i&&e._colorize3D(e),r()})})}var k;function U(){if(k)return k;{let e=require("DS/PADUtils/PADContext");return k=e.get()}}function B(){let e=U();return!(!e||!e.colorMap)}function V(e){if(e.isRelationsObjectNode&&e.childComputed){if(e.options.childComputed=!0,e.hasChildren()){let t=e.getChildren();for(let e=0;e<t.length;e++){V(t[e])}}return!0}}function L(e,t){if(e.getDepth()<t){e.options.childComputed=!0;let o=e.getChildren();p.iterate(o,function(e){L(e,t)})}}function G(){}return G.prototype={processResponse:function(t,o,s,r,a,l,c){!0!==n.getSetting("authoringModeNotSupported")&&!1===x.isAuthoring()&&t.authoringMode&&!0===t.authoringMode&&x.setAuthoringState(!0,e.warnings.disablingIndexFromServer);const p="ENOSCEN_AP"===i.getAppId()?t.results:function(e,t){return e.length>1?e.map(e=>t.results.filter(t=>(function(e){let t;for(let o=0;o<e.length&&!t;o++){let n=e[o];"resourceid"===n.name&&(t=n.value)}return t})(t.attributes)===e)[0]):t.results}(s,t),u=d.parseFetch({results:p,treeDoc:o,nodeModelClass:o.options.nodeModelClass});o._pendingCompletion=new f(o,u),u.then(function(){if(!r&&a.callback&&a.callback.call(null,l),S.addRoot(),o.isGroupingApplied()){let e=[],t=[];for(let n=0;n<s.length;n++)if(-1===t.indexOf(s[n])){t.push(s[n]);let i=o.searchRootById(s[n]);i&&e.push(i)}o.__applyGrouping({roots:e,groups:o.options.groups})}c(l)})},add:function(t){let s=this;return new Promise(function(r,a){s._directSelection=!0;let l=[],d={alreadyLoadedRoots:[]};if(!0!==Array.isArray(t.pids)||0===t.pids.length){let t=e.replace(e.errors.wrongInputParameter,{functionCalled:"xNavTreeDoc.add",param:"pids"});throw i.displayNotif({level:"error",message:t,key:"xNavDoc-add-invalid-input"}),new Error(t)}t.pids.forEach(function(e){-1===l.indexOf(e)&&l.push(e)});let p=s.getRoots(),u=l.length;for(let e=0;e<p.length;e++){let t=l.indexOf(p[e].options.resourceid);-1!==t&&(l.splice(t,1),d.alreadyLoadedRoots.push(p[e].options.resourceid))}if(l.length===u||N.isWidgetSynchronizing()||i.displayNotif({message:e.infos.rootAlreadyLoaded}),l.length>0){let p=s._getAuthoringFlag();s._getFetchFunc(p)({data:{physicalid:l},autoAttSelection:!0}).then(async function(a){let u=c.data.jsonParse(a);s.invalidateViewPort();let h=!1;if(!u.results||u.results.length<l.length)if(u.results&&u.results.length>0&&!s.isEditor())s.processResponse(u,s,l,h,t,d,r);else if(!1===n.getSetting("enopad_webapis"))n.getSetting("activateFUN148764")?await i.getLastDataIndexTime().then(o=>{i.displayNotif({message:e.replace(e.errors.objectNotFoundInDBFUN148764,{lastIndexed:o}),level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&t.callback("error")}):n.getSetting("activateFUN148764")?await i.getLastDataIndexTime().then(o=>{i.displayNotif({message:e.replace(e.errors.objectNotFoundInDBFUN148764,{lastIndexed:o}),level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&t.callback("error")}):(i.displayNotif({message:e.errors.objectNotFoundInDB,level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&t.callback("error"));else if(p)n.getSetting("activateFUN148764")?await i.getLastDataIndexTime().then(o=>{i.displayNotif({message:e.replace(e.errors.objectNotFoundInDBFUN148764,{lastIndexed:o}),level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&(t.callback.call(null,d),r(d))}):(i.displayNotif({message:e.errors.objectNotFoundInDB,level:"error",key:"xNavDoc-add-obj-not-found"}),!h&&t.callback&&(t.callback.call(null,d),r(d)));else if(u.infos&&u.infos.sources&&u.infos.sources.length>0&&u.infos.sources[0].error){let e=u.infos.sources[0],o=e.error.errorMessage||"An error has occurred in "+e.name;i.displayNotif({message:o,level:"error",key:"xNavDoc-add-error-in-response"}),!h&&t.callback&&t.callback.call(null,d)}else x.setAuthoringState(!0,o.PADSession_disabling_index_object_not_found),s.add(t),h=!0;else u.results.length>l.length?(i.displayNotif({message:e.errors.tooManyResults,level:"error",key:"xNavDoc-add-too-many-results"}),!h&&t.callback&&t.callback.call(null,d)):s.processResponse(u,s,l,h,t,d,r)}).catch(function(e){console.log(e),i.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-fetch-generic-error"}),t.callback&&t.callback("error"),a()})}else t.callback&&t.callback.call(null,d),r(d)})},addPaths:function(e){console.log("addPaths:"+JSON.stringify(e));let t=this,s={alreadyLoadedRoots:[]};var r,a;function l(n){for(var s=[],r=0;r<e.paths.length;r++){if(-1===s.indexOf(e.paths[r][0])){var a=t.searchRootById(e.paths[r][0]);UWA.is(a)&&!0===a.options.waiting4validation&&s.push(e.paths[r][0])}for(var l=0;l<e.paths[r].length;l+=2){var d=e.paths[r][l],c=t.getNodesById(d);UWA.is(c,"array")&&c.forEach(function(e){if(!0===e.options.waiting4validation){var t=e.getParent();if(e.remove(),t&&!t.hasChildren()&&"noChildren"!==t.getState()&&UWA.is(t.setState,"function"))try{t.setState({state:"collapsed"}),t.options.children=[]}catch(e){console.error(e)}}})}}if(n&&n.removedByFilter?i.displayNotif({message:o.cannot_insert_branch_filtered,eventID:"info",key:"xNavDoc-addPaths-cannot-add-branch-filtered"}):i.displayNotif({message:o.cannot_insert_branch,eventID:"error",key:"xNavDoc-addPaths-cannot-add-branch"}),e.callback){var p={};p.idleRootIds=s,p.success=!1,e.callback.call(t,p,"error")}}function p(){!0!==n.getSetting("authoringModeNotSupported")&&!1===t._getAuthoringFlag()?(x.setAuthoringState(!0,o.PADSession_disabling_index_object_not_found),t.addPaths(e)):l()}let u;this.isGroupingApplied()&&(r=!0,a=v.NODE_STATES.COLLAPSED),e.addedBranches&&(u=e.addedBranches),u||(u=d.buildTemporaryBranches({treeDoc:this,paths:e.paths,temporaryRoot:!0,nodeModelClass:this.options.nodeModelClass,forceCollapsed:r,state:a}),e.addedBranches=u),s.alreadyLoadedRoots=u.rootsAlreadyLoaded;let h=!1;if(s.alreadyLoadedRoots.length){let e=s.alreadyLoadedRoots.filter(function(e){return t.options.FBIProxy.HasFilter(e).hasFilter});h=e.length>0}let g={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:this.options.FBIProxy},m=t._getAuthoringFlag(),b=t._getExpandFunc(m)(g);t._pendingCompletion=new f(t,b),b.then(function(o){let n=c.data.jsonParse(o),i=n.results&&0===n.results.length;n.errors&&n.errors.length||i?i&&h?l({removedByFilter:!0}):p():d.addPathsUpdateTempNodes({treeDoc:t,FBIProxy:t.options.FBIProxy,wsResponse:n,nodeModelClass:t.options.nodeModelClass,idsToFetch:u.ids_to_fetch,expandLevel:0}).then(function(o){S.addRoot();for(let e=0;e<o.nodesId.length;e++){var n=t.getNodesById(o.nodesId[e])[0];n.isRoot()&&t.getModelEvents().publish({event:"onRootAdded",data:{nb_root:o.nodesId.length,added_node:n}})}if(e.callback){var i={success:!0};if(t.isGroupingApplied()){for(var r=[],a=[],l=e.paths,d=0;d<l.length;d++)if(-1===a.indexOf(l[d][0])){a.push(l[d][0]);var c=t.searchRootById(l[d][0]);c&&r.push(c)}t.__applyGrouping({roots:r,groups:t.options.groups,noGroupUpdate:!0}).then(()=>{e.callback(i,s)})}else e.callback(i,s)}})}).catch(function(e){p()})},onPreExpandChecker:function(e){if("true"===i.getURLParameter("deactivateFUN131056")){let t=!0;if(e.data.nodeModel.options.filtered)e.data.expandAll&&(e.data.numberOfLevelsToExpand="-1"),e.data.performingFilter=!0,e.data.expandAll=!0,t=!1;else if(!e.data.nodeModel.isRoot()&&function(e){return!e.isRelationsObjectNode}(e.data.nodeModel)){let t=e.data.nodeModel.getRoot();t&&t.options&&t.options.filtered&&(e.data.skpChildComputed=!0)}e.data.expandAll&&t&&(e.data.numberOfLevelsToExpand="-1")}else e.data.expandAll&&(e.data.numberOfLevelsToExpand="-1");var t=e.data,o=t.nodeModel,s=!!t.expandAll&&t.expandAll;if(this._parseLoadModel)e.target.preExpandDone({preventExpandAll:!1});else if(s&&!0===n.getSetting("activateSynthesisOnRoot")){var r=document.getElementsByClassName("enx-appMainBody");if(r&&1===r.length){r=r[0];var a=o.isRoot()?o:o.getRoot(),l=this;require(["DS/ENXNav/views/private/ExpandChecker"],function(t){t.check({targetDiv:r,roots:[a]}).then(function(t){!0===t.performExpandAll?l.onPreExpandCB(e):e.target.preExpandDone({preventExpandAll:!0,state:"collapsed"})})})}else this.onPreExpandCB(e)}else this.onPreExpandCB(e)},onPreExpandCB:function(t){let r=u.addOrGetSection("populate"),a=this,l=t.data,p=l.nodeModel,h=!!l.expandAll&&l.expandAll,g=l.performingFilter,m=!l.skpChildComputed&&!g||this.isGroupingApplied(),b=l.numberOfLevelsToExpand?l.numberOfLevelsToExpand.toString():n.getSetting("expand_iter");if(!0===p.isGroupingNode||void 0!==p.options.fakeNodesTable)return void t.target.preExpandDone();let _=p.options.filtered,D=!1;"partiallyExpanded"!==p.options.padstate||_||(D=!0),h&&(p._expandAllPending=!0,s.publish({event:"ENXNav/parser/expandAll/begin"}),this.isGroupingApplied()&&this.__expandAllGroups(p));let x=b;this.invalidateViewPort(),h&&(b="-1");var y=parseInt(b),N=-1===y||y>1;if(m&&(function(e){if(V(e),e.hasChildren()){let t=e.getChildren();for(let e=0;e<t.length;e++)V(t[e])}}(p),p.options.childComputed||p.isRoot()&&a.isGroupingApplied())){r.start("validateExistingTree",{stats:!0});var C=p.getDepth();if(p.isRoot()&&a.isGroupingApplied()||F(p,h?y:C+y,C,N))return t.target.preExpandDone({preventExpandAll:!0}),a._selectOccurence(),B()&&a._colorize3D(a),delete p._expandAllPending,h&&s.publish({event:"ENXNav/parser/expandAll/complete"}),void r.end("validateExistingTree");r.end("validateExistingTree")}let P=p,w=!1,A=0;p.isRoot()||(P=p.getRoot());let I=p.getOccurencePath();A=I.length-1;let O={pathIds:[I],data:{expandLevel:b},FBIProxy:this.options.FBIProxy,timeout:n.getSetting("webapi_timeout"),select_relation:["ro.plminstance.V_treeorder"]};w=n.getSetting("enopad_webapis"),a.prodConfigSupportInAuth&&(O.data.prodConfigSupportInAuth=a.prodConfigSupportInAuth);let M,R=a._getAuthoringFlag();R&&P.options.isReadOnly&&(R=!1),r.start("performExpand-"+y,{stats:!0}),r.start("progressiveExpand",{stats:!0});let T=a._getExpandFunc(R)(O);a._pendingCompletion=new f(a,T),T.then(function(n){r.end("progressiveExpand");var l=c.data.jsonParse(n);if(l.timeoutOccurs)throw l;if(l.results)if(0===l.results.length)_?i.displayNotif({message:o.find_in_context_no_result,eventID:"info"}):i.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-expand-generic-error"}),h&&s.publish({event:"ENXNav/parser/expandAll/complete"}),t.target.preExpandDone({preventExpandAll:!0,state:"collapsed"});else{a._parseLoadModel=!0,!0===D&&a._cmdProxy.padExpand({paths:[p.getOccurencePath()],expand_level:y});let e=d.parseExpandLoadModel({treeDoc:a,expandedNodes:[p],FBIProxy:a.options.FBIProxy,wsResponse:l,nodeModelClass:a.options.nodeModelClass,expandLevel:y,expandLevelRequest:parseInt(x),filter:P.options.filtered});new E(a,e);a._pendingCompletion=new f(a,e),e.then(function(e){!h&&y>1&&L(p,p.getDepth()+y),S.expand(),a._parseLoadModel=!1,p.options.childComputed=!0,t.target.preExpandDone({preventExpandAll:!0,state:"expanded"}),s.publish({event:"ENXNav/parser/expandAll/complete"}),r.end("performExpand-"+y)}).catch(function(e){a._parseLoadModel=!1,M=e}).finally(function(){M&&M.parseTimeout&&(t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,s.publish({event:"ENXNav/parser/expandAll/complete"}),i.displayNotif({message:o.parseTimeout,eventID:"warning",key:"xNavDoc-expand-parse-timeout"})),a._selectOccurence()})}if(l.errors){let o=!1,n="",r="",a=[];for(let e=0;e<l.errors.length;e++)if("UNKNOWN_META"===l.errors[e].code)if(console.log("== UNKNOWN_META V2 Mgt"),o=!0,void 0!==l.errors[e].unknownmetas){a.concat(l.errors[e].unknownmetas);r=l.errors[e].unknownmetas}else{let t=l.errors[e].reason,o="com.exalead.expand.progressive.ProgressiveExpandException: [",i=t.indexOf(o)+o.length;n=t.substring(i,t.length-1),r=n,n=n.replace(/,\s+/g,","),a=a.concat(n.split(","))}!0===o?(s.subscribeOnce({event:"ENXViews/DatagridView/CheckColumns/Done"},()=>{t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,p.setState({state:"collapsed"}),s.publish({event:"ENXNav/parser/expandAll/complete"});var o=require("DS/PADServices/utils/PlatformURL");i.displayNotif({title:e.replace(e.warnings.unknownMeta2.title,{metaName:r,envId:o.getPlatformId()}),subtitle:e.warnings.unknownMeta2.subtitle})}),s.publish({event:"ENXViews/DatagridView/CheckColumns",data:{colsToRemove:a}})):(t.target.preExpandDone({preventExpandAll:!1,state:v.NODE_STATES.COLLAPSED.state}),delete p._expandAllPending,p.setState(v.NODE_STATES.COLLAPSED),i.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:p.getLabel(),expandLevel:"-1"===b?"all":b}),level:"error",key:"xNavDoc-expand-api-error"}))}}).catch(function(o){if(r.end("progressiveExpand"),o.timeoutOccurs)return t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,s.publish({event:"ENXNav/parser/expandAll/complete"}),void i.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-request-timeout"});t.target.preExpandDone({preventExpandAll:!1,state:"collapsed"}),delete p._expandAllPending,p.setState({state:"collapsed"}),s.publish({event:"ENXNav/parser/expandAll/complete"}),i.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:p.getLabel(),expandLevel:"-1"===b?"all":b}),level:"error",key:"xNavDoc-expand-parse-error"}),r.end("performExpand-"+y)})},expandZeroForFilterRoots:function(e){let t=this,o=parseInt("0"),i=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest("expandV2");g.promStepper(e.filteredRoots,1,1,function(s,r){let a=s[0],p=a.getOccurencePath(),u=a.options.filtered,h={pathIds:[p],data:{expandLevel:"0",select_bo:i.select_object,select_rel:i.select_relation,compute_select_bo:i.select_file},FBIProxy:t.options.FBIProxy,timeout:n.getSetting("webapi_timeout")};var g=Promise.resolve();t.isGroupingApplied()&&(t.cleanGroupingForRoots({rootIds:e.filteredRoots.map(function(e){return e.getID()})}),g=t.__applyGrouping({roots:e.filteredRoots,groups:t.options.groups,fromApplyFilter:!0})),g.then(function(){l.expandv2(h).then(function(e){let n=c.data.jsonParse(e);if(n.results&&n.results.length){let e=d.parseExpandLoadModel({treeDoc:t,expandedNodes:[a],FBIProxy:t.options.FBIProxy,wsResponse:n,filter:u,expandLevel:o,expandLevelRequest:o});t._parseFlagMgr=new E(t,e),t._pendingCompletion=new f(that,e),e.then(function(e){a.options.childComputed=!1,t.options.groupingFilterInProgress=!1,r()}).catch(function(e){r()})}}).catch(function(e){r()})})},function(){s.publish({event:"ENXModel/SyncModel",data:{what:"applyFilter",method:"expandZeroForFilterRoots"}})})()},updateSpecificColumnViews:function(e,t,o){c.node.updateSpecificColumnViews(e,t,o)},_selectFromTagger:function(e){var t=this,o=[];let i=v.NODE_STATES.EXPANDING;const a=function(e){e.setState({state:i})};e.doNotBroacast&&(t._doNotBroadcastSelect=!0,t._inBatchingForUpdate=!0),t.getXSO().empty(),y.empty();const c=function(e,t){s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestTimeout"}}),a(e),t()};g.promStepper(t.getRoots(),1,1,function(o,p){let u=o[0];i=u.getState(),u.setState(v.NODE_STATES.COLLAPSED);var h=b.createOutputsRequest();const g={rootPhID:u.getOccurencePath(),select_bo:h.select_object,select_rel:h.select_relation,compute_select_bo:h.select_file,max_count_path:n.getSetting("maxPathsForSearch"),boundingbox:!1,taggerSelect:e.eventData};l.selectFromTagger({data:g,FBIProxy:t.options.FBIProxy}).then(function(e,o,n){t.options.FBIProxy.setSelectStatus({status:!0});const i=UWA.is(n,"string")?JSON.parse(n):n;if(i.results&&i.results.length){t._parseLoadModel=!0;let n=d.parseExpandLoadModel({treeDoc:t,expandedNodes:[e],FBIProxy:t.options.FBIProxy,wsResponse:i,nodeModelClass:t.options.nodeModelClass,selectPaths:!0,selectFromTagger:!0,findInCtx:!1,isFindDialog:!1,mode:"noChildComputed"});t._pendingCompletion=new f(t,n),new r(n,t.boundClearFlag),n.then(function(){t._parseLoadModel=!1,e.setState({state:"partiallyExpanded"}),o()})}else i.timeoutOccurs?(t._parseLoadModel=!1,c(e,o)):(t._parseLoadModel=!1,a(e),o())}.bind(this,u,p),function(e,o){t.options.FBIProxy.setSelectStatus({status:!0}),s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"requestFailure"}}),a(e),o()}.bind(this,u,p))},function(){e.doNotBroacast&&(t._doNotBroadcastSelect=!1,t._inBatchingForUpdate=!1),(o=t.getXSO().get()).length>n.getSetting("maxPathsForSearch")?s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"tooManyResults"}}):0===o.length?s.publish({event:"ENXViews/Model/SelectFromTagger/Failure",data:{reason:"noResults"}}):s.publish({event:"ENXViews/Model/SelectFromTagger/Success",data:{nbSelected:o.length}})})()},_findInCtx:function(e){var i=this,a=function(){e.doNotBroacast&&(i._doNotBroadcastSelect=!0,i._inBatchingForUpdate=!0)},p=function(){e.doNotBroacast&&(i._doNotBroadcastSelect=!1,i._inBatchingForUpdate=!1)};let u=e.nodes.length>1,h=[],m=[];this.closePager(),require(["DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Utility"],function(b,_,D){i._selection=[],i.searchProgress=!0,a(),i.prepareBroadcastSelect(),i.getXSO().empty(),p(),i._getAuthoringFlag()&&_.displayNotif({message:t.find_in_ctx_after_authoring,level:"warning",key:"xNavDoc-find-in-ctx-after-auth"});var S=b.createOutputsRequest();-1===S.select_object.indexOf("bo.plmentity.v_usage")&&S.select_object.push("bo.plmentity.v_usage"),g.promStepper(e.nodes,1,1,function(o,c){let g=o[0],b=g.getState(),D=function(){g.setState({state:b})};g.setState(v.NODE_STATES.EXPANDING);var x={FBIProxy:i.options.FBIProxy,data:{rootPhID:g.getOccurencePath(),select_bo:S.select_object,select_rel:S.select_relation,compute_select_bo:S.select_file,ftsString:e.searchFts,rscIdToSearch:e.rscId,max_count_path:n.getSetting("maxPathsForSearch")},iterativeFilter:e.iterativeFilter,filterRel:e.no_type_filter_rel};x.data.select_rel.push("ds6w:type"),l.findInCtxV2(x).then(function(e){var o="string"==typeof e?JSON.parse(e):e;if(o.results&&o.results.length){i._parseLoadModel=!0,a();let e=d.parseExpandLoadModel({treeDoc:i,expandedNodes:[g],FBIProxy:i.options.FBIProxy,wsResponse:o,nodeModelClass:i.options.nodeModelClass,selectPaths:!0,findInCtx:!0,isFindDialog:!0,mode:"noChildComputed"});i._pendingCompletion=new f(i,e);new r(e,i.boundClearFlag),new r(e,p);e.then(function(e){i._parseLoadModel=!1;var o=i.getXSO().get();o.length>n.getSetting("maxPathsForSearch")&&(o.pop(),_.displayNotif({message:t.replace(t.tooManyResultFound,{maxResult:n.getSetting("maxPathsForSearch")}),level:"warning",key:"FindInCtx-tooManyResult"}));let r=m.slice(),a=o.filter(function(e){return-1===r.indexOf(e)});m=m.concat(a),i._selection.length&&u&&(i._selection.length=0),a.forEach(function(e){i._selection.push(e.getOccurencePath())}),i.originalSelection=i._selection,h=h.concat(i._selection);g.setState({state:"partiallyExpanded"}),s.publish({event:"ENXModel/SyncModel",data:{what:"FindInCtx"}}),c()})}else i._parseLoadModel=!1,console.error("Find in Ctx failed - No Results"),D(),c()}).catch(function(e){i._parseLoadModel=!1,console.error("Find in Ctx failed"),D(),c()})},function(){e.doNotBroacast||i.pushBroadcastSelect();for(var t=[],n=0;n<h.length;n++){var r=i.getNodeByOccurencePath(h[n]);r&&t.push(r)}i._selection=h,0===i._selection.length?_.displayNotif({message:o.find_in_context_no_result,level:"info"}):(a(),i.unselectAll(),p()),c.node.clearChildComputed(i),!0!==e.noPager&&i._selection.length&&i.displayPager().then(function(){a(),i.reframeOn({idx:i._selectedIdx}),p()}),s.publish({event:"ENXViews/Model/FindInCtx/complete",data:{foundNodes:t}}),i.searchProgress=!1})()})},insertBranches:function(e,t){let o=this;var n={};let i={treeDoc:this,paths:e,temporaryRoot:!1,nodeModelClass:this.options.nodeModelClass};if(t.node_state&&(i.state=t.node_state),t.forceCollapsed&&(i.forceCollapsed=t.forceCollapsed),n=d.buildTemporaryBranches(i),!0===t.novalidation&&!0===t.forceCollapsed&&e.length>20&&!0!==D.getSetting("forcePathValidationOnSelect"))n.visibleNodesIds.length>0?this.refreshNodeById({modified:n.visibleNodesIds,relationids:n.visibleNodesRelIds,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:t.onComplete?t.onComplete:void 0}):n.ids_to_fetch.length?this.refreshNodeById({modified:n.ids_to_fetch,relationids:n.relationids,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:function(){let e=n.ids_to_fetch.map(function(){return o.getNodesById(rootId)}).concat(function(e,t){e=e.concat(t)},[]);p.iterate(e,function(e){e.getParent().setState(v.NODE_STATES.COLLAPSED)}),t.onComplete&&t.onComplete(!0)}}):t.onComplete&&t.onComplete.call(!0);else if(n.ids_to_fetch.length>0||n.relationids.length>0)if(n.ids_to_fetch.length>0||n.relationids.length>0){let o=this;this.addPaths({addedBranches:n,paths:e,callback:function(e,n){e.success&&(n&&n.alreadyLoadedRoots&&p.iterate(n.alreadyLoadedRoots,function(e){o.getNodesById(e)}),t.onComplete&&t.onComplete())}})}else t.onComplete&&t.onComplete.call(!0);else n.ids_to_fetch.length>0?this.refreshNodeById({modified:n.ids_to_fetch,relationids:n.relationids,skipDrop:void 0!==t.skipDrop&&t.skipDrop,onComplete:t.onComplete?t.onComplete:void 0}):t.onComplete&&t.onComplete.call(!0)},updateColorForNodes:function(e,t,o){var n=require("DS/PADUtils/Configuration");let i=this;var s=e.length<1e3?100:200;T(i,e,t,o,!0,n).then(function(){setTimeout(function(){let s=i.getAllDescendants();(function(e,t){let o=e.length,n=t.length,i=!1;if(o===n){let o=!1;for(let i=0;i<n;i++){let n=t[i];if(-1===e.indexOf(n)){o=!0;break}}return o||(i=!0),i}return!1})(e,s)||T(i,i.getAllDescendants(),t,o,!0,n)},s)})},_colorChildren:function(e,t,o,n,i){var s=this;e.getChildren().forEach(function(e){if(t.push(e.options.resourceid),t.push(e.options.relationid),o.push({color:e.options.color?e.options.color:A,pid:e.options.resourceid,ghostMode:e.ghostMode,metaType:"reference"}),o.push({color:e.options.colorInstance?e.options.colorInstance:A,pid:e.options.relationid,ghostMode:e.ghostMode,metaType:"instance"}),"collapseState"==e._expandState||"partiallyExpandedState"==e._expandState)if(e.hasChildren())s._colorChildren(e,t,o,n,i);else{var r=e.getOccurencePath(e.options.resourceid);n.push(r.map(function(e){return t.indexOf(e)}))}else{var a=e.getOccurencePath(e.options.resourceid);n.push(a.map(function(e){return t.indexOf(e)}))}})},_checkColorize3D:function(){B()&&this._colorize3D(this)},_colorize3D:function(e){if(!0!==this._collapseRepDuringExpandAll){let t=this,o=[],n={},i=[],s=[];t.getRoots().forEach(function(n){if(n.options.color||(n.options.color=A),n.options.color)if(o.push(n.options.resourceid),s.push({color:n.options.color?n.options.color:A,pid:n.options.resourceid,ghostMode:n.ghostMode}),"collapseState"==n._expandState||"partiallyExpandedState"==n._expandState)if(null!==n.getChildren()&&n.getChildren().length>0)t._colorChildren(n,o,s,i,e);else{var r=n.getOccurencePath(n.options.resourceid);i.push(r.map(function(e){return o.indexOf(e)}))}else{var a=n.getOccurencePath(n.options.resourceid);i.push(a.map(function(e){return o.indexOf(e)}))}}),n={nodes:s,path:i},void 0!==t._cmdProxy&&0!==n.nodes.length&&t._cmdProxy.padFilterBI({filterBIColorize:n})}},refreshNodeById:function(e){var t=[],o=this,n=[],i=[],r=[],a=[];if(UWA.is(e.created)&&(t=t.concat(e.created)),UWA.is(e.modified)&&UWA.is(e.modified,"array")&&this.withTransactionUpdate(function(){let s=b.getAvailableColumns(),l=!(!s.includes("ds6w:reserved-Instance")&&!s.includes("ds6w:reservedBy-Instance"));e.modified.forEach(function(e){if(h.checks.object(e)){var d=e.physicalid;if(h.checks.array(e.attributes)){var c=o.getNodesById(d);0===c.length&&l&&(c=o.getNodesByRelId(d),e.attributes.forEach(function(e){"ds6w:reserved"===e.name&&(e.name="ds6w:reserved-Instance"),"ds6w:reservedBy"===e.name&&(e.name="ds6w:reservedBy-Instance")})),c.forEach(function(t){t.updateAttributes(e.attributes,s),t._manageNLS=!0,!0})}else{if(-1===t.indexOf(d))(p=o.getNodesById(d))&&p.length>0&&(t.push(d),n.push(d));"ownerChanged"===e.key&&i.push(d)}}else{var p,u;if(-1===t.indexOf(e))if((p=o.getNodesById(e))&&p.length>0)t.push(e),n.push(e);else(p=o.getNodesByRelId(e)).length>0&&p.forEach(function(e){a.push(e),(u=e.options.relationid)&&r.push(u)})}})}),t.length>0){D.getWebAPI_Options("fetch").include_param_Attributes=!1;let r=function(){return t.filter(function(e){let t=o.getNodesById(e);return!(1!==t.length||!t[0].isRoot())})},a=r();e.relationids&&e.relationids.length>0&&(t=t.concat(e.relationids));o._getFetchFunc(o._getAuthoringFlag())({data:{physicalid:t},autoAttSelection:!0}).then(function(i){let l=c.data.jsonParse(i);var p=[];for(var u of l.results)if(u.attributes.find(e=>"#DENIED!"===e.value)){let e=u.attributes.find(e=>"resourceid"===e.name).value;o.removeRoot(o.getNodesById(e)[0]),p.push(e)}p.length&&s.publish({event:"ENXViews/WelcomePanel/cleanup",data:{item2remove:p}}),c.array.compare(t,n)?d.parseMultiFetch({results:l.results,treeDoc:o,FBIProxy:o.options.FBIProxy}):d.refreshNodes({wsResponse:l,treeDoc:o,refreshParameters:e,FBIProxy:o.options.FBIProxy}).then(function(){if(e.created&&e.created.length&&(a=r()),!e.skipDrop&&a.length){var t={pids:a,already_added_in_PS:!0};o._commandProxy.drop(t)}for(var n=[],i=0;i<a.length;i++){var s=o.getNodesById(a[i]);s.length&&n.push(s[0])}var l=n.map(function(e){return e.getOccurencePath()});e.onAddPaths&&e.onAddPaths(l)})}).catch(function(e){let n=i.length>0;M(e,t,o,n)})}else if(r.length>0){var p={lIds:r,attributes:"true"},u={},g={};l.read({data:p}).then(function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;t.results&&(t.results.forEach(function(e){var t=e.physicalID,o={instanceName:[],instanceDesc:[],modified:[]};e.data.forEach(function(e){e.path&&"PLMInstance.PLM_ExternalID"===e.path?o.instanceName=e.value:e.path&&"PLMInstance.V_description"===e.path?o.instanceDesc=e.value:e.path&&!e.path.includes("PLMInstance")&&(o["ds6wg:"+e.path+"-Instance"]=e.value,g["ds6wg:"+e.path+"-Instance"]=e.value)}),e.basicData.forEach(function(e){"modified"===e.name&&(o.modified=e.value)}),u[t]=o}),a&&a.length>0&&o.wrapInTransaction(function(){a.forEach(function(e){var t={grid:{}};for(var o in t.grid["ds6w:modified"]=u[e.options.relationid].modified[0],t.grid["ds6w:label-Instance"]=u[e.options.relationid].instanceName[0],Array.isArray(u[e.options.relationid].instanceDesc)&&(t.grid["ds6w:description-Instance"]=u[e.options.relationid].instanceDesc[0]),g)u[e.options.relationid]&&(t.grid[o]=h.checks.array(u[e.options.relationid][o])?u[e.options.relationid][o][0]:u[e.options.relationid][o]);e.updateOptions(t)})}))}).catch(function(e){console.error("failure with error",e)})}},refresh:function(e){let o=w.v4();window.top.performance.mark("app_refresh_start-"+o),s.publish({event:"ENXModel/refresh/begin"});var r=function(){S.refresh(),window.top.performance.mark("app_refresh_end-"+this);var e=C.getPADTracker({eventCategory:"performance",eventAction:"refresh"});if(e){window.top.performance.measure("app_refresh_measure-"+this,"app_refresh_start-"+this,"app_refresh_end-"+this);var t=window.top.performance.getEntriesByName("app_refresh_measure-"+this),o=t.length>0?t[t.length-1].duration:void 0,n=t.length>0?t[t.length-1].startTime:void 0;e.addMultivaluedEventData("2d_app_refresh",{call_refresh_start:n,call_refresh_duration:o}),e.trackPageEvent()}s.publish({event:"ENXModel/refresh/complete"})}.bind(o);let a=e&&e.roots,l=this;if(a.forEach(function(e){l.prodConfigSupportInAuth&&!0===D.getSetting("keepFilterAuthoring")?l.prodConfigSupportInAuth&&e.validFilter&&!e.keepFilterBadge&&(e.keepFilterBadge=!0):e.validFilter&&e.keepFilterBadge&&(e.keepFilterBadge=!1)}),a||(a=this.getRoots()),0!==a.length){var p=a.map(function(e){return e.getOccurencePath()}),u=function(e){let t=-1;return e.processDescendants({processNode:function(){let e=this.getDepth();e>t&&(t=e)}}),t}(this);if(this.unselectAll(),0===u){let o=a.map(function(e){return e.getID()}),n=this._getAuthoringFlag();n&&e.hasOwnProperty("isReadOnlyRoot")&&e.isReadOnlyRoot&&(n=!1);let s=this._getFetchFunc(n),l=this;s({data:{physicalid:o},autoAttSelection:!0}).then(function(e){let o=c.data.jsonParse(e);d.refreshFetch({wsResponse:o,roots:a,treeDoc:l,FBIProxy:l.options.FBIProxy}).then(()=>{i.displayNotif({message:t.refresh_ok}),r()})}).catch(function(e){i.displayNotif({message:t.refresh_failure,level:"error",key:"xNavDoc-refresh-error"}),r()})}else{let o={pathIds:p,data:{expandLevel:u},FBIProxy:this.options.FBIProxy,timeout:n.getSetting("webapi_timeout")},s=this._getAuthoringFlag();s&&e.hasOwnProperty("isReadOnlyRoot")&&e.isReadOnlyRoot&&(s=!1);let l=this._getExpandFunc(s);s&&(o.data.expandLevel=""+u);let h=this;h.prodConfigSupportInAuth&&(o.data.prodConfigSupportInAuth=h.prodConfigSupportInAuth),l(o).then(function(e){let o=c.data.jsonParse(e);o.results&&o.results.length?d.refresh({roots:a,treeDoc:h,FBIProxy:h.options.FBIProxy,wsResponse:o,expandLevel:-1}).then(function(){h.isGroupingApplied()&&h.__applyGrouping({roots:a,groups:h.options.groups}),i.displayNotif({message:t.refresh_ok}),r()}):r()}).catch(function(e){i.displayNotif({message:t.refresh_failure,eventID:"error",key:"xNavDoc-refresh-error"}),r()})}}else r()},updatePaths:function(e){let t=this;return new Promise(function(o,n){let i={pathIds:e.paths,data:{expandLevel:"0"},FBIProxy:t.options.FBIProxy},s=t._getAuthoringFlag();t._getExpandFunc(s)(i).then(function(i){let s=c.data.jsonParse(i),r=s.results&&0===s.results.length;if(s.errors&&s.errors.length||r)n();else{let n=new Set;for(let t=0;t<e.paths.length;t++){let o=e.paths[t].filter(function(e,t){return t%2==0});for(let e=0;e<o.length;e++)n.add(o[e])}e.idsToFetch=Array.from(n);let i=d.addPathsUpdateTempNodes({treeDoc:t,FBIProxy:t.options.FBIProxy,wsResponse:s,idsToFetch:e.idsToFetch,expandLevel:0}).then(function(n){if(t.isGroupingApplied()){for(var i=[],s=[],r=e.paths,a=0;a<r.length;a++)if(-1===s.indexOf(r[a][0])){s.push(r[a][0]);var l=t.searchRootById(r[a][0]);l&&i.push(l)}t.__applyGrouping({roots:i,groups:t.options.groups,noGroupUpdate:!0}).then(()=>{o()})}else o()});t._pendingCompletion=new f(t,i)}}).catch(function(e){n(e)})})},updateNodesAttrValue:function(e,t,o){let i=this;for(var s=require("DS/PADServices/utils/AttributesMgtV2"),r=0;r<t.length;r++)s.addBIColumn(t[r],n.getSetting("synthesisModeOnInstance"));var a=t.slice();-1===a.indexOf("ds6w:globaltype")&&a.push("ds6w:globaltype");var l={select_predicate:a,select_file:[],timeout:n.getSetting("webapi_timeout")},c=[];if(e.length>=1e3){var p=Math.trunc(e.length/1e3);e.length%1e3>0&&p++;for(var u=0;u<p;u++)c.push(e.splice(0,e.length>=1e3?1e3:e.length))}else c.push(e);var h;(h=c,h.reduce((e,t)=>e.then(()=>(function(e){return new Promise(function(t,o){l.physicalid=e,i._getFetchFunc(i._getAuthoringFlag())({data:l,enopad_webapis:!1,pids:e,noCompletion:!0}).then(function(o){var n=UWA.is(o,"string")?JSON.parse(o):o;n.results?d.parseMultiFetch({treeDoc:i,results:n.results,refresh_parameters:{modified:e}}).then(function(){t()}):t()}).catch(function(e){console.error(e),o()})})})(t)),Promise.resolve())).then(()=>{o&&o({allNodesProcessed:!0})})},isAuthoredNode:function(e){return 0==e.getRoot().options.isReadOnly},isIndexedNode:function(e){return 1==e.getRoot().options.isReadOnly},expandMultiSelect_og:function(t){var a=!!t.expandAll&&t.expandAll,l=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():n.getSetting("expand_iter"),u=(n.getSetting("enopad_webapis"),!0===n.getSetting("alwaysExpandPath")||isNGFilter||n.getSetting("pgpFromServer"));a&&(l="-1");for(var h=parseInt(l),g=-1===h||h>1,m=[],b=0;b<t.nodes2Expand.length;b++){var _=t.nodes2Expand[b];if(_.isRoot()){let e=!0;for(var D=1;D<t.nodes2Expand.length;D++)t.nodes2Expand[D].isGroupingNode||(e=!1);e&&(_.options.childComputed=!0)}if(_.options.childComputed){var S=_.getDepth();F(_,a?parseInt(l):S+parseInt(l),S,g)?_.setState(v.NODE_STATES.EXPANDED):m.push(_)}else m.push(_)}var x=this;if(0===m.length)x.prepareUpdate(),B()&&x._colorize3D(x),x.forceSyncModel4TreeListView(),x.pushUpdate(),t.callback&&t.callback();else{var y=0,N=[],C=[],P=[],w=[],A=[];this.withTransactionUpdate(function(){p.iterate(m,function(e){e.setState(v.NODE_STATES.EXPANDING);var t=e;if(t.isRoot()||(t=t.getRoot()),u){var o=e.getOccurencePath();t&&-1===P.indexOf(t.getID())&&(P.push(t.getID()),C.push(t)),y=Math.max(o.length-1,y),N.push(o)}else N.push([e.getID()]),-1===P.indexOf(e.getID())&&(P.push(e.getID()),C.push(e));x.isAuthoredNode(e)?w.push(o):x.isIndexedNode(e)&&A.push(o)})});let n=x._getAuthoringFlag();new Map;let a=[];w.length>0&&a.push({path:w,isReadOnly:!0}),A.length>0&&a.push({path:A,isReadOnly:!1});for(let t=0;t<a.length;t++){let s=a[t];x._getAuthoringFlag()&&(N=s.path,n=s.isReadOnly);let u=x._getExpandFunc(n);var I=[];I.push(new Promise(function(t,n){let s={pathIds:N,data:{expandLevel:l},FBIProxy:x.options.FBIProxy,timeout:3e4};x.prodConfigSupportInAuth&&(s.data.prodConfigSupportInAuth=x.prodConfigSupportInAuth),u(s).then(function(e){var s=c.data.jsonParse(e);if(s.timeoutOccurs)throw s;if(0===s.results.length)i.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-expand-multi-select-generic-error"}),p.iterate(m,function(e){e.setState(v.NODE_STATES.NOCHILDREN)}),n();else{x._parseLoadModel=!0;let e=d.parseExpandLoadModel({treeDoc:x,expandedNodes:m,FBIProxy:x.options.FBIProxy,wsResponse:s,nodeModelClass:x.options.nodeModelClass,expandLevel:h});new f(x,e),new r(e,x.boundClearFlag);e.then(function(e){p.iterate(m,function(e){e.options.childComputed=!0,e.setState(v.NODE_STATES.EXPANDED)}),t()})}}).catch(function(o){o.timeoutOccurs&&i.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-multi-select-request-timeout"}),x.withTransactionUpdate(function(){p.iterate(m,function(t){i.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t.getLabel(),expandLevel:"-1"===l?"all":l}),level:"error",key:"xNavDoc-expand-multi-select-parse-error"}),t.setState(v.NODE_STATES.COLLAPSED)})}),t()})}))}var E=Promise.allSettled(I);t.callback&&E.then(t.callback);new f(x,E);E.then(function(){s.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}})})}},expandMultiSelect:function(t){var a=!!t.expandAll&&t.expandAll,l=t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():n.getSetting("expand_iter"),u=(n.getSetting("enopad_webapis"),!0===n.getSetting("alwaysExpandPath")||isNGFilter||n.getSetting("pgpFromServer"));a&&(l="-1");for(var h=parseInt(l),g=-1===h||h>1,m=[],b=0;b<t.nodes2Expand.length;b++){var _=t.nodes2Expand[b];if(_.isRoot()){let e=!0;for(var D=1;D<t.nodes2Expand.length;D++)t.nodes2Expand[D].isGroupingNode||(e=!1);e&&(_.options.childComputed=!0)}if(_.options.childComputed){var S=_.getDepth();F(_,a?parseInt(l):S+parseInt(l),S,g)?_.setState(v.NODE_STATES.EXPANDED):m.push(_)}else m.push(_)}var x=this;if(0===m.length)x.prepareUpdate(),B()&&x._colorize3D(x),x.forceSyncModel4TreeListView(),x.pushUpdate(),t.callback&&t.callback();else{var y=0,N=[],C=[],w=[],A=[],I=[],E=[];x=this;const n=P.isMultiRootSupported();this.withTransactionUpdate(function(){p.iterate(m,function(e){e.setState(v.NODE_STATES.EXPANDING);var t=e;t.isRoot()||(t=t.getRoot());var o=e.validFilter;if(u){var i=e.getOccurencePath();t&&-1===w.indexOf(t.getID())&&(w.push(t.getID()),C.push(t)),y=Math.max(i.length-1,y),N.push(i)}else N.push([e.getID()]),-1===w.indexOf(e.getID())&&(w.push(e.getID()),C.push(e));o?n&&E.push(i):x.isAuthoredNode(e)?A.push(i):x.isIndexedNode(e)&&I.push(i)})});let a=x._getAuthoringFlag();new Map;let g=[];if(A.length>0&&g.push({path:A,isReadOnly:!0}),I.length>0&&g.push({path:I,isReadOnly:!1}),E.length)for(let e=0;e<E.length;e++)g.push({path:[E[e]],isReadOnly:!0});for(let t=0;t<g.length;t++){let n=g[t];x._getAuthoringFlag()&&(N=n.path,a=n.isReadOnly);let s=x._getExpandFunc(a);var O=[];O.push(new Promise(function(t,n){let a={pathIds:N,data:{expandLevel:l},FBIProxy:x.options.FBIProxy,timeout:3e4};x.prodConfigSupportInAuth&&(a.data.prodConfigSupportInAuth=x.prodConfigSupportInAuth),s(a).then(function(e){var s=c.data.jsonParse(e);if(s.timeoutOccurs)throw s;if(0===s.results.length)i.displayNotif({message:o.generic_service_failure,eventID:"error",key:"xNavDoc-expand-multi-select-generic-error"}),p.iterate(m,function(e){e.setState(v.NODE_STATES.NOCHILDREN)}),n();else{x._parseLoadModel=!0;let e=d.parseExpandLoadModel({treeDoc:x,expandedNodes:m,FBIProxy:x.options.FBIProxy,wsResponse:s,nodeModelClass:x.options.nodeModelClass,expandLevel:h});new f(x,e),new r(e,x.boundClearFlag);e.then(function(e){p.iterate(m,function(e){e.options.childComputed=!0,e.setState(v.NODE_STATES.EXPANDED)}),t()})}}).catch(function(o){o.timeoutOccurs&&i.displayNotif({message:e.errors.requesttimeout,level:"error",key:"xNavDoc-expand-multi-select-request-timeout"}),x.withTransactionUpdate(function(){p.iterate(m,function(t){i.displayNotif({message:e.replace(e.errors.cannotExpandObject,{rootLabel:t.getLabel(),expandLevel:"-1"===l?"all":l}),level:"error",key:"xNavDoc-expand-multi-select-parse-error"}),t.setState(v.NODE_STATES.COLLAPSED)})}),t()})}))}var M=Promise.allSettled(O);t.callback&&M.then(t.callback);new f(x,M);M.then(function(){s.publish({event:"ENXModel/SyncModel",data:{what:"expandMultiSelect"}})})}},clearLoadModelFlag:function(){this._parseLoadModel=!1},_getAuthoringFlag:function(){return!1},_getExpandFunc:function(e){let t=void 0!==window.jasmine;return(!this._boundExpandIndex&&!this._boundExpandDB||t)&&(this._boundExpandDB=l.expandv2DBprogressive.bind(l),this._boundExpandIndex=l.expandv2.bind(l)),e?this._boundExpandDB:this._boundExpandIndex},_getFetchFunc:function(e){let t=void 0!==window.jasmine;return(!this._boundFetchIndex&&!this._boundFetchDB||t)&&(this._boundFetchDB=l.fetchDB.bind(l),this._boundFetchIndex=l.fetch.bind(l)),e?this._boundFetchDB:this._boundFetchIndex},callForODT_applyChildComputedFlag:function(e,t){L(e,t)}},G}),define("DS/ENXNav/models/xNavTreeDoc",["DS/TreeModel/TreeDocument","DS/ENXNav/models/xNavNodeModel","DS/ENOXParser/modules/TwoDParser","DS/ENXNav/models/NodeUtils","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/ENXNav/models/mixins/TreeDocSelect","DS/ENXNav/models/mixins/TreeDocProxy","DS/ENXNav/models/mixins/TreeDocPopulate","DS/ENXNav/models/mixins/TreeDocAccess","DS/ENXNav/models/mixins/TreeDocShared","DS/ENXNav/models/mixins/TreeDocSupport","DS/ENXNav/models/mixins/TreeDocAdditionals","DS/ENXNav/models/_xNavGrouping","DS/PADUtils/PADTransactionManager","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g,f){"use strict";function v(){}return v.prototype=Object.assign(v.prototype,r.prototype),v.prototype=Object.assign(v.prototype,s.prototype),v.prototype=Object.assign(v.prototype,a.prototype),v.prototype=Object.assign(v.prototype,l.prototype),v.prototype=Object.assign(v.prototype,d.prototype),v.prototype=Object.assign(v.prototype,c.prototype),v.prototype=Object.assign(v.prototype,p.prototype),v.prototype=Object.assign(v.prototype,u.prototype),v.prototype=Object.assign(v.prototype,{setFBIProxyOptions:function(e){this.options.FBIProxy=e.FBIProxy},applyActiveView:function(e){this.options.active_view=e},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},_shouldAcceptDrop:function(e){var t=e.dropPosition;return"top"!==t&&"bottom"!==t},_shouldAcceptDrag:function(e,t){return!0},createNodeModel:function(e){return new this.options.nodeModelClass(e)}}),e.extend(h,v,{init:function(e){this.version="2.0";var s=e||{};s.shouldBeSelected=function(e){return!0!==e.isRelationsObjectGroupingNode},UWA.is(s.shouldAcceptDrop)||(s.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),UWA.is(s.shouldAcceptDrag)||(s.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),s.nodeModelClass=t,s.showModelChanges=!1,this._parent(s),o.setup({nls:{loadingText:i.loadingText},modules:{NodeUtils:n,_xNavGrouping:u}}).then(function(){console.log("parser is setup")}),this.options.viewport={},this.boundClearFlag=this.clearLoadModelFlag.bind(this),this.initProxy(),this.initSelectCB(),g.subscribe({event:"ENXViews/Model/FindInCtx"},this._findInCtx.bind(this)),this.onPreExpand(this.onPreExpandChecker.bind(this)),g.subscribe({event:"ENXViews/Model/SelectFromTagger"},this._selectFromTagger.bind(this)),this.getModelEvents().subscribe({event:"addChild"},function(e){var t=e.data.nodeModel,o=e.parent.getChildren();t.options.grid.actualIndex=o.indexOf(t)}),g.subscribe({event:"ENXModel/Model/ApplyGrouping"},this.__applyGrouping.bind(this)),g.subscribe({event:"ENXModel/Model/ExpandAllGroups"},this.__expandAllGroupsCmd.bind(this)),g.subscribe({event:"ENXModel/Model/FocusOnGroups"},this.__focusOnGroupsCmd.bind(this)),g.subscribe({event:"ENXModel/Model/ColorizeGroup"},this.__colorizeGroupCmd.bind(this)),g.subscribe({event:"ENXModel/Model/RemoveGroupColor"},this.__removeColorGroupCmd.bind(this)),g.subscribe({event:"ENXModel/Model/GroupsLayout"},this.__groupsLayoutCmd.bind(this)),g.subscribe({event:"ENXModel/Model/CopyLink"},this.__copyLink.bind(this))},isEditor:function(){return!1}})}),define("DS/ENXNav/utils/xNavCmdsMap",["DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADContext","DS/WebappsUtils/WebappsUtils","DS/ENXNav/utils/CtxMenuUtilsV2","DS/ApplicationFrame/CommandFactory","DS/ApplicationFrame/CommandsManager","DS/CoreEvents/Events","DS/PADServices/settings/AppSettings"],function(e,t,o,n,i,s,r,a){"use strict";function l(e){return this.options={context:null,toolbarActivated:!1,cmdsDefinition:null,commandMap:null,subscriptionWUX:[]},this.options=Object.assign(this.options,e),!0===this.options.toolbarActivated&&t.set(this.options.context),this}l.prototype.destroy=function(){this.options.subscriptionWUX.forEach(function(e){r.unsubscribe(e)})},l.prototype.initialize=function(e){var t=this;return new Promise(function(e,o){null!==t.options.cmdsDefinition&&t.options.cmdsDefinition.definition||o("Invalid input parameters"),require(["text!"+t.options.cmdsDefinition.definition],function(o){t.options.commandMap=new Map,t.options.cmdsJSON=JSON.parse(o),t.options.version=t.options.cmdsJSON.version,t._createCommands(t.options.cmdsJSON.commands).then(function(){t.options.subscriptionWUX.push(r.subscribe({event:d+"/ENABLE"},t._enableCommand.bind(t))),t.options.subscriptionWUX.push(r.subscribe({event:d+"/DISABLE"},t._disableCommand.bind(t))),e()})})})},l.prototype.getMap=function(){return this.options.commandMap},l.prototype._createCommands=function(e){var t=this;return new Promise(function(r){var d=[];Array.isArray(e)&&d.push(new Promise(function(n){for(var r=[],d=0;d<e.length;d++)r.push(new Promise(function(n){var r=this;"string"==typeof r.activationSetting&&!0!==a.getSetting(r.activationSetting)&&(r.deactivated=!0),(r.afr&&r.afr.AMD&&!0!==r.deactivated?new Promise(function(o){require([r.afr.AMD],function(e){if(e){var n=r.afr.args?r.afr.args:{};switch(r.afr.behavior){case"CATCommandHeader":var a=s.getCommand(r.id);a?r.isEnabled=a.isEnabled():i._createCommand(e,{context:null,ID:r.id,isEnabled:"boolean"!=typeof r.isEnabled||r.isEnabled,arguments:n});break;case"CATAfrHeaderCheck":var l=s.getCommandCheckHeader(r.id);l?r.isEnabled=l.isEnabled():l=i._createCommandCheckHeader(e,{context:null,ID:r.id,isEnabled:"boolean"!=typeof r.isEnabled||r.isEnabled,arguments:n}),l.onStateChange(function(){var e=t.options.commandMap.get(this._id);t._updateCheckHdr(this,e)})}}o()},function(e){console.warn("Cannot load ["+this.afr.behavior+"] of the command ["+this.id+"] with the AMD ["+this.afr.AMD+"]"),console.groupCollapsed("load failed with following error:"+e.message),console.log(e.stack),console.groupEnd(),o()}.bind(e[d]))}.bind(e[d])):Promise.resolve()).then(function(){r.icon&&r.icon.module&&r.icon.path&&(r.icon=o.getWebappsAssetUrl(r.icon.module,r.icon.path)),(r.HelpResourceFile&&!0!==r.deactivated?new Promise(function(e){r.HelpResourceFile.length?l.retrieveHlpRsc(r.HelpResourceFile).then(function(t){t&&(r.label=t[r.id+".Title"],r.unchecked&&r.unchecked.idNLS&&(r.labelUnchecked=t[r.unchecked.idNLS+".Title"]),r.checked&&r.unchecked.idNLS&&(r.labelChecked=t[r.checked.idNLS+".Title"]),r.tooltip={rscId:r.id,HelpResourceFile:r.HelpResourceFile}),e()}):e()}):Promise.resolve()).then(function(){if(!0!==r.noUXAvailable){var e=t.options.commandMap.get(r.id);e||(e={isEnabled:!0}),e=UWA.extend(e,r,!0),t.options.commandMap.set(r.id,e)}n()})}.bind(e[d]))}.bind(e[d])));Promise.all(r).then(n)})),d.push(n.initializeCmdMap({context:t.options.context,commandMap:t.options.commandMap})),Promise.all(d).then(r)})},l.prototype._updateCheckHdr=function(e){if(e.checked&&e.unchecked){var t=s.getCommandCheckHeader(e.id);t&&(!0===t.getState()?(e.checked.icon&&(e.icon=UWA.clone(e.checked.icon,!0)),e.state="selected",e.labelChecked&&(e.label=UWA.clone(e.labelChecked))):(e.unchecked.icon&&(e.icon=UWA.clone(e.unchecked.icon,!0)),e.state="",e.labelUnchecked&&(e.label=UWA.clone(e.labelUnchecked))))}},l.prototype._enableCommand=function(t){var o=t.getId(),n=this.options.commandMap.get(o);n&&!1===n.isEnabled&&(n.isEnabled=!0,this.options.commandMap.set(o,n),e.publish({event:"ENXCmds/Update",data:o}))},l.prototype._disableCommand=function(t){var o=t.getId(),n=this.options.commandMap.get(o);n&&!0===n.isEnabled&&(n.isEnabled=!1,this.options.commandMap.set(o,n),e.publish({event:"ENXCmds/Update",data:o}))};var d="/WUX/AFR/CMD/";return l.retrieveHlpRsc=function(e){return new Promise(function(t){var o=e.split("/"),n="i18n!"+o[0],i=o.splice(1,1);n+="/assets/help/"+i.join("/"),require([n],t,()=>{console.error("Cannot load "+n),t()})})},l}),define("DS/ENXNav/commands/HideIn3DCmd",["DS/ENXNav/commands/CmdUtils","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/ENOXInterWdgCom/LinkManager","DS/ENXNav/utils/xNavCmdsMap"],function(e,t,o,n,i){"use strict";return t.extend({init:function(t){this._parent(t),e.selectionMgt(this.options.ID,{atleastonevisible:!0});let o=function(){let e=n.getLinked(),t=!0;if(e.length>0)for(let o=0;o<e.length;o++){e[o].matchLinkability().matchingFeatures.includes("ENXContentSync2D")&&(t=!1)}t?this.disable():this.enable()}.bind(this);n.addEventListener("link",o),n.addEventListener("unlink",o)},execute:function(){var e=o.get().getPADTreeDocument().getSelectedNodes(),t=[];e.length>=1&&e.forEach(function(e){t.push(e.getOccurencePath())}),o.get().onHide({paths:t})}})}),define("DS/ENXNav/features/xNavSaveSort",["DS/ENXNav/utils/LocalStorageForAppState","DS/ENXNav/utils/TwoDAppEvents"],function(e,t){function o(e){this.options=e,this._boundPersist=this.persist.bind(this),this._boundReapply=this._reapplySortModel.bind(this),t.onExpand(this._boundReapply),t.onAddRoot(this._boundReapply),t.onAddChild(this._boundReapply),t.onRemoveRoot(this._boundReapply),t.onClearSort(this._onClearSort.bind(this)),t.onRefresh(this._boundReapply)}return o.prototype={initialize:function(){return new Promise(function(e,t){e()})},setup:function(e){this.setupOptions=e,this.setupOptions.dgv&&(this.options.dgv=this.setupOptions.dgv,this.options.actual=this.setupOptions.dgv.options.dgv,this.options.dgv.options.shouldClearSort=!0,this.options.actual.addEventListener("sortModelChange",this._boundPersist),widget.hasPreference("sortColumns")&&!0===widget.getValue("sortColumns")&&this.restore())},restore:function(){let t=e.get("sortModel");t&&(this._cachedSortModel=t,this.options.actual.sortModel=t)},_onClearSort:function(t){"begin"===t?(this._clearSortOccurring=!0,delete this._cachedSortModel,e.del("sortModel")):this._clearSortOccurring=!1},_reapplySortModel:function(e){this.options.actual&&(!this.options.actual.sortModel&&this._cachedSortModel?this.options.actual.sortModel=this._cachedSortModel:(!1===widget.getValue("sortColumns")&&this.options.dgv.options.shouldClearSort&&(this.options.dgv.options.shouldClearSort=!1),this.options.actual.reapplySortModel()))},persist:function(){if(!this._clearSortOccurring)if(this.options.dgv.isClearSortEnabled()){let t=this.options.actual.sortModel;t&&e.set("sortModel",t)}else delete this._cachedSortModel,e.del("sortModel")}},Object.defineProperties(o.prototype,{name:{get:function(){return"saveSorts"}}}),o}),define("DS/ENXNav/views/xNavDataGridView",["css!DS/ENXNav/ENXNav","i18n!DS/ENXNav/assets/nls/ENXNav.json","UWA/Core","DS/DataGridView/DataGridView","DS/PADUtils/PADCommandProxy","DS/ENXNav/views/customize_views/_xNavDGVParametrization","DS/ENXNav/views/customize_views/_xNavDGVUtils","DS/ENXNav/features/xNavSaveSort","DS/PADUtils/Configuration","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/Dimensions","DS/PADServices/settings/AppSettings","DS/PADServices/utils/DictionaryAccess"],function(e,t,o,n,i,s,r,a,l,d,c,p,u,h,g){"use strict";function f(){return d.getSetting("saveSorts")||"true"===c.getURLParameter("saveSorts")}function v(e){this.name="xnav-dgv",this._version=.1,this._additionalColumnsAMD=e.additionalColumnsAMD,this._cbDefinition=e.callbacksDefinition||{},this.options={renderTo:null,context:null,viewMode:"",view_customization:null,modelEvents:null,subscribeTokens:[],dgv:null,dgvLayout:null,isActiveView:!1,clickEvent:{},doubleClickEvent:{}},this.options=Object.assign(this.options,e)}return v.prototype=Object.assign(v.prototype,s.prototype),v.prototype=Object.assign(v.prototype,r.prototype),v.prototype.initialize=function(){var e=this;return new Promise(function(s){var r=o.clone(l.getConfig("dgvOptions"));e.options.viewMode=r.viewMode,e.options.useAsyncPreExpand=r.useAsyncPreExpand,e.options.activateFilterView=r.activateFilterView||"true"===c.getURLParameter("activateFilterView"),e.options.columnsDefaultfilterDefinition=r.columnsDefaultfilterDefinition,e.options.activateStatusBar=r.activateStatusBar,f()&&(e._saveSortsHandler=new a({})),e.buildDGVOpts().then(function(a){var l=o.extend({identifier:"DataGridView-"+e.name+"-"+c.uid()},a);if("undefined"!==r.dgvLayout){var u=o.clone(r.dgvLayout);void 0!==a.defaultCellHeight&&(u.cellHeight=a.defaultCellHeight,delete a.defaultCellHeight),void 0!==a.rowsHeader&&(u.rowsHeader=a.rowsHeader,delete a.rowsHeader),l.layoutOptions=u}else l.layoutOptions={};e.options.viewMode=a.viewMode?a.viewMode:"comfortable",l.layoutOptions.layoutDensity=e.options.viewMode,"undefined"!==r.useAsyncPreExpand&&(l.useAsyncPreExpand=r.useAsyncPreExpand),l.showContextualMenuColumnFlag=!0,!0===h.getSetting("grpBSD")&&(l.rowGroupingOptions={depth:1,hideGroupedColumns:!1,getNodeGroupingKey:(o,n)=>{let i=e.options.dgvLayout.getColumnOptionValue(n,"text"),s="rel"===e.options.dgvLayout.getColumnOptionValue(n,"ds6wFrom");"string"!=typeof i?i="":i+=!0===s?t.groupingNode.fromInstance:":  ";let r=o.getReferenceValue(n);void 0===r&&(r=t.groupingNode.notValuated);return i+r},getGroupingNodeLabel:e=>{var t=e.getOriginalChildrenInformation().notHiddenNotFilteredChildrenCount;return e.getIdentifier()+" ("+t+")"},getGroupingNodeIcons:()=>[{iconName:"group"}],canNodeBeGrouped:e=>{return!e.isRelationsObjectNode},mapGroupingKeys:e=>{let t,o=[],n=new Map;for(let i in e){const s={};s[i]=[];for(let o=0;o<e[i].length;o++){const r=e[i][o].split(":");if(r.length>1){t||(t=r[0]);const a=r[1].trim();n.set(e[i][o],r[1].trim()),s[i].push(a)}}o.push(g.retrieveNLS({nlsData:s}))}return Promise.all(o).then(function(e){let o={};for(let[i,s]of n)for(let n=0;n<e.length;n++){const r=e[n],a=Object.values(r),l=Object.keys(r)[0];o[l]||(o[l]={});for(let e=0;e<a.length;e++)if(a[e][s]){o[l]={...o[l],[i]:t+": "+a[e][s]};break}}return o})}},p.subscribe({event:"ENXModel/parseEnded"},()=>{e.options.dgv.groupingApplied&&e.options.dgv.groupRows({dataIndexesToGroup:[e.options.dgv.groupingApplied]})}));var v=e.options.dgv=new n(l);f()&&e._saveSortsHandler.setup({dgv:e}),!0===h.getSetting("activateStatusBar")&&e.__buildStatusBar(),e.options.dgvLayout=v.layout;var m=v.getColumnOrGroup("ContextualMenuColumn");if(m){if(e.options.dgv.prepareUpdateView(),void 0!==a.ctxMenuColumn){v.onReady(function(){void 0!==a.ctxMenuColumn.pinned&&e.changePinCB("ContextualMenuColumn",a.ctxMenuColumn.pinned);var t=e.options.dgvLayout.getColumnIndex("ContextualMenuColumn");t!==a.ctxMenuColumn.columnIdx&&e.moveColumnCB({move2perform:{fromID:t,toID:a.ctxMenuColumn.columnIdx}}),void 0!==a.ctxMenuColumn.visibleFlag&&!1===a.ctxMenuColumn.visibleFlag&&e.hideColumn("ContextualMenuColumn")})}m.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!1}},e.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0)}var b=v._keymapManager,_=function(){var e=require("DS/ApplicationFrame/CommandsManager").getCommand("ActionBar_Attributes");e&&e.isEnabled()&&e.begin()};["alt+return","alt+enter"].forEach(function(e){b.unregisterKeymap(e),b._commandsRegistry.registerCommand("enxdgv:"+e,_),b.registerKeymap(e,void 0,"enxdgv:"+e)});var D=["ctrl+shift+f"];if(b.unregisterKeymap(D),b._commandsRegistry.registerCommand("enxdgv:"+D,function(){var e=require("DS/ApplicationFrame/CommandsManager").getCommand("FindCmd");e&&e.isEnabled()&&e.begin()}),b.registerKeymap(D,void 0,"enxdgv:"+D),e.options.additionalColumnsModules)for(var S=0;S<e.options.additionalColumnsModules.length;S++){if(e.options.additionalColumnsModules[S].getTypeRepresentations){var x=e.options.additionalColumnsModules[S].getTypeRepresentations();v.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(x))}e.options.additionalColumnsModules[S].setupDGVManipulation&&e.options.additionalColumnsModules[S].setupDGVManipulation({onAddColumn:function(t){e.addColumnCB(o.clone(t.addedColumns))},onRemoveColumn:function(t){e.removeColumnCB(o.clone(t.removedColumns))}})}v.getTypeRepresentationFactory().registerTypeRepresentations(e.getTypeRepresentations()),e._commandProxy=i.create(),e.eventHandlerOnGridView(v).then(function(){v.getContent().addClassName(e.name),e.options.renderTo&&!0===e.options.isActiveView&&v.inject(e.options.renderTo),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/DatagridView/ExportAs"},e._exportAsCmd.bind(e))),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/ActionBar/statusChanged"},t=>{t&&"true"===t.dataOpen?navigator.userAgent.match(/Android|iPhone|iPod|BlackBerry|Opera Mini|IEMobile/i)?e.options.dgvLayout.scrollPaddingBottom=110:RegExp(/Macintosh/i).test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2?e.options.dgvLayout.scrollPaddingBottom=110:e.options.dgvLayout.scrollPaddingBottom=75:e.options.dgvLayout.scrollPaddingBottom=0})),p.publish({event:"ENXViews/ActionBar/status"}),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/Model/FindInCtx"},e.removeFilterView.bind(e))),e.options.subscribeTokens.push(p.subscribe({event:"ENXModel/Root/remove"},t=>{e.removeFilterView()})),e.options.subscribeTokens.push(p.subscribe({event:"ENXViews/DatagridView/CheckColumns"},t=>{e.removeColumns(t.colsToRemove),e.saveCustoView(!0,!1),p.publish({event:"ENXViews/DatagridView/CheckColumns/Done"})})),s()}),require(["DS/PADUtils/PADUtilsServices"],function(t){e.options.currentTenant=t.getPlatformId(),d.addEvent("onX3dPlatformId",function(t){e.options.currentTenant!==t&&(e.options.currentTenant=t,"function"==typeof e.options.onTenantChange&&e.options.onTenantChange({updateTreeView:function(t){o.is(t)&&""!==t?console.warn("Modification of columns during Tenant modification must be done"):e.reset()}}))})})})})},v.prototype.destroy=function(){for(var e=0;e<this.options.subscribeTokens.length;e++)p.unsubscribe(this.options.subscribeTokens[e])},v.prototype.setModel=function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this.options.dgv.treeDocument=e,!0===this.options.activateFilterView&&this.options.dgv.treeDocument.setFilterModel(this.options.filterModel),this.toggleStatusBarListener(!0)},v.prototype.completeDGVOptions=function(e){return new Promise(function(t){for(var o=0;o<e.columns.length;o++){let t=e.columns[o];!0===h.getSetting("activateUnits")&&"tree"!==t.dataIndex&&void 0===t.getCellValue&&(t.typeRepresentation="string",t.getCellValue=function(e){let o=this.getColumnOrGroup(e.columnID);if(!e.isHeader&&o){let o;if(e.nodeModel){let n=e.nodeModel.getReferenceValue(t.dataIndex);o="object"==typeof n&&n.inputValue?n.inputValue+" "+u.getNLSForUnit(n.inputUnit):n}return o}},t.getCellValueForSort=function(e,o){let n,i=e.getReferenceValue(t.dataIndex);return n="object"==typeof i&&i.inputValue?i.value:i},t.getCellValueForExport=function(e){let o=this.getColumnOrGroup(e.columnID);if(!e.isHeader&&o){let o;if(e.nodeModel){let n=e.nodeModel.getReferenceValue(t.dataIndex);o="object"==typeof n&&n.inputValue?n.inputValue+" "+u.getNLSForUnit(n.inputUnit):n}return o}}),void 0===t.getCellClassName&&(t.getCellClassName=function(e){var t=[];return e.nodeModel&&!0===e.nodeModel.options.isBeingCut&&t.push("dgv-cutNode"),t.join(" ")})}t(e)})},v.prototype.unsetModel=function(){this.options.isActiveView&&(this.options.renderTo.removeChild(this.options.dgv.getContent()),this.toggleStatusBarListener(!1),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},v.prototype.isColumnHidden=function(e){var t=!0;return this.options.dgv&&this.options.dgv.getColumnOrGroup(e)&&"boolean"==typeof this.options.dgv.getColumnOrGroup(e).visibleFlag&&(t=!this.options.dgv.getColumnOrGroup(e).visibleFlag),t},v.prototype.isColumnExportable=function(e){var t=!0;if(this.options.dgv&&this.options.dgv.getColumnOrGroup(e)){var o=this.options.dgv.getColumnOrGroup(e);o.customisation&&o.customisation.exportable&&(t="boolean"!=typeof o.customisation.exportable.value||o.customisation.exportable.value)}return t},v.prototype.showColumn=function(e){this.changeVisibilityCB(e,!0)},v.prototype.hideColumn=function(e){this.changeVisibilityCB(e,!1)},v.prototype.updateView=function(){this.options.dgv.updateView(!0)},v.prototype.changeColumnTitle=function(e,t){this.changeTitleCB(e,t)},v.prototype.setUseClipboardFlag=function(e){this.options.dgv.setUseClipboardFlag(e)},v.prototype.getColumnsForExport=function(){for(var e=[],t=this.options.dgvLayout.getOrderedColumnsIndexes(),o=0;o<t.length;o++){var n=this.options.dgvLayout.getColumnOptionValue(t[o],"customisation");n&&n.exportable&&!0===n.exportable.value&&e.push(this.options.dgvLayout.getDataIndexFromColumnIndex(t[o]))}return e},v.prototype.removeFilterView=function(){if(this.options.dgv){const e=this.options.dgv.getFilterViewManager(),t=e.getFilterViews();(!e.isEmpty()||this.options.dgv.treeDocument&&0===this.options.dgv.treeDocument.getRoots().length)&&(console.debug("DGV: Reset View Filter"),Object.keys(t).forEach(e=>{t[e].filter.filterModel=void 0}))}},v.prototype.reapplySortModel=function(){this.options.dgv&&this.options.dgv.reapplySortModel()},v.prototype.refreshStatusBar=function(){if(this.options.dgv.elements.statusBar){let e=this.options.dgv.elements.statusBar.getNodeModelByID("switchSGIId");if(e){let t=h.getSetting("redirectQueryToSGI");e.updateOptions({icon:{iconName:"warning-symbol-biohazard",fontIconFamily:1,className:"enx-sgi-status enx-status-bar "+(!0===t?"activated":"")}})}}},v});