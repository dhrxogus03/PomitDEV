define("DS/ENOXAttachmentsUX/utils/Menus",["UWA/Core","UWA/Utils/InterCom","DS/LifecycleCmd/MaturityCmd","DS/DocumentCommands/DOCMClipboard","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,a,i){"use strict";return function(e){var a={socket:null,init:function(e){this.ctrl=e},handler:function(e){a.actions[e.menuItem.methodName]&&a.actions[e.menuItem.methodName](a.ctrl,e.nodeModels,e.menuItem,e.target)},actions:{ctxRelations:function(e,n,o,i){var s=a.ctrl.helper.make3DXContent(n);s.appId="ENORIPE_AP";var r=new t.Socket("compassPageSocket");r.subscribeServer("com.ds.compass",window.parent),r.dispatchEvent("onSetX3DContent",s,"compassPageSocket"),r.addListener("launchApp",function(e,t,n){r.unsubscribeServer("com.ds.compass"),r.disconnect()}),r.dispatchEvent("onLaunchApp",s,"compassPageSocket")},ctxCopy:function(e,t,n,i){var s=a.ctrl.helper.make3DXContent(t);o.copy(s)},ctxMaturity:function(e,t,o,a){var i={securitycontext:e.options.connectorOptions.fetchSecurityContext(),context:{}};new n(i).executeAsync(t.map(function(t){return{physicalid:t.options.data.id,serviceurl:e.options.connectorOptions.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/"}}))},ctxShare:function(e,t,n,o){var a=this;require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],function(e,n){var o=t.map(function(t){return new e({physicalId:t.options.data.id,name:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})});a.sharePanel?(a.sharePanel.show(o),a.sharePanel.container.centerIt()):(a.sharePanel=new n(widget,widget.body,{removeAtClose:!0,events:{onClose:function(){a.sharePanel=null}}}),a.sharePanel.show(o))})},ctxProperties:function(e,t,n,o){require(["DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],function(n){var o=t.map(function(t){return{id:t.options.data.id,type:"Document Proxy"==t.options.data.type?t.options.data.type+`?parentId=${e.options.parentObject.parentId}`:t.options.data.type,tenant:e.options.connectorOptions.platformUrls.platformId,source:"Document Proxy"==t.options.data.type?"www":"3DSpace",getID:function(){return t.options.data.id}}}),a={getSelectedNodes:function(){return o},getSecurityContext:function(){return{SecurityContext:e.options.connectorOptions.fetchSecurityContext()}}};(new n).launchProperties(a)})}}};return a.init(e),a}}),define("DS/ENOXAttachmentsUX/utils/URLDialog",["UWA/Controls/Abstract","DS/Form/Form","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Core/WebUXGlobalEnums","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n,o,a,i){return e.extend({modal:{},name:"docm-attachment-url-dialog",options:{className:""},_options:{},modelEvents:void 0,init:function(e){e.events&&(this.events=e.events,delete e.events),this._parent(e),this.events&&(e.events=this.events),this.buildSkeleton()},buildSkeleton:function(){var e=this;e.immersiveFrame=new n({identifier:"attach_url"});let s=new t({invalidDisplayPolicy:a.InvalidDisplayPolicy.OnInput,model:[{id:"title",label:i.get("Title"),typeRepresentation:"string",value:e.options.dialogCustomizations.defaultTitle?e.options.dialogCustomizations.defaultTitle:void 0,invalidFlag:!e.options.dialogCustomizations.defaultTitle,invalidTooltip:{shortHelp:i.get("CanNotBeEmpty",{field:i.get("Title")})},onNodeLiveUpdate:e=>{var t=e.id,n=e.value;n.length<1&&(s.globalInformation={text:i.get("CanNotBeEmpty",{field:i.get("TitleOrURL")}),emphasize:"error"}),s.updateModelItem(t,{invalidFlag:n.length<1}),this.DialogButtonVisibilityChecker()}},{id:"url",label:i.get("URL"),typeRepresentation:"string",value:e.options.dialogCustomizations.defaultUrl?e.options.dialogCustomizations.defaultUrl:void 0,invalidFlag:!e.options.dialogCustomizations.defaultUrl,invalidTooltip:{shortHelp:i.get("CanNotBeEmpty",{field:i.get("URL")})},semantics:{placeholder:i.get("URLPlaceHolder")},onNodeLiveUpdate:e=>{var t=e.id,n=e.value;n||(n="");var o=n.length<1;o&&(s.globalInformation={text:i.get("CanNotBeEmpty",{field:i.get("TitleOrURL")}),emphasize:"error"}),s.updateModelItem(t,{invalidFlag:o}),this.DialogButtonVisibilityChecker()}}],usePaddingFlag:!0}),r={label:i.get("Cancel"),onClick:function(t){e.attachUrlCompleteEventToken&&(e.events.unsubscribe(e.attachUrlCompleteEventToken),e.attachUrlCompleteEventToken=void 0),t.dsModel.dialog.destroy(),e.immersiveFrame.destroy(),t.dsModel=null},role:a.WUXCustomButtonRoleEnum.Escape},l=[{label:e.options.dialogCustomizations.defaultConfirmButtonTitle?i.get(e.options.dialogCustomizations.defaultConfirmButtonTitle):i.get("Create"),emphasize:"primary",disabled:!e.options.dialogCustomizations.defaultConfirmButtonVisibility||!e.options.dialogCustomizations.defaultConfirmButtonVisibility,onClick:function(t){if(t.dsModel.dialog.getCustomButtons()[0].disabled=!0,t.dsModel.dialog.checkboxInfos.checkFlag){t.dsModel.dialog._isCreateInProgress=!0,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Creating")}),t.dsModel.dialog._requestInProgress=!0;//! to be removed
var n=t.dsModel.dialog.content.getModelItem("title").value,o=t.dsModel.dialog.content.getModelItem("url").value;o=/^[A-Za-z]+:/.test(o)?o:`https://${o}`,e.options&&e.options.onConfirm&&e.options.onConfirm({title:n,url:o}),e.attachUrlCompleteEventToken&&(e.events.unsubscribe(e.attachUrlCompleteEventToken),e.attachUrlCompleteEventToken=void 0),e.attachUrlCompleteEventToken=e.events.subscribe({event:"attach-url-attachment-complete"},function(n){if(t&&t.dsModel&&t.dsModel.dialog&&t.dsModel.dialog.content&&t.dsModel.dialog.getCustomButtons&&t.dsModel.dialog.getCustomButtons().length>0){t.dsModel.dialog._isCreateInProgress=!1;var o=t.dsModel.dialog.content.getModelItem("title").value,a=t.dsModel.dialog.content.getModelItem("url").value;a=/^[A-Za-z]+:/.test(a)?a:`https://${a}`,n.urlData.title==o&&n.urlData.url==a?(t.dsModel.dialog.getCustomButtons()[0].disabled=!1,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Create")}),t.dsModel.dialog.content.updateModelItem("title",{invalidFlag:!t.dsModel.dialog.content.getModelItem("title").value.length>0}),t.dsModel.dialog.content.updateModelItem("url",{invalidFlag:!t.dsModel.dialog.content.getModelItem("url").value.length>0}),e.DialogButtonVisibilityChecker()):(t.dsModel.dialog._isCreateInProgress=!1,t.dsModel.dialog.getCustomButtons()[0].disabled=!1,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Create")}),t.dsModel.dialog.content.updateModelItem("title",{invalidFlag:!t.dsModel.dialog.content.getModelItem("title").value.length>0}),t.dsModel.dialog.content.updateModelItem("url",{invalidFlag:!t.dsModel.dialog.content.getModelItem("url").value.length>0}),e.DialogButtonVisibilityChecker())}}),e.attachUrlFailureEventToken&&(e.events.unsubscribe(e.attachUrlFailureEventToken),e.attachUrlFailureEventToken=void 0),e.attachUrlFailureEventToken=e.events.subscribe({event:"attach-url-attachment-failure"},function(e){t&&t.dsModel&&t.dsModel.dialog&&t.dsModel.dialog.content&&t.dsModel.dialog.getCustomButtons&&t.dsModel.dialog.getCustomButtons().length>0&&(t.dsModel.dialog._isCreateInProgress=!1,t.dsModel.dialog.getCustomButtons()[0].disabled=!1,t.dsModel.dialog.getCustomButtons()[0].setProperties({label:i.get("Create")}))})}else e.options&&e.options.onConfirm&&e.options.onConfirm({title:t.dsModel.dialog.content.getModelItem("title").value,url:t.dsModel.dialog.content.getModelItem("url").value}),t.dsModel.dialog.destroy(),e.immersiveFrame.destroy(),t.dsModel=null},role:a.WUXCustomButtonRoleEnum.Validate},r];this.DialogButtonVisibilityChecker=function(){var e=s.invalidState,t=this.myDialog.getCustomButtons()[0];e||1==this.myDialog._isCreateInProgress?t.disabled=!0:(s.globalInformation=void 0,t.disabled=!1)},e.myDialog=new o({immersiveFrame:e.immersiveFrame,identifier:"attachURLDialog",title:e.options.dialogCustomizations.defaultDialogTitle?i.get(e.options.dialogCustomizations.defaultDialogTitle):i.get("NewLink"),content:s,activeFlag:!1,resizableFlag:!0,width:400,modalFlag:!0,checkboxInfos:{label:i.get("Repeat"),checkFlag:!1},customButtonsDefinition:l}),e.myDialog._isCreateInProgress=!1,e.myDialog.addEventListener("close",t=>{e.attachUrlCompleteEventToken&&(e.events.unsubscribe(e.attachUrlCompleteEventToken),e.attachUrlCompleteEventToken=void 0),e.immersiveFrame.destroy()}),e.immersiveFrame.inject(widget.body)}})}),define("DS/ENOXAttachmentsUX/views/GridPane",["UWA/Core","DS/DataGridView/DataGridView","DS/TreeModel/DataModelSet","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n,o){"use strict";return function(a){var i={build:function(a){this.ctrl=a,i.container=e.createElement("div",{class:a.getClassNames("-gridpane"),styles:{display:"none"}}),i.container.inject(a.elements.panes),a.config.headers.forEach(e=>{"stateNLS"==e.dataIndex&&(e.getCellSemantics=function(e){return{emphasize:a.helper.getStateEmphasisClassname(e.nodeModel.options.data)}})});var s=new n;a.config.headers.forEach(e=>{"Title"==e.text&&(e.getCellValue=function(e){if(e.nodeModel)return{label:e.nodeModel.options.label,url:e.nodeModel.options.grid.proxyurl}})});var r="";widget.environment&&widget.environment.data&&widget.environment.data._data&&(r=widget.environment.data._data._x_appId);var l="ENOXAttachmentsUX_"+a.options.attachmentsType+"_"+(e.is(widget.data.appId)?widget.data.appId:r);i.datagridview=new t({identifier:l,treeDocument:i.ctrl.controller.attachments,dataModelSet:s,columns:a.config.headers,selectionMode:"row",showSelectionCheckBoxesFlag:!0,showRowIndexFlag:!1,cellDragEnabledFlag:!0,showContextualMenuColumnFlag:!0,rowSelection:"multiple",cellSelection:"none",onDragStartCell:function(e,t){this.onDragStartCellDefault(e,t),e.dataTransfer.effectAllowed="all";var n=["Document Proxy"],s=[],r=[];i.datagridview.treeDocument.getSelectedNodes().forEach(e=>{n.includes(e.options.data.dataelements.type)?s.push(e.options.data.dataelements.type):r.push(e)}),s.length>0&&(s=[...new Set(s)]).forEach(e=>{"Document Proxy"==e&&(e="Link"),a.controller.showNotification("warning",o.get("Invalid_Content"),o.get("Selected_Objects_Invalid"),o.get("Objects_WillBE_Removed",{type:e}))}),e.dataTransfer.setData("Text",JSON.stringify(i.ctrl.helper.make3DXContent(r,i.ctrl.controller.options)))},onContextualEvent:function(e){var t=[];if(e&&e.collectionView){t=e.collectionView.buildDefaultContextualMenu(e,{});var n,o,a="event"in window?event:window.event;if(a)n=a.target,a.clientX&&(o={x:a.clientX,y:a.clientY});else if(e&&e.data&&e.data.windowPosition&&e.data.windowPosition.x&&e.data.windowPosition.y){var s=e.data.windowPosition;o={x:s.x,y:s.y}}else e&&e.data&&e.data.target?n=e.data.target:e.cellInfos&&(n=e.cellInfos.cellView.elements.container);i.datagridview.treeDocument.getSelectedNodes().length>0?i.ctrl.controller.prepareContextMenu(i.datagridview.treeDocument.getSelectedNodes(),n,o):e.cellInfos&&e.cellInfos.nodeModel?i.ctrl.controller.prepareContextMenu([e.cellInfos.nodeModel],n,o):null==e.cellInfos&&i.ctrl.controller.prepareRightClickMenuNoObjectSelection(n,o)}return t}}).inject(i.container),i.datagridview.registerReusableCellContent({id:"actionButton",buildContent:function(){var t=new e.Element("div",{class:"fonticon fonticon-chevron-down",styles:{color:"#b4b6ba",display:"list-item","font-size":"18px",width:"100%"}});return t.addEvent("click",function(e){e.nodeModels=[e.target.cellInfos.nodeModel],i.ctrl.controller.actionMenuHandler(e)}),t}}),i.datagridview.sortModel=[a.topBar.currentSort],a.gridPane=i},show:function(){this.container.show()},hide:function(){this.container.hide()}};return i.build(a),i}}),define("DS/ENOXAttachmentsUX/views/TilePane",["UWA/Core","DS/CollectionView/ResponsiveLargeTilesCollectionView","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n){"use strict";return function(o){var a={build:function(o){a.ctrl=o,a.container=e.createElement("div",{class:o.getClassNames("-tilepane"),styles:{display:"none"},events:{contextmenu:function(e){e.preventDefault(),a.ctrl.controller.prepareRightClickMenuNoObjectSelection(e.target,{x:e.clientX,y:e.clientY})}}}),a.container.inject(o.elements.panes),a.rcv=a.container.rcv=new t({model:a.ctrl.controller.attachments,useDragAndDrop:!0,shouldCellAllowUnsafeHTMLContentAt:function(e,t){return["subtitle","description"].includes(t)},displayedOptionalCellProperties:["contextualMenu","description","activeFlag"],onDropBlank:function(e,t){e.preventDefault(),e.stopPropagation(),a.ctrl.dndManager.handleDrop(e),this.onDropBlankDefault(e,t)},onDragStartCell:function(e,t){this.onDragStartCellDefault(e,t),e.dataTransfer.effectAllowed="all";var i=["Document Proxy"],s=[],r=[];a.rcv.TreedocModel.getSelectedNodes().forEach(e=>{i.includes(e.options.data.dataelements.type)?s.push(e.options.data.dataelements.type):r.push(e)}),s.length>0&&(s=[...new Set(s)]).forEach(e=>{"Document Proxy"==e&&(e="Link"),o.controller.showNotification("warning",n.get("Invalid_Content"),n.get("Selected_Objects_Invalid"),n.get("Objects_WillBE_Removed",{type:e}))}),e.dataTransfer.setData("Text",JSON.stringify(a.ctrl.helper.make3DXContent(r,a.ctrl.controller.options)))},onDragEnterBlank:function(e,t){o.options.readonly||this.onDragEnterBlankDefault(e,t)}}).inject(a.container),a.rcv.getContextualMenu=function(e,t,n){return[""]},a.rcv.getLabel=function(t){return e.String.escapeHTML(t.options.label)},a.rcv.onContextualEvent={callback:function(e){if(e&&e.cellInfos){if(e.cellInfos.cellModel){var t,n,o="event"in window?event:window.event;if(o)t=o.target,o.clientX&&(n={x:o.clientX,y:o.clientY});else if(e&&e.data&&e.data.windowPosition&&e.data.windowPosition.x&&e.data.windowPosition.y){var i=e.data.windowPosition;n={x:i.x,y:i.y}}else t=e&&e.data&&e.data.target?e.data.target:e.cellInfos.cellView.elements.container;t&&t.hasClassName&&t.hasClassName("wux-controls-responsivetileview-menu")?a.rcv.TreedocModel.getSelectedNodes().length>1?a.ctrl.controller.prepareContextMenu(a.rcv.TreedocModel.getSelectedNodes(),t,n):a.ctrl.controller.prepareContextMenu([e.cellInfos.nodeModel],t,n):a.ctrl.controller.prepareContextMenu(a.rcv.TreedocModel.getSelectedNodes(),t,n)}}else e.cellCtxMenuRequired;return o.stopPropagation(),[]}},a.rcv.onSelectionAdd(function(e,t){a.ctrl.modelEvents.publish({event:"selection-add",data:e})}),a.rcv.onSelectionRemove(function(e,t){a.ctrl.modelEvents.publish({event:"selection-remove",data:e})}),o.tilePane=a},show:function(){this.container.show()},hide:function(){this.container.hide()},repaintUI:function(){a.rcv._modelEvents.publish({event:"ENDRESIZE",context:a.rcv})},destroy:function(){a.rcv.destroy()}};return a.build(o),a}}),define("DS/ENOXAttachmentsUX/views/UploadPane",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n,o){"use strict";return function(a){var i={build:function(a){this.ctrl=a,this.container=e.createElement("div",{class:a.getClassNames("-uploadpane"),events:{contextmenu:function(e){e.preventDefault(),i.ctrl.controller.prepareRightClickMenuNoObjectSelection(e.target,{x:e.clientX,y:e.clientY})}}}),this.container.inject(a.elements.panes);var s=e.createElement("div",{class:a.getClassNames("-uploadpane-center")});s.inject(this.container);var r=e.createElement("div",{class:a.getClassNames("-uploadpane-center-msg")});r.inject(s);var l=e.createElement("div",{class:a.getClassNames("-uploadpane-center-buttons")});a.options.readonly?r.setText(o.get("NO_DOCUMENTS_ATTACHED")):l.inject(s),i.uploadButton=this.container.uploadButton=new n({input:!1,multiple:!0,buttonText:o.get("UPLOAD_DOCUMENTS"),attributes:{title:o.get("UPLOAD_DOCUMENTS")},buttonClassName:"primary",events:{onChange:function(e){var t=e.target.files.length>0?e.target.files:e.dataTransfer.files;i.ctrl.modelEvents.publish({event:"user-selects-files-for-upload",data:{cancelled:!1,files:t}})},onClick:function(){event.target.value=""}}}),i.uploadButton.inject(l),i.attachButton=this.container.attachButton=new t({value:o.get("ATTACH_EXISTING"),attributes:{title:o.get("ATTACH_EXISTING")},events:{onClick:function(e){i.ctrl.modelEvents.publish({event:"user-clicks-attach",data:{cancelled:!1}})}}}),i.attachButton.inject(l),a.uploadPane=i},show:function(){this.container.show()},hide:function(){this.container.hide()}};return i.build(a),i}}),define("DS/ENOXAttachmentsUX/Actions/OpenLink",["UWA/Core","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t){"use strict";var n=function(e){return{id:"openLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"open",fontIconFamily:1},label:t.get("OpenLink"),tooltip:t.get("OpenLink"),position:"far",category:"dialog",value:function(t){t.options=e,n.execute(t)},visibleFlag:!0},execute:function(){n.execute({options:e})},updateForSelection:function(e,t){return Promise.resolve(!0)}}};return n.execute=function(e){e.options.getSelectedNodes().length>0&&window.open(e.options.getSelectedNodes()[0].options.data.dataelements.proxyurl)},n}),define("DS/ENOXAttachmentsUX/data/Constants",[],function(){"use strict";return{ERROR:"error",PRIMARY:"primary",WARNING:"warning",INFO:"info",SUCCESS:"success",PAD_CURRENT_SECURITY_CONTEXT:"pad_security_ctx",PAD_AVAILABLE_SECURITY_CONTEXT:"pad_security_ctx_list",PAD_CSRF_TOKEN:"pad_csrf",PLATFORM_SERVICES:"platformServices",CONTEXT_USER:"context_user",CSRF:"CSRF",OBJECT_ID:"id",PHYSICAL_ID:"physicalid",REL_ID:"id[connection]",REL_NAME:"name[connection]",REL_PHYSICAL_ID:"physicalid[connection]",TYPE:"type",NAME:"name",REVISION:"revision",MODIFIED:"modified",REFERENCE_DOCUMENT:"Reference Document",SPECIFICATION_DOCUMENT:"SpecificationDocument",REL_PLMDOCCONNECTION:"PLMDocConnection",Document_Proxy:"Document Proxy",ACCEPT_APPLICATION_JSON:"application/json",SECURITY_CONTEXT_KEY:"SecurityContext",CONTENT_TYPE:"Content-Type",APPLICATION_URL_ENCODED:"application/x-www-form-urlencoded",GET:"GET",POST:"POST",PUT:"PUT",Resources:{GET_SECURITY_CONTEXT:"/resources/pno/person/getsecuritycontext?tenant=",GET_DOCS_BY_PARENT:"/resources/v1/modeler/documents/parentId/"},Query:{REFERENCE_DOCS:"?parentRelName=Reference%20Document&parentDirection=from&$include=versions"}}}),define("DS/ENOXAttachmentsUX/utils/MaturityCache",["UWA/Core","DS/WAFData/WAFData"],function(e,t){"use strict";var n={cachedPolicies:null,setup:function(e){n.options=e,n.load()},fetchPolicies:function(e,o){if(n.cachedPolicies&&n.cachedPolicies[widget.lang]&&e.every(n.hasStateInfoForDoc))o(n.cachedPolicies);else{var a={url:n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId,type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",securitycontext:n.options.fetchSecurityContext()},data:JSON.stringify({data:e.map(function(e){return{physicalid:e.id}})}),onComplete:function(e){e.status&&null==e.status.errorMsg&&(n.cachedPolicies=n.cachedPolicies||{},n.cachedPolicies[widget.lang]=n.cachedPolicies[widget.lang]||{},e.data.policies.forEach(function(e){n.cachedPolicies[widget.lang][e.name]=n.cachedPolicies[widget.lang][e.name]||{},e.maturityGraph.states.forEach(function(t){n.cachedPolicies[widget.lang][e.name][t.stateSysName]=t})}),localStorage.setItem("DocoMaturityCache:"+n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId,JSON.stringify(n.cachedPolicies)),o(n.cachedPolicies))},onFailure:function(e,t){}};t.authenticatedRequest(a.url,a)}},load:function(){var e=localStorage.getItem("DocoMaturityCache:"+n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId);null!=e&&null!=(e=JSON.parse(e))&&(n.cachedPolicies=e)},hasStateInfoForDoc:function(e){if(n.cachedPolicies&&n.cachedPolicies[widget.lang]&&(null!=n.cachedPolicies[widget.lang][e.dataelements.policy]&&null!=n.cachedPolicies[widget.lang][e.dataelements.policy][e.dataelements.state]))return!0;return!1}};return n}),define("DS/ENOXAttachmentsUX/views/Topbar",["UWA/Core","DS/UIKIT/Iconbar","DS/DocumentCommands/DOCMClipboard","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n,o){"use strict";return function(o){var a={ctrl:void 0,build:function(o){this.ctrl=o;var i=[];o.config.actionbar.forEach(function(e){e.content&&e.content.options&&e.content.options.items&&e.content.options.items.length&&(e.content.options.events={onClick:function(e,t,n){a.handleClick(e,t,n)}},"sort"==e.name&&e.content.options.items.forEach(function(e){e.selected&&(a.currentSort={dataIndex:e.dataIndex,sort:e.order})})),i.push(e)}),this.container=e.createElement("div",{class:o.getClassNames("-topbar")}),this.container.inject(o.elements.content),e.createElement("div",{class:o.getClassNames("-topbar-filler")}).inject(this.container),this.actionbar=new t({renderTo:this.container,items:i,className:o.getClassNames("-actionbar"),events:{onClick:function(e,t,n){a.handleClick(e,t,n)}}}),a.selectedItemsMenuButton=a.container.getElement("[name=actions]"),a.setPasteEnabled(),n.events.subscribe({event:"x3dcontent-copied"},function(e){a.setPasteEnabled()}),this.setReadOnly(o.options.readonly),o.topBar=a},handleClick:function(e,t,n,o){t&&(a.actions[t.methodName]?a.actions[t.methodName](e,t,n):t.name.startsWith("viewswitch")?a.actions.SwitchView(e,t,n):t.fonticon.startsWith("sort-")&&a.actions.SwitchSort(e,t,n))},actions:{ActionActions:function(e,t,n){e.nodeModels=a.ctrl.controller.attachments.getSelectedNodes(),a.ctrl.controller.actionMenuHandler(e)},ActionUpload:function(e,t,n){a.ctrl.uploadPane.uploadButton.elements.input.click()},ActionAttach:function(e,t,n){a.ctrl.modelEvents.publish({event:"user-clicks-attach",data:{cancelled:!1}})},ActionAttachURL:function(e,t,n){a.ctrl.modelEvents.publish({event:"user-clicks-attach-url",data:{cancelled:!1}})},ActionDetach:function(e,t,n){a.ctrl.modelEvents.publish({event:"user-clicks-detach",data:{cancelled:!1}})},ActionPaste:function(e,t,o){n.paste(a.pasteX3dContent)},SwitchView:function(e,t,n){"view-list"==t.fonticon?a.ctrl.controller.switchView("grid"):a.ctrl.controller.switchView("tile")},SwitchSort:function(e,t,n){t.dataIndex==a.currentSort.dataIndex?(a.currentSort.sort="asc"==a.currentSort.sort?"desc":"asc",t.order=a.currentSort.sort,"tree"==t.dataIndex?t.elements.icon.className="fonticon fonticon-sort-alpha-"+a.currentSort.sort:t.elements.icon.className="fonticon fonticon-sort-num-"+a.currentSort.sort):a.currentSort={dataIndex:t.dataIndex,sort:t.order},a.ctrl.controller.applySortModel(a.currentSort)}},setDetachEnabled:function(e){e?a.container.getElement(".fonticon-remove").getParent().removeClassName("disabled"):a.container.getElement(".fonticon-remove").getParent().addClassName("disabled")},setPasteEnabled:function(){n.contentCopied?a.container.getElement(".fonticon-paste").getParent().removeClassName("disabled"):a.container.getElement(".fonticon-paste").getParent().addClassName("disabled")},pasteX3dContent:function(e){if(e.data){var t=e.data;if(t.data&&t.data.items&&t.data.items.length>0){var n=t.data.items.map(function(e){return e.objectId});a.ctrl.controller.attachAttachments(n)}}else a.ctrl.controller.helper.showNotification("success","Nothing To Paste")},setReadOnly:function(e){e?(a.container.getElement(".fonticon-upload").getParent().addClassName("hidden"),a.container.getElement(".fonticon-plus").getParent().addClassName("hidden"),a.container.getElement(".fonticon-remove").getParent().addClassName("hidden")):(a.container.getElement(".fonticon-upload").getParent().removeClassName("hidden"),a.container.getElement(".fonticon-plus").getParent().removeClassName("hidden"),a.container.getElement(".fonticon-remove").getParent().removeClassName("hidden"))}};return a.build(o),a}}),define("DS/ENOXAttachmentsUX/utils/Search",["UWA/Core","UWA/Utils/InterCom","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n){"use strict";return function(o){var a={ctrl:o,socketName:void 0,options:void 0,init:function(e){a.socketName&&a.destroy(),a.socketName="ENOXAttachmentsUX_"+(new Date).getTime(),a.setSearchOptions(e)},getdefaultOptions:function(){return{title:n.get("ATTACH_EXISTING"),multiSel:!0,source:["3dspace"],tenant:void 0,role:"",precondition:void 0,defaultSearchCriteria:void 0}},destroy:function(){a.socket&&(a.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),a.socket.unsubscribeServer("SearchComServer"),a.socket.removeListener("Selected_Objects_search",a.objectsSelected),a.socket.disconnect(),delete a.socket),a.socketName=void 0},execute:function(){if(null==a.options.tenant)throw"Needs Actual Tenant ID";a.ctrl.options.parentObject&&a.ctrl.options.parentObject.parentId?a.originalSearchOptions.resourceid_not_in=[a.ctrl.options.parentObject.parentId]:a.originalSearchOptions.resourceid_not_in=[],a.originalSearchOptions.resourceid_not_in.push(a.ctrl.controller.helper.restrict(a.ctrl.controller.attachments.getRoots(),"options.data.id"));var e={cancelled:!1,options:a.originalSearchOptions};a.ctrl.modelEvents.publish({event:"user-clicks-add-existing",data:e}),e.cancelled||(a.setSearchOptions(e.options),a.ctrl.modelEvents.publish({event:"open-3dsearch-for-add-existing",data:a.options}),null==a.socket&&(a.socket=new t.Socket(a.socketName,{dispatchRetryInterval:5}),a.socket.subscribeServer("SearchComServer"),a.socket.addListener("Selected_Objects_search",a.objectsSelected)),a.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),a.socket.dispatchEvent("RegisterContext",a.options),a.socket.dispatchEvent("InContextSearch",a.options))},objectsSelected:function(e,t,n){var o=e.map(function(e){return e.id});a.ctrl.controller.attachAttachments(o)},setSearchOptions:function(t){e.merge(t,a.getdefaultOptions());var o=a.originalSearchOptions=t;if(a.options={},a.options.title=o.title||n.get("ATTACH_EXISTING"),a.options.mode="furtive",a.options.app_socket_id=a.socketName,a.options.widget_id=widget.id,a.options.default_with_precond=!0,a.options.multiSel=o.multiSel||!0,a.options.source=o.source||["3dspace"],a.options.tenant=o.tenant,a.options.role=o.role||"",a.options.precond=void 0,Array.isArray(o.includedTypes)&&!o.includedTypes.includes("*")){o.includedTypes.forEach(function(e,t){0!==t&&(a.options.precond+=" OR "),null==a.options.precond&&(a.options.precond=""),a.options.precond+='flattenedtaxonomies:"types/'+e+'"'});var i=["Controlled Document Template","Rendition Document Template","Version","ProxyItem"];i.forEach((e,t)=>{'(policy:"'+e+'")',t!=i.length-1&&" OR "})}if(null==a.options.precond&&(a.options.precond=""),a.options.precond&&""!==a.options.precond&&(a.options.precond="("+a.options.precond+")"),Array.isArray(o.excludedTypes)){var s="";o.excludedTypes.forEach(function(e,t){0!==t&&(s+=" OR "),s+='flattenedtaxonomies:"types/'+e+'"'}),""!=s&&(s=" NOT ("+s+")"),""!=a.options.precond&&""!=s?a.options.precond="("+a.options.precond+" AND "+s+")":""!=s&&(a.options.precond="("+s+")")}o.precondition&&a.options.precond?a.options.precond="("+a.options.precond+" AND "+o.precondition+")":o.precondition&&(a.options.precond=o.precondition),o.defaultSearchCriteria&&""!==o.defaultSearchCriteria.trim()&&(a.options.default_search_criteria=o.defaultSearchCriteria),o.resourceid_in&&Array.isArray(o.resourceid_in)&&(a.options.resourceid_in=o.resourceid_in),o.resourceid_not_in&&Array.isArray(o.resourceid_not_in)&&(a.options.resourceid_not_in=o.resourceid_not_in)}};return a}}),define("DS/ENOXAttachmentsUX/ajaxRequests/DocPropertiesModel",["DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n,o){"use strict";function a(){return t.getWebappsAssetUrl("ENOXAttachmentsUX","icons/LinkThumbnailBig.png")}return{commitModels:async function(t){var o=t.modelList;if(o.length){let s=o[0],r=s.changedValues.Title,l=s.changedValues.URL,c=s.get("objectId"),d=r?r.valueDB:null,p=l?l.valueDB:null;var a=s.get("type").split("?")[1];if(a)var i=a.split("=")[1];this.getLatestCSRF().then(o=>{t.headers={Accept:"application/json"},t.model=s,t.withSC=!0,t.withChange="silent",t.source="3DSpace";var a={csrf:o,data:[{id:c,updateAction:"MODIFY",dataelements:{title:s.get("Title").valueDB,proxyurl:s.get("URL").valueDB,parentId:i}}]};if(d&&(a.data[0].dataelements.title=d),p){p=/^[A-Za-z]+:/.test(p)?p:`https://${p}`,a.data[0].dataelements.proxyurl=p}t.onCompleteWS=(e=>{let o={results:[]};o.results.push({status:200,body:{physicalid:e.data[0].id,Title:{selectable:"Title",name:"Title",value:[e.data[0].dataelements.title]},URL:{selectable:"URL",name:"URL",value:[e.data[0].dataelements.proxyurl]},url:"model/bus/"+e.data[0].id,errors:[]}}),t.onComplete(o),s.get("objectId")!=e.data[0].id&&(e.data[0]._oldUrlId=s.get("objectId"),s.set({objectId:e.data[0].id})),n.publish("Enox-Attachment-Refresh",{data:{platformId:t.tenant,parentId:e.data[0].dataelements.parentId,modified:e.data}})}),e.createRequest(t,"POST","/resources/v1/modeler/documents/manageExternalURL",a)}).catch(e=>{console.log(e),t.onComplete({results:[],UXMessage:[""]})})}},getLatestCSRF:function(){var t={};return new Promise((n,o)=>{t.onCompleteWS=(e=>{n(e.csrf)}),e.createRequest(t,"GET","/resources/v1/application/E6WFoundation/CSRF",void 0)})},getListOfAttributes:function(t){var n=t.modelList;if(1===n.length&&!n[0].isMergedModel()){let s=n[0],r=s.get("objectId");t.headers={Accept:"application/json","Accept-Language":widget.lang};var i="/resources/v1/modeler/documents/"+r;t.model=s,t.withSC=!0,t.withChange="silent",t.source="3DSpace",t.onCompleteWS=(e=>{var n={options:{autoExpand:!1},results:[{computed:{label:{path:"Title",name:"Title",value:[e.data[0].dataelements.title]}},data:[{path:"Title",nls:o.get("Title"),maxlength:0,name:"Title",readOnly:!1,type:"string",value:[e.data[0].dataelements.title],mandatory:!0,UIPosition:2},{path:"URL",nls:o.get("URL"),maxlength:0,name:"URL",readOnly:!1,type:"string",value:[e.data[0].dataelements.proxyurl],mandatory:!0,UIPosition:3}],physicalID:e.data[0].id,metatype:"bus",type:s.get("type"),type_icon_large_url:a(),PLMParametersAvailable:!1,preview_url:"",success:!0,modifyAccess:!0,groupData:[]}]};s._currentLinkInfo=e,t.onComplete(n)}),e.createRequest(t,"GET",i,void 0)}},getPreviewUrl:function(e){var t=[];t.push({id:e.modelList[0]._attributes.objectId,preview:a()}),e.onComplete(t)}}}),define("DS/ENOXAttachmentsUX/utils/Overlay",["UWA/Core"],function(e){"use strict";return{overlay:function(t,n){var o;this.isOverlaid(t)&&this.unoverlay(t),t.addClassName("overlaid"),o=e.createElement("div",{class:"overlay"}),n=e.is(n,"string")?n:"",n=e.createElement("div",{class:"overlay-wrapper",html:{tag:"div",class:"overlay-content",html:[e.createElement("span",{class:"text",text:n})]}}).inject(o),o.inject(t)},unoverlay:function(e){var t=e.getElement(" > .overlay");t&&t.destroy(),e.removeClassName("masked")},isOverlaid:function(e){return e.hasClassName("overlaid")}}}),define("DS/ENOXAttachmentsUX/views/ProgressPane",["UWA/Core","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t){"use strict";return function(n){var o={build:function(n){this.ctrl=n,this.container=e.createElement("div",{class:n.getClassNames("-progresspane")}),this.container.inject(this.ctrl.elements.content);var a=e.createElement("div",{class:"progresspane-titlebar"});a.inject(this.container),e.createElement("div",{class:"progresspane-title",text:t.get("PROGRESS")}).inject(a);var i=e.createElement("button",{class:"close fonticon fonticon-chevron-down",type:"button"});i.inject(a),i.addEvent("click",function(){i.classList.contains("fonticon-chevron-down")?(i.classList.remove("fonticon-chevron-down"),i.classList.add("fonticon-chevron-up"),o.content.hide()):(i.classList.remove("fonticon-chevron-up"),i.classList.add("fonticon-chevron-down"),o.content.show())}),this.content=e.createElement("div",{class:"progresspane-content"}),this.content.inject(this.container),this.hide(),n.progressPane=o},show:function(){this.container.show()},hide:function(){this.container.hide()},addProgress:function(t){o.show();var n=e.createElement("div",{class:"progresspane-job"}),a=e.createElement("div",{class:"progresspane-jobtitle",text:t.title,title:t.title});a.inject(n);var i=e.createElement("progress",{class:"progress progresspane-jobprogress",value:0,max:100});i.inject(n),n.inject(o.content),t.progress=n,t.progress.update=function(e,t,n){a.setText(e),i.setAttributes({value:t,max:n,title:e})}}};return o.build(n),o}}),define("DS/ENOXAttachmentsUX/Actions/DeleteLink",["UWA/Core","DS/DocumentCommonInfra/components/DeleteDialog","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n){"use strict";var o=function(e){return{id:"deleteLink",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},label:n.get("Delete"),tooltip:n.get("Delete"),position:"far",category:"dialog",value:function(t){t.options=e,o.execute(t)},visibleFlag:!0},execute:function(){o.execute({options:e})},updateForSelection:function(e,t){return Promise.resolve(!0)}}};return o.execute=function(n){this.deleteDialog&&this.deleteDialog.components.myDialog&&(this.deleteDialog.immersiveFrame&&this.deleteDialog.immersiveFrame.destroy(),this.deleteDialog.components.myDialog.destroy(),this.deleteDialog.components.myDialog=void 0);var o={getSelectedNodes:n.options.getSelectedNodes,events:n.options.events,dialogCustomizations:{},platformUrls:e.clone(n.options.platformUrls,!0),onDelete:function(e){n.options.events.publish({event:"user-confirms-delete",data:{urlData:n.options.getSelectedNodes()}})}};this.deleteDialog=new t(o)},o}),define("DS/ENOXAttachmentsUX/data/Connector3DSpace",["UWA/Core","DS/ENOXAttachmentsUX/data/Constants","DS/DocumentManagement/DocumentManagement","DS/DocumentCommonInfra/TrackerAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n,o,a,i,s,r){"use strict";return function(){var l={options:{},init:function(e,t){if(l.controller=e,l.options=t||{},!(l.options&&l.options.fetchSecurityContext&&l.options.platformUrls&&l.options.platformUrls["3DSpace"]&&l.options.platformUrls.platformId)){n=new Date-e.ctrl.attachmentsPaneStartTime;throw o.sendTrackerPageEvent({category:"docm.attachmentsPane.ready",action:"click",label:"Attachments Ready",pd:{},pv:{totalTimeTaken:n,failure:0}}),new Error("Connector Options incomplete")}var n=new Date-e.ctrl.attachmentsPaneStartTime;o.sendTrackerPageEvent({category:"docm.attachmentsPane.ready",action:"click",label:"Attachments Ready",pd:{},pv:{totalTimeTaken:n,success:1}}),l.ready=!0,l.controller.connectorReady(l.options)},loadAttachments:function(a){if(!this.ready){var i=new Date-s;throw o.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:void 0,parentObjs:void 0,parentRelName:void 0},pv:{totalTimeTaken:i,aborted:-1}}),new Error("Connector not ready")}var s=new Date;if(a)if(a.noParent&&e.is(a.objectIds,"array"))n.getDocuments(a.objectIds,{tenant:l.options.platformUrls.platformId,securityContext:l.options.fetchSecurityContext(),tenantUrl:l.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){var t=l.controller.ctrl.options.parentObject;if(a.objectIds==t.objectIds){if(e.success){if(!Array.isArray(e.data))return;var n=new Date-s;o.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:void 0,parentObjs:a.objectIds,parentRelName:a.parentRelName},pv:{totalTimeTaken:n,success:1,numOfDocs:e.data.length}}),l.controller.addAttachmentsToUI(e.data)}l.controller.finishLoadingAttachments()}},onFailure:function(e){var t=new Date-s;o.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:void 0,parentObjs:a.objectIds,parentRelName:a.parentRelName},pv:{totalTimeTaken:t,failure:0,numOfDocs:0}}),l.controller.finishLoadingAttachments(),e.error&&l.controller.showNotification("error",r.get("FAILED_TO_LOAD_ATTACHMENTS"),e.error)}});else{var c={relInfo:{parentId:a.parentId,parentRelName:a.relationName||t.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:l.options.platformUrls.platformId,securityContext:l.options.fetchSecurityContext(),tenantUrl:l.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e,n){var i=l.controller.ctrl.options.parentObject;if(n.relInfo.parentId==i.parentId&&n.relInfo.parentRelName==(i.relationName||t.REFERENCE_DOCUMENT)){if(!Array.isArray(e.data))return;e.data.forEach(function(e){e.relName=c.relInfo.parentRelName});var r=new Date-s;o.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:a.parentId,parentObjs:a.objectIds,parentRelName:c.relInfo.parentRelName},pv:{totalTimeTaken:r,success:1,numOfDocs:e.data.length}}),l.controller.addAttachmentsToUI(e.data),l.controller.finishLoadingAttachments()}},onFailure:function(e,t){console.error(e);var n=new Date-s;o.sendTrackerPageEvent({category:"docm.attachments.ready",action:"auto",label:"Attachments Ready",pd:{parentId:a.parentId,parentObjs:a.objectIds,parentRelName:c.relInfo.parentRelName},pv:{totalTimeTaken:n,failure:1,numOfDocs:0}}),e.error&&l.controller.showNotification("error",r.get("FAILED_TO_LOAD_ATTACHMENTS"),e.error),l.controller.finishLoadingAttachments()}};n.getDocumentsFromParent(c)}},uploadAttachments:function(e,n,o){require(["DS/DocumentCreateNew/CreateNew","DS/Windows/ImmersiveFrame"],function(a,i){var s=new i;s.inject(widget.body),new a({tenantUrl:l.options.platformUrls["3DSpace"],securityContext:l.options.fetchSecurityContext(),tenant:l.options.platformUrls.platformId,immersiveFrame:s,parentObject:n,parentRelName:n.relationName||t.REFERENCE_DOCUMENT,connector:l,supportedTypes:o,credentialsPrefName:l.options.credentialsPrefName||t.PAD_CURRENT_SECURITY_CONTEXT,onUploadStart:function(){s.destroy()},onCancel:function(){s.destroy()},onError:function(e){l.controller.showNotification("error",r.get("UPLOAD_FAILED"),e.subtitle,e.message||""),s.destroy()}}).create(e)})},attachAttachments:function(o,a){if(o.length>0){for(var i=l.controller.attachments.getRoots(),s=0;s<i.length;s++){var d=i[s];if(o.includes(d.options.data.id)){l.controller.showNotification("error",r.get("TYPE_ATTACH_FAILED",{type:d.options.data.dataelements.typeNLS}),r.get("X_IS_ALREADY_ATTACHED",{title:d.options.data.dataelements.title||d.options.data.dataelements.secondaryTitle||d.options.data.dataelements.name}));var p=o.indexOf(d.options.data.id);p>-1&&o.splice(p,1)}}n.getDocuments(o,{tenant:l.options.platformUrls.platformId,securityContext:l.options.fetchSecurityContext(),tenantUrl:l.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(n){if(n.success)for(var o=0;o<n.data.length;o++){var i=n.data[o];n.data[o].relName=a.relationName||t.REFERENCE_DOCUMENT;var s=!0;if(a&&a.parentId&&i.id==a.parentId){l.controller.showNotification("error",r.get("TYPE_ATTACH_FAILED",{type:i.dataelements.typeNLS}),r.get("CANNOT_ATTACH_X_TO_ITSELF",{title:i.dataelements.title||i.dataelements.secondaryTitle||i.dataelements.name})),s=!1;break}if(s)if((l.controller.options.supportedTypes.includedTypes.includes("*")||l.controller.options.supportedTypes.includedTypes.includes(i.type)||l.controller.options.webinwin)&&!l.controller.options.supportedTypes.excludedTypes.includes(i.type))if(a.noParent){var d={onFailure:function(t){console.error(t),e.is(t,"string")&&l.controller.showNotification("error",r.get("FAILED_TO_ATTACH_ATTACHMENT"),t)},onSuccess:function(e){l.controller.addAttachmentsToUI([e]),l.controller.showNotification("success",r.get("DOCUMENT_ATTACHED",{type:e.dataelements.typeNLS}),r.get("X_ATTACHED_SUCCESSFULLY",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}))}};l.controller.events.publish({event:"attach-document-requested",data:{document:i,parentObject:a,callback:d}})}else c(i,a);else l.controller.showNotification("error",r.get("DOCUMENT_NOT_ALLOWED",{type:i.dataelements.typeNLS}),r.get("X_CANNOT_BE_ATTACHED",{type:i.type}))}},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var n=t.error.split("\n"),o=[],a=2;a<n.length;a++)o.push(n[a]);o=o.join("<br/>"),l.controller.showNotification("error",n[0],n[1],o,void 0,!0)}else l.controller.showNotification("error",r.get("DOCUMENT_ATTACH_FAILED"),t.error);else e.is(t,"string")?l.controller.showNotification("error",r.get("DOCUMENT_ATTACH_FAILED"),t):l.controller.showNotification("error",r.get("DOCUMENT_ATTACH_FAILED"))}})}},detachAttachments:function(e,t){if(t.noParent){var n={onSuccess:function(t){e.forEach(function(e){t.forEach(function(t){e.options.data.id==t&&(l.controller.attachments.removeRoot(e),l.controller.showNotification("success",r.get("DOCUMENT_DETACHED",{type:e.options.data.dataelements.typeNLS}),r.get("X_DETACHED_SUCCESSFULLY",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name})))})})}};l.controller.events.publish({event:"detach-attachments-requested",data:{ids:l.controller.helper.restrict(e,"options.data.id"),parentObject:t,callback:n}})}else for(var o=0;o<e.length;o++){d(e[o],t)}},getUpdatedAttachment:function(o,a){n.getDocuments([o.id],{tenant:l.options.platformUrls.platformId,securityContext:l.options.fetchSecurityContext(),tenantUrl:l.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;e.data.forEach(function(e){e.relName=o.relName||t.REFERENCE_DOCUMENT}),a(e.data)}},onFailure:function(t){t.error?l.controller.showNotification("error",r.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t.error):e.is(t,"string")?l.controller.showNotification("error",r.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t):l.controller.showNotification("error",r.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},getUpdatedAttachments:function(t,o,a){n.getDocuments(t.map(function(e){return e.id}),{tenant:l.options.platformUrls.platformId,securityContext:l.options.fetchSecurityContext(),tenantUrl:l.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;o(e.data)}},onFailure:function(t){e.is(a,"function")?a(t):t.error?l.controller.showNotification("error",r.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t.error):e.is(t,"string")?l.controller.showNotification("error",r.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),t):l.controller.showNotification("error",r.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},ready:!1,uploadAttachment:function(t,i,s){if(l.ready){var c={customDocumentObject:t.custom_attributes?{dataelements:t.custom_attributes}:void 0,tenant:l.options.platformUrls.platformId,securityContext:s,tenantUrl:l.options.platformUrls["3DSpace"],additionalURLParams:"disableOwnershipInheritance=1",additionalHeaders:e.is(l.options.getWorkUnderHeaders,"function")?l.options.getWorkUnderHeaders():function(){let t=a.get(),n=e.is(t)&&e.is(t.change.id)?t.change.id:null;return""!=n?{"DS-Change-Authoring-Context":"pid:"+n}:{}}(),onFailure:function(e){var n=new Date-d.attachmentUploadStart;if(o.sendTrackerPageEvent({category:"docm.attachment.upload.complete",action:"click",label:"Attachment Upload Done",pd:{parentId:t.relInfo?t.relInfo.parentId||"":void 0,parentRelName:t.relInfo?t.relInfo.parentRelName||"":void 0,securityContext:s,docType:t.type,fileType:t.fileInfo.file.name.substring(t.fileInfo.file.name.lastIndexOf(".")+1,t.fileInfo.file.name.length)||t.fileInfo.file.name,filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,failure:0}}),e.error)if((e.error.match(/\n/g)||[]).length>2){for(var a=e.error.split("\n"),c=[],p=2;p<a.length;p++)c.push(a[p]);c=c.join("<br/>"),l.controller.showNotification("error",a[0],a[1],c,void 0,!0)}else l.controller.showNotification("error",r.get("UPLOAD_FAILED"),e.error);else l.controller.showNotification("error",r.get("UPLOAD_FAILED"),e.error?e.error:r.get("X_UPLOAD_FAILED",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}));l.controller.events.publish({event:"upload-attachment-failure",data:{document:t,parentObject:i}}),l.controller.jobs.finishJob(d)},onProgress:function(e){l.controller.events.publish({event:"upload-attachment-progress",data:{document:t,parentObject:i}}),d.update(e)},onComplete:function(e){var n=new Date-d.attachmentUploadStart;o.sendTrackerPageEvent({category:"docm.attachment.upload.complete",action:"click",label:"Attachment Upload Done",pd:{parentId:t.relInfo?t.relInfo.parentId||"":void 0,parentRelName:t.relInfo?t.relInfo.parentRelName||"":void 0,securityContext:s,docType:t.type,fileType:t.fileInfo.file.name.substring(t.fileInfo.file.name.lastIndexOf(".")+1,t.fileInfo.file.name.length)||t.fileInfo.file.name,filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,success:1}}),e.data&&(e.data[0].dataelements.isDocumentType="TRUE");var a=e.data;a.forEach(function(e){e.delayLoadThumbnails=!0,t.relInfo&&(e.relName=t.relInfo.parentRelName)});var c=function(e){l.controller.addAttachmentsToUI(e),1==e.length?l.controller.showNotification("success",r.get("DOCUMENT_ATTACHED",{type:e[0].dataelements.typeNLS}),r.get("X_ATTACHED_SUCCESSFULLY",{title:e[0].dataelements.title||e[0].dataelements.secondaryTitle||e[0].dataelements.name})):e.length>1&&l.controller.showNotification("success",r.get("DOCUMENTS_ATTACHED"),r.get("X_DOCUMENTS_ATTACHED_SUCCESSFULLY",{num:e.length}))},p={event:"upload-attachment-complete",data:{documents:a,parentObject:i}};i.noParent&&(p.data.callback=c),l.controller.events.publish(p),l.controller.jobs.finishJob(d),i.noParent||c(a)}},d={title:r.get("UPLOADING_X",{title:t.title}),ui:!0,process:function(){d.attachmentUploadStart=new Date,n.createDocument(t,c)}};l.controller.jobs.addJob(d)}},attachUrlAsAttachment:function(e,n){if(l.ready){var o={csrf:{name:"ENO_CSRF_TOKEN",value:""},data:[{dataelements:{policy:"ProxyItem",title:e.title,proxyurl:e.url,parentId:n.parentId,parentRelName:n.relationName||t.REFERENCE_DOCUMENT,parentDirection:"from"},type:t.Document_Proxy}]},a={method:"POST",timeout:3e4,headers:{"Content-Type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent(l.options.fetchSecurityContext())},data:o,type:"json",tenant:l.options.platformUrls.platformId,onFailure:function(t){l.controller.showNotification("error",r.get("TYPE_ATTACH_FAILED",{type:"Link"}),r.get("X_ATTACH_FAILED",{title:e.title})),l.controller.events.publish({event:"attach-url-attachment-failure",data:{document:void 0,urlData:e,parentObject:n}}),l.controller.jobs.finishJob(s)},onProgress:function(t){l.controller.events.publish({event:"attach-url-attachment-progress",data:{document:void 0,urlData:e,parentObject:n}}),s.update(t)},onComplete:function(t){l.controller.showNotification("success",r.get("URL_ATTACHED"),r.get("X_ATTACHED_SUCCESSFULLY",{title:e.title})),l.controller.jobs.finishJob(s),l.controller.addAttachmentsToUI(t.data),l.controller.events.publish({event:"attach-url-attachment-complete",data:{document:void 0,urlData:e,parentObject:n}})}},s={title:e.title,ui:!0,process:function(){p().then(e=>{a.data.csrf=e,a.data=JSON.stringify(a.data),i.authenticatedRequest(l.options.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/?disableOwnershipInheritance=1",a)}).catch(e=>{l.controller.jobs.finishJob(s)})}};l.controller.jobs.addJob(s)}},deleteUrlAttachment:function(e,t){if(l.ready){var n={csrf:{name:"ENO_CSRF_TOKEN",value:""},data:[]},o=[];e.forEach(e=>{o.push(e.options.data.id),n.data.push({id:e.options.data.id,updateAction:"DELETE",dataelements:{parentId:t.parentId}})});var a={method:"POST",timeout:3e4,headers:{"Content-Type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent(l.options.fetchSecurityContext())},data:n,type:"json",tenant:l.options.platformUrls.platformId,onFailure:function(n){l.controller.showNotification("error",r.get("URL_Delete_Failed"),r.get("URL_Delete_Failed_MSG",{title:e.length>1?r.get("SELECTED_OBJECTS"):e[0].options.data.title})),l.controller.events.publish({event:"delete-url-attachment-failure",data:{document:void 0,urlData:e,parentObject:t}}),l.controller.jobs.finishJob(c)},onProgress:function(n){l.controller.events.publish({event:"delete-url-attachment-progress",data:{document:void 0,urlData:e,parentObject:t}})},onComplete:function(e){l.controller.jobs.finishJob(c),e.data.forEach(function(e){l.controller.attachments.getRoots().forEach(function(n){n.options.data.id==e.id&&(l.controller.events.publish({event:"delete-url-attachment-complete",data:{id:l.controller.helper.restrict(n,"options.data.id"),parentObject:t}}),s.publish("Enox-Attachment-Refresh",{data:{platformId:l.options.platformUrls.platformId,parentId:e.dataelements.parentId,deleted:e}}),l.controller.showNotification("success",r.get("Link_Deleted"),r.get("X_DETACHED_SUCCESSFULLY",{title:n.options.grid.title})),l.controller.attachments.removeRoot(n))})})}},c={title:e[0].title,ui:!1,process:function(){p().then(e=>{a.data.csrf=e,a.data=JSON.stringify(a.data),i.authenticatedRequest(l.options.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/manageExternalURL",a)}).catch(e=>{l.controller.jobs.finishJob(c)})}};l.controller.jobs.addJob(c)}}};function c(e,o){if(l.ready){var a={relInfo:{parentId:o.parentId,parentRelName:o.relationName||t.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:l.options.platformUrls.platformId,securityContext:l.options.fetchSecurityContext(),tenantUrl:l.options.platformUrls["3DSpace"],additionalURLParams:"disableOwnershipInheritance=1",onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var n=t.error.split("\n"),a=[],s=2;s<n.length;s++)a.push(n[s]);a=a.join("<br/>"),l.controller.showNotification("error",n[0],n[1],a,void 0,!0)}else l.controller.showNotification("error",r.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),t.error);else l.controller.showNotification("error",r.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),r.get("X_ATTACH_FAILED",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}));l.controller.events.publish({event:"attach-attachment-failure",data:{document:e,parentObject:o}}),l.controller.jobs.finishJob(i)},onProgress:function(t){l.controller.events.publish({event:"attach-attachment-progress",data:{document:e,parentObject:o}}),i.update(t)},onComplete:function(t){l.controller.events.publish({event:"attach-attachment-complete",data:{document:e,parentObject:o}}),e.relName=a.relInfo.parentRelName,l.controller.jobs.finishJob(i),l.controller.addAttachmentsToUI([e]),l.controller.showNotification("success",r.get("DOCUMENT_ATTACHED",{type:e.dataelements.typeNLS}),r.get("X_ATTACHED_SUCCESSFULLY",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}))}},i={title:r.get("ATTACHING_X",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}),ui:!1,process:function(){n.connectDocumentToParent(e.id,a)}};l.controller.jobs.addJob(i)}}function d(o,a){if(l.ready){var i={relInfo:{parentId:a.parentId,parentRelName:o.options.data.relName||t.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:l.options.platformUrls.platformId,securityContext:l.options.fetchSecurityContext(),tenantUrl:l.options.platformUrls["3DSpace"],onFailure:function(t){if(l.controller.events.publish({event:"detach-attachment-failure",data:{id:l.controller.helper.restrict(o,"options.data.id"),parentObject:a}}),l.controller.jobs.finishJob(s),t.error)if((t.error.match(/\n/g)||[]).length>2){for(var n=t.error.split("\n"),i=[],c=2;c<n.length;c++)i.push(n[c]);i=i.join("<br/>"),l.controller.showNotification("error",n[0],n[1],i,void 0,!0)}else l.controller.showNotification("error",r.get("FAILED_TO_DETACH_ATTACHMENT",{type:o.options.data.dataelements.typeNLS}),t.error);else e.is(t,"string")?l.controller.showNotification("error",r.get("FAILED_TO_DETACH_ATTACHMENT",{type:o.options.data.dataelements.typeNLS}),t):l.controller.showNotification("error",r.get("FAILED_TO_DETACH_ATTACHMENT",{type:o.options.data.dataelements.typeNLS}))},onProgress:function(e){l.controller.events.publish({event:"detach-attachment-progress",data:{id:l.controller.helper.restrict(o,"options.data.id"),parentObject:a}}),s.update(e)},onComplete:function(e){l.controller.jobs.finishJob(s),e.success&&l.controller.attachments.getRoots().forEach(function(t){e.data.forEach(function(e){t.options.data.id==e.id&&(l.controller.events.publish({event:"detach-attachment-complete",data:{id:l.controller.helper.restrict(t,"options.data.id"),parentObject:a}}),l.controller.attachments.removeRoot(t),l.controller.showNotification("success",r.get("DOCUMENT_DETACHED",{type:t.options.data.dataelements.typeNLS}),r.get("X_DETACHED_SUCCESSFULLY",{title:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})))})})}},s={title:r.get("DETACHING_X",{title:o.options.data.dataelements.title||o.options.data.dataelements.secondaryTitle||o.options.data.dataelements.name}),ui:!1,process:function(){n.disconnectDocumentFromParent(o.options.data.id,i)}};l.controller.jobs.addJob(s)}}function p(){return new e.Promise(function(e,t){i.authenticatedRequest(l.options.platformUrls["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",onComplete:function(t){e(JSON.parse(t).csrf)},onFailure:function(e){console.warn("Failed to get CSRF"),t(e)}})})}return l}}),define("DS/ENOXAttachmentsUX/data/Model",["DS/TreeModel/TreeNodeModel","DS/ENOXAttachmentsUX/utils/MaturityCache","DS/Tweakers/TypeRepresentationFactory"],function(e,t,n){"use strict";var o=new n;return function(t,n){function a(e){if("Document Proxy"==e.type&&e.dataelements&&"ProxyItem"==e.dataelements.policy){e.dataelements||(e.dataelements={});var t={title:e.dataelements.title||e.dataelements.name||"",proxyurl:e.dataelements.proxyurl,modified:e.dataelements.modified,originated:e.dataelements.originated};return e.dataelements.type=e.type,(a={data:e,grid:t}).label=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name||e.title,a.title=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name||e.title,a.icons=[{iconName:"link"}],a.link=e.dataelements.proxyurl||e.url,n.controller&&n.controller.options&&n.controller.options.connectorOptions&&n.controller.options.connectorOptions.platformUrls&&(a.thumbnail=n.controller.options.connectorOptions.platformUrls["3DSpace"]+"/webapps/ENOXAttachmentsUX/assets/icons/LinkThumbnail.png"),o.generateView(e.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){a.subLabel=e.getContent().getText()}}),a}var a;if(e.dataelements.originated=new Date(e.dataelements.originated),e.dataelements.modified=new Date(e.dataelements.modified),e.dataelements.type=e.type,(a={data:e,grid:e.dataelements}).label=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name,a.title=e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name,a.icons=[{iconName:"doc-text"}],a.grid.tree=a.title,a.thumbnail=e.dataelements.indexedImage||e.dataelements.image,a.taxonomies=[e.type],"TRUE"!=e.dataelements.isDocumentType||a.taxonomies.includes("Document")||a.taxonomies.push("Document"),a.thumbnail.endsWith("snresources/images/icons/small/I_CDM_Document.png")&&(a.thumbnail=a.thumbnail.replace("small/I_CDM_Document.png","large/I_TextDoc200x150.png")),a.icons=[e.dataelements.indexedTypeicon||e.dataelements.typeicon],o.generateView(e.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(t){a.subLabel=e.dataelements.typeNLS+" | "+e.dataelements.revision+" | "+t.getContent().getText()}}),a.description=n.helper.getNameAndState(e),e.relateddata&&e.relateddata.files&&e.relateddata.files.length>0){var i=[];e.relateddata.files.forEach(e=>{e.dataelements&&UWA.is(e.dataelements.title,"string")&&i.push(function(e){return e.substring(e.lastIndexOf(".")+1,e.length)||e}(e.dataelements.title))}),"TRUE"==e.dataelements.isDocumentType?e.dataelements.fileExtension=i.join(", "):e.dataelements.fileExtension=""}return a}var i=a(t);i.reloadFromNewData=function(e){s.updateOptions(a(e))};var s=new e(i);return s}}),define("DS/ENOXAttachmentsUX/Actions/CreateLinkDialog",["UWA/Core","DS/ENOXAttachmentsUX/utils/URLDialog","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n){"use strict";var o=function(e){return{id:"createLinkDialog",dataElements:{docV2Public:!0,typeRepresentation:"functionIcon",icon:{iconName:"link-add",fontIconFamily:1},label:n.get("CreateLink"),tooltip:n.get("CreateLink"),position:"far",category:"dialog",value:function(t){t.options=e,o.execute(t)},visibleFlag:!0},execute:function(){o.execute({options:e})},updateForSelection:function(e,t){return Promise.resolve(!0)}}};return o.execute=function(e){this.createLinkDialog&&this.createLinkDialog.myDialog&&(this.createLinkDialog.immersiveFrame&&this.createLinkDialog.immersiveFrame.destroy(),this.createLinkDialog.myDialog.destroy(),this.createLinkDialog.myDialog=void 0);var n={getSelectedNodes:e.options.getSelectedNodes,events:e.options.events,dialogCustomizations:e.options.dialogCustomizations?e.options.dialogCustomizations:{},onConfirm:e.options.onConfirm?e.options.onConfirm:function(t){t.url=/^[A-Za-z]+:/.test(t.url)?t.url:`https://${t.url}`,e.options.events.publish({event:"user-attaches-url-Attachement",data:{urlData:t}})}};this.createLinkDialog=new t(n)},o}),define("DS/ENOXAttachmentsUX/data/Collection",["DS/TreeModel/TreeDocument","DS/ENOXAttachmentsUX/data/Model","DS/DocumentCommonInfra/MaturityColors"],function(e,t,n){"use strict";return function(o){var a=new e({useAsyncPreExpand:!0,shouldAcceptDrag:function(e,t){return!0},shouldAcceptDrop:function(e,t){return!0}});n.setup(o.options.connectorOptions);var i=o.helper.debounce(5e3,function(e){var t=this.data.map(function(e){return e[0].options.data}),n=this.data.map(function(e){return e[0]});o.controller.connector.getUpdatedAttachments(t,function(e){e.forEach(function(e){var t=n.find(function(t){return t.options.data.id==e.id});t&&t.options.reloadFromNewData(e)})})},!0);return a.addAttachments=function(e){a.prepareUpdate();var s=[],r=[];e.forEach(function(e){if("Document Proxy"==e.type&&"ProxyItem"==e.dataelements.policy){var n=new t(e,o);a.addRoot(n)}else{s.includes(e.dataelements.policy)||(s.push(e.dataelements.policy),r.push(e));n=new t(e,o);a.addRoot(n),e.delayLoadThumbnails&&i(n)}}),a.pushUpdate(),n.fetchPolicies(r,function(e,t,n){})},require(["DS/PlatformAPI/PlatformAPI"],function(e){a.enoRefreshToken&&e.unsubscribe(a.enoRefreshToken),a.enoRefreshToken=e.subscribe("DS/ENO/refresh",function(e){if(e.data&&e.data.authored){if(UWA.is(e.data.authored.modified,"array")&&e.data.authored.modified.length>0){var t=[];a.getRoots().forEach(n=>{e.data.authored.modified.includes(n.options.data.id)&&t.push(n)}),t.length>0&&o.controller.connector.getUpdatedAttachments(t.map(e=>e.options.data),function(e){e.forEach(function(e){var n=t.find(function(t){return t.options.data.id==e.id});n&&n.options.reloadFromNewData(e)})})}UWA.is(e.data.authored.deleted,"array")&&e.data.authored.deleted.length>0&&a.getRoots().forEach(t=>{e.data.authored.deleted.includes(t.options.data.id)&&setTimeout(()=>{t.remove()},1)})}}),a.urlAttachmentRefreshToken&&e.unsubscribe(a.urlAttachmentRefreshToken),a.urlAttachmentRefreshToken=e.subscribe("Enox-Attachment-Refresh",function(e){e.data&&e.data.platformId&&e.data.platformId==o.options.connectorOptions.platformUrls.platformId&&e.data.parentId&&e.data.parentId==o.options.parentObject.parentId&&(UWA.is(e.data.modified,"array")&&e.data.modified.length>0&&a.getRoots().forEach(t=>{e.data.modified.forEach(e=>{e.id!=t.options.data.id&&e._oldUrlId!=t.options.data.id||t.options.reloadFromNewData(e)})}),UWA.is(e.data.deleted,"array")&&e.data.deleted.length>0&&e.data.deleted.forEach(e=>{a.getRoots().forEach(t=>{e.id==t.options.data.id&&a.removeRoot(t)})}))}),a.lifeCycleModificationToken&&e.unsubscribe(a.lifeCycleModificationToken),a.lifeCycleModificationToken=e.subscribe("Lifecycle.Modification",function(e){if("Lifecycle"==(e="string"==typeof e?JSON.parse(e):e).From&&e.Refresh&&e.Refresh.deleted&&Array.isArray(e.Refresh.deleted)){var t=e.Refresh.deleted.map(function(e){return e.physicalid});t.length>0&&a.getRoots().forEach(e=>{t.includes(e.options.data.id)&&setTimeout(()=>{e.remove()},1)})}})}),a}}),define("DS/ENOXAttachmentsUX/utils/Helper",["UWA/Core","DS/LifecycleCmd/MaturityCmd","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/ENOXAttachmentsUX/utils/MaturityCache","DS/ENOXAttachmentsUX/data/Constants","DS/WAFData/WAFData","DS/Controls/Label"],function(e,t,n,o,a,i,s,r){"use strict";return function(t){var a={getStateEmphasisClassname:function(e){return"class-name-of-no-use doco-state-badge doco-state-"+e.dataelements.policy.replace(/ /g,"_")+"-"+e.dataelements.state.replace(/ /g,"_")},getNameAndState:function(t,n){var o=e.createElement("span",{class:"NameAndState",styles:{position:"relative"}});return a.getDisplayName(t.relateddata.ownerInfo[0].dataelements.firstname+" "+t.relateddata.ownerInfo[0].dataelements.lastname,t.relateddata.ownerInfo[0]).inject(o),e.createElement("span",{class:"divider",text:"|"}).inject(o),new r({value:t.dataelements.stateNLS,emphasize:a.getStateEmphasisClassname(t)}).inject(o),o},updateStateSpan:function(e,t){},getDisplayName:function(t,n){var o;o=a.ctrl.options.connectorOptions.platformUrls["3DSwym"]?{avatarStr:"",avatarColor:""}:a.getNonSwymAvatarDetails(t);var i=e.createElement("span",{title:t}),s=e.createElement("span",{html:o.avatarStr,class:"avatarIcon"});return a.ctrl.options.connectorOptions.platformUrls["3DSwym"]?s.style.setProperty("background-image","url('"+a.ctrl.options.connectorOptions.platformUrls["3DSwym"]+"/api/user/getpicture/login/"+n.dataelements.name+"/format/mini')"):s.style.setProperty("background",o.avatarColor),s.inject(i),e.createElement("span",{class:"userName",text:t}).inject(i),i},getNonSwymAvatarDetails:function(e){var t,n,o={},a=[[7,139,250],[249,87,83],[111,188,75],[158,132,106],[170,75,178],[26,153,123],[245,100,163],[255,138,46]],i=e.split(" "),s=i[0].toUpperCase(),r=i[i.length-1].toUpperCase(),l=(t=s[0])+(n=r[0]),c=Math.ceil((t.charCodeAt(0)+n.charCodeAt(0))%a.length),d="rgb("+a[c][0]+","+a[c][1]+","+a[c][2]+")";return o.name=e,o.avatarStr=l,o.avatarColor=d,o},showNotification:function(e,t,a,i,s,r){var l={level:e,title:t,subtitle:a,message:i,sticky:s,allowUnsafeHTML:r||!1};window.notifs||(window.notifs=o,n.setNotificationManager(window.notifs),n.setStackingPolicy(5)),window.notifs.addNotif(l)},make3DXContent:function(e,t){var n={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",widgetId:widget.id,data:{items:[]}};return e.forEach(function(e){var o={envId:a.ctrl.options.connectorOptions.platformUrls.platformId,serviceId:"3DSpace",contextId:a.ctrl.options.connectorOptions.fetchSecurityContext(),objectId:e.options.data.id,objectType:e.options.data.type};t&&t.includeObjectTaxonomies&&(o.objectTaxonomies=e.options.taxonomies),n.data.items.push(o)}),n},restrict:function(t,n){if(e.is(t,"array")){if("id"==n)return t.map(function(e){return e.id});if("options.data.id"==n)return t.map(function(e){return e.options.data.id})}else{if("id"==n)return t.id;if("options.data.id"==n)return t.options.data.id}},debounce:function(e,t,n){var o=null,a=[];return function(){if(n){for(var i=[],s=0;s<arguments.length;++s)i.push(arguments[s]);a.push(i)}o&&clearTimeout(o);var r=arguments;o=setTimeout(function(){t.apply(n?{data:a}:null,r),a=[],o=null},e)}},saveViewMode:function(n){var o=localStorage.getItem("ENOXAttachmentsUXViewMode"),a="";widget.environment&&widget.environment.data&&widget.environment.data._data&&(a=widget.environment.data._data._x_appId),(o=e.Json.isJson(o)?JSON.parse(o):{})[t.options.attachmentsType+"_"+(e.is(widget.data.appId)?widget.data.appId:a)]=n,localStorage.setItem("ENOXAttachmentsUXViewMode",JSON.stringify(o))},loadViewMode:function(){var n=localStorage.getItem("ENOXAttachmentsUXViewMode"),o="";if(widget.environment&&widget.environment.data&&widget.environment.data._data&&(o=widget.environment.data._data._x_appId),e.Json.isJson(n)){var a=(n=JSON.parse(n))[t.options.attachmentsType+"_"+(e.is(widget.data.appId)?widget.data.appId:o)];return"tile"==a||"grid"==a?a:"tile"}return"tile"}};return a.ctrl=t,t.helper=a,a}}),define("DS/ENOXAttachmentsUX/data/Controller",["UWA/Core","DS/ENOXAttachmentsUX/data/Collection","DS/UIKIT/DropdownMenu","DS/ENOXAttachmentsUX/utils/Search","DS/ENOXAttachmentsUX/utils/Helper","DS/ENOXAttachmentsUX/utils/Menus","DS/DocumentCommands/ENOXDocumentCommands","DS/DocumentCommands/DocumentCommandsV2","DS/DocumentCommands/Constants","DS/i3DXCompassPlatformServices/OpenWith","DS/Utilities/Utils","DS/DocumentCommands/TypeDerivativesCache","DS/UIKIT/Modal","DS/ENOXAttachmentsUX/Actions/CreateLinkDialog","DS/ENOXAttachmentsUX/Actions/DeleteLink","DS/ENOXAttachmentsUX/Actions/OpenLink","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","text!DS/ENOXAttachmentsUX/assets/searchFilter.json"],function(e,t,n,o,a,i,s,r,l,c,d,p,u,m,h,f,g,v){"use strict";const y=["Document","Quality System Document","Technical Document"];var D={};return e.Class.extend({ready:!1,ctrl:void 0,attachments:void 0,init:function(e){this.ready=!1,this.ctrl=e,this.ctrl.controller=this,this.helper=new a(e),this.attachments=new t(e)},initialize:function(t,n){var a=this;p.setup(t.options.connectorOptions.platformUrls),this.attachments.getModelEvents().subscribe({event:"addChild"},function(e){a.switchView(a.view)}),this.attachments.getModelEvents().subscribe({event:"removeChild"},function(e){a.switchView(a.view)}),this._hackRepaint=d.debounce(function(){},500),this.options=t.options,this.initContextMenu(),widget&&widget.app&&widget.app.jobs&&"doco-jobs"==widget.app.jobs.name&&widget.app.progressPane&&"doco-progress"==widget.app.progressPane.name?((D=widget.app).jobs.MAX_PARALLEL_JOBS=1,this.jobs=D.jobs):(null==D.jobs?require(["DS/DocumentCommands/Jobs"],function(e){null==D.jobs?(D.jobs=new e(D),D.jobs.MAX_PARALLEL_JOBS=1,a.jobs=D.jobs):a.jobs=D.jobs}):a.jobs=D.jobs,null==D.progressPane&&require(["DS/DocumentCommands/ProgressPane"],function(e){null==D.progressPane&&(D.progressPane=new e(D),D.progressPane.inject(widget.body))})),this.events=this.ctrl.modelEvents,this.hookEvents(),this.ctrl.topBar.selectedItemsMenuButton.style.display="none",this.connector=n,this.view=this.helper.loadViewMode(),this.connector.init(this,t.options.connectorOptions),this.options.supportedTypes=this.options.supportedTypes||{};var s={includedTypes:[],excludedTypes:[]};try{this.typesFilter=JSON.parse(v),this.typesFilter[t.options.attachmentsType].includedTypes&&this.typesFilter[t.options.attachmentsType].includedTypes.length>0&&(s.includedTypes=this.typesFilter[t.options.attachmentsType].includedTypes),this.typesFilter[t.options.attachmentsType].excludedTypes&&(s.excludedTypes=this.typesFilter[t.options.attachmentsType].excludedTypes)}catch(e){console.warn("No filter types found")}s.includedTypes&&s.includedTypes.length>0||s.excludedTypes&&s.excludedTypes.length>0?(this.options.supportedTypes=s,0==this.options.supportedTypes.includedTypes.length&&(this.options.supportedTypes.includedTypes=["*"])):e.merge(this.options.supportedTypes,{includedTypes:y,excludedTypes:[]}),this.PLMDMTDocumentTypes=["PLMDMTDocument"],this.options.searchOptions=this.options.searchOptions||{},e.merge(this.options.searchOptions,{tenant:t.options.connectorOptions.platformUrls.platformId}),e.merge(this.options.searchOptions,this.options.supportedTypes),this.search=new o(this.ctrl),this.search.init(this.options.searchOptions),this.menus=new i(this.ctrl);var c=[];this.options.supportedTypes.includedTypes.length>0&&!this.options.supportedTypes.includedTypes.includes("*")&&c.push(...this.options.supportedTypes.includedTypes),this.options.supportedTypes.excludedTypes.length>0&&c.push(...this.options.supportedTypes.excludedTypes),c.push(...this.PLMDMTDocumentTypes),c.push(...y),p.getTypeDerivatives(c,function(e){var t=[],n=[];a.options.supportedTypes.includedTypes.length>0&&!a.options.supportedTypes.includedTypes.includes("*")&&(a.options.supportedTypes.includedTypes.forEach(n=>{e[n]&&e[n].length>0&&t.push(...e[n])}),a.options.supportedTypes.includedTypes=t),a.options.supportedTypes.excludedTypes.length>0&&(a.options.supportedTypes.excludedTypes.forEach(t=>{e[t]&&e[t].length>0&&n.push(...e[t])}),a.options.supportedTypes.excludedTypes=n),e.PLMDMTDocument&&e.PLMDMTDocument.length>0&&a.PLMDMTDocumentTypes.push(...e.PLMDMTDocument)},t.options.connectorOptions.platformUrls["3DSpace"]);var u={fetchSecurityContext:t.options.connectorOptions.fetchSecurityContext,getWorkUnderHeaders:t.options.connectorOptions.getWorkUnderHeaders,getSelectedNodes:function(){return a.attachments.getSelectedNodes()},getDocumentFromNodeModel:function(e){return e.options.data},platformUrls:t.options.connectorOptions.platformUrls,events:a.events,isFromContextMenu:!0,uaSource:"attachments & specifications"};a.documentCommands=new r(u);var g=a.documentCommands.commands;a.activatedCmds=[g[l.PREVIEW],g[l.SHARE],g[l.DOWNLOAD],g[l.OFFICE_WEB_EDITION],g[l.EDIT],g[l.LOCK_AND_DOWNLOAD],g[l.UNDO_EDIT],g[l.UNLOCK],g[l.UPDATE_AND_UNLOCK],g[l.UPDATE]],a.createLinkDialogCommand=new m(u),a.openLinksCommand=new f(u),a.deleteLinksCommand=new h(u),a.urlCommands=[a.openLinksCommand,a.deleteLinksCommand]},loadAttachments:function(){window.loadAttachmentsStartTime=new Date,this.connector.loadAttachments(this.ctrl.options.parentObject)},uploadAttachments:function(e){e.length>this.ctrl.config.limits.maxFilesUploadsAtATime?this.showNotification("error",g.get("UPLOAD_FAILED"),g.get("CANNOT_UPLOAD_MORE_THAN_X",{count:this.ctrl.config.limits.maxFilesUploadsAtATime})):this.connector.uploadAttachments(e,this.ctrl.options.parentObject,this.options.supportedTypes)},attachAttachments:function(e){e.length>0&&this.connector.attachAttachments(e,this.ctrl.options.parentObject)},detachAttachments:function(e){var t=!1,n=this;if(e.forEach(e=>{n.PLMDMTDocumentTypes.includes(e.options.data.type)&&(t=!0)}),t){var o='<div style="display: flex;"><span class="fonticon fonticon-attention text-warning fonticon-2x"></span><p style="margin-left: 10px; white-space: pre-line">'+g.get("RemoveConfirmationMsg")+"</p></div>",a=new u({className:"site-reset",header:g.get("DETACH"),body:o,footer:'<button type="button" class="btn btn-primary">'+g.get("DETACH")+'</button> <button type="button" class="btn btn-default">'+g.get("Cancel")+"</button>",animate:!0,resizable:!0,autocenter:!0,visible:!0,limitParent:!0,overlay:!0,closable:!1});a.show(),a.elements.container.setStyle("z-index","50000"),a.inject(widget.body),a.getContent().getElements(".btn.btn-primary").forEach(function(t){t.addEvent("click",function(){var t={cancelled:!1,ids:n.helper.restrict(e,"options.data.id")};n.events.publish({event:"user-clicks-remove",data:t}),t.cancelled||(n.connector.detachAttachments(e,n.ctrl.options.parentObject),a.hide(),a.destroy())})}),a.getContent().getElements(".btn.btn-default").forEach(function(e){e.addEvent("click",function(){a.hide(),a.destroy()})})}else{var i={cancelled:!1,ids:this.helper.restrict(e,"options.data.id")};if(this.events.publish({event:"user-clicks-remove",data:i}),i.cancelled)return;this.connector.detachAttachments(e,this.ctrl.options.parentObject)}},selectionChanged:function(e){var t=this.attachments.getSelectedNodes(),n=t.length,o=t.filter(e=>"Document Proxy"==e.options.data.dataelements.type&&"ProxyItem"==e.options.data.dataelements.policy);n>0&&0==o.length?(this.ctrl.topBar.setDetachEnabled(!0),this.ctrl.topBar.selectedItemsMenuButton.style.display=""):(this.ctrl.topBar.setDetachEnabled(!1),this.ctrl.topBar.selectedItemsMenuButton.style.display="none"),n>0&&o.length==n&&(this.ctrl.topBar.selectedItemsMenuButton.style.display=""),this._hackRepaint()},switchView:function(e){this.attachments.getRoots().length>0?"grid"==e?(this.ctrl.tilePane.hide(),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.show(),this.view=e,this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-list",this.ctrl.topBar.actionbar.menu.items.find(e=>"viewmenu"==e.name).tooltip.setBody(g.get("GRIDVIEW")),this.helper.saveViewMode(e)):"tile"!=e&&null!=e||(this.ctrl.uploadPane.hide(),this.ctrl.gridPane.hide(),this.ctrl.tilePane.show(),this.view="tile",this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-big-tile",this.ctrl.topBar.actionbar.menu.items.find(e=>"viewmenu"==e.name).tooltip.setBody(g.get("TILEVIEW")),this.helper.saveViewMode(this.view)):("grid"!=e&&"tile"!=e||(this.view=e,"grid"==e?(this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-list",this.ctrl.topBar.actionbar.menu.items.find(e=>"viewmenu"==e.name).tooltip.setBody(g.get("GRIDVIEW"))):(this.ctrl.topBar.container.getElement("[name=viewmenu] span").className="fonticon fonticon-view-big-tile",this.ctrl.topBar.actionbar.menu.items.find(e=>"viewmenu"==e.name).tooltip.setBody(g.get("TILEVIEW"))),this.helper.saveViewMode(this.view)),this.ctrl.gridPane.hide(),this.ctrl.tilePane.hide(),this.ctrl.uploadPane.show())},actionMenuHandler:function(e){this.prepareContextMenu(e.nodeModels,e.target)},applySortModel:function(e){this.ctrl.gridPane.datagridview.sortModel=[e],this.ctrl.gridPane.datagridview.reapplySortModel()},prepareContextMenu:function(e,t,n){this.contextMenu.hide(),this.manipulateMenuItemsThenShowContextMenu(e,t,n)},prepareRightClickMenuNoObjectSelection:function(e,t){this.contextMenu.hide(),this.manipulateRightClickMenuItemsNoObjectSelection(e),this.showContextMenu(void 0,e,t)},manipulateRightClickMenuItemsNoObjectSelection:function(t){var n=this;this.contextMenu.removeItem(this.contextMenu.items.map(function(e){return e.id}));var o={};o.document={id:n.ctrl.options.parentObject.parentId,contextId:n.connector.options.fetchSecurityContext(),serviceId:"3DSpace",envId:n.connector.options.platformUrls.platformId},o.platformUrls=n.connector.options.platformUrls,o.onComplete=function(e){if("Paste"===e.action)if(e.data){var t=e.data;if(t.data&&t.data.items&&t.data.items.length>0){var o=t.data.items.map(function(e){return e.objectId});n.attachAttachments(o)}}else n.helper.showNotification("success",g.get("Nothing_To_Paste"))};var a=new s;a.init(o);var i=a.render(),r={},c=0;i[l.PASTE]&&(r={index:++c},n.contextMenu.addItem(e.merge(r,i[l.PASTE])))},manipulateMenuItemsThenShowContextMenu:function(t,n,o){var a=this;this.contextMenu.removeItem(this.contextMenu.items.map(function(e){return e.id}));var i,r,c,d,p=-1,u=!1,m=0;t.forEach(e=>{a.PLMDMTDocumentTypes.includes(e.options.data.type)?u=!0:m++}),this.ctrl.config.contextMenu.forEach(function(e){"OpenWith"==e.name?p=a.options.webinwin&&e.hiddenInWebInWin||u&&!m?-1:0:(e.handler=function(o,i,s){a.menus.handler({nodeModels:t,menuItem:e,target:n})},"Maturity"==e.name?r=e:"Relations"==e.name?i=e:"Share"==e.name?e:"Copy"==e.name?c=e:"Properties"==e.name&&(d=e))});var h={},f=e.clone(t[0].options.data);f=e.merge(f,{parentId:a.ctrl.options.parentObject.parentId,parentDirection:"from",relName:t[0].options.data.relName}),h.getWorkUnderHeaders=a.connector.options.getWorkUnderHeaders,h.document={id:t[0].options.data.id,contextId:a.connector.options.fetchSecurityContext(),serviceId:"3DSpace",envId:a.connector.options.platformUrls.platformId,data:f,type:t[0].options.data.type},h.onComplete=function(e){if("ReplacebyRevision"===e.action||"ReplacebyLatestRevision"===e.action)if(t[0].options.data.id==e.targetDocumentId)console.log("same revision selected. Do nothing. only show notification");else{var n=a.ctrl.controller.attachments.getRoots().find(function(e){return e.options.data.id==t[0].options.data.id});n.remove(),a.ctrl.controller.connector.getUpdatedAttachment({id:e.targetDocumentId},function(t){a.ctrl.controller.attachments.addAttachments(t,n._rowID),a.ctrl.setSelection([e.targetDocumentId])})}else"Update"!==e.action&&"Edit"!==e.action&&"UndoEdit"!==e.action||a.connector.getUpdatedAttachment(t[0].options.data,function(e){1==e.length&&(t[0].options.data.relateddata.files=e[0].relateddata.files)});var o=e.result.message;a.helper.showNotification("info",t[0].options.data.dataelements.title||t[0].options.data.dataelements.secondaryTitle||t[0].options.data.dataelements.name,o,"",!1)},h.onFailure=function(e){console.log(e.action+" failed for "+e.targetDocumentId),a.helper.showNotification("error",e.message?e.message:e.error.message,"","",!1)},h.platformUrls=a.connector.options.platformUrls;var g,v=t.every(e=>"TRUE"==e.options.data.dataelements.isDocumentType),y=t.filter(e=>"Document Proxy"==e.options.data.dataelements.type&&"ProxyItem"==e.options.data.dataelements.policy),D=[],E=new s;g=v?a.documentCommands.getUIKitItemsForCurrentSelection(a.activatedCmds,!1):new e.Promise(function(e){e([])});var C=E.init(h);e.Promise.all([C,g]).then(function(s){D=s[1];var m=E.render(),h={},f=0;if(-1!=p){f++;var v=a.helper.make3DXContent(t,{includeObjectTaxonomies:!0});a.openWith.set3DXContent(v).render(a.contextMenu)}if(t[0].options.data.type){if(!u){y.length||0==t[0].options.data.relateddata.files.length||""!=t[0].options.data.relateddata.files[0].dataelements.locker,!y.length&&t[0].options.data.relateddata.files.length>1&&!0,0!=a.contextMenu.items.length?(h={index:++f},a.contextMenu.addItem(e.merge(h,{className:"divider"}))):f=0,a.options.webinwin||D.forEach(t=>{t.name==l.PREVIEW&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t)))}),h={index:++f},a.contextMenu.addItem(e.merge(h,{className:"divider"})),window.dscef||D.forEach(t=>{t.name==l.OFFICE_WEB_EDITION&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t)))}),D.forEach(t=>{t.name==l.UPDATE&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.UPDATE_AND_UNLOCK&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.LOCK_AND_DOWNLOAD&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.EDIT&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.UNDO_EDIT&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t))),t.name==l.UNLOCK&&(h={index:++f},a.contextMenu.addItem(e.merge(h,t)))}),h={index:++f},a.contextMenu.addItem(e.merge(h,c)),m[l.REPLACE_BY_REVISION]&&(h={index:++f},a.contextMenu.addItem(e.merge(h,m[l.REPLACE_BY_REVISION]))),h={index:++f},a.contextMenu.addItem(e.merge(h,{className:"divider"})),h={index:++f},a.contextMenu.addItem(e.merge(h,r)),h={index:++f},a.contextMenu.addItem(e.merge(h,{className:"divider"})),D.forEach(t=>{t.name==l.SHARE&&(h={index:++f},t.acceptsMultiSelection=!0,a.contextMenu.addItem(e.merge(h,t)))}),m[l.COPY_LINK]&&(h={index:++f},a.contextMenu.addItem(e.merge(h,m[l.COPY_LINK]))),h={index:++f},a.contextMenu.addItem(e.merge(h,{className:"divider"}))}h={index:++f},a.contextMenu.addItem(e.merge(h,i)),u||D.forEach(t=>{t.name==l.DOWNLOAD&&(h={index:++f},t.acceptsMultiSelection=!0,a.contextMenu.addItem(e.merge(h,t)))}),h={index:++f},a.contextMenu.addItem(e.merge(h,d))}a.contextMenu.removeItem(a.contextMenu.items.filter(function(n){return!(!a.options.webinwin||!n.hiddenInWebInWin)||(!(!a.options.readonly||!n.hiddenInReadOnly)||(t.length>1?!n.acceptsMultiSelection:!!e.is(n.supportedTypes,"array")&&!n.supportedTypes.includes(t[0].options.data.type)))}).map(function(e){return e.id})),a.contextMenu.removeItem(a.contextMenu.items.filter(function(e,t,n){return 0!==t&&(e.className&&"divider"===e.className&&"divider"===n[t-1].className)}).map(function(e){return e.id})),a.contextMenu.items.length>0&&a.contextMenu.items[0].className&&"divider"===a.contextMenu.items[0].className&&a.contextMenu.removeItem(a.contextMenu.items[0].id),a.events.publish({event:"context-menu-requested",data:{contextMenu:a.contextMenu,data:t.map(function(e){return e.options.data}),PLMDMTDocumentTypes:a.PLMDMTDocumentTypes}}),y.length>0?(a.contextMenu.removeItem(a.contextMenu.items.map(function(e){return e.id})),g=a.documentCommands.getUIKitItemsForCurrentSelection(a.urlCommands,!1),y.length==t.length&&t.length>0&&g.then(i=>{f=0,i.forEach((t,n)=>{h={index:++f},a.contextMenu.addItem(e.merge(h,t)),0==n&&(h={index:++f},a.contextMenu.addItem(e.merge(h,d)))}),y.length>1&&a.contextMenu.removeItem(a.contextMenu.items.filter(e=>"deleteLink"!=e.name).map(e=>e.id)),a.showContextMenu(t,n,o)})):a.showContextMenu(t,n,o)})},showContextMenu:function(e,t,n){null==n?delete this.contextMenu.options.altPosition:this.contextMenu.options.altPosition=n,this.contextMenu.nodeModels=e,this.contextMenu.options.target=t;var o=void 0;n?(o={pageX:n.x,pageY:n.y},this.contextMenu.options.contextual=!0,delete this.contextMenu.options.altPosition,this.contextMenu.show(!1,o)):(this.contextMenu.options.contextual=!1,this.contextMenu.show())},attachExistingAttachments:function(){this.search.execute()},clearAll:function(){this.attachments.removeRoots()},addAttachmentsToUI:function(e){this.attachments.addAttachments(e),this.events.publish({event:"on-add-attachments-to-ui",data:{ids:this.helper.restrict(e,"id")}}),this.ctrl.gridPane.datagridview.reapplySortModel()},finishLoadingAttachments:function(){this.ctrl.finishLoading(),this._hackRepaint()},showNotification:function(e,t,n,o,a,i){this.helper.showNotification(e,t,n,o,a,i)},connectorReady:function(e){this.connector.options=e,this.events.publish({event:"on-connector-ready",data:e}),this.loadAttachments()},destroy:function(){this.ctrl.tilePane.destroy(),this.search.destroy()},_hackRepaint:null,initContextMenu:function(){var e=this,t=[],o=-1,a=-1;this.ctrl.config.contextMenu.forEach(function(n){o++,"OpenWith"==n.name?a=e.options.webinwin&&n.hiddenInWebInWin?-1:o:(n.handler=function(t,o,a){e.menus.handler({nodeModels:e.contextMenu.nodeModels,menuItem:n,target:e.contextMenu.options.target})},t.push(n))}),this.contextMenu=new n({items:t,events:{onClickOutside:function(e,t){}}});var i={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",data:{items:[{envId:void 0,serviceId:void 0,contextId:void 0,objectId:void 0,objectType:void 0}]}};-1!=a&&(this.openWith=this.openWith||new c,this.openWith.set3DXContent(i).setIndex(a+1).render(this.contextMenu))},hookEvents:function(){var e=this;if(this.events.subscribe({event:"user-clicks-attach"},function(t){0==t.cancelled&&e.attachExistingAttachments()}),this.events.subscribe({event:"user-clicks-attach-url"},function(t){e.createLinkDialogCommand.execute()}),this.events.subscribe({event:"user-attaches-url-Attachement"},function(t){e.connector.attachUrlAsAttachment(t.urlData,e.ctrl.options.parentObject)}),
//! TO BE REMOVED
this.events.subscribe({event:"user-modifies-url"},function(t){e.connector.updateUrlAttachment(t.urlData,t.updatedNodeId)}),this.events.subscribe({event:"user-confirms-delete"},function(t){e.connector.deleteUrlAttachment(t.urlData,e.ctrl.options.parentObject)}),this.events.subscribe({event:"user-clicks-detach"},function(t){var n=e.attachments.getSelectedNodes().filter(e=>"Document Proxy"==e.options.data.dataelements.type&&"ProxyItem"==e.options.data.dataelements.policy);0==t.cancelled&&0==n.length&&e.detachAttachments(e.attachments.getSelectedNodes())}),this.events.subscribe({event:"user-selects-files-for-upload"},function(t){0==t.cancelled&&e.uploadAttachments(t.files)}),this.events.subscribe({event:"user-dropped-files"},function(t){0==t.cancelled&&e.uploadAttachments(t.files)}),this.events.subscribe({event:"user-dropped-x3dcontent"},function(t){if(0==t.cancelled&&t.x3dcontent.data&&t.x3dcontent.data.items&&t.x3dcontent.data.items.length>0){var n=t.x3dcontent.data.items.map(function(e){return e.objectId});e.attachAttachments(n)}}),this.events.subscribe({event:"selection-add"},function(t){e.selectionChanged(t)}),this.events.subscribe({event:"selection-remove"},function(t){e.selectionChanged(t)}),this.attachments.getModelEvents().subscribe({event:"addChild"},function(t){e.events.publish({event:"attachments-count-changed",data:e.attachments.getRoots().length})}),this.attachments.getModelEvents().subscribe({event:"removeChild"},function(t){e.events.publish({event:"attachments-count-changed",data:e.attachments.getRoots().length})}),this.events.subscribe({event:"docv2-edit-complete"},function(t){e.connector.getUpdatedAttachment(t.nodeModel.options.data,function(n){1==n.length&&(t.nodeModel.options.data.relateddata.files=n[0].relateddata.files,e.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:t.nodeModel}}))})}),this.events.subscribe({event:"docv2-update-complete"},function(t){e.connector.getUpdatedAttachment(t.nodeModel.options.data,function(n){1==n.length&&(t.nodeModel.options.data.relateddata.files=n[0].relateddata.files,e.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:t.nodeModel}}),e.events.publish({event:"docv2-preview-reload-viewer",data:{nodeModel:t.nodeModel}}))})}),this.events.subscribe({event:"docv2-undoedit-complete"},function(t){e.connector.getUpdatedAttachment(t.nodeModel.options.data,function(n){1==n.length&&(t.nodeModel.options.data.relateddata.files=n[0].relateddata.files,e.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:t.nodeModel}}))})}),!this.events.addSingletonEventListener){var t={};e.events.addSingletonEventListener=function(n,o,a){t[n]&&e.events.unsubscribe(t[n]),t[n]=e.events.addEventListener(o,a)}}this.events.addSingletonEventListener("doc-cmd-evts-show-notification","docv2-show-notification",function(t){e.helper.showNotification(t.level,t.title,t.subtitle,t.message,t.sticky,t.allowUnsafeHTML)})}})}),define("DS/ENOXAttachmentsUX/data/DnDManager",["UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/ENOXAttachmentsUX/data/Controller","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(e,t,n,o){"use strict";return function(e){var n={init:function(e){this.ctrl=e;var o=e.uploadPane.container,a=e.gridPane.container,i=e.getClassNames("-drag-over"),s={drop:function(t,s,r){e.options.readonly||(o.removeClassName(i),a.removeClassName(i),n.handleDrop(r))},enter:function(t,n){e.options.readonly||(o.addClassName(i),a.addClassName(i))},over:function(t,n){e.options.readonly||(o.addClassName(i),a.addClassName(i))},leave:function(t,n){e.options.readonly||(o.removeClassName(i),a.removeClassName(i))}};t.droppable(o,s),t.droppable(a,s),e.dndManager=this,this.restrictedTypes=["Document Proxy"]},handleDrop:function(t){var a=this;if(!e.options.readonly)if(t.dataTransfer.files&&t.dataTransfer.files.length>0)n.ctrl.modelEvents.publish({event:"user-dropped-files",data:{cancelled:!1,files:t.dataTransfer.files}});else if(""!=t.dataTransfer.getData("text")){var i=t.dataTransfer.getData("text"),s=JSON.parse(i);if(null!=s&&"3DXContent"==s.protocol){var r=s.data.items.filter(e=>a.restrictedTypes.includes(e.objectType));s.data.items=s.data.items.filter(e=>!a.restrictedTypes.includes(e.objectType)),r.forEach(e=>{a.ctrl.helper.showNotification("error",o.get("TYPE_ATTACH_NOT_ALLOWED",{type:"Link"}),o.get("SELECT_SUPPORTED_TYPE_MSG"))}),n.ctrl.modelEvents.publish({event:"user-dropped-x3dcontent",data:{cancelled:!1,x3dcontent:s}})}}}};return n.init(e),n}}),define("DS/ENOXAttachmentsUX/AttachmentsPane",["UWA/Core","DS/ENOXAttachmentsUX/data/Controller","DS/ENOXAttachmentsUX/data/Connector3DSpace","DS/ENOXAttachmentsUX/views/Topbar","DS/ENOXAttachmentsUX/views/UploadPane","DS/ENOXAttachmentsUX/views/GridPane","DS/ENOXAttachmentsUX/views/TilePane","text!DS/ENOXAttachmentsUX/assets/config.json","DS/ENOXAttachmentsUX/data/DnDManager","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","DS/ENOXAttachmentsUX/utils/Overlay","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","css!DS/ENOXAttachmentsUX/ENOXAttachmentsUX.css"],function(e,t,n,o,a,i,s,r,l,c,d,p,u,m){"use strict";return(r=JSON.parse(r)).actionbar.forEach(function(e){e.text=u.get(e.nls),e.title=u.get(e.nls),e.content&&e.content.options&&e.content.options.items&&e.content.options.items.forEach(function(e){e.text=u.get(e.nls),e.description=u.get(e.nls)})}),r.headers.forEach(function(e){e.text=u.get(e.nls)}),r.contextMenu.forEach(function(e){e.text=u.get(e.nls),e.title=u.get(e.nls)}),e.Controls.Abstract.extend({name:"enox-attachments",options:{className:""},_options:{},modelEvents:void 0,init:function(t){this.attachmentsPaneStartTime=new Date,this.modelEvents=t.events||new c,this.config=e.clone(r),this._parent(t),this._options=t,this.buildSkeleton()},buildSkeleton:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.options.attachmentsType="attachments",new t(this),new o(this),this.buildContentPanes(),new l(this),this._options.delayInitialize?console.log("Waiting for initialize to be called"):this.initialize()},buildContentPanes:function(){this.elements.panes=e.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new a(this),new i(this),new s(this)},setParentObject:function(e,t){var n=!1;"true"==t&&(n=!0),this.options.parentObject=e,this.finishLoading(),n?this.showNotSupportedParent():this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.controller.clearAll(),n||this.controller.loadAttachments()},getParentObject:function(){return this.options.parentObject},setConnectorOptions:function(t){e.merge(this.options.connectorOptions,t)},setSupportedTypes:function(t){e.merge(this.options.supportedTypes,t),e.merge(this.options.searchOptions,this.options.supportedTypes)},initialize:function(){this.controller.initialize(this,this._options.connector||new n)},attachAttachments:function(e){this.controller.attachAttachments(e)},startLoading:function(){d.mask(this.elements.container)},finishLoading:function(){d.unmask(this.elements.container),p.unoverlay(this.elements.container)},showNoParentSelected:function(){p.overlay(this.elements.container,u.get("NOPARENTOBJECT"))},showNotSupportedParent:function(){p.overlay(this.elements.container,u.get("NOTSUPPORTEDSELECTION"))},destroy:function(){this.controller.destroy(),this._parent()},onRemoved:function(){this.destroy()},setSelection:function(e){this.controller.attachments.processDescendants({processNode:function(t){e.includes(t.nodeModel.options.data.id)?t.nodeModel.select():t.nodeModel.unselect()},onlyVisibleNodes:!1})},getSelection:function(){return this.controller.helper.restrict(this.controller.attachments.getSelectedNodes(),"options.data.id")}})}),define("DS/ENOXAttachmentsUX/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXAttachmentsUX/AttachmentsPane"],function(e,t,n,o,a){return t.extend(n,o,{init:function(e){this._parent(e),this.componentRefresh=!1,this.buildView(e)},buildView:function(t){this.elements.container=e.createElement("div",{class:"attachments"});var n={parentObject:{parentId:t.appContext.getDocumentId()},connectorOptions:{fetchSecurityContext:function(){return t.appContext.options.securityContext},platformUrls:t.appContext.options.platformUrls,credentialsPrefName:"credentials"}};this.attachmentsPane=new a(n),this.attachmentsPane.inject(this.elements.container),this.attachmentsPane.modelEvents.subscribe({event:"context-menu-requested"},function(e){var t;if(e.contextMenu.items.forEach(function(e){e.name&&e.name.startsWith("open-with")&&(t=e)}),t){var n=[];e.contextMenu.items.forEach(function(e){e.parentItemId&&e.parentItemId==t.id&&n.push(e)}),n.length>0&&1==n.length&&"ENXWDOC_AP"==n[0].name&&e.contextMenu.removeItem([t.id,n[0].name])}})},updateFacet:function(){this.selectionModified(this.options.appContext.getDocumentId())},selectionModified:function(e){if(e){var t={parentId:e};this.attachmentsPane&&this.attachmentsPane.getParentObject().parentId!==e&&this.attachmentsPane.setParentObject(t),this.componentRefresh=!0}},onResize:function(){},onRefresh:function(){}})});