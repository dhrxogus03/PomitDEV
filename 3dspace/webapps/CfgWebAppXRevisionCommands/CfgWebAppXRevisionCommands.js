define("DS/CfgWebAppXRevisionCommands/facets/CfgXRevisionVariabilityFacet",["UWA/Core","DS/EditPropWidget/facets/Common/FacetsBase","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXRevisionUtility","i18n!DS/CfgWebAppXRevisionCommands/assets/nls/CfgWebAppXRevisionCommands"],function(e,t,i,s,n,o){"use strict";return t.extend({init:function(){this._parent.apply(this,arguments),this.elements.container||(this.elements.container=e.createElement("div",{styles:{height:"100%"}}))},updateFacet:function(){require(["DS/CfgXRevisionUX/scripts/CfgXRevisionVariabilityView"],e=>{if(!this.elements&&!this.elements.container)return!1;let t=this.getModel();if(!t)return!1;this.objectId="";var i=this.getOccurrence().getOptions("Variability");this.objectId=i?i.targets[0].id:t.get("objectId"),this.getTenantID(t),this.elements.container.setContent(""),this.elements.container.setContent(new e({env:this.isNativeEnvironnement()?"Native":"3DDashboard",tenantID:this.tenantID,objectID:this.objectId,displayCompactMode:!0}).render()),this.subscribeVariabilityEvents()})},isNativeEnvironnement:function(){let e=!1;return(this.options.webToWinComSocket||"undefined"!=typeof dscef)&&(e=!0),e},getTenantID:function(e){this.tenantID=e.getTenant(),!this.tenantID&&widget.getValue("x3dPlatformId")?(console.log(">> tenant taken from widget"),this.tenantID=widget.getValue("x3dPlatformId")):!this.tenantID&&this.options.context&&this.options.context._context?(console.log(">> tenant taken from options for web in win"),this.tenantID=this.options.context._context.tenant):this.tenantID||(console.log(">> tenant value not found and OnPremise tenant value is used"),this.tenantID="OnPremise")},destroyComponent:function(){e.is(this.destroy,"function")&&this.destroy()},onSave:async function(){if("allocation"===this.allocationInfo.task)try{await n.allocation(this.allocationInfo),s.showNotifs("success","",o.allocationSuccess,"",""),i.ModelEvents.publish({event:"AllocationSuccess",data:{allocationID:this.allocationInfo.allocationPID[0]}})}catch(e){this._raiseEvent("switchSave",!0);let t=e?`${o.allocationFailed}: ${e}`:o.allocationFailed;s.showNotifs("error","",t,"","")}else try{await n.deallocation(this.allocationInfo),s.showNotifs("success","",o.deallocationSuccess,"",""),i.ModelEvents.publish({event:"DeallocationSuccess"})}catch(e){this._raiseEvent("switchSave",!0);let t=e?`${o.deallocationFailed}: ${e}`:o.deallocationFailed;s.showNotifs("error","",t,"","")}},subscribeVariabilityEvents:function(){i.ModelEvents.subscribe({event:"changeInAllocation"},e=>{this.allocationInfo=e,this._raiseEvent("switchSave",!0)})}})}),define("DS/CfgWebAppXRevisionCommands/commands/CfgXRevisionCmd",["DS/ApplicationFrame/Command","DS/CfgXRevisionUX/scripts/CfgXRevisionCreateView","DS/Utilities/Utils","DS/PADUtils/PADContext","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/Utilities/TouchUtils","DS/CfgBaseUX/scripts/CfgData","i18n!DS/CfgWebAppXRevisionCommands/assets/nls/CfgWebAppXRevisionCommands","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],function(e,t,i,s,n,o,a,r,c){"use strict";return e.extend({init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._isConfigAvailable=0,this.enable();t=this;o.rolesAvailable(function(e){e.isCFGRoleAvail&&(t._isConfigAvailable=1,t._setStateCmd())}),void 0!==s.get&&null!==s.get()?this._SelectorManager=s.get().getPADTreeDocument().getXSO():this._SelectorManager=null,null!==this._SelectorManager&&(void 0!==this._SelectorManager.onPostAdd&&this._SelectorManager.onPostAdd(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onPostRemove&&this._SelectorManager.onPostRemove(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onEmpty&&this._SelectorManager.onEmpty(this._checkSelection.bind(this)));t=this;void 0!==s.get&&null!==s.get()&&s.get().addEvent("editModeModified",function(e){!0===e?t._checkSelection():t.disable()})},_checkSelection:i.debounce(function(){this._SelectedID="";var e=this.getData().selectedNodes;e.length>=1&&(this._SelectedID=e[0].id||"",this._SelectedAlias=e[0].alias||"?"),this._setStateCmd()},200),_setStateCmd:function(){var e=0;let t=this.getData().selectedNodes;void 0!==this._SelectedID&&""!==this._SelectedID&&(e=1,0==this._isConfigAvailable&&(e=0)),void 0!==s.get&&null!==s.get()&&!0!==s.get().getEditMode()&&(e=0),1===e?this.enable():this.disable(),t.length>1&&this.disable(),"object"==typeof widget&&widget.data&&widget.data.appId&&"ENOLCMI_AP"===widget.data.appId&&this.enable()},execute:async function(){var e=this;e.disable();var i=e.getData().selectedNodes;let s={referenceId:i[0].id,type:i[0].type};try{enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",await o.populate3DSpaceURL(),await o.populateSecurityContext();let g=await o.checkProperties([i[0].type]);if(g&&g[i[0].type]&&"NO"===g[i[0].type].configurable)return o.showNotifs("info","",c.Object_Not_Configurable),void e.enable();let h={version:"1.1",xRevisionContent:!0,referenceIds:[s.referenceId]},f=await o.getMultipleConfigurationContextInfo(h);if(f&&f.xRevisionContent&&f.xRevisionContent.length>0)return o.showwarning(c.xRevision_Exists,"info"),void e.enable();e.xRevCreateView=new t(s);let u=e.xRevCreateView.render();e.enable();var l=[{label:"Close",labelValue:c.Close,handler:function(){e.xRevisionDialog.closeDialog()},className:"primary"}];let v=c.xRevision+" - "+i[0].alias,p=!!a.getTouchMode();var d={className:"CfgEditConfigurationFloatingPanel",title:v,parent:widget.body,body:u,overlay:!0,mode:"DashboardConfigurationContext",closable:!1,animate:!0,resizable:!0,touchMode:p,footer:l,persistId:"xRevisionDialog",appNamePosition:0,width:400,height:200,minWidth:300,minHeight:200,dialogue:{header:v,buttonArray:l,target:widget.body}};this.xRevisionDialog=new n(d),this.xRevisionDialog.render(),r.ModelEvents.subscribe({event:"XRevCreatecloseDialog"},t=>{e.xRevisionDialog.closeDialog()})}catch(e){this.enable()}},getData:function(){var e={selectedNodes:[]};if(void 0!==s.get&&null!==s.get()){let t=s.get().getPADTreeDocument().getSelectedNodes();for(let i=0;i<t.length;i++){let s=t[i].options&&t[i].options.type?t[i].options.type:"",n=this.getItem(t[i].getID(),t[i].getLabel(),s);e.selectedNodes.push(n)}}else{let t=this.options.context.getSelectedNodes();for(let i=0;i<t.length;i++){let s=t[i].object&&t[i].object.type?t[i].object.type:"",n=this.getItem(t[i].getID(),t[i].getLabel(),s);e.selectedNodes.push(n)}}return e},getItem:(e,t,i)=>({id:e,alias:t,type:i})})}),define("DS/CfgWebAppXRevisionCommands/facets/PLMNewRevisionFacet",["DS/CfgXRevisionUX/scripts/PLMNewRevisionFacetView","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgController","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase","DS/CoreEvents/ModelEvents","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],function(e,t,i,s,n,o,a){"use strict";return o.extend({init:function(t){this._parent(t),s.ModelEvents=new a,n.init(),enoviaServerFilterWidget.tenant=t.tenant,enoviaServerFilterWidget.mySecurityContext=t.securityContext,this.elements.container=UWA.createElement("div",{class:"revisionPLMNewContainer"}),this.facetView=new e({}),this.elements.container.setContent(this.facetView.render())},postCreation:function(e){this.createdObject=e,"Effectivity based"===this.facetView.currentRevControl?this.postProcessingEffectivityBased():"Effectivity based - Use existing graph"===this.facetView.currentRevControl?this.postProcessingReuse():"Effectivity based - Model"===this.facetView.currentRevControl&&this.postProcessingModel()},postProcessingEffectivityBased:async function(){try{let e=await t.createxRevision(this.createdObject[0].identifier);e&&e.xRevisionGraphPID&&t.showwarning(i.xRevision_Creation_Success,"success"),this.publishPostProcessingEvent()}catch(e){e&&e.errorMessage?t.showwarning(e.errorMessage,"error"):t.showwarning(i.xRevision_Creation_Error,"error")}},postProcessingReuse:async function(){try{const e={selectedObjectId:this.facetView.selectedRefIDForReuse,inputObjectIdList:[this.createdObject[0].identifier]},s=await t.setConfiguredObjectInfo(e);s&&"SUCCEED"===s.result&&t.showwarning(i.xRevision_Creation_Success,"success"),this.publishPostProcessingEvent()}catch(e){e&&e.errorMessage?t.showwarning(e.errorMessage,"error"):t.showwarning(i.xRevision_Creation_Error,"error")}},postProcessingModel:async function(){try{const e={version:"1.2",pidList:[this.createdObject[0].identifier],content:{attachCfgCtxt:[this.facetView.selectedModelID],enabledCriteria:{}}};"products"==this.facetView.criteriaDropDown.currentValue&&(e.content.enabledCriteria.productState="true"),"manufacturingPlans"==this.facetView.criteriaDropDown.currentValue&&(e.content.enabledCriteria.manufacturingPlan="true");const s="/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1",n=e=>{console.log(e)},o=(e,t)=>{reject(t||e)};t.makeWSCall(s,"POST","enovia","application/json",JSON.stringify(e),n,o,!0,{}),this.publishPostProcessingEvent()}catch(e){e&&e.errorMessage?t.showwarning(e.errorMessage,"error"):t.showwarning(i.xRevision_Creation_Error,"error")}},publishPostProcessingEvent:function(){let e={commandName:"cfgEditConfigurationContext",widgetId:widget.id,response:{},data:{pids:[this.createdObject[0].identifier]}};t.publishPostProcessingEventForApplications(e)}})});