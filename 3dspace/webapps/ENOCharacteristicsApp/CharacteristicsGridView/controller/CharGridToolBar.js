define("DS/ENOCharacteristicsApp/CharacteristicsGridView/controller/CharGridToolBar",["UWA/Core","UWA/Class","DS/Menu/Menu","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","DS/ENOCharacteristicsApp/utils/CharacteristicsEvents","DS/ENOCharacteristicsApp/utils/Constants","DS/ENOCharacteristicsApp/utils/CharacteristicsMask","DS/ENOCharacteristicsApp/utils/CharacteristicsUtils","DS/XSRCommonComponents/utils/TypeUtils","DS/Windows/ImmersiveFrame","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/ComboBox","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/TooltipModel","i18n!DS/ENOCharacteristicsApp/assets/nls/ENOCharacteristicsApp"],function(e,t,i,n,a,o,l,s,r,c,d,u,h,p,m,C,g){"use strict";return t.extend({init:function(e){this.modelEvents=e.modelEvents,this.target=e.target,this.container=e.container,this.toolBarEvents=new a,this.hiddenCmds=[],this.appCore=e.appCore,this._subscribeEvents(),this.appCore.wrap_enabled=!1},draw:function(e){e&&(this.target=e);var t={modelEvents:this.toolBarEvents,withmultisel:!0,showItemCount:!0,actions:this.actionCommands,multiselActions:null,multiselActionCallback:!1,filter:{multiselect:!1,enableCache:!1},sort:[],views:[],currentView:""};this.collectionToolbar=new n(t),this.collectionToolbar.inject(e),this.hideResetCommand(),this.hideCommand("Unwraptext"),this.hideCommand("expandAll")},_subscribeEvents:function(){var e=this;this.subscriptionList=[],this.subscriptionList.push(this.modelEvents.subscribe({event:o.UPDATE_CHARVIEW_TOOLBOOR_COUNT},function(t){var i=e.currentModel?e.currentModel.getSelectedNodes().length:0;i>0?e.toolBarEvents.publish({event:o.COLLECTION_TOOLBAR_CHECKBOX_CHECK_FLAG,data:{}}):e.toolBarEvents.publish({event:o.COLLECTION_TOOLBAR_CHECKBOX_UNCHECK_FLAG,data:{}}),e.toolBarEvents.publish({event:o.COLLECTION_TOOLBAR_EVENT_UPDATE_COUNT,data:i})})),this.subscriptionList.push(e.modelEvents.subscribe({event:o.EVENT_SHOW_RESET_COMMAND},function(){e.showResetCommand()})),this.subscriptionList.push(e.modelEvents.subscribe({event:o.EVENT_HIDE_RESET_COMMAND},function(){e.hideResetCommand()})),e.toolBarEvents.subscribe({event:o.COLLECTION_TOOLBAR_SEARCH},function(t){var i=e.currentModel;i.prepareUpdate();var n=i.getChildren();e.showAllNodes(n);let a=widget.getValue(o.VIEW_PERSISTANCE_KEY);if(t.searchValue[0]&&0!==t.searchValue.length){var l=[];i.search({match:function(e){var i=e.nodeModel;if(!i._canBeGrouped())return!1;if(i&&r.isPerformanceSpecification(i.getTypeActualName())){if(a===o.TOOLBAR_VIEW_RELEASED&&!i.isReleased()||a===o.TOOLBAR_VIEW_REVISED&&!i.isLastRevision())return i.setSearchFilterState(!1),!0}else if(r.isPerformanceCharacteristics(i.getTypeActualName())&&(a===o.TOOLBAR_VIEW_RELEASED&&!i.getParent().isReleased()||a===o.TOOLBAR_VIEW_REVISED&&!i.getParent().isLastRevision()))return i.setSearchFilterState(!1),!0;if(!i.getTitle)return!0;var n=i.getTitle()+" "+i.getDescription()+" "+i.getCategory()+" "+i.getRevision()+" "+i.getMaturity()+" "+i.getNotes();if(r.isPerformanceCharacteristics(i.getTypeActualName())&&(n+=i.getDimension()+" "+i.getLowerRoutineReleaseLimit()+" "+i.getLowerSpecificationLimit()+" "+i.getLowerTarget()+" "+i.getUpperRoutineReleaseLimit()+" "+i.getUpperSpecificationLimit()+" "+i.getUpperTarget()+" "+i.getDisplayUnit()+" "+i.getCharPrecision()+" "+i.getPriority()+" "+i.getMissedTargetAction()+" "+i.getTestMethodsLabel()+" "+i.getDisplayTarget()),t.searchValue[0]&&-1!==n.toUpperCase().indexOf(t.searchValue[0].toUpperCase())){if(i.setSearchFilterState(!0),r.isPerformanceCharacteristics(i.getTypeActualName())){let e=i.getParent();l.push(e.getID())}return!1}return i.setSearchFilterState(!1),!0}}).forEach(function(e,t){e._canBeGrouped()&&e.getTitle&&!l.includes(e.getID())&&(e.unmatchSearch(),e.setSearchFilterState(!1),e.applyFilters())}),i.pushUpdate()}else i.pushUpdate()}),e.toolBarEvents.subscribe({event:o.COLLECTION_TOOLBAR_EVENT_ALL_SELECTED},function(t){e.currentModel.selectAll()}),e.toolBarEvents.subscribe({event:o.COLLECTION_TOOLBAR_EVENT_ALL_UNSELECTED},function(t){e.currentModel.unselectAll()})},hideResetCommand:function(){var e=this.target?this.target.getElementsByTagName("li").ResetChanges:void 0;e&&e.setStyle("display","none")},showResetCommand:function(){var e=this.target?this.target.getElementsByTagName("li").ResetChanges:void 0;e&&e.setStyle("display","inline-block")},showAllNodes:function(e){var t=this;let i=widget.getValue(o.VIEW_PERSISTANCE_KEY);e&&Array.isArray(e)&&e.forEach(function(e,n){if(!e||!r.isPerformanceSpecification(e.getTypeActualName())||(i!==o.TOOLBAR_VIEW_RELEASED||e.isReleased())&&(i!==o.TOOLBAR_VIEW_REVISED||e.isLastRevision()))if(e._canBeGrouped()){if(e.setSearchFilterState(!0),e.getChildren()&&e.getChildren().length>0){e.getChildren().forEach(e=>{e.setSearchFilterState(!0),e._isHidden=!1})}e.applyFilters()}else t.showAllNodes(e.getChildren())})},setActions:function(e){this.actionCommands=this.commandHandler(e)},setCurrentView:function(e){this.currentView=e},setCurrentModel:function(e){this.currentModel=e},commandHandler:function(e){var t=[],i=this;e.forEach(function(e){var n={};n.id=e.key,n.text=e.nlsLabel?g[e.nlsLabel]:e.nlsLabel,n.title=e.nlsLabel,n.disabled=e.disabled,n.fonticon=e.fonticon;var a=e.persistencyKey,o=e.isSelectable,l=e.subMenu;if(l){if(n.handler=function(e){var t=e.target.getBoundingClientRect();i.drawSubMenu(t,l,this,a,o)},a&&o){let e=widget.getValue(a);l.forEach(t=>{e&&e===t.key&&(n.fonticon=t.fonticon,n.text=g[t.nlsLabel])})}}else n.handler=i.launchCommand.bind(i,e.key);t.push(n)});var n={id:"expandAll"};n.text=g.label_expandAll||"Expand All",n.title="expand View",n.fonticon="flow-tree-expand-down",n.handler=i.launchExpandAll.bind(i,"expandAll"),t.push(n);var a={id:"collapseAll"};a.text=g.label_collapseAll||"Collapse All",a.title="Collapse View",a.fonticon="flow-tree-expand-up",a.handler=i.launchCollapseAll.bind(i,"collapseAll"),t.push(a);var o={id:"Export"};o.text=g.label_ExportCharacteristics,o.title=g.label_ExportCharacteristics,o.fonticon="export",o.handler=i.launchCommand.bind(i,"Export"),t.push(o);var l={id:"Personalize"};l.text=g.PersonalizeView,l.title="Personalize View",l.fonticon="cog",l.handler=i.launchCommand.bind(i,"Personalize"),t.push(l);var s={id:"Wraptext"};s.text=g.label_Wrap,s.title=g.label_Wrap,s.fonticon="text-wrapping-ok",s.handler=i.launchWrapText.bind(i),t.push(s);var r={id:"Unwraptext"};r.text=g.label_UnWrap,r.title=g.label_UnWrap,r.fonticon="text-wrapping-off",r.handler=i.launchUnWrapText.bind(i),t.push(r);var c={id:"ResetChanges"};return c.text=g.ResetChanges,c.title=g.ResetChanges,c.fonticon="reset",c.handler=i.launchResetModelChanges.bind(i),t.push(c),t},drawSubMenu:function(e,t,n,a,o){var l=this;if(t){var r=function(e){var t=[];return e.forEach(function(e){var i={};if(i.title=g[e.nlsLabel]||e.text,"CheckItem"==e.type?i.type=e.type:i.type=e.type&&"separator"===e.type?"TitleItem":"PushItem",e.tooltip){let t={};e.tooltip.title&&(t.title=g[e.tooltip.title]),e.tooltip.shortHelp&&(t.shortHelp=g[e.tooltip.shortHelp]),e.tooltip.longHelp&&(t.longHelp=g[e.tooltip.longHelp]),i.tooltip=new C(t)}if("CreateCharacteristics"===e.key){let e=l.currentView.getTreeDocument().getSelectedNodes();1===e.length&&s.allTypeList.includes(e[0].getTypeActualName())&&e[0].isInWork()||(i.state="disabled")}if(l.currentView.getTreeDocument().getSelectedNodes().length>0&&"CreateSpecification"===e.key&&(i.state="disabled"),a||"CheckItem"===i.type){let t=widget.getValue(a);null!=t?t==e.key?i.state="selected":i.state="unselected":(e.isDefault,i.state=e.isDefault?"selected":"unselected")}if(e.subMenu){e.fonticon&&(i.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),i.action={this:this,callback:function(t){l.launchCommand(e.key)}};var c=r(e.subMenu);i.submenu=c}else if("PushItem"===i.type||"CheckItem"===i.type){if(e.fonticon&&(i.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),"CreateSpecification"===e.key){delete i.fonticon;var d=s.getIconForChar("PerformanceSpecification_2");i.icon=d}else if("CreateCharacteristics"===e.key){delete i.fonticon;var u=s.getIconForChar("MeasurementCharacteristics_2");i.icon=u}i.action={this:this,callback:function(t){!e.isDefault&&o?(widget.setValue(a,e.key),l.changeTooltipFontIcon(n,e)):e.isDefault&&o&&(widget.setValue(a,e.key),l.changeTooltipFontIcon(n,e)),l.launchCommand(e.key)}}}t.push(i)}),t};l.subMenus=r(t),i.show(l.subMenus,{position:{x:e.left,y:e.bottom}})}},launchExport:function(){this.currentView.gridOptions.api.exportDataAsExcel()},launchExpandAll:function(){this.currentView.treeDocument.expandAll(),this.hideCommand("expandAll"),this.showCommand("collapseAll")},launchCollapseAll:function(){this.currentView.treeDocument.collapseAll(),this.hideCommand("collapseAll"),this.showCommand("expandAll")},launchCustomView:function(){let t=this.currentView.gridOptions,i=e.createElement("div",{class:"xsr-custom-view-content-container"});var n=e.createElement("div",{class:"xsr-cusotm-view-selection-container",styles:{display:"flex","align-items":"center"}});n.inject(i);let a=e.createElement("div",{class:"xsr-unique-cusotm-view-selection-container",styles:{marginTop:"10px"}});a.inject(i),e.createElement("div",{class:"xsr-custom-view-label",html:"View"}).inject(n);var o=new d({placeholder:"custom view label",value:"",widthInCharNumber:40});o.inject(n),o.visibleFlag=!1;var l=new h({elementsList:c(),enableSearchFlag:!1});l.inject(n),new u({label:"Add View",showLabelFlag:!1,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite",onClick:function(e){o.visibleFlag=!0,l.visibleFlag=!1}}).inject(n),new u({label:"Delete View",showLabelFlag:!1,icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite",onClick:function(e){console.log(l);let t=JSON.parse(localStorage.getItem("agGridState"));delete t[l.value],localStorage.setItem("agGridState",JSON.stringify(t)),l.elementsList=c()}}).inject(n);let s=new m({type:"switch",label:"Save Unique Performance Specification View",value:1});s.inject(a);var r=new p({title:"Custom Views",content:i,activeFlag:!1,modalFlag:!0,buttons:{Save:new u({label:"Save",onClick:function(e){r.close();let i=o.value,n=(s.checkFlag,t.columnApi.getColumnState()),a=null;t.api.forEachDetailGridInfo(e=>{a=e.columnApi.getColumnState()});let l=JSON.parse(localStorage.getItem("agGridState")),c=a?{rootGridState:n,nestedGridState:a}:{rootGridState:n};l?l[i]=c:l={[i]:c},localStorage.setItem("agGridState",JSON.stringify(l))}}),Apply:new u({label:"Apply",emphasize:"primary",onClick:function(e){console.log(o),r.close();let i=l.value,n=JSON.parse(localStorage.getItem("agGridState"));n&&(t.columnApi.setColumnState({state:n[i].rootGridState,applyOrder:!0}),t.api.forEachDetailGridInfo(e=>{e.columnApi.setColumnState({state:n[i].nestedGridState,applyOrder:!0})}))}}),Reset:new u({label:"Reset to Default",onClick:function(e){console.log(o),r.close(),t.columnApi.resetColumnState(),t.api.forEachDetailGridInfo(e=>{e.columnApi.resetColumnState()})}}),Cancel:new u({onClick:function(e){console.log(o),r.close();o.value}})}});function c(){let e=JSON.parse(localStorage.getItem("agGridState"));return e?Object.keys(e):[]}console.log("display Custom Dialog from XSRSearch.js")},launchWrapText:function(){var e=this.currentModel;l.maskLoader(this.container,g.WrapLoader),this.currentModel.gridLayout.collectionView.prepareUpdateView();var t=this.currentModel.gridLayout.columns;document.querySelectorAll(".xsr-custom-container > .read-only").forEach(e=>{e.addClassName("wrap-text")}),this.appCore.wrap_enabled=!0;for(var i=function(e,t,i){"tree"!==t.typeRepresentation&&"string"!==t.typeRepresentation||(t._defaulttypeRepresentation=t.typeRepresentation,e.gridLayout.setColumnTypeRepresentation(i,"textBlock")),e.gridLayout.setColumnAutoRowHeightFlag(i,!0)},n=0;n<t.length;n++){var a=t[n],o=t[n].children,r=a.dataIndex;if(a.typeRepresentation)i(e,a,r);else if(o)for(var c=0;c<o.length;c++){var d=o[c];i(e,d,d.dataIndex)}}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),s.disableEditableContainers(),this.hideCommand("Wraptext"),this.showCommand("Unwraptext"),l.unmaskLoader(this.container)},launchUnWrapText:function(){this.currentModel.gridLayout.collectionView.prepareUpdateView();var e=this.currentModel.gridLayout.columns;document.querySelectorAll(".xsr-custom-container > .read-only").forEach(e=>{e.removeClassName("wrap-text")}),this.appCore.wrap_enabled=!1;for(var t=function(e,t,i){t.typeRepresentation&&"textBlock"===t.typeRepresentation&&(t.typeRepresentation=t._defaulttypeRepresentation?t._defaulttypeRepresentation:t.typeRepresentation),e.gridLayout.setColumnAutoRowHeightFlag(i,!1)},i=0;i<e.length;i++){var n=this.currentModel,a=e[i],o=e[i].children,l=a.dataIndex;if(a.typeRepresentation)t(n,a,l);else if(o)for(var r=0;r<o.length;r++){var c=o[r];t(n,c,c.dataIndex)}}this.currentModel.gridLayout.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0),s.disableEditableContainers(),this.hideCommand("Unwraptext"),this.showCommand("Wraptext")},hideCommand:function(e){var t=this.target?this.target.getElementsByTagName("li")[e]:void 0;t&&(t.setStyle("display","none"),-1===this.hiddenCmds.indexOf(e)&&this.hiddenCmds.push(e))},showCommand:function(e){var t=this.target?this.target.getElementsByTagName("li")[e]:void 0;t&&(t.setStyle("display","inline-block"),this.hiddenCmds.splice(this.hiddenCmds.indexOf(e),1))},launchResetModelChanges:function(){this.currentModel&&(this.currentModel.cancelChanges(),this.hideResetCommand())},launchCommand:function(e){this.modelEvents.publish({event:"grid-toolbar-action-click-characterstics",data:e})},disableCommands:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.toolBarEvents.publish({event:o.COLLECTION_TOOLBAR_COMMAND_DISABLE,data:i}),this.hiddenCmds.indexOf(i)>=0&&this.hideCommand(i)}},enableCommands:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.toolBarEvents.publish({event:o.COLLECTION_TOOLBAR_COMMAND_ENABLE,data:i}),this.hiddenCmds.indexOf(i)>=0&&this.hideCommand(i)}},changeTooltipFontIcon:function(e,t){let i=g[t.nlsLabel]||t.text;e.tooltip.getBody().setText(i),e.fonticon="fonticon fonticon-"+t.fonticon,e.elements.icon.className="fonticon fonticon-"+t.fonticon},destroy:function(){this.subscriptionList&&this.modelEvents.unsubscribeList(this.subscriptionList),this.toolBarEvents.unsubscribeAll()}})});