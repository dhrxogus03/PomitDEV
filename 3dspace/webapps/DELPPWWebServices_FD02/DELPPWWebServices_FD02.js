define("DS/DELPPWWebServices_FD02/CommonService",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/DELPPWModelServices_FD02/ModelUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DELPPWLoggerModel_FD02/LoggerUtils"],function(e,t,i,r,s,n,a){"use strict";return t.extend({name:"CommonService",_servicesURL:{},_platformId:{},_3DSpaceServiceName:"3DSpace",_3DODMServiceName:"orderdatamgmt",_AppCloudServiceName:"3dmfgitemsmgt",_3DSearchServiceName:"3DSearch",_defaultSecurityContext:"ctx::FakeDefaultRole.FakeDefaultOrga.FakeDefaultCommonSpace",_CSRFToken:{},init:function(t){t=t||{},e.is(t.cloudServiceName)?this._AppCloudServiceName=t.cloudServiceName:a.debug(this.name,"ERROR: Cloud Service name is not proivided"),this._servicesURL[this._3DSpaceServiceName]="NOT_DEFINED",this._servicesURL[this._3DODMServiceName]="NOT_DEFINED",this._servicesURL[this._AppCloudServiceName]="NOT_DEFINED",this._servicesURL[this._3DSearchServiceName]="NOT_DEFINED",this._platformId[this._3DSpaceServiceName]="NOT_DEFINED",this._platformId[this._3DODMServiceName]="NOT_DEFINED",this._platformId[this._AppCloudServiceName]="NOT_DEFINED",this._platformId[this._3DSearchServiceName]="NOT_DEFINED",this._CSRFToken[this._3DSpaceServiceName]=null,this._CSRFToken[this._3DODMServiceName]=null,this._CSRFToken[this._AppCloudServiceName]=null,this._CSRFToken[this._3DSearchServiceName]=null,a.debug(this.name,"initialized")},getDefault3DSpaceBaseURL:function(t){var r=!!e.is(t,"string")&&t.length>0,s=(r?r?t:"":i.getWebappsBaseUrl()).match(/^(https?:\/\/)?([\da-z\.-]+)(:[0-9]{2,5})?([\/\w \.-]*3DDashboard\/)*/),n="";return e.is(s)&&e.is(s,"array")&&(n=(e.is(s[1])?s[1]:"")+s[2]+(e.is(s[4])?"":s[3])+(e.is(s[4])?s[4].replace(/3DDashboard\/?/,"3DSpace/"):"/3DSpace/")),n},getDefault3DODMBaseURL:function(t){var r=!!e.is(t,"string")&&t.length>0,s=(r?r?t:"":i.getWebappsBaseUrl()).match(/^(https?:\/\/)?([\da-z\.-]+)(:[0-9]{2,5})?([\/\w \.-]*3DDashboard\/)*/),n="";return e.is(s)&&e.is(s,"array")&&(n=s[0].replace(this._AppCloudServiceName,"odm")),n+"/"},getPlatformID:function(t){var i=null;return t=t||{serviceId:this._3DSpaceServiceName},e.is(t.serviceId,"string")?i=this._platformId[t.serviceId]:a.debug(this.name,"ERROR: Couldn't retrieve the platform ID"),i},get3DSpaceServiceName:function(){return this._3DSpaceServiceName},get3DSpaceUrl:function(){return"NOT_DEFINED"===this._servicesURL[this._3DSpaceServiceName]&&(this._servicesURL[this._3DSpaceServiceName]=this.getDefault3DSpaceBaseURL()),this._servicesURL[this._3DSpaceServiceName]},get3DSearchUrl:function(){return this._servicesURL[this._3DSearchServiceName]},getServiceUrl:function(e){var t=null;return-1!==Object.keys(this._servicesURL).indexOf(e)&&(t=this._servicesURL[e]),t},setSecurityContext:function(t){a.debug("setDefaultSecurityContext: "+e.Json.encode(t)),this._defaultSecurityContext=e.is(t)?t:""},getSecurityContext:function(){return this._defaultSecurityContext},setCSRFToken:function(t,i){e.is(i,"string")&&i.length>0&&e.is(t)&&(this._CSRFToken[i]=e.is(t.eno_csrf_token)?{eno_csrf_token:t.eno_csrf_token}:null)},getCSRFToken:function(t){var i="";return e.is(t,"string")&&this._CSRFToken[t]&&(i=this._CSRFToken[t].eno_csrf_token),i},getHeaders:function(t){var i=t||{},r=!!e.is(i.isJsonOnly)&&i.isJsonOnly,s=!!e.is(i.isAuthoringCtx)&&i.isAuthoringCtx,n=e.is(i.minorVersion)?i.minorVersion:"",a=e.is(i.serviceName)?i.serviceName:"3DSpace",o=this._getAuthoringContextHdr(),c={"Accept-Language":e.is(widget)&&e.is(widget.lang,"string")?widget.lang:"en",SecurityContext:this.getSecurityContext()};return r?(c.Accept="application/json",c["Content-Type"]="application/json"):(c.Accept="application/json,text/javascript,*/*",c["Content-Type"]="application/ds-json"),e.is(s)&&(c=e.extend(c,o)),e.is(n,"string")&&n.length>0&&(c["DS-API-Version"]=n),e.is(a,"string")&&a.length>0&&e.is(this._CSRFToken[a])&&(c=e.extend(c,this._CSRFToken[a])),c},_getAuthoringContextHdr:function(){var t=s.get();return e.is(t)&&e.is(t.AuthoringContextHeader)?t.AuthoringContextHeader:{}},getRetrieveServiceURLPromise:function(t){var i=this;return new Promise(function(r,s){var o=e.is(widget)?e.is(widget.getValue,"function")?widget.getValue("x3dPlatformId"):"noWidgetGetValue":"noWidget";e.is(o,"string")&&0<o.length||(o="OnPremise",a.warn("getRetrieveServiceURLPromise, platformId set by default !!!")),a.debug("getRetrieveServiceURLPromise: "+o),n.getServiceUrl({serviceName:t,platformId:o,onComplete:function(n){var a="";e.is(n,"array")&&0<n.length&&e.is(n[0].url,"string")?(i._servicesURL[t]=n[0].url+(t===i._3DSpaceServiceName||t===i._AppCloudServiceName?"/":""),i._platformId[t]=n[0].platformId,r("iServiceInfoArray Array (ServiceName, ServiceURL, ServicePlatformID): "+t+", "+i._servicesURL[t]+", "+i._platformId[t])):e.is(n,"string")?(i._servicesURL[t]=n+(t===i._3DSpaceServiceName||t===i._AppCloudServiceName||t===i._3DODMServiceName?"/":""),i._platformId[t]=o,r("iServiceInfoArray String (ServiceName, ServiceURL, ServicePlatformID): "+t+", "+i._servicesURL[t]+", "+i._platformId[t])):e.is(i._servicesURL[t],"string")&&"NOT_DEFINED"!==i._servicesURL[t]?r("Warning (ServiceName, iServiceInfo, Default URL): "+t+", "+n+", "+i._servicesURL[t]):(a=e.is(n)?e.Json.encode(n):"No Object found",s("Error in getRetrieveServiceURLPromise (ServiceName, iServiceInfo): "+t+", "+a))},onFailure:function(e){s("i3DXCompassPlatformServices.getServiceUrl call failed: "+e)}})})},getAvailableRolesPromise:function(){return new Promise(function(e){var t=[];n.getGrantedRoles(function(i){i.forEach(function(e){t.push(e.id)}),e("userGrantedRoles: "+t)}),r._userGrantedRoles=t})}})}),define("DS/DELPPWWebServices_FD02/WebService",["UWA/Core","UWA/Date","DS/WAFData/WAFData","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELPPWWebServices_FD02/CommonService","DS/DELPPWLoggerModel_FD02/LoggerUtils","DS/DELPPWModelServices_FD02/BehaviorUtil"],function(e,t,i,r,s,n,a){"use strict";return s.extend({name:"WebService",_webServicesCount:1,init:function(e){this._parent(e)},getServiceUrlPromises:function(){var e=[this.getRetrieveServiceURLPromise(this._3DSpaceServiceName)];return e.push(this.getRetrieveServiceURLPromise(this._3DSearchServiceName)),a.isCloud()&&(e.push(this.getRetrieveServiceURLPromise(this._AppCloudServiceName)),e.push(this.getRetrieveServiceURLPromise(this._3DODMServiceName))),e.push(this.getAvailableRolesPromise()),Promise.all(e)},webServiceRequest:function(s){var a,o,c,l,u,m,S,d,v,h,g,f,p,D,_,C,N,R,b,P,U,L=this;e.is(s)?e.is(s.url,"string")?e.is(s.method,"string")?(a=e.is(s.serviceName)?s.serviceName:"3DSpace",o=/^https?:\/\//i.test(s.url)?s.url:L.getServiceUrl(a)+"resources/"+s.url,c=e.is(s.type)?s.type:"json",l=e.is(s.data)?s.data:null,u=e.is(s.headers)?s.headers:L.getHeaders({serviceName:a}),m=!e.is(s.async)||s.async,S=e.is(s.context)?s.context:this,d=e.is(s.noProxy)?null:"passport",v=!e.is(s.authenticated)||s.authenticated,h=r.getTimeoutPreference(),o+=(o.indexOf("?")>-1?"&":"?")+"useAttrFullName=false",document.body.style.cursor="wait",N=t.now(),R=L._webServicesCount+"-START- "+s.url+" request / Time: "+new t(N).toISOString(),b=L._webServicesCount+"-END- "+s.url+" request",P=L._webServicesCount+"-FAIL- "+s.url+" request",U=L._webServicesCount+"-TIME OUT- "+s.url+" request",f=function(i,r){document.body.style.cursor="default",_=t.now(),C=b+" / Duration: "+(_-N)+" ms",n.debug(C),e.is(s.onComplete)&&s.onComplete.call(S,i,r),e.is(s.logMessage)&&n.debug(s.logMessage)},p=function(t,i,r){document.body.style.cursor="default",n.warn(P),n.warn(t),n.warn(JSON.stringify(i)),e.is(s.onFailure)&&s.onFailure.call(S,t,i,r),e.is(s.logMessage)&&n.debug(s.logMessage+i)},D=function(t){document.body.style.cursor="default",n.warn(U),n.warn(t),e.is(s.onTimeout)&&s.onTimeout.call(S,t),e.is(s.logMessage)&&n.debug(s.logMessage)},n.debug(R),g={headers:u,method:s.method,type:c,onComplete:f,data:l,onFailure:p,onTimeout:D,async:m},s.noProxy||(g.proxy=d),e.is(h)&&(g.timeout=h),e.is(s.logMessage)&&n.debug(s.logMessage),v?(n.debug("Call to WAFData.authenticatedRequest(URL, options): ",o+", "+e.Json.encode(g)),i.authenticatedRequest(o,g)):(n.debug("Call to WAFData.proxifiedRequest(URL, options): ",o+", "+e.Json.encode(g)),i.proxifiedRequest(o,g)),L._webServicesCount++):n.debug(this.name,"iOptions.method must be be defined in Webservice.webServiceRequest call."):n.debug(this.name,"iOptions.url must be a string in Webservice.webServiceRequest call."):n.debug(this.name,"iOptions must exist in Webservice.webServiceRequest call.")},fireGETWSInChunkIfTooBig:function(t){var i,r=this,s=0,a=null,o=[],c=[],l=null,u=null,m=null;if(e.is(t))if(e.is(t.url,"string")&&0!==t.url.length)if(e.is(t.data,"array")&&0!==t.data.length)if(i=JSON.stringify(t.data),u=e.is(t.chunk,"number")&&u>0?t.chunk:5,t.url.length+i.length>2048){for(s=0;s<t.data.length;s+=u)a=t.data.slice(s,s+u),l=new Promise(function(e,i){var s={url:t.url,method:"GET",data:{payload:JSON.stringify(a)},type:t.type,async:t.async,context:t.context,headers:t.headers,noProxy:t.noProxy,authenticated:t.authenticated,onComplete:e,onFailure:i,onTimeout:i};r.webServiceRequest(s)}),c.push(l);Promise.all(c).then(function(i){e.is(i,"array")?(o=i.flat(),e.is(t.onComplete,"function")&&t.onComplete(o)):e.is(t.onComplete,"function")&&t.onComplete()},function(i){e.is(t.onFailure,"function")&&t.onFailure(i)})}else m={url:t.url,method:"GET",data:{payload:i},type:t.type,async:t.async,context:t.context,headers:t.headers,noProxy:t.noProxy,authenticated:t.authenticated,onComplete:t.onComplete,onFailure:t.onFailure,onTimeout:t.onTimeout},r.webServiceRequest(m);else n.debug(r.name,"iOptions.data must be an array in Webservice.splitGETWebService call.");else n.debug(r.name,"iOptions.url must be a string in Webservice.splitGETWebService call.");else n.debug(r.name,"iOptions must exist in Webservice.splitGETWebService call.")}})}),define("DS/DELPPWWebServices_FD02/WebserviceUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELPPWWebServices_FD02/WebService","DS/DELPPWModelServices_FD02/BehaviorUtil","DS/DELPPWLoggerModel_FD02/LoggerUtils"],function(e,t,i,r,s,n){"use strict";return t.singleton({name:"WebServiceUtils",_xmlCache:null,_xmlConfiguration:null,_custoParamSetPID:null,init:function(e){var s=this;e=e||{},this.options=e,i.isStandAlone()?require(["DS/DELPPWWebServicesTst/StandaloneService"],function(r){t.implement.call(s,new r),i.setUserGrantedRoles(["IFW","InternalDS"]),s._servicesURL[s._3DSpaceServiceName]="http://localhost/3DSpace",s._servicesURL[s._3DSearchServiceName]="http://localhost/federated",s._platformId[s._3DSpaceServiceName]="OnPremise",s._platformId[s._3DSearchServiceName]="OnPremise",e.resolve()}):(t.implement.call(s,new r({cloudServiceName:e.cloudServiceName})),s.getServiceUrlPromises().then(e.resolve,e.reject))},getTenant:function(){return this.getPlatformID()},getWebServicesURL:function(){return this.get3DSpaceUrl()+"resources/dsmfg/private/V0/MfgElement"},setXMLConfiguration:function(e,t){this._xmlCache={},this._xmlConfiguration=e,this._custoParamSetPID=t},fetchXMLValues:function(t,i,r){var a,o,c,l=this,u=e.is(this._custoParamSetPID,"string")&&this._custoParamSetPID.length>0,m=s.isCacheFullyOptimized(),S=u?m?"&custoParamSetPID="+this._custoParamSetPID:"&custoParamSetPID="+this._custoParamSetPID+"&v="+Date.now():"",d=function(r){n.debug(l.name,"WebserviceUtil._fetchXMLValues(), REQUEST: "+t),e.is(r)?(l._xmlCache[t]=r.fileContent,e.is(i)&&i(l._xmlCache[t]),n.debug(l.name,l._xmlCache[t])):n.debug(l.name,"configurationXML response data is undefined for requested  XML Key : "+t)},v=function(i){n.debug(l.name,"!!! WebserviceUtil._fetchXMLValues(), ERROR: "+t),n.debug(i),e.is(r)&&r(i)},h=function(e){u&&s.isCloud()?l.webServiceRequest({url:"dsmfg/private/V0/ApplicationConfiguration?frameworkName="+a[0]+"&fileName="+a[1]+".xml",method:"GET",serviceName:l._AppCloudServiceName,onComplete:d,onFailure:v}):v(e)};e.is(this._xmlConfiguration[t])?(a=this._xmlConfiguration[t],o=u?"dsmfg/private/V0/invoke/configurationXML":"dsmfg/private/V0/ApplicationConfiguration",c=s.isCloud()&&!u?l._AppCloudServiceName:l._3DSpaceServiceName,a=a.split("/"),e.is(a,"array")&&2===a.length?l.webServiceRequest({url:o+"?frameworkName="+a[0]+"&fileName="+a[1]+".xml"+S,method:"GET",serviceName:c,onComplete:d,onFailure:h}):h("xmlPath is not correctly defined in configurationXML  : "+t)):v("xmlKey is not defined in configurationXML  : "+t)},getXMLValues:function(t,i,r){var s,n={dataCache:[],convert:function(t,i){var r,s=t.split("."),n=this;if(!e.is(this.dataCache[i])){for(r=0;r<s.length;++r){if(!e.is(n[s[r]])){n=null;break}n=n[s[r]]}if(e.is(n))for("array"!==e.typeOf(n)&&(n=[n]),this.dataCache[i]={},r=0;r<n.length;++r)this.dataCache[i][n[r][i]]=n[r],delete this.dataCache[i][n[r][i]][i]}return this.dataCache[i]}};return e.is(this._xmlCache[t])?(s=e.merge(this._xmlCache[t],n),e.is(i,"function")&&i(e.clone(s))):e.is(r,"function")&&r("xmlKey is not defined in configurationXML  : "+t),e.clone(s)}})});