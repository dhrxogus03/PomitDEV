define("DS/ClassificationProp/UI/ClassifPropSkeleton",["UWA/Json","DS/ClassificationProp/UI/IDCardManager","DS/ClassificationProp/constants/ClassifPropConstants","DS/WidgetServices/WidgetServices","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n){"use strict";return t.extend({defaultOptions:{className:"",typeOfDisplay:i.ALL,setEditButton:!1,displayType:i.STANDARD},init:function(e,t){var n=this;t.typeOfDisplay=t.typeOfDisplay?t.typeOfDisplay:i.ALL,t.displayType=t.displayType?t.displayType:i.STANDARD,t.className=t.className?t.className:"",t.className+=" ClassificationAttMasterContain",t.className+=t.typeOfDisplay?" "+t.typeOfDisplay:"",t.name="ClassificationAttMasterContain",t.showIdCard=void 0!==t.showIdCard?t.showIdCard:t.typeOfDisplay!==i.ONLY_EDIT_PROPERTIES,t.showFacets=t.typeOfDisplay===i.ALL,t.showExpander=t.typeOfDisplay===i.ALL,t.closeButton=i.isCloseButton(t.displayType),t.defaultFacetName=t.defaultFacetName?t.defaultFacetName:"",t.infoForFacet=t.infoForFacet?t.infoForFacet:null,t.indexModeParameter=!!t.indexModeParameter&&t.indexModeParameter,t.idCardOptions={events:{thumbnailClick:function(){n._getFirstPropertiesModel().get("activeThumbnail")?(n.elements.postIdCard&&n.elements.postIdCard.maskThumbnail(),require(["DS/ImageManager/ImageManager","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests"],function(e,t){n.elements.postIdCard&&n.elements.postIdCard.unmaskThumbnail();var i=n._getFirstPropertiesModel(),s=i?i.get("objectId"):null;!s||n.elements.imageManager&&n.elements.imageManager.getModelId()===s||(n.elements.imageManager&&n.elements.imageManager.destroy(),n.elements.imageManager=new e({modelId:s,tenantId:t.getTenantFromModel(i),events:{onPrimaryChange:function(e){(i=n._getFirstPropertiesModel()).set("previewUrl",e?e.url:"");var t=i?i.get("objectId"):null;t&&n.dispatchEvent("onPrimaryChange",{id:t,image:e}),n._updateThumbnailForModel(i)}}})),n.elements.imageManager&&n.elements.imageManager.execute()})):n._isFacetAuthorized(i.FACET_VIEWS)&&n.selectFacet(i.FACET_VIEWS)}}},this._parent(e,t),this._sharedOptions.readOnly=!1!==t.readOnly,this.options.typeOfDisplay===i.ONLY_IDENTITY_CARD&&(this.options.setEditButton=!1),this.editMode=!0===t.editMode,this.options.typeOfDisplay===i.ALL&&(this.elements.containerError=this.elements.globalDiv),this.elements.mainError=UWA.createElement("div",{class:"EditProp_MainError"}).inject(this.elements.globalDiv).hide()},setReadonlyStatus:function(e){this._sharedOptions.readOnly=e,this.onRefresh()},setOccurrences:function(e){this.elements.imageManager&&(this.elements.imageManager.destroy(),delete this.elements.imageManager),this._parent(e)},_manageEvent:function(e){this._parent(e);var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);e.facet===i&&"switchMode"===e.eventID&&this.elements.postIdCard&&this._manageActionVisibility()},clearPanel:function(){this._parent(),this._getErrorManager(function(e){e.clearAllMessages()})},_getErrorManager:function(e){var t=this;this.errorOverlay?e.call(null,this.errorOverlay):require(["DS/ErrorWidget/ErrorWidget"],function(i){t.errorOverlay||(t.errorOverlay=new i(n.getWidgetObject(),t.elements.containerError,{className:"editProperties_errorManager"})),e.call(null,t.errorOverlay)})},_addNotif:function(e){var t=e.msg,i=e.eventID,n=e.customClass;switch(i){case"mainstaticerror":t=t||e.json,this.showMainErrorArea(t);break;case"error":t=t||e.json,this._addError(t,n);break;case"warning":this._addWarning(t,n);break;case"success":this._addSuccess(t,n);break;default:this._addInfo(t,n)}},_addInfo:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addInfo(e,t);i.dispatchEvent("onNotification",s)})},_addWarning:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addWarning(e,t);i.dispatchEvent("onNotification",s)})},_addSuccess:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addSuccess(e,t);i.dispatchEvent("onNotification",s)})},_addError:function(t,i){var n=this;this._getErrorManager(function(s){var a=t;if(null!=a&&("string"==typeof a||a instanceof String)&&a.includes("ErrorCode:1501009")){a={level:"error",title:UWA.i18n("InvalidCSCreationfailed"),subtitle:UWA.i18n("InvalidCSCreationFailedSubtitle"),message:UWA.i18n("NoAccessToCS")};var o=s.display(a)}else o=s.displayJSONError(e.encode(t),i);n.dispatchEvent("onNotification",o)})},hideMainErrorArea:function(){this.elements.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.elements.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.elements.mainError)},clearAllMainError:function(){this.elements.mainError.setContent("")},showMainComponent:function(){this._parent(),this.hideMainErrorArea()}})}),define("DS/ClassificationProp/ajaxRequests/MultipleAsynchronousRequests",[],function(){"use strict";return function(e,t){var i={},n=e.length,s=t;this.setAnswer=function(t,a){e.indexOf(t)>=0&&(void 0===i[t]&&n--,i[t]=a),n<=0&&null!==s&&s.call(this)},this.getAnswer=function(e){return i[e]}}}),define("DS/ClassificationProp/controllers/ClassifPropUIController",["UWA/Class"],function(e){"use strict";return e.extend({defaultOptions:{},init:function(e,t){this.allModels=[],this.editPropModelList=e,this._parent(t)},setModels:function(e){this.editPropModelList=e},getModels:function(){return this.editPropModelList},getModel:function(e){var t=null;return this.editPropModelList.every(function(i){var n=!0;return e==i.get("objectId")&&(t=i,n=!1),n}),t},getModifiedModels:function(){var e=[];return this.editPropModelList.forEach(function(t){if(!0!==t.get("isTransient")){var i=t.getChangedValues();Object.keys(i).length>0&&e.push(t)}}),e},getLabel:function(){var e="";return 1===this.editPropModelList.length&&(e=this.editPropModelList[0].get("label")),e}})}),define("DS/ClassificationProp/utils/AttributesUtils",["UWA/Array","DS/WidgetServices/WidgetServices","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i){"use strict";return{defaultOptions:{},validateModels:function(e){for(var t=null,i=e.length,n=0;n<i;n++){var s=e[n];t=this._validateAllAttributes(s)}return t},validateAttributes:function(e,t){var i=this,n=[],s=[];return t.forEach(function(t){if(t?t.name:null){!0!==t.get("error").server&&t.resetError();var n=t.valueDB,a=null;if(e.isMergedModel()){var o=Object.keys(n);o.length>0&&(a=o[0])}if(null!=a&&(n=n[a]),null!==(n=n||(!0===t.get("readOnly")?null:null!=a?t.value[a]:t.value))){var r=i.checkValueForAttribute(t,n,s);r&&r.message&&t.setError(r.message,r.type)}}}),s.length>0?s.forEach(function(e){var t={customClass:e.attrName&&e.attrName.length>0?"EP_Warning_"+e.attrName:"EP_Warning_Message",message:e.message,code:"ERROR",eventID:"warning"};n.push(t)}):n=null,n},checkValueForAttribute:function(n,s,a){var o=this,r=n?n.name:null,l={message:null,type:null};if(r&&!0!==n.get("readOnly")){var c=n.label;return c=c?c.toLowerCase():"",null!==s&&(Array.isArray(s)||(s=[s]),0==s.length&&!0===n.mandatory&&(l=o.addError(a,n,c,"MandatoryAttribute")),s.every(function(s){var r=null;if("function"==typeof n.validationFunction&&(r=n.validationFunction(n)),r&&((l=o.addError(a,n,n.label,r.message)).type=r.type),!0===n.mandatory){var u=s+"",d=new RegExp(" ","g");""===(u=u.replace(d,""))&&(l=o.addError(a,n,c,"MandatoryAttribute"))}if(n.maxlength>0&&s.length>n.maxlength&&(l=o.addErrorWithValue(a,n,c,n.maxlength,"MaxLengthAttribute")),"real"===n.type||"integer"===n.type){u=s;e.isArray(u)?u.forEach(function(e){isNaN(e)&&(l=o.addErrorWithValue(a,n,n.label,e,"NotaNumber"))}):isNaN(u)?l=o.addErrorWithValue(a,n,n.label,u,"NotaNumber"):"integer"===n.type&&u%1!=0&&(l=o.addErrorWithValue(a,n,n.label,u,"IntegerIsDecimal"))}if(""!==n.minval){var h=parseFloat(n.minval),f=n.value;if(e.isArray(f))f.forEach(function(e){var t=parseFloat(e);t<h&&(l=o.addErrorWithValue(a,n,n.label,e,"OutOfMinVal")),n.minvalincluded||t!==h||(l=o.addErrorWithValue(a,n,n.label,e,"OutOfMinVal"))});else(p=parseFloat(n.value))<h&&(l=o.addErrorWithValue(a,n,n.label,n.value,"OutOfMinVal")),n.minvalincluded||p!==h||(l=o.addErrorWithValue(a,n,n.label,n.value,"OutOfMinVal"))}if(""!==n.maxval){var p,m=parseFloat(n.maxval);f=n.value;if(e.isArray(f))f.forEach(function(e){var t=parseFloat(e);t>m&&(l=o.addErrorWithValue(a,n,n.label,e,"OutOfMaxVal")),n.maxvalincluded||t!==m||(l=o.addErrorWithValue(a,n,n.label,e,"OutOfMaxVal"))});else(p=parseFloat(n.value))>m&&(l=o.addErrorWithValue(a,n,n.label,n.value,"OutOfMaxVal")),n.maxvalincluded||p!==m||(l=o.addErrorWithValue(a,n,n.label,n.value,"OutOfMaxVal"))}var g=n.get("forbiddenChar");if(g){u=s;if(t.commonChar(u,g,!0)>0){var v=i.replace(i.get("ForbiddenCharacters"),{label:n.label,badChars:g});a.push({message:v,attrName:n.getIdentifier()}),l.message=v,l.type="error"}}return null===l.message})),l}},_validateAllAttributes:function(e){var t=e.values();return this.validateAttributes(e,t)},addErrorWithValue:function(e,t,n,s,a){i.get(a);var o=i.replace(i.get(a),{label:n,value:s});return e.push({message:o,attrName:t.getIdentifier()}),{message:o,type:"error"}},addError:function(e,t,n,s){i.get(s);var a=i.replace(i.get(s),{label:n});return e.push({message:a,attrName:t.getIdentifier()}),{message:a,type:"error"}}}}),define("DS/ClassificationProp/constants/ClassifPropConstants",[],function(){"use strict";return{ONLY_IDENTITY_CARD:"editProp_onlyIC",ONLY_EDIT_PROPERTIES:"editProp_onlyProperties",ALL:"editProp_all",ALL_SELECTION:"allSelection",RESTRICTED_SELECTION:"restrictSelection",NO_SELECTION:"noSelection",MVA_SEP:"|",POPUP:"editProp_popup",TRANSIENT:"editProp_transient",STANDARD:"editProp_standard",FORCE_READWRITE:"force_readWrite",FORCE_READONLY:"force_readonly",FORCE_DEFAULT:"force_default",NO_CHANGES:"no_changes",ACTION_REFRESH:"cw",FACET_NONE:"none",FACET_VIEWS:"views",FACET_PROPERTIES:"classificationAttiProp",FACET_SWYM_COMMUNITY_PROPERTIES:"swym_community_properties",FACET_SWYM_USER_PROPERTIES:"swym_user_properties",FACET_SWYM_SURVEY_PROPERTIES:"swym_survey_properties",FACET_SPECIFICATIONS:"Specifications",FACET_Variability:"Variability",FACET_EFFECTIVITY:"Effectivity",FACET_CHANGE:"Change",FACET_iCHANGE:"iChange",FACET_ALTERNATE:"Alternate",FACET_IPPROTECTION:"IPProtection",FACET_RICHCONTENT:"Rich Content Attr",FACET_DOCUMENTS:"documents",FACET_FILES:"Files",FACET_PROXY:"proxyFacet",FACET_ADMIN:"adminFacet",FACET_RELATIONS:"relations",FACET_DERIVEDOUTPUT:"derivedoutputs",FACET_REVISIONS:"revisions",FACET_SHARING:"sharing",FACET_PHYSICSSIMULATION:"physicssimulation",FACET_POSTERRORANALYSIS:"postErrorAnalysis",FACET_PC_CONTENT:"product_configuration_content",FACET_FL_SPECIFICATION:"catfl_specification_document",FACET_CLASSIFICATIONPROP:"classificaiton_prop",MODEL_INIT:"Classification_INIT",MODEL_FACET_INFO_PREFIX:"_DS_FACET_",MODEL_DS_ATTR:"_DS_ATTR_",METATYPE_BUS:"businessobject",METATYPE_REL:"relationship",METATYPE_PATH:"path",METATYPE_UNKNOWN:"unknown",MULTISEL_STD:"yes",MULTISEL_NO:"no",MULTISEL_MERGE:"merge",COLLAPSE_IC_PREFERENCE:{type:"hidden",name:"editProperty_collapseIC",label:"is IC collapse",defaultValue:"false"},TYPES:{INTEGER:"integer",REAL:"real",TIMESTAMP:"timestamp",PERSON:"person",BOOLEAN:"boolean",ENUM:"enum"},MIN_WIDTH_FOR_TABLE:200,WIDTH_SWITCH_MODE:150,VARIABLES:{minWidthForTable:200},ACCORDION:{ATTRIBUTES:"Attributes"},isCloseButton:function(e){return e!==this.STANDARD}}}),define("DS/ClassificationProp/utils/ClassifPropControl",["UWA/Controls/Abstract"],function(e){return e.singleton({_Context:null,_informationPanel:!1,_objectId:!1,_dataProvider:null,_ipClassifyAlertProvider:null,_classifPropController:null,_searchFilterforDefinition:null,_searchFilterforCategorization:null,getContext:function(){return this._Context},setContext:function(e){this._Context=e},getInformationPanel:function(){return this._informationPanel},setInformationPanel:function(e){this._informationPanel=e},getObjectId:function(){return this._objectId},setObjectId:function(e){this._objectId=e},getProvider:function(){return this._dataProvider},setProvider:function(e){this._dataProvider=e},getIPClassifyAlertProvider:function(){return this._ipClassifyAlertProvider},setIPClassifyAlertProvider:function(e){this._ipClassifyAlertProvider=e},getClassifPropController:function(e){return this._classifPropController},setClassifPropController:function(e){this._classifPropController=e},setSearchQueryFilter:function(e,t){this._searchFilterforDefinition=e,this._searchFilterforCategorization=t},getSearchQueryFilter:function(){return!0===this._searchFilterforDefinition&&1==this._searchFilterforCategorization?null:!0===this._searchFilterforDefinition?"Definition":!0===this._searchFilterforCategorization?"Standard":null}})}),define("DS/ClassificationProp/changeAction/passThruJS",[],function(){"use strict";return{onReady:function(e){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(t){var i={changeIsSetChecker:function(e){return e&&e.AuthoringContextHeader&&Object.keys(e.AuthoringContextHeader).length>0}},n=[],s=[];for(var a in t)"function"==typeof t[a]&&(n.push(t[a]),s.push(a));s.forEach(function(e,s){i[e]=function(i,a){if("init"!==e&&"constructor"!==e&&"initialize"!==e&&"undefined"==typeof enoviaServerAuthoringWidget)return console.log("Authoring context not initialized"),void("function"==typeof i?i({}):"function"==typeof a&&a({}));n[s].apply(t,arguments)}}),e.call(null,i)},function(){e.call(null,null)})}}}),define("DS/ClassificationProp/comm/CommManager",["UWA/Class"],function(e){"use strict";return e.extend({subscriptions:[],lCurrentListId:[],_nbOfCancelReceived:0,_statusReady:"ready",_statusRunning:"running",_commName:null,_currentStatus:null,_currentListenStatus:null,init:function(e){this._currentStatus=null,this._currentListenStatus=null,this.subscriptions=[],this.lCurrentListId=[],this._nbOfCancelReceived=0,e||(e="default"),this._commName=e},getCommObject:function(e){var t=window.top.EP_CommManager;return t||!0===e||(t=window.top.EP_CommManager={}),t},getCurrentComm:function(e){var t=this.getCommObject(e);return(t=t||{})[this._commName]||e||(t[this._commName]={callbacks:[]}),t[this._commName]},_removeCurrentComm:function(){this.getCommObject(!0)&&delete window.top.EP_CommManager[this._commName]},createRunningEvent:function(e){this.lCurrentListId=e,this._currentStatus={status:this._statusRunning,answer:this.lCurrentListId},this.getCurrentComm().status=this._currentStatus},createReadyEvent:function(e){this._currentStatus={status:this._statusReady,answer:e};var t=this.getCurrentComm();t.status=this._currentStatus,t.callbacks&&t.callbacks.length>0&&(t.callbacks.forEach(function(t){t.call(null,e)}),this._removeCurrentComm())},createListenEvent:function(e){var t=this.getCurrentComm(!0);t&&(t.status.status===this._statusReady?(e.call(null,t.status.answer),this._removeCurrentComm()):t.callbacks.push(e))},getCurrentListenStatus:function(){var e=this.getCurrentComm(!0),t=null;return e&&(t=e.status.status),t},destroy:function(){this._removeCurrentComm(),this._parent()}})}),define("DS/ClassificationProp/models/ClassifPropAttributeModel",[],function(){"use strict";return function(e){for(var t in this._identifier=null,this.isTransient=!1,this.name="",this.label="",this.select="",this.path="",this.value="",this.valueDB="",this.type="text",this.tw_type=null,this.authorizedValues=[],this.authorizedValuesNLS=[],this.authorizedValuesRequired=!0,this.dimension="",this.unitName=null,this.dimensionType=null,this.maxlength=-1,this.positionUI="0",this.positionIdentityCard=-1,this.sectionIdentityCard="",this.masked=!0,this.forbiddenChar=null,this.mandatory=!1,this.modified=!1,this.multiline=!1,this.multivalue=!1,this.multisel=!1,this.readOnly=!0,this.minval="",this.maxval="",this.minvalincluded=!1,this.maxvalincluded=!1,this.attributeID="",this.facet="",this.section="",this.extension="",this.group="Default",this.urlIcon=null,this.from=null,this.navType=null,this.relation=null,this.dbValues={value:"",valueDB:""},this.initialsValues={value:"",valueDB:""},this.error={message:null,type:"error"},this.validationFunction=function(){},e)this[t]=e[t];this.getIdentifier=function(){var e=this._identifier;return e||(e="",e+=this.facet?this.facet+"-":"",e+=this.path,this._identifier=e),e},this.set=function(e,t){void 0!==t&&(this[e]=t,"modified"!==e&&(this.modified=!0))},this.saveInitialValues=function(){for(var e in this.initialsValues)this.initialsValues[e]=UWA.clone(this[e]),this.dbValues[e]=UWA.clone(this[e])},this.resetError=function(){this.error={message:null,type:"error"}},this.setError=function(e,t,i){e&&(t||(t="error"),this.error={message:e,type:t,server:!0===i})},this.resetInitialValues=function(){for(var e in this.initialsValues)this[e]=UWA.clone(this.initialsValues[e])},this.get=function(e){return this[e]},this.isSameValueSet=function(e){var t=!0;if(t=!(null===e.value||null===this.value||null===e.valueDB||null===this.valueDB))if(this.multisel){for(var i in this.value)if(!(t=t&&this._isSameValueSet(e.value[i],this.value[i],e.valueDB[i],this.valueDB[i])))break}else t=this._isSameValueSet(e.value,this.value,e.valueDB,this.valueDB);return!t},this._isSameValueSet=function(e,t,i,n){var s=!0;if("boolean"===this.type)s=i===n||(i+"").toLowerCase()===(n+"").toLowerCase();else{var a=e.length;if(s=null==t||a===t.length){if("relation"!==this.type)for(var o=0;o<a&&(s=e[o]===t[o]);o++);if(s)for(s=(a=i.length)===(n?n.length:0),o=0;o<a&&(s=i[o]===n[o]);o++);}}return s},this.getChangedIds=function(){var e={};if(!0===this.multisel)for(var t in this.value){var i=this.value[t],n=this.valueDB[t],s=s&&this._isSameValueSet(this.initialsValues.value[t],i,this.initialsValues.valueDB[t],n);s||(e[t]={value:i,valueDB:n})}else e.a={value:this.value,valueDB:this.valueDB};return e},this.hasChanged=function(){return this.isSameValueSet(this.initialsValues)},this.applySort=!1}}),define("DS/ClassificationProp/comm/EventManager",["UWA/Class"],function(e){"use strict";var t=0;return e.singleton({init:function(){this._parent.apply(this,arguments),this._events={},this._queueStack=[]},publish:function(e){var i=this,n={index:++t},s=this._events[e];Array.prototype.shift.apply(arguments);var a=arguments;s&&s.forEach(function(e){i._queueStack.push({callback:e,context:n,args:a})});for(var o=null;o=this._queueStack.shift();)o.callback.apply(o.context,o.args)},subscribe:function(e,t){var i=this._events[e];i||(i=[],this._events[e]=i),i.push(t)},remove:function(e,t){var i=this._events[e];if(i){for(var n=-1;(n=i.indexOf(t))>=0;)i.splice(n,1);0==i.length&&delete this._events[e]}}})}),define("DS/ClassificationProp/models/ClassifPropModel",["UWA/Class/Model","UWA/Class/Debug","DS/WidgetServices/WidgetServices","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/constants/ClassifPropConstants","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s){"use strict";return e.extend(t,{METATYPE_BUS:s.METATYPE_BUS,METATYPE_REL:s.METATYPE_REL,METATYPE_PATH:s.METATYPE_PATH,changedValues:{},_locked:!1,_lockedAttributes:[],_initProperties:{},defaults:{metatype:s.METATYPE_UNKNOWN,source:"3DSpace",sourceName:"",tenant:i.getTenantID(),objectId:"",label:"",labelAttribute:"",type_icon_url:"",previewUrl:"",isTransient:!1,_changeId:"",instrefid:""},isMergedModel:function(){return!1},getOptions:function(){var e={};for(var t in this.defaults)e[t]=this.get(t);return e},lockModel:function(e){var t=this;this._locked=!0===e,this._locked||(this._lockedAttributes.forEach(function(e){var i=t.get(e);null!=i&&(i=new n(i),t.set(e,i))}),this._lockedAttributes=[])},isLocked:function(){return!0===this._locked},setFloatingAttribute:function(e,t,i){this.isLocked()?(this._attributes[e]=t,this._lockedAttributes.indexOf(e)<0&&this._lockedAttributes.push(e)):(!0!==i&&(t=new n(t)),this.set(e,t))},getComputedTitle:function(){return this.get("label")},setup:function(){for(var e in this._lockedAttributes=[],this._locked=!1,this.changedValues={},this._initProperties={},this.defaults)this._initProperties[e]=this.get(e)},getChangeId:function(){return this.get("_changeId")},getTenant:function(){return this.get("tenant")},saveInitialValues:function(e,t){var i=this,n=this.keys(),s=[];n.forEach(function(t){var n=i.get(t);null!==n&&"object"==typeof n&&"function"==typeof n.saveInitialValues&&(null==e||e.indexOf(t)>=0)&&(n.saveInitialValues(),s.push(t))}),!1!==t&&this._dispatchChangedAttributes(i,s,!1),this._clearChangedValue(e),this.modelSaved()},isTransientModel:function(){return this.get("isTransient")},getAttributeFromField:function(e,t,i){var n=this;i=i||0;var s=[];return this.keys().every(function(a){var o=n.get(a);return null!==o&&"object"==typeof o&&"function"==typeof o.get&&o.get(e)===t&&s.push(o),0===i||s.length<i}),1===i?s.length>0?s[0]:null:s},resetInitialValues:function(){var e=this;this.keys().forEach(function(t){var i=e.get(t);i&&"object"==typeof i&&"function"==typeof i.resetInitialValues&&(i.resetInitialValues(),e._dispatchChangedAttributes(e,[t],!0))}),this._clearChangedValue()},resetAllErrors:function(e){var t=this;this.keys().forEach(function(i){var n=t.get(i);n&&"object"==typeof n&&"function"==typeof n.resetError&&(n.resetError(),!1!==e&&t._dispatchChangedAttributes(t,[i],!0))})},clearChangedValue:function(e){this._clearChangedValue(e)},_clearChangedValue:function(e){var t=this;e?e.forEach(function(e){t._removeChangedValue(e)}):this.changedValues={}},removeChangedValue:function(e){this._removeChangedValue(e)},_removeChangedValue:function(e){this.changedValues[e]&&delete this.changedValues[e]},attributeHasChanged:function(e){return!!this.changedValues[e]},removeEvent:function(e,t){this.removeEvent2("onChange:"+e,t)},removeEvent2:function(e,t){var i=this._dispatchers[e];if(i)for(var n=i.bindings.length-1;n>=0;n--){i.bindings[n].listener===t&&i.bindings.splice(n,1)}},getChangedValues:function(){return this.changedValues},setChangedValues:function(e){"object"==typeof e&&(this.changedValues=e)},hasSameAttributesThan:function(e){var t=Object.keys(this._attributes),i=Object.keys(e._attributes),n=!1;return t.length===i.length&&(n=!0,t.every(function(e){return i.indexOf(e)<0&&(n=!1),n})),n},onChange:function(e){var t=this._getChangedAttributes(e);t.length>0&&this._dispatchChangedAttributes(e,t,!1)},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=[];for(var s in t){var a=t[s],o=!1;a instanceof n&&((o=a.hasChanged())?e.changedValues[s]=a:((o=void 0!==e.changedValues[s])&&delete e.changedValues[s],o=o||!this._previousAttributes[s]),o&&i.push(s))}return i},_dispatchChangedAttributes:function(e,t,i){var n=this,s=[];t.forEach(function(t){i&&n.dispatchEvent("onChange:"+t),s.push(e.get(t))}),this.dispatchEvent("onChangeAttributes",[e,s])},modelSaved:function(){this.dispatchEvent("onSave")},getAllAttributes:function(){return this._attributes}})}),define("DS/ClassificationProp/models/CommonAbstract",["DS/ClassificationProp/comm/EventManager","UWA/Controls/Abstract"],function(e,t){var i=0;return t.extend({_callbacks:{},init:function(e){i++,e&&!e.eventThread&&(e.eventThread="CT"+i),this._parent.apply(this,arguments),this._callbacks={}},publishEvt:function(t){var i=this._getEventThread(t);arguments[0]=i,e.publish.apply(e,arguments)},subscribeEvt:function(t,i,n){var s=this._getEventThread(t);arguments[0]=s,e.subscribe.apply(e,arguments),this._callbacks[s]=i},destroy:function(){for(var t in this._callbacks)e.remove(t,this._callbacks[t]);this._parent.apply(this,arguments)},_getEventThread:function(e){return(this.options.eventThread?this.options.eventThread+".":"")+e},_callMethodOnEach:function(e,t){var i=e,n=t;for(var s in Array.prototype.shift.apply(arguments),Array.prototype.shift.apply(arguments),i)i[s][n].apply(this,arguments)}})}),define("DS/ClassificationProp/constants/ConstantsMapping",["DS/ClassificationProp/constants/ClassifPropConstants","DS/WidgetServices/WidgetServices","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i){"use strict";var n={"3dspace":{name:"3DSpace",fedPrefix:"physicalid",require:"DS/ClassificationProp/ajaxRequests/3DSpaceAjaxRequests",identifire:"pid:",path:"/resources"},fedsearch:{name:"3DSearch",require:"DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests"}};return{getSupportedServices:function(){return n},getSupportedServicesArray:function(){var e=this.getSupportedServices(),t=[],i=[];for(var n in e){var s=e[n];!0!==s.modelRequired&&(s.isSource?t.push(s.id?s.id:n):i.push(s.name))}return{sources:t,services:i}},getServiceBySource:function(e){return n[e]},getServiceForModel:function(e){var t=null,i=null;if(e){if(i=e.get("_sourceId"),!(t=n[i])){var s=e.get("sourceName");s&&(i=s.toLowerCase(),t=n[i]),t||(s=e.get("source"))&&(i=s.toLowerCase(),t=n[i]),e.set("_sourceId",i)}null!=t&&(e.identifire=t.identifire?t.identifire:"",e.path=t.path?t.path:"")}return t},getMapping:function(t){var i={};return i[e.FACET_PROPERTIES]={alwaysCalled:!1,supportMerge:!0,require:"DS/ClassificationProp/facets/Properties/ClassifPropController",options:t,facet:{name:e.FACET_PROPERTIES,text:"classification attributes",icon:"attributes"}},i},getDefaultFacets:function(i,n){var s=this.getMapping(),a=[e.FACET_PROPERTIES],o=a,r=t.isWebInWinEnvironment();return!0!==r&&!0!==i&&!0!==n||(o=[],a.forEach(function(e){var t=!0,a=s[e];!0===i&&(t=!a||!0===a.supportMerge),t&&!0===r&&(t=!1!==a.webInWin),t&&(!0===n?o.push(a):o.push(e))})),o}}}),define("DS/ClassificationProp/comm/DistantAjax",["UWA/Class","DS/ClassificationProp/comm/CommManager","DS/WidgetServices/WidgetServices"],function(e,t,i){"use strict";return window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0,e.singleton({_isAsynchronous:!1,_valuesAsync:{},init:function(){this._isAsynchronous=!0===widget.getValue("asynchronousRequest")||"true"===widget.getValue("asynchronousRequest"),widget.setValue("asynchronousRequest","false"),this._valuesAsync={}},_getCommManager:function(e){e.call(this,t)},getAsyncRead:function(e){this._getAsync("read",e)},getAsyncFacetCheck:function(e){this._getAsync("facetCheck",e)},_getAsync:function(e,t){this._isAsynchronous?this._getCommManager(function(i){var n=new i(e);n.createListenEvent(function(e){t(e),n.destroy()}),setTimeout(function(){n.getCurrentListenStatus()||t(null)},100)}):t(null)},_distantCall:function(e,t,i,n){this._getCommManager(function(s){var a=new s(e),o=!1,r=++window.top.perfoIncrem;window.top.performance.mark("start_getAsync:"+r),this._getAsync(e,function(e){e&&window.top.performance.mark("end_getAsync:"+r),!1===o&&e&&e.discriminant===t&&(o=!0,i&&i(e?e.value:e))}),setTimeout(function(){!1===o&&(a.createRunningEvent(),n.call(this,function(e){!1===o&&(o=!0,a.createReadyEvent({value:e,discriminant:t}),i&&i(e))}))}),setTimeout(function(){a&&a.destroy()},12e4)})},getRoles:function(e,t){var n=this;this._distantCall("role",e,t,function(t){i.getGrantedRoles(function(e){t.call(n,e)},e)})},getServices:function(e,t){var n=this;this._distantCall("services",e,t,function(e){i.getServicesUrl({onComplete:function(t){e.call(n,t)}})})},launchMainRead:function(e,i){require(["DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests"],function(n,s){var a=new t("read");a.createRunningEvent(e),n.getListOfAttributes({modelList:e,tenant:s.getTenantFromModel(e&&e.length>0?e[0]:null),handleRequest:{},navigateToMain:!0,securityContext:i.securityContext,index_mode:i.index_mode,onComplete:function(e){a.createReadyEvent(e)}}),setTimeout(function(){a&&a.destroy()},12e4)})},launchFacetsVisibility:function(e,t,n,s,a){var o=this,r=["DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests"];void 0===this._valuesAsync.facetCheck&&(this._valuesAsync.facetCheck=this._isAsynchronous);var l=this._valuesAsync.facetCheck&&!s,c=!1,u=0;n.handleRequest=n.handleRequest?n.handleRequest:{},n.handleRequest&&(n.handleRequest.handle=i.getCancelObject());var d=n.handleRequest.handle;s?r.push("DS/ClassificationProp/comm/CommManager"):l&&(u=200,this.getAsyncFacetCheck(function(e){1==c||d.isCancelled()||e&&(c=!0,o._valuesAsync.facetCheck=!1,n.onComplete(e))})),require(r,function(i,s,r){setTimeout(function(){if(!0!==c&&!d.isCancelled()){var l=null;r&&((l=new r("facetCheck")).createRunningEvent(e),setTimeout(function(){l&&l.destroy()},12e4)),i.checkFacetsVisibility({handleRequest:n.handleRequest,context:n.context,tenant:s.getTenantFromModel(e),model:e,facets:t,sourceAppId:a,onComplete:function(e){l&&l.createReadyEvent(e),"function"==typeof n.onComplete&&!0!==c&&n.onComplete(e),c=!0,o._valuesAsync.facetCheck=!1}})}},u)})}})}),define("DS/ClassificationProp/facets/Properties/TweakerManager",["UWA/Core","UWA/Class","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/utils/ClassifPropControl","DS/ClassificationProp/models/ClassifPropModel","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r,l,c,u){var d={};d.DEFAULT={type:"DEFAULT",from:function(e){return e.valueDB},to:function(e){return{valueDB:e.value,value:e.displayValue?e.displayValue:e.value}},extraOptions:function(e,t){var i=t.authorizedValuesNLS,n=t.authorizedValues,s=t.authorizedValuesGroup,a=t.authorizedValuesIcon,r=t.customSelect,l=t.sortedOptions,c=!0===t.autocomplete,u=i.length;if(u>0){var h=!1,f=t.get("tw_type"),p=d[f];p&&p.from||(p=d.DEFAULT);for(var m=[],g=[],v=0;v<u;v++){var _=i[v],C=n[v],b={label:_,value:C,group:s?s[v]:null};if(a&&a[v]){var S="icons/16/"+a[v]+".png",E=o.getWebappsAssetUrl("ENOCollabSharingCmds",S);b.icon=E}g.push(b),h||i[v]!==n[v]?h=!0:(C=p.from({value:_,valueDB:C}),_=null,m.push({label:_,value:C}))}return{autocomplete:c,sortedOptions:l,customSelect:r,trueEnum:h,data:{list:h?g:m,range_required:t.authorizedValuesRequired}}}}},d[n.TYPES.BOOLEAN]={type:n.TYPES.BOOLEAN,from:function(e){return!0===e.valueDB||"string"==typeof e.valueDB&&"true"===e.valueDB.toLowerCase()}},d[n.TYPES.RELATION]={type:n.TYPES.RELATION,from:function(e){return{id:e.valueDB,label:e.value&&e.value.label?e.value.label:""}},to:function(e){return{valueDB:e.value?e.value.id:"",value:e.value?e.value:""}},extraOptions:function(e,t){return{data:{rules:t.get("rules")}}}},d[n.TYPES.PERSON]={type:n.TYPES.PERSON,from:function(e){return{personID:e.valueDB,fullName:e.value}},to:function(e){return{valueDB:e.value.personID,value:e.value.fullName}},extraOptions:function(e){return{data:{objectIDs:e.isMergedModel()?e.getMergedModelIds():[e.get("objectId")]}}},check:function(e,t){if(null===t)return{message:u.UnvalidAttribute,type:"error"}}},d[n.TYPES.DATE]={type:n.TYPES.DATE,from:function(e){return a.formatDateObj(e.valueDB)},to:function(e){return{valueDB:a.convertDateToStandard(e.value,!0).valueDB,value:e.displayValue}}},d[n.TYPES.DATETIME]=d[n.TYPES.DATE],d[n.TYPES.BOOLEAN_WUX]=d[n.TYPES.BOOLEAN],d[n.TYPES.DATE_WUX]=d[n.TYPES.DATE],d[n.TYPES.DATETIME_WUX]=d[n.TYPES.DATE],d[n.TYPES.PERSON_WUX]=d[n.TYPES.PERSON];var h=function(e){var t=d[e.get("tw_type")],i=null;if(t&&t.check){var n=e.get("valueDB");e.multisel&&(n=n[Object.keys(n)[0]]),Array.isArray(n)||(n=[n]),n.every(function(n){return null===(i=t.check(e,n))})}return i};return t.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this.elements={},this.elements.fields={},this._sharedOptions=t,this.onNotification=e.onNotification?e.onNotification:function(){},this.options=this.options?this.options:{},this._setEditable(e&&!0===e.editable)},isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},clear:function(){for(var e in this.elements.fields)this._removeField(e);this.elements.fields={}},actionOnScroll:function(){for(var e in this.elements.fields){var t=this.elements.fields[e];t.field&&"function"==typeof t.field.actionOnScroll&&t.field.actionOnScroll()}},getValidationFunction:function(e){var t=d[e];if(t&&t.check)return h},_getValueForTweaker:function(e,t){var i=e,n=d[i];n&&n.from||(n=d[i="DEFAULT"]);return t.multisel?this.__getValueFromMultiselForConvert(n,t):this.__getValueFromStandardForConvert(n,t)},__getValueFromStandardForConvert:function(e,t){var i=!0===t.multivalue,n=e.type,s=t.value,a=Array.isArray(s)?s:[s],o=s,r=a;"DEFAULT"===n&&t.readOnly||(o=t.valueDB,r=Array.isArray(o)?o:[o]);for(var l=a.length,c=[],u=0;u<l;u++){var d=e.from({value:a[u],valueDB:r[u]});c.push(d)}return i?c:l>0?c[0]:null},__getValueFromMultiselForConvert:function(e,t){var i=t.value,n=t.valueDB,s={};for(var a in i){var o={value:i[a],valueDB:n[a],multivalue:t.multivalue,readOnly:t.readOnly},r=this.__getValueFromStandardForConvert(e,o);s[a]=r}return s},__getValueFromStandardFromTweaker:function(e,t){var i=t.value,n=t.displayValue,s={},a={};if(Array.isArray(i)){s=[],a=[];for(var o=i.length,r=0;r<o;r++){var l=e.to({value:i[r],displayValue:n[r]});s.push(l.value),a.push(l.valueDB)}}else s=(l=e.to({value:i,displayValue:n})).value,a=l.valueDB;return{value:s,valueDB:a}},__getValueFromMultiselFromTweaker:function(e,t,i){var n=t.value,s=t.displayValue;for(var a in valueAttr={},valueDBAttr={},n){i&&i.multivalue&&(n[a]=Array.isArray(n[a])?n[a]:[n[a]],s[a]=Array.isArray(s[a])?s[a]:[s[a]]);var o=this.__getValueFromStandardFromTweaker(e,{value:n[a],displayValue:s[a]});valueAttr[a]=o.value,valueDBAttr[a]=o.valueDB}return{value:valueAttr,valueDB:valueDBAttr}},_getValueFromTweaker:function(e,t,i){var n=d[e];n&&n.to||(n=d.DEFAULT);i.multivalue;var s={value:t.getValue(),displayValue:t.getDisplayValues()};return!0===i.multisel?this.__getValueFromMultiselFromTweaker(n,s,i):this.__getValueFromStandardFromTweaker(n,s)},_generateOptions:function(e,t,i){var n={units:i.dimension,minValue:i.minval,maxValue:i.maxval,minValueIncluded:i.minvalincluded,maxValueIncluded:i.maxvalincluded,multiline:i.multiline,multisel:i.multisel,icon:i.urlIcon,parameter:!!i.attributeID,multivalued:i.multivalue,mandatory:i.mandatory,readOnly:i.readOnly,applySort:i.applySort,type:i.type};this.isReadOnly()&&(n.editable=!1),"prop"===t.facet&&(n.prop=!0);var s=d[e];if(s&&s.extraOptions||(s=d.DEFAULT),s&&s.extraOptions){var a=s.extraOptions(t,i);for(var o in a)n[o]=a[o]}return i.dropdownMode&&(n.dropdownMode=i.dropdownMode),n},_updateValue:function(e,t,i,n){if(e.isMergedModel()){var s=e.getMergingModels();for(var a in e.lockModel(!0),s)innerModel=s[a],this.__updateValue(innerModel,innerModel.get(t.getIdentifier()),i[a],n[a]);setTimeout(function(){e.lockModel(!1)})}else this.__updateValue(e,t,i,n)},__updateValue:function(e,t,i,n){var s=e.getChangedValues(),a=t.getIdentifier(),o=(t.value,t.valueDB),r=s[a];if(r)r.value,o=r.valueDB;var l=!1;if(!(l=(null==n||null==n?"":Array.isArray(n)?n.sort().toString():n)===(null==o||null==o?"":Array.isArray(o)?o.sort().toString():o))&&e.isMergedModel()){l=!0;var c=e.getMergingModels();for(var u in c)l=l&&c[u]===o[u]}l||this._modelChangeValue(e,e.get(a),i,n)},_modelChangeValue:function(t,i,n,a){var o=new s(e.clone(i));return o.set("value",n),o.set("valueDB",a),t.set(i.getIdentifier(),o),o.set("classUsage",i.classUsage),o},_getOrCreateField:function(e,t){var i=this.elements.fields[e];return i||t||(i=this.elements.fields[e]={}),i},_addEventToField:function(e,t,i){var n=this._getOrCreateField(t);n.events||(n.events=[]),n.events.push(i),n.model=e},_addTweakerToField:function(e,t){this._getOrCreateField(e).field=t},_removeField:function(e){var t=this.elements.fields[e];t.field&&("function"==typeof t.destroy?t.destroy():"function"==typeof t.field.destroy&&t.field.destroy()),t.events&&t.model&&t.events.forEach(function(i){t.model.removeEvent(e,i)}),delete this.elements.fields[e]},setError:function(e){},onNotification:function(e){},_manageOnChangeEvent:function(e,t,i,n){var s=function(){setTimeout(function(){i.elements.container?n.call():e.removeEvent(t,s)})};this._addEventToField(e,t,s),e.addEvent("onChange:"+t,s)},_setEditable:function(e){this.editable=e&&!this.isReadOnly()},underEdition:function(){return this.editable&&!this.isReadOnly()},switchMode:function(e){for(var t in this._setEditable(e),this.elements.fields){var i=this.elements.fields[t];i&&i.field&&i.field.switchMode(this.underEdition())}},getTweakerFromId:function(e){return this.elements.fields[e]},getTweaker:function(e,t,s,a,o){var u,d=this,h=e.get(t),f=this._generateOptions(s,e,h),p=0;(u=l.getInformationPanel())&&(p=1e3),(e.webUxTweakers||e.propertiesWidgetUI)&&!0===f.trueEnum?s=n.TYPES.ENUM_WUX:e.propertiesWidgetUI||e.webUxTweakers||!0!==f.trueEnum||(s=n.TYPES.ENUM);var m=this._getValueForTweaker(s,h);if(f.value=m,f.events={changes:d.debounce(function(){var i=e.get(t);if(i){var n=d._getValueFromTweaker(s,this,i);u&&e&&e.clearChangedValue();var a=n.value;if(Date.parse(n.value)&&"function"==typeof a.getMonth){var o=a.getUTCFullYear()+"/"+(parseInt(format(a.getUTCMonth()))+1)+"/"+format(a.getUTCDate())+"@"+format(a.getUTCHours())+":"+format(a.getUTCMinutes())+":"+format(a.getUTCSeconds())+":GMT";n.value=o}d._updateValue(e,i,n.value,n.valueDB)}if(!0===u){var h=new c({objectId:l.getObjectId()});r.publish("onInformationAttributeUpdate",{model:e,selection:h,informationPanelContext:l.getContext(),ObjectId:l.getObjectId(),informationPanelContext:l.getContext()})}},p,!1),notification:function(e){d.onNotification(e)}},a)for(var g in a)f[g]=a[g];i.getTweaker(s,f,function(i){d._addTweakerToField(t,i),d._manageOnChangeEvent(e,t,i,function(){var n=e.get(t),a=d._getValueForTweaker(s,n);i.setValue(a),d._sharedOptions.editMode&&r.publish("onAttributeUpdate",n)}),i.switchMode(d.underEdition()),o.call(this,i)})},_debounceTimeouts:[],debounce:function(e,t,i){var n,s=this;return function(){var a=this,o=arguments,r=i&&!n;clearTimeout(n);var l=s._debounceTimeouts.indexOf(n);-1!==l&&s._debounceTimeouts.splice(l,1),n=setTimeout(function(){n=null,i||e.apply(a,o)},t),s._debounceTimeouts.push(n),r&&e.apply(a,o)}}})}),define("DS/ClassificationProp/models/ClassifPropModelMerge",["DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropAttributeModel","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i){return e.extend({_innerModels:{},setup:function(){this._parent(),this._innerModels={}},getMergingModels:function(){return this._innerModels},getMergedModelIds:function(){var e=this.getMergingModels();return Object.keys(e)},setMergingModels:function(e){var t=this;if(this._innerModels)for(var i in this._innerModels){(n=this._innerModels[i])._callbackMerge&&n.removeEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}for(var i in this._innerModels=e,this._innerModels){var n;(n=this._innerModels[i])._callbackMerge=n._callbackMerge?n._callbackMerge:{},n._callbackMerge[t.get("objectId")]=function(e,i){var n=e.get("objectId");i.forEach(function(e){var i=e.getIdentifier(),s=t.get(i);s&&(s.get("value")[n]=e.get("value"),s.get("valueDB")[n]=e.get("valueDB"),t.setFloatingAttribute(i,s))})},n.addEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}},isMergedModel:function(){return!0},set:function(e,i){i instanceof t&&i.set("multisel",!0),this._parent(e,i)},getComputedTitle:function(){var e=this.getMergedModelIds().length;return newLabel=i.replace(i.get("{0} objects selected"),{0:e}),newLabel},resetAllErrors:function(){var e=this;this.lockModel(!0);var t=this.getMergingModels();for(var i in t)t[i].resetAllErrors();setTimeout(function(){e.lockModel(!1)}),e._parent(!1)},clearChangedValue:function(e){var t=this;this.lockModel(!0);var i=this.getMergingModels();for(var n in i);setTimeout(function(){t.lockModel(!1)})},resetInitialValues:function(){this._parent.apply(this,arguments);var e=this.getMergingModels();for(var t in e){var i=e[t];i.resetInitialValues.apply(i,arguments)}},getChangedValues:function(){var e={},t=this.getMergingModels();for(var i in t){var n=t[i];if(n){var s=n.getChangedValues();if(s)for(var a in s){var o=this.get(a);o&&(e[a]=o)}}}return e},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=e.getChangedValues(),n=[];for(var s in t)null!==i[s]&&n.push(s);return n}})}),define("DS/ClassificationProp/utils/ClassifPropUtils",["DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/constants/ClassifPropConstants","DS/WidgetServices/WidgetServices","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/constants/ClassifPropConstants","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a){"use strict";var o=a.get("accordion_parameters"),r=function(e,t,i){var s=[];if(t){t.forEach(function(t,a){var r=function(e,t,i){var s=new n,a=null;i&&t.extension&&(a=i[t.extension]),a=a||{};var r=1;s.set("multisel",e.isMergedModel()),s.set("name",t.name),s.set("label",t.name+" (NLS not defined)"),s.set("path",t.selectable),s.set("select",t.selectable),s.set("select",t.select),s.set("classUsage",i[t.extension].classUsage),s.set("type",t.type),t.speType&&s.set("type",t.speType),s.set("multiline",null!=t.multiline&&!1!==t.multiline);var l=null!=t.multivalue&&!1!==t.multivalue;s.set("multivalue",l);var c=t.value,u=t.valueDB;if(e.isMergedModel()||(c={r:c},u&&(u={r:u})),c)for(var d in c){var h=c[d],f=u?u[d]:f;!1===l?(h=null===h?"":h,f=null===f?"":f,Array.isArray(h)&&(h=h.length>0?h[0]:"",f&&(f=f.length>0?f[0]:"")),h=void 0===h?"":h):""!==h&&null!=h||(h=[],f=[]),c[d]=h,u&&(u[d]=f)}else if(e.isMergedModel()){var p=e.getMergingModels();for(var m in c={},u={},p){var g=p[m],v=!1===l?"":[];c[g.get("objectId")]=v,u[g.get("objectId")]=v}}e.isMergedModel()||(c=c.r,u&&(u=u.r)),t.range&&("string"==typeof t.range&&(t.range=t.range.split(",")),s.set("authorizedValues",t.range)),t.rangeNLS&&("string"==typeof t.rangeNLS&&(t.rangeNLS=t.rangeNLS.split(",")),s.set("authorizedValuesNLS",t.rangeNLS)),void 0!==t.range_required&&s.set("authorizedValuesRequired",!0===t.range_required);var _=!0;t.readOnly||"owner"!==t.selectable||(_=!1),"No"!==t.readOnly&&!1!==t.readOnly||(_=!1),s.set("readOnly",_),s.set("value",c),u?s.set("valueDB",u):s.set("valueDB",c),s.set("mandatory","Yes"===t.mandatory||!0===t.mandatory),s.set("label",t.nls),s.set("path",t.path),s.set("dimension",t.dimension),s.set("unitName",t.unitName),s.set("dimensionType",t.dimensionType),s.set("maxlength",t.maxlength),s.set("forbiddenChar",t.forbiddenChar),t.minval&&(s.set("minval",t.minval),t.minvalincluded&&s.set("minvalincluded",t.minvalincluded)),t.maxval&&(s.set("maxval",t.maxval),t.maxvalincluded&&s.set("maxvalincluded",t.maxvalincluded)),t.attrID&&(s.set("attributeID",t.attrID),s.set("facet",o),s.set("section",o)),t.facet?(s.set("facet",t.facet),s.set("section",t.facet)):a.name&&!0!==a.deploymentExtension&&(s.set("facet",a.name),s.set("section",a.nameNLS?a.nameNLS:a.name)),t.facetName&&s.set("section",t.facetName),t.extension&&s.set("extension",t.extension),void 0!==t.from&&s.set("from",t.from),t.relation&&s.set("relation",t.relation),t.rules&&s.set("rules",t.rules),t.applysort&&s.set("applySort",t.applysort);var C=t.UIPosition,b=(r=1,1);a.deploymentExtension&&!0!==t.maskedByType&&(r=2),C||0===C||(b=2,C=0,s.set("masked",!1));var S=r+"-"+b+"-"+C;return s.set("positionUI",S),t.group&&"Default"!==t.group&&(s.set("group",t.group),s.set("groupNLS",t.groupNLS),s.set("groupWeight",t.groupWeight)),s.saveInitialValues(),s}(e,t,i),l=r.get("positionUI");l+="-"+a,r.set("positionUI",l),s.push(r)})}return s};return{getModelFromSelectedNode:function(n){var s,a=null;null!=(s=!(s=n&&"function"==typeof n.getInstID?n.getInstID():null)&&n&&"function"==typeof n.getRelationID?n.getRelationID():s)&&Array.isArray(s)&&(s=s.length>0?s[0]:null);var o=!!s,r=o?"relationship":"businessobject";if((s=(s=s||n.getID())||n.id)===n.plmType)return null;var l=!o&&n.metatype?n.metatype:r,c=n.source?n.source:null,u=n.tenant?n.tenant:null,d=!o&&n.type?n.type:null;if(null===d&&!o&&n.options&&n.options.type&&(d=n.options.type),s){var h={metatype:l,objectId:s};(u=u||i.getTenantID())&&(h.tenant=u),c&&(h.source=c),d&&(h.type=d,h[t.MODEL_DS_ATTR+"type"]=d),a=new e(h)}return a},getModelFromPath:function(i,n,s){var a=i.length,o=1==a||(s||a%2==0),r=o?a-1:a-2,l=i[r],c=n?n[l]:null,u="";n&&!o&&(c=n[u=i[r+1]]);var d={objectId:l,metatype:m=s||!o?"relationship":"businessobject"};if(c){var h=c.source?c.source:null,f=c.type?c.type:null,p=c.tenant?c.tenant:null,m=o&&c.metatype?c.metatype:m;p&&(d.tenant=p),h&&(d.source=h),f&&(d[t.MODEL_DS_ATTR+"type"]=f),m&&(d.metatype=m),u&&(d.selReferenceID=u)}return new e(d)},getPreviewUrl:function(e){var t=e.preview_url;return t||""},fillFromServer:function(e,t,a){var o={modifyAccess:!0,success:!1,allAttributeAreRO:!0,plmparams:!1};if(!1!==e.success){o.success=!0,o.modifyAccess=!1!==e.modifyAccess;var l=this.getPreviewUrl(e),c=e.type_icon_url||"",u=function(e){var t=e.type_icon_large_url;return t||""}(e);c===u&&(u="");var d=t.getChangedValues(),h={};l&&(h.previewUrl=l),u&&(h.type_icon_url=u),c&&(h.type_small_icon=c),e.thumbnailsRW&&(h.activeThumbnail=!0),o.allAttributeAreRO=function(e,t,n){var s=!0;n||(n={});var a=["owner","modified","branch.owner","branch.modified"];(i.getWidgetValue("index_mode")||"Federated"===t.source)&&(a=["ds6w:responsible","ds6w:modified"]);var o=n.type_small_icon;return r(e,t.data,t.extensions).forEach(function(t,i){s=s&&!0===t.get("readOnly"),"ds6w:type"===t.name&&t.set("urlIcon",o);var r=0,l=a.indexOf(t.name);t.get("positionUI")&&(r=t.get("positionUI")),!e.isMergedModel()&&l>=0&&(0===l||2===l?t.set("sectionIdentityCard","ownerName"):1===l||3===l?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",l)),t.set("positionUI",r),n[t.getIdentifier()]=t}),s}(t,e,h);var f=function(e){var t={},i=e.computed;if(i&&i.label){var n=i.label;if(n.value&&"object"==typeof n.value)for(var s in n.value){var a=n.value[s];n.value[s]=Array.isArray(a)&&a.length>0?a[0]:a}t.label=n.value,n.path&&(t.attributeId=n.path),!n.path&&n.name&&(t.attributeId=n.name)}return t}(e),p=f.label;p||(t.isMergedModel()?(p={},t.getMergedModelIds().forEach(function(e){p[e]=""})):p=""),p&&(h.label=Array.isArray(p)?p[0]:p),f.attributeId&&h[f.attributeId]?(h.labelAttribute=f.attributeId,h[f.attributeId].set("sectionIdentityCard","title"),t.addEvent("onChange:"+f.attributeId,function(){var e=t.get(f.attributeId);e&&t.set("label",e.valueDB)})):h[s.MODEL_DS_ATTR+"label"]=new n({sectionIdentityCard:"title",value:p,valueDB:p,multisel:t.isMergedModel(),isTransient:!0,path:s.MODEL_DS_ATTR+"label"});var m={};for(var g in d)h[g]||(m[g]=d[g]);e.type&&(h.type?h.type.set("valueDB",e.type):h.type=e.type);var v=t.getAllAttributes();for(var g in v){var _=v[g];"object"==typeof _&&_ instanceof n&&!_.isTransient&&(a.initTable||_.attributeID)&&delete v[g]}if(t.set(h),t&&t.isMergedModel()){var C=t.getMergingModels();for(var b in C){var S=C[b];S.clearChangedValue();var E=UWA.clone(h);for(var g in h){var y=h[g];if(y instanceof n){var A=new n(E[g]);A.set("value",y.get("value")[b]),A.set("valueDB",y.get("valueDB")[b]),A.set("multisel",!1),A.saveInitialValues(),E[g]=A}}S.set(E),S.setChangedValues(m)}}t.clearChangedValue(),t.setChangedValues(m),function(e){!e.get("type")||"true"!==i.getWidgetValue("admin")||"CATProduct"!==e.get("type").value&&"CATPart"!==e.get("type").value||e.get("project")&&e.get("project").set("readOnly",!1)}(t),o.plmparams=!0===function(e){var t=e.PLMParametersAvailable;return t=t||!1}(e)}return o}}}),define("DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests",["DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ClassificationProp/ajaxRequests/MultipleAsynchronousRequests","DS/WAFData/WAFData","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s){"use strict";return{createRequest:function(e,t,i,n){var s=this;e&&!1===e.withChange?s._createRequestWithAuthoringContext(e,t,i,n):require(["DS/ClassificationProp/changeAction/passThruJS"],function(a){a.onReady(function(a){s._createRequestWithAuthoringContext(e,t,i,n,a)})})},_createRequestWithAuthoringContext:function(s,a,o,r,l){var c=this;if(s.handleRequest){if(s.handleRequest.handle&&"function"==typeof s.handleRequest.handle.isCancelled&&s.handleRequest.handle.isCancelled())return}else s.handleRequest={};var u=["A"];e.isChangeAvailable()&&l&&u.push("B"),!0===s.withSC&&u.push("C");var d=new i(u,function(){var t=this.getAnswer("A"),i=this.getAnswer("B"),l=this.getAnswer("C");l=l||s.securityContext;var u=t+o,d={Accept:"application/json","content-type":"application/json"};if(d["Accept-Language"]=e.getLanguage(),i){var h="silent"===s.withChange&&"object"==typeof r;for(var f in i)h?void 0===r[f]&&(r[f]=i[f]):d[f]=i[f]}l&&(d.SecurityContext=encodeURIComponent(l));var p=s.contentType?s.contentType:"json";if(s.headers)for(var f in s.headers)d[f]=s.headers[f];var m={type:p,method:a,timeout:36e5,proxy:"passport",headers:d,cache:-1,onComplete:function(e){s.onCompleteWS(e,s)},onFailure:function(e,t,i){c._onFailure(e,t,i,s)},onTimeout:function(e){c._onTimeout(s)}};e.getWidgetValue("isStandalone")||(m.authentication="passport"),r&&(m.data="json"!==p?r:UWA.Json.encode(r)),s.handleRequest.handle=n.handleRequest(c._formatUrl(s.model,u),m)});s.handleRequest.handle=e.getSourceUrlAsync({platformId:this.getTenantFromModel(s.model),source:s.source?s.source:this.getSourceFromModel(s.model),onComplete:function(e){d.setAnswer("A",e)}}),!0===s.withSC&&t.getInstance({tenant:this.getTenantFromModel(s.model)}).getSecurityContext({onSuccess:function(e){d.setAnswer("C",e.SecurityContext)},onFailure:function(e){console.log(" -- >> Can't get the security context"),d.setAnswer("C",null)}}),e.isChangeAvailable()&&l&&l.get2(function(e){var t=null;l.changeIsSetChecker(e)&&(t=e.AuthoringContextHeader),e.errorMessage&&console.log("Change : "+e.errorMessage),d.setAnswer("B",t)})},getTenantFromModel:function(t){var i=t?t.get("tenant"):null;return i=i||e.getTenantID()},getSourceFromModel:function(e){return e?e.get("source"):null},_formatUrl:function(e,t){var i=this.getTenantFromModel(e);return this._formatUrl2(i,t)},_formatUrl2:function(e,t){if(e){var i=t.indexOf("?");i<0&&(t+="?"),i>0&&i<t.length-1&&(t+="&"),t=t+="tenant="+e}return t},getExtraValues:function(e,t){var i={},n=[];return e.forEach(function(e){i[e]=!0}),t.forEach(function(e){i[e]||n.push(e)}),n},_createJSONModifiedAttribute:function(e){var t,i=[],n=["physicalid","modified"],s={},a=new Map,o=new Map,r=e.getChangedValues(),l={};for(var c in r){var u=e.get(c),d=u.facet;if(t=u.classUsage,"object"==typeof u&&!u.isTransient){var h=u.attributeID;if(null!=h&&h.length>0)this._addPLMParameterQuery(u,i);else{var f=u.getChangedIds();for(var p in f){var m=f[p];if("a"===p&&(p=e.get("objectId")),!a.has(d)){var g=[];g=[].concat(n),a.set(d,new Array)}if(g.push(u.select),a.set(d,g),"Definition"==t){var v=l[d];v||(v=[],l[d]=v)}else{var _=l[d];_||(_=[],l[d]=_)}var C=m.valueDB;!1!==C&&null==C&&(C=m.value);var b=null;Array.isArray(C)||"string"==typeof C||(b=C.toString()),null===b&&(b=C);var S=null;S={op:"replace",path:u.path,value:b},d&&(S.facet=d);var E=u.get("unitName");E&&(S.unitName=E,S.dimensionType=u.get("dimensionType")),S&&"Definition"==t&&(v.push(S),o.has("Definition")||o.set("Definition",new Map),o.get("Definition").set(d,v)),S&&"Standard"==t&&(_.push(S),o.has("Standard")||o.set("Standard",new Map),o.get("Standard").set(d,_))}}}}var y=e.get("metatype"),A="model/";A+="businessobject"==y||"bus"==y?"bus/":"EBOM"==y?"EBOM/":"rel/";var I=[];if(o){var M=o.get("Definition"),T=o.get("Standard");M&&P(M,"Definition"),T&&P(T,"Standard")}function P(t,i){t&&t.forEach(function(t,n){let o=n;var r=e.get("objectId"),l={path:A+r,method:"POST",body:t,classUsage:i,classId:o},c=a.get(n);c&&(s={select:[...c]},l.queryParams=s),I.push(l)})}return{requests:I,plmParametersRequests:i}},_addPLMParameterQuery:function(e,t){var i=e.valueDB;!1===i||i||(i=e.value);var n=[],s=[],a={},o=null;if(Array.isArray(i)||"string"==typeof i||(o=i.toString()),null===o&&(o=i),n.push(e.name),s.push({op:"replace",path:e.path,value:o}),null!=n){var r={select:n};a.queryParams=r}a.body=s;var l="plmparameter/"+e.attributeID;a.path="model/"+l;a.method="PATCH",t.push(a)},_concatRequestListComposite:function(e,t){t.forEach(function(t,i){var n=!1;e.every(function(i,s){return t.path!=i.path||t.method!=i.method||(e[s].body=e[s].body.concat(t.body),e[s].queryParams.select=e[s].queryParams.select.concat(t.queryParams.select),n=!0,!1)}),!1===n&&e.push(t)})},securityContextDispatcher:function(e,i){var n=this;if(e.securityContext)i.call(this,e);else{var s=t.getInstance({tenant:e.tenant}).getSecurityContext({context:e.context,onSuccess:function(t){e.securityContext=t.SecurityContext,i.call(n,e)},onFailure:function(t){n._onFailure(null,{error:t},null,e)}});e.handleRequest&&s&&(e.handleRequest.handle=s);//!!handle IR-635449-3DEXPERIENCER2018x                
}},_onCompleteAttributes:function(e,t){t.onComplete.call(null,e)},_onCompleteCommit:function(e,t){t.onComplete.call(null,e)},_onFailure:function(e,t,i,n){var a={};if(null!=t&&t.hasOwnProperty("error")&&"EDITPROP_ERROR_0001"===t.error)a={message:s.get("UpdateFailedDueToFrozenModelConnected"),code:"ERROR"},this._raiseError(a,n);else if(null!=t&&t.hasOwnProperty("error")&&"ErrorCode:1500572"===t.error)UWA.i18n("InvalidCSCreationfailed"),UWA.i18n("InvalidCSCreationFailedSubtitle"),UWA.i18n("NoAccessToCS");else if(null!=t&&t.hasOwnProperty("error")&&"INF102"===t.error.code)UWA.i18n("NoaccesstoApptitle"),UWA.i18n("NoaccesstoAppDesc");else a=null!=t&&t.hasOwnProperty("error")?t.error:{message:s.get("Error Server"),code:"ERROR"},this._raiseError(a,n)},_raiseError:function(e,t){"object"!=typeof e&&(e={message:e}),t.onComplete.call(null,{success:!1,error:e})},_onTimeout:function(e){var t={message:s.get("ErrorTimeOut"),code:"TO"};this._raiseError(t,e)}}}),define("DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests",["DS/WidgetServices/WidgetServices","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/ClassificationProp/utils/ClassifPropUtils","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r){"use strict";var l={},c={},u={},d=function(e,t,i){var n=e[t];n?(!0==!n.multivalue&&(n.value=[n.value],n.valueDB=[n.valueDB],n.multivalue=!0),n.value.push(i.value),n.valueDB.push(i.valueDB)):e[t]=i};return{getPreviewUrl:function(e){if(!e.ids&&e.modelList){var t=this;e.ids=[],e.modelList.forEach(function(i){var n=t.getIdFromModel(i);n&&e.ids.push(n)})}this._getPreviewUrl(e)},_getPreviewUrl:function(i){var n=this,s=i.ids,o=s.length;o&&(i.handleRequest.handle=e.get3DSearchUrlAsync({platformId:i.tenant,onComplete:function(r){var l=r+"/search",c=e.getLanguage(),u="",d="";s.forEach(function(e){u+=d+e,d=" OR "});var h={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!1,nresults:o,locale:c,query:u,tenant:i.tenant,start:0,select_file:["icon","thumbnail_2d"]},f="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();h.label=f;var p={Accept:"application/json","content-type":"application/json"};p["Accept-Language"]=e.getLanguage();var m={type:"json",method:"POST",timeout:24e4,data:UWA.Json.encode(h),proxy:"passport",headers:p,cache:-1,onComplete:function(e){n.onCompletePreview(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(m.authentication="passport"),i.handleRequest.handle=a.handleRequest(t._formatUrl2(i.tenant,l),m)}}))},onCompletePreview:function(e,t){var i=[];e&&e.results&&e.results.forEach(function(e){var t=null,n=null,s=!0;e.attributes&&e.attributes.every(function(e){return"resourceid"===e.name&&(t=e.value),"preview_url"===e.name&&(n=e.value),s=!(null!=t&&null!=n)}),s||i.push({id:t,preview:n})}),t.onComplete(i)},checkFacetsVisibility:function(e){var t={};t[i.FACET_PROPERTIES]=!0,e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getSourceId:function(e){var t=e.get("sourceName");t=t||e.get("source");var i="",s=n.getSupportedServices()[t.toLowerCase()];return s&&s.fedPrefix&&(i=s.fedPrefix),i},fillModel:function(e,t){var i=e.onComplete;return e.onComplete=function(e){e&&e.results&&e.results.length>0&&s.fillFromServer(e.results[0],t,{}),i.apply(this,[t])},e.modelList=[t],this.getListOfAttributes(e)},getIdFromModel:function(e){var t=this.getSourceId(e),i=e.get("objectId");return i=i||"",t&&0!==i.indexOf(t)?t+':"'+i+'"':i},_getModelType:function(e){var t,i=e.get("ds6w:type");t="string"==typeof i?i:i?i.get("valueDB"):"";var n=e.get("source");t||"3DSwym"!==n||0==e.get("objectId").indexOf("iam")&&(t="pno:Person");return t},getListOfAttributes:function(i){var n=i.modelList;i.securityContext;if(n.length){var s=n[0],a=s.get("objectId"),o="";if(a){o="/search";var r=[];s.get("indexSource")?r.push(s.get("indexSource")):s.get("sourceName")&&r.push(s.get("sourceName")),i.model=s,i.idModel=a,i.onCompleteWS=this._onCompleteFederated.bind(this);var l=e.getLanguage(),c=e.getCancelObject();this.getMask({"ds6w:type":{valueDB:this._getModelType(s)}},function(e){var n=[];e.Write.attributes.forEach(function(e){var t=e.name;n.push(t)});var a=this.getIdFromModel(s),u={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!0,with_nls:!1,locale:l,query:a,tenant:t.getTenantFromModel(s),source:r,select_predicate:i.select_predicates?i.select_predicates:n,start:0,select_file:["icon","thumbnail_2d"]},d="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();u.label=d,i.source="3DSearch",c.handler=t.createRequest(i,"POST",o,u)});return c}}},getElementsNls:function(t,i){t&&t.length>0?o.getResourcesInfo(t.join(","),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2018x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},getValuesNls:function(t,i){t?(o.getNlsOfPropertiesValues(JSON.stringify(t),{tenantId:i.tenant,serviceName:i.service,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}}),o.getPropertiesForClass(JSON.stringify(t),{tenantId:i.tenant,serviceName:i.service,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}})):i.onComplete.call(this,null)},_callMask:function(e,t,i){var n=this;u[e]?i.call(n,u[e]):require([t],function(t){(t=JSON.parse(t))[e]?u[e]=t[e]:u[e]=t,i.call(n,u[e])},function(t){require(["text!DS/ClassificationProp/assets/masks/Federated/default.json"],function(t){(t=JSON.parse(t))[e]?u[e]=t[e]:u[e]=t,i.call(n,u[e])})})},getMask:function(e,t){var i=e["ds6w:type"];if(i&&"pno:Person"===i.valueDB)this._callMask("Person","text!DS/ClassificationProp/assets/masks/3DSwym/Person.json",t);else{var n=i.valueDB;if(null!=n&&""!=n){var s=n.split(":")[1];if(null!=s&&null!=s&&""!=s){var a="text!DS/ClassificationProp/assets/masks/Federated/"+(s+".json");this._callMask(i&&i.valueDB,a,t)}else this._callMask("Default","text!DS/ClassificationProp/assets/masks/Federated/default.json",t)}else this._callMask("Default","text!DS/ClassificationProp/assets/masks/Federated/default.json",t)}},_onCompleteFederated:function(i,n){var s=this,a=i.results,o={source:"Federated"},u=[],h={};if(o.data=u,a&&a.length>0){var f={},p={},m={},g={},v=null,_=null,C=a[0],b={};for(var S in C.attributes.forEach(function(t){var i=t.name,n=i,s=t.value;s=void 0===s?"":s;var a="ds6w_facet"===t.format,r=a;if(a){var u=i.split("/");n=u[u.length-1]}if(a=a||"attribute"===t.format){v=!0===r?g:p,_=!0===r?m:f;var C=t.type,S=!1;if("date"===C){var E=Date.parse(s),y=new Date(E);y&&(s=(s=e.convertDateToStandard(y,!0)).valueDB,"ds6w:modified"!==n&&"ds6w:created"!==n||(C="datetime"))}else S="STRING"===C.toUpperCase();0===s.indexOf(n)&&(s=s.replace(n+".",""));var A=void 0!==t.dispValue,I=A?t.dispValue:s;if(S&&!A){var M=c[n];I=s;var T=M?M[s]:null;if(T)I=T;else{var P=b[n];P||(P=[],b[n]=P),P.push(s)}}var D={name:n,selectable:n,path:i,type:C,value:I,valueDB:s,readOnly:!0,nls:n};"ds6w:label"===n&&(h=D);var w=l[n];w?(D.nls=w.nlsName,d(v,n,D)):d(_,n,D)}else"resourceid"===n?o.physicalID=s:o[i]=s}),m)f[S]||(f[S]=m[S]);for(var S in g)p[S]||(p[S]=g[S]);n.idModel&&(o.physicalID=n.idModel),o.computed={label:h};var E=Object.keys(f),y=new Promise(function(e){s.getElementsNls(E,{tenant:t.getTenantFromModel(n.model),onComplete:function(t){e(t)}})}),A=new Promise(function(e){s.getValuesNls(b,{tenant:t.getTenantFromModel(n.model),service:n.model.get("sourceName"),onComplete:function(t){e(t)}})});Promise.all([y,A]).then(function(e){var i=e[0],a=e[1];if(i)if(!1!==i.success){var r=i||{};r.vocabularyElementNLSInfo&&r.vocabularyElementNLSInfo.forEach(function(e){var t=f[e.uri];"Predicate"===e.type?l[e.uri]=e:c[e.uri]=e,t&&e.nlsName&&(t.nls=e.nlsName,p[e.uri]=t)})}else t._raiseError(i.error?i.error.message:"Error",n);for(var d in a){var h=p[d];if(h){var m=a[d];if(h.multivalue){var g=[];h.value.forEach(function(e){var t=m[e];g.push(t||e)}),h.value=g}else h.value=m[h.value]?m[h.value]:h.value}}s.getMask(p,function(e){e.Write.attributes.forEach(function(e){var t=e.name,i=p[t];i&&u.push(i)}),n.onComplete.call(null,{results:[o]})})})}else t._raiseError(r.get("FedAjax_NotFound"),n)}}}),define("DS/ClassificationProp/ICard/IdCard",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Mask","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServices/WidgetServices","DS/ClassificationProp/facets/Properties/TweakerManager","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/models/ClassifPropAttributeModel","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r,l,c,u){return e.extend({init:function(e){this._parent.apply(this,arguments),this._showThumbnailsCondition={},this._currentModel=null,this._titleAttr=null,this.elements.container=UWA.createElement("div",{class:"idCardContainer"}),this.elements.thumbnail=UWA.createElement("div",{class:"thumbnail"}),this.elements.attrContainer=UWA.createElement("div",{class:"attributes"}),this.elements.thumbnail.inject(this.elements.container),this.elements.attrContainer.inject(this.elements.container),this.elements.headerContainer=UWA.createElement("div",{class:"header-section"}),this.elements.titleContainer=UWA.createElement("div",{class:"title-section"}),this.elements.title=UWA.createElement("div",{class:"title"}),this.elements.revision=UWA.createElement("div",{class:"revision"}),this.elements.multititles=UWA.createElement("div",{class:"multititles"}),this.elements.title.inject(this.elements.titleContainer),this.elements.revision.inject(this.elements.titleContainer),this.elements.multititles.inject(this.elements.titleContainer),this.elements.detailsContainer=UWA.createElement("div",{class:"details-section"}),this.elements.headerContainer.inject(this.elements.attrContainer),this.elements.detailsContainer.inject(this.elements.attrContainer),this.elements.owner=UWA.createElement("span",{class:"owner"}),this.elements.date=UWA.createElement("span",{class:"lastModified text-muted"}),this.elements.owner.inject(this.elements.detailsContainer),this.elements.date.inject(this.elements.detailsContainer),this.tweakerManager=new r({},{readOnly:!1}),this._handlerThumbnailClick=function(){this.dispatchEvent("thumbnailClick")}.bind(this);var t=this,i=[{icon:"expand-up",text:u.get("hideIDCard"),method:"show"},{icon:"expand-down",text:u.get("showIDCard"),method:"hide"}],n=o.getWidgetValue(l.COLLAPSE_IC_PREFERENCE.name),s=0===n||1===n?n:0;this.defaultAction={name:"actionHide",text:i[s].text,icon:i[s].icon,handler:function(){var e=i[s=s?0:1];t.defaultAction.text=i[s].text,t.defaultAction.icon=i[s].icon,o.setWidgetValue(l.COLLAPSE_IC_PREFERENCE.name,s),t._updateFromExpandButton(e)}},this.setActions(e.actions);e=i[s];this._updateFromExpandButton(e)},_updateFromExpandButton:function(e){this.showThumbnail("collapse","show"===e.method),this.elements.detailsContainer[e.method](),this.elements.multititles[e.method]()},setActions:function(e){},fillFromModel:function(e){this.clearValues();var t=e.getAllAttributes();if(t)for(var i in t){var n=t[i];n instanceof c&&this.setValueForSection(e,n)}if(!e.get("labelAttribute")){var s=e.get(l.MODEL_DS_ATTR+"label");s&&this.setValueForSection(e,s)}},clearValues:function(){this.elements.container&&(this.elements.owner.empty(),this.elements.date.empty(),this.elements.title.empty(),this.elements.multititles.empty(),this.elements.revision.empty())},onResize:function(){this._manageThumbnailDisplay(),this._computeTitle()},maskThumbnail:function(){var e=this.getThumbnailElement();e&&n.mask(e)},unmaskThumbnail:function(){var e=this.getThumbnailElement();e&&n.unmask(e)},changeThumbnail:function(e,t){this.elements.thumbnail.setStyle("background-image","url("+e+")");var i=this.getThumbnailElement();i&&(this.showThumbnail("url",!!e),!0===t&&i.addClassName("clickable"),i.removeEvent("click",this._handlerThumbnailClick),i.addEvent("click",this._handlerThumbnailClick))},showThumbnail:function(e,t){this._showThumbnailsCondition[e]!==t&&(this._showThumbnailsCondition[e]=t,this.__manageThumbnailDisplay())},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize();showThumbnails=e.width>=350,this.showThumbnail("width",showThumbnails)},__manageThumbnailDisplay:function(){var e=!0;for(var t in this._showThumbnailsCondition)if(!(e=this._showThumbnailsCondition[t]))break;e?this.elements.container.removeClassName("noThumbnail"):this.elements.container.addClassName("noThumbnail")},getThumbnailElement:function(){return this.elements.thumbnail},injectValue:function(e,t,i,n){this.elements[i]&&this._injectValue(e,t,this.elements[i],n)},_injectValue:function(e,t,i,n){var a={readOnly:!0,value:e,postBuild:!1};if(n)for(var o in n)a[o]=n[o];i.empty(),s.getTweaker(t,a,function(e){i.empty(),e.inject(i),n&&n.callback&&n.callback()})},addRevision:function(){if(this.elements.title){var e=this.elements.title.getElementsByClassName("tw_ROValue_content");e&&e.length>0&&this.elements.revision.inject(e[0])}},_computeTitle:function(e){if(this._currentModel){var t=this,i=this._currentModel.getComputedTitle(),n=e;e||(n=this._currentModel.get(this._titleAttr)),n&&(this._titleAttr=n.getIdentifier(),i||(i=n.get("value")));var s=!!(this.elements.container.getSize().width>380);s?this.elements.container.removeClassName("smallSize"):this.elements.container.addClassName("smallSize");var o=this.elements.attrContainer.getSize().width/4,r=i.length>o,l=s,c=s;this.injectValue(i,a.TYPES.STRING,"title",{postBuild:r,maxCharacters:o,multiline:l,forHTML:c,callback:function(){t.addRevision()}})}},setValueForSection:function(e,t){var i=t.get("sectionIdentityCard"),n=!!i;if(n){this._currentModel=e;var s="title"===i;if(s&&(this._computeTitle(t),!0===e.isMergedModel()?this.elements.title.addClassName("EP_MergedTitle"):this.elements.title.removeClassName("EP_MergedTitle")),!0!==e.isMergedModel()){if(s){var r=e.get("revision");r&&this.injectValue(" "+r.get("value"),a.TYPES.STRING,"revision")}else if("ownerName"===i)this.injectValue(t.get("value")+" ",a.TYPES.STRING,"owner");else if("date"===i){var l=t.get("value");l=l||t.get("valueDB"),computedDate=o.formatDateObj(l),this._injectValue(computedDate,a.TYPES.DATETIME,this.elements.date)}}else this.injectValue(t.get("value"),a.TYPES.STRING,"multititles",{multisel:!0})}return n}})}),define("DS/ClassificationProp/facets/Properties/ClassifPropBase",["UWA/Class","DS/UIKIT/Tooltip","DS/WidgetServicesUI/helpers/Constants","DS/ClassificationProp/facets/Properties/TweakerManager"],function(e,t,i,n){"use strict";return e.extend({lTooltip:[],elements:{},_sharedOptions:null,init:function(e,t){var i=this;this._sharedOptions=t||{},this._parent(e),this.tweakerManager=new n({editable:!0===e.editMode,onNotification:function(e){i._manageError(e)}},t)},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},switchTweakersStatus:function(e){this.tweakerManager.switchMode(e)},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},_valueIsChanging:function(e,t){},setError:function(e){},_manageError:function(e,t){}})}),define("DS/ClassificationProp/models/OccurrenceModel",["UWA/Class/Model","DS/ClassificationProp/models/ClassifPropModel","UWA/Class/Debug"],function(e,t,i){"use strict";return e.extend(i,{defaults:{isMerging:!1,modelPrefix:"00"},isMergedOccurrence:function(){return!0===this.get("isMerging")},getMergePrefixe:function(){return this.get("modelPrefix")},getAllModels:function(e,i){var n=this._attributes,s=!0===e?[]:{};for(var a in n)if(n[a].model instanceof t&&(!0===e?s.push(n[a].model):s[a]=n[a].model,!0===i))break;return s},_getModelElement:function(e){var t=this.get(e);return t||(t={model:null,options:null}),t},setOptions:function(e,t){var i=this._getModelElement();i.options=t,this.set(e,i)},getOptions:function(e){var t=this.get(e);return t?t.options:null},setModel:function(e,t){var i=this._getModelElement();i.model=t,this.set(e,i)},getModel:function(e){var t=this.get(e);return t?t.model:null}})}),define("DS/ClassificationProp/ajaxRequests/3DSpaceAjaxRequests",["DS/WidgetServices/WidgetServices","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests","DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests","DS/ClassificationProp/constants/ClassifPropConstants","DS/WAFData/WAFData"],function(e,t,i,n,s){"use strict";return{commitModels:function(e){var i=e.modelList,n=(e.securityContext,[]),s=!1;i.forEach(function(e,i){var a=t._createJSONModifiedAttribute(e);s=s||a.requests.length>0,n=n.concat(a.requests);var o=a.plmParametersRequests;o.length>0&&t._concatRequestListComposite(n,o)});var a=i.length>0?i[0]:null,o={requests:n};s&&null!=a&&a.isMergedModel()&&(o.transactionid=a.get("objectId")),e.model=a,e.onCompleteWS=t._onCompleteCommit,o&&0!=o.requests.length&&t.createRequest(e,"POST","/resources/IPClassificationReuse/classifiedItem/attributes/update",o)},getPreviewUrl:function(e){var t=e.modelList,n=(t.length,[]),s="";t.forEach(function(e){var t=e.get("objectId");s=s||e.get("tenant"),t&&n.push("physicalid:"+e.get("objectId"))}),n.length>0&&(e.ids=n,e.tenant=s,i.getPreviewUrl(e))},getHistory:function(e){t.securityContextDispatcher(e,this._getHistory)},_getHistory:function(i){var n=i.modelList,a=i.nbResult,o=i.lastDate,r=i.securityContext;i.handleRequest||(i.handleRequest={}),a=a||20;if(n.length){var l="",c="";n.forEach(function(e){var t=e.get("objectId");l+=c+"id="+t,c="&"});var u=n.length>0?n[0]:null;i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(u),source:t.getSourceFromModel(u),onComplete:function(c){var u="",d="";u="passport",d=c+"/resources/v1/collabServices/attributes/op/history",d+="?"+l,d+="&nbResults="+a,o&&(d+="&lastDate="+o);var h={Accept:"application/json","content-type":"application/json"};h["Accept-Language"]=e.getLanguage(),r&&(h.SecurityContext=encodeURIComponent(r));var f={type:"json",method:"GET",timeout:36e5,proxy:u,headers:h,cache:-1,onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(f.authentication="passport");var p=n.length>0?n[0]:null;i.handleRequest.handle=s.handleRequest(t._formatUrl(p,d),f)}})}},checkFacetsVisibility:function(e){t.securityContextDispatcher(e,this._checkFacetsVisibility)},_checkFacetsVisibility:function(i){var n=i.model,a=n.get("objectId"),o=i.facets,r=i.sourceAppId,l=i.securityContext;i.handleRequest||(i.handleRequest={});var c={id:a,facets:o,sourceAppId:r};n.isMergedModel()&&(c.ids=n.getMergedModelIds());i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(n),source:t.getSourceFromModel(n),onComplete:function(a){var o="",r="";o="passport",r=a+"/resources/v1/collabServices/attributes/op/facets/available";var u={Accept:"application/json","content-type":"application/json"};u["Accept-Language"]=e.getLanguage(),l&&(u.SecurityContext=encodeURIComponent(l));var d={type:"json",method:"POST",timeout:36e5,proxy:o,headers:u,data:UWA.Json.encode(c),onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(d.authentication="passport"),i.handleRequest.handle=s.handleRequest(t._formatUrl(n,r),d)}})},getClassificationAttributes:function(e){var i=e;if(!UWA.is(i,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes");var n="/resources/IPClassificationReuse/class/"+e.modelList[0]._attributes.objectId+"/getclassificationattributes";e.onCompleteWS=t._onCompleteAttributes,t.createRequest(e,"GET",n)},getListOfAttributes:function(i){var s=i.modelList,a=!0===i.navigateToMain?"true":"false",o=(i.securityContext,e.getWidgetValue("index_mode")),r=s.length,l=!1,c=!1;if(r){for(var u=[],d=[],h=[],f=(M=s[0]).get("objectId"),p=0;p<r;p++){var m=s[p],g={a:m};for(var v in c=c||m.isMergedModel(),m.isMergedModel()&&(g=m.getMergingModels()),g){var _=g[v],C=_.get("metatype"),b=_.get("objectId"),S=_.get("instrefid");l=l||"EBOM"==C,o||C!=n.METATYPE_BUS&&"bus"!=C?o||C!=n.METATYPE_REL?u.push(b):("undefined"!==S&&""!==S&&d.length===h.length&&h.push(S),d.push(b)):h.push(b)}}var E="";E="/resources/v1/proto/attributes/op/read",!1!==l||o?o&&(E="/resources/v1/collabServices/attributes/op/readIndex"):E="/resources/v1/collabServices/attributes/op/read";var y=e.isDebug(),A=e.getWidgetValue("debug_properties")||y?"true":null,I=null;o?I={lIds:u,indexattributes:"true",debug_properties:A||""}:(I={lIds:u,relIDs:d,busIDs:h,plmparameters:i.plmParams?"true":"false",attributes:!1!==i.attributes?"true":"false",navigateToMain:a,readonly:!0===i.readonly?"true":"false",debug_properties:A||""},c&&(I.format="merge"),c&&(I.transactionid=f));var M=s.length>0?s[0]:null;i.model=M,i.withSC=!0,i.withChange="silent",i.onCompleteWS=t._onCompleteAttributes,t.createRequest(i,"POST",E,I)}}}}),define("DS/ClassificationProp/facets/Common/ClassifFacetsCore",["DS/ClassificationProp/models/CommonAbstract"],function(e){return e.extend({_sharedContext:null,destroyComponent:function(){},onResize:function(){},updateFacet:function(){},getButtons:function(){},onAction:function(e){},onSave:function(){},getExtensions:function(){},nothingToSave:function(){return!0},isActionAvailable:function(e){return!0},init:function(e){this._parent(e),this.elements||(this.elements={})},getTabId:function(){return this.options.tabId?this.options.tabId:""},onRefresh:function(){this.updateFacet()},getContext:function(){return this._sharedContext},switchSaveButton:function(e){this._raiseEvent("switchSave",e)},switchAddButton:function(e){this._raiseEvent("switchAdd",e)},refreshActions:function(){this._raiseEvent("updateActions")},updateReadWriteAccess:function(e){this._raiseEvent("updateRWA",e)},_raiseNotification:function(e,t,i){t=t||"error",this.dispatchEvent("onNotification",{msg:e,eventID:t,customClass:i})},_raiseEvent:function(e,t){e&&this.dispatchEvent("onEvent",{facet:this.getTabId(),eventID:e,value:t})},inject:function(e){var t=this.getUI();t&&(t.hide(),t.inject(e))},show:function(){return this.__callMethodOnUI("show")},hide:function(){return this.__callMethodOnUI("hide")},getOptimalSize:function(){return this.__callMethodOnUI("getSize")},__callMethodOnUI:function(e){var t=this._getUI(),i=t[e];return"function"!=typeof i&&(i=(t=this._getDOMUI())[e]),t?i.call(t):null},getUI:function(){return this._getUI()},_getDOMUI:function(){for(var e=this._getUI();"function"==typeof e.getContent;)e=e.getContent();return e},_getUI:function(){return this.elements?this.elements.container:null},showLoader:function(){this._raiseEvent("switchLoader",!0)},hideLoader:function(){this._raiseEvent("switchLoader",!1)},display:function(e){this.setContext(e),this.show()},setContext:function(e){this._sharedContext!==e&&(this._sharedContext=e,this.updateFacet())}})}),define("DS/ClassificationProp/controllers/ClassifPropMainController",["UWA/Class/Model","DS/ClassificationProp/models/OccurrenceModel","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropModelMerge","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/utils/ClassifPropUtils","DS/ClassificationProp/UI/ClassifPropSkeleton","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices"],function(e,t,i,n,s,a,o,r,l,c,u){"use strict";return UWA.Class.extend({skeleton:null,defaultOptions:{selectionType:r.ALL_SELECTION,displayType:r.STANDARD,context:null,odtUpTransient:!1},init:function(e){var t=this;for(var i in this._parent(e),this._selectionIsStopped=!1,this._currentNewSelection=null,this.options=this.options?this.options:{},this.defaultOptions)this.options[i]=e[i];u.getInstance({context:this.options.context});var n=e.events.onCancel;e.events.onCancel=function(e){t._unsubscribeSelect(),t.skeleton.clearPanel(),t.skeleton.setOccurrences([]),t.skeleton.notifyClose,t.skeleton.notifyClose(),n&&n.call(t,e)},this._setup(e),e.selectionType!==r.NO_SELECTION&&(this._commandProxy=null,require(["DS/WidgetServices/commandProxy/CommandProxy"],function(e){var i=!1,n=0,s=function(e,s){if(e.paths&&0===e.paths.length||e.pathsInst&&0===e.pathsInst.length)i=!1,setTimeout(function(){!1===i&&t._onSelectionChange(e,s)},500);else{i=!0;var a=++n;setTimeout(function(){a===n&&t._onSelectionChange(e,s)},50)}},a={events:{onSelect:s}};t.options.displayType!==r.TRANSIENT&&!0!==t.options.odtUpTransient||(a.events.onUpdateTransient=function(e){e.models;var i=e.options;i&&i.securityContext&&u.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i.securityContext}}}}).getSecurityContext(),t._commandProxy.subscribe({onSelect:s})}),t._commandProxy=e.create(a)}))},getTopBar:function(){return this.skeleton.getTopBar()},_unsubscribeSelect:function(){this._commandProxy&&this._commandProxy.unsubscribe(this._commandProxy.choices.SELECT)},setModels:function(e,t,i,n,s){var a=this;null!=i&&""!==i?(this.skeleton.defaultFacetName=i,this.skeleton.selectFacet(i)):this.skeleton.defaultFacetName=null,null!=n&&""!==n&&(this.skeleton.infoForFacet=n);var o=!!this._currentNewSelection;this._currentNewSelection={models:e,change:t},o||this.skeleton.checkChangeAuthorized(function(e){var t=a._currentNewSelection;a._currentNewSelection=null,!0===e&&a._setModels(t.models,t.change)},!0)},_setModels:function(a,o){window.top.performance.mark("start_setModelController");var l=(g=a&&a.length>0?a[0]:null)?g instanceof e?g.get("tenant"):g.tenant:null;g&&l&&c.setWidgetValue("x3dPlatformId",l);var u=this,d=a.length,h=[];if(d){var f={},p={},m=null;a.forEach(function(n,o){if("function"!=typeof n.isMergedModel||!0!==n.isMergedModel()){var l=a[o],c=null;n instanceof e?(u._getModel(l.get("objectId"))||l.clearChangedValue(),c=l.getChangedValues()):(l=new i(n),a[o]=l),u._getModel(l.get("objectId"))||(u.editPropModelList=[l],l.clearChangedValue()),l.keys().forEach(function(e){var t=l.get(e),i=t instanceof s;if(!i&&t&&"object"==typeof t&&"EditProp_listOfChange"!==e&&"label"!==e&&(t=new s(t),i=!0,l.set(e,t)),i&&!0===l.isTransientModel()){var n=t.getIdentifier();if(n){var a=p[n];if(a){var o=t.get("value"),r=t.get("valueDB"),c=a.get("value"),u=a.get("valueDB");c[l.get("objectId")]=o,u[l.get("objectId")]=r,"title"===a.get("sectionIdentityCard")&&(m.value[l.get("objectId")]=o,m.valueDB[l.get("objectId")]=r),a.__nbValues++}else{o=(a=new s(UWA.clone(t))).get("value"),r=a.get("valueDB"),u={};(c={})[l.get("objectId")]=o,u[l.get("objectId")]=r,a.set("multisel",!0),a.set("value",c),a.set("valueDB",u),a.__nbValues=1,"title"===a.get("sectionIdentityCard")&&((m={value:{},valueDB:{}}).value[l.get("objectId")]=o,m.valueDB[l.get("objectId")]=r),p[n]=a}}}});var d=l.get("EditProp_listOfChange");d&&(l.setChangedValues(d),l.unset("EditProp_listOfChange")),c&&l.setChangedValues(c);var g=l;if(!f[g.get("objectId")]){f[g.get("objectId")]=g;var v=new t;v.setModel(r.MODEL_INIT,g),h.push(v)}}});var g,v=Object.keys(f).length;if(v>1)if(null!=(g=h[0].getModel(r.MODEL_INIT))){var _=UWA.clone(g.getOptions());for(var C in p){p[C].__nbValues===v&&(_[C]=p[C])}null!=m&&(_[r.MODEL_DS_ATTR+"label"]=new s({sectionIdentityCard:"title",value:m.value,valueDB:m.valueDB,isTransient:!0,multisel:!0,path:r.MODEL_DS_ATTR+"label"}));var b=(b=c.getWidgetPreference("transactionId"))&&b.value?b.value:u._generateMergeID(),S=new t({modelPrefix:b,isMerging:!0});_.objectId=b,u.mergeModel=new n(_),u.mergeModel.setMergingModels(f),S.setModel(r.MODEL_INIT,u.mergeModel),h.unshift(S)}else console.log("First model not found in occurrence")}window.top.performance.mark("end_setModelController"),this.skeleton.setOccurrences(h)},_generateMergeID:function(){return c.generateUniqueId()},_getModel:function(e){return this.skeleton.getModel(e)},getModels:function(){return this.skeleton.getModels()},getTitle:function(){return this.skeleton.getTitle()},getOptimalSize:function(){return this.skeleton.getOptimalSize()},getUI:function(){return this.skeleton},onRefresh:function(){var e=this.getModels();this.setModels([],void 0),this.setModels(e,void 0)},_getFacet:function(e,t){var i=t;if("string"==typeof t)i=e[t];else if("object"==typeof t&&t.id){var n=e[t.id];if(n){for(var s in t)n[s]=t[s];i=n}}return i},addFacets:function(e){if(e){var t=this,i=[],n=this.mapFacet?this.mapFacet:l.getMapping();e.forEach(function(e){i.push(t._getFacet(n,e))});var s=this.getUI();s&&s.addFacets(i)}},_setup:function(e){var t=this,i=l.getMapping(e);t.mapFacet=i;var n=l.getDefaultFacets();e.facets&&(n=e.facets,delete e.facets);var s=[],a=!1;n.forEach(function(n){var o=t._getFacet(i,n);o&&(!a&&o.facet&&o.facet.name===r.FACET_PROPERTIES&&(a=!0),(!0!==o.blockFromSearch||!e||"searchInformationProperties"!==e.className&&"searchPreviewProperties"!==e.className)&&(o.facet&&o.facet.name!==r.FACET_GENERALHISTORY||(e.displayType===r.TRANSIENT||e.displayType===r.POPUP)&&o.facet&&o.facet.name===r.FACET_GENERALHISTORY)&&s.push(o))}),a||(i[r.FACET_PROPERTIES].visible=!1,s.push(i[r.FACET_PROPERTIES])),this.skeleton=new o(s,e)},destroyComponent:function(){this._commandProxy&&(this._commandProxy.unsubscribe("onUpdateTransient"),this._commandProxy.unsubscribe("onSelect"))},onResize:function(){this.getUI().onResize()},_raiseNotif:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:t})},stopSelection:function(e){this._selectionIsStopped=!0===e},_onSelectionChange:function(e,t){if(!(this.options.selectionType===r.NO_SELECTION||!0===this._selectionIsStopped||t&&t.metadata&&t.metadata.originWidgetId===c.getWidgetId()&&"ENORIPE_Relations"===t.metadata.origin)){var i=e.pathsInst,n=!!i,s=(i=i&&i.length>0?i:e.paths).length,o=e.defaultFacetName,l=e.infoForFacet,u=e.attributes,d=this.getModels(),h=[];d.forEach(function(e){h.push(e.get("objectId"))});if(this.options.selectionType!==r.RESTRICTED_SELECTION||t.metadata&&t.metadata.originWidgetId===c.getWidgetId()){for(var f=[],p=0;p<s;p++){var m=i[p];if(m){var g=a.getModelFromPath(m,u,n);!g.get("tenant")&&e.tenant&&g.set("tenant",e.tenant),f.push(g)}}var v=null;c.isChangeAvailable()&&(v=UWA.clone(e.changeControl)),this.setModels(f,v||null,o,l)}}},changeAttributes:function(e){this.skeleton.changeAttributes(e)}})}),define("DS/ClassificationProp/ClassifPropWidget",["UWA/Core","UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/controllers/ClassifPropMainController"],function(e,t,i,n,s){"use strict";return t.extend({defaultOptions:{},_getController:function(e){return this.controller?this.controller:new s(e)},init:function(e,t){t&&i.setWidgetObject(t);var s={};for(var a in e)s[a]=e[a];s.propertiesWidgetUI=!0,null!==s.securityContextFromAppPreference&&void 0!==s.securityContextFromAppPreference||(s.context&&"function"==typeof s.context.getSecurityContext&&s.context.getSecurityContext()&&s.context.getSecurityContext().SecurityContext?s.securityContextFromAppPreference=s.context.getSecurityContext().SecurityContext:s.securityContextFromAppPreference=null),s.sourceAppId||(s.sourceAppId=s.appId);var o=this;this._parent(s),this.elements||(this.elements={}),s.events||(s.events={}),s.events.onInnerCancel=function(){o.destroyComponent()},this.controller=this._getController(s),this.elements.UI=this.controller.getUI(),this.elements.container=this.elements.UI,this.elements.container.getContent().addEvent("resize",function(){o.onInnerResize()}),(i.isReplayedODT()||!0===i.getWidgetObject().getValue("proto"))&&(this._handlerSwitch=function(e){this.setReadonlyStatus(e)}.bind(this),n.subscribe("switchMode",this._handlerSwitch))},initDatas:function(e,t,i,n){this.controller.setModels(e,void 0,t,i,n)},initData:function(e,t,i){this.initDatas(e,t,i)},changeAttributes:function(e){this.controller.changeAttributes(e)},show:function(e){this.elements.popup&&(this.elements.popup.show(),this.initDatas(e))},centerIt:function(e){this.elements.popup&&this.elements.popup.centerIt()},onRefresh:function(){this.controller.onRefresh()},onResize:function(){},onInnerResize:function(){this.elements.popup?this.elements.popup.onResize():this.elements.UI&&this.elements.UI.onResize()},setReadonlyStatus:function(e){this.elements.UI.setReadonlyStatus(e)},selectFacet:function(e){this.elements.UI.selectFacet(e)},removeFacets:function(e){this.elements.UI.removeFacets(e)},stopSelection:function(e){this.controller.stopSelection(e)},addFacets:function(e){this.controller.addFacets(e)},getTitle:function(){return this.elements.UI.getTitle()},getIdentityCardUI:function(){return this.elements.UI.getIdentityCardUI()},getMainTable:function(e){return this.elements.UI.getMainTable()},getListModel:function(){return this.controller.getModels()},destroyComponent:function(){this._handlerSwitch&&n.remove("switchMode",this._handlerSwitch),this.controller.destroyComponent(),this.elements.popup?this.elements.popup.destroyComponent():this.elements.UI.destroyComponent()},getAccordeonFormSection:function(){return this.editPropertiesUI.elements.formSection}})}),define("DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests",["DS/ClassificationProp/ajaxRequests/3DSpaceAjaxRequests","DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests","DS/ClassificationProp/constants/ConstantsMapping","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n){"use strict";var s={checkFacetsVisibility:"_getDefaultFacetsVisibility"},a=i.getSupportedServices(),o=a["3dspace"];o&&(o.service=e);var r=a.fedsearch;return o&&(r.service=t),{_getAjaxService:function(e,t,s){var a=null;i.getSupportedServices();if(s)a=s;else if(e&&e.length>0){var o=e[0];a=i.getServiceForModel(o)}a?a.service?t.call(null,a,e):require([a.require],function(i){a.service=i,t.call(null,a,e)}):t.call(null,{name:n.get("Unknown")},e)},_onSourceUnavailable:function(e,t){var i={message:n.replace(n.get("sourceUnavailable"),{label:"SourceName",value:t}),code:"SU"};e.onComplete.call(null,{success:!1,error:i})},_callMethodOnSource:function(e,t){var i=this,n=e.modelList;!Array.isArray(n)&&e.model&&(n=[e.model]),this._getAjaxService(n,function(n,a){var o=n.service;if(o&&"function"==typeof o[t])o[t].call(o,e);else{var r=!0;a.forEach(function(e){r=r&&e.get("isTransient")});var l=s[t];r&&l?i[l].call(i,e):i._onSourceUnavailable(e,n.name)}},e.defService)},commitModels:function(e){this._callMethodOnSource(e,"commitModels")},getPreviewUrl:function(e){this._callMethodOnSource(e,"getPreviewUrl")},getHistory:function(e){this._callMethodOnSource(e,"getHistory")},checkFacetsVisibility:function(e){this._callMethodOnSource(e,"checkFacetsVisibility")},getListOfAttributes:function(e){this._callMethodOnSource(e,"getListOfAttributes")},getClassificationAttributes:function(e){this._callMethodOnSource(e,"getClassificationAttributes")},_getDefaultFacetsVisibility:function(e){var t=e.model.get("objectId");e.onComplete.call(null,{id:t,facets:{classificationAttiProp:!0}})}}}),define("DS/ClassificationProp/facets/Common/ClassifFacetsBase",["DS/ClassificationProp/facets/Common/ClassifFacetsCore","DS/ClassificationProp/constants/ClassifPropConstants"],function(e,t){return e.extend({_lastUpdatedId:null,_sharedOptions:null,init:function(e,t){this._sharedOptions=t,this._parent.apply(this,arguments),this.elements||(this.elements={})},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},getOccurrence:function(){return this.getContext()},setContext:function(e){this.setOccurrence(e)},setOccurrence:function(e){var i;if((i=this.getOccurrence())&&e){var n=i.getModel(t.MODEL_INIT),s=i.getModel(t.FACET_PROPERTIES),a=e.getModel(t.MODEL_INIT),o=e.getModel(t.FACET_PROPERTIES);this.getModel();var r=e.getModel(this.getTabId())}if(this._setOccurrence(e),i=this.getOccurrence()){var l=this.getModel();if(!l)return;var c=l.get("objectId");"relationship"==l.get("metatype")&&(c=l.get("selReferenceID"));var u=!0;r&&n.get("objectId")===a.get("objectId")?(u=!1,i.setModel(this.getTabId(),r)):s&&o&&s.get("objectId")===o.get("objectId")?(u=!1,i.setModel(t.FACET_PROPERTIES,s)):n&&n.get("objectId")===a.get("objectId")&&(u=!1,i.setModel(t.MODEL_INIT,n)),(c!=this._lastUpdatedId||u)&&(this._lastUpdatedId=c,this.updateFacet())}},getModel:function(e){var i=null,n=this.getOccurrence();if(n&&(model=this.getOccurrence().getModel(this.getTabId())),e){if(model&&model.get("objectId")===e&&(i=model),!model&&n){var s=n.getAllModels();for(var a in s){var o=s[a];if(o&&o.get("objectId")===e){i=o;break}}}}else n&&(model||(model=this.getOccurrence().getModel(t.FACET_PROPERTIES)),model||(model=this.getOccurrence().getModel(t.MODEL_INIT)),i=model);return i},_setOccurrence:function(e){this._sharedContext=e},setModel:function(e){this.getOccurrence()&&this.getOccurrence().setModel(this.getTabId(),e)}})}),define("DS/ClassificationProp/facets/Properties/ClassifPropUIController",["DS/ClassificationProp/controllers/ClassifPropUIController","DS/ClassificationProp/utils/AttributesUtils","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i){"use strict";return e.extend({defaultOptions:{},validateModels:function(e){return t.validateModels(e)},validateAttributes:function(e,i){return t.validateAttributes(e,i)},resetValueOfModels:function(e){e||(e=this.getModels()),e.forEach(function(e){e.resetInitialValues()})}})}),define("DS/ClassificationProp/form/Form",["DS/ClassificationProp/models/CommonAbstract","DS/WidgetServicesUI/helpers/Constants","DS/ClassificationProp/facets/Properties/TweakerManager","DS/ClassificationProp/utils/AttributesUtils","DS/WidgetServices/WidgetServices","DS/WidgetServices/moveHelper/MoveHelper","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/ClassificationProp/models/ClassifPropAttributeModel","css!DS/ClassificationProp/ClassificationProp.css"],function(e,t,i,n,s,a,o,r,l){var c=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON_WUX:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME_WUX:(i=e.get("type"),n="string"===i||"text"===i?"string_wux":i,"integer"===i?n=t.TYPES.INTEGER_WUX:"real"===i?n=t.TYPES.NUMBER_WUX:"timestamp"===i||"date"===i?n=t.TYPES.DATE_WUX:"person"===i?n=t.TYPES.PERSON_WUX:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN_WUX:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM_WUX),s=n),e.set("tw_type",s)),s},u=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME:(i=e.get("type"),n=i,"integer"===i?n=t.TYPES.INTEGER:"real"===i?n=t.TYPES.NUMBER:"timestamp"===i||"date"===i?n=t.TYPES.DATE:"person"===i?n=t.TYPES.PERSON:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM),s=n),e.set("tw_type",s)),s},d={},h=function(e,t,i){var n=p(e,d[t]?d[t]:"200",t,i);return function(e,t,i){try{localStorage.setItem(e+"_style"+(i?"_"+i:""),JSON.stringify(t))}catch(e){console.log("Local storage full. Current form size can't be saved")}}(e,n,t),n},f=function(e,t){var i=localStorage.getItem(e+"_style"+(t?"_"+t:"")),n=null;try{(n=JSON.parse(i)).width<80&&(n.width=80)}catch(e){}return n||(n=h(e,t)),n},p=function(e,t,i,n){var s={};return s["."+e+" .formLabel"+(i?"."+i:"")]={width:t+"px"},s["."+e+" .resizeHandler"+(i?"."+i:"")]={left:t-10+"px"},{style:s,width:t,userAction:n}},m=function(e,t,i){var n=null;return e.forEach(function(e){var a=function(e,t){var i=f(e,t),n=e+"_style"+(t?"_"+t:"");return s.addNewStyles(n,i.style,!0),i}(e,i);t===e&&(n=a)}),n},g=e.extend({postBuildTweaker:function(){this._tweaker&&this._tweaker.postBuildUI(),this._finalizeWhenReady=!0},destroy:function(){this._parent.apply(this,arguments),this._model&&this._model.removeEvent(this._idAttr,this._manageMessageHandler)},init:function(e,t,i,n){this._parent(n),this._idAttr=i.getIdentifier(),this._model=t,this._form=e,this._tweaker=null,this._finalizeWhenReady=!1,this._manageMessageHandler=this._manageMessage.bind(this);var s=this;!0!==n.postBuild&&this.subscribeEvt("triggerPostBuild",function(){s.postBuildTweaker()}),this.elements.container=UWA.createElement("div",{class:"formLine s12 m12"+(i.get("width")?" l"+i.get("width"):" l12")}),this.elements.flexLine=UWA.createElement("div",{class:"flexLine"}).inject(this.elements.container);var a=this._form._sharedOptions.identifier?"formLabel "+this._form._sharedOptions.identifier:"formLabel",o=UWA.createElement("div",{class:a+" s12"}).inject(this.elements.flexLine),l=!0!==this.options.readOnly&&i.get("mandatory"),d=UWA.createElement("div",{class:"attrLabel"+(l?" mandAttr":"")}).inject(o),h=UWA.createElement("span",{class:"textContainer"}).inject(d);UWA.createElement("span",{text:i.get("label")}).inject(h).tooltipInfos=new r({shortHelp:i.get("label"),mouseRelativePosition:!0}),!0===l&&UWA.createElement("div",{class:"attrMand",html:" *"}).inject(d);var f=this._idAttr,p=UWA.createElement("div",{class:"formValue s12"}).inject(this.elements.flexLine),m=UWA.createElement("div",{class:"formTweakerContainer",id:f}).inject(p),g=t.propertiesWidgetUI||t.webUxTweakers?c(i):u(i),v={};this.options.readonly&&(v.readOnly=this.options.readOnly),v.postBuild=this.options.postBuild,!t.propertiesWidgetUI||t.webUxTweakers||"string"!==g&&"string_wux"!==g?v.forClickable=!1:v.forClickable=!0,this._form.tweakerManager.getTweaker(t,this._idAttr,g,v,function(e){e.inject(m),s._tweaker=e,s._finalizeWhenReady&&s.postBuildTweaker(),s.dispatchEvent("tweakerReady:"+s._idAttr,[e]),"string"!==i.tw_type&&"string_wux"!==i.tw_type||i.multiline||s._tweaker.addEvent("enterKeyDown",function(){t.dispatchEvent("onEnterKeyDown",[i])})}),t.addEvent("onChange:"+this._idAttr,this._manageMessageHandler),this._manageMessage()},showNotificationOnField:function(e){if(this.elements.errorContent&&this.elements.errorContent.setText(e.message?e.message:""),e.message)e.type&&e.type;else this.elements.flexLine.removeClassName("errorOnField")},_manageMessage:function(){var e=this._model.get(this._idAttr),t=this._model.webUxTweakers||this._model.propertiesWidgetUI?c(e):u(e);e.validationFunction=this._form.tweakerManager.getValidationFunction(t);var i=n.validateAttributes(this._model,[e]);e&&e.error&&this.showNotificationOnField(e.error),i&&i.length>0&&(!this._tweaker||!0===this._tweaker.underEdition)&&this.publishEvt("onNotifications",i)},focusTweakerElement:function(){if(this._tweaker){var e=this._tweaker;e&&UWA.is(e.focus,"function")&&e.focus()}else this.addEventOnce("tweakerReady:"+this._idAttr,function(e){e&&UWA.is(e.focus,"function")&&e.focus()})}}),v=null,_=null;return e.extend({defaultOptions:{width:12,label:null,classname:"large",postBuild:!0},_sharedOptions:null,isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},init:function(e,t){this._parent(e),this._sharedOptions=t;var n=this;this.elements.container=UWA.createElement("fieldset",{class:"classifAttContainer s12 m12 l"+this.options.width}),this.fields=[],e.label&&UWA.createElement("legend",{text:e.label}).inject(this.elements.container),this.elements.content=UWA.createElement("div",{class:"classifAttformContent"}).inject(this.elements.container),this.subscribeEvt("editionSwitched",function(e){n.switchTweakersStatus()}),this.subscribeEvt("innerSwitch",function(e){if(n.options.sizeClassname=e,_!==this.index){_=this.index;var t=f(e,n._sharedOptions.identifier);n._publishResizeCell(t)}}),this.subscribeEvt("resetDisplay",function(){v!==this.index&&(v=this.index,n.resetDisplay())}),this.addEvent("resetDisplay1",function(){var e=n.elements.content.getSize();if(n.idealLabelWidth||n.updateResizeLimit(),e.width){n.maxColWidth=e.width-287;var t=f(n.getClassResize(),n._sharedOptions.identifier);t&&t.width&&t.userAction?(d[n._sharedOptions.identifier]=t.width,n.maxColWidth<80?(d[n._sharedOptions.identifier]=80,n.resetDisplay(["medium","large"],t.userAction)):e.width-t.width<287&&(d[n._sharedOptions.identifier]=n.maxColWidth,n.resetDisplay(["medium","large"],t.userAction))):(d[n._sharedOptions.identifier]=n.idealLabelWidth,n.resetDisplay(["medium","large"]))}}),this.tweakerManager=new i({editable:!0===this._sharedOptions.editMode,onNotification:function(e){n.publishEvt("onNotifications",e)}},this._sharedOptions),this._manageEditionStatus(),!0===this.options.automaticCSS&&this.updateCSS()},updateCSS:function(){var e=m(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier);this._publishResizeCell(e)},_publishResizeCell:function(e){var t=null;e&&((t=function(e,t,i){var n={};return e.forEach(function(e){var s=f(e,i);t===e&&(s.current=!0),n[e]=s}),n}(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier)).userAction=e.userAction),this.publishEvt("onResizeCells",t)},updateResizeLimit:function(){var e=this;e.fields&&e.fields.length&&(e.idealLabelWidth=0,e.fields.forEach(function(t){t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:"auto"});var i=t.elements.flexLine.getElementsByClassName("formLabel")[0].getSize();i&&i.width&&e.idealLabelWidth<i.width&&(e.idealLabelWidth=i.width),t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:""})}))},resetDisplay:function(e,t){var i=e||this.options.classnames;i||(i=[this.getClassResize()]);var n=this;i.forEach(function(e){var i=h(e,n._sharedOptions.identifier,t),a=e+"_style"+(n._sharedOptions.identifier?"_"+n._sharedOptions.identifier:"");s.addNewStyles(a,i.style,!0)}),this._publishResizeCell(null)},getClassResize:function(){return this.options.sizeClassname},_manageEditionStatus:function(){var e=!1===this.isReadOnly()&&!0===this._sharedOptions.editMode;e?this.elements.container.addClassName("underEdition"):this.elements.container.removeClassName("underEdition"),this.tweakerManager.switchMode(e)},destroy:function(){this.clear(),this.fields.forEach(function(e){e.destroy()}),this._parent.apply(this,arguments)},switchTweakersStatus:function(){this._manageEditionStatus()},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},clear:function(){this._clearAllFields(),this.elements.content.empty()},setModel:function(e,t){var i=this;this.clear();var n=null!=t&&t.attrs?t.attrs:e.getAllAttributes(),a=[];for(var o in n){var r=n[o];r instanceof l&&a.push(r)}a.sort(function(e,t){return s.compareValue(t.get("positionUI"),e.get("positionUI"))}),a.forEach(function(t){i._addLine(e,t)})},_addLine:function(e,t){this.options.readOnly=this.isReadOnly();var i=new g(this,e,t,this.options);this.fields.push(i),i.inject(this.elements.content)},toggleLineById:function(e,t){if(this.fields){var i=this.fields.find(t=>t._idAttr===e);if(i)return i.getContent().toggle(t),!0}},focusLine:function(e){this.fields[e].focusTweakerElement()}})}),define("DS/ClassificationProp/form/FormOrganizer",["DS/ClassificationProp/models/CommonAbstract","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/WidgetServices/WidgetServices","DS/ClassificationProp/form/Form"],function(e,t,i,n){return e.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this._display=null,this._sharedOptions=t,this._forms=[],this.elements.container=UWA.createElement("div",{class:"ClassifAttformOrganizer "+(this.options.className?this.options.className:"")})},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this._forms.forEach(function(e){e.destroy()}),this._forms=[]},_callOnForms:function(e,t){this._forms.forEach(function(i){i[e].apply(i,t)})},setModel:function(e,t){var i=e.getAllAttributes();this.setAttributes(e,i,t)},setAttributes:function(e,s,a){var o=this;this.clear();var r={},l=[];for(var c in s){var u=s[c];if(u instanceof t&&!0!==u.isTransient){var d=u.get("form");d||(d="DSDefault");var h=r[d];if(!h){var f=a?a[d]:null;h={list:[],name:d},f&&(h.group=f,void 0!==f.position&&(h.position=f.position)),l.push(h),r[d]=h}h.list.push(u)}}l.sort(function(e,t){n=null;var n=void 0===e.position&&void 0!==t.position?1:null;return n=null===(n=null===(n=null===n&&void 0===t.position&&void 0!==e.position?-1:n)&&void 0!==t.position&&void 0!==e.position?e.position-t.position:n)?i.compareValue(t.name,e.name):n});var p=++window.top.perfoIncrem;window.top.performance.mark("start_buildForm:"+p),l.forEach(function(t){var i=UWA.clone(o.options);if(t.group)for(var s in t.group)i[s]=t.group[s];i.automaticCSS=!1;var a=new n(i,o._sharedOptions);a.setModel(e,{attrs:t.list}),a.inject(o.elements.container),o._forms.push(a)}),o._forms.length>0&&o._forms[0].updateCSS(),window.top.performance.mark("end_buildForm:"+p)},focusLine:function(e,t){var i=this;setTimeout(function(){i._forms[e].focusLine(t)},0)},toggleFormLine:function(e,t){this._forms&&this._forms.forEach(function(i){i.toggleLineById(e,t)})}})}),define("DS/ClassificationProp/form/FormSections",["DS/ClassificationProp/models/CommonAbstract","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/form/FormOrganizer","DS/ClassificationProp/comm/EventManager","DS/WidgetServices/WidgetServices","DS/UIKIT/Accordion","DS/Controls/Accordeon","DS/ClassificationProp/constants/ClassifPropConstants","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r,l){var c=r.ACCORDION.ATTRIBUTES,u=l.get("accordion_attributes"),d=l.get("accordion_parameters"),h=new Map;new Map;return e.extend({_sharedOptions:null,defaultOptions:{showSections:!0,sizeClassname:"large"},init:function(e,t){var i=this;this._parent.apply(this,arguments),this.options.classnames=["large","medium","small"],this.openedExpanderItemIndex=[],this._sharedOptions=t,i.elements.accordion=new o({items:[],style:"simple",exclusive:!1}),i.accordeonClassIDandDataMap=new Map,i.elements.accordion.getContent().addEventListener("expand",function(e){n.publish("onClassificationTableOpen",e.options.expanderTarget.domId);var t={expanderItem:e,action:"opened"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)}),i.elements.accordion.getContent().addEventListener("collapse",function(e){var t={expanderItem:e,action:"closed"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)}),this.elements.container=UWA.createElement("div",{class:this._getDefaultClassname()+" "+this.options.sizeClassname}),this.elements.container.addEvent("resize",function(){console.log("resize section")}),i.elements.accordion.inject(this.elements.container),this.subscribeEvt("switchDisplay",function(e){i._switchDisplay(e)||i.publishEvt("innerSwitch",i.options.sizeClassname)}),this.subscribeEvt("switchWrap",function(){i._switchWrap()}),this.elements._organizers={},this._accordionProperties=[],this._openedSections=[]},_switchWrap:function(){this.options.titleWrap?this.elements.container.removeClassName("formWrap"):this.elements.container.addClassName("formWrap"),this.options.titleWrap=!this.options.titleWrap},_getDefaultClassname:function(){var e="";return s.isTouchDevice()&&(e="touchDevice "),!0===this.options.titleWrap&&(e+="formWrap"),"ClassifAttFormSections "+e},_switchDisplay:function(e){var t=this._display===e;return t||(this._display=e,this._checkSize()),t},_checkSize:function(){var e=this.elements.container.getSize().width,t=this._getDefaultClassname();(null===this._display&&e<500||"s"===this._display)&&(this.options.sizeClassname="small"),(null===this._display&&e<1e3&&e>500||"m"===this._display)&&(this.options.sizeClassname="medium"),(null===this._display&&e>1e3||"l"===this._display)&&(this.options.sizeClassname="large"),t+=this.options.sizeClassname,this.elements.container.className=t},inject:function(){var e=this;this._parent.apply(this,arguments),setTimeout(function(){e._checkSize()})},getOrganizers:function(){return this.elements._organizers},setAccordionProperties:function(e){this._accordionProperties=e},_callOnOrganizers:function(e,t){for(var i in this.elements._organizers){var n=this.elements._organizers[i];n[e].apply(n,t)}},openSections:function(e){var t=this;e.forEach(function(e){t.openSection(e)})},openSection:function(e){var t=this.findExpanderIndexFromId(e);-1!=t&&this.elements.accordion.expandItem(t)},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this.reset()},setModel:function(e,i){var n=this;this.clear(),this._model=e,this._groups=i;var a=e.getAllAttributes(),o={},r=[];for(var l in a){var h=a[l];if(h instanceof t&&!0!==h.isTransient){var f,p=h.get("facet"),m=h.get("section"),g=h.get("extension");p=p||m,(n.options.showSections||p===d)&&(f=p||c);var v=o[f];if(!v){var _=n._accordionProperties[f];if(!((_=_||{})&&_.name&&_.nameNLS&&_.icon)){var C=n._accordionProperties[g];C&&(_.icon=C.icon),_.name=f,_.nameNLS=m||(f===c?u:f)}n._accordionProperties[f]=_,"Default"!==h.group&&(_.name=h.group,_.nameNLS=h.groupNLS,_.weight=h.groupWeight),_.weight||(_.weight=0),v={list:[],name:f,section:_},r.push(v),o[f]=v}v.list.push(h)}}r.sort(function(e,t){var i=e.section.weight===t.section.weight?null:e.section.weight<t.section.weight?1:-1;return i=null===i?s.compareValue(t.name,e.name):i});var b=++window.top.perfoIncrem;window.top.performance.mark("start_buildSections:"+b),r.forEach(function(e){n.addSection(e)}),window.top.performance.mark("end_buildSections:"+b),this.openSections(this._openedSections)},addSection:function(e,t){var i=e.section,n=i,s=i;if("object"==typeof i&&(n=i.name),t){var a=this.findExpanderIndexFromId(n);if(!!this.elements.accordion.getExpanderFromIndex(a))return}var o=this._accordionProperties[n],r=null;o&&(t||o.nameNLS&&(s=o.nameNLS),o.icon&&(r="classif"===o.icon?UWA.createElement("span",{class:"fonticon fonticon-flow-tree",title:l.get("EP_icon_classification")}):UWA.createElement("img",{src:o.icon,width:"10px"})));var c=UWA.createElement("span",{text:s});r&&r.inject(c);var u=s?s.replace(/ /g,"_"):"";this._addSection({expandedFlag:s!==d&&this.options.sectionAutoexpand,name:n,attrs:e.list,title:c,orgClassName:"formSection_"+u})},reset:function(){},_addSection:function(e){if(e&&e.name){var t=e.name,n=this.elements._organizers[t];if(!n){var s=UWA.clone(this.options);s.className=e.orgClassName,n=new i(s,this._sharedOptions),this.elements._organizers[t]=n,e.content=n.getContent(),this.elements.accordion.addItem(e);var a=this.elements.accordion.items.indexOf(e),o=this.elements.accordion.getExpanderFromIndex(a);o.domId=e.name,e.title&&e.title.textContent&&(o.header=e.title.textContent)}n.setAttributes(this._model,e.attrs,this._groups),n.classUsage=this._accordionProperties[t].classUsage,this.accordeonClassIDandDataMap.set(e.name,n),h.set(e.name,this)}this._manageAccordionVisibility()},_removeSection:function(e){if(e){this.elements._organizers;var t=this.findExpanderIndexFromId(e);-1!=t&&(this.elements.accordion.deleteItem(t),delete this.elements._organizers[e]),h.has(e)&&h.delete(e),this.accordeonClassIDandDataMap.has(e)&&this.accordeonClassIDandDataMap.delete(e)}},getFormSections:function(){return h},getAttributeNameAndOrganiserMap:function(){return this},toggleFormOrgLine:function(e,t){var i=this.elements._organizers;if(i)for(var n in i){i[n].toggleFormLine(e,t)}},getAccordeonDataMap:function(){return this.accordeonClassIDandDataMap},_manageAccordionVisibility:function(){this.elements.accordion.items.length<=1||2==this.elements.accordion.items.length&&this._showAccordion()},_hideAccordion:function(){var e=this.elements.accordion.getExpanderFromIndex(0);if(e){var t=this.elements.accordion.elements.container.parentElement,i=this.elements._organizers[e.domId];t&&i.inject(t)}this.elements.accordion.hide()},_showAccordion:function(){var e=this.elements.accordion.getExpanderFromIndex(0);e&&this.elements._organizers[e.domId].inject(e.elements.bodyContainer);this.elements.accordion.show()},findExpanderIndexFromId:function(e){for(var t=0;t<this.elements.accordion._expanderItems.length;t++)if(this.elements.accordion._expanderItems[t].domId===e)return t;return-1},getIndexesOfOpenedOrSelectedAccordeonItems:function(e){var t=e.expanderItem.options.expanderTarget.domId,i=e.action;if("opened"===i){for(var n=0;n<this._openedSections.length;n++)if(t&&this._openedSections[n]===t)return;t&&this._openedSections.push(t)}else if("closed"===i){var s=this._openedSections.filter(e=>e!==t);this._openedSections=s}}})}),define("DS/ClassificationProp/facets/Properties/Properties",["UWA/Class","DS/ClassificationProp/models/CommonAbstract","UWA/Json","UWA/Array","DS/WidgetServices/WidgetServices","DS/ClassificationProp/form/FormSections","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/facets/Properties/ClassifPropBase","DS/ClassificationProp/facets/Properties/ClassifPropUIController","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/WidgetServicesUI/tweakers/TweakerWUXButton","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r,l,c,u,d,h,f,p,m){"use strict";m.get("accordion_attributes"),m.get("accordion_parameters");var g=new Map,v=new Map,_=new Map,C=new Map,b=null;window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;return e.extend(t,r,{_previousScrollerPosition:null,defaultOptions:{setRefreshButton:!1,setValidButton:!1,setCloseButton:!1,setEditButton:!1,showTopBar:!1,editMode:!0,showSections:!0,sectionAutoexpand:!0,readOnly:!1,scroller:!1,displayType:c.STANDARD,updateSession:!1},init:function(e){this._parent.apply(this,arguments),this.wiwListModels=null,this.handlerTouchEnd=function(e){Date.now()}.bind(this),this.handlerDblClick=null,this.handlerAttributeChanged=function(){this._ManageValidButton()}.bind(this),this.handlerLabelChanged=function(){this._firstModel&&this.dispatchEvent("onTitleChanged",this._firstModel.get("label"))}.bind(this),this._firstModel=null,this._previousScrollerPosition=null,this.lastPointedTableCellObj=null,this._sharedOptions.editMode=!0===e.editMode,this._sharedOptions.identifier=e.identifier,e.webUxTweakers&&(this.webUxTweakers=e.webUxTweakers),e.propertiesWidgetUI&&(this.propertiesWidgetUI=e.propertiesWidgetUI),this.elements.UIController=new l([]),this.isReadOnly=this.isReadOnly();var t=this;this.subscribeEvt("onResizeCells",this._onCellResized.bind(this)),this.subscribeEvt("onNotifications",function(e){t.setError(e)}),this.initUI()},_onCellResized:function(e){var t=null,i=!1;if(e){var n=e.medium;i=!0!==(t=n&&!0===n.current?n:e.large).current}var s=!1;if(!i){var a=c.MIN_WIDTH_FOR_TABLE;e&&(a=parseInt(t.width)),s=c.VARIABLES.minWidthForTable!==a,c.VARIABLES.minWidthForTable=a}e&&!0===s&&this.dispatchEvent("refreshActions"),this._updateUI()},setAccordionProperties:function(e){this.elements.formSection.setAccordionProperties(e)},getAccordeon:function(){return[this.elements.formSection,null]},getClassTitleFromID:function(e){return g.get(e)},setClassIDandTitle:function(e,t){g.set(e,t)},removeClassIdandTilefromMap:function(e){g.delete(e)},isReadonly:function(){return!1!==this.isReadOnly},clear:function(){this._clearAllFields()},_clearAllLine:function(){this.elements.formSection.clear()},_getModel:function(e){return this.elements.UIController.getModel(e)},getClassPath:function(e){return v.get(e)},setClassPath:function(e){v=e},getExistingClassAttributes:function(e){return _.get(e)},setExistingClassAttributes:function(e){_=e},setClassUsage:function(e){C=e},getClassUsage:function(e){return C.get(e)},setIsInformationPanel:function(e){b=e},getIsInformationPanel:function(e){return b},initData:function(e,t){this.resetUIValues(),this.elements.UIController.setModels([]),this._clearAllLine();var i=this._sharedOptions.editMode;if(t)switch(t.edition){case c.FORCE_READWRITE:i=!0;break;case c.FORCE_READONLY:i=!1;break;case c.FORCE_DEFAULT:i=!0===this.options.editMode}if(this._sharedOptions.editMode!==i&&this._switchEditionMode(),!0===this.options.updateSession){if("undefined"!=typeof dscef){this.wiwListModels=e;var n=e[0]._attributes,s=[];for(var a in n){if(null!=n[a]){var o=n[a].value,r=n[a].valueDB,l=n[a].readOnly;null!=o&&null!=l&&null!=r&&s.push({attribute:a,value:n[a].value,valueDB:n[a].valueDB,readOnly:n[a].readOnly})}}var u=JSON.stringify(s);dscef.sendString('{"operation":"getData","operationVersion":"1.0","attributes":'+u+"}")}}else this.addData(e)},addData:function(e){this._addData(e)},changeAttributes:function(e){var t=JSON.parse(e);if(null!=this.wiwListModels&&null!=e){for(var i=0;i<t.attributes.length;i++){var n=t.attributes[i],s=n.attribute,a=n.value,o=n.valueDB,r=n.readOnly;null!=a&&null!=o&&null!=r&&(this.wiwListModels[0]._attributes[s].value!=a&&(this.wiwListModels[0]._attributes[s].value=a,this.wiwListModels[0]._attributes[s].initialsValues.value=a),this.wiwListModels[0]._attributes[s].valueDB!=o&&(this.wiwListModels[0]._attributes[s].valueDB=o,this.wiwListModels[0]._attributes[s].initialsValues.valueDB=o),this.wiwListModels[0]._attributes[s].readOnly!=r&&(this.wiwListModels[0]._attributes[s].readOnly=r))}this.addData(this.wiwListModels)}},_getScrollerContent:function(){return this.elements.scroller?this.elements.scroller.elements.content:null},_scrollIsBottom:function(e){var t=!1;if(e){var i=e.scrollHeight,n=e.getDimensions();t=0!==e.scrollTop&&e.scrollTop>i-n.height}return t},_getScrollerPosition:function(){var e=this._getScrollerContent();return e?this._scrollIsBottom(e)?-1:e.scrollTop:null},_setScrollerPosition:function(e){var t=this._getScrollerContent();t&&(t.scrollTop=-1===e?t.scrollHeight:e)},_saveScrollerPosition:function(){this._previousScrollerPosition=this._getScrollerPosition()},_restoreScrollerPosition:function(){null!==this._previousScrollerPosition&&this._setScrollerPosition(this._previousScrollerPosition),this._previousScrollerPosition=null},onResize:function(){},_addData:function(e){var t=++window.top.perfoIncrem;window.top.performance.mark("start_LoadUI:"+t);var i=this;this._ManageValidButton(!1),null!=e&&e.length>0&&this.elements.UIController.setModels([e[0]]);var n=this.elements.UIController.getModels();if(n.length<=0)this._clearAllLine();else{var s=n[0];this._firstModel=s,s.addEvent("onChange:label",this.handlerLabelChanged),s.addEvent("onChange",this.handlerAttributeChanged),this.updateTableManager(),this.onResize(),this._ManageValidButton(),this.endOfLoad()}window.top.performance.mark("end_LoadUI:"+t),this.dispatchEvent("onChangeSize"),this.dispatchEvent("onTitleChanged"),this.elements.UIController.validateModels(this.elements.UIController.getModels()),setTimeout(function(){i._restoreScrollerPosition(),window.top.performance.mark("end_EP_FullTime")}),this.elements.formSection._manageAccordionVisibility()},endOfLoad:function(){var e=this;this.dataLoadedOnce||setTimeout(function(){e.dataLoadedOnce=!0,e.dispatchEvent("onDataLoaded")},0)},_isCloseButton:function(){return c.isCloseButton(this.options.displayType)},show:function(){this.getUI().show()},setOption:function(e,t){this._parent.apply(this,arguments),this.elements.formSection.options[e]=t},resetDisplay:function(){this.publishEvt("resetDisplay")},initUI:function(){var e=++window.top.perfoIncrem;window.top.performance.mark("start_EP_InitUI:"+e);var t=this;this.elements.mainDiv=this.elements.container=UWA.createElement("div",{class:"EditProp_MainContain includeMenuBar"}),!0!==this.isReadOnly&&!0===this._sharedOptions.editMode||this.elements.container.addClassName("EP_ReadOnly");var i=this.elements.containerProperties=UWA.createElement("div",{class:"ClassifAtt_Container"}),n=this.elements.containerAccordeon=UWA.createElement("div",{class:"ClassifAtt_Scroller"});o.subscribe("onClassificationTableOpen",function(e){t._saveScrollerPosition()}),t.elements.formSection=new a({postBuild:!0,sectionAutoexpand:this.options.sectionAutoexpand,showSections:this.options.showSections,eventThread:this.options.eventThread},this._sharedOptions),this.elements.formSection.inject(n),o.subscribe("onAttributeUpdate",function(e){var i=t.elements.formSection.getAccordeonDataMap(),n=e.extension;if(e&&i)for(let[t,s]of i){let a=t+"-"+e.name,o=t,r=null,l=null,c=null;if(l=s._forms[0].tweakerManager){let t=l._getOrCreateField(a,!0);t&&(c=t.field)&&0!=Object.keys(c).length&&(r=l._getValueForTweaker(e.tw_type,e),o!=n&&"Definition"==e.classUsage&&"Definition"==i.get(o).classUsage&&c.setValue(r))}}}),n.setStyle("overflow-y","auto"),n.inject(i);var r=this.elements.bottomTable=UWA.createElement("div",{class:"Classif_BottomTableContainer"}),l="true"===s.getWidgetValue(c.COLLAPSE_IC_PREFERENCE.name)&&this.options.typeOfDisplay===c.ALL;null!==l&&!0!==l||s.setWidgetValue(c.COLLAPSE_IC_PREFERENCE.name,"true");var u=this.elements.containerMainTable=UWA.createElement("div",{class:"ClassifTableContainer "}).inject(r);i.inject(u),r.inject(this.elements.container),!0===this.options.showTopBar&&this.ManageButtonDiv.inject(t.elements.container),this.elements.formSection._manageAccordionVisibility(),window.top.performance.mark("end_EP_InitUI:"+e),this.elements.container.addEvent("resize",this._updateUI.bind(this))},getUpdatedValueForAttribute:function(e){var t=this.elements.formSection.getAccordeonDataMap();if(t)for(let[n,s]of t){let t=n+"-"+e;var i=null;let a=null,o=null,r=null,l=null;if((o=s._forms[0].tweakerManager)&&(l=o._getOrCreateField(t,!0))&&(a=l.model.getChangedValues()[t],r=l.field,a&&r&&0!=Object.keys(r).length))return i=o._getValueForTweaker(a.tw_type,a),"date_wux"==a.tw_type?a.valueDB:i}},_updateUI:function(){var e=this.elements.container.getSize();e.width&&e.width<381?this.publishEvt("switchDisplay","s"):this.publishEvt("switchDisplay","m")},getAccordeonFromID:function(e){return this.elements.formSection.getFormSections().get(e)},getUI:function(){return this.elements.container},getclassAndAttributeNameMap:function(){return classAndAttributeNameMap},resetUIValues:function(){this.elements.formSection&&this.elements.formSection.reset()},getComponentMode:function(){return!0===this.options.updateSession||this.isReadOnly},switchComponentMode:function(e){this.isReadOnly=e,this.handlerDblClick&&this.elements.container.removeEvent("dblclick",this.handlerDblClick),this.handlerDblClick=null,!0!==e&&(this.handlerDblClick=function(){this._switchEditionMode(!0)}.bind(this),this.elements.container.addEvent("dblclick",this.handlerDblClick))},addSection:function(){this.elements.formSection.addSection.apply(this.elements.formSection,arguments)},_switchEditionMode:function(e){var t=!1;if(e!==(!1===this.isReadOnly&&!0===this._sharedOptions.editMode)){if(!1===this.isReadOnly)if(this._sharedOptions.editMode){if(this.elements.UIController.getModifiedModels().length>0){var i=m.get("Some attributes are in edition. Please valid or cancel the modifications to switch");return this._isCloseButton()&&(i=m.get("Some attributes are in edition. Please valid or refresh to switch")),void this.addWarning(i)}this._sharedOptions.editMode=!1,this._activateAddingButton(!1)}else this._sharedOptions.editMode=!0,this._activateAddingButton(!0);else this._sharedOptions.editMode=!1;t=!0}return t&&this.publishEvt("editionSwitched",this._sharedOptions.editMode),!0!==this._sharedOptions.editMode?this.elements.container.addClassName("EP_ReadOnly"):this.elements.container.removeClassName("EP_ReadOnly"),s.setWidgetValue("editProperties_editMode",this._sharedOptions.editMode),t},_switchEdition:function(e){this._switchEditionMode(e)&&this.onResize(),this.lastPointedTableCellObj=null},resizeActionActive:function(){return c.VARIABLES.minWidthForTable!==c.MIN_WIDTH_FOR_TABLE},getOptimalSize:function(){var e=this.elements.masterTable.getSize(),t=this.elements.containerProperties.getSize(),i=e.height-t.height,n=this.elements.formSection.getContent().getSize();return n.height+=i+60,n.width+=30,n},updateTableManager:function(){this._saveScrollerPosition(),this._clearAllLine(),this.updateTable()},updateTable:function(){var e=this;this._clearAllFields(),this._clearAllLine(),e.modelIdentityCard&&(e.modelIdentityCard.set("title",""),e.modelIdentityCard.set("ownerName",""),e.modelIdentityCard.set("date",""),e.modelIdentityCard.set("description",""));var t=this.elements.UIController.getModels(),i=t.length,n=++window.top.perfoIncrem;window.top.performance.mark("start_addInForm:"+n);for(var s=0;s<i;s++){var a=t[s];this.webUxTweakers&&(a.webUxTweakers=this.webUxTweakers),this.propertiesWidgetUI&&(a.propertiesWidgetUI=this.propertiesWidgetUI),this.elements.formSection.setModel(a)}window.top.performance.mark("end_addInForm:"+n),this._restoreScrollerPosition(),setTimeout(function(){e.publishEvt("triggerPostBuild")})},saveIsNeeded:function(){var e=!0;return this.elements.UIController.getModifiedModels().every(function(t){var i=t.previousAttributes();for(var n in"function"==typeof t.getChangedValues&&(i=t.getChangedValues()),i){var s=i[n];if(s instanceof u&&!1===s.isTransient){e=!1;break}}return!1!==e}),!e},validateModel:function(e){var t=!1,i=null;if((i=e||this.elements.UIController.getModifiedModels()).length>0){var n=this.elements.UIController.validateModels(i);n?(n.message=m.get("Modification failed")+":"+n.message,this.setError(n)):t=!0}return this._ManageValidButton(),t},_valueIsChanging:function(e,t){this._ManageValidButton();var i={value:t,valueDB:e.get("valueDB")};e.isSameValueSet(i)&&this._activateValidButton()},_activateAddingButton:function(e){this.dispatchEvent("onAddActivation",e)},_activateValidButton:function(e){var t=!e;this.elements.boutonCancel&&(t?this.elements.boutonCancel.show():this.elements.boutonCancel.hide()),this.dispatchEvent("onValidActivation",t)},_ManageValidButton:function(){this._activateValidButton(!this.saveIsNeeded())},getButtons:function(){return this.ManageButtonDiv},getTitle:function(){var e="";return this.elements.UIController&&(e=this.elements.UIController.getLabel()),e},showNotification:function(e){this.addSuccess(e)},setError:function(e){var t=this;if(n.isArray(e))e.forEach(function(e){var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)});else{var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}},_manageError:function(e,t){if(e)switch(e.eventID?e.eventID:"error"){case"warning":this.addWarning(e.message?e.message:e,t);break;case"success":this.addSuccess(e.message?e.message:e,t);break;default:this.addError(e,t)}},addWarning:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"warning",customClass:t})},addSuccess:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"success",customClass:t})},addInfo:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"info",customClass:t})},addError:function(e,t){this.dispatchEvent("onNotification",{msg:e.message?e.message:i.encode(e),eventID:"error",customClass:t})}})}),define("DS/ClassificationProp/facets/Properties/ClassifPropController",["UWA/Class/Model","UWA/Core","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/facets/Common/ClassifFacetsBase","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropModelMerge","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests","DS/ClassificationProp/facets/Properties/Properties","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/ClassificationProp/comm/DistantAjax","DS/ClassificationProp/utils/ClassifPropUtils","DS/ClassificationProp/utils/ClassifPropControl","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r,l,c,u,d,h,f,p,m,g){"use strict";var v=g.get("accordion_parameters");let _=!0;return a.extend({defaultOptions:{serverName:"",serverUri:"",displayType:d.STANDARD,extraNotif:!1,context:null},getListHandle:null,commitHandle:null,previewUrlHandle:null,init:function(e){var t=this;this._parent.apply(this,arguments),this.getListHandle={handle:null},this.commitHandle={handle:null},this.previewUrlHandle={handle:null},this.attributeNameAndClassMap=new Map;var i={};for(var n in e)i[n]=e[n];i.events=i.events?i.events:{},i.events.onNotification=function(e){t._setError(e.msg?e.msg:e.json,e.eventID,e.customClass)},i.events.onValidActivation=function(e){t.switchSaveButton(e)},i.events.onAddActivation=function(e){t.switchAddButton(e)},t.parametersLoaded=!1,t.alreadySelectedModels=[],s.subscribe("onClassificationTableOpen",function(e){e==v&&!1===t.parametersLoaded&&(t.parametersLoaded=!0,t._loadPLMParameters())}),s.subscribe("onInformationAttributeUpdate",function(e){var i=[];i.push(e.model),t.onSave(e.ObjectId,i,e.selection,e.informationPanelContext)}),i.events.refreshActions=function(e){t.refreshActions()},this._createUI(i)},isUIReadonly:function(){return this.editPropertiesUI.isReadonly()},_createUI:function(e){e.className=this.getTabId(),e.eventThread=this.options.eventThread,this.editPropertiesUI=new u(e,this.getSharedOptions())},nothingToSave:function(){return!this.editPropertiesUI.saveIsNeeded()},onSave:function(e,t,i,n){var s=[],a=this.editPropertiesUI.validateModel(t);t.forEach(function(e){s.push(e.getChangedValues())});var o={},r=i;[...s].forEach(function(e){for(let t in e)o[t]=e[t]}),r.setChangedValues(o);for(const e in r.changedValues)r._attributes[e]=r.changedValues[e];if(a)if(!0===this.options.updateSession){var l=r.changedValues,c=[];for(var u in l)if(null!=u){var d=l[u].value,h=l[u].valueDB;null!=d&&null!=h&&c.push({attribute:u,value:d,valueDB:h})}var f=JSON.stringify(c);"undefined"!=typeof dscef&&dscef.sendString('{"operation":"onOk","operationVersion":"1.0","attributes":'+f+"}")}else{r._attributes;r._attributes.objectId=e,r.set("metatype","bus"),this._commitModels([r],n)}},getExtensions:function(){var e=this;require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],function(t){var n=e.getModel(),s=n.getTenant();i.getInstance({tenant:s}).getSecurityContext({context:e.options.context,onSuccess:function(i){e.showLoader();new t(widget,e._parent,e.options,i,n,function(){e.hideLoader(),e.onRefresh()},function(t){e.hideLoader(),require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({eventID:"string"==typeof type?type:"info",msg:t})})})},onFailure:function(t){e._setError(t)}})},function(){e._setError("AddExtensionWidget do not exist")})},switchEdition:function(){this.editPropertiesUI._switchEdition()},getButtons:function(){return this.editPropertiesUI.getButtons()},_getUI:function(){return this.editPropertiesUI},onLoad:function(){this.clearAllDatas()},updateFacet:function(){this.onRefresh()},onRefresh:function(){this.loadModels(this.getModel(),{parameters:!0===this.parametersLoaded})},_cancelListRequest:function(){this.getListHandle&&this.getListHandle.handle&&(this.getListHandle.handle.cancel(),this.getListHandle.handle=null)},_cancelCommitHandle:function(){this.commitHandle&&this.commitHandle.handle&&(this.commitHandle.handle.cancel(),this.commitHandle=null)},_cancelPreviewUrlHandle:function(){this.previewUrlHandle&&this.previewUrlHandle.handle&&(this.previewUrlHandle.handle.cancel(),this.previewUrlHandle=null)},destroyComponent:function(){this._cancelCommitHandle(),this._cancelListRequest(),this._cancelPreviewUrlHandle(),this.clearAllDatas(),this._commandProxy&&this._commandProxy.destroy()},clearAllDatas:function(){var e=this.getModel();e&&e.destroy(),this.setModel(null)},_loadPLMParameters:function(){this.loadModels(this.getModel(),{parameters:!0,attributes:!1})},loadModels:function(t,i){window.top.performance.mark("start_PrepareAjax");var n=this;this.showLoader(),s.subscribe("getnoClassificationAttribute",function(e,t){if(_=t,null==t&&(_=!1),e){var i=n.alreadySelectedModels.indexOf(e);i>-1&&n.alreadySelectedModels.splice(i,1)}});var a=t;if(t){h.getServiceForModel(t);var r=null;t instanceof e?(n.getModel(a.get("objectId"))||a.clearChangedValue(),r=a.getChangedValues()):a=new o(t),n.getModel(a.get("objectId"))||(n.setModel(a),a.clearChangedValue()),a.keys().forEach(function(e){var t=a.get(e);t instanceof l||"object"!=typeof t||"EditProp_listOfChange"===e||"label"===e||e.startsWith(d.MODEL_FACET_INFO_PREFIX)||e.startsWith(d.MODEL_DS_ATTR)||a.set(e,new l(t))}),n._resetModifFlag(a);var u=a.get("EditProp_listOfChange");if(u&&(a.setChangedValues(u),a.unset("EditProp_listOfChange")),r&&a.setChangedValues(r),window.top.performance.mark("end_PrepareAjax"),i&&!1===i.loadModel)this.setModel(a),this.editPropertiesUI.initData([this.getModel()],{classificationAttiProp:!0});else{window.top.performance.mark("start_EP_AJAXRequest");var p=!1;window.top.performance.mark("start_EP_GetFromDistant"),f.getAsyncRead(function(e){!1===p&&(e?(window.top.performance.mark("end_EP_GetFromDistant"),p=!0,n._cancelListRequest(),n._onCompleteLoadModel(e)):_&&function(){var e,t,o,r=i&&!0===i.parameters,l=i&&!1!==i.attributes,u=[];if(a.isMergedModel()){var h=a.getMergingModels();a._initProperties.objectId;for(var f in h){var g=h[f];u.push(g._attributes.objectId),console.log(g)}(e=u,t=n.alreadySelectedModels,o=[],e.forEach(function(e){t.includes(e)||o.push(e)}),o).forEach(function(e){v(a=h[e])})}else v(a);function v(e,t){var i={modelList:[e],tenant:e.getTenant(),onAttributesLoad:function(t){if(!1===p){var i,a,o={data:[]};e._attributes.objectId=t.id?t.id:e._attributes.objectId,i=e._attributes.objectId,t.results=[],t.attribute&&t.attribute.forEach(function(t){a=t.name;var s={path:t.name,extension:e._attributes.objectId,nls:t.nls_label,selectable:"attribute["+t.name+"]",name:t.name,readOnly:!1,type:t.type,value:[t.default]};if(""==t.default&&(s.value=[]),t.dimensionUnits&&t.dimensionUnits.defaultUnit&&(s.dimension=t.dimensionUnits.defaultUnit),t.dimensionUnits&&t.manipulationUnit&&(""==t.default||m.getInformationPanel())&&(s.dimension=t.dimensionUnits[t.manipulationUnit]),t.dimension&&(s.dimensionType=t.dimension),t.manipulationUnit&&(""==t.default||m.getInformationPanel())&&(s.unitName=t.manipulationUnit),"multival"==t.valuetype&&(s.multivalue=!0),"TRUE"==t.multiline&&(s.multiline=!0),t.range&&t.range.length>0){let e=[];if(Object.values(t.range).forEach(function(t){"between"!=t.operator&&e.push(t.value)}),t.rangeNLS){let e=[];Object.values(t.rangeNLS).forEach(function(t){"between"!=t.operator&&e.push(t.value)}),s.rangeNLS=e}s.range=e,s.rangeNLS=s.rangeNLS?s.rangeNLS:e}var r=n.editPropertiesUI.getUpdatedValueForAttribute(s.name);r&&"Definition"==n.editPropertiesUI.getClassUsage(i)&&(s.value=r),o.data.push(s)}),o.extensions={};var c=n.editPropertiesUI.getClassTitleFromID(i),u=n.editPropertiesUI.getClassPath(i),h=n.editPropertiesUI.getClassUsage(i);o.extensions[i]={name:i,nameNLS:m.getInformationPanel()&&null!=h?u:c,classUsage:h,weight:0,icon:"classif"},o.modifyAccess=!0,o.physicalID=e._attributes.objectId,o.metatype="bus",o.PLMParametersAvailable=!1,o.computed={label:{path:e._attributes.objectId+"-"+a,selectable:"attribute["+e._attributes.objectId+"]",name:e._attributes.objectId+"-"+a}},t.results[0]=o,s.publish("getAttributesDone",!0),!0===window.top.isDebug&&console.log("Ajax 2 answered "+window.top.performance.now()),n.getListHandle.handle=null,n._onCompleteLoadModel(t,{initTable:!r,buildBehavior:l?d.FORCE_DEFAULT:d.NO_CHANGES})}},onComplete:function(e){n.hideLoader(),i.onAttributesLoad(e)}};i.plmParams=r,i.attributes=l,i.readonly=n.isUIReadonly(),i.navigateToMain=n.getTabId()===d.FACET_CLASSIFICATIONPROP,n.alreadySelectedModels.push(e._attributes.objectId),m.setClassifPropController(i),n.editPropertiesUI.getExistingClassAttributes(e._attributes.objectId)&&n.editPropertiesUI.getExistingClassAttributes(e._attributes.objectId).isExisting&&n.editPropertiesUI.getExistingClassAttributes(e._attributes.objectId).attribute&&i.onAttributesLoad(n.editPropertiesUI.getExistingClassAttributes(e._attributes.objectId)),(!m.getInformationPanel()||m.getInformationPanel()&&"function"!=typeof m.getProvider().getClassificationAttributesForAClass)&&c.getClassificationAttributes(i)}}())})}1==(t._innerModels?Object.keys(t._innerModels).length:1)&&t._attributes&&t._attributes._DS_ATTR_type&&t._attributes._DS_ATTR_type.valueDB&&t._attributes._DS_ATTR_type.valueDB}else this.editPropertiesUI.clear(),this._onCompleteLoadModel({results:[]})},hide:function(){this._parent(),this.editPropertiesUI.clear()},_commitModels:function(e,t){var i=this,n=null;t&&"function"==typeof t&&(n=t()),i.commitHandle.handle=null,i.showLoader(),c.commitModels({handleRequest:i.commitHandle,serverName:i.options.serverName,serverUri:i.options.serverUri,modelList:e,tenant:e[0].getTenant(),securityContext:n,onComplete:function(e){i.hideLoader(),i.commitHandle.handle=null,i._onCompleteCommit(e)}})},_manageNotificationFromAnswer:function(e,t){var i=t,n="error",s="undefined";if(e)if(e.hasOwnProperty("error"))i=e.error;else if(e.hasOwnProperty("notification")){i=(a=e.notification).message,n=a.type?a.type:n,(s=a.code?a.code:"LCERR400100")&&(i={type:"MainStaticError",message:a.message})}else if(e.hasOwnProperty("errors")&&e.errors.length>0){var a;i=(a=e.errors[e.errors.length-1]).message,n=a.type?a.type:n}else!1===e.success&&(i={message:g.get("Server error"),code:"ERROR"});if(i)if(void 0!==e&&void 0!==e.errors&&null!=e.errors&&2==e.errors.length&&void 0!==e.errors[0].code&&"1900068"===e.errors[0].code&&void 0!==e.errors[1]&&"1500188"!=e.errors[1].code)UWA.i18n("UpdateObjectfailed"),UWA.i18n("UpdateObjectfailedSubtitle");else s&&0==s.localeCompare("LCERR400100")?this._setMainError(i.message,i.type.toLowerCase(),i.customClass):this._setError(i,n.toLowerCase(),i.customClass);return{message:i,type:n.toLowerCase()}},_setError:function(e,t,i){t=t||"error",this._raiseNotification(e,t,i)},_setMainError:function(e,t,i){t=t||"mainstaticerror",this._raiseNotification(e,t,i)},_onCompleteCommit:function(e){},_buildFromResponse:function(e,t,i){var n={modifyAccess:!0,oneSuccess:!1,allAttributeAreRO:!0,plmparams:null};if(!1!==e.success){for(var s=e.transactionid,a=e.results,l=a.length,c=0;c<l;c++){var u=a[c];this._manageNotificationFromAnswer(u);var d=null;d=null!=s?s:this._getID(u);var h=this.getModel(d);if(null==h)(b=(C=this.getOccurrence()).getModel(this.getTabId()))&&(h=b.getMergingModels()[d]);var f=this._getMetaType(u),m=null,g=!1;if(h&&h.isMergedModel()){m={};var v=this.alreadySelectedModels,_=h.getMergingModels();v.forEach(function(e){var t=_[e];if(null==t){g=!0;var i=UWA.clone(h.getOptions());i.objectId=e,i.metatype=f,t=new o(i)}m[e]=t})}if(g||null==h){if(!g){var C,b;if(null===(C=this.getOccurrence()))return console.log(" --- >> No current occurence"),{};if(null!==(b=C.getModel(this.getTabId())))return console.log(" --- >> A model already exist for properties tab"),{};if(!h&&s)return console.log(" --- >> A merged model is returned for a single model"),{}}var S=this.getOccurrence().getAllModels(!0,!0);t={metatype:f,objectId:d};S&&S.length>0&&((t=UWA.clone(S[0].getOptions())).objectId=d,t.metatype=f),null!=m?(h=new r(t)).setMergingModels(m):h=new o(t),h.clearChangedValue()}if(null!=m&&(h=new r(t)).setMergingModels(m),f&&h.set("metatype",f),this.setModel(h),u.extensions)for(var E in u.extensions)i[E]=u.extensions[E];var y=p.fillFromServer(u,h,t);n.modifyAccess=!1!==y.modifyAccess&&n.modifyAccess,n.oneSuccess=n.oneSuccess||y.success,n.allAttributeAreRO=n.allAttributeAreRO&&y.allAttributeAreRO,n.plmparams=!1!==n.plmparams&&y.plmparams}this.editPropertiesUI._ManageValidButton()}return n},_onCompleteLoadModel:function(e,t){this.hideLoader(),window.top.performance.mark("end_EP_AJAXRequest"),window.top.performance.mark("start_EP_DataTreatement"),t||(t={initTable:!0,buildBehavior:d.FORCE_DEFAULT});var i=e.options;i&&(void 0!==i.showSections&&this.editPropertiesUI.setOption("showSections",!0===i.showSections),void 0!==i.autoExpand&&this.editPropertiesUI.setOption("sectionAutoexpand",!0===i.autoExpand));var n={};this._manageNotificationFromAnswer(e);var s=this._buildFromResponse(e,t,n),a=s.modifyAccess&&!s.allAttributeAreRO&&(!this.isReadOnly()||"false"===this.isReadOnly());!0!==a&&!0!==t.initTable||(this.editPropertiesUI.switchComponentMode(!a),this.updateReadWriteAccess(a)),window.top.performance.mark("end_EP_DataTreatement"),window.top.performance.mark("start_EP_DataDisplay");var o=this.getModel(),r=s.oneSuccess&&o?[o]:[];this.editPropertiesUI.setAccordionProperties(n),r&&r.length>0&&(r[0].facet="prop"),this.editPropertiesUI.initData(r,{edition:t.buildBehavior,classificationAttiProp:!0}),s.plmparams&&this.editPropertiesUI.addSection({section:v},!0)},_getID:function(e){return e.physicalID},_getMetaType:function(e){return e.metatype},_resetModifFlag:function(e,t){e.clearChangedValue(t),this.editPropertiesUI._ManageValidButton()},changeAttributes:function(e){this.editPropertiesUI.changeAttributes(e)}})}),define("DS/ClassificationProp/UI/IDCardSkeleton",["UWA/Class/Model","DS/ClassificationProp/models/CommonAbstract","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/ICard/IdCard","DS/ClassificationProp/facets/Properties/ClassifPropController","DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServices/WidgetServices","DS/ClassificationProp/comm/DistantAjax","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/PlatformAPI/PlatformAPI","DS/WidgetServicesUI/tweakers/TweakerWUXButton","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r,l,c,u,d,h,f,p,m,g,v){"use strict";var _={"DS/ClassificationProp/facets/Properties/ClassifPropController":s};window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;i.FACET_NONE;return t.extend({_lFacets:[],_sharedContext:null,_sharedOptions:{},_RWAccess:!1,defaultOptions:{name:"",className:"",showIdCard:!0,showTopBar:!0,showFacets:!0,warningOnUnsaved:!0,closeButton:!0,noThumbnail:!1,facetLabel:!0,displayType:i.STANDARD},init:function(e,t){this._sharedOptions={},this._parent(t),this.options.actions&&this.options.actions.forEach(function(e){void 0===e.after&&"action_close_panel"===e.name&&(e.after=!0)}),this._sharedContext=t.sharedContext?t.sharedContext:null,this._lFacets=e,this.elements||(this.elements={}),this.loaderFacetList=[],this.idcardInit()},getTopBar:function(){return this.elements.manageButtonDiv},idcardInit:function(e){var t=this,i=this.elements.container=UWA.createElement("div",{name:this.options.name,class:this.options.className}),s="";!0===this.options.showTopBar&&(s="withMenuBar");this.elements.globalDiv=UWA.createElement("div",{class:"IDCardGlobalContain "+s}).inject(i);var a=t.elements.mainInterface=UWA.createElement("div",{class:"ClassifMainInterface"}).inject(this.elements.globalDiv),o=this.elements.masterTable=UWA.createElement("div",{class:"ClassifAttMasterTable "}).inject(a),r=this.elements.topTable=UWA.createElement("div",{class:"IDCardTopTableContainer"});if(this.elements.bottomMainArea=UWA.createElement("div",{class:"ClassificationCardArea"}),this.elements.bottomInnerArea=UWA.createElement("div",{class:"ClassificationCardInnerArea"}),this.elements.bottomInnerArea.inject(this.elements.bottomMainArea),this.elements.bottomArea=UWA.createElement("div",{class:"ClassifAttributePropContainer"}),this.elements.bottomArea.inject(this.elements.bottomInnerArea),this.elements.bottomMainArea.inject(o),delete this.elements.postIdCard,!0===this.options.showIdCard){var l={};this.options.idCardOptions&&(l=this.options.idCardOptions),l.actions=[],this.elements.postIdCard=new n(l),t.identityCardContainer=UWA.createElement("div",{class:"topTableElement identityCardCell infra"}).inject(r);var c=UWA.createElement("div",{class:"ClassifTableContainer ",events:{click:function(){let e={currentFacet:t.currentFacetName};p.publish(`PropHeaderActivated:${widget.id}`,e)}}}).inject(this.identityCardContainer);this.elements.postIdCard.inject(c),this.currentFacetName=null,this.defaultFacetName=null,this.infoForFacet=null,this._createTabs([]),this.elements.superModal=new u({renderTo:this.container})}var d={className:"TopButtonValid",emphasize:"primary",setAttribute:{name:"TopButtonValid"},clickCallback:function(){t._saveAllFacets()}};if(!0===t.options.updateSession)d.label=v.get("EP_OK"),this.elements.boutonValid=m(d);else{d.label=v.get("EP_Ok"),this.elements.boutonValid=m(d)}require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],function(e){v.get("EP_Add")})},_createTabs:function(e){var t=this;!0===this.options.showFacets&&(this.elements.tabs&&this.elements.tabs.getTabCount()>0&&(this.elements.tabs.destroy(),this.elements.tabs=null),this.elements.tabs||(this.elements.tabs=new h({displayStyle:"strip",centeredFlag:!0,showComboBoxFlag:!0,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1}),this.elements.tabs.touchMode=o.isTouchDevice(),this.elements.tabs.onSelectTab(function(e){if(void 0!==e&&void 0!==e.index&&e.index>=0){var i=t.elements.tabs.getValueByIndex(e.index);t._switchFacet(i)}})),(e=e||this._lFacets).forEach(function(e){var i=t.elements.tabs.add({label:!0===t.options.facetLabel?e.facet.text:void 0,value:e.facet.name,allowClosableFlag:!1,icon:{iconName:e.facet.icon,fontIconFamily:1}});i.getModel().tooltipInfos=new f({shortHelp:e.facet.text,mouseRelativePosition:!1}),i.getContent().setAttribute("tab_name",e.facet.name)}),e.length>1?this.elements.tabs.show():this.elements.tabs.hide())},saveClassificationFacet:function(e,t,i,n){var s=this;this._lFacets.forEach(function(a){if("classificationAttiProp"===a.facet.name){var o=s._getFacetContent(a);o&&o.onSave(e,t,i,n)}})},_loadExtensions:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&!1!==t._isVisible&&i.getTabId()==e.currentFacetName&&i.getExtensions()})},checkChangeAuthorized:function(e,t){!0===this.options.warningOnUnsaved&&this._checkSaveForAllFacets();e.call(this,!0)},_checkSaveForAllFacets:function(){var e=this,t=!1;return this._lFacets.every(function(i){var n=e._getFacetContent(i);return n&&!1!==i._isVisible&&(t=!n.nothingToSave()),!t}),t},getSharedContext:function(){return this._sharedContext},setSharedContext:function(e){this._sharedContext=e,this.onRefresh()},getContainer:function(){return this.elements.container},getMainTable:function(){return this.elements.bottomArea},getIdentityCardUI:function(){return this.elements.topTable},getCollapseICPreferenceName:function(){return i.COLLAPSE_IC_PREFERENCE.name},destroyComponent:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&i.destroyComponent()}),this.elements.tabs.destroy()},getOptimalSize:function(){var e=this._getCurrentFacetContent(),t=this._getSizeTopTable(),i={width:0,height:0};return e&&((i=e.getOptimalSize()).height+=t.height),i},_getSizeTopTable:function(){var e=this.elements.topTable.getSize();return"none"===this.elements.topTable.getStyle("display")&&(e={height:0,width:0}),e},_getThumbnailDiv:function(){return this.thumbnail||(this.thumbnail=this.elements.container.getElement(".thumbnail-section")),this.thumbnail},_refreshCurrentFacet:function(){var e=this._getCurrentSelectedFacet(),t=this._getFacetContent(e);t&&t.onRefresh()},onRefresh:function(){var e=this,t=this._getCurrentSelectedFacet();this._refreshCurrentFacet(),this._lFacets.forEach(function(i){(!0===i.alwaysCalled&&!1!==i._isVisible||!0===i.calledIfVisible&&!0===i._isVisible)&&e._getFacetName(i)!==e._getFacetName(t)&&e._loadFacet(i,!1,function(){var t=e._getFacetContent(i);t&&t.onRefresh()})})},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize(),t=!0!==this.options.noThumbnail&&e.height>=300;this.elements.postIdCard&&this.elements.postIdCard.showThumbnail("height",t)},onResize:function(e){var t=this._getCurrentFacetContent();t&&t.onResize(),this._manageThumbnailDisplay(),this.elements.postIdCard&&this.elements.postIdCard.onResize()},_getFacetFromName:function(e){var t=null;return this._lFacets.every(function(i){return i.facet&&i.facet.name===e&&(t=i),!t}),t},getFacetContent:function(e){var t=this._getFacetFromName(e);return t?this._getFacetContent(t):null},_getFacetContent:function(e){return e&&e.content&&"object"==typeof e.content?e.content:null},_getCurrentFacetContent:function(){var e=this._getCurrentSelectedFacet();return e?this._getFacetContent(e):null},_getCurrentSelectedFacet:function(){var e=null,t=null;if(this.currentFacetName&&this.options.showFacets)(e=this.currentFacetName)&&this._lFacets.every(function(i){return i.facet&&i.facet.name===e&&(t=i),!t});else{var i=null;this._lFacets.length>0&&(i=this._lFacets[0],this._lFacets.every(function(e){var t=e.alwaysVisible;return t&&(i=e),!t})),t=i}return t},_updateFacets:function(){var e=this._getCurrentFacetContent();e&&e.display()},_hideAllFacetsContent:function(e){var t=this,i=e?this._getFacetName(e):null;this._lFacets.forEach(function(e){var n=t._getFacetContent(e);n&&t._getFacetName(e)!==i&&n.hide()})},_manageFacetLaunching:function(e){var t=++window.top.perfoIncrem;window.top.performance.mark("start_launchFacets:"+t);var i=this,n=this._getCurrentSelectedFacet(),s=this.getSharedContext();!0!==e&&this._launchFacet(),window.top.performance.mark("start_Iterate:"+t);var a=i._getFacetName(n);this.currentFacetName=a,this._lFacets.forEach(function(e){if((!0===e.alwaysCalled&&!1!==e._isVisible||!0===e.calledIfVisible&&!0===e._isVisible)&&i._getFacetName(e)!==a){var t=++window.top.perfoIncrem;window.top.performance.mark("start_loadFacet:"+t),i._loadFacet(e,!1,function(){window.top.performance.mark("end_loadFacet:"+t);var n=i._getFacetContent(e);n&&n.setContext(s);var a=i._getCurrentSelectedFacet();i._getFacetName(a)===i._getFacetName(e)&&i.__launchFacet(a)})}}),window.top.performance.mark("end_Iterate:"+t),window.top.performance.mark("end_launchFacets:"+t)},_launchFacet:function(){var e=this,t=this._getCurrentSelectedFacet();return this._hideAllFacetsContent(t),this._loadFacet(t,!0,function(){e.__launchFacet(t)}),t},_loadFacet:function(e,t,i){var n=this;if(e&&"loading"!==e.content)if(e.content)i.call(n);else{e.content="loading";var s=++window.top.perfoIncrem;window.top.performance.mark("start_prereqFacet:"+s),function(e,t){var i=[],n=[];e.forEach(function(e){var t=_[e];t?n.push(t):i.push(e)}),i.length>0?require(i,function(){for(var s=0;s<arguments.length;s++)e[i[s]]=arguments[s],n.push(arguments[s]);t.apply(null,n)}):t.apply(null,n)}([e.require],function(a){window.top.performance.mark("end_prereqFacet:"+s),e.content=null;var r=n._getCurrentSelectedFacet(),l=n._getFacetName(e)===n._getFacetName(r);if(!t||l){var c=e.options?e.options:{};if(Object.keys(c).length>0){var u=n.infoForFacet;if(c.infoForFacet,null!=u&&(e.options.infoForFacet=u),void 0===c.tenant||null===c.tenant){var d=n._getTenant();null===d&&(d=o.getTenantID()),e.options.tenant=d}}var h=c.events?c.events:{};h.onNotification=function(e){n._addNotif(e)},h.onEvent=function(e){n._manageEvent(e)},c.events=h,e.options=c,e.options.tabId=e.facet.name,e.options.eventThread=n.options.eventThread+"."+e.facet.name,e.content=new a(e.options,n._sharedOptions);var f=e.content.getUI(),p="function"==typeof f.addClassName?f:f.container?f.container:f.elements?f.elements.container:null;p&&p.addClassName("ClassifAttTabContainer Classif_tab_"+e.facet.name),e.content.getUI().inject(n.elements.bottomArea),l||e.content.hide(),n.publishEvt("classifAttributeLoaded",e),i.call(n)}})}},_switchSave:function(e){e?(this.elements.boutonValid.show(),this.elements.boutonAdd&&(this.elements.boutonAdd.disabled=!0)):(this.elements.boutonValid.hide(),this.elements.boutonAdd&&(this.elements.boutonAdd.disabled=!1))},_switchAdd:function(e){e?!0===this.options.updateSession?this.elements.boutonAdd&&this.elements.boutonAdd.hide():this.elements.boutonAdd&&this.elements.boutonAdd.show():this.elements.boutonAdd&&this.elements.boutonAdd.hide()},_manageActionVisibility:function(){var e=this,t=this._getCurrentSelectedFacet();(i=t?t.actions:null)&&i.forEach(function(i){var n=i;"object"==typeof i&&(n=i.name);var s=e._getFacetContent(t);s&&("pencil"!==n?s.isActionAvailable(n):"pencil"===n&&!0===e._RWAccess&&s.isActionAvailable(n))});var i=this.options.actions;this.elements.postIdCard&&i&&i.length>0&&this.elements.postIdCard.setActions(i)},_manageEvent:function(e){var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);if("switchSave"===e.eventID){var n=e.value;!0!==n&&(n=this._checkSaveForAllFacets()),this._switchSave(n)}else if("switchAdd"===e.eventID){var s=e.value;this._switchAdd(s)}else if("switchLoader"===e.eventID){var a=e.value,o=this.loaderFacetList.indexOf(e.facet);!0===a&&o<0?this.loaderFacetList.push(e.facet):!1===a&&o>=0&&this.loaderFacetList.splice(o,1),this.loaderFacetList.length>0?this._displayLoadingArea():this._hideLoadingArea()}else e.facet===i&&"updateActions"===e.eventID?this._manageActionVisibility():"updateRWA"===e.eventID&&(this._updateRWA(e.value),this._manageActionVisibility())},_updateRWA:function(e){this._RWAccess=e},_hideLoadingArea:function(){},_displayLoadingArea:function(){},__launchFacet:function(e){var t=++window.top.perfoIncrem,i=this._getFacetContent(e);i&&(!0===this.options.showTopBar?this.elements.globalDiv.addClassName("withMenuBar"):this.elements.globalDiv.removeClassName("withMenuBar"),window.top.performance.mark("start_displayFacets:"+t),i.display(this.getSharedContext()),window.top.performance.mark("end_displayFacets:"+t),this._manageActionVisibility())},_getFacetName:function(e){return e&&e.facet?e.facet.name:""},_updateThumbnail:function(e,t){this.elements.postIdCard&&this.elements.postIdCard.changeThumbnail(e,t)},clearIdentityCard:function(){this.elements.postIdCard&&this.elements.postIdCard.clearValues()},getIdentityCard:function(){return this.elements.postIdCard},selectFacet:function(e){var t=this._getFacetFromName(e);if(this.elements.tabs&&t&&!1!==t._isVisible){var i=this.elements.tabs.getButtonFromValue(e);i&&(i.setProperties({checkFlag:!0}),this._switchFacet(e))}},clearPanel:function(){this._hideAllFacetsContent()},hideMainComponent:function(){this.elements.mainInterface.hide()},showMainComponent:function(){this.elements.mainInterface.show()},_manageFacetVisibility:function(){var e=this;this._hideAllFacets();var t=++window.top.perfoIncrem;window.top.performance.mark("start_facetVisibility:"+t);var i=new a(["B","C"],function(){var i=this.getAnswer("B"),n=this.getAnswer("C"),s=e._facetCheck(this);if(!0===s.success){var a=e._getCurrentSelectedFacet();this.currentFacetName=e._getFacetName(a);var o=!0,r=null,l=!1;e._lFacets.forEach(function(t){var c=t.facet.name,u=a&&e._getFacetName(a)===c,d=t._isVisible||!0===t.alwaysVisible;d&&t.services&&t.services.forEach(function(e){i[e]||(d=!1)}),d&&t.roles&&(d=!1,t.roles.forEach(function(e){n.indexOf(e)>=0&&(d=!0)})),!r&&d&&(r=c),d&&u&&(o=!1),t._isVisible=d,"iproperties"===c&&(t._isVisible=!1),!0===s.refreshCurrent&&u&&!o&&(l=!0)}),e._facetVisibilityUpdate(),o&&e.selectFacet(r),!l&&s.refreshAction&&e._manageActionVisibility(),window.top.performance.mark("end_facetVisibility:"+t),e._manageFacetLaunching(!l)}});if(!0===e._queryFacets(i)){var n=e._getTenant();window.top.performance.mark("start_visibilityUrl"),r.getServices(n,function(e){window.top.performance.mark("end_visibilityUrl"),i.setAnswer("B",e)}),window.top.performance.mark("start_visibilityRole"),r.getRoles(n,function(e){window.top.performance.mark("end_visibilityRole"),i.setAnswer("C",e)})}},_getTenant:function(){return o.getTenantID()},_queryFacets:function(e){return!0},_facetCheck:function(e){return this._lFacets.forEach(function(e){e._isVisible=!0}),{success:!0}},_getPriorityFacetName:function(){var e=null;null===e&&(null!=(t=this.defaultFacetName)&&""!==t&&(e=t));if(null===e&&this.currentFacetName&&this.options.showFacets&&(e=this.currentFacetName),null===e){if(null!==this.options)var t=this.options.defaultFacetName;null!=t&&""!==t&&(e=t)}return null===e&&(e="properties"),e},_facetVisibilityUpdate:function(){var e=this;if(this.elements.tabs){var t=this._getPriorityFacetName(),i=e._getFacetFromName(t),n=this._getCurrentSelectedFacet();i!==n&&(n=i);var s=null,a=!1,o=[];this._lFacets.forEach(function(t){!1!==t._isVisible&&!1!==t.visible&&(!0===e.options.updateSession?"properties"===t.facet.name&&o.push(t):o.push(t),n===t&&(null===s&&(s=t),a=!0))}),null===s&&this._lFacets.forEach(function(e){!1!==e._isVisible&&!1!==e.visible&&null===s&&(s=e)}),this._createTabs(o),a&&n.content&&n.content.display?(this.selectFacet(n.facet.name),n.content.display(this.getSharedContext())):s&&this.selectFacet(s.facet.name)}},removeFacets:function(e){var t=[],i=this._getCurrentSelectedFacet(),n=!1;this._lFacets.forEach(function(s){e.indexOf(s.facet.name)<0?t.push(s):i&&i.facet.name===s.facet.name&&(n=!0)}),this._lFacets=t,this._facetVisibilityUpdate(),n&&this._manageFacetLaunching()},getOrAddFacets:function(e){var t=this,i=[];e.forEach(function(e){t._getFacetFromName(e.facet.name)||i.push(e)}),this.addFacets(i)},addFacets:function(e){if(e&&(!Array.isArray(e)||0!==e.length)){var t=this,i=!0;if(e&&Array.isArray(e)){var n={};t._lFacets.forEach(function(e){e.facet&&(n[e.facet.name]=!0)}),e.forEach(function(e){e.facet&&!n[e.facet.name]&&(e._isVisible=!0===e.alwaysVisible,i=i&&e._isVisible,void 0!==e.position?t._lFacets.splice(Math.min(e.position,Object.keys(t._lFacets).length-1),0,e):t._lFacets.push(e))})}i?this._facetVisibilityUpdate():this._manageFacetVisibility()}},_hideAllFacets:function(){this._createTabs([])},_isFacetAuthorized:function(e){this._getCurrentModelType();var t=this._getFacetFromName(e);return t&&!1!==t._isVisible},changeAttributes:function(e){var t=this._getCurrentFacetContent();null!=t&&t.changeAttributes(e)}})}),define("DS/ClassificationProp/UI/IDCardManager",["DS/ClassificationProp/UI/IDCardSkeleton","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/ClassificationProp/comm/DistantAjax","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropModelMerge","DS/ClassificationProp/models/ClassifPropAttributeModel","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],function(e,t,i,n,s,a,o,r,l){"use strict";return window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0,e.extend({_lOccurrences:[],_faceVisibilityHandler:null,defaultOptions:{multiselection:t.MULTISEL_STD},init:function(e,t){this._lOccurrences=[],this._faceVisibilityHandler={handle:null},this.sourceAppId=t.sourceAppId,this._parent(e,t)},getModels:function(){var e=this.getOccurrences(),i=[];return e&&e.forEach(function(e){var n=e.getModel(t.MODEL_INIT);n&&i.push(n)}),i},notifyClose:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&"function"==typeof i.onClose&&i.onClose()})},getModel:function(e,t){var i=null;return(t?t.getAllModels(!0):this.getModels()).every(function(t){return e!==t.get("objectId")||(i=t,!1)}),i},_getFirstFacetModel:function(e){var t=null,i=this._getFirstOccurrence();return i&&(t=i.getModel(e)),t},_getFirstInitModel:function(){return this._getFirstFacetModel(t.MODEL_INIT)},_getFirstPropertiesModel:function(){return this._getFirstFacetModel(t.FACET_PROPERTIES)},getOccurrences:function(){return this._lOccurrences},_getFirstOccurrence:function(){return this._lOccurrences.length>0?this._lOccurrences[0]:null},getSharedContext:function(){return this._getFirstOccurrence()},setOccurrences:function(e){var i=window.top.perfoIncrem++;window.top.performance.mark("start_setModelSkeleton:"+i);var n=this;this._clearAllFacetsModels(),this.modelHasChanged=!0;var s=e.length<=0,a=null;if(s||this.options.multiselection===t.MULTISEL_NO&&e.length>1)a=l.get(s?"NoItemSelected":"TooManyObjectSelected");else if(e.length>1&&this.options.multiselection===t.MULTISEL_MERGE){var o,r=(o=e[0]).getModel(t.MODEL_INIT);if(r){var c=r.getMergingModels(),u=null,d=null;for(var h in c){var f=c[h],p=f.get("tenant"),m=f.get("source");if(null===u?u=p:u!==p&&(a=l.get("DifferentTenantsNotSupported")),null===d?d=m:d!==m&&(a=l.get("DifferentSourcesNotSupported")),null!==a)break}}}null!==a?(this.clearIdentityCard(),this.showMainErrorArea(a),this.dispatchEvent("onTitleChanged",""),this.hideMainComponent(),this._lOccurrences=[]):(this.showMainComponent(),(o=e[0]).addEvent("onChange:"+t.FACET_PROPERTIES,function(){n._initializeIDCard(o)}),this._initializeIDCard(o),this._lOccurrences=e);window.top.performance.mark("end_setModelSkeleton:"+i),this._manageFacetVisibility(),this._manageFacetLaunching()},__queryFacets:function(e){var t=this;this._faceVisibilityHandler.handle&&(this._faceVisibilityHandler.handle.cancel(),this._faceVisibilityHandler.handle=null);var i=this._getFirstInitModel();if(i){var s=[],a=!1;t._lFacets.forEach(function(e){i.isMergedModel()&&!e.supportMerge||(s.push({name:e.facet.name,inheritance:e.inheritance}),a=a||e.services&&e.services.length>0)}),n.launchFacetsVisibility(i,s,{context:this.options.context,handleRequest:this._faceVisibilityHandler,onComplete:function(i){i&&!1!==i.success?e.setAnswer("A",i):t._addNotif({msg:i?i.error.message:l["Error Server"],eventID:"error"})}},void 0,t.sourceAppId)}},_queryFacets:function(e){var t=this;e.addRequest("A");var n=this._getFirstInitModel();if(n){var s=i.getServiceForModel(n);n.get("isTransient")||!0!==s.modelNeeded?t.__queryFacets(e):(e.addRequest("Fed"),require(["DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests"],function(i){i.fillModel({onComplete:function(i){var n=i.get("ds6w:type");if(n=n||i.get("ds6w:what/ds6w:type")){var s=n.get("valueDB");i.set("ds6w:what/ds6w:type_value",s)}i.set("preview_url",i.get("previewUrl")),t.__queryFacets(e),e.setAnswer("Fed",!0)}},n)}))}return!!n},_facetCheck:function(e){var i=this,n=e.getAnswer("A"),r=e.getAnswer("Fed"),l=n.id,c=n.facets,u=i._getFirstInitModel(),d=i._getCurrentSelectedFacet(),h=null!==u&&u.get("objectId")===l,f=null,p=!!r,m=!1;if(h&&n.notification)return this.clearIdentityCard(),this.showMainErrorArea(n.notification.message),this.hideMainComponent(),{success:!1};if(h){var g=i._getFirstOccurrence(),v=n.mains,_=v?v[l]:null,C=l,b="empty",S=null;_&&(C=_.id,b=_.type,S=_.metatype?"bus"==_.metatype?t.METATYPE_BUS:t.METATYPE_REL:t.METATYPE_UNKNOWN);var E=!1,y={};if(f=g.getModel(t.FACET_PROPERTIES),u.isMergedModel()){C=l,b="mergedObject";var A=u.getMergingModels(),I=f&&f.isMergedModel()?f.getMergingModels():null;for(var M in A){var T=A[M],P=v[M],D=null!=P&&P.id?P.id:M,w=t.METATYPE_UNKNOWN;if(w=P.metatype?"bus"==P.metatype?t.METATYPE_BUS:t.METATYPE_REL:w,b=P?P.type:"",!(I?I[D]:null)&&D!==M)E=!0,(O=UWA.clone(T.getOptions())).objectId=D,T=new s(O);T.set("metatype",w),T.set(t.MODEL_DS_ATTR+"type",{valueDB:b,isTransient:!0});var F=w===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;T.set(t.MODEL_DS_ATTR+"types",{valueDB:F?F[b]:null,isTransient:!0}),y[D]=T}f=g.getModel(t.FACET_PROPERTIES)}else null===f&&C===l&&(f=u);if(E||!f){var O,R=f||u,U=R.getAllAttributes();!0!==R.get("isTransient")&&(U=R.getOptions()),(O=UWA.clone(U)).objectId=C,S&&(O.metatype=S),O[t.MODEL_DS_ATTR+"type"]={valueDB:b,isTransient:!0};F=w===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;for(var x in O[t.MODEL_DS_ATTR+"types"]={valueDB:F?F[b]:null,isTransient:!0},O)U[x]instanceof o&&(O[x]=new o(O[x]));u.isMergedModel()?(f=new a(O)).setMergingModels(y):f=new s(O)}else if(f){f.set(t.MODEL_DS_ATTR+"type",{valueDB:b,isTransient:!0});F=w===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;f.set(t.MODEL_DS_ATTR+"types",{valueDB:F?F[b]:null,isTransient:!0})}g.setModel(t.FACET_PROPERTIES,f);c=n.facets;i._lFacets.forEach(function(e){var t=e.facet.name,n=c[t],s=n&&(!0===n||!0===n.available);(e._isVisible=s,!0===e.inheritance&&i._getFacetName(d)===t&&(m=!0),n&&n.information)&&(g.setOptions(t,n.information),i._getFacetName(d)===t&&(p=!0))})}return{success:!!f,refreshCurrent:p,refreshAction:m}},_getTenant:function(){var e=this._getFirstInitModel(),t=null;return e&&(t=e.getTenant()?e.getTenant():this._parent()),t},_clearAllFacetsModels:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&i.setOccurrence(null)})},_initializeIDCard:function(e){var i=this;if(e){var n=e.getModel(t.FACET_PROPERTIES);n&&(this._updateThumbnailForModel(n),this.elements.postIdCard&&this.elements.postIdCard.fillFromModel(n),this.elements.postIdCard&&n.addEvent("onChangeAttributes",function(e,t){var n=!1;t.forEach(function(t){t&&t instanceof o&&(n=i.elements.postIdCard.setValueForSection(e,t)||n)})}),n.addEvent("onChange:label",function(){var e=n?n.getComputedTitle():"";i.dispatchEvent("onTitleChanged",e),n.get(t.MODEL_DS_ATTR+"label")&&i.elements.postIdCard&&i.elements.postIdCard.setValueForSection(n,n.get(t.MODEL_DS_ATTR+"label"))}),n.addEvent("onChange:previewUrl",function(){i._updateThumbnailForModel(this)}),n.addEvent("onChange:type_icon_url",function(){i._updateThumbnailForModel(this)}))}},getTitle:function(){var e=this._getFirstOccurrence(),i=e?e.getModel(t.FACET_PROPERTIES):null;return i?i.getComputedTitle():""},_updateThumbnailForModel:function(e){if(!0!==this.options.noThumbnail){var i=e.get("previewUrl")?e.get("previewUrl"):e.get("type_icon_url");i=i||"";var n=this._isFacetAuthorized(t.FACET_VIEWS)||e.get("activeThumbnail");this._updateThumbnail(i,n)}},_getCurrentModelType:function(){var e=this.getModels(),t=e.length>0?e[0].get("type"):"",i=t;return t&&"object"==typeof t&&(i=(i=t.get("valueDB"))||t.get("value")),i}})});