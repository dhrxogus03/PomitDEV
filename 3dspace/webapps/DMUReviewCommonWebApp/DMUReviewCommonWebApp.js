define("DS/DMUReviewCommonWebApp/DMUCommonWebAppController",["UWA/Class","DS/DMUControls/EXPNotify","DS/DMUReadPersistence/DMULoadMarkupServices","DS/DMUBaseExperience/DMUContextManager","UWA/Utils","DS/DMUBaseExperience/EXPManagerSet","DS/DMUPlaySlide/controllers/DMUSlideShowController","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CoreEvents/ModelEvents","DS/DMUBaseUIControllers/DMU2DSheetManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/PADUtils/PADUtilsServices","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUPersistence/DMUDOSThumbnailServices","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUReadPersistence/DMULoadingContextController","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/DMUReadPersistence/DMUWebServicesUtils","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADProgressBar","DS/PADServices/utils/GlobalModelEvents","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarkerFactory","DS/DMUPlayMarker/DMUMarkerServices","DS/DMUPlaySection/DMUToolsSection","DS/DMUControls/DMUWarningPanel","DS/Selection/PSOManager","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUReviewController","DS/CATWebUXComponents/CATWebUXUtils","i18n!DS/DMUBaseUI/assets/nls/DMUBaseUI","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/DMUControls/DMUToolsSave","DS/DMUBaseUIControllers/DMUReqCompareController","i18n!DS/DMUReviewCommonWebApp/assets/nls/DMUReviewCommonWebApp","i18n!DS/CATWebUXTIC/assets/nls/CATWebUXTICCmdAdapt"],function(e,t,i,n,a,o,r,l,s,d,c,u,g,p,m,f,D,v,h,w,C,S,b,y,M,R,P,A,V,x,U,I,k,E,F,O,T,_,W,L,N,j,q,B,X,H){"use strict";return e.extend({init:function(G,J){this._parent(G);var z,Q,K,Y,$,Z=this,ee=!1,te=J,ie=(G||{}).ctxViewer,ne=n.getEventsController({viewer:ie.getViewer()}),ae=!1,oe=new g,re={},le={},se=null,de={},ce={};let ue,ge,pe,me,fe=null,De=!1;var ve,he,we,Ce,Se,be,ye,Me,Re,Pe,Ae,Ve,xe,Ue,Ie,ke,Ee,Fe,Oe,Te=!1,_e=!1;let We,Le,Ne=!1,je=!1,qe=!0;const Be=["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight"];function Xe(e,i){Le&&(Le.destroy(),Le=null),Le=new t({body:ie.getFrameWindow().getUIFrame(),type:e,message:i})}w.notify({notifId:"review.init"}),this.setSlideShowController=function(e){z=e},this.setValidatedObjCreationFlag=function(e){ae=e};var He=function(){return Q||(Q=_.giveDMUSlidesController({context:ie.getFrameWindow()})),Q};function Ge(e){const t=W.giveDMUReviewController({context:ie.getFrameWindow()});let i,a,r;if(ie.getExecutionContext){["Marker","Measure","Markup","Slide","Check","Highlight","Section"].forEach(e=>{n.setAuthoringFeatureTypes(e)})}if("R3V"===te?(Ee&&clearTimeout(Ee),Ee=setTimeout(function(){if(Ee=null,!ie)return;var e,r=n.getReviewContext({context:ie});e=["DMU2DCompareCmdHdr"],a=ee&&0!==ie.getViewer().getVisibleSpace()&&d.getRoots(ie).length&&(!r||r&&!r.isReadOnly())&&Ce&&("Drawing"===Oe||"DIFSheet"===Oe||"DIFLayout"===Oe);let l=!0;r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getActiveFlag()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getMarkupOwner()&&!r.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),Z._applyFlag(e,a&&l),e=["measureCmdHdr","sectionCmdHdr","3DcompareCmdHdr","thicknessCmdHdr","LockUnlockSectionHdr"],a=ee&&0!==ie.getViewer().getVisibleSpace()&&d.getRoots(ie).length&&(!r||r&&!r.isReadOnly()),l=!0,r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getActiveFlag()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getMarkupOwner()&&!r.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),Z._applyFlag(e,a&&l),a=(a||!a&&!d.getRoots(ie).length)&&r&&!r.isReadOnly()&&r.getCurrentSessionMarkup()&&!r.getCurrentSessionMarkup().isReadOnly();let s=r&&r.getValidation()?r.getValidation().getCurrentMarkup():null;for(;s&&"Markup"!==s.getValType();)s=s.getParentRepRef().getParent();l=!0,s&&!1===s.isWebMarkup()&&(l=!1),t&&(i=t.getRestrictions(s));let c=!0;r&&r.getValidation()&&(!r.getValidation().getModifyAccessFlag()||"Activated"===r.getValidation().getRestrictedEditionFlag()&&i&&s&&!i.markup.canEdit)&&(c=!1),e=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],Z._applyFlag(e,a&&l&&c),s=r&&r.getValidation()?r.getValidation().getCurrentMarkup():null,t&&(i=t.getRestrictions(s)),c=!0,r&&r.getValidation()&&(!r.getValidation().getModifyAccessFlag()||"Activated"===r.getValidation().getRestrictedEditionFlag()&&i&&s&&("Markup"===s.getValType()&&!i.markup.canEdit||"Reply"===s.getValType()&&!i.reply.canEdit))&&(c=!1),a=a&&r&&!r.isReadOnly()&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getActiveFlag()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getCurrentSlide()&&r.getCurrentSessionMarkup().getCurrentSlide().isVisible()&&!r.getCurrentSessionMarkup().isReadOnly(),e=["markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMUMarkerCloudCreateHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","DMUCreateValidatedMkrHdr","DMUCreateRejectedMkrHdr","markerArrowCmdHdr"],Z._applyFlag(e,a&&c),a=ee&&0!==ie.getViewer().getVisibleSpace()&&r&&r.getValidation()&&!r.isReadOnly(),e=["CATWebUXGenerateIssueTemplateHdr","CATWebUXGenerateCAHdr"],l=!0,r&&r.getValidation()&&"Activated"===r.getValidation().getRestrictedEditionFlag()&&i&&!i.highlight.canEditDef&&(l=!1),Z._applyFlag(e,a&&l),a=ee&&0!==ie.getViewer().getVisibleSpace()&&r&&r.getValidation()&&!r.isReadOnly()&&!De,e=["CATWebUXGenerateIssueHdr"],Z._applyFlag(e,a&&l),a=a&&r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getActiveFlag()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getCurrentSlide()&&r.getCurrentSessionMarkup().getCurrentSlide().isVisible(),e=["DMUAddHighlightHdr"],Z._applyFlag(e,a&&l),a=ee&&0!==ie.getViewer().getVisibleSpace()&&r&&r.getValidation()&&!r.isReadOnly(),l=!0,(r&&r.getValidation()&&(!r.getValidation().getModifyAccessFlag()||"Activated"===r.getValidation().getRestrictedEditionFlag()&&("inProgress"!==r.getValidation().getStatus()||"IN_WORK"!==r.getValidation().getCurrentState()))||i&&!i.markup.canCreate)&&(l=!1),e=["DMUReviewMarkupHdr","DMUReplyCmdHdr"],Z._applyFlag(e,a&&l),l=!0,r&&r.getValidation()&&(!r.getValidation().getModifyAccessFlag()||"Activated"===r.getValidation().getRestrictedEditionFlag()&&i&&!i.check.canCreate)&&(l=!1),e=["DMUAddCheckHdr"],Z._applyFlag(e,a&&l),a=ee&&0!==ie.getViewer().getVisibleSpace()&&d.getRoots(ie).length&&r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getSlides().length>0||"Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we,e=["CATWebUXSlideShowHdr"],Z._applyFlag(e,a),a=ee&&(!r||!r.isReadOnly())&&("Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we)&&ve&&ve.documentHasBookmarks(),e=["WebDocumentBookmarksPanelCmdHdr"],Z._applyFlag(e,a),a=ee&&("Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we)&&ve&&ve.documentHasMultipleElements(),e=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],Z._applyFlag(e,a),a=ee&&("Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we)&&ve&&"Document"===ve.getDocumentType(),e=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],Z._applyFlag(e,a);var u=o.getManager({name:"DMUUserExperienceManager",context:ie.getFrameWindow()});u&&u.refreshCommandsAvailability()})):(Ee&&clearTimeout(Ee),Ee=setTimeout(function(){if(Ee=null,!ie)return;var e,r=n.getReviewContext({context:ie});e=["DMU2DCompareCmdHdr"],a=ee&&0!==ie.getViewer().getVisibleSpace()&&d.getRoots(ie).length&&(!r||r&&!r.isReadOnly())&&("Drawing"===Oe||"DIFSheet"===Oe||"DIFLayout"===Oe);let l=!0;r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getActiveFlag()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getMarkupOwner()&&!r.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),Z._applyFlag(e,a&&l),e=["measureCmdHdr","sectionCmdHdr","3DcompareCmdHdr","thicknessCmdHdr","LockUnlockSectionHdr"],a=ee&&0!==ie.getViewer().getVisibleSpace()&&d.getRoots(ie).length&&(!r||r&&!r.isReadOnly()),l=!0,r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getActiveFlag()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getMarkupOwner()&&!r.getCurrentSessionMarkup().getMarkupOwner().isWebMarkup()&&(l=!1),Z._applyFlag(e,a&&l),a=(a||!a&&!d.getRoots(ie).length)&&r&&!r.isReadOnly()&&r.getCurrentSessionMarkup()&&!r.getCurrentSessionMarkup().isReadOnly();let s=r&&r.getValidation()?r.getValidation().getCurrentMarkup():null;for(;s&&"Markup"!==s.getValType();)s=s.getParentRepRef().getParent();l=!0,s&&!1===s.isWebMarkup()&&(l=!1),t&&(i=t.getRestrictions(s));let c=!0;r&&r.getValidation()&&(!r.getValidation().getModifyAccessFlag()||"Activated"===r.getValidation().getRestrictedEditionFlag()&&i&&!i.markup.canEdit)&&(c=!1),e=["DMUEditFormatsHdr","slideCmdHdr","DMUExportReviewAsPdfHdr"],Z._applyFlag(e,a&&l&&c),s=r&&r.getValidation()?r.getValidation().getCurrentMarkup():null,t&&(i=t.getRestrictions(s)),c=!0,r&&r.getValidation()&&(!r.getValidation().getModifyAccessFlag()||"Activated"===r.getValidation().getRestrictedEditionFlag()&&i&&s&&("Markup"===s.getValType()&&!i.markup.canEdit||"Reply"===s.getValType()&&!i.reply.canEdit))&&(c=!1),a=a&&r&&!r.isReadOnly()&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getActiveFlag()&&r.getCurrentSessionMarkup().isVisible()&&r.getCurrentSessionMarkup().getCurrentSlide()&&r.getCurrentSessionMarkup().getCurrentSlide().isVisible()&&!r.getCurrentSessionMarkup().isReadOnly(),e=["markerTextCmdHdr","markerPictureCmdHdr","marker2DTextCmdHdr","marker2DPictureCmdHdr","markerCircleCmdHdr","DMUMarkerCloudCreateHdr","DMU3DRectangleCmdHdr","DMUFreehandCmdHdr","DMUCommentCmdHdr","DMUCreateValidatedMkrHdr","DMUCreateRejectedMkrHdr","markerArrowCmdHdr"],Z._applyFlag(e,a&&c),a=d.getRoots(ie).length,e=["DMUReviewHdr"],Z._applyFlag(e,a),a=ee&&0!==ie.getViewer().getVisibleSpace()&&r&&r.getValidation()&&!r.isReadOnly(),e=["CATWebUXGenerateIssueTemplateHdr","CATWebUXGenerateCAHdr"],l=!0,r&&r.getValidation()&&"Activated"===r.getValidation().getRestrictedEditionFlag()&&i&&!i.highlight.canEditDef&&(l=!1),Z._applyFlag(e,a&&l),a=ee&&0!==ie.getViewer().getVisibleSpace()&&r&&r.getValidation()&&!r.isReadOnly()&&!De,e=["CATWebUXGenerateIssueHdr"],Z._applyFlag(e,a&&l),a=ee&&0!==ie.getViewer().getVisibleSpace()&&r&&r.getValidation()&&!r.isReadOnly(),l=!0,r&&r.getValidation()&&(!r.getValidation().getModifyAccessFlag()||"Activated"===r.getValidation().getRestrictedEditionFlag()&&("inProgress"!==r.getValidation().getStatus()||"IN_WORK"!==r.getValidation().getCurrentState())||i&&!i.markup.canCreate)&&(l=!1),e=["DMUReviewMarkupHdr","DMUReplyCmdHdr"],Z._applyFlag(e,a&&l),a=ee&&0!==ie.getViewer().getVisibleSpace()&&d.getRoots(ie).length&&r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getSlides().length>0||"Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we,e=["CATWebUXSlideShowHdr"],Z._applyFlag(e,a),a=ee&&(!r||!r.isReadOnly())&&("Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we)&&ve&&ve.documentHasBookmarks(),e=["WebDocumentBookmarksPanelCmdHdr"],Z._applyFlag(e,a),a=ee&&("Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we)&&ve&&ve.documentHasMultipleElements(),e=["WebDocumentPreviousPageCmdHdr","WebDocumentNextPageCmdHdr"],Z._applyFlag(e,a),a=ee&&("Document"===he||"Specification Report"===he||"Requirement"===we||"Requirement Specification"===we)&&ve&&"Document"===ve.getDocumentType(),e=["WebDocumentRotatePagesLeftCmdHdr","WebDocumentRotatePagesRightCmdHdr"],Z._applyFlag(e,a);var u=o.getManager({name:"DMUUserExperienceManager",context:ie.getFrameWindow()});u&&u.refreshCommandsAvailability()})),e&&e.removeRoot&&(r=!0),a="Specification Report"===he&&!r){let e=O.getCommandCheckHeader("RootPanel",ie.getCommandContext());e&&e.getState()&&e.setState(!1)}Z._applyFlag(["RootPanel"],!a)}function Je(){ne.fireEvent("onIssueTemplateOnlySet",De)}function ze(e){he!==e&&(he&&Se&&Se.removeApplicativeContainer(he),he=e,n.setCurrentReviewContext(he),Z.publish("onReviewContextModified",{type:he,onABReady:function(){Ge(),Se&&ie.getExecutionContext&&Se.initApplicativeContainer(he,{authoring:!0})}}),Se.initApplicativeContainer(he,{authoring:!0})),Ge()}function Qe(e,t){let i=[];d.getRoots(ie).forEach(n=>{const a=ie.getController().getRootStats(d.getNodeID(n))&&"r2vsurvey"===ie.getController().getRootStats(d.getNodeID(n)).serviceId?"R2V_FeatureState":d.getNodeType(n);e&&a===e||d.getNodeID(n)!==t&&("VPMReference"===e&&"R2V_FeatureState"===a||"R2V_FeatureState"===e&&"VPMReference"===a||i.push(d.getNodeID(n)))}),i.length&&ie.removeRoots({pids:i})}async function Ke(e){try{let t=await M.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function Ye(e){if(!ee||!e)return;var t,i;let o=B.giveReqCompareController({context:ie}),r=!!o&&o.isLoading();if(Oe=void 0,e.path?(t=d.getNodeID(e.path.getLastElement(!0)),i=ie.getController().getRootStats(t)&&"r2vsurvey"===ie.getController().getRootStats(t).serviceId?"R2V_FeatureState":d.getNodeType(e.path.getLastElement(!0))):e.docData&&(t=e.docData.objectId,i=e.docData.objectType),!t||!i)return;Oe=i,Ce&&Ce.getLoadedID()===t||(!ve||ve.getDocumentLoadedID()===t||_e||r||ve.clean2DDocument(),!ke||Te||r||ke.cleanCommentsPanel(),Ce&&Ce.clean()),be=null;var s=function(){ze("ITF")};var c=async function(){Qe("R2V_FeatureState",t),await async function(){const e=d.getRoots(ie);let t=!1;for(let i=0;i<e.length;i++){let n=d.getNodeType(e[i]),a=0;const o=await Ke(n);if(o.includes("VPMReference")||a===e.length-1)return o.includes("VPMReference")&&(t=!0),t;a++}}()||ze("R2V"),Ce.load({data:{serviceId:"r2vsurvey",objectParentType:"R2V_FeatureState",objectType:"R2V_FeatureState",objectId:t}})},u=function(){if("DIFLayout"===i||"DIFSheet"===i)ze("2DFL");else if("Drawing"===i){ze("2D"),_e||Qe(null,t);var e=setInterval(function(){var n,a,o,r;(1===ie.getRootBagPath().getChildrenPathes().length||_e&&2===ie.getRootBagPath().getChildrenPathes().length)&&(clearInterval(e),n=t,a=i,o=ie.getRootBagPath().getChildrenPathes()[ie.getRootBagPath().getChildrenPathes().length-1].getLastElement(!0),ve.load2DDocument({phyID:n,dataType:a,serverUrl:f.get3DSpaceUrl(),securityContext:R.getSetting("pad_security_ctx"),parentNode:o,is2DCompareActive:_e,onLoadingStarted:function(){P.on(),r=1},onComplete:function(){r&&(P.off(),r=0)},onFailure:function(){ie.removeRoots({pids:[n]}),ie.displayNotification({msg:X.fileWithNoSVG,eventID:"error"}),r&&(P.off(),r=0),ne&&"R3V"===te&&ne.fireEvent("on2DDocumentLoadFailure")}}))},100)}},g=function(){!Ce||"DXF"!==Ce.getLoadMarkupCtxType()&&"DWG"!==Ce.getLoadMarkupCtxType()?r||(ze(i),Qe(null,t)):(ze("2D"),Qe(null,t)),be=t};if("Drawing"===i||"DIFLayout"===i||"DIFSheet"===i&&e.path.getParentPath().isEqual(ie.getRootBagPath()))u(),we=i;else if("Document"===i||"Requirement"===i||"Requirement Specification"===i||"Specification Report"===i){g(),we=i;var p=n.getReviewContext({viewer:ie.getViewer()});if(p){const e=p.getValidation();if(e){var D=e.getLoadedRepRefs();if(D.length>0)for(let e=0;e<D.length;e++){var v=D[e].getMarkupContent();if(v&&!v.getCurrentSlide()&&0===v.getComments().length){var h=new l(ie,v);h.setAttributes([{name:"sID",value:v.computeNewID()},{name:"sUuid",value:a.getUUID()}]),h.updateEnvironmentOverload({target:p.getEnvironment(),state:p.getEnvironment().getEnvironmentInfo()}),v.addSlide(h),h&&v.setCurrentSlide(h)}}ke||(ke=m.getDMUCommentsController({context:ie.getFrameWindow(),commandContext:ie?ie.getCommandContext():null})),o&&!o.isLoading()&&ke.setVisibleFlag(!0)}}}else if(ie.getApplicativeData().getLoadedItfData&&ie.getApplicativeData().getLoadedItfData().data.length>0)s(),we="SIMItfSimulation";else if("DesignSight"===i)ze("MSR"),we="MSR";else if("R2V_FeatureState"===i)c(),we="R2V";else{const n=await Ke(i);n&&n.length&&-1!==n.indexOf("Drawing")&&e.path.getParentPath().isEqual(ie.getRootBagPath())?(i=we="Drawing",u()):n&&n.length&&-1!==n.indexOf("SIMItfSimulation")&&e.path.getParentPath().isEqual(ie.getRootBagPath())?(i=we="SIMItfSimulation",s()):n&&n.length&&(-1!==n.indexOf("Requirement")||-1!==n.indexOf("Requirement Specification"))?(i=-1!==n.indexOf("Requirement Specification")?"Requirement Specification":"Requirement",we="Requirement",g()):n&&n.length&&-1!==n.indexOf("Document")?(i=we="Document",g()):n&&n.length&&-1!==n.indexOf("R2V_FeatureState")?(c(),we="R2V"):Fe?ie.removeRoots({pids:[t]}):(Qe("VPMReference",t),ze("3D"))}Ge()}let $e;function Ze(){var e=n.getReviewContext({context:ie}),t=e?e.getValidation():null;if(t){let i=t.getAllRepRefs().filter(e=>{let t=e.getMarkupContent();if(t)return t.isDirty()&&!t.isReadOnly()&&!e.isBeingRemoved()});if(ee&&!Ve&&i&&i.length){if(!ie||!ee||Ve||!e)return;if(h.isProcessing())return $e&&(clearTimeout($e),$e=null),void($e=setTimeout(Ze,1e3));q.tryToSaveData({frameWindow:ie.getFrameWindow(),saveFunction:()=>new Promise((e,n)=>{let a=[],o=0;(i=t.getAllRepRefs().filter(e=>{let t=e.getMarkupContent();if(t)return t.isDirty()&&!t.isReadOnly()&&!e.isBeingRemoved()})).forEach(e=>a.push(function(e){return new Promise((t,i)=>{let n,a,o,r,l,s=null;!we||"Document"!==we&&"Specification Report"!==we||(l=Ce.getDocumentVersionInfos(),r=we,s=Ce.getLoadMarkupCtxType()),ie.getApplicativeData&&(ie.getApplicativeData(),ie.getApplicativeData().getLoadedItfData&&(n=ie.getApplicativeData().getLoadedItfData()).data.length&&(n.data[0].metricID&&(a=n.data[0].metricID),void 0!==n.loadMode&&(o=n.loadMode),r="SIMItfSimulation")),h.saveReviewMarkup({markupRepRefId:e,frmWindow:ie.getFrameWindow(),superType:r,documentType:s,listData:a,loadingInfos:o,documentVersionInfos:l,onSaveCompleted:t,onSaveFailed:i})})}(e.getPlmID()))),Promise.allSettled(a).then(t=>{t.forEach(e=>{"fulfilled"!==e.status&&"NoSaveNeeded"!==e.reason||o++}),o===a.length?e():n(new Error("One or more markups failed to save"))})})}).then(()=>{var e=n.giveEventsController({viewer:ie.getViewer()});e&&e.fireEvent("onReviewSaved")}).catch(()=>{var e=n.giveEventsController({viewer:ie.getViewer()});e&&e.fireEvent("onReviewSaveFailed")})}}}function et(){Ze(),Ge()}function tt(){const e=n.getReviewContext({context:ie});(e?e.getValidation():null)&&setTimeout(()=>{ie.toggleSOITimelinesUsability(!1)},1e3)}function it(e){if(!ee)return;Ve=!1,Ne=!1;var t=V.giveDMUSceneDisplayController({context:ie});const i=t=>{var i=n.getReviewContext({viewer:ie.getViewer()});if(i&&i.getValidation()&&"R3V"===te){var a=i.getValidation().getContext(),o={},r={};Ce&&(r=Ce.getSubContextInformations(e.id)),o.id=ie.getApplicativeData().getLoadedItfData&&ie.getApplicativeData().getLoadedItfData().data.length>0?ie.getApplicativeData().getLoadedItfData().data[0].isrID:e.id;const n=n=>{r&&r.id?(r.icon=n.icon,o.type=t):(o.label=n.label,o.icon=n.icon,o.type=n.type),h.updateReviewContext({ctxViewer:ie,validation:i.getValidation(),mainContext:o,subContext:r,onUpdateReviewContextCompleted:function(){if("DesignSight"!==t&&"DIFLayout"!==t&&"Requirement Specification"!==t){let t=i.getValidation().getContext()&&i.getValidation().getContext().getSubContextID()?i.getValidation().getContext().getSubContextID():e.id;h.updateValidatedObjectsList({fullPathRefs:[[t]],validatedObjects:[[t]],validatedId:i.getValidation().getValidated().getPlmID()?i.getValidation().getValidated().getPlmID():null,validatedToAdd:[[t]],referenceIds:[t],instanceIds:[t],instanceNames:[],updateMode:"add",onReviewCtxUpdateOrDropValidated:!0,ctxViewer:ie.getFrameWindow().getViewer(),onSaveValidatedObjectsFailed:function(){}})}},onUpdateReviewContextFailed:function(){}})};if(!a||a&&!a.getJsonContexts().length)if("R2V_FeatureState"===t){let e=setInterval(()=>{if(Ce&&Ce.getLoadedR2VInformations().length){clearInterval(e);let t=Ce.getLoadedR2VInformations()[0].info;n({label:t[0]["ds6w:label"],icon:t[0].icon,type:"R2V_FeatureState"})}},100)}else{let e=[];r&&r.id?e.push(r.id):e.push(o.id),ie.getController().getAttributes({ids:e,attributes:["ds6w:label","type_icon_url","ds6w:type"],callbacks:{onComplete:function(t){n({label:t[e[0]]["ds6w:label"],icon:t[e[0]].type_icon_url,type:t[e[0]]["ds6w:type"]})},onFailure:function(){}}})}}};if((!t||!t.getCurrentComparedObjectIDPaths()&&z&&z.getActiveState())&&z.setActiveState(!1),e.id===sessionStorage.getItem("DMU2DCompareTempRoot"))ie.removeRoots({pids:[sessionStorage.getItem("DMU2DCompareTempRoot")]}),sessionStorage.removeItem("DMU2DCompareTempRoot");else if(e.path){Ye({path:e.path}),i(d.getNodeType(e.path.getLastElement(!0))),be=null}else{var a=ie.getRootBagPath().externalPath[0].path.getChildrenPathes().length;if(a){var o=ie.getRootBagPath().externalPath[0].path.getChildrenPathes()[a-1];Ye({path:o}),i(d.getNodeType(o.getLastElement(!0)))}}}function nt(e){if(!ee)return;!ie.getRootBagPath().getChildrenPathes().length&&z&&z.getActiveState()&&z.setActiveState(!1);let t=B.giveReqCompareController({context:ie});if(!!t&&t.isLoading()||(ve&&(e&&e.id?ve.clean2DDocument(e):ve.clean2DDocument()),ke&&(ke.cleanCommentsPanel(),m.unreferenceDMUCommentsController({context:ie.getFrameWindow()}),ke=null)),Oe&&"R2V_FeatureState"===Oe&&ie.toggleSOITimelinesUsability(!0),ie.getRootBagPath().getChildrenPathes().length){var i=ie.getRootBagPath().externalPath[0].path.getChildrenPathes().length;let e;i&&(e=ie.getRootBagPath().externalPath[0].path.getChildrenPathes()[i-1]),Oe=d.getNodeType(e.getLastElement(!0))}else Ve=!0,n.setReviewContext({context:ie});Ce&&(Ce.clean(),Ce.updateLoadedR2VInformations(e.id,"remove")),Ge({removeRoot:!0})}function at(){ie.unsubscribe(re.onRootRemoved),re.onRootRemoved=-1}function ot(){re.onRootRemoved=ie.subscribe({event:"onRootRemoved"},nt)}var rt;function lt(e){rt=x.getNearPositionFrom2DCoordinates({x:e.clientX,y:e.clientY},ie.getViewer())}function st(e){ee&&Z&&e&&f.multiTenantMgt([e],d.getRoots(ie),function(t){if(!t.isMultiTenant){var i=n.getReviewContext({context:ie}),a=i?i.getCurrentSessionMarkup():null;if(!a||a.isReadOnly()||!a.getCurrentSlide())return;I.getDataFromRelatedId({type:"DMUMarker3DPicture",objectId:e.objectId,onComplete:function(t){var i=U.create3DMarker({viewer:ie.getViewer(),frameWindow:ie.getFrameWindow(),parent:a,date:Date.now(),objectId:e.objectId,shape:{type:"picture",pointingPoint:rt,data:t}});i&&(a.getCurrentSlide().addDMUObject(i),i.fireEvent("onDMUObjectInitialized",{dmuObject:i}))}})}})}function dt(e){ee&&Z&&e&&qe&&f.multiTenantMgt([e],d.getRoots(ie),function(t){t.isMultiTenant||Z.loadMarkupContext(e)})}this.loadReviewAfterRefresh=function(e){"_DMUValidationValidation"!==e.type&&"DMUValidationValidation"!==e.displayType||Z.loadContext(e,ee,"_DMUValidationValidation","refreshMode",!0,Z),"_DMUValidationExposedPresentation"===e.type&&Z.loadContext(e,ee,"_DMUValidationExposedPresentation","refreshMode",!0,Z)},this.loadContext=function(e,t,i,a){var o;t&&Z&&e&&(o=K&&K.objectId===e.reviewId?K:e,f.multiTenantMgt([o],d.getRoots(ie),async function(e){if(!e.isMultiTenant&&("_DMUValidationValidation"===i||"_DMUValidationExposedPresentation"===i)){var t={};t.loadMode=a||null,t.reviewId=o.objectId,t.context=ie,t.displayName=o.displayName,t.displayType=o.displayType?o.displayType:"DMUValidationValidation"===o.objectType?"Review":void 0,t.type="_DMUValidationValidation"===i?"DMUValidationValidation":"DMUValidationExposedPresentation",t.readOnly=!1,t.commentId=o.commentId,t.cbRootAdded=function(){K=o},t.cbOK=async function(e){let t=!1;e&&!0===e.sameReview&&(t=!0);var i=await S.createReviewContext({context:ie}),a=He(),r=i.getValidation(),l="",s=r.getContext();if(s&&(l=s.getJsonContextTypes()[0]),"Document"!==l&&"Requirement"!==l&&"Requirement Specification"!==l&&"Specification Report"!==l){var d=r.getLoadedRepRefs();d.length>0&&a&&(a=_.giveDMUSlidesController({context:ie.getFrameWindow()}),Z.autoReframe=!1,"DMUValidationValidation"!==o.objectType&&"_DMUValidationValidation"!==o.objectType||t||d[0].getMarkupContent()&&d[0].getMarkupContent().getSlides().length&&a.setActiveSlide(d[0].getMarkupContent().getSlides()[0]))}var c,u,g=[];let p=r.getHighlights();if(p&&p.length)for(c=0;c<p.length;c++)g.push(p[c]);if(u=[],r){var f=r.getLoadedRepRefs();for(c=0;c<f.length;c++)if(f[c].getMarkupContent()){u=u.concat(f[c].getMarkupContent().getSlides());for(let e=0;e<f[c].getMarkupContent().getSlides().length;e++){var D=f[c].getMarkupContent().getSlides()[e].getDMUObjects();for(let e=0;e<D.length;e++)D[e].getDMUComments&&(u=u.concat(D[e].getDMUComments()))}}let e,t,i=n.getReviewContext({viewer:ie.getFrameWindow().getViewer()}),a=r.getContext()?r.getContext().getJsonContexts():null;a&&a.length>0&&(e=a[0].id,t=a[0].type);let o=i.getReviewCtxInformation();o&&o.contextId===e&&o.reviewId===r.getPlmID()||i.setReviewCtxInformation({contextId:e,contextType:t,reviewId:r.getPlmID(),reviewName:r.getName(),reviewType:r.getValType(),owner:r.getOwner()}),n.getContextViewer({viewer:ie.getFrameWindow().getViewer()}).getController().getAttributes({ids:[r.getPlmID()],attributes:["ds6w:reservedBy"],callbacks:{onComplete:function(e){if(e){var t=n.getReviewContext({context:ie}),i=t?t.getValidation():null,a=i.getModifyAccessFlag(),o=e[i.getPlmID()]["ds6w:reservedBy"];!a&&o&&""!==o?Xe("info",X.reviewLocked+" "+e[i.getPlmID()]["ds6w:reservedBy"]):!1===a&&Xe("info",X.reviewNoModifyAccess)}},onFailure:function(){return null}}})}var v=function(e,t){m.giveDMUCommentsController({context:ie.getFrameWindow()}).applyComment({commentId:e,markupId:t})};let h,w=(e,t)=>{h||(h=ne.addEvent("on2DDocumentLoadSuccess",function(){v(e,t),ne&&h&&ne.removeEvent(h),h=null}))};for(let e=0;e<u.length;e++)for(let i=0;i<g.length;i++)if(g[i].getAttribute("sPresentationSlideID")===u[e].getAttribute("sUuid")){if(g[i].getPlmID()===o.objectId)if("DMUSlide"===u[e].getType())a&&a.setActiveSlide(u[e]);else if("DMUComment"===u[e].getType()){let n=u[e].getAttribute("sUuid"),a=g[i].getAttribute("sRepRefMarkupID");t?v(n,a):w(n,a)}t||Z.highlightInitialization({highlight:g[i],slide:u[e]})}ne.addEvent("onReplyExpandRequest",function(e){let t=n.getReviewContext({viewer:ie.getFrameWindow().getViewer()}),i=t.getValidation();ne.fireEvent("onGetMarkupJsonEvt",{markup:i.getRepRef(e.data.id),onLoadingCompleted:function(e,n){i.setCurrentMarkup(n),ne.fireEvent("onImportModelEvt",{asset:e,onImportCompleted:function(){var e=t.getCurrentSessionMarkup();n.setMarkupContent(e),e.setMarkupOwner(n),a&&a.setActiveSlide(e.getSlides()[0]),e.setReadOnly(t.isReadOnly());let o=i.getHighlightsData();if(o&&o.length)for(u=e.getSlides(),c=0;c<o.length;c++)for(var r=0;r<u.length;r++)o[c].slideId===u[r]._sUuid&&Z.highlightInitialization({highlight:o[c],slide:u[r]})}})}})})},t.cbFailed=function(){ie.getWidget().dispatchEvent("onDMUValidationLoadFailed")},await Z.loadValidation(t),T.setSlidePreferences({context:ie.getFrameWindow(),preferences:{displayNominal:!1,displayInWork:!1}})}}))},this.createSharedPreferences=function(e){e&&e.addPreferences([{nls:X.markerPrefTitle,id:"MarkerPreferences",type:"section",preferences:[{nls:X.validatedStampMarkerLabel,id:"MarkerValidatedStampLabel",type:"editor",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_MarkerValidatedStampLabel")||N.defaultValidatedStampLabel},getDefaultValue:function(){return N.defaultValidatedStampLabel},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_MarkerValidatedStampLabel")&&localStorage.setItem("CATWebUXMePreferences_MarkerValidatedStampLabel",e)}},{nls:X.rejectedStampMarkerLabel,id:"MarkerRejectedStampLabel",type:"editor",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_MarkerRejectedStampLabel")||N.defaultRejectedStampLabel},getDefaultValue:function(){return N.defaultRejectedStampLabel},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_MarkerRejectedStampLabel")&&localStorage.setItem("CATWebUXMePreferences_MarkerRejectedStampLabel",e)}}]},{nls:X.compareSectionTitle,id:"ComparePreferences",type:"section",preferences:[{nls:X.firstProductColor,id:"CompareFirstColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareFirstColor")?localStorage.getItem("CATWebUXMePreferences_CompareFirstColor"):"#FF0000"},getDefaultValue:function(){return"#FF0000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareFirstColor",e)}},{nls:X.secondProductColor,id:"CompareSecondColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_CompareSecondColor")?localStorage.getItem("CATWebUXMePreferences_CompareSecondColor"):"#00FF00"},getDefaultValue:function(){return"#00FF00"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_CompareSecondColor",e)}},{nls:X.compare3DCommonColor,id:"Compare3DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare3DCommonColor"):"#D3D3D3"},getDefaultValue:function(){return"#D3D3D3"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare3DCommonColor",e)}},{nls:X.compare2DCommonColor,id:"Compare2DCommonColor",type:"color",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor")?localStorage.getItem("CATWebUXMePreferences_Compare2DCommonColor"):"#000000"},getDefaultValue:function(){return"#000000"},setValue:function(e){localStorage.setItem("CATWebUXMePreferences_Compare2DCommonColor",e)}}]},{nls:X.slideSectionTitle,id:"SlidePreferences",type:"section",preferences:[{nls:X.slideNameFromFeature,id:"SlideNameFromFeature",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SlideNameFromFeature"))&&localStorage.setItem("CATWebUXMePreferences_SlideNameFromFeature",e?"true":"false")}},{nls:X.slideTitleDisplayLbl,id:"DisplaySlideTitle",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_DisplaySlideTitle"))&&localStorage.setItem("CATWebUXMePreferences_DisplaySlideTitle",e?"true":"false")}},{nls:X.preferences.slideCaptureSpecLayers,id:"CaptureSpecLayers",type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers")},getDefaultValue:function(){return!1},setValue:function(e){e!==("true"===localStorage.getItem("CATWebUXMePreferences_CaptureSpecLayers"))&&localStorage.setItem("CATWebUXMePreferences_CaptureSpecLayers",e?"true":"false")}},{nls:X.preferences.slideEnableDrag,id:"SlideDragAndDropOperation",type:"radio",getValue:function(){return localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")||"SlideReorder"},getDefaultValue:function(){return"0"},setValue:function(e){e!==localStorage.getItem("CATWebUXMePreferences_SlideDragAndDropOperation")&&localStorage.setItem("CATWebUXMePreferences_SlideDragAndDropOperation",e)},options:[{id:"SlideReorder",nls:X.preferences.enableReorder},{id:"TransferView",nls:X.preferences.enableDragContent}]}]}])},this.removeSharedPreferences=function(e){e&&e.removePreferences(["MarkerPreferences","ComparePreferences","SlidePreferences"])},this._onContextualBarReadyCB=function(){var e=[],t=c.get(),i=t[t.length-1],a=function(e,t){return e.x>=t.x-3&&e.x<=t.x+3&&e.y>=t.y-3&&e.y<=t.y+3};if(t.length){for(var o,r=!1,l=null,s=!1,u=0;u<t.length;u++){for(o=t[u].pathElement.clone();o&&o.internalPath.length;)o=o.getParentPath();if(o.getLastElement(!0).getAnnotationClassType||o.getLastElement(!0).getDMUType)return ie.getExecutionContext?{WAfrCtxBarRow1:void 0}:{cmdList:[]};l=d.getLastReference(o);let e=!ie.getController().isRootSupported||ie.getController().isRootSupported(d.getNodeID(l.getLastElement(!0)));l&&d.isReference(l.getLastElement(!0))&&e?r=!0:l=null}i&&i.event&&i.event.lastPosition&&i.event.startPosition&&a(i.event.startPosition,i.event.lastPosition)&&i.pathElement.externalPath.length>2&&i.pathElement.externalPath[0]===ie.getRootBagPath().getLastElement(!0)&&(s=!0);var g=n.getReviewContext({context:ie}),p=g?g.getCurrentSessionMarkup():null;let c="3D"===n.getCurrentReviewContext()||"ITF"===n.getCurrentReviewContext();if(p&&p.getActiveFlag()&&!p.isReadOnly()&&p.isVisible()&&p.getCurrentSlide()&&!ae){if(r&&c&&e.push({name:"DMUHideShowOverloadStr",line:1,hdr_list:["DMUHideShowOverloadHdr"],type:"handler",identifier:"DMUHideShowOverloadHdr"}),l&&l.externalPath&&l.externalPath.length&&c){var m=V.getDMUSceneDisplayController({context:ie});m&&!m.getCurrentComparedObjectIDPaths()&&e.push({name:"DMUColorOpacityOverloadStr",line:1,hdr_list:["DMUColorOpacityOverloadHdr"],type:"handler",identifier:"DMUColorOpacityOverloadHdr"}),e.push({name:"DMUPositionOverloadStr",line:1,hdr_list:["DMUPositionOverloadHdr"],type:"handler",identifier:"DMUPositionOverloadHdr"})}}else r&&c&&e.push({name:"HideShowStr",line:1,hdr_list:["HideShowHdr"],type:"handler",identifier:"ENO3DHideShowCmd"});s&&c?e.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"ENO3DLevelSelectorCmd"}):1===t.length&&i&&i.pathElement&&i.pathElement.getParentPath().isEqual(ie.getRootBagPath())&&c&&e.push({name:"RemoveRootStr",line:1,hdr_list:["RemoveRootHdr"],type:"handler",identifier:"ENO3DRemoveRootCmd"})}return"DIFLayout"!==Oe&&"DIFSheet"!==Oe||i&&i.event&&i.event.lastPosition&&i.event.startPosition&&a(i.event.startPosition,i.event.lastPosition)&&i.pathElement.externalPath.length>2&&i.pathElement.externalPath[0]===ie.getRootBagPath().getLastElement(!0)&&e.push({name:"DMULevelSelectorStr",line:1,hdr_list:["DMULevelSelectorHdr"],type:"handler",identifier:"ENO3DLevelSelectorCmd"}),ie.getExecutionContext?{WAfrCtxBarRow1:{model:e}}:{cmdList:e}},this._applyFlag=function(e,t){for(var i,n=0;n<e.length;n++)(i=O.getCommand(e[n],ie.getCommandContext()))||(i=O.getCommandCheckHeader(e[n],ie.getCommandContext())),i&&(t?i.enable():i.disable())},this._onContextualMenuReadyCB=function(e,t){var i=[],a=[],r=[],l=Boolean(ie.getExecutionContext);if(z&&z.getActiveState())return l?i:{cmdList:i};var s=n.getReviewContext({context:ie}),u=c.get(),g=!ie.getViewer().get2DMode(),p=o.getManager({name:"DMUUserExperienceManager",context:ie.getFrameWindow()}),m=t?{x:t.XmousePositionWithDevPxRatio,y:t.YmousePositionWithDevPxRatio}:{x:e.XmousePositionWithDevPxRatio,y:e.YmousePositionWithDevPxRatio};if(0===(p?p.pick(m,"mesh"):ie.getViewer().pick({xPix:m.x,yPix:m.y},"mesh",!0).path).length){var f=F.get(),D=f&&f[0]&&f[0].pathElement?f[0].pathElement.getLastElement(!0):null,v=D&&D.getDMUType?D.getDMUType():"";if("DMUSlide"===v||"DMUFormat"===v||"DMUComment"===v||"DMUMarkup"===v||"DMUValidationExposedPresentation"===v||"DMUValidationCheck"===v||"Checks"===v||"Highlights"===v)return l?i:{cmdList:i};l?r.push({category:"Display",hdrs:!L.isMobile()&&g?["VisuQMCommand","ENO3DToggleStatusBarCmd"]:["ENO3DToggleStatusBarCmd"]},{category:"Ambience",hdrs:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}):i=[{line:1,name:"DMU3DReviewDisplaySubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:!L.isMobile()&&g?["VisuQMCommand","PAD3DToggleStatusBarHdr"]:["PAD3DToggleStatusBarHdr"]},{line:1,name:"DMU3DReviewAmbiencesSubMenu",resourceFile:"DMUBaseCommands/3DPlayPro",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}];let e=k.getEditCmd(ie.getViewer());e&&e.isEnabled()&&(l&&Oe&&"2D"!==Oe&&"Document"!==Oe&&"Specification Report"!==Oe&&"DIFLayout"!==Oe&&"DIFSheet"!==Oe&&"Drawing"!==Oe&&"Requirement"!==Oe&&"Requirement Specification"!==Oe?e.isRunning()?a.push("DMUExitClippingEditionHdr"):a.push("DMUClippingEditionHdr"):l||(i=i.concat([{line:1,name:"DMUClippingEditStr",hdr_list:e.isRunning()?["DMUExitClippingEditionHdr"]:["DMUClippingEditionHdr"]}])))}else if(u.length){var h=s?s.getCurrentSessionMarkup():null,w=!1,C=!1,S=!1,b=h&&!h.isReadOnly()&&h.isVisible();for(let e=0;e<u.length;e++){if(h&&!h.isReadOnly()&&h.isVisible()){var y=h.getOrCreateOccurrenceOverloader(u[e]);if(!w)if(y&&y.isOverloadedInCurrentSlide())w=!0;else{let t=u[e].pathElement.clone();t.getParentPath()&&d.isInstance(t.getParentPath().getLastElement(!0))&&(y=h.getOrCreateOccurrenceOverloader({pathElement:t.getParentPath()}))&&y.isOverloadedInCurrentSlide()&&(w=!0)}}for(var M=!0,R=0;R<u[e].pathElement.externalPath.length;R++)u[e].pathElement.externalPath[R].getDMUType&&(C=!0,M=!1);M&&(S=!0)}var P=!1;if(p&&(P=p.areOccurenceOverloadsCopied()),w&&(l?a.push("DMURemoveOverloadHdr","DMUCopyHdr","DMUCutHdr"):i=i.concat([{line:1,name:"DMURemoveOverloadStr",hdr_list:["DMURemoveOverloadHdr"]},{line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]},{line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}])),S&&P&&(l?a.push("DMUPasteHdr","DMUPasteSpecialHdr"):i=i.concat([{line:1,name:"DMUPasteStr",hdr_list:["DMUPasteHdr"]},{line:1,name:"DMUPasteSpecialStr",hdr_list:["DMUPasteSpecialHdr"]}])),!C){g?l?a.push("ENO3DFocusOnCmd"):i.push({line:1,name:"FocusOn",hdr_list:["FocusOnHdr"]}):-1!==we.indexOf("Document")&&-1!==we.indexOf("Specification Report")||(l?a.push("DMUFocusOnRepresentationHdr"):i.push({line:1,name:"FocusOn",hdr_list:["DMUFocusOnRepresentationHdr"]})),"Requirement"===Oe||"Requirement Specification"===Oe?l?a.push("WebDocumentReframeOnHdr"):i.push({line:1,name:"ReframeOn",hdr_list:["WebDocumentReframeOnHdr"]}):"Drawing"===we||"DIFLayout"===we||"DIFSheet"===we?l?a.push("DMUReframeOnRepresentationHdr"):i.push({line:1,name:"ReframeOn",hdr_list:["DMUReframeOnRepresentationHdr"]}):l?a.push("ENO3DReframeOnCmd"):i.push({line:1,name:"ReframeOn",hdr_list:["ReframeOnHdr"]});let e=!ie.getController().isRootSupported||u.length>=1&&u[0].pathElement.externalPath.length>=2&&ie.getController().isRootSupported(d.getNodeID(u[0].pathElement.externalPath[1]));if(b&&g&&e){var A=!1;let e,t;for(let i=0;i<u.length;i++){for(e=u[i].pathElement.clone();e&&e.internalPath.length;)e=e.getParentPath();if((t=d.getLastReference(e))&&d.isReference(t.getLastElement(!0))){A=!0;break}}t&&t.externalPath.length<=2&&(A=!1),A&&(l?a.push("DMUHideShowOverloadHdr"):i.push({line:1,name:"DMUHideShowOverloadStr",hdr_list:["DMUHideShowOverloadHdr"]}))}1===u.length&&"Drawing"!==Oe&&ie.getRootBagPath().isAParentOf(u[0].pathElement)&&(l?a.push("DMUNavOnImplementationLinksHdr"):i.push({name:"DMUNavOnImplementationLinksStr",line:1,hdr_list:["DMUNavOnImplementationLinksHdr"]})),l?a.push("ActionBar_Attributes"):i.push({line:1,name:"EditPropertiesCmd",hdr_list:["ActionBar_Attributes"]}),g&&e&&(l?r.push({category:"Geometry Quality",hdrs:["OptimizedQualityCmd","HighQualityCmd"]}):i.push({line:1,name:"PAD3DViewerToggleGeometrySection",resourceFile:"ENOPAD3DViewer/ENOPAD3DViewer",hdr_list:["PAD3DToggleSimplifiedHdr","PAD3DToggleAccurateHdr"]}));let t=k.getEditCmd(ie.getViewer());t&&t.isEnabled()&&(l&&Oe&&"2D"!==Oe&&"Document"!==Oe&&"Specification Report"!==Oe&&"DIFLayout"!==Oe&&"DIFSheet"!==Oe&&"Drawing"!==Oe&&"Requirement"!==Oe&&"Requirement Specification"!==Oe?t.isRunning()?a.push("DMUExitClippingEditionHdr"):a.push("DMUClippingEditionHdr"):l||(i=i.concat([{line:1,name:"DMUClippingEditStr",hdr_list:t.isRunning()?["DMUExitClippingEditionHdr"]:["DMUClippingEditionHdr"]}])))}}if(l){for(let e=0;e<a.length;e++)"ENO3DToggleStatusBarCmd"===a[e]?i.push({type:"WAfrCheckHandlerItem",handlerId:a[e]}):i.push({type:"WAfrDefaultHandlerItem",handlerId:a[e]});return r.forEach(e=>{let t={type:"PushItem",title:e.category,submenu:[]};for(let i=0;i<e.hdrs.length;i++)"ENO3DToggleStatusBarCmd"===e.hdrs[i]?t.submenu.push({type:"WAfrCheckHandlerItem",handlerId:e.hdrs[i]}):t.submenu.push({type:"WAfrDefaultHandlerItem",handlerId:e.hdrs[i]});i.push(t)}),i}return{cmdList:i}},this.highlightInitialization=function(e){e&&e.slide&&e.slide.addAssociatedHighlightData&&e.highlight&&e.slide.addAssociatedHighlightData({id:e.highlight.getPlmID(),rating:e.highlight.getRating(),hasIssue:Boolean(e.highlight._lIssuesIDs.length),hasImpactedChecks:Boolean((e.highlight.getAssociatedCheck()||[]).length)})},this.getRequirementData=(e=>new Promise((t,i)=>{require("DS/WAFData/WAFData").authenticatedRequest(f.get3DSpaceUrl()+"/resources/trm/streaming/structure/"+e.phyId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:R.getSetting("pad_security_ctx")},timeout:6e4,onComplete:function(e){let i=JSON.parse(e);t(i)},onFailure:i,onTimeout:i})})),this._setActiveState=async function(e){const t=()=>f.get3DSpaceUrl(),a=()=>f.getPlatformId(),l=()=>R.getSetting("pad_security_ctx");let g,S,M;if(e!==ee){if(ee=e){Ce||(Ce=b.getLoadingContextController({context:ie}));let e=function(e){return new Promise((i,n)=>{let o=t()+"/resources/dictionary/getTypeInfo?tenant="+a(),r=l();require("DS/WAFData/WAFData").authenticatedRequest(o+"&SecurityContext="+r,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:r},data:JSON.stringify(e),onComplete:function(e){i(e)},onFailure:function(e){n(e)},onTimeout:function(e){n(e)}})})},c={_DMUValidationValidation:function(e){Z.loadContext(e,ee,"_DMUValidationValidation",!1,Z)},_DMUValidationExposedPresentation:function(e){Z.loadContext(e,ee,"_DMUValidationExposedPresentation",!1,Z)},...j.getDelegation(ie,function(){ne.fireEvent("onApplyingSlideView")})};try{let t=await e(Be);Object.keys(t).forEach(e=>{c["_"+e]=dt}),ie.setLoadingDelegations(c)}catch{Be.forEach(e=>{c["_"+e]=dt}),ie.setLoadingDelegations(c)}if((Ie=y.getSelectionManager({context:ie})).setActiveState(!0),xe={activated:ie.getViewer().picking.activated,trapSelection:ie.getViewer().picking.trapSelection,trapGPU:ie.getViewer().picking.trapGPU},Ue={activated:ie.getViewer().pPicking.activated},ie.getViewer().setPicking({activated:!0,trapSelection:!0,trapGPU:!0}),ie.getViewer().setPrePicking({activated:!0}),A.subscribe({event:"ENXViews/WelcomePanel/openContent"},async e=>{let t=e.unserializedData?e.unserializedData.data.items:null;if(t&&t.length>1)for(const e of t){const t=await Ke(e.objectType);if(!t.includes("VPMReference")&&!t.includes("R2V_FeatureState")){qe=!1,Xe("warning",X.dropMultiNoAutorized);break}}else qe=!0}),ne=n.getEventsController({viewer:ie.getViewer()}),de.onValidationObjectDeleted=ne.addEvent("onValidationObjectDeleted",function(e){var t=function(){e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&"Markup"===e.dmuObject[0].getType()&&Xe("error",N.deleteMarkupFailed),e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&"Reply"===e.dmuObject[0].getType()&&Xe("error",N.deleteReplyFailed)};if(e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&("Markup"===e.dmuObject[0].getType()||"Reply"===e.dmuObject[0].getType())){let i=n.getReviewContext({context:ie});i.getCurrentSessionMarkup()===e.dmuObject[0].getRepRef().getMarkupContent()&&i.setCurrentSessionMarkup(null),h.deleteObject({ctxViewer:ie,objectIds:[e.dmuObject[0].getPlmID()],type:e.dmuObject[0].getValType(),onDeleteCompleted:function(){e&&e.dmuObject&&e.dmuObject.length&&e.dmuObject[0].getType&&("Markup"===e.dmuObject[0].getType()||"Reply"===e.dmuObject[0].getType())&&(e.dmuObject[0].getRepRef().removeMarkupContent(),Ge())},onDeleteFailed:t})}else if(e&&e.dmuObject&&e.dmuObject.length&&("DMUValidationExposedPresentation"===e.dmuObject[0].getType()||"DMUValidationCheck"===e.dmuObject[0].getType())){var i=[];for(let t=0;t<e.dmuObject.length;t++)i.push(e.dmuObject[t].getPlmID());h.deleteObject({ctxViewer:ie,objectIds:i,type:"validationObject",onDeleteCompleted:function(){},onDeleteFailed:t})}}),de.onValidationObjectAttributesModificationRequest=ne.addEvent("onValidationObjectAttributesModificationRequest",function(e){if(e&&e.attr&&e.dmuObject&&e.dmuObject.getValType&&e.attr.key){var t=[];if("name"===e.attr.key&&"ReviewMarkup"===e.dmuObject.getValType()){var i=[];i.push({sAlias:e.attr.value}),t.push({object:e.dmuObject,attributesList:i}),e.dmuObject.getParent&&e.dmuObject.getParent()&&t.push({object:e.dmuObject.getParent(),attributesList:i})}q.tryToSaveData({frameWindow:ie.getFrameWindow(),saveFunction:function(){return new Promise((e,i)=>{h.updateAttributes({ctxViewer:ie,objectsToModify:t,onAttributesSaveCompleted:e,onSaveFailed:i})})}})}}),de.onDMUObjectDeleted=ne.addEvent("onDMUObjectDeleted",function(e){e&&e.dmuObject&&e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType()&&(e.dmuObject.getValType||et())}),de.onDMUObjectInitialized=ne.addEvent("onCreateMarkupNoSlide",()=>{et()}),de.onDMUObjectInitialized=ne.addEvent("onDMUObjectInitialized",function(e){if(e&&e.dmuObject&&e.dmuObject.getParent()&&e.dmuObject.getParent().getType&&"DMUTemporaryBag"!==e.dmuObject.getParent().getType())if(!e.dmuObject.getValType||Ne)et(),Ge();else if("DMUValidationValidation"===e.dmuObject.getValType())if(Ge(),ie.elements.container.removeEventListener("drop",lt),"2DFL"===he){ie.elements.container.addEventListener("drop",lt);var t={_EleLogicalRelay:st,_EleLogicalContact:st,_EleLogicalOperatingDevice:st,_EleLogicalSingleConnector:st,_EleLogicalInlineConnector:st,_EleLogicalShellConnector:st,_EleLogicalSplice:st,_EleLogicalTerminalBoard:st,_EleLogicalBusbar:st,_EleLogicalHarness:st,_EleLogicalNet:st,_EleLogicalNetGroup:st,_EleLogicalWire:st,_EleLogicalWireShield:st,_EleLogicalCable:st,_EleLogicalCableShielded:st,_EleLogicalCableTwisted:st,_EleLogicalCableTwistedShielded:st,_EleLogicalOverShield:st,_EleLogicalPowerCable:st,_EleLogicalCoaxCable:st,_EleLogicalCableGroup:st,_EnsLogicalEquipment:st,_EnsInCLoop:st,_EnsInCLogicalRoute:st,_EnsInCLogicalBranch:st,_EnsInCLogicalComponent:st,_Piping_Logical_Miscellaneous:st,_Piping_Logical_Branch:st,_Piping_Logical_Instrument:st,_Piping_Logical_Reducer:st,_Piping_Logical_Valve:st,_Piping_Logical_Pipe:st,_Piping_Line:st,_ICLoop_Line:st,_HVAC_Logical_Miscellaneous:st,_HVAC_Logical_Branch:st,_HVAC_Logical_Instrument:st,_HVAC_Logical_Reducer:st,_HVAC_Logical_Damper:st,_HVAC_Logical_Duct:st,_HVAC_Line:st};ie.setLoadingDelegations(Object.assign({},t,c))}else ie.setLoadingDelegations(c);else"DMUValidationExposedPresentation"===e.dmuObject.getValType()&&Z.highlightInitialization({highlight:e.dmuObject,slide:e.slideObject})}),de.onSlideApplicativeContextModified=ne.addEvent("onSlideApplicativeContextModified",function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&et()}),de.onDMUOverloadPropertiesChanged=ne.addEvent("onDMUOverloadPropertiesChanged",et),de.onDMUOccOverloadRemoved=ne.addEvent("onDMUOccOverloadRemoved",et),de.onDMUSlideSessionInfoChanged=ne.addEvent("onDMUSlideSessionInfoChanged",function(e){e&&e.dmuObject&&("DMUSlide"===e.dmuObject.getType()||"DMUFormat"===e.dmuObject.getType())&&Ze()}),de.onDMUSlideNameChanged=ne.addEvent("onDMUSlideNameChanged",Ze),de.onSaveRequested=ne.addEvent("onSaveRequested",Ze),de.onDMUCurrentSlideChanged=ne.addEvent("onDMUCurrentSlideChanged",Ge),de.onFormatsEditionModeStarted=ne.addEvent("onFormatsEditionModeStarted",function(){Z.publish("onReviewContextModified",{type:he+"Formats",onABReady:Ge})}),de.onFormatsEditionModeEnded=ne.addEvent("onFormatsEditionModeEnded",function(){Z.publish("onReviewContextModified",{type:"RefreshAB",onABReady:Ge})}),de.onComparisonStarted=ne.addEvent("onComparisonStarted",function(e){e&&e.is2DCompare&&(_e=!0),Ge()}),de.onComparisonEnded=ne.addEvent("onComparisonEnded",function(){_e=!1,Ge()}),de.onReviewCtxInformationChanged=ne.addEvent("onReviewCtxInformationChanged",function(e){e&&e.reviewId&&ie&&ie.getWidget()&&ie.getWidget().dispatchEvent("onDMUReviewLoaded",{envId:f.getPlatformId(),reviewId:"DMUValidationExposedPresentation"===e.reviewType&&e.highlightId?e.highlightId:e.reviewId,objectId:e.reviewId,objectType:"Review"===e.reviewType?"_DMUValidationValidation":"_"+e.reviewType,displayName:e.reviewName,displayType:e.reviewType,type:"Review"===e.reviewType?"_DMUValidationValidation":"_"+e.reviewType})}),de.onDMUObjectReadOnlyFlagChanged=ne.addEvent("onDMUObjectReadOnlyFlagChanged",function(e){if("Markup"===e.dmuObject.getAttribute("sType"))Ge();else if("DMUValidationValidation"===e.dmuObject.getType()){var t="R3V"===te&&!e.flag;ne.fireEvent("setEditionMode",{editionMode:t,readOnly:e.flag}),Ge()}}),de.onDMUObjectActiveFlagChanged=ne.addEvent("onDMUObjectActiveFlagChanged",Ge),de.onDMUObjectVisibleFlagChanged=ne.addEvent("onDMUObjectVisibleFlagChanged",Ge),de.onApplicativeContextCommandsRequired=ne.addEvent("onApplicativeContextCommandsRequired",function(e){Z.publish("onReviewContextModified",{type:"Data",data:e,onABReady:e.cb})}),de.on2DDocumentLoadSuccess=ne.addEvent("on2DDocumentLoadSuccess",function(){Ge(),Fe=!1}),de.onDXFLoadSuccess=ne.addEvent("onDXFLoadSuccess",function(){ze("2D"),ke&&(ke.cleanCommentsPanel(),m.unreferenceDMUCommentsController({context:ie.getFrameWindow()}),ke=null)}),de.onDXFLoadSuccess=ne.addEvent("onR2VReviewCreationSuccess",function(){ze("R2V")}),de.reviewNoContextModeOn=ne.addEvent("reviewNoContextModeOn",function(){ze("ReviewNoContext"),Ve=!1,Ne=!0}),require(["DS/PIMwebViewController/PIMwebItfCtrl"],function(e){We=e.getLoaderForMarkup({context:ie}),le.onDMUCtxtLoadingSuccess=We.subscribe("onDMUCtxtLoadingSuccess",function(){ze("ITF")}),le.onDMUCtxtRemoved=We.subscribe("onDMUCtxtRemoved",function(){n.getReviewContext({context:ie})&&n.removeReviewContext({context:ie}),ze("3D")})}),de.onValidatedCreationFlagChanged=ne.addEvent("onUpdateValidatedRequested",function(e){Z.setValidatedObjCreationFlag(e)}),de.onValidatedObjectDropped=ne.addEvent("onValidatedObjectDropped",function(e){S=n.getReviewContext({context:ie}),h.updateValidatedObjectsList({fullPathRefs:e.path,validatedObjects:e.path,validatedId:S.getValidation().getValidated().getPlmID()?S.getValidation().getValidated().getPlmID():null,validatedToAdd:e.pathToAdd,referenceIds:e.pathToAdd,instanceIds:e.pathToAdd,instanceNames:[],updateMode:"add",ctxViewer:ie.getViewer(),onReviewCtxUpdateOrDropValidated:!0,serviceId:e.serviceId,onSaveValidatedObjectsFailed:function(){}})}),de.onRequirementDropped=ne.addEvent("onRequirementDropped",function(e){S=n.getReviewContext({context:ie});let t=[];function i(e){let t=void 0;if(void 0!==e){var i=document.createElement("textarea");i.innerHTML=e,t=(new DOMParser).parseFromString(i.value,"text/html").documentElement.textContent}return t}const a=e=>{let n=e["attribute[Content Text]"]?i(e["attribute[Content Text]"]):e["Content Text"]?e["Content Text"]:i(e.content)?i(e.content):"",a=e["attribute[Title]"]?i(e["attribute[Title]"]):e.Title?e.Title:"",o=e.type.value?e.type.value:e["type.kindof"]?e["type.kindof"]:"";n&&n.length>100&&(n=n.substring(0,99)+"..."),"Requirement"===o&&t.push({sValidationId:S.getValidation().getPlmID(),sRequirementDocId:e.physicalid,sName:a,sDescription:n,iCheckState:1})};new Promise(t=>{let i=0;e.forEach(async n=>{if(["Requirement Specification","Chapter"].includes(n.objectType)){(await Z.getRequirementData({phyId:n.objectId})).forEach(e=>{a(e)})}else{(await function(e){return new Promise((t,i)=>{let n=encodeURI(`${f.get3DSpaceUrl()}/resources/trm/dictionary/info?pid=${e}&select=type,attribute[Content Data],attribute[Title],attribute[Content Text]`);require("DS/WAFData/WAFData").authenticatedRequest(n,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:R.getSetting("pad_security_ctx")},timeout:6e4,onComplete:function(e){let n=JSON.parse(e);n&&"success"===n.status&&n.results[0]?t(n):i(new Error("Requirement has no content"))},onFailure:function(){i(new Error("Requirement content Request Failed"))},onTimeout:function(){i(new Error("Requirement content Request Timeout"))}})})}(n.objectId)).results.forEach(e=>{e.physicalid||(e.physicalid=n.objectId),a(e)})}++i===e.length&&t()})}).then(()=>{let e=[],i=[],n=e=>{if(e>10){new E({title:X.warningPanelTitle,message:X.createCheckInfo,frmWindow:ie._frmWindow,callbacks:{onValidateCB:()=>{h.addChecks({checkList:t,iCtxViewer:ie})},onCancelCB:()=>{},onCloseCB:()=>{}}})}else h.addChecks({checkList:t,iCtxViewer:ie})};if(S.getValidation().getChecks().forEach(n=>{t.forEach(t=>{n.getJsonRequirements().length&&t.sRequirementDocId===n.getJsonRequirements()[0]._sPlmID&&(e.includes(t.sRequirementDocId)||(e.push(t.sRequirementDocId),i.push(t.sName)))})}),i.length){new E({title:X.warningPanelTitle,message:X.requirementAlreadyAssociated01+" <br /> "+X.requirementAlreadyAssociated02+" <br /> "+i.toString(),frmWindow:ie._frmWindow,callbacks:{onValidateCB:()=>{n(t.length)},onCancelCB:()=>{},onCloseCB:()=>{}}})}else n(t.length)})}),de.onIssueDataRequested=ne.addEvent("onIssueDataRequested",function(e){!function(e){new Promise(function(t,i){var n={method:"GET"};n.headers={Accept:"application/json","Content-Type":"application/json",SecurityContext:R.getSetting("pad_security_ctx")},n.onComplete=function(i){var n=JSON.parse(i).body;e.onComplete&&n&&e.onComplete({issuePriority:n.priority?n.priority:"Low",issueTitle:n.title?n.title:"Issue",issueDescription:n.description?n.description:""}),t()},n.onFailure=i;var a=f.get3DSpaceUrl()+"/resources/issues/"+e.physicalId;require("DS/WAFData/WAFData").authenticatedRequest(a,n)})}(e)}),de.onPrefTemplateIssueOnlyRequested=ne.addEvent("onPrefTemplateIssueOnlyRequested",function(e){e.onPrefTemplateIssueOnlyRequestedCB(De)}),de.onLoadingReviewContext=ne.addEvent("onLoadingReviewContext",function(e){"Document"!==e.rootType&&"Requirement Specification"!==e.rootType&&"Requirement"!==e.rootType&&"Specification Report"!==e.rootType||ke||(ke=m.getDMUCommentsController({context:ie.getFrameWindow(),commandContext:ie.getCommandContext()}))}),de.onPreviewThumbnailUpdateRequested=ne.addEvent("onPreviewThumbnailUpdateRequested",function(e){const t=(S=n.getReviewContext({context:ie}))&&S.getReviewCtxInformation();if(t&&S.getValidation()){e.thumbnailData?C.saveObjectThumbnail("review2dthumbnail",e.thumbnailData,t.reviewId):C.deleteMarkupThumbnail("review2dthumbnail",t.reviewId),h.setSlideForPreview({validation:S.getValidation(),slideForPreview:e.elementId,ctxViewer:ie,onSetSlideForPreviewCompleted:()=>{},onSetSlideForPreviewFailed:()=>{}});var i=S.getValidation().getHighlights();for(let t=0;t<i.length;t++)i[t].getPresentationSlideID()===e.elementId&&C.saveObjectThumbnail("review2dthumbnail",e.thumbnailData,i[t].getPlmID())}}),de.onPreviewThumbnailUpdateRequested=ne.addEvent("onPreviewUpdateOnHighlightRequested",function(e){(S=n.getReviewContext({context:ie}))&&S.getReviewCtxInformation()&&S.getValidation()&&(e.elementId&&S.getValidation().getHighlights().forEach(t=>{t.getPresentationSlideID()===e.elementId&&e.imageData&&C.saveObjectThumbnail("review2dthumbnail",e.imageData,t.getPlmID())}))}),de.onDMUObjectRemovedFromObject=ne.addEvent("onDMUObjectRemovedFromObject",function(e){if("DMUComment"===e.dmuObject.getType()){let t=(S=n.getReviewContext({context:ie})).getValidation().getHighlights();for(let i=0;i<t.length;i++){let n=e.dmuObject.getAssociatedHighlightData();for(let e=0;e<n.length;e++)n[e].id===t[i].getPlmID()&&(C.deleteMarkupThumbnail("review2dthumbnail",t[i].getPlmID()),ne.fireEvent("onHighlightPreviewUpdateRequested",{highlightId:t[i].getPlmID()}))}}}),de.onPreviewThumbnailUpdateRequested=ne.addEvent("onPreviewDeleteOnHighlightRequested",function(e){(S=n.getReviewContext({context:ie}))&&S.getReviewCtxInformation()&&S.getValidation()&&C.deleteMarkupThumbnail("review2dthumbnail",e.elementId)}),de.onReviewObjectAttributesModified=ne.addEvent("onReviewObjectAttributesModified",function(e){if(e&&e.object&&e.attr&&e.attr[0]&&(e.attr[0].currentState||e.attr[0].sValidationState)&&e.object.getRestrictedEditionFlag&&"Activated"===e.object.getRestrictedEditionFlag()){var t=ie.getFrameWindow().getContent().getElementsByClassName("DMUCreateReviewInfoDiv");t.length&&t[0].dsModel&&t[0].dsModel.destroy(),Ge()}}),de.onMaturityModificationRequested=ne.addEvent("onMaturityModificationRequested",function(e){var t;const i=()=>f.get3DSpaceUrl(),a=()=>f.getPlatformId();var o=(S=n.getReviewContext({context:ie})).getValidation(),r={data:[{physicalid:o.getPlmID(),name:o.getName(),fromstate:e.fromState,tostate:e.toState,type:"DMUValidationValidation"}]};t=i()+"/resources/lifecycle/maturity/promote?tenant="+a();require("DS/WAFData/WAFData").authenticatedRequest(t,{method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:R.getSetting("pad_security_ctx")},timeout:36e5,data:JSON.stringify(r),onComplete:function(t){t&&t.results&&t.results.length&&t.results[0].current?(o.setCurrentState(t.results[0].current),ne&&ne.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:t.results[0].current}]})):ne&&ne.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:e.fromState}]})},onFailure:function(){ne&&ne.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:e.fromState}]})},onTimeout:function(){ne&&ne.fireEvent("onReviewObjectAttributesModified",{object:o,attr:[{currentState:e.fromState}]})}})}),de.onNewCommentMentionsCreated=ne.addEvent("onNewCommentMentionsCreated",function(e){if(e&&e.mentions){let t;(S=n.getReviewContext({context:ie})).getValidation()&&S.getValidation().getContext()&&(t=S.getValidation().getContext().getSubContextID()?S.getValidation().getContext().getSubContextID():S.getValidation().getContext().getMainContextID()),w.notify({validationId:S.getValidation().getPlmID(),contextId:t,notifId:"review.mentionned.new",listUsers:e.mentions,commentId:e.commentId})}}),Y=i.getLoadMarkupServices({context:ie}),$=ie.getExecutionContext?Ge():ie.getFrameWindow().getActionBar().onActionBarReady(Ge),(ve=o.getManager({name:"DMU2DSheetManager",context:ie.getFrameWindow()}))||(ve=new p({ctxViewer:ie}),o.addManager({name:"DMU2DSheetManager",context:ie.getFrameWindow(),manager:ve})),ke||!ve.isADocumentDisplayed()&&!ve.isRunning()||"Document"!==ve.getDocumentType()&&"Requirement"!==ve.getDocumentType()||(ke=m.getDMUCommentsController({context:ie.getFrameWindow(),commandContext:ie?ie.getCommandContext():null})),z||(z=new r({context:ie})),re.onApplyFilterBegin=ie.subscribe({event:"onBeginFilterApplied"},at),re.onFilterApplied=ie.subscribe({event:"onFilterApplied"},ot),re.onLoadingFailure=ie.subscribe({event:"onLoadingFailure"},ot),re.onRootAdded=ie.subscribe({event:"onRootAdded"},it),re.onR2VLoaded=ie.subscribe({event:"onR2VLoaded"},tt),re.onRootRemoved=ie.subscribe({event:"onRootRemoved"},nt),re.onRootAttached=ie.subscribe({event:"onRootAttached"},it),re.onRootDetached=ie.subscribe({event:"onRootDetached"},nt),re.onRefresh=ie.subscribe({event:"onRefresh"},()=>{je=!0}),re.onRefreshBegin=ie.subscribe({event:"onRefreshBegin"},()=>{Ve=!0,je||(ie.unsubscribe(re.onRootRemoved),re.onRootRemoved=-1)}),re.onRefreshCompleted=ie.subscribe({event:"onRefreshCompleted"},function(){Ve=!1,je?je=!1:re.onRootRemoved=ie.subscribe({event:"onRootRemoved"},nt)}),se=ie.getViewer().onSwapVisibleSpace(Ge),Se=s.getDMUApplicativeContextManager({context:ie}),de.onR3RAppTransitionRequested=ne.addEvent("onLeavingReviewApp",function(e){if(S=n.getReviewContext({context:ie}),"X3DPLAW_AP"===e.targetApp)S&&S.getValidation()&&(S.getValidation().setReadOnly(!0),Ge());else if("ENOR3V_AP"!==e.targetApp&&"ENOR3R_AP"!==e.targetApp){if((S=n.getReviewContext({context:ie}))&&S.getValidation()){W.giveDMUReviewController({context:ie.getFrameWindow()}).setVisibleFlag(!1);const e=Q||He();e&&e.setVisibleFlag(!1)}}else"ENOR3V_AP"===e.targetApp?S&&S.getValidation()&&(S.getValidation().setReadOnly(!1),Ge()):"ENOR3R_AP"===e.targetApp&&S&&S.getValidation()&&(S.getValidation().setReadOnly(!0),Ge())}),(S=n.getReviewContext({context:ie}))&&S.getCurrentSessionMarkup()){var P=!1,V=S.getReviewCtxInformation();if(V&&V.contextId||"R3R"===te){var x=ie.getRootBagPath().getChildrenPathes();for(g=0;g<x.length;g++){if((ie.getApplicativeData().getLoadedItfData&&ie.getApplicativeData().getLoadedItfData().data.length?ie.getApplicativeData().getLoadedItfData().data[0].isrID:d.getNodeID(x[g].getLastElement(!0)))===V.contextId){S.getCurrentSessionMarkup().setActiveFlag(!0),!0===V.modifiable&&S.setReadOnly(!1),P=!0;break}}P||S.setCurrentSessionMarkup(null)}}if(S&&S.getValidation()){W.giveDMUReviewController({context:ie.getFrameWindow()}).setVisibleFlag(!0);const e=Q||He();e&&e.setVisibleFlag(!0),Te||(S.setReadOnly(!1),S.getValidation().setReadOnly(!1),ne.fireEvent("setEditionMode",{editionMode:"R3V"===te,readOnly:!1}),Ge())}else S&&S.setCurrentSessionMarkup(null);Ae=ie.getViewer().sectionCappingEnabled,ie.getViewer().setSectionCapping(!0),(Pe=ie.isRobotVisible())&&ie.setRobotVisibility(!1),ie.getFrameWindow().getContextualUIManager().registerUnshift({subscriberId:"R3V"===te?"3DValidationWebAppCtxElements":"3DReviewWebAppCtxElements",workbenchName:"R3V"===te?"DMUValWebAppController":"DMUReviewWebAppController",context:ie.getCommandContext(),module:"R3V"===te?"DMUValWebAppController":"DMUReviewWebAppController",cmdPrefix:"",directory:"assets/afr/",merge:!0,onContextualBarReady:this._onContextualBarReadyCB,onContextualMenuReady:this._onContextualMenuReadyCB}),(ye=ie.isDefaultContextualBarVisible())&&ie.setDefaultContextualBarVisibility(!1),(Me=ie.isDefaultContextualMenuVisible())&&ie.setDefaultContextualMenuVisibility(!1),(Re=ie.isOpenWithMenuAvailable())||ie.setOpenWithMenuAvailability(!0),await async function(){var e=D.getPreferenceManager({context:ie.getFrameWindow()});if(e){if(e.setUnitsPreferencesDisplayFlag(!0),e.setDisplayPreferencesDisplayFlag(!0),e.set3DSelectionPreferencesDisplayFlag(!0),e.set2DSelectionPreferencesDisplayFlag(!0),e.setExportPreferencesDisplayFlag(!0),e.setMeasurePreferencesDisplayFlag(!0),e.setClippingPreferencesDisplayFlag(!0),e.addPreferences([{nls:X.preferences.reviewSectionTitle,id:"ReviewPreferences",type:"section",preferences:[{nls:X.preferences.reviewQuickCreationLbl,id:"DisplayReviewCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayReviewCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayReviewCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayReviewCreationDialog",e?"true":"false")}},{nls:X.preferences.markupAutomaticCreationLbl,id:"AutomaticMarkupCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_AutomaticMarkupCreationDialog",e?"true":"false")}}]},{nls:X.preferences.markupSectionTitle,id:"MarkupPreferences",type:"section",preferences:[{nls:X.preferences.QuickCreationLbl,id:"CATWebUXMePreferences_DisplayMarkupCreationDialog",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_DisplayMarkupCreationDialog"))&&localStorage.setItem("CATWebUXMePreferences_DisplayMarkupCreationDialog",e?"true":"false")}},{nls:X.preferences.automaticallyCreateFirstSlide,id:"CreateFirstSlide",type:"checkbox",getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide")},getDefaultValue:function(){return!0},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_CreateFirstSlide"))&&localStorage.setItem("CATWebUXMePreferences_CreateFirstSlide",e?"true":"false")}}]},{nls:X.preferences.handlesSectionTitle,id:"HandlesPreferences",type:"section",preferences:[{prefixnls:X.preferences.gridSpacingPrefix,suffixnls:X.preferences.gridSpacingSuffix,id:"SnapHandlesToGrid",type:"checkbox+spinbox",disableSpinboxAtUncheck:!0,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e=isNaN(e)?.001:e;var t=localStorage.getItem("CATWebUXMePreferences_Length")||"Millimeter";return{value:e="Inch"===(t="Foot"===t?"Inch":"Centimeter"===t||"Meter"===t||"Kilometer"===t?"Millimeter":t)||"Millimeter"===t?v.convert(e,"Length","Meter",t):e,units:t,minValue:"Millimeter"===t?1:.01,stepValue:"Millimeter"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:1,units:"Millimeter",minValue:1,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapHandlesToGrid"))&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesToGrid",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapHandlesGridValue"));e!==(t=isNaN(t)?1:t)&&localStorage.setItem("CATWebUXMePreferences_SnapHandlesGridValue",e)}},{prefixnls:X.preferences.rotSnappingPrefix,suffixnls:"("+X.preferences.rotSnappingSuffix+")",id:"SnapRotationToggle",type:"checkbox+spinbox",disableSpinboxAtUncheck:!1,getValue:function(){return"false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle")},getSpinBoxValues:function(){var e=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e=isNaN(e)?1.5708:e;var t=localStorage.getItem("CATWebUXMePreferences_Angle")||"Degree";return{value:e="Degree"===t?Math.round(v.convert(e,"Angle","Radian",t)):e,units:t,minValue:"Degree"===t?1:.01,stepValue:"Degree"===t?1:.01}},getDefaultValue:function(){return!0},getSpinBoxDefaultValues:function(){return{value:90,units:"Degree",minValue:1,maxValue:360,stepValue:1}},setValue:function(e){e!==("false"!==localStorage.getItem("CATWebUXMePreferences_SnapRotationToggle"))&&localStorage.setItem("CATWebUXMePreferences_SnapRotationToggle",e?"true":"false")},setSpinBoxValue:function(e){var t=parseFloat(localStorage.getItem("CATWebUXMePreferences_SnapRotationAngle"));e!==(t=isNaN(t)?90:t)&&localStorage.setItem("CATWebUXMePreferences_SnapRotationAngle",e)}}]},{nls:H.ticSection,id:"TICSection",type:"section",preferences:[{nls:H.ticTemplateIssue,type:"checkbox",id:"TICTemplateIssue",setValue:function(e){localStorage.setItem("TICTemplateIssue",e)},getValue:function(){return"true"===localStorage.getItem("TICTemplateIssue")},getDefaultValue:function(){return!1}}]}]),Z.createSharedPreferences(e),e.setPreferredPreferenceContainersOrder(["ReviewPreferences","MarkupPreferences","SlidePreferences","HandlesPreferences","MarkerPreferences","TICSection","MeasurePreferences","SectionPreferences"]),!ie.getViewer().get2DMode()){try{let e=(await v.readPreferences([{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]},{Repository:"TICSection",PreferenceNames:["TICTemplateIssue"]}])).repositories;for(let t=0;t<e.length;t++)if("VisualizationRepository"===e[t].name)ue="true"===e[t].preferences[0].value;else if("FrameGeneral"===e[t].name)ge=e[t].preferences[0].value;else if("SelectionRepository"===e[t].name){let i=e[t].preferences;for(let e=0;e<i.length;e++)"Select3DGeometry"===i[e].name?pe="true"===i[e].value:"SelectParentReferenceOr3DShape"===i[e].name&&(me=i[e].value)}else"TICSection"===e[t].name&&(De="true"===e[t].preferences[0].value,Je())}catch(e){ue=!1,De=!1,Je(),ge="Perspective",pe=!1,me="selectParentReference",window.console.warn("Could not get server value, default value set instead.",e)}"boolean"==typeof ue&&(ie.getViewer().currentViewpoint.getControl().setRotationRolling(!ue),ie.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!ue)),"Perspective"!==ge&&"Parallel"!==ge||ie.getViewer().currentViewpoint.setProjectionType("Perspective"===ge?0:1),Ie&&Ie.setPicking(pe?0:1),Ie&&Ie.selectParentReference("select3DShape"!==me)}fe=e.subscribe("com.ds.mep:onPrefUpdate",function(e){let t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;e++)for(let i=0;i<t.repositories[e].preferences.length;i++)"SelectParentReferenceOr3DShape"===t.repositories[e].preferences[i].name?(me=t.repositories[e].preferences[i].value,Ie&&Ie.selectParentReference("select3DShape"!==me)):"Select3DGeometry"===t.repositories[e].preferences[i].name?(pe="true"===t.repositories[e].preferences[i].value,Ie&&Ie.setPicking(pe?0:1)):"ProjectionType"===t.repositories[e].preferences[i].name?(ge=t.repositories[e].preferences[i].value,ie&&ie.getViewer()&&ie.getViewer().currentViewpoint&&ie.getViewer().currentViewpoint.setProjectionType(ge)):"Gravity"===t.repositories[e].preferences[i].name?(ue="true"===t.repositories[e].preferences[i].value,ie&&ie.getViewer()&&ie.getViewer().currentViewpoint&&ie.getViewer().currentViewpoint.control&&(ie.getViewer().currentViewpoint.getControl().setRotationRolling(!ue),ie.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!ue))):"TICTemplateIssue"===t.repositories[e].preferences[i].name&&(De="true"===t.repositories[e].preferences[i].value,Je(),Ge())})}}(),ie.getRootBagPath()&&ie.getRootBagPath().getChildrenPathes().length&&Ye({path:ie.getRootBagPath().getChildrenPathes()[0]})}else{var U;if(y.unreferenceSelectionManager({context:ie}),Ie=null,xe&&ie.getViewer().setPicking(xe),Ue&&ie.getViewer().setPrePicking(Ue),Ue=null,Ue=null,ie.elements.container.removeEventListener("drop",lt),M=D.givePreferenceManager({context:ie.getFrameWindow()})){for(U=Object.keys(ce),g=0;g<U.length;g++)M.unsubscribe(ce[U[g]]);ce={},M.removePreferences("R3V"===te?["MarkupPreferences","HandlesPreferences"]:["ReviewPreferences","HandlesPreferences"]),Z.removeSharedPreferences(M)}if(D.unreferencePreferenceManager({context:ie.getFrameWindow()}),$e&&(clearTimeout($e),$e=null),q.clean(),ie.setLoadingDelegations({}),ie.getFrameWindow().getActionBar().removeCallback($),ie.getFrameWindow().getContextualUIManager().unregister("3DReviewWebAppCtxElements"),ie.getFrameWindow().getContextualUIManager().unregister("3DValidationWebAppCtxElements"),void 0!==ye&&ie.setDefaultContextualBarVisibility(ye),ye=void 0,void 0!==Me&&ie.setDefaultContextualMenuVisibility(Me),Me=void 0,void 0!==Re&&ie.setOpenWithMenuAvailability(Re),Re=void 0,void 0!==Pe&&ie.setRobotVisibility(Pe),Pe=void 0,void 0!==Ae&&ie.getViewer().setSectionCapping(Ae),Ae=void 0,s.unreferenceDMUApplicativeContextManager({context:ie}),Se=null,ve.isADocumentDisplayed())if(Te)(S=n.getReviewContext({context:ie}))&&S.getCurrentSessionMarkup()&&S.setReadOnly(!0);else{ve.clean2DDocument(),ke&&ke.cleanCommentsPanel();for(var I=[],k=d.getRoots(ie),F=0;F<k.length;F++)I.push(d.getNodeID(k[F]));ie.removeRoots({pids:I})}else(S=n.getReviewContext({context:ie}))&&S.getCurrentSessionMarkup()&&(Te||S.getCurrentSessionMarkup().setActiveFlag(!1));for(c.empty(),u.empty(),U=Object.keys(re),g=0;g<U.length;g++)ie.unsubscribe(re[U[g]]);if(re={},ne){for(U=Object.keys(de),g=0;g<U.length;g++)ne.removeEvent(de[U[g]]);n.unreferenceEventsController({viewer:ie.getViewer()}),ne=null}if(de={},We){for(U=Object.keys(le),g=0;g<U.length;g++)We.unsubscribe(le[U[g]]);le={},We=null}z&&(z.clean(),z=null),se&&(ie.getViewer().unsubscribe(se),se=null),fe&&(M.unsubscribe(fe),fe=null),Te||(o.removeManager({name:"DMU2DSheetManager",context:ie.getFrameWindow()}),ve=null,ke&&(m.unreferenceDMUCommentsController({context:ie.getFrameWindow()}),ke=null)),i.unreferenceLoadMarkupServices({context:ie}),Y=null}Ge()}},this.disableDMUContextualBar=function(){ie.getFrameWindow().getContextualUIManager().getContextualBar().hide()},this.enableDMUContextualBar=function(){},this.subscribe=function(e,t){if(e&&t&&oe)return oe.subscribe({event:e},t)},this.unsubscribe=function(e){oe&&e&&oe.unsubscribe(e)},this.getActiveState=function(){return ee},this.clearController=function(){Ee&&clearTimeout(Ee),Z._setActiveState(!1),ie=Z=oe=re=Fe=Ee=null},this.loadMarkupContext=async function(e){var t=!1,i=n.getReviewContext({context:ie});if(i){var a=i.getReviewCtxInformation();t=a&&a.contextId===e.objectId}const o=await Ke(e.objectType);if(e.objectId&&!t){if(be===e.objectId)return void ie.displayNotification({msg:X.documentAlreadyLoaded,eventID:"info"});var r;o&&o.length&&["SIMItfSimulation","PLMPIMMetricReference","Document","Specification Report","DIFLayout","DIFSheet","DIFAnnotationSet","Requirement","Requirement Specification","DesignSight"].some(function(e){if(-1!==o.indexOf(e))return r=e,!0})?(e.objectParentType=r||e.objectType,Ce.load({data:e}),-1===o.indexOf("Document")&&-1===o.indexOf("Specification Report")||(Fe=!0)):Ye({docData:e})}},this.loadValidation=async function(e){await S.createReviewContext({context:ie}),e.editionMode="R3V"===te,e&&Y&&Y.loadValidation(e)},this.appInitFromTransition=function(t){return new e.Promise(function(e){e()}).then(function(e){e||t.onNoActionDone()}).catch(t.onNoActionDone).finally(function(){void 0})},this.refreshContext=function(){var e=n.getReviewContext({context:ie});e&&(e.refreshNode(),ie.getViewer().render())},this.publish=function(e,t){ee&&setTimeout(function(){oe&&oe.publish({event:e,data:t,context:Z})})},this.setappTransition=function(e){Te=e}},setControllerActiveState:async function(e){this._setActiveState&&await this._setActiveState(e)}})}),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMUReviewCommonWebApp/DMUCommonWebAppOptions",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils"],function(e,t,i,n){"use strict";return t.singleton(i,{init:function(){var t={};""!==window.location.search&&(e.extend(t,n.parseQuery(window.location.search)),t.widgetDomain&&e.extend(t,n.parseQuery(t.widgetDomain))),("debug_me"in t||window.debug)&&(t.debug=!0),("testWkb"in t||window.testWkb)&&(t.testWkb=!0),this.setOptions(t)}})}),define("DS/DMUReviewCommonWebApp/ENOR3CommonAppMain",["DS/DMUReviewCommonWebApp/DMUCommonWebAppOptions","DS/DMUMeasurable/DMUToolsSceneGraph","DS/PADUtils/PADSettingsMgt","DS/CATWebUXComponents/DMUCommandsManager","DS/EditPropWidget/constants/ConstantsMapping","DS/CATWebUXComponents/DMUFrameWindow"],function(e,t,i,n,a,o){"use strict";let r={widget:null,widgetLink:null,viewer:null,viewerAttachment:null};var l,s,d,c,u,g,p,m=!1,f="3D",D="CATCmdWorkbench";function v(){return r.widget.getValue(D)}function h(e){r.widget.setValue(D,e)}function w(){r.viewer.getContentName({callbacks:{onComplete:function(e){r.widget.setTitle(e.contentName)},onFailure:function(){}}})}let C=function(e){let t=u.getSourceApp().getId();return t.includes("R3R")?"2D"===e||"Drawing"===e||"DIFSheet"===e||"DIFLayout"===e||"2DFL"===e?"ENOR3R_AP_2D":"Document"===e||"Specification Report"===e||"Requirement"===e||"Requirement Specification"===e?"ENOR3R_AP_Document":"ITF"===e?"ENOR3R_AP_PIM":"MSR"===e?"ENOR3R_AP_MSR":"R2V"===e?"ENOR3R_AP_R2V":"3DFormats"===e?"R3RFormat_AP_3D":"MSRFormats"===e?"R3RFormat_AP_MSR":"2DFormats"===e?"R3RFormat_AP_2D":t:t.includes("R3V")?"2D"===e||"Drawing"===e||"DIFSheet"===e||"DIFLayout"===e||"2DFL"===e?"ENOR3V_AP_2D":"Document"===e||"Specification Report"===e||"Requirement"===e||"Requirement Specification"===e?"ENOR3V_AP_Document":"ITF"===e?"ENOR3V_AP_PIM":"MSR"===e?"ENOR3V_AP_MSR":"R2V"===e?"ENOR3V_AP_R2V":"3DFormats"===e?"R3VFormat_AP_3D":"MSRFormats"===e?"R3VFormat_AP_MSR":"2DFormats"===e?"R3VFormat_AP_2D":t:void 0};var S,b,y,M=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(S=e).renderDiv||S.initialize2(r.viewer.getFrameWindow().getViewerFrame(),t.appId(),r.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){S.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&r.widget.setValue("changeControlActivation",!0)})})})},R=function(t){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","DS/DMUBaseExperience/DMUContextManager","i18n!DS/PADUtils/assets/nls/PADUtils"],function(n,a,o,l){var s,d=[],c=[];y=function(){r.widget.setPreferences([]),s.destroy(),d.forEach(function(e){e.cb&&i.removeEvent(e.cb,e.padFct)}),y=function(){}},b=function(){if(d.forEach(function(e){var t=e.preference.name,n=r.widget.getValue(t),a=i.getSetting(t);(n="boolean"===e.preference.type&&"boolean"!=typeof n?"true"===n:n)!==a&&i.setSetting(t,n),e.fct&&e.fct(n)}),i.updateWidgetPreferences(),!s&&d.length){let e=o.giveEventsController({viewer:r.viewer.getViewer()});s=n.create({events:{onPreferenceModification:function(e){d.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(i.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,r.widget.setValue(e.name,e.value),i.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}}),r.widgetLink&&r.widgetLink.subscribe("DS/ExternalWdgtCom/Find",t=>{e&&e.fireEvent("onCrossWidgetFind",t)}),e&&(e.addEvent("onFireCrossWidgetSelection",e=>{s&&s.select(e)}),e.addEvent("onFireCrossWidgetFind",e=>{e&&e.paths&&e.paths.length&&r.widgetLink&&r.widgetLink.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})})),d.forEach(function(e){e.cb&&i.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:s.preferenceModification({name:e.preference.name,value:t})})})}},r.widget.setPreferences([]),i.setSetting("syncAutoReload",!0),a.destroy(),a.addSharedSettings(r.widget),d.push({preference:{name:"changeControlActivation",type:"boolean",label:l.changeControlActivation_label,defaultValue:!1},fct:function(e){S&&S[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),d.push({preference:{name:"changeControlPosition",type:"list",label:l.changeControlPosition_label,defaultValue:"top-right",options:[{label:l["top-right_label"],value:"top-right"},{label:l["top-left_label"],value:"top-left"},{label:l["bottom-left_label"],value:"bottom-left"},{label:l["bottom-right_label"],value:"bottom-right"}]},fct:function(e){S&&S.setPosition(e)}}),i.setSetting("authorizeChangeControl",!0),t&&M(),e.getOption("debug")?(d.push({preference:{name:"populateTags",type:"boolean",label:l.activateFilter_label,defaultValue:!1},fct:function(e){var t=r.viewer.getBIController();t&&t.toggleBetweenStandaloneAndSlaveMode(e?"STANDALONE":"SLAVE")}}),d.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}})):c=["populateTags","webapi_timeout"],c.forEach(function(e){r.widget.deleteValue(e)}),c.length=0,d.forEach(function(e){r.widget.mergePreferences([e.preference])}),b(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{r.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){i.setSetting(e,t)});var t=i.getSetting("enopad3dviewer_roles");let n=!0,a=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var l=0;l<t.length;l++)if("E19"===t[l].id&&(!t[l].platforms||t[l].platforms&&t[l].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){n=!1;break}!n||a||o?(r.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):r.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(r.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==r.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&r.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",r.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),i.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)}),r.widget.addEvent("endEdit",b)})},P=function(e){e.unsubscribe(s),s=null,w(),M(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),r.widget.getValue(D)||r.widget.addPreference({name:D,type:"hidden"});let t=async function(){var t=l.getController({context:e});await async function(e){e&&(e.subscribe("onReviewContextModified",async function(e){if("ReviewNoContext"===e.type){var t=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),i=window.document.getElementsByClassName("DMULoadingPanel");t.length&&(t[0].dsModel.off(),t[0].dsModel.destroy(),t=null),i.length&&i[0].destroy()}var a=v();if("Data"===e.type){if("3D"===e.data.wkb){for(var o=!1,l=0;l<p.wkb3D.wkb.length;l++)p.wkb3D.wkb[l].file===e.data.file&&p.wkb3D.wkb[l].module===e.data.module&&(o=!0);o||p.wkb3D.wkb.push({file:e.data.file,module:e.data.module})}}else"Document"===e.type||"Requirement"===e.type||"Requirement Specification"===e.type||"Specification Report"===e.type?e.type.contains("Formats")||h("Document"):("ITF"===e.type||"MSR"===e.type||"R2V"===e.type||e.type!==a&&p["wkb"+e.type])&&(e.type.contains("Formats")||h(e.type));"ITF"===e.type?r.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&r.widget.deleteValue("mkpSession"),"Data"===e.type&&(e.type="3D");let s=u.getSourceApp().getId(),d=C(e.type);if(f!==e.type){if("3D"===f){let e=u.getComponent(WAfrStandardComponentKey.HandlerComponent);if(e.hasCheckHandler("AnnotationSwitchOnOff")&&e.isCheckExecutable("AnnotationSwitchOnOff")){let t=localStorage.getItem("CAT3DAnnotationSwitchOnOffCmd");await e.setCheckState({id:"AnnotationSwitchOnOff",state:!1}),localStorage.setItem("CAT3DAnnotationSwitchOnOffCmd",t)}}u.switchApp(s,d).then(()=>{f=e.type,n.refreshCommandsManager(u),e.onABReady()})}}),await e.setActiveState(!0))}(t),u.getComponent("LandingPage").appReady()};require([r.controller],function(e){l=e,t()}),r.viewerAttachment&&r.viewerAttachment(d),r.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic()};function A(e){e&&"string"==typeof e.reviewId&&r.widget.setValue("reviewIdInSession",JSON.stringify(e))}function V(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}function x(){if(i&&(i.setSetting("activateWidgetLink",!0),i.setSetting("useNewUXGuidelinesWP",!0)),!r.viewer){var e=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(r.widget,["showWelcomePanel"]),e()})}),t=new Promise(function(e){require(["text!DS/DMUReviewCommonWebApp/assets/DMUCommonWebApp.json"],function(t){e([t])})}),l=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{r.widgetLink=t,t.initializeWidgetLink(r.widget,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([e,t,l]).then(function(e){var t=JSON.parse(e[1][0]);t.context="Default",t.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var l=v();t.workbenchModule="2D"===l||"ITF"===l||"MSR"===l||"R2V"===l||"Document"===l||"2DFL"===l||"ReviewNoContext"===l?p["wkb"+l].wkb[0].module:p.wkb3D.wkb[0].module,t.workbench="2D"===l||"ITF"===l||"MSR"===l||"R2V"===l||"Document"===l||"2DFL"===l||"ReviewNoContext"===l?p["wkb"+l].wkb[0].file:p.wkb3D.wkb[0].file;r.widget;var s=r.viewer=g;o.init(s),n.dmuSetExecutionContext(g.getExecutionContext()),n.dmuSetHandlerComponent(g.getExecutionContext()),t.mouseProfile&&s.getViewpoint().setDefaultController(!0,t.mouseProfile);var c=i.getSetting("propertiesFacet"),u=a.getMapping();u&&(u.physicssimulation.alwaysVisible=!1,c.push(u.physicssimulation)),s.setOption("propertiesFacet",c),s.setAuthorizedRootTypes(i.getSetting("ups_authorized_root_types")),s.subscribe({event:"onRootAdded"},w),s.subscribe({event:"onRootRemoved"},w),s.subscribe({event:"onRootAttached"},w),s.subscribe({event:"onRootDetached"},w),s.subscribe({event:"onContentNameModified"},w),i.setSetting("settypes",!0),i.setSetting("syncAutoReload",!0),"1"===r.widget.getValue("widgetForODTReplay")&&r.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:s}]),r.widgetInitDone&&r.widgetInitDone({appMainDiv:d,pad3DViewer:s}),P(s)})}}function U(){if(function(){var e=i.getSetting("enopad3dviewer_roles");let t=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var o=0;o<e.length;o++)if("E19"===e[o].id&&(!e[o].platforms||e[o].platforms&&e[o].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!n&&!a),i.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)}(),!1===m&&r.viewer){var e=r.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0,r.viewer.refresh();var n,a,o=t.getRoots(r.viewer),s=!1;for(let e=0;e<o.length;e++)if(""!==t.getNodeID(o[e])&&(n=t.getNodeID(o[e]),"Document"===(a=t.getNodeType(o[e]))||"Specification Report"===a||"Requirement"===a||"Requirement Specification"===a||"DIFSheet"===a||"DIFLayout"===a)){s=!0;break}if(s)var d=r.viewer.subscribe({event:"onRefreshCompleted"},function(){r.viewer.unsubscribe(d);var e=r.viewer.options.visuProgressiveTileModel?[{rootID:n,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:n,"ds6w:type":a,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:n,"ds6w:type":a,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:n,structure:{rootId:a,results:[{attributes:[{name:"did",value:n},{name:"physicalid",value:n},{name:"ds6w:type",value:a}]},{path:[n]}]}}];r.viewer.loadJSON({data:e})});else"DesignSight"===a&&r.viewer.publish({event:"widgetReresh",data:{objectId:n,objectType:a}});var c=r.viewer.subscribe({event:"onLoadingComplete"},function(){r.viewer.unsubscribe(c),A(e);var t=r.widget.getValue("reviewIdInSession");t&&l&&l.giveController({context:r.viewer}).loadReviewAfterRefresh(JSON.parse(t))})}}function I(){m=!0}function k(){if(l){var e=l.giveController({context:r.viewer});e&&e.refreshContext()}m=!1}function E(){r.viewer&&(l&&l.unreferenceController({context:r.viewer}),r.viewer.destroy()),r={widget:null,viewer:null,viewerAttachment:null},l=null}function F(e){r.viewer&&r.viewer.search({searchQuery:e})}return class{constructor(e){if(r.widget=e.widget,d=e.appMainDiv,r.widgetInitDone=e.done,r.data=e.data.wkb?e.data.wkb:e.data,r.controller=e.data.controller?e.data.controller:e.controller,p=e.data.wkb?e.data.wkb:e.data,g=e.viewer?e.viewer:e.pad3DViewer,u=e.executionContext,e.pad3DViewer){r.viewer=e.pad3DViewer,o.init(r.viewer);var s=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),m=s?s.getReviewCtxInformation():null;m&&m.reviewId&&A(m.reviewId)}else e.viewerAttachment?(r.viewerAttachment=e.viewerAttachment,x()):(r.viewerAttachment=function(e){r.widget.setBody(e)},r.widget.addEvent("onLoad",x)),r.widget.addEvent("onEdit",I),r.widget.addEvent("endEdit",k),r.widget.addEvent("onRefresh",U),r.widget.addEvent("onDestroy",E),r.widget.addEvent("onSearch",F),"1"===r.widget.getValue("widgetForODTReplay")&&(r.widgetViewer3DReview=this),r.widget.addEvent("onDMUReviewLoaded",A),r.widget.addEvent("onDMUValidationLoadFailed",V),r.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"});this.setUp=function(){e.sourceApp&&e.sourceApp.pad3DViewer!==r.viewer&&(r.viewer=e.sourceApp.pad3DViewer,o.init(r.viewer),n.dmuSetExecutionContext(g.getExecutionContext()),n.refreshCommandsManager(g.getExecutionContext())),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),i.setSetting("activateWidgetLink",!0),i.setSetting("useNewUXGuidelinesWP",!0),(c=u.getComponent("LandingPage")).setViewer(r.viewer),c.appReady(),r.widget.addEvent("onRefresh",U),r.widget.addEvent("onSearch",F),r.widget.addEvent("onDMUReviewLoaded",A),r.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==r.viewer&&(r.viewer=e.sourceApp.pad3DViewer),o.init(r.viewer),n.dmuSetExecutionContext(g.getExecutionContext()),n.dmuSetHandlerComponent(g.getExecutionContext());var l=i.getSetting("propertiesFacet"),s=a.getMapping();s&&s.physicssimulation&&s.physicssimulation.facet&&(l.find(function(e){return!(!e||!e.facet||e.facet.name!==s.physicssimulation.facet.name)})||(s.physicssimulation.alwaysVisible=!1,l.push(s.physicssimulation))),r.viewer.setOption("propertiesFacet",l),r.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),R(r.viewer),r.viewer.getViewer().updateViewPanelUIConfiguration&&r.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),w(),"3D"===v()||t.getRoots(r.viewer).length>0?("2D"!==v()&&"Document"!==v()&&r.viewer.getViewer().set2DMode(!1),h("3D")):"2DFL"===v()?h("2DFL"):"ReviewNoContext"===v()?h("ReviewNoContext"):h("2D"),i.setSetting("dynamic_authorized_types",!0);var d=i.getSetting("unsupported_root_types");d.push("Drawing"),i.setSetting("unsupported_root_types",d)},this.dispose=function(){if(i.setSetting("dynamic_authorized_types",!1),r.widget.removeEvent("onRefresh",U),r.widget.removeEvent("onSearch",F),r.widget.removeEvent("endEdit",b),r.widget.removeEvent("onDMUReviewLoaded",A),y&&y(),r.viewer){var t=i.getSetting("propertiesFacet"),n=a.getMapping();if(n){var s=t.findIndex(function(e){return!(!e||!e.facet||e.facet.name!==n.physicssimulation.facet.name)});s>=0&&t.splice(s,1)}r.viewer.setOption("propertiesFacet",t),l&&l.unreferenceController({context:r.viewer,options:e})}p.wkb2D.wkb.length>1&&p.wkb2D.wkb.splice(1,p.wkb2D.wkb.length),p.wkb2DFL.wkb.length>1&&p.wkb2DFL.wkb.splice(1,p.wkb2DFL.wkb.length),p.wkb3D.wkb.length>1&&p.wkb3D.wkb.splice(1,p.wkb3D.wkb.length),p.wkb2DFormats.wkb.length>1&&p.wkb2DFormats.wkb.splice(1,p.wkb2DFormats.wkb.length),p.wkb2DFLFormats.wkb.length>1&&p.wkb2DFLFormats.wkb.splice(1,p.wkb2DFLFormats.wkb.length),p.wkb3DFormats.wkb.length>1&&p.wkb3DFormats.wkb.splice(1,p.wkb3DFormats.wkb.length),l=null,o.reset(),c=void 0},this.onWillLeave=function(e){if(r.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){var i=t.giveEventsController({viewer:r.viewer.getViewer()});i&&i.fireEvent("onLeavingReviewApp",{targetApp:e&&e.options?e.options.id:""})}}}}}}),define("DS/DMUReviewCommonWebApp/DMUCommonWebAppMain",["UWA/Core","DS/DMUControls/EXPNotify","DS/DMUReviewCommonWebApp/DMUCommonWebAppOptions","DS/DMUMeasurable/DMUToolsSceneGraph","DS/PADUtils/PADSettingsMgt","DS/DMUBaseUI/DMUReviewDnDComponent","DS/CATWebUXComponents/DMUCommandsManager","DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/EditPropWidget/constants/ConstantsMapping","DS/CATWebUXComponents/DMUFrameWindow","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUReadPersistence/DMULoadingContextController","i18n!DS/DMUReviewCommonWebApp/assets/nls/DMUCommonWebAppMain"],function(e,t,i,n,a,o,r,l,s,d,c,u,g,p){"use strict";let m,f,D={widget:null,widgetLink:null,viewer:null,viewerAttachment:null};const v=[{key:"rvw",type:"DMUValidationValidation"},{key:"highlight",type:"DMUValidationExposedPresentation"},{key:"isr",type:"SIMItfSimulation"},{key:"itf",type:"PLMPIMMetricReference"},{key:"difLayout",type:"DIFLayout"},{key:"difSheet",type:"DIFSheet"},{key:"difAnnotSet",type:"DIFAnnotationSet"},{key:"doc",type:"Document"},{key:"req",type:"Requirement"},{key:"reqSpec",type:"Requirement Specification"},{key:"msr",type:"DesignSight"},{key:"pointClouds",type:"R2V_FeatureState"}],h=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];function w(){var e=this.params.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function C(e){e&&e.length&&(e[0].id.reviewId&&(e[0]=e[0].id,e[0].type&&"_DMUValidationValidation"===e[0].type&&(e[0].type="DMUValidationValidation"),e[0].type&&"_DMUValidationExposedPresentation"===e[0].type&&(e[0].type="DMUValidationExposedPresentation")),this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map(function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.reviewId?e.reviewId:e.id,objectType:"PointCloud"!==e.type?e.type:"R2V_FeatureState",displayName:e.displayName,serviceId:"PointCloud"!==e.type?void 0:"r2vsurvey"}})}}}))}async function S(e){try{let t=await u.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function b(e){let i=!0;if(e.length>1)for(const t of e){let e=await S(t["ds6w:type"]);if(!e.includes("VPMReference")&&!e.includes("R2V_FeatureState")){i=!1;break}}var n,a,o;i?C.call(this,e.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}})):(n="warning",a=p.dropMultiNoAutorized,o=this.pad3DViewer,f&&(f.destroy(),f=null),f=new t({body:o.getFrameWindow().getUIFrame(),type:n,message:a}))}function y(e){if(e&&e.length){s.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map(function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}})}});var t=setInterval(function(){this.isAppReady&&this.welcomePanel&&(clearInterval(t),function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:h,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(this.welcomePanel){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=i.getRoots(this.pad3DViewer).map(function(e){return i.getNodeID(e)}),a=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),o=a?a.getReviewCtxInformation():{};o&&o.reviewId&&n.push(o.reviewId),o&&o.highlightId&&n.push(o.highlightId),this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.forEach(function(e){n=n.concat(e.metricID.length?e.metricID:[e.isrID])}),e.attributes.forEach(function(e){t[e.name]=e.value});var r={resourceid:t.resourceid,label:t["ds6w:label"],icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:n.indexOf(t.resourceid)>-1,item2Load:{}};r.item2Load[r.resourceid]={};let l=t["ds6w:type"];return"SIMItfSimulation"!==l&&"PLMPIMMetricReference"!==l&&"DIFAnnotationSet"!==l||(r.addRemoveFromViewCtx=!0),r}.bind(this));s.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}}.bind(this)))}.bind(this),100)}}function M(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=this.reviewCtrl=null,this.tokensWelcomePanel=[],this.tokensPAD=[],this.tokensMkp=[],this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/refreshCustom"},y.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=w.call(this),i=[];e.customitem2open.forEach(function(e){v.some(function(n){if(t[n.key]&&t[n.key][e])return i.push({id:e,type:n.type}),!0})}),C.call(this,i)}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=t.getRoots(this.pad3DViewer).map(function(e){return t.getNodeID(e)}),n=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),a=n?n.getReviewCtxInformation():{},o=a?a.reviewId:null,r=[];this.pad3DViewer.getApplicativeData().getLoadedItfData&&(r=this.pad3DViewer.getApplicativeData().getLoadedItfData().data),this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach(e=>{this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd(e)}),e.customitem2remove.indexOf(o)>-1&&require(["DS/DMUBaseExperience/DMUContextManager"],function(e){e.removeReviewContext({context:D.viewer});let t=e.giveEventsController({viewer:D.viewer.getViewer()});t&&t.fireEvent("onDMURemoveSessionReview")}),r.forEach(function(t){(t.metricID.length?t.metricID:[t.isrID]).some(function(i){if(e.customitem2remove.indexOf(i)>-1)return this.pad3DViewer.getApplicativeData().removeIsrKeepContext(t.isrID),!0},this)},this),i.forEach(function(t){e.customitem2remove.indexOf(t)>-1&&this.pad3DViewer.removeRoots({pids:[t]})},this)}}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=w.call(this),i=[];e.customitem2remove.forEach(function(e){v.some(function(n){if(t[n.key]&&t[n.key][e]&&-1===i.indexOf(e))return i.push(e),delete t[n.key][e],!0})}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),s.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelHighlights"},function(){l.launchSearch({title:p.highlights,precondition:'flattenedtaxonomies:"types/DMUValidationExposedPresentation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRvw"},function(){l.launchSearch({title:p.rvw,precondition:'flattenedtaxonomies:"types/DMUValidationValidation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},function(){l.launchSearch({title:p.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},function(){l.launchSearch({title:p.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDrw"},function(){l.launchSearch({title:p.drw,precondition:'flattenedtaxonomies:"types/Drawing"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFLayout"},function(){l.launchSearch({title:p.difLayout,precondition:'flattenedtaxonomies:"types/DIFLayout"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFSheet"},function(){l.launchSearch({title:p.difSheet,precondition:'flattenedtaxonomies:"types/DIFSheet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){l.launchSearch({title:p.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDocument"},function(){l.launchSearch({title:p.doc,precondition:'flattenedtaxonomies:"types/Document"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirement"},function(){l.launchSearch({title:p.req,precondition:'flattenedtaxonomies:"types/Requirement"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirementSpec"},function(){l.launchSearch({title:p.reqSpec,precondition:'flattenedtaxonomies:"types/Requirement Specification"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMsr"},function(){l.launchSearch({title:p.msr,precondition:'flattenedtaxonomies:"types/DesignSight"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){let i=t.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(i)var n=i.subscribe("onPreferencesPanelDestroyed",function(){i.unsubscribe(n),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",this.pad3DViewer&&this.pad3DViewer.getCommandContext?this.pad3DViewer.getCommandContext():null).begin()}.bind(this))}.bind(this))),"R3V"===m&&this.tokensWelcomePanel.push(s.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelNewActivity"},function(){var e=r.getCommand("DMUReviewHdr",this.pad3DViewer.getCommandContext());this.showWelcomePanel(!1),e.begin()}.bind(this)));var t=l.getDefaultActivities();t.activities[0].section.actions.splice(2,0,{id:"welcomePanelRvw",title:p.rvw,icon:"review"}),t.activities[0].section.actions.splice(3,0,{id:"welcomePanelHighlights",title:p.highlights,icon:"highlight-review"}),t.activities[0].section.actions.splice(6,0,{id:"welcomePanelDIFAnnotationSet",title:p.difAnnotSet,icon:"annotation"}),t.activities[0].section.actions.splice(7,0,{id:"welcomePanelIsr",title:p.isr,icon:"interference-simulation"}),t.activities[0].section.actions.splice(8,0,{id:"welcomePanelItf",title:p.itf,icon:"interference-metric"}),t.activities[0].section.actions.splice(9,0,{id:"welcomePanelMsr",title:p.msr,icon:"physics-simulation"}),t.activities[0].section.actions.splice(10,0,{id:"welcomePanelDrw",title:p.drw,icon:"drawing"}),t.activities[0].section.actions.splice(11,0,{id:"welcomePanelRequirementSpec",title:p.reqSpec,icon:"requirement-specification"}),t.activities[0].section.actions.splice(12,0,{id:"welcomePanelRequirement",title:p.req,icon:"requirement"}),t.activities[0].section.actions.splice(13,0,{id:"welcomePanelDIFLayout",title:p.difLayout,icon:"fl-diagrams"}),t.activities[0].section.actions.splice(14,0,{id:"welcomePanelDIFSheet",title:p.difSheet,icon:"fl-diagram"}),t.activities[0].section.actions.splice(15,0,{id:"welcomePanelDocument",title:p.doc,icon:"doc"}),"R3V"===m&&t.activities.push({section:{id:"NewActivitySection",title:p.startNewActivity,actions:[{id:"welcomPanelNewActivity",title:p.newReview,icon:"review"}]}}),t.activities.push({section:{id:"customizeAppSection",title:p.customApp,actions:[{id:"welcomPanelPrefCmd",title:p.prefs,icon:"cog"}]}}),this.welcomePanel=new l({widget:e.widget,readOnlyApp:!1,renderDiv:e.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/DMUValidation" OR flattenedtaxonomies:"types/DMUValidationExposedPresentation" OR flattenedtaxonomies:"types/SIMItfSimulation" OR flattenedtaxonomies:"types/PLMPIMMetricReference" OR flattenedtaxonomies:"types/DIFLayout" OR flattenedtaxonomies:"types/DIFSheet" OR flattenedtaxonomies:"types/DIFAnnotationSet" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification" OR (flattenedtaxonomies:"types/Document" AND [ds6w:docextension]:(pdf OR dxf OR dwg)) OR flattenedtaxonomies:"types/Requirement" OR flattenedtaxonomies:"types/Requirement Specification"',defaultActionId:t.defaultActionId,activities:t.activities,onLandingPageReady:e.onLandingPageReady})}var R;M.prototype={constructor:M,initialize:function(){var e=this.welcomePanel.initialize();return e.then(function(){var e=w.call(this),t=Array.prototype.concat.apply([],v.map(function(t){return Object.keys(e[t.key]||[])}));y.call(this,t)}.bind(this)),e},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),i=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&i&&i!==this.params.renderDiv&&i.insertBefore(this.params.renderDiv,i.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.welcomePanel&&(this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)),this.tokensPAD.push(e.subscribe({event:"onRootAdded"},function(t){var i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.id,a=e.getController().getNode({id:n}),o=i.getNodeType(a);if("R2V_FeatureState"===o){var r=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),l=window.document.getElementsByClassName("DMULoadingPanel");r.length&&(r[0].dsModel.off(),r[0].dsModel.destroy(),r=null),l.length&&l[0].destroy()}let s,d=g.getLoadingContextController({context:e});if(d&&(s=d.getSubContextInformations(n)),"R2V_FeatureState"===o||"DesignSight"===o||"DIFLayout"===o||"DIFSheet"===o||"Document"===o||"Specification Report"===o||"Requirement"===o||"Requirement Specification"===o){"DesignSight"===o?this.params.widget.setValue("mkpSession",JSON.stringify({type:"msr",plmType:o,id:n})):"Specification Report"===o?(n=s?s.id:n,o=s?s.type:o):(this.params.widget.setValue("mkpSession",JSON.stringify({type:"Document"===o||"Specification Report"===o||"Requirement"===o||"Requirement Specification"===o?o:"2D",plmType:o,id:n})),"Specification Report"===o&&(n=s?s.id:n,o=s?s.type:o));var c=w.call(this);c[o="DIFLayout"===o?"difLayout":"DIFSheet"===o?"difSheet":"Requirement"===o?"req":"Requirement Specification"===o?"reqSpec":"DesignSight"===o?"msr":"R2V_FeatureState"===o?"pointClouds":"VPMReference"===o?"products":"doc"]||(c[o]={}),c[o][n]={},this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(c)),this.showWelcomePanel(!1),y.call(this,[n])}}.bind(this))),this.tokensPAD.push(e.subscribe({event:"onBeginRootLoading"},function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()})),this.tokensPAD.push(e.subscribe({event:"onRootRemoved"},function(t){let i=g.getLoadingContextController({context:e});i&&i.removeSubContextInformations(t.id);var n=w.call(this);["difLayout","difSheet","doc","req","reqSpec","msr"].some(function(e){return n[e]&&n[e][t.id]})&&(y.call(this,[t.id]),this.params.widget.deleteValue("mkpSession"))}.bind(this))),require(["DS/DMUBaseExperience/DMUContextManager"],function(t){var i=t.getEventsController({viewer:e.getViewer()});this.tokensMkp.push(i.addEvent("onReviewCtxInformationChanged",function(e){var t=w.call(this);t.rvw||(t.rvw={}),t.highlight||(t.highlight={}),"DMUValidationValidation"===e.reviewType?t.rvw[e.reviewId]={}:"DMUValidationExposedPresentation"===e.reviewType&&(t.highlight[e.highlightId]={}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),y.call(this,[e.reviewId])}.bind(this))),this.tokensMkp.push(i.addEvent("onReviewRemoved",function(e){var t=w.call(this);e&&t.rvw&&t.rvw[e.reviewId]&&y.call(this,[e.reviewId]),e&&e.highlightId&&t.highlight&&t.highlight[e.highlightId]&&y.call(this,[e.highlightId]),this.params.widget.deleteValue("reviewIdInSession")}.bind(this)))}.bind(this))},appReady:function(e){if(this.reviewCtrl=e,this.isAppReady=!0,this.params.initApp){let s=this.params.widget.getValue("X3DContentId"),d=this.params.widget.id.indexOf("preview")>-1,c=this;if(this.params.widget.deleteValue("X3DContentId"),s)e.appInitFromTransition({x3dContent:JSON.parse(s),onNoActionDone:function(){setTimeout(function(e){var t=JSON.parse(s);c.showWelcomePanel(!1),(t.data&&t.data.items||[]).forEach(function(e){("Drawing"===e.objectType||e.objectTaxonomies&&e.objectTaxonomies.indexOf("Drawing")>-1)&&delete e.path}),t.data&&t.data.items&&t.data&&t.data.items.length&&o.callSpecReportData(e,t,!0)},0,this.pad3DViewer)}.bind(this)});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!d){var t=this.params.widget.getValue("reviewIdInSession");if(t){var i=JSON.parse(t);"_DMUValidationExposedPresentation"===i.objectType?C.call(this,[{id:JSON.parse(t),type:"DMUValidationExposedPresentation"}]):"_DMUValidationValidation"===i.objectType?C.call(this,[{id:JSON.parse(t),type:"DMUValidationValidation"}]):C.call(this,[{id:JSON.parse(t),type:"Markup"}])}else{var n=this.params.widget.getValue("mkpSession");if((n=n?JSON.parse(n):null)&&"ITF"===n.type){var a=this.params.widget.getValue("ItfSimuInSession");if((a=a?JSON.parse(a):null)&&!Array.isArray(a)&&"object"==typeof a){var r=Object.keys(a);if(1===r.length){var l=r[0];Array.isArray(a[l])&&a[l].length?C.call(this,a[l].map(function(e){return{id:e,type:"PLMPIMMetricReference"}})):C.call(this,[{id:l,type:"SIMItfSimulation"}])}}}else n&&n.id&&("2D"===n.type||"Document"===n.type||"msr"===n.type)&&C.call(this,[{id:n.id,type:n.plmType}])}}d?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp")}var s=this.welcomePanel.appReady();return this.welcomePanel.redraw(),s},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel){var e=require("DS/DMUBaseExperience/DMUContextManager").getEventsController({viewer:this.pad3DViewer.getViewer()});this.tokensMkp.forEach(e.removeEvent,e),this.tokensMkp=[],this.tokensPAD.forEach(this.pad3DViewer.unsubscribe,this.pad3DViewer),this.tokensPAD=[],this.pad3DViewer=this.params=null,this.tokensWelcomePanel.forEach(s.unsubscribe,s),this.tokensWelcomePanel.length=0;var t=this.welcomePanel.dispose();return this.welcomePanel=null,t}},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}};var P,A,V,x,U=!1,I="CATCmdWorkbench",k=i.getOption("testWkb");function E(){return D.widget.getValue(I)}function F(e){D.widget.setValue(I,e)}function O(){let e;var t=n.getRoots(D.viewer);let i=g.getLoadingContextController({context:D.viewer});i&&t.length&&(e=i.getSubContextInformations(t[0].getIdentificationObject())),e&&e.label?D.widget.setTitle(e.label):D.viewer.getContentName({callbacks:{onComplete:function(e){D.widget.setTitle(e.contentName)},onFailure:function(){}}})}var T=[],_=function(e){T.push(e),1===T.length&&function e(t){var i={lastCommand:[],currentCommand:null,defaultCommand:null},n=D.viewer.getCommandContext?D.viewer.getCommandContext():null;n?r._commandsState[n]=i:r._commandsState=i,r.resetDefaultCommand(n),r._isCommandEnding=!1,r._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(e){var t=n?r[e][n]:r[e];Object.keys(t).forEach(function(e){var i=t[e];i&&i._destroy&&i._destroy(),delete t[e]})});var a=0,o=t.viewer.getFrameWindow().getActionBar(),l=o.onActionBarReady(function(){++a<t.afr.wkb.length&&t.merge?t.viewer.loadActionBar({merge:!0,file:t.afr.wkb[a].file,module:t.afr.wkb[a].module}):(o.removeCallback(l),t.viewer.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange(),r.setDefaultCommand({ID:"R3R"===m?"DMUReviewWebAppDefaultHdr":"DMUValidationWebAppDefaultHdr",className:"R3R"===m?"DS/DMUReviewWebApp/DMUReviewWebAppDefaultCmd":"DS/DMUValidationWebApp/DMUValidationWebAppDefaultCmd",context:n}),t.actionBarReadyCb&&t.actionBarReadyCb(),t.options&&t.options.done({appMainDiv:A,pad3DViewer:t.viewer})),t.merge&&a!==t.afr.wkb.length||(T.shift(),T.length&&e(T[0]))});t.viewer.loadActionBar({merge:!1,file:t.afr.wkb[0].file,module:t.afr.wkb[0].module})}(T[0])};async function W(e){e&&(e.subscribe("onReviewContextModified",function(e){if("ReviewNoContext"===e.type){var t=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),i=window.document.getElementsByClassName("DMULoadingPanel");t.length&&(t[0].dsModel.off(),t[0].dsModel.destroy(),t=null),i.length&&i[0].destroy()}var n=e.onABReady?e.onABReady:function(){},a=E();if("Specification Report"===e.type&&(e.type="Document"),"Data"===e.type){if("3D"===e.data.wkb){for(var o=!1,r=0;r<x.wkb3D.wkb.length;r++)x.wkb3D.wkb[r].file===e.data.file&&x.wkb3D.wkb[r].module===e.data.module&&(o=!0);o||(x.wkb3D.wkb.push({file:e.data.file,module:e.data.module}),"3D"===a&&_({merge:!0,afr:k?x.wkb3DTst:x.wkb3D,viewer:D.viewer,actionBarReadyCb:n}))}}else"RefreshAB"===e.type?_({merge:!0,afr:x["wkb"+a],viewer:D.viewer,actionBarReadyCb:n}):("ITF"===e.type||"MSR"===e.type||"R2V"===e.type||"Document"===e.type||"Requirement"===e.type||e.type!==a&&x["wkb"+e.type])&&(_({merge:!0,afr:x["wkb"+e.type+(k&&x["wkb"+e.type+"Tst"]?"Tst":"")],viewer:D.viewer,actionBarReadyCb:n}),e.type.contains("Formats")||F(e.type));"ITF"===e.type?D.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&D.widget.deleteValue("mkpSession")}),await e.setActiveState(!0))}var L,N,j,q=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(L=e).renderDiv||L.initialize2(D.viewer.getFrameWindow().getViewerFrame(),t.appId(),D.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){L.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&D.widget.setValue("changeControlActivation",!0)})})})},B=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","DS/DMUBaseExperience/DMUContextManager","i18n!DS/PADUtils/assets/nls/PADUtils"],function(t,n,o,r){var l,s=[],d=[];j=function(){D.widget.setPreferences([]),l.destroy(),s.forEach(function(e){e.cb&&a.removeEvent(e.cb,e.padFct)}),j=function(){}},N=function(){if(s.forEach(function(e){var t=e.preference.name,i=D.widget.getValue(t),n=a.getSetting(t);(i="boolean"===e.preference.type&&"boolean"!=typeof i?"true"===i:i)!==n&&a.setSetting(t,i),e.fct&&e.fct(i)}),a.updateWidgetPreferences(),!l&&s.length){let e=o.giveEventsController({viewer:D.viewer.getViewer()});l=t.create({events:{onPreferenceModification:function(e){s.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(a.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,D.widget.setValue(e.name,e.value),a.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}}),D.widgetLink&&D.widgetLink.subscribe("DS/ExternalWdgtCom/Find",t=>{e&&e.fireEvent("onCrossWidgetFind",t)}),e&&(e.addEvent("onFireCrossWidgetSelection",e=>{l&&l.select(e)}),e.addEvent("onFireCrossWidgetFind",e=>{e&&e.paths&&e.paths.length&&D.widgetLink&&D.widgetLink.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})})),s.forEach(function(e){e.cb&&a.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:l.preferenceModification({name:e.preference.name,value:t})})})}},D.widget.setPreferences([]),a.setSetting("syncAutoReload",!0),n.destroy(),n.addSharedSettings(D.widget),s.push({preference:{name:"changeControlActivation",type:"boolean",label:r.changeControlActivation_label,defaultValue:!1},fct:function(e){L&&L[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),s.push({preference:{name:"changeControlPosition",type:"list",label:r.changeControlPosition_label,defaultValue:"top-right",options:[{label:r["top-right_label"],value:"top-right"},{label:r["top-left_label"],value:"top-left"},{label:r["bottom-left_label"],value:"bottom-left"},{label:r["bottom-right_label"],value:"bottom-right"}]},fct:function(e){L&&L.setPosition(e)}}),a.setSetting("authorizeChangeControl",!0),e&&q(),i.getOption("debug")?(s.push({preference:{name:"populateTags",type:"boolean",label:r.activateFilter_label,defaultValue:!1},fct:function(e){var t=D.viewer.getBIController();t&&t.toggleBetweenStandaloneAndSlaveMode(e?"STANDALONE":"SLAVE")}}),s.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}})):d=["populateTags","webapi_timeout"],d.forEach(function(e){D.widget.deleteValue(e)}),d.length=0,s.forEach(function(e){D.widget.mergePreferences([e.preference])}),N(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{D.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){a.setSetting(e,t)});var t=a.getSetting("enopad3dviewer_roles");let i=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){i=!1;break}!i||n||o?(D.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):D.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(D.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==D.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&D.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",D.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),a.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)}),D.widget.addEvent("endEdit",N)})},X=function(e){e.unsubscribe(P),P=null,O(),q(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),D.widget.getValue(I)||D.widget.addPreference({name:I,type:"hidden"});var t=!1,i=async function(){if(t){var i=R.getController({context:e});await W(i),V.appReady(i)}else t=!0};require([D.controller],function(e){R=e,i()}),setTimeout(function(){"1"===D.widget.getValue("widgetForODTReplay")&&(D.widgetViewer3DReview._viewer3DReview=e),D.widget.dispatchEvent("onWidgetAndAppReady","1"===D.widget.getValue("widgetForODTReplay")?[{pad3DViewer:D.viewer}]:void 0),i()}),D.viewerAttachment&&D.viewerAttachment(A),D.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange()};function H(t){return A||(A=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),(V=new M({widget:D.widget,readOnlyApp:!1,renderDiv:A,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady})).initialize()}function G(e){e&&"string"==typeof e.reviewId&&D.widget.setValue("reviewIdInSession",JSON.stringify(e))}function J(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}function z(){if(a&&(a.setSetting("activateWidgetLink",!0),a.setSetting("useNewUXGuidelinesWP",!0)),!D.viewer){var e=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(D.widget,["showWelcomePanel"]),H({initApp:!0,onLandingPageReady:function(){D.viewerAttachment(A),D.viewerAttachment=null}}).then(e)})}),t=new Promise(function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","text!DS/DMUReviewCommonWebApp/assets/DMUCommonWebApp.json"],function(t,i){e([t,i])})}),i=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{D.widgetLink=t,t.initializeWidgetLink(D.widget,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([e,t,i]).then(function(e){var t=JSON.parse(e[1][1]);t.context="Default",t.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var i=E();t.workbenchModule="2D"===i||"ITF"===i||"MSR"===i||"R2V"===i||"Document"===i||"2DFL"===i||"ReviewNoContext"===i?x["wkb"+i].wkb[0].module:x.wkb3D.wkb[0].module,t.workbench="2D"===i||"ITF"===i||"MSR"===i||"R2V"===i||"Document"===i||"2DFL"===i||"ReviewNoContext"===i?x["wkb"+i].wkb[0].file:x.wkb3D.wkb[0].file;var n={widget:D.widget,windowOptions:t,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,readyCB:B,authorizedRootTypes:["MCAD Assembly","MCAD Component","VPMReference","VPMRepReference"],visuProgressiveTileModel:!0};n.windowOptions.allowDnD=!1;var r=D.viewer=new e[1][0](n);c.init(r),t.mouseProfile&&r.getViewpoint().setDefaultController(!0,t.mouseProfile),V.setViewer(r);var l=a.getSetting("propertiesFacet"),s=d.getMapping();s&&(s.physicssimulation.alwaysVisible=!1,l.push(s.physicssimulation)),r.setOption("propertiesFacet",l),r.setAuthorizedRootTypes(a.getSetting("ups_authorized_root_types")),P=r.subscribe({event:"onReady"},X),r.subscribe({event:"onRootAdded"},O),r.subscribe({event:"onRootRemoved"},O),r.subscribe({event:"onRootAttached"},O),r.subscribe({event:"onRootDetached"},O),r.subscribe({event:"onContentNameModified"},O),o.initViewerDnd(r,S),localStorage.getItem("defaultSelectedTypeData")||localStorage.setItem("defaultSelectedTypeData","product"),a.setSetting("settypes",!0),a.setSetting("syncAutoReload",!0),"1"===D.widget.getValue("widgetForODTReplay")&&D.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:r}]),D.widgetInitDone&&D.widgetInitDone({appMainDiv:A,pad3DViewer:r})})}}function Q(){if(function(){var e=a.getSetting("enopad3dviewer_roles");let t=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),n=require("DS/PADUtils/PADSession").isAuthoring();for(var o=0;o<e.length;o++)if("E19"===e[o].id&&(!e[o].platforms||e[o].platforms&&e[o].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!i&&!n),a.setSetting("enopad3dviewer_staticMappingSupportActivated",!n)}(),!1===U&&D.viewer){var e=D.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0,D.viewer.refresh();var t,i,o=n.getRoots(D.viewer),r=!1;for(let e=0;e<o.length;e++)if(""!==n.getNodeID(o[e])&&(t=n.getNodeID(o[e]),"Document"===(i=n.getNodeType(o[e]))||"Specification Report"===i||"Requirement"===i||"Requirement Specification"===i||"DIFSheet"===i||"DIFLayout"===i)){r=!0;break}if(r)var l=D.viewer.subscribe({event:"onRefreshCompleted"},function(){D.viewer.unsubscribe(l);var e=D.viewer.options.visuProgressiveTileModel?[{rootID:t,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":i,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":i,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:t,structure:{rootId:i,results:[{attributes:[{name:"did",value:t},{name:"physicalid",value:t},{name:"ds6w:type",value:i}]},{path:[t]}]}}];D.viewer.loadJSON({data:e})});else"DesignSight"===i&&D.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:i}});var s=D.viewer.subscribe({event:"onLoadingComplete"},function(){D.viewer.unsubscribe(s),G(e);var t=D.widget.getValue("reviewIdInSession");t&&R&&R.giveController({context:D.viewer}).loadReviewAfterRefresh(JSON.parse(t))})}}function K(){U=!0}function Y(){if(R){var e=R.giveController({context:D.viewer});e&&e.refreshContext()}U=!1}function $(){V&&V.dispose(),V=null,D.viewer&&(R&&R.unreferenceController({context:D.viewer}),D.viewer.destroy()),D={widget:null,viewer:null,viewerAttachment:null},R=null}function Z(e){D.viewer&&D.viewer.search({searchQuery:e})}var ee=function(e){if(D.widget=e.widget,A=e.appMainDiv,D.widgetInitDone=e.done,D.data=e.data.wkb?e.data.wkb:e.data,D.controller=e.data.controller?e.data.controller:e.controller,x=e.data.wkb?e.data.wkb:e.data,m=e.data.appId?e.data.appId:e.appId,e.pad3DViewer){D.viewer=e.pad3DViewer,c.init(D.viewer);var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),i=t?t.getReviewCtxInformation():null;i&&i.reviewId&&G(i.reviewId)}else e.viewerAttachment?(D.viewerAttachment=e.viewerAttachment,z()):(D.viewerAttachment=function(e){D.widget.setBody(e)},D.widget.addEvent("onLoad",z)),D.widget.addEvent("onEdit",K),D.widget.addEvent("endEdit",Y),D.widget.addEvent("onRefresh",Q),D.widget.addEvent("onDestroy",$),D.widget.addEvent("onSearch",Z),"1"===D.widget.getValue("widgetForODTReplay")&&(D.widgetViewer3DReview=this),D.widget.addEvent("onDMUReviewLoaded",G),D.widget.addEvent("onDMUValidationLoadFailed",J),D.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"})};return ee.prototype.setUp=function(e){function t(){require([D.controller],function(t){var i=(R=t).getController({context:D.viewer});(async()=>{await W(i),H().then(function(){V.setViewer(D.viewer),V.appReady(i)}),e.sourceApp&&e.sourceApp.issues&&1===e.sourceApp.issues.length&&i.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})})()})}e.sourceApp&&e.sourceApp.pad3DViewer!==D.viewer&&(D.viewer=e.sourceApp.pad3DViewer,c.init(D.viewer)),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),a.setSetting("activateWidgetLink",!0),a.setSetting("useNewUXGuidelinesWP",!0),D.widget.addEvent("onRefresh",Q),D.widget.addEvent("onSearch",Z),D.widget.addEvent("onDMUReviewLoaded",G),D.widget.setMetas({helpPath:"DMUReviewWebApp/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==D.viewer&&(D.viewer=e.sourceApp.pad3DViewer),c.init(D.viewer);var i=a.getSetting("propertiesFacet"),o=d.getMapping();o&&o.physicssimulation&&o.physicssimulation.facet&&(i.find(function(e){return!(!e||!e.facet||e.facet.name!==o.physicssimulation.facet.name)})||(o.physicssimulation.alwaysVisible=!1,i.push(o.physicssimulation))),D.viewer.setOption("propertiesFacet",i),D.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),B(D.viewer),D.viewer.getViewer().updateViewPanelUIConfiguration&&D.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),O(),"3D"===E()||n.getRoots(D.viewer).length>0?(_({options:e,merge:!1,afr:x.wkb3D,actionBarReadyCb:t,viewer:D.viewer}),"2D"!==E()&&"Document"!==E()&&D.viewer.getViewer().set2DMode(!1),F("3D")):"2DFL"===E()?(_({options:e,merge:!1,afr:x.wkb2DFL,actionBarReadyCb:t,viewer:D.viewer}),F("2DFL")):"ReviewNoContext"===E()?(_({options:e,merge:!1,afr:x.wkbReviewNoContext,actionBarReadyCb:t,viewer:D.viewer}),F("ReviewNoContext")):(_({options:e,merge:!1,afr:x.wkb2D,actionBarReadyCb:t,viewer:D.viewer}),F("2D")),a.setSetting("dynamic_authorized_types",!0);var r=a.getSetting("unsupported_root_types");r.push("Drawing"),a.setSetting("unsupported_root_types",r)},ee.prototype.dispose=function(e){if(a.setSetting("dynamic_authorized_types",!1),D.widget.removeEvent("onRefresh",Q),D.widget.removeEvent("onSearch",Z),D.widget.removeEvent("endEdit",N),D.widget.removeEvent("onDMUReviewLoaded",G),j&&j(),V&&V.dispose(),V=null,D.viewer){var t=a.getSetting("propertiesFacet"),i=d.getMapping();if(i){var n=t.findIndex(function(e){return!(!e||!e.facet||e.facet.name!==i.physicssimulation.facet.name)});n>=0&&t.splice(n,1)}D.viewer.setOption("propertiesFacet",t),R&&R.unreferenceController({context:D.viewer,options:e})}x.wkb2D.wkb.length>1&&x.wkb2D.wkb.splice(1,x.wkb2D.wkb.length),x.wkb2DFL.wkb.length>1&&x.wkb2DFL.wkb.splice(1,x.wkb2DFL.wkb.length),x.wkb3D.wkb.length>1&&x.wkb3D.wkb.splice(1,x.wkb3D.wkb.length),x.wkb2DFormats.wkb.length>1&&x.wkb2DFormats.wkb.splice(1,x.wkb2DFormats.wkb.length),x.wkb2DFLFormats.wkb.length>1&&x.wkb2DFLFormats.wkb.splice(1,x.wkb2DFLFormats.wkb.length),x.wkb3DFormats.wkb.length>1&&x.wkb3DFormats.wkb.splice(1,x.wkb3DFormats.wkb.length),R=null},ee.prototype.onWillLeave=function(e){if(D.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){var i=t.giveEventsController({viewer:D.viewer.getViewer()});i&&i.fireEvent("onLeavingReviewApp",{targetApp:e&&e.options?e.options.id:""})}}},ee});