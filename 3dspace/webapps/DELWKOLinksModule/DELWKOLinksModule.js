define("DS/DELWKOLinksModule/DELWKOLinksUI",["UWA/Core"],function(e){"use strict";return function(t,n,o,r,s,a,c){var l,d,f,u,g,h,m,p,P,I,v,b,L,y,S,E,R,C,A,D={className:"Links MGA-linksUIContainer disableContentselection"},T=o.getNLSValue("LinksUI.PanelTitle"),k={},w=null,U={title:"",labelAttribute:"V_Name",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}};return m=function(){e.is(w)&&(w.title=T+U.title)},p=function(){var i,o,r,s,a=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext());(w=n.create("Panel",{position:{my:"center",at:"center"},domId:"RelationsPanel",immersiveFrame:a.getImmersiveFrame(),resizableFlag:!0,visibleFlag:!1})).close=function(){e.is(d)?t.notify("toggleCmdCheckHeaderState",{cmdName:d,cmdState:!1}):L()},g=n.create("Element","div",{class:D.className}),i=n.create("Element","div",{class:"linksPanel-Container"}),o=n.create("Element","div",{class:"module-messages"}),r=P(),s=I(),o.inject(i),r.inject(i),s.inject(i),i.inject(g)},P=function(){var t;return t=n.create("Element","div",{class:"linkView-toolbar"}),(h=n.create("Filter",{filterToolbarSections:f})).inject(t),h.addEvent("onChange",function(t,n){var i,o;for(i in o=this.getSelectedItems(),k)k.hasOwnProperty(i)&&(-1===o.indexOf(i)?k[i].pprTypeDiv.hide():(e.is(t,"string")&&"PARENT"===t&&!0===n&&!1===U.whereUsed.isFetched&&y(),k[i].pprTypeDiv.show()))}),t},I=function(){var t,i;for(i in t=n.create("Element","div",{class:"LinksUI-menuDiv"}),(u=n.create("WUXLoader")).inject(t),k)k.hasOwnProperty(i)&&(k[i].pprTypeDiv=new e.Element("div",{class:"pprTypeDiv"}).inject(t));return t},v=function(t,i,s,a,c){var l,d=o.getNLSValue("LinksUI.ConfirmationDialog.Header"),f=o.getNLSValue("LinksUI.ConfirmationDialog.Text");l=function(n){e.is(n,"boolean")&&n&&r.switchScope(t,i,s,a,c)},n.showConfirmation(d,f,null,l)},b=function(t,r){var s,a,c=n.createElement("div",{class:"selectInstance-dialog-container"}),l=[],d=n.getComponent("ComboBox"),f=n.getComponent("Button"),u=o.getNLSValue("LinksUI.SelectInstanceDialog.Header");for(i=0;i<t.length;i++)l.push({label:t[i].get("PLM_ExternalID"),value:t[i]});(a=new d({elementsList:l,enableSearchFlag:!1,actionOnClickFlag:!1})).inject(c),(s=n.create("Dialog",{domId:"selectInstance-dialog",title:u,content:c,resizableFlag:!0,modalFlag:!0,width:400,minWidth:290,buttons:{Cancel:new f({onClick:function(){s.close()}}),Ok:new f({disabled:!1,emphasize:"primary",onClick:function(){s.close(),e.is(r,"function")&&r(a.currentValue)}})}})).close=function(){this.destroy()}},L=function(){w.hide()},y=function(){var n,i=!1,o=!1,r=[],a=[],c=[],l=U.reference.model,d=U.instance.model,f=U.labelAttribute,g=function(){var e,n,s,g;i&&o&&(e=r,n=a,s=c,g={PRODUCT:[],PPLAN:[],BUILDS:[],PROCESS:[],SYSTEM:[],RESOURCE:[],PART:[],PARENT:[],SERVICE:[]},A(),g=E(e,l,d,f,g),g=R(n,s,l,d,f,g),S(g),u.hide(),t.notify("RelationsPanelLoaded"))};n=h.getSelectedItems(),!0!==U.whereUsed.isFetched?e.is(l)?(s.getWhereUsedReferences(l,function(t,n){o=!0,e.is(U.whereUsed)&&(U.whereUsed.isFetched=!0,U.whereUsed.references=t,U.whereUsed.instances=n),a=t,c=n,g()},function(e){i=!0,r=e,g()}),U.whereUsed.isFetched=!0):o=!0:(e.is(l)&&-1!==n.indexOf("PARENT")&&(a=U.whereUsed.references||[],c=U.whereUsed.instances||[]),o=!0)},S=function(t){var i,r,a,c,l,d,f,u,g,m,p;for(a in p=h.getSelectedItems(),t)if(t.hasOwnProperty(a)&&k.hasOwnProperty(a)){if(c=t[a],r=k[a].pprTypeDiv,0===c.length){r.setStyle("display","none");continue}for(p.indexOf(a)>-1?r.show():r.hide(),r.addClassName("pprTypeMarg"),new e.Element("div",{class:"pprTypeTitleDiv",text:k[a].title}).inject(r),i=0;i<t[a].length;i++){if(f=n.create("Element","div",{class:"connectionDiv default"}),m=(l=t[a][i]).type,e.is(m)&&("SecondaryCandidateResourceLink"===m&&(f.className="connectionDiv secondaryRecource"),g=l.iconDirection,e.is(g)&&(-1!==m.indexOf("_inverse")?g.tooltipInfos=n.create("TooltipModel",{shortHelp:o.getNLSValue("LinksUI.BackwardIcon")}):g.tooltipInfos=n.create("TooltipModel",{shortHelp:o.getNLSValue("LinksUI.ForwardIcon")}),g.inject(f)),u=l.icon,e.is(u)&&(u.tooltipInfos=n.create("TooltipModel",{shortHelp:o.getNLSValue(m)}),u.inject(f))),(d=n.create("Element","div",{class:"connectionLabel",text:l.label,styles:{display:"inline-block"}})).tooltipInfos=n.create("TooltipModel",{shortHelp:l.label}),d.inject(f),e.is(U.reference)&&e.is(U.reference.model)){const e=U.reference.model;s.isReferencesHasReadOnlyType(e)}f.inject(r)}}},E=function(n,i,a,d,f){var u,g,h,m,p,P,I,v,b,L,y,S,E,R,C,A=l,D=e.is(i)?i.id:"",T=e.is(a)?a.id:"";for(u=0;u<n.length;u++){switch(g=(P=n[u]._attributes).type){case"DELIsSerializedFrom":g="DELLmiWorkPlanSystemReference";break;case"PartialProductImplementLink":g="CreateAssembly";break;case"ProductionPlanLink":g="DELLmiProductionPlanReference";break;case"DELIsGeneratedFromProcessFilteredBy":g="Builds";break;case"DELLmiTimeConstraintCnx":g=r.getLinkInfo(n[u]).subType;break;case"DELAsmProcessCanUseCnx":r.getSecondaryRscLinksFromPrimaryLink(n[u]).forEach(function(e){(C=e.clone()).set("from",P.from),n.splice(u+1,0,C)});break;case"SecondaryCandidateResourceLink":if(R=r.getConnection(P.from),e.is(R)){(C=n[u].clone()).set("from",R.get("from")),n.splice(u+1,0,C),(C=n[u].clone()).set("from",R.get("to")),n.splice(u+1,0,C);continue}}if(L=P.to,!("ProcessImplementLinkOcc"===P.type&&e.is(P.from,"array")&&e.is(P.to,"array")&&e.is(U.instance.absPath))||c.isImplementLinkValidForOccPath(P.from,P.to,U.instance.absPath))if(E=e.is(P.to,"array")&&"ProcessImplementLink"===g?T===P.to[P.to.length-2]:!!e.is(P.to,"array")&&T===P.to[P.to.length-1],D===P.to||T===P.to||E?(L=P.from,v=o.getIconElem("LinkInverse")):v=o.getIconElem("Link"),y=s.getReference(L),e.is(y)||((b=e.is(L,"array")?"ProcessImplementLink"===g?s.getInstance(L[L.length-2]):s.getInstance(L[L.length-1]):s.getInstance(L))?y=s.getReference(b.get("isInstanceOf")||b.get("to")):t.debug("No linked instance !!!")),e.is(y)){if(p=y.get("type"),e.is(A[p])&&e.is(A[p].Attribute)){S=A[p].Attribute,S=e.is(S,"array")?S:[S];const t=A[p].separator||" ";e.is(b)&&"ProcessImplementLink"===g&&(e.is(P.to,"array")||b.id===P.to)?(m="("+b.get("PLM_ExternalID")+") ",m+=S.map(e=>y.get(e.name)).join(t)):m=S.map(e=>y.get(e.name)).join(t)}else m=y.get(d);I=y.get("PPRTYPE"),e.is(I,"string")?("OPERATION"===I&&(I="SYSTEM"),h=o.getIconElem(g),f[I].push({label:m,icon:h,iconDirection:v,pid:P.PID,linkedReferencePID:y.get("PID"),type:g})):t.debug("PPRTYPE is not available for object type:"+p)}else t.debug("No linked reference !!!")}return f},R=function(n,i,r,s,a,c){var d,f,u,g,h,m,p,P,I,v,b=l;for(d=0;d<n.length;d++){if(m=(P=n[d]).get("type"),e.is(b[m])&&e.is(b[m].Attribute))for(v=b[m].Attribute,v=e.is(v,"array")?v:[v],p=b[m].separator||" ",g="",f=0;f<v.length;f++)0!==f&&(g+=p),g+=P.get(v[f].name);else g=P.get(a);for(u=o.getIconElem(m),h="Type."+m,f=0;f<i.length;f++)if(i[f].get("isAggregatedBy")===P.get("PID")){I=i[f];break}e.is(I)?c.PARENT.push({label:g,icon:u,pid:I.get("PID"),linkedReferencePID:P.get("PID"),type:h}):t.debug("Instance of reference id:"+P.get("PID")+" not found.")}return c},function(t){var n,i;n=r.getConnection(t),e.is(n)?r.deleteConnection(t):(i=s.getInstance(t),e.is(i)&&s.deleteInstance([i],{askDeleteConfirmation:!1}))},function(n){var i,a,c,l,d,f;i=r.getConnection(n),a=!(Array.isArray(i.get("to"))||!e.is(s.getInstance(i.get("to")))),e.is(i)&&(Array.isArray(i.get("to"))?(f=!0,c=i.get("to")[i.get("to").length-1],l=i.get("to")[i.get("to").length-2],c&&l&&v(i.get("from"),c,l,f,i)):a?(f=!0,c=s.getInstance(i.get("to")).get("isInstanceOf"),l=i.get("to"),c&&l&&v(i.get("from"),c,l,f,i)):(f=!1,c=i.get("to"),0!==(d=s.getParentInstancesFromCollection(c)).length?d.length>1?b(d,function(e){e&&(l=e.get("PID"),c&&l&&r.switchScope(i.get("from"),c,l,f,i))}):d[0].get("isInstanceOf")===c&&(l=d[0].get("PID"),c&&l&&r.switchScope(i.get("from"),c,l,f,i)):t.warn(o.getNLSValue("LinksUI.SwitchScopeCallback.Warn"))))},C=function(){var e;for(e in k)k.hasOwnProperty(e)&&("PARENT"===e?h.unselectItem(e,!0):h.selectItem(e,!0))},A=function(){Object.values(k).forEach(function(e){e.pprTypeDiv.empty()})},{init:function(t){D=e.extend(D,t),l=t.relAttributeConfig,d=e.is(t.relatedCmdId)?t.relatedCmdId:null,e.is(t.acceptedTypes)?t.acceptedTypes:null,!e.is(t.exploreInWebApp)||t.exploreInWebApp,f=e.is(t.filterToolbarSections)?t.filterToolbarSections:null,Array.isArray(f)?f.forEach(function(e){k[e]={title:o.getNLSValue("PPRTYPE."+e)}}):k={PRODUCT:{title:o.getNLSValue("PPRTYPE.PRODUCT")},PROCESS:{title:o.getNLSValue("PPRTYPE.PROCESS")},PPLAN:{title:o.getNLSValue("PPRTYPE.PPLAN")},BUILDS:{title:o.getNLSValue("PPRTYPE.BUILDS")},SYSTEM:{title:o.getNLSValue("PPRTYPE.SYSTEM")},RESOURCE:{title:o.getNLSValue("PPRTYPE.RESOURCE")},PART:{title:o.getNLSValue("PPRTYPE.PART")},SERVICE:{title:o.getNLSValue("PPRTYPE.SERVICE")},PARENT:{title:o.getNLSValue("PPRTYPE.PARENT")}},p()},destroy:function(){this.isActive()&&L(),e.is(w)&&(w.destroy(),w=void 0)},showModal:function(t){U=e.extend(U,t),y(),w.show(),m(),w.content=g},isActive:function(){return!!e.is(w)&&w.visibleFlag},clear:function(){U={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}},m(),A()},hideUI:function(){w.hide()},updateWhereUsed:function(t){var n,i,o=-1;if(e.is(t)&&(n=t.isInstance()?t.get("isAggregatedBy"):t.get("PID"),e.is(U.whereUsed.references,"array"))){for(i=0;i<U.whereUsed.references.length;++i)if(U.whereUsed.references[i].id===n){o=i;break}-1!==o?U.whereUsed.references.splice(o,1):t.isInstance()&&(U.whereUsed.instances.push(t),U.whereUsed.references.push(s.getReference(n))),y()}},getCurrentModel:function(){return U},updateTitle:function(e){U.title=e,m()},resetFilter:function(){C()}}}}),define("DS/DELWKOLinksModule/DELWKOLinks",["UWA/Core","DS/DELWKOLinksModule/DELWKOLinksUI"],function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","SelectionBehavior","LinkBehavior","ModelBehavior","EditAttributeBehavior","ImplementBehavior","ProductFlowLinkBehavior"],creator:function(n,i,o,r,s,a,c,l){var d,f,u,g,h,m,p,P=null;return g=function(t,n){s.getXMLValues(d.relationsDialogDisplayAttributeConfigXML,function(n){var i=n.convert("DisplayAttributeDescriptionList.Type","name")||{},o=n.convert("DisplayAttributeDescriptionList.Relation","linkName")||{};f=e.merge(i,o),t()},function(e){n(e)})},h=function(t){var n=!1,i=P.getCurrentModel(),o=e.is(i.reference.model)?i.reference.model.id:"",r=e.is(i.instance.model)?i.instance.model.id:"";return t!==o&&t!==r||(n=!0),n},m=function(t){var i={instModel:{},refModel:{},absPath:""},o=t.id?t.id:t.instancePID,r=t.id?t.id:t.referencePID;return i.instModel=a.getInstance(o),e.is(i.instModel)?(i.absPath=t.path?t.path:t.absPath,i.refModel=a.getReferenceModelFromInstance(i.instModel)):(i.refModel=a.getReference(r),e.is(i.refModel)||n.debug("Object with reference PID:"+o+" and instance PID:"+r+" not found.")),i},u=function(t){var n,i,o,s,a={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}};return e.is(t)?(n=m(t),i=n.refModel,o=n.instModel,s=n.absPath):1===r.getSelectedNodesCount()&&r.getSelectionsWithPaths().forEach(function(t){e.is(t)&&1===t.length&&t.forEach(function(e){n=m(e),i=n.refModel,o=n.instModel,s=n.absPath})}),a.title=e.is(i)?i.get("V_Name"):"",a.reference.model=i,a.instance.model=o,a.instance.absPath=s,a},p=function(){P.isActive()&&(P.resetFilter(),P.showModal(u()))},{name:"LinksModule",listenTo:function(){return{select:this.onSelect,Relations:this.onShowRelations,addInstance:this.onAddInstance,addConnection:this.onAddConnections,removeConnection:this.onRemoveConnections,removeReference:this.onRemoveRefOrInst,changeReference:this.onChangeRefOrInst,removeInstance:this.onRemoveRefOrInst,refreshImpacted:this.relaodUI,changeConnection:this.relaodUI}},onStart:function(r,h){if(d=r||{},!e.is(d.relationsDialogDisplayAttributeConfigXML))return n.debug("LinksModule loading failed : relationsDialogDisplayAttributeConfigXML options are undefined"),void h();Promise.all([new Promise(g.bind(this))]).then(function(){(P=new t(n,i,o,s,a,c,l)).init({relAttributeConfig:f,relatedCmdId:d.relatedCmdId,acceptedTypes:d.pprTypes,exploreInWebApp:d.exploreInWebApp,filterToolbarSections:d.filterToolbarSections}),P.showModal(u(d.node)),h()},function(e){n.debug("LinksModule loading failed :"+e),h()})},onStop:function(){P.destroy(),P=void 0},onRemoveRefOrInst:function(t){(t=Array.isArray(t)?t:[t]).forEach(function(t){e.is(t)&&P.isActive()&&(h(t.id)?P.clear():P.updateWhereUsed(t))})},onChangeRefOrInst:function(t){var n;(t=Array.isArray(t)?t:[t]).forEach(function(t){P.isActive()&&e.is(t)&&t.isReference()&&h(t.id)&&(n=t.changedAttributes(),e.is(n)&&n.hasOwnProperty("V_Name")&&P.updateTitle(n.V_Name))})},onShowRelations:function(t){var n;n=e.is(t)?e.is(t,"array")?t[0]:t:null,e.is(n)&&P.isActive()&&P.showModal(u(n))},onSelect:function(){p()},onAddConnections:function(t){var n,i,o;P.isActive()&&(o=function(t){return!!(e.is(t)&&(n=t.getAttribute("from"),i=t.getAttribute("to"),h(n)&&h(i)))},(e.is(t,"array")?t.some(o):o(t))&&P.showModal(P.getCurrentModel()))},onRemoveConnections:function(t){var n,i,o;P.isActive()&&(o=function(t){var o,r,a,c;if(e.is(t))if(n=t.getAttribute("from"),i=t.getAttribute("to"),"SecondaryCandidateResourceLink"===t.get("type")){if(o=s.getConnection(n),!e.is(o))return!1;if(r=o.getAttribute("from"),a=o.getAttribute("to"),c=i,h(r)||h(a)||h(c))return!0}else if(h(n)||h(i))return!0;return!1},(e.is(t,"array")?t.some(o):o(t))&&P.showModal(P.getCurrentModel()))},onAddInstance:function(t){e.is(t)&&P.isActive()&&h(t.get("isInstanceOf"))&&P.updateWhereUsed(t)},relaodUI:function(){p()}}}}});