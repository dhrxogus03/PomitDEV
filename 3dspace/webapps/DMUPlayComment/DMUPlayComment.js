define("DS/DMUPlayComment/DMUSelectPreviousCommentCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseUIControllers/DMUCommentsController"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this._parentBeginExecute=this.beginExecute,this.beginExecute=function(){this._parentBeginExecute();var e=t.giveDMUCommentsController({context:n.getFrameWindow()});e&&e.selectNextOrPreviousComment(!1),n.end?n.end():n.done()}}})}),define("DS/DMUPlayComment/DMUCommentImport",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){this.importData=function(t,n,i){t&&n&&e&&(n.fillObjectAttributes(e,t,i),n.registerForPostImport(e))},this.afterImport=function(){if(e){for(var t=e;t&&"DMUMarkup"!==t.getType();)t=t.getParent();e.fireEvent("onDMUObjectInitialized",{dmuObject:e,dmuCont:t})}}}})}),define("DS/DMUPlayComment/DMUSelectNextCommentCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseUIControllers/DMUCommentsController"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this._parentBeginExecute=this.beginExecute,this.beginExecute=function(){this._parentBeginExecute();var e=t.giveDMUCommentsController({context:n.getFrameWindow()});e&&e.selectNextOrPreviousComment(!0),n.end?n.end():n.done()}}})}),define("DS/DMUPlayComment/DMUComment",["require","exports","DS/DMUPlayComment/DMUCommentImport","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUBaseUI/DMUNode3D","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n,i,o,r,s){"use strict";let a=[{name:"sOwner",type:"string",JSONname:"PropertiesCommentBase.Owner"},{name:"sTextContents",type:"string",JSONname:"PropertiesCommentBase.TextContents",defaultValue:[""]},{name:"fCreationDate",type:"float",JSONname:"PropertiesCommentBase.CreationDate"},{name:"fLastModificationDate",type:"float",JSONname:"PropertiesCommentBase.LastModificationDate"},{name:"bMarkedAsDeleted",type:"boolean",JSONname:"PropertiesCommentBase.MarkedAsDeleted"},{name:"sParentCommentId",type:"string",JSONname:"PropertiesComment.ParentCommentId"},{name:"lReplies",type:"listObjects",JSONname:"PropertiesComment.Replies",defaultValue:null}];return class extends o{constructor(e,t,o){super(e,t),this.addParameters(a);let m,d=this,l=o;const u="DS/DMUComment/DMUCommentContextualBar",g="Marker";let c,h=[];this.setAttribute("sType","Comment"),this.initAuthoringData=function(){-1!==s.getAuthoringFeatureTypes().indexOf(g)&&(-1===s.getAuthoringFeatureTypes().indexOf(g)||d.getSharedContextualMenuCommandList||window.require([u],function(e){var n;let o=new e;d.getSharedContextualMenuCommandList=o.getSharedContextualMenuCommandList,d.getContextualMenuCommandList=o.getContextualMenuCommandList,o.register({frmWindow:d.getFrameWindow(),type:d.getType(),experience:(null===(n=null==t?void 0:t.getParent())||void 0===n?void 0:n.getValidation())?"review":"markup"});let r=1===i.get().length?i.get()[0].pathElement.clone():null;r&&r.getLastElement(!0).getDMUType&&r.getLastElement(!0)===d.getNode()&&(i.empty(),i.add({pathElement:r}))}))},this.removeAuthoringData=function(){-1!==s.getAuthoringFeatureTypes().indexOf(g)&&-1!==s.getAuthoringFeatureTypes().indexOf(g)&&window.require([u],function(e){var n;let i=new e;d.getSharedContextualMenuCommandList=null,d.getContextualMenuCommandList=null,i.unregister({frmWindow:d.getFrameWindow(),experience:(null===(n=null==t?void 0:t.getParent())||void 0===n?void 0:n.getValidation())?"review":"markup"})})};let C=new n(d);this.importData=C.importData,this.afterImport=C.afterImport,this.initAuthoringData();let p=new r({frmWindow:this.getFrameWindow(),getType:this.getType});p.setPickParent(!0),this.setNode(p),this.setReadOnly(Boolean(o)),this.isExternal=function(){return Boolean(l)},this.setAlertFlag=function(e){e!==m&&(m=e,d.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:d}))},this.hasAlertFlag=function(){return m},this.isReply=function(){return Boolean(d.getAttribute("sParentCommentId"))},this.getParentCommentId=function(){return d.getAttribute("sParentCommentId")};let f=this.refreshNode;this.refreshNode=function(){let e=d.getNode();if(e&&(!t||!t.isImporting())){e.setName(d.getAttribute("sName"));let t=d.getActiveFlag()&&d.isDisplayed()&&d.isVisible();e.setVisibility(t),e.setVisibilityFree(!t),f()}};let D=this.isReadOnly.bind(this);this.isReadOnly=function(){return D()||Boolean(d.getAttribute("bMarkedAsDeleted"))},this.addAssociatedHighlightData=function(e){h.some(t=>t.id===e.id)||(h.push(e),d.fireEvent("onDMUCommentAssociatedToHighlight",{dmuObject:d,highlights:h}))},this.updateAssociatedHighlightData=function(e){const t=h.find(t=>t.id===e.id);t&&(e.rating&&(t.rating=e.rating),"hasIssue"in e&&(t.hasIssue=e.hasIssue),"hasImpactedChecks"in e&&(t.hasImpactedChecks=e.hasImpactedChecks),d.fireEvent("onDMUCommentAssociatedToHighlight",{dmuObject:d,highlights:h}))},this.removeAssociatedHighlightData=function({id:e}){let t=h.findIndex(t=>t.id===e);-1!==t&&(h.splice(t,1),d.fireEvent("onDMUCommentAssociatedToHighlight",{dmuObject:d,highlights:h}))},this.getAssociatedHighlightData=function(){return h},this.setPreviewFlag=(e=>{c=e}),this.isPreview=(()=>c),this.getTextContent=function(){const e=(d.getAttribute("sTextContents")||[]).join("\n");let t=document.createElement("div");return t.innerHTML=e,t.innerText},this.getReferencedCheckIds=(()=>{const e=(d.getAttribute("sTextContents")||[]).join("\n");let t=document.createElement("div");t.innerHTML=e;const n=t.querySelectorAll("span[data-id]");return Array.from(n).map(e=>e.getAttribute("data-id")||"")}),this.importDeprecatedReplies=(e=>{let t=d.getAttribute("lReplies");if(t){t=t.slice();let n=e.getDMUComments().indexOf(d);t.forEach(function(t,i){d.getNode().removeChild(t.getNode()),t.setAttributes([{name:"sType",value:"Comment"},{name:"sParentCommentId",value:d.getAttribute("sUuid")}]),e.addDMUComment(t,n+1+i)}),d.setAttribute("lReplies",null)}}),this.deprecatedAddDMUReply=function(e,t){if(!e||!e.getType||"DMUComment"!==e.getType())return;let n=d.getAttribute("lReplies")||[];"number"==typeof t?n.splice(t,0,e):n.push(e),d.setAttribute("lReplies",n),e.getNode&&d.getNode().addChild(e.getNode()),d.fireEvent("onDMUObjectAddedInObject",{dmuObject:e,parentObject:d})}}}});