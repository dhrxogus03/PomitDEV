define("DS/CfgXRevisionUX/scripts/CfgXRevisionCreateView",["DS/Controls/Button","UWA/Class/View","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],function(e,t,i,s,o,n,r){"use strict";return t.extend({render:function(){n.ModelEvents=new r;let t=UWA.createElement("div",{class:"xRevision"}),a=[this.options.referenceId],l=new e({label:o.Create_xRevision,domId:"xRevision-button",emphasize:"default"}).inject(t),c=new e({label:o.Reuse_xRevision,domId:"xRevision-button",emphasize:"default"}).inject(t);var d=this;l.addEventListener("click",async function(e){try{let e=await s.createxRevision(a[0]);e&&e.xRevisionGraphPID&&s.showwarning(o.xRevision_Creation_Success,"success"),d.publishPostProcessingEvent()}catch(e){e&&e.errorMessage?s.showwarning(e.errorMessage,"error"):s.showwarning(o.xRevision_Creation_Error,"error")}n.ModelEvents.publish({event:"XRevCreatecloseDialog"})});let h=async e=>{let t=e[0].id;try{let e={selectedObjectId:t,inputObjectIdList:a},i=await s.setConfiguredObjectInfo(e);i&&"SUCCEED"===i.result&&s.showwarning(o.xRevision_Creation_Success,"success"),d.publishPostProcessingEvent()}catch(e){e&&e.errorMessage?s.showwarning(e.errorMessage,"error"):s.showwarning(o.xRevision_Creation_Error,"error")}n.ModelEvents.publish({event:"XRevCreatecloseDialog"})};return c.addEventListener("click",function(e){let t=new i(!1,"Open Products"),s=d.options.type,n=enoviaServerFilterWidget?enoviaServerFilterWidget.myRole:"",r=a;t.activate(o.Select_Physical_product,s,n,h,"",r)}),t},publishPostProcessingEvent:function(){let e={commandName:"cfgEditConfigurationContext",widgetId:widget.id,response:{},data:{pids:[this.options.referenceId]}};s.publishPostProcessingEventForApplications(e)}})}),define("DS/CfgXRevisionUX/scripts/PLMNewRevisionFacetView",["UWA/Class/View","DS/Controls/ComboBox","DS/CfgBaseUX/scripts/CfgAutoComplete","DS/Handlebars/Handlebars4","text!DS/CfgXRevisionUX/scripts/CfgPLMNewRevisionFacetTemplate.html","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],function(e,t,i,s,o,n,r,a){"use strict";var l=s.compile(o);return e.extend({className:"cfg-X-revision-PLMNewRevisionFacetView",init:function(e){this._parent(e),r.rolesAvailable(e=>{e.isCFGRoleAvail?this.initUI(this.options):this.container.addContent(`<font-size="17px"> ${a.RevisionFacet_NoCFGRole} </font>`)})},initUI:async function(e){await r.populate3DSpaceURL(),enoviaServerFilterWidget.mySecurityContext||await r.populateSecurityContext(),e.revisionControlLabel=a.labelRevisionControl,e.controlledByLabel=a.labelControlledBy,e.modelCriteriaLabel=a.labelModelCriteria,e.revControlInfo=a.revisionInfo,this.container.setHTML(l(e)),this.container.getElement(".modelCriteriaLabel").hide();let i=this.container.getElement(".CfgClassical"),s=this.container.getElement(".CfgEffectivityBased"),o=this.container.getElement(".CfgReuse"),n=this.container.getElement(".CfgModel");i.show(),s.hide(),o.hide(),n.hide();const c=[{labelItem:a.revisionControlClassical,valueItem:"Classical"},{labelItem:a.revisionControlEffectivityBased,valueItem:"Effectivity based"},{labelItem:a.revisionControlEffectivityBasedUseExisting,valueItem:"Effectivity based - Use existing graph"},{labelItem:a.revisionControlEffectivityBasedModel,valueItem:"Effectivity based - Model"}];this.revisionControlSelector=new t({elementsList:c,selectedIndex:0}).inject(this.container.getElement(".revisionControlDropDown")),this.revisionControlSelector.addEventListener("change",e=>{"Classical"===e.dsModel.value?(i.show(),s.hide(),o.hide(),n.hide(),this.currentRevControl=e.dsModel.value,this.buildClassicUX(i)):"Effectivity based"===e.dsModel.value?(i.hide(),s.show(),o.hide(),n.hide(),this.currentRevControl=e.dsModel.value,this.buildEffectivityBasedUX(s)):"Effectivity based - Use existing graph"===e.dsModel.value?(i.hide(),s.hide(),o.show(),n.hide(),this.currentRevControl=e.dsModel.value,this.reuseUXReady||this.buildReuseUX(this.container.getElement(".reuseAutoComplete"))):"Effectivity based - Model"===e.dsModel.value&&(i.hide(),s.hide(),o.hide(),n.show(),this.currentRevControl=e.dsModel.value,this.modelUXReady||this.buildModelUX(this.container.getElement(".modelAutoComplete")))})},buildModelUX:function(e){let t=[];this.selectedModelID&&t.push(this.selectedModelID),({autoComplete:this.modelRearchAutocomplete,searchBtn:this.modelSearchBtn}=this.createAutocompleteWithSearch("Model",e,'( NOT current:"Inactive")',t,a.SelectConfigurationContext)),this.modelUXReady=!0},renderCriteria:function(){const e={version:"1.0",modelIds:[{id:`pid:${this.selectedModelID}`}]};r.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",JSON.stringify(e),e=>{let i=Object.entries(e.criteria[0]).filter(e=>{if("products"==e[0]&&"TRUE"==e[1]||"manufacturingPlans"==e[0]&&"TRUE"==e[1])return e[0]}).map(e=>"products"==e[0]?{labelItem:a.ProductState,valueItem:"products"}:"manufacturingPlans"==e[0]?{labelItem:a.ManufacturingPlan,valueItem:"manufacturingPlans"}:void 0);i.length>0&&(this.container.getElement(".modelCriteriaLabel").show(),this.criteriaDropDown?(this.criteriaDropDown.elementsList=i,this.criteriaDropDown.selectedIndex=0):this.criteriaDropDown=new t({elementsList:i,selectedIndex:0}).inject(this.container.getElement(".modelCriteriaDropDown")))},function(e){console.log("getCriteria failed")},!0)},buildClassicUX:function(e){},buildEffectivityBasedUX:function(e){},createAutocompleteWithSearch:function(e,t,s,o,n){let r={query:[{type:e,condition:s,excludedArray:o}],searchTitle:n,multiselection:!1,minLengthBeforeSearch:0,parentElement:t,showRevision:!1,callBackFunction:t=>this.onSearchComplete(t,e),clearInfo:()=>this.clearInfo(e)};const{autoComplete:a,searchBtn:l}=new i(r).render();return{autoComplete:a,searchBtn:l}},onSearchComplete:function(e,t){e&&("VPMReference"===t?this.selectedRefIDForReuse=e.get("ID"):"Model"===t&&(this.selectedModelID=e.get("ID"),this.renderCriteria()))},clearInfo:function(e){"VPMReference"===e?this.selectedRefIDForReuse="":"Model"===e&&(this.selectedModelID="",this.criteriaDropDown&&(this.criteriaDropDown.elementsList={}))},buildReuseUX:function(e){let t=[];this.selectedRefIDForReuse&&t.push(this.selectedRefIDForReuse),({autoComplete:this.refRearchAutocomplete,searchBtn:this.refSearchBtn}=this.createAutocompleteWithSearch("VPMReference",e,'( NOT current:"Inactive")',t,a.Select_Physical_product)),this.reuseUXReady=!0}})}),define("DS/CfgXRevisionUX/scripts/CfgXRevisionVariabilityView",["UWA/Class/View","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXRevisionUtility","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgController","DS/CfgEvolutionUX/CfgModelSelection","DS/Controls/Label","DS/CoreEvents/ModelEvents","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","DS/EffectivityWebExternalJS/scripts/CfgVersionExplorerLoader","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],function(e,t,i,s,o,n,r,a,l){"use strict";return e.extend({className:"cfg-X-revision-versionexplorerview",vEObject:{},getVEObject(){return this.vEObject.value},handleResize:function(e){new ResizeObserver(t=>{t[0].target.getDimensions().width<330?(e.addClassName("VariabilityResize"),this.divVersionGraph.addClassName("CfgVersionGraphInVariabilityResize")):(e.removeClassName("VariabilityResize"),this.divVersionGraph.removeClassName("CfgVersionGraphInVariabilityResize"))}).observe(this.container)},init:async function(e){try{s.ModelEvents=new a,o.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",this._parent(e),await t.populate3DSpaceURL(),enoviaServerFilterWidget.mySecurityContext||await t.populateSecurityContext();const n=await i.getScopesFromXRevision(this.options.objectID);if(!n||!n.scopes||!Array.isArray(n.scopes))throw new Error("No scopes data received from getScopesFromXRevision WS call");if(0==n.scopes.length)return t.showNotifs("info","",l.noScopeDefined,"",this.divVersionGraph),void this.noContextDisply();await this.getAllocation();let r=UWA.createElement("div",{id:"CfgModelInVariability"}).inject(this.container);UWA.createElement("div",{class:"contextLabel",html:`${l.Context}:`}).inject(r),this.contextDiv=UWA.createElement("div",{class:"contextDiv"}).inject(r),this.divVersionGraph=UWA.createElement("div",{class:"CfgVersionGraphInVariability"}).inject(this.container),n.scopes.length>1&&this.handleResize(r),this.createModelSelectorComp(n.scopes),this.displayCompactMode=!this.options.displayCompactMode||0!=this.options.displayCompactMode,this.options.callBackFunction=(()=>this.pubSubEvents()),this.modelID=n.scopes[0],await this.loadVersionGraph(),s.ModelEvents.subscribe({event:"AllocationSuccess"},e=>{this.allocatedID=e.allocationID}),s.ModelEvents.subscribe({event:"DeallocationSuccess"},e=>{this.allocatedID=""})}catch(e){console.error(e)}},loadVersionGraph:async function(){this.divVersionGraph.innerHTML="",console.log(`CFGUX: ID to be selected on graph Variability view: ${this.allocatedID}`),await VersionExplorerLoaderFactory(this.modelID,this.options.callBackFunction,enoviaServerFilterWidget.tenant,enoviaServerFilterWidget.baseURL,enoviaServerFilterWidget.getSecurityContext(),this.divVersionGraph,{id:this.allocatedID||""},"Products",this.vEObject)},getAllocation:async function(){try{this.allocatedID="";const e=await i.getAllocation(this.options.objectID);if(!e||!e.result||!Array.isArray(e.result))throw new Error("No allocation data received in getAllocation WS call");const[{allocationPIDs:t}]=e.result;[this.allocatedID]=t}catch(e){}},render:function(){return this.container},pubSubEvents:function(){this.getVEObject().subscribeEvent("select",e=>{const t=e.data.nodeModel.getAttribute("id");this.allocatedID!==t&&s.ModelEvents.publish({event:"changeInAllocation",data:{xRevisionElementPID:this.options.objectID,allocationPID:[t],task:"allocation"}})}),this.getVEObject().subscribeEvent("unselect",e=>{s.ModelEvents.publish({event:"changeInAllocation",data:{xRevisionElementPID:this.options.objectID,allocationPID:[e.data.nodeModel.getAttribute("id")],task:"deallocation"}})})},createModelSelectorComp:async function(e){try{const s=await i.getModelsDataFromSearch(e);if(!s||!s.results||!Array.isArray(s.results)||s.results.length<=0)throw new Error("CFGUX: No response from search WS call");const o={Data:s.results.map(e=>({valueItem:t.getAttributeValue(e.attributes,"resourceid"),labelItem:[t.getAttributeValue(e.attributes,"ds6w:label")],name:[t.getAttributeValue(e.attributes,"ds6w:identifier")]})),currentindex:0,parentElement:this.contextDiv};this.ModelSelectionComponent=new n(o),this.ModelSelectionComponent.render()}catch(e){console.error(e)}s.ModelEvents.subscribe({event:"modelUpdated"},e=>{this.modelID=e.model.valueItem,this.loadVersionGraph()})},noContextDisply:function(){const e=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png";this.container.setContent(`<span><img src=${e} style="width:25%;"></img></span><br>`),this.container.addContent(`<font-size="17px"> ${l.noScopeDefined} </font>`),this.container.addClassName("cfg-X-revision-versionExplorerEmptyView")}})});