define("DS/DELPPWReplaceWhereUsedModule_FD02/ReplaceWhereUsedModule",["UWA/Core"],function(e){"use strict";return{behaviors:["UXFactoryBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ResourceBehavior","ReplaceBehavior","MfgItemBehavior","ModelBehavior","SearchBehavior","SelectionBehavior"],creator:function(t,n,a,o,i,r,l,s,c,p){var u,I={Replace_By_Existing:{label:i.getNLSValue("MIL.ReplaceByExisting"),value:1,tooltip:i.getNLSValue("MIL.ToolTip.ReplaceByExisting"),getLabel:function(){return this.tooltip}},Replace_By_NewRev:{label:i.getNLSValue("MIL.ReplaceByNewRevision"),value:2,tooltip:i.getNLSValue("MIL.ToolTip.ReplaceByNewRev"),getLabel:function(){return this.tooltip}},Replace_By_NewBranch:{label:i.getNLSValue("MIL.ReplaceByNewBranch"),value:3,tooltip:i.getNLSValue("MIL.ToolTip.ReplaceByNewBranch"),getLabel:function(){return this.tooltip}},Remove:{label:i.getNLSValue("MIL.Remove"),value:5,tooltip:i.getNLSValue("MIL.Remove"),getLabel:function(){return this.tooltip}},Ignore:{label:i.getNLSValue("MIL.Ignore"),value:4,tooltip:i.getNLSValue("MIL.Ignore"),getLabel:function(){return this.tooltip}},Add:{label:i.getNLSValue("MIL.Add"),value:6,tooltip:i.getNLSValue("MIL.Add"),getLabel:function(){return this.tooltip}}},g=function(e){var t=new Map;return e?(t.set(I.Ignore.value,{labelItem:I.Ignore.label,valueItem:I.Ignore.value,tooltipItem:I.Ignore.tooltip}),t.set(I.Add.value,{labelItem:I.Add.label,valueItem:I.Add.value,tooltipItem:I.Add.tooltip})):(t.set(I.Replace_By_Existing.value,{labelItem:I.Replace_By_Existing.label,valueItem:I.Replace_By_Existing.value,tooltipItem:I.Replace_By_Existing.tooltip}),t.set(I.Replace_By_NewRev.value,{labelItem:I.Replace_By_NewRev.label,valueItem:I.Replace_By_NewRev.value,tooltipItem:I.Replace_By_NewRev.tooltip}),t.set(I.Replace_By_NewBranch.value,{labelItem:I.Replace_By_NewBranch.label,valueItem:I.Replace_By_NewBranch.value,tooltipItem:I.Replace_By_NewBranch.tooltip}),t.set(I.Remove.value,{labelItem:I.Remove.label,valueItem:I.Remove.value,tooltipItem:I.Remove.tooltip}),t.set(I.Ignore.value,{labelItem:I.Ignore.label,valueItem:I.Ignore.value,tooltipItem:I.Ignore.tooltip})),t},d=function(e){return{label:e.label,icons:[i.getIconURLFromKey(e.type)],useAsyncPreExpand:!0,referencePID:e.PID,referenceType:e.type,instancePID:e.instancePID,parentReferencePID:e.parentReferencePID,parentInstancePID:e.parentInstancePID,scopedParentPrdRefIDs:"",mfgOccPathArr:[],defaultMILSuggestionValue:e.selectedAction,rwuStatus:"",isLeaf:e.isLeaf,isCreated:e.isCreated,current:e.currentFullName,selectableFlag:!1,grid:{RWU_Action:e.selectedRWUAction,RWU_Status:"","PLM_ExternalID.instance":e.PLMExternalInstanceID,"revision.reference":e.revision,RWU_Replace:e.reroutingProposal,RWU_ReplacePID:e.RWUReplacePID,cellInfo:{mbomId:e.PID,action:e.selectedAction,suggestionToPerformEntries:(e.isLeaf,Array.from(e.suggestionsLinkedMap.values())),PreviousProdIconUrl:"",MfgItemIconUrl:i.getIconURLFromKey(e.type),isLeaf:e.isLeaf,RWU_Replace:e.reroutingProposal}}}},f=function(e,t){e?4===t.options.grid.RWU_Action.value?(t.options.grid.RWU_Status=i.getNLSValue("MfgItemCreateReportUI.Status.Ignored"),t.options.rwuStatus="ignored"):(t._options.isCreated&&(t.options.grid.RWU_Status=i.getNLSValue("MfgItemCreateReportUI.isMfgRefernceCreatedOrReused.Created"),t.options.rwuStatus="success"),t.options.grid.RWU_Status=i.getNLSValue("MIL.Status.Success"),t.options.rwuStatus="success"):t._options.isCreated?4===t.options.grid.RWU_Action.value?(t.options.grid.RWU_Status=i.getNLSValue("RWU.Status.NotCreated"),t.options.rwuStatus="ignored"):(t.options.grid.RWU_Status=i.getNLSValue("RWU.Message.CreationFailed",{suggestion:t.options.grid.RWU_Action.label,mfg:t.getLabel(),failureMsg:""}),t.options.rwuStatus="fail"):(t.options.grid.RWU_Status=i.getNLSValue("MIL.Message.Failure",{suggestion:t.options.grid.RWU_Action.label,mfg:t.getLabel(),failureMsg:""}),t.options.rwuStatus="fail"),a.updateNode(t._referencePID)},R=function n(o,c,p,I){var g,d;o.length>c&&(""!==(g=o[c]).instancePID?(d=e.is(a.getNodeModel(g.PID))?a.getNodeModel(g.PID):null,e.is(d,"array")&&d.every(function(a){return a.options.instancePID===g.instancePID&&new Promise(function(n){!function(n,a,o,c){var p,I,g,d,R,P=function(){f(!0,n),c()},D=function(){f(!1,n),c()},m=[];switch(p=[[{id:n.options.instancePID,path:[n.options.instancePID]}]],n.options.grid.RWU_Action.value){case 1:e.is(n.options.grid.RWU_ReplacePID)&&""!==n.options.grid.RWU_ReplacePID?r.replace("replaceByExisting",n.options.grid.RWU_ReplacePID,p,!1,P,D):(t.warn(i.getNLSValue("RWU.ReroutingProposalEmpty")),u.buttons.Ok.disabled=!1,D());break;case 2:e.is(a.get(n.options.referencePID))?r.replace("replaceByExisting",a.get(n.options.referencePID),p,!1,P,D):r.replace("replaceByNewRevision",null,p,!1,function(t){var o,i;for(o=0;o<t.instancesAndReferences.length;o++)t.instancesAndReferences[o].get("type")===n.options.referenceType&&(i=t.instancesAndReferences[o].get("PID"));e.is(i)?(a.set(n.options.referencePID,i),P()):D()},D);break;case 3:I={},e.is(o.get(n.options.referencePID))?r.replace("replaceByExisting",o.get(n.options.referencePID),p,!1,P,D):(I[n.options.parentReferencePID]={brokenMfgItems:{},engConfigFilter:"",mfgConfigFilter:""},I[n.options.parentReferencePID].brokenMfgItems[n.options.instancePID]={MbomUpdateAction:"ReplaceByNewBranch",VTreeOrder:n.options.grid.V_TreeOrder,aggregatedByPath:n.options.parentReferencePID,brokenMfgPID:n.options.instancePID,candidatePaths:[n.options.instancePID],candidateProduct:"",id:n.options.instancePID,instanceLID:n.options.instancePID,instancePID:n.options.instancePID,isBroken:!0,isInstanceOf:n.options.referencePID,isLeaf:!0,mfgOccPathPIDs:n.options.instancePID,referecePID:n.options.referencePID,routeMfgItemPID:n.options.parentReferencePID,status:"NotApplicable",type:"MfgItemsUpdateStatus",typeOfScope:"None",fromRWU:!0},l.webservice("rerouteLink",null,I,function(t){e.is(t.succeeded)&&e.is(t.succeeded[n.options.parentReferencePID])?(o.set(n.options.referencePID,t.succeeded[n.options.parentReferencePID][n.options.instancePID].instancesAndReferences[0].PID),P()):D()}));break;case 4:P();break;case 5:s.deleteInstance([s.getInstance(n.options.instancePID)],{forceDBMode:!0,askDeleteConfirmation:!1,onComplete:function(){P()},onFailure:function(){D()}});break;case 6:g=s.getReferenceModel(n.options.parentReferencePID),s.fetchRoot(n.options.referencePID,{onComplete:function(t){if(e.is(t)&&e.is(g)){for(d=0;d<n.options.grid.RWU_ReplacePID;d++)R=s.createMultipleInstances([{rootReferencePID:n.options.referencePID,referencePID:n.options.referencePID,targetReferencePID:n.options.parentReferencePID,instancePID:null,targetRootReferencePID:n.options.parentReferencePID,targetInstancePID:null,allowMove:!0,instancePIDsArray:[],targetInstancePIDsArray:[],path:[]}],g.get("V_Name"),t.get("V_Name")),m.push(R);Promise.all(m).then(function(){P()}).catch(function(){D()})}else D()},onFailure:function(){D()},forceDBMode:!0});break;default:D()}}(a,p,I,n)}).then(function(){return n(o,c+1,p,I),!1}),!0})):n(o,c+1,p,I))},P=function(r){var l=n.getComponent("Dialog"),f=n.getComponent("Button"),P=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext()).getImmersiveFrame(),D=P.elements.container.getSize(),m=n.create("Element","div",{class:"mil-tree-container",styles:{height:"100%",width:"100%"}}),v=a.getWUXNodeModel(),L=g(!1),N=e.is(r.values)?Array.isArray(r.values)?r.values:[r.values]:{};e.extend(v.options,{shouldBeSelected:function(e){var t=!0;return e._options.isLeaf||(t=!1),t}}),o.loadDocument(v),o.getContent().inject(m),function(e,t){var n,o=new Map,r=[];e.forEach(function(e){var l="",s="",c="",p=!1;if(""!==e.instancePID){switch(e.currentFullName){case"FROZEN":l=t.get(1).valueItem,s=I.Replace_By_Existing;break;case"IN_WORK":"RELEASED"===a.getNodeModel(e.parentReferencePID)[0].options.current?(l=t.get(1).valueItem,s=I.Replace_By_Existing):(l=t.get(2).valueItem,s=I.Replace_By_NewRev);break;case"RELEASED":l=t.get(3).valueItem,s=I.Replace_By_NewBranch;break;default:l=t.get(4).valueItem,s=I.Ignore}p=!0,c=i.getNLSValue("RWU.ManufItemSelection")}(n=d({label:e.V_Name,type:e.type,PID:e.PID,instancePID:e.instancePID,parentReferencePID:e.parentReferencePID,parentInstancePID:e.parentInstancePID,selectedAction:l,isLeaf:p,currentFullName:e.currentFullName,selectedRWUAction:s,PLMExternalInstanceID:e.PLM_ExternalInstanceID,reroutingProposal:c,suggestionsLinkedMap:t,RWUReplacePID:"",isCreated:!1,revision:e.revision})).isLeaf&&-1===r.indexOf(n.instancePID)?(o.set(e.PID,a.addNodeModel(n,o.get(e.parentReferencePID))),r.push(n.instancePID)):n.isLeaf||-1!==r.indexOf(n.referencePID)||(o.set(e.PID,a.addNodeModel(n)),r.push(n.referencePID))}),a.expandAllRoots()}(N,L),(u=new l({domId:"replaceWhereUsed-Dialog",immersiveFrame:P,modalFlag:!0,visibleFlag:!1,resizableFlag:!0,snappableFlag:!1,height:D.height-240,width:D.width-1e3,title:i.getNLSValue("RWU.Dialog.Title"),content:m,closeButtonFlag:!0,buttons:{Ok:new f({domId:"replaceWhereUsed-Dialog-Apply",className:"ok primary",label:i.getNLSValue("MIL.PanelApplyButton"),emphasize:"primary",disabled:!1,onClick:function(){u.buttons.Ok.disabled=!0,u.buttons.Apply.disabled=!0,R(N,0,new Map,new Map)}}),Cancel:new f({domId:"replaceWhereUsed-Dialog-Close",className:"close",label:i.getNLSValue("MIL.PanelCloseButton"),onClick:function(){u.close()}}),Apply:new f({domId:"replaceWhereUsed-Dialog-Add",className:"Add",label:i.getNLSValue("RWU.Button.AddInstances"),onClick:function(){!function(n){var a,o,r,l,u=p.getModuleSelections(t.getId()),f=t.getBehavior("WUXNodeModelBehavior");e.is(u,"array")&&u.length>0?(a=u[0].id,o=s.getReferenceModel(a),r=s.getValidChildTypes(o),c.showSearchDialoguAndActivate(function(a){u.forEach(function(o){var r,c=f.getNodeModel(o.id,!0),p=f.getNodeModel(c.options.parentReferencePID,!0);e.is(c.options.grid)&&c.options.grid.cellInfo.isLeaf&&(e.is(a,"array")?a.forEach(function(t){l=s.getReferenceModel(t),r=e.is(l)?d({label:l.get("V_Name"),type:l.get("type"),PID:l.get("PID"),instancePID:Math.random().toString(),parentReferencePID:c.options.parentReferencePID,parentInstancePID:null,selectedAction:I.Ignore.value,isLeaf:!0,currentFullName:l.get("V_Name"),selectedRWUAction:I.Add,PLMExternalInstanceID:null,reroutingProposal:i.getNLSValue("RWU.Quantity",{quantity:1}),RWUReplacePID:1,suggestionsLinkedMap:g(!0),isCreated:!0,revision:l.get("revision")}):d({label:a[0]["ds6w:label"],type:a[0].type,PID:a[0].id,instancePID:Math.random().toString(),parentReferencePID:c.options.parentReferencePID,parentInstancePID:null,selectedAction:I.Ignore.value,isLeaf:!0,currentFullName:a[0]["ds6w:label"],selectedRWUAction:I.Add,PLMExternalInstanceID:null,reroutingProposal:i.getNLSValue("RWU.Quantity",{quantity:1}),RWUReplacePID:1,suggestionsLinkedMap:g(!0),isCreated:!0,revision:a[0]["ds6wg:revision"]}),f.addNodeModel(r,p),n.push({instancePID:r.instancePID,PID:r.referencePID})}):t.warn(i.getNLSValue("RWU.ObjectRetrievalFailure")),f.updateNode(c.options.parentReferencePID))})},{title:i.getNLSValue("Dialog.InsertInstanceCmd.Title"),searchTitle:i.getNLSValue("Search.InsertInstanceCmd.Placeholder"),types:r})):t.warn(i.getNLSValue("ReplaceWhereUsed.NoSelection"))}(N)}})}})).close=function(){a.emptyNodeModel(),u.hide()},u.show()};return{listenTo:function(){return{replaceWhereUsedModule:P}},onStart:function(){},onStop:function(){a.getTreeDocument().removeRoots()},start:function(){},stop:function(){}}}}});