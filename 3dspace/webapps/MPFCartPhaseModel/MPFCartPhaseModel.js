define("DS/MPFCartPhaseModel/CartPhaseModel",["UWA/Core","UWA/Promise","DS/MPFModel/MPFModel","DS/MPFModel/ModelValidator","i18n!DS/MPFCartPhaseModel/assets/nls/CartPhaseModel"],function(t,e,r,a,s){"use strict";const i=Object.freeze({STATE:"currentState",NAME:"Name",DESCRIPTION:"PhaseDescription",NUMBER:"PhaseNumber",PRICE:"UnitNetAmount",START_DATE:"PhaseStartDate",END_DATE:"PhaseEndDate",TOTAL_NET_AMOUNT:"TotalNetAmount",TOTAL_TAXES_AMOUNT:"TotalTaxesAmount",TOTAL_GROSS_AMOUNT:"TotalGrossAmount",UNIT_TAXES_AMOUNT:"UnitTaxesAmount",UNIT_NET_AMOUNT:"UnitNetAmount",PHASE_NUMBER:"PhaseNumber",DOCUMENTS:"documents",OFFER_ID:"OfferID",QUANTITY:"Quantity",INNOVATE_OFFER_ID:"innovateOfferId",SKU_ID:"SkuId",ITEM_TYPE:"ItemType",ROLE:"Role",PERIODICITY:"Periodicity"}),n=Object.freeze({DRAFT:"DRAFT",SUBMITTED:"SUBMITTED",ACCEPTED:"ACCEPTED",PENDING_PROCESSING:"PENDING_PROCESSING",PROCESSING:"PROCESSING",DELIVERED:"DELIVERED",PAYMENT_REFUSED:"PAYMENT_REFUSED",READY:"READY",SHIPPED:"SHIPPED",DELETED:"DELETED"}),o=Object.freeze({[n.DRAFT]:s.get("submitted"),[n.SUBMITTED]:s.get("submitted"),[n.ACCEPTED]:s.get("quoted"),[n.PENDING_PROCESSING]:s.get("confirmed"),[n.PROCESSING]:s.get("processing"),[n.PAYMENT_REFUSED]:s.get("unknown"),[n.DELIVERED]:s.get("delivered"),[n.READY]:s.get("ready"),[n.SHIPPED]:s.get("delivered"),[n.DELETED]:s.get("canceled")}),d=Object.freeze({DOCUMENTS:"documents"}),u=r.extend({setup(t,e){this._type="CartPhaseModel",this._parent(t,e),this.validator=this._createValidator()},updateState(t){let r;if(Object.keys(n).indexOf(t)>-1){const e={};e[i.STATE]=t,r=this.savePromise(e,{patch:!0})}else r=e.reject(new Error("state "+t+" does not exist"));return r},validate(t){return this.validator.validate(t)},_createValidator(){return new a({model:this,validations:[{attribute:i.DESCRIPTION,required:!0,requiredError:s.get("errorDescriptionMissing")},{attribute:i.PRICE,required:!0,pattern:/^-?\d+(\.\d{1,3})?$/,requiredError:s.get("errorPriceMissing"),invalidError:s.get("errorPriceFormat")},{attribute:i.PRICE,pattern:/^(?!-)[0-9.,]+$/,invalidError:s.get("errorPriceZeroOrNegative")},{attribute:i.PRICE,pattern:/[1-9]+/,invalidError:s.get("errorPriceZeroOrNegative")},{attribute:i.START_DATE,required:!0,requiredError:s.get("errorStartDateMissing")},{attribute:i.END_DATE,required:!0,requiredError:s.get("errorEndDateMissing")}]})},getState(){return this.get(i.STATE)},setState(t){return this.set(i.STATE,t)},getName(){return this.get(i.NAME)},getNumber(){return this.get(i.NUMBER)},setNumber(t){return this.set(i.NUMBER,t)},getDescription(){return this.get(i.DESCRIPTION)},getPrice(){return this.get(i.PRICE)},getStartDate(){return this.get(i.START_DATE)},getEndDate(){return this.get(i.END_DATE)},getTotalNetAmount(){return this.get(i.TOTAL_NET_AMOUNT)},getTotalTaxesAmount(){return this.get(i.TOTAL_TAXES_AMOUNT)},getTotalGrossAmount(){return this.get(i.TOTAL_GROSS_AMOUNT)},getUnitNetAmount(){return this.get(i.UNIT_NET_AMOUNT)},getUnitTaxesAmount(){return this.get(i.UNIT_TAXES_AMOUNT)},getPhaseNumber(){return this.get(i.PHASE_NUMBER)},getOfferId(){return this.get(i.OFFER_ID)},setOfferId(t){return this.set(i.OFFER_ID,t)},getDisplayedState(){return o[this.getState()]||s.get("unknown")},getDocuments(){return this.get(i.DOCUMENTS)},hasDocuments(){const t=this.getDocuments();return!!t&&t.length>0},getRole(){return this.get(i.ROLE)},getPeriodicity(){return this.get(i.PERIODICITY)},getQuantity(){return this.get(i.QUANTITY)},isEditable(){const t=this.getState();return this.isNew()||t===n.DRAFT||t===n.SUBMITTED}});return u.Fields=Object.freeze(i),u.States=Object.freeze(n),u.Expands=Object.freeze(d),u}),define("DS/MPFCartPhaseModel/CartPhaseDataProxy",["DS/MPFDataProxy/DataProxy"],function(t){"use strict";return t.extend({init:function(t,e){this._parent(t,"/mdcart/phases",e)}})}),define("DS/MPFCartPhaseModel/CartCartPhaseDataproxy",["UWA/String","DS/MPFDataProxy/DataProxy","DS/MPFError/NotImplementedError"],function(t,e,r){"use strict";return e.extend({init:function(t,e){this._parent(t,"/mdcart/carts/{0}/phases",e)},buildPath:function(e,r){return t.format(this.resourcePath,e.parentResourceId)},urlPut:r.emit,urlDelete:e.delegate,urlPatch:e.delegate,doPut:r.emit,doDelete:e.delegate,doPatch:e.delegate})}),define("DS/MPFCartPhaseModel/CartPhasesValidationResults",["UWA/Class"],function(t){"use strict";return t.extend({init:function(){this._isValid=!0,this._phaseValidationResults=[]},isValid:function(){return this._isValid},addPhaseValidationResult:function(t){this._isValid=this._isValid&&t.isValid(),this._phaseValidationResults.push(t)},getPhaseValidationResults:function(){return this._phaseValidationResults}})}),define("DS/MPFCartPhaseModel/CartPhaseValidationResult",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t){this._phase=t,this._isValid=!0,this._errors=[]},isValid:function(){return this._isValid},getPhase:function(){return this._phase},addError:function(t,e){this._isValid=!1,this._errors.push({field:t,message:e})},getErrors:function(){return this._errors},toDataObject:function(){return{isValid:this.isValid(),errors:this.getErrors()}}})}),define("DS/MPFCartPhaseModel/CartPhaseCollection",["DS/MPFModel/MPFCollection","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhasesValidationResults","DS/MPFCartPhaseModel/CartPhaseValidationResult","i18n!DS/MPFCartPhaseModel/assets/nls/CartPhaseModel"],function(t,e,r,a,s){"use strict";const i=t.extend({model:e,comparator:function(t,e){return parseInt(t.getNumber(),10)-parseInt(e.getNumber(),10)},validate:function(t){t=t||{};const i=new r;let n=new Date(0);return this.forEach(function(t){const r=new Date(t.getStartDate()),o=new Date(t.getEndDate()),d=new a(t);n>r&&d.addError(e.Fields.START_DATE,s.get("phaseStartDateMustBeAfterPreviousPhaseEndDate")),r>o&&d.addError(e.Fields.END_DATE,s.get("phaseEndDateMustBeAfterStartDate")),this._phaseValidation(t,d),i.addPhaseValidationResult(d),n=o},this),i},_phaseValidation:function(t,e){const r=t.validate();if(Array.isArray(r))for(let t=0;t<r.length;t++)e.addError(r[t].field,r[t].message)},getActivePhase:function(){let t=this.find(function(t){const r=t.getState();return r===e.States.ACCEPTED||r===e.States.PENDING_PROCESSING||r===e.States.PROCESSING||r===e.States.PAYMENT_REFUSED||r===e.States.READY});return t||(t=this.find(function(t){return t.getState()===e.States.SUBMITTED})),t}});return i.Expands=e.Expands,i}),define("DS/MPFCartPhaseModel/CartPhaseFactory",["DS/MPFModelFactory/Factory","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFCartPhaseModel/CartPhaseCollection","DS/MPFCartPhaseModel/CartPhaseDataProxy","DS/MPFCartPhaseModel/CartCartPhaseDataproxy"],function(t,e,r,a,s){"use strict";const i=Object.freeze({CART_PHASE:"cartPhase",CART_CART_PHASE:"cartCartPhase"}),n=t.extend({createModel:function(t,r,a){return this._parent(e,t,r,a)},createCollection:function(t,e,a){return this._parent(r,t,e,a)},getDataProxy:function(t){var e;return t===i.CART_CART_PHASE?(this.dataProxies[i.CART_CART_PHASE]||(this.dataProxies[i.CART_CART_PHASE]=new s(this.connector,this.getDataProxy(i.CART_PHASE))),e=this.dataProxies[i.CART_CART_PHASE]):(this.dataProxies[i.CART_PHASE]||(this.dataProxies[i.CART_PHASE]=new a(this.connector)),e=this.dataProxies[i.CART_PHASE]),e}});return n.Types=Object.freeze(i),n});