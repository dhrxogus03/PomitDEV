define("DS/VisuLoaders/ThreeDXResourcesLibrary",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";var t=function(){this.refImages={},this.imagesToRequest=new Map};return t.prototype.addImageToRequest=function(e,t,r){this.imagesToRequest.set(e,{map:t,format:r})},t.prototype.getImageToRequest=function(e){return this.imagesToRequest.get(e)},t.prototype.removeImageToRequest=function(e){this.imagesToRequest.delete(e)},t.prototype.getRequestedUids=function(){var e=[];return this.imagesToRequest.forEach(function(t,r){e.push(r)}),e},t.prototype.getIdFromParameters=function(e){var t="";return void 0!==e.wrapS&&(t+="wS"+e.wrapS),void 0!==e.wrapT&&(t+="wT"+e.wrapT),void 0!==e.anisotropy&&(t+="anis"+e.anisotropy),void 0!==e.minFilter&&(t+="minF"+e.minFilter),void 0!==e.magFilter&&(t+="magF"+e.magFilter),e.borderColor&&(t+="borderColor"+e.borderColor.x+"-"+e.borderColor.y+"-"+e.borderColor.z+"-"+e.borderColor.w),void 0!==e.repeat&&(t+="rpt"+e.repeat.x+"-"+e.repeat.y),void 0!==e.sRGB&&(t+="srgb"+e.sRGB),"id"+t.hashCode()},t.prototype.getIdFromTexture=function(e){var t="";return void 0!==e.wrapS&&(t+="wS"+e.wrapS),void 0!==e.wrapT&&(t+="wT"+e.wrapT),void 0!==e.anisotropy&&(t+="anis"+e.anisotropy),void 0!==e.minFilter&&(t+="minF"+e.minFilter),void 0!==e.magFilter&&(t+="magF"+e.magFilter),e.borderColor&&(t+="borderColor"+e.borderColor.x+"-"+e.borderColor.y+"-"+e.borderColor.z+"-"+e.borderColor.w),void 0!==e.repeat&&(t+="rpt"+e.repeat.x+"-"+e.repeat.y),void 0!==e.sRGB&&(t+="srgb"+e.sRGB),"id"+t.hashCode()},t.prototype.getImage=function(e){var t=this.refImages[e];return t?t.values().next().value:null},t.prototype.addImage=function(e,t){if(!t)return!1;var r=this.getIdFromTexture(t),o=this.refImages[e];return!o&&((o=new Map).set(r,t),this.refImages[e]=o,!0)},t.prototype.removeImage=function(e){delete this.refImages[e]},t.prototype.getTexture=function(e,t){var r=this.getIdFromParameters(t),o=this.refImages[e];return o&&o.has(r)?o.get(r):null},t.prototype.addTexture=function(e,t,r){if(!t)return!1;var o=this.getIdFromParameters(r),a=this.refImages[e];return a||(a=new Map,this.refImages[e]=a),a.set(o,t),this.subscribeToImageLoading(t,a),!0},t.prototype.subscribeToImageLoading=function(t,r){r.forEach(function(r,o,a){if(r===t)return;let s=function(r){if(t.image=r.image,r.loadEndStatus===e.AssetLoadingStatus.READY&&(t.loadEndStatus=e.AssetLoadingStatus.READY),t.format=r.format,t.type=r.type,t.needsUpdate=!0,r.hdr&&(t.minFilter=r.minFilter,t.magFilter=r.magFilter),t.loadEndStatus===e.AssetLoadingStatus.READY&&t.onLoadCallbacks)for(let e=0;e<t.onLoadCallbacks.length;e++)t.onLoadCallbacks[e](t)};if(r.loadEndStatus==e.AssetLoadingStatus.READY)s(r);else if(r.loadEndStatus!==e.AssetLoadingStatus.LOADING)return;r.onLoadCallbacks.push(s)})},t.prototype.debug=function(){for(var e in console.log("=============== ThreeDXResourcesLibrary ==================="),this.refImages){var t=this.refImages[e];t&&(console.log("image "+e+" :"),t.forEach(function(e,t,r){console.log("["+t+"] = "+e.id+" status "+e.loadEndStatus)}))}console.log("===========================================================")},t});