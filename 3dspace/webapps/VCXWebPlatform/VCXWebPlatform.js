define("DS/VCXWebPlatform/VCX3DSwymmServices",["require","exports","DS/SwymPublishForm/script/publish-form-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/UIKIT/Modal"],function(e,t,r,n,s){"use strict";return class{static async get3DSwymmData(e){return this.publish3DSwymm({...e,customUpload:!0,returnJson:!0})}static async publish3DSwymm(e){return new Promise((t,i)=>{let a={modal:null,publishForm:null},o=()=>{a&&(a.publishForm&&(a.publishForm.destroy(),a.publishForm=null),a.modal&&(a.modal.destroy(),a.modal=null))};a.publishForm=new r({title:e.strMediaFileName,contentTitle:e.titre,description:e.description,contentDescription:e.contentDescription,platformId:widget.getValue("x3dPlatformId"),forcePlatform:!0,mode:e.customUpload?"jsevent":"automatic",base64image:e.mediaURL,base64imageExtension:e.extension,onCancel:()=>{t(!1),o()},onContentCreated:()=>{t(!0),o()}}),e.customUpload&&a.publishForm.addEvents({StartUpload:r=>{var s=JSON.parse(r);console.log("Swym > Media > Start upload");var c=a.publishForm.getControl("titleInput")?a.publishForm.getControl("titleInput").getValue():"Published from xHighlight",l=a.publishForm.getControl("descriptionInput")?a.publishForm.getControl("descriptionInput").getValue():"";if(e.returnJson)return s.title=c,s.description=l,s.is_illustration="media"!==s.contentType||1!=a.publishForm._media_is_illustration,o(),void t(s);new n({},{urlRoot:s.platform_instance}).save({title:c,description:l,published:!0,community_id:s.community_id,userFile:new File([e.mediaBlob],e.strMediaFileName,{type:e.mediaBlob.type,lastModified:Date.now()}),media_type:e.mediaType,fileName:e.strMediaFileName,base64_encoded:!1,is_illustration:!1,content_type:s.content_type},{onComplete:e=>{console.log("Swym > Media > Upload is successfull"),a.publishForm.createContent(e.get("mid"))},onFailure:()=>{console.log("Swym > Media > Upload failed"),o(),i()}})},ContentCreated:()=>{console.log("Swym > Media > Content creation successfull"),o(),t(!0)},CancelShare:()=>{o(),t(!1)}}),a.modal=new s({closable:!0,header:e.header,body:a.publishForm.render("publish_to_sywm_wrapper_id"),className:"swymm-modal"}),a.modal.elements.header&&a.modal.elements.header.getElements(".close")[0].addEvent("click",()=>{o(),t(!1)}),a.modal.inject(document.body),a.modal.show()})}}}),define("DS/VCXWebPlatform/VCXSearchServices",["require","exports","UWA/Utils/InterCom"],function(e,t,r){"use strict";return class{static async SearchInApp(e,t){return new Promise((n,s)=>{try{var i=new r.Socket("vcx-3DSearch-InterCom"),a={title:t,mode:"furtive",widget_id:widget.id,app_socket_id:"vcx-3DSearch-InterCom",default_with_precond:!0,show_precond:!1,multiSel:!1,precond:e,tenant:widget.getValue("x3dPlatformId")};i.subscribeServer("SearchComServer"),i.addListener("Selected_Objects_search",e=>{i.dispatchEvent("UnregisterContext",a),i.unsubscribeServer("SearchComServer"),n({id:e[0].id,label:e[0]["ds6w:label"]})}),i.addListener("onCloseTransient",()=>{i.dispatchEvent("UnregisterContext",a),i.unsubscribeServer("SearchComServer"),n(null)}),i.dispatchEvent("RegisterContext",a),i.dispatchEvent("InContextSearch",a)}catch(e){s(e)}})}}}),define("DS/VCXWebPlatform/VCXPlatformServices",["require","exports","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","UWA/Core"],function(e,t,r,n,s,i){"use strict";class a{static async getPlatformServices(e){return new Promise((t,n)=>r.getPlatformServices({platformId:e,onComplete:function(e){t(e)},onFailure:function(e){n(new Error(e))}}))}static async listPlatformsIds(){return new Promise((e,t)=>r.getServiceUrl({serviceName:"3DSpace",onComplete:function(t){e(t.map(function(e){return e.platformId}))},onFailure:function(e){t(new Error(e))}}))}static async getServiceUrl(e,t){return new Promise((n,s)=>r.getServiceUrl({serviceName:e,platformId:t,onComplete:function(e){n(e)},onFailure:function(e){s(new Error(e))}}))}static async get3DSpaceURL(e){return this.getServiceUrl("3DSpace",e)}static async listSecurityContextInfos(e,t){return new Promise((r,s)=>n.authenticatedRequest(e+"/resources/modeler/pno/person?current=true&select=collabspaces&select=preferredcredentials&tenant="+t,{method:"GET",type:"json",onComplete:function(e){r(e)},onFailure:function(e){s(new Error(e))}}))}static async extractCollabSpaceFromProduct(e,t){var r=e+"/resources/v1/modeler/documents/"+t;return new Promise((e,t)=>{n.authenticatedRequest(r,{method:"GET",type:"json",onComplete:r=>{r&&r.data?e(r.data[0].dataelements.collabspace):t(new Error("Bad data format"))},onFailure:e=>{t(new Error(e))}})})}static async GetTenantId(){let e=widget.getValue("x3dPlatformId");if(e)return e;let t=await this.listPlatformsIds();if(1===t.length)return widget.setValue("x3dPlatformId",t[0]),t[0];var r=new Error("Multi-tenant: unable to get the tenant, widget.getValue('x3dPlatformId') is undefined.");throw console.error(r),r}static async CheckTenant(e){if(!e)throw new Error("Items missing");let t=await this.GetTenantId();if(t&&t===e.envId)return t;{let e=new Error("Multi-tenant : the tenant of the app & the collabspace are different (content cannot be opened)");throw e.criticity="Warning",e}}static async getObjectInfo(e,t){var r=t+"/resources/v2/e6w/service/ObjectInfo/"+e;return new Promise((e,t)=>{try{n.authenticatedRequest(r,{method:"GET",type:"json",onComplete:r=>{r&&r.data?e(r.data[0]):t(new Error("Bad data format"))},onFailure:e=>{t(new Error(e))}})}catch(e){t(e)}})}static async retrieveTransientToken(e){let t=await this.GetTenantId();return new Promise(function(r,i){var a=s.getApplicationConfiguration("app.urls.passport")+"/api/authenticated/cas/transient?service=";a+=encodeURIComponent("https://"+e.serviceUrl),a+="&tenant="+encodeURIComponent(t.trim()),n.authenticatedRequest(a,{method:"GET",type:"json",onComplete:function(t){r({...t,x3ds_service_url:e.serviceUrl})},onFailure:i})})}static async retrieveLoginTicket(e,t){let r=await this.GetTenantId();var s=t+"/ticket/get?";s+="runasctx="+encodeURIComponent(e.context?e.context.trim():"preferred");var i=t;return i+="/resources/modeler/pno/person?current=true&select=preferredcredentials",s+="&tenant="+encodeURIComponent(r.trim()),i+="&tenant="+encodeURIComponent(r.trim()),new Promise(function(e,t){n.authenticatedRequest(i,{method:"GET",type:"json",proxy:"passport",onComplete:function(){n.authenticatedRequest(s,{headers:{Accept:"application/json","Accept-Language":null},method:"GET",type:"json",proxy:"passport",onComplete:function(t){e(t.ticket)},onFailure:function(e){t("Failed to retrieve login ticket "+e)}})}})})}static async getSessionId(){const e=this.getUser(),t=await this.GetTenantId();return e.login+"_"+t}static getUser(){return this._cachedUser||(this._cachedUser=s.getUser()),this._cachedUser}static async _buildRequestData(e){const t=a.getUser(),r=null!=t&&void 0!==t.login?t.login:"";return{label:e.label||"3DSearch-"+r+"-"+(new Date).getTime(),locale:"en",order_field:e.order_field?e.order_field:"relevance",order_by:e.order_by?e.order_by:"desc",select_file:i.is(e.select_file,"array")?e.select_file:[],select_synthesis:e.select_synthesis?e.select_synthesis:e.select_predicate,select_predicate:e.select_predicate?e.select_predicate:["ds6w:label"],refine:e.refine,nresults:e.nresults||10,start:0,tenant:await a.GetTenantId(),query:e.query,source:e.source,specific_source_parameter:e.specific_source_parameter}}static _getQueryFromIds(e){e=Array.isArray(e)?e:[e];let t="";for(let r=0;r<e.length;r++)e[r]&&(0===r?t+="(physicalid:"+e[r]:(t+=" OR ",t+="physicalid:"+e[r]));return t+=")"}static async getExperienceInfosByPhysicalIds(e,t){var r=t+a.WSInformation.search.url;const s=await a._buildRequestData({select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:label","ds6w:type","type_icon_url","preview_url","name","ds6w:where/ds6w:context/ds6w:project","resourceid","physicalid","ds6wg:revision"],nresults:1e3,order_field:"ds6w:modified",query:a._getQueryFromIds(e)});return new Promise(e=>{const t={method:a.WSInformation.search.verb,headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(s),type:"json",onComplete:t=>{try{let r={};t&&t.results&&t.results.forEach(e=>{let t={};if(e.attributes&&e.attributes.length>0)try{const r=new Map;e.attributes.map(e=>{r.set(e.name,e.value)}),t={thumbnail:r.get("preview_url")||"",label:r.get("ds6w:label")||"",experienceId:r.get("resourceid")||"",experienceName:r.get("name")||r.get("ds6w:label")||"",experienceRevision:r.get("ds6wg:revision")||"",experienceCollabSpace:r.get("ds6w:where/ds6w:context/ds6w:project"),experienceType:r.get("ds6w:what/ds6w:type")}}catch(e){}t.experienceId&&(r[t.experienceId]=t)}),e(r)}catch(r){console.error(t),e(null)}},onFailure:t=>{console.error(t),e(null)},onTimeout:t=>{console.error(t),e(null)},timeout:6e4};n.authenticatedRequest(r,t)})}static async runRequest(e){const t=await this.GetTenantId();let r;r=e.wsArguments?e.wsInformation.url.replace(/\{(\w+)\}/g,function(t){return e.wsArguments&&e.wsArguments[t.substring(1,t.length-1)]?e.wsArguments[t.substring(1,t.length-1)]:t}):e.wsInformation.url;let s=e.serverURL+r+"?tenant="+t;e.urlAdd&&(s+="&"+e.urlAdd);const i={Accept:"*/*","Content-Type":e.wsInformation["Content-Type"]||"application/json","Accept-Language":"en"};return e.securityCtx&&(i.SecurityContext=encodeURIComponent(e.securityCtx),i.SecurityToken=encodeURIComponent(e.user.login+"|"+e.securityCtx+"|preferred")),new Promise(t=>{const r={method:e.wsInformation.verb,type:e.wsInformation.type||"JSON",headers:i,data:e.data,onComplete:r=>{try{const n=e.charToSkip||0,s=JSON.parse(r.substr(0,r.length-n));s.success&&s.csrf&&this.setCsrf(s.csrf.value,e.serverURL),t(s)}catch(e){console.error(r),t(null)}},onFailure:e=>{console.error(e),t(null)},onTimeout:e=>{console.error(e),t(null)},timeout:6e4};e.data&&(!e.data.csrf&&this.getCsrf(e.serverURL)&&(e.data.csrf={name:"ENO_CSRF_TOKEN",value:this.getCsrf(e.serverURL)}),"JSON"===r.type&&(r.data=JSON.stringify(e.data))),n.authenticatedRequest(s,r)})}static async getLastIndexingDate(e,t,r){const n=this.getUser(),s={select_service:r};return this.runRequest({serverURL:e,securityCtx:"ctx::"+t,wsInformation:a.WSInformation.indexingDate,data:s,user:n,urlAdd:"SecurityContext="+encodeURIComponent(t)})}static async searchDocument(e,t,r){const n=this.getUser();return this.runRequest({serverURL:e,securityCtx:t,wsInformation:a.WSInformation.searchDocument,user:n,urlAdd:"searchStr="+r})}static async retreiveDocumentFiles(e,t,r){const n=this.getUser();return this.runRequest({serverURL:e,securityCtx:t,user:n,wsInformation:a.WSInformation.retreiveDocumentFiles,wsArguments:{docId:r}})}static async _checkinToFCS(e){var t=e||{},r=t.ticketURL,n=this._getFCSFormData(t),s=new XMLHttpRequest;return s.open("POST",r,!0),new Promise((e,t)=>{var r=()=>{t()};s.onloadend=(()=>{200===s.status?e(s.responseText):r()}),s.onabort=r,s.onerror=r,s.ontimeout=r,s.send(n)})}static _getFCSFormData(e){var t=(e=e||{}).fileInfo||e.documentInfo&&e.documentInfo.fileInfo,r=t&&t.file,n=t&&t.fileName,s=new FormData;return s.append(e.ticketparamname,e.ticket),r&&s.append("file_0",r,n),s}static async requestTicket(e,t){const r=await e;if(r.success&&1===r.data.length){const e={ticketURL:r.data[0].dataelements.ticketURL,ticketparamname:r.data[0].dataelements.ticketparamname,ticket:r.data[0].dataelements.ticket,fileInfo:{}};return t&&(e.fileInfo={file:t,fileName:t.name}),this._checkinToFCS(e)}}static async checkinTicket(e,t,r){const n=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:n,data:{},wsInformation:a.WSInformation.checkinTicket}),r)}static async downloadDocumentTicket(e,t,r){const n=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:n,data:{},wsInformation:a.WSInformation.downloadDocumentTicket,wsArguments:{docId:r}}))}static async downloadFileTicket(e,t,r,n){const s=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:s,data:{},wsInformation:a.WSInformation.downloadFileTicket,wsArguments:{docId:r,fileId:n}}))}static async checkinDocumentTicket(e,t){const r=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:r,data:{},wsInformation:a.WSInformation.checkinDocumentTicket}))}static async checkoutTicket(e,t){const r=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:r,data:{},wsInformation:a.WSInformation.checkoutTicket}))}static async checkoutDocumentTicket(e,t,r){const n=this.getUser();return this.requestTicket(this.runRequest({serverURL:e,securityCtx:t,user:n,data:{},wsInformation:a.WSInformation.checkoutDocumentTicket,wsArguments:{docId:r}}))}static async getFileVersions(e,t,r,n){const s=this.getUser();return this.runRequest({serverURL:e,securityCtx:t,user:s,wsInformation:a.WSInformation.getFileVersions,wsArguments:{docId:r,fileId:n}})}static async updateDocument(e,t,r,n,s,i){const o=this.getUser(),c={data:[{id:r,updateAction:"NONE",relateddata:{files:[{dataelements:{title:s,receipt:n},updateAction:i?"REVISE":"CREATE",id:i||""}]}}]};return this.runRequest({serverURL:e,securityCtx:t,user:o,wsInformation:a.WSInformation.updateDocument,data:c,urlAdd:"e6w-lang=en&e6w-timezone=-120",wsArguments:{docId:r}})}static async createDocumentFiles(e,t,r,n,s){const i=this.getUser(),o={data:[{id:r,updateAction:"NONE",relateddata:{files:[{dataelements:{title:s,receipt:n},updateAction:"CREATE"}]}}]};return this.runRequest({serverURL:e,securityCtx:t,user:i,data:o,wsInformation:a.WSInformation.createDocumentFiles,wsArguments:{docId:r}})}static async createDocument(e,t,r){const n=this.getUser(),s={data:[{type:"Document",dataelements:{name:r,policy:"Document Release",state:"IN_WORK",title:r,description:"Repository to store custom styles"}}]};return this.runRequest({serverURL:e,securityCtx:t,user:n,data:s,wsInformation:a.WSInformation.createDocument})}static async frustrumExpandV2(e,t,r,n){const s=this.getUser(),i={batch:{expands:[{label:s.login+"_xHighlight_"+Date.now(),root:{physical_id:r},filter:{and:{filters:[{prefix_filter:{prefix_path:[{physical_id_path:[r]}]}},{in_frustum:n}]}},graph:{descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:'NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency")'}},aggregation_processors:[{materials:{uql:'bo_46_plmentity_46_plm_95_externalid:"Applied%20Material"'}}]}]},outputs:{select_object:["ds6w:label","physicalid","ds6w:type","ds6w:globalType"],select_relation:["ds6w:label","physicalid","ds6w:type","ds6w:globalType","TreeOrder","matrixtxt"],select_pgp:["show","hide","color","opacity"],hits:{predefined_computation:["urlstream|mythumbnail2d|2dthb"]}}};return this.runRequest({serverURL:e,securityCtx:t,wsInformation:a.WSInformation.expandv2,data:i,user:s,charToSkip:2})}static async fetchV2(e,t,r){const n=this.getUser(),s={physicalid:r,label:n.login+"_xHighlight_"+Date.now(),select_predicate:["ds6w:label","ds6w:type","name","policy","revision","stateNLS","title","typeNLS","ds6w:name","ds6w:policy","ds6w:revision","ds6w:stateNLS","ds6w:title","ds6w:typeNLS"],select_file:["thumbnail_2d"]};return this.runRequest({serverURL:e,securityCtx:t,wsInformation:a.WSInformation.fetch,data:s,user:n})}static async expandV2(e,t,r){const n=this.getUser(),s={batch:{expands:[{label:n.login+"_xHighlight_"+Date.now(),root:{physical_id:r},filter:{and:{filters:[{prefix_filter:{prefix_path:[{physical_id_path:[r]}]}}]}},graph:{descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:'NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency")'}},aggregation_processors:[{materials:{uql:'bo_46_plmentity_46_plm_95_externalid:"Applied%20Material"'}}]}]},outputs:{select_object:["ds6w:label","physicalid","ds6w:type","ds6w:globalType"],select_relation:["ds6w:label","physicalid","ds6w:type","ds6w:globalType","TreeOrder","matrixtxt"],select_pgp:["show","hide","color","opacity"],hits:{predefined_computation:["urlstream|mythumbnail2d|2dthb","boundingbox"]}}};return this.runRequest({serverURL:e,securityCtx:t,wsInformation:a.WSInformation.expandv2,data:s,user:n,charToSkip:2})}static getCsrf(e){return this.csrf&&this.csrf[e]}static setCsrf(e,t){return this.csrf=this.csrf||{},this.csrf[t]=e}}return a.WSInformation={indexingDate:{url:"/cvservlet/indexingdate",verb:"POST"},fetch:{url:"/cvservlet/fetch/v2",verb:"POST"},expandv2:{url:"/cvservlet/progressiveexpand/v2",verb:"POST"},progressiveExpand:{url:"/cvservlet/progressiveexpand",verb:"POST"},search:{url:"/search",verb:"POST"},searchv2:{url:"/cvservlet/progressiveexpand/v2",verb:"POST"},createDocument:{url:"/resources/v1/modeler/documents",verb:"POST"},updateDocument:{url:"/resources/v1/modeler/documents",verb:"PUT"},reserveDocument:{url:"/resources/v1/modeler/documents/{docId}/reserve",verb:"PUT"},unreserveDocument:{url:"/resources/v1/modeler/documents/{docId}/unreserve",verb:"PUT"},searchDocument:{url:"/resources/v1/modeler/documents/search",verb:"GET"},getDocumentInformation:{url:"/resources/v1/modeler/documents/{docId}",verb:"GET"},updateDocumentInformation:{url:"/resources/v1/modeler/documents/{docId}",verb:"PUT"},deleteDocument:{url:"/resources/v1/modeler/documents/{docId}",verb:"DELETE"},retreiveDocumentFiles:{url:"/resources/v1/modeler/documents/{docId}/files",verb:"GET"},createDocumentFiles:{url:"/resources/v1/modeler/documents/{docId}/files",verb:"POST"},updateDocumentFiles:{url:"/resources/v1/modeler/documents/{docId}/files",verb:"PUT"},updateDocumentFile:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}",verb:"PUT"},deleteDocumentFile:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}",verb:"DELETE"},getFileVersions:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/versions",verb:"GET"},deleteFileVersion:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/versions/{versionId}",verb:"DELETE"},checkinTicket:{url:"/resources/v1/modeler/documents/files/CheckinTicket",verb:"PUT"},checkinDocumentTicket:{url:"/resources/v1/modeler/documents/{docId}/files/CheckinTicket",verb:"PUT"},downloadTicket:{url:"/resources/v1/modeler/documents/DownloadTicket",verb:"PUT"},downloadDocumentTicket:{url:"/resources/v1/modeler/documents/{docId}/files/DownloadTicket",verb:"PUT"},downloadFileTicket:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/DownloadTicket",verb:"PUT"},downloadVersionTicket:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/versions/{versionId}/DownloadTicket",verb:"PUT"},checkoutTicket:{url:"/resources/v1/modeler/documents/CheckoutTicket",verb:"PUT"},checkoutDocumentTicket:{url:"/resources/v1/modeler/documents/{docId}/files/CheckoutTicket",verb:"PUT"},checkoutFileTicket:{url:"/resources/v1/modeler/documents/{docId}/files/{fileId}/CheckoutTicket",verb:"PUT"}},a}),define("DS/VCXWebPlatform/VCX3DDriveServices",["UWA/Class","DS/VCXWebPlatform/VCXPlatformServices","DS/WAFData/WAFData"],function(e,t,r){"use strict";var n=e.extend({initialize:function(){},_request3DDriveService:function(e){var t=UWA.Promise.deferred(),n=this,s={method:"GET",type:"json",onComplete:(e,r,s)=>{var i=r["x-ds-csrftoken"];i&&(n._csrf=i),t.resolve(e)},onFailure:e=>{console.log(e),t.reject(new Error("3Ddrive: error calling web service"))}},i=UWA.extend(UWA.clone(s),e.requestOptions);i.headers||(i.headers={});return i.headers["X-DS-CSRFTOKEN"]=n._csrf||"",r.authenticatedRequest(e.url,i),t.promise},get3DDriveURL:async function(){let e=await t.GetTenantId();return t.getServiceUrl("3DDrive",e)},_call3DDriveService:function(e){var t=UWA.clone(e);return t.serviceName="3DDrive",this.get3DDriveURL().then(e=>this._request3DDriveService({url:e+t.URI,requestOptions:t.requestOptions}))},_find3DDriveFile(e,t){var r=this;return this.get3DDriveURL().then(e=>{var n=e+"/resources/3ddrive/v1/bos/DSROOT/contents?tenant="+t;return r._authenticatedRequest(n,{method:"GET",type:"json"})}).then(t=>{for(var r=0;r<t.items.length;r++)if(t.items[r].title===e)return UWA.Promise.resolve(t.items[r].id);return UWA.Promise.resolve(null)})},_authenticatedRequest:function(e,t){var n=UWA.Promise.deferred();return t.onComplete=(e=>{n.resolve(e)}),t.onFailure=(e=>{console.log(e),n.reject(new Error("3Ddrive: Impossible to get fcsTicket "))}),r.authenticatedRequest(e,t),n.promise},Pushto3Ddrive:async function(e,r,n){var s=this,i=new File([e],r,{type:e.type,lastModified:Date.now()});let a=await t.GetTenantId();var o="/resources/3ddrive/v1/bos/ticket?tenant="+a;return this._call3DDriveService({URI:o,envId:a}).then(e=>{var t=new FormData;return t.append(e.jobticket,e.ticket),t.append("file_0",i),t.append("file-name",i.name),t.append("file-title",i.name),t.append("file-description",i.name),s._authenticatedRequest(e.actionurl,{method:"POST",data:t,type:"text"})}).then(e=>{var t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll('[name="__fcs__jobReceipt"]')[0].attributes.value;return s.dataOpts=JSON.stringify({description:"",file:i.name,receipt:t.value,title:i.name,type:"Document"}),s._find3DDriveFile(r,a)}).then(e=>{var t=s.dataOpts;if(delete s.dataOpts,e){var r="/resources/3ddrive/v1/bos/"+e+"?tenant="+a;return s._call3DDriveService({URI:r,envId:n,requestOptions:{method:"PUT",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}}})}r="/resources/3ddrive/v1/bos/DSROOT/contents?tenant="+a;return s._call3DDriveService({URI:r,envId:n,requestOptions:{method:"POST",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}}})})},_request3DDriveServiceCB:function(e,t,n){var s=this,i={method:"GET",type:"json",onComplete:(e,r,n)=>{var i=r["x-ds-csrftoken"];i&&(s._csrf=i),t(e)},onFailure:e=>{console.log(e.message),n({message:"error calling web service"})}},a=UWA.extend(UWA.clone(i),e.requestOptions);a.headers||(a.headers={});a.headers["X-DS-CSRFTOKEN"]=s._csrf||"",r.authenticatedRequest(e.url,a)},_call3DDriveServiceCB:async function(e,r,n){var s=UWA.clone(e);s.serviceName="3DDrive";let i=await t.GetTenantId(),a=t.getServiceUrl("3DDrive",i);this._request3DDriveServiceCB({url:a+s.URI,requestOptions:s.requestOptions},r,n)},_find3DDriveFileCB(e,n,s,i){var a=t.getServiceUrl("3DDrive",n)+"/resources/3ddrive/v1/bos/DSROOT/contents?tenant="+n;r.authenticatedRequest(a,{method:"GET",type:"json",onComplete:t=>{for(var r=null,n=0;n<t.items.length;n++)if(t.items[n].title===e){r=t.items[n].id;break}r||console.log("Warning : "+e+"not found in 3DDrive"),s(r)},onFailure:e=>{i(e)}})},Pushto3DdriveCB:function(e,t,n,s,i){var a=this,o=new File([e],t,{type:e.type,lastModified:Date.now()}),c=widget.getValue("x3dPlatformId");n||(n=c);var l="/resources/3ddrive/v1/bos/ticket?tenant="+c;this._call3DDriveServiceCB({URI:l,envId:c},e=>{var l=new FormData;l.append(e.jobticket,e.ticket),l.append("file_0",o),l.append("file-name",o.name),l.append("file-title",o.name),l.append("file-description",o.name);e.actionurl;r.authenticatedRequest(e.actionurl,{method:"POST",data:l,type:"text",onComplete:e=>{var r=(new DOMParser).parseFromString(e,"text/html").querySelectorAll('[name="__fcs__jobReceipt"]')[0].attributes.value,l=JSON.stringify({description:"",file:o.name,receipt:r.value,title:o.name,type:"Document"});let d="/resources/3ddrive/v1/bos/DSROOT/contents?tenant="+c;a._call3DDriveServiceCB({URI:d,envId:n,requestOptions:{method:"POST",data:l,headers:{"Content-Type":"application/json;charset=UTF-8"}}},e=>{s(e)},e=>{console.log(e.message),a._find3DDriveFileCB(t,c,e=>{d="/resources/3ddrive/v1/bos/"+e+"?tenant="+c,a._call3DDriveServiceCB({URI:d,envId:n,requestOptions:{method:"PUT",data:l,headers:{"Content-Type":"application/json;charset=UTF-8"}}},e=>{s(e)},()=>{i({message:"3Ddrive: Impossible to update Document "})})},()=>{console.log(e.message),i({message:"3Ddrive: Impossible to find the file to be updated "})})})},onFailure:e=>{console.log(e.message),i({message:"3Ddrive: Impossible to get fcsTicket "})}})},e=>{console.log(e.message),i({message:"3Ddrive: Impossible to find "})})},publish3DDrive:async function(e,r){e.name=r;var s=new n,i=await t.GetTenantId();await s.Pushto3Ddrive(e,r,i),console.log("Experience "+r+" Saved"),console.log("Publish Media -> 3DDrive OK")}});return n}),define("DS/VCXWebPlatform/VCX3DSpaceServices",["require","exports","DS/DocumentManagement/DocumentManagement","DS/VCXWebPlatform/VCXPlatformServices"],function(e,t,r,n){"use strict";class s{static async Get3DSpaceURL(e=null){if(e||(e=await n.GetTenantId()),s._cache3DSpace)return s._cache3DSpace;let t=await n.get3DSpaceURL(e);if(e)return s._cache3DSpace=t,t;throw new Error("Tenant not found")}static UpdateWidgetPreferenceCollabspace(e){widget.hasPreference("Collaborative_Space")||widget.addPreference({type:"text",name:"Collaborative_Space",label:"",disabled:!0,defaultValue:e}),widget.setValue("Collaborative_Space",e)}static addWidgetPreferences(){if(widget&&widget.data&&widget.data.x3dPlatformId){var e=widget.data.x3dPlatformId;widget.addPreference({type:"list",name:"Platform",label:"",defaultValue:e,disabled:!0,options:[{label:e,value:e}]})}}static UpdateCollabSpaceInCloudIcon(e){if(widget){let t=e.role+"."+e.organization+"."+e.collabspace;s.UpdateWidgetPreferenceCollabspace(e.collabspace),widget.setValue("xPref_CREDENTIAL",t),widget.setValue("xPref_CREDENTIAL_raw",JSON.stringify(e))}}static async SetPreferredSecurityContext(e){e||(e=await s.GetPreferredSecurityContext()),widget.setValue("tenantAware",!0),s.UpdateCollabSpaceInCloudIcon(e)}static async GetPreferredSecurityContext(){if(widget&&widget.data&&widget.data.xPref_CREDENTIAL_raw)return JSON.parse(widget.data.xPref_CREDENTIAL_raw);let e=await s.GetSecurityContextInformations(),t=void 0;if(Object.keys(e).length){let n=e;for(var r in n)if(n.hasOwnProperty(r)&&(s._cachePreferred&&r===s._cachePreferred.collabspace.name||!s._cachePreferred)&&n[r].highPrivilegeRoleOrga&&(t=n[r].highPrivilegeRoleOrga))return s.SetPreferredSecurityContext(t),t;throw new Error("You do not have any collabspace. Request an invitation to a collabspace.")}throw new Error("listSecurityContextInfos not found.")}static async GetSecurityContextInformations(){let e=await n.GetTenantId();console.log("----- VCX3DSpaceServices: GetTenantId found : "+e);let t=await s.Get3DSpaceURL(e);if(console.log("----- VCX3DSpaceServices: Get3DSpaceURL found : "+t),this._cacheCollabSpace)return this._cacheCollabSpace;let r=await n.listSecurityContextInfos(t,e);if(r&&r.preferredcredentials&&(s._cachePreferred=r.preferredcredentials),r&&r.collabspaces){for(var i={},a=0;a<r.collabspaces.length;a++){var o=r.collabspaces[a],c=o.name;if("Default"!==c||"Default"!==o.title){i[c]=o,i[c].securityContext=[];for(var l=0;l<o.couples.length;l++){var d=o.couples[l];i[c].securityContext.push({role:d.role.name,organization:d.organization.name,title:d.organization.title,nlsrole:d.role.nls})}var u=s._getHighestPrivilegeRoleOrga(i[c].securityContext);i[c].highPrivilegeRoleOrga=u,i[c].highPrivilegeRoleOrga.collabspace=c}}s._cacheCollabSpace=i}if(s._cacheCollabSpace)return s._cacheCollabSpace;throw new Error("listSecurityContextInfos not found.")}static async _getRoleOrgaFromCollabSpace(e){let t=await s.GetSecurityContextInformations();for(var r in t)if(t.hasOwnProperty(r)&&r===e)return t[r].highPrivilegeRoleOrga}static async getObjectSecurityContextFromExperienceID(e){let t=await s.Get3DSpaceURL(),r=await n.extractCollabSpaceFromProduct(t,e);return s._getRoleOrgaFromCollabSpace(r)}static _getHighestPrivilegeRoleOrga(e){if(e.length){for(var t=["VPLMProjectLeader","VPLMProjectAdministrator","VPLMCreator"],r=!0,n=0,s=[];r&&n<=2;)r=0===(s=e.filter(e=>e.role===t[n])).length,n++;return s.length>0?s[0]:e[0]}console.warn("No security context found!")}static async publish3DSpace(e,t,r){let i=await n.GetTenantId(),a=await s.Get3DSpaceURL(i),o=await s.GetPreferredSecurityContext(),c={tenant:i,tenantUrl:a,securityContext:o.role+"."+o.organization+"."+o.collabspace};e.name=t,await s.PushBlob(c,e,r),console.log("Experience "+t+" Saved"),console.log("Publish Media -> 3Dspace OK")}static async PushBlob(e,t,r){var n=new File([t],t.name,{type:t.type,lastModified:Date.now()});let s={title:t.name,type:"Document",policy:"Document Release",fileInfo:{file:n}};r&&(s.relInfo={parentId:r,parentRelName:"Reference Document",parentDirection:"from"});try{await this.PushDocument(e,s)}catch(n){if(r)return await this.PushBlob(e,t,null);throw new Error("Impossible to write in the Collabspace")}}static async PushDocument(e,t){await new Promise(function(n,s){var i={...e,onComplete:n,onFailure:s};r.createDocument(t,i)})}get(){}}return s});