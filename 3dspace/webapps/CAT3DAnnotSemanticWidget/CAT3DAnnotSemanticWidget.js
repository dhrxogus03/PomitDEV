/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticSolveAttrLinkCmd",["UWA/Class","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],function(t,e){"use strict";return t.extend(e,{init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0}),this.beginExecute=function(){this.launchProperties(t.args.args)}}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticAttrBrowserCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/PADUtils/PADContext","DS/CAT3DAnnotationAttributeController/CAT3DAnnotationAttributeController"],function(t,e,n){"use strict";var o,i=t.extend({init:function(t){this._parent(t,{});var e=this,a=this.onStateChange(function(){e.getState()?i.OpenSemanticBrowser():i.CloseSemanticBrowser()}),r=this._destroy;this._destroy=function(){o&&n.unreference3DAnnotAttrBrowserController({context:o}),e._modelEvents.unsubscribe(a),r.call(e)},this.setState("false"!==localStorage.getItem("CAT3DAnnotSemanticAttrBrowserCmd"),!0)},_destroy:function(){this._parent()}});return i.OpenSemanticBrowser=async function(t,i){!o&&i?o=i.executionContext.getComponent("Viewer"):o||i||(o=e.get());let a=n.get3DAnnotAttrBrowserController({context:o});await a.setActiveState(!0),localStorage.setItem("CAT3DAnnotSemanticAttrBrowserCmd","true"),t&&t()},i.CloseSemanticBrowser=async function(t,i){!o&&i?o=i.executionContext.getComponent("Viewer"):o||i||(o=e.get());let a=n.get3DAnnotAttrBrowserController({context:o});a&&await a.setActiveState(!1),localStorage.setItem("CAT3DAnnotSemanticAttrBrowserCmd","false"),t&&t()},i}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticCmds",[],function(){}),define("DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticController",[],function(){}),define("DS/CAT3DAnnotSemanticWidget/CATA3IAppInit",["DS/WAfrContainer/App","UWA/Core","DS/Controls/Loader","i18n!DS/CAT3DAnnotationWidget/assets/nls/CAT3DAnnotationWidget"],function(t,e,n,o){"use strict";var i,a,r={wkbFile:"CAT3DAnnotSemanticWidgetWkb.xml",wkbModule:"CAT3DAnnotSemanticWidget",defaultCmdHdr:"CAT3DAnnotInsightWidgetDefaultHdr",defaultCmdJSModule:"DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticWidgetDefaultCmd"};return t.extend({setUp:function(t){var s=this;if(window.widget.getValue("X3DContentId")){var l="",g=JSON.parse(window.widget.getValue("X3DContentId"));g.data&&g.data.items&&g.data.items[0]&&g.data.items[0].displayName&&(l=g.data.items[0].displayName);var d=e.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(a=new n({text:o.loadingMessage+" "+l}).inject(d)).on(),a.getContent().addClassName("DMULoadingPanelInfoDiv");var c=a.elements.label.getSize().width,h=a.elements.progressBar.getContent().getSize().width,A=a.elements.progressBar.getContent().getSize().height,m=c+h;d.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),a.getContent().setStyles({position:"absolute",left:"calc(50% - "+m/2+"px)",top:"calc(50% - "+A/2+"px)"})}if(t.sourceApp)if(t.sourceApp.pad3DViewer){this.pad3DViewer=t.sourceApp.pad3DViewer,this.appMainDiv=t.sourceApp.appMainDiv;var u=function(e){e.sourceApp&&!e.sourceApp.isDisposeCalled()&&e.sourceApp.dispose();var n=e;n.widgetData=r;var o=e.done;t.done=function(e){s.appMainDiv||(s.appMainDiv=e.appMainDiv),t.done=o,t.done()},i.setUp(n)};i?u(t):require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(e){i=new e({widget:window.widget,data:r,pad3DViewer:t.sourceApp.pad3DViewer,appMainDiv:t.sourceApp.appMainDiv}),u(t)})}else t.done();else require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(e){i=new e({widget:window.widget,viewerAttachment:t.done,done:function(t){s.pad3DViewer=t.pad3DViewer,s.appMainDiv=t.appMainDiv},data:r})})},dispose:function(t){i&&i.dispose&&i.dispose(t),a&&(a.destroy(),a=null);var e=window.document.getElementsByClassName("DMULoadingPanel");e.length&&e[0].destroy(),this._parent(t)},onWillEnter:function(t){return i&&i.onWillEnter&&i.onWillEnter(t),require(["DS/PADUtils/PADSettingsMgt"],function(t){t.setSetting("enopad3dviewer_staticMappingSupportActivated",!0)}),this._parent(t)},onWillLeave:function(t){return i&&i.onWillLeave&&i.onWillLeave(t),this._parent(t)}})}),define("DS/CAT3DAnnotSemanticWidget/CAT3DAnnotSemanticWidget",[],function(){}),define("DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticContInstance",["DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance","DS/Selection/CSOManager","DS/CATWebUXSlideShow/CATWebUXSlideShowController"],function(t,e,n){"use strict";return t.extend({init:function(t){var o=t||{};o.workbenchName="CAT3DAnnotSemanticWidgetWkb",o.moduleName="CAT3DAnnotSemanticWidget",this._parent(o);var i=this,a=o.ctxViewer;let r=function(){if(!a)return;let t,e=a.getExecutionContext?a.getExecutionContext():void 0;e&&((t=e.getComponent(WAfrStandardComponentKey.HandlerComponent)).hasCheckHandler("AnnotationSemanticBrowser")&&!t.isCheckExecutable("AnnotationSemanticBrowser")&&t.enableCheck("AnnotationSemanticBrowser"),t.setCheckState({id:"AnnotationSemanticBrowser",state:"false"!==localStorage.getItem("CAT3DAnnotSemanticAttrBrowserCmd")}))};var s=this.setActiveState;this.setActiveState=function(t){s(t),t&&setTimeout(r,1500);var e=n.giveSlideShowController({context:a.getFrameWindow(),id:"CAT3DAnnotationSlideShow"});e&&e.setListOfCommandsAllowed(["CAT3DAnnotInsightWidgetDefaultHdr","CAT3DAnnotationWidgetDefaultHdr"])},this.getAnnotationControllerType=function(){return"3DAnnotationInsight"};var l=this.clearController;this.clearController=function(){l(),a=i=null};var g=this._onCommandStartCB;this._onCommandStartCB=function(t){g(t);for(var e=["CAT3DAnnotSemanticShowGeomAttachHdr","CAT3DAnnotSemanticShowRelatedAnnotHdr"],n=function(){setTimeout(i._refreshContextualBar)},o=0;o<e.length;o++)t._id===e[o]&&t.onEnd(n)};var d=this.getAnnotControllerPrototype;this.getAnnotControllerPrototype=function(){var t=d();return t.getReferencedAnnotations=function(t){if(i)return i.getReferencedAnnotations(t)},t};var c=this.getContextualCommandList;this.getContextualCommandList=function(){if(!a)return[];var t,n,o,r=c(),s=[],l=e.get(),g=a.getRootBagPath(),d=!1,h=!0;for(t=0;t<l.length;t++)if(l[t].pathElement&&g.isAParentOf(l[t].pathElement)){s.push(l[t].pathElement);var A=l[t].pathElement.getLastElement(!0);if(!A.getAnnotationClassType){h=!1;break}if(d=!0,"tps"!==A.getAnnotationClassType()){h=!1;break}}if(h)for(o=!1,t=0;t<s.length&&!o;t++)if(s[t].getLastElement(!0).isVisible()){var m=s[t].getLastElement(!0),u=void 0!==m.getGeometricalAttachmentList?m.getGeometricalAttachmentList():null;if(u&&u.length){var C=s[t].getParentPath().getParentPath().getLastElement(!0).children;for(n=0;n<C.length;n++){if("RootViews"!==C[n].getAnnotationType()&&"RootCaptures"!==C[n].getAnnotationType()&&"RootGeometries"!==C[n].getAnnotationType())for(var f=C[n].children,p=0;p<f.length;p++){if(-1!==u.indexOf(f[p].getAnnotationID())&&!f[p].isVisible()){a.getExecutionContext?r.WAfrCtxBarRow1.model.unshift({name:"CAT3DAnnotInsightShowGeomAttachStr",line:1,hdr_list:["CAT3DAnnotSemanticShowGeomAttachHdr"],identifier:"CAT3DAnnotSemanticShowGeomAttachHdr",type:"handler"}):r.unshift({name:"CAT3DAnnotInsightShowGeomAttachStr",line:1,hdr_list:["CAT3DAnnotSemanticShowGeomAttachHdr"]}),o=!0;break}}if(o)break}}}if(!d)for(o=!1,t=0;t<s.length&&!o;t++){var D=i.getPontingAnnotations(s[t]);if(D&&D.length)for(n=0;n<D.length;n++)if(!D[n].getLastElement(!0).isVisible()){a.getExecutionContext?r.WAfrCtxBarRow1.model.unshift({name:"CAT3DAnnotInsightShowRelatedAnnotStr",line:1,hdr_list:["CAT3DAnnotSemanticShowRelatedAnnotHdr"],type:"handler",identifier:"CAT3DAnnotSemanticShowRelatedAnnotHdr"}):r.unshift({name:"CAT3DAnnotInsightShowRelatedAnnotStr",line:1,hdr_list:["CAT3DAnnotSemanticShowRelatedAnnotHdr"]}),o=!0;break}}return r},this.getReferencedAnnotations=function(t){var e=t.getLastElement(!0);if("tps"!==e.getAnnotationClassType())return[];var n,o,a=i._getParentAnnotationSetPath(t),r=void 0!==e.getAnnotationReferenceFrame?e.getAnnotationReferenceFrame():null,s=[];if(r||32===e.getAnnotationType()){var l,g=a.getLastElement(!0).getReferenceFrames();for(n=0;n<g.length;n++)if(g[n].tpsID===r||e.getAnnotationUuid()===g[n].uuid){l=g[n].datums;break}if(void 0!==l){var d=a.getLastElement(!0).getRootAnnotationNode("RootDatums"),c=d.children,h=a.clone();for(h.addElement(d),n=0;n<l.length;n++)for(o=0;o<c.length;o++)if(c[o].getAnnotationID()===l[n]){var A=h.clone();A.addElement(c[o]),s.push(A);break}}}return s};var h=function(t,e){return e&&e.length&&(t=t&&t.length?t.concat(e):e),t},A=i.getPointedPaths;this.getPointedPaths=function(t){var e=A(t);if(a.getRootBagPath().isAParentOf(t)){var n=t.getLastElement(!0);if(n.getAnnotationClassType&&"tps"===n.getAnnotationClassType())if(e=h(e,i.getRelatedGeometryPaths([t])),e=h(e,i.getReferencedAnnotations(t)),8===n.getAnnotationSupertype())e=h(e,i.getPontingAnnotations(t));else{var o=i._getParentAnnotationSetPath(t);o&&(e=h(e,function(t,e){var n,o=t.getLastElement(!0);if(o.getDatumTargetList&&o.getDatumTargetList()){var i=o.getDatumTargetList(),a=e.getLastElement(!0).getRootAnnotationNode("RootDatums"),r=e.clone();r.addElement(a);var s=r.getChildrenPathes();n=[];for(var l=0;l<s.length;l++)-1!==i.indexOf(s[l].getLastElement(!0).getAnnotationID())&&n.push(s[l].clone())}return n}(t,o)),e=h(e,function(t,e){var n,o=t.getLastElement(!0);if(o.getAssociatedBasicDims&&o.getAssociatedBasicDims()){var i=o.getAssociatedBasicDims(),a=e.getChildrenPathes();n=[];for(var r=0;r<a.length;r++){var s=a[r].getLastElement(!0);if("RootViews"!==s.getAnnotationType()&&"RootCaptures"!==s.getAnnotationType()&&"RootGeometries"!==s.getAnnotationType())for(var l=a[r].getChildrenPathes(),g=0;g<l.length;g++)-1!==i.indexOf(l[g].getLastElement(!0).getAnnotationID())&&n.push(l[g].clone())}}return n}(t,o)),e=h(e,function(t,e){var n,o=t.getLastElement(!0),i=o.getAuxiliaryFeatures?o.getAuxiliaryFeatures():null;if(i&&(i.annotations||i.cgs)){var a=e.getChildrenPathes();n=[];for(var r=0;r<a.length;r++){var s=a[r].getLastElement(!0);if("RootViews"!==s.getAnnotationType()&&"RootCaptures"!==s.getAnnotationType()){var l,g=0;if("RootGeometries"===s.getAnnotationType()&&i.cgs.length)for(l=a[r].getChildrenPathes(),g=0;g<l.length;g++)-1!==i.cgs.indexOf(l[g].getLastElement(!0).getAnnotationID())&&n.push(l[g].clone());else if("RootGeometries"!==s.getAnnotationType()&&i.annotations.length)for(l=a[r].getChildrenPathes(),g=0;g<l.length;g++)-1!==i.annotations.indexOf(l[g].getLastElement(!0).getAnnotationID())&&n.push(l[g].clone())}}}return n}(t,o)),e=h(e,function(t,e){var n=[];if(t&&t.getLastElement(!0).getAnnotationSCSReframeArea&&t.getLastElement(!0).getAnnotationSCSReframeArea()){let l=t.getLastElement(!0).getAnnotationSCSReframeArea(),g=[];l.upperLimit&&l.upperLimit.length&&(g=g.concat(l.upperLimit)),l.lowerLimit&&l.lowerLimit.length&&(g=g.concat(l.lowerLimit));for(var o=e.getChildrenPathes(),i=0;i<o.length;i++){var a=o[i].getLastElement(!0);if("RootViews"!==a.getAnnotationType()&&"RootCaptures"!==a.getAnnotationType()&&"RootGeometries"!==a.getAnnotationType())for(var r=o[i].getChildrenPathes(),s=0;s<r.length;s++)-1!==g.indexOf(r[s].getLastElement(!0).getAnnotationID())&&n.push(r[s].clone())}}return n}(t,o)))}else e=h(e,i.getPontingAnnotations(t))}return e}}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticShowRelatedAnnotCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/CAT3DAnnotationController/CAT3DAnnotationController"],function(t,e,n,o,i){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0})},beginExecute:function(){var t=function(t){if(!t)return null;var e=void 0!==t.getLastElement(!0).getAnnotationID?t.getLastElement(!0).getAnnotationID():null,n=t.getParentPath().getParentPath();if(!n.getLastElement(!0).getAnnotationClassType||"tpsAnnotationSet"!==n.getLastElement(!0).getAnnotationClassType())return null;var o,i,a=null,r=n.getChildrenPathes();for(o=0;o<r.length;o++)if("RootViews"===r[o].getLastElement(!0).getAnnotationType()){a=r[o];break}if(a){var s=a.getChildrenPathes();for(o=0;o<s.length;o++){var l=s[o].getLastElement(!0).getTPSList();if(l&&l.length)for(i=0;i<l.length;i++)if(l[i]===e)return s[o]}}},n=e.get();n.length||this._endExecute(),this.ctxBarPosition=this.getFrameWindow().getContextualUIManager().getContextualBar().getPosition(),this.ctxBarPosition=this.ctxBarPosition?{x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}:{x:0,y:0};var a,r,s,l=o.get(),g=i.giveAnnotationController({context:l}),d=[],c=[];for(a=0;a<n.length;a++){var h=g.getPontingAnnotations(n[a].pathElement);if(h&&h.length)for(r=0;r<h.length;r++){d.push(h[r]);var A=t(h[r]);A&&A.getLastElement(!0).isVisible()&&-1===d.indexOf(A)&&d.push(A);var m=h[r].getParentPath().getParentPath();-1===c.indexOf(m)&&c.push(m)}}if(c&&c.length)for(a=0;a<c.length;a++){var u=c[a].getChildrenPathes();for(r=0;r<u.length;r++){var C=u[r].getChildrenPathes();for(s=0;s<C.length;s++)C[s].getLastElement(!0).setVisibility(!1)}}if(d&&d.length)for(a=0;a<d.length;a++)d[a].getLastElement(!0).setVisibility(!0);this._endExecute()},_endExecute:function(){for(var t=e.get(),o=[],i=0;i<t.length;i++)o.push({pathElement:t[i].pathElement.clone()});e.empty(),n.empty(),e.add(o),n.add(o),this.ctxBarPosition&&(this.getFrameWindow().getExecutionContext?this.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}):this.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y})),this.getFrameWindow().getViewer().render(),this.ctxBarPosition=null,this.cancel()},destroy:function(){this._endExecute()}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticShowGeomAttachCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/Selection/HSOManager"],function(t,e,n){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0})},beginExecute:function(){var t=e.get();t.length||this._endExecute(),this.ctxBarPosition=this.getFrameWindow().getContextualUIManager().getContextualBar().getPosition(),this.ctxBarPosition=this.ctxBarPosition?{x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}:{x:0,y:0};for(var n=0;n<t.length;n++)if(t[n].pathElement.getLastElement(!0).isVisible()){var o=t[n].pathElement.getLastElement(!0).getGeometricalAttachmentList();if(o&&o.length)for(var i=t[n].pathElement.getParentPath().getParentPath().getLastElement(!0).children,a=0;a<i.length;a++)if("RootViews"!==i[a].getAnnotationType()&&"RootCaptures"!==i[a].getAnnotationType()&&"RootGeometries"!==i[a].getAnnotationType())for(var r=i[a].children,s=0;s<r.length;s++){-1===o.indexOf(r[s].getAnnotationID())||r[s].isVisible()||r[s].setVisibility(!0)}}this._endExecute()},_endExecute:function(){for(var t=e.get(),o=[],i=0;i<t.length;i++)o.push({pathElement:t[i].pathElement.clone()});e.empty(),n.empty(),e.add(o),n.add(o),this.ctxBarPosition&&(this.getFrameWindow().getExecutionContext?this.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}):this.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y})),this.getFrameWindow().getViewer().render(),this.ctxBarPosition=null,this.cancel()},destroy:function(){this._endExecute()}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticWidgetDefaultCmd",["DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd"],function(t){"use strict";return t.extend({init:function(t){var e=t||{};e.annotControllerLib="DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticContInstance",this._parent(e)}})});