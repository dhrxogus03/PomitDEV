/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNInfraUX/SearchDataSources",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Data","UWA/Promise","DS/WebappsUtils/WebappsUtils","text!DS/SNInfraUX/assets/SearchDataSources.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/SearchSettings"],function(e,t,i,r,s,n,a,o,c,l,d){"use strict";return t.singleton(i,{options:{search_dataSources:{},search_dataSources_odt:{}},loadComplete:!1,settings_loaded:[],onCompleteLoad:void 0,init:function(){c.groupCollapsed("SearchDataSources.init"),-1===location.search.indexOf("debug")&&-1===location.search.indexOf("searchLogs")||(this.setDebugMode(!0),window.searchLogs=!0,c.info("[3dSearch] - traces activated")),e.is(this.options)||(this.options={search_dataSources:{}}),e.is(this.options.search_dataSources)||(this.options.search_dataSources={});var t=null;if(!0===d.getOption("dataSourcesFile"))try{t=JSON.parse(a),c.log("DataSources from SearchDataSources.json:"),t&&c.log(JSON.parse(JSON.stringify(t)))}catch(e){c.error("Error parsing SearchDataSources.json:",e)}e.is(t)&&(e.merge(this.options,t),e.is(t.search_dataSources)&&e.merge(this.options.search_dataSources,t.search_dataSources)),c.groupEnd()},getOption:function(t,i){if(e.is(this.options))return this.options.search_dataSources[t]}})}),define("DS/SNInfraUX/SearchSettings",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Data","UWA/Promise","DS/WebappsUtils/WebappsUtils","text!DS/SNInfraUX/assets/SearchSettings.json","text!DS/SNInfraUX/assets/SearchSettings_Public.json","text!DS/SNInfraUX/assets/SearchSettings_IP.json","DS/WebRecordEnabler/Adapter","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchControlCenterFetchService"],function(e,t,i,r,s,n,a,o,c,l,d,u,p){"use strict";var h=e=>{return/(http|https):\/\//.test(e)},g=t.singleton(i,{options:{search_settings:{},search_settings_odt:{}},loadComplete:!1,settings_loaded:[],onCompleteLoad:void 0,_tenantSettingsPC:{},_tenantSettings:{},setODToption:function(t,i){e.is(this.options.search_settings_odt,"object")||(this.options.search_settings_odt={}),this.options.search_settings_odt[t]=i,u.info("ODT option SET, "+t+" = "+this.options.search_settings_odt[t])},init:function(){u.groupCollapsed("SearchSettings.init"),-1===location.search.indexOf("debug")&&-1===location.search.indexOf("searchLogs")||(this.setDebugMode(!0),window.searchLogs=!0,u.info("3DSearch traces activated"));try{this.options=JSON.parse(c),u.log("Settings from SearchSettings_IP.json:"),this.options&&u.log(JSON.parse(JSON.stringify(this.options)))}catch(e){u.error("Error parsing SearchSettings_IP.json:",e)}e.is(this.options)||(this.options={search_settings:{}}),e.is(this.options.search_settings)||(this.options.search_settings={});var t=null;try{t=JSON.parse(o),u.log("Settings from SearchSettings_Public.json:"),t&&u.log(JSON.parse(JSON.stringify(t)))}catch(e){u.error("Error parsing SearchSettings_Public.json:",e)}e.is(t)&&(e.merge(this.options,t),e.is(t.search_settings)&&e.merge(this.options.search_settings,t.search_settings));var i=null;try{i=JSON.parse(a),u.log("Settings from SearchSettings.json:"),i&&u.log(JSON.parse(JSON.stringify(i)))}catch(e){u.error("Error parsing SearchSettings.json:",e)}e.is(i)&&(e.merge(this.options,i),e.is(i.search_settings)&&e.merge(this.options.search_settings,i.search_settings)),this.options.url_search_settings={};var r=null;if(e.is(window)&&e.is(window.location)&&e.is(window.location.search,"string")&&(r=window.location.search.substring(1)),e.is(r,"string")&&r.length>0&&r.indexOf("widgetDomain=")>=0){for(var s=r.split("&"),n={},l=0;l<s.length;l++){var d=s[l].split("=");if(2===d.length&&"widgetDomain"===d[0]){var p=d[1];if(e.is(p,"string")&&p.length>0&&p.indexOf("%3F")>-1){p=p.substring(p.indexOf("%3F")+3);for(var h=(p=decodeURIComponent(p)).split("&"),g=0;g<h.length;g++){var f=h[g].split("=");1===f.length?n[f[0]]=!0:2===f.length&&f[0].length>0&&(n[f[0]]=f[1])}}}}this.urlSettings(n),u.log("Settings from URL:"),n&&u.log(JSON.parse(JSON.stringify(n)))}if(this.isODTMode()){let t=sessionStorage.getItem("search_settings");if(e.is(t,"string"))try{let i=JSON.parse(t);e.is(i,"object")&&(t=i)}catch(e){u.error("Invalid settings from sessionStorage",t)}if(e.is(t,"object")){this.options.sessionStorageSettings=t,u.log("Settings from local storage:",t);for(let[e,i]of Object.entries(t))this.options.search_settings[e]=i}}this._adjustLegacySettings(),this.debugMode=this.getDebugMode(),u.groupEnd()},load:function(e){this.settings_loaded.indexOf(e.url)&&(this.onCompleteLoad=e.onComplete,this._loadSettings(e.url),this.settings_loaded.push(e.url))},urlSettings:function(t){for(var i in u.groupCollapsed("SearchSettings.urlSettings"),u.log("upd_settings input:"),u.log(t),e.is(t.debug_me)&&(this.options.search_settings.debug_mode=!0,u.log("debug_me key present")),!0===this.options.search_settings.debug_mode&&(this.setDebugMode(!0),u.log("debug_mode true => activate debug")),e.is(this.options.url_search_settings)||(this.options.url_search_settings={}),t)if("debug_me"===i)u.log("Debug mode already taken into account");else{var r=t[i];if(void 0!==r&&"string"==typeof r.valueOf()&&r.length>0&&("false"===r.toLowerCase()?r=!1:"true"===r.toLowerCase()&&(r=!0)),e.is(this.options.search_settings[i],"number")&&!isNaN(r)&&(r=Number(r)),e.is(r,"string")&&r.indexOf("%")>-1&&(r=decodeURIComponent(r)).indexOf("{")>-1)try{r=JSON.parse(r)}catch(e){u.error("Error parsing arg:",e)}this.options.url_search_settings[i]=r}u.log("Updated settings:"),u.log(this.options.url_search_settings),u.groupEnd()},initialize:function(t){this.options=e.extend(this.options,t,!0),this._adjustLegacySettings(),this.debugMode=this.getDebugMode()},serialize:function(){return JSON.stringify(this.options)},getDebugMode:function(){return!!(e.is(this.options)&&e.is(this.options.search_settings)&&this.options.search_settings.debug_mode)},getDebug:function(){return!!(e.is(this.options)&&e.is(this.options.search_settings)&&e.is(this.options.search_settings.debug)&&!0===this.options.search_settings.debug)},manageHardcodedSettings:function(t,i){if("Recent_Content_Delta_Time"!==t||this.getOption("deactivate_checks")){if("defaultViewModeAfterCacheCleaning"===t){var r=i.toLowerCase();if("table"===r||"grid"===r?i="table":!0!==this.options.search_settings.simple_search_experience&&(i="thumbnail"),!0===this.getOption("newSearch19xFD02")&&!0===this.getOption("predefinedBetaUser")&&!0===this.options.search_settings.simple_search_experience&&(i="tilebig"),!0===this.getOption("OneSearch")&&("table"===i||"tile"===i||"thumbnail"===i)){var s=/iPhone/.test(navigator.userAgent)&&!window.MSStream,n=/iPad/.test(navigator.userAgent)&&!window.MSStream,a=/Android/.test(navigator.userAgent)&&!window.MSStream;if(-1!==["iphone","ipad","android"].indexOf(s?"iphone":(n?"ipad":"")||(a?"android":""))){var o=screen.availWidth;e.is(o)&&o<1023&&(i="tilebig")}else!0===this.getOption("search_compact_mode")&&(i="tilebig")}}else if("max_selection_for_selectall"===t||"max_selection_for_actions"===t)!e.is(i)&&(i=200),i>1e3?i=1e3:i<1&&(i=200);else if("results_perpage"===t&&(!e.is(i,"number")||i<=1||i>200)){let t=window.devicePixelRatio,r=26;t<1&&(t=1/t);let s,n=window.innerWidth,a=window.innerHeight;u.log("Settings results_perpage width: ",n),u.log("Settings results_perpage height: ",a);let o=/iPhone/.test(navigator.userAgent)&&!window.MSStream,c=/iPad/.test(navigator.userAgent)&&!window.MSStream,l=/Android/.test(navigator.userAgent)&&!window.MSStream;-1!==["iphone","ipad","android"].indexOf(s=o?"iphone":(c?"ipad":"")||(l?"android":""))&&(r=40);let d=10*Math.ceil(n*a/(t*t)/53e3/10),p=Math.ceil(a/r+1),h=Math.max(d,p);u.log("Settings results_perpage ratio: ",t),u.log("Settings results_perpage computedMaxTileValue: ",d),u.log("Settings results_perpage computedMaxGridValue: ",p),u.log("Settings results_perpage computedValue: ",h),e.is(h,"number")&&h>1&&h<200?(i=h,!0===g.getOption("search_web_in_win")&&h<41&&(i=40)):i=200}}else(i>30||i<1)&&(i=5);return i},getOptionPerTenant:function(t,i){var r=null;return e.is(t)&&e.is(i,"object")&&e.is(i.tenant,"string")&&i.tenant.length>0&&e.is(this._tenantSettings[i.tenant])&&e.is(this._tenantSettings[i.tenant].search_settings)&&e.is(this._tenantSettings[i.tenant].search_settings[t])&&(r=this._tenantSettings[i.tenant].search_settings[t]),e.is(r)||e.is(t)&&e.is(i,"object")&&e.is(i.tenant,"string")&&i.tenant.length>0&&e.is(this._tenantSettings[i.tenant])&&e.is(this._tenantSettings[i.tenant][t])&&(r=this._tenantSettings[i.tenant][t]),r},getOption:function(t,i){var r=l.getenv(t);if(e.is(this.options)){var s=null,n=!1;return e.is(this.options.url_search_settings)&&!0===this.options.url_search_settings.ignoreAdminSettings?n=!0:e.is(this.options.sessionStorageSettings)&&!0===this.options.sessionStorageSettings.ignoreAdminSettings&&(n=!0),!1===n&&(s=this.getOptionPerTenant(t,i)),e.is(this.options.url_search_settings,"object")&&e.is(this.options.url_search_settings[t])?this.options.url_search_settings[t]:e.is(this.options.sessionStorageSettings,"object")&&e.is(this.options.sessionStorageSettings[t])?this.options.sessionStorageSettings[t]:!0===i&&e.is(this.options.search_settings_odt)?this.options.search_settings_odt[t]:e.is(window.dscef)&&e.is(window.dscef.getEnv,"function")&&e.is(window.dscef.getEnv(t),"string")&&window.dscef.getEnv(t).length>0?window.dscef.getEnv(t):e.is(this.options.search_settings)&&e.is(this.options.search_settings[t])?(r=this.options.search_settings[t],e.is(s)&&(r=s),r=this.manageHardcodedSettings(t,r)):e.is(s)?r=this.manageHardcodedSettings(t,s):e.is(this.options[t])?this.options[t]:this.manageHardcodedSettings(t,s)}},_loadSettings:function(t){u.groupCollapsed("SearchSettings._loadSettings"),u.log("url=",t);var i=this,s={timeout:5e4,method:"GET",data:{},type:"json",headers:{Accept:"application/ds-json"},onComplete:function(t){u.log("setting file successfully retrieved");var r={};if(e.is(t,"string"))try{r=JSON.parse(t)}catch(e){u.log("Error parsing file",e),u.log("resp=",t)}else r=t;r.error?u.log("Bad format for SearchSettings"):i.initialize(r),i.loadComplete=!0,e.is(i.onCompleteLoad,"function")&&i.onCompleteLoad.call(void 0,null),u.log("Available Search Settings:\n"+JSON.stringify(i.options)),u.groupEnd()},onFailure:function(){u.log("failed retrieving setting file"),e.is(i.onCompleteLoad,"function")&&i.onCompleteLoad.call(void 0,null),u.groupEnd()},onTimeout:function(){u.log("No settings found timeout reach"),u.groupEnd()}};try{if(!h(t)){var a="";a=n.getWebappsBaseUrl();a=a.replace(/\/$/,""),u.log("Base URL "+a),h(a)||(u.log("The base URL is not a valid one (webapp context?)"),a=""),t=a+t}u.log("Used URL "+t),r.request(t,s)}catch(e){u.log("Failure : "+e),u.groupEnd()}},getSettingsToDisplayInUI:function(){var t=[];e.is(this.options.search_settings.searchOptionsDisplayedInUI,"array")&&(t=this.options.search_settings.searchOptionsDisplayedInUI);for(var i=t.length-1;i>=0;i--){var r=t[i];if(e.is(r)&&e.is(r.optionID)){var s=r.optionID,n=d.get(s),a=d.get(s+".tooltip");if(r.optionLabel=n,r.optionTooltip=a,e.is(r.moreOptions,"array")){for(var o=r.moreOptions,c=0;c<o.length;c++){var l=o[c];e.is(l)&&e.is(l.optionID)&&(s=l.optionID,n=d.get(s),a=d.get(s+".tooltip"),l.optionLabel=n,l.optionTooltip=a,l.father=s,t.push(l))}r.moreOptions=void 0,!1===this.getDebug()&&(t[i]=void 0)}}}return t},_adjustLegacySettings:function(){e.is(this.options.search_settings)&&e.is(this.options.search_settings.topbar_search_banned_list)&&(e.is(this.options.search_settings.topbar_search_banned_list.types,"array")&&(this.options.search_settings.topbar_search_banned_list.types={"3dspace":this.options.search_settings.topbar_search_banned_list.types}),e.is(this.options.search_settings.topbar_search_banned_list.users,"array")&&(this.options.search_settings.topbar_search_banned_list.users={"3dspace":this.options.search_settings.topbar_search_banned_list.users}))},_loadTenantSettings:function(t){var i=this;i._tenantSettingsPC[t]||(i._tenantSettingsPC[t]=s.deferred(),i._tenantSettings[t]={},p.getSearchSettings({tenantID:t}).then(r=>{e.is(r)&&(i._initializeIrrelevantTags(t,r),Object.keys(r).forEach(function(s){var n=r[s];"relevant_tags"===s?e.is(n,"object")&&Object.keys(n).length>0&&(i._tenantSettings[t][s]=n):i._tenantSettings[t][s]=n})),i._tenantSettingsPC[t].resolve()},()=>{i._tenantSettingsPC[t].resolve()}))},_initializeIrrelevantTags:function(t,i){if(u.groupCollapsed("SearchSettings._initializeIrrelevantTags from SCC relevant_tags"),u.log("tenantId:",t),u.log("SCCsettings:",i),e.is(i)&&e.is(i.relevant_tags)){for(var r=i.relevant_tags,s=this.getOption("irrelevant_tags")||[],n=Object.keys(r),a=0;a<n.length;a++)if(e.is(n[a],"string")){var o=r[n[a]];e.is(o)&&e.is(o.weight)&&-1===o.weight&&(u.log("Adding key",n[a]," in irrelevant_tags setting"),s.indexOf(n[a])<0&&s.push(n[a]),u.log("Deleting key",n[a]," from relevant_tags setting"),delete i.relevant_tags[n[a]])}this._tenantSettings[t].irrelevant_tags=s}else e.is(i)?e.is(i.relevant_tags)||u.log("relevant_tags key not found in SCC settings"):u.log("SCC setting is undefined");u.groupEnd()},getTenantSettings:function(e){return this._loadTenantSettings(e),this._tenantSettingsPC[e].promise},_resolveTenantSettings:function(e){this._tenantSettingsPC[e]=s.deferred(),this._tenantSettingsPC[e].resolve()},changeSettingForFD01:function(){!0!==this.getOption("enableNewSearchViews")&&(!e.is(this.options.search_settings.keepOldSearchViews)&&(this.options.search_settings.keepOldSearchViews=!0),e.is(this.options.search_settings.informationsPanel)&&(this.options.search_settings.informationsPanel=!1))},changeSettingForBETA:function(){u.groupCollapsed("SearchSettings.changeSettingForBETA");var e={contentsLocation_FUN072059:!0,keepOldSearchViews:!1};u.log("Overriding the settings for beta "+JSON.stringify(e)),this.initialize({search_settings:e}),u.groupEnd()},changeSettingForBETA_deactivated:function(e){u.groupCollapsed("SearchSettings.changeSettingForBETA_deactivated");var t=e||{};u.log("Overriding the settings when beta option is available but deactivated: "+JSON.stringify(t)),this.initialize({search_settings:t}),u.groupEnd()},changeSettings:function(e){this.initialize({search_settings:e})},isODTMode:function(){let e=sessionStorage.getItem("isODTMode")||this.getOption("isODTMode");return"true"===e&&(e=!0),e&&!this._warningAlreadyDisplayed&&(this._warningAlreadyDisplayed=!0,u.warn("ODT Mode active !!!")),e},setCompactMode:function(t){if(e.is(this.options.search_settings)){var i=t;e.is(i)||(i=!0),this.options.search_settings.simple_search_experience=!0,this.options.search_settings.search_compact_mode=i,e.is(this.options.search_settings.informationsPanel)&&(this.options.search_settings.informationsPanel=!1),this.options.search_settings.NoadvOnMenu=i,this.options.search_settings.NofavoritesOnMemu=i,this.options.search_settings.NoPQMenu=i,this.options.search_settings.show_last_indexation_time=!i}}});return g}),define("DS/SNInfraUX/tracker/SearchTrackerApi",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/Usage/TrackerAPI","DS/MessageBus/MessageBus"],function(e,t,i,r,s,n){"use strict";return t.singleton(i,r,{tracker:null,messageBus:null,init:function(){},trackPageView:function(){s.trackPageView({pageURL:window.location.href})},trackPageEvent:function(e,t){s.trackPageEvent({eventCategory:e,eventAction:t})},set:function(){this.messageBus=n.subscribe({channel:"SearchTrackerApi",topic:"hit",callback:this._track.bind(this)})},register:function(e){s.registerData(e)},_track:function(t){require(["DS/SNInfraUX/SearchUtils"],function(i){e.is(t)&&s.trackPageEvent({eventCategory:e.is(t.category)?t.category:"category",eventAction:e.is(t.action)?t.action:"actions",appID:i.getSearchAppId(),persDim:e.is(t.persDim)?t.persDim:{},persVal:e.is(t.persVal)?t.persVal:{}})})}})}),define("DS/SNInfraUX/SearchViewServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","text!DS/SNInfraUX/assets/SearchView.json"],function(e,t,i,r,s){"use strict";return t.singleton(i,r,{_searchViewSpec:null,init:function(){this._searchViewSpec=JSON.parse(s)},initialize:function(t){this._searchViewSpec=e.extend(this._searchViewSpec,t,!0)},_getSourceSpecificAllPredicates:function(e){var t=this.getViewSpecs(e),i=[],r=Object.keys(t);if(Array.isArray(r)&&r.length>0)for(var s=0;s<r.length;s++)Array.isArray(t[r[s]])&&(i=i.concat(t[r[s]]));return i.filter(function(e,t,i){return t===i.indexOf(e)})},getAllSelectClause:function(t){var i=[];if(!0===t){var r=Object.getOwnPropertyNames(this._searchViewSpec.SearchView);if(e.is(r,"array")&&r.length>0){var s=r.indexOf("UXSupportedFields");s>=0&&r.splice(s,1)}for(var n=0,a=r.length;n<a;n++){var o=this._getSourceSpecificAllPredicates(r[n]);i=i.concat(o)}}else i=this._getSourceSpecificAllPredicates("default");return i.filter(function(e,t,i){return t===i.indexOf(e)})},getViewSpecs:function(t,i){""===t&&(t="default");var r=i;e.is(r)||(r=[]);var s={};if(e.is(this._searchViewSpec)&&this._searchViewSpec.hasOwnProperty("SearchView")){this._searchViewSpec.SearchView.hasOwnProperty(t)||(t="default");var n=this._searchViewSpec.SearchView[t];if(Array.isArray(r)&&(r.length<=0&&this._searchViewSpec.SearchView.hasOwnProperty("UXSupportedFields")&&(r=e.clone(this._searchViewSpec.SearchView.UXSupportedFields)),r.length>0))for(var a=0,o=0;o<r.length;o++)if(e.is(n)&&n.hasOwnProperty(r[o]))s[r[a++]]=n[r[o]];else{var c=this._searchViewSpec.SearchView.default;e.is(c)&&c.hasOwnProperty(r[o])&&(s[r[a++]]=c[r[o]])}}return s}})}),define("DS/SNInfraUX/Logger",[],function(){"use strict";return-1!==location.search.indexOf("searchLogs")&&(window.searchLogs=!0),new function(e){var t,i,r,s,n;function a(e){return function(){if(t){var r=Array.prototype.slice.call(arguments);if(r.unshift("[3DSearch | "+e+"]"),i.console){if("function"==typeof i.console[e]&&(i.searchLogs||"info"===e||"warn"===e||"error"===e))return i.console[e].apply(i.console,r);if("function"!=typeof i.console[e]&&"object"==typeof i.console[e]&&"debug"!==e&&i.searchLogs)return i.console[e](r)}else if(i.opera&&"function"==typeof i.opera.postError&&i.searchLogs)return i.opera.postError.apply(null,r)}}}for("boolean"!=typeof e&&(e=!1),t=e,i=window||global||{},this.disable=(()=>(t=!1,this)),r=0,s=(n=["log","info","warn","error","debug","group","groupEnd","groupCollapsed"]).length;r<s;r++)this[n[r]]=a(n[r])}(!0)}),define("DS/SNInfraUX/utils/RankingEngine",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(e,t,i){"use strict";return t.singleton({init:function(){},getMatchResults:function(e,t,i){var r=[];if(!(0!=e.length&&t.length>0&&i))return t;var s=e=(e=e.replace(/  +/g," ").trim()).toLowerCase();s=this.regexHandle4Symbols(s,!0);var n=this.getIndexesOfSymbols(s),a=[];if(a[0]=[],a[1]=[],a[2]=[],e.length>3){for(let e=1;e<s.length+1;e++)n.indexOf(e)>=0?(e++,e++):a[0].push(s.substr(0,e)+"."+s.slice(e));for(let e=1;e<s.length-1;e++)n.indexOf(e+1)>=0?(e++,e++,e++):a[1].push(s.substr(0,e)+s[e+1]+s[e]+s.slice(e+2));for(let e=1;e<s.length;e++)n.indexOf(e)>=0?(e++,e++):a[2].push(s.substr(0,e)+".?"+s.slice(e+1));var o=[],c=s;for(let e=0;e<s.length-1;e++)n.indexOf(e)>=0&&(e+=2),e+1<s.length&&o.push(e+1);o.forEach((e,t)=>{c=c.substr(0,e+3*t)+".*?"+c.slice(e+3*t)})}return function(t){var n=[];n[0]=[],n[1]=[],n[2]=[],n[3]=[];for(let r=0;r<t.length;r++)if(t[r][i]){var o=t[r][i];if(e===o.toLowerCase())t[r].rank=1e3,t[r].highLight=t[r][i],t[r].matchType="exact",n[0].push(t[r]);else{var l=new RegExp(s,"i");if(l=o.match(l)){let e=l[0].trim();t[r].rank=100-2*o.indexOf(e)+e.length,t[r].highLight=e,t[r].matchType="simple",n[1].push(t[r]);continue}if(e.length>3){let e=!1;for(let i=0;i<3;i++){if(0==a[i].length)continue;var d="("+a[i].join("|")+")";d=new RegExp(d,"i");let s=o.match(d);if(s){let i=s[0].trim(),a=o.indexOf(i);t[r].rank=100-2*a+i.length,t[r].highLight=i,t[r].matchType="extended",n[2].push(t[r]),e=!0;break}}if(!e){let e=o.match(new RegExp(c,"i"));if(e){let i=o.indexOf(e[0]);t[r].rank=100-2*i-e[0].length,t[r].highLight=e[0],t[r].matchType="extended",n[3].push(t[r])}}}}}for(var u=0;u<n.length;u++)n[u].length&&(n[u].sort((e,t)=>t.rank-e.rank),r=r.concat(n[u]))}(t),r},getIndexesOfSymbols:function(e){var t=[...e.matchAll(/[!"#$%&'()*+,-./\\:;<=>?@[\]^_`{|}~]/g)],i=[];return t.forEach((e,t)=>{var r=e.index;i.push(r)}),i},regexHandle4Symbols:function(e,t){var i=[...e.matchAll(/[!"#$%&'()*+,-./\\:;<=>?@[\]^_`{|}~]/g)],r=e;return i.forEach((e,i)=>{var s=e.index;r=t?r.slice(0,s+2*i)+"\\"+r[s+2*i]+"?"+r.slice(s+2*i+1):r.slice(0,s+i)+"\\"+r[s+i]+r.slice(s+i+1)}),r}})}),define("DS/SNInfraUX/RefineHelper/RefineHelper",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(e,t,i){"use strict";return t.singleton(i,{isSimplifiedTaggerFilters:function(e){return e&&e.operator&&e.condition},isEmpty:function(e){return this.isSimplifiedTaggerFilters(e)&&0===e.condition.length},getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],r=e.value||[];i.forEach(function(e,i){t[e.predicate]||(t[e.predicate]=[]),t[e.predicate].push(r[i])})})})}),t},extractSourceInSimplifiedTagger:function(e){var t=[],i=this.getAllAdvanceFilters(e);i.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&i["sixw:ds6w:where/ds6w:source/ds6w:dataSource"].forEach(function(e){t.push(e.object)});return t},getAllAdvanceFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){i.includes("sixw:")&&(t[i]=t[i]||[],(e[i]||[]).forEach(function(e){t[i].push(e)}))})}),t},convertToRefineAndUQL:function(e){var t=e||{},i=t.operator||!1,r=t.excluded||!1,s=t.condition||[],n="AND"!==i||r,a="",o={};return s.reduce(function(e,t){Object.keys(t).forEach(function(e){if(0!==e.indexOf("sixw:")){var r=t[e],s=this._ds6w(r,n);a=this._mergeQuery(a,s.uql,i,!0),this._andRefines(o,s.refine)?this._collectRefines(o,s.refine):a=this._mergeQuery(a,this._refineToQuery(s.refine),i,!0)}}.bind(this))}.bind(this),{}),r&&a&&(a="NOT"+a),{uql:a,refine:o}},_ds6w:function(e,t){var i="",r={},s=e.excluded||!1,n=s?"OR":e.operator,a=e.condition||[],o=e.display||[],c=o.length===a.length,l=!1;return s||(l=this._allConditionsExluded(a)),t=t||s||this._uqlonly_ds6w(e),a.forEach(function(e,s){var a=t||!this._canRefine(r,e,n),d=this._condition(e,a,c?o[s].nls:void 0,l),u=d.uql;e.excluded&&!l&&d.uql&&(u="NOT ("+d.uql+")"),i=this._mergeQuery(i,u,n),this._collectRefines(r,d.refine)}.bind(this)),(l||s)&&i&&(i="NOT("+i+")"),{uql:i,refine:r}},_allConditionsExluded:function(t){return t.every(t=>e.is(t.excluded)&&t.excluded)},_condition:function(t,i,r,s){var n="",a={},o=t.value,c=t.predicates,l=t.operator||"OR",d=t.excluded||!1,u=t.field;return u&&c.length!==u.length&&(u=null),d&&!s?{uql:n,refine:a}:(i?c.forEach(function(t,i){if(e.is(o[i],"array"))n=this._mergeQuery(n,this._keyValue(t.predicate,JSON.stringify(o[i].join("/").concat("*"))),l);else if(e.is(o[i],"string"))n=this._mergeQuery(n,this._keyValue(t.predicate,JSON.stringify(o[i])),l);else if(e.is(o[i],"object")){var r=this._range_query(t,o[i]);n=this._mergeQuery(n,r,l)}}.bind(this)):c.forEach(function(e,t){var i=e.predicate;a[i]||(a[i]=[]),a[i].push({type:e.type,object:o[t],disptext:r||o[t],field:u?[u[t]]:["implicit"]})}),{uql:n&&!d?"("+n+")":n,refine:a})},_uqlonly_ds6w:function(e){var t=e.operator;e.excluded;if("AND"===t)return!1;if("XOR"===t)return!0;for(var i=e.condition||[],r={},s=0;s<i.length;s++){var n=i[s],a=this._canRefineCondition(n);if(!1===a)return!0;for(var o=Object.keys(a),c=0;c<o.length;c++){var l=o[c];if(!r[l]){if(Object.keys(r).length>0)return!0;r[l]=[]}}}return!1},_canRefineCondition:function(t){var i={},r=t.predicates||[],s=t.operator||"OR",n=t.excluded||!1,a=t.value;if(n)return!1;for(var o=0;o<r.length;o++){if(e.is(a[o],"object"))return!1;var c=r[o];if(i[c.predicate]){if("OR"!==s)return!1}else if(i[c.predicate]=[],Object.keys(i).length>1&&"AND"!==s)return!1}return i},_canRefine:function(e,t,i){var r=this._canRefineCondition(t);if(!1===r)return!1;for(var s=Object.keys(r),n=0;n<s.length;n++){if(e[s[n]]){if("OR"!==i)return!1}else if(Object.keys(e).length>0&&"AND"!==i)return!1}return!0},_keyValue:function(t,i){var r=t.split("/");return e.is(i,"array")&&(i=i.join("/")),"["+r[r.length-1]+"]:"+i},_mergeQuery:function(e,t,i,r){return t&&r&&(t="("+t+")"),e?t?e+" "+i+" "+t:e:t},_collectRefines:function(e,t){Object.keys(t).forEach(function(i){e[i]||(e[i]=[]),e[i]=e[i].concat(t[i])})},_andRefines:function(e,t){return!Object.keys(t).some(function(t){return e[t]})},_refineToQuery:function(e){var t="",i=this;return Object.keys(e).forEach(function(r){var s=e[r],n="";s.forEach(function(e){var t=i._keyValue(r,JSON.stringify(e.object));n=i._mergeQuery(n,t,"OR")}),t=i._mergeQuery(t,n,"AND")}),t},_range_query:function(t,i){var r="",s="["+t.predicate+"]",n="",a="";if("date"===t.type){if(e.is(i.from)){var o=new Date(i.from+" 00:00:00");n=s+'>="'+new Date(o).toISOString()+'"'}if(e.is(i.to)){var c=new Date(i.to+" 23:59:59");a=s+'<="'+new Date(c).toISOString()+'"'}r+=this._mergeQuery(n,a,"AND")}return r},applyTransformation:function(e,t){this.isSimplifiedTaggerFilters(e)&&((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],r=e.value||[],s=e.field;i.forEach(function(i,n){var a={};a[i.predicate]=[];var o={disptext:e.display,object:r[n],type:i.type,field:s?[s[n]]:["implicit"]};a[i.predicate].push(o),t.call(void 0,a),Object.keys(a).forEach(function(e){r[n]=a[e][0].object,i.predicate=e})})})})})},applyTransformationAdvancedFilter:function(e,t){this.isSimplifiedTaggerFilters(e)&&((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){if(i.includes("sixw:")){var r={};e[i].forEach(function(e){r[i]=[];var t={disptext:e.displayValue,object:e.object,type:e.type,field:e.field?[e.field]:["implicit"]};r[i].push(t)}),t.call(void 0,r)}})})},preMergeSimplifiedTagger:function(e,t,i,r,s){if(this.isSimplifiedTaggerFilters(i)){var n=i.condition||[],a={};n.forEach(function(e){Object.keys(e).forEach(function(t){a[t]=e[t]})});var o=this.getAllFilters(i);if(a["ds6w:where/ds6w:location/computedCountryInfo"]||a["ds6w:where/ds6w:location/computedCityInfo"]){var c=[];r.forEach(function(e){e.sixw.startsWith("ds6w:who/")||c.push(e)}),r=c}else if(a["ds6w:who/person"]){e.filter(function(e){return e.sixw.startsWith("ds6w:who/")}).forEach(function(e){o[e.sixw]||r.push(e)})}s=s||[],Object.keys(o).map(function(e){return e.split("/").pop()}).some(function(e){return s.indexOf(e)>=0})&&e.forEach(function(e){var t=e.sixw.split("/").pop();s.indexOf(t)>=0&&!o[e.sixw]&&r.push(e)})}return r},mergeWhat:function(e,t,i,r){if(this.isSimplifiedTaggerFilters(i)){var s=i.condition||[],n={};if(s.forEach(function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})}),n["ds6w:where/ds6w:location/computedCountryInfo"]||n["ds6w:where/ds6w:location/computedCityInfo"])return[];var a=e.filter(function(e){return e.sixw.startsWith("ds6w:who/")}),o=this.getAllFilters(i);a.forEach(function(e){o[e.sixw]||r.push(e)})}return r},postMergeSimplifiedTagger:function(e,t){var i={};if(this.isSimplifiedTaggerFilters(e)){(e.condition||[]).forEach(function(e){Object.keys(e).forEach(function(t){i[t]=e[t]})});var r=[];function s(e){e&&e.condition&&e.condition.forEach&&e.condition.forEach(function(e){r.push.apply(r,e.value)})}s(i["ds6w:where/ds6w:location/computedCountryInfo"]),s(i["ds6w:where/ds6w:location/computedCityInfo"]),t=t.filter(function(e){return!(e.sixw.startsWith("ds6w:who/")&&r.length>0&&r.indexOf(e.object)<0)})}return t}})}),define("DS/SNInfraUX/SWFiltering",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Json"],function(e,t,i,r){"use strict";return t.singleton(i,{_select_predicates:null,_select_exclude_synthesis:null,_additional_criteria:null,_specificSourceParameter:null,init:function(){},setSelectPredicates:function(t){e.is(t)&&(e.is(t,"string")&&(t=r.decode(t)),e.is(t,"array")&&(this._select_predicates=t))},getSelectPredicates:function(){return this._select_predicates},isAVisiblePredicate:function(t){var i=!0;return e.is(this._select_predicates,"array")&&-1===this._select_predicates.indexOf(t)&&(i=!1),i},setSelectExcludeSynthesis:function(t){e.is(t)&&(e.is(t,"string")&&(t=e.Json.decode(t)),e.is(t,"array")&&(this._select_exclude_synthesis=t))},getSelectExcludeSynthesis:function(){return this._select_exclude_synthesis},setAdditionalQueryCriteria:function(t){e.is(t,"string")&&(this._additional_criteria=t)},getAdditionalQueryCriteria:function(){return this._additional_criteria},setSpecificSourceParameter:function(t){e.is(t)&&(this._specificSourceParameter=t)},getSpecificSourceParameter:function(){return this._specificSourceParameter},clear:function(){this._select_predicates=null,this._select_exclude_synthesis=null,this._additional_criteria=null,this._specificSourceParameter=null}})}),define("DS/SNInfraUX/SearchDebug",["UWA/Core","UWA/Class/Debug","DS/SNInfraUX/SearchSettings"],function(e,t,i){"use strict";return t.extend({_check_activated:!1,log:function(t){return!1===this._check_activated&&(this.setDebugMode(i.debugMode),this._check_activated=!0),this._parent(String.prototype.format.apply("{0}: {1}".format(e.is(this.uwaClassName,"string")?this.uwaClassName:"[UNKNOWN]",t),[].slice.call(arguments,1)))}})}),define("DS/SNInfraUX/utils/SNCompassUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Logger","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json"],function(e,t,i,r,s,n,a,o){"use strict";return t.singleton(i,{init:function(){},getApplicationsFromCompass:function(t,i){return new r(function(r,n){a.searchApplication({query:t,limit:e.is(i)?i:3,onComplete:function(e){s.info("List of application from compass >> "+e),r(e)},onFailure:function(e){s.error("Error from compass>>"+e),n(e)}})})},launchApplicationFormCompass:function(t){return new r(function(i,r){n.publish("launchApp",{appId:t},function(t){s.log(t),e.is(t)&&"COMPLETE"===t.response?i(o.get("AppLaunchSuccess")):r(o.get("AppLaunchFail"))})})},searchApplicationsInCompass:function(t){e.is(t)?n.publish("search",{query:t,onComplete:function(e){s.log(e)}}):s.log("Invalid query")}})}),define("DS/SNInfraUX/SearchPreferences",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","UWA/Promise","DS/i3DXCompass/Data"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(i,{preferences:{},_previousPrefOptionsValue:{},_tenantData:{},_tenantSpecificPreferences:["optionMode"],init:function(){s.groupCollapsed("SearchPreferences"),this._restoreDataFromLocalStorage(),s.groupEnd()},getItemPromise:function(t,i){if(s.groupCollapsed("SearchPreferences.getItemPromise"),s.log("Key:",t),!e.is(t,"string"))throw s.groupEnd(),new Error("Invalid input key"+t);let r=n.deferred();if(e.is(this._previousPrefOptionsValue[t]))s.log("Retrieving value from cache:",this._previousPrefOptionsValue[t].parsed),this._isTenantSpecificPreference(t)?r.resolve(this._tenantData&&this._tenantData[i]?this._tenantData[i]:{}):r.resolve(this._previousPrefOptionsValue[t].parsed);else{s.log("item not found in cache, trying to retrieve it from compass service");let e=this;this.getPreference({name:t,onComplete:function(n){s.log("Retrieval successful: ",n),e._previousPrefOptionsValue[t]={stringified:JSON.stringify(n&&n[i]?n[i]:null),parsed:n&&n[i]?n[i]:null},e._tenantData=n,r.resolve(n&&n[i]?n[i]:{})},onFailure:function(e){s.warn("fail to get data",e),r.reject()}})}return s.groupEnd(),r.promise},_restoreDataFromLocalStorage:function(){if(e.is(localStorage)){var t=this.getLocalStorageItem("searchPreferences");if(e.is(t))try{this.preferences=JSON.parse(t),s.log("preferences (from localStorage):",t)}catch(e){s.error("Error parsing searchPreferences:",e)}e.is(this.preferences)||(this.preferences={})}else s.warn("localStorage not supported !")},setItem:function(t,i){e.is(localStorage)?(this._checkUpdateToDo(),this.preferences[t]=e.clone(i)):s.warn("localStorage not supported !")},removeItem:function(t){e.is(localStorage)&&delete this.preferences[t]},setLocalStorageItem:function(e,t){"function"==typeof localStorage.setItem?localStorage.setItem(e,t):localStorage._setItem(e,t)},getLocalStorageItem:function(e){return"function"==typeof localStorage.getItem?localStorage.getItem(e):localStorage._getItem(e)},removeLocalStorageItem:function(e){"function"==typeof localStorage.removeItem?localStorage.removeItem(e):localStorage._removeItem(e)},_checkUpdateToDo:function(){if(!e.is(localStorage))return;let t=this.getLocalStorageItem("updateToDo");e.is(t)&&"true"===t&&(this._restoreDataFromLocalStorage(),this.removeLocalStorageItem("updateToDo"))},getItem:function(t){if(!e.is(localStorage))return;this._checkUpdateToDo();let i=this.preferences[t];if(!e.is(i))if(e.is(this.uiSettings))i=this.uiSettings[t];else{this.uiSettings={};var n=r.getSettingsToDisplayInUI();if(e.is(n,"array")&&n.length>0)for(var a=0,o=n.length;a<o;a++)e.is(n[a])&&e.is(n[a].optionID)&&e.is(n[a].optionDefaultValue)&&(this.uiSettings[n[a].optionID]=n[a].optionDefaultValue,e.is(r.getOption(n[a].optionID))&&r.getOption(n[a].optionID)!==n[a].optionDefaultValue&&(s.log("Default value for "+n[a].optionID+" in searchOptionsDisplayedInUI overloaded with value="+r.getOption(n[a].optionID)),this.uiSettings[n[a].optionID]=r.getOption(n[a].optionID)));i=this.uiSettings[t]}if(!e.is(i)){let s=r.getOption("SearchPreferencesDefault");e.is(s,"object")&&e.is(s[t])&&(i=s[t])}return i},commit:function(t){this._checkUpdateToDo(),this.setLocalStorageItem("searchPreferences",JSON.stringify(this.preferences));var i={};!0===r.getOption("newSearch19xFD02")&&!0===r.getOption("predefinedBetaUser")&&e.is(this.preferences.simple_search_experience)&&(i.simple_search_experience=this.preferences.simple_search_experience),i.revisionDisplayType=this.preferences.revisionDisplayType,i.find_in_this_tab_default=this.preferences.find_in_this_tab_default,this.setPreference({name:"3DSearchOptions",value:JSON.stringify(i),onComplete:t?t.onComplete:void 0,onFailure:t?t.onFailure:void 0})},setPreference:function(t){if(!e.is(t,"object")||!e.is(t.name,"string")||!e.is(t.value,"string"))throw s.error("Invalid arg in SearchPreferences.setPreference!",t),new Error("Invalid arg in SearchPreferences.setPreference!");var i=this;if("{}"===t.value||e.is(this._previousPrefOptionsValue,"object")&&e.is(this._previousPrefOptionsValue[t.name],"object")&&e.is(this._previousPrefOptionsValue[t.name].stringified,"string")&&this._previousPrefOptionsValue[t.name].stringified===t.value)e.is(t.onComplete,"function")&&t.onComplete();else{try{this._previousPrefOptionsValue[t.name]={},this._previousPrefOptionsValue[t.name].parsed=JSON.parse(t.value),this._previousPrefOptionsValue[t.name].stringified=t.value}catch(e){return void s.warn("Cannot parse this data")}if(e.is(a,"object")&&!e.is(a.setPreferencesUrl,"string")&&e.is(window.COMPASS_CONFIG,"object")&&e.is(COMPASS_CONFIG.userId,"string")&&a.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,passportUrl:"",proxyTicketUrl:""}),!e.is(a.setPreferencesUrl))return s.warn("No compass service to store preferences, using local storage instead"),void this.setItem(t.name,t.value);this._isTenantSpecificPreference(t.name)&&(this._tenantData[t.tenantId]=JSON.parse(t.value),t.value=JSON.stringify(this._tenantData));var r={url:a.setPreferencesUrl,urlParams:{name:t.name,value:t.value},onComplete:function(e){e&&0===e.code?(t&&t.onComplete&&t.onComplete(),i._isTenantSpecificPreference(t.name)&&(i.optionMode=JSON.parse(t.value))):(s.warn("Compass service reponding with unexpected answer, using local storage instead"),i.setItem(t.name,t.value),t&&t.onFailure&&t.onFailure())},onFailure:function(){s.warn("Failure when trying to use compass service to store preferences, using local storage instead"),i.setItem(t.name,t.value),t&&t.onFailure&&t.onFailure()}};a.request(r)}},getPreference:function(t){if(!e.is(t,"object")||!e.is(t.name,"string"))throw s.error("Invalid arg in SearchPreferences.getPreference!",t),new Error("Invalid arg in SearchPreferences.getPreference!");var i=this;if(e.is(a,"object")&&!e.is(a.getPreferencesUrl,"string")&&e.is(window.COMPASS_CONFIG,"object")&&a.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,passportUrl:"",proxyTicketUrl:""}),!e.is(a.getPreferencesUrl))return s.warn("No compass service to get preferences, using local storage instead"),void(t&&t.onComplete&&t.onComplete(this.getItem(t.name)));let n={url:a.getPreferencesUrl,urlParams:{name:t.name},onComplete:function(n){e.is(n)||(n={}),!0===r.getOption("newSearch19xFD02")&&!0===r.getOption("predefinedBetaUser")&&e.is(n.simple_search_experience)&&(i.preferences.simple_search_experience=n.simple_search_experience),e.is(n.find_in_this_tab_default)&&(i.preferences.find_in_this_tab_default=n.find_in_this_tab_default),e.is(n.revisionDisplayType)&&(i.preferences.revisionDisplayType=n.revisionDisplayType),s.log("preferences (from compass):",n),t&&t.onComplete&&t.onComplete(n)},onFailure:function(){s.warn("No compass service to get preferences, using local storage instead"),t&&t.onComplete&&t.onComplete(i.getItem(t.name))}};a.request(n)},_isTenantSpecificPreference:function(e){return this._tenantSpecificPreferences.indexOf(e)>=0}})}),define("DS/SNInfraUX/SearchLogin",["UWA/Core","UWA/Class","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger"],function(e,t,i,r,s,n){"use strict";return t.singleton({_loginPromises:{},_cacheLoginData:{},_serviceToSourceMapping:null,_serviceError:null,login:function(t){n.groupCollapsed("SearchLogin.login");var s=this,a="",o="";(e.is(t,"object")&&(e.is(t.tenantID)?(n.log("options.tenantID platformID : "+t.tenantID),a=t.tenantID):e.is(t.resources)&&(n.log("options.resources.getActiveTenant() platformID : "+t.resources.getActiveTenant()),a=t.resources.getActiveTenant()),e.is(t.fedSearchURL)?(n.log("options.fedSearchURL fedSearchURL : "+t.fedSearchURL),o=t.fedSearchURL):e.is(t.resources)&&(n.log("options.resources.getFedSearchUrl(platformID) : "+t.resources.getFedSearchUrl(a)),o=t.resources.getFedSearchUrl(a))),e.is(a,"string"))&&(this._loginPromises[a]||(this._loginPromises[a]=new r(function(r,c){s._cacheLoginData[a]=[];var l={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};n.log("fetch_options.data tenant : "+a),l.data={tenant:a},l.url=s._buildFedSearchLoginURL(o),n.log("fetch_options.url : "+l.url),l.onComplete=function(t){n.log("FedSearch login succcessful with platform : "+a);var i=e.is(t,"string")?t.length>0?JSON.parse(t):{}:t;if(e.is(i.infos)&&e.is(i.infos.sources,"array")){var o=i.infos.sources;s.updateServiceToSourceMapping(a,o),r(),n.groupEnd()}else n.error("/federated/login WS response is not in expected format"),c(),n.groupEnd()},l.onFailure=function(t,i){n.error("FedSearch login FAILED with platform : "+a,t,i),!s._serviceToSourceMapping&&(s._serviceToSourceMapping={}),!e.is(s._serviceToSourceMapping["3dspace"])&&(s._serviceToSourceMapping["3dspace"]="3DSpace"),!e.is(s._serviceToSourceMapping.swym)&&(s._serviceToSourceMapping.swym="3DSwym"),!e.is(s._serviceToSourceMapping.drive)&&(s._serviceToSourceMapping.drive="3DDrive"),!e.is(s._serviceToSourceMapping.dropbox)&&(s._serviceToSourceMapping.dropbox="3DDrive"),!e.is(s._serviceToSourceMapping.googledrive)&&(s._serviceToSourceMapping.googledrive="3DDrive"),!e.is(s._serviceToSourceMapping.onedrive)&&(s._serviceToSourceMapping.onedrive="3DDrive"),!e.is(s._serviceToSourceMapping.dashboard)&&(s._serviceToSourceMapping.dashboard="3DDashboard"),c()},e.is(t.resources)&&!0===t.resources.is_odt_source()?(n.warn("No action retrieved in ODT mode"),r(),n.groupEnd()):i.authenticatedRequest(l.url,l)})),this._loginPromises[a].then(()=>{t.onComplete.call(void 0,s._cacheLoginData[a]),n.groupEnd()},()=>{t.onFailure.call(void 0,s._cacheLoginData[a]),n.groupEnd()}))},getAvailableSources:function(e){return this._cacheLoginData[e]},getServiceFromSource:function(t){return e.is(this._serviceToSourceMapping)?this._serviceToSourceMapping[t]:void 0},getServiceErrorFromSource:function(t){return e.is(this._serviceError)?this._serviceError[t]:void 0},getDiscoveryURL:function(t,i){var r=void 0;if(e.is(this._cacheLoginData)){var s=this._cacheLoginData[t];if(e.is(s,"array"))for(var n=0;n<s.length;n++)i===s[n].name&&(r=s[n].FSearchAppDiscovery_url)}return r},_buildFedSearchLoginURL:function(e){return-1===e.lastIndexOf("/federated")&&(e+="/federated"),e+"/login"},updateServiceToSourceMapping:function(t,i){if(e.is(t,"string")&&0!==t.length&&e.is(i,"array")){if(e.is(this._cacheLoginData[t]))for(var r=0,a=i.length;r<a;r++){for(var o=!1,c=0,l=this._cacheLoginData[t].length;c<l;c++)e.is(this._cacheLoginData[t][c])&&e.is(i[r])&&this._cacheLoginData[t][c].name===i[r].name&&this._cacheLoginData[t][c].name&&(o=!0);!1===o&&this._cacheLoginData[t].push(i[r])}else this._cacheLoginData[t]=i;!this._serviceToSourceMapping&&(this._serviceToSourceMapping={}),!this._serviceError&&(this._serviceError={});for(var d=0;d<i.length;d++){var u=i[d];e.is(u,"object")&&e.is(u.name,"string")&&u.name.length>0&&e.is(u.service,"string")&&u.service.length>0&&(this._serviceToSourceMapping[u.name]=u.service),e.is(u,"object")&&e.is(u.name,"string")&&e.is(u.error)&&(this._serviceError[u.name]=u)}1===i.length&&e.is(i[0],"object")&&e.is(i[0].service,"string")&&i[0].service.length>0&&(s.options.search_settings.service=i[0].service)}else n.error("Bad arguments used in updateServiceToSourceMapping",t,i)}})}),define("DS/SNInfraUX/PlatformEnvServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Logger"],function(e,t,i,r,s){"use strict";return t.singleton(i,{_platformEnvServices:r.deferred(),_available_tenants:{},init:function(){},setEnvironments:function(t){if(this._platformEnvServices.resolve(),e.is(t,"object")&&e.is(t.available_tenants,"object"))Object.keys(t.available_tenants).forEach(i=>{e.is(this._available_tenants[i])?e.merge(this._available_tenants[i].sources,t.available_tenants[i].sources):this._available_tenants[i]=t.available_tenants[i]});else{let i=["cstorage","hpc","search","swym","tagger"];for(let r=0;r<i.length;r++){let s=i[r];if(e.is(t[s]))for(let i=0;i<t[s].length;i++){let r=t[s][i];e.is(this._available_tenants[r.id])||(this._available_tenants[r.id]={sources:{},displayName:r.displayName}),this._available_tenants[r.id].sources[s]={displayName:r.displayName,url:r.url},e.is(r.odt)&&(this._available_tenants[r.id].sources[s].odt=r.odt)}}}},getPlatformEnvServicesPromise:function(){return this._platformEnvServices.promise},getServiceURL:function(t,i){let r;return e.is(this._available_tenants)&&e.is(this._available_tenants[i])&&e.is(this._available_tenants[i].sources)&&e.is(this._available_tenants[i].sources[t])&&(r=this._available_tenants[i].sources[t].url),r},getAllTenants:function(){return this._available_tenants},getAvailableTenantsForSearch:function(){let t,i=[];for(let r in this._available_tenants)this._available_tenants.hasOwnProperty(r)&&(t=this._available_tenants[r],e.is(t)&&e.is(t.sources)&&e.is(t.sources.search)?i.push({tenantId:r,displayName:this._available_tenants[r].displayName}):s.warn("tenant "+r+" does not have search service available, so not listed in UI"));return i},tenantExists:function(t){return e.is(this._available_tenants[t])||"3DDashboard"===t},getTenantDisplayName:function(t){let i=void 0;return this.tenantExists(t)&&e.is(this._available_tenants[t].displayName)&&(i=this._available_tenants[t].displayName),i}})}),define("DS/SNInfraUX/PredicatesNLS",["DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchDebug","UWA/Core","UWA/Class","UWA/Class/Options","UWA/Promise","UWA/Class/Collection","UWA/Class/Model","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(e,t,i,r,s,n,a,o,c,l){"use strict";var d=c.extend({idAttribute:"uri"}),u=s.singleton(n,i,{uwaClassName:"DS/SNInfraUX/PredicatesNLS",_predicatesInfo:{},_callbacksInfo:{},_6wg_predicates:{},init:function(){this.setDebugMode(t.setDebugMode())},setResources:function(e){this.setOptions(e)},isLoaded:function(e){var t=!1,i=this._predicatesInfo[e];return r.is(i)&&r.is(i.status)&&"waiting"!==i.status&&(t=!0),t},loadVocabulary:function(t,i){this.log("loadVocabulary called for vocabId : "+t);var s=this.getOption("resources");if(r.is(s)){var n=this._predicatesInfo[t];if(r.is(n)){if(r.is(n.status))if("waiting"===n.status)this.log("Vocabulary : "+t+" is already requested to be loaded"),r.is(i,"function")&&(this._callbacksInfo.hasOwnProperty(t)||(this._callbacksInfo[t]=[]),this._callbacksInfo[t].push(i));else if(this.log("Vocabulary : "+t+" is already loaded"),r.is(i,"function")){var a={id:t,status:n.status};i(a)}}else{this._predicatesInfo[t]={status:"waiting",info:new o([],{model:d})};var c=this;s.PredicatesNLSNames(t,function(s){s.onComplete=function(s){var n;n=r.is(s,"string")?JSON.parse(s):s,e.log("Successfully loaded the vocabulary : "+t),c._predicatesInfo[t].status="success",r.is(n)&&r.is(n.vocabularyElementNLSInfo)&&c._predicatesInfo[t].info.add(n.vocabularyElementNLSInfo),c._sendCallbacks(i,{id:t,status:"success"})},s.onFailure=function(){e.log("FAILED to load the vocabulary : "+t),c._predicatesInfo[t].status="failed",c._sendCallbacks(i,{id:t,status:"failed"})},l.getVocabularyProperties(t,s)})}}else e.error("INVALID STATE: loadVocabulary is called before doing setResources on PredicatesNLS")},getVocabId:function(e){var t=e.match(/\/([^/]*)$/);if(t=null===t?e:t[1],r.is(t)){var i=t.split(":");if(r.is(i)&&2===i.length)return i[0]}},getNLSValueForPredicate:function(e){if(r.is(e,"array")){for(var t=0;t<e.length;t++)e[t]=this._getNLSValueForPredicateOne(e[t]);return e}return this._getNLSValueForPredicateOne(e)},_getNLSValueForPredicateOne:function(e){var t=e.match(/\/([^/]*)$/);t=null===t?e:t[1];var i=null;if(r.is(this._predicatesInfo)&&r.is(t)){var s=t.split(":");if(r.is(s)&&2===s.length){var n=this._predicatesInfo[s[0]];r.is(n)&&(i=n.info.get(t))}}return r.is(i)?i.get("nlsName"):t},_sendCallbacks:function(e,t){var i=this._callbacksInfo[t.id];r.is(i)?r.is(e,"function")&&i.unshift(e):(i=[],r.is(e,"function")&&i.push(e));for(var s=0;s<i.length;s++)i[s].call(void 0,t);this._callbacksInfo[t.id]=[]},_asyncCallToPredicatesWS:function(t,i){var s,n=this;return r.is(n.getOption("resources"))&&(s=n.getOption("resources").getActiveTenant()),n._6wg_predicates.hasOwnProperty(s)||(n._6wg_predicates[s]={classPredicates:{}}),t.indexOf("ds6wg:SavedSearch")>=0&&!r.is(n._6wg_predicates[s].classPredicates["ds6wg:SavedSearch"])&&(n._6wg_predicates[s].classPredicates={"ds6wg:SavedSearch":[{name:"Title",uri:"ds6w:label",nlsName:u.getNLSValueForPredicate("ds6w:label")},{name:"PLM_ExternalID",uri:"ds6w:identifier",nlsName:u.getNLSValueForPredicate("ds6w:identifier")},{name:"originated",uri:"ds6w:created",nlsName:u.getNLSValueForPredicate("ds6w:created")},{name:"modified",uri:"ds6w:modified",nlsName:u.getNLSValueForPredicate("ds6w:modified")},{name:"owner",uri:"ds6w:responsible",nlsName:u.getNLSValueForPredicate("ds6w:responsible")}]}),new a(function(a,c){r.is(t,"array")&&0!==t.length||c(new Error("No DS6WGTypeArray"));var u=[];for(let e=t.length-1;e>=0;e--)r.is(n._6wg_predicates[s].classPredicates[t[e]])&&u.push(t.splice(e,1)[0]);if(0===t.length){let e={classPredicates:[]};for(let t=0,i=u.length;t<i;t++)e.classPredicates.push({className:u[t],vocabularyPredicateInfo:n._6wg_predicates[s].classPredicates[u[t]]});a(e)}else{var p=t.join(","),h="Predicates",g="POST";r.is(i)&&r.is(i.service_name)&&(h=i.service_name),r.is(i)&&r.is(i.method)&&(g=i.method);var f={idService:h,method:g,data:p};n.getOption("resources").getServicewithRole(f,function(t){t.onComplete=function(t){if(n.log("GetRelevantPredicates succeeded"),r.is(i)&&r.is(i.forcetoresolve)&&!0===r.is(i.forcetoresolve))return a(t);let l=null;if(r.is(t)){l=t,r.is(l,"object")&&r.is(l.classPredicates,"array")||(e.error("Invalid response to Predicates WS"+l),c(new Error("Invalid response to Predicates WS")));let i=0,a=0;for(i=0,a=l.classPredicates.length;i<a;i++){var p=l.classPredicates[i].vocabularyPredicateInfo;if(n._6wg_predicates[s].classPredicates[l.classPredicates[i].className]=p,r.is(p)){r.is(n._predicatesInfo.ds6wg)||(n._predicatesInfo.ds6wg={status:"success",info:new o([],{model:d})});for(var h=0,g=p.length;h<g;h++)p[h].uri.startsWith("ds6wg:")&&n._predicatesInfo.ds6wg.info.add(p[h])}}}r.is(l)||(l={classPredicates:[]},e.warn("Strange response from _asyncCallToPredicatesWS"));for(let e=0,t=u.length;e<t;e++)l.classPredicates.push({className:u[e],vocabularyPredicateInfo:n._6wg_predicates[s].classPredicates[u[e]]});a(l)},t.onFailure=function(e,t){n.log("_asyncCallToPredicatesWS fails"),c(e,t)},l.getPropertiesForClass(p,t)})}})}});return u}),define("DS/SNInfraUX/SNAdvSearchCusto",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(r,i,{name:"DS_SNInfraUX_ANAdvSearchCusto",_thePromisePC:s.deferred(),_custo:{},_preferredTypeList:[],_easyAccessTypeList:[],_easyAccessTypeSource:{},_vocabularyElementNLSInfo:null,init:function(){},getCusto:function(e){return n.getTenantSettings(e)},isCustoEnabled:function(){return!0},_getAdvancedSearchOptions:function(e){var t=n.getOption("advanced_search",{tenant:e});return this.loadCusto(t,e),t},getDefaultSelectedSource:function(t){var i=this._getAdvancedSearchOptions(t);if(e.is(i))return i.default_datasource},getExcludedDataSources:function(t){var i=this._getAdvancedSearchOptions(t);if(e.is(i))return i.excluded_dataSource},getExcludedTypes:function(t,i){var r=n.getOption("topbar_search_banned_list",{tenant:t});if(e.is(r)&&e.is(r.types))return r.types[i]},loadCusto:function(t,i){var r=this;if(!this._custo[i]&&e.is(t)){this._custo[i]={};var s=this._custo[i];e.is(t.default_datasource,"string")&&(s.default_datasource=t.default_datasource),e.is(t.excluded_dataSource,"array")&&(s.excluded_dataSource=t.excluded_dataSource),e.is(t.exclusive_taxonomies,"boolean")&&(s._exclusive_taxonomies=t.exclusive_taxonomies);var n=t["ds6w:type"];e.is(n)&&Object.keys(n).forEach(function(t){var i=n[t];if(e.is(i,"array")){var a={selectedByDefault:[],preferredPosition:{}};s[t]=a;for(var o=0;o<i.length;o++){var c=i[o],l=c.uri;if(e.is(l)){r._preferredTypeList.push(l),a.preferredPosition[l]=o,!0===c.selectByDefault&&a.selectedByDefault.push(l),s[l]={},!0===c.easyTypeAcess&&(r._easyAccessTypeList.push(l),r._easyAccessTypeSource[l]=t);var d=c.interfaces;if(e.is(d,"array")){var u={preferredPosition:{},selectedByDefault:[]};s[l].interfaces=u;for(let t=0;t<d.length;t++){var p=d[t];e.is(p.name)&&(u.preferredPosition[p.name]=t,!0===p.selectByDefault&&u.selectedByDefault.push(p.name))}}var h=c.predicates;if(e.is(h,"array")){var g={preferredPosition:{}};s[l].predicates=g;for(let e=0;e<h.length;e++){var f=h[e];f.uri&&(g.preferredPosition[f.uri]=e)}}var y=c.excluded_predicates,_=[];if(e.is(y,"array")){for(let e=0;e<y.length;e++)_.push(y[e].uri);s[l].excluded_predicates=_}}}}})}},getAllPreferredTypes:function(){return null},hasPreferredTypesForSource:function(){return null},getTypesSelectedByDefault:function(){return null},getTypePreferredPosition:function(t,i){var r=this._getAdvancedSearchOptions(t);if(e.is(r)){var s=r["ds6w:type"];if(e.is(s)&&e.is(s[i])){for(var n=s[i],a={},o=0,c=0;c<n.length;c++)!0===n[c].easyTypeAcess&&(a[n[c].uri]=o++);return a}}},getInterfacesSelectedByDefault:function(e){var t=this._custo[e];if(t&&t.interfaces)return t.interfaces.selectedByDefault},getPredicatePreferredPosition:function(t,i){if(e.is(i)&&e.is(this._custo[i])){var r=this._custo[i][t];if(r&&r.predicates)return r.predicates.preferredPosition}},getExcludedPredicatesForType:function(t,i){if(e.is(i)&&e.is(this._custo[i])){var r=this._custo[i][t];if(r&&r.excluded_predicates)return r.excluded_predicates}},getInterfacePreferredPosition:function(){return null},getEasyAccessTypeList:function(){return this._easyAccessTypeList},getSelectedTypeSource:function(e){return this._easyAccessTypeSource[e]},isExclusiveTaxonomies:function(t){if(e.is(t)&&e.is(this._custo[t]))return this._custo[t]._exclusive_taxonomies},getCustoTypeListNLSNames:function(t){if(e.is(t)){var i=this;if(null===this._vocabularyElementNLSInfo){var r=i.getAllPreferredTypes();a._asyncCallToPredicatesWS(r,{service_name:"ElementsNLSNames",method:"POST",forcetoresolve:!0}).then(function(r){var s=null;e.is(r)&&r.length>0&&(s=JSON.parse(r),e.is(s)&&e.is(s.vocabularyElementNLSInfo)&&e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&(i._vocabularyElementNLSInfo={},s.vocabularyElementNLSInfo.forEach(function(e){var t=e.uri;i._vocabularyElementNLSInfo[t]=e}),t.onComplete.call(this,i._vocabularyElementNLSInfo)))},function(){e.is(t)&&e.is(t.onFailure)&&e.is(t.onFailure,"function")&&t.onFailure.call(this)})}else e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(this,i._vocabularyElementNLSInfo)}}})}),define("DS/SNInfraUX/utils/SNPreferenceUtil",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger"],function(e,t,i,r){"use strict";return t.singleton(i,{_unitPreferenceMap:null,init:function(){this._unitPreferenceMap=new Map},setUserUnitPreference:function(t){let i=this;e.is(t)&&e.is(t.displayUnits,"array")&&t.displayUnits.forEach((e,t)=>{i._unitPreferenceMap.set(e.dimension.toUpperCase(),e)})},getPreferenceUnitForDimension:function(e){return this._unitPreferenceMap.get(e.toUpperCase())}})}),define("DS/SNInfraUX/ServiceDelegationLoader",["UWA/Core","UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,i,r,s,n,a,o){"use strict";return t.singleton({_loaderPromises:{},_cacheServiceDelegation:{},_discoverPromises:{},_cacheDiscovery:{},load:function(t){var r=this;if(e.is(t,"object")&&e.is(t.serviceID,"string")){var a=this._loaderPromises[t.serviceID];return a||(a=new i(function(i,a){r._cacheServiceDelegation[t.serviceID]=null;var o,c,l=(e.is(t.servicesData)?t.servicesData:n.getOption("servicesData"))[t.serviceID];e.is(l,"object")?(o=l.module,c=l.relativePath):e.is(l,"string")&&(o=l,c="/webapps"),e.is(o,"string")?require([o],function(e){r._cacheServiceDelegation[t.serviceID]=e,i(r._cacheServiceDelegation[t.serviceID])},function(e){s.warn("Cannot load service delegation"+e.requireModules),r.loadModuleFromService(o,{serviceID:t.serviceID,platformID:t.platformID,relativePath:c}).then(function(e){r._cacheServiceDelegation[t.serviceID]=e,i(r._cacheServiceDelegation[t.serviceID])},function(e){a(e)})}):a("Service delegation not registered for "+t.serviceID)}),this._loaderPromises[t.serviceID]=a),a}},loadServiceDelegations:function(e){var t=this,r=[];return e.services.forEach(function(i){var s=t.load({serviceID:i,platformID:e.platform});r.push(s)}),i.allSettled(r)},getDelegation:function(e){return this._cacheServiceDelegation[e.serviceID]},discover:function(t){if(e.is(t,"object")&&e.is(t.platformID,"string")&&e.is(t.sourceID)){var n=this,o=a.getDiscoveryURL(t.platformID,t.sourceID);this._discoverPromises[t.platformID]||(this._discoverPromises[t.platformID]={},this._cacheDiscovery[t.platformID]={});var c=this._discoverPromises[t.platformID][t.sourceID];return c||(c=new i(function(i,a){n._cacheDiscovery[t.platformID][t.sourceID]=null;var c={method:"GET",headers:{Accept:"application/json"}};c.data={tenant:t.platformID},c.url=o,c.onComplete=function(r){s.log("discovery call succcessful for "+t.sourceID+" for tenant : "+t.platformID);var o=e.is(r,"string")?r.length>0?JSON.parse(r):{}:r;e.is(o,"object")?(n._cacheDiscovery[t.platformID][t.sourceID]=o,i(n._cacheDiscovery[t.platformID][t.sourceID])):(s.error("discovery WS response is not in expected format"),a())},c.onFailure=function(e,i){s.log("discovery call FAILED for "+t.sourceID+" for tenant : "+t.platformID,e,i),a(new Error("discovery call FAILED"))},r.authenticatedRequest(c.url,c)}),this._discoverPromises[t.platformID][t.sourceID]=c),c}},getRealtivePath:function(t){var i=n.getOption("servicesData")[t.serviceID];return e.is(i,"object")?i.relativePath:e.is(i,"string")?"/webapps":void 0},loadModuleFromService:function(t,r){let n=this;return new i(function(i,a){requirejs.undef(t);let c=e.is(r.relativePath)?r.relativePath:n.getRealtivePath({serviceID:r.serviceID});var l=t.split("/");if(e.is(l,"array")&&l.length>2){var d=function(e){var r=l[0]+"/"+l[1],n=e+c;n+="/"+l[1];var o={};o[r]=n,require.config({paths:o}),require([t],function(e){i(e)},function(e){s.warn("Cannot load service delegation "+e.requireModules),a("Failed to load module. Error:"+e.requireModules)})};e.is(r.serviceURL,"string")?d(r.serviceURL):o.getServiceUrl({serviceName:r.serviceID,platformId:r.platformID,onComplete:function(e){d(e)},onFailure:function(){a("Failed to get the service URL for given service with serviceID : "+r.serviceID)}})}else a("AMD module name is not in a good format:"+serviceDelegationModule)})}})}),define("DS/SNInfraUX/SNPLMDictionary",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/Logger"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(i,r,{_dictionaryPromise:null,_dimensions:{},_mksUnitName:{},_mksUnit:{},init:function(){},_createDictionaryPromise:function(){if(null===this._dictionaryPromise){var t=this.getOption("resources");if(e.is(t)){var i=this;this._dictionaryPromise=new n(function(r){var n=t.getFetchOptions({service_name:"listDimensions"});n.onComplete=function(t){var s=(e.is(t,"string")?JSON.parse(t):t).results;if(e.is(s))for(var n=0;n<s.length;n++){var a=s[n];i._dimensions[a.Name]=a;var o=a.MKSUnit;i._mksUnitName[a.Name]=o;var c=a.Units.filter(function(e){return e.Name===o});c.length>0&&(i._mksUnit[a]=c[0])}r.call()},n.onFailure=function(){a.log("FAILED to load Dimensions "),r.call()},s.authenticatedRequest(n.url,n)})}}},setResources:function(e){this.setOptions(e)},loadDictionary:function(t){return this._createDictionaryPromise(),e.is(t)&&this._dictionaryPromise.then(t),this._dictionaryPromise},getMKSNLSForDimension:function(t){var i=this._dimensions[t];if(e.is(i)){var r=i.MKSUnit,s=i.Units.filter(function(e){return e.Name===r});if(s.length>0)return s[0].NLSName}return""},getUnitNLSForDimension:function(t,i){var r=this._dimensions[t];if(e.is(r)){var s=r.Units.filter(function(e){return e.Name===i});if(s.length>0)return s[0].NLSName}return""},getMKSNLSLableNameForDimension:function(t){var i=this._dimensions[t];if(e.is(i)){var r=i.MKSUnit,s=i.Units.filter(function(e){return e.Name===r});if(s.length>0)return s[0].label}return""},getMKSNLSNameForDimension:function(t){var i=this._dimensions[t];if(e.is(i)){var r=i.MKSUnit,s=i.Units.filter(function(e){return e.Name===r});if(s.length>0)return s[0].Name}return""},loadConvertedMKSValues:function(t,i){var r=this.getOption("resources");if(!e.is(r))throw new Error("INVALID STATE: loadConvertedMKSValues is called before doing setResources");var n=r.getFetchOptions({service_name:"getConvertedMKSValues",service_data:t});n.onComplete=function(t){var r=e.is(t,"string")?JSON.parse(t):t;if(e.is(i,"function")){var s=r.Response;i(s)}},n.onFailure=function(e,t){a.log("Failure loaded the converted MKS values for : "+t),i([])},s.authenticatedRequest(n.url,n)},getMKSUnitNameForDimensionName:function(e){return this._mksUnitName[e]}})}),define("DS/SNInfraUX/SearchControlCenterFetchService",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","text!DS/SNInfraUX/assets/SearchcontrolCenter_TagRelationship.json","DS/SNInfraUX/Logger","DS/SNInfraUX/PlatformEnvServices"],function(e,t,i,r,s,n,a){"use strict";var o={_searchControlCenterSettingsJSONFromDB:{},_tenantObjects:{},_tenantPromise:{},getTagRelationshipDefaultSettings:function(){let t={},i={},r=[],n=[],a=JSON.parse(s);if(e.is(a)&&a.hasOwnProperty("Predicates_Default_AND")&&e.is(a.Predicates_Default_AND,"array"))for(let t=0;t<a.Predicates_Default_AND.length;t++){let i={},s=a.Predicates_Default_AND[t];e.is(s)&&(i.uri=s,i.operator="AND",r.push(i))}if(e.is(a)&&a.hasOwnProperty("Predicates_Irrelevant_AND")&&e.is(a.Predicates_Irrelevant_AND,"array"))for(let t=0;t<a.Predicates_Irrelevant_AND.length;t++){let i={},s=a.Predicates_Irrelevant_AND[t];e.is(s)&&(n.push(s),i.uri=s,i.operator="OR",r.push(i))}return i.irrelevantANDPredicates=n,t.tagRelationship_IrrelevantOpert=i,t.tagRelationship_predicates=r,t.activate_tag_relationship=!0,t},getAppWisePredicates:function(i,r){var s,n={},a="text!DS/SearchControlCenter/assets/DefaultPreferredTags/SCCPreferredTags_"+i+".json";return new t((t,c)=>{if(s=e.is(o._searchControlCenterSettingsJSONFromDB,"string")?JSON.parse(o._searchControlCenterSettingsJSONFromDB):o._searchControlCenterSettingsJSONFromDB,e.is(s)&&s.hasOwnProperty("attribute_custo")){var l=!1,d=s.attribute_custo;if(e.is(d)&&d.hasOwnProperty("context_apps_predicates")&&!r&&!0===d.attributes_display){var u=d.context_apps_predicates;if(e.is(u,"array"))for(var p=0;p<u.length;p++){var h=u[p],g=Object.keys(h);i===g[0]&&(n=h[i],l=!0,t(n))}}}l||require([a],i=>{let r=JSON.parse(i);if(r.hasOwnProperty("SCCPreferredTags")){var s=r.SCCPreferredTags,a=s.preferredTags;if(a.hasOwnProperty("predicates")){let t=a.predicates;if(e.is(t,"array")){let e=[];for(var o=0;o<t.length;o++)e.push(t[o]);n.preferred_predicates=e}}if(s.hasOwnProperty("ExcludedTags")){var c=s.ExcludedTags;if(c.hasOwnProperty("predicates")){let t=c.predicates;if(e.is(t,"array")){let e=[];for(o=0;o<t.length;o++)e.push(t[o]);n.excluded_predicates=e}}}}t(n)},function(){c()})})},getSearchSettings:function(i){var r=null,s=null;return e.is(i.tenantID)&&(r=i.tenantID),e.is(i.key)&&(s=i.key),this._tenantPromise[r]||(this._tenantPromise[r]=t.deferred(),this.loadSearchSettings(s,r)),this._tenantPromise[r].promise},transalateToSearchFormat:function(t){var i={},r=[],s=[],n=!0,a=localStorage.getItem("TagNavigator-simplifiedTagger");e.is(a)&&"true"===a&&(n=!0);var c=o._searchControlCenterSettingsJSONFromDB;if(e.is(t,"string"))e.is(c)&&"SCC_UI"===t&&(i=c);else if(e.is(c)&&!e.is(t)){if(Object.keys(c).length>0){var l,d,u,p,h,g,f,y,_,S,v,m,D,I,C,w,M=!1;if(c.hasOwnProperty("search_settings")&&(l=c.search_settings),c.hasOwnProperty("result_categories")&&(d=c.result_categories),c.hasOwnProperty("search_synonyms")&&(u=c.search_synonyms),c.hasOwnProperty("tagRelationships")&&(h=c.tagRelationships),c.hasOwnProperty("tagColorization")&&(p=c.tagColorization),c.hasOwnProperty("controlledVocabulary")&&(v=c.controlledVocabulary),c.hasOwnProperty("enterprise_ontology")&&(m=c.enterprise_ontology),c.hasOwnProperty("companyTagsSearchSuggest")&&(D=c.companyTagsSearchSuggest),c.hasOwnProperty("controlledVocabMode")&&(I=c.controlledVocabMode),c.hasOwnProperty("current_enterprise_ontology_title")&&(C=c.current_enterprise_ontology_title),c.hasOwnProperty("enterprise_ontology_history")&&(w=c.enterprise_ontology_history),c.hasOwnProperty("hierarchical_predicates")&&(S=c.hierarchical_predicates),c.hasOwnProperty("type_custo")&&(g=c.type_custo),c.hasOwnProperty("attribute_custo")&&(f=c.attribute_custo),c.hasOwnProperty("column_custo")&&(y=c.column_custo),c.hasOwnProperty("results_attributes_display_customization")&&(_=c.results_attributes_display_customization),e.is(l)&&e.is(g)){var b={},A={},O=[];if(g.hasOwnProperty("SEARCH_INSTANCES")){var P=g.SEARCH_INSTANCES;l.SEARCH_INSTANCES=P}if(g.hasOwnProperty("excluded_types")&&!0===g.type_display){for(var T=g.excluded_types,N=0;N<T.length;N++){let e=T[N].source,t=T[N].uri;A.hasOwnProperty(e)?(O=A[e]).push(t):(O.push(t),A[e]=O)}b.types=A}l.hasOwnProperty("simple_search_experience")&&delete l.simple_search_experience,l.topbar_search_banned_list=b,i.search_settings=l}var E={};if(e.is(g)&&e.is(f)){var U=!0;if(g.hasOwnProperty("default_datasourceandtype")){var x=g.default_datasourceandtype;x.length>0&&(E.default_datasource=x[0].source)}if(f.hasOwnProperty("ds6w:type")){var F={},R=f["ds6w:type"];if(e.is(R,"array"))for(var L=0;L<R.length;L++){let e={},t=R[L].source;if("AllDataSourcesandTypes"===t&&!0===f.attributes_display)f.hasOwnProperty("extend_to_widgets")&&(M=f.extend_to_widgets),U=!1,r=R[L].predicates,s=R[L].excluded_predicates;else if("AllDataSourcesandTypes"!==t&&!0===g.type_display)if(e.uri=R[L].uri,e.predicates=R[L].predicates,e.excluded_predicates=R[L].excluded_predicates,F.hasOwnProperty(t)){F[t].push(e)}else{var j=[];j.push(e),F[t]=j}}E["ds6w:type"]=F}if(f.hasOwnProperty("ds6w:type")&&!0!==U||(n&&r.push({uri:"computedCountryInfo"}),r.push({uri:"ds6w:dataSource"}),r.push({uri:"ds6w:type"}),n||r.push({uri:"ds6w:category"}),r.push({uri:"ds6w:modified"}),n&&r.push({uri:"ds6w:created"}),r.push({uri:"ds6w:lastModifiedBy"}),r.push({uri:"ds6w:responsible"})),g.hasOwnProperty("easyTypeAccess")&&!0===g.type_display)for(var W=g.easyTypeAccess,k=0;k<W.length;k++){var V=W[k],X=V.source;let t=V.uri;if(E.hasOwnProperty("ds6w:type")){var H=E["ds6w:type"];if(e.is(H)&&H.hasOwnProperty(X)){var q=H[X];if(e.is(q,"array")){for(var B=-1,Q=0;Q<q.length;Q++){let e=q[Q];t===e.uri&&(e.easyTypeAcess=!0,B=Q)}if(-1===B){var J={};J.uri=t,J.easyTypeAcess=!0,q.push(J)}else q.push(q.splice(B,1)[0])}}else{var Y={},z=[];Y.uri=t,Y.easyTypeAcess=!0,z.push(Y),H[X]=z}}else{var K={},G={},$=[];G.uri=t,G.easyTypeAcess=!0,$.push(G),K[X]=$,E["ds6w:type"]=K}}}e.is(E)&&i.hasOwnProperty("search_settings")&&(i.search_settings.advanced_search=E),e.is(d)&&i.hasOwnProperty("search_settings")&&(i.search_settings.result_categories=d),e.is(u)&&i.hasOwnProperty("search_settings")&&(i.search_settings.search_synonyms=u),e.is(p)&&i.hasOwnProperty("search_settings")&&(i.search_settings.tagColorization=p),e.is(v)&&i.hasOwnProperty("search_settings")&&(i.search_settings.controlledVocabulary=v),e.is(m)&&i.hasOwnProperty("search_settings")&&(i.search_settings.enterprise_ontology=m),e.is(C)&&i.hasOwnProperty("search_settings")&&(i.search_settings.current_enterprise_ontology_title=C),e.is(w)&&i.hasOwnProperty("search_settings")&&(i.search_settings.enterprise_ontology_history=w),e.is(D)&&i.hasOwnProperty("search_settings")&&(i.search_settings.companyTagsSearchSuggest=D),e.is(I)&&i.hasOwnProperty("search_settings")&&(i.search_settings.controlledVocabMode=I),e.is(h)&&i.hasOwnProperty("search_settings")&&(i.search_settings.tagRelationships=h),e.is(S)&&i.hasOwnProperty("search_settings")&&(i.search_settings.hierarchical_predicates=S),e.is(y)&&i.hasOwnProperty("search_settings")&&(i.search_settings.column_custo=y),e.is(_)&&i.hasOwnProperty("search_settings")&&(i.search_settings.results_attributes_display_customization=_)}}if(e.is(r,"array")||e.is(s,"array")){var Z={extendToApplicablewidgets:M};if(e.is(r,"array"))for(var ee=0;ee<r.length;ee++){var te=!1;"ds6w:type"!==r[ee].uri&&"ds6w:dataSource"!==r[ee].uri&&"ds6w:project"!==r[ee].uri&&"ds6w:community"!==r[ee].uri&&"computedCountryInfo"!==r[ee].uri||(te=!0);var ie={relevant:!0,expanded:te,weight:100-ee};Z[r[ee].uri]=ie}if(n||(Z["ds6w:who"]={relevant:!0,expanded:!0,weight:7},Z["ds6w:when"]={relevant:!0,expanded:!0,weight:6},Z["ds6w:what"]={relevant:!0,expanded:!0,weight:5},Z["ds6w:where"]={relevant:!0,expanded:!0,weight:4},Z["ds6w:why"]={relevant:!0,expanded:!0,weight:3},Z["ds6w:how"]={relevant:!0,expanded:!0,weight:2}),e.is(s,"array"))for(var re=0;re<s.length;re++){Z[s[re].uri]={relevant:!0,expanded:!1,weight:-1}}i.relevant_tags=Z}return e.is(f)&&f.hasOwnProperty("context_apps_predicates")&&(i.context_apps_predicates=f.context_apps_predicates),i},setResourceMgt:function(t){e.is(t,"object")&&t.hasOwnProperty("available_tenants")&&(o._tenantObjects=t.available_tenants)},get3DSpaceURL:function(e){return a.getServiceURL("cstorage",e)},loadSearchSettings:function(t,s){var a=t;r.getServiceUrl({serviceName:"3DSpace",platformId:s,onComplete:function(t){if(e.is(t,"string")){o.getURL=t+"/resources/SNAPI/infra_services/searchsettings?tenant="+s;let r={timeout:5e4,method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(t){var i=e.is(t,"string")?JSON.parse(t):t;require(["DS/SNInfraUX/SearchSettings"],function(e){(e.getOption("ODTLogs")||e.getOption("ODTLogs-SCCSettings"))&&n.warn("ODTLogs-SCCSettings:"+JSON.stringify(i))}),o._searchControlCenterSettingsJSONFromDB=i;var r=o.transalateToSearchFormat(a);e.is(r)&&o._tenantPromise[s].resolve(r)},onFailure:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)},onTimeout:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)}};i.authenticatedRequest(o.getURL,r)}else if(e.is(a))n.log("getServiceUrl was success, but URL is empty, ISSUE !!"),o._tenantPromise[s].reject();else{let t=o.get3DSpaceURL(s);if(e.is(t)){o.getURL=t+"/resources/SNAPI/infra_services/searchsettings?tenant="+s;let r={timeout:5e4,method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(t){var i=e.is(t,"string")?JSON.parse(t):t;o._searchControlCenterSettingsJSONFromDB=i;var r=o.transalateToSearchFormat(a);e.is(r)&&o._tenantPromise[s].resolve(r)},onFailure:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)},onTimeout:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)}};i.authenticatedRequest(o.getURL,r)}else n.log("getServiceUrl - By-pass URL is empty, ISSUE !!"),o._tenantPromise[s].reject()}},onFailure:function(t){if(e.is(a))n.error("URL building fails inside SearchControlCenterFetchService!!"),o._tenantPromise[s].reject(t);else{let r=o.get3DSpaceURL(s);if(e.is(r)){o.getURL=r+"/resources/SNAPI/infra_services/searchsettings?tenant="+s;let c={timeout:5e4,method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(t){var i=e.is(t,"string")?JSON.parse(t):t;o._searchControlCenterSettingsJSONFromDB=i;var r=o.transalateToSearchFormat(a);e.is(r)&&o._tenantPromise[s].resolve(r)},onFailure:function(e){n.error("Error Response from server :: "+e),o._tenantPromise[s].reject(t)},onTimeout:function(e){n.error("Time Out Response from server :: "+e),o._tenantPromise[s].reject(t)}};i.authenticatedRequest(o.getURL,c)}else n.error("URL building fails inside SearchControlCenterFetchService also By-pass URL is empty, ISSUE !!"),o._tenantPromise[s].reject()}}})}};return o}),define("DS/SNInfraUX/PredefinedQueries",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/Logger"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(i,r,{_PQDictionary:{},_pqFetchPC:n.deferred(),_PQs:null,_PQNLS:null,init:function(){},setResources:function(e){this.setOptions({resources:e})},fetchPQsFromServer:function(t){t&&this.setResources(t);var i=this;if(!i._pqFetchInitiated){let o=this.getOption("resources");if(!e.is(o))return a.error("INVALID STATE: getPQs is called before doing setResources on PredefinedQueries"),null;var r=o.get3DSpaceUrl();if(void 0===r&&t.predefinedQuerySCC&&(r=t.spaceURL),e.is(r,"string")&&r.length>0){var n=o.getFetchOptions({service_name:"loadPQData"});n.onComplete=function(t){var r;i._pqFetchInitiated=!0;var s=(r=e.is(t,"string")?JSON.parse(t):t).pqlist;if(e.is(r.custom)){for(var n=r.custom,a=0,o=n.PQ.length;a<o;a++){n.PQ[a].custom=!0}i.mergeRecursive(s,r.custom)}e.is(s)&&(i._PQs=s,i.loadPQDictionary(s));var c=r.nls;e.is(r.customnls)&&i.mergeRecursive(c,r.customnls),i._PQNLS=r.nls,i._pqFetchPC.resolve()},n.onFailure=function(){a.log("FAILED to load PQ data "),i._pqFetchPC.resolve()},e.is(n.url)?(t.predefinedQuerySCC&&e.is(r,"string")&&r.length>0&&(n.url=r+n.url.split("undefined")[1]),s.authenticatedRequest(n.url,n)):(a.warn("3DSpace URL not found, PQs are not fetched.."),i._pqFetchPC.resolve())}else a.warn("3DSpace URL not found, PQs are not fetched.."),i._pqFetchPC.resolve()}return this._pqFetchPC.promise},mergeRecursive:function(t,i){for(var r in i)i.hasOwnProperty(r)&&(e.is(t[r],"array")?t[r]=t[r].concat(i[r]):e.is(t[r],"object")&&e.is(i[r],"object")?this.mergeRecursive(t[r],i[r]):t[r]||(t[r]=i[r]))},getPQFetchPromise:function(){return this._pqFetchPC.promise},loadPQDictionary:function(t){var i=void 0;if(e.is(t))for(var r=0;r<t.PQ.length;r++){var s=t.PQ[r].abbreviations;if(e.is(s))for(var n=s.split(","),a=0;a<n.length;a++){var o=n[a],c=o.toLowerCase();e.is(t.PQ[r].sort_order)&&1===(i=t.PQ[r].sort_order).length&&(i=i[0]);var l={pqPrefix:o,value:t.PQ[r].value,pqName:n[n.length-1],pqid:t.PQ[r].pqid,appData:t.PQ[r].appData,sort_order:i};this._PQDictionary[c]=l}}},isAPQAbbrevation:function(e){var t=e.toString().toLowerCase();return"type"!==t&&t in this._PQDictionary},isAPQSearch:function(t){var i=null;if(e.is(t)){var r=t.match(/[\s\b]*\w+:/g);if(e.is(r))for(var s=0;s<r.length;s++){var n=r[s].match(/\w+/g);if(this.isAPQAbbrevation(n)){i=n;break}}}return i},isAPrefixedPQSearch:function(t){let i=null;return e.is(t)&&(/^3dexp/.test(t)&&(i=t.substring(5)),/^\(3dexp/.test(t)&&(i=t.substring(6).slice(0,-1)),/^\( 3dexp/.test(t)&&(i=t.substring(7).slice(0,-1))),null!==i?this.isAPQSearch(i):null},getSortOrder:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t].sort_order},getPQPrefix:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t].pqPrefix},getPQName:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t].pqName},getPQs:function(){return this._PQs},getPQNLS:function(){return this._PQNLS},getPQObjFromPQPrefix:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t]}})}),define("DS/SNInfraUX/SearchVersioning",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger"],function(e,t,i,r){"use strict";let s=new Set;return t.singleton(i,{_SUPPORTED_LEVELS:{R2024x:["FD02","FD01"],R2023x:["FD03","FD02","FD01"],R2022x:["FD04","FD03","FD02","FD01","GA","BETA2","BETA1"],R2021x:["FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA","BETA2","BETA1"],R2020x:["FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA","BETA2","BETA1"],R2019x:["FD14","FD13","FD12","FD11","FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA","BETA3","BETA2","BETA1"],R2018x:["FD15","FD14","FD13","FD12","FD11","FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA"],R2017x:["FD15","FD14","FD13","FD12","FD11","FD10","FD09"],R2016x:["FD16","FD15","FD14"]},init:function(){r.group("Info from SearchVersioning"),r.info("code level:"+this.getCurrentVersion()),r.info("dsVersion:"+window.dsVersion),r.groupEnd()},isActiveWithCurrentVersion:function(t){e.is(t,"array")||(t=[t]);var i=this.getCurrentRelease(),r=[],s=0,n=t.length;for(s=0,n=t.length;s<n;s++)r.push(Object.keys(t[s])[0]);if(r.sort(),i>r[r.length-1])return!0;for(s=0,n=t.length;s<n;s++)if(this._SUPPORTED_LEVELS[i].indexOf(t[s][i])>-1)return!0;return!1},getCurrentBuildLevel:function(){return this._SUPPORTED_LEVELS[Object.keys(this._SUPPORTED_LEVELS)[0]][0]},getCurrentVersion:function(){var e=this._SUPPORTED_LEVELS[Object.keys(this._SUPPORTED_LEVELS)[0]];return Object.keys(this._SUPPORTED_LEVELS)[0]+e[0]},getCurrentRelease:function(){return Object.keys(this._SUPPORTED_LEVELS)[0]},addHFTracesInConsole:function(e){if(!s.has(e)){s.add(e),r.group("Info from SearchVersioning"),r.info("3DSearch code level:"+this.getCurrentVersion()),r.info("dsVersion:"+window.dsVersion),r.info("3DSearch HFs:");for(let e of s)r.info("  "+e);r.groupEnd()}}})}),define("DS/SNInfraUX/SearchUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Data","UWA/Element","UWA/Utils/Client","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/ServiceDelegationLoader","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchVersioning","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","text!DS/SNInfraUX/assets/SearchColumnCustoAdmin.json","DS/SNInfraUX/Logger","text!DS/SNInfraUX/assets/SourceToPredicateMapping.json","DS/SNInfraUX/tracker/SearchTrackerApi","DS/SNInfraUX/SearchLogin","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json"],function(e,t,i,r,s,n,a,o,c,l,d,u,p,h,g,f,y,_,S,v){"use strict";var m=t.singleton(i,{_sessionUserId:null,_helper_collections:{},_searchViewPromise:null,_searchReadyPromise:null,_autocompletePromise:null,_securityContextPromise:null,_securityContext3DSpacePromise:null,_activeDataSourcePromise:null,_powerByInitPromise:null,_active_dataSource:[],_chosen_dataSource:[],_customerConfigPromise:null,trackerData:{timeData:[],searchData:[],search:{selectItem:!1,previewItem:!1,openItem:!1,indexItem:null,scenario:null,firstSearch:!0}},SEARCH_APP_ID:"X3DSEAR_AP",bIsPublicUser:!1,SEARCH_APP_ID_PUBLIC:"X3PSEAR_AP",TRANSIENT_WIDGET_HELPER_ID:"transient_helper_collection",TAGGERPROXY_CONTEXTID_WEB_IN_WIN:"Universal_SearchCtx",_mappingURIPredicate:{},SearchTypeEnum:{ADVANCED_SEARCH:"#advancedSearch",MY_CONTENT:"#myContent",MY_RECENT_CONTENT:"#myRecentContent",SIMILAR_SEARCH:"#similarity",SEARCH_IN:"#searchIn",SEARCH:"#search",FAVORITE_SEARCH:"#favoriteSearches"},widgetLaunchMode:{TOPBAR_SEARCH:"from_topbar_search",COMPASS_PINNED:"from_compass_pinned",COMPASS_TRANSIENT:"from_compass_transient",PINNED:"pinned_widget",INCONTEXT_TRANSIENT:"in_context_transient"},HelperCollectionStatus:{SEARCH_IN_PROGRESS:"search_in_progress",SEARCH_SUCCEEDED:"search_succeeded",SEARCH_FAILED:"search_failed"},SidePanelStatus:{SIDE_PANEL_OPEN:"side_panel_open",SIDE_PANEL_CLOSED:"side_panel_closed"},_securityContext:null,_securityContext3DSpace:null,_activeDataSource:null,_serverUrl:null,_searchtype:null,_mappingServices:{"3DPassport":"3DPassport","3dpassport":"3DPassport","3DCompass":"3DCompass","3dcompass":"3DCompass","3DSwym":"3DSwym",swym:"3DSwym","3DSpace":"3DSpace",space:"3DSpace",cstorage:"3DSpace","3DSearch":"3DSearch","3dsearch":"3DSearch",search:"3DSearch","3DMessaging":"3DMessaging","3DComputeOrchestration":"3DComputeOrchestration",hpc:"3DComputeOrchestration","3DDesign":"3DDesign","6WTags":"6WTags",tagger:"6WTags"},_platforms:{},_taggerOpenedByCode:!1,_adminCusto:null,_isInTheSimpleSearchMode:void 0,_isInTheSimpleSearchModePromise:null,_isInTheSimpleSearchModePromiseStatus:null,_sourceToPredicateMapping:null,_isDataSourceHasChanged:!1,_dateInternationalFormats:{ar:"dd/MM/yy",bg:"d.M.yyyy ",ca:"dd/MM/yyyy","zh-Hans":"yyyy/M/d",cs:"d.M.yyyy",da:"dd-MM-yyyy",de:"dd.MM.yyyy",el:"d/M/yyyy",en:"M/d/yyyy",es:"dd/MM/yyyy",fi:"d.M.yyyy",fr:"dd/MM/yyyy",he:"dd/MM/yyyy",hu:"yyyy.MM.dd.",is:"d.M.yyyy",it:"dd/MM/yyyy",ja:"yyyy/MM/dd",ko:"yyyy-MM-dd",nl:"d-M-yyyy",no:"dd.MM.yyyy",pl:"yyyy-MM-dd",pt:"dd/MM/yyyy",rm:"dd/MM/yyyy",ro:"dd.MM.yyyy",ru:"dd.MM.yyyy",hr:"d.M.yyyy.",sk:"d. M. yyyy",sq:"yyyy-MM-dd",sv:"yyyy-MM-dd",th:"d/M/yyyy",tr:"dd.MM.yyyy",ur:"dd/MM/yyyy",id:"dd/MM/yyyy",uk:"dd.MM.yyyy",be:"dd.MM.yyyy",sl:"d.M.yyyy",et:"d.MM.yyyy",lv:"yyyy.MM.dd.",lt:"yyyy.MM.dd",tg:"dd.MM.yy",fa:"MM/dd/yyyy",vi:"dd/MM/yyyy",hy:"dd.MM.yyyy",az:"dd.MM.yyyy",eu:"yyyy/MM/dd",hsb:"d. M. yyyy",mk:"dd.MM.yyyy",tn:"yyyy/MM/dd",xh:"yyyy/MM/dd",zu:"yyyy/MM/dd",af:"yyyy/MM/dd",ka:"dd.MM.yyyy",fo:"dd-MM-yyyy",hi:"dd-MM-yyyy",mt:"dd/MM/yyyy",se:"dd.MM.yyyy",ga:"dd/MM/yyyy",ms:"dd/MM/yyyy",kk:"dd.MM.yyyy",ky:"dd.MM.yy",sw:"M/d/yyyy",tk:"dd.MM.yy",uz:"dd/MM yyyy",tt:"dd.MM.yyyy",bn:"dd-MM-yy",pa:"dd-MM-yy",gu:"dd-MM-yy",or:"dd-MM-yy",ta:"dd-MM-yyyy",te:"dd-MM-yy",kn:"dd-MM-yy",ml:"dd-MM-yy",as:"dd-MM-yyyy",mr:"dd-MM-yyyy",sa:"dd-MM-yyyy",mn:"yy.MM.dd",bo:"yyyy/M/d",cy:"dd/MM/yyyy",km:"yyyy-MM-dd",lo:"dd/MM/yyyy",gl:"dd/MM/yyyy",kok:"dd-MM-yyyy",syr:"dd/MM/yyyy",si:"yyyy-MM-dd",iu:"d/MM/yyyy",am:"d/M/yyyy",tzm:"dd-MM-yyyy",ne:"M/d/yyyy",fy:"d-M-yyyy",ps:"dd/MM/yy",fil:"M/d/yyyy",dv:"dd/MM/yy",ha:"d/M/yyyy",yo:"d/M/yyyy",quz:"dd/MM/yyyy",nso:"yyyy/MM/dd",ba:"dd.MM.yy",lb:"dd/MM/yyyy",kl:"dd-MM-yyyy",ig:"d/M/yyyy",ii:"yyyy/M/d",arn:"dd-MM-yyyy",moh:"M/d/yyyy",br:"dd/MM/yyyy",ug:"yyyy-M-d",mi:"dd/MM/yyyy",oc:"dd/MM/yyyy",co:"dd/MM/yyyy",gsw:"dd/MM/yyyy",sah:"MM.dd.yyyy",qut:"dd/MM/yyyy",rw:"M/d/yyyy",wo:"dd/MM/yyyy",prs:"dd/MM/yy",gd:"dd/MM/yyyy","ar-SA":"dd/MM/yy","bg-BG":"d.M.yyyy ","ca-ES":"dd/MM/yyyy","zh-TW":"yyyy/M/d","cs-CZ":"d.M.yyyy","da-DK":"dd-MM-yyyy","de-DE":"dd.MM.yyyy","el-GR":"d/M/yyyy","en-US":"M/d/yyyy","fi-FI":"d.M.yyyy","fr-FR":"dd/MM/yyyy","he-IL":"dd/MM/yyyy","hu-HU":"yyyy.MM.dd.","is-IS":"d.M.yyyy","it-IT":"dd/MM/yyyy","ja-JP":"yyyy/MM/dd","ko-KR":"yyyy-MM-dd","nl-NL":"d-M-yyyy","nb-NO":"dd.MM.yyyy","pl-PL":"yyyy-MM-dd","pt-BR":"dd/MM/yyyy","rm-CH":"dd/MM/yyyy","ro-RO":"dd.MM.yyyy","ru-RU":"dd.MM.yyyy","hr-HR":"d.M.yyyy.","sk-SK":"d. M. yyyy","sq-AL":"yyyy-MM-dd","sv-SE":"yyyy-MM-dd","th-TH":"d/M/yyyy","tr-TR":"dd.MM.yyyy","ur-PK":"dd/MM/yyyy","id-ID":"dd/MM/yyyy","uk-UA":"dd.MM.yyyy","be-BY":"dd.MM.yyyy","sl-SI":"d.M.yyyy","et-EE":"d.MM.yyyy","lv-LV":"yyyy.MM.dd.","lt-LT":"yyyy.MM.dd","tg-Cyrl-TJ":"dd.MM.yy","fa-IR":"MM/dd/yyyy","vi-VN":"dd/MM/yyyy","hy-AM":"dd.MM.yyyy","az-Latn-AZ":"dd.MM.yyyy","eu-ES":"yyyy/MM/dd","hsb-DE":"d. M. yyyy","mk-MK":"dd.MM.yyyy","tn-ZA":"yyyy/MM/dd","xh-ZA":"yyyy/MM/dd","zu-ZA":"yyyy/MM/dd","af-ZA":"yyyy/MM/dd","ka-GE":"dd.MM.yyyy","fo-FO":"dd-MM-yyyy","hi-IN":"dd-MM-yyyy","mt-MT":"dd/MM/yyyy","se-NO":"dd.MM.yyyy","ms-MY":"dd/MM/yyyy","kk-KZ":"dd.MM.yyyy","ky-KG":"dd.MM.yy","sw-KE":"M/d/yyyy","tk-TM":"dd.MM.yy","uz-Latn-UZ":"dd/MM yyyy","tt-RU":"dd.MM.yyyy","bn-IN":"dd-MM-yy","pa-IN":"dd-MM-yy","gu-IN":"dd-MM-yy","or-IN":"dd-MM-yy","ta-IN":"dd-MM-yyyy","te-IN":"dd-MM-yy","kn-IN":"dd-MM-yy","ml-IN":"dd-MM-yy","as-IN":"dd-MM-yyyy","mr-IN":"dd-MM-yyyy","sa-IN":"dd-MM-yyyy","mn-MN":"yy.MM.dd","bo-CN":"yyyy/M/d","cy-GB":"dd/MM/yyyy","km-KH":"yyyy-MM-dd","lo-LA":"dd/MM/yyyy","gl-ES":"dd/MM/yyyy","kok-IN":"dd-MM-yyyy","syr-SY":"dd/MM/yyyy","si-LK":"yyyy-MM-dd","iu-Cans-CA":"d/M/yyyy","am-ET":"d/M/yyyy","ne-NP":"M/d/yyyy","fy-NL":"d-M-yyyy","ps-AF":"dd/MM/yy","fil-PH":"M/d/yyyy","dv-MV":"dd/MM/yy","ha-Latn-NG":"d/M/yyyy","yo-NG":"d/M/yyyy","quz-BO":"dd/MM/yyyy","nso-ZA":"yyyy/MM/dd","ba-RU":"dd.MM.yy","lb-LU":"dd/MM/yyyy","kl-GL":"dd-MM-yyyy","ig-NG":"d/M/yyyy","ii-CN":"yyyy/M/d","arn-CL":"dd-MM-yyyy","moh-CA":"M/d/yyyy","br-FR":"dd/MM/yyyy","ug-CN":"yyyy-M-d","mi-NZ":"dd/MM/yyyy","oc-FR":"dd/MM/yyyy","co-FR":"dd/MM/yyyy","gsw-FR":"dd/MM/yyyy","sah-RU":"MM.dd.yyyy","qut-GT":"dd/MM/yyyy","rw-RW":"M/d/yyyy","wo-SN":"dd/MM/yyyy","prs-AF":"dd/MM/yy","gd-GB":"dd/MM/yyyy","ar-IQ":"dd/MM/yyyy","zh-CN":"yyyy/M/d","de-CH":"dd.MM.yyyy","en-GB":"dd/MM/yyyy","es-MX":"dd/MM/yyyy","fr-BE":"d/MM/yyyy","it-CH":"dd.MM.yyyy","nl-BE":"d/MM/yyyy","nn-NO":"dd.MM.yyyy","pt-PT":"dd-MM-yyyy","sr-Latn-CS":"d.M.yyyy","sv-FI":"d.M.yyyy","az-Cyrl-AZ":"dd.MM.yyyy","dsb-DE":"d. M. yyyy","se-SE":"yyyy-MM-dd","ga-IE":"dd/MM/yyyy","ms-BN":"dd/MM/yyyy","uz-Cyrl-UZ":"dd.MM.yyyy","bn-BD":"dd-MM-yy","mn-Mong-CN":"yyyy/M/d","iu-Latn-CA":"d/MM/yyyy","tzm-Latn-DZ":"dd-MM-yyyy","quz-EC":"dd/MM/yyyy","ar-EG":"dd/MM/yyyy","zh-HK":"d/M/yyyy","de-AT":"dd.MM.yyyy","en-AU":"d/MM/yyyy","es-ES":"dd/MM/yyyy","fr-CA":"yyyy-MM-dd","sr-Cyrl-CS":"d.M.yyyy","se-FI":"d.M.yyyy","quz-PE":"dd/MM/yyyy","ar-LY":"dd/MM/yyyy","zh-SG":"d/M/yyyy","de-LU":"dd.MM.yyyy","en-CA":"dd/MM/yyyy","es-GT":"dd/MM/yyyy","fr-CH":"dd.MM.yyyy","hr-BA":"d.M.yyyy.","smj-NO":"dd.MM.yyyy","ar-DZ":"dd-MM-yyyy","zh-MO":"d/M/yyyy","de-LI":"dd.MM.yyyy","en-NZ":"d/MM/yyyy","es-CR":"dd/MM/yyyy","fr-LU":"dd/MM/yyyy","bs-Latn-BA":"d.M.yyyy","smj-SE":"yyyy-MM-dd","ar-MA":"dd-MM-yyyy","en-IE":"dd/MM/yyyy","es-PA":"MM/dd/yyyy","fr-MC":"dd/MM/yyyy","sr-Latn-BA":"d.M.yyyy","sma-NO":"dd.MM.yyyy","ar-TN":"dd-MM-yyyy","en-ZA":"yyyy/MM/dd","es-DO":"dd/MM/yyyy","sr-Cyrl-BA":"d.M.yyyy","sma-SE":"yyyy-MM-dd","ar-OM":"dd/MM/yyyy","en-JM":"dd/MM/yyyy","es-VE":"dd/MM/yyyy","bs-Cyrl-BA":"d.M.yyyy","sms-FI":"d.M.yyyy","ar-YE":"dd/MM/yyyy","en-029":"MM/dd/yyyy","es-CO":"dd/MM/yyyy","sr-Latn-RS":"d.M.yyyy","smn-FI":"d.M.yyyy","ar-SY":"dd/MM/yyyy","en-BZ":"dd/MM/yyyy","es-PE":"dd/MM/yyyy","sr-Cyrl-RS":"d.M.yyyy","ar-JO":"dd/MM/yyyy","en-TT":"dd/MM/yyyy","es-AR":"dd/MM/yyyy","sr-Latn-ME":"d.M.yyyy","ar-LB":"dd/MM/yyyy","en-ZW":"M/d/yyyy","es-EC":"dd/MM/yyyy","sr-Cyrl-ME":"d.M.yyyy","ar-KW":"dd/MM/yyyy","en-PH":"M/d/yyyy","es-CL":"dd-MM-yyyy","ar-AE":"dd/MM/yyyy","es-UY":"dd/MM/yyyy","ar-BH":"dd/MM/yyyy","es-PY":"dd/MM/yyyy","ar-QA":"dd/MM/yyyy","en-IN":"dd-MM-yyyy","es-BO":"dd/MM/yyyy","en-MY":"d/M/yyyy","es-SV":"dd/MM/yyyy","en-SG":"d/M/yyyy","es-HN":"dd/MM/yyyy","es-NI":"dd/MM/yyyy","es-PR":"dd/MM/yyyy","es-US":"M/d/yyyy","bs-Cyrl":"d.M.yyyy","bs-Latn":"d.M.yyyy","sr-Cyrl":"d.M.yyyy","sr-Latn":"d.M.yyyy",smn:"d.M.yyyy","az-Cyrl":"dd.MM.yyyy",sms:"d.M.yyyy",zh:"yyyy/M/d",nn:"dd.MM.yyyy",bs:"d.M.yyyy","az-Latn":"dd.MM.yyyy",sma:"yyyy-MM-dd","uz-Cyrl":"dd.MM.yyyy","mn-Cyrl":"yy.MM.dd","iu-Cans":"d/M/yyyy","zh-Hant":"d/M/yyyy",nb:"dd.MM.yyyy",sr:"d.M.yyyy","tg-Cyrl":"dd.MM.yy",dsb:"d. M. yyyy",smj:"yyyy-MM-dd","uz-Latn":"dd/MM yyyy","mn-Mong":"yyyy/M/d","iu-Latn":"d/MM/yyyy","tzm-Latn":"dd-MM-yyyy","ha-Latn":"d/M/yyyy","zh-CHS":"yyyy/M/d","zh-CHT":"d/M/yyyy*"},_dictionnary:{},setDictionnaryEntry:function(e,t){this._dictionnary[e]=t},getDictionnaryEntry:function(t){return e.is(this._dictionnary[t])?this._dictionnary[t]:void 0},_width:0,init:function(){this.sessionUserId="",Object.freeze(this.SearchTypeEnum),this._searchViewPromise=d.deferred(),this._searchReadyPromise=d.deferred(),this._autocompletePromise=d.deferred(),this.getGrantedRoles(function(){}),this._securityContextPromise=d.deferred(),this._searchUXTopbarSocketPromise=d.deferred(),this._securityContext3DSpacePromise=d.deferred(),this._activeDataSourcePromise=d.deferred(),this._powerByInitPromise=d.deferred(),this._sourceToPredicateMapping=JSON.parse(y),this._dictionnary={},this.identifyClientInfo(),_.set(),!0===a.getOption("FromBItoDP")==1&&this.bIOnWeb(),m.bIsPublicUser=!1,m.hasRole(["UAU","XBY","IWA","MPU"],e=>{m.bIsPublicUser=e}),this._initEvents()},_initEvents:function(){let e=this;this._width=document.getElementsByTagName("BODY")[0].offsetWidth;let t=()=>{let t=document.getElementsByTagName("BODY")[0];if(null==t)return;let i=t.offsetWidth;null!=i&&i!=e._width&&require(["DS/MessageBus/MessageBus"],function(t){t.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"bodyWidthUpdate",data:{oldWidth:e._width,newWidth:i}}),e._width=i})};window.addEventListener?window.addEventListener("resize",t,!0):window.attachEvent&&window.attachEvent("onresize",t)},getSearchAppId:function(){return m.bIsPublicUser?m.SEARCH_APP_ID_PUBLIC:m.SEARCH_APP_ID},checkSearchAppId:function(e){return this.getSearchAppId()===e},setUserId:function(e){this._sessionUserId=e,this.setUserSpecificSettings()},getUserId:function(){return this._sessionUserId},setserverUrl:function(e){this._serverUrl=e},getserverUrl:function(){return this._serverUrl},setAutocompleteRendered:function(){this._autocompletePromise.resolve()},autocompleteRendered:function(){return this._autocompletePromise.promise},setSearchUXTopbarSocketInitialized:function(){this._searchUXTopbarSocketPromise.resolve()},searchUXTopbarSocketInitialized:function(){return this._searchUXTopbarSocketPromise.promise},setSearchViewRendered:function(){this._searchViewPromise.resolve()},getSearchViewPromise:function(){return this._searchViewPromise.promise},onSearchReady:function(){return this._searchReadyPromise.promise},setSearchReady:function(){this._searchReadyPromise.resolve()},setPowerByInitDone:function(){this._powerByInitPromise.resolve()},getPowerByInitPromise:function(){return this._powerByInitPromise.promise},setsearchType:function(e){this._searchtype=e},getsearchType:function(){return null===this._searchtype&&(this._searchtype="#searchIn"),this._searchtype},getWidth:function(){return Math.max(document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)},getHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},result:function(t,i){var r;return t?(r=t[i],"function"===e.typeOf(r)?r.call(t):r):null},replace:function(e,t){return e.replace(/\{([\w\-]+)\}/g,function(e,i){return void 0!==t[i]?t[i]:""})},getTaggerService:function(t){var i="",r=t.getSourceID(),s=r||"3dspace",n=t.getPlatformID();if(e.is(r,"string")){var a=S.getServiceFromSource(r),o=c.getDelegation({serviceID:a});i=o&&e.is(o.getTaggerService,"function")?o.getTaggerService({id:t.get("id"),source:s,platform:n}):r.indexOf("3dspace")>=0?"3DSpace":"6WTagger"}return i},getAvailableHeight:function(){var t=450,i=e.extendElement(document.body).getElement(".app-content>.module>.front");if(i){var r=i.getScrolls().height;r>t&&(t=r-110)}else a.getOption("search_web_in_win")&&document.body.parentElement.clientHeight>70&&(t=document.body.parentElement.clientHeight-70);return t+"px"},getLanguage:function(){var t;window&&window.dsLang?"devsymbol"===(t=window.dsLang)&&(t="en"):t=(window&&window.clntlang?window.clntlang:navigator&&navigator.languages&&e.is(navigator.languages,"array")&&navigator.languages.length>0?navigator.languages[0]:navigator?navigator.language||navigator.systemLanguage:DEFAULT_LANG).toLowerCase().split("-")[0];return t},getRegion:function(){return o.getItem("search_date_region")},getAdminSetting:function(t){var i={};return e.is(a)&&e.is(a._tenantSettings)&&e.is(a._tenantSettings[t])&&e.is(a._tenantSettings[t].search_settings)&&(i=a._tenantSettings[t].search_settings),i},dateToDisplay:function(t,i,r){let s,n,a;return e.is(r.date)||e.is(i.date)?(e.is(r)&&""!==r?(s=t.toLocaleString(i.date,r.date),n=t.toLocaleString(i.time,r.time)):(s=t.toLocaleString(i.date),n=t.toLocaleString(i.time)),a=s+" "+n):a=t.toLocaleString(i,r),a},getDeviceCategory:function(){let e=/iPhone/.test(navigator.userAgent)&&!window.MSStream,t=n.Platform.ipad,i="android"===n.Platform.name;return e?"iphone":(t?"ipad":"")||(i?"android":"")},getDeviceType:function(){const e=navigator.userAgent.toLowerCase();let t=screen.availWidth,i=screen.availHeight,r=/iPhone|Android/i.test(navigator.userAgent),s=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(e);return s||"ipad"!==m.getDeviceCategory()||(r=!1,s=!0),r&&t>=600&&"iphone"!=m.getDeviceCategory()&&(r=!1,s=!0),window.matchMedia("(pointer:coarse)").matches&&(t>=600&&i>=600?(r=!1,s=!0):(r=!0,s=!1)),r?"mobile":s?"tablet":"desktop"},getMobileDeviceBrowser:function(){const e=navigator.userAgent.toLowerCase();let t={Opera:/opera/.test(e)||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,Chrome:/chrome/.test(e)||!!window.chrome&&!!window.chrome.webstore,Safari:!Chrome&&/safari/.test(e)||/constructor/i.test(window.HTMLElement),IE:!Opera&&check(/msie/)||!!document.documentMode,Edge:!IE&&!!window.StyleMedia,Firefox:"undefined"!=typeof InstallTrigger};return Object.keys(t).find(e=>!0===t[e])},isMobileOrTablet:function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))},getViewportOrientation:function(){return window.innerHeight>window.innerWidth||window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape"},setHelperCollection:function(t,i){e.is(t,"string")&&t.length>0&&(this.deleteHelperCollection(t),this._helper_collections[t]=i)},bIOnWeb:function(){let t=require("DS/PlatformAPI/PlatformAPI");e.is(t)&&t.subscribe("DS/PADUtils/PADCommandProxy/enrich3D",function(e){var t,i,r;if((console.log(e),e.hasOwnProperty("data"))&&((e=e.data).hasOwnProperty("graphicProperties")&&(e=e.graphicProperties).hasOwnProperty("layers")&&(e=e.layers[0]).hasOwnProperty("styles")&&(e.styles.forEach((e,t)=>{"#57b847"==e.color&&(r=t)}),e.styles.forEach((e,i)=>{"#d1d4d4"==e.color&&(t=i)}),e.styles.forEach((e,t)=>{"#ADADAD"==e.color&&(i=t)}),e.hasOwnProperty("colorMap")))){var s=[],n=[],a=[];(e=e.colorMap).forEach(function(e){e.style===t?s.push(e.resourceid):e.style===r?a.push(e.resourceid):e.style===i&&n.push(e.resourceid)}),"undefined"!=typeof dscef&&dscef.sendString("Not Locked = "+s+" Locked BY Owner = "+a+" Locked By Others = "+n)}})},getHelperCollection:function(t){if(e.is(t))return this._helper_collections[t]},deleteHelperCollection:function(t){var i=this._helper_collections[t];e.is(i)&&(i.destroy(),i=null,delete this._helper_collections[t],f.info("removed helper collection for widget id = "+t))},replacePQsWithCVPrefixes:function(t){if(e.is(t)){for(var i="",r=0,s=/[\s\b]*(\w+):/g;;){var n=s.exec(t);if(!n)break;var a=n[1];if(u.isAPQAbbrevation(a)){var o=t.substring(r,n.index);o.length>0&&(o+=" "),i=i+o+"3dexp"+u.getPQPrefix(a),i+=":",r=s.lastIndex}}return i=(i+=t.substring(r)).replace(/3dexp(\w+):[*]+(?=($| |\)))/g,"3dexp$1:#all")}return t},executeWithPQ:function(e){if(e.wait&&e.wait()){var t=this;u.getPQFetchPromise().then(function(){t.executeWithPQ=function(e){e.run.call()},t.executeWithPQ(e)})}else e.run.call()},getPlatformServices:function(){return h},getGrantedRoles:function(t){var i=this;a.getOption("search_web_in_win")?t([]):e.is(this._grantedRoles)?t(i._grantedRoles):e.is(h.getGrantedRoles,"function")&&h.getGrantedRoles(function(r){if(e.is(r,"array")&&r.length){i._grantedRoles=r;var s=a.getOption("role");if(e.is(window.dsUserLogin,"string")&&"uxodtitp"===window.dsUserLogin&&e.is(s,"string")&&0<s.length){var n=!1;r.some(function(e){e.id===s&&(n=!0)}),!1===n&&i._grantedRoles.push({id:s,name:"Dummy role from ODT",platforms:[]})}t(i._grantedRoles)}else t([])})},isRoleAvailable:function(t,i,r){this.getGrantedRoles(function(s){var n=!0;if(e.is(t,"array")&&t.length>0&&e.is(s,"array")&&0<s.length){n=!1;var a=0,o=t.length;for(a=0;a<o;a++)s.some(function(r){return"InternalDS"===r.id||(r.id===t[a]&&e.is(r.platforms)?r.platforms.some(function(t){return!(e.is(i)&&i.length>0)||t===i}):void 0)})&&(n=!0)}r(n)})},hasRole:function(t,i){this.getGrantedRoles(function(r){var s=!0;if(e.is(t,"array")&&t.length>0&&e.is(r,"array")&&0<r.length){s=!1;var n=0,a=t.length;for(n=0;n<a;n++)r.some(function(e){return t.includes(e.id)})&&(s=!0)}i(s)})},getZIndex:function(t,i){try{var r=0;if(e.is(i)&&(r=i),e.is(t,"element")){var s=window.getComputedStyle(t).getPropertyValue("z-index");return isNaN(s)||(s=parseInt(s))>r&&(r=s),this.getZIndex(t.parentElement,r)}return r}catch(t){return f.error("Exception caught in getZIndex ! :"+t),e.is(i)?i:1049}},getURIToUse:function(t){var i=t;return e.is(t)&&!e.is(this._mappingURIPredicate[t])&&(this._mappingURIPredicate[t]=t.slice(t.lastIndexOf("/")+1,t.length)),e.is(this._mappingURIPredicate[t])&&(i=this._mappingURIPredicate[t]),i},getServicesToUse:function(t){return e.is(this._mappingServices[t])?this._mappingServices[t]:t},getServiceUrl:function(t,i){var r=this._platforms[i],s=null,n=this.getServicesToUse(t);return e.is(r,"object")&&e.is(r.services,"object")&&e.is(n,"string")&&e.is(r.services[n],"object")&&(s=r.services[n].url),s},setPlatforms:function(t){this._platforms={};var i=0,r=0;if(e.is(t,"array"))for(r=t.length,i=0;i<r;i++)if(e.is(t[i],"object")){var s=t[i];if(e.is(s.id,"string")&&s.id.length>0){var n={};n.name=s.name,n.services={};var a=s.services,o=0,c=0;if(e.is(a,"array"))for(c=a.length,o=0;o<c;o++)n.services[this.getServicesToUse(a[o].id)]={url:a[o].url};this._platforms[s.id]=n}}},getTaggerSubjectURI:function(t){var i={};if(e.is(t,"object")&&e.is(t.subjects,"array")){var r=c.getDelegation({serviceID:t.service});if(r&&e.is(r.getSubjectURI,"function"))i=r.getSubjectURI({subjects:t.subjects});else{var s="pid://";e.is(t.source,"string")&&t.source.indexOf("drive")>=0&&(s="driveid:"),t.subjects.length>0&&t.subjects[0].id&&-1===t.subjects[0].id.indexOf(":")?t.subjects.forEach(function(e){i[e.id]=s+e.id}):t.subjects.forEach(function(e){i[e.id]=e.id})}}return i||{}},setSecurityContext:function(e){this._securityContext=e},setSecurityContext3DSpace:function(e){this._securityContext3DSpace=e},getSecurityContext:function(){return this._securityContext},getSecurityContext3DSpace:function(){return this._securityContext3DSpace},stripHtml:function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""},escapeHtml:function(t){if(!e.is(t,"string")||!e.is(t.replace,"function"))return f.warn("Trying to escapeHtml of a non string : ",t," !"),t;var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(e){return i[e]})},decodeHtml:function(t){if(!e.is(t,"string")||!e.is(t.replace,"function"))return f.warn("Trying to decodeHtml of a non string : ",t," !"),t;var i={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(e){return i[e]})},constructEmptyViewMsg:function(e){var t=e.split("\n");return t[0]+'<br><br><div style="text-align:left">'+t[1]+'<br><ul style="font-size: 0.8em"><li>'+t[2]+"</li><li>"+t[3]+"</li><li>"+t[4]+"</li><li>"+t[5]+"</li></ul></div>"},iconURL_check:function(e){let t=".("+a.getOption("companyTagsImgExtensions").join("|")+")$";return!!(t=new RegExp(t,"gi")).test(e)},initSecurityContext:function(t){var i=this,r=i.getSecurityContext();if(r&&r.trim().length>0)i._securityContextPromise.resolve();else{var s={method:"GET"};s.headers={"Accept-Language":m.getLanguage(),Accept:"application/json"},e.is(t.get3DSpaceUrl,"function")?(s.url=t.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext",s.data={tenant:t.getActiveTenant()}):(s.url=t.url+"/resources/pno/person/getsecuritycontext",s.data={tenant:t.tenant}),s.onComplete=function(e){var t=JSON.parse(e);i.setSecurityContext(t.SecurityContext),i._securityContextPromise.resolve()},s.onFailure=function(e){f.warn("Failed to get security context: "+e),i._securityContextPromise.resolve()},l.authenticatedRequest(s.url,s)}},getSecurityContextPromise:function(){return this._securityContextPromise.promise},initSecurityContext3DSpace:function(e){var t=this;t.getSecurityContext3DSpace();if(e.active_tenant===this.active_tenant)t._securityContext3DSpacePromise.resolve();else{this.active_tenant=e.getActiveTenant();var i=e.get3DSpaceUrl()+"/resources/bps/cspaces?tenant="+e.getActiveTenant(),r={type:"json",method:"GET",proxy:"passport"};r.headers={"Content-Type":"application/ds-json","Accept-Language":m.getLanguage()},r.timeout=6e5,r.that=t,r.onComplete=function(e){var i=e.cspaces,r=[];i&&0!==i.length||(i=[]);var s="",n=!0;i.forEach(function(e){var t=e.displayName.split(".");if(3===t.length&&n){var i=t[1];""===s&&(s=i),n=s===i}}),i.forEach(function(e){var t=e.displayName,i=e.displayName.split(".");3===i.length&&(t=i[2]+" ● ",n||(t+=i[1]+" ● "),t+=i[0]),r.push({label:t,value:e.name})}),t.setSecurityContext3DSpace(i),t._securityContext3DSpacePromise.resolve()},r.onFailure=function(e){f.log("getSecurityContext3DSpace:Failure..."+e)},r.ontimeout=function(){f.log("getSecurityContext3DSpace: A connection timeout occured.")},l.authenticatedRequest(i,r)}},getSecurityContext3DSpacePromise:function(){return this._securityContext3DSpacePromise.promise},setActiveDataSource:function(e){f.log("SearchUtils.setActiveDataSource",e),this._active_dataSource=e},getActiveDataSource:function(){return f.log("SearchUtils.getActiveDataSource",this._active_dataSource),this._active_dataSource},getActiveTenant:function(){return f.log("SearchUtils.getActiveTenant",this.active_tenant),this.active_tenant},setChosenDataSource:function(e){f.log("SearchUtils.setChosenDataSource",e),e.length>0&&(this._chosen_dataSource=e)},getChosenDataSource:function(){return f.log("SearchUtils.getChosenDataSource",this._chosen_dataSource),this._chosen_dataSource},addChosenDataSource:function(e){f.log("SearchUtils.addChosenDataSource",e),-1===this._chosen_dataSource.indexOf(e)&&(this._chosen_dataSource.push(e),this._isDataSourceHasChanged=!0)},suppressChosenDataSource:function(e){f.log("SearchUtils.suppressChosenDataSource",this._chosen_dataSource),0===this._chosen_dataSource.length&&(this._chosen_dataSource=m.getActiveDataSource());for(var t=0;t<this._chosen_dataSource.length;)this._chosen_dataSource[t]===e?(this._chosen_dataSource.splice(t,1),this._isDataSourceHasChanged=!0):++t},chosenDataSourceHasChanged:function(t){e.is(t.onComplete,"function")&&(this._chosenDataSourceHasChanged=t.onComplete)},resetDataSourceHasChanged:function(){this._isDataSourceHasChanged=!1},dataSourceChangeCompleted:function(){!0===this._isDataSourceHasChanged&&e.is(this._chosenDataSourceHasChanged,"function")&&this._chosenDataSourceHasChanged.call(this._chosen_dataSource)},setActiveDataSourcePromise:function(){return this._activeDataSourcePromise.resolve()},getActiveDataSourcePromise:function(){return this._activeDataSourcePromise.promise},isODTMode:function(){return a.isODTMode()||window.navigator.webdriver},isFUNActive:function(t){if(!e.is(t,"string"))throw new Error("Invalid arg in SearchUtils.isFUNActive !");return!1!==a.getOption(t)},isFUN139159Active:function(){return window.location.href.indexOf("FUN139159")>-1},isFUN072117Active:function(){return a.getOption("preferredUnit_FUN072117")||p.isActiveWithCurrentVersion({R2019x:"BETA3"})},isFUN109031Active:function(){let t=this.is6WInWebInWinActive();if(!0===t)return t;let i=a.getOption("addinmode");if(null==a.getOption("disable6w")&&!1===this.isWebInWin()&&-1===["solidworks","catiav5"].indexOf(i)&&void 0===o.getItem("BETA-FUN109031")){let t=a.getOption("6w_default_activated");o.setItem("BETA-FUN109031",!e.is(t,"boolean")||t)}return!0===o.getItem("BETA-FUN109031")&&-1===["solidworks","catiav5"].indexOf(i)&&!1===this.isWebInWin()},isFUN096612Active:function(){return a.getOption("SearchDisplayName")},isFUN127551Active:function(){let e=m.isFUNActive("FUN127551"),t=this.isWebInWin(),i=-1!==["solidworks","catiav5"].indexOf(a.getOption("addinmode")),r=this.isMobile();return e&&!t&&!i&&!r},identifyClientInfo:function(t){var i="3DDashboard";let r=void 0,s=window.parent?window.parent:window;e.is(document.getElementById("searchContainer"))||e.is(document.getElementById("targeted-search"))||e.is(document.getElementById("panelToggle"))?i="3DSpace":!s.ds||"3DSwym"!==s.ds.env&&"3DSwym"!==s.ds.app?a.getOption("search_web_in_win")&&(i="3DEXPERIENCE"):(i="3DSwym",r=!s.ds.app);var n={identifier:i,deprecated:r};return e.is(t,"string")&&t.length>0&&(n.addinmode=t),n},_isSearchWidgetTransientAvailable:function(t){var i=!1;return e.Widgets&&e.Widgets.instances.filter(function(r){e.is(r)&&e.is(r.getView,"function")&&"maximized"===r.getView().type&&e.is(r.data)&&e.is(r.data.appId)&&"X3DSEAR_AP"===r.data.appId&&(i=!0,r.id===t&&(i=!1))}),i},instantiateAppInSearch:function(t,i,s,n){var a=this.createContent(t);this.setContentVisibility(t);var o=require,c=o("UWA/Class/Promise"),l=o("DS/i3DXCompass/i3DXCompass"),d=null,u=null;return new c(function(){var t,p;(t=["DS/UWPClientCode/WidgetFactory","DS/TopFrame/Environment"],p=[],e.is(t,"string")?p[0]=t:p=t,new c(function(e,t){require(p,function(){e(Array.prototype.slice.call(arguments))},function(e){t(new Error("Error loading modules."+(e&&e.requireModules?e:"")))})})).then(function(t){d=t[0],u=t[1],e.is(d)&&e.is(u)&&function(e){return new c(function(t,i){l?l.getAppInfo({appId:e,onComplete:function(e){e?t(e):i(new Error("Could not locate app information."))},onFailure:i}):i(new Error("No compass"))})}(i).then(function(t){return function(t,i,s,n){return new c(function(a){var c,l="",p=s;if(e.is(p,"object")&&(p=JSON.stringify(s)),e.is(t.config)&&t.config.length>0)l=t.config,r.request(l,{method:"GET",type:"json",cache:3600,onComplete:function(r){if(e.merge(s,r),p=JSON.stringify(s),c={el:i,title:"",parent:!1,preview:!0,appId:t.id,data:p||{},header:!0,config:l},!t||!(t.checksum&&t.launchInfos||t.platforms&&t.platforms[0]&&t.platforms[0].checksum&&t.platforms[0].launchInfos))throw new Error("Could not get valid Config from MyApps for the App "+c.appId);c=UWA.extend(c,{widgetId:e.is(t.launchInfos)?t.launchInfos:t.platforms[0].launchInfos,isolationLevel:e.is(t.isolationLevel)?t.isolationLevel:t.platforms[0].isolationLevel,token:e.is(t.checksum)?t.checksum:t.platforms[0].checksum}),d.load(c,function(){if(c.widget&&c.widget.environment){if(c.widget.setValue("X3DContentId",c.data),e.is(n)&&e.is(n.historyNode)&&e.is(n.historyNode._options)){n.historyNode._options.contextid="RightPanelContext",c.widget.context="RightPanelContext";let t=require("DS/TagNavigator/TagNavigator").get6WTagger(c.widget.context);t&&(t.setAsCurrent(),t.focusOnCC(n.historyNode._options.widgetAppId)),e.is(n.historyNode._options.containers,"array")||(n.historyNode._options.containers=[]),e.is(n.historyNode._options.containers)&&n.historyNode._options.containers.push(i),e.is(n.historyNode._options.widgets,"array")||(n.historyNode._options.widgets=[]),e.is(n.historyNode._options.widgets)&&n.historyNode._options.widgets.push(c.widget)}var t=o("DS/PlatformAPI/PlatformAPI");e.is(t)&&t.subscribe("onAppReady.CATC3D_AP",function(){c.widget.setTitle(" ")})}a(c.widget)},u)}});else{if(c={el:i,title:"",parent:!1,preview:!0,appId:t.id,data:s||{},header:!0},!t||!(t.checksum&&t.launchInfos||t.platforms&&t.platforms[0]&&t.platforms[0].checksum&&t.platforms[0].launchInfos))throw new Error("Could not get valid Config from MyApps for the App "+c.appId);c=UWA.extend(c,{widgetId:e.is(t.launchInfos)?t.launchInfos:t.platforms[0].launchInfos,isolationLevel:e.is(t.isolationLevel)?t.isolationLevel:t.platforms[0].isolationLevel,token:e.is(t.checksum)?t.checksum:t.platforms[0].checksum}),d.load(c,function(){if(c.widget&&c.widget.environment){if(c.widget.setValue("X3DContentId",JSON.stringify(c.data)),e.is(n)&&e.is(n.historyNode)&&e.is(n.historyNode._options)){n.historyNode._options.contextid="RightPanelContext",n.historyNode._options.widgetAppId=c.widget.id,c.widget.context="RightPanelContext";let t=require("DS/TagNavigator/TagNavigator").get6WTagger(c.widget.context);t&&(t.setAsCurrent(),t.focusOnCC(n.historyNode._options.widgetAppId)),e.is(n.historyNode._options.containers,"array")||(n.historyNode._options.containers=[]),e.is(n.historyNode._options.containers)&&n.historyNode._options.containers.push(i),e.is(n.historyNode._options.widgets,"array")||(n.historyNode._options.widgets=[]),e.is(n.historyNode._options.widgets)&&n.historyNode._options.widgets.push(c.widget)}c.widget.addEvent("onUpdateTitle",function(t){var i=c.el.querySelector(".moduleHeader__title");if(i){var r=!1,s=i.innerHTML.split(" - ");e.is(s)&&s[0]!==c.name?(s[0]=c.name,r=!0):(s[1]=t,r=!0),r&&(i.innerHTML=s.filter(function(e){return e}).join(" - "))}})}a(c.widget)},u)}})}(t,a,s,n)})})})},setContentVisibility:function(t){var i=this.getCurrentSearchWidget();if(null!==i){var r,s=t,n=!1;e.is(t)&&e.is(t.SNtype)&&(s=t.SNtype,n=!0,r=t.contextid);var a=require("DS/TagNavigator/TagNavigator"),o=i.elements.body.getElement(".onesearch_skeleton");e.is(o)&&o.setStyle("display","none");var c=i.elements.body.getElement(".relational-div");e.is(c)&&c.setStyle("display","none");var l=i.elements.body.getElement(".product-div");if(e.is(l)&&l.setStyle("display","none"),"Search"===s||"Children"===s?e.is(o)&&o.setStyle("display","block"):"Explore"===s||"ExploreList"===s||"Explore3D"===s?e.is(l)&&l.setStyle("display","flex"):"Relational"===s&&e.is(c)&&c.setStyle("display","block"),!0===n){var d=a.get6WTagger(r);d&&(d.setAsCurrent(),d.focusOnCC(t.widgetAppId))}}},createContent:function(t){var i=null,r=this.getCurrentSearchWidget();if(null!==r){var n=t,a=r.elements.body.getElement(".relational-div");e.is(a)&&a.setStyle("display","none");var o=r.elements.body.getElement(".product-div");return e.is(o)&&o.setStyle("display","none"),"Explore"===n||"ExploreList"===n||"Explore3D"===n?e.is(o)&&(o.setStyle("display","flex"),"ExploreList"===n?(i=s.create("div",{class:"productList-div",styles:{float:"left"}})).inject(o):"Explore3D"===n&&(i=s.create("div",{class:"product3D-div",styles:{float:"right"}})).inject(o)):"Relational"===n&&e.is(a)&&(a.setStyle("display","block"),i=a),i}},pinToDashboard:function(t){require(["DS/Dashboard/Notification/Subscribe"],function(i){var r=t.widgetData;e.is(t.widgetData)&&(r.pinToDashboard=!1),i.subscribe({notification:{data:JSON.stringify({contentData:{title:t.widgetTitle},url:t.widgetIdOrUrl,appId:t.widgetAppId,widgetId:t.widgetId,data:r})},type:"widget"}).then(function(){e.is(t.success,"function")&&t.success()},function(){e.is(t.failure,"function")&&t.failure()})})},getCurrentTabId:function(){var t,i,r,s=null,n=(t=e.Widgets&&e.Widgets.instances||[]).length;for(i=0;i<n;i++)if(void 0!==(r=t[i]).data&&void 0!==r.data.module&&"DS/Dashboard/Layout/Dashboard"===r.data.module&&void 0!==r.layout&&void 0!==r.layout.selectedTab&&void 0!==r.layout.selectedTab.options){s=r.layout.selectedTab.options.id;break}return s},getSearchWidget:function(t){let i=null;return e.is(t)&&e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances)&&UWA.Widgets.instances.forEach(function(e){e.id===t&&(i=e)}),i},getCurrentSearchWidget:function(){var t=null,i=this.getCurrentTabId();if(e.Widgets){var r,s,n,a=(r=e.Widgets&&e.Widgets.instances||[]).length;for(s=0;s<a;s++)n=r[s],e.is(n,"object")&&n.getValue("appId")===m.SEARCH_APP_ID&&"maximized"===n.getView().type&&e.is(n.getView().previous)&&e.is(n.getView().previous.type)&&"windowed"===n.getView().previous.type&&(t=n,s=a);if(null===t)for(s=0;s<a;s++)n=r[s],e.is(n,"object")&&n.context===i&&n.getValue("appId")===m.SEARCH_APP_ID&&"maximized"===n.getView().type&&(t=n,s=a);if(null===t)for(s=0;s<a;s++)n=r[s],e.is(n,"object")&&n.getValue("appId")===m.SEARCH_APP_ID&&"sidepanel"===n.getView().type&&(t=n,s=a)}return t},addSourceSpecificParameter:function(t,i){if(e.is(t)&&e.is(i)){var r=i.sourceIds;if(e.is(r,"array"))for(var s=0;s<r.length;s++){var n=r[s];if(e.is(t.specific_source_parameter))var a=t.specific_source_parameter[n];e.is(a)||(a={});var o=i.param.id,c=i.param.value;if(e.is(o,"string")&&e.is(c)&&c.toString().length){var l=a[o];e.is(l,"string")?a[o]+=c:a[o]=c,e.is(t.specific_source_parameter)||(t.specific_source_parameter={}),e.is(t.specific_source_parameter[n])||(t.specific_source_parameter[n]=a)}}}},setTaggerOpenedByCode:function(e){this._taggerOpenedByCode=e},isTaggerOpenedByCode:function(){return this._taggerOpenedByCode},getResultArgsFromSearchArgs:function(e){var t={};switch(e.to){case"onSearch":var i=e.options;t.search_criteria=i.value,t.adv_search=i.adv_search,t.search_mode=i.search_mode,t.recent_filter=i.sFilter,t.search_criteria_to_display=i.searchStringToDisplayInSearchField,t.internalSearchCriteria=i.internalSearchCriteria,t.displayValue=i.displayValue,t.source=i.source,t.viewData=i.viewData,t.in_apps_search=i.customization_options,t.tag_filter=i.tag_filter,t.savedSearch=i.savedSearch;break;case"init":var r=e.preferences_wdg;t.incontext_global_actions=r.incontext_global_actions,t.in_apps_search=r.customization_options,t.transient_context="true",t.css_view_class="maximized",t.search_options={search_criteria:r.search_criteria,adv_search:r.adv_search,search_criteria_to_display:r.search_criteria_to_display,search_mode:"index",tag_filter:r.reSearch,source:r.source},t.viewData=r.viewData,t.result_ux_customization=r.result_ux_customization,t.tagger_context_id=e.tagger_context_id}return t},getResultInitArgs:function(e){return m.getResultArgsFromSearchArgs({to:"init",preferences_wdg:e.preferences_wdg})},getResultUpdateArgs:function(e){return m.getResultArgsFromSearchArgs({to:"onSearch",options:e.options})},checkCustomerConfigs:function(t){return e.is(this._customerConfigPromise)||(this._customerConfigPromise=new d(function(i,r){if(e.is(t,"object")&&e.is(t.resources)){var s=t.resources.getFedSearchUrl();if(e.is(s,"string")){var n={"DS/SNSearchCusto":s+"/webapps/SNSearchCusto"};require.config({paths:n});var o="text!DS/SNSearchCusto/assets/SearchCmdConfig.json";a.getOption("cmd_config_cache")||(o+="?app="+m.identifyClientInfo().identifier),require([o],function(t){try{var s=JSON.parse(t);e.is(s.require,"object")&&e.is(s.require.config,"object")&&e.is(s.require.config.paths,"object")?(require.config(s.require.config),i("customer config set as : "+JSON.stringify(s.require.config))):r(new Error("SearchCmdConfig.json is not in required format, contents = "+t))}catch(e){r(new Error("Issue during parsing SearchCmdConfig.json, error = "+e+"file content = "+t))}},function(e){r(new Error("Issue during require of SearchCmdConfig.json, error = "+e.message))})}else r(new Error("Invalid federated Service Base URL"))}else r(new Error("Invalid Inputs"))})),this._customerConfigPromise},is6WInWebInWinActive:function(){return!0===a.getOption("W6_In_WebInWin")},isSearchDropDownActive:function(){return!0},isWebInWin:function(){return!!e.is(a.getOption("search_web_in_win"),"boolean")&&a.getOption("search_web_in_win")},getValidDatasources:function(t){var i={},r=t.dataSourcesToFilterFromAdvancedSearch||a.getOption("dataSourcesToFilterFromAdvancedSearch");e.is(r)||(r={});var s=a.getOption("RDFDataSources");if(e.is(s)||(s={}),e.is(t)){var n=t.dataSources;if(e.is(n,"array")){for(var o=[],c=[],l=[],d=0;d<n.length;d++){var u=n[d];if(!0===u.status){var p=u.name;e.is(r[p])||e.is(s[p])?e.is(s[p])&&(e.is(u.service)?l.push(u.service):l.push(u.name)):(o.push(p),e.is(u.service)?c.push(u.service):c.push(u.name))}}o=o.filter(function(e,t,i){return i.indexOf(e)===t}),l.length>0&&(o.push("other"),o.push(o.splice(o.indexOf("other"),1)[0])),i.dataSourceNames=o,i.dataSourceServices=c,i.otherDataSourceServices=l}}return i},getValidDatasourcesWithConfiguration:function(t){var i={},r=a.getOption("dataSourcesToFilterFromAdvancedSearch");e.is(r)||(r={});var s=a.getOption("RDFDataSources");if(e.is(s)||(s={}),e.is(t)){var n=t.dataSources;if(this._chosen_dataSource.length<1&&(this._chosen_dataSource=o.getItem("dataSource")||[]),e.is(n,"array")){for(var c=[],l=[],d=[],u=0;u<n.length;u++){var p=n[u];if(!0===p.status){var h=p.name;(this._chosen_dataSource.length<1||this._chosen_dataSource.indexOf(h)>-1)&&(e.is(r[h])||e.is(s[h])?e.is(s[h])&&(e.is(p.service)?d.push(p.service):d.push(p.name)):(c.push(h),e.is(p.service)?l.push(p.service):l.push(p.name)))}}c=c.filter(function(e,t,i){return i.indexOf(e)===t}),d.length>0&&(c.push("other"),c.push(c.splice(c.indexOf("other"),1)[0])),i.dataSourceNames=c,i.dataSourceServices=l,i.otherDataSourceServices=d}}return i},getAdminCustoDefinition:function(){if(!e.is(this._adminCusto))try{sessionStorage&&sessionStorage.getItem("SearchColumnCustoAdmin.json")&&(this._adminCusto=JSON.parse(sessionStorage.getItem("SearchColumnCustoAdmin.json"))),e.is(this._adminCusto)||(this._adminCusto=JSON.parse(g))}catch(e){f.error("Error parsing SearchColumnCustoAdmin.json:",e)}return this._adminCusto},_getPredicateTypeFromDataType:function(t){var i="",r="string";return e.is(t)&&e.is(t.range)&&e.is(t.range.dataTypes)&&e.is(t.range.dataTypes.length)?"http://www.w3.org/2001/XMLSchema#string"===(i=t.range.dataTypes[0])?r="string":"http://www.w3.org/2001/XMLSchema#boolean"===i?r="boolean":"http://www.w3.org/2001/XMLSchema#integer"===i?r=e.is(t.rangeValues,"object")&&Object.keys(t.rangeValues).length>0?"string":"integer":"http://www.w3.org/2001/XMLSchema#dateTime"===i?r="date":"http://www.w3.org/2001/XMLSchema#date"===i?r="date":"http://www.w3.org/2001/XMLSchema#double"===i?r="double":"http://www.w3.org/2001/XMLSchema#real"===i?r="double":"http://www.w3.org/2001/XMLSchema#timestamp"===i?r="date":"http://www.w3.org/2001/XMLSchema#time"===i&&(r="date"):e.is(t.type)&&(r=t.type),r},ensureBetaStatus:function(){var t=this;return e.is(this._isInTheSimpleSearchModePromise)||(this._isInTheSimpleSearchModePromise=new d(function(e){!0===a.getOption("newSearch19xFD02")&&!0===a.getOption("predefinedBetaUser")||!0===t.isOneSearchInternalProd()?o.getPreference({name:"3DSearchOptions",onComplete:function(){t._isInTheSimpleSearchModePromiseStatus="resolved",e(t.isInTheSimpleSearch())},onFailure:function(){t._isInTheSimpleSearchModePromiseStatus="resolved",e(t.isInTheSimpleSearch())}}):(t._isInTheSimpleSearchModePromiseStatus="resolved",e(t.isInTheSimpleSearch()))})),this._isInTheSimpleSearchModePromise},isOneSearchInternalProd:function(){var t=a.getOption("DoNotRestoreSearchChoice"),i=a.getOption("OneSearch"),r=m.identifyClientInfo(),s=!1;return!0!==t&&!0===i&&!0===a.getOption("internalProd")&&(!e.is(r,"object")||"3DDashboard"!==r.identifier&&"3DSwym"!==r.identifier||(s=!0)),s},isInTheSimpleSearch:function(){if(e.is(this._isInTheSimpleSearchMode))return this._isInTheSimpleSearchMode;this._isInTheSimpleSearchMode=a.getOption("simple_search_experience");var t=!1;if(!0===a.getOption("internalProd")){var i=m.identifyClientInfo();e.is(i,"object")&&"3DDashboard"===i.identifier&&(t=!0)}var r=a.getOption("OneSearch");if(e.is(a.options.url_search_settings.simple_search_experience))this._isInTheSimpleSearchMode=a.options.url_search_settings.simple_search_experience;else if(e.is(a.getOption("Odt_simple_search")))this._isInTheSimpleSearchMode=a.getOption("Odt_simple_search");else if(!0!==r||!0!==a.getOption("search_web_in_win")&&!a.getOption("addinmode")){var s=a.getOption("newSearch19xFD02"),n=a.getOption("predefinedBetaUser");if(!0===s&&!0===n){var c=o.getItem("simple_search_experience");e.is(c,"boolean")&&(this._isInTheSimpleSearchMode=c),!0===this._isInTheSimpleSearchMode&&(t=!1)}}else this._isInTheSimpleSearchMode=!0;return this.isOneSearchInternalProd()&&(t=o.getItem("find_in_this_tab_default")),a.changeSettingForBETA_deactivated({find_in_this_tab_default:t}),!1===this._isInTheSimpleSearchMode?a.changeSettingForFD01():a.changeSettingForBETA(),e.is(this._isInTheSimpleSearchMode)&&(a.options.search_settings.simple_search_experience=this._isInTheSimpleSearchMode),this._isInTheSimpleSearchMode},isSnippetAvailable:function(t){var i=!0;return!1===a.getOptionPerTenant("search_snippet_admin",{tenant:t})&&(i=!1),!0===a.getOption("OneSearchOFF")&&(i=!1),e.is(a.getOption("search_snippet"),"boolean")&&(i=a.getOption("search_snippet")),i},isSuggestAvailable:function(t){var i=!0;return!1===a.getOptionPerTenant("suggest_admin",{tenant:t})&&(i=!1),!0===a.getOption("OneSearchOFF")&&(i=!1),e.is(a.getOption("suggest"),"boolean")&&(i=a.getOption("suggest")),i},isCompactModeEnforced:function(e){var t=!0;return!0!==a.getOptionPerTenant("mobile_experience_admin",{tenant:e})&&(t=!1),t},isMobile:function(){return-1!==["iphone","ipad","android"].indexOf(m.getDeviceCategory())},isBetaEnabledForUser:function(){var t=!0,i=a.getOption("predefined_beta_users"),r=this.getUserId();return e.is(r)&&e.is(i,"array")&&(t=i.indexOf(r)>=0||i.indexOf(r.toUpperCase())>=0),t},setUserSpecificSettings:function(){a.changeSettings({predefinedBetaUser:this.isBetaEnabledForUser()})},activateCompactOrComfortMode:function(){var t=a.getOption("OneSearch");if(e.is(t)&&!0===t){let e=!1;"mobile"===m.getDeviceType()&&(e=!0),a.setCompactMode(e)}},isTabletCompactMode:function(){let t=!1,i=screen.availWidth;return"tablet"===m.getDeviceType()&&("portrait"===m.getViewportOrientation()?t=!0:e.is(i)&&i<700&&(t=!0)),t},getHierarchyClass:function(t){if(e.is(t)){var i={method:"POST"};i.headers=t.headers||{},i.headers["Content-Type"]="application/xml",i.headers.Accept="application/json",i.url=t.searchmodel.getFederatedSource().get3DSpaceUrl()+"/i3dx/services/xmql?tenant="+t.searchmodel.getFederatedSource().getActiveTenant();var r='<?xml version="1.0" encoding="utf-8"?>\n';r+='<executeSequence xmlns="http://www.3ds.com/xmql/query">\n',r+="\t<execute>\n",r+="\t\t<function>get_parents_bus_type</function>\n",r+="\t\t<version>1.0.0</version>\n",r+="\t\t<params>\n",r+='\t\t\t<param name="type">'+t.searchmodel.get("ds6w:type_value")+"</param>\n",r+="\t\t</params>\n",r+="\t</execute>\n",r+="</executeSequence>\n",i.data=r,i.onComplete=function(i){var r=[];try{var s=JSON.parse(i);if(e.is(s)&&(r=JSON.parse(s.xmql_response.body.result[2].output),e.is(r,"array"))){r.reverse(),r.push(t.searchmodel.get("ds6w:type_value"));var n=t.searchmodel.get("ds6w:kind_value");e.is(n,"array")?r=r.concat(n):e.is(n,"string")&&r.push(n)}Array.isArray(r)||(r=[])}catch(e){r=[]}e.is(t.onComplete,"function")&&t.onComplete.call(null,r)},i.onFailure=function(i){e.is(t.onFailure,"function")&&t.onFailure.call(null,i)},l.authenticatedRequest(i.url,i)}},getSourceToPredicateMapping:function(){var t=[];return e.is(this._sourceToPredicateMapping,"object")&&e.is(this._sourceToPredicateMapping.SourceToPredicate)&&(t=this._sourceToPredicateMapping.SourceToPredicate),t},getMinimalWidthForInformationPanelAvailability:function(){return 870},getCSVSeparatorValueFromId:function(t,i){let r,s;if(e.is(a)&&e.is(a._tenantSettings)&&e.is(a._tenantSettings[t])&&e.is(a._tenantSettings[t].search_settings)&&(s=a._tenantSettings[t].search_settings),e.is(s,"object")&&e.is(s.defaultCsvSeparator,"object")&&e.is(s.defaultCsvSeparator.id,"string")){let t=null;if(e.is(a.options)&&e.is(a.options.csvSeparatorArray,"array"))for(let i=0,n=(t=a.options.csvSeparatorArray).length;i<n;i++)e.is(t[i],"object")&&e.is(t[i].id,"string")&&t[i].id===s.defaultCsvSeparator.id&&e.is(t[i].value,"string")&&(r=t[i].value)}return r},isInternalProduction:function(){return!0===a.getOption("internalProd")||"DSEXT001"===this.getActiveTenant()&&["3DDashboard","3DSpace","3DSwym"].includes(m.identifyClientInfo().identifier)},getSericeURLPromise:function(e,t){return new d(function(i,r){h.getServiceUrl({serviceName:t,platformId:e,onComplete:function(e){e?i(e):r()},onFailure:function(e){r(e)}})})},addHFTracesInConsole:function(e){p.addHFTracesInConsole(e)},htmlDecode:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},isFetchSynthesisSeparately:function(){var e=m.identifyClientInfo().identifier;return!1!==a.getOption("fetchSynthesisSeparately")&&("3DDashboard"===e||"3DSpace"===e||"3DSwym"===e||"3DEXPERIENCE"===e)},arrayUnique:function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var r=i+1;r<t.length;++r)t[i]===t[r]&&t.splice(r--,1);return t},_getQueryFromRefine:function(t,i){return"["+t.split("/").pop()+"]:("+i.reduce((t,i)=>{var r='"'+(i=e.is(i.object,"array")?i.object.join("/"):i.object)+'"';return t?t+" OR "+r:r},"")+")"},getQueryFromRefines:function(e){var t="",i=this;return e&&Object.keys(e).length>0&&Object.keys(e).forEach((r,s)=>{var n=e[r],a=i._getQueryFromRefine(r,n);a&&(t&&(t+=" AND "),t+=a)}),t},getTaggerSubjectURIForMultipleSources:function(e,t){let i=[],r={};for(let i of e){let e=i.getSourceID(),s=e||"3dspace",n={id:i.id,source:s,platform:t};r[s]?r[s].push(n):r[s]=[n]}for(let s in r){let n=m.getTaggerSubjectURI({subjects:r[s],source:s,platform:t,service:e[0].collection.get(r[s][0].id).getServiceID()});for(let t in n)i.push({uri:n[t],service:m.getTaggerService(e[0].collection.get(r[s][0].id)),tags:[]})}return i},hasTaggerSubjectURI:function(e,t){return m.getTaggerSubjectURIForMultipleSources(e,t).some(function(e){return e.uri})},clickOnSearchBETA:function(t){require(["DS/UIKIT/SuperModal","DS/WebappsUtils/WebappsUtils","DS/MessageBus/MessageBus","text!DS/SNInfraUX/assets/templates/SearchBeta.html","text!DS/SNInfraUX/assets/templates/SearchBetaEXT.html","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","css!DS/SNInfraUX/SNInfraUX"],function(i,r,s,n,a,c){let l=new i({renderTo:document.body,className:"betaWarning",closable:!0,events:{onHide:function(){e.is(t)&&e.is(t.onFailure,"function")&&t.onFailure.call(void 0)}}}),d=t&&t.state?t.state:m.isFUN109031Active(),u=m.isInternalProduction()?n:a,p=["BETA-FUN109031-modal-content-section-1","BETA-FUN109031-modal-content-section-directive-1","BETA-FUN109031-modal-content-section-directive-2","BETA-FUN109031-modal-content-what","BETA-FUN109031-modal-content-where","BETA-FUN109031-modal-content-who","BETA-FUN109031-modal-content-when","BETA-FUN109031-modal-content-feedback"];for(let e=0;e<p.length;e++)u=u.replace("###"+p[e]+"###",c.get(p[e]));u=(u=(u=(u=u.replace("###WHAT###",r.getWebappsAssetUrl("SNInfraUX","images/WHAT.png"))).replace("###WHERE###",r.getWebappsAssetUrl("SNInfraUX","images/WHERE.png"))).replace("###WHO###",r.getWebappsAssetUrl("SNInfraUX","images/WHO.png"))).replace("###WHEN###",r.getWebappsAssetUrl("SNInfraUX","images/WHEN.png")),l.dialog({body:u,title:c.get("BETA-FUN109031-modal-title"),buttons:[{className:"primary",value:!0!==d?c.get("beta_activation_ok_title"):c.get("beta_deactivation_ok_title"),action:i=>{!0!==d&&!1!==d&&(d=!1),s.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"searchBeta",persDim:{pd14:d?"disabled":"enabled"}}}),o.setItem("BETA-FUN109031",!d),o.commit(),e.is(t)&&e.is(t.onComplete,"function")?(i&&i.hide(),t.onComplete.call(void 0,!d)):location.reload(!0)}}]})})},getRandomInteger:function(e,t){return Math.floor(Math.random()*(t-e)+e)},formatDate:function(e,t,i={}){let r=this,s=Object.keys(this._dateInternationalFormats).find(e=>r._dateInternationalFormats[e]===t);return void 0===s&&(s=void 0!==t?t:"",void 0===this._dateInternationalFormats[s])?(f.log("Format Date, format "+t+" is not known."),null):void 0!==s?new Intl.DateTimeFormat(s.toLowerCase(),i).format(e):null},buildNotification:function(t,i,r=null){let n=s.create("div",{class:"wux-notification-container",attributes:{"notification-level":"info"}}).inject(t),o=s.create("div",{class:"wux-notification-band"}).inject(n);s.create("span",{class:"wux-notification-icon wux-ui-3ds wux-ui-3ds-info"}).inject(o);let c=s.create("button",{class:"wux-notification-close wux-ui-3ds wux-ui-3ds-wrong"}).inject(n),l=s.create("div",{class:"wux-notification-title"}).inject(n),d=s.create("div",{class:"wux-notification-text",text:v.get("FUN141960-notif-text")}).inject(l),u=s.create("a",{text:v.get("FUN141960-notif-link"),class:"notification-link"}).inject(d),p=s.create("span",{text:v.get("FUN141960-notif-link"),class:"notification-span"}).inject(d);return e.is(r)&&(r._isPinnedWidget()||r._ctx_options)||e.is(a.getOption("search_compact_mode"))&&!0===a.getOption("search_compact_mode")?(u.hide(),p.show()):(u.show(),p.hide()),u.addEventListener("click",i),c.addEventListener("click",function(){t.hide()}),n},updateDateByDays:function(e,t){let i=e.getDate()+t;e.setDate(i)},setDateDay:function(e,t){let i=t-e.getDay();e.setDate(e.getDate()+i)},getSecurityContextObject:function(){let t,i,r;if(i=e.is(this.getCurrentSearchWidget,"function")&&e.is(this.getCurrentSearchWidget())&&e.is(this.getCurrentSearchWidget().getValue,"function")?this.getCurrentSearchWidget().getValue("securityContext"):o.getItem("securityContext"+this.getActiveTenant()),e.is(i)&&(r=JSON.parse(i)),""===(t=e.is(r)&&e.is(r.csName)?r.csName:"")){let i=[];i=this.getSecurityContext3DSpace(),e.is(i,"array")&&i.forEach(function(i){if(e.is(i.isDefault)){!0===i.isDefault&&(t=i.name)}})}return t}});return m}),define("DS/SNInfraUX/utils/SearchNlsUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],function(e,t,i,r,s,n,a,o){"use strict";var c=function(e){var t=e.lastIndexOf("/");return e=t>-1?e.slice(0,e.lastIndexOf("/")+1)+e.slice(e.lastIndexOf(".")+1):e.slice(e.lastIndexOf(".")+1)};return t.singleton(i,{_policyNLS:{},init:function(){},translateFacetToObj:function(t,i,r,s){var a=/\w+:\w+\.\w+/,o="";if(e.is(t)&&e.is(t.sixw)&&e.is(t.object)){let u=t.sixw.slice(t.sixw.lastIndexOf("/")+1);if(!e.is(t.dispValue,"string")||0===t.dispValue.length){e.is(r[u])||(r[u]=[]);let p=t.object;if(e.is(p,"array")&&p.length>0){if(o=p[0],!i.has(o)){let n=e.clone(t,!0);n.object=t.object[0],this.translateFacetToObj(n,i,r,s)}let n=p.length;for(let t=0;t<n;t++)e.is(o,"array")?o.forEach(function(e,t,i){a.test(e)&&e.startsWith(u)&&(i[t]=c(e))}):a.test(o)&&o.startsWith(u)&&(o=c(o)),o=s(u,o),t<n-1&&(o+="/"+p[t+1]),i.add(o)}else o=t.object,i.add(o),a.test(o)&&o.startsWith(u)&&(o=o.slice(o.lastIndexOf(".")+1));var l={value:o},d=[];UWA.is(t.sources)&&(d.push(n.getServiceFromSource(t.sources[0])),l.source=d,UWA.is(r[u])||(r[u]=[]),r[u].push(l))}}},translateFacets:function(t){var i=t.facets,r=this,s=(t.subjectTags,t.prepareNlsPropertiesValueForServerCb||function(e,t){return t}),n={},a=new Set;e.is(i,"array")&&i.forEach((e,t)=>{r.translateFacetToObj(e,a,n,s)}),this.getNlsOfPropertiesValuesSearchTag(t,n)},getNlsOfPropertiesValuesSearchTag:function(t,i){s.groupCollapsed("SearchNlsUtils.getNlsOfPropertiesValuesSearchTag"),s.log("->subjectTags:",a),s.log("->facets:",c),s.log("->dataToComputeNlsAUWFormat:",i);var n=this,a=t.subjectTags,c=t.facets,l=t.tenantId,d=t.setNlsNameDetailsCb||function(){},u=t.prepareNlsPropertiesValueForServerCb||function(e,t){return t},p=t.addSourceCb||function(){},h=t.onComplete,g=t.onFailure;p(i=n._sanitizePredicates(i,l)),s.log("Calling SearchDictionaryAccess.getNlsOfPropertiesValues"),s.log("->dataToComputeNlsAUWFormat:",i);var f={tenantId:l,lang:o.getLanguage(),onComplete:function(t){try{s.log("<-onComplete response from SearchDictionaryAccess.getNlsOfPropertiesValues:"),s.log(t),e.is(n._policyNLS[l],"object")||(n._policyNLS[l]={});let o=t["ds6w:policy"];if(e.is(o,"object"))for(let t in o)e.is(t,"string")&&(n._policyNLS[l][t]=o[t]);d(t);var i=/\w+:\w+\.\w+/;if(e.is(a)&&Object.keys(a).forEach(function(r){a[r].forEach(function(r){if(e.is(r)&&e.is(r.sixw)&&e.is(r.object)){let o=r.sixw.slice(r.sixw.lastIndexOf("/")+1,r.sixw.length);if(e.is(t)&&e.is(t[o])&&e.is(r.object)){let s=r.object;if(e.is(s,"array")&&s.length>0){let n=s[0],c="",l="";for(let d=0,p=s.length;d<p;d++){if(i.test(n)){var a=n.lastIndexOf("/");n=a>-1?n.slice(0,n.lastIndexOf("/")+1)+n.slice(n.lastIndexOf(".")+1):n.slice(n.lastIndexOf(".")+1)}n=u(o,n),c=t[o][n],e.is(c,"string")&&l&&c.startsWith(l)&&(c=c.substring(l.length)),c!==n&&c||(c=s[d]),r.dispValue[d]=c,d<p-1&&(l=n+"/",n+="/"+s[d+1])}}else{let e=r.object;i.test(e)&&(e=r.object.slice(r.object.indexOf(".")+1)),r.dispValue=t[o][e]}if("ds6w:status"===o&&e.is(r.dispValue)){let t=null;if(e.is(s,"string")&&(t=s.split(".")[0]),e.is(n._policyNLS[l][t])){let e=n._policyNLS[l][t];r.dispValue+=" ("+e+")"}}}else s.log("Pb with "+o)}})}),e.is(c,"array")){var r={};c.forEach(function(n,a){if(e.is(n)){let l=n.sixw.slice(n.sixw.lastIndexOf("/")+1,n.sixw.length);if(e.is(t)&&e.is(t[l])&&e.is(n.object)){let s=n.object;if(e.is(s,"array")&&s.length>0){let r=s[0],a="";n.dispValue=[];var o="";for(let d=0,p=s.length;d<p;d++){if(i.test(r)){var c=r.lastIndexOf("/");r=c>-1?r.slice(0,r.lastIndexOf("/")+1)+r.slice(r.lastIndexOf(".")+1):r.slice(r.lastIndexOf(".")+1)}r=u(l,r),a=t[l][r],e.is(a,"string")&&o&&a.startsWith(o)&&(a=a.substring(o.length)),a!==r&&a||(a=s[d]),n.dispValue[d]=a,d<p-1&&(o=r+"/",r+="/"+s[d+1])}}else{let e=n.object;i.test(e)&&e.startsWith(l)&&(e=n.object.slice(n.object.indexOf(".")+1)),n.dispValue=t[l][e]}"ds6w:status"===l&&e.is(n.dispValue)&&n.sources.includes("3dspace")&&(e.is(r[n.dispValue])?r[n.dispValue].push({index:a,object:n.object}):r[n.dispValue]=[{index:a,object:n.object}])}else s.warn("Pb with "+l)}}),Object.keys(r).forEach(function(t){r[t].forEach(function(t){var i=t.object,r=null;e.is(i,"string")?r=i.split("."):s.warn("ds6wStatus is not a string :",i),e.is(r,"array")&&r.length>1&&e.is(r[0],"string")&&e.is(n._policyNLS[l][r[0]])&&(i=n._policyNLS[l][r[0]]),c[t.index].dispValue!==i&&(c[t.index].dispValue+=" ("+i+")")})})}h()}catch(e){console.log(e)}s.groupEnd()},onFailure:function(){s.error("Failure calling DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess.getNlsOfPropertiesValues !",arguments);try{g()}catch(e){console.log(e)}s.groupEnd()}};s.log("->searchDictionaryAccessOptions:",f),r.getNlsOfPropertiesValuesBySource(i,f)},getNlsOfPropertiesValuesBySource:function(e,t){r.getNlsOfPropertiesValuesBySource(e,t)},_sanitizePredicates:function(t,i){var r=[];if(!0===o.isSnippetAvailable(i)){var s=a.getOption("select_snippets");e.is(s)&&e.is(s,"object")&&(r=Object.keys(s).map(function(e){return s[e]}))}var n={};if(e.is(t)){var c=Object.keys(t);if(c.length>0&&e.is(c,"array"))for(var l=0;l<c.length;l++)if(e.is(r,"array")&&-1===r.indexOf(c[l])){for(var d=t[c[l]],u=0;u<d.length;u++);n[c[l]]=d}}return n},getResourcesInfo:function(e,t){r.getResourcesInfo(e,t)}})}),define("DS/SNInfraUX/Api/SearchApi",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings"],function(e,t,i,r,s,n,a,o,c,l){"use strict";var d=t.singleton(i,{_searchRessources:null,_searchApiPromise:r.deferred(),setResourceMgt:function(e){this._searchRessources=e,this.load(!0)},load:function(e){var t=this;return!0===e&&this._searchRessources&&(o.log("DS/SNInfraUX/Api/SearchApi load : "+this._searchRessources),a.login({resources:this._searchRessources,onComplete:function(){o.log("DS/SNInfraUX/Api/SearchApi login : onComplete"),t._searchApiPromise.resolve()},onFailure:function(){o.log("DS/SNInfraUX/Api/SearchApi login : onFailure"),t._searchApiPromise.resolve()}})),this._searchApiPromise.promise},getSearchApiPromise:function(){return this._searchApiPromise.promise},search:function(e){this._queryFedSearch(e)},_queryFedSearch:function(t){o.log("DS/SNInfraUX/Api/SearchApi _queryFedSearch : "+t);var i=this;n.getServiceUrl({serviceName:"3DSearch",platformId:t.tenant?t.tenant:i._searchRessources?i._searchRessources.getActiveTenant():void 0,onComplete:function(r){if(o.log("DS/SNInfraUX/Api/SearchApi onComplete urc : "+r),e.is(r,"string")){var n={query:t.query,order_field:t.order_field||"relevance",order_by:t.order_by||"desc",select_file:e.is(t.select_file,"array")?t.select_file:[],select_synthesis:t.select_synthesis||[],select_predicate:t.select_predicate||["ds6w:label"],label:e.is(t.label)?t.label:"3DSearch-"+c.getUserId()+"-"+(new Date).getTime(),nresults:t.nresults||40,next_start:t.next_start,source:t.source,specific_source_parameter:t.specific_source_parameter||{},tenant:t.tenant};!n.tenant&&i._searchRessources&&(n.tenant=i._searchRessources.getActiveTenant()),o.log("DS/SNInfraUX/Api/SearchApi onComplete fedsearch_data : "+n);var a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(n),onComplete:function(e){o.log("DS/SNInfraUX/Api/SearchApi onComplete onComplete : "+e);var i=JSON.parse(e);!0!==t.with_info&&delete i.infos,delete i.facets,t.onComplete(i)},onFailure:function(e){o.log(e),t.onFailure(e)}};o.log("DS/SNInfraUX/Api/SearchApi onComplete fedsearch_options : "+a),s.authenticatedRequest(r+"/search",a)}else t.onFailure()},onFailure:function(e){o.log(e),t.onFailure(e)}})},getSearchResources:function(){return this._searchRessources&&e.clone(this._searchRessources)},getSearchInfo:function(t){if(t.query)return new Promise(function(i,r){let s=e.extend(t,{with_info:!0,label:e.is(t.label)?t.label:"3DSearch-"+c.getUserId()+l.getOption("fedsearch_query_label.feature_id.TopBarSearchEstimation")+(new Date).getTime(),nresults:1,onComplete:function(e){i(e.infos)},onFailure:function(e){r(e)}});d.search(s)})}});return d}),define("DS/SNInfraUX/SearchResultCategories",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","text!DS/SNInfraUX/assets/ResultPreviewDefinition.json","text!DS/SNInfraUX/assets/defaultCustomCategory.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json"],function(e,t,i,r,s,n,a,o,c){"use strict";var l=t.singleton(i,{_promises:{},_categories:{},_categoriesJSON:{},init:function(e){this._promises={},this._categories={},this._categoriesJSON=JSON.parse(a),this._parent(e)},getResultCategories:function(e){var t=this;return this._promises[e]||(this._promises[e]=new r(function(i,r){s.getOption("deactivate_FUN108944")||-1!==["iphone","ipad","android"].indexOf(n.getDeviceCategory())?(t._loadTenantCategories(e),i()):s.getTenantSettings(e).then(function(){var r=s.getOption("result_categories",{tenant:e});t._loadTenantCategories(e,r),i()})})),this._promises[e]},getActiveCategories:function(t,i){var r=(s.getOption("activateSuggestion")+"").split(",");if(this._categories[t]&&this._categories[t][i])return this._categories[t][i].list.filter(function(e){return!1!==e.active||r.indexOf(e.id)>=0}).map(t=>e.clone(t,!0))},getCategoryTitleNls:function(e){var t="search.suggestion.group.title."+e.name,i=c.get(t);return i==t?e.name:i},_getCategoryiconInfo:function(e){let t=void 0,i=e.id,r=this._categoriesJSON.suggestion.list.length;for(let e=0;e<r;e++){let r=this._categoriesJSON.suggestion.list[e];if(r&&r.id===i){t=r.iconInfo;break}}return t},_loadTenantCategories:function(t,i){var r=JSON.parse(a);function n(t){if(t)for(var i=0;i<t.length;i++){let r=t[i];t[i].nls=l.getCategoryTitleNls(r),!0===r.custom&&t.splice(i,1,e.extend(JSON.parse(o),r)),!s.getOption("disable_InstantSearch_thumbnails")&&r.select_file&&r.select_file.indexOf("thumbnail_2d")<0&&r.select_file.push("thumbnail_2d"),e.is(r.iconInfo)||(r.iconInfo=l._getCategoryiconInfo(r)),r.with_synthesis=!1}}i&&i.suggestion&&(r.suggestion=i.suggestion),n(r.suggestion.list),n(r.result.list),this._categories[t]=r}});return l}),define("DS/SNInfraUX/SessionSecurityContextServices",["UWA/Class","UWA/Class/Debug","DS/WAFData/WAFData","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PlatformEnvServices","DS/SNInfraUX/Logger","UWA/Promise"],function(e,t,i,r,s,n,a){"use strict";return e.singleton(t,{_SCPromises:{},_SContexts:{},getSecurityContext3DSpace:function(e){var t=this;return t._SCPromises.hasOwnProperty(e)?t._SContexts.iTenantId:(t._SCPromises.iTenantId=new a(function(a,o){var c=s.getServiceURL("cstorage",e)+"/resources/bps/cspaces?tenant="+e,l={type:"json",method:"GET",proxy:"passport"};l.headers={"Content-Type":"application/ds-json","Accept-Language":r.getLanguage()},l.timeout=6e5,l.that=t,l.onComplete=function(i){var r=i.cspaces,s=[];r&&0!==r.length||(r=[]);var n="",o=!0;r.forEach(function(e){var t=e.displayName.split(".");if(3===t.length&&o){var i=t[1];""===n&&(n=i),o=n===i}}),r.forEach(function(e){var t=e.displayName,i=e.displayName.split(".");3===i.length&&(t=i[2]+" ● ",o||(t+=i[1]+" ● "),t+=i[0]),s.push({label:t,value:e.name})}),t._SContexts[e]=r,a(t._SContexts[e])},l.onFailure=function(e){n.log("getSecurityContext3DSpace:Failure..."+e),o("getSecurityContext3DSpace:Failure...")},l.ontimeout=function(){n.log("getSecurityContext3DSpace: A connection timeout occured."),o("getSecurityContext3DSpace: A connection timeout occured.")},i.authenticatedRequest(c,l)}),t._SCPromises.iTenantId)}})}),define("DS/SNInfraUX/SearchCom",["UWA/Core","UWA/Utils/InterCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],function(e,t,i,r){"use strict";return{_searchCom_server:null,_created_special_server:[],_created_socket_global:[],_created_socket:[],in3DDashboardApp:void 0,_init:function(){this._searchCom_server=new t.Server("SearchComServer",{isPublic:!1}),!0===i.getOption("debug_mode")&&(this.in3DDashboardApp=location.pathname.match(/\/3DDashboard\//))},createSocket:function(s){if(!e.is(this._searchCom_server)&&this._init(),void 0===this.in3DDashboardApp&&(this.in3DDashboardApp=r.identifyClientInfo().identifier,e.is(s)&&e.is(s.clientInfo)&&(this.in3DDashboardApp=s.clientInfo)),!e.is(s.socket_id))throw new Error("SearchCom: socket_id not found");var n=null;if(-1!==this._created_socket.indexOf(s.socket_id))throw new Error("SearchCom: socket with id "+s.socket_id+" already created");return"3DDashboard"===this.in3DDashboardApp&&s.widgetId&&-1===s.widgetId.indexOf("preview")?(-1===this._created_special_server.indexOf(s.widgetId)&&(this._searchCom_server=new t.Server("SearchComServer_"+s.widgetId,{isPublic:!1}),this._created_special_server.push(s.widgetId),this.updateGlobalSockets()),n=new t.Socket(s.socket_id,{dispacthRetryInterval:0}),i.getOption("search_web_in_win")||i.getOption("SearchComServer_odt")?n.subscribeServer("SearchComServer_"+s.widgetId,window):n.subscribeServer("SearchComServer_"+s.widgetId),this._created_socket.push(s.socket_id)):(n=new t.Socket(s.socket_id,{dispacthRetryInterval:0}),i.getOption("search_web_in_win")||i.getOption("SearchComServer_odt")?n.subscribeServer("SearchComServer",window):n.subscribeServer("SearchComServer"),this._created_socket.push(s.socket_id),this._created_socket_global.push(n),this.subscribeServer_global(n)),n},updateGlobalSockets:function(){var e=this;this._created_socket_global.forEach(function(t){e.subscribeServer_global(t)})},subscribeServer_global:function(e){"searchview_socket_id"!==e.id&&this._created_special_server.forEach(function(t){var r="SearchComServer_"+t;!e.servers[r]&&e&&(i.getOption("search_web_in_win")||i.getOption("SearchComServer_odt")?e.subscribeServer(r,window):e.subscribeServer(r))})},unsubscribeServer:function(t){if(e.is(t)&&0!==this._created_special_server.length){var i=this;this._created_socket_global.forEach(function(e){i._created_special_server.forEach(function(i){var r="SearchComServer_"+i;t===i&&e.servers[r]&&e.unsubscribeServer(r)})})}},deleteServer:function(e){this._created_special_server=this._created_special_server.filter(e=>{})},deleteSocket:function(t){var i=this._created_socket.indexOf(t);if(-1!==i){this._created_socket.splice(i,1);var r=null,s=null,n=null;for(s=0;s<this._created_socket_global.length;s++)if(n=this._created_socket_global[s],e.is(n)&&e.is(n.id)&&n.id===t){r=n;break}s&&null!==r&&(this._created_socket_global.splice(s,1),this._created_special_server.forEach(function(e){var t="SearchComServer_"+e;n.servers[t]&&r.unsubscribeServer(t)}))}}}}),define("DS/SNInfraUX/SNVocabAccess",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/WAFData/WAFData","UWA/Class/Model","UWA/Class/Collection","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","UWA/Promise","DS/SNInfraUX/SearchUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(e,t,i,r,s,n,a,o,c,l,d,u){"use strict";var p=n.extend({idAttribute:"name"}),h=n.extend({idAttribute:"uri"}),g=n.extend({idAttribute:"className"}),f=t.singleton(i,r,{_cacheVocabularyInfo:{},_cacheInterfacesInfo:{},_cachePredicatesInfo:{},_vocabPromises:{},_interfacePromises:{},_predicatePromises:{},_fedPropertiesPromise:{},init:function(){},setResources:function(e){this.setOptions(e)},loadVocabularyClasses:function(t,i){if(o.groupCollapsed("SNVocabAccess.loadVocabularyClasses"),!e.is(t,"object"))throw o.error("INVALID STATE: loadVocabularyClasses is called with incorrect arguments",t),new Error("INVALID STATE: loadVocabularyClasses is called with incorrect arguments");o.log("requestedVocabData : ",t);var r=t.vocabId,s=t.tenantId,n=t.lang,p=t.rdfSources;this.log("loadVocabulary called for vocabId : "+r);var g=this;if(!e.is(s)){var f=this.getOption("resources");if(!e.is(f))throw new Error("INVALID STATE: loadVocabularyClasses is called before doing setResources");s=f.getActiveTenant()}e.is(n)||(n=d.getLanguage()),e.is(this._vocabPromises[r])||(this._vocabPromises[r]=new l(function(t,i){g._cacheVocabularyInfo[r]={info:new a([],{model:h})};var l={tenantId:s,lang:n,apiVersion:"R2019x"};!0===c.getOption("SEARCH_INSTANCES",{tenant:s})&&(l.includeInstances=!0,delete l.apiVersion),l.onComplete=function(s){var n=function(t,i){let r=[];if(!e.is(i,"array"))return o.error("Bad arg when calling loopOnClasses",i),r;let s=null;for(let a=0;a<i.length;a++)if(s=i[a],e.is(s,"object")&&(e.is(s.curi,"string")||e.is(s.uri,"string"))){var n=s.label||s.nlsName||s.curi||s.uri;r.push({nlsName:n,uri:s.curi||s.uri,type:s.type,service:e.is(t,"string")?t:"3dspace"})}else o.error("Invalid data : ",s);return r};try{if(e.is(s,"string")&&0>=s.length)return o.warn("Empty response for vocabulary : "+r),void i(new Error("Empty response for vocabulary"));var a=null;if(e.is(s,"string")&&s.length>0)try{a=JSON.parse(s)}catch(e){o.error("Error parsing response:",e)}else a=s;o.log("Successfully loaded the vocabulary : "+r);var l={};if(Array.isArray(a)){l.vocabularyClassInfo=[];let t=null;for(let i=0;i<a.length;i++){if(!e.is(a[i])){o.error("Unexpected data structure returned by FedDictionaryAccess.getServiceClasses (invalid element in returned array,  index = "+i+") :",a);continue}let r=a[i].service;if(o.log("Treating service "+r),t=a[i].classes,e.is(t))l.vocabularyClassInfo=l.vocabularyClassInfo.concat(n(r,t));else{if(!e.is(a[i].vocabularies,"array")){o.error('Unexpected data structure returned by FedDictionaryAccess.getServiceClasses (no "classes" or "vocabularies" property found on '+i+" element) :",a);continue}for(let t=0,s=a[i].vocabularies.length;t<s;t++)e.is(a[i].vocabularies[t],"object")&&e.is(a[i].vocabularies[t].classes||a[i].vocabularies[t].vocabularyClassInfo,"array")?l.vocabularyClassInfo=l.vocabularyClassInfo.concat(n(r,a[i].vocabularies[t].classes||a[i].vocabularies[t].vocabularyClassInfo)):o.error("Unexpected data structure returned by FedDictionaryAccess.getServiceClasses json_nls["+i+"].vocabularies.classes is not an array",a)}}}else l=a;var d=c.getOption("vocabToExtend_"+r,!1);if(e.is(d)&&!0===d.includeCommonClasses)for(var u=d.commonClasses,p=u.length-1;p>=0;p--)l.vocabularyClassInfo.push({uri:u[p]});l.vocabularyClassInfo.sort(function(t,i){var r=t.nlsName;e.is(r)||(r=t.uri),r=r.toUpperCase();var s=i.nlsName;return e.is(s)||(s=i.uri),r<(s=s.toUpperCase())?-1:r>s?1:0}),g._cacheVocabularyInfo[r].info.add(l.vocabularyClassInfo),t()}catch(e){o.error("Exception caught in SNVocabAccess.loadVocabularyClasses.onComplete ! :"+e),i(new Error("Exception caught in SNVocabAccess.loadVocabularyClasses.onComplete"))}},l.onFailure=function(e,t){o.log("FAILED to load the vocabulary : "+r,e,t),i(new Error("FAILED to load the vocabulary"))},"other"===r?u.getServiceClasses(p,l):u.getServiceClasses(r,l)}));var y=function(){e.is(i)&&i({classInfos:g._cacheVocabularyInfo[r].info.toJSON()}),o.groupEnd()};this._vocabPromises[r].then(y,y)},getVocabularyClasses:function(e){if(this._cacheVocabularyInfo[e]&&this._cacheVocabularyInfo[e].info.length>0)return this._cacheVocabularyInfo[e].info.toJSON()},_getRDFServiceIdByClassName:function(e){var t="";if(this._cacheVocabularyInfo.other&&this._cacheVocabularyInfo.other.info.length>0)for(var i=this._cacheVocabularyInfo.other.info.toJSON(),r=0;r<i.length;r++)if(i[r].uri===e){t=i[r].service;break}return t},loadRelevantInterfaces:function(t,i){var r=t.className,s=t.lang;e.is(s)||(s=d.getLanguage()),r=r.replace("ds6wg:","");var n=this;e.is(this._interfacePromises[r])||(this._interfacePromises[r]=new l(function(i,c){n._cacheInterfacesInfo[r]={info:new a([],{model:p})};var l={};if(e.is(t.currentDataSource)?"other"===t.currentDataSource?l.serviceName=n._getRDFServiceIdByClassName(r):l.serviceName=t.currentDataSource:l.serviceName="3DSpace",e.is(t.tenantId))l.tenantId=t.tenantId;else{var d=n.getOption("resources");e.is(d)&&(l.tenantId=d.getActiveTenant())}l.lang=s,l.onComplete=function(t){o.log("Successfully loaded the vocabulary : "+r);var s=null;if(e.is(t,"string")&&t.length>0)try{s=JSON.parse(t)}catch(e){o.error("Error parsing response:",e)}else s=t;s.extensions.sort(function(e,t){return e.label.toUpperCase()<t.label.toUpperCase()?-1:e.label.toUpperCase()>t.label.toUpperCase()?1:0});for(var a=s.extensions,c=[],l=0;l<a.length;l++){var d={name:a[l].curi,nlsName:a[l].label};c.push(d)}n._cacheInterfacesInfo[r].info.add(c),i()},l.onFailure=function(e,t){o.log("FAILED to load the vocabulary : "+r,e,t),c(new Error("FAILED to load the vocabulary"))},u.getExtensionsForClass(r,l)}));var c=function(){e.is(i)&&i({interfaces:n._cacheInterfacesInfo[r].info.toJSON()})};this._interfacePromises[r].then(c,c)},RemoveDuplicateJsonObj:function(t,i){if(e.is(t)){for(var r=[],s=0;s<t.length;s++)if(t[s].hasOwnProperty(i)){let e=0;for(e=0;e<r.length&&t[s][i]!==r[e][i];e++);e===r.length?r.push(t[s]):o.log(t[s].nlsName+" is ignored : DUPLICATE :"+t[s][i])}return r}},loadRelevantPredicates:function(t,i){if(!e.is(t,"object"))throw new Error("INVALID STATE: loadRelevantPredicates is called with incorrect arguments");let r=t.className;r&&!e.is(r,"array")&&(r=[r]);var s=t.tenantId,n=this;if(!e.is(s)){var c=this.getOption("resources");if(!e.is(c))throw new Error("INVALID STATE: loadRelevantPredicates is called before doing setResources");s=c.getActiveTenant()}var p=[],h=[];if(r.forEach(t=>{t.indexOf(":")!==t.lastIndexOf(":")&&t.startsWith("ds6wg:")&&(t=t.substring(6)),e.is(this._predicatePromises[t])||(p.push(t),this._predicatePromises[t]=new l(function(e,i){n._cachePredicatesInfo[t]={status:"waiting",info:new a([],{model:g}),resolvePromise:function(){e()},rejectPromise:function(){i(new Error("Empty response given by FedDictionaryAccess.getPropertiesForClass"))}}}),h.push(this._predicatePromises[t]))}),p.length>0){e.is(t.serviceName)?"other"===t.serviceName&&(t.serviceName=n._getRDFServiceIdByClassName(p[0])):t.serviceName="3DSpace";var y=function(){p.forEach(e=>{o.log("Response Object is EMPTY : "+e),n._cachePredicatesInfo[e].rejectPromise()})},_={tenantId:s,lang:d.getLanguage(),serviceName:t.serviceName,onComplete:function(t){o.log("Successfully loaded the vocabulary : "+t);var i=null;if(e.is(t,"string")&&t.length>0)try{i=JSON.parse(t)}catch(e){o.error("Error parsing response:",e)}else i=t;e.is(i)?e.is(i.classPredicates,"array")&&i.classPredicates.length>0&&i.classPredicates.forEach(t=>{if(e.is(t,"object")&&e.is(t.vocabularyPredicateInfo,"array")&&t.vocabularyPredicateInfo.length>0){let e=[];e=f.RemoveDuplicateJsonObj(t.vocabularyPredicateInfo,"uri"),n._cachePredicatesInfo[t.className].info.add(e),n._cachePredicatesInfo[t.className].resolvePromise()}else o.log("Response Object is EMPTY : "+t.className),n._cachePredicatesInfo[t.className].rejectPromise(new Error("Empty response given by FedDictionaryAccess.getPropertiesForClass"))}):y()},onFailure:function(e,t){o.log("FAILED to load the vocabulary : ",e,t),y()}};d.isODTMode()?u.getPropertiesForClass(p.join(","),_,t):u.getPropertiesForClass(p.join(","),_)}var S=function(){if(e.is(i)){let r=[];e.is(t.className,"array")?t.className.forEach(e=>{r.push({type:e,vocabularyPredicateInfo:n._cachePredicatesInfo[e].info.toJSON()})}):r={type:t.className,vocabularyPredicateInfo:n._cachePredicatesInfo[t.className].info.toJSON()},i(r)}};l.all(h).then(S,S)},loadPLMSuggestList:function(t,i){var r=this.getOption("resources");if(!e.is(r))throw new Error("INVALID STATE: loadPLMSuggestList is called before doing setResources");var n=d.getLanguage(),a=c.getOption("PLMParamNLS"),l="plmparam.title";e.is(a,"object")&&e.is(a[n],"string")&&(l=a[n]);var u,p=new Date;u="3DSearch-"+d.getUserId()+"-"+p.getTime();var h=r.getFetchOptions({service_name:"listAvailablePamameters",service_data:{query:"type:PlmParameter AND ["+l+"]:("+t+")",order_field:"plmparam.title",select_predicate:[l,"plmparam.itf","plmparam.displayunit","plmparam.title"],label:u,source:["3dspace"],nresults:101}});h.onComplete=function(r){o.log("Successfully loaded the suggest list for : "+t);var s=null;if(e.is(r,"string")&&r.length>0)try{s=JSON.parse(r)}catch(e){o.error("Error parsing response:",e)}else s=r;if(e.is(i,"function")){var n={plmtitle:t,info:s.results};i(n)}},h.onFailure=function(e,t){o.log("Failure loaded the suggest list for : "+t)},s.authenticatedRequest(h.url,h)},loadSearchSuggestList:function(t,i,r){var n=this.getOption("resources");if(!e.is(n))throw new Error("INVALID STATE: loadSearchSuggestList is called before doing setResources");var a=n.getFetchOptions({service_name:"listSuggestPamameters",service_data:t});a.onComplete=function(t){o.log("Successfully loaded the suggest list for : ");var r=null;if(e.is(t,"string")&&t.length>0)try{r=JSON.parse(t)}catch(e){o.error("Error parsing response:",e)}else r=t;e.is(i,"function")&&i(r)},a.onFailure=function(t,i){o.log("Failure loaded the suggest list for : "+i),e.is(r,"function")&&r()},s.authenticatedRequest(a.url,a)},_sendCallbacks:function(e,t){for(var i=e.length,r=0;r<i;r++)e[r].call(void 0,t)},getVocabularyName:function(t){var i={"3dspace":"3DSpace",swym:"3DSwym",drive:"3DDrive"};return e.is(i[t])?i[t]:t},IsClassAnInstance:function(t){this.log("IsClassAnInstance called for "+t);var i=!1,r=t.split(":");if(2===r.length){var s=r[0];if(e.is(this._cacheVocabularyInfo[s])||"ds6wg"==s&&(s=this.getVocabularyName("3dspace")),e.is(this._cacheVocabularyInfo[s])){var n=this._cacheVocabularyInfo[s].info.get(t);e.is(n)&&"Instance"===n.get("type")&&(i=!0)}}return i},updateRootInPredicateLineage:function(t){var i=this.options.resources,r=e.is(i)?i.getActiveTenant():"OnPremise",s=d.getLanguage();return new l(i=>{var n={},a="";n.tenantId=r,n.lang=s,n.onComplete=function(r){e.is(r,"array")&&t.forEach(t=>{const i=r.find(function(e){return e.curi===t.sixw});e.is(i)&&(t.root6w=i.lineage)}),i(t)},n.onFailure=function(){i(t)},e.is(t)?(t.forEach(t=>{var i=t.sixw;e.is(i)&&1===i.split("/").length&&!a.includes(i)&&(a+=a.length>0?","+t.sixw:t.sixw)}),a.length<1?i(t):u.getPropertiesRoots(a,n)):i(t)})},getAllVocabPredicatesInfo:function(e){return this._fedPropertiesPromise[e]||(this._fedPropertiesPromise[e]=new l(function(t,i){u.getFedProperties({tenantId:e,apiVersion:"R2021x",lang:d.getLanguage(),onComplete:function(e){t(e)},onFailure:function(e){i(e)}})})),this._fedPropertiesPromise[e]},getFedProperties:function(e){u.getFedProperties(e)},getPropertiesRoots:function(e,t){u.getPropertiesRoots(e,t)}});return f}),define("DS/SNInfraUX/SNUnitConversion",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SNPLMDictionary","DS/SNInfraUX/utils/SNPreferenceUtil"],function(e,t,i,r,s,n,a,o,c){"use strict";return t.singleton(r,i,{name:"DS_SNInfraUX_SNUnitConversion",_predicateDimensionName:{},_manipulationUnit:{},init:function(){this.setDebugMode(s.getDebugMode())},setResources:function(e){n.setResources({resources:e}),o.setResources({resources:e})},getPreferredUnitLabelForPredicate:function(e){var t=this,i=e.predicates,r=e.callback,s={};i.forEach(function(e){if(e.startsWith("ds6wg")){var i=t._manipulationUnit[e],r=t._predicateDimensionName[e],n=o.getUnitNLSForDimension(r,i);s[e]=n}}),r(s)},loadManipulationUnitForTypePredicates:function(t,i){var r=this;n.loadRelevantPredicates({className:t},function(t){t.forEach(t=>{var s=t.vocabularyPredicateInfo;s&&s.forEach(function(t){var i=e.is(t.lineage)?t.lineage:t.uri,s=t.manipulationUnit;s&&s.trim().length>0&&(r._manipulationUnit[i]=s.trim()),t.dimension&&(r._predicateDimensionName[i]=t.dimension)}),i(t.type)})})},getManipulationUnitForPredicateURI:function(t){var i=this._predicateDimensionName[t];if(i){var r=c.getPreferenceUnitForDimension(i);if(e.is(r))return r.unitInternal}return this._manipulationUnit[t]},getDimensionNameForPredicateURI:function(e){return this._predicateDimensionName[e]},convertValues:function(t){var i=t.data,r=t.callback,n=t.toPreferredUnit,a=t.predicate2Type,l=e.is(t.extsToLoad,"array")?t.extsToLoad:[],d=this,u=function(){var t={},a={},l={Data:[]};Object.keys(i).forEach(function(e){var t=d.getManipulationUnitForPredicateURI(e);if(t){var r,s,a=i[e].join(";"),c=d.getDimensionNameForPredicateURI(e),u=o.getMKSUnitNameForDimensionName(c);n?(r=u,s=t):(r=t,s=u),r!==s&&l.Data.push({UnitFrom:r,UnitTo:s,Dimension:c,Values:a})}});var u=function(){var r=s.getOption("preferredUnit_decimals");Object.keys(i).forEach(function(s){var l=i[s];t[s]={};var u,p=d.getManipulationUnitForPredicateURI(s),h=d.getDimensionNameForPredicateURI(s),g="";if(h&&(u=o.getMKSUnitNameForDimensionName(h)),p){var f=n?u:p,y=n?p:u;if(n){var _=c.getPreferenceUnitForDimension(h);g=e.is(_)?_.unitSymbol:o.getUnitNLSForDimension(h,y)}l.forEach(function(i){var o;a[f]&&(o=a[f][y]);var c=o&&o[i]?1*o[i]:i;n&&e.is(r,"number")&&(c=1*(Math.round(c+"e"+r)+"e-"+r));var l=c;g.length>0&&(l=l+" "+g),t[s][i]=l})}else n&&u&&(g=o.getUnitNLSForDimension(h,u)),i[s].forEach(function(e){var i=e;g.length>0&&(i=i+" "+g),t[s][e]=i})})};l.Data.length>0?o.loadConvertedMKSValues(l,function(e){e.forEach(function(e){var t=e.UnitFrom,i=e.UnitTo,r=e.ValuesToConvert.split(";"),s=e.ConvertedValues.split(";");a[t]||(a[t]={}),a[t][i]||(a[t][i]={});for(var n=a[t][i],o=0;o<r.length;o++)n[r[o]]=s[o]}),u.call(),r(t)}):(u.call(),r(t))},p={},h=function(e){p[e]=!0,Object.keys(p).every(function(e){return p[e]})&&o.loadDictionary().then(u)};if(Object.keys(i).length>0){let t=[];Object.keys(i).forEach(function(i){var r=a[i];e.is(r,"array")||(r=[r]),r.forEach(i=>{i.startsWith("ds6wg:")&&(e.is(p[i])||(p[i]=!1,s.getOption("concatTypesToPredicatesAPI")?t.push(i):d.loadManipulationUnitForTypePredicates([i],h)))})}),l.length>0&&l.forEach(function(t){t="ds6wg:"+t,e.is(p[t])||(p[t]=!1,d.loadManipulationUnitForTypePredicates([t],h))}),s.getOption("concatTypesToPredicatesAPI")&&t.length>0&&d.loadManipulationUnitForTypePredicates(t,h),0===Object.keys(p).length&&r({})}else r({})}})}),define("DS/SNInfraUX/keywords/SNKeywordManager",["UWA/Core","UWA/Class","UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","text!DS/SNInfraUX/assets/keywords/KeywordDefinition.json"],function(e,t,i,r,s,n,a){"use strict";var o=t.singleton({Macros:{TODAY_START:"{TODAY_START}",TODAY_END:"{TODAY_END}",THIS_WEEK_START:"{THIS_WEEK_START}",THIS_WEEK_END:"{THIS_WEEK_END}",THIS_MONTH_START:"{THIS_MONTH_START}",THIS_MONTH_END:"{THIS_MONTH_END}",THIS_YEAR_START:"{THIS_YEAR_START}",THIS_YEAR_END:"{THIS_YEAR_END}",LAST_YEAR_START:"{LAST_YEAR_START}",LAST_YEAR_END:"{LAST_YEAR_END}"},init:function(e){this._keywordDefinitions=JSON.parse(a)},isKeywordsActivated:function(){return s.getOption("activateKeywords")},processKeywords:function(e){return e&&this.isKeywordsActivated()&&(e=this.expandValueKeywords(e),e=this.expandMe(e),e=this.expandWhenKeywords(e)),e},expandValueKeywords:function(e){let t=this;return e=(e=e.replace(/\$BY\s*:\s*(\$ME|[*'"].*?[*'"])/gi,function(e,i){"$ME"===i&&(i="{USER_FULLNAME}");let r=t.getKeywordQuery("BY");return r&&(i[0]!==i[i.length-1]||'"'!=i[0]&&"'"!=i[0]||(i=i.substring(1,i.length-1)),e=r=r.replaceAll("{USER_NAME}",i)),e})).replace(/(\w+|\[\s*\w+:\w+\s*\])\s*(:|>|>=|<|<=)\s*\$(ME|TODAY|THIS_WEEK|THIS_MONTH|THIS_YEAR|LAST_YEAR)/gi,function(e,t,i,r){if("ME"===r){return t.concat(':"{USER_FULLNAME}"')}var s="",n="";switch(r){case"TODAY":":"===i?(s=o.Macros.TODAY_START,n=o.Macros.TODAY_END):">"===i?s=o.Macros.TODAY_END:">="===i?s=o.Macros.TODAY_START:"<"===i?n=o.Macros.TODAY_START:"<="===i&&(n=o.Macros.TODAY_END);break;case"THIS_WEEK":":"===i?(s=o.Macros.THIS_WEEK_START,n=o.Macros.THIS_WEEK_END):">"===i?s=o.Macros.THIS_WEEK_END:">="===i?s=o.Macros.THIS_WEEK_START:"<"===i?n=o.Macros.THIS_WEEK_START:"<="===i&&(n=o.Macros.THIS_WEEK_END);break;case"THIS_MONTH":":"===i?(s=o.Macros.THIS_MONTH_START,n=o.Macros.THIS_MONTH_END):">"===i?s=o.Macros.THIS_MONTH_END:">="===i?s=o.Macros.THIS_MONTH_START:"<"===i?n=o.Macros.THIS_MONTH_START:"<="===i&&(n=o.Macros.THIS_MONTH_END);break;case"THIS_YEAR":":"===i?(s=o.Macros.THIS_YEAR_START,n=o.Macros.THIS_YEAR_END):">"===i?s=o.Macros.THIS_YEAR_END:">="===i?s=o.Macros.THIS_YEAR_START:"<"===i?n=o.Macros.THIS_YEAR_START:"<="===i&&(n=o.Macros.THIS_YEAR_END);break;case"LAST_YEAR":":"===i?(s=o.Macros.LAST_YEAR_START,n=o.Macros.LAST_YEAR_END):">"===i?s=o.Macros.LAST_YEAR_END:">="===i?s=o.Macros.LAST_YEAR_START:"<"===i?n=o.Macros.LAST_YEAR_START:"<="===i&&(n=o.Macros.LAST_YEAR_END)}return s&&n?`(${t} >= "${s}" AND ${t} <= "${n}")`:s?`${t} ${i} "${s}"`:n?`${t} ${i} "${n}"`:e})},expandMe:function(e){let t=this.getKeywordQuery("ME");return t&&(e=e.replaceAll("$ME",t)),e=this.getUserQuery(e,this.getCurrentUserInfo())},getUserQuery:function(e,t){return e=(e=(e=(e=(e=e.replaceAll("{USER_ID}",t.USER_ID)).replaceAll("{USER_FULLNAME}",t.USER_FULLNAME)).replaceAll("{USER_FIRSTNAME}",t.USER_FIRSTNAME)).replaceAll("{USER_LASTNAME}",t.USER_LASTNAME)).replaceAll("{USER_EMAIL}",t.USER_EMAIL)},getCurrentUserInfo:function(){return{USER_ID:this._loggedInUserFromCompass.id,USER_FIRSTNAME:this._loggedInUserFromCompass.firstname,USER_LASTNAME:this._loggedInUserFromCompass.lastname,USER_EMAIL:this._loggedInUserFromCompass.email,USER_FULLNAME:this._loggedInUserFromCompass.firstname+" "+this._loggedInUserFromCompass.lastname}},expandWhenKeywords:function(e){let t=this.getDateRanges();return e=this.expandToday(e,t),e=this.expandThisWeek(e,t),e=this.expandThisMonth(e,t),e=this.expandThisYear(e,t),e=this.expandLastYear(e,t),e=this.expandOlder(e,t)},_replaceMacro:function(e,t,i){return e=e.replaceAll(t,i)},expandToday:function(e,t){let i=this.getKeywordQuery("TODAY");return i&&(e=this._replaceMacro(e,"$TODAY",i)),e=this._replaceMacro(e,"{TODAY_START}",t.TODAY_START),e=this._replaceMacro(e,"{TODAY_END}",t.TODAY_END)},expandThisWeek:function(e,t){let i=this.getKeywordQuery("THIS_WEEK");return i&&(e=this._replaceMacro(e,"$THIS_WEEK",i)),e=this._replaceMacro(e,"{THIS_WEEK_START}",t.THIS_WEEK_START),e=this._replaceMacro(e,"{THIS_WEEK_END}",t.THIS_WEEK_END)},expandThisMonth:function(e,t){let i=this.getKeywordQuery("THIS_MONTH");return i&&(e=this._replaceMacro(e,"$THIS_MONTH",i)),e=this._replaceMacro(e,"{THIS_MONTH_START}",t.THIS_MONTH_START),e=this._replaceMacro(e,"{THIS_MONTH_END}",t.THIS_MONTH_END)},expandThisYear:function(e,t){let i=this.getKeywordQuery("THIS_YEAR");return i&&(e=this._replaceMacro(e,"$THIS_YEAR",i)),e=this._replaceMacro(e,"{THIS_YEAR_START}",t.THIS_YEAR_START),e=this._replaceMacro(e,"{THIS_YEAR_END}",t.THIS_YEAR_END)},expandLastYear:function(e,t){let i=this.getKeywordQuery("LAST_YEAR");return i&&(e=this._replaceMacro(e,"$LAST_YEAR",i)),e=this._replaceMacro(e,"{LAST_YEAR_START}",t.LAST_YEAR_START),e=this._replaceMacro(e,"{LAST_YEAR_END}",t.LAST_YEAR_END)},expandOlder:function(e,t){let i=this.getKeywordQuery("OLDER");return i&&(e=this._replaceMacro(e,"$OLDER",i)),e=this._replaceMacro(e,"{OLDER_END}",t.OLDER_END)},getKeywordQuery:function(e){return this._keywordDefinitions[e]&&this._keywordDefinitions[e].query},getByPredicates:function(){return this._keywordDefinitions.BY&&this._keywordDefinitions.BY.predicates},getDateRanges:function(){let e={},t=new Date,i=new Date;i.setDate(i.getDate()-i.getDay()+1);let r=new Date;r.setDate(i.getDate()+6);let s=t.getMonth(),n=t.getFullYear();var a=new Date(n,s,1),o=new Date(n,s+1,0),c=new Date(n,0,1),l=new Date(n,11,31),d=n-1,u=new Date(d,0,1),p=new Date(d,11,31),h=new Date(n-2,11,31);return e.TODAY_START=this._startDateInQueryFormat(t),e.TODAY_END=this._endDateInQueryFormat(t),e.THIS_WEEK_START=this._startDateInQueryFormat(i),e.THIS_WEEK_END=this._endDateInQueryFormat(r),e.THIS_MONTH_START=this._startDateInQueryFormat(a),e.THIS_MONTH_END=this._endDateInQueryFormat(o),e.THIS_YEAR_START=this._startDateInQueryFormat(c),e.THIS_YEAR_END=this._endDateInQueryFormat(l),e.LAST_YEAR_START=this._startDateInQueryFormat(u),e.LAST_YEAR_END=this._endDateInQueryFormat(p),e.OLDER_END=this._endDateInQueryFormat(h),e},_startDateInQueryFormat:function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.toISOString()},_endDateInQueryFormat:function(e){return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),e.toISOString()},getRangeQuery:function(e,t){return e=(e=e.replaceAll("{FROM_DATE}",t.FROM_DATE)).replaceAll("{TO_DATE}",t.TO_DATE)},getLoggedInUserFromCompassPromise:function(){let e=this;return this._loggedInUserPromise||(this._loggedInUserPromise=new i(function(t,i){let s=n.getActiveTenant();r.getUser({platformId:s,onComplete:function(i){console.log(i),e._loggedInUserFromCompass=i,t(i)},onFailure:function(e){console.log(e),i(e)}})})),this._loggedInUserPromise}});return o}),define("DS/SNInfraUX/SNSearchTypeCusto",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS"],function(e,t,i,r,s,n){"use strict";return t.singleton(i,r,{init:function(){var t=this,i=s.getOption("type_custo");if(i){var r=i.IncludedTypes;e.is(r)&&r.length>0&&(this._typeCusto={},r.forEach(function(e){t._typeCusto[e.typeURI]=e,t._typeCusto[e.typeURI].typeRef="Class"})),r=i.IncludedRelTypes,e.is(r)&&r.length>0&&(this._typeCustoInst={},r.forEach(function(e){t._typeCustoInst[e.typeURI]=e,t._typeCustoInst[e.typeURI].typeRef="Instance"}))}this._vocabularyElementNLSInfo=null},getSearchTypeCustoQuery:function(){if(this._globalSearchTypeCustoQuery)return this._globalSearchTypeCustoQuery;var e="";if(this._typeCusto)for(let t in this._typeCusto)if(this._typeCusto.hasOwnProperty(t)){let i,r=t.split(":");i=r.length>1?"ds6wg"===r[0]?'flattenedtaxonomies:"types/'+r[1]+'"':'type:"'+r[1]+'"':'flattenedtaxonomies:"types/'+r[0]+'"';let s=this._typeCusto[t].interfaceURIs;if(s&&s.length>0){let e="NOT listoffields:interface";for(let t=0;t<s.length;t++)e+=' OR flattenedtaxonomies:"interfaces/'+s[t]+'"';i="("+i+" AND ("+e+"))"}0===e.length?e=i:e+=" OR "+i}if(this._typeCustoInst)for(let t in this._typeCustoInst)if(this._typeCustoInst.hasOwnProperty(t)){let i,r=t.split(":");i=r.length>1?"ds6wg"===r[0]?'flattenedtaxonomies:"reltypes/'+r[1]+'"':'type:"'+r[1]+'"':'flattenedtaxonomies:"reltypes/'+r[0]+'"';let s=this._typeCustoInst[t].interfaceURIs;if(s&&s.length>0){let e="NOT listoffields:interface";for(let t=0;t<s.length;t++)e+=' OR flattenedtaxonomies:"interfaces/'+s[t]+'"';i="("+i+" AND ("+e+"))"}0===e.length?e=i:e+=" OR "+i}return e.length>0&&(this._globalSearchTypeCustoQuery=e),e},getTypeCusto:function(){var t=e.clone(this._typeCusto);if(e.is(this._typeCustoInst))for(var i in this._typeCustoInst)this._typeCustoInst.hasOwnProperty(i)&&(t[i]=this._typeCustoInst[i]);return t},getSearchTypeCustoList:function(t){var i=[];if(this._typeCusto)for(let e in this._typeCusto)if(this._typeCusto.hasOwnProperty(e)){let t=e.split(":");t.length>1?"ds6wg"===t[0]&&i.push(t[1]):i.push(t[0])}if(this._typeCustoInst&&e.is(t)&&!0===t)for(let e in this._typeCustoInst)if(this._typeCustoInst.hasOwnProperty(e)){let t=e.split(":");t.length>1?"ds6wg"===t[0]&&i.push(t[1]):i.push(t[0])}return i},getSearchTypeCustoListNLSNames:function(t){if(e.is(t)){var i=this;if(null===this._vocabularyElementNLSInfo){var r=[];if(this._typeCusto)for(let e in this._typeCusto)this._typeCusto.hasOwnProperty(e)&&r.push(e);if(this._typeCustoInst)for(let e in this._typeCustoInst)this._typeCustoInst.hasOwnProperty(e)&&r.push(e);n._asyncCallToPredicatesWS(r,{service_name:"ElementsNLSNames",method:"POST",forcetoresolve:!0}).then(function(r){var s=null;e.is(r)&&r.length>0&&(s=JSON.parse(r),e.is(s)&&e.is(s.vocabularyElementNLSInfo)&&e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&(i._vocabularyElementNLSInfo={},s.vocabularyElementNLSInfo.forEach(function(e){var t,r=e.uri.split(":");t=r.length>1?r[1]:r[0],i._vocabularyElementNLSInfo[t]=e}),t.onComplete.call(this,i._vocabularyElementNLSInfo)))},function(){e.is(t)&&e.is(t.onFailure)&&e.is(t.onFailure,"function")&&t.onFailure.call(this)})}else e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(this,i._vocabularyElementNLSInfo)}}})}),define("DS/SNInfraUX/TaggerConfigAccess",["UWA/Core","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences"],function(e,t,i,r,s,n,a,o){"use strict";var c={_tenantPromise:{},_tagColorizationPromises:{},_communityOntologyPromises:{},_OntologyPromises:{},_tagRelationshipPromise:{},_controlledVocabPromise:{},get6WTagsColorsConfiguration:function(r){var s=null;if(!r||!r.tenantID)return s;if(!this._tagColorizationPromises[r.tenantID]){this._tagColorizationPromises[r.tenantID]=new t(function(t,n){i.getTenantSettings(r.tenantID).then(function(n){var a=i.getOption("tagColorization",{tenant:r.tenantID});(a=e.is(a)?a.colorization:a)&&(s={},Object.keys(a).forEach(function(e){s[e]=[],Object.keys(a[e]).forEach(function(t){s[e].push({object:t,color:a[e][t]})})})),t(s)},function(){n()})})}return this._tagColorizationPromises[r.tenantID]},get6WTagsConfiguration:function(i){var s=null,n=null,a=null;if(!e.is(i.tenantID)||!e.is(i.appID))return s;if(e.is(i.tenantID)&&e.is(i.appID)){n=i.tenantID,a=i.appID;var o={tenantID:n};c._tenantPromise[n]||(c._tenantPromise[n]={}),c._tenantPromise[n][a]||(c._tenantPromise[n][a]=t.deferred(),r.getSearchSettings(o).then(function(e){s=c._transalateToTaggerFormat(a,e),c._tenantPromise[n][a].resolve(s)},function(e){c._tenantPromise[n][a].reject()}))}return this._tenantPromise[n][a].promise},_transalateToTaggerFormat:function(t,i){var s=null,n=!1,a=o.getLocalStorageItem("TagNavigator-simplifiedTagger");if((e.is(a)&&"true"===a&&(n=!0),e.is(i))&&Object.keys(i).length>0)if(i.hasOwnProperty("context_apps_predicates")){var c=i.context_apps_predicates;if(e.is(c,"array"))for(var l=0;l<c.length;l++){var d=c[l],u=Object.keys(d);if(s={},t===u[0]){var p=null,h=null;if(d[t].hasOwnProperty("preferred_predicates")&&(p=d[t].preferred_predicates),d[t].hasOwnProperty("excluded_predicates")&&(h=d[t].excluded_predicates),e.is(p,"array"))for(var g=0;g<p.length;g++){var f={relevant:!0,expanded:!0,weight:100-g};s[p[g].uri]=f}if(e.is(h,"array"))for(var y=0;y<h.length;y++){s[h[y].uri]={relevant:!0,expanded:!0,weight:0}}break}}}else r.getAppWisePredicates(t,!1).then(function(t){var i=null,r=null;if(t.hasOwnProperty("preferred_predicates")&&(i=t.preferred_predicates),t.hasOwnProperty("excluded_predicates")&&(r=t.excluded_predicates),!n)for(let e=0;e<i.length;e++)"computedCountryInfo"===i[e]&&i.splice(e,1);if(e.is(i,"array"))for(var a=0;a<i.length;a++){var o={relevant:!0,expanded:!0,weight:100-a};s[i[a].uri]=o}if(e.is(r,"array"))for(var c=0;c<r.length;c++){s[r[c].uri]={relevant:!0,expanded:!0,weight:0}}},function(){console.log("Error: Default json for preferred predicates has not been defined yet for this APP")});return s},getAssociatedOntologies:function(r){if(!r||!r.tenantID||!r.name)return null;let s=r.tenantID+"_"+r.name;if(!this._communityOntologyPromises[s]){this._communityOntologyPromises[s]=new t(function(t,s){i.getTenantSettings(r.tenantID);var n=i.getOption("controlledVocabulary",{tenant:r.tenantID});if(n&&e.is(n,"array"))for(let e=0;e<n.length;e++)if(r&&r.type&&n[e].type==r.type&&r&&r.name&&n[e].name==r.name){t(n[e]);break}})}return this._communityOntologyPromises[s]},getEnterpriseOntology:function(r){let s=this;if(!e.is(r)||!e.is(r.tenantID))return null;n.log("DS/SNInfraUX/TaggerConfigAccess:getEnterpriseOntology",r);let a=r.tenantID;return s._OntologyPromises[a]||(s._OntologyPromises[a]=new t(function(t,s){i.getTenantSettings(r.tenantID).then(function(){var a=i.getOption("enterprise_ontology",{tenant:r.tenantID});if(a){if(t(a),n.log("DS/SNInfraUX/TaggerConfigAccess:getEnterpriseOntology:resolve",a),e.is(r.onCompleteConceptsOfConcept)){require(["DS/SearchControlCenter/scripts/ControlledOntology/OntologyDatasetsHelpers"],function(e){let t={sessionsId:a[0].applicativeId,onComplete:function(e){r.onCompleteConceptsOfConcept.call(void 0,e),n.log("DS/SNInfraUX/TaggerConfigAccess:getEnterpriseOntology:getConceptsOfConcept",e)}};e.getConceptsOfConcept(t)})}}else s()},function(){s("Failed to get Tenant settings")})})),s._OntologyPromises[a]},getCompanyTagSuggestInfo:function(){let e=null;return n.log("DS/SNInfraUX/TaggerConfigAccess:getCompanyTagSuggestInfo"),new t(function(t,r){var s=a.getActiveTenant();i.getTenantSettings(s).then(function(){var n=i.getOption("enterprise_ontology",{tenant:s});if(i.getOption("companyTagsSearchSuggest",{tenant:s})){require(["DS/SearchControlCenter/scripts/ControlledOntology/utils/SCCOntologyUtils"],function(i){let s={structure:[{dataset:n.dataset[0].dataset,datasetTitle:n.dataset[0].datasetTitle,"session@id":n.dataset[0]["session@id"],sessionTitle:n.dataset[0].sessionTitle,applicativeId:n.dataset[0].applicativeId,publisher:n.dataset[0].publisher,modificationdate:n.dataset[0].modificationdate,label:n.dataset[0].label}],onComplete:function(e){options.onCompleteConcepts.call(void 0,e)}};i.getOntologyConceptsFromSessionId(s.structure).then(function(){e=i.getConceptsInfo(),t(e)},function(){r("Failed to fetch concepts")})})}else r("Company Tags For Search Suggest is not activated")},function(){r("Failed to get Tenant settings")})})},getControlledVocabularyMode:function(r){let s=null,a=this;if(!e.is(r)||!e.is(r.tenantID))return s;n.log("DS/SNInfraUX/TaggerConfigAccess:getControlledVocabularyMode",r);let o=r.tenantID;if(!a._controlledVocabPromise[o]){a._controlledVocabPromise[o]=t.deferred();i.getTenantSettings(r.tenantID).then(function(){let t=i.getOption("controlledVocabMode",{tenant:o});e.is(t)||(t=!1),s={controlledVocabMode:t},e.is(t)?c._controlledVocabPromise[o].resolve(s):c._controlledVocabPromise[o].reject()},function(){reject("Failed to get Tenant settings")})}return this._controlledVocabPromise[o].promise},get6WTagsRelationship:function(s){let a=null,o=this;if(!e.is(s)||!e.is(s.tenantID))return a;n.log("DS/SNInfraUX/TaggerConfigAccess:get6WTagsRelationship",s);let l=s.tenantID;if(!o._tagRelationshipPromise[l]){o._tagRelationshipPromise[l]=t.deferred();let s=i.getOption("tagRelationships",{tenant:l});e.is(s)||(s=r.getTagRelationshipDefaultSettings()),e.is(s)?(a=c._transalateToTagRelationshipFormat(s),c._tagRelationshipPromise[l].resolve(a)):c._tagRelationshipPromise[l].reject()}return this._tagRelationshipPromise[l].promise},_transalateToTagRelationshipFormat:function(t){let i=null;if(e.is(t)&&t.hasOwnProperty("activate_tag_relationship")&&!1===t.activate_tag_relationship&&(t=r.getTagRelationshipDefaultSettings()),e.is(t)){if(Object.keys(t).length>0){i={};let r=t;if(r.hasOwnProperty("activate_tag_relationship")&&!0===r.activate_tag_relationship){if(r.hasOwnProperty("tagRelationship_predicates")){let t=r.tagRelationship_predicates;if(e.is(t,"array"))for(let r=0;r<t.length;r++){let s=t[r];if(e.is(s)){if(s.hasOwnProperty("uri")&&s.hasOwnProperty("operator")){let e=s.uri,t={operator:s.operator};i[e]=t}}}}if(r.hasOwnProperty("tagRelationship_IrrelevantOpert")){let t=r.tagRelationship_IrrelevantOpert;if(e.is(t)&&t.hasOwnProperty("irrelevantANDPredicates")){let r=t.irrelevantANDPredicates;if(e.is(r,"array")&&r.length>0)for(let t=0;t<r.length;t++){let s=r[t];if(i.hasOwnProperty(s)){let t=i[s];e.is(t)&&(t.irrelevantOperator=["AND"])}else{let e={irrelevantOperator:["AND"]};i[s]=e}}}}}}}return i}};return c}),define("DS/SNInfraUX/SNSuggestionHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/TaggerConfigAccess","DS/SNInfraUX/utils/RankingEngine"],function(e,t,i,r,s,n,a,o,c,l){"use strict";return t.singleton(i,{ordered_concepts:[],iconPromise:r.deferred(),_companyConceptsPromise:r.deferred(),init:function(){this.build()},getCompanyConceptsPromise:function(){return c.getCompanyTagSuggestInfo()},getEnterpriseConceptsIconURLPromise:function(){return c.getEnterpriseOntology({tenantID:o.getActiveTenant()})},build:function(){var e=this;e.getEnterpriseConceptsIconURLPromise().then(function(t){let i=t.iconURL;e.iconPromise.resolve(i)},function(){a.getOption("companyTagsSug")?e.iconPromise.resolve("building-office wux-ui-3ds"):e.iconPromise.resolve(void 0)}),this.getCompanyConceptsPromise().then(function(t){t&&s.log(t),e.ordered_concepts=e.getOrganisedConcepts(t),e._companyConceptsPromise.resolve()},function(t){if(a.getOption("companyTagsSug"))try{require(["text!DS/SNInfraUX/assets/companyConcepts.json"],function(t){var i=JSON.parse(t);e.ordered_concepts=e.getOrganisedConcepts(i),e._companyConceptsPromise.resolve()})}catch(e){s.error("Error parsing companyConcepts.json:",e)}else e.ordered_concepts=[],e._companyConceptsPromise.resolve()})},getOrganisedConcepts:function(e){var t=[];for(let t=0;t<e.length;t++)"ds6wclassifier:Root"===e[t]["@id"]&&(e[t].added=!0,e[t].level=0);var i=function(r){let s=r.broader[0]["@id"];for(let n=0;n<e.length;n++)if(s===e[n]["@id"]){if(e[n].added){r.level=e[n].level+1,1!==r.level&&(r.category=e[n].category,r.value=e[n].value+"//"+r.shortURI);break}i(e[n]),e[n].added=!0,r.level=e[n].level+1,1!==r.level&&(r.category=e[n].category,r.value=e[n].value+"//"+r.shortURI,t.push(e[n]))}};for(let r=0;r<e.length;r++)e[r].added||(i(e[r]),e[r].added=!0,1!==e[r].level?t.push(e[r]):(e[r].category=e[r]["@id"].split(":").pop().toLowerCase(),e[r].value=e[r].shortURI));return t.sort((e,t)=>e.label.localeCompare(t.label)),t.sort((e,t)=>t.level-e.level),t},_prioritizeSuggestions:function(t,i,r){t.enterpriseConcepts=i;var s=t,o=["enterpriseConcepts","swym","drive","3dspace","dashboard"],c=[],l=a.getOption("suggest_max_display");e.is(l)||(l=7),e.is(r)||!0!==n.getItem("InstantSearchSCC")||e.is(n.getItem("InstantSearch"))&&!0!==n.getItem("InstantSearch")||(l=2);var d=!1;e.is(a.getOption("search_compact_mode"))&&!0===a.getOption("search_compact_mode")&&(l=a.getOption("suggest_max"));for(var u=0;u<l;u++)o.forEach(function(t){if(d=!1,e.is(s[t])&&e.is(s[t].entries)&&u<s[t].entries.length&&c.length<l){var i=s[t].entries[u],r=i.entry;if(0===c.length)c.push(i);else{for(var n=0;n<c.length;n++)if(c[n].entry.toLowerCase()===r.toLowerCase()){d=!0;break}!1===d&&c.push(i)}}});let p=[];for(let t=0;t<c.length;)e.is(c[t].isEnterpriseConcept)?(p.push(c[t]),c.splice(t,1)):t++;return c=p.concat(c)},getIcon:function(){return this.iconPromise.promise},getEnterpriseConceptsSuggestions:function(t){var i=this;return new r(function(r,s){i._companyConceptsPromise.promise.then(function(){var s=[];e.is(i.ordered_concepts)&&(s=l.getMatchResults(t,i.ordered_concepts,"label"));let n=[];if(s.length>0)for(var a=0;a<s.length;a++)n[a]={entry:s[a].label,isEnterpriseConcept:!0,highLight:s[a].highLight,category:s[a].category,value:s[a].value};r({entries:n})})})}})}),define("DS/SNInfraUX/SearchPreviewContainer",["UWA/Core","UWA/Class/Model","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger"],function(e,t,i,r){"use strict";return t.extend({init:function(){},getPrimaryContent:function(t){e.is(t)&&e.is(t.searchmodel)&&e.is(t.onFailure,"function")&&t.onFailure.call()},getSecondaryContent:function(t){e.is(t)&&e.is(t.searchmodel)&&e.is(t.onFailure,"function")&&t.onFailure.call()},Open:function(t){if(!(e.is(t)&&e.is(t.searchmodel)&&e.is(t.widget_id)&&e.is(this.getAppIdForOpen,"function")))return;i.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"Preview",action:"openFromPreview"}});let s={searchmodel:t.searchmodel,widget_id:t.widget_id,onComplete:function(i){let s,n=void 0;e.is(i,"string")||e.is(i,"object")&&e.is(i.appId,"string")||r.error("Bad response from getAppIdForOpen:",i),e.is(i,"string")?s=i:e.is(i,"object")&&(s=i.appId,n=!e.is(i.closePreview,"boolean")||i.closePreview);require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(i){i.publish("launchApp",{appId:s}),e.is(t.cb,"function")&&t.cb(n)})},onFailure:function(){r.log("Open not available for this object type")}};this.getAppIdForOpen(s)},dispose:function(){},_applyHTMLHighlight:function(e,t,i){let r,s,n,a,o,c=e.childNodes;if(e.nodeType===e.TEXT_NODE)return s=RegExp(t,"gi"),a=e.textContent.replace(s,'<span class="'+i+'">'+t+"</span>"),void(e.textContent!==a&&((o=document.createElement("span")).innerHTML=a,o.className="filtered-node",e.parentNode.replaceChild(o,e)));for(r=0;r<c.length;r++)(n=c[r]).textContent&&!n.textContent.trim()||this._applyHTMLHighlight(n,t,i)}})}),define("DS/SNInfraUX/SearchRevisionDelegator",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences"],function(e,t,i,r,s,n){"use strict";return t.singleton(i,{_revisionImpl:null,_modLoadPromise:null,_revision_options:null,init:function(){},load:function(t){var i=this;require(["DS/RevisionHelper/3DSearchRevisionImpl"],function(r){e.is(t.onLoaded,"function")&&(i._revisionImpl=r,t.onLoaded.call(void 0,r))},function(){})},initialize:function(){var e=this,t={onLoaded:function(t){e._revision_options=t.getRevisionOptions()}};this.load(t)},isRevisioLoaded:function(){return!!e.is(this._revision_options)},getAdditionalQuery:function(t){var i,s=r.getOption("defaultRevision",{tenant:t.tenant}),a=n.getItem("revisionDisplayType");if(e.is(this._revision_options&&e.is(this._revision_options.show_search_results_revision_array,"array"))){var o=this._revision_options.show_search_results_revision_array[0].id;if(e.is(a)||(a=s||o),a){var c=a.id,l=this._revision_options.show_search_results_revision_array;if(e.is(l)&&l.length>0)for(var d=0;d<l.length;d++)c===l[d].id&&(i=l[d])}if(i){var u=Object.keys(i.specific_source_parameter);return e.is(u,"array")?i.specific_source_parameter:null}return null}return""},getOptionsDetails:function(t){var i=this;this.load().then(function(){t&&e.is(i._revisionImpl.getOptionsDetails,"function")&&i._revisionImpl.getOptionsDetails(t)})},isCSVRole:function(e){var t=!1;return this._checkCSVAvailability(e).then(function(){t=!0}),t},_checkCSVAvailability:function(t){var i=this;return r.getOption("search_web_in_win")?(i.CSVpromise.resolve([]),i.CSVpromise.promise):(s.getGrantedRoles(function(r){for(var s=!1,n=0;n<r.length;n++){var a=r[n];if(e.is(a)&&e.is(a.platforms,"array")&&(0===a.platforms.length||a.platforms.indexOf(t)>=0&&"CSV"===a.id)){s=!0;break}}s?i.CSVpromise.resolve(r):i.CSVpromise.reject(r)}),this.CSVpromise.promise)}})}),define("DS/SNInfraUX/utils/SynonymsUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],function(e,t,i,r,s){"use strict";var n=t.singleton(i,{_synonyms:{},_isSupported:!1,init:function(){var t;try{var i=r.getOption("search_synonyms",{tenant:s.getActiveTenant()});if(!e.is(i))return;t=i.synonyms,this._isSupported=i.activateSnonyms}catch(e){this.log("Error in parsing client side synonyms.")}t&&Object.keys(t).forEach(e=>{t[e].unshift(e),t[e].forEach(i=>{this._synonyms[i]=t[e]})})},isSynonymAvailable:function(t){return e.is(this._synonyms[t])&&e.is(this._synonyms[t],"array")&&this._synonyms[t].length>1},getQueryWithSynonyms:function(t){var i="",r=this._findValue(this._synonyms,t);return e.is(r)&&e.is(r,"array")&&r.length>0?r.forEach((e,t)=>{e.indexOf(" ")>0&&(e='"'+e+'"'),i+=0===t?e:" OR "+e}):i=t,i},_findValue:function(t,i){let r=Object.keys(t).find(e=>0===e.localeCompare(i,"en",{sensitivity:"base"}));if(e.is(r))return t[r].filter(e=>0!==e.localeCompare(i,"en",{sensitivity:"base"}))},isSynonymSupportAvailable:function(){return!0===this._isSupported},_treatWithSynonymsForSources:function(e,t){s.addSourceSpecificParameter(e,{sourceIds:["3dswym"],param:{id:"with_synonyms",value:t}})},treatSynonyms:function(t){let i=this;if("client"===r.getOption("Synonyms_impl_type")){let r=n.getQueryWithSynonyms(t.query);if(r===t.query)return;r="("+r+")";let a=t.source,o=t.specific_source_parameter||{};e.is(a,"array")&&a.length>0&&(a=i._sourcesToTreat(a)).forEach(i=>{let n;e.is(o[i])&&e.is(o[i].additional_query)?(n=o[i].additional_query,n=" OR ("+r+n+")"):n="OR "+r,s.addSourceSpecificParameter(t,{sourceIds:[i],param:{id:"additional_query",value:n}})})}else"server"===r.getOption("Synonyms_impl_type")&&(t.with_synonyms=!0,this._treatWithSynonymsForSources(t,!0))},_sourcesToTreat:function(e){let t=r.getOption("SynonymsSupportBlackList",{tenant:s.getActiveTenant()}),i=r.getOption("SynonymsSupportWhiteList",{tenant:s.getActiveTenant()});return t.length>0?e.filter(e=>!(t.indexOf(e)>=0)):i.length>0?i.filter(t=>e.indexOf(t)>=0):e}});return n}),define("DS/SNInfraUX/SearchRessources",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Promise","DS/WAFData/WAFData","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SWFiltering","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchRevisionDelegator","DS/SNInfraUX/SearchDataSources","DS/SNInfraUX/PlatformEnvServices","DS/SNInfraUX/keywords/SNKeywordManager","DS/SNInfraUX/utils/SynonymsUtils"],function(e,t,i,r,s,n,a,o,c,l,d,u,p,h,g,f,y,_,S,v){"use strict";return t.extend(o,i,{uwaClassName:"DS/SNInfraUX/SearchRessources",source_names:["cstorage","hpc","search","swym","tagger"],valid:!1,active_tenant:"",active_role:null,_fedSearchLabel:"",init:function(t,i){if(this.setDebugMode(n.getOption("debug_mode")),this._reset_internals(),!e.is(t))throw new Error("SearchRessources:init called without valid options!");e.is(t.platforms)&&c.setPlatforms(t.platforms),_.setEnvironments(t);let r=null;if(e.is(t.active_tenant))r=t.active_tenant;else if(e.is(t.x3dplatformid))r=t.x3dplatformid;else{let t=a.getItem("defaultTenantId");e.is(t,"string")&&t.length>0&&(r=t)}if(!e.is(r,"string")||!_.tenantExists(r)){let t=_.getAvailableTenantsForSearch();e.is(t,"array")&&t.length>0&&e.is(t[0],"object")&&e.is(t[0].tenantId,"string")&&(r=t[0].tenantId)}_.tenantExists(r)&&(this.setActiveTenant(r),this.valid=!0),c.initSecurityContext3DSpace(this),e.is(i,"function")&&i.call(this,{})},available_services:{fed_search:function(t){g.log("fedsearch query ",t.service_data.query);var i=t.original_options||{},r=n.getOption("fedSearchTimeout");if(e.is(r)&&(g.log("fedSearchTimeout found, value=",r),!isNaN(r))){var o=+r;o>0&&(i.timeout=1e3*o)}var d=c.SearchTypeEnum.MY_RECENT_CONTENT===t.service_data.query;i.method="POST",i.headers={Accept:"application/json","Content-Type":"application/json"};var y=t.original_options.data||{};if(t.service_data.specific_source_parameter&&(y.specific_source_parameter=t.service_data.specific_source_parameter),d){i.url=this.getFedSearchUrl()+"/recent";var _=n.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});y.delta_time_interval=60*_,y.version=2,t.service_data.recent_search&&t.service_data.recent_search.types&&(y.select_type=t.service_data.recent_search.types)}else i.url=this.getFedSearchUrl()+"/search",y.with_indexing_date=!0,y.with_synthesis=!0,e.is(t.service_data.with_synthesis)&&(y.with_synthesis=t.service_data.with_synthesis);y.with_nls=!0,n.getOption("activate_dictionary_NLS_computation")&&(y.with_nls=!1);let m=t.featureId;var D=new Date;!0===t.isPinnedWidget?m="Pinned":(e.is(t.service_data)&&e.is(t.service_data.adv_search)&&e.is(t.service_data.adv_search)&&!0===t.service_data.adv_search&&(m=n.getOption("fedsearch_query_label.feature_id.AdvancedSearch")),e.is(t.context_options)&&(m=n.getOption("fedsearch_query_label.feature_id.InContextSearch")),e.is(m)||(m=n.getOption("fedsearch_query_label.feature_id.TopBarSearch"))),this._fedSearchLabel="3DSearch-"+c.getUserId()+(m?"-"+m:"")+"-"+D.getTime(),y.label=this._fedSearchLabel,y.locale=c.getLanguage(),i.ajax=s.authenticatedRequest;var I=[];t.context_options&&t.context_options.columns&&(I=e.clone(t.context_options.columns)),t.attributesToRetrieve&&Array.prototype.push.apply(I,t.attributesToRetrieve);I=I.concat(p.getAllSelectClause(!0)),!0===n.getOption("SEARCH_INSTANCES")&&(I=I.concat("ds6wg:isAnInstance")),e.is(t.displayNamePredicates,"array")&&t.displayNamePredicates.length>0&&(I=I.concat(t.displayNamePredicates)),e.is(t.service_data.select_predicate,"array")&&(I=t.service_data.select_predicate);var C=I,w=l.getSelectPredicates();e.is(w,"array")&&(C=w),C.length>0&&(y.select_predicate=C),t.context_options&&(t.context_options.resourceid_in&&(y.resourceid_in=e.clone(t.context_options.resourceid_in)),t.context_options.resourceid_not_in&&(y.resourceid_not_in=e.clone(t.context_options.resourceid_not_in))),!0===n.getOption("synthesis_hierarchical")&&(y.with_synthesis_hierarchical=!0),e.is(t.service_data.with_synthesis_hierarchical)&&(y.with_synthesis_hierarchical=t.service_data.with_synthesis_hierarchical),y.select_file=["icon","thumbnail_2d"],e.is(t.service_data.select_file,"array")&&(y.select_file=t.service_data.select_file);var M={};if(!d){if(y.query=t.service_data.query,"*"===y.query&&(y.query="#all"),t.service_data&&t.service_data.query&&(0===t.service_data.query.indexOf(c.SearchTypeEnum.MY_CONTENT)||t.service_data.queryType===c.SearchTypeEnum.MY_CONTENT||0===t.service_data.query.indexOf("("+c.SearchTypeEnum.MY_CONTENT)||0===t.service_data.query.indexOf("(("+c.SearchTypeEnum.MY_CONTENT))){let e=c.getUserId();y.query=t.service_data.query.replace(c.SearchTypeEnum.MY_CONTENT,"(owner:"+e+" OR username:"+e+")");let i=u.getSearchTypeCustoQuery();i.length>0&&c.addSourceSpecificParameter(y,{sourceIds:["3dspace"],param:{id:"additional_query",value:" AND ("+i+")"}})}if(0===t.service_data.query.indexOf(c.SearchTypeEnum.FAVORITE_SEARCH)||t.service_data.queryType===c.SearchTypeEnum.FAVORITE_SEARCH){let e=c.getUserId();y.query=t.service_data.query.replace(c.SearchTypeEnum.FAVORITE_SEARCH,"((owner:"+e+" AND flattenedtaxonomies:types/PLMWspFavoriteSearch) OR flattenedtaxonomies:types/SavedSearch)")}else e.is(t.context_options)&&e.is(t.context_options.precond,"string")&&0<t.context_options.precond.length&&-1===y.query.indexOf(t.context_options.precond)&&(y.query="("+y.query+") AND ("+t.context_options.precond+")");if(e.is(t.service_data.searchInCriteria,"string")&&0<=t.service_data.searchInCriteria.length&&(y.query+=" AND ("+t.service_data.searchInCriteria+")"),e.is(t.service_data.refine,"object")&&e.is(t.service_data.refine.allfilters,"object")){var b=t.service_data.refine.allfilters,A={};for(var O in b)0!==O.indexOf("sixw:")&&(A[O]=b[O]);M=this.treatMyContentRefine(A),e.is(M,"object")&&e.is(M.additionalQuery,"string")&&M.additionalQuery.length>0&&c.addSourceSpecificParameter(y,{sourceIds:["3dspace"],param:{id:"additional_query",value:M.additionalQuery}}),y.refine=A}var P=l.getAdditionalQueryCriteria();e.is(P)&&c.addSourceSpecificParameter(y,{sourceIds:["3dspace"],param:{id:"additional_query",value:" "+P}});var T=l.getSpecificSourceParameter();e.is(T)&&c.addSourceSpecificParameter(y,{sourceIds:[T.source],param:{id:T.parameter,value:T.value}});var N=t.context_options,E=t.service_data&&t.service_data.isAPQSearch,U=t.service_data.adv_search&&e.is(t.service_data.advanced_criteria,"string")&&(t.service_data.advanced_criteria.indexOf("flattenedtaxonomies")>=0||t.service_data.advanced_criteria.indexOf("[ds6w:type]")>=0),x=y.query.indexOf("flattenedtaxonomies")>=0||y.query.indexOf("[ds6w:type]")>=0,F=e.is(t.service_data.refine,"object")&&e.is(t.service_data.refine.allfilters,"object")&&t.service_data.refine.allfilters.hasOwnProperty("ds6w:what/ds6w:type"),R=t.service_data.query.indexOf("#similarity")>=0,L=!0;if(t.context_options&&e.is(t.context_options.show_banned_types)&&(L=t.context_options.show_banned_types),!(N&&L||E||R)){var j="",W=n.getOption("topbar_search_banned_list",{tenant:this.getActiveTenant()});if(!U&&!x&&!F||N&&!L||t.uqlAvailable)if(W&&W.types)Object.keys(W.types).forEach(function(t){var i=e.is(W.types[t])?W.types[t]:[];if("3dspace"===t){var r=n.getOption("topbar_search_banned_types_21xFD05_tactical");e.is(r,"array")&&r.forEach(function(e){i.indexOf(e)<0&&i.push(e)}),j=this._create3DSpaceBannedTypeQuery(i)}else j=this._createBannedTypeQuery(i);j.length>0&&c.addSourceSpecificParameter(y,{sourceIds:[t],param:{id:"additional_query",value:j}})}.bind(this));if("OnPremise"!==this.active_tenant&&c.SearchTypeEnum.MY_CONTENT!==t.service_data.query){var k=n.getOption("topbar_search_banned_list"),V=[];if(e.is(k)&&e.is(k.users)&&(V=k.users["3dspace"]),e.is(V,"array")&&V.length>0){j=" AND NOT (";for(var X=0;X<V.length;X++)j+='owner:"'+V[X]+'"',X<V.length-1&&(j+=" OR ");(j+=")").length>0&&c.addSourceSpecificParameter(y,{sourceIds:["3dspace"],param:{id:"additional_query",value:j}})}}}var H,q=t.service_data.update_incontext_options;if(q){if(q.precond&&q.precond.length>0&&(y.query="("+y.query+") AND ("+q.precond+")"),e.is(q.resourceid_in,"array")&&q.resourceid_in.length>0){var B=y.resourceid_in,Q=q.resourceid_in;y.resourceid_in=!e.is(B)||e.is(B,"array")&&B.length<1?Q:Q.filter(function(e){return B.includes(e)}),y.resourceid_in.length<1&&(y.resourceid_in=[""])}if(e.is(q.resourceid_not_in,"array")&&q.resourceid_not_in.length>0){var J=y.resourceid_not_in||[],Y=q.resourceid_not_in;y.resourceid_not_in=Y.concat(J.filter(function(e){return!Y.includes(e)}))}}if(H=e.is(t.context_options)&&e.is(t.context_options.irrelevant_tags,"array")&&t.context_options.irrelevant_tags.length>0?t.context_options.irrelevant_tags:n.getOption("irrelevant_tags",{tenant:this.getActiveTenant()}),e.is(H,"array")&&H.length>0){e.is(y.select_exclude_synthesis,"array")||(y.select_exclude_synthesis=[]);for(var z=0;z<H.length;z++){var K=H[z];-1===y.select_exclude_synthesis.indexOf(K)&&y.select_exclude_synthesis.push(K)}}if(e.is(t.select_exclude_synthesis,"array")&&t.select_exclude_synthesis.length>0&&(e.is(y.select_exclude_synthesis,"array")?y.select_exclude_synthesis=y.select_exclude_synthesis.concat(t.select_exclude_synthesis):y.select_exclude_synthesis=t.select_exclude_synthesis),e.is(t.select_exclude_synthesis,"array")&&t.select_exclude_synthesis.length>0&&t.select_exclude_synthesis.indexOf("ds6w:dataSource")>=0)!e.is(H,"array")||H.indexOf("ds6w:dataSource")>=0||y.select_exclude_synthesis.push("ds6w:dataSource");else if(e.is(H,"array")&&-1!==H.indexOf("ds6w:dataSource")){var G=c.getSourceToPredicateMapping();if(e.is(G,"array"))for(let t=0;t<G.length;t++){let i=G[t];e.is(i,"object")&&e.is(i.predicate,"string")&&-1===y.select_exclude_synthesis.indexOf(i.predicate)&&y.select_exclude_synthesis.push(i.predicate)}}this._addOrderInfo(t,y),e.is(y.specific_source_parameter)&&e.is(t.service_data.context)?this.mergeRecursive(y.specific_source_parameter,t.service_data.context.specific_source_parameter):e.merge(y,t.service_data.context);var $=f.getAdditionalQuery({tenant:this.active_tenant});if(e.is($)){var Z=Object.keys($),ee=Object.values($);for(let e=0;e<Z.length;e++)c.addSourceSpecificParameter(y,{sourceIds:[Z[e]],param:{id:"additional_query",value:ee[e].additional_query}})}var te=null;if(n.getOption("rangeValuesClassification")&&(te={with_synthesis_ranged:n.getOption("rangeValuesClassification"),enable_mono_sixw:!1}),!0===n.getOption("activate_hierarchical_tag_depth")){var ie=n.getOption("hierarchical_predicates",{tenant:this.active_tenant});if(e.is(ie)&&!0===ie.specify_hierarchical_predicates&&e.is(ie.hierarchical_predicates,"array")){var re=n.getOption("default_deep_hierarchy_tag_depth"),se=n.getOption("default_deep_hierarchy_tag_width"),ne=n.getOption("max_deep_hierarchy_tags"),ae={},oe=0;ie.hierarchical_predicates.forEach(function(t,i){if(oe<ne){var r=t.uri,s=t.depth||re,n=t.width||se;ae[r]={depth:s},e.is(n)&&(ae[r].width=n),oe++}}),(te=te||{}).facet_params=ae}}if(te&&c.addSourceSpecificParameter(y,{sourceIds:["3dspace"],param:{id:"option",value:te}}),!0===n.getOption("add_taxonomies_in_select_clause")&&e.is(y.select_predicate,"array")&&y.select_predicate.push("taxonomies"),!0===c.isSnippetAvailable(this.getActiveTenant())){var ce=n.getOption("select_snippets");if(e.is(ce)&&e.is(ce,"object")){var le=Object.keys(ce).map(function(e){return ce[e]});e.is(le,"array")&&(y.select_snippets=le)}}e.is(t.service_data.select_snippets,"array")&&(y.select_snippets=t.service_data.select_snippets),y.nresults=""+t.state.pageSize,void 0===t.state.next_start?y.start="0":y.next_start=t.state.next_start,e.is(t.service_data.in_ctx_role)&&n.getOption("activate_default_role")?y.user_ctx=t.service_data.in_ctx_role:n.getOption("activate_default_role")&&(y.user_ctx=n.getOption("default_user_ctx")),this.addInstanceSearchParam(y),e.is(t.context_options)&&this.addInContextSpecificSourceParam(y,t.context_options)}if(t.service_data.query.indexOf("#similarity")>=0?y.source=["onepart"]:e.is(t.service_data.isAPQSearch)?y.source=["3dspace"]:t.service_data.queryType===c.SearchTypeEnum.FAVORITE_SEARCH?y.source=["3dspace"]:e.is(t.service_data.source)?y.source=t.service_data.source:e.is(t.source)?y.source=t.source:e.is(y.source)||(y.source=[]),e.is(M,"object")&&!0===M.isRefineOnlyFavorite&&(y.source=["3dspace"]),0===y.source.length){var de=h.getAvailableSources(this.active_tenant);if(e.is(de)&&0<de.length&&!c.isInTheSimpleSearch({tenant:this.active_tenant})){var ue=n.getOption("exclusiveDataSourcesForSSE",{tenant:this.active_tenant});e.is(ue)&&0<ue.length&&(de=de.filter(function(e){return-1===ue.indexOf(e.name)})).forEach(function(e){y.source.push(e.name)})}}t.service_data.ignoreRestrictedSources||this._removeRestrictedSources(y);var pe=c.getChosenDataSource();if(c.setActiveDataSource(y.source),pe.length>0?y.source=pe:(pe=a.getItem("dataSource"),e.is(pe)&&pe.length>0?y.source=pe:pe=y.source),e.is(t.context_options)&&e.is(t.context_options.source)&&t.context_options.source.length>0&&!t.hasfilterToSourceQueryTransformed&&(y.source=t.context_options.source),e.is(y.source,"array")&&(0===y.source.length||y.source.indexOf("drive")>=0)){var he=' AND NOT ([flattenedtaxonomies]:"types/DriveNode" AND ( [current]:"Trashed" OR [policy]:"Drive File Iteration") )';e.is(he)&&c.addSourceSpecificParameter(y,{sourceIds:["drive"],param:{id:"additional_query",value:he}})}e.is(y.source,"array")&&y.source.length>0&&y.source.indexOf("other")>=0&&(y.source=this._getOtherRDFDataSources()),c.getGrantedRoles(function(t){for(var i=!1,r=0;r<t.length;r++){var s=t[r];if(e.is(s)&&e.is(s.platforms,"array")&&"Operator"===s.id){i=!0;break}}if(e.is(y.source,"array")&&!i&&(0===y.source.length||y.source.indexOf("swym")>=0)){c.addSourceSpecificParameter(y,{sourceIds:["swym"],param:{id:"additional_query",value:' AND NOT (([ds6w:type]:"pno:Person") AND (ut_state:0))'}})}});var ge=n.getOption("data_predicates");if(Object.keys(ge).forEach(function(e){if(y.source.indexOf(e)>=0||0==y.source.length){var t=ge[e];y.select_predicate=y.select_predicate.concat(t)}}),y.select_predicate=y.select_predicate.filter(function(e,t,i){return t===i.indexOf(e)}),n.getOption("enablePLM",{tenant:this.getActiveTenant()})&&!0===t.service_data.adv_search&&e.is(t.service_data)&&e.is(t.service_data.refine)&&e.is(t.service_data.refine.PLMParameters)&&e.is(t.service_data.refine.PLMParameters.plmparam)&&0!==Object.keys(t.service_data.refine.PLMParameters.plmparam).length){var fe={"3dspace":t.service_data.refine.PLMParameters};y.specific_source_parameter=fe}y.tenant=this.active_tenant;let ye=this.get3DSpaceLoginSC(t),_e=n.getOption("loginSCParamSources");if(ye&&y.source&&(y.login={},_e.forEach(e=>{y.source.indexOf(e)>=0&&(y.login[e]={SecurityContext:ye})})),y.query=S.processKeywords(y.query),!1===y.with_synthesis&&y.refine&&!n.getOption("SearchExclude")){var Se=c.getQueryFromRefines(y.refine);Se&&(y.query="("+y.query+") AND ("+Se+")",delete y.refine)}if(v.isSynonymSupportAvailable()&&!e.is(t.context_options)&&v.treatSynonyms(y),i.data=y,this.is_odt_source()){var ve=i.onComplete,me=i.onFailure;(i={}).method="GET",i.headers={Accept:"application/json"},i.auth={},i.proxy="",i.url=t.service_data.query,e.is(ve,"function")&&(i.onComplete=ve),e.is(me,"function")&&(i.onFailure=me)}return(n.getOption("ODTLogs")||n.getOption("ODTLogs-FederatedSearchOptions"))&&g.warn("ODTLogs-FederatedSearchOptions:"+JSON.stringify(i)),i},logOut:function(e){var t=e.original_options||{};return t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.getFedSearchUrl()+"/logout",t},getSavedSearches:function(e){let t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearches",t.data={page:1,pageSize:"all"},t},saveSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"};var i=c.getSecurityContext();i&&i.trim().length>0&&(t.headers.SecurityContext=i),t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/saveSearch";var r=e.service_data||{};return t.data=JSON.stringify(r),t},renameSavedSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/updateSearch";var i=e.service_data||{};return t.data=JSON.stringify(i),t},runSavedSearch:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearch",t.data="id="+e.service_data.id,t},deleteSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json, application/xml","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/deleteSearch";var i=e.service_data||{};return t.data=JSON.stringify(i),t},shareSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json, application/xml","Content-Type":"application/json"};var i=c.getSecurityContext();i&&i.trim().length>0&&(t.headers.SecurityContext=i),t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearch/lifecycle/share";var r=e.service_data||{};return t.data=JSON.stringify(r),t},unshareSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json, application/xml","Content-Type":"application/json"};var i=c.getSecurityContext();i&&i.trim().length>0&&(t.headers.SecurityContext=i),t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearch/lifecycle/unshare";var r=e.service_data||{};return t.data=JSON.stringify(r),t},lastObjects:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/AppsMngt/user/objects",t},actions_for_results:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_delegation/actions";var i=e.service_data||{};return t.data=JSON.stringify(i),t},fed_search_odt:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json"},t.auth={},t.proxy="",t.url=e.service_data.url,t},loginToSources:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json","Content-Type":"application/json"},t.data={tenant:this.active_tenant},t.url=this.getFedSearchUrl()+"/login",t},listAvailablePamameters:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.getFedSearchUrl()+"/search/suggestresult";var i=e.service_data||{};return i.tenant=this.active_tenant,t.data=JSON.stringify(i),t},listSuggestPamameters:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.getFedSearchUrl()+"/search";var i=e.service_data||{};return i.tenant=this.active_tenant,this.addInstanceSearchParam(i),t.data=JSON.stringify(i),t},getConvertedMKSValues:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/dictionary/dimensions/convertValues";var i=e.service_data||{};return i.tenant=this.active_tenant,t.data=JSON.stringify(i),t},getRelevantInterfaces:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Accept-Language":c.getLanguage(),"Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/dictionary/class/interfaces";var i=e.service_data||{};return t.data=JSON.stringify(i),t},listDimensions:function(e){var t=e.original_options||{};return t.method="GET",t.headers={"Accept-Language":c.getLanguage(),Accept:"application/json"},t.url=this.get3DSpaceUrl()+"/resources/dictionary/dimensions",t},getSecurityContext:function(e){var t=e.original_options||{};return t.method="GET",t.headers={"Accept-Language":c.getLanguage(),Accept:"application/json"},t.url=this.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext",t},loadPQData:function(e){var t=this,i=e.original_options||{};return c.isRoleAvailable(["CSV"],this.active_tenant,function(e){!0===e?(i.method="GET",i.headers={"Accept-Language":c.getLanguage(),Accept:"application/json"},i.data={tenant:t.active_tenant},i.url=t.get3DSpaceUrl()+"/resources/SNAPI/pq_services/pqs?lang="+c.getLanguage()):i.url=void 0}),i}},get3DSpaceLoginSC:function(t){let i;if(e.is(this.active_role))i=this.active_role;else{let n=c.identifyClientInfo();if("3DSpace"===n.identifier){let t=[];t=c.getSecurityContext3DSpace(),e.is(t,"array")&&t.forEach(function(t){e.is(t.isDefault)&&!0===t.isDefault&&(i=t.name)})}else if("3DDashboard"===n.identifier){if(t&&!0===t.isPinnedWidget){if(e.is(t.pinWdgSC)){var r=JSON.parse(t.pinWdgSC);i=r.name}}else{var s=a.getItem("securityContext"+this.active_tenant);e.is(s)&&(r=JSON.parse(s),i=r.name)}if(!i){let t=[];t=c.getSecurityContext3DSpace();let r=!1;e.is(t,"array")&&(t.forEach(function(t){e.is(t.isDefault)&&!0===t.isDefault&&(i=t.name,r=!0)}),!1===r&&t.length>0&&(i=t[0].name))}}}return i},addInstanceSearchParam:function(e){var t=n.getOption("SEARCH_INSTANCES",{tenant:this.getActiveTenant()});!0===t&&c.addSourceSpecificParameter(e,{sourceIds:["3dspace"],param:{id:"option",value:{with_Idx_Search:t,with_relationship_search:t}}})},addInContextSpecificSourceParam:function(t,i){e.is(i.app_id)&&n.getOption("whitelist").with_Idx_Search.includes(i.app_id)&&e.is(i.specific_source_parameter)&&e.is(i.specific_source_parameter["3dspace"])&&e.is(i.specific_source_parameter["3dspace"].option)&&e.is(i.specific_source_parameter["3dspace"].option.with_Idx_Search)&&!0===i.specific_source_parameter["3dspace"].option.with_Idx_Search&&c.addSourceSpecificParameter(t,{sourceIds:["3dspace"],param:{id:"option",value:{with_Idx_Search:!0}}})},_createBannedTypeQuery:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND NOT ([ds6w:type]:(";for(var r=0;r<t.length;r++){var s=t[r];s.startsWith("ds6w:")&&(s=s.substring(5)),i+='"'+s+'"',r<t.length-1&&(i+=" OR ")}i+="))"}return i},_create3DSpaceBannedTypeQuery:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND NOT (flattenedtaxonomies:(";for(var r=0;r<t.length;r++){var s=t[r];s.startsWith("ds6wg:")&&(s=s.substring(6)),i+='"types/'+s+'"',r<t.length-1&&(i+=" OR ")}i+="))"}return i},_addOrderInfo:function(t,i){e.is(t.service_data.order_field)&&""!==t.service_data.order_field&&e.is(t.service_data.order_by)&&""!==t.service_data.order_by.length?(i.order_by=t.service_data.order_by,i.order_field=t.service_data.order_field):(i.order_by="desc",i.order_field="relevance")},mergeRecursive:function(t,i){for(var r in i)i.hasOwnProperty(r)&&(e.is(t[r],"array")?t[r]=t[r].concat(i[r]):e.is(t[r],"object")&&e.is(i[r],"object")?this.mergeRecursive(t[r],i[r]):t[r]||(t[r]=i[r]))},treatMyContentRefine:function(t){var i={};if(t.hasOwnProperty("ds6w:what/ds6w:category")){for(var r=e.clone(t["ds6w:what/ds6w:category"]),s=!1,n=!1,a=!1,o=r.length-1;o>=0;o--)"#myFavoriteSearches"===r[o].object?(s=!0,r.splice(o,1)):"#myFavoriteContent"===r[o].object?(n=!0,r.splice(o,1)):"#myOtherContent"===r[o].object&&(a=!0,r.splice(o,1));var c="";(s||n||a)&&(!s||n||a?!n||s||a?!a||s||n?n&&s&&!a?c+=" AND ([ds6w:type]:PLMWspFavoriteSearch OR [ds6w:type]:SavedSearch OR [ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)":n&&a&&!s?c+=" AND NOT [ds6w:type]:PLMWspFavoriteSearch AND NOT [ds6w:type]:SavedSearch":s&&a&&!n&&(c+=" AND NOT ([ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)"):c+=" AND NOT ([ds6w:type]:PLMWspFavoriteSearch OR [ds6w:type]:SavedSearch OR [ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)":c+=" AND ([ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)":c+=" AND ([ds6w:type]:PLMWspFavoriteSearch OR [ds6w:type]:SavedSearch)"),0===r.length&&delete t["ds6w:what/ds6w:category"],i.additionalQuery=c,i.isRefineOnlyFavorite=!1===a&&(!0===s||!0===n)}return i},PredicatesNLSNames:function(t,i){var r=this;!function(t){if(e.is(t,"array")){var s=r.getActiveTenant(),n=c.getLanguage();i({tenantId:s,lang:n})}}([])},getFetchOptions:function(e){e.original_options;var t=e.service_name;if(!(t in this.available_services))throw new Error("Unknown federated service "+t);return this.log("getFetchOptions for service "+t),this.available_services[t].call(this,e)},setActiveTenant:function(e){if(!_.tenantExists(e)&&"3DDashboard"!==e)throw g.warn("Unknown tenant "+e),new Error("Unknown tenant "+e);this.active_tenant=e,c.initSecurityContext3DSpace(this)},getActiveTenant:function(){return this.active_tenant},toJSON:function(){return{active_tenant:this.active_tenant,available_tenants:_.getAllTenants()}},getAvailableTenants:function(){return _.getAvailableTenantsForSearch()},getTenantDisplayName:function(e){return _.getTenantDisplayName(e)},get3DSpaceUrl:function(){return _.getServiceURL("cstorage",this.active_tenant)},getFedSearchUrl:function(t){let i="",r=e.is(t,"string")?t:this.active_tenant;return i=_.getServiceURL("search",r),e.is(i)&&-1===i.lastIndexOf("/federated")&&(i+="/federated"),i},getVocabularyUrl:function(){let t=this.get3DSpaceUrl();return e.is(t,"string")||(t=_.getServiceURL("tagger",this.active_tenant)),t},is_odt_source:function(t){let i=!1;if(!0===n.getOption("odt_active",!0))i=!0;else{let r=_.getAllTenants(),s=!1;e.is(this.active_tenant,"string")&&this.active_tenant.length>0&&e.is(r)&&e.is(r[this.active_tenant])&&e.is(r[this.active_tenant].sources)&&(s=e.is(t)&&e.is(r[this.active_tenant].sources[t])?r[this.active_tenant].sources[t].odt:!!e.is(r[this.active_tenant].sources.search)&&r[this.active_tenant].sources.search.odt),i=!!e.is(s)&&s}return i},_reset_internals:function(){this.valid=!1,this.active_tenant=""},getFedSearchLabel:function(){return this._fedSearchLabel},getServicewithRole:function(t,i){var r=this;!function(s){if(e.is(s,"array")){var n=t.tenantId;e.is(n)||(n=r.getActiveTenant());var a=c.getLanguage();i({tenantId:n,lang:a})}}([])},getSuggestions:function(t,i){if(!e.is(t,"object")||!e.is(t.query,"string")||t.query.indexOf(":")>0)return!1;e.is(t.input,"array")&&t.input.length>0&&t.input.pop();var r=this.getFedSearchUrl()+"/suggest",n=c.getSecurityContext(),a={method:"GET",data:{query:t.query,SecurityContext:n&&n.trim().length>0?n:void 0,tenant:this.active_tenant,field:"ds6w:label"},headers:{"Accept-Language":c.getLanguage(),Accept:"application/json"},onComplete:function(t){return t&&(t=JSON.parse(t)),e.is(t,"object")?i(t):i([])},onFailure:function(e){return g.error(e),i([])}};!0===c.isSuggestAvailable(this.getActiveTenant())?s.authenticatedRequest(r,a):a.onComplete()},setSecurityContext:function(e){this.active_role=e},getUserPicture:function(t){if(!e.is(t))throw new Error("Invalid argument in getUserPicture. No options provided");let i=d.getWebappsAssetUrl("SNResultUX","images/anonymized_34x34.png");if(e.is(this.active_tenant,"string")){let r=_.getServiceURL("swym",this.active_tenant);e.is(r,"string")&&(i="{0}/api/user/getpicture/login/{1}/format/{2}".format(r,t.login,t.format))}return i},_removeRestrictedSources:function(t){var i=n.getOption("restrictedSourcesForTopBarSearch");if(e.is(i,"array")&&i.length>0){var r=h.getAvailableSources(this.active_tenant);e.is(r,"array")&&r.length>0&&(0===t.source.length?(r=r.filter(function(e){return-1===i.indexOf(e.name)&&!0===e.status})).forEach(function(e){t.source.push(e.name)}):t.source.length>0&&(t.source=t.source.filter(function(e){return-1===i.indexOf(e)})))}},_getOtherRDFDataSources:function(){var t=[],i=h.getAvailableSources(this.active_tenant);if(e.is(n.getOption("RDFDataSources"))){var r=Object.keys(n.getOption("RDFDataSources"));e.is(r,"array")&&r.length>0&&(i=i.filter(function(e){return-1<r.indexOf(e.name)&&!0===e.status})).forEach(function(e){t.push(e.name)})}return t},isSingleTenant:function(){return!(_.getAvailableTenantsForSearch().length>1)}})});