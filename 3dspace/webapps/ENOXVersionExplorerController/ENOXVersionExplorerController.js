define("DS/ENOXVersionExplorerController/CreateNewVersionController",["UWA/Core","UWA/Controls/Abstract","DS/ENOXVersionExplorerViews/NewVersionDialog","DS/ENOXVersionExplorerViews/NewRevisionDialog","DS/ENOXVersionExplorerModelManager/ModelManagerBase","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/LifecycleCmd/MessageMediator","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","UWA/Promise","DS/ENOXVersionExplorerModelManager/ModelManagerP","DS/ENOXVersionExplorerModelManager/ModelManagerHistory2","DS/ENOXVersionExplorerModelManager/ModelManagerRDF","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils"],function(e,n,t,o,i,r,s,a,d,l,u,p,c){"use strict";return n.extend({init:function(n){n=n||{};var E=this,f=void 0,h=void 0;E=this;function _(e,n){if("string"==typeof n&&n.length&&e!==a.DATA_MODEL_TYPES.MODEL_HISTORY&&(e=a.DATA_MODEL_TYPES[n.contains(":")?"MODEL_RDF":"MODEL_REVISION"]),e&&f._DATA_MODEL_TYPE!==e){switch(f._DATA_MODEL_TYPE=e,f._DATA_MODEL_TYPE){case a.DATA_MODEL_TYPES.MODEL_RDF:h=p;break;case a.DATA_MODEL_TYPES.MODEL_HISTORY:h=u;break;default:h=l}f.setManager(h)}}function v(e){E.dispatchEvent("ENOXVersionExplorerError",e)}function x(e){f.createNewVersionPromise({parentid:e.parent.options.id,title:e.title,description:e.description,versionSemantic:e.versionSemantic,nextRevision:e.parent.nextRevision,itemID:f.itemID,loadThumbnail:!1}).then(function(e){s.dispatchEvent("_ENOXVersionExplorerNewVersionCreated",e),E.dispatchEvent("ENOXVersionExplorerNewVersionCreated",e)},v)}n=e.extend({newVersionDialogContainer:null},n),this._parent(n),f=new(r.implement(i));var m=e.Class.extend({showDialog:function(e){if("string"!=typeof e.parentID||!e.parentID.length)throw Error("CreateNewVersionController:showDialog: parentPhysical ID cannot be null");_(e.dataModelType,e.type),f.loadVersionModelPromise({id:e.parentID,loadThumbnail:!1,tenantId:e.tenantId,securityContext:e.securityContext}).then(function(){var i=f.searchByID(e.parentID);if(i.length>1)throw Error("CreateNewVersionController:showDialog: more than one node with same ID");if(!i.length)throw Error("CreateNewVersionController:showDialog: Parent ID not found");f._DATA_MODEL_TYPE===a.DATA_MODEL_TYPES.MODEL_REVISION?function(e){var t=e.parentTreeNode;if(!t)throw Error("CreateNewVersionController:_displayNewRevisionDialog parent tree node is null");o.displayDialog({defaultName:t.options.grid.title,derivedFrom:{id:t.options.id,name:t.options.grid.title+" "+t.options.grid.code},nextRevision:c.getNextRevision(t.options.grid.code.split(".")[0])+".1",parentContainer:n.newVersionDialogContainer,onOK:function(e,n){x({title:e,description:n,parent:t,versionSemantic:"E"})}})}({parentTreeNode:i[0]}):function(e){var o=e.parentTreeNode;if(!o)throw Error("CreateNewVersionController:_displayNewversionDialog parent tree node is null");t.displayDialog({dataModelType:f._DATA_MODEL_TYPE,defaultName:f.getNewVersionName(),derivedFrom:{id:o.options.id,name:o.options.grid.title},parentContainer:n.newVersionDialogContainer,onOK:function(e,n,t){x({title:e,description:n,parent:o,nextRevision:c.getNextRevision(o.options.grid.code.split(".")[0])+".1",versionSemantic:t})}})}({parentTreeNode:i[0]})},v)},canNewVersionBeCreatedPromise:function(e){if("string"!=typeof e.parentID||!e.parentID.length)throw Error("CreateNewVersionController:canNewVersionBeCreatedPromise: parentPhysical ID cannot be null");return _(e.dataModelType,e.type),new d(function(n,t){f.loadVersionModelPromise({id:e.parentID,loadThumbnail:!1,tenantId:e.tenantId,securityContext:e.securityContext}).then(function(){var t=f.searchByID(e.parentID);if(t.length>1)throw Error("CreateNewVersionController:showDialog: more than one node with same ID");if(!t.length)throw Error("CreateNewVersionController:showDialog: Parent ID not found");n(t[0].isLeaf())},t)})}});e.Class.implement.call(this,m)}})}),define("DS/ENOXVersionExplorerController/VersionExplorerEventList",["UWA/Core","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerViews/NodeDropdownMenu","DS/WebappsUtils/WebappsUtils","DS/LifecycleCmd/CommandAPI","DS/LifecycleServices/LifecycleCommandManager","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","css!DS/ENOXVersionExplorerController/styles/VersionExplorerEventList"],function(e,n,t,o,i,r,s,a,d,l){"use strict";var u=function(e,n){return"url("+r.getWebappsBaseUrl()+(n||"RevisionFamily")+"/assets/icons/32/"+e+")"};return function(r,l){function p(n){var t,i,r,s;n instanceof o?(i=n,t={position:{x:0,y:0},selectedNodes:[]}):i=(t=n.menuctx).treeNode,void 0!==i.options&&void 0!==i.options.label&&void 0!==i.options.label&&(s=e.String.unescapeHTML(i.options.label));var a=i.options.data.type;void 0!==a&&0!=a.length||(a=i.options.grid.type);var d=i.options.grid&&i.options.grid.contents&&i.options.grid.contents.length>0?i.options.grid.contents[0].id:i.options.id;return r={physicalid:d,id:d,displayName:s,revision:i.options.grid.code,type:a,pos:[t.position.x,t.position.y],selectedNodes:t.selectedNodes,name:s},n.menuctx=void 0,r}this._eventList=[{id:"ENOXVersionExplorerSetActiveVersion",subscribed:!0,published:!1,externalsub:!0,externalpub:!1,subfn:function(e){var n=e.data||e,t={};n instanceof o?t.treeNode=n:t.id=n&&"string"==typeof n.id?n.id:"string"==typeof n?n:void 0,t.treeNode||t.id||(t.id=this._activeVersion||this._currentVersion),t.id&&this._setActiveVersion(t)}},{id:"ENOXVersionExplorerLoadVersionModel",subscribed:!0,externalsub:!0,onComplete:!0,subfn:function(n){var t=this,o=n&&(n.data||n)||{};if(!("string"==typeof o.id&&o.id.length||"object"==typeof o.id&&null!==o.id))throw Error("ENOXVersionExplorerLoadVersionModel:id <physicalid> cannot be null");var i=o&&"function"==typeof o.onComplete?function(e){o.onComplete(e),t.publishEvent("ENOXVersionExplorerLoadCompleted",e)}:function(e){t.publishEvent("ENOXVersionExplorerLoadCompleted",e)};t._loadVersionModel(e.merge({reframe:!0,onComplete:i},o))}},{id:"ENOXVersionExplorerLoadCompleted",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){null==this.commandManager&&(this.commandManager=new a,this.commandManager.addEvent("onCompleteGetOptions",function(e){for(var n=!1,t=0;t<e.options.length;++t){var o=e.options[t];if(o.hasOwnProperty("newRevisionFromOldRevisionAllowed")){this._REVISION_FROM_NON_LEAF_ALLOWED=o.newRevisionFromOldRevisionAllowed,n=!0;break}}!1===n&&(this._REVISION_FROM_NON_LEAF_ALLOWED=!0)},this));try{var n={data:[{physicalid:e.id}],command:"revise"};void 0===this.tenant&&void 0!==e&&(this.tenant=e.tenantId),this.commandManager.setTenant(this.tenant),this.commandManager.getOptions(n,function(e){},this._context)}finally{}}},{id:"ENOXVersionExplorerRefresh",subscribed:!0,published:!1,externalsub:!0,externalpub:!1,onComplete:!0,subfn:function(n){var t=this,o=n&&(n.data||n)||{};if(o.id=o.id||t._currentVersion,o.tenantId=o.tenantId||t._tenantId,o.context=o.context||t._context,o.type=o.type||t._type,o.dataModelType=o.dataModelType||r._DATA_MODEL_TYPE,"portfolio"===o.applicationName&&!0===o.forcereload&&(r.itemID=null),!("string"==typeof o.id&&o.id.length||"object"==typeof o.id&&null!==o.id))throw Error("ENOXVersionExplorerRefresh:id <physicalid> cannot be null");var i=o&&"function"==typeof o.onComplete?function(e){o.onComplete(e),t.publishEvent("ENOXVersionExplorerLoadCompleted",e)}:function(e){t.publishEvent("ENOXVersionExplorerLoadCompleted",e)};t._loadVersionModel(e.merge({reframe:!0,onComplete:i},o))}},{id:"ENOXVersionExplorerThumbnailGraphLayoutChanged",published:!0,externalsub:!1,externalpub:!0},{id:"ENOXVersionExplorerOpenVersion",externalpub:!0,published:!0},{id:"preENOXVersionExplorerNewRevisionFrom",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerNewRevisionFrom",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerNewRevisionFrom",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerNewRevisionFrom",subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e;if(r._DATA_MODEL_TYPE===n.DATA_MODEL_TYPES.MODEL_RDF){var i={};t instanceof o?i.treeNode=t:i.id=t&&"string"==typeof t.id?t.id:"string"==typeof t?t:void 0,this._displayNewRevisionDialog(i)}else window.widget.options||(window.widget.options={}),window.widget.options._pruneHash=r._pruneHash,window.widget.options._branchColorHash=r._branchColorHash,s.runCommand("ReviseFromHdr",[p(t)],this._widget,this._context)}},{id:"preENOXVersionExplorerCompareToSelected",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCompareToSelected",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCompareToSelected",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerMergeIntoSelected",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerMergeIntoSelected",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerMergeIntoSelected",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerCompareWithBranchOrigin",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCompareWithBranchOrigin",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCompareWithBranchOrigin",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerSetPruneModeUp",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerSetPruneMode",subfn:function(e){e.pruneMode="up",this.publishEvent("preEventCompletedENOXVersionExplorerSetPruneMode",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerSetPruneModeDown",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerSetPruneMode",subfn:function(e){e.pruneMode="down",this.publishEvent("preEventCompletedENOXVersionExplorerSetPruneMode",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerSetPruneModeNone",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerSetPruneMode",subfn:function(e){e.pruneMode="none",this.publishEvent("preEventCompletedENOXVersionExplorerSetPruneMode",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerSetPruneModeNoneAncestors",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerSetPruneMode",subfn:function(e){e.pruneMode="none",this.publishEvent("preEventCompletedENOXVersionExplorerSetPruneMode",e)},allowPreventDefault:!0},{id:"preENOXVersionExplorerSetPruneModeNoneDescendants",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerSetPruneMode",subfn:function(e){e.pruneMode="none",this.publishEvent("preEventCompletedENOXVersionExplorerSetPruneMode",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerSetPruneMode",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.__SUBWAYGRAPHNODE__;n&&n.view&&n.view.display.elt.onmousedown({pruneMode:e.pruneMode})}},{id:"preEventCompletedENOXVersionExplorerCompareToSelected",subscribed:!0,externalsub:!1,subfn:function(e){for(var n,t,o,i,r,s=e.data||e,a=s.options.data.id,d=s.options.data.contextId,l=s.options.data.serviceId,u=s.options.data.type,p=s.options.data.displayName,c=this.getSelectedNodes(),E=0;E<c.length;E++){var f=c[E];if(f._options.id!==a){n=f._options.id,t=f._options.data.contextId,o=f._options.data.serviceId,i=f._options.data.type,r=f._options.data.displayName;break}}this._showCompare({id:a,contextId:d,serviceId:l,objectType:u,displayName:p},{id:n,contextId:t,serviceId:o,objectType:i,displayName:r})}},{id:"preEventCompletedENOXVersionExplorerMergeIntoSelected",subscribed:!0,externalsub:!1,subfn:function(e){for(var n=e.data||e,t=p(n),o=n.options.data.id,i=null,r=this.getSelectedNodes(),a=0;a<r.length;a++){var d=r[a];if(d._options.id!==o){i=p(d);break}}s.runCommand("MergeHdr",[i,t],this._widget,this._context)}},{id:"preEventCompletedENOXVersionExplorerCompareWithBranchOrigin",subscribed:!0,externalsub:!1,subfn:function(e){var n,t,o,i,r=e.data||e,s=r.options.data.id,a=r.options.data.contextId,d=r.options.data.serviceId,l=r.options.data.type,u=r.options.data.displayName;if(e.options&&e.options.ancestors){var p=e.options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()});if(!p&&e.__BRANCH__&&e.__BRANCH__.nodeList[0].options.ancestors&&(p=e.__BRANCH__.nodeList[0].options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()})),p){n=p.id,t=a,o=d,i=l;var c=this.getFilter({id:s,contextId:a,serviceId:d,objectType:l,displayName:u});if(c&&c.referencedObject){var E=c.referencedObject;if(E.identifier!==n){E.identifier=n;var f=E.relativePath.substring(0,E.relativePath.length-32);if(f+=n,E.relativePath=f,c.filter&&c.filter.filterSpecifications){var h=c.filter.filterSpecifications;for(var _ of h){var v=_.filterCriteria;for(var x of v)if("context"===x.criteriaType){var m=x.excludedNodesList;m&&(x.excludedNodesList=m.filter(e=>e.indexOf(n)>-1).map(e=>e.slice(e.indexOf(n))));var b=x.addedNodesList;b&&(x.addedNodesList=b.filter(e=>e.indexOf(n)>-1).map(e=>e.slice(e.indexOf(n))))}}}}}this._showCompare({id:s,contextId:a,serviceId:d,objectType:l,displayName:u,filter:void 0},{id:n,contextId:t,serviceId:o,objectType:i,displayName:void 0,filter:c})}}}},{id:"preENOXVersionExplorerDownload",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerDownload",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerDownload",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerDownload",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e;s.runCommand("DownloadHdr",[p(n)],this._widget,this._context)}},{id:"preENOXVersionExplorerPreview",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerPreview",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerPreview",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerPreview",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e;s.runCommand("PreviewHdr",[p(n)],this._widget,this._context)}},{id:"preENOXVersionExplorerWhereUsed",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerWhereUse",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerWhereUse",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerWhereUse",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e,t=n.options.data.id,o=n.options.data.type,i=n.options.data.displayName;this._showWhereUsed({id:t,type:o,displayName:i})}},{id:"preENOXVersionExplorerCreateNewVersion",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateNewVersion",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCreateNewVersion",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerCreateNewVersion",subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e;if(r._DATA_MODEL_TYPE===n.DATA_MODEL_TYPES.MODEL_RDF){var i={};t instanceof o?i.treeNode=t:i.id=t&&"string"==typeof t.id?t.id:"string"==typeof t?t:void 0,this._displayNewRevisionDialog(i)}else s.runCommand("RevisionHdr",[p(t)],this._widget,this._context)}},{id:"ENOXVersionExplorerNewVersionCreated",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){var t=e.data||e;if(l._getActiveView()===n.DISPLAY_MODES.THUMBNAIL_VIEW&&l._thumbnailGraphView){var o=[];o.push(t),t.getParent()&&o.push(t.getParent()),l._thumbnailGraphView.reframeOn(o)}}},{id:"preENOXVersionExplorerCreateNewBranch",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateNewBranch",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCreateNewBranch",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerCreateNewBranch",subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e;if(r._DATA_MODEL_TYPE===n.DATA_MODEL_TYPES.MODEL_RDF){var i={};t instanceof o?i.treeNode=t:i.id=t&&"string"==typeof t.id?t.id:"string"==typeof t?t:void 0,this._displayNewVersionDialog(i)}else s.runCommand("NewBranchHdr",[p(t)],this._widget,this._context)}},{id:"preENOXVersionExplorerEditBranchTitle",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerEditBranchTitle",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerEditBranchTitle",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerEditBranchTitle",published:!0,externalsub:!1,subfn:function(e){var n=e.data||e,t=n.options.data.id,o=n.options.data.displayName,i="";e.options&&e.options.ancestors&&(i=e.options.ancestors[0].title),this._displayEditDialog(t,o,i)},allowPreventDefault:!0},{id:"preENOXVersionExplorerCreateDuplicate",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerCreateDuplicate",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerCreateDuplicate",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerCreateDuplicate",subscribed:!0,externalsub:!1,subfn:function(e){var t=e.data||e;if(r._DATA_MODEL_TYPE===n.DATA_MODEL_TYPES.MODEL_RDF){var i={};t instanceof o?i.treeNode=t:i.id=t&&"string"==typeof t.id?t.id:"string"==typeof t?t:void 0,this._displayNewVersionDialog(i)}else s.runCommand("DuplicateHdr",[p(t)],this._widget,this._context)}},{id:"preENOXVersionExplorerDeleteVersion",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerDeleteVersion",subfn:function(e){r._forceLoadTree=!0,this.publishEvent("preEventCompletedENOXVersionExplorerDeleteVersion",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerDeleteVersion",subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e;s.runCommand("DeleteHdr",[p(n)],this._widget,this._context)}},{id:"ENOXVersionExplorerVersionDeleteCompleted",published:!0,externalpub:!0},{id:"preEventENOXVersionExplorerShowMaturity",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerShowMaturity",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerShowMaturity",e)},allowPreventDefault:!0},{id:"preEventENOXVersionExplorerOpenWith",published:!0,externalpub:!0,onCompleteEvent:"preEventCompletedENOXVersionExplorerOpenWith",subfn:function(e){this.publishEvent("preEventCompletedENOXVersionExplorerOpenWith",e)},allowPreventDefault:!0},{id:"preEventCompletedENOXVersionExplorerShowMaturity",published:!0,externalpub:!0,subscribed:!0,externalsub:!1,allowPreventDefault:!0,subfn:function(e){var n=e.data||e;s.runCommand("MaturityHdr",[p(n)],this._widget,this._context)}},{id:"ENOXVersionExplorerDoubleClickVersion",published:!0,externalpub:!0},{id:"ENOXVersionExplorerError",published:!0,externalpub:!0},{id:"ENOXVersionExplorerCompare",published:!0,externalpub:!0,subscribed:!1,externalsub:!1},{id:"select",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){void 0!==l._highlightParents&&l._highlightParents(e.data.nodeModel)},externalsub:!0,noPubFn:!0},{id:"unselect",published:!0,externalpub:!0,subscribed:!0,subfn:function(e){void 0!==l._unhighlightParents&&l._unhighlightParents(e.data.nodeModel)},externalsub:!0,noPubFn:!0},{id:"ENOXVersionExplorerVersionModified",published:!0,externalpub:!0},{id:"ENOXVersionExplorerVersionOwnerChanged",published:!0,externalpub:!0},{id:"ENOXVersionExplorerDisplayProperties",published:!0,externalpub:!0,subscribed:!0,externalsub:!1,allowPreventDefault:!0,subfn:function(e){var n=e.data||e;s.runCommand("Properties",[p(n)],this._widget,this._context)}},{id:"ENOXVersionExplorerModalOK",published:!0,externalpub:!0},{id:"ENOXVersionExplorerModalCancel",published:!0,externalpub:!0},{id:"ENOXVersionExplorerDropdownMenu",published:!0,externalpub:!1,subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e,t=this;if(t._isWebInWinMode()){var o=n.treeNode.options.grid.type,r=n.treeNode.options.grid.name,s=n.treeNode.options.grid.code,a=n.treeNode.options.grid.id;t._getWebInWinSocket().contextCallback=function(e){t._getNodeDropdownMenuListPromise(n.treeNode).then(function(e){n.menuList=e,i.displayNodeDropdownMenu.bind(t)(n)})},t._fetchNativeContextMenu(a,o,r,s)}else t._getNodeDropdownMenuListPromise(n.treeNode).then(function(e){n.menuList=e,i.displayNodeDropdownMenu.bind(t)(n)})},allowPreventDefault:!0},{id:"ENOXVersionExplorerOnDrag",published:!0,externalpub:!1,subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e,t=this;t._getNodeDropdownMenuListPromise(n.treeNode).then(function(e){n.menuList=e,i.displayNodeDropdownMenu.bind(t)(n)})},allowPreventDefault:!0},{id:"ENOXVersionExplorerOnDrop",published:!0,externalpub:!1,subscribed:!0,externalsub:!1,subfn:function(e){var n=e.data||e,t=this;t._getNodeDropdownMenuListPromise(n.treeNode).then(function(e){n.menuList=e,i.displayNodeDropdownMenu.bind(t)(n)})},allowPreventDefault:!0},{id:"_ENOXVersionExplorerInternalRefresh",published:!0,subscribed:!0,externalpub:!1,externalsub:!1,subfn:function(n){var t=this;if(!("string"==typeof t._currentVersion&&t._currentVersion.length||"object"==typeof t._currentVersion&&null!==t._currentVersion))throw Error("_ENOXVersionExplorerInternalRefresh: _versionExplorerController._currentVersion is not defined");t._loadVersionModel(e.extend({id:t._currentVersion,tenantId:t._tenantId,securityContext:t._securityContext,context:t._context,type:t._type,dataModelType:r._DATA_MODEL_TYPE,onComplete:function(e){t.publishEvent("_ENOXVersionExplorerInternalRefreshCompleted",e)}},n))}},{id:"_ENOXVersionExplorerLaunchFilterSpecification",published:!0,externalpub:!0,subscribed:!0,externalsub:!1,allowPreventDefault:!0,subfn:function(e){e.data}},{id:"_ENOXVersionExplorerUpdatePruneState",published:!0,externalpub:!0,subscribed:!0,externalsub:!1,allowPreventDefault:!0,subfn:function(e){var n=e.data||e,t=this,o=function(e,n,t,o){Object.keys(r._pruneHash).map(function(i){(r._pruneHash[i].branchId!=e&&"down"!=n||r._pruneHash[i].pruneMode!=n)&&(r._pruneHash[i].branchId!=e&&"down"!=t||r._pruneHash[i].pruneMode!=t)&&(r._pruneHash[i].branchId!=e&&"down"!=o||r._pruneHash[i].pruneMode!=o)||delete r._pruneHash[i]})},i=void 0,s=r._pruneHash[n[0].id];s&&(i=s.pruneMode),"up"==n[0].pruneMode?"down"==i?o(n[0].branchId,"up","out","down"):o(n[0].branchId,"up","out"):"down"==n[0].pruneMode?"up"==i?o(n[0].branchId,"up","out","down"):o(n[0].branchId,"down"):"none"==n[0].pruneMode&&("up"==i?o(n[0].branchId,"up","out"):"down"==i&&o(n[0].branchId,"down"));for(var a=0;a<n.length;a++)"none"==n[a].pruneMode?delete r._pruneHash[n[a].id]:"up"==n[a].pruneMode?r._pruneHash[n[a].id]={pruneMode:"up",branchId:n[a].branchId}:"out"==n[a].pruneMode?r._pruneHash[n[a].id]={pruneMode:"out",branchId:n[a].branchId}:"down"==n[a].pruneMode&&(r._pruneHash[n[a].id]={pruneMode:"down",branchId:n[a].branchId});r._forceLoadTree=!0,t.publishEvent("_ENOXVersionExplorerInternalRefresh",{refresh:!0});var d=t.subscribeEvent("_ENOXVersionExplorerInternalRefreshCompleted",function(e){t.unsubscribeEvent("_ENOXVersionExplorerInternalRefreshCompleted",d),t.resetFilter()},!1)}},{id:"_ENOXVersionExplorerInternalRefreshCompleted",published:!0,externalpub:!1,subscribed:!0,externalsub:!1},{id:"_ENOXVersionExplorerSelectionModeChanged",published:!0,externalpub:!1,subscribed:!0,externalsub:!1},{id:"_ENOXVersionExplorerManageMultiSelect",published:!0,externalpub:!1,subscribed:!0,externalsub:!1},{id:"_ENOXVersionExplorerNoActions",published:!1,externalpub:!1,pubfn:function(){}},{id:"_ENOXVersionExplorerViewChanged",published:!0,externalpub:!1,subfn:function(e){r._loadThumbnailsAsync()}}],this._menuList=[{id:"ENOXVersionExplorerOpenVersion",event:"ENOXVersionExplorerOpenVersion",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open",family:WUXManagedFontIcons.Font3DS},text:d.open,userAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&!e.isActive()},nodeDropdown:!0},{id:"ENOXVersionExplorerOpenWith",event:"preEventENOXVersionExplorerOpenWith",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-export",family:WUXManagedFontIcons.Font3DS},icon:u("I_OpenWith.png","ENXNav"),text:d.openWith,userAccess:["read","write"],checkVersion:function(e){return!1},nodeDropdown:!0},{id:"ENOXVersionExplorerPreview",event:"preENOXVersionExplorerPreview",fonticon:{content:"fonticon fonticon-2x fonticon-eye",family:WUXManagedFontIcons.Font3DS},text:d.preview,checkAccess:["read","write"],checkVersion:function(e){return s.checkAvailability("PreviewHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0},{id:"divider"},{id:"ENOXVersionExplorerCreateNewRevision",event:"preENOXVersionExplorerCreateNewVersion",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-line-add",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("RevisionHdr"),text:s.getTitle("RevisionHdr"),checkAccess:["read","write"],checkVersion:function(e){return!0===t.X_DESIGN||r._DATA_MODEL_TYPE===n.DATA_MODEL_TYPES.MODEL_RDF||null!=this._REVISION_FROM_NON_LEAF_ALLOWED&&(e.isLeaf()||!0===this._REVISION_FROM_NON_LEAF_ALLOWED)&&s.checkAvailability("RevisionHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerNewRevisionFrom",event:"preENOXVersionExplorerNewRevisionFrom",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-branch-add wux-ui-3ds-flip-vertical version-explorer-noflip-border",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("ReviseFromHdr"),text:s.getTitle("ReviseFromHdr"),checkAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&s.checkAvailability("ReviseFromHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerCreateNewBranch",event:"preENOXVersionExplorerCreateNewBranch",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-branch-add",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("NewBranchHdr"),text:s.getTitle("NewBranchHdr"),checkAccess:["read","write"],checkVersion:function(e){return!0===t.X_DESIGN||r._DATA_MODEL_TYPE===n.DATA_MODEL_TYPES.MODEL_RDF||s.checkAvailability("NewBranchHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerCompareWithBranchOrigin",event:"preENOXVersionExplorerCompareWithBranchOrigin",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-part-compare",family:WUXManagedFontIcons.Font3DS},icon:u("I_Compare.png"),text:d.compareWithBranchOrigin,checkAccess:["read","write"],checkVersion:function(e){return!!(e.__BRANCH__&&e.__BRANCH__.nodeList[0].options.ancestors&&e.__BRANCH__.nodeList[0].options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()}))},nodeDropdown:!0},{id:"ENOXVersionExplorerEditBranchTitle",event:"preENOXVersionExplorerEditBranchTitle",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil",family:WUXManagedFontIcons.Font3DS},text:d.editBranchTitle,checkAccess:["read","write"],checkVersion:function(e){return!!(e.isMIB()&&e.__BRANCH__&&e.__BRANCH__.nodeList[0].options.ancestors)},nodeDropdown:!0},{id:"ENOXVersionExplorerDuplicate",event:"preENOXVersionExplorerCreateDuplicate",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-duplicate",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("DuplicateHdr"),text:s.getTitle("DuplicateHdr"),checkAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&s.checkAvailability("DuplicateHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerCompareToSelected",event:"preENOXVersionExplorerCompareToSelected",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-part-compare",family:WUXManagedFontIcons.Font3DS},icon:u("I_Compare.png"),text:d.compareTo,checkAccess:["read","write"],checkVersion:function(e){return!1},nodeDropdown:!0},{id:"ENOXVersionExplorerMergeIntoSelected",event:"preENOXVersionExplorerMergeIntoSelected",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-branch-downward",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("MergeHdr"),text:d.mergeInto,checkAccess:["read","write"],checkVersion:function(e){return!1},nodeDropdown:!0},{id:"ENOXVersionExplorerPruneDescendants",event:"preENOXVersionExplorerSetPruneModeUp",fonticon:{content:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-down",family:WUXManagedFontIcons.Font3DS},text:d.hideDescendants,checkAccess:["read","write"],pruneMode:"up",checkVersion:function(e){if(l._getActiveView()===n.DISPLAY_MODES.SUBWAY_VIEW){var t=e.__SUBWAYGRAPHNODE__&&e.__SUBWAYGRAPHNODE__.data?e.__SUBWAYGRAPHNODE__.data.pruneMode:void 0;return"up"!=t&&"down"!=t}return!1},nodeDropdown:!0},{id:"ENOXVersionExplorerPruneAncestors",event:"preENOXVersionExplorerSetPruneModeDown",fonticon:{content:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-up",family:WUXManagedFontIcons.Font3DS},text:d.hideAncestors,checkAccess:["read","write"],pruneMode:"down",checkVersion:function(e){if(l._getActiveView()===n.DISPLAY_MODES.SUBWAY_VIEW&&e.options.ancestors){var t=e.__SUBWAYGRAPHNODE__&&e.__SUBWAYGRAPHNODE__.data?e.__SUBWAYGRAPHNODE__.data.pruneMode:void 0;return"up"!=t&&"down"!=t}return!1},nodeDropdown:!0},{id:"ENOXVersionExplorerPruneNoneAncestors",event:"preENOXVersionExplorerSetPruneModeNoneAncestors",fonticon:{content:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-up",family:WUXManagedFontIcons.Font3DS},text:d.showAncestors,checkAccess:["read","write"],pruneMode:"none",checkVersion:function(e){return l._getActiveView()===n.DISPLAY_MODES.SUBWAY_VIEW&&"down"==(e.__SUBWAYGRAPHNODE__&&e.__SUBWAYGRAPHNODE__.data?e.__SUBWAYGRAPHNODE__.data.pruneMode:void 0)},nodeDropdown:!0},{id:"ENOXVersionExplorerPruneNoneDescendants",event:"preENOXVersionExplorerSetPruneModeNoneDescendants",fonticon:{content:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-flow-tree-expand-down",family:WUXManagedFontIcons.Font3DS},text:d.showDescendants,checkAccess:["read","write"],pruneMode:"none",checkVersion:function(e){return l._getActiveView()===n.DISPLAY_MODES.SUBWAY_VIEW&&"up"==(e.__SUBWAYGRAPHNODE__&&e.__SUBWAYGRAPHNODE__.data?e.__SUBWAYGRAPHNODE__.data.pruneMode:void 0)},nodeDropdown:!0},{id:"ENOXVersionExplorerShowMaturity",event:"preEventENOXVersionExplorerShowMaturity",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collaborative-lifecycle-management",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("MaturityHdr"),text:s.getTitle("MaturityHdr"),userAccess:["read","write"],checkVersion:function(e){return!e.isMIB()&&s.checkAvailability("MaturityHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0},{id:"divider"},{id:"ENOXVersionExplorerWhereUsed",event:"preENOXVersionExplorerWhereUsed",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related",family:WUXManagedFontIcons.Font3DS},icon:u("I_ENORIPE32.png"),text:d.relations,checkAccess:["read","write"],checkVersion:function(e){return!1},nodeDropdown:!0},{id:"ENOXVersionExplorerDownload",event:"preENOXVersionExplorerDownload",fonticon:{content:"fonticon fonticon-2x fonticon-download",family:WUXManagedFontIcons.Font3DS},text:d.download,checkAccess:["read","write"],checkVersion:function(e){return s.checkAvailability("DownloadHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0},{id:"ENOXVersionExplorerDisplayProperties",event:"ENOXVersionExplorerDisplayProperties",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-info-open-in-a-new-window",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("Information"),text:s.getTitle("Information"),userAccess:["read","write"],checkVersion:function(e){return r._DATA_MODEL_TYPE!==n.DATA_MODEL_TYPES.MODEL_RDF},nodeDropdown:!0},{id:"divider"},{id:"ENOXVersionExplorerDeleteVersion",event:"preENOXVersionExplorerDeleteVersion",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash",family:WUXManagedFontIcons.Font3DS},icon:s.getIconPath("DeleteHdr"),text:s.getTitle("DeleteHdr"),checkAccess:["read","write"],checkVersion:function(e){/*!treeNode.isMIB() &&*/
return s.checkAvailability("DeleteHdr",[p(e)],this._widget,this._context)},nodeDropdown:!0}],this._multiSelectMenuList=[{id:"ENOXVersionExplorerNoActions",event:"_ENOXVersionExplorerNoActions",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-block",family:WUXManagedFontIcons.Font3DS},text:d.noActions,checkVersion:function(e){return!0},multiSelectMenu:!0,minNodes:2,maxNodes:1/0,excludeIfOtherItemsExist:!0}]}}),define("DS/ENOXVersionExplorerController/VersionExplorerEventManager",["UWA/Core","UWA/Class","UWA/Promise","DS/ENOXVersionExplorerController/VersionExplorerEventList","DS/i3DXCompassPlatformServices/OpenWith","DS/CoreEvents/ModelEvents"],function(e,n,t,o,i,r){"use strict";var s=r.extend({_disabledEventList:[],init:function(r,a,d){this._parent(r);var l=a;s.implement({addExternalNodeDropdownMenuItem:function(e){for(var n=Array.isArray(e)?e:new Array(e),t=0;t<n.length;t++){if("string"!=typeof(e=n[t]).id||!e.id.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - eventId cannot be null ");if(!e.icon&&!e.fonticon)throw Error("VersionExplorerEventManager:addDropDownMenuItem - icon cannot be null ");if("string"!=typeof e.text||!e.text.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - menu text cannot be null ");if("function"!=typeof e.subfn)throw Error("VersionExplorerEventManager:addDropDownMenuItem - subscribe function cannot be null");if("function"!=typeof e.checkVersion)throw Error("VersionExplorerEventManager:addDropDownMenuItem - checkVersion function cannot be null");var o={id:e.id,externalpub:!0,published:!0,externalEvent:!0,subfn:e.subfn};this._eventList.push(o),this._registerEvent(o),this._menuList.push({id:e.id,event:e.id,icon:e.icon||void 0,fonticon:e.fonticon||void 0,text:e.text,checkVersion:e.checkVersion,externalMenu:!0,nodeDropdown:!0})}},addExternalMultiSelectDropdownMenuItem:function(e){for(var n=Array.isArray(e)?e:new Array(e),t=0;t<n.length;t++){if("string"!=typeof(e=n[t]).id||!e.id.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - eventId cannot be null ");if(!e.icon&&!e.fonticon)throw Error("VersionExplorerEventManager:addDropDownMenuItem - icon cannot be null ");if("string"!=typeof e.text||!e.text.length)throw Error("VersionExplorerEventManager:addDropDownMenuItem - menu text cannot be null ");if("function"!=typeof e.subfn)throw Error("VersionExplorerEventManager:addDropDownMenuItem - subscribe function cannot be null");if("function"!=typeof e.checkVersion)throw Error("VersionExplorerEventManager:addDropDownMenuItem - checkVersion function cannot be null");var o={id:e.id,externalpub:!0,published:!0,externalEvent:!0,subfn:e.subfn};this._eventList.push(o),this._registerEvent(o),this._multiSelectMenuList.push({id:e.id,event:e.id,icon:e.icon||void 0,fonticon:e.fonticon||void 0,text:e.text,checkVersion:e.checkVersion,externalMenu:!0,multiSelectMenu:!0,minNodes:e.minNodes||2,maxNodes:e.maxNodes||1/0})}},removeExternalNodeDropdownMenuItem:function(e){this._removeExternalDropdownMenuItem(e)},removeExternalMultiSelectDropdownMenuItem:function(e){this._removeExternalDropdownMenuItem(e,!0)},getPublishedEvents:function(){return this._eventList.reduce(function(e,n){return!0===n.published&&!0===n.externalpub&&e.push({event:n.id,onCompleteEvent:n.onCompleteEvent}),e},[])},getSubscribedEvents:function(){return this._eventList.reduce(function(e,n){return!0===n.subscribed&&!0===n.externalsub&&e.push({event:n.id,onComplete:n.onComplete}),e},[])},subscribeEvent:function(e,n,t){var o,i=this._getEvent(e);return i&&"function"==typeof n&&(o=this.subscribe({event:i.id},n),t&&i.tokenDefault&&!0===i.allowPreventDefault&&(this.unsubscribe(i.tokenDefault),i.tokenDefault=void 0),i.tokens.push(o)),o},unsubscribeEvent:function(e,n){var t=this._getEvent(e);if(t&&n){var o=t.tokens.splice(t.tokens.indexOf(n),1);1===o.length&&this.unsubscribe(o[0]),t.tokens.length||!t.subfn||t.tokenDefault||(t.tokenDefault=this.subscribe({event:t.id},t.externalEvent?t.subfn:t.subfn.bind(this)))}},publishEvent:function(e,n){var t=this._getEvent(e);t&&"function"==typeof t.pubfn&&t.pubfn(n)},disablePublishEvent:function(e){this._disabledEventList.push(e)},enablePublishEvent:function(e){this._disabledEventList.splice(this._disabledEventList.indexOf(e),1)},getMenuItemsIDList:function(e){return this[e?"_multiSelectMenuList":"_menuList"].reduce(function(e,n){return!("divider"===n.id||"ENOXVersionExplorerNoActions"===n.id)&&e.push(n.id),e},[])},hideMenuItem:function(e,n){var t=this[n?"_multiSelectMenuList":"_menuList"].find(function(n){return n.id===e});t&&(t.disabled=!0)},showMenuItem:function(e,n){var t=this[n?"_multiSelectMenuList":"_menuList"].find(function(n){return n.id===e});t&&(t.disabled=!1)},setCheckVersionExternalFunction:function(e,n,t){var o=this[t?"_multiSelectMenuList":"_menuList"].find(function(n){return n.id===e});o&&"function"==typeof n&&(o.checkVersionExternal=n)},resetCheckVersionExternalFunction:function(e,n){var t=this[n?"_multiSelectMenuList":"_menuList"].find(function(n){return n.id===e});t&&(t.checkVersionExternal=void 0)},publish:function(e){if("select"===e.event||"unselect"===e.event&&e.context&&e.context.options){var n=e.context.options;if(n.grid&&n.grid.contents&&n.grid.contents[0].id){var t=n.grid.contents[0].id;e.context.options.cid=t}}this._disabledEventList.indexOf(e.event)<0&&this._parent(e)},_removeExternalDropdownMenuItem:function(e,n){var t,o,i=!0===n?"_multiSelectMenuList":"_menuList";1===(o=1===(t=this[i].splice(this[i].findIndex(function(n){return n.id===e&&!0===n.externalMenu}),1)).length?this._eventList.find(function(e){return e.id===t[0].id&&!0===t[0].externalMenu&&!0===e.externalEvent}):[]).length&&this._unregisterEvent(o[0])},_registerEvent:function(e){e.noPubFn||(e.pubfn=function(n){this.publish({event:e.id,data:n})}.bind(this)),e.tokens=[],e.subfn&&(e.tokenDefault=this.subscribe({event:e.id},e.externalEvent?e.subfn:e.subfn.bind(this)))},_unregisterEvent:function(e){for(var n=e.tokens.length,t=0;t<n;t++)this.unsubscribe(e.tokens[t]);e.tokens=[],e.tokenDefault&&(this.unsubscribe(e.tokenDefault),e.defaultToken=void 0)},_getEvent:function(e){return this._eventList.find(function(n){return n.id===e})},_getMenuItemList:function(e){var n=this;return n[!0===e?"_multiSelectMenuList":"_menuList"].map(function(e){if("object"==typeof e){var t={};if("divider"===e.event)t=e;else for(var o in e)t[o]="event"===o?n._eventList.find(function(n){return n.id===e[o]}):e[o];return t}})},_getNodeDropdownMenuListPromise:function(e){var n=this;return l._getPreContextualMenuPromise(e).then(function(e){var o=e;return new t(function(e,t){var i=n._getMenuItemList().reduce(function(e,t,i,r){return t&&t.id&&("divider"===t.id||!t.disabled&&!!(t.checkVersionExternal||(!0===t.event.externalEvent?t.checkVersion:t.checkVersion.bind(n)))(o)&&!0===t.nodeDropdown)&&e.push(t),e},[]);"divider"==i[i.length-1].id&&i.pop();for(var r=-1,s=0;s<i.length;s++)if("ENOXVersionExplorerOpenWith"===i[s].id){r=s;break}if(!(r<0))return n._getNodeDropdownMenuListOpenWithPromise(o).then(function(n){n.length>0?i[r].submenu=n:i.splice(r,1),e(i)});e(i)})})},_getNodeDropdownMenuListOpenWithPromise:function(n){var o=this;return new t(function(t,s){var a=[],d=n.options.data.type;void 0!==d&&0!==d.length||!n.options.grid||(d=n.options.data.type=n.options.grid.type);var l=n.options.grid["ds6w:kind"];o._widget?require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(o,s){o.app_initialization(function(){var s=n;s.options.type=s.options.data.type,s.options.displayname=r.label,s.getID=function(){return this.options.grid&&this.options.grid.contents&&this.options.grid.contents.length>0?this.options.grid.contents[0].id:this.options.id},o.contentOpenWith([s],function(n){Array.isArray(n.data.items)&&n.data.items.length>0&&l&&(n.data.items[0]["ds6w:kind"]=l,"SystemModel"===s.options.type&&Array.isArray(n.data.items[0].objectTaxonomies)&&n.data.items[0].objectTaxonomies.length>0&&(n.data.items[0].objectTaxonomies[n.data.items[0].objectTaxonomies.length-1]=l));var r=new i;r.set3DXContent(n,!1),e.is(r.retrieveCompatibleApps,"function")&&r.retrieveCompatibleApps(function(n){var r=!1;s.options.type===d&&n.forEach(function(e){e.text.contains("CATIA V5")&&(r=!0),a.push({type:"PushItem",title:e.text,fonticon:void 0!==e.fonticon&&null!==e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:void 0!==e.icon&&null!==e.icon&&e.icon.length>0?e.icon:"",action:{callback:e.handler}})}),r||"XCADNonPSBaseRepReference"!==s.options.type?s.options.type===d&&t(a):(s.options.type="VPMReference",o.contentOpenWith([s],function(n){var o=new i;o.set3DXContent(n,!1),e.is(o.retrieveCompatibleApps,"function")&&o.retrieveCompatibleApps(function(e){e.forEach(function(e){e.text.contains("CATIA V5")&&a.push({type:"PushItem",title:e.text,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS},action:{callback:e.handler}})}),s.options.type=d,t(a)})}))})})})}):t(a)})},_getMultiSelectMenuListPromise:function(e){if(!Array.isArray(e))throw Error("_getMultiSelectMenuListPromise.nodeList: Input not of type array");var n=this,o=e.length;return new t(function(t,i){var r=n._getMenuItemList(!0).reduce(function(t,i,r,s){var a=!0;if(!0===i.multiSelectMenu&&o>=i.minNodes&&o<=i.maxNodes)for(var d=0;d<o;d++)a&=!i.disabled&&(i.checkVersionExternal||i.checkVersion).bind(n)(e[d],e);return i&&i.id&&("divider"===i.id||!0===Boolean(a))&&t.push(i),t},[]);r.length&&"divider"==r[r.length-1].id&&r.pop(),r.length>1&&r.splice(r.findIndex(function(e){return!0===e.excludeIfOtherItemsExist}),1),t(r)})}}),n.implement.call(this,new o(a,d));for(var u=this._eventList.length,p=0;p<u;p++){var c=this._eventList[p];this._registerEvent(c)}}});return s}),define("DS/ENOXVersionExplorerController/VersionExplorerController",["UWA/Core","UWA/Utils/InterCom","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerViews/VersionExplorerView","DS/ENOXVersionExplorerViews/NewVersionDialog","DS/ENOXVersionExplorerViews/NewRevisionDialog","DS/ENOXVersionExplorerController/VersionExplorerEventManager","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerModelManager/ModelManagerBase","DS/ENOXVersionExplorerModelManager/ModelManagerP","DS/ENOXVersionExplorerModelManager/ModelManagerRDF","DS/ENOXVersionExplorerModelManager/ModelManagerHistory2","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/ENOXVersionExplorerUtils/ColumnList","DS/WAFData/WAFData","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/DictionaryServices","DS/LifecycleControls/CommandDialogWUX","DS/ENOXVersionExplorerViews/VersionExplorerPrefs","DS/PlatformAPI/PlatformAPI","DS/WebInWinHelper/WebInWinHelper","DS/Controls/LineEditor","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS"],function(e,n,t,o,i,r,s,a,d,l,u,p,c,E,f,h,_,v,x,m,b,D,N,O,g,w,M){"use strict";return a.extend({_currentVersion:void 0,_activeVersion:void 0,_context:void 0,_tenant:void 0,_type:void 0,_widget:void 0,init:function(a){var V,S,C,y,I,A,L,T,X=void 0,P=void 0,W=void 0,k=void 0,R=void 0,F=void 0;function U(n){var t;if("string"==typeof n){var i=JSON.parse(n),r=i.Refresh;if(r)if(Array.isArray(r.created)&&r.created.length>0&&W.isNodeInModel(r.created[0].sourceObjectId))t={physicalid:r.created[0].physicalid,tenant:i.tenant,fireEvent:"ENOXVersionExplorerNewVersionCreated"},r.created[0].forceLoad&&(t.forceLoad=r.created[0].forceLoad);else if(Array.isArray(r.modified)&&r.modified.length>0&&W.isNodeInModel(r.modified[0].physicalid))t={physicalid:r.modified[0].physicalid,tenant:i.tenant,fireEvent:"ENOXVersionExplorerVersionModified"};else if(Array.isArray(r.deleted)&&r.deleted.length>0&&W.isNodeInModel(r.deleted[0].physicalid)){var s=f.intersectionDifference(r.deleted,W._nodeList,function(e,n){return e.physicalid===n.options.id}),a=s[1].difference,d=s[1].intersection;d.length&&(t={removedVersion:d[0],fireEvent:"ENOXVersionExplorerVersionDeleteCompleted"},d[0]===X._activeVersion&&(X._activeVersion=void 0),a.length&&e.extend(t,{physicalid:a[0].options.id,tenant:i.tenant}))}}else if(n&&n.authored&&n.authored.modified&&e.is(n.authored.modified,"array")&&1===n.authored.modified.length){if(e.is(n.authored.modified[0],"string")&&W.isNodeInModel(n.authored.modified[0]))t={physicalid:n.authored.modified[0],fireEvent:"ENOXVersionExplorerVersionModified"};else if(e.is(n.authored.modified[0].physicalid,"string")&&W.isNodeInModel(n.authored.modified[0].physicalid)&&e.is(n.authored.modified[0].key,"string")&&e.is("ownerChanged"===n.authored.modified[0].key)){var l=W._nodeList.findIndex(function(e){return e.options.id===n.authored.modified[0].physicalid});t=0===l&&1===W._nodeList.length?{removedVersion:W.searchByID(n.authored.modified[0].physicalid)[0],fireEvent:"ENOXVersionExplorerVersionOwnerChanged"}:{removedVersion:W.searchByID(n.authored.modified[0].physicalid)[0],fireEvent:"ENOXVersionExplorerVersionOwnerChanged",physicalid:W._nodeList[0===l?1:0].options.id}}}else n.options&&n.options.id&&(t={physicalid:n.options.id,fireEvent:"NewVersionCreated"});t&&(t.physicalid?(t.forceLoad&&(W._circularColorArray.resetCurrentIndex(),W._forceReset=!0,W.items=null),X._loadVersionModel({id:t.physicalid,tenantId:t.tenant,context:X._context,securityContext:X._securityContext,type:W.type,dataModelType:W._DATA_MODEL_TYPE,onComplete:function(e){var n,i;if(n=t.fireEvent.contains("Created")||t.fireEvent.contains("Modified")?1===(i=W.searchByID(t.physicalid)).length?i[0]:void 0:t.removedVersion,X._activeVersion){var r=W.searchByID(X._activeVersion);1===r.length&&r[0]instanceof o&&!r[0].isActive()&&X._setActiveVersion({treeNode:r[0]})}n&&X.publishEvent(t.fireEvent,n)}})):W.empty())}function B(e){console.log("VersionExplorerController error handler"),console.log(e),X.publishEvent("ENOXVersionExplorerError",e),P.unmask()}function H(e,n){W.createNewVersionPromise({parentid:e.parent.options.id,title:e.title,description:e.description,versionSemantic:e.versionSemantic,nextRevision:e.parent.nextRevision,itemID:W.itemID}).then(n,B)}X=this,a=a||{},this._widget=a.widget,l._widget=a.widget,I="boolean"!=typeof a.autoUpdate||a.autoUpdate,(W=new(t.implement(u)))._isODT=a._isODT,W.useGlobalStorage="boolean"==typeof a.useGlobalStorage&&a.useGlobalStorage,W._useFontIcons="boolean"==typeof a.useIcons&&a.useIcons,W.globalStorageName=a.globalStorageName,W.webToWinComSocket=a.webToWinComSocket,this._ID=W._ID="VE_"+Date.now().valueOf().toString(),V=a.versionGraphContainer,C=a.nodeEdgeViewsTemplate,y=a.customOnDrop,S=a.newVersionDialogContainer,A=a.useWebCommandsOnNative,L=a.disableMaturityButton,T=a.fromWebInWinWrapper,F=new N(a.widget,"RevisionExplorerCustomizeColumns",void 0,void 0,a._isODT,W.useGlobalStorage,W.globalStorageName,W.webToWinComSocket),I&&(v.addEvent("_ENOXVersionExplorerNewVersionCreated",U),this.refreshSub=O.subscribe("Lifecycle.Modification",U),require(["DS/PADUtils/PADCommandProxy"],function(e){X.PADCommandProxy=e.create({events:{onRefresh:U.bind(X)}})})),P=new i({parentContainer:V,nodeEdgeViewsTemplate:C,customOnDrop:y,versionExplorerController:X,versionModel:W,_isODT:a._isODT,customizeColumns:F}),this._parent(a,W,P),W._getTrueRoot()._modelEvents._setParent(this),P.build(),W._SELECTION_MODE=a.selectionMode||d.SELECTION_MODES.MULTI_SELECT_ONLY|d.SELECTION_MODES.WITH_COMMANDS,W._SELECTION_MODE>=0&&W._SELECTION_MODE&d.SELECTION_MODES.SINGLE_SELECT_ONLY&&(W._SELECTION_MODE&=~d.SELECTION_MODES.MULTI_SELECT_ONLY),e.Class.implement.call(this,{setSelectionMode:function(e){R=W._SELECTION_MODE,e>=0&&e&d.SELECTION_MODES.SINGLE_SELECT_ONLY&&(e&=~d.SELECTION_MODES.MULTI_SELECT_ONLY),P.setSelectionMode(e>=0?e:d.SELECTION_MODES.MULTI_SELECT_ONLY|d.SELECTION_MODES.WITH_COMMANDS)},restorePreviousSelectionMode:function(){P.setSelectionMode(R||d.SELECTION_MODES.MULTI_SELECT_ONLY|d.SELECTION_MODES.WITH_COMMANDS)},showDialog:function(n,t,i){var r;null==t&&(t=null!=this._widget?this._widget.body:null),P.showDialog(n,t,i);var s,a=1===(r=W.searchByID(X._activeVersion)).length?r[0]:void 0;a instanceof o&&(void 0!==a.options&&void 0!==a.options.label&&void 0!==a.options.label&&(s=e.String.unescapeHTML(a.options.label)),P.setTitle(s))},hideDialog:function(){P.hideDialog()},cleanup:function(){I&&v.removeEvent("_ENOXVersionExplorerNewVersionCreated",U),P.cleanup(),W.empty(),W.itemID=null,W.items=null},getSelectedNodes:function(){return W.getSelectedNodes()},setSingleSelectionMode:function(){this.setSelectionMode(W._SELECTION_MODE&~d.SELECTION_MODES.MULTI_SELECT_ONLY)},setMultiSelectionMode:function(){this.setSelectionMode(W._SELECTION_MODE|d.SELECTION_MODES.MULTI_SELECT_ONLY)},enableCommands:function(){this.setSelectionMode(W._SELECTION_MODE|d.SELECTION_MODES.WITH_COMMANDS)},areCommandsEnabled:function(){return!!(W._SELECTION_MODE&d.SELECTION_MODES.WITH_COMMANDS)},disableCommands:function(){this.setSelectionMode(W._SELECTION_MODE&~d.SELECTION_MODES.WITH_COMMANDS)},select:function(e,n){var t=e instanceof o?[e]:"string"==typeof e&&e.length?W.searchByID(e):void 0;Array.isArray(t)&&1===t.length&&(W.prepareAddDelete(),t[0].select(n),W.pushAddDelete())},unselectAll:function(){W&&(W.prepareAddDelete(),W.unselectAll(),W.pushAddDelete())},applyFilter:function(e){if(W){W.filterData=e,W.prepareAddDelete(),W._FILTER_ENABLED=!0;var n=W?W.applyFilter(e):[];!n.length&&(W._FILTER_ENABLED=!1,this.clearFilter()),W.pushAddDelete()}return n},resetFilter:function(){W&&null!=W.filterData&&this.applyFilter(W.filterData)},clearFilter:function(){W&&(W.prepareAddDelete(),W._FILTER_ENABLED=!1,W&&W.clearFilter(),W.pushAddDelete())},enableDrag:function(e){this.setSelectionMode(W._SELECTION_MODE|d.SELECTION_MODES.ALLOW_DRAG)},disableDrag:function(){this.setSelectionMode(W._SELECTION_MODE&~d.SELECTION_MODES.ALLOW_DRAG)},enableDrop:function(){this.setSelectionMode(W._SELECTION_MODE|d.SELECTION_MODES.ALLOW_DROP)},disableDrop:function(){this.setSelectionMode(W._SELECTION_MODE&~d.SELECTION_MODES.ALLOW_DROP)},getObjects:function(){return W._nodeList.slice()},reframeAll:function(){P&&P.reframeThumbnailGraph()},_getMaturityStatesAttributes:function(n,t,o){return new e.Class.Promise(function(e,i){var r=new Set;r.add(n);var s={policies:Array.from(r)},a=JSON.stringify(s),d=m.get3DSpaceWSUrl(t,"/resources/lifecycle/maturity/getStatesAttributes",null);_.authenticatedRequest(d,{method:"POST",type:"text",headers:m.getHeaders(encodeURIComponent(o)),timeout:6e5,data:a,onComplete:function(n){var t="string"==typeof n?JSON.parse(n):n;e(t)},onFailure:function(n,t){e({})},ontimeout:function(){e({})}})})},_loadVersionModel:function(e){a._isODT||P.setLoadingMask(),W.type=e.type||W.type||"",void 0===e.securityContext&&(e.securityContext=this._securityContext),widget.securityContext=e.securityContext,"function"!=typeof widget.getValue&&(widget.getValue=function(n){if("x3dPlatformId"===n)return e.tenantId});var n=e.tenantId;!n&&e.tenant&&(n=e.tenant),n||(n=widget.getValue("x3dPlatformId"));var t=[e.id],o=["3DSpace"],i=[],r=[0];X._app_initialization(function(){X._loadAttrs(t,o,i,r,n,function(t){!function(o){var i={};!function(e,n,t,o,i,r){if(e===d.DATA_MODEL_TYPES.MODEL_HISTORY&&(W._DupToggling=!0,!1===l.UserSettings.displayDuplicates&&(e=d.DATA_MODEL_TYPES.MODEL_REVISION,W._forceReset=!0)),"string"==typeof n&&n.length&&e!==d.DATA_MODEL_TYPES.MODEL_HISTORY&&e!==d.DATA_MODEL_TYPES.MODEL_CUSTOM&&(e=d.DATA_MODEL_TYPES[n.contains(":")?"MODEL_RDF":"MODEL_REVISION"]),void 0!==W.lastType&&W.lastType!==n&&(W._forceReset=!0),W.lastType=n,W._forceReset||W._DATA_MODEL_TYPE!==e){W._forceReset=!1,W._DATA_MODEL_TYPE=e;for(var s=h(W._DATA_MODEL_TYPE),a={},u=0;u<s.columns.length;u++)a[s.columns[u].dbKey]=u;if(t&&t.length>0){var f={nlsLabel:!0,"PLMEntity.PLM_ExternalID":!0,"PLMEntity.V_Name":!0,"PLMEntity.V_description":!0,current:!0,originated:!0},_=t[0].basicData,v=t[0].data,x=t[0].computed;t[0].extensions,X._isMIB=0==t[0].physicalID.indexOf("cid:");for(var m={},b=[_,v,x],D=0;D<b.length;D++){var N=b[D];if(void 0!==N)for(u=0;u<N.length;u++){var O=N[u],g=O.selectable,w=O.name,M=O.nls,V=O.path;if(null==O.attrID&&(void 0!==V&&(g=w=V),(!g||0!==g.indexOf("branch."))&&"SystemModel.Title"!==g&&"attribute[Title]"!==O.selectable)){if(null!=i&&O.path===i&&O.value&&O.value.length>0&&(r["ds6w:kind"]=O.value[0]),void 0===M&&O.displayName&&(M=O.displayName),void 0===g&&w){var S=(g=w).split(":");g=S[S.length-1]}void 0===a[g]&&void 0===f[g]&&(m[g]={dbKey:g,outputKey:w,columnNLS:M})}}}for(var u in m)s.columns.push(m[u]);X._isMIB&&s.columns.push({dbKey:"__BranchTitle__",outputKey:"__BranchTitle__",columnNLS:"Branch Title"})}switch(F.setParams("RevisionExplorerCustomizeColumns_"+W._DATA_MODEL_TYPE.toString(),s.columns,s.defaultCols,s.resetGraphListView,s.resetGraphView),W._DATA_MODEL_TYPE){case d.DATA_MODEL_TYPES.MODEL_RDF:k=c;break;case d.DATA_MODEL_TYPES.MODEL_HISTORY:k=E;break;case d.DATA_MODEL_TYPES.MODEL_CUSTOM:if(!o)throw Error("VersionExplorerController:setModelManager - Custom model manager not provided for data model type MODEL_CUSTOM");k=o;break;default:k=p}W.setManager(k)}}(e.dataModelType,W.type,t,e.customModelManager,o,i),P&&P.updateViewOptions();var r,s=e.onComplete;X._context=e.context,X._tenantId=n,X._securityContext=e.securityContext,X._securityContext&&(X._context?"function"!=typeof X._context.getSecurityContext&&(X._context.getSecurityContext=function(){return{SecurityContext:X._securityContext}}):X._context={getSecurityContext:function(){return{SecurityContext:X._securityContext}}}),r=h(W._DATA_MODEL_TYPE).excludeFromQuery,e.attributeList=F.getAlldbKeys();var u={revision:"code",created:"creationDate",owner:"ownerName",maturity:"maturity_nls",project:"project_nls",policy:"policy_nls",organization:"organization_nls",type:"type_nls",reservedby:"reservedbyName"},_={};e.attributeList.forEach(function(e){var n=void 0===u[e]?e:u[e];_[e]=n});for(var v=F.load(),x=0,m=v.length;x<m;x++){var b=void 0;b=v[x].startsWith("###")?v[x].replace("###",""):v[x],_[b]&&delete _[b]}var D=X.options.customizeColumnAttributeHash;if(D){var N=Object.keys(D);for(x=0;x<N.length;x++)delete _[N[x]]}delete _.policy,delete _.policy_nls,null!=o&&delete _[o];var O={};Array.isArray(r)&&r.length&&r.forEach(function(e){O[e]=!0}),(N=Object.keys(_)).forEach(function(e){O[e]||r.push(e)}),Array.isArray(r)&&r.length&&(e.attributeList=f.intersectionDifference(e.attributeList,r,function(e,n){return e===n})[0].difference);var g=e.attributeList.indexOf("__BranchTitle__");g>=0&&e.attributeList.splice(g,1),e.ds6w_kind=i["ds6w:kind"],W.loadVersionModelPromise(e).then(function(n){g>=0&&e.attributeList.push("__BranchTitle__");var t="";W.mainBranchRoot&&W.mainBranchRoot.policy&&(t=W.mainBranchRoot.policy),X._getMaturityStatesAttributes(t,X._tenantId,X._securityContext).then(function(t){X._statesData=t,a._isODT||P.unmask(),n&&P.displayView(e.reframe),X._currentVersion=e.id,"function"==typeof s&&s(e)})},function(e){X._widget&&X._widget.data&&X._widget.data.TemporaryPropertiesWidget&&P.cleanup(),X._widget&&X._widget.lifecycleWidget&&X._widget.lifecycleWidget.empty(),B(e)})}("SystemModel.SystemContentType")},void 0,void 0,l)})},_setActiveVersion:function(n){var t;if(n.treeNode)t=n.treeNode;else if(n.id){var o=W.searchByID(n.id);1===o.length&&(t=o[0])}if(W.prepareAddDelete(),W.setAttributeAll("__isActive__",!1),t){var i;if(W.setAttribute(t,"__isActive__",!0),X._activeVersion=t.options.id,void 0!==t.options&&void 0!==t.options.label&&void 0!==t.options.label){var r={};t.options.eStrings&&(r=t.options.eStrings),!0===r[t.options.label]&&(i=e.String.unescapeHTML(t.options.label))}P.setTitle(i)}W.pushAddDelete()},_displayNewVersionDialog:function(e){var n;if(e.treeNode)n=e.treeNode;else if(e.id){var t=W.searchByID(e.id);1===t.length&&(n=t[0])}n&&r.displayDialog({dataModelType:W._DATA_MODEL_TYPE,defaultName:W.getNewVersionName(),derivedFrom:{id:n.options.id,name:n.options.grid.title},parentContainer:S,onOK:function(e,t,o){H({title:e,description:t,parent:n,versionSemantic:o},function(e){X.publishEvent("ENOXVersionExplorerNewVersionCreated",e)})}})},_showWhereUsed:function(e){if(null===W.webToWinComSocket||void 0===W.webToWinComSocket){var t=m.getTenant(),o=require("DS/PADUtils/PADCommandProxy").create();require(["DS/PADUtils/PADUtilsServices"],function(i){var r=[];r.push({envId:t,serviceId:"",contextId:"",objectId:e.id,objectType:e.type,displayName:e.displayName});var s={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:r}},a={attributes:{},paths:[],version:"1.1"},d=new n.Socket("compassPageSocket");d.subscribeServer("com.ds.compass",window.parent),d.dispatchEvent("onSetX3DContent",s,"compassPageSocket"),d.addListener("launchApp",function(e){o.select(a),o.destroy(),console.log("Response = "+JSON.stringify(e))}),d.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")})}else g.fireWintopCommand(W.webToWinComSocket,e,"CATRelNavWebInWinCmdHdr")},_getMainBranchAttribute:e=>W.mainBranchRoot?W.mainBranchRoot[e]:"",_isMaturityButtonDisabled:()=>L,_isFromWebInWinWrapper:()=>T,saveCustomizedColumns(){for(var e={code:"revision",creationDate:"created",ownerName:"owner",maturity_nls:"maturity",project_nls:"project",policy_nls:"policy",organization_nls:"organization",type_nls:"type",reservedbyName:"reservedby"},n=[],t=P._subwayGraphView.getColumnManager()._listView.layout,o=0,i=t._balancedColumnTree.length;o<i;o++){if(0==t._balancedColumnTree[o].isHidden)if(!t._balancedColumnTree[o].alwaysOn){var r=t._balancedColumnTree[o].dataIndex,s=void 0===e[r]?r:e[r];n.push(s)}}P._subwayGraphView.getColumnManager().arrangeColumns(n),F.save(n)},_setUseWebCommandsOnNative(){var e=!1;if(1!=A)return e;if(this._isWebInWinMode()){var n=this._getMainBranchAttribute("type");this._getMainBranchAttribute("label"),this._getMainBranchAttribute("code"),this._getMainBranchAttribute("id");if(""===n){var t=this.getSelectedNodes();t.length>0&&(n=t[0].options.grid.type,t[0].options.grid.name,t[0].options.grid.code,t[0].options.grid.id)}"ConfiguredBaseline"===n&&(e=!0)}return e},_fetchNativeContextMenu:function(e,n,t,o){var i=[],r={displayName:t,id:e,name:t,physicalid:e,revision:o,type:n};i.push(r),g.fetchContextFromSelection(W.webToWinComSocket,i)},_getWebInWinSocket:function(){return W.webToWinComSocket},_isWebInWinMode:function(){return null!==W.webToWinComSocket&&void 0!==W.webToWinComSocket},getFilterHashObject:function(e){return W.filterHash[e]},getFilter:function(e){var n=void 0,t=W.objectHash[e.id];if(t&&t.ancestors){var o=t.ancestors.find(function(e){return e.hasExpand});if(o){var i=W.filterHash&&W.filterHash[o.filterid];i&&i.filterQuery&&(n=i.filterQuery.filter)}}return n},_showCompare:function(e,t){if(null===W.webToWinComSocket||void 0===W.webToWinComSocket){var o=m.getTenant(),i=[];if(null!==e&&i.push({envId:o,serviceId:e.serviceId,contextId:e.contextId,objectId:e.id,objectType:e.objectType,displayName:e.displayName,filterSpec:e.filter}),null!==t&&i.push({envId:o,serviceId:t.serviceId,contextId:t.contextId,objectId:t.id,objectType:t.objectType,displayName:t.displayName,filterSpec:t.filter}),i.length>0){var r={envId:o,protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:i}},s=new n.Socket("compassPageSocket");s.subscribeServer("com.ds.compass",window.parent),s.dispatchEvent("onSetX3DContent",r,"compassPageSocket"),s.addListener("launchApp",function(e){console.log("Response = "+JSON.stringify(e)),this.response=e.response});s.dispatchEvent("onLaunchApp",{appId:"ENOCOMP_AP"},"compassPageSocket")}}else g.launchWinCompare(W.webToWinComSocket,e,t)},_displayNewRevisionDialog:function(e){var n;if(e.treeNode)n=e.treeNode;else if(e.id){var t=W.searchByID(e.id);1===t.length&&(n=t[0])}n&&s.displayDialog({defaultName:n.options.grid.title,derivedFrom:{id:n.options.id,name:n.options.grid.title+" "+n.options.grid.code},nextRevision:n.nextRevision,parentContainer:S,onOK:function(e,t){H({title:e,description:t,parent:n,versionSemantic:"E"},function(e){X.publishEvent("ENOXVersionExplorerNewVersionCreated",e)})}})},_displayEditDialog:function(n,t,o){var i=new D,r=e.createElement("div",{class:"editDialog_content",styles:{display:"grid","grid-template-columns":"1fr 1fr","margin-top":"5px"}});new e.Element("text",{text:M.branchTitle,class:"branchtitle_label",styles:{"font-weight":"bold","margin-right":"3px"}}).inject(r);var s=new w({value:o});s.getContent().addClassName("branchtitle_input"),s.inject(r);i.createDialog(r,{title:M.editBranchTitle+" - "+t,identifier:"EditBranchTitle",container:widget.elements.wrapper,modalFlag:!0,OKBtnText:M.save,onOk:function(){var e=this.dialog.elements._contentDiv.querySelector(".branchtitle_input input").value;W.setBranchTitlePromise(n,e).then(function(){X.publishEvent("_ENOXVersionExplorerInternalRefresh",{reframe:!0})}),console.log(e),i.destroy()},onClose:function(){i.destroy()}})},_forceLoad:function(){!0===W.usePersistentColor()&&W._circularColorArray.currentIndex||W._circularColorArray.resetCurrentIndex(),W._forceReset=!0,W.items=null},_app_initialization:function(e){m.app_initialization(e)},_loadAttrs(e,n,t,o,i,r){x.loadAttrs(e,n,t,o,i,r)},_getIsKindOfPromise:(e,n,t)=>b.getIsKindOfPromise(e,n,t)}),a._isODT&&e.Class.implement.call(this,{_ODTGetVersionExplorerView:function(){return P},_ODTGetVersionModel:function(){return W}})}})});