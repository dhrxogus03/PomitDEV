define("DS/ENOCollabRouteTask/RouteTaskDetailsPanelConfig",["DS/Foundation2/FoundationV2Data","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonApps/Views/CommonPropertiesConfig","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonUI/PlatformManager"],function(e,t,a,o,r,s,n,i,l,m,u,p){"use strict";var c=function(t){var a=e.getWidgetConstant.apply(this,arguments);return a===t&&(a=u.get(t)),a},b={},T=function(e){var t=e&&e.isTaskReassignmentRequired()&&e.get("routeOwnerUGName");return p.getServiceUrl("swym",!0)&&!t?["swym"]:["3dspace"]},d=function(e){return Boolean("false"!==c("emxComponents.Routes.ShowCommentsForTaskApproval").toLowerCase().trim()||e&&"Comment"===e.get("routeTaskAction"))};return b.config=function(e){var u,p=c("emxCollaborativeTasks.GroupLabel.More"),b="false"!==c("emxComponents.Routes.EnforceAssigneeApprovalComments").toLowerCase().trim(),v=e&&"No"!==e.get("needsReview"),k=e.collection&&e.collection.contentsTypesForSearch(),C=e.collection&&e.collection.contentsTypes(),g=[{name:"title",label:c("emxCollaborativeTasks.Label.Title"),type:"text",numberOfEditableLines:4,maxLength:128},{name:"routeTaskAction",label:c("emxCollaborativeTasks.Label.TaskExpectedAction"),type:"select"},{name:"routeTaskInstructions",label:c("emxCollaborativeTasks.Label.TaskInstructions"),type:"textarea"},{name:"route",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,label:c("emxCollaborativeTasks.Label.Route"),type:"object",customView:i,linkCallback:s.launchProperties},{readWrite:!0,required:b,name:"routeTaskApprovalComments",label:c("emxCollaborativeTasks.Label.TaskApproverComments"),type:"RichText",titleAttribute:"title",customView:l,validate:b,isRoute:!0,numberOfDisplayLines:3,numberOfEditableLines:6},{name:"needsReview",label:c("emxCollaborativeTasks.Label.TaskNeedsReview"),type:"checkbox"},{readWrite:e&&!("Approve"===e.get("routeTaskAction")&&"Assign"===e.get("state")),name:"state",label:c("emxCollaborativeTasks.Label.TaskMaturityState"),type:"select"},{readWrite:!1,name:"routeTaskDueDate",label:c("emxCollaborativeTasks.Label.TaskDueDate"),type:"date"},{readWrite:!0,name:"assignees",attributeToDisplay:"name",imageAttribute:"image",label:c("emxCollaborativeTasks.Label.Assignees"),searchTitle:c("E6WCommonApps.Label.assigneeSearchTitle"),typeAheadCallback:t.typeAheadCallback,singleObjectOnly:!0,type:"person",dropTypes:o.PERSON_DROP_TYPES,customView:i,linkCallback:s.launchProperties,searchSourceTypes:(u=T(),"swym"===u.toString()?{swym:["pno:Person"]}:{"3dspace":["Person"]}),searchSource:a.filterSearchSources(T()),excludeSearchTypes:function(e){var t;return"swym"===e.toString()||(t={"3dspace":["Security Context"]}),t}(T()),customButtons:[r.assignToSelfButtonConfig()]},{name:"contents",attributeToDisplay:"title",imageAttribute:"image",label:c("emxCollaborativeTasks.Label.Content"),searchTitle:c("emxCollaborativeTasks.Label.contentsSearchTitle"),typeAheadCallback:t.typeAheadCallback,type:"object",customView:i,linkCallback:s.launchProperties,placeHolder:c("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:a.filterSearchSources(["3dspace"]),dropTypes:{"3dspace":C&&C.split(",")},searchSourceTypes:{"3dspace":k&&k.split(",")},excludeSearchTypes:{"3dspace":["Person","Security Context"]},allowFileManagement:!0,validateSameTenant:!0,getDropDownMenuItems:n.getDocumentTypeDropDownMenuItems},{readWrite:!0,name:"references",attributeToDisplay:"name",imageAttribute:"image",allowFileManagement:!0,label:c("emxCollaborativeTasks.Label.References"),searchTitle:c("emxCollaborativeTasks.Label.referencesSearchTitle"),typeAheadCallback:t.typeAheadCallback,type:"object",customView:i,linkCallback:s.launchProperties,placeHolder:c("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:a.filterSearchSources(["3dspace","drive"]),excludeSearchTypes:{"3dspace":["Person","Security Context","Business Role","Route","Route Template","Inbox Task"]},validateSameTenant:!0,limit:100,getDropDownMenuItems:n.getDocumentTypeDropDownMenuItems},{name:"routeTaskApprovalAction",label:c("emxCollaborativeTasks.Label.Decision"),type:"select"},{name:"project",label:c("emxCollaborativeTasks.Label.CollaborativeSpace"),type:"text"},m.getTagsFieldConfig(),{name:"originatorInfo",attributeToDisplay:"name",imageAttribute:"image",label:c("emxCollaborativeTasks.Label.TaskOriginator"),type:"person",customView:i,linkCallback:s.launchProperties,searchSource:["swym"]},{name:"ownerInfo",attributeToDisplay:"name",imageAttribute:"image",label:c("emxCollaborativeTasks.Label.TaskOwner"),type:"person",customView:i,linkCallback:s.launchProperties,searchSource:["swym"]},{name:"originated",label:c("emxCollaborativeTasks.Label.TaskCreated"),type:"date",group:p},{name:"modified",label:c("emxCollaborativeTasks.Label.TaskModified"),type:"date",group:p}];return v&&g.splice(6,0,{readWrite:!0,required:!0,name:"routeTaskReviewerComments",label:c("emxCollaborativeTasks.Label.TaskReviewerComments"),titleAttribute:"title",type:"RichText",validate:!0,customView:l,isRoute:!0,numberOfDisplayLines:3,numberOfEditableLines:6}),function(e,t,a){d(e)||t.splice(4,1);var o=e&&"FALSE"!==e.get("routeTaskDelegationAllowed"),r=e.get("state");e&&"Comment"!==e.get("routeTaskAction")&&"Assign"!==r||(a?t.splice(12,1):t.splice(11,1));for(var s=e.get("routeOwner"),n=e.get("routeOwnerUGName"),i=e&&"No"!==e.get("routeTaskSetDueDate"),l=o||enoviaServer.user===s,m=0;m<t.length;m++)("assignees"===t[m].name&&!l||"routeTaskDueDate"===t[m].name&&!i||"routeTaskReviewerComments"===t[m].name&&(enoviaServer.user!==s||"Review"!==r))&&delete t[m].readWrite,("routeTaskReviewerComments"===t[m].name&&(enoviaServer.user!==s||"Review"!==r)||"routeTaskApprovalComments"===t[m].name&&"Complete"===r)&&(delete t[m].required,delete t[m].validate,delete t[m].numberOfDisplayLines),"assignees"===t[m].name&&l&&n&&(t[m].userRole=n);return t}(e,g,v)},b}),define("DS/ENOCollabRouteTask/RouteTaskHelper",[],function(){"use strict";var e={};return e.getIconValue=function(e){return require.toUrl("DS/E6WCommonApps/assets/img/I_RouteTask"+(e?"_16.png":"_22.png"))},e.validate=function(t,a,o,r){return o=e._validateApprovalComments(t,o,r),o=e._validateApprovalAction(t,o,r),o=e._validateEnforceOwnerReviewComments(t,o,r),(o=e._validateSignatureRequired(t,a,o,r))&&o.fields.length?o:void 0},e._validateApprovalComments=function(e,t,a){if(a.currentState!==a.newState&&e.hasOwnProperty("routeTaskAction")){var o=e.routeTaskApprovalComments&&e.routeTaskApprovalComments.trim();a.enforceAssigneeApprovalComments&&!o&&t.fields.push("routeTaskApprovalComments")}return t},e._validateApprovalAction=function(e,t,a){return a.currentState!==a.newState&&e.hasOwnProperty("routeTaskApprovalAction")&&"Approve"===e.routeTaskAction&&"None"===e.routeTaskApprovalAction&&t.fields.push("routeTaskApprovalAction"),t},e._validateEnforceOwnerReviewComments=function(e,t,a){return"Yes"===a.needsReview&&a.enforceOwnerReviewComments&&e.hasOwnProperty("routeTaskReviewerComments")&&("Complete"!==a.newState||e.routeTaskReviewerComments.trim()||t.fields.push("routeTaskReviewerComments")),t},e._validateSignatureRequired=function(e,t,a,o){return o.currentState!==o.newState&&e.hasOwnProperty("routeTaskApprovalAction")&&"Approve"===e.routeTaskAction&&"None"!==e.routeTaskApprovalAction&&(0!==a.fields.length||"True"!==e.routeTaskRequiresESign||t._signature||(a.fields.push("signature_required"),a.fields.push(e.routeTaskApprovalAction))),a},e});