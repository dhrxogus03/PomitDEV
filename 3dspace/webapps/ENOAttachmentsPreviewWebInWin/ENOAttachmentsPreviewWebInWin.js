define("DS/ENOAttachmentsPreviewWebInWin/Preview",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/3DPlayHelper/3DPlayHelper","DS/Controls/ComboBox","css!DS/ENOAttachmentsPreviewWebInWin/assets/css/ENOAttachmentsPreviewWebInWin.css"],function(e,t,n){"use strict";var i=null;return{_3dplay:null,_3dspace:null,_platformId:null,_securityContext:null,InitWebInWin:function(e,t,n,s,o,l){var a=this;a.tenant=t,a._securityContext=n,i=e;var r={};this._getWebInWinParameters(function(e){r=e||null,a._populate3DSpaceURL(r).then(function(e){a._3dspace=e["3DSpace"]?e["3DSpace"]:"",a._platformId=e.platformId?e.platformId:"";var t=a.buildDocumentArray(s,o,l);a.container=UWA.createElement("div",{id:"Attachments-Preview-Container"}),a.container.inject(widget.body),t.length>1&&a.buildComboBox(t),t.length>0&&a.buildPlayer(t[0])},function(e){return console.log("Populate 3DSpace URL failed"),Promise.reject(e)})})},_getWebInWinParameters:function(e){window.COMPASS_CONFIG&&window.COMPASS_CONFIG.myAppsBaseUrl?e(window.COMPASS_CONFIG):this._getAppsUrl(function(t){window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),t&&(window.COMPASS_CONFIG.myAppsBaseUrl=t,window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=i),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=widget.lang)),e(window.COMPASS_CONFIG)})},_getAppsUrl:function(e){"function"==typeof dscef.getMyAppsURL?dscef.getMyAppsURL().then(function(t){console.log("MyApps URL",t),e(t)}).catch(function(t){console.error("Failed to fetch MyApps URL: "+t),e(null)}):e(null,null)},_populate3DSpaceURL:function(t){var n=this;return new Promise(function(i,s){var o=null;t&&((o={}).myAppsBaseUrl=t.myAppsBaseUrl,o.userId=t.userId,o.lang=t.lang),e.getPlatformServices({config:o,platformId:n.tenant,onComplete:function(e){console.log("platformId",e.platformId),console.log("3DSpace",e["3DSpace"]),console.log("3DSearch",e["3DSearch"]),e&&i(e)},onFailure:s})})},reload:function(e,t,n,i,s){e&&(this._platformId=e),t&&(this._securityContext=t);var o=this.buildDocumentArray(n,i,s);if(o.length>1)this.buildComboBox(o);else{var l=this.container.getElement("#Attachments-Preview-Combo");l&&l.setStyle("display","none")}o.length>0&&this.loadAsset(o[0])},loadAsset:function(e){if(this._3dplay&&this._3dspace&&this._platformId){var t={input:{asset:{dtype:e.documentType,provider:"EV6",serverurl:this._3dspace,physicalid:e.physicalId,tenant:this._platformId,contextId:this._securityContext,requiredAuth:"passport",requestsOptions:{authentication:"passport"}}}};this._3dplay.load(t)}},buildPlayer(e){var n=UWA.createElement("div",{id:"Attachments-Preview-3DPlay"});n.inject(this.container),this._3dplay=new t({container:n,input:{asset:{dtype:e.documentType,provider:"EV6",serverurl:this._3dspace,physicalid:e.physicalId,tenant:this._platformId,contextId:this._securityContext,requiredAuth:"passport",requestsOptions:{authentication:"passport"}}},options:{loading:"autoplay"}})},buildComboBox:function(e){var t=this,i=t.container.getElement("#Attachments-Preview-Combo");if(e.length>1){i?i.setStyle("display","block"):(i=UWA.createElement("div",{id:"Attachments-Preview-Combo"})).inject(t.container,"top");var s=[];if(e.forEach(e=>{s.push(e.name)}),i.firstChild&&i.firstChild.dsModel)i.firstChild.dsModel.elementsList=s;else{var o=new n({elementsList:s,enableSearchFlag:!1});o.addEventListener("change",function(n){var i=e[n.dsModel.selectedIndex];t.loadAsset(i)}),o.inject(i)}}else i&&i.firstChild&&i.firstChild.dsModel&&(i.firstChild.dsModel.destroy(),i.remove())},buildDocumentArray(e,t,n){var i=[];if(e.length===t.length&&e.length===n.length)for(var s=0;s<e.length;s++)i[s]={physicalId:e[s],name:n[s],documentType:t[s]};return i}}});