define("DS/ENOXSpecificationsUX/data/Connector3DSpace",["UWA/Core","UWA/Promise","DS/ENOXAttachmentsUX/data/Constants","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentCommonInfra/TrackerAPI","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,n,o,a,r,i,s){"use strict";return function(){var a={options:{},init:function(t,e){if(a.controller=t,a.options=e||{},!(a.options&&a.options.fetchSecurityContext&&a.options.platformUrls&&a.options.platformUrls["3DSpace"]&&a.options.platformUrls.platformId)){n=new Date-t.ctrl.specificationsPaneStartTime;throw i.sendTrackerPageEvent({category:"docm.specificationsPane.ready",action:"click",label:"Specifications Ready",pd:{},pv:{totalTimeTaken:n,failure:0}}),new Error("Connector Options incomplete")}var n=new Date-t.ctrl.specificationsPaneStartTime;i.sendTrackerPageEvent({category:"docm.specificationsPane.ready",action:"click",label:"Specifications Ready",pd:{},pv:{totalTimeTaken:n,success:1}}),a.ready=!0,a.controller.connectorReady(a.options)},loadAttachments:function(r){if(!this.ready){var c=new Date-l;throw i.sendTrackerPageEvent({category:"docm.specifications.ready",action:"auto",label:"Specifications Ready",pd:{parentId:void 0},pv:{totalTimeTaken:c,status:-1}}),new Error("Connector not ready")}var l=new Date;if(r)if(r.noParent&&t.is(r.objectIds,"array"))o.getDocuments(r.objectIds,{tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(t){var e=a.controller.ctrl.options.parentObject;if(r.objectIds==e.objectIds){if(t.success){if(!Array.isArray(t.data))return;var n=new Date-l;i.sendTrackerPageEvent({category:"docm.specifications.ready",action:"click",label:"Specifications Ready",pd:{parentId:void 0,parentObjs:r.objectIds,parentRelName:r.parentRelName},pv:{totalTimeTaken:n,success:1,numOfDocs:t.data.length,noParent:!0}}),a.controller.addAttachmentsToUI(t.data)}a.controller.finishLoadingAttachments()}},onFailure:function(t){a.controller.finishLoadingAttachments();var e=new Date-l;i.sendTrackerPageEvent({category:"docm.specifications.ready",action:"click",label:"Specifications Ready",pd:{parentId:void 0,parentObjs:r.objectIds,parentRelName:r.parentRelName},pv:{totalTimeTaken:e,failure:0,numOfDocs:void 0}}),t.error&&a.controller.showNotification("error",s.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error)}});else{var d=e.deferred(),p=e.deferred();t.Promise.all([d.promise,p.promise]).then(function(){a.controller.finishLoadingAttachments();var t=new Date-window.loadAttachmentsStartTime;i.sendTrackerPageEvent({category:"docm.specifications.completeLoad",action:"click",label:"Specifications Complete Load",pd:{},pv:{totalTimeTaken:t,success:1,numOfDocs:a.controller.attachments.getRoots().length}})});var m={relInfo:{parentId:r.parentId,parentRelName:r.relationName||n.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(t,e){var o=a.controller.ctrl.options.parentObject;if(e.relInfo.parentId==o.parentId&&e.relInfo.parentRelName==(o.relationName||n.SPECIFICATION_DOCUMENT)){if(!Array.isArray(t.data))return;var s=new Date-l;i.sendTrackerPageEvent({category:"docm.specifications.ready",action:"auto",label:"Specifications Ready",pd:{parentId:r.parentId,parentObjs:r.objectIds,parentRelName:r.parentRelName},pv:{totalTimeTaken:s,success:1,numOfDocs:t.data.length}}),t.data.forEach(function(t){t.relName=m.relInfo.parentRelName}),a.controller.addAttachmentsToUI(t.data),d.resolve()}},onFailure:function(t){console.error(t);var e=new Date-l;i.sendTrackerPageEvent({category:"docm.specifications.ready",action:"click",label:"Specifications Ready",pd:{parentId:r.parentId,parentObjs:r.objectIds,parentRelName:r.parentRelName},pv:{totalTimeTaken:e,failure:0,numOfDocs:0}}),t.error&&a.controller.showNotification("error",s.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error),d.resolve()}};o.getDocumentsFromParent(m);var f={relInfo:{parentId:r.parentId,parentRelName:n.REL_PLMDOCCONNECTION,parentDirection:"from"},tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(t,e){var o=a.controller.ctrl.options.parentObject;if(e.relInfo.parentId==o.parentId&&e.relInfo.parentRelName==n.REL_PLMDOCCONNECTION){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=n.REL_PLMDOCCONNECTION});var s=new Date-l;i.sendTrackerPageEvent({category:"docm.specifications.PLMDMT.ready",action:"auto",label:"Specifications PLMDT Ready",pd:{parentId:r.parentId,parentObjs:r.objectIds,parentRelName:n.REL_PLMDOCCONNECTION},pv:{totalTimeTaken:s,success:1,numOfDocs:t.data.length}}),a.controller.addAttachmentsToUI(t.data),p.resolve()}},onFailure:function(t){var e=new Date-l;i.sendTrackerPageEvent({category:"docm.specifications.PLMDMT.ready",action:"click",label:"Specifications PLMDMT Ready",pd:{parentId:r.parentId,parentObjs:r.objectIds,parentRelName:n.REL_PLMDOCCONNECTION},pv:{totalTimeTaken:e,failure:0,numOfDocs:0}}),console.error(t),t.error&&a.controller.showNotification("error",s.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error),p.resolve()}};o.getDocumentsFromParent(f)}},uploadAttachments:function(t,e,o){require(["DS/DocumentCreateNew/CreateNew","DS/Windows/ImmersiveFrame"],function(r,i){var c=new i;c.inject(widget.body),new r({tenantUrl:a.options.platformUrls["3DSpace"],securityContext:a.options.fetchSecurityContext(),tenant:a.options.platformUrls.platformId,immersiveFrame:c,parentObject:e,parentRelName:e.relationName||n.SPECIFICATION_DOCUMENT,connector:a,supportedTypes:o,credentialsPrefName:a.options.credentialsPrefName||n.PAD_CURRENT_SECURITY_CONTEXT,onUploadStart:function(){c.destroy()},onCancel:function(){c.destroy()},onError:function(t){a.controller.showNotification("error",s.get("UPLOAD_FAILED"),t.subtitle,t.message||""),c.destroy()}}).create(t)})},attachAttachments:function(e,i){if(e.length>0){for(var c=a.controller.attachments.getRoots(),l=0;l<c.length;l++){var d=c[l];if(e.includes(d.options.data.id)){a.controller.showNotification("error",s.get("TYPE_ATTACH_FAILED",{type:d.options.data.dataelements.typeNLS}),s.get("X_IS_ALREADY_ATTACHED",{title:d.options.data.dataelements.title||d.options.data.dataelements.secondaryTitle||d.options.data.dataelements.name}));var p=e.indexOf(d.options.data.id);p>-1&&e.splice(p,1)}}o.getDocuments(e,{tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(e){if(e.success)for(var o=0;o<e.data.length;o++){var c=e.data[o];e.data[o].relName=n.SPECIFICATION_DOCUMENT;var l=!0;if(i&&i.parentId&&c.id==i.parentId){a.controller.showNotification("error",s.get("TYPE_ATTACH_FAILED",{type:c.dataelements.typeNLS}),s.get("CANNOT_ATTACH_X_TO_ITSELF",{title:c.dataelements.title||c.dataelements.secondaryTitle||c.dataelements.name})),l=!1;break}if(l)if(!a.controller.options.supportedTypes.includedTypes.includes("*")&&!a.controller.options.supportedTypes.includedTypes.includes(c.type)||a.controller.options.supportedTypes.excludedTypes.includes(c.type))a.controller.showNotification("error",s.get("DOCUMENT_NOT_ALLOWED",{type:c.dataelements.typeNLS}),s.get("X_CANNOT_BE_ATTACHED",{type:c.type}));else if(i.noParent){var d={onFailure:function(e){console.error(e),t.is(e,"string")&&a.controller.showNotification("error",s.get("FAILED_TO_ATTACH_ATTACHMENT"),e)},onSuccess:function(t){a.controller.addAttachmentsToUI([t]),a.controller.showNotification("success",s.get("DOCUMENT_ATTACHED",{type:t.dataelements.typeNLS}),s.get("X_ATTACHED_SUCCESSFULLY",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}))}};a.controller.events.publish({event:"attach-document-requested",data:{document:c,parentObject:i,callback:d}})}else r(c,i)}},onFailure:function(e){if(e.error)if((e.error.match(/\n/g)||[]).length>2){for(var n=e.error.split("\n"),o=[],r=2;r<n.length;r++)o.push(n[r]);o=o.join("<br/>"),a.controller.showNotification("error",n[0],n[1],o,void 0,!0)}else a.controller.showNotification("error",s.get("DOCUMENT_ATTACH_FAILED"),e.error);else t.is(e,"string")?a.controller.showNotification("error",s.get("DOCUMENT_ATTACH_FAILED"),e):a.controller.showNotification("error",s.get("DOCUMENT_ATTACH_FAILED"))}})}},detachAttachments:function(t,e){if(e.noParent){var n={onSuccess:function(e){t.forEach(function(t){e.forEach(function(e){t.options.data.id==e&&(a.controller.attachments.removeRoot(t),a.controller.showNotification("success",s.get("DOCUMENT_DETACHED",{type:t.options.data.dataelements.typeNLS}),s.get("X_DETACHED_SUCCESSFULLY",{title:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})))})})}};a.controller.events.publish({event:"detach-attachments-requested",data:{ids:a.controller.helper.restrict(t,"options.data.id"),parentObject:e,callback:n}})}else for(var o=0;o<t.length;o++){c(t[o],e)}},getUpdatedAttachment:function(e,r){o.getDocuments([e.id],{tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=e.relName||n.SPECIFICATION_DOCUMENT}),r(t.data)}},onFailure:function(e){e.error?a.controller.showNotification("error",s.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?a.controller.showNotification("error",s.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):a.controller.showNotification("error",s.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},getUpdatedAttachments:function(e,n,r){o.getDocuments(e.map(function(t){return t.id}),{tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle,isLatestRevision,!parentId",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;n(t.data)}},onFailure:function(e){t.is(r,"function")?r(e):e.error?a.controller.showNotification("error",s.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?a.controller.showNotification("error",s.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):a.controller.showNotification("error",s.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},ready:!1,uploadAttachment:function(e,n,r){if(a.ready){var i={customDocumentObject:e.custom_attributes?{dataelements:e.custom_attributes}:void 0,tenant:a.options.platformUrls.platformId,securityContext:r,tenantUrl:a.options.platformUrls["3DSpace"],additionalHeaders:t.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var o=t.error.split("\n"),r=[],i=2;i<o.length;i++)r.push(o[i]);r=r.join("<br/>"),a.controller.showNotification("error",o[0],o[1],r,void 0,!0)}else a.controller.showNotification("error",s.get("UPLOAD_FAILED"),t.error);else a.controller.showNotification("error",s.get("UPLOAD_FAILED"),t.error?t.error:s.get("X_UPLOAD_FAILED",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}));a.controller.events.publish({event:"upload-attachment-failure",data:{document:e,parentObject:n}}),a.controller.jobs.finishJob(c)},onProgress:function(t){a.controller.events.publish({event:"upload-attachment-progress",data:{document:e,parentObject:n}}),c.update(t)},onComplete:function(t){t.data&&(t.data[0].dataelements.isDocumentType="TRUE");var o=t.data;o.forEach(function(t){t.delayLoadThumbnails=!0,e.relInfo&&(t.relName=e.relInfo.parentRelName)});var r=function(t){a.controller.addAttachmentsToUI(t),1==t.length?a.controller.showNotification("success",s.get("DOCUMENT_ATTACHED",{type:t[0].dataelements.typeNLS}),s.get("X_ATTACHED_SUCCESSFULLY",{title:t[0].dataelements.title||t[0].dataelements.secondaryTitle||t[0].dataelements.name})):t.length>1&&a.controller.showNotification("success",s.get("DOCUMENTS_ATTACHED"),s.get("X_DOCUMENTS_ATTACHED_SUCCESSFULLY",{num:t.length}))},i={event:"upload-attachment-complete",data:{documents:o,parentObject:n}};n.noParent&&(i.data.callback=r),a.controller.events.publish(i),a.controller.jobs.finishJob(c),n.noParent||r(o)}},c={title:s.get("UPLOADING_X",{title:e.title}),ui:!0,process:function(){o.createDocument(e,i)}};a.controller.jobs.addJob(c)}}};function r(e,r){if(a.ready){var i={relInfo:{parentId:r.parentId,parentRelName:r.relationName||n.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalHeaders:t.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var n=t.error.split("\n"),o=[],i=2;i<n.length;i++)o.push(n[i]);o=o.join("<br/>"),a.controller.showNotification("error",n[0],n[1],o,void 0,!0)}else a.controller.showNotification("error",s.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),t.error);else a.controller.showNotification("error",s.get("TYPE_ATTACH_FAILED",{type:e.dataelements.typeNLS}),s.get("X_ATTACH_FAILED",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}));a.controller.events.publish({event:"attach-attachment-failure",data:{document:e,parentObject:r}}),a.controller.jobs.finishJob(c)},onProgress:function(t){a.controller.events.publish({event:"attach-attachment-progress",data:{document:e,parentObject:r}}),c.update(t)},onComplete:function(t){a.controller.events.publish({event:"attach-attachment-complete",data:{document:e,parentObject:r}}),a.controller.jobs.finishJob(c),e.relName=i.relInfo.parentRelName,a.controller.addAttachmentsToUI([e]),a.controller.showNotification("success",s.get("DOCUMENT_ATTACHED",{type:e.dataelements.typeNLS}),s.get("X_ATTACHED_SUCCESSFULLY",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}))}},c={title:s.get("ATTACHING_X",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}),ui:!1,process:function(){o.connectDocumentToParent(e.id,i)}};a.controller.jobs.addJob(c)}}function c(e,r){if(a.ready){var i={relInfo:{parentId:r.parentId,parentRelName:e.options.data.relName||n.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:a.options.platformUrls.platformId,securityContext:a.options.fetchSecurityContext(),tenantUrl:a.options.platformUrls["3DSpace"],additionalHeaders:t.is(a.options.getWorkUnderHeaders,"function")?a.options.getWorkUnderHeaders():{},onFailure:function(n){if(a.controller.events.publish({event:"detach-attachment-failure",data:{id:a.controller.helper.restrict(e,"options.data.id"),parentObject:r}}),a.controller.jobs.finishJob(c),n.error)if((n.error.match(/\n/g)||[]).length>2){for(var o=n.error.split("\n"),i=[],l=2;l<o.length;l++)i.push(o[l]);i=i.join("<br/>"),a.controller.showNotification("error",o[0],o[1],i,void 0,!0)}else a.controller.showNotification("error",s.get("FAILED_TO_DETACH_ATTACHMENT",{type:e.options.data.dataelements.typeNLS}),n.error);else t.is(n,"string")?a.controller.showNotification("error",s.get("FAILED_TO_DETACH_ATTACHMENT",{type:e.options.data.dataelements.typeNLS}),n):a.controller.showNotification("error",s.get("FAILED_TO_DETACH_ATTACHMENT",{type:e.options.data.dataelements.typeNLS}))},onProgress:function(t){a.controller.events.publish({event:"detach-attachment-progress",data:{id:a.controller.helper.restrict(e,"options.data.id"),parentObject:r}}),c.update(t)},onComplete:function(t){a.controller.jobs.finishJob(c),t.success&&a.controller.attachments.getRoots().forEach(function(e){t.data.forEach(function(t){e.options.data.id==t.id&&(a.controller.events.publish({event:"detach-attachment-complete",data:{id:a.controller.helper.restrict(e,"options.data.id"),parentObject:r}}),a.controller.attachments.removeRoot(e),a.controller.showNotification("success",s.get("DOCUMENT_DETACHED",{type:e.options.data.dataelements.typeNLS}),s.get("X_DETACHED_SUCCESSFULLY",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name})))})})}},c={title:s.get("DETACHING_X",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name}),ui:!1,process:function(){o.disconnectDocumentFromParent(e.options.data.id,i)}};a.controller.jobs.addJob(c)}}return a}}),define("DS/ENOXSpecificationsUX/SpecificationsPane",["UWA/Core","DS/ENOXAttachmentsUX/data/Controller","DS/ENOXSpecificationsUX/data/Connector3DSpace","DS/ENOXAttachmentsUX/views/Topbar","DS/ENOXAttachmentsUX/views/UploadPane","DS/ENOXAttachmentsUX/views/GridPane","DS/ENOXAttachmentsUX/views/TilePane","DS/ENOXAttachmentsUX/views/ProgressPane","text!DS/ENOXAttachmentsUX/assets/config.json","DS/ENOXAttachmentsUX/data/DnDManager","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","DS/ENOXAttachmentsUX/utils/Overlay","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","css!DS/ENOXAttachmentsUX/ENOXAttachmentsUX.css"],function(t,e,n,o,a,r,i,s,c,l,d,p,m,f,u){"use strict";c=JSON.parse(c);var T={actionBarRestrict:["attachURL"]};return c.actionbar=c.actionbar.filter(t=>!T.actionBarRestrict.includes(t.name)),c.actionbar.forEach(function(t){t.text=f.get(t.nls),t.title=f.get(t.nls),t.content&&t.content.options&&t.content.options.items&&t.content.options.items.forEach(function(t){t.text=f.get(t.nls),t.description=f.get(t.nls)})}),c.headers.forEach(function(t){t.text=f.get(t.nls)}),c.contextMenu.forEach(function(t){t.text=f.get(t.nls),t.title=f.get(t.nls)}),t.Controls.Abstract.extend({name:"enox-attachments",options:{className:""},_options:{},modelEvents:void 0,init:function(e){this.specificationsPaneStartTime=new Date,this.modelEvents=e.events||new d,this.config=t.clone(c),this._parent(e),this._options=e,this.buildSkeleton()},buildSkeleton:function(){this.elements.container=t.createElement("div",{class:this.getClassNames()}),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.elements.content=t.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.options.attachmentsType="specifications",new e(this),new o(this),this.buildContentPanes(),new s(this),new l(this),this._options.delayInitialize?console.log("Waiting for initialize to be called"):this.initialize()},buildContentPanes:function(){this.elements.panes=t.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new a(this),new r(this),new i(this)},setParentObject:function(t,e){var n=!1;"true"==e&&(n=!0),this.options.parentObject=t,this.finishLoading(),n?this.showNotSupportedParent():this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.controller.clearAll(),n||this.controller.loadAttachments()},setConnectorOptions:function(e){t.merge(this.options.connectorOptions,e)},setSupportedTypes:function(e){t.merge(this.options.supportedTypes,e),t.merge(this.options.searchOptions,this.options.supportedTypes)},initialize:function(){this.controller.initialize(this,this._options.connector||new n)},attachSpecifications:function(t){this.controller.attachAttachments(t)},startLoading:function(){p.mask(this.elements.container)},finishLoading:function(){p.unmask(this.elements.container),m.unoverlay(this.elements.container)},showNoParentSelected:function(){m.overlay(this.elements.container,f.get("NOPARENTOBJECT"))},showNotSupportedParent:function(){m.overlay(this.elements.container,f.get("NOTSUPPORTEDSELECTION"))},destroy:function(){this.controller.destroy(),this._parent()},onRemoved:function(){this.destroy()},setSelection:function(t){this.controller.attachments.processDescendants({processNode:function(e){t.includes(e.nodeModel.options.data.id)?e.nodeModel.select():e.nodeModel.unselect()},onlyVisibleNodes:!1})},getSelection:function(){return this.controller.helper.restrict(this.controller.attachments.getSelectedNodes(),"options.data.id")}})});