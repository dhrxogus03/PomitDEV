define("DS/SNUQLEditor/Adapters/InterfacesAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/InterfacesMockUp.json","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils"],function(e,t,s,n,i,r){"use strict";return t.singleton({_interfaces:null,init:function(){},getSuggestions:function(e,t,s){let n=e.slice(0,t),a=/\w*$/.exec(n)[0],o=new RegExp("^"+UWA.String.escapeRegExp(a),"i");return new Promise((e,t)=>{if(!0!==s.context.isInterface)e([]);else if(1===s.types.length){let t=r.getActiveTenant();i.loadRelevantInterfaces({className:s.types[0],tenantId:t},function(t){e(t.interfaces.filter(function(e){return o.test(e.nlsName)}).map(e=>({displayValue:e.nlsName,value:'flattenedtaxonomies:"interfaces/'+e.name.replace("ds6wg:","")+'"',suggestionType:"interface",uri:e.name,textToInsert:"`"+e.nlsName+"` "})))})}else e([])})}})}),define("DS/SNUQLEditor/utils/InContextSearchManager",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchCom","UWA/Utils/InterCom"],function(e,t,s,n){"use strict";return t.singleton({_socket:null,init:function(){this._socket=new n.Socket("socket_id_#expert_query_search#",{dispacthRetryInterval:0}),this._socket.subscribeServer("SearchComServer")},search:function(e){let t=this,s=this._getInContextOptions(e);this._socket.dispatchEvent("RegisterContext",s),this._socket.addListener("RegisterContext_Response",function(){t._socket.dispatchEvent("InContextSearch",s)}),this._socket.addListener("onCloseTransient",this._cleanUpContext.bind(this))},_getInContextOptions:function(e){return{widget_id:"widget_id_#expert_query_search#",app_socket_id:"socket_id_#expert_query_search#",title:"Expert Query Results",default_search_criteria:e,search_criteria_to_display:"",precond:void 0,default_with_precond:!0}},_cleanUpContext:function(){this._socket.dispatchEvent("UnregisterContext",{widget_id:"widget_id_#expert_query_search#"}),this._socket.removeListener("RegisterContext_Response"),this._socket.removeListener("onCloseTransient")},destroy:function(){this._socket.unsubscribeServer("SearchComServer"),this._socket=null}})}),define("DS/SNUQLEditor/Adapters/OperatorAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/OperatorsMockUp.json"],function(e,t,s,n){"use strict";return t.singleton({_operators:null,init:function(){let e=JSON.parse(n);this._operators=e.operators.map(e=>({displayValue:e.displayValue,value:e.value,suggestionType:"oparator",uri:e.value,textToInsert:e.displayValue+" "}))},getSuggestions:function(t,s,n){let i=this,r=t.slice(0,s),a=/\w*$/.exec(r)[0],o=new RegExp("^"+UWA.String.escapeRegExp(a),"i");return new Promise((t,s)=>{!0!==n.context.isOperator?t([]):e.is(i._operators)?t(i._operators.filter(function(e){return e=e.displayValue,o.test(e)})):s(i._operators)})}})}),define("DS/SNUQLEditor/utils/StaticDataRepository",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,s,n,i,r,a){"use strict";return t.singleton({_loadTypesPromise:null,_loadPredicatesPromise:null,_staticDatapromiseArray:null,_getLoggedInUserPromise:null,_loggedInUser:null,_predicated2DataTypeMap:null,init:function(e){this._loadTypesPromise=s.deferred(),this._loadPredicatesPromise=s.deferred(),this._getLoggedInUserPromise=s.deferred(),this._staticDatapromiseArray=[this._loadTypesPromise.promise,this._loadPredicatesPromise.promise,this._getLoggedInUserPromise.promise],this._tempMap=new Map,this._predicated2DataTypeMap=new Map,this._getClassesFromAllTheSources(),this._loadPredicatesFromFedDictonary(),this._loadLoggedInUser()},getStaticDataPromiseArray:function(){return this._staticDatapromiseArray},getTypesPromise:function(){return this._loadTypesPromise.promise},getPreicatesPormise:function(){return this._loadPredicatesPromise.promise},getLoggedInUser:function(){return this._loggedInUser},setPredicateDataType:function(e,t){this._predicated2DataTypeMap.set(e,t)},getPredicateDataType:function(e){return this._predicated2DataTypeMap.get(e)},_getClassesFromAllTheSources:function(){let e=this,t=null,n=null;s.all(this._loadVocabClassesForAllServices()).then(function(s){let i,r=[];s.forEach(e=>{r=r.concat(e.classInfos)}),r=r.map(s=>(i=s.uri.split(":").pop(),t={displayValue:s.nlsName,value:"3DSpace"===s.service?'flattenedtaxonomies:"types/'+i+'"':'[ds6w:type]:"'+s.uri+'"',suggestionType:"class",uri:s.uri,textToInsert:"`"+s.nlsName+"` "},e._tempMap.has(t.displayValue)?(1===(n=e._tempMap.get(t.displayValue)).length&&(n[0].displayValue=n[0].displayValue+"("+n[0].uri+")",n[0].textToInsert="`"+n[0].displayValue+"` "),t.displayValue=t.displayValue+"("+t.uri+")",t.textToInsert="`"+t.displayValue+"` ",n.push(t)):e._tempMap.set(t.displayValue,[t]),t)),e._loadTypesPromise.resolve(r)})},_loadVocabClassesForAllServices:function(){let e=[],t=n.getActiveTenant(),a=r.getAvailableSources(t),o=n.getLanguage();return a.forEach(n=>{n.status&&e.push(new s((e,s)=>{i.loadVocabularyClasses({vocabId:n.service,tenantId:t,lang:o},e)}))}),e},_loadPredicatesFromFedDictonary:function(){let e=this,t=null,s=null,r=[],a={onComplete:function(n){Object.values(n).forEach(n=>{n.properties.forEach(n=>{e._predicated2DataTypeMap.set(n.curi,n.dataType.split("#")[1]),t={uri:n.curi,displayValue:n.label,value:"["+n.curi+"]",suggestionType:"predicates",textToInsert:"`"+n.label+"` ",dataType:n.dataType.split("#")[1]},e._tempMap.has(t.displayValue)?(1===(s=e._tempMap.get(t.displayValue)).length&&(s[0].displayValue=s[0].displayValue+"("+s[0].uri+")",s[0].textToInsert="`"+s[0].displayValue+"` "),t.displayValue=t.displayValue+"("+t.uri+")",t.textToInsert="`"+t.displayValue+"` ",s.push(t)):e._tempMap.set(t.displayValue,[t]),r.push(t)})}),e._loadPredicatesPromise.resolve(r)},onFailure:function(t){e._loadPredicatesPromise.resolve(r)},tenantId:n.getActiveTenant(),lang:n.getLanguage(),apiVersion:"R2021x"};i.getFedProperties(a)},_treatTypeWithDatePredicate:function(t){let s,n,i=[];return t.forEach(t=>{i.push(t),"dateTime"===t.dataType&&(n=e.clone(t,!0),s=e.clone(t,!0),n.displayValue=t.displayValue+" Before",n.textToInsert=n.textToInsert.replace(":"," < "),s.displayValue=t.displayValue+" After",s.textToInsert=n.textToInsert.replace(":"," > "),i.push(n),i.push(s))}),i},_loadLoggedInUser:function(){let e=this,t=n.getActiveTenant();a.getUser({platformId:t,onComplete:function(t){console.log(t),e._loggedInUser="("+t.firstname+" "+t.lastname+")",e._getLoggedInUserPromise.resolve()},onFailure:function(e){console.log(e)}})}})}),define("DS/SNUQLEditor/persistences/EQDAO",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchPreferences"],function(e,t,s){"use strict";return t.singleton({init:function(e){this._parent(e)},getAll:function(){let t=s.getLocalStorageItem("EQs");if(!e.is(t))return[];let n=t.database;return e.is(n)?Object.values(n):[]},getByName:function(t){let n=s.getLocalStorageItem("EQs");if(!e.is(n))return;let i=(n=JSON.parse(n)).database;return e.is(i)?i[t]:void 0},getAllName:function(){let t=s.getLocalStorageItem("EQs");if(!e.is(t))return[];let n=(t=JSON.parse(t)).database;return e.is(n)?Object.keys(n):[]},save:function(t,n){let i;i=s.getLocalStorageItem("EQs");let r=(i=e.is(i)?JSON.parse(i):{}).database;e.is(r)||(r={},i.database=r),r[t]=n,s.setLocalStorageItem("EQs",JSON.stringify(i))}})}),define("DS/SNUQLEditor/context/ContextManager",["UWA/Core","UWA/Class"],function(e,t){"use strict";var s=t.singleton({_types:[],_interfaces:[],_nls2InternalNameMap:new Map,_selectedPredicate:null,initializeContext:function(e){this._types=e.types,this._interfaces=e.intefaces,this._nls2InternalNameMap=e.nls2InternalNameMap,this._selectedPredicate=e.selectedPredicates},getContext:function(e){let t=this._getInputContext(e);return{context:this._getContext(t),types:this._types,interfaces:this._interfaces,currentPredicate:this._selectedPredicate}},getContextToSave:function(e){return{types:this._types,interfaces:this._interfaces,currentPredicate:this._selectedPredicate,nls2InternalNameMap:this._nls2InternalNameMap}},addSelectedType:function(e){this._types.push(e)},addSelectedInterface:function(e){this._interfaces.push(e)},setSelectedPredicate:function(e){this._selectedPredicate=e},resetContext:function(){this._types=[],this._interfaces=[],this._selectedPredicate=null,this._nls2InternalNameMap.clear()},getInternalName:function(e){return this._nls2InternalNameMap.has(e)?this._nls2InternalNameMap.get(e).value:""},setEntrieInNLSMap:function(e,t){this._nls2InternalNameMap.set(e.trim(),t)},updateContext:function(e){s.setEntrieInNLSMap(e.fullValue,{suggestionType:e.suggestionType,value:e.value}),"class"===e.suggestionType?s.addSelectedType(e.uri):"interface"===e.suggestionType?s.addSelectedInterface(e.uri):"predicates"===e.suggestionType&&s.setSelectedPredicate(e.uri)},_getContext:function(e){switch(e){case"P_AND_T":return{isType:!0,isInterface:!0,isOperator:!1,isPredicate:!0,isTag:!1,isRelation:!1};case"O_ONLY":return{isType:!1,isInterface:!1,isOperator:!0,isPredicate:!1,isTag:!1,isRelation:!1};case"PV_ONLY":return{isType:!1,isInterface:!1,isOperator:!1,isPredicate:!1,isTag:!0,isRelation:!1};case"R_ONLY":return{isType:!1,isInterface:!1,isOperator:!1,isPredicate:!1,isTag:!1,isRelation:!0};default:return{isType:!0,isInterface:!0,isOperator:!0,isPredicate:!0,isTag:!0}}},_getInputContext:function(t){let s=t.pop();if(s.length<=0&&(s=t.pop()),!e.is(s)||"AND"===s||"OR"===s||"NOT"===s||"XOR"===s||s.endsWith("("))return"P_AND_T";if(!s.endsWith("`"))return"O_ONLY";{let e=this._nls2InternalNameMap.get(s).suggestionType;if("class"===e||"interface"===e||"tag"===e)return"O_ONLY";if("predicates"===e)return"R_ONLY";if("relation"===e)return"PV_ONLY"}}});return s}),define("DS/SNUQLEditor/Adapters/ComparativeOperatorAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/ComparativeOperator.json"],function(e,t,s,n){"use strict";return t.singleton({_relations:null,init:function(){this._relations=JSON.parse(n)},getSuggestions:function(t,s,n){let i=this,r=t.slice(0,s),a=/\w*$/.exec(r)[0],o=new RegExp("^"+UWA.String.escapeRegExp(a),"i");return new Promise((t,s)=>{!0!==n.context.isRelation?t([]):e.is(i._relations)?t(i._relations.filter(function(e){return e=e.displayValue,o.test(e)})):s(i._relations)})}})}),define("DS/SNUQLEditor/utils/DateAndTimeUtils",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.singleton({init:function(){},todayForUQL:function(){return(new Date).toISOString().split("T")[0].replaceAll("-","/")}})}),define("DS/SNUQLEditor/UQLAutoComplete",["UWA/Core","UWA/Controls/Autocomplete"],function(e,t){"use strict";return t.extend({init:function(e){this._parent(e)},onHideSuggestions:function(){},onShowSuggestions:function(){}})}),define("DS/SNUQLEditor/Adapters/PredicatesAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/PredicatesMockUp.json","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNUQLEditor/utils/StaticDataRepository"],function(e,t,s,n,i,r,a){"use strict";return t.singleton({_basicPredicates:[{uri:"ds6w:type",displayValue:"Type",value:"[ds6w:type]",suggestionType:"predicates",textToInsert:"[Type]:"},{uri:"ds6w:label",displayValue:"Title",value:"[ds6w:label]",suggestionType:"predicates",textToInsert:"[Title]:"},{uri:"ds6w:identifier",displayValue:"Name",value:"[ds6w:identifier]",suggestionType:"predicates",textToInsert:"[Name]:"},{uri:"ds6w:modified",displayValue:"Modification Date",value:"[ds6w:modified]",suggestionType:"predicates",textToInsert:"[Modification Date]:"},{uri:"ds6w:description",displayValue:"Discription",value:"[ds6w:description]",suggestionType:"predicates",textToInsert:"[Discription]:"},{uri:"ds6w:responsible",displayValue:"Owner",value:"[ds6w:responsible]",suggestionType:"predicates",textToInsert:"[Owner]:"},{uri:"ds6w:created",displayValue:"Creation Date",value:"[ds6w:created]",suggestionType:"predicates",textToInsert:"[Creation Date]:"}],_type2PredicatesPromise:{},init:function(){},getSuggestions:function(t,s,n){let o=this,l=n.types.length>0,c=i.getActiveTenant(),u=t.slice(0,s),d=/\w*$/.exec(u)[0],p=new RegExp("^"+UWA.String.escapeRegExp(d),"i");return new Promise((t,s)=>{if(!0!==n.context.isPredicate)t([]);else if(l){let s=n.types,i=[];s.forEach((t,s)=>{e.is(o._type2PredicatesPromise[t])?i.push(o._type2PredicatesPromise[t]):(o._type2PredicatesPromise[t]=new Promise((e,s)=>{let n={className:t,tenantId:c};r.loadRelevantPredicates(n,e)}),i.push(o._type2PredicatesPromise[t]))}),Promise.all(i).then(function(e){let s=o._getCommonPredicates(e);s=s.map(e=>(a.setPredicateDataType(e.uri,e.range.dataTypes[0].split("#")[1]),{displayValue:e.nlsName,value:"["+e.uri+"]",uri:e.uri,suggestionType:"predicates",textToInsert:"`"+e.nlsName+"` "})),a.getPreicatesPormise().then(function(e){s=s.concat(e),t(s.filter(function(e){return p.test(e.displayValue)}))})})}else a.getPreicatesPormise().then(function(e){t(e.filter(function(e){return p.test(e.displayValue)}))})})},_getCommonPredicates:function(e){let t,s=e[0].vocabularyPredicateInfo;return e.forEach((e,n)=>{t=e.vocabularyPredicateInfo,s=s.filter(e=>e.uri.indexOf("ds6wg:")>=0&&t.some(t=>e.uri===t.uri))}),s}})}),define("DS/SNUQLEditor/Adapters/TypeAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","text!DS/SNUQLEditor/assets/TypesMockUp.json","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchLogin","DS/SNUQLEditor/utils/StaticDataRepository"],function(e,t,s,n,i,r,a,o){"use strict";return t.singleton({_types:null,init:function(){},getSuggestions:function(e,t,s){let n=e.slice(0,t),i=/\w*$/.exec(n)[0],r=new RegExp("^"+UWA.String.escapeRegExp(i),"i");return new Promise((e,t)=>{!0!==s.context.isType?e([]):o.getTypesPromise().then(function(t){e(t.filter(function(e){return e=e.displayValue,r.test(e)}))},function(){e([])})})}})}),define("DS/SNUQLEditor/persistences/EQPersistenceAPI",["UWA/Core","UWA/Class","DS/SNUQLEditor/persistences/EQDAO","DS/SNInfraUX/SearchPreferences"],function(e,t,s,n){"use strict";return t.singleton({init:function(e){this._parent(e)},getByNameFromDB:function(e){return s.getByName(e)},saveToDB:function(e,t){s.save(e,t)},getAllFromDB:function(){return s.getAll()},getAllNameFromDB:function(){return s.getAllName()},isLastAvailable:function(){let t=n.getLocalStorageItem("EQs");return!!e.is(t)&&(t=JSON.parse(t),e.is(t.lastEQ))},getLast:function(){let t=n.getLocalStorageItem("EQs");if(e.is(t))return(t=JSON.parse(t)).lastEQ},storeLast:function(t){let s;s=n.getLocalStorageItem("EQs"),(s=e.is(s)?JSON.parse(s):{}).lastEQ=t,n.setLocalStorageItem("EQs",JSON.stringify(s))}})}),define("DS/SNUQLEditor/utils/CustomPredicateSuggestHelper",["UWA/Core","UWA/Class","DS/SNUQLEditor/utils/StaticDataRepository","text!DS/SNUQLEditor/assets/CustomPredicatesSuggests.json"],function(e,t,s,n){"use strict";return t.singleton({predicate_suggests:null,init:function(e){this.predicate_suggests=JSON.parse(n),this._parent(e)},getPredicateSuggests:function(e){return this.predicate_suggests[e]}})}),define("DS/SNUQLEditor/Adapters/PredicateValueAdapter",["UWA/Core","UWA/Class","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/SNInfraUX/SearchLogin","DS/SNUQLEditor/utils/CustomPredicateSuggestHelper","DS/SNUQLEditor/utils/StaticDataRepository"],function(e,t,s,n,i,r,a,o,l){"use strict";return t.singleton({_interfaces:null,_me_predicate:{uri:"ds6w:what/ds6w:responsible",displayValue:"ME",value:"%ME%",suggestionType:"tag",textToInsert:"`ME`"},init:function(){},getSuggestions:function(e,t,s){let n=this,i=e.slice(0,t),r=s.currentPredicate,a=l.getPredicateDataType(r),o=/\w*$/.exec(i)[0],c=new RegExp("^"+UWA.String.escapeRegExp(o),"i");return new Promise((e,t)=>{if(!0!==s.context.isTag)e([]);else if("string"===a)n._getSuggestions(o,s).then(function(t){t=t.filter(function(e){return c.test(e.displayValue)}),n._getRootWofPredicate(r).then(function(s){"ds6w:who"===s[0].lineage&&t.unshift(n._me_predicate),e(t)})});else{let t=n._getCustomSuggestsForDataType(a);e(t||[])}})},_getCustomSuggestsForDataType:function(e){return o.getPredicateSuggests(e)},_getSuggestions:function(t,s){let n=this;return new Promise((i,r)=>{t.length<3&&i([]);let a=function(t){let n=[];e.is(t.facets,"array")?(t.facets.forEach(e=>{e.sixw.indexOf(s.currentPredicate)>=0&&n.push({displayValue:e.object,value:'"'+e.object+'"',suggestionType:"tag",uri:e.sixw,textToInsert:"`"+e.object+"` "})}),i(n)):i([])};n._fedSearch(t,s,a,a)})},_getFedSearchOptions:function(e,t){let s=t.currentPredicate,i=n.getActiveTenant(),r=a.getAvailableSources(i),o=(r=r.map(e=>e.name)).includes("swym"),l=t.types,c="";c=l[0].indexOf("ds6wg:")>=0?'(flattenedtaxonomies:"types/'+l[0].replace("ds6wg:","")+'"':'([ds6w:type]:"'+l[0]+'"',l.forEach((e,t)=>{t>0&&(e[0].indexOf("ds6wg:")>=0?c+=' OR flattenedtaxonomies:"types/'+e.replace("ds6wg:","")+'"':c+=" OR [ds6w:type]:"+e)}),c+=")",c+=" AND ["+s+"]:(*"+e+"*)";let u={label:"ExpertSearchSuggest-"+n.getUserId()+"-"+(new Date).getTime(),order_by:"desc",order_field:"relevance",query:c,select_predicate:[s],nresults:1,source:r,tenant:i,with_nls:!1};return o||(u.select_synthesis=[s]),u},_fedSearch:function(t,s,a,o){var l=this;i.getServiceUrl({serviceName:"3DSearch",platformId:n.getActiveTenant(),onComplete:function(n){if(e.is(n,"string")){let e=l._getFedSearchOptions(t,s),i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(e),onComplete:function(e){let t=JSON.parse(e);a(t)},onFailure:function(e){o([])}};r.authenticatedRequest(n+"/search",i)}else o([])},onFailure:function(e){o([])}})},_getRootWofPredicate:function(e){let t=n.getLanguage(),i=n.getActiveTenant();return new Promise(function(n,r){s.getPropertiesRoots(e,{onComplete:n,onFailure:n,lang:t,tenantId:i})})}})}),define("DS/SNUQLEditor/utils/SmartKeywordsManager",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchUtils","DS/SNUQLEditor/utils/StaticDataRepository","DS/SNUQLEditor/utils/DateAndTimeUtils"],function(e,t,s,n,i){"use strict";return t.singleton({init:function(e){this._parent(e)},getValueForSmartKeyWords:function(t){if(!e.is(t))return"";switch(t){case"%ME%":return n.getLoggedInUser();case"%TODAY%":return i.todayForUQL();case"%THIS_WEEK%":case"%THIS_MONTH%":case"%THIS_YEAR%":default:return""}}})}),define("DS/SNUQLEditor/persistences/EQPersistenceManager",["UWA/Core","UWA/Class","DS/SNUQLEditor/persistences/EQPersistenceAPI"],function(e,t,s){"use strict";return t.singleton({lastQueryName:"Last Expert Query",init:function(e){this._parent(e)},getEQsNameToShowInCB:function(){let e=s.getAllNameFromDB();return s.isLastAvailable()&&e.unshift(this.lastQueryName),e},getEQByName:function(e){let t;return(t=e===this.lastQueryName?s.getLast():s.getByNameFromDB(e)).nls2InternalNameMap=new Map(Object.entries(t.nls2InternalNameMap)),t},storeLastEQ:function(e,t){let n={name:this.lastQueryName,query:e,types:t.types,intefaces:t.interfaces,selectedPredicates:t.currentPredicate,nls2InternalNameMap:Object.fromEntries(t.nls2InternalNameMap)};s.storeLast(n)},storeEQ:function(e,t,n){let i={name:e,query:t,types:n.types,intefaces:n.interfaces,selectedPredicates:n.currentPredicate,nls2InternalNameMap:Object.fromEntries(n.nls2InternalNameMap)};s.saveToDB(e,i)}})}),define("DS/SNUQLEditor/DataAdaptor",["UWA/Core","UWA/Controls/AutocompleteAdaptors/Abstract","text!DS/SNUQLEditor/assets/Adaptors.json","DS/SNUQLEditor/context/ContextManager"],function(e,t,s,n){"use strict";return t.extend({getSuggestions:function(t,s){let i=this,r=t.slice(0,s),a=/\w*$/.exec(r)[0],o=r.substring(0,r.length-a.length),l=this._getTokens(o),c=n.getContext(l),u=this.getAdaptors();return new Promise((n,r)=>{if(e.is(u,"array")&&u.length>0){let e=[];require(u,function(){for(let n=0;n<arguments.length;n++)e.push(arguments[n].getSuggestions(t,s,c));Promise.all(e).then(function(){let e=[];for(let t=0;t<arguments[0].length;t++)e=e.concat(arguments[0][t]);let t=e.map(function(e){return{displayValue:e.displayValue,start:s-a.length,end:s,fullValue:e.textToInsert,value:e.value,lastWord:a,suggestionType:e.suggestionType,uri:e.uri}},i);n(t)})})}else n([])})},getAdaptors:function(){return JSON.parse(s).adaptors},_getTokens:function(e){let t=new RegExp(/\`.+?\`/g);return(e=e.replaceAll(t,function(e){return e.replaceAll(" ","@")})).split(" ").map(function(e){return e.replaceAll("@"," ")})}})}),define("DS/SNUQLEditor/SNUQLEditorUX",["UWA/Core","UWA/Element","UWA/Controls/Abstract","UWA/Promise","DS/SNInfraUX/Logger","DS/SNUQLEditor/UQLAutoComplete","DS/SNUQLEditor/DataAdaptor","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/UIKIT/Mask","css!SNUQLEditor/SNUQLEditor","DS/SNUQLEditor/context/ContextManager","DS/SNUQLEditor/utils/InContextSearchManager","DS/SNUQLEditor/utils/StaticDataRepository","DS/SNUQLEditor/utils/SmartKeywordsManager","DS/Controls/ComboBox","DS/SNUQLEditor/persistences/EQPersistenceManager","DS/Controls/Popup","DS/Controls/Button","DS/Controls/LineEditor"],function(e,t,s,n,i,r,a,o,l,c,u,d,p,g,f,S,m,h,y,_){"use strict";return s.extend({_editorDialog:null,_autocomplete:null,init:function(e){this._parent(e),this._buildUI()},_buildUI:function(){let e=t.create("div",{}).inject(document.body),s=this;this._editorDialog=new l({header:this.getHeader(),closable:!1,visible:!0,body:this.getAutocomplete(),footer:this.getButtons(),events:{onHide:function(){s._cleanUp()}}}).inject(e),document.getElementsByClassName("modal-content")[0].addClassName("uql-editor-container"),c.mask(document.getElementsByClassName("uql-editor-container")[0]),n.all(g.getStaticDataPromiseArray()).then(function(){c.unmask(document.getElementsByClassName("uql-editor-container")[0])})},getHeader:function(){let e=t.create("div",{class:"uql-editor-header"});t.create("p",{text:"Expert Query"}).inject(e);let s=t.create("div",{styles:{width:"35%",display:"grid"}}).inject(e),n=new S({elementsList:m.getEQsNameToShowInCB(),placeholder:"Select a existing query"});return n.inject(s),n.addEventListener("change",this._restoreEQ.bind(this)),e},getButtons:function(){let e=this,t=[];return t[0]=new o({className:"primary",value:"Search",events:{onClick:function(){e._storeLastEQ(),e._searchInContext()}}}),t[1]=new o({className:"primary",value:"Save",events:{onClick:function(t){e._renderForm(t)}}}),t[2]=new o({value:"Cancel",events:{onClick:function(){e._storeLastEQ(),e._cleanUp()}}}),t},getAutocomplete:function(){let e=t.create("div",{class:"div-autocomplete",id:"div-autocomplete"});return this._autocomplete=new r({adaptor:a,multiline:!0,floatingSuggestions:!0,typeDelay:500,inputOptions:{attributes:{placeholder:"Start writing custom UQL...",styles:{left:0,opacity:1,"font-family":"3ds"}}}}).inject(e),this._autocomplete.elements.container.style.height="inherit",this._autocomplete.elements.container.style.width="inherit",this._autocomplete.elements.container.style["min-height"]="inherit",this._autocomplete.addEvent("onSetSuggestion",this.onSetSuggestion,!1),e},_searchInContext:function(){let e=this._autocomplete.getValue(),t=this._treatSpecialKeywords(this._getQueryFromUserInput(e));this._cleanUp(),p.search(t)},_getQueryFromUserInput:function(e){let t=new RegExp(/\`.+?\`/g);return e.replaceAll(t,function(e){return d.getInternalName(e)})},_treatSpecialKeywords:function(e){let t=new RegExp(/\%.+?\%/g);return e.replaceAll(t,function(e){return f.getValueForSmartKeyWords(e)})},_cleanUp:function(){d.resetContext(),this._editorDialog.destroy(),this._autocomplete.destroy()},onSetSuggestion:function(e){d.updateContext(e)},_storeLastEQ:function(){let t=this._autocomplete.getValue();if(e.is(t)&&t.length>10){let e=d.getContextToSave();m.storeLastEQ(t,e)}},_restoreEQ:function(e){e.stopPropagation();let t=m.getEQByName(e.dsModel.value);d.initializeContext({types:t.types,intefaces:t.interfaces,nls2InternalNameMap:t.nls2InternalNameMap,selectedPredicates:t.selectedPredicates}),this._autocomplete.setValue(t.query)},_renderForm:function(e){let s,n=this,i=t.create("div",{class:"save-uql-panel-form"});t.create("p",{text:"Save Expert Query",styles:{"font-weight":"bolder","margin-bottom":"0px"}}).inject(i);let r=t.create("div",{class:"save-uql-panel-line-editor"});r.inject(i);let a=new _({placeholder:"Enter Name",displayClearFieldButtonFlag:!0});a.inject(r);let o=t.create("div",{class:"save-uql-panel-button"});o.inject(i),new y({emphasize:"primary",label:"OK",onClick:function(){n._saveEQToDB(a.value),s.hide(),n._cleanUp(),s=null}}).inject(o),new y({emphasize:"secondary",label:"Cancel",onClick:function(){s.hide(),s=null}}).inject(o),(s=new h({target:e.target,visibleFlag:!0,position:"top",alignment:"near",offset:{x:-20,y:-80}})).setBody(i)},_saveEQToDB:function(t){let s=this._autocomplete.getValue();if(e.is(s)&&s.length>10){let e=d.getContextToSave();m.storeEQ(t,s,e)}},destroy:function(){}})});