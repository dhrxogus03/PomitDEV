define("DS/W3DSpaceApp/Views/cleanCollaborativeSpace",["DS/UIKIT/Input/Select","DS/UIKIT/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Utils/RequestHelper","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp","css!DS/UIKIT/UIKIT.css","css!DS/W3DSpaceApp/W3DSpaceApp.css"],function(e,t,n,i,s,a){"use strict";return function(o,r){var l,c,u=0,p=0;l=r&&r.report?r.report.length:0;var d,m,f,h=r&&r.results?r.results:[],g=[],b=[];(h.filter(function(e){return"businessobject"!==e.basetype||"PLMPosSettingRef"!==e.type}).forEach(function(e){var t;e.actiontype&&"automove"===e.actiontype?(u++,t={objectID:e.ObjectID,targetowner:e.target.owner,targetcs:e.target.cs,targetorg:e.target.org},g.push(t)):e.actiontype&&"manualmove"===e.actiontype&&(p++,t={objectID:e.ObjectID,targetowner:e.attributes.owner,targetorg:e.attributes.organization},b.push(t))}),l||u||p)?(d={title:o.get("title"),nbReports:l,nbAutoMove:u,nbManualMove:p,spaces:[]},p>0?(m="{0}/resources/enocsmrest/collabspaces".format(o._auth.platform.url3DSpace),f={embed:"contexts",sort:"atitle",fields:"title,contexts"},new Promise(function(e,t){var n=["VPLMProjectLeader","VPLMCreator"];s.performRequestWithOptions(m,{type:"json",data:f,onComplete:function(t){var i=t.filter(function(e){if(e.name!==o.id){var t=e.contexts;return t.filter(function(e){return Boolean(n.includes(e.role))}).length>0}return!1}).map(function(e){var t={value:e.name,label:e.title,context:e.contexts[0].name};return t});e(i)},onFailure:function(e){t(e)}})})).then(function(e){d.spaces=e,v(d)},function(){v(d)}):v(d)):i.add({message:a.replace(a.reportCheckNoReport,{name:o.get("title")}),className:"error"});function v(s){var r,l,u,p=a.replace(a.deleteElem,{name:s.title}),d="";d+="<ul>",s.nbReports&&(l=a.replace(a.reportCheckError,{nbelem:s.nbReports}),d=d.concat("<li>").concat(l).concat("</li>")),s.nbAutoMove&&(l=a.replace(a.reportCheckAutoMove,{nbelem:s.nbAutoMove}),d=d.concat("<li>").concat(l).concat("</li>")),s.nbManualMove&&(l=a.replace(a.reportCheckManualMove,{nbelem:s.nbManualMove}),d=d.concat("<li>").concat(l).concat("</li>"),u=new e({className:"cleanSelect",placeholder:s.spaces.length?a.selectCS:a.reportCheckNoCS,disabled:Boolean(!s.spaces.length),events:{onChange:function(e){r=e.target.value}}}),r=s.spaces.length?s.spaces[0].value:void 0,s.spaces.forEach(function(e,t){var n={};n.value=e.value,n.label=e.label,n.selected=0===t,u.add(n)}));var m=document.createElement("div");m.classList.add("cleanHeader"),m.innerHTML=a.reportCheckHeader,d+="</ul><br>";var f=document.createElement("div");f.innerHTML=d,f.classList.add("cleanActions");var h=[m,f];u&&h.push(u);var v={title:p,body:h,buttons:[{value:a.move,disabled:!s.nbAutoMove&&!s.nbManualMove||s.nbManualMove&&!r,active:!0,action:function(e){if(!b.length||r){b.length&&b.forEach(function(e){e.targetcs=r});var n={data:[{content:g.concat(b)}]},l={};l.body=n,o.cleanContent(l).then(function(e){if(e&&e.report&&e.report.length){var t,n=[];e.report.forEach(function(e){e.error&&!n.includes(e.error)&&n.push(e.error)}),n.forEach(function(e){t=t?t+" | "+e:e}),i.add({message:a.replace(a.reportCleanPartial,{name:s.name,message:t}),className:"error"})}else i.add({message:a.replace(a.reportCleanSuccess,{name:s.name}),className:"success"})},function(e){i.add({message:a.replace(a.reportCleanError,{name:s.name}),className:"error"})}),e.hide()}else!function(e){c||(c=new t({visible:!0,autoHide:!0,hideDelay:3e3,className:"w3ddrive alert"}).inject(document.body.querySelector(".cleanSelect"))),c.add({message:e.message,className:e.className||"success"})}({message:a.selectCS,className:"warning"})}},{value:a.cancel,action:function(e){e.hide()}}]};n.dialog(v)}}}),define("DS/W3DSpaceApp/Views/advancedView",["DS/i3DXPnOMultiOrg/OrgOperatorController","DS/W3DSpaceComponents/Views/shareCollaborativeSpace","DS/W3DContentApp/BusEvent","UWA/Core","DS/UIKIT/Tooltip","DS/W3DDrive/widget","DS/W3DContentApp/Utils/Metrics","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a,o,r){"use strict";return{createMultiOrgButton:function(e){var t=i.createElement("span",{class:"fonticon fonticon-user-cog fonticon-clickable",events:{click:function(){l(e),o.trackAction({eventAction:"advancedView",model:e})}}});return new s({target:t,body:r.advanced,position:"top"}),t},multiOrgClick:l};function l(i){var s=document.createElement("div");s.classList.add("multiOrg"),s.classList.add("multiOrg--visible"),a.body.appendChild(s),window.selectedInode=i,window.orgOperatorController=new e({container:s,tenantId:i._auth.platformId,currentUser:i.drive.get("user").id,collabSpace:i.id,collabSpaceTitle:i.get("title"),securityContext:function(e){var t,n,i=e.get("contexts");if(i.length>1){for(t=0;t<i.length&&"VPLMProjectAdministrator"!==(n=i[t]).role&&"3DSRestrictedOwner"!==n.role;t++);return encodeURIComponent(n.name)}return encodeURIComponent(i[0].name)}(i),owner:c(i).isOwner,ownerRestricted:c(i).isOwnerRestricted,mainOwner:i.get("owners").login,roles:i.drive.get("availableRoles"),onAddUsers:function(){(function(e){t(e),o.trackAction({eventAction:"addMemberAdvanced",model:e})}).call(this,selectedInode)},onCloseView:function(){document.querySelector(".multiOrg").destroy(),n.dispatchEvent("inodeDetailAccessesView:onAccesses",selectedInode),a.removeEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)}),orgOperatorController.destroy(),orgOperatorController=null}}),i.listenTo(orgOperatorController,"onRemoveUser",function(e){var t=this.permissions,n=t.findWhere({physicalid:e});n&&t.remove(n)}),a.addEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)})}function c(e){for(var t,n,i,s=e.get("contexts"),a=0;a<s.length;a++){if("VPLMProjectAdministrator"===(t=s[a]).ocdx){n=!0;break}if("3DSRestrictedOwner"===t.ocdx){i=!0;break}n=!1,i=!1}return{isOwner:n,isOwnerRestricted:i}}}),define("DS/W3DSpaceApp/Actions/editCS",["DS/UIKIT/Form","DS/W3DContentApp/Utils/UIElementsFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","DS/W3DContentApp/Actions/Utils/actionsUtils","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a,o){"use strict";return function(r,l){var c,u=s(r),p=u.maxchars,d=u.maxcharsDesc,m=r.drive._attributes.actions.filter(function(e){return"add.collabspaces.visibility"===e}),f=!1;const h=[],g={type:"text",name:"title",id:"input-title",focus:!0,label:o.get("title"),value:r.get("title"),placeholder:o.CSName,required:!0,spellcheck:!1,pattern:u.forbiddenChars.regex,errorText:u.forbiddenChars.text,maxlength:p.maxLength},b={type:"textarea",name:"description",label:o.description,placeholder:o.description,value:r.get("description"),required:!1,spellcheck:!1,maxlength:d.maxLength,errorText:o.warningDescription},v={type:"select",label:o.visibility,name:"visibility",id:"visibility",options:[{value:"PRIVATE",name:"PRIVATE",label:o.isPrivate+" - "+o.privateDetail,id:"private",selected:r.get("visibility").value.toUpperCase()==="Private".toUpperCase(),disabled:"STANDARDTEAM"===r.get("family").value.toUpperCase()},{value:"PROTECTED",name:"PROTECTED",label:o.isProtected+" - "+o.protectedDetail,id:"protected",selected:r.get("visibility").value.toUpperCase()==="Protected".toUpperCase(),disabled:"STANDARDTEAM"===r.get("family").value.toUpperCase()},{value:"PUBLIC",name:"PUBLIC",label:o.isPublic+" - "+o.publicDetail,id:"public",selected:r.get("visibility").value.toUpperCase()==="Public".toUpperCase()}]};if(r.get("actions")){var S=r.get("actions");r.get("actions").indexOf("edit.title")>r.get("actions").indexOf("edit.owner")&&(S=r.get("actions").reverse());for(var y=0;y<S.length;y++)"edit.title"===S[y]&&h.push(g),"edit.description"===S[y]&&h.push(b),m.length>0&&"edit.visibility"===S[y]&&(f=!0,h.push(v))}const D=new e({fields:h,events:{onSubmit:function(){t.getModalSubmitButton().click()}}}),C=D.getField("title"),A=D.getField("description"),w=D.getField("visibility");function W(e,t,n,i){return!(!t||t.value===e.get("title"))||(!(!n||n.value===e.get("description"))||!(!i||i.value===e.get("visibility").value.toUpperCase()))}function I(){var e,t=(D.getValue("title")||"").trim(),s=D.getValue("description")||"",c=f?D.getValue("visibility"):r.get("visibility").value.toUpperCase();if(t){e={title:t,description:s,visibility:c};var u=function(e,t,n){var i=["PRIVATE","PROTECTED","PUBLIC"],s=i.findIndex(t=>t===e.toUpperCase()),a=i.findIndex(e=>e===t.toUpperCase()),r=null;a>s?(r=o.replace(o.visibilityIncreaseConfirmMessage1,{name:n}),r+="<br><br><b>",r+=o.visibilityIncreaseConfirmMessage2+"</b>"):a<s&&(r=o.replace(o.visibilityReduceConfirmMessage1,{name:n}),r+="<br><br><b>",r+=o.visibilityReduceConfirmMessage2+"</b>");return r}(r.get("visibility").value,c,r.get("title"));if(u){var p=o.replace(o.visibilityConfirmTitle),d=o.get("Edit");a.showGenericConfirmationModal(p,u,d,function(){i.dispatchEvent("inodeActions:onEditCS",[r,l,e])})}else i.dispatchEvent("inodeActions:onEditCS",[r,l,e]),n.modals.current&&n.modals.current.hide()}}C.addEventListener("keyup",function(){t.resetInput(C),"Escape"!==event.key&&(D.getValue("title").length>=p.maxLength&&t.unvalidateInput(C,{customMessage:p.maxLengthText,type:"warning"}),C.checkValidity()&&C.value.trim().length>0?W(r,C,A,w)?t.enableModalSubmitButton():t.disableModalSubmitButton():(t.unvalidateInput(C,{customMessage:u.forbiddenChars.text,type:"error"}),t.disableModalSubmitButton()))}),A.addEventListener("keyup",function(){"Escape"!==event.key&&(t.resetInput(A),this.value.length>=d.maxLength&&t.unvalidateInput(A,{customMessage:o.warningDescription,type:"warning"}),W(r,C,A,w)?t.enableModalSubmitButton():t.disableModalSubmitButton())}),w&&w.addEventListener("change",function(){W(r,C,A,w)?t.enableModalSubmitButton():t.disableModalSubmitButton()}),c={title:o.editCollabSpace,body:D,buttons:[{className:"primary js-validation-button",value:o.Edit,action:function(){I()}},{value:o.cancel,action:function(e){e.hide()}}]},n.dialog(c),D.getField("title").focus(),n.modals.current.getFooter().getElement(".btn-primary").disabled=!0}}),define("DS/W3DSpaceApp/Views/inodePropertiesView3DSpaceContainer",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/W3DContentApp/Views/InodeDetailView/inodePropertiesView","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/UIKIT/Scroller","DS/W3DContentApp/Utils/Metrics","DS/W3DContentApp/BusEvent","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a,o,r,l,c,u){"use strict";return function(e){if(!e||!e.model)throw new Error("Missing input");var p,d,m,f,h=e.model,g=new n,b=g.destroy,v=g.render;return h.isContainer()?(h.isCollabSpace()?e.listProperties=[{key:"name",attribute:"name",nls:u.name,type:"string"},{key:"type",attribute:"mimeType",nls:u.type,type:"string",value:function(e){return e.isCollabSpace()?u.collaborativeSpace:""}},{key:"owner",attribute:"owners",nls:u.owner,type:"string",value:function(e){return e.getOwnerNames()}},{key:"createdDate",attribute:"createdDate",nls:u.dateCreated,type:"date"},{key:"modifiedDate",attribute:"modifiedDate",nls:u.dateModified,type:"date"},{key:"description",attribute:"description",nls:u.description,type:"string"},{key:"visibility",attribute:"visibility",nls:u.visibility,type:"string",value:function(e){return e.get("visibility")?e.get("visibility").name:""}},{key:"family",attribute:"family",nls:u.family,type:"string",value:function(e){return e.get("family")?e.get("family").name:""}}]:e.listProperties=[],p=i(e),g.elements.propertiesView=p,g.container.appendChild(p.container),p.container.classList.add("inode-detail__body")):(m=t.createElement("div",{className:"inode-edit-properties inode-detail__body",styles:{height:"100%"}}),g.container.appendChild(m),d={"onChange:title":function(){f.onRefresh()},"onChange:description":function(){f.onRefresh()}}),new r({element:g.container}),Object.assign(g,{render:function(){if(p)p.render();else{g.stopListening(),g.listenTo(h,d);var e=m,t=[],n=new o({metatype:"businessobject",tenant:h.drive.id,objectId:h.get("id")});f?(f.onRefresh(),t.push(n),f.initDatas(t)):(f=new s({typeOfDisplay:a.ALL,selectionType:a.NO_SELECTION,editMode:!1,clickOnAnnotationData:this.loadAnnotation}),t.push(n),f.initDatas(t),f.removeFacets([a.FACET_VIEWS]),f.inject(e))}return l.trackAction({model:h,eventAction:"propertiesTab"}),v(),g},loadAnnotation:function(e){var t={data:{annotationFile:e.annotation}};c.dispatchEvent("socialToolbar:onPreviewAnnotation",[h,t])},destroy:function(){g.stopListening(),b.apply(g,arguments),g.container=null,g.stopListening(),g.model=null}})}}),define("DS/W3DSpaceApp/Utils/W3DSpacePreferencesUpgrade",[],function(){"use strict";return function(e){var t=e.getValue("collab-storage");return t&&(e.setValue("saved-fragment","drives/"+t+"/mimetype/text%2Fdirectory/inode/myCollabSpaces/content"),e.setValue("firstlyLoading","false"),e.setValue("collab-storage",null),e.setValue("main-view",null),e.setValue("id-card-view",null)),e}}),define("DS/W3DSpaceApp/Actions/accessActions",["i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e){"use strict";return function(t){function n(e){t.dispatchAccessActions("onChangeCollabSpaceMemberRole",[t.model,e])}return t.actions=t.actions.concat([{id:"removePermission",text:e.remove,icon:"fonticon fonticon-user-delete",handler:function(){var n,i=t.model;return n=i.isGroup()?document.createTextNode(e.removeAccessGroupDescription):document.createTextNode(e.removeAccessUserDescription),t.openDialog({title:e.replace(e.get("removeAccessTo"),{name:i.get("title")}),body:[n],confirmAction:{title:e.remove,handler:function(){t.dispatchAccessActions("onRemoveCollabSpaceMember",[i])}}})}},{id:"makePublicReader",text:e.publicReader,icon:"fonticon fonticon-eye",handler:function(){n({value:"PublicReader",admin:!1})}},{id:"makeReader",text:e.reader,icon:"fonticon fonticon-eye",handler:function(){n({value:"Reader",admin:!1})}},{id:"makeContributor",text:e.contributor,icon:"fonticon fonticon-eye",handler:function(){n({value:"Contributor",admin:!1})}},{id:"makeAuthor",text:e.author,icon:"fonticon fonticon-feather",handler:function(){n({value:"Author",admin:!1})}},{id:"makeLeader",text:e.leader,icon:"fonticon fonticon-star",handler:function(){n({value:"Leader",admin:!1})}},{id:"makeLeaderOwner",text:e.leaderOwner,icon:"fonticon fonticon-star",handler:function(){n({value:"Leader",admin:!0})}},{id:"makeOwner",text:e.owner,icon:"fonticon fonticon-key",handler:function(){n({value:"Owner",admin:!0})}},{id:"makeMainOwner",text:e.mainOwner,icon:"fonticon fonticon-user-key",handler:function(){t.dispatchAccessActions("onChangeMainOwnerCS",[t.model])}}]),t}}),define("DS/W3DSpaceApp/Views/PublishContent",["UWA/Class/View","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Views/PublishTo3DSwymService","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i){"use strict";return e.extend({setup:function(e){if(!e)throw new Error("Missing input");this.inode=e,this._launch()},_launch:function(){t.dialog({title:i.replace(i.get("publishTo3DSwymTitle"),{name:this.inode.get("title")}),body:[new n(this.inode).render()]}),t.modals.current.getBody().className="shareview"}})}),define("DS/W3DSpaceApp/Actions/editContent",["DS/UIKIT/Form","DS/W3DContentApp/Utils/UIElementsFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a){"use strict";return function(o){var r,l=s(o),c=l.maxchars,u=l.maxcharsDesc;const p=[],d={type:"text",name:"title",id:"input-title",focus:!0,label:a.get("title"),value:o.get("title"),placeholder:a.title,required:!0,spellcheck:!1,errorText:a.errorEditTitle,maxlength:c.maxLength},m={type:"textarea",name:"description",label:a.description,placeholder:a.description,value:o.get("description"),required:!1,spellcheck:!1,maxlength:u.maxLength};p.push(d,m);const f=new e({fields:p,events:{onSubmit:function(){t.getModalSubmitButton().click()}}}),h=f.getField("title"),g=f.getField("description");h.addEventListener("keyup",function(){t.resetInput(h),"Escape"!==event.key&&(f.getValue("title").length>=c.maxLength&&t.unvalidateInput(h,{customMessage:l.maxchars.maxLengthText,type:"warning"}),h.checkValidity()&&h.value.trim().length>0?h.value.trim().toUpperCase()===o.get("title").trim().toUpperCase()?t.disableModalSubmitButton():t.enableModalSubmitButton():(t.unvalidateInput(h,{customMessage:a.errorEditTitle,type:"error"}),t.disableModalSubmitButton()))}),g.addEventListener("keyup",function(){t.resetInput(g),"Escape"!==event.key&&(g.value.trim().toUpperCase()===o.get("description").trim().toUpperCase()?t.disableModalSubmitButton():t.enableModalSubmitButton())}),r={title:a.EditProperties,body:f,buttons:[{className:"primary js-validation-button",value:a.Edit,action:function(){var e,t,s;t=(f.getValue("title")||"").trim(),s=f.getValue("description")||"",t&&(e={title:t,description:s},i.dispatchEvent("inodeActions:onEditContent",[o,e]),n.modals.current&&n.modals.current.hide())}},{value:a.cancel,action:function(e){e.hide()}}]},n.dialog(r),f.getField("title").focus(),n.modals.current.getFooter().getElement(".btn-primary").disabled=!0}}),define("DS/W3DSpaceApp/Metas/inode",["DS/W3DContentApp/Metas/inode","DS/WebappsUtils/WebappsUtils"],function(e,t){"use strict";return function(){var n=e();return Object.assign(n.ids,{files:"files",trueRoot:"trueRootId",collaborativeSpaces:"CollaborativeSpaces",myCollabSpaces:"myCollabSpaces"}),Object.assign(n.icons,{}),Object.assign(n.thumbnails,{collabSpace:t.getWebappsAssetUrl("W3DDrive","Collab_Space_Thumbnail.png"),defaultPeople:t.getWebappsAssetUrl("W3DContentApp","thumbnails/default-people.png")}),n.boType={collabSpace:"collaborative Space",team:"Team",leader:"Leader",leaderOwner:"Leader & Owner",document:"Document"},n}}),define("DS/W3DSpaceApp/Views/inodeDetailAnalyticsView",["UWA/Core","UWA/Class/View","DS/W3DXComponents/Views/GraphView","DS/UIKIT/Scroller","DS/W3DContentApp/Utils/Metrics","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp","css!DS/W3DSpaceApp/W3DSpaceApp.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,s,a){"use strict";var o;function r(t){var i,s,r,l;i={title:a.mpr,unit:a.unitMembers,labelFormat:"",graphName:"Members"},s=t,r=new n({title:i.title,type:n.TYPE_PIE,unit:i.unit,plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.y:} "+i.labelFormat}}},series:[]}),l=e.createElement("div",{class:"analytics"}),r.inject(l),l.inject(s),r.reflow(),o=r}return function(n){var l=n.model,c=new t(n),u=c.destroy,p=e.createElement("div",{class:"inode-analytics_container"});return p.render=function(){},p.container=p,s.trackAction({model:l,eventAction:"analyticsTab"}),c.container.classList.add("inode-detail-analytics"),Object.assign(c,{render:function(){var e,t,n=c.container;return 0===n.getChildren().length&&((t=document.createElement("div")).classList.add("inode-detail-analytics__to-scroll"),e=t,r(p),function(e,t){var n={onComplete:function(t){var n,i,s=JSON.parse(t),o=s.mpr,r=s.nbmembers;n=e,i={data:o,subtitle:a.members,nbr:r},n.setOptions({subtitle:i.nbr+" "+i.subtitle,series:[{data:i.data}]}),n.render(),n._highcharts.container.childNodes[0].childNodes[6].style.visibility="hidden"}};t.getAnalyticsMembers(n)}(o,l),e.appendChild(p),n.appendChild(e),new i({element:e})),c},destroy:function(){c.stopListening(),u.apply(c,arguments)}})}}),define("DS/W3DSpaceApp/Actions/createCS",["DS/UIKIT/Form","DS/W3DContentApp/Utils/UIElementsFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DContentApp/Utils/drivesInputs","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a){"use strict";return function(o,r){var l,c,u,p=s(o),d=p.maxchars,m=p.maxcharsDesc,f=o.drive.get("actions").filter(function(e){return"add.collabspaces.visibility"===e});const h=[{type:"text",name:"title",id:"input-title",focus:!0,label:a.get("title"),placeholder:a.CSName,required:!0,spellcheck:!1,pattern:p.forbiddenChars.regex,errorText:p.forbiddenChars.text,maxlength:d.maxLength},{type:"textarea",name:"description",label:a.description,placeholder:a.description,required:!1,spellcheck:!1,maxlength:m.maxLength,errorText:a.warningDescription}];c={type:"select",label:a.visibility,name:"visibility",id:"visibility",options:[{value:"PRIVATE",label:a.isPrivate+" - "+a.privateDetail,id:"private",selected:!0,disabled:!1},{value:"PROTECTED",label:a.isProtected+" - "+a.protectedDetail,id:"protected",disabled:!1},{value:"PUBLIC",label:a.isPublic+" - "+a.publicDetail,id:"public",disabled:!1}]},l={type:"select",label:a.family,name:"family",id:"family",options:[{value:"DESIGNTEAM",id:"DESIGNTEAM",label:a.design+" - "+a.designDetail,selected:!0,disabled:!1},{value:"STANDARDTEAM",id:"STANDARDTEAM",label:a.standard+" - "+a.standardDetail,disabled:!1}]},o.drive._attributes.isInnovation&&(h.push(l),h.push(c));const g=new e({fields:h,events:{onSubmit:function(){t.getModalSubmitButton().click()}}});g.elements.container.getChildren()[3].getElementsByClassName("select-dropdown")[0].classList.add("visibility"),g.elements.container.getChildren()[3].getElementsByClassName("select-choices")[0].classList.add("visibility"),0===f.length?(g.elements.container.getChildren()[3].hide(),g.getInput("family").disable(1),g.getInput("visibility").enable(0),g.getInput("visibility").disable(1),g.getInput("visibility").disable(2),g.getInput("visibility").setValue(0)):f.length>0&&o.drive._attributes.isInnovation&&g.getInput("family").addEvent("onChange",function(){"DESIGNTEAM"===g.getValue("family")?(g.getInput("visibility").enable(0),g.getInput("visibility").enable(1),g.getInput("visibility").enable(2),g.getInput("visibility").setValue(0)):(g.getInput("visibility").enable(2),g.getInput("visibility").disable(1),g.getInput("visibility").disable(0),g.getInput("visibility").setValue(2))});const b=g.getField("title"),v=g.getField("description");b.addEventListener("keyup",function(){"Escape"!==event.key&&(t.resetInput(b),g.getValue("title").length>=d.maxLength&&t.unvalidateInput(b,{customMessage:d.maxLengthText,type:"warning"}),b.value.trim().length>0&&b.checkValidity()?b.value.contains("  ")?(t.unvalidateInput(b,{customMessage:p.forbiddenChars.spaces,type:"error"}),t.disableModalSubmitButton()):t.enableModalSubmitButton():(t.unvalidateInput(b,{customMessage:p.forbiddenChars.text,type:"error"}),t.disableModalSubmitButton()))}),v.addEventListener("keyup",function(){"Escape"!==event.key&&(t.resetInput(v),this.value.length>=m.maxLength&&t.unvalidateInput(v,{customMessage:a.warningDescription,type:"warning"}))}),u={title:a.createCollabSpace,body:g,buttons:[{className:"primary js-validation-button",value:a.create,action:function(){var e,t,s,a,l;t=(g.getValue("title")||"").trim(),s=g.getValue("description")||"",a=g.getValue("visibility"),l=o.drive._attributes.isInnovation?g.getValue("family"):"DESIGNTEAM",t&&(e={title:t,description:s,visibility:a,family:l},g.validate()&&i.dispatchEvent("inodeActions:onCreateCS",[o,r,e]),n.modals.current&&n.modals.current.hide())}},{value:a.cancel,action:function(e){e.hide()}}]},n.dialog(u),g.getField("title").focus(),n.modals.current.getFooter().getElement(".btn-primary").disabled=!0}}),define("DS/W3DSpaceApp/Models/CSMember",["DS/W3DContentApp/Models/AuthModel","UWA/String"],function(e,t){"use strict";return e.extend({idAttribute:"physicalid",defaults:{type:"",id:"",role:{}},parse:function(e){return e.type?"Person"===e.type?{type:e.type,id:e.id,physicalid:e.physicalid,title:e.title,picture:n(this,e),email:e.email,role:i(e.role),accessright:i(e.role).value,isownercs:e.isownercs,actions:s(e.actions),collabspace:e.collabspace}:{type:e.type,id:e.id,physicalid:e.physicalid,title:e.title,picture:n(this,e),members:e.members,role:i(e.role),accessright:i(e.role).value,isownercs:e.isownercs,actions:s(e.actions),collabspace:e.collabspace}:void 0},getActionIds:function(){return this.get("actions")||[]},isUser:function(){return"Person"===this.get("type")},isGroup:function(){return"Group"===this.get("type")},isPending:function(){return this.get("id")===this.get("email")},isActionAllowed:function(e){return-1!==this.getActionIds().indexOf(e)}});function n(e,n){return"Person"===n.type?t.format("{0}/api/user/getpicture/login/{1}/format/normal",e._auth.getSwymService(),n.id):n.picture}function i(e){var t;if(e)return e&&e.value&&"owner"!==(t=e.value.toLowerCase())&&e.admin&&(t+="Owner"),{value:t,admin:e.admin,restricted:e.restricted}}function s(e){if(e){var t={delete:"removePermission","edit.role.publicreader":"makePublicReader","edit.role.reader":"makeReader","edit.role.contributor":"makeContributor","edit.role.author":"makeAuthor","edit.role.leader":"makeLeader","edit.role.leaderowner":"makeLeaderOwner","edit.role.owner":"makeOwner","edit.owner":"makeMainOwner"};return e.map(function(e){return t[e]})}}}),define("DS/W3DSpaceApp/Models/ContentVersion",["UWA/Class/Promise","UWA/Class/Model","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n){"use strict";return t.extend({idAttribute:"physicalid",parentId:"",drive:"",parse:function(e){var t,n={};for(t in n={physicalid:e.physicalid,file:e.file,masterid:e.masterid,title:e.title,modified:this.convertDateToMs(e.modified),actions:e.actions,fileExtension:e.title.split(".")[1]})n.hasOwnProperty(t)&&void 0===n[t]&&delete n[t];return n},getDownloadUrl:function(){var t=this,i="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/versions/{3}/download".format(this.collection._auth.platform.url3DSpace,this.collection._parentInode.id,this.get("masterid"),this.id);return new e(function(e,s){n.performRequestWithOptions(i,{type:"json",onComplete:function(n){var i=n?n.url:null;t.set("downloadUrl",i),e({url:i,method:"POST"})},onFailure:s})})},isActionIdoK:function(){return"download"},isActionAllowed:function(e){return!0===this.get("actions").reduce(function(e,t){return e[t]=!0,e},{})[e.replace("Version","")]},isContainer:function(){return!1},convertDateToMs:function(e){if(e)return 1e3*parseInt(e,10)}})}),define("DS/W3DSpaceApp/Views/dndCoachmark",["DS/W3DXComponents/Views/EmptyView","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp","css!DS/W3DContentApp/W3DContentApp.css"],function(e,t){"use strict";const n="start-view--medium",i="start-view--small";let s,a=!0;const o=Object.freeze({normal:980,small:660});function r(e,t){return e&&t in e?e[t].join?e[t].join(" "):e[t]:""}function l(e="div",t={}){const n=t.id,i=r(t,"classes");return"<"+e+(n?' id="'+n+'"':"")+(i?' class="'+i+'"':"")+">"+r(t,"content")+"</"+e+">"}return function(r={}){let c=new e({id:"start_view_0",template:function(){return l("div",{id:"no-content-view",classes:"empty-view-infos"+(r.isDnD?" hidden":""),content:[l("span",{classes:"empty-view-icon center-block fonticon fonticon-5x fonticon-picture"}),l("span",{classes:"empty-view-title center-block",content:t.get("noContent")})]})+l("div",{id:"dnd-view",classes:"start-view__drop-zone"+(r.isDnD?"":" hidden"),content:[l("div",{classes:"start-view__drop-zone-content",content:[l("span",{classes:"start-view__drop-zone-icon fonticon fonticon-5x fonticon-picture"}),l("span",{classes:"start-view__drop-zone-title",content:t.get("dropFiles")})]})]})}});var u;c.container.classList.add("start-view"),u=c,a=!0,s=window.requestAnimationFrame(function e(){if(a&&(setTimeout(function(){a&&(s=requestAnimationFrame(e))},500),u&&u.container)){const e=u.container.classList,t=parseInt(getComputedStyle(u.container).getPropertyValue("width").replace("px",""),10);if(t<o.small){if(e.contains(i))return;return e.remove(n),void e.add(i)}if(t<o.normal){if(e.contains(n))return;return e.remove(i),void e.add(n)}e.remove(n),e.remove(i)}}),c.toggleDnDView=(e=>{const t=this.container.querySelector("#no-content-view"),n=this.container.querySelector("#dnd-view");t&&t.classList.toggle("hidden",e),n&&n.classList.toggle("hidden",!e)});const p=c.destroy;return c.destroy=function(){c&&(c.container.removeEvents(),window.cancelAnimationFrame(s),s=null,a=!1,c.template=null,p.apply(c,arguments),c.stopListening(),c.container=null,c.model=null,c=null)},c}}),define("DS/W3DSpaceApp/Utils/actionsFiltering",[],function(){"use strict";var e={getCollabSpaceActions:function(e){var t=[];"trueRootId"!==e.get("parentId")&&(t=["viewAccesses","viewAnalytics"]);var n=e.get("actions");if(n)for(var i=0;i<n.length;i++)"edit.title"===n[i]&&t.push("editCS"),"add.contents"===n[i]&&t.push("addContent"),"add.members"===n[i]&&t.push("PublicReader","Reader","Contributor","Author","Leader","Readerrestricted","Contributorrestricted","Authorrestricted","Leaderrestricted"),"add.members.restricted"===n[i]&&t.push("Readerrestricted","Contributorrestricted","Authorrestricted","Leaderrestricted"),"delete"===n[i]&&t.push("delete"),"edit.thumbnail"===n[i]&&t.push("changeThumbnail"),"add.collabspaces"===n[i]&&t.push("createCollabSpace");return t},getContentActions:function(e){var t=["comment","preview","openWith","viewHistory"],n=e.get("actions");if(n)for(var i=0;i<n.length;i++)"download"===n[i]&&(t.push("download"),"Document"===e.get("type").value&&t.push("shareContent")),"move"===n[i]&&t.push("moveToCS"),"update"===n[i]&&t.push("update"),"delete"===n[i]&&t.push("delete"),"edit"===n[i]&&t.push("editContent");return t}};return e}),define("DS/W3DSpaceApp/Views/inodeAllAccessesContainer",["UWA/Class/View","DS/UIKIT/Iconbar","DS/W3DDrive/InodeActions","DS/W3DSpaceApp/Views/advancedView","DS/W3DContentApp/Views/InodeDetailView/inodeAllAccessesView","DS/W3DContentApp/Components/SearchFilterAccesses","DS/W3DSpaceApp/Actions/accessActions","DS/W3DContentApp/Utils/Metrics","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a,o,r,l){"use strict";return function(c){if(!c||!c.model)throw new Error("**************** Missing input! ****************");var u=c.model,p=new e,d=p.destroy,m=i.createMultiOrgButton(u),f=new n({model:u,context:"access"}).toJSON(),h=u.drive.get("availableRoles")||[],g=new t({className:"inode-access__topbar",items:f.filter(function(e){return"addMember"===e.id||"addMemberRestricted"===e.id})});function b(e){const t={};let n,i,s;return Object.entries(e).forEach(function(e){"title"===e[0]&&(s=e[1]),"type"===e[0]&&(n=e[1]),"role"===e[0]&&(i=e[1].toString())}),n&&(t.type=n),i&&(t.role=i),s&&(t.title=s),t}var v=[{category:"role",name:"contributor",fonticon:"eye",text:l.get("contributor"),selectable:!0},{category:"role",name:"author",fonticon:"pencil",text:l.get("author"),selectable:!0},{category:"role",name:"leaderOwner",fonticon:"star",text:l.get("leaderOwner"),selectable:!0}];h.includes("Reader")&&v.push({category:"role",name:"reader",fonticon:"eye",text:l.get("reader"),selectable:!0}),h.includes("PublicReader")&&v.push({category:"role",name:"publicReader",fonticon:"eye",text:l.get("publicReader"),selectable:!0}),h.includes("Leader")&&v.push({category:"role",name:"leader",fonticon:"star",text:l.get("leader"),selectable:!0}),h.includes("Owner")&&v.push({category:"role",name:"owner",fonticon:"key",text:l.get("owner"),selectable:!0});const S={is3DSpace:!0,collection:u.permissions,searchConfig:{handler:function(){this.collection.fetch({reset:!0,data:b(this.filters)})}},filterConfig:{multiSelect:!0,items:[{className:"header",text:l.get("responsibilities")},v,{className:"divider"},{className:"header",text:l.get("Types")},{category:"type",name:"Person",fonticon:"user",text:l.get("person"),selectable:!0},{category:"type",name:"Group",fonticon:"users-group",text:l.get("group"),selectable:!0}],handler:function(){const e=this.elements.filterMenu.getSelectedItems(),t=e.filter(e=>"role"===e.category).map(e=>e.name);this.filters.role=t;const n=e.filter(e=>"type"===e.category).map(e=>e.name);this.filters.type=n.join(),this.collection.fetch({reset:!0,data:b(this.filters)})}}};m.inject(g.getContent().querySelector(".iconbar-items-wrap"),"top"),new a(S).render().container.inject(g.getContent().querySelector(".iconbar-items-wrap"),"top"),c.shareAccessActions=o,c.emptyView={title:l.noMemberRetreived,icon:"search"};var y=s(c);return y.render(),p.container.setContent([g,y.elements.spinner,y.elements.scrollView]),p.container.classList.add("inode-access"),r.trackAction({model:u,eventAction:"membersTab"}),Object.assign(p,{destroy:function(){d.apply(p,arguments),p.container=null,p.stopListening(),p.model=null}})}}),define("DS/W3DSpaceApp/Models/MyCollabSpace",["UWA/Core","UWA/Class/Promise","UWA/Class/Model","DS/W3DSpaceApp/Metas/inode","DS/W3DContentApp/Models/Inode","DS/W3DSpaceApp/Utils/actionsFiltering","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Utils/RequestHelper","DS/W3DSpaceComponents/Utils/SecurityContext","DS/W3DDrive/widget","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a,o,r,l,c,u){"use strict";var p=i();function d(t,n){var i;return t&&(i=t[n],e.is(i,"function")&&(i=i.call(t))),i}return s.extend({idAttribute:"name",versions:[],extensionsAllowed:[".3dxml",".stpa",".step",".stp",".stpz",".ifc",".ifczip",".smg",".rvt",".rfa",".stl",".jpg",".jpeg",".png",".gif",".tif",".tiff",".bmp",".svg",".flv",".avi",".mov",".wmv",".mpg",".mpeg",".mp4",".m4v",".rm",".webm",".mkv",".mp3",".wav",".aac",".m4a",".wma",".ra",".ogg",".doc",".docx",".ppt",".pptx",".pps",".ppsx",".xls",".xlsx",".xlsm",".pdf",".zip",".txt",".csv",".json",".xml",".xd",".odt",".odp",".ods",".geojson",".mdb",".gml",".kml",".sdm",".omf",".str",".mineschedanimation"],extensionsAllowedThumbnail:[".jpg",".jpeg",".png",".gif",".tif",".tiff",".bmp",".svg"],setup:function(){return this._parent(arguments)},url:function(){var e="";if(this.isNew())return e;if(!this._auth)return e;var t=this._auth.platform;return t?e="{0}/resources/enocsmrest/collabspaces/{1}?embed=contexts&sort=amodified".format(t.url3DSpace,this.id):e},parse:function(e){var t,n;function i(e){if(e)return 1e3*parseInt(e,10)}for(t in e.id=e.name,n={name:e.name,id:e.id,parentId:p.ids.myCollabSpaces,mimeType:p.mimeType.collabSpace,title:e.title,contexts:e.contexts,thumbnailLink:function(e){var t,n;return t={},n=e.thumbnail?e.thumbnail:p.thumbnails.collabSpace,t.medium=n,t.small=n,t.large=n,t}(e),iconLink:"logo-3dspace",description:e.description,createdDate:i(e.created),modifiedDate:e.modified?i(e.modified):i(e.created),family:e.family,visibility:e.visibility,solution:e.solution,owner:"",contents:"",members:"",actions:e.actions,owners:e.owner?e.owner:void 0})n.hasOwnProperty(t)&&void 0===n[t]&&delete n[t];if(e.actions){var s=this.get("actions")||[],a=e.actions.length!==s.length;a||(a=s.some(function(t,n){e.actions[n]})),a&&this.dispatchEvent("onChange:actions",[this,n.actions])}return n},save:function(t,i,s){var a;if(s=Object.assign({},s,{}),e.is(t)&&"object"!==e.typeOf(t)?(a={})[t]=i:(a=t,s=i),!a)return this._parent(t,s);if("changeThumbnail"===t.action){var o=this.extensionsAllowedThumbnail,r=t.file.name.substring(t.file.name.lastIndexOf("."),t.file.name.length),l=RegExp(r,"i"),c=s.onFailure,u=o.some(function(e){return l.test(e)});if(0===r.length||!1===u)return c(new Error("Extension not supported, please try with an image"));(s=e.clone(s||{},!1)).file=t.file,s.type="json",this.set("thumbnailLink",{});var p=this,m=t.file.name,f=s.onComplete;return s.onComplete=function(t,i,s){e.extend(s,i),s.onComplete=function(e,t,i){i.onComplete=function(e,t,n){if(f)return f(e,t,n)};var s={actions:p.get("actions"),contents:p.get("contents"),contexts:p.get("contexts"),created:p.get("created"),description:p.get("description")?p.get("description"):"",family:p.get("family"),members:p.get("members"),name:p.get("name"),owner:p.get("owners"),solution:p.get("solution"),thumbnail:m,title:p.get("title"),visibility:p.get("visibility")};i.method="PUT",i.url=d(e,"url").split("?")[0]+"?receipt="+encodeURIComponent(t.receipt),i.data=JSON.stringify(s),i.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},n.prototype.save.call(p,s,i)},t.checkInThumbnailFile(s)},this.getTicket(e.extend({model:this},s))}return a={actions:this.get("actions"),contents:this.get("contents"),contexts:[],created:this.get("createdDate"),description:t.csAtrributes?t.csAtrributes.description:this.get("description"),family:t.csAtrributes?t.csAtrributes.family:this.get("family"),members:null,name:this.get("name"),owner:t.owner||this.get("owners"),solution:this.get("solution"),thumbnail:this.get("thumbnailLink").medium,title:t.csAtrributes?t.csAtrributes.title:this.get("title"),visibility:t.csAtrributes&&t.csAtrributes.hasOwnProperty("visibility")?{value:t.csAtrributes.visibility}:this.get("visibility")},s.method="PUT",s.url=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("id"),s.data=JSON.stringify(a),s.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},this._parent(this,s)},destroy:function(t){t=e.clone(t||{},!1);var n=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("id");return t=Object.assign({headers:{"Content-Type":"application/json"},url:n,timeout:8e4,method:"DELETE"},t),this._parent(t)},isCollabSpace:function(){return this.get("mimeType")===p.mimeType.collabSpace},enableDrop:function(){return!1},getDetailsUndeletedCS:function(e){var n="{0}/resources/enocsmrest/collabspaces/{1}/typesleft".format(e._auth.platform.url3DSpace,e.get("id"));return new t(function(e,t){r.performRequestWithOptions(n,{type:"json",onComplete:function(t){e(t.types)},onFailure:t})})},checkContent:function(){var e,n=this,i=encodeURIComponent(n.get("contexts")[0].name),s="{0}/resources/v1/application/CSRF".format(n._auth.platform.url3DSpace);return new t(function(t,n){r.performRequestWithOptions(s,{type:"json",onComplete:function(n){e=n.csrf.value,t(e)},onFailure:function(e){n(e)}})}).then(function(e){var s="{0}/resources/lifecycle/clean/cleananalyze".format(n._auth.platform.url3DSpace),a=JSON.stringify({data:[{csname:n.get("id")}]});return new t(function(t,n){r.performRequestWithOptions(s,{type:"json",method:"POST",headers:{ENO_CSRF_TOKEN:e,SecurityContext:"ctx::"+i,"Content-Type":"application/json"},timeout:5e4,data:a,onComplete:function(e){t(e)},onFailure:n,onTimeout:function(){var e=new Error("timeout");e.errorMessage=": Timeout",n(e)}})})})},cleanContent:function(e){var n,i=this,s=encodeURIComponent(i.get("contexts")[0].name),a="{0}/resources/v1/application/CSRF".format(i._auth.platform.url3DSpace);return new t(function(e,t){r.performRequestWithOptions(a,{type:"json",onComplete:function(t){n=t.csrf.value,e(n)},onFailure:t})}).then(function(n){var a="{0}/resources/lifecycle/clean/cleanmove".format(i._auth.platform.url3DSpace),o=JSON.stringify(e.body);return new t(function(e,t){r.performRequestWithOptions(a,{type:"json",method:"POST",headers:{ENO_CSRF_TOKEN:n,SecurityContext:"ctx::"+s,"Content-Type":"application/json"},data:o,timeout:5e4,onComplete:function(t){e(t)},onFailure:function(e){t(e)},onTimeout:function(){var e=new Error("timeout");e.errorMessage=": Timeout",t(e)}})})})},doesItHaveContent:function(){var e="{0}/resources/enocsmrest/collabspaces/{1}/contents".format(this._auth.platform.url3DSpace,this.get("id"));return new t(function(t,n){r.performRequestWithOptions(e,{data:"sort=amodified&page=0&limit=2",onComplete:function(e){t(e)},onFailure:n})})},getTicket:function(t){var n,i=this,s=d(this,"url").split("?")[0]+"/ticket?id="+Date.now();return t=t?e.clone(t,!1):{},n=t.onComplete,t.onComplete=function(e){if(n)return n(i,i.parseTicket(e),t)},r.performRequestWithOptions(s,e.extend(e.extend({type:"json"}),t,!0))},parseTicket:function(e){return{urlFCS:e.actionurl,ticket:{name:e.jobticket,value:e.ticket}}},checkInThumbnailFile:function(t){if(!(t=t?e.clone(t,!1):{}).urlFCS)throw new Error('A "url" must be specified');var n,i,s,a=this,o=t.urlFCS,r=t.onComplete;for(var l in t.onComplete=function(e){if(r)return r(a,a.parseThumbnailFileReceipt(e),t)},n=new FormData,i=this.getThumbnailFileForm(t))n.append(l,i[l]);return(s=new XMLHttpRequest).open("POST",o),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t.onComplete(s.responseText):t.onFailure&&t.onFailure(s.responseText))},s.send(n),s},parseThumbnailFileReceipt:function(t){return{receipt:e.createElement("div").setHTML(t).getElement('[name="__fcs__jobReceipt"]').value}},getThumbnailFileForm:function(t){var n={};return(t=t?e.clone(t,!1):{}).ticket&&t.ticket.name&&(n[t.ticket.name]=t.ticket.value),e.extend(n,{__fcs__jobTicket:t.ticket.value,"file-name":t&&t.file.name,file_0:t&&t.file,"file-title":t&&t.file.name,"file-description":t&&t.file.name}),n},getAnalyticsLastModified:function(e){e||(e={});var t=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics",n=e.modified;n&&(n="&modified="+n);var i=t+"?fields=lmpt,lastmodified,nbmodified"+n;return r.performRequestWithOptions(i,{type:"JSON",headers:{"Accept-Language":c.lang},onComplete:e.onComplete})},getAnalyticsContents:function(e){e||(e={});var t=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics"+"?fields=cpt,cpm,nbcontents";return r.performRequestWithOptions(t,{type:"JSON",headers:{"Accept-Language":c.lang},onComplete:e.onComplete})},getAnalyticsMembers:function(e){e||(e={});var t=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics"+"?fields=mpr,nbmembers";return r.performRequestWithOptions(t,{type:"JSON",headers:{"Accept-Language":c.lang},onComplete:e.onComplete})},securityContext:function(e){var t="{0}/resources/pno/person/setsecuritycontext".format(this._auth.platform.url3DSpace);r.performRequestWithOptions(t,{method:"POST",data:{SecurityContext:l.getPreferred(e)}})},getOwnerNames:function(){return this.get("owners")?this.get("owners").name:""},getActionIds:function(){return a.getCollabSpaceActions(this)},getPreview:function(t){t||(t={});var n=this,i=d(this,"url").split("?")[0]+"/preview",s=t.onComplete;t.onComplete=function(e){if(n.set("thumbnail",e.thumbnail),s)return s(n,e,t)},r.performRequestWithOptions(i,e.extend({type:"json"},e.extend(t,!0)))},isActionIdoK:function(e){return e===p.actionPubIds.share?this._parent("giveEditAccess")||this._parent("giveReadAccess"):e===p.actionPubIds.addMember?this._parent("Contributor")||this._parent("Author")||this._parent("Leader")||this._parent("Reader")||this._parent("PublicReader"):e===p.actionPubIds.addMemberRestricted?!this._parent("Contributor")&&(this._parent("Contributorrestricted")||this._parent("Authorrestricted")||this._parent("Leaderrestricted")||this._parent("Readerrestricted")):this._parent(e)},"onChange:id":function(e,n,i){var s,a,l=this;i.add||this.get("parentId")&&(a=this,new t(function(e,t){var n;try{"/"!==(n=o.result(a,"url"))[n.length-1]&&(n+="/"),n+="preview",r.performRequestWithOptions(n,{type:"json",onComplete:e,onFailure:t})}catch(e){t(e)}})).then(function(e){s=function(e){var t={};return t.medium=e,t.small=e,t.large=e,t}(e.thumbnail),l.set("thumbnailLink",s)})},getNLSType:function(){return u.collaborativeSpace}})}),define("DS/W3DSpaceApp/Models/MyCollabSpacesRoot",["DS/W3DSpaceApp/Metas/inode","DS/W3DContentApp/Models/Inode","DS/W3DContentApp/Models/Stub","DS/W3DSpaceApp/Utils/actionsFiltering","DS/W3DContentApp/BusEvent","i18n!DS/W3DSpaceApp/assets/nls/W3DSpaceApp"],function(e,t,n,i,s,a){"use strict";var o=e();return t.extend(n,{defaults:{parentId:o.ids.trueRoot,title:a.myCollabSpaces,mimeType:o.mimeType.folder,iconLink:"logo-3dspace",thumbnailLink:{small:o.thumbnails.collabSpace,medium:o.thumbnails.collabSpace,large:o.thumbnails.collabSpace}},setup:function(){const e=this;this.listenTo(s,{setSessionAvailable:function(t){e.set({isInnovation:t.isInnovation,isAdmin:t.isAdmin,actions:t.actions})}})},getActionIds:function(){var e=this.isFolder();return i[e?"getCollabSpaceActions":"getContentActions"](this)},getNLSType:function(){return""},doesExistInBackend:function(){return new Promise(function(e){e(!0)})},isFolder:function(){return!0}})}),define("DS/W3DSpaceApp/Collections/MyCollabSpaces",["UWA/Core","DS/W3DContentApp/Collections/Inodes","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession","DS/W3DSpaceApp/Models/MyCollabSpace","DS/W3DDrive/widget","DS/W3DContentApp/Utils/RequestHelper"],function(e,t,n,i,s,a){"use strict";return t.extend({model:i,thumbnailsRetrieved:!1,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0},queryFilter:null,queryReset:!1,resetState:function(){this.state={firstPage:0,currentPage:0,pageSize:20,lastPage:0}},updateState:function(e){this.state=Object.assign({},this.state,e)},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"csTotal"},url:function(){var e=this._auth.platform.url3DSpace;return"{0}/resources/enocsmrest/collabspaces".format(e)},parseResponseForStateUpdate:function(e){return{totalRecords:e.csTotal,lastPage:e.nbPages>0?e.nbPages-1:0}},parseRecords:function(e){return e.items},parse:function(e,t){this.thumbnailsRetrieved=!1;var n=this.parseResponseForStateUpdate(e,Object.assign({},this.queryParams),Object.assign({},this.state),t);return n&&this.updateState(n),this.parseRecords(e,t)},setup:function(e,t){t&&(this._auth=t.auth),s&&this.listenTo(s,{onSearch:this.onSearchFilter,onResetSearch:this.onResetSearchFilter})},sort:function(e){if((e=e||{}).sorting&&e.sorting.id!==this._sorting.id)return this._sorting=e.sorting,this.getFirstPage({reset:!0})},onSearch:function(e){this.queryFilter=e||null;var t,n={reset:!0,type:"json",evnt:"OnSearch",setState:{firstPage:0,currentPage:0,pageSize:20,lastPage:0}};t=n.onComplete,n.onComplete=function(){t&&t(arguments)},this.fetch(n)},onResetSearchFilter:function(){this.queryFilter=null,this.queryReset=!0},onSearchFilter:function(e){this.queryFilter=e,this.queryReset=!0},create:function(t,n){var i;return n=e.clone(n||{},!1),t.csAtrributes.title&&(i={actions:[],contents:null,contexts:[],description:t.csAtrributes.description,family:{value:t.csAtrributes.family},members:null,owner:{},solution:"",thumbnail:"",title:t.csAtrributes.title,visibility:{value:t.csAtrributes.visibility}},n.method="POST",n.url=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces"),n.data=JSON.stringify(i),n.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},this._parent(t,n)},fetch:function(t){!0!==t.queryReset&&!0!==this.queryReset||(t.reset=!0,this.resetState(),this.queryReset=!1);var n=Object.assign({},this.state),i=this,a=Object.keys(this.queryParams).reduce(function(e,t){var s=i.queryParams[t],a=n[t];return s="function"==typeof s?s.call(i):s,a="function"==typeof a?a.call(i):a,null!==s&&null!==a&&(e[s]=a),e},{});t.data=Object.assign({},t.data,a),e.extend(t,!0),t.data||(t.data={}),this.queryFilter&&(t.data.filter=this.queryFilter),t.data.embed="contexts",t.data.sort=this.getCurrentSorting(),t.headers={"Accept-Language":s.lang},t.data.fields||(t.data.fields="actions,contexts,created,description,family,owner,solution,visibility,title,modified"),this._parent.apply(this,arguments)},getPreviews:function(t){if(!this.isEmpty()){t||(t={});var n=this,i=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/previews",s=t.onComplete;t.onComplete=function(e){var i,a,o;if(Array.isArray(e)&&e.forEach(function(e){(i=n.get(e.id))&&(a=null===e.thumbnail?i.get("thumbnailLink").small:e.thumbnail,o=function(e){var t={};return t.medium=e,t.small=e,t.large=e,t}(a),i.set("thumbnailLink",o))}),s)return s(n,e,t)},a.performRequestWithOptions(i,e.extend(t,{type:"json",data:{ids:this.pluck(this.model.prototype.idAttribute).reduce(function(e,t){return e+","+t})}}))}},shareChildren:function(e,t){var i=this,s=e.reduce(function(e,n){if(!i.contains(n))return e;var s=n.permissions;return t.map(function(e){var t=s.findWhere({emailAddress:e.emailAddress});return t?function(){return new Promise(function(i,s){t.save({role:e.role},{patch:!1,onComplete:function(e){i({inode:n,permission:e})},onFailure:function(e){s({inode:n,permission:e})}})})}:function(){return new Promise(function(t,i){s.create(e,{wait:!0,onComplete:function(e){t({inode:n,permission:e})},onFailure:function(e){s.remove(e),i({inode:n,permission:e})}})})}}).concat(e)},[]);return n(s)},getCurrentSorting:function(){var e,t=s.getValue("inodesSorting")?s.getValue("inodesSorting"):{id:"modifiedDate-a"};return"title-a"===t.id?e="atitle":"title-d"===t.id?e="dtitle":"modifiedDate-a"===t.id?e="amodified":"modifiedDate-d"===t.id?e="dmodified":"createdDate-a"===t.id?e="acreated":"createdDate-d"===t.id&&(e="dcreated"),e},onReset:function(){this.thumbnailsRetrieved=!0,this.getPreviews()},onChange:function(){this.thumbnailsRetrieved||(this.thumbnailsRetrieved=!0,this.getPreviews())}})}),define("DS/W3DSpaceApp/Collections/ContentVersions",["UWA/Core","DS/W3DContentApp/Collections/AuthCollection","DS/W3DSpaceApp/Models/ContentVersion"],function(e,t,n){"use strict";return t.extend({model:n,id:"",parentId:"",parentCS:"",init:function(e,t){var n=(t=t||{}).parentInode;if(!n)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._inode=t.inode,this._parent.apply(this,arguments)},url:function(){return!this._auth&&this._parentInode._auth&&(this._auth=this._parentInode._auth),this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this._inode.get("parentId")+"/contents/"+this._inode.get("id")+"/versions"},fetch:function(e){return e=e||{},this._parent(e)},sync:function(e,t,n){return this._parent(e,t,n)},parse:function(e){return this.dispatchEvent("onUpdate"),e.reverse()}})}),define("DS/W3DSpaceApp/Models/MyCollabSpaceContent",["UWA/Core","UWA/String","UWA/Class/Promise","DS/W3DContentApp/Models/Inode","DS/W3DSpaceApp/Utils/actionsFiltering","DS/W3DSpaceApp/Collections/ContentVersions","DS/W3DContentApp/Utils/RequestHelper","DS/W3DSpaceComponents/Utils/SecurityContext"],function(e,t,n,i,s,a,o,r){"use strict";function l(e){return new n(function(t,n){var i;try{e.id&&(i=e._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+e.get("parentId")+"/contents/"+e.id+"/preview",setTimeout(function(){o.performRequestWithOptions(i,{type:"json",onComplete:t,onFailure:n})},7e3))}catch(e){n(e)}})}function c(e){return[function(e){return e.actionurl}(e),function(e){return e.jobticket}(e),function(e){return e.ticket}(e)]}function u(t){return e.createElement("div").setHTML(t).getElement('[name="__fcs__jobReceipt"]').value}function p(e,t,i,s){var a,o=s.substring(s.lastIndexOf("."),s.split("."));return a=Object.assign({actions:[],businessobj:{description:"",file:s,fullnameowner:"",icon:"",maturity:"",modified:"",owner:{},thumbnail:"",title:o,type:{}},collabspace:e.collabspace}),n.cast([a,t,i])}return i.extend({idAttribute:"id",setup:function(){var e=this.collection?this.collection._parentInode:this.get("parentId");return this.inodeVersions=new a([],{parentInode:e,inode:this,auth:this._auth}),this._parent.apply(this,arguments)},parse:function(e){var t,n,i,s,a,o;function r(e){if(e)return 1e3*parseInt(e,10)}function l(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}for(t in n={id:e.id,parentId:e.collabspace,title:e.businessobj?l(e.businessobj.title):void 0,name:e.businessobj?l(e.businessobj.name):void 0,createdDate:e.businessobj?r(e.businessobj.created):void 0,type:e.businessobj?e.businessobj.type:void 0,modifiedDate:e.businessobj?r(e.businessobj.modified):void 0,thumbnailLink:e.businessobj?(a=e.businessobj.thumbnail,o={},o.medium=a,o.small=a,o.large=a,o):void 0,iconLink:e.businessobj?e.businessobj.icon:void 0,description:e.businessobj?e.businessobj.description.replace(/&amp;/g,"&"):void 0,family:{},owners:e.businessobj?function(e){var t;return e&&(t=e.fullnameowner),t?[{displayName:t}]:void 0}(e.businessobj):void 0,downloadUrl:"",fullnameowner:e.businessobj?e.businessobj.fullnameowner:void 0,maturity:e.businessobj?e.businessobj.maturity:void 0,version:e.businessobj?e.businessobj.version:void 0,actions:e.actions,taxonomies:e.businessobj?(i=e.businessobj.taxonomies,s=[],i&&i.map(function(e){"types"===e.split("/")[0].toLowerCase()?s.push(e.split("/")[1]):s.push(e)}),s):void 0,icon:e.businessobj?e.businessobj.icon:void 0})n.hasOwnProperty(t)&&void 0===n[t]&&delete n[t];return n},getDownloadUrl:function(){var e=this,t="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/download".format(this._auth.platform.url3DSpace,this.get("parentId"),this.get("id"));return new n(function(n,i){o.performRequestWithOptions(t,{type:"json",onComplete:function(t){var i=t?t.url:null;e.set("downloadUrl",i),n({url:i,method:"POST"})},onFailure:i})})},getOwnerNames:function(){return this.get("owners")[0]?this.get("owners")[0].displayName:""},getFileUrl:function(){var e=this,t="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/fileurl".format(this._auth.platform.url3DSpace,this.get("parentId"),this.get("id"));return new n(function(n,i){o.performRequestWithOptions(t,{type:"json",onComplete:function(t){var i=t?t.url:null,s=t?t.extension:null;e.set("fileUrl",i),e.set("fileExtension",s),n(i)},onFailure:i})})},sync:function(e,t,i){if("create"!==e)return this._parent(e,t,i);var s,a,r=this,l=this.collection._auth.getStorage(),d=i.file||{},m=function(e,t,n){var i;return i=Object.assign({data:{},headers:{"Content-Type":"application/json;charset=utf-8"}},t),[{title:e.title,duplicatedfrom:e.duplicatedfrom,collabspace:n.get("parentId")},i]}(function(e,t){var n,i,s,a={};return e&&(e.parentId&&(n=e.parentId),e.description&&(i=e.description),e.title&&(s=e.title),e.parentId&&e.parentId),n&&(a.parents=[{id:n}]),i&&(a.description=i||""),s&&(a.title=s),t&&(a.uploadType="media"),a}(t._attributes||t.toJSON(),t.isNew()),i,t),f=t._parent.bind(t),h=i.onFailure,g=[];this.collection&&this.collection._parentInode&&(g=this.collection._parentInode.extensionsAllowed||[]);var b=d.name.substring(d.name.lastIndexOf("."),d.name.length),v=RegExp(b,"i"),S=g.some(function(e){return v.test(e)});if(0===b.length||!1===S)return h(new Error("Extension not supported"));a="update"===i.action?"{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/versions".format(t._auth.platform.url3DSpace,t.get("parentId"),t.get("id")):"{0}/resources/enocsmrest/collabspaces/{1}/contents".format(t._auth.platform.url3DSpace,t.get("parentId")),i.headers=i.headers||{},i.headers["Content-Type"]="application/json;charset=UTF-8",s=function(e,t){return new n(function(n,i){var s;s="{0}/resources/enocsmrest/collabspaces/{1}/ticket?id={2}".format(t.url3DSpace,e.get("parentId"),window.Date.now()),o.performRequestWithOptions(s,{method:"GET",type:"json",onComplete:function(e){n(e)},onFailure:i})})}.call(t,t,l).then(c).spread(function(e,t,i){return function(e,t,i,s,a){var o,r,l;return o=new window.FormData,(r={})[t]=i,r["file-name"]=s.name,r.file_0=s,r["file-title"]=s.name,r["file-description"]=s.name,Object.keys(r).map(function(e){o.append(e,r[e])}),(l=new window.XMLHttpRequest).open("POST",e,!0),new n(function(e,t){l.onload=function(){this.status>=200&&this.status<400?e(this.response):t("file upload in FCS failed")},l.onerror=function(){t()},l.upload.onprogress=a.dispatchAsEventListener("onProgress"),l.send(o)})}(e,t,i,d,r)}).then(u),n.all(m.concat(s).concat(d.name)).spread(p).spread(function(n,s,o){return"update"===i.action?i.data={title:n.businessobj.file,file:n.businessobj.file,modified:n.businessobj.modified,filedescription:n.businessobj.description,download:"",preview:"",index:"",physicalid:"",versionnumbers:"",actions:["download"]}:(i.data=s||{},i.data=n),i.type="json",i.data=JSON.stringify(i.data),i.url=a+"?receipt="+encodeURIComponent(o),f(e,t,i)}).catch(function(e){h(e)})},destroy:function(t){return t=e.clone(t||{},!1),this.get("type"),this._parent(t)},save:function(t,n,i){var s,a="";return i=Object.assign({},i),e.is(t)&&"object"!==e.typeOf(t)?(s={})[t]=n:(s=t,i=n),s?(s.parentid&&(a=this._auth.platform.url3DSpace+"/resources/restmove/collabspaces/"+this.get("parentId")+"/moveable/"+this.get("id"),o.performRequestWithOptions(a,{method:"PUT",data:JSON.stringify({collabspace:t.parentid}),headers:{"Content-type":"application/json"},onComplete:i.onComplete,onFailure:i.onFailure})),"editContent"===t.action?(a=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("parentId")+"/contents/"+this.id,this._parent(this,Object.assign({},i,{url:a,type:"json",method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8"},data:JSON.stringify({actions:this.get("actions"),businessobj:{created:this.get("createdDate"),description:t.attributes.description,fullnameowner:this.get("fullnameowner"),icon:this.get("iconLink"),maturity:this.get("maturity"),modified:this.get("modified"),owner:this.owner,physicalid:this.id,thumbnail:this.get("thumbnail"),title:t.attributes.title,type:this.get("type"),version:this.get("version")},collabspace:t.inode.get("parentId"),id:t.inode.id})}))):void 0):this._parent(s,i)},getActionIds:function(){return s.getContentActions(this)},"onChange:id":function(e,t,n){var i=this;n&&void 0===n.from&&l(this).then(function(e){e.thumbnail&&i.set("thumbnailLink",{medium:e.thumbnail})})},"onChange:thumbnail":function(){var e=this;l(this).then(function(t){t.thumbnail&&e.set("thumbnailLink",{medium:t.thumbnail})})},getNLSType:function(){return this.get("type").name},get3DPlayOptions:function(){return{asset:{provider:"EV6",physicalid:this.id,dtype:this.get("type")?this.get("type").value:null,tenant:this._auth.platformId,serverurl:this._auth.platform.url3DSpace,requiredAuth:"passport",contextId:r.getNominalContext(this.collection&&this.collection._parentInode)}}},isPlayable:function(){return!1},enableDrop:function(){return!1},getDragDataType:function(){return null},getDropDataType:function(){return null},doesExistInBackend:function(){var e=this;return new n(function(t){e.sync("GET",e,{onComplete:function(n){n.businessobj&&(n.businessobj.contexts||n.businessobj.maturity)?t(!0):(t(!1),e.destroy({noSync:!0}))},onFailure:function(){t(!1),e.destroy({noSync:!0})}})})},uploadFileToSwym:function(e){var i=t.format("{0}/resources/enocsmrest/publish/swym/createMedia",this._auth.platform.url3DSpace),s=this.get("id"),a=this._auth.platform.url3DSpace;return new n(function(t,n){o.performRequestWithOptions(i,{url:i,auth:a,timeout:3e5,method:"POST",data:JSON.stringify({tenantid:e.platformId,communityid:e.threadId,contenttype:e.content_type,isDownloadable:"true",objectid:s}),type:"json",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},proxy:"passport",onComplete:function(e){t(e)},onTimeout:function(){var e=new Error("timeout");e.name="timeout",n(e)},onFailure:function(e,t){var i=new Error;i.name="error",i.message=t,n(i)}})})}})}),define("DS/W3DSpaceApp/Models/InodeFactory",["DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/MyCollabSpacesRoot","DS/W3DSpaceApp/Models/MyCollabSpace","DS/W3DSpaceApp/Models/MyCollabSpaceContent"],function(e,t,n,i){"use strict";var s=e(),a={};a[s.ids.myCollabSpaces]=t;var o="id";function r(e,t){e.name||(e.name=e.id);var r=a[e[o]];return e.mimeType===s.boType.collabSpace&&(r=n),e[o]===s.ids.trueRoot&&(r=n),r||(r=i),new r(e,t)}return r.prototype.idAttribute=o,r}),define("DS/W3DSpaceApp/Collections/MyCollabSpaceContents",["UWA/Core","UWA/String","UWA/Class/Promise","DS/W3DContentApp/Collections/Inodes","DS/W3DSpaceApp/Models/MyCollabSpaceContent","DS/W3DContentApp/Utils/scheduleTasksToGlobalSession","DS/W3DContentApp/Utils/RequestHelper","DS/W3DDrive/widget","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/W3DContentApp/Utils/Tagger6WProxy"],function(e,t,n,i,s,a,o,r,l,c){"use strict";return i.extend({shouldFetch:!0,model:s,state:{firstPage:0,currentPage:0,pageSize:25,lastPage:0},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal"},filterTagObj:null,isNewFilter:!1,queryFilter:null,resetState:function(){this.state={firstPage:0,currentPage:0,pageSize:25,lastPage:0}},updateState:function(e){this.state=Object.assign({},this.state,e)},url:function(){return t.format("{0}/resources/enocsmrest/collabspaces/{1}/contents",this._auth.platform.url3DSpace,this._parentInode.id)},setup:function(e,t){t&&(this._auth=t.auth),r&&this.listenTo(r,{onSearch:this.onSearchFilter,onResetSearch:this.onResetSearchFilter})},sort:function(e){if((e=e||{}).sorting&&e.sorting.id!==this._sorting.id)return this._sorting=e.sorting,this.getFirstPage({reset:!0})},getNLSValues:function(e,t){var i=[],s=[],a={"ds6w:type":{},"ds6w:status":{}},o=e.subjectsTags,c=e.tagValues;for(const e in o)for(var u=o[e],p=0;p<u.length;p++){var d=u[p].sixw;"ds6w:what/ds6w:status"===d&&s.push(u[p].object),"ds6w:what/ds6w:type"===d&&i.push(u[p].object)}s=s.filter((e,t,n)=>n.indexOf(e)===t),i=i.filter((e,t,n)=>n.indexOf(e)===t),a["ds6w:status"]=s,a["ds6w:type"]=i;let m=function(e,t){for(const n in e)e.hasOwnProperty(n)&&n===t.object&&(t.dispValue=e[n])};return new n(function(n,i){l.getNlsOfPropertiesValues(JSON.stringify(Object.assign({},a)),{tenantId:t._auth.platformId,lang:r.lang,onComplete:function(t){let i=t["ds6w:type"],s=t["ds6w:status"];for(const e in o)for(var a=o[e],r=0;r<a.length;r++){var l=a[r].sixw;"ds6w:what/ds6w:status"===l&&m(s,a[r]),"ds6w:what/ds6w:type"===l&&m(i,a[r])}for(var u=0;u<c.length;u++){var p=c[u].sixw;"ds6w:what/ds6w:status"===p&&m(s,c[u]),"ds6w:what/ds6w:type"===p&&m(i,c[u])}n(e)},onFailure:function(e){i(e)}})})},getNLSValues2:function(e,t){for(var i=e.items,s=[],a=[],o={"ds6w:type":{},"ds6w:status":{}},c=0;c<i.length;c++)s.push(i[c].businessobj.type.value),a.push(i[c].businessobj.maturity.value);a=a.filter((e,t,n)=>n.indexOf(e)===t),s=s.filter((e,t,n)=>n.indexOf(e)===t),o["ds6w:status"]=a,o["ds6w:type"]=s;let u=function(e,t,n,i){for(const s in e)e.hasOwnProperty(s)&&s===t&&("maturity"===i?n.maturity.name=e[s]:n.type.name=e[s])};return new n(function(e,n){l.getNlsOfPropertiesValues(JSON.stringify(Object.assign({},o)),{tenantId:t._auth.platformId,lang:r.lang,onComplete:function(t){let n=t["ds6w:type"],s=t["ds6w:status"];for(const e in i){var a=i[e].businessobj;u(s,a.maturity.value,a,"maturity"),u(n,a.type.value,a,"type")}e(i)},onFailure:function(e){n(e)}})})},fetch:function(t){var n,i,s,a,o=this;(t=t||{}).setState&&(this.state=t.setState),t.data||(t.data={}),t.data.fields||(t.data.sort=this.getCurrentSorting()),(n=Object.assign({},t)).headers={"Accept-Language":r.lang},a=Object.assign({},this.state);var l=Object.keys(this.queryParams).reduce(function(e,t){var n=o.queryParams[t],i=a[t];return n="function"==typeof n?n.call(o):n,i="function"==typeof i?i.call(o):i,null!=n&&null!=i&&(e[n]=i),e},{});return n.data=Object.assign({},t.data,l),this.shouldFetch?(!0===this.queryReset&&(n.reset=!0,this.resetState(),this.queryReset=!1),t.queryReset&&(n.remove=!1),(t.evnt||this.filterTagObj)&&((i=this.filterTagObj)&&(s={tags:JSON.stringify(i)},n.data=n.data?e.extend(s,n.data):s),n.onComplete=function(e,n){var i=o.parseTags(n);"en"!==r.lang?o.getNLSValues(i,o).then(function(){!0===t.reset?c._currentTagger.setTags(i.subjectsTags,i.tagValues):c._currentTagger.addSubjects(i.subjectsTags)}):!0===t.reset?c._currentTagger.setTags(i.subjectsTags,i.tagValues):c._currentTagger.addSubjects(i.subjectsTags),o.isNewFilter=!1}),this.queryFilter&&(n.data.q=this.queryFilter),t.withThumbnails&&(n.onComplete=function(e,n){var i=o.parseTags(n);"en"!==r.lang?o.getNLSValues(i,o).then(function(){c._currentTagger.setTags(i.subjectsTags,i.tagValues)}):c._currentTagger.setTags(i.subjectsTags,i.tagValues),o.isNewFilter=!1,"function"==typeof t.onComplete&&t.onComplete(e,n,t)}),this._parent.call(this,n)):("function"==typeof t.onComplete&&t.onComplete(this,this.toJSON(),t),void this.dispatchEvent("onSync",[this,this.toJSON(),t]))},parseTags:function(e){return{tagValues:e.tagValues,subjectsTags:e.subjectsTags}},onSearch:function(e){this.queryFilter=e||null;var t,n={reset:!0,type:"json",evnt:"OnSearch",setState:{firstPage:0,currentPage:0,pageSize:25,lastPage:0}};t=n.onComplete,n.onComplete=function(){t&&t(arguments)},this.fetch(n)},onResetSearchFilter:function(){this.queryFilter=null,this.queryReset=!0},onSearchFilter:function(e){this.queryFilter=e,this.queryReset=!0},parseResponseForStateUpdate:function(e,t,n,i){return{totalRecords:e.contentTotal,lastPage:e.nbPages>0?e.nbPages-1:0}},parseRecords:function(e){return e.items},parse:function(e,t){"en"!==r.lang&&n.all([this.getNLSValues2(e,this)]).then(function(t){e.items=t}),console.log(e);var i=this.parseResponseForStateUpdate(e,Object.assign({},this.queryParams),Object.assign({},this.state),t);return i&&this.updateState(i),this.parseRecords(e,t)},getCurrentSorting:function(){var e,t=r.getValue("inodesSorting")?r.getValue("inodesSorting"):{id:"modifiedDate-a"};return"title-a"===t.id?e="atitle":"title-d"===t.id?e="dtitle":"modifiedDate-a"===t.id?e="amodified":"modifiedDate-d"===t.id?e="dmodified":"createdDate-a"===t.id?e="acreated":"createdDate-d"===t.id&&(e="dcreated"),e}})}),define("DS/W3DSpaceApp/Collections/CSMembers",["UWA/String","DS/W3DContentApp/Collections/AuthCollection","DS/W3DSpaceApp/Models/CSMember","DS/W3DContentApp/Collections/Pagination"],function(e,t,n,i){"use strict";var s=t.extend({model:n,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0,type:"",role:"",title:""},queryParams:{currentPage:"page",pageSize:"limit"},url:function(){return e.format("{0}/resources/enocsmrest/collabspaces/{1}/allmembers",this._auth.getStorage().url3DSpace,this._parentInode.get("id"))},init:function(e,t){var n=(t=t||{}).parentInode;if(!n||!n.id)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._parent.apply(this,arguments)},fetch:function(e){(e.firstLoad||e.reset)&&(this.state.currentPage=0,this.state.firstPage=0,this.state.pageSize=20,this.state.lastPage=0,this.state.type="",this.state.role="",this.state.title=""),e.data&&(e.data.type||e.data.role||e.data.title)&&(this.state.type=e.data.type,this.state.role=e.data.role,this.state.title=e.data.title),e.data==={}&&(this.state.type="",this.state.role="",this.state.title="");var t=Object.assign({},this.state),n=this,i=Object.keys(this.queryParams).reduce(function(e,i){var s=n.queryParams[i],a=t[i];return s="function"==typeof s?s.call(n):s,a="function"==typeof a?a.call(n):a,null!=s&&null!=a&&(e[s]=a),e},{});(t.role||t.type||t.title)&&void 0===e.data&&(e.data={}),t.role&&e.data&&void 0===e.data.role&&(e.data=Object.assign(e.data,{role:this.state.role})),t.type&&e.data&&void 0===e.data.type&&(e.data=Object.assign(e.data,{type:this.state.type})),t.title&&e.data&&void 0===e.data.title&&(e.data=Object.assign(e.data,{title:this.state.title})),e.data=Object.assign({withactions:!0,sort:"atitle"},e.data,i),"refresh"!==e.from&&"myCollabSpaces"!==e.inode&&this._parent.apply(this,arguments)},parse:function(e){return this.updateState({totalRecords:e.total,lastPage:e.nbPages>0?e.nbPages-1:0}),e.items},create:function(t,n){n.url=e.format("{0}/resources/enocsmrest/collabspaces/{1}/allmembers/batch",this._auth.getStorage().url3DSpace,this._parentInode.get("id"));var i=Object.assign({data:t},n);return this._parent(this,i)},updateState:function(e){this.state=Object.assign({},this.state,e)}});return s=i(s)}),define("DS/W3DSpaceApp/Collections/RootInodes",["DS/W3DContentApp/Collections/Inodes","DS/W3DContentApp/Collections/Stub","DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/InodeFactory"],function(e,t,n,i){"use strict";n=n();return e.extend(t,{init:function(e,t){t=t||{};var i=[];i.push(n.ids.myCollabSpaces);var s=this.model.prototype.idAttribute;return this._parent(i.map(function(e){var t={};return t[s]=e,t}).map(function(t){var n,i;for(i=0;!n&&i<e.length;i++)e[i].id===t.id&&(n=e[i]);return n||t}),t)},model:i})}),define("DS/W3DSpaceApp/Models/InodeFactoryCS",["DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/MyCollabSpacesRoot","DS/W3DSpaceApp/Models/MyCollabSpace"],function(e,t,n){"use strict";var i=e(),s={};s[i.ids.myCollabSpaces]=t;var a="id";function o(e,t){e.name||(e.name=e.id);var i=s[e[a]];return i||(i=n),new i(e,t)}return o.prototype.idAttribute=a,o}),define("DS/W3DSpaceApp/Collections/InodesFactory",["DS/W3DSpaceApp/Collections/RootInodes","DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Models/InodeFactory","DS/W3DSpaceApp/Collections/MyCollabSpaces","DS/W3DSpaceApp/Collections/MyCollabSpaceContents"],function(e,t,n,i,s){"use strict";var a=t(),o={};function r(e,t){var n=t.parentInode;if(n){var r=n.id,l=o[r];return n.get("parentId")===a.ids.trueRoot&&(l=i),!n.get("parentId")&&n.isCollabSpace()&&(l=s),l||(l=s),new l(e,t)}}return o[a.ids.trueRoot]=e,r.prototype.model=n,r}),define("DS/W3DSpaceApp/Collections/InodesFactoryCS",["DS/W3DSpaceApp/Metas/inode","DS/W3DSpaceApp/Collections/MyCollabSpaces","DS/W3DSpaceApp/Models/InodeFactoryCS"],function(e,t,n){"use strict";var i=e(),s={};function a(e,n){var a=n.parentInode;if(a){var o=a.id,r=s[o];return a.get("parentId")===i.ids.trueRoot&&(r=t),r||(r=t),new r(e,n)}}return s[i.ids.myCollabSpaces]=t,a.prototype.model=n,a}),define("DS/W3DSpaceApp/Models/Drive",["DS/W3DContentApp/Models/DriveAbstract","DS/W3DSpaceApp/Collections/InodesFactory","DS/W3DSpaceApp/Collections/InodesFactoryCS","DS/W3DSpaceApp/Collections/CSMembers","DS/W3DContentApp/BusEvent"],function(e,t,n,i,s){"use strict";return e.extend({_Inodes:t,_Contents:n,isDsDrive:!1,isCollabSpace:!0,_Permissions:i,isActionIdoK:function(){return!1},url:function(){var e=this.get("auth").platform.url3DSpace;if(e)return"{0}/resources/enocsmrest/session".format(e);console.log("3DSpace url is not returned! the url can't be defined")},init:function(e){return this._parent(e)},fetch:function(e){return this._parent(e)},parse:function(e){return s.dispatchEvent("setSessionAvailable",{isInnovation:e.isinnovation,isAdmin:e.isadmin,actions:e.actions}),{id:e.id,name:e.id,auth:e.auth,granted:e.granted,authenticated:e.authenticated,actions:e.actions,isAdmin:e.isadmin,isInnovation:e.isinnovation,availableRoles:e.availableRoles}},getMeta:function(){return this.get("auth").platform.displayName}})});