define("DS/CAT3DWChooser/CAT3DWLoadServices",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(e){t.prototype._onOpenFile=null,this._inputId="CAT3DWChooser-fileinput",document.getElementById(this._inputId)||this.createInputFile(),this._acceptAttributes="image/*",e&&e.acceptAttributes&&(this._acceptAttributes=e.acceptAttributes)},createInputFile:function(){var e=document.getElementsByClassName(this._inputId+"-class");if(e)for(var t=0;t<e.length;t++)e[t].parentElement.remove();new UWA.Element("div",{html:[{tag:"input",id:this._inputId,class:this._inputId+"-class",type:"file",styles:{visibility:"hidden",position:"absolute",left:"0px",top:"0px"},events:{change:this.openFile.bind(this)}}]}).inject(document.body)},openFileSelector:function(e){var i=document.getElementById(this._inputId);i.setAttribute("accept",this._acceptAttributes),t.prototype._onOpenFile=e,i.value=null,i.click()},openFile:function(e){if(e){var i=e.target.files;if(i&&i.length){var n=window.URL.createObjectURL(i[0]);t.prototype._onOpenFile(n,i[0])}else t.prototype._onOpenFile(null)}}});return t}),define("DS/CAT3DWChooser/CAT3DWChooseThread",["UWA/Class","UWA/Core","DS/UIKIT/Form","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/UIKIT/Spinner","UWA/Utils/Client","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/RTConvAPI/RTConvAPI","DS/PlatformAPI/PlatformAPI","i18n!DS/CAT3DWChooser/assets/nls/CAT3DSKChooseThread","css!DS/CAT3DWChooser/CAT3DWChooser"],function(e,t,i,n,s,o,a,r,l,c,h,d,u){"use strict";var m=e.extend({init:function(e){this._platformId=e.platformId,this._platformUrl=e.platformUrl,this._platformId||this._platformUrl||console.warn("[CAT3DWChooseThread] A platformId or a platformUrl must be provided"),this._appMode=a.getPreferenceValue("appMode"),this._formName="thread-form",this._threadConversation="dm",this._threadCommunity="community",this._defaultThreadType=this._threadCommunity,this._communitiesLimit=50,this._chooseThreadModal=null},_getPlateformData:function(){return this._platformUrl&&this._csrfToken&&this._currentUser?new Promise(function(e){e()}):new Promise(function(e){o.get3DSwym(this._platformId).then(o.getCsrfToken).then(function(t){this._platformUrl=t.url,this._csrfToken=t.token,o.getCurrentUser({url:this._platformUrl,token:this._csrfToken}).then(function(t){this._currentUser=t,e()}.bind(this)).catch(function(t){console.log(t),e()})}.bind(this)).catch(function(t){console.log(t),e()})}.bind(this))},selectThread:function(e){return new Promise(async function(t,i){this._createModal(e);var n=this._getLoadingBody();this._chooseThreadModal.setBody(n),this._chooseThreadModal.show(),this._chooseThreadModal.resolveCB=t,this._chooseThreadModal.rejectCB=i,await this._getPlateformData(),this._communities=[],this._conversations=[],this._communityPage=1,this._lastCommunityPage=1,this._conversations=await this._getConversations(),this._communities=await this._getCommunities(this._communityPage),this._communities.length===this._communitiesLimit&&this._lastCommunityPage++;var s=this._getBody({type:this._defaultThreadType,conversations:this._conversations,communities:this._communities});this._chooseThreadModal.setBody(s),this._chooseThreadModal.show(),a.getPreferenceValue("ODTMode")&&this._isReady()}.bind(this))},_isReady:function(){},_createModal:function(e){var t;this._chooseThreadModal&&this._deleteModal(),t="whiteboard"===this._appMode?a.getPreferenceValue("creative")?u.get("modalTitleCreative"):u.get("modalTitleWhiteboard"):u.get("modalTitleSketch"),this._chooseThreadModal=new n({className:"choose-thread-modal",closable:e,header:"<h4>"+t+"</h4>",escapeToClose:!1,footer:'<button type="submit" form="'+this._formName+'" class="btn btn-primary submit-thread-btn">'+u.get("submitBtnLabel")+"</button>"}).inject(document.body),this._chooseThreadModal.onHide=this._onHide.bind(this),this._chooseThreadModal.onShow=this._onShow.bind(this),e&&(this._chooseThreadModal.elements.close.id="chooseThread-closeBtn")},_onSubmit:function(e,t,i){e&&t?this._chooseThreadModal.resolveCB({threadId:e,threadType:t,threadTitle:i}):this._chooseThreadModal.rejectCB(),this._chooseThreadModal.hide()},_onThreadChange:function(e){var t=this._getBody({type:e,conversations:this._conversations,communities:this._communities});this._chooseThreadModal.setBody(t)},_onShow:function(){},_onHide:function(){this._deleteModal()},_onScrollEnd:async function(e){if(this._waitSelectInputToBeUpdated)return;if(this._lastCommunityPage===this._communityPage)return;this._waitSelectInputToBeUpdated=!0;let t=document.createElement("div");t.classList.add("loadingCommunities-container"),new r({zIndex:2e3}).inject(t).show();var i=document.createElement("span");i.innerText=u.get("spinnerCommunitiesLabel"),t.appendChild(i),e.elements.content.appendChild(t),this._communityPage++;var n=await this._getCommunities(this._communityPage);n.length===this._communitiesLimit&&this._lastCommunityPage++,this._communities=this._communities.concat(n),e.elements.content.removeChild(t),t=null,e.add(n),this._waitSelectInputToBeUpdated=!1},_deleteModal:function(){this._chooseThreadModal.resolveCB=null,this._chooseThreadModal.rejectCB=null,this._chooseThreadModal&&this._chooseThreadModal.hide(),this._chooseThreadModal&&this._chooseThreadModal.destroy(),this._chooseThreadModal=null,this._onDocCB&&(document.removeEventListener(c.POINTERDOWN,this._onDocCB),this._onDocCB=null)},_getLoadingBody:function(){var e=document.createElement("div");e.classList.add("loadingBody"),new r({zIndex:2e3}).inject(e).show();var t=document.createElement("span");t.innerText=u.get("spinnerLabel"),e.appendChild(t);var i=document.createElement("div");return i.classList.add("loadingMsg"),i.innerText=u.get("modalLoadingMessage"),e.appendChild(i),e},_getBody:function(e){var t=document.createElement("div"),n=document.createElement("p");n.innerText=u.get("selectLocation"),n.className="label-cnt",t.appendChild(n);var o=document.createElement("div");o.className="thread-selector-cnt",t.appendChild(o);var r="primary thread-selector ";r+=e.type===this._threadCommunity?"checked":"",new s({name:"threadType",value:this._threadCommunity,label:u.get("community"),className:r,checked:e.type===this._threadCommunity}).inject(o).addEvent("onClick",function(){this._onThreadChange&&this._onThreadChange(this._threadCommunity)}.bind(this)),r="primary thread-selector ",r+=e.type===this._threadConversation?"checked":"",new s({name:"threadType",value:this._threadConversation,label:u.get("conversation"),className:r,checked:e.type===this._threadConversation}).inject(o).addEvent("onClick",function(){this._onThreadChange&&this._onThreadChange(this._threadConversation)}.bind(this));var h=new i({fields:[{type:"select",custom:!0,label:e.type===this._threadCommunity?u.get("selectLabelCommunity"):u.get("selectLabelConversation"),name:"threadInput",options:e.type===this._threadConversation?e.conversations:e.communities}]}).inject(t);h.elements.container.setAttribute("id",this._formName);var d=h.getInput("threadInput"),m=d.scroller;if(a.getPreferenceValue("MobileMode")&&l.Platform.ios&&(d.addEvent("onClick",function(){d.toggleDropdown()}),this._onDocCB&&(document.removeEventListener(c.POINTERDOWN,this._onDocCB),this._onDocCB=null),this._onDocCB=d.onClickOutside.bind(d),document.addEventListener(c.POINTERDOWN,this._onDocCB),d.elements.input.style.display="none"),m&&m.getInnerElement()&&e.type===this._threadCommunity&&(m.getInnerElement().onscroll=function(){let e=m._infos.y;e.scrollSize<e.scrollPosition+e.offsetSize+50&&this._onScrollEnd(d)}.bind(this)),h.addEvent("onSubmit",function(t){t.threadInput&&""!==t.threadInput?this.getThreadTitle(t.threadInput).then(function(i){this._onSubmit(t.threadInput,e.type,i)}.bind(this)):this._onSubmit(void 0,void 0,void 0)}.bind(this)),e.type===this._threadConversation&&0===e.conversations.length&&0!==e.communities.length){var f=document.createElement("p");f.classList.add("infoMsg"),f.textContent=u.get("emptyConversationList"),t.appendChild(f)}else if(e.type===this._threadCommunity&&0===e.communities.length&&0!==e.conversations.length){var _=document.createElement("p");_.classList.add("infoMsg"),_.textContent=u.get("emptyCommunityList"),t.appendChild(_)}else if(0===e.communities.length&&0===e.conversations.length){var p=document.createElement("p");p.classList.add("infoMsg"),p.textContent=u.get("emptyThreadList"),t.appendChild(p)}return t},_getCommunities:function(e){return new Promise(function(t){this._platformId||this._platformUrl?o.getCommunities({url:this._platformUrl,token:this._csrfToken,limit:this._communitiesLimit,page:e}).then(function(e){for(var i=[],n=0;n<e.length;n++)i.push({label:e[n].title,value:e[n].id});i.length&&i.sort((e,t)=>e.label>t.label?1:t.label>e.label?-1:0),t(i)}).catch(function(){t([])}):t([])}.bind(this))},_getConversations:function(){return new Promise(function(e){this._platformId||this._platformUrl?o.getConversations({url:this._platformUrl,token:this._csrfToken}).then(function(t){if(t.length)for(var i=[],n=0;n<t.length;n++)this._getConversationName(t[n]).then(n=>{i.push({label:n.title,value:n.id}),i.length===t.length&&(i.sort((e,t)=>e.label>t.label?1:t.label>e.label?-1:0),e(i))});else e([])}.bind(this)).catch(function(){e([])}):e([])}.bind(this))},_getConversationName:function(e){return new Promise(function(t){var i=this._currentUser.login,n=e.topic;if(!n){n="";for(var s=0;s<e.users.length;s++)i.toLowerCase()!==e.users[s].login.toLowerCase()&&(n+=e.users[s].first_name+" "+e.users[s].last_name,s!==e.users.length-1&&(s===e.users.length-2&&i.toLowerCase()===e.users[s+1].login.toLowerCase()||(n+=", ")))}t({title:n,id:e.subject_uri})}.bind(this))},getThreadTitle:function(e){return new Promise(function(t,i){var n=function(){return this._platformUrl?new Promise(e=>{e(this._platformUrl)}):this._getPlateformData()}.bind(this);if(e.includes("community:rt")){let i=d.getTenant(),n=e.split("community:rt:")[1];h.getConv({dmId:n,platformId:i}).then(e=>{let i=e.topic?e.topic:u.get("conversationTitle");t(i)})}else{var s={id:e};n().then(function(){o.callPlatformWebService({url:this._platformUrl,params:s,api:"/api/community/get",token:this._csrfToken,returnPromise:!1,onSuccessCB:function(e){if(e.result.community_type===this._threadCommunity)t(e.result.title);else if(e.result.community_type===this._threadConversation){let i=e.result.topic?e.result.topic:u.get("conversationTitle");t(i)}}.bind(this),onFailCB:function(){i(new Error("[CAT3DWChooseThread] - getThreadTitle failed"))}})}.bind(this))}}.bind(this))}});return t.namespace("DS/CAT3DWChooser/CAT3DWChooseThread",m)}),define("DS/CAT3DWChooser/CAT3DWImageGallery",["UWA/Core","UWA/Controls/Abstract","UWA/Json","WebappsUtils/WebappsUtils","text!DS/CAT3DWChooser/assets/gallerySettings.json","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWImageGallery"],function(e,t,i,n,s,o){"use strict";var a="variable";return t.singleton({init:function(){this._currentSection={},this._maxLength=8,this._settingsURL=null,this._initialPath="",this._currentPath=""},initProperties:function(){var t=JSON.parse(s),o=i.path(t,"$");o[0].sections.map(function(e){return e.thumbnails.forEach(function(t){t.sectionName=e.name,t.url=t.url?n.getWebappsAssetUrl("CAT3DWChooser",t.url):t.url}),e}),this._initialPath+=e.Json.encode(o),this._currentPath+=this._initialPath},getIDs:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].thumbnails..id')},getThumbnails:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].thumbnails..url')},addThumbnail:function(e,t){var n=i.decode(this._currentPath);if(this._currentSection=i.path(n[0],'$.sections[?(@.name=="'+e+'")]')[0],this._currentSection&&this._currentSection.type===a){var s=this._genId();return this._currentSection.thumbnails||(this._currentSection.thumbnails=[]),this._currentSection.thumbnails.unshift({id:s,url:t}),this._currentSection.thumbnails.length>this._maxLength&&this._currentSection.thumbnails.pop(),this._currentPath=i.encode(n),s}return!1},getThumbnailPropertiesByID:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$..properties[?(@.id=="'+e+'")]')[0]},getSectionTitle:function(e){return o.get(e)},isSectionSelected:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].selected')[0]},setSectionVisible:function(e,t){var n=i.decode(this._currentPath);this._currentSection=i.path(n[0],'$.sections[?(@.name=="'+e+'")]')[0],this._currentSection&&(this._currentSection.visible=t,this._currentPath=i.encode(n))},countVisibleSections:function(){if(""!==this._currentPath){var e=i.decode(this._currentPath);return i.path(e[0],"$.sections[?(@.visible==true)]").length}return 0},isSectionVisible:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].visible')[0]},getOnClickCB:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].onClick')[0]},getSectionsNames:function(){var e=i.decode(this._currentPath);return i.path(e[0],"$.sections..name")},reset:function(){this._currentPath="",this._currentPath+=this._initialPath},_genId:function(){var e=Date.now();return e+=Math.floor(10*Math.random())}})}),define("DS/CAT3DWChooser/CAT3DWDisplayUserMedia",["UWA/Core","UWA/Promise","DS/CAT3DWInfra/CAT3DW3DSwymMediaServices","DS/CAT3DWLoaderLight/CAT3DWLoaderLight","DS/CoreEvents/Events","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWDisplayUserMedia","DS/UIKIT/SuperModal","DS/CAT3DWPanoply/CAT3DWDropMenu","DS/CAT3DWInfraUI/CAT3DWHandleErrors","DS/RTConvAPI/RTConvAPI","DS/PlatformAPI/PlatformAPI","css!DS/CAT3DWChooser/CAT3DWChooser"],function(e,t,i,n,s,o,a,r,l,c,h,d,u){"use strict";var m=e.Class.extend({init:function(e){this.mediaContainer=e.body,this.showLoader(),this._currentUser=a.getPreferenceValue("currentUserInfo"),this._swymMediaServices=new i({platformId:a.getPreferenceValue("swymTenant")}),this.platformId=a.getPreferenceValue("swymTenant"),this._isWhiteboard="whiteboard"===a.getPreferenceValue("appMode"),this.isSearchFeatureTurnedOff=!0,this.getAllData()},showLoader:function(){n.show()},searchInUserMedia:async function(e){var t=this.boxContainer&&this.boxContainer.isInjected();this.isSearchFeatureTurnedOff=!e;var i=[],n=[];if(t&&!this.isSearchFeatureTurnedOff){for(let t of this._processedMediaInfo)!0===t.label.toLowerCase().includes(e.toLowerCase())&&(t.hasOwnProperty("isMediaDeleted")?!1===t.isMediaDeleted&&i.push(t):n.push(t));for(let e of n)try{let t=await o.checkIfMediaExists({url:this.platformUrl,token:this.csrfToken,mediaId:e.id,returnPromise:!0});t instanceof Error?e.isMediaDeleted=!0:(this.retrievedMediaMap.set(e.id,t),i.push(e),e.isMediaDeleted=!1)}catch(e){console.warn(e)}if(i.sort((e,t)=>e.modified<t.modified?1:t.modified<e.modified?-1:0),0!==i.length){this.boxContainer&&(this.boxContainer.innerText="");for(let e of i)this.mediaCardView(e)}else h.setGeneralErrorMessage(r.get("searchWhiteboardsNoResults"),"","",h.INFORMATION)}else if(this.isSearchFeatureTurnedOff){this.boxContainer&&(this.boxContainer.innerText="");for(let e of this.mediaList)this.mediaCardView(e);let e=this.screenContent.contains(this.mediaContainer)?this.screenContent:this.screenContentTabletMobile,t=e.scrollHeight>e.clientHeight;!1===t&&this._fillCallback(t,null)}else t||h.setGeneralErrorMessage(r.get("MyWhiteboardsButtonNotClickedError"),"","",h.INFORMATION)},_onResizeCallback:function(e){let t=this.screenContent.contains(this.mediaContainer)?this.screenContent:this.screenContentTabletMobile,i=t.scrollHeight>t.clientHeight;clearTimeout(this._fillCallback._tId),!1===i&&(this._fillCallback._tId=setTimeout(()=>{this._fillCallback(!1,null)},200))},_onScrollCallback:function(e){e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight==0&&this.isSearchFeatureTurnedOff&&(clearTimeout(this._fillCallback._tId),this._fillCallback._tId=setTimeout(()=>{this._fillCallback(!0,!0)},200))},_fillCallback:function(e,t){if(!0===e){let e=this._processedMediaInfo.slice(this._fillStartIndex,this._fillEndIndex);0!==e.length&&t&&this._displayUserMedia(e)}else if(!1===e){let e=this._processedMediaInfo.slice(this._fillStartIndex,this._fillEndIndex);0!==e.length?this._displayUserMedia(e):0===this.mediaList.length&&this.noMediaView()}},_getConversationName:function(e){var t=this._currentUser.login,i=e.topic;if(!i){i="";for(var n=0;n<e.users.length;n++)t.toLowerCase()!==e.users[n].login.toLowerCase()&&(i+=e.users[n].first_name+" "+e.users[n].last_name,n!==e.users.length-1&&(n===e.users.length-2&&t.toLowerCase()===e.users[n+1].login.toLowerCase()||(i+=", ")))}return i},startFetchAndFill:function(){let e=function(){let e=new Set,t=u.getTenant();d.listConv({platformId:t}).then(t=>{let i=new Map;t.forEach(e=>{i.set(e.id,e)});for(let t of this._fetchedRawMediaInfo){let n={};if(t.attributes.map(e=>{let t=e.name;(t=t.replace("ds6w:","").replace("swym:","")).contains("resourceid")&&e.value.contains("media:")&&(t="id",e.value=e.value.split("media:")[1]),t.contains("containerUid")&&e.value.contains("community:")&&(e.value=e.value.split("community:")[1],e.value.contains("rt:")&&(e.value=e.value.split("rt:")[1])),t.contains("community")&&(t="community"),t.contains("dataSource")&&(t="conversation"),t.contains("modified")&&(t="modified",e.value=this.formatDate(new Date(e.value))),n[t]="conversation"===!t?"My Conversation":e.value}),!n.community){let e=i.get(n.containerUid);e&&(n.conversation=this._getConversationName(e))}n.isDraft="Draft"===n.publicationState,!1===e.has(n.id)&&(e.add(n.id),this._processedMediaInfo.push(n))}this._fillStartIndex=0,this._fillEndIndex=5,this._fillCallback(!1,null)})}.bind(this);this._getMediasOfCurrentUser(e)},getAllData:function(){this._onScrollCallbackBind&&(this.screenContent.removeEventListener("scroll",this._onScrollCallbackBind),this.screenContentTabletMobile.removeEventListener("scroll",this._onScrollCallbackBind)),this._onResizeCallbackBind&&window.removeEventListener("resize",this._onResizeCallbackBind),this._getPlateformData().then(this._getCurrentUser.bind(this)).then(this._get3DSearchUrl.bind(this)).then(function(){this._processedMediaInfo=[],this._fetchedRawMediaInfo=[],this.mediaList=[],this.retrievedMediaMap=new Map,this.page=0,this.page_size=500,this.boxContainer&&(this.boxContainer.innerText=""),this._onScrollCallbackBind=this._onScrollCallback.bind(this),this._onResizeCallbackBind=this._onResizeCallback.bind(this),this.screenContent.addEventListener("scroll",this._onScrollCallbackBind),this.screenContentTabletMobile.addEventListener("scroll",this._onScrollCallbackBind),window.addEventListener("resize",this._onResizeCallbackBind),this.startFetchAndFill()}.bind(this))},displayRecentUserMedia:function(){let t=e.createElement;this.titleBoxContainer=t("div",{class:"title-box-container",text:r.get("recentPublishedContent")}),this.boxContainer=t("div",{class:"box-container"}),this.screenContent=document.getElementsByClassName("afr-welcome-screen-content")[0],this.screenContent.style.overflow="auto",this.screenContent.style.width="78%",this.screenContentTabletMobile=document.getElementsByClassName("afr-custom-panel")[0],this.mediaContainer.className="media-container",this.mediaContainer.appendChild(this.titleBoxContainer),this.mediaContainer.appendChild(this.boxContainer)},_getPlateformData:function(){return new t(function(e){this._swymMediaServices.getPlatformUrl().then(o.getCsrfToken).then(function(t){this.platformUrl=t.url,this.csrfToken=t.token,e(t)}.bind(this)).catch(function(e){console.log(e)})}.bind(this))},_getCurrentUser:function(){return new t(function(e){this._currentUser&&e(this._currentUser),o.getCurrentUser({url:this.platformUrl,token:this.csrfToken}).then(function(t){this._currentUser=t,e(this._currentUser)}.bind(this)).catch(function(e){console.log(e)})}.bind(this))},_get3DSearchUrl:function(){return new t(function(e){this._federatedSearchUrl&&e(this._federatedSearchUrl),o.get3DSearch(this.platformId).then(function(t){this._federatedSearchUrl=t,e(this._federatedSearchUrl)}.bind(this)).catch(function(e){console.log(e)})}.bind(this))},_getMediasOfCurrentUser:function(e){o.searchMedia({url:this._federatedSearchUrl,platform_id:this.platformId,current_user:this._currentUser.login,search_data:{user:this._currentUser.login,media_type:this._isWhiteboard?"whiteboard":"sketch"},include_draft:!0,source:"swym",page_size:this.page_size,page:this.page*this.page_size,order_field:"ds6w:modified",order_by:"desc"}).then(t=>{t.results?(this._fetchedRawMediaInfo.push(...t.results),t.infos.nmatches>(this.page+1)*this.page_size?(this.page=this.page+1,this._getMediasOfCurrentUser(e)):e()):(n.hide(),this.noMediaView())})},_deleteProjectFromSwym:function(e){var t=e&&e.subject6wuri;return this._swymMediaServices&&t?new Promise(e=>{this._swymMediaServices.deleteMedia({subject6wuri:t}).then(()=>e(!0)).catch(()=>e(!1))}):Promise.resolve(!1)},_displayUserMedia:function(e){let t=[],i=this.mediaList.length;for(let i of e)t.push(o.checkIfMediaExists({url:this.platformUrl,token:this.csrfToken,mediaId:i.id,returnPromise:!0}).then(function(e){e instanceof Error?i.isMediaDeleted=!0:(this.mediaList.push(i),this.retrievedMediaMap.set(i.id,e),i.isMediaDeleted=!1)}.bind(this)));Promise.all(t).then(()=>{n.hide(),this.mediaList.sort((e,t)=>e.modified<t.modified?1:t.modified<e.modified?-1:0);for(let e=i;e<this.mediaList.length;e++)this.mediaCardView(this.mediaList[e]);let e=this.screenContent.contains(this.mediaContainer)?this.screenContent:this.screenContentTabletMobile,t=e.scrollHeight-e.scrollTop-e.clientHeight==0,s=e.scrollHeight>e.clientHeight;this._fillStartIndex+=5,this._fillEndIndex+=5,this._fillCallback(s,t)})},mediaCardView:function(t){let i=e.createElement;var a,d=function(e){e.stopPropagation();let i=this.retrievedMediaMap.get(t.id);i?s.publish({event:"mediaClicked",data:i}):o.getMedia({url:this.platformUrl,token:this.csrfToken,mediaId:t.id,returnPromise:!0}).then(e=>{s.publish({event:"mediaClicked",data:e})})}.bind(this),u=function(e){e.stopPropagation(),new l({className:"CAT3DSK-onHomeModal"}).dialog({body:r.get("deleteConfirmationModalBody"),title:r.get("deleteConfirmationModalTitle"),buttons:[{className:"primary",value:r.get("deleteConfirmationModalConfirmButton"),action:function(e){e.hide();let i=this.mediaList.length,s=this.retrievedMediaMap.get(t.id),o=-1;for(let e=0;e<i;e++)if(this.mediaList[e].id===t.id){o=e;break}this._deleteProjectFromSwym(s).then(e=>{if(e){if(f.remove(),t.isMediaDeleted=!0,this.retrievedMediaMap.has(t.id)&&this.retrievedMediaMap.delete(t.id),-1!==o&&this.mediaList.splice(o,1),this.isSearchFeatureTurnedOff){let e=this.screenContent.contains(this.mediaContainer)?this.screenContent:this.screenContentTabletMobile,t=e.scrollHeight>e.clientHeight;!1===t&&this._fillCallback(t,null)}}else n.hide()})}.bind(this)},{className:"default",value:r.get("deleteConfirmationModalRejectButton"),action:function(e){e.hide()}.bind(this)}]})}.bind(this),m=function(e){e.stopPropagation(),window.navigator.clipboard.writeText(t.ResourceURL),h.setGeneralErrorMessage(r.get("shareableLinkCopyMessage"),"","",h.INFORMATION)}.bind(this),f=i("div",{class:"box",events:{click:d}}),_=[{id:"SHARELINK",text:r.get("dropmenuShareableLinkOption"),icon:"fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-link",selectable:!1,handler:m},{id:"EDIT",text:r.get("dropmenuEditOption"),icon:"fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil",selectable:!1,handler:d},{id:"DELETE",text:r.get("dropmenuDeleteOption"),icon:"fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash",selectable:!1,handler:u}],p=i("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-down",styles:{position:"absolute",bottom:"6px",right:"3px",fontSize:"2rem",color:"#77797C",display:"block"},events:{click:function(e){e.stopPropagation(),a||(a=new c({target:p,renderTo:f,items:_,multiSelect:!1,closeOnClick:!1,menuClassList:["HomepageDropmenu"],onShowCallback:function(){}.bind(this)})),a.onHide(()=>{a&&a.remove(),a=null}),a.toggle()}.bind(this)}});f.append(p);var C=i("div",{class:"image-container",styles:{height:"142px"}}),g=i("img",{class:"media-image",src:t.preview_url}),v=i("div",{class:"details-container"}),b=i("div",{class:"header-container"}),D=i("div",{class:"draft-label",text:r.get("draft")});t.isDraft&&b.appendChild(D);var T=i("div",{class:"title-text",text:t.label});b.appendChild(T);var S=i("div",{class:"date-container",text:t.modified}),y=i("div",{class:"community-container"}),I=i("div",{class:"community-icon",html:t.community?'<span class="fonticon fonticon-users-alt"></span>':'<span class="fonticon fonticon-chat-alt"></span>'});let A=t.community?t.community:t.conversation;var w=i("div",{class:"community-text",text:A||""});y.appendChild(I),y.appendChild(w),f.setAttribute("href",this.platformUrl+"/#community:"+t.containerUid+"/media:"+t.id+"/edit"),C.appendChild(g),f.appendChild(C),v.appendChild(b),v.appendChild(S),v.appendChild(y),f.appendChild(v),this.boxContainer.appendChild(f)},noMediaView:function(){this.boxContainer&&(this.boxContainer.innerText="");var t=e.createElement("div",{class:"empty-container",text:this._isWhiteboard?r.get("noWhiteboard"):r.get("noSketch")});this.boxContainer.appendChild(t)},formatDate:function(e){return e.getFullYear().toString().padStart(4,0)+"-"+(e.getMonth()+1).toString().padStart(2,0)+"-"+e.getDate().toString().padStart(2,0)+" "+e.getHours().toString().padStart(2,0)+":"+e.getMinutes().toString().padStart(2,0)+":"+e.getSeconds().toString().padStart(2,0)}});return e.namespace("DS/CAT3DWChooser/CAT3DWDisplayUserMedia",m)}),define("DS/CAT3DWChooser/CAT3DWChoose3DModel",["UWA/Class","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/CAT3DWChooser/CAT3DWLoadServices","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DSKChoose3DModel","css!DS/CAT3DWChooser/CAT3DWChooser"],function(e,t,i,n,s,o,a){"use strict";var r=UWA.Class.extend({init:function(){this._onOpenFile=null,this._url=null,this._loadServices=new n({acceptAttributes:".3dxml,.cgr"}),this._drivePanelAnchor="sidepanel:X3PDRIV_AP"},open:function(e){this._onOpenFile=e;var t=new i({className:"choose-picture-modal"});t.onHide=this.onHide.bind(this,t),this._chooseProviderContent(t)},onHide:function(e){this._url=null,e.destroy()},_chooseProviderContent:function(e){if(s.cacheUrl3DDrive||o.getPreferenceValue("ODTMode")){var t=[];if(o.getPreferenceValue("ODTMode")){var i=this._createProviderObject(a.get("odtBtnLabel"),this._onODTClick.bind(this,e),"fonticon-cog",null);t.push(i);new UWA.Element("input",{type:"hidden",id:"x3DPhoto-ODT-modelUrl"}).inject(document.body)}var n=this._createProviderObject(a.get("deviceBtnLabel"),this._onComputerClick.bind(this,e),"fonticon-install",null);if(t.push(n),s.cacheUrl3DDrive){var r=this._getDrivePanelUrl(),l=this._createProviderObject(a.get("driveBtnLabel"),this._on3DDriveClick.bind(this,e),"fonticon-component",r);t.push(l)}var c=new UWA.Element("div",{html:t});e.dialog({body:c,title:a.get("title"),buttons:[{value:a.get("cancelBtnLabel"),action:function(e){e.hide()}}]})}else this._onComputerClick(e)},_onComputerClick:function(e){this._loadServices.openFileSelector(function(t){e.next(),this._onOpenFile(t)}.bind(this))},_onODTClick:function(e){var t=document.getElementById("x3DPhoto-ODT-modelUrl");e.next(),this._onOpenFile(t.value)},_on3DDriveClick:function(e){},_createProviderObject:function(e,t,i,n){return{tag:"a",href:n||"javascript:void(0)",target:"_parent",html:{tag:"div",class:"provider",html:[{tag:"span",class:"fonticon "+i+" fonticon-2x"},{tag:"span",class:"name",text:e}],events:{click:t}}}},_getDrivePanelUrl:function(){return parent.document.location.hash="","/#"+this._drivePanelAnchor}});return UWA.namespace("DS/CAT3DWChooser/CAT3DWChoose3DModel",r)}),define("DS/CAT3DWChooser/CAT3DWChoosePicture",["UWA/Class","UWA/Controls/Scroller","DS/UIKIT/Accordion","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/CAT3DWChooser/CAT3DWLoadServices","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfraUI/CAT3DWCanvasServices","DS/CAT3DWChooser/CAT3DWImageGallery","DS/i3DXCompassServices/i3DXCompassPubSub","WebappsUtils/WebappsUtils","DS/WAFData/WAFData","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWChoosePicture","css!DS/CAT3DWChooser/CAT3DWChooser"],function(e,t,i,n,s,o,a,r,l,c,h,d,u,m){"use strict";var f=UWA.Class.extend({init:function(){this._onOpenFile=null,this._url=null,this._loadServices=new o,this._canvasServices=new r,this._drivePanelAnchor="sidepanel:X3PDRIV_AP",this._maxWidth=2e3,this._maxHeight=1500,this._widget=null},setWidget:function(e){this._widget=e},open:function(e){this._onOpenFile=e;var t=new s({className:"choose-picture-modal"});t.onHide=this.onHide.bind(this,t),this._chooseProviderContent(t)},dropImage:function(e,t){this._onOpenFile=t,this._canvasServices.loadImage(e,!1,function(e){this._computeImageUrl(e,function(e){this._url=e,this._onOpenFile(this._url)}.bind(this))}.bind(this))},onHide:function(e){this._url=null,e.destroy(),c.unsubscribe("setX3DContent")},_chooseProviderContent:function(e){if(!a.cacheUrl3DDrive&&!u.getPreferenceValue("ODTMode")&&l.countVisibleSections()<=0)this._onComputerClick(e);else{var t=[];if(u.getPreferenceValue("ODTMode")){var i=this._createProviderObject(m.get("odtBtnLabel"),this._onODTClick.bind(this,e),"fonticon-cog",null);t.push(i);new UWA.Element("input",{type:"hidden",id:"x3DPhoto-ODT-imageUrl"}).inject(document.body)}var n=this._createProviderObject(m.get("deviceBtnLabel"),this._onComputerClick.bind(this,e),"fonticon-install",null);if(t.push(n),a.cacheUrl3DDrive){var s=this._getDrivePanelUrl(),o=this._createProviderObject(m.get("driveBtnLabel"),this._on3DDriveClick.bind(this,e),"fonticon-component",s);t.push(o)}var r=null;l.countVisibleSections()>1?r=this._createAccordionContainer("divided",e):1==l.countVisibleSections()&&(r=this._createSectionContainer(e)),r&&t.push(r);var c=new UWA.Element("div",{html:t});e.dialog({body:c,title:m.get("title"),buttons:[{value:m.get("cancelBtnLabel"),action:function(e){e.hide()}}]});var h=document.getElementById("toScroll");h&&this._addToScroller(h)}},_onComputerClick:function(e){this._loadServices.openFileSelector(function(t,i){this._loadLocalImage(e,t,i)}.bind(this))},_onODTClick:function(e){var t=document.getElementById("x3DPhoto-ODT-imageUrl");this._loadLocalImage(e,t.value)},_loadLocalImage:function(e,t,i){this._canvasServices.loadImage(t,!1,function(t){e.next(),this._computeImageUrl(t,function(e){this._url=e,this._onOpenFile(this._url,i?i.name:"")}.bind(this))}.bind(this))},_on3DDriveClick:function(e){var t=this._selectPictureContent(e);e.next(),c.subscribe("setX3DContent",this._on3DXContentSelection.bind(this,t))},_onRecentContentClick:function(e){this._canvasServices.getBlobUrlFromImg(this._url,function(t){this._url=t,this._onOpenFile(this._url),e.next()}.bind(this))},_onRecentTextureClick:function(e){this._canvasServices.getBlobUrlFromImg(this._url,function(t){this._url=t,this._onOpenFile(this._url),e.next()}.bind(this))},_onSampleClick:function(e,t){if(this._url=l.getThumbnailPropertiesByID(t),!this._url.type)return this._onOpenFile(this._url),void e.next();if("side"==this._url.type){for(var i in this._url.set){var n=this._url.set[i];n&&"string"==typeof n&&(this._url.set[i]=n?n.match("http")?n:h.getWebappsAssetUrl("CAT3DWChooser",n):null)}this._canvasServices.getBlobUrlFromImg(this._url.set.front,function(t){this._url.set.front=t,this._canvasServices.getBlobUrlFromImg(this._url.set.left,function(t){this._url.set.left=t,this._canvasServices.getBlobUrlFromImg(this._url.set.top,function(t){this._url.set.top=t,this._onOpenFile(this._url),e.next()}.bind(this))}.bind(this))}.bind(this))}else"scene"==this._url.type?(this._url.background=h.getWebappsAssetUrl("CAT3DWChooser",this._url.background),this._canvasServices.getBlobUrlFromImg(this._url.background,function(t){u.setPreferenceValue("SampleMode",{base:this._url.manhattanBase,floorParams:this._url.floorParams,camParams:this._url.camParams}),this._onOpenFile(t),e.next()}.bind(this))):(this._onOpenFile(this._url),e.next())},_selectPictureContent:function(e){var t=h.getWebappsAssetUrl("CAT3DWChooser","graphics/G_NXGAddImageWhite.png"),i=new UWA.Element("div",{html:[{tag:"div",class:"thumbnail",styles:{backgroundImage:"url("+t+")"},html:{tag:"img",src:t,class:"hide"}}]});return e.dialog({body:i,title:m.get("title"),buttons:[{className:"primary",value:m.get("validateBtnLabel"),action:function(e){this._url&&(this._onOpenFile(this._url),e.hide())}.bind(this)},{value:m.get("cancelBtnLabel"),action:function(e){e.hide()}}]}),i.getElementsByTagName("img")[0]},_on3DXContentSelection:function(e,t){if(t&&null!=t.data.items[0]){var i=a.cacheUrl3DDrive+"/resources/3ddrive/v1/bos/"+t.data.items[0].objectId+"/download";d.authenticatedRequest(i,{method:"GET",type:"json",onComplete:function(t){this._canvasServices.loadImage(t.url,!1,function(t){this._computeImageUrl(t,function(t){e.parentNode.setStyle("backgroundImage","url("+t+")"),this._url=t}.bind(this))}.bind(this))}.bind(this),onFailure:function(e){}})}},_createProviderObject:function(e,t,i,n){return{tag:"a",href:n||"javascript:void(0)",target:"_parent",html:{tag:"div",class:"provider",html:[{tag:"span",class:"fonticon "+i+" fonticon-2x"},{tag:"span",class:"name",text:e}],events:{click:t}}}},_createPictureContainer:function(e,t,i){var n=new UWA.Element("div",{class:"section-thumbnail",events:{click:function(){this._url=e,t?i(t):i()}.bind(this)}});return this._canvasServices.loadImage(e,!1,function(e){e.naturalWidth>e.naturalHeight?n.addClassName("landscape"):n.addClassName("portrait"),n.appendChild(e)}),n},_createSectionContent:function(e,t,i){if(n=null,e&&e.length>0){var n=new UWA.Element("div",{class:"section-thumbnail-container",id:"toScroll"});e.forEach(function(e,s){this._createPictureContainer(e,t?t[s]:null,i).inject(n,"bottom")}.bind(this)),new UWA.Element("div",{class:"section-padding-trick"}).inject(n)}return n},_createAccordionContainer:function(e,t){var n=new UWA.Element("div",{class:"section-container"}),s=new i({className:e||"",exclusive:!1,items:[]});return l.getSectionsNames().forEach(function(e){l.isSectionVisible(e)&&(s.addItem({title:l.getSectionTitle(e),name:e,content:this._createSectionContent(l.getThumbnails(e),l.getIDs(e),this[l.getOnClickCB(e)].bind(this,t)),selected:l.isSectionSelected(e)}),s.inject(n))}.bind(this)),n},_createSectionContainer:function(e){var t=new UWA.Element("div",{class:"section-container"});return l.getSectionsNames().forEach(function(i){if(l.isSectionVisible(i)){var n=this._createSectionContent(l.getThumbnails(i),l.getIDs(i),this[l.getOnClickCB(i)].bind(this,e));if(n)new UWA.Element("div",{class:"section-title",text:l.getSectionTitle(i)}).inject(t),n.inject(t)}}.bind(this)),t},_addToScroller:function(e){new t(e,{scrollbarV:!1,scrollableY:!1})},_getDrivePanelUrl:function(){return parent.document.location.hash="","/#"+this._drivePanelAnchor},_computeImageUrl:function(e,t){var i=null,n=this._widget?this._widget.getValue("ImageOptimization"):"1";"-1"===n&&(e.width>this._maxWidth||e.height>this._maxHeight)?this._openImageOtimizationModal(function(n){i=this._optimizeImage(e,n),t(i)}.bind(this)):(i=this._optimizeImage(e,n),t(i))},_openImageOtimizationModal:function(e){var t=new n({className:"image-optimization",overlay:!0,closable:!1,header:"<h4>"+m.get("optimTitle")+"</h4>",body:"<p>"+m.get("optimMessage1")+"</p><p>"+m.get("optimMessage2")+'</p><br /><p><font size="2">'+m.get("optimTip")+"</font></p>",footer:'<button type="button" class="btn btn-primary" value="1">'+m.get("optimYesBtnLabel")+'</button> <button type="button" class="btn btn-default" value="0">'+m.get("optimNoBtnLabel")+"</button>"}).inject(document.body);t.onHide=this._onImageOptimizationHide.bind(this,t),t.getContent().getElements(".btn").forEach(function(i){i.addEvent("click",function(){t.hide(),this._widget&&this._widget.setValue("ImageOptimization",i.value),e(i.value)}.bind(this))}.bind(this)),t.show()},_optimizeImage:function(e,t){var i=e.width,n=e.height;"1"===t?(i=this._maxWidth,n=this._maxHeight):"0"===t&&(i=4e3,n=4e3);var s=this._canvasServices.getOptimizedDataUrlFromImg(e,i,n);return this._canvasServices.getBlobUrlFromDataUrl(s)},_onImageOptimizationHide:function(e){e.destroy()}});return UWA.namespace("DS/CAT3DWChooser/CAT3DWChoosePicture",f)});