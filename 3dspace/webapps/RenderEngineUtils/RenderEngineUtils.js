define("DS/RenderEngineUtils/StateSortingCacheItem",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";var t=function({dlIndex:e,resetFrameIndex:t,material:i,geometry:r,dg:a,dgInterval:n,renderVolumesOnly:s,renderLineMode:o,geomDisposeFunc:l,materialToUse:d,matApp:u,gasMaterial:c,cpInfos:p=null}){this._inheritanceSolverCache={material:i,geometry:r,dg:a,dgInterval:n,geomDisposeFunc:l,materialToUse:d,matApp:u,gasMaterial:c,cpInfos:p},s&&i&&(i.isWideLine||i.is2DLine)&&(this._inheritanceSolverCache.material=null),this._drawCallCache={polygonOffset:null,side:null,noZ:!1,updateLineInfos:!1,isFace:!1},this.materialPack=null,this.dlIndex=e,this.resetFrameIndex=t,this.renderLineMode=o};return t.prototype.addDrawable=function(e,t){if(this._inheritanceSolverCache.material&&this.materialPack){var i={object:t,geometry:this._inheritanceSolverCache.geometry,dg:this._inheritanceSolverCache.dg,dgInterval:this._inheritanceSolverCache.dgInterval,matApp:this._inheritanceSolverCache.matApp,gasMaterial:this._inheritanceSolverCache.gasMaterial,cpInfos:this._inheritanceSolverCache.cpInfos,materialPack:this.materialPack,tokenCache:this._drawCallCache};e.addDrawable(i)}},t}),define("DS/RenderEngineUtils/BufferUtils",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";var t=new e.Matrix4;function i(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function r(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function a(t){return function(t){return t&&void 0!==t.shading&&t.shading===e.SmoothShading}(t)?e.SmoothShading:e.FlatShading}function n(e){return!!e.vertexColors&&e.vertexColors}function s(t){return!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t instanceof e.ShaderMaterial)}function o(t,i){return t.material instanceof e.MeshFaceMaterial?t.material.materials[i.materialIndex]:t.material}function l(e,t){var i,r,l=t.geometry,d=e.faces3,u=e.faces4,c=3*d.length+4*u.length,p=1*d.length+2*u.length,y=3*d.length+4*u.length,g=o(t,e),f=s(g),h=a(g),_=n(g);if(e.__vertexArray=new Float32Array(3*c),h&&(e.__normalArray=new Float32Array(3*c)),l.hasTangents&&(e.__tangentArray=new Float32Array(4*c)),_&&(e.__colorArray=new Float32Array(3*c)),f&&((l.faceUvs.length>0||l.faceVertexUvs.length>0)&&(e.__uvArray=new Float32Array(2*c)),(l.faceUvs.length>1||l.faceVertexUvs.length>1)&&(e.__uv2Array=new Float32Array(2*c))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*c),e.__skinWeightArray=new Float32Array(4*c)),e.__faceArray=new Uint16Array(3*p),e.__lineArray=new Uint16Array(2*y),e.numMorphTargets)for(e.__morphTargetsArrays=[],i=0,r=e.numMorphTargets;i<r;i++)e.__morphTargetsArrays.push(new Float32Array(3*c));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],i=0,r=e.numMorphNormals;i<r;i++)e.__morphNormalsArrays.push(new Float32Array(3*c));e.__webglFaceCount=3*p,e.__webglLineCount=2*y,e.__inittedArrays=!0}return function(d){var u=d,c=null,p=null;function y(e){var t,i;if(c.deleteBuffer(e.__webglVertexBuffer),c.deleteBuffer(e.__webglNormalBuffer),c.deleteBuffer(e.__webglTangentBuffer),c.deleteBuffer(e.__webglColorBuffer),c.deleteBuffer(e.__webglUVBuffer),c.deleteBuffer(e.__webglUV2Buffer),c.deleteBuffer(e.__webglSkinIndicesBuffer),c.deleteBuffer(e.__webglSkinWeightsBuffer),c.deleteBuffer(e.__webglFaceBuffer),c.deleteBuffer(e.__webglLineBuffer),e.numMorphTargets)for(t=0,i=e.numMorphTargets;t<i;t++)c.deleteBuffer(e.__webglMorphTargetsBuffers[t]);if(e.numMorphNormals)for(t=0,i=e.numMorphNormals;t<i;t++)c.deleteBuffer(e.__webglMorphNormalsBuffers[t]);p.geometries--}this.setInfo=function(e){p=e},this.setContext=function(e){c=e},this.dispose=function(){u=null};var g=function(e){var t=e.target;t.removeEventListener("dispose",g),function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&c.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&c.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&c.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&c.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&c.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&c.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglTangentBuffer&&c.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglBinormalBuffer&&c.deleteBuffer(e.__webglBinormalBuffer),void 0!==e.__webglSkinIndicesBuffer&&c.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&c.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&c.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&c.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&c.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups)y(e.geometryGroups[t])}(t),u&&p.geometries--};function f(t,a){var n,s,d,u=t.geometry;if(u)if(1===u._type);else if(2===u._type||u.length>=0);else if(t instanceof e.Mesh){for(var p=0,y=u.geometryGroupsList.length;p<y;p++)n=u.geometryGroupsList[p],d=a||o(t,n),u.buffersNeedUpdate&&l(n,t),s=d.attributes&&i(d),(u.verticesNeedUpdate||u.morphTargetsNeedUpdate||u.elementsNeedUpdate||u.uvsNeedUpdate||u.normalsNeedUpdate||u.colorsNeedUpdate||u.tangentsNeedUpdate||s)&&m(n,t,c.DYNAMIC_DRAW,!u.dynamic,d);u.verticesNeedUpdate=!1,u.morphTargetsNeedUpdate=!1,u.elementsNeedUpdate=!1,u.uvsNeedUpdate=!1,u.normalsNeedUpdate=!1,u.colorsNeedUpdate=!1,u.tangentsNeedUpdate=!1,u.buffersNeedUpdate=!1,d.attributes&&r(d)}else t instanceof e.Line?(s=(d=o(t,u)).attributes&&i(d),(u.verticesNeedUpdate||u.colorsNeedUpdate||u.lineDistancesNeedUpdate||s)&&function(e,t){var i,r,a,n,s,o,l=e.vertices,d=e.colors,u=e.lineDistances,p=l.length,y=d.length,g=u.length,f=e.__vertexArray,h=e.__colorArray,_=e.__lineDistanceArray,m=e.verticesNeedUpdate,S=e.colorsNeedUpdate,v=e.lineDistancesNeedUpdate;if(e.__webglCustomAttributesList,m){for(i=0;i<p;i++)n=l[i],f[s=3*i]=n.x,f[s+1]=n.y,f[s+2]=n.z;c.bindBuffer(c.ARRAY_BUFFER,e.__webglVertexBuffer),c.bufferData(c.ARRAY_BUFFER,f,t)}if(S){for(r=0;r<y;r++)o=d[r],h[s=3*r]=o.r,h[s+1]=o.g,h[s+2]=o.b;c.bindBuffer(c.ARRAY_BUFFER,e.__webglColorBuffer),c.bufferData(c.ARRAY_BUFFER,h,t)}if(v){for(a=0;a<g;a++)_[a]=u[a];c.bindBuffer(c.ARRAY_BUFFER,e.__webglLineDistanceBuffer),c.bufferData(c.ARRAY_BUFFER,_,t)}}(u,c.DYNAMIC_DRAW),u.verticesNeedUpdate=!1,u.colorsNeedUpdate=!1,u.lineDistancesNeedUpdate=!1,d.attributes&&r(d)):t instanceof e.ParticleSystem&&(s=(d=o(t,u)).attributes&&i(d),(u.verticesNeedUpdate||u.colorsNeedUpdate||t.sortParticles||s)&&_(u,c.DYNAMIC_DRAW,t),u.verticesNeedUpdate=!1,u.colorsNeedUpdate=!1,d.attributes&&r(d))}function h(e){var t,i;if(e.__webglVertexBuffer=c.createBuffer(),e.__webglNormalBuffer=c.createBuffer(),e.__webglTangentBuffer=c.createBuffer(),e.__webglColorBuffer=c.createBuffer(),e.__webglUVBuffer=c.createBuffer(),e.__webglUV2Buffer=c.createBuffer(),e.__webglSkinIndicesBuffer=c.createBuffer(),e.__webglSkinWeightsBuffer=c.createBuffer(),e.__webglFaceBuffer=c.createBuffer(),e.__webglLineBuffer=c.createBuffer(),e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,i=e.numMorphTargets;t<i;t++)e.__webglMorphTargetsBuffers.push(c.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,i=e.numMorphNormals;t<i;t++)e.__webglMorphNormalsBuffers.push(c.createBuffer());p.geometries++}function _(e,i,r){var a,n,s,o,l,d=e.vertices,u=d.length,p=e.colors,y=p.length,g=e.__vertexArray,f=e.__colorArray,h=e.__sortArray,_=e.verticesNeedUpdate,m=(e.elementsNeedUpdate,e.colorsNeedUpdate);if(e.__webglCustomAttributesList,r.sortParticles){for(t.copy(_projScreenMatrix),t.multiply(r.matrixWorld),a=0;a<u;a++)s=d[a],_vector3.copy(s),_vector3.applyProjection(t),h[a]=[_vector3.z,a];for(h.sort(numericalSort),a=0;a<u;a++)s=d[h[a][1]],g[o=3*a]=s.x,g[o+1]=s.y,g[o+2]=s.z;for(n=0;n<y;n++)o=3*n,l=p[h[n][1]],f[o]=l.r,f[o+1]=l.g,f[o+2]=l.b}else{if(_)for(a=0;a<u;a++)s=d[a],g[o=3*a]=s.x,g[o+1]=s.y,g[o+2]=s.z;if(m)for(n=0;n<y;n++)l=p[n],f[o=3*n]=l.r,f[o+1]=l.g,f[o+2]=l.b}(_||r.sortParticles)&&(c.bindBuffer(c.ARRAY_BUFFER,e.__webglVertexBuffer),c.bufferData(c.ARRAY_BUFFER,g,i)),(m||r.sortParticles)&&(c.bindBuffer(c.ARRAY_BUFFER,e.__webglColorBuffer),c.bufferData(c.ARRAY_BUFFER,f,i))}function m(t,i,r,o,l){if(t.__inittedArrays){var d,u,p,y,g,f,h,_,m,S,v,D,L,P,b,A,E,M,w,R,T,B,O,I,F=a(l),C=n(l),N=s(l),x=F===e.SmoothShading,U=0,k=0,G=0,j=0,W=0,V=0,z=0,Y=0,H=t.__vertexArray,Z=t.__uvArray,K=t.__normalArray,J=t.__tangentArray,Q=t.__colorArray,X=t.__faceArray,$=t.__lineArray,q=i.geometry,ee=q.verticesNeedUpdate,te=q.elementsNeedUpdate,ie=q.uvsNeedUpdate,re=q.normalsNeedUpdate,ae=q.tangentsNeedUpdate,ne=q.colorsNeedUpdate,se=q.vertices,oe=t.faces3,le=t.faces4,de=q.faces,ue=q.faceVertexUvs[0];if(ee){for(d=0,u=oe.length;d<u;d++)S=se[(p=de[oe[d]]).a],v=se[p.b],D=se[p.c],H[k]=S.x,H[k+1]=S.y,H[k+2]=S.z,H[k+3]=v.x,H[k+4]=v.y,H[k+5]=v.z,H[k+6]=D.x,H[k+7]=D.y,H[k+8]=D.z,k+=9;for(d=0,u=le.length;d<u;d++)S=se[(p=de[le[d]]).a],v=se[p.b],D=se[p.c],L=se[p.d],H[k]=S.x,H[k+1]=S.y,H[k+2]=S.z,H[k+3]=v.x,H[k+4]=v.y,H[k+5]=v.z,H[k+6]=D.x,H[k+7]=D.y,H[k+8]=D.z,H[k+9]=L.x,H[k+10]=L.y,H[k+11]=L.z,k+=12;c.bindBuffer(c.ARRAY_BUFFER,t.__webglVertexBuffer),c.bufferData(c.ARRAY_BUFFER,H,r)}if(ne&&C){for(d=0,u=oe.length;d<u;d++)f=(p=de[oe[d]]).vertexColors,h=p.color,3===f.length&&C===e.VertexColorType.RGBA?(M=f[0],w=f[1],R=f[2]):(M=h,w=h,R=h),Q[Y]=M.r,Q[Y+1]=M.g,Q[Y+2]=M.b,Q[Y+3]=w.r,Q[Y+4]=w.g,Q[Y+5]=w.b,Q[Y+6]=R.r,Q[Y+7]=R.g,Q[Y+8]=R.b,Y+=9;for(d=0,u=le.length;d<u;d++)f=(p=de[le[d]]).vertexColors,h=p.color,4===f.length&&C===e.VertexColorType.RGBA?(M=f[0],w=f[1],R=f[2],T=f[3]):(M=h,w=h,R=h,T=h),Q[Y]=M.r,Q[Y+1]=M.g,Q[Y+2]=M.b,Q[Y+3]=w.r,Q[Y+4]=w.g,Q[Y+5]=w.b,Q[Y+6]=R.r,Q[Y+7]=R.g,Q[Y+8]=R.b,Q[Y+9]=T.r,Q[Y+10]=T.g,Q[Y+11]=T.b,Y+=12;Y>0&&(c.bindBuffer(c.ARRAY_BUFFER,t.__webglColorBuffer),c.bufferData(c.ARRAY_BUFFER,Q,r))}if(ae&&q.hasTangents){for(d=0,u=oe.length;d<u;d++)P=(_=(p=de[oe[d]]).vertexTangents)[0],b=_[1],A=_[2],J[V]=P.x,J[V+1]=P.y,J[V+2]=P.z,J[V+3]=P.w,J[V+4]=b.x,J[V+5]=b.y,J[V+6]=b.z,J[V+7]=b.w,J[V+8]=A.x,J[V+9]=A.y,J[V+10]=A.z,J[V+11]=A.w,V+=12;for(d=0,u=le.length;d<u;d++)P=(_=(p=de[le[d]]).vertexTangents)[0],b=_[1],A=_[2],E=_[3],J[V]=P.x,J[V+1]=P.y,J[V+2]=P.z,J[V+3]=P.w,J[V+4]=b.x,J[V+5]=b.y,J[V+6]=b.z,J[V+7]=b.w,J[V+8]=A.x,J[V+9]=A.y,J[V+10]=A.z,J[V+11]=A.w,J[V+12]=E.x,J[V+13]=E.y,J[V+14]=E.z,J[V+15]=E.w,V+=16;c.bindBuffer(c.ARRAY_BUFFER,t.__webglTangentBuffer),c.bufferData(c.ARRAY_BUFFER,J,r)}if(re&&F){for(d=0,u=oe.length;d<u;d++)if(y=(p=de[oe[d]]).vertexNormals,g=p.normal,3===y.length&&x)for(B=0;B<3;B++)O=y[B],K[W]=O.x,K[W+1]=O.y,K[W+2]=O.z,W+=3;else for(B=0;B<3;B++)K[W]=g.x,K[W+1]=g.y,K[W+2]=g.z,W+=3;for(d=0,u=le.length;d<u;d++)if(y=(p=de[le[d]]).vertexNormals,g=p.normal,4===y.length&&x)for(B=0;B<4;B++)O=y[B],K[W]=O.x,K[W+1]=O.y,K[W+2]=O.z,W+=3;else for(B=0;B<4;B++)K[W]=g.x,K[W+1]=g.y,K[W+2]=g.z,W+=3;c.bindBuffer(c.ARRAY_BUFFER,t.__webglNormalBuffer),c.bufferData(c.ARRAY_BUFFER,K,r)}if(ie&&ue&&N){for(d=0,u=oe.length;d<u;d++)if(void 0!==(m=ue[oe[d]]))for(B=0;B<3;B++)I=m[B],Z[G]=I.x,Z[G+1]=I.y,G+=2;for(d=0,u=le.length;d<u;d++)if(void 0!==(m=ue[le[d]]))for(B=0;B<4;B++)I=m[B],Z[G]=I.x,Z[G+1]=I.y,G+=2;G>0&&(c.bindBuffer(c.ARRAY_BUFFER,t.__webglUVBuffer),c.bufferData(c.ARRAY_BUFFER,Z,r))}if(te){for(d=0,u=oe.length;d<u;d++)X[j]=U,X[j+1]=U+1,X[j+2]=U+2,j+=3,$[z]=U,$[z+1]=U+1,$[z+2]=U,$[z+3]=U+2,$[z+4]=U+1,$[z+5]=U+2,z+=6,U+=3;for(d=0,u=le.length;d<u;d++)X[j]=U,X[j+1]=U+1,X[j+2]=U+3,X[j+3]=U+1,X[j+4]=U+2,X[j+5]=U+3,j+=6,$[z]=U,$[z+1]=U+1,$[z+2]=U,$[z+3]=U+3,$[z+4]=U+1,$[z+5]=U+2,$[z+6]=U+2,$[z+7]=U+3,z+=8,U+=4;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,X,r),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,$,r)}o&&(delete t.__inittedArrays,delete t.__colorArray,delete t.__normalArray,delete t.__tangentArray,delete t.__uvArray,delete t.__uv2Array,delete t.__binormalArray,delete t.__faceArray,delete t.__vertexArray,delete t.__lineArray,delete t.__skinIndexArray,delete t.__skinWeightArray)}}d._inheritanceSolver.onGeometryDisposeDS=g,this.updateObject=f;var S=function(e){var t=e.target;t.removeEventListener("dispose",S);var i=u?u.info:null;t.deallocate(c,i)};function v(e,t,i,r){u.initObject(e.object);var a=r(e,t,i);a&&u.__glResources__&&u.__glResources__.geometry.push(a)}d.initObject=function(t){var a;if(t.geometry&&(2===t.geometry._type||t.geometry.length>=0)){if(t._normalMatrix=new e.Matrix3,2===(s=t.geometry)._type)s.addEventListener("dispose",S);else if(s.length)for(var n=0;n<s.length;n++)s[n].addEventListener("dispose",S)}else if(!t.__webglInit){t.__webglInit=!0,t._normalMatrix=new e.Matrix3,void 0!==t.geometry&&void 0===t.geometry.__webglInit&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",g));var s=t.geometry;if(void 0===s);else if(1===s._type)!function(e){var t,i,r;for(t in e.attributes)r="index"===t?c.ELEMENT_ARRAY_BUFFER:c.ARRAY_BUFFER,(i=e.attributes[t]).buffer=c.createBuffer(),c.bindBuffer(r,i.buffer),c.bufferData(r,i.array,c.STATIC_DRAW)}(s);else if(t instanceof e.Mesh)for(a in u=t.material,void 0===s.geometryGroups&&function(t,i){var r,a,n,s,o,l,d={},u=t.morphTargets.length,c=t.morphNormals.length,p=i instanceof e.MeshFaceMaterial;for(t.geometryGroups={},r=0,a=t.faces.length;r<a;r++)n=t.faces[r],void 0===d[s=p?n.materialIndex:0]&&(d[s]={hash:s,counter:0}),l=d[s].hash+"_"+d[s].counter,void 0===t.geometryGroups[l]&&(t.geometryGroups[l]={faces3:[],faces4:[],materialIndex:s,vertices:0,numMorphTargets:u,numMorphNormals:c}),o=n instanceof e.Face3?3:4,t.geometryGroups[l].vertices+o>65535&&(d[s].counter+=1,l=d[s].hash+"_"+d[s].counter,void 0===t.geometryGroups[l]&&(t.geometryGroups[l]={faces3:[],faces4:[],materialIndex:s,vertices:0,numMorphTargets:u,numMorphNormals:c})),n instanceof e.Face3?t.geometryGroups[l].faces3.push(r):t.geometryGroups[l].faces4.push(r),t.geometryGroups[l].vertices+=o;for(var y in t.geometryGroupsList=[],t.geometryGroups)t.geometryGroups[y].id=e.GeometryIdCount++,t.geometryGroupsList.push(t.geometryGroups[y])}(s,u),s.geometryGroups){var d=s.geometryGroups[a];d.__webglVertexBuffer||(h(d),l(d,t),s.verticesNeedUpdate=!0,s.morphTargetsNeedUpdate=!0,s.elementsNeedUpdate=!0,s.uvsNeedUpdate=!0,s.normalsNeedUpdate=!0,s.tangentsNeedUpdate=!0,s.colorsNeedUpdate=!0)}else if(t instanceof e.Line)s.__webglVertexBuffer||(function(e){e.__webglVertexBuffer=c.createBuffer(),e.__webglColorBuffer=c.createBuffer(),e.__webglLineDistanceBuffer=c.createBuffer(),p.geometries++}(s),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i}(s),s.verticesNeedUpdate=!0,s.colorsNeedUpdate=!0,s.lineDistancesNeedUpdate=!0);else if(t instanceof e.ParticleSystem){s.__webglVertexBuffer||(function(e){e.__webglVertexBuffer=c.createBuffer(),e.__webglColorBuffer=c.createBuffer(),p.geometries++}(s),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i}(s),s.verticesNeedUpdate=!0,s.colorsNeedUpdate=!0);var u=o(t,s),y=u.attributes&&i(u);(s.verticesNeedUpdate||s.colorsNeedUpdate||t.sortParticles||y)&&_(s,c.DYNAMIC_DRAW,t),s.verticesNeedUpdate=!1,s.colorsNeedUpdate=!1,u.attributes&&r(u)}}t._updateWorldCenterAndRadius()},d.initWebGLObjects=function(t){t.initWebGLObjectFrameIndex!==d.currentFrameIndex&&(t.initWebGLObjectFrameIndex=d.currentFrameIndex,t.__webglObjects||(t.__webglObjects={main:new e.WebGLObjectManager},t.__webglObjectsAll=new e.WebGLObjectManager,t.__webglSprites=[],t.__webglFlares||(t.__webglFlares=[])),t.__objectsAdded.size&&t.__processAddedObjects(v),t.__objectsUpdated.size&&t.__processUpdatedObjects(v),t.__objectsRemoved.size&&t.__processRemovedObjects(u.__glResources__),u.bufferGPUManager.allocateShared(0==e.loadingModels),u.bufferGPUManager.intermediaryArray=null,t.traverseObject3DWithCondition(function(e){return!e.isRoot3ds&&(f(e),!0)}))}}}),define("DS/RenderEngineUtils/DisplayRangeList",["DS/Mesh/ThreeJS_Base","DS/Visualization/FixedSizeArrayPool"],function(e,t){"use strict";var i=null,r=null,a=function(e,t,i,r,a,n){const s=t.geometry.indexBufferGPU;e.drawElements(e.LINE_STRIP,i,s.glFormat,t.start*s.bytesPerIndex)},n=function(e,t,i,r,a,n){e.drawArrays(t.dg.glType,t.geometry.vertexIndexArray[t.start],i)},s=function(e,t,i,r,a,n){e.drawArrays(t.dg.glType,t.start,i)},o=function(e,t,i,r,a,n){const s=t.geometry,o=s.indexBufferGPU;e.drawElements(t.dg.glType,i,o.glFormat,(s.indexOffsetGPU+t.start)*o.bytesPerIndex)},l=function(e,t,i,r,a,n){const s=t.geometry.indexBufferGPU;r._setVertexAttribDivisors(1,a,n),r.drawElementsInstanced(e.LINE_STRIP,i,s.glFormat,t.start*s.bytesPerIndex,t.object.nbInstances),r._setVertexAttribDivisors(0,a,n)},d=function(e,t,i,r,a,n){const s=t.geometry,o=s.indexBufferGPU,l=t.dg&&t.dg._instancingInfos?t.dg._instancingInfos.nbInstances:t.object.nbInstances;r._setVertexAttribDivisors(1,a,n),r.drawElementsInstanced(t.dg.glType,i,o.glFormat,(s.indexOffsetGPU+t.start)*o.bytesPerIndex,l),r._setVertexAttribDivisors(0,a,n)},u=function(e,t,i,r,a,n){if(n.specialMeshIds>=0){const a=t.geometry.indexBufferGPU;var s=t.autoInstancingData.updateData;t.autoInstancingData.updateData=!1,e.bindBuffer(e.ARRAY_BUFFER,t.autoInstancingData.idsBuffer),e.vertexAttribPointer(n.specialMeshIds,2,e.FLOAT,!1,0,0),s&&e.bufferData(e.ARRAY_BUFFER,t.autoInstancingData.idsArray,e.DYNAMIC_DRAW),r.vertexAttribDivisor(n.specialMeshIds,1),n.specialMeshPicking>=0&&(e.bindBuffer(e.ARRAY_BUFFER,t.autoInstancingData.pickingColorBuffer),e.vertexAttribPointer(n.specialMeshPicking,3,e.FLOAT,!1,0,0),s&&e.bufferData(e.ARRAY_BUFFER,t.autoInstancingData.pickingColorArray,e.DYNAMIC_DRAW),r.vertexAttribDivisor(n.specialMeshPicking,1));const o=t.autoInstancingData.lastId+1;r.drawElementsInstanced(t.dg.glType,i,a.glFormat,t.start*a.bytesPerIndex,o),r.vertexAttribDivisor(n.specialMeshIds,0),n.specialMeshPicking>=0&&r.vertexAttribDivisor(n.specialMeshPicking,0)}},c=function(t,a){this.material=t,this.materialOverride=null,this.tree=new Map,this.dl=a,this.pack=null,null===i&&(i=e.Constants,r=e.MaterialToUse)};return c.prototype.getSortId=function(e,t){return e.isCurvedPipe?t.id:t.vertexBufferGPU?t.vertexBufferGPU.id:-1},c.prototype._insertToken=function(t,i,r,c,p){if(t.previous){const f=p.isFace;var y=c?c.glType:-1;if(c){p.polygonOffset&&(t.doRenderLineModePolygonOffset.doIt=p.polygonOffset.doIt,t.doRenderLineModePolygonOffset.enable=p.polygonOffset.enable,t.doRenderLineModePolygonOffset.unit=p.polygonOffset.unit,t.doRenderLineModePolygonOffset.factor=p.polygonOffset.factor);var g=null!==(c._instancingInfos?c._instancingInfos.instanceAttribArrays:i._instancingInfos?i._instancingInfos.instanceAttribArrays:null);i.isCurvedPipe?t.draw=u:this.material.wireframe&&f?t.draw=g?l:a:g?t.draw=d:0===y&&r.vertexPositionArray&&r.vertexPositionArray.nonindexedPoints?t.draw=n:c.nonIndexed?t.draw=s:t.draw=o}return t.doSetMaterialFaces.doubleSided=p.side.doubleSided,t.doSetMaterialFaces.forceSide=p.side.forceSide,t.doSetMaterialFaces.flipSided=p.side.flipSided,p.noZ&&(t._programID|=e.ProgramIDs.NOZ_OBJECT),t.updateLineInfos=p.updateLineInfos,!0}return!1},c.prototype.insert=function(e,t,i,r,a,n,s){var o=this.getSortId(t,i),l=this.tree,d=l.get(o);if(d){var u=!0,c=d.next;if(r.cullingData||1!==r.glType||c.object.id===t.id&&c.geometry===i&&c.dg.glType===r.glType&&c.start+c.count===a&&(c.count+=n,u=!1),u){var p=d.next;d.next=e,e.previous=d,e.next=p,null!==p&&(p.previous=e)}}else d={tree:l,sortId:o,previous:null,next:e},e.previous=d,l.set(o,d);return this._insertToken(e,t,i,r,s)},c.prototype._setRenderingInfos=function(t,i){var r=this.material;var a=(this.dl.ssr.overridableMaterial||r.deferrable)&&r.overridable&&i&&i.materialOverride?i.materialOverride:null;return a&&a.internalMaterialOverride&&a.internalMaterialOverride.material===r&&(a=null),this.materialOverride=a,!(r.overridable&&a&&0===a.getOpacity(r.__dimension)||!a&&0===r.getOpacity())||e._isSelectionMaterial(t)},c.prototype.flagObjectsAsGSSOInvalidated=function(){this.tree.forEach(function(e,t){for(var i=e.next;null!==i;i=i.next)i.object._flagAsGSSOInvalidated()})},c.prototype.add=function({object:i,geometry:a,dg:n,dgInterval:s,materialToUse:o,matApp:l,gasMaterial:d,cpInfos:u=null,tokenCache:c}){const p=this.dl.ssr.id;var y=s?s.start:0,g=s?s.count:0;if(i.isCurvedPipe){var f=e.InstancedCurvedPipeManager,h=f._perRenderableData.get(u.dgIndex);if(!h)return;var _=h[u.index],m=this.tree.get(a.id),S=m?m.next:null,v=f._geometryToInstancingGroup.get(a.id);if(!v)return;var D=2,L=o===r.pickingMaterial,P=!1;if(S)if(S.autoInstancingData){if(S.autoInstancingData.lastId+1>=S.autoInstancingData._maxNbInstances){D=2*S.autoInstancingData._maxNbInstances;var b=t.prototype.allocate_autoInstData(D,L,_.bin);S.autoInstancingData.copyDataTo(b),S.releaseAutoInstData(),S.autoInstancingData=b}}else S.autoInstancingData=t.prototype.allocate_autoInstData(D,L,_.bin);else P=!0,(S=t.prototype.allocateInstancedCurvedPipeSection(i,a,n,y,g,l,this.material.useGASColor?d:null,D,L,_.bin)).next=null,this.insert(S,i,a,n,y,g,c);var A=null;if(L){var E=i.pickingID>>16&255,M=(i.pickingID>>8&255)/255,w=(255&i.pickingID)/255;E|=128,A=(new e.Color).setRGB(E/255,M,w)}S.autoInstancingData.addInstance(i,_,u,A,v._nbCurvePointsPlus2),(T=i._tokens[p])||(T=[],i._tokens[p]=T),P=!0;for(var R=0;R<T.length;R++)if(T[R]===S){P=!1;break}P&&T.push(S)}else{var T,B=t.prototype.allocate(i,a,n,y,g,l,this.material.useGASColor?d:null);if(B.next=null,this.insert(B,i,a,n,y,g,c))(T=i._tokens[p])||(T=[],i._tokens[p]=T),T.push(B)}},c.prototype.getFirstDrawable=function(){if(this.tree.values)var e=this.tree.values().next().value;else{e=null;this.tree.forEach(function(t,i){null===e&&(e=t)})}return e?e.next:null},c}),define("DS/RenderEngineUtils/StateSortingCache",["DS/Mesh/ThreeJS_Base"],function(e){"use strict";const t=e._VisuFilterType;let i=null,r=null;var a=function(t){this.object=t,null===i&&(r=e.MaterialToUse,i=e.DrawCallSorting)};return(a.prototype=Object.create(Array.prototype)).__addCacheItem=function(a,n,s,o){this.push(a);const l=a._inheritanceSolverCache,d=l.material;if(!d)return;const u=this.object;u._sgOrdered=u._sgOrdered||n.drawCallSort===i.NeverSort&&!(!u._occurrence||!u._occurrence.prev&&!u._occurrence.next);const c=l.gasMaterial,p=l.materialToUse;var y=n.buildDisplayRangeList({object:u,geometry:l.geometry,dg:l.dg,dgInterval:l.dgInterval,geomDisposeFunc:l.geomDisposeFunc,matApp:l.matApp,material:d,gasMaterial:c,materialToUse:p,oitActive:o,sectionCapping:s});if(!y.materialPack)return;a.materialPack=y.materialPack,y.dgInterval!==l.dgInterval&&(l.dgInterval=y.dgInterval,l.geometry=y.geometry,l.dg=y.dg);const g=l.dg;g&&n.canForceSideOnSolids&&p===r.originalMaterial&&d._autoForceSide&&(5===g._dimension||c&&0===c.side)&&(u._forceBackFacesOnSolid=!0);const f=a._drawCallCache;{const e=!!g&&(4===g.glType||5===g.glType);f.isFace=e;let i=null;var h=u._getFilter(t.POLYGON_OFFSET);h?i={doIt:!0,enable:h.enabled(),unit:h.unit,factor:h.factor}:e&&!d.polygonOffset&&(i={doIt:!0,enable:0!==u.renderLineMode&&!(d.isWideLine||d.is2DLine),unit:1,factor:1}),f.polygonOffset=i}{const i=e.Constants,a=c||(g?g.gas:null),n=!(!a||d.forceSide)?a:d;let s=n.side,o=n.forceSide;const l=u._getFilter(t._SIDE);l&&(s=l.side,o=!0);let y=s===i.BackSide;u._isDecal()&&(y=y||p!==r.highlightMaterial&&p!==r.pickingMaterial),f.side={doubleSided:s!==i.BackSide&&s!==i.FrontSide,forceSide:o,flipSided:y}}f.noZ=u._occurrence&&u._occurrence.isInNozPass()||n.noz,f.updateLineInfos=!1,r.pickingPassMaterial(p)||(f.updateLineInfos=d.isDashedLine&&d.isCPUPattern||g&&g._updateLineWithShapes)},a}),define("DS/RenderEngineUtils/DisplayRangeListBackToFront",["DS/RenderEngineUtils/DisplayRangeList"],function(e){"use strict";var t=function(t,i){e.call(this,t,i)};return(t.prototype=Object.create(e.prototype)).getSortId=function(e,t){return 0},t.prototype.sortDrawablesBackToFront=function(e){var t=e.matrixWorldInverse.elements,i=this.tree.get(0),r=i?i.next:null;if(r)for(var a=null;null!==r;){if(null!==(a=r.object).renderDepth)a.z=a.renderDepth,r.zSortKey=a.z;else{var n=a.worldRadius,s=a.worldCenter,o=t[2]*s.x+t[6]*s.y+t[10]*s.z+t[14];a.z=o+n,r.zSortKey=a.z}for(var l=r.previous,d=!1;l!==i&&a.z<l.object.z;)l=l.previous,d=!0;var u=r.next;if(d){var c=r.previous;c.next=u,u&&(u.previous=c);var p=l.next;l.next=r,r.next=p,r.previous=l,p&&(p.previous=r)}r=u}},t}),define("DS/RenderEngineUtils/DisplayRangeListNeverSort",["DS/RenderEngineUtils/DisplayRangeList"],function(e){"use strict";var t=function(t,i){e.call(this,t,i)};return(t.prototype=Object.create(e.prototype)).getSortId=function(e,t){return 0},t.prototype.insert=function(e,t,i,r,a,n,s){var o=this.getSortId(t,i),l=this.tree,d=l.get(o);if(d){for(var u=!0,c=d.next;null!==c.next;)c=c.next;r.cullingData||1!==r.glType||c.object.id===t.id&&c.geometry===i&&c.dg.glType===r.glType&&c.start+c.count===a&&(c.count+=n,u=!1),u&&(c.next=e,e.previous=c)}else d={tree:l,sortId:o,previous:null,next:e},e.previous=d,l.set(o,d);return this._insertToken(e,t,i,r,s)},t}),define("DS/RenderEngineUtils/DisplayList",["DS/Mesh/ThreeJS_Base","DS/Visualization/WidelinesHelper","DS/RenderEngineUtils/DisplayRangeList","DS/RenderEngineUtils/DisplayRangeListBackToFront","DS/RenderEngineUtils/DisplayRangeListNeverSort"],function(e,t,i,r,a){"use strict";var n=0,s=0;let o=null,l=null,d=null;var u=function(t){null===l&&(l=e.MaterialToUse,d=e.DrawCallSorting),o=e.displayListPriorityEnum,this.name="",this.string_id=n.toString(),n++,this.active=!0,this.priority=0,this.drawCallSort=d.FrontToBackSort,this.side=e.DoubleSide,this.clearDepth=!1,this.clearStencil=!1,this.useStencil=!1,this.pickingPriority=!1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=null,this.polygonOffset=!1,this.polygonOffsetFactor=1,this.polygonOffsetUnits=1,this.canOIT=!1,this.canForceSideOnSolids=!1,this.hasTranspar=!1,this.hasPoliteDepth=!0,this.hasOcclusionDepth=!0,this.noz=!1,this.setValues(t),this._materialList=[],this._displayRangeLists=new Map,this.index=-1,this.ssrId=-1,this._sortByProgramNextFrame=!0,this._sortByClippingContext=!1},c=function(e,t,i,r,a,n,s,o,l,d){this.material=e,this.occurrenceRenderingOverride=i,this.id=r,this.occurrenceRenderingOverrideId=a,this.decalSortID=n,this.glType=s,this.materialToUse=o,this._objectsTransparentOnGPU=l,this.drawOnlyOnStaticFrames=d,this.displayRangeList=t,this._forceAlphaBlending=!1,t.pack=this};const p="true"===localStorage.getItem("__WEBVISU_NEW_TRANSPARDL_SORTING__");function y(e){return!(e.vertexLineDistancesArray||e.vertexBufferGPU&&e.vertexBufferGPU.layout.has("lineDistance"))}return u.prototype.buildDisplayRangeList=function({object:i,geometry:r,dg:a,dgInterval:n,geomDisposeFunc:u,matApp:g,material:f,gasMaterial:h,materialToUse:_,oitActive:m,sectionCapping:S}){const v=f.isCPUPattern||l.pickingPassMaterial(_);var D="",L=null;i&&i.occurrenceRenderingOverride&&(D=D+"#"+(L=i.occurrenceRenderingOverride).getGSSOId(L.isPurePGP()));var P=null;if(this.drawCallSort===d.DecalSort&&i&&i._isInDecalPass()){D=R+"!"+i._decalData.stencilID+"?"+i._decalData.key+"."+i._decalData.internalSortKey,g&&(D+="l"+g._layer);const e=i._isDecal();P={key:i._decalData.key,internalSortKey:e?i._decalData.internalSortKey:a.glType,layer:e&&g?g._layer:i._decalData.layer}}else p&&this.priority===o.dlTranspar&&i&&!m&&(D=D+"O"+i.id);var b=!1;if(i._vertexColors&&(f.useGASColor||f._isFromGAS)){D=D+"VC"+i._vertexColors;var A=i._vertexColors;b=(A&e.VertexColorType.A)>0||A<=e.VertexColorType.RGBA}var E=!1;f.useGASColor&&!f.transparent&&h&&h._opacity<1&&(D+="FT",E=!0),this.drawCallSort!==d.NeverSort&&this.drawCallSort!==d.RenderDepthSort||(D+="ns"+s++);var M=i.getDynamicMode(_===l.pickingMaterial||_===l.pickingMaterialInstancing);M&&(D+="dyn"),S&&L&&L.clippingContext&&(this._sortByClippingContext=!0);var[w,R]=this._getDisplayRangeList(_,f,L,D);if(f.isWideLine||f.is2DLine){var T=r.computeWideLine(a,f);if(T){var B=!0;if(r.wideLinesLinker&&(r.wideLinesLinker.linkedGeometry.addEventListener("dispose",u),f.isDashedLine&&!v&&y(r.wideLinesLinker.linkedGeometry)&&(r&&!r.vertexIndexArray?(B=!1,f=f._getBodyEdgeMaterial(),[w,R]=this._getDisplayRangeList(_,f,L,D)):t._computeWideLineDistances(r.wideLinesLinker.linkedGeometry))),B){if(n===a)n=T;else{var O=T.getPrimitiveStart(n.primitiveStart),I=T.getPrimitiveStart(n.primitiveStart+n.primitiveCount-1),F=T.getPrimitiveCount(n.primitiveStart+n.primitiveCount-1);O>=0&&I>=0&&(n={start:O,count:I-O+F},T.getPrimitiveStart(0)!==T.start&&(n.start+=T.start))}a=T,r=r.wideLinesLinker.linkedGeometry}}else f=f._getBodyEdgeMaterial(),[w,R]=this._getDisplayRangeList(_,f,L,D)}else f.isDashedLine&&!f.is2DLine&&(v||!y(r)&&!r.isAttributeStale("position")||(r&&!r.vertexIndexArray?(f=f._getBodyEdgeMaterial(),[w,R]=this._getDisplayRangeList(_,f,L,D)):t._computeLineDistances(r)));if(w){var C=w.pack;if(C){if(C.occurrenceRenderingOverride&&C.occurrenceRenderingOverride!==L){C.occurrenceRenderingOverride=L,C.occurrenceRenderingOverrideId=L?L.id:-1,!w._setRenderingInfos(_,L)&&(this._materialList.splice(this._materialList.indexOf(C),1),this._displayRangeLists.delete(R),w.material._removeDisplayRangeList(w),w=null)}}else{var N=new c(f,w,L,R,L?L.id:-1,P,a?a.glType:-1,_,b,M);N._forceAlphaBlending=E,this.drawCallSort===d.NeverSort&&i._sgOrdered||(this._materialList.push(N),this._displayRangeLists.set(R,w),w.material._addDisplayRangeList(w))}}return{materialPack:w?w.pack:null,dgInterval:n,geometry:r,dg:a}},u.prototype._getDisplayRangeList=function(e,t,n,s){var o=(e+"-"+t.id+s).hashCode(),l=this._displayRangeLists.get(o);l||((l=this.drawCallSort===d.NeverSort?new a(t,this):this.drawCallSort===d.BackToFrontSort?new r(t,this):new i(t,this))._setRenderingInfos(e,n)||(l=null));return[l,o]},u.prototype.addDrawable=function({materialPack:e,object:t,geometry:i,dg:r,dgInterval:a,matApp:n,gasMaterial:s,cpInfos:o=null,tokenCache:l}){let u;this.drawCallSort===d.NeverSort&&t._sgOrdered?(u=e.displayRangeList,this._materialList.push(e),this._sortByProgramNextFrame=!0,u.material._addDisplayRangeList(u)):(u=this._displayRangeLists.get(e.id))||(u=e.displayRangeList,this._materialList.push(e),this._sortByProgramNextFrame=!0,this._displayRangeLists.set(e.id,u),u.material._addDisplayRangeList(u)),u.add({object:t,geometry:i,dg:r,dgInterval:a,materialToUse:e.materialToUse,matApp:n,gasMaterial:s,cpInfos:o,tokenCache:l})},u.prototype.empty=function(){for(var e=this._materialList,t=e.length,i=0;i<t;i++){var r=e[i].displayRangeList;r&&r.material._removeDisplayRangeList(r)}e.length=0,this._displayRangeLists.clear()},u.prototype.clearNeverSort=function(){if(this.drawCallSort===d.NeverSort){for(var e=this._materialList,t=[],i=this._displayRangeLists,r=0;r<e.length;r++){var a=e[r],n=a.displayRangeList;n&&n.getFirstDrawable()?t.push(a):(i.delete(a.id),n&&n.material._removeDisplayRangeList(n))}this._materialList=t}},u.prototype.cleanMaterialListAndDRLs=function(){for(var e=this._displayRangeLists,t=0,i=0,r=0,a=-1,n=this._materialList;t<n.length;){var s=n[t];a=s.id;var o=s.displayRangeList;o&&o.getFirstDrawable()?r>0?(n.splice(i,r),t=++i,r=0):i=++t:(r++,e.delete(a),o&&o.material._removeDisplayRangeList(o),t++)}r>0&&n.splice(i,r)},u.prototype.init=function(){},u.prototype.finalize=function(){},u.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var i=e[t];void 0!==i?t in this&&(this[t]=i):console.warn("DisplayList: '"+t+"' parameter is undefined.")}},u}),define("DS/RenderEngineUtils/InheritanceSolver",["DS/Mesh/ThreeJS_Base","DS/RenderEngineUtils/StateSortingCache","DS/RenderEngineUtils/StateSortingCacheItem"],function(e,t,i){"use strict";function r(t){return!(!t||!(t instanceof e.MeshBasicMaterial||t instanceof e.MeshPhongMaterial||t instanceof e.MeshLambertMaterial||t instanceof e.PhysicalMaterial)||t.map)}const a=e._VisuFilterType;let n=null,s=0,o=0,l=0,d=0,u=null,c=null,p=null;function y(e,t){if(!e||!t)return null;let i=e;return t.glType!=l&&t.glType!=d||!e.line||(i=e.line),t.glType==o&&e.point&&(i=e.point),i._deferredMaterialsInit||i.updateDeferredMaterials(),i}function g(e){if("true"===localStorage.getItem("forceCPUOutlines"))return e.isOrtho;return e._viewpoint&&e._viewpoint._2DMode&&e.isOrtho}function f(t,i,r){return t._viewpoint&&t._viewpoint.isNative2D()&&t._viewpoint._depthMode?i.gas&&i.gas._type!=e.GASTypeEnum.NOZ?null:r?{depthPriority:{value:r._priority-4+i._depthPriority}}:{depthPriority:{value:i._depthPriority}}:null}let h=null;return class{constructor(e){this.renderer=e,this.gl=null,this.reset(),this._objectsWithOutlines=null,this.camera=null,this.onGeometryDisposeDS=null}_useCPUOutlines(e){return g(e)}_getMaterialMode(e){return this.renderer.getMaterialMode(this.object,e,this.zOnlyPass)}enableOutlineHanding(t,i){if(!this.camera)throw"Globals are not set, camera not found";if(this.outlineStruct=null,t){const t=this.camera;this.outlineStruct=i;let r=null;g(t)&&(r=new e.Vector4(0,0,1,0).applyMatrix4(t.matrixWorld)),i.outlinesCameraDirection=r;const a=this._objectsWithOutlines&&this._objectsWithOutlines.cameraDir,n=!!r!=!!a||r&&!r.equals(a);this._objectsWithOutlines&&n&&(this._objectsWithOutlines.cameraDir=r,this._objectsWithOutlines.objects.forEach(e=>e._flagAsGSSOInvalidated()),this._objectsWithOutlines.objects.clear())}}setContext(t,i,r){this.gl=t,s=e.GeomTypeEnum.FACE,o=t.POINTS,l=t.LINES,d=t.LINE_STRIP,u=i,c=r,p||(p=new e.MeshBasicMaterial)}setFrameContext(t,i,r,a,n,s){this.getDLFromObject=t,this.camera=i,this.defaultAppearanceType=r,this.QAAutomationMode=r===e.DefaultAppearanceMode.__QA_AUTOMATION__,this.stateSortingResultID=a,this.zOnlyPass=n,this.pickingPass=s}reset(){this.getDLFromObject=null,this.QAAutomationMode=!1,this.defaultAppearanceType=-1,this.stateSortingResultID=-1,this.outlineStruct=null,this.object=null,this.cappingMaterial=null,this.zOnlyPass=!1,this.pickingPass=!1}_registerObjectWithOutlines(){this._objectsWithOutlines||(this._objectsWithOutlines={cameraDir:this.outlineStruct.outlinesCameraDirection,objects:new Set}),this._objectsWithOutlines.objects.add(this.object)}_handleOutlines(t){if(!this.outlineStruct)return;const i=this.object,r=this.renderer,a=this.outlineStruct,n=(this.getDLFromObject,this.onGeometryDisposeDS);if(i.fromLoadedModel&&t&&t.getMask()&e.OutlineMask)if(i.geometry&&i.geometry.length&&i.geometry[0]&&i.geometry[0].vertexIndexArray){let s=null;const o=a.outlinesCameraDirection;o&&((s=o.clone()).applyMatrix4((new e.Matrix4).getInverse(i.matrixWorld)),s=new e.Vector3(s.x,s.y,s.z).normalize());let{outlineBG:l,created:d,invalidateGSSO:c}=u.prepareOutlines({object:i,width:t._outlineWidth,viewDirection:s,_sortCount:a.sortCount,_gl:this.gl,visibleSpace:r.visibleSpace,showHiddenOutlines:1===t._hiddenEdges});l.length>0&&(this._registerObjectWithOutlines(),c&&a.objectWithTransientGSSO.add(i),d&&(a.outlinesCreated=!0));for(let e=0;e<l.length;e++){const i=l[e];d&&i.addEventListener("dispose",n);const r=i.drawingGroups[0];this._addDGToDL({geometry:i,dg:r,dgInterval:r,material:r.material,originalMaterial:r.material,renderMode:t})}}else r._NoMeshInRamWarningCount<10&&(console.warn("OutlineBuilding unavailable, make sure noMeshInRAM is inactive"),r._NoMeshInRamWarningCount++)}_handleSectionLines(t){let i=null;if(t&&t._maskWithDefault&e.SectionLineMask){const e=this.object,r=this.renderer,a=(this.getDLFromObject,this.onGeometryDisposeDS);if(e.geometry&&e.geometry.length&&e.geometry[0]&&e.geometry[0].vertexIndexArray){let n=e.sectionLinesBuilder&&e.sectionLinesBuilder.sectionLineGeometry;const s=e.occurrenceRenderingOverride&&e.occurrenceRenderingOverride.sectionLinesProperties,o=s?s.color:null,l=s?s.width:1,d=e.occurrenceRenderingOverride&&e.occurrenceRenderingOverride.clipPlanes;let u=null;e.occurrenceRenderingOverride&&e.occurrenceRenderingOverride.clippingContext&&(u=e.occurrenceRenderingOverride.clippingContext._getSectionLinesArray());const p=n&&e.layer&&!e.layer.upToDate,y=!p&&e.sectionLinesBuilder&&e.sectionLinesBuilder.update({width:l,color:o,clipPlanes:d,sectionLines:u});if(!p&&y||(e.sectionLinesBuilder&&e.sectionLinesBuilder.dispose(),e.sectionLinesBuilder=null,n=null,e.layer&&(e.layer.upToDate=!0)),!n&&!e.sectionLinesBuilder){const t=new c({renderable:e,renderer:r,lineWidth:l,color:o,clipPlanes:d,sectionLines:u});t.computeSectionLineGeometry(),(n=t.sectionLineGeometry)&&n.addEventListener("dispose",a),e.sectionLinesBuilder=t}if(n){const e=n.drawingGroups[0];null===o&&(i=e.material),this._addDGToDL({geometry:n,dg:e,dgInterval:e,material:e.material,originalMaterial:e.material,renderMode:t})}}else r._NoMeshInRamWarningCount<10&&(console.warn("SectionLineBuilding unavailable, make sure noMeshInRAM is inactive"),r._NoMeshInRamWarningCount++)}return i}_handleObjectSectionCapping(e,t,i,r){const a=this.renderer,n=this.object,o=n.renderPointsOnly;let l=null;for(let t=0;t<e.length;t++){const n=e[t].drawingGroups;let d=0;for(let e=0;e<n.length;e++){const t=n[e];if(t._geomType===s&&!o){let e;e=i&&t.material?t.material:t.gas.isGAS?t.gas.getMaterial(null,4,t.gas,a):t.gas,!t._completeSolid||e.opacity>=1?t.count>d&&(l=e,d=t.count):r.add(t)}}}return t&&!a.cuttingScene&&l&&l.color&&(n.sectionLinesBuilder.setColor(l.color),l=null),l}_getModifiedOriginalMaterial(e,t,i,r,a){const n=this.renderer,o=this.object._occurrence;let l=t;!i&&o&&o.__solvedSubstituteMaterials&&(o.__solvedSubstituteMaterials.has(t)?l=o.__solvedSubstituteMaterials.get(t):t._cloneOrigin&&o.__solvedSubstituteMaterials.has(t._cloneOrigin)&&(l=o.__solvedSubstituteMaterials.get(t._cloneOrigin)));let d=r;return i&&(l=l.getGeomTypeDeferredMaterial(e._geomType,{boundaryEdge:n.boundaryEdgeMaterialInfo,smoothEdge:a._halfVisibleSmoothEdges>0}),d=null),(i&&e._geomType===s||this.QAAutomationMode)&&(l=l.getPredefinedMaterial(n.noiseTexture3D,this.defaultAppearanceType,n._customMaterialModeParams),d=null),l._deferredMaterialsInit||l.updateDeferredMaterials(),[l,d]}_getBackgroundViewModeMaterial(t,i){return this.renderer._backgroundViewMode===e.BackgroundViewMode.GHOST&&t.applyBackgroundViewMode?h||((h=new e.MeshBasicMaterial({force:!0,side:e.Constants.DoubleSide,color:new e.Color(16711680),transparent:!0}))._activatePDSFXMigrated("BGViewModeGhost"),h.setPDSFXOverridableFunctions(null,{ProcessFinalColor:function(e,t){const i=e.variableHandler;return`\n                    ${i.dereference()+t[0]} = ${i.vec4()}(1.0, 1.0, 1.0, 0.1);\n                `}}),h):i}checkGASStructCommon(t){const i=this.object,r=this.renderer;if(this.pickingPass&&t._noPick)return this._earlyExit(),null;const n=i._getFilter(a.ZMODE)||r._GlobalZModeFilter;return n&&(t._type===e.GASTypeEnum.NOZ&&n.enableZ?(t=t.clone())._type=e.GASTypeEnum._SKIN:t._type===e.GASTypeEnum.NOZ||n.enableZ||((t=t.clone())._type=e.GASTypeEnum.NOZ)),t}doLookFilter(e,t,i,r){const n=this.object._getFilter(a.LOOK);if(n){const a=n.material;a&&(e=null,t=!1,i=y(a,r))}return[e,t,i]}_handleOldWorkFlowCommon(e,t,i,a,o,l,d,u){const c=this.object,g=this.renderer;let f=null,h=!1,_=y(t.gas,t);if(l&&d)f=y(d,t);else{const e=c.material||p,i=o||!c.fromLoadedModel,r=e.force&&"forceGeomTypeFACE"!==e.force,a=e.force&&"forceGeomTypeFACE"===e.force,n=i&&r;f=y(e,t),n||(o&&t.material&&t.material.updateDeferredMaterials?f=y(t.material,t):(f=_,h=!0),a&&t._geomType===s&&(f=e,h=!1))}if(this.pickingPass&&t._noPick)return void this._earlyExit();f=this._getBackgroundViewModeMaterial(c,f),!l&&u&&t._geomType===s&&(f=u),[n,h,f]=this.doLookFilter(null,h,f,t),[f,n]=this._getModifiedOriginalMaterial(t,f,h,null,e);const m=g.materialToUse;let S=f._deferredMaterials[m];if(S){if(g.cuttingScene&&!r(S)&&(S=_||S),l&&g.cuttingScene&&t.glType>=4&&(null!==this.cappingMaterial?S=this.cappingMaterial:this.cappingMaterial=S),f.backMaterial){const r=f.backMaterial._deferredMaterials[m];r&&this._addDGToDL({geometry:a,dg:t,dgInterval:i,material:r,gasMaterial:_,originalMaterial:f,renderMode:e,materialMode:o})}this._addDGToDL({geometry:a,dg:t,dgInterval:i,material:S,gasMaterial:_,originalMaterial:f,renderMode:e,materialMode:o})}else this._earlyExit()}_handleLayerOldWorkflow(e,t,i,r){const a=e.drawableGroup,n=e.drawableInterval,s=e.geometry;this._handleOldWorkFlowCommon(i,a,n,s,r,!0,t,null)}_handleGeometryOldWorkflow(e,t,i,r){const a=this.object,n=this.renderer,s=a.renderPointsOnly,l=a.material||p,d=i||!a.fromLoadedModel,u=l.force&&"forceGeomTypeFACE"!==l.force;let c=null,y=null;d&&u||!n.cuttingScene&&!r||(y=new Set,c=this._handleObjectSectionCapping(e,r,i,y)),c&&!n.cuttingScene&&("forceGeomTypeFACE"!==l.force||this.QAAutomationMode||(c=l));for(let r=0;r<e.length;r++){const a=e[r],n=a.drawingGroups;for(let e=0;e<n.length;e++){const r=n[e],l=r.glType;if(s&&l!=o){this._earlyExit();continue}let d=c;null!==y&&y.has(r)&&(d=null),this._handleOldWorkFlowCommon(t,r,r,a,i,!1,null,d)}}}_handleNewWorkFlowCommon(t,i,a,n,o,l,d,u,c,p){const g=this.object,h=this.renderer,_=i.glType;let m=!1,S=null;const v=g.gas;let D=null;if(!(D=v?l.isGAS?l.clone().merge(v):v:l.isGAS?l:null)||!u||d||0!==i.glType&&1!==i.glType||D._type!==e.GASTypeEnum.SKIN||(d=u._getMaterialFromGLType(4,e.GeomTypeEnum.FACE)),!p){const e=g.material;d&&u||!o&&g.fromLoadedModel||!e||!e.force||"forceGeomTypeFACE"===e.force&&i._geomType!==s||(d=y(e,i))}if(S=v?v.getMaterial(l,_,i.gas.isGAS?i.gas:null,h,f(this.camera,g,l),d):l.isGAS?l.getMaterial(null,_,i.gas,h,f(this.camera,g,l),d):l,D&&!(D=this.checkGASStructCommon(D)))return;S&&!d&&(d=S,m=!0),[u,m,d]=this.doLookFilter(u,m,d,i),d=this._getBackgroundViewModeMaterial(g,d),[d,u]=this._getModifiedOriginalMaterial(i,d,m,u,t);const L=h.materialToUse;let P=d._deferredMaterials[L];if(P){if(h.cuttingScene&&S&&!r(P)&&(P=S),d.backMaterial){const e=d.backMaterial._deferredMaterials[L];e&&this._addDGToDL({geometry:n,dg:i,dgInterval:a,material:e,originalMaterial:d,renderMode:t,matApp:u,gasMaterial:S,gasStruct:D,materialMode:o})}c&&h.cuttingScene&&_>=4&&(null!==this.cappingMaterial?d=P=this.cappingMaterial:this.cappingMaterial=P),this._addDGToDL({geometry:n,dg:i,dgInterval:a,material:P,originalMaterial:d,renderMode:t,matApp:u,gasMaterial:S,gasStruct:D,materialMode:o})}else this._earlyExit()}_solveIntervalMaterialNewWorkflow(t,i,r){const a=this.object,n=a.matApp;let s=null,o=null;return t.isMatApp&&(o=(s=t.solveInheritance(n,a._occurrence.depth))===n?r:t._getMaterialFromGLType(i.glType,i._geomType)),o||t.isMatApp||(s=r?n:null,(o=r)||(o=t instanceof e.Material?y(t,i):null)),[s,o]}_handleLayerNewWorkflow(e,t,i,r,a){const n=this.object,s=e.drawableGroup,o=s.glType;let l=null,d=null,u=!1;if(a){const e=n.matApp;let i=e&&e._getMaterialFromGLType(o,s._geomType);t?(u=!0,[l,d]=this._solveIntervalMaterialNewWorkflow(t,s,i)):s.material&&([l,d]=this._solveIntervalMaterialNewWorkflow(s.material,s,i)),d||(l=e,d=i)}this._handleNewWorkFlowCommon(r,s,e.drawableInterval,e.geometry,a,i,d,l,!0,u)}_handleGeometryNewWorkflow(e,t,i,r){const a=this.object,n=a.renderPointsOnly,l=function(e){return e&&e.materialMode<2}(a);let d=null,u=null;(this.renderer.cuttingScene||r)&&(u=new Set,d=this._handleObjectSectionCapping(e,r,i,u));const c=l?i:i||!a.fromLoadedModel;for(let r=0;r<e.length;r++){const l=e[r],p=l.drawingGroups;for(let e=0;e<p.length;e++){const r=p[e],y=r.glType;if(n&&y!=o){this._earlyExit();continue}let g=null,f=null;if(c){const e=a.matApp;let t=e&&e._getMaterialFromGLType(y,r._geomType);r.material&&([g,f]=this._solveIntervalMaterialNewWorkflow(r.material,r,t)),f||(g=e,f=t),!d||e&&g===e||r._geomType!==s||null!==u&&u.has(r)||(f=d)}this._handleNewWorkFlowCommon(t,r,r,l,i,r.gas,f,g,!1,!1)}}}_handleObjectWithLayers(e,t,i){const r=this.object,a=r.layer,n=this.renderer,s=r.renderPointsOnly,l=a.layers.length;this.cappingMaterial=null;for(let d=0;d<l;d++){const l=a.layers[d];let u=l.drawableInterval.getMaterial();if(l.drawableInterval.skip(r,n.visibleSpace)){this._earlyExit();continue}const c=l.drawableGroup,p=c.glType;if(s&&p!=o)this._earlyExit();else if(e||u&&u.isMatApp){u||(u=c.material);let e=l.drawableInterval.gas;e||(e=c.gas),this._handleLayerNewWorkflow(l,u,e,t,i)}else this._handleLayerOldWorkflow(l,u,t,i)}}_handleObject(e,t,i,r){const a=this.object;a&&a.occurrenceRenderingOverride&&a.occurrenceRenderingOverride.materialOverride&&(a.occurrenceRenderingOverride.materialOverride.disablePGP=i);let n=a.geometry;n.length||0===n.length||(n=[n]),e?this._handleGeometryNewWorkflow(n,t,i,r):this._handleGeometryOldWorkflow(n,t,i,r)}_earlyExit(){const e=this.object,t=this.renderer,r=e._gsso_cache[this.stateSortingResultID];r.length||r.__addCacheItem(new i({dlIndex:-1,material:null,resetFrameIndex:t.resetGSSOCacheFrame,renderLineMode:e.renderLineMode}),null)}_addDGToDL({material:t,originalMaterial:i,dg:r=null,dgInterval:a=null,geometry:n,renderMode:s=null,matApp:o=null,gasMaterial:l=null,gasStruct:d=null,materialMode:u=!1}){const c=this.object;let p=!0;{const t=this.renderer,i=t.materialToUse;let a=s?s._maskWithDefault:e.RenderMode.defaultMask;const n=i===e.MaterialToUse.pickingMaterial||i===e.MaterialToUse.highlightMaterial;if(n||(a&=~e.Constants.SurfacicPointRenderPointMask),r){var y=c&&c.getFilterGeomType(),g=y||r._geomType;if(g||(g=0===r.glType?e.GeomTypeEnum.UNKNOWN_0D:e.GeomTypeEnum.UNKNOWN),p=(g&a)>0,s&&s._repViewNothing&&!n&&(p=!1),t.renderVolumesOnly){var f=l?l.side:r.gas?r.gas.side:-1;0===r.glType||1===r.glType||g&e.RenderMode.pointsMask||g&e.RenderMode.linesMask?p=!1:f===e.DoubleSide&&(p=!1)}if(this.QAAutomationMode){var h=e.__QA_AUTOMATION_MASK__;p&&(p=(g&h)>0),n&&(p=(g&(h|=e.BodyLinesMask))>0)}}}p&&t.visible&&this.renderer.addDGToDL({object:c,geometry:n||c.geometry,dg:r,dgInterval:a,material:t,originalMaterial:i,renderMode:s,matApp:o,gasMaterial:l,gasStruct:d,getDLFromObjectFunc:this.getDLFromObject,geomDisposeFunc:this.onGeometryDisposeDS,camera:this.camera,materialMode:u})||this._earlyExit()}solve(i){this.object=i;const r=this.object._occurrence,n=this.renderer,s=n.materialToUse,o=i.material;let l=null;const d=i.matApp,u=n.newMaterialInheritance||!!function(e){if(!e.geometry.length)return!1;const t=e.geometry[0].drawingGroups;return!(!t||!t.length)&&t[0].gas&&t[0].gas.isGAS}(i)||!!d;i._gsso_cache||(i._gsso_cache={}),i._gsso_cache[this.stateSortingResultID]||(i._gsso_cache[this.stateSortingResultID]=new t(i));var c=i._getFilter(a._MATERIAL_TO_USE);if(c&&c.materialToUse!==s)return void this._earlyExit();var p=i._getFilter(a.NO_HIGHLIGHT);if(p&&s===e.MaterialToUse.highlightMaterial)if(n.currentPass&&currentPass.name.includes("prehlRenderPass")){if(p.skipPreHL)return void this._earlyExit()}else if(p.skipHL)return void this._earlyExit();if(r&&r._isFurtiveFiltered())return void this._earlyExit();if(s===e.MaterialToUse.originalMaterial&&(i._forceBackFacesOnSolid=!1),!u&&o&&(o._deferredMaterialsInit||o.updateDeferredMaterials(),o.line&&!o.line._deferredMaterialsInit&&o.line.updateDeferredMaterials(),o.point&&!o.point._deferredMaterialsInit&&o.point.updateDeferredMaterials(),l=o._deferredMaterials[s]),void 0===l&&(l=o),i._updateBackgroundViewMode(this.renderer._invertBackgroundNodes),n._backgroundViewMode===e.BackgroundViewMode.NO_DISPLAY&&i.applyBackgroundViewMode)return void this._earlyExit();let y=i._getFilter(a.PLANE_VIEW_MODE);if(i._applyPlaneViewMode=e.PlaneViewMode.NORMAL,y&&y.mode!==e.PlaneViewMode.NORMAL){for(let t of y.planeFilters)if(i._updatePlaneViewMode(t.plane,t.mode),i._applyPlaneViewMode===e.PlaneViewMode.NO_DISPLAY)return void this._earlyExit();if(this.pickingPass&&(i._applyPlaneViewMode===e.PlaneViewMode.LOWLIGHT_NO_PICK||i._applyPlaneViewMode===e.PlaneViewMode.NO_PICK))return void this._earlyExit()}let g=n.getRenderMode(i);if(i.renderLineMode=g.getMasks()[1],2===i.geometry._type||i.geometry.length>=0){const e=i.layer,t=this._getMaterialMode(g);this._handleOutlines(g);const r=this._handleSectionLines(g);e?this._handleObjectWithLayers(u,g,t):this._handleObject(u,g,t,r)}else u&&o?(o._deferredMaterialsInit||o.updateDeferredMaterials(),o.backMaterial&&this._addDGToDL({material:o.backMaterial._deferredMaterials[s],originalMaterial:o}),this._addDGToDL({material:o._deferredMaterials[s],originalMaterial:o})):(l.backMaterial&&this._addDGToDL({material:l.backMaterial._deferredMaterials[s],originalMaterial:o}),this._addDGToDL({material:l,originalMaterial:o}))}}}),define("DS/RenderEngineUtils/StateSortingResult",["DS/Mesh/ThreeJS_Base","DS/RenderEngineUtils/DisplayList","DS/Visualization/CullingSystem"],function(e,t,i){"use strict";var r=null,a=null,n=null,s=i.__CullingSystemFactory;e.nbDisplayListPriority=73,e.displayListPriorityEnum={},e.displayListPriorityEnum.dlSolids=72,e.displayListPriorityEnum.dlSurfaces=71,e.displayListPriorityEnum.dlSurfacesCurvedPipes=70,e.displayListPriorityEnum.dlOutlines=69,e.displayListPriorityEnum.dlEdges=68,e.displayListPriorityEnum.dlPoints=67,e.displayListPriorityEnum.dlDecals=66,e.displayListPriorityEnum.dlBack=65,e.displayListPriorityEnum.dlTranspar1D=64,e.displayListPriorityEnum.dlSurfacesCurvedPipesTranspar=63,e.displayListPriorityEnum.dlTranspar=62,e.displayListPriorityEnum.dlEdgeAdjacenceSelection=61,e.displayListPriorityEnum.dlEdgePrimitiveSelection=60,e.displayListPriorityEnum.dlPointPrimitiveSelection=59,e.displayListPriorityEnum.dlNoZ=58,e.displayListPriorityEnum.dlNoZTranspar=57,e.displayListPriorityEnum.dlRenderDepth=56.5,e.displayListPriorityEnum.dlDepthValue=56,e.displayListPriorityEnum.dlDepthValue2=55,e.displayListPriorityEnum.OTHER3D_2DMODE=54,e.displayListPriorityEnum.OTHER3D=36,e.displayListPriorityEnum.priority0=53,e.displayListPriorityEnum.priority1=51,e.displayListPriorityEnum.priority2=49,e.displayListPriorityEnum.priority3=47,e.displayListPriorityEnum.priority4=45,e.displayListPriorityEnum.priority5=43,e.displayListPriorityEnum.priority6=41,e.displayListPriorityEnum.priority7=39,e.displayListPriorityEnum.priority8=37,e.displayListPriorityEnum.priority9=34,e.displayListPriorityEnum.priority10=32,e.displayListPriorityEnum.priority11=30,e.displayListPriorityEnum.priority12=28,e.displayListPriorityEnum.priority13=26,e.displayListPriorityEnum.priority14=24,e.displayListPriorityEnum.priority15=22,e.displayListPriorityEnum.priorityP0=52,e.displayListPriorityEnum.priorityP1=50,e.displayListPriorityEnum.priorityP2=48,e.displayListPriorityEnum.priorityP3=46,e.displayListPriorityEnum.priorityP4=44,e.displayListPriorityEnum.priorityP5=42,e.displayListPriorityEnum.priorityP6=40,e.displayListPriorityEnum.priorityP7=38,e.displayListPriorityEnum.priorityP8=35,e.displayListPriorityEnum.priorityP9=33,e.displayListPriorityEnum.priorityP10=31,e.displayListPriorityEnum.priorityP11=29,e.displayListPriorityEnum.priorityP12=27,e.displayListPriorityEnum.priorityP13=25,e.displayListPriorityEnum.priorityP14=23,e.displayListPriorityEnum.priorityP15=21,e.displayListPriorityEnum.HEDGE=20,e.displayListPriorityEnum.HOTHER=19,e.displayListPriorityEnum.FURTIVE_EDGE=18,e.displayListPriorityEnum.FURTIVE=17,e.displayListPriorityEnum.OTHER2D=16,e.displayListPriorityEnum.TRANSPAR2DP15=15,e.displayListPriorityEnum.TRANSPAR2DP14=14,e.displayListPriorityEnum.TRANSPAR2DP13=13,e.displayListPriorityEnum.TRANSPAR2DP12=12,e.displayListPriorityEnum.TRANSPAR2DP11=11,e.displayListPriorityEnum.TRANSPAR2DP10=10,e.displayListPriorityEnum.TRANSPAR2DP9=9,e.displayListPriorityEnum.TRANSPAR2DP8=8,e.displayListPriorityEnum.TRANSPAR2DP7=7,e.displayListPriorityEnum.TRANSPAR2DP6=6,e.displayListPriorityEnum.TRANSPAR2DP5=5,e.displayListPriorityEnum.TRANSPAR2DP4=4,e.displayListPriorityEnum.TRANSPAR2DP3=3,e.displayListPriorityEnum.TRANSPAR2DP2=2,e.displayListPriorityEnum.TRANSPAR2DP1=1,e.displayListPriorityEnum.TRANSPAR2DP0=0,e.displayListPriorityEnum.priority=[e.displayListPriorityEnum.priority0,e.displayListPriorityEnum.priority1,e.displayListPriorityEnum.priority2,e.displayListPriorityEnum.priority3,e.displayListPriorityEnum.priority4,e.displayListPriorityEnum.priority5,e.displayListPriorityEnum.priority6,e.displayListPriorityEnum.priority7,e.displayListPriorityEnum.priority8,e.displayListPriorityEnum.priority9,e.displayListPriorityEnum.priority10,e.displayListPriorityEnum.priority11,e.displayListPriorityEnum.priority12,e.displayListPriorityEnum.priority13,e.displayListPriorityEnum.priority14,e.displayListPriorityEnum.priority15],e.displayListPriorityEnum.priorityP=[e.displayListPriorityEnum.priorityP0,e.displayListPriorityEnum.priorityP1,e.displayListPriorityEnum.priorityP2,e.displayListPriorityEnum.priorityP3,e.displayListPriorityEnum.priorityP4,e.displayListPriorityEnum.priorityP5,e.displayListPriorityEnum.priorityP6,e.displayListPriorityEnum.priorityP7,e.displayListPriorityEnum.priorityP8,e.displayListPriorityEnum.priorityP9,e.displayListPriorityEnum.priorityP10,e.displayListPriorityEnum.priorityP11,e.displayListPriorityEnum.priorityP12,e.displayListPriorityEnum.priorityP13,e.displayListPriorityEnum.priorityP14,e.displayListPriorityEnum.priorityP15];var o=0,l=function(t,i){null===r&&(r=e.Constants,a=e.MaterialToUse,n=e.DrawCallSorting),this.id=o++,this._displayLists=[],this._resetGSSOCacheIndex=-1,this._pickingPriorityMapping=null,this.pass=t,this.materialToUse=i,this.overridableMaterial=i===a.originalMaterial||i===a.oitAccumMaterial||i===a.oitRevealMaterial||i===a.transparentShadowMaterial||i===a.ZOnlyMaterial,this.init()};function d(t,i){return t?"c"+(t._renderingRole===e._CameraRoles.NONE||i&&i._checkCamera?t.id:t._renderingRole):"c"}l.prototype.init=function(){for(var i=new t({name:"SOLID",priority:e.displayListPriorityEnum.dlSolids,drawCallSort:n.FrontToBackSort,side:r.FrontSide,polygonOffset:!0}),a=new t({name:"SURFACE",priority:e.displayListPriorityEnum.dlSurfaces,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!0}),s=new t({name:"EDGE",priority:e.displayListPriorityEnum.dlEdges,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1}),o=new t({name:"OUTLINE",priority:e.displayListPriorityEnum.dlOutlines,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1}),l=new t({name:"SURFACE_CURVED_PIPE",priority:e.displayListPriorityEnum.dlSurfacesCurvedPipes,drawCallSort:n.FrontToBackSort,side:e.DoubleSide,polygonOffset:!0}),d=new t({name:"SURFACE_CURVED_PIPE_TRANSPAR",priority:e.displayListPriorityEnum.dlSurfacesCurvedPipesTranspar,drawCallSort:n.BackToFrontSort,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,hasTranspar:!0,canOIT:!0,hasOcclusionDepth:!1}),u=new t({name:"BACK",priority:e.displayListPriorityEnum.dlBack,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,depthFunc:"GREATER",canOIT:!0,hasPoliteDepth:!1,hasOcclusionDepth:!1}),c=new t({name:"POINT",priority:e.displayListPriorityEnum.dlPoints,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1}),p=new t({name:"DECALS",priority:e.displayListPriorityEnum.dlDecals,drawCallSort:n.DecalSort,side:r.DoubleSide,polygonOffset:!0,hasTranspar:!0,hasPoliteDepth:!1,hasOcclusionDepth:!1,canOIT:!0}),y=new t({name:"TRANSPAR1D",priority:e.displayListPriorityEnum.dlTranspar1D,drawCallSort:n.BackToFrontSort,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,hasTranspar:!0,canOIT:!0,hasOcclusionDepth:!1}),g=new t({name:"TRANSPAR",priority:e.displayListPriorityEnum.dlTranspar,drawCallSort:n.BackToFrontSort,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,hasTranspar:!0,canOIT:!0,hasOcclusionDepth:!1,canForceSideOnSolids:!0}),f=new t({name:"EDGEADJACENCESELECTION",priority:e.displayListPriorityEnum.dlEdgeAdjacenceSelection,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1,hasPoliteDepth:!1,depthTest:!1}),h=new t({name:"EDGEPRIMITIVESELECTION",priority:e.displayListPriorityEnum.dlEdgePrimitiveSelection,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1,hasPoliteDepth:!1,depthTest:!1}),_=new t({name:"POINTPRIMITIVESELECTION",priority:e.displayListPriorityEnum.dlPointPrimitiveSelection,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!1,hasOcclusionDepth:!1,hasPoliteDepth:!1,depthTest:!1}),m=new t({name:"RenderDepth",priority:e.displayListPriorityEnum.dlRenderDepth,drawCallSort:n.RenderDepthSort,side:r.DoubleSide,polygonOffset:!0,depthWrite:!1,hasTranspar:!0,canOIT:!1,hasOcclusionDepth:!1,noz:!0,canForceSideOnSolids:!0}),S=new t({name:"NOZ",priority:e.displayListPriorityEnum.dlNoZ,drawCallSort:n.FrontToBackSort,side:r.DoubleSide,polygonOffset:!0,clearDepth:!0,hasPoliteDepth:!1,hasOcclusionDepth:!1,noz:!0}),v=new t({name:"DEPTHVALUE2",priority:e.displayListPriorityEnum.dlDepthValue2,drawCallSort:n.NeverSort,side:r.DoubleSide,hasPoliteDepth:!1,hasOcclusionDepth:!1,depthTest:!1,noz:!0}),D=new t({name:"DEPTHVALUE",priority:e.displayListPriorityEnum.dlDepthValue,drawCallSort:n.FrontToBackSort,side:r.DoubleSide}),L=new t({name:"NOZTRANSPAR",priority:e.displayListPriorityEnum.dlNoZTranspar,drawCallSort:n.BackToFrontSort,side:r.DoubleSide,polygonOffset:!0,hasPoliteDepth:!1,hasOcclusionDepth:!1,depthTest:!1,noz:!0}),P=new t({name:"OTHER2D",priority:e.displayListPriorityEnum.OTHER2D,drawCallSort:n.NeverSort,side:r.DoubleSide,noz:!0,depthTest:!0,depthWrite:!0,hasOcclusionDepth:!0,hasPoliteDepth:!1}),b=new t({name:"OTHER3D",priority:e.displayListPriorityEnum.OTHER3D,drawCallSort:n.NeverSort,side:r.DoubleSide,depthTest:!1,noz:!0,hasOcclusionDepth:!0,hasPoliteDepth:!1}),A=0;A<16;A++){var E=new t({name:"NOZPRIORITY"+A,priority:e.displayListPriorityEnum.priority[A],drawCallSort:n.NeverSort,side:r.DoubleSide,polygonOffset:!0,depthTest:!1,hasOcclusionDepth:!0,hasPoliteDepth:!1,noz:!0});this.addDisplayList(E)}for(A=0;A<16;A++){E=new t({name:"NOZPRIORITYP"+A,priority:e.displayListPriorityEnum.priorityP[A],drawCallSort:n.NeverSort,side:r.DoubleSide,polygonOffset:!0,depthTest:!1,depthFunc:"ALWAYS",hasOcclusionDepth:!0,hasPoliteDepth:!1,noz:!0});this.addDisplayList(E)}for(A=0;A<16;A++){E=new t({name:"TRANSPAR2DP"+A,priority:e.displayListPriorityEnum.TRANSPAR2DP0+A,drawCallSort:n.NeverSort,side:r.DoubleSide,depthTest:!0,noz:!0,depthWrite:!1,hasPoliteDepth:!1,hasOcclusionDepth:!1,hasTranspar:!0});this.addDisplayList(E)}this.addDisplayList(i),this.addDisplayList(a),this.addDisplayList(l),this.addDisplayList(d),this.addDisplayList(o),this.addDisplayList(s),this.addDisplayList(u),this.addDisplayList(c),this.addDisplayList(p),this.addDisplayList(g),this.addDisplayList(y),this.addDisplayList(f),this.addDisplayList(h),this.addDisplayList(_),this.addDisplayList(S),this.addDisplayList(L),this.addDisplayList(P),this.addDisplayList(b),this.addDisplayList(D),this.addDisplayList(v),this.addDisplayList(m)},l.prototype.addDisplayList=function(e){var t,i=!1;if(this._displayLists.length&&void 0!==e.priority)for(t=0;t<this._displayLists.length&&!i;t++){var r=this._displayLists[t].priority;e.priority>r&&(this.insertDisplayList(e,t),i=!0)}for(i||this._displayLists.push(e),t=0;t<this._displayLists.length;t++)this._displayLists[t].index=t;return e.ssrId=this.id,e.ssr=this,e},l.prototype.insertDisplayList=function(e,t){this._displayLists.splice(t,0,e)},l.prototype.getDisplayListByPriority=function(e){for(var t=0;t<this._displayLists.length;t++)if(this._displayLists[t].priority===e)return this._displayLists[t];return null},l.prototype.getDisplayListByName=function(e){for(var t=0;t<this._displayLists.length;t++)if(this._displayLists[t].name===e)return this._displayLists[t];return null};var u={_getStateSortingResult:function(e,t,i,r,a){const n=a.pass;var s;i?(s="id"+i.id+d(r,i),t&&(s+="s"+t.id,a.addScene(t.id))):s="noid",n&&n.hideSurfacesAndUnclipedMeshes&&(s+="h");var o=a.getCache(s);if(o)return o;var u=new l(n,e);return a.addCache(s,u),u},_getCullingSystem:function(e,t,i,r,a){var n=r+d(e,i);return a&&a.hideSurfacesAndUnclipedMeshes&&(n+="h"),s.get(t,n)}};return u.StateSortingResultCache=class{constructor(e){this.pass=e,this.scenes=new Set,this.cache={}}getCache(e){return this.cache[e]}addCache(e,t){this.cache[e]=t}cleanCache(){this.scenes.clear(),this.cache={}}addScene(e){this.scenes.add(e)}nbScenes(){return this.scenes.size}},u}),define("DS/RenderEngineUtils/RenderEngineUtils",["DS/RenderEngineUtils/StateSortingResult","DS/RenderEngineUtils/DisplayList","DS/RenderEngineUtils/InheritanceSolver","DS/RenderEngineUtils/StateSortingCacheItem","DS/RenderEngineUtils/StateSortingCache"],function(e,t,i,r,a){"use strict";return{StateSortingResult:e,DisplayList:t,InheritanceSolver:i,StateSortingCacheItem:r,StateSortingCache:a}});