define("DS/PPWDataGridView/RecursiveGrouping",["UWA/Core","UWA/Class","DS/PPWTreeNodeModel/PPWTreeNodeModel","i18n!DS/PPWDataGridView/assets/nls/ContextualMenu.json"],function(e,t,o,r){"use strict";var n,i,s,a,l,u,p,d,c,g,h,f,_,G,v,I,D;return n=function(t){var r=!1;return e.is(t)&&e.is(t.getNodeSource,"function")&&(r=t.getNodeSource()===o.NODE_SOURCE.GROUPING),r},i=function(t,o){var r;switch(t){case"date":r=e.is(o,"number")?o:Date.parse(o),isNaN(r)||(o=new Date(r));break;case"number":case"integer":case"float":r=isNaN(o)?o:parseFloat(o);break;case"boolean":r=o;break;default:r=o}return r},s=function(t){var o;o=(t=t||{}).onDropCell,t.onDropCell=function(t,r){var s,a,l,u=this;if(e.is(r.nodeModel)&&n(r.nodeModel))s=r.nodeModel,a=s.getProperty(),l=s.getIdentifier(),(Array.isArray(r.droppedNodes)?r.droppedNodes:[]).forEach(t=>{var o,r,n,s,p,d,c;o=u.layout,r=t._getRowID(),n=o.getColumnIndex(a),r&&n&&(s=o.getCellIDFromCoordinates({rowID:r,columnID:n}))&&u.getCellEditableState(s)&&(d=o.getColumnSetCellValue(a),e.is(d,"function")&&(p=u.getCellInfosAt(s),c=o._getCellTypeRepresentation({cellID:s,columnID:n,rowID:r,cellModel:l,nodeModel:t}),d.call(u,p,i(c,l))))});else{if(!e.is(o,"function"))return!1;o.call(this,t,r)}}},a=function(t){var o,r;r=function(t){var r,i,s,a="N/A",l=function(t){var o,r,i=t.getChildren();if(Array.isArray(i)&&i.length>0)for(o=0;o<i.length&&(r=n(i[o])?l(i[o]):i[o],!e.is(r));o++);return r};return e.is(t)&&n(t)?(r=t.getProperty(),i=l(t),e.is(i)&&(s=t.getOriginalChildrenInformation().notHiddenNotFilteredChildrenCount,a=e.is(o,"function")?o.call(this,t):this.layout.getColumnOptionValue(r,"text")+": "+t.getIdentifier()+" ("+s+")")):e.is(o,"function")&&(a=o.call(this,t)),a},(t=t||{}).rowGroupingOptions=t.rowGroupingOptions||{},o=t.rowGroupingOptions.getGroupingNodeLabel,t.rowGroupingOptions.getGroupingNodeLabel=r.bind(this._dgv)},l=function(){return[{iconName:"group"}]},u=function(t,o,r){return e.is(r)||(r=t.getTreeDocument()._getTrueRoot()),-1===r._propertiesToGroup.indexOf(o)?"unselected":"selected"},I=function(t,r){e.is(r)||(r=this.getTreeDocument()._getTrueRoot()),r._propertiesToGroup=t,r.getAllDescendants().forEach(function(e){e.getNodeSource()===o.NODE_SOURCE.MODEL&&(e._propertiesToGroup=t)}),this.rowGroupingOptions.depth=e.is(r)?r.getNodeDepth()+1:0},p=function(t,r){var n,i;e.is(r)||(r=this.getTreeDocument()._getTrueRoot()),e.is(this._rowModel)&&("clear"===t?(r._propertiesToGroup=[],n="clear"):((i=r._propertiesToGroup.indexOf(t))>-1?r._propertiesToGroup.splice(i,1):r._propertiesToGroup.push(t),n=-1===i?"add":"remove"),r.getAllDescendants().forEach(function(e){var r;if(e.getNodeSource()===o.NODE_SOURCE.MODEL)switch(r=e._propertiesToGroup.indexOf(t),n){case"add":r<0&&e._propertiesToGroup.push(t);break;case"remove":(r=e._propertiesToGroup.indexOf(t))>-1&&e._propertiesToGroup.splice(r,1);break;case"clear":e._propertiesToGroup=[]}}),this.rowGroupingOptions.depth=e.is(r)?r.getNodeDepth()+1:0,this.groupRows({dataIndexesToGroup:r._propertiesToGroup,ignorePreprocess:!0}))},d=function(t){var o=t.target;!n(o)&&Array.isArray(o._propertiesToGroup)&&o._propertiesToGroup.length>0&&(o._appliedGroupingProps.join(",")===o._propertiesToGroup.join(",")||(this.rowGroupingOptions.depth=e.is(o)?o.getNodeDepth()+1:0,this.groupRows({dataIndexesToGroup:o._propertiesToGroup,ignorePreprocess:!0})))},v=function(t){var o,r,n,i,s=this,a={},l=Number.MAX_VALUE;t.forEach(function(t){o=t.target,r=t.nodeModel,e.is(o)&&e.is(r)&&Array.isArray(o._propertiesToGroup)&&o._propertiesToGroup.length>0&&(i=o.getNodeDepth(),t.event&&"update"===t.event?(n=Array.from(o._propertiesToGroup),s.rowGroupingOptions.depth=i+1,o._propertiesToGroup=[],s.groupRows({dataIndexesToGroup:[],ignorePreprocess:!0}),o._propertiesToGroup=n,s.groupRows({dataIndexesToGroup:n,ignorePreprocess:!0})):(a[i]=a[i]||[],a[i].push(o),i<l&&(l=i)))}),Object.keys(a).length>0&&(s.rowGroupingOptions.depth=parseInt(l)+1,s.reapplyRowGrouping())},c=function e(t){let o=t.getParent();return n(o)?e(o):o},g=function(){this._transactionCounter++,null===this._transactions&&(this._transactions=[])},h=function(){var e;this._transactionCounter--,0===this._transactionCounter&&(e=Array.isArray(this._transactions)?Array.from(this._transactions):[],this._transactions=null,e.length>0&&v.call(this._dgv,e))},f=function(t){var o,r,i;r=t.target,i=t.data.nodeModel,e.is(i)&&!n(i)&&(!e.is(r)||n(r)||r._isGroupingInProgress||Array.isArray(r._propertiesToGroup)&&r._propertiesToGroup.length>0&&(i._propertiesToGroup=e.clone(r._propertiesToGroup),o={event:"addchild",target:r,nodeModel:i},Array.isArray(this._transactions)?this._transactions.push(o):v.call(this._dgv,[o])))},_=function(t){var o,r,i;r=t.target,i=t.data.nodeModel,e.is(r)&&n(r)&&e.is(i)&&!n(i)&&((r=c(r))._isGroupingInProgress||(o={event:"remove",target:r,nodeModel:i},Array.isArray(this._transactions)?this._transactions.push(o):v.call(this._dgv,[o])))},G=function(t){var o,r,i,s,a,l;r=(i=t.data.nodeModel).getParent(),e.is(r)&&n(r)&&e.is(i)&&!n(i)&&(s=t.data.attributes,(l=e.is(s)?Object.keys(s):[]).length>0&&(r=c(r),a=Array.isArray(r._propertiesToGroup)?e.clone(r._propertiesToGroup):[],l.some(e=>{var t="label"===e?"tree":e;return a.indexOf(t)>-1})&&(o={event:"update",target:r,nodeModel:i},Array.isArray(this._transactions)?this._transactions.push(o):v.call(this._dgv,[o]))))},D=function(){var e;(e=this._dgv.getTreeDocument()).addEventListener("prepareUpdate",g.bind(this)),e.addEventListener("addChild",f.bind(this)),e.addEventListener("removeChild",_.bind(this)),e.addEventListener("pushUpdate",h.bind(this)),e.addEventListener("nodeModelUpdate",G.bind(this))},t.extend({_dgv:null,_transactions:null,_transactionCounter:0,init:function(e){this._dgv=e,this._transactions=null,this._transactionCounter=0},handlePreCreation:function(t){var o;return o=t.rowGroupingOptions||{},o=e.merge(o,{getGroupingNodeIcons:l}),t.rowGroupingOptions=o,a.call(this,t),s.call(this,t),t},handlePostCreation:function(e){this._dgv.getTreeDocument().addEventListener("postExpand",d.bind(this._dgv)),D.call(this),e&&Array.isArray(e.initialDataIndecesToGroup)&&e.initialDataIndecesToGroup.length>0&&this._dgv.groupRows({dataIndexesToGroup:e.initialDataIndecesToGroup})},getGroupByMenu:function(t){var o,n,i=this,s=[],a=[],l=t.collectionView,d=!1,c=t.cellInfos.nodeModel,g=function(t){var o=c;return e.is(o)||(o=i._dgv.getTreeDocument()._getTrueRoot()),o._propertiesToGroup.indexOf(t.dataIndex)>-1},h=function(e){let t=u(l,e.dataIndex,c);return"selected"!==t||d||(d=!0),{type:"CheckItem",title:e.text,state:t,icon:e.icon,action:{callback:p.bind(l,e.dataIndex,c)}}};return o=l.layout.getLeafColumns(),function(){var e;for(n=0;n<o.length;n++)(e=o[l.layout._orderedColumnsIndexes[n]]).groupableFlag&&(!1!==e.visibleFlag||e.defaultGroupable||g(e))&&a.push(h(e))}(),a.length>0&&(s.push({type:"PushItem",id:"GroupBy",title:r.get("ContextualMenu.GroupBy.Title"),icon:{iconName:"group",fontIconFamily:WUXManagedFontIcons.Font3DS},submenu:a}),d&&s.push({type:"PushItem",id:"ClearGroupBy",title:r.get("ContextualMenu.ClearGroupBy.Title"),icon:{iconName:"group-delete",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:p.bind(l,"clear",c)}})),s},doGroupingPreprocess:function(e){var t=e.dataIndexesToGroup,o=e.nodeModel;return I.call(this._dgv,t,o)}})}),define("DS/PPWDataGridView/ColumnFiltering",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({_dgv:null,init:function(e){this._dgv=e},setFilterModel:function(){var t=this,o={};this._dgv.columns.forEach(function(r){var n,i,s,a={};if(e.is(r.filterInfos)){switch(n="tree"===r.dataIndex?"label":r.dataIndex,r.filterInfos.type){case"boolean":i="string",a._isBoolean=!0;break;default:i=r.filterInfos.type}(s=r.filterInfos.options)&&(s.getCellValueForFilter&&(s.getCellValueForFilter=s.getCellValueForFilter.bind(t._dgv)),a=e.extend(a,s,!0)),o[n]={filterId:i,filterOptions:a}}}),Object.keys(o).length>0&&this._dgv.treeDocument.setFilterModel(o)}})}),define("DS/PPWDataGridView/PPWDataGridView",["UWA/Core","DS/Utilities/Dom","DS/DataGridView/DataGridView","DS/PPWDataGridView/ColumnFiltering","DS/PPWDataGridView/RecursiveGrouping","i18n!DS/PPWDataGridView/assets/nls/ContextualMenu.json"],function(e,t,o,r,n,i){"use strict";var s,a,l,u,p,d,c,g=["Filter","Pin","SizeColumnToFit","Hide","GroupBy"];return c=function(e){var o,r,n,i,s,a=[],l=e.collectionView,u=e.cellInfos&&-1===e.cellInfos.rowID;if(!u&&e.infos&&e.infos.target&&(u=t.firstParentWithClass(e.infos.target,"wux-layouts-header")),u)for(n=(r=l.layout).getLeafColumns(),i=0;i<n.length;i++)o=n[r._orderedColumnsIndexes[i]],s=r.getColumnVisibleFlag(o.dataIndex)?"selected":"unselected",a.push({type:"CheckItem",title:o.text,icon:o.icon,state:r.getColumnAlwaysVisibleFlag(o.dataIndex)?"disabled|"+s:s,action:{callback:function(e){var t;e&&e.context&&e.context.id&&(t=r.getColumnVisibleFlag(e.context.id),r.setColumnVisibleFlag(e.context.id,!t,{isUserInteraction:!0}))},context:{id:o.dataIndex}}});return a},l=function(e){var t,o=[];return(t=c(e)).length>0&&o.push({type:"PushItem",title:i.get("ContextualMenu.DisplayColumns.Title"),icon:{iconName:"eye",fontIconFamily:WUXManagedFontIcons.Font3DS},submenu:t}),o},a=function(e){let t,o,r=this,n=[];return e&&e.cellInfos&&-1===e.cellInfos.rowID&&e.collectionView&&(t=e.collectionView)._contextualMenuBuilder&&g.forEach(function(i){var s;"Hide"===i?o=l(e):"GroupBy"===i?o=r._recursiveGroupingHelper.getGroupByMenu(e):(s="_create"+i+"ContextualMenu",o=t._contextualMenuBuilder[s](e)),n=n.concat(o)}),n},u=function(e){var t;return e&&e.collectionView&&(t=e.collectionView.buildDefaultContextualMenu(e,{expandCollapse:!0})),t},s=function(t,o){var r=[],n=[];return function(t){var o,r=!1;return e.is(t)&&e.is(t.cellInfos)&&e.is(t.cellInfos.nodeModel)&&e.is(t.collectionView)&&(o=t.collectionView.getTreeDocument(),e.is(o)&&(r=o.isGroupingNodeModel(t.cellInfos.nodeModel))),r}(o)?n=u.call(this,o):(e.is(o.cellInfos)&&(r=-1===o.cellInfos.rowID?a.call(this,o):this._recursiveGroupingHelper.getGroupByMenu(o)),n=e.is(t,"function")&&o.collectionView?t.call(o.collectionView,o,r):r),n},p=function(t){t.filterViewOptions=t.filterViewOptions||{},t.filterViewOptions=e.merge(t.filterViewOptions,{ignoreGroupingNodes:!0}),this._recursiveGroupingHelper=new n(this),this._columnFilteringHelper=new r(this),(t=this._recursiveGroupingHelper.handlePreCreation(t)).onContextualEvent=s.bind(this,t.onContextualEvent)},d=function(e){this._recursiveGroupingHelper.handlePostCreation(e),this._columnFilteringHelper.setFilterModel()},o.extend({name:"PPRDataGridView",init:function(e){p.call(this,e=e||{}),this._parent(e),d.call(this,e)},groupRows:function(t){var o,r,n;t=t||{},n=this.getTreeDocument(),r=this.rowGroupingOptions.depth,o=!e.is(t.ignorePreprocess)||!t.ignorePreprocess,delete t.ignorePreprocess,o&&this._recursiveGroupingHelper.doGroupingPreprocess(t),e.is(r)&&Array.isArray(t.dataIndexesToGroup)&&0===t.dataIndexesToGroup.length&&(!e.is(this._rowModel._latestGroupingOptions)||Array.isArray(this._rowModel._latestGroupingOptions)&&0===this._rowModel._latestGroupingOptions.length)&&n.getNodeModelsAtNthDepth(r-1).some(e=>{var t=!1;return Array.isArray(e._appliedGroupingProps)&&e._appliedGroupingProps.length>0&&(this._rowModel._latestGroupingOptions=Array.from(e._appliedGroupingProps),t=!0),t}),this._parent(t)},getCellEditableState:function(t){var o,r,n;return n=this.layout.getCellCoordinatesAt(t),o=this.getNodeModelAtRowID(n.rowID),r=this.getTreeDocument(),(!e.is(o)||!r.isGroupingNodeModel(o))&&this._parent(t)}})});