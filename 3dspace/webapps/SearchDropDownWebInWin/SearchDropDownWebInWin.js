define("DS/SearchDropDownWebInWin/BroadcastWinSearchDropDownManager",["UWA/Class","UWA/Core","UWA/Event","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences"],function(e,n,t,o,i){"use strict";return e.extend(t,{init:function(){o.log("BroadcastWinSearchDropDownManager init"),this._BroadcastsearchDropDown=null,this._SearchDropDownPanelMgr=null,this._parent()},setup:function(e){this._BroadcastsearchDropDown&&this._BroadcastsearchDropDown.close(),this._BroadcastsearchDropDown&&delete this._BroadcastsearchDropDown,this._SearchDropDownPanelMgr=e,this._BroadcastsearchDropDown=new BroadcastChannel("searchDropDownWebInWin"),this._parent(e)},destroy:function(){n.is(this._BroadcastsearchDropDown)&&this._BroadcastsearchDropDown.close(),n.is(this._BroadcastsearchDropDown)&&delete this._BroadcastsearchDropDown,this._parent()},getBroadcastsearchDropDown:function(){return this._BroadcastsearchDropDown},postMessage:function(e){let t;n.is(this._BroadcastsearchDropDown)&&(n.is(e)&&(t=e),this._BroadcastsearchDropDown.postMessage(t),o.log("DS/SearchDropDownWebInWin/BroadcastWinSearchDropDownManager postMessage from: ",t))},listenBroadcast:function(){let e=this;n.is(e._BroadcastsearchDropDown)&&n.is(e._SearchDropDownPanelMgr)&&(e._BroadcastsearchDropDown.onmessage=(t=>{if(n.is(t)&&n.is(t.data)){o.log("DS/SearchDropDownWebInWin/BroadcastWinSearchDropDownManager onmessage",t.data);const{type:a="",message:r="",value:s=""}=t.data;if("clickOnDropDown"===a)e._SearchDropDownPanelMgr._SearchDropDown2.onBlur(void 0,!0),e._SearchDropDownPanelMgr._SearchDropDown2.eventManager.dispatchEvent("otherCommand",{value:s});else if("applySettings"===a){let t=JSON.parse(s);i.setItem("search_tabbed_ui",t.search_tabbed_ui),i.setItem("search_double_click_open",t.search_double_click_open),i.setItem("revisionDisplayType",t.revisionDisplayType),i.commit(),i.setPreference({name:"optionMode",value:t.value,tenantId:t.tenantId,onComplete:function(){let t=e._SearchDropDownPanelMgr&&e._SearchDropDownPanelMgr._SearchDropDown2;n.is(t)&&n.is(t._SearchDropDownSettings)&&(t.hideSettingPQs(),t._SearchDropDownSettings._initDefaultSettings(),t.onBlur(void 0,!0))},onFailure:function(e){o.error("DS/SearchDropDownWebInWin/BroadcastWinSearchDropDownManager: Failure, Unable to save preferences :",e)}})}}}))}})}),define("DS/SearchDropDownWebInWin/SearchDropDownPanelMgr",["UWA/Drivers/Alone","UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","UWA/Element","UWA/Event","DS/SNInfraUX/Logger","DS/SearchDropDownWebInWin/BroadcastWinSearchDropDownManager","i18n!DS/SNResultUX/assets/nls/SearchDropDownWebInWin.json"],function(e,n,t,o,i,a,r,s,c){"use strict";return t.singleton(o,{_SearchDropDown2:null,_Broadcast:null,_historyList:null,_embedded:!1,init:function(){r.log("SearchDropDownPanelMgr init"),this._SearchDropDown2=null,this._Broadcast=null,this._historyList=[],this._embedded=!1;let e=window.location.search.substring(1).indexOf("debug_me")>=0;this.setDebugMode(e),this._Broadcast=new s,this._Broadcast.setup(this),this._Broadcast.listenBroadcast()},destroy:function(){this._Broadcast.close(),this._Broadcast&&delete this._Broadcast,this._Broadcast=null,this._parent()},initView:function(e){let t=this;r.log("Inside initView, view Parameters="+JSON.stringify(e));let o={};o[e.active_tenant]={sources:{cstorage:{displayName:e.tenantDisplayName,url:e.cstorageUrl},hpc:{displayName:e.tenantDisplayName,url:""},search:{displayName:e.tenantDisplayName,url:e.url},swym:{displayName:e.tenantDisplayName,url:e.swymurl},tagger:{displayName:e.tenantDisplayName,url:e.cstorageUrl}}},require(["DS/i3DXCompass/i3DXCompass","DS/i3DXCompass/Data","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Logger","DS/SNInfraUX/Api/SearchApi","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","text!DS/SNResultUX/assets/WebInWin_settings.json"],function(i,a,r,s,c,l,d,D,h){let p=window.location.search.substring(1);if(p.length>0){let e=p.split("&"),n=[];for(var S=0;S<e.length;S++){let t=e[S].split("=");1==t.length?n[t[0]]=!0:2==t.length&&t[0].length>0&&(n[t[0]]=t[1])}D.urlSettings(n)}D.initialize(JSON.parse(h)),n.is(e.userid)&&(d.setUserId(e.userid),c.log("User id set = "+d.getUserId())),n.is(e.securityContext)&&(d.setSecurityContext(e.securityContext),c.log("securityContext id set = "+d.getSecurityContext())),n.is(e.cstorageUrl)&&(d.setserverUrl(e.cstorageUrl),c.log("securityContext id set = "+d.getserverUrl())),n.is(a,"object")&&!n.is(a.getPreferencesUrl,"string")&&n.is(window.COMPASS_CONFIG,"object")&&a.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,platform:e.active_tenant,passportUrl:"",proxyTicketUrl:""}),i.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,passportUrl:"",proxyTicketUrl:"",compassTarget:"SearchDropDown-Compass",appsTarget:"SearchDropDown-Compass"});let u=new r({active_tenant:e.active_tenant,available_tenants:o});s.login({resources:u,onComplete:function(){c.log("Early /federated/login DONE from SearchDropDownPanelMgr.js")},onFailure:function(){c.log("Early /federated/login FAILED from SearchDropDownPanelMgr.js")}}),l.setResourceMgt(u),n.is(e.historyList)&&(t._historyList=e.historyList),D.getTenantSettings(e.active_tenant).then(function(){require(["DS/SNSearchUX/SearchDropDown2"],function(o){t.addEvent("favoriteSearches",function(e){let n=JSON.stringify(e);c.log("sendNotificationWebInWin favoriteSearches: ",e),sendNotificationWebInWin("favoriteSearches",n)}),t.addEvent("myContent",function(e){let n=JSON.stringify(e);c.log("sendNotificationWebInWin myContent: ",e);t._Broadcast.postMessage({type:"clearLocalGrouping",value:"clearLocalGrouping"}),setTimeout(function(){sendNotificationWebInWin("myContent",n)},200)}),t.addEvent("advancedSearch",function(e){let n=JSON.stringify(e);c.log("sendNotificationWebInWin advancedSearch: ",e),sendNotificationWebInWin("advancedSearch",n)}),t.addEvent("tabSelected",function(e){let n=JSON.stringify(e);c.log("sendNotificationWebInWin tabSelected: ",e),sendNotificationWebInWin("tabSelected",n)}),t.addEvent("onPQ",function(e){let n=JSON.stringify(e);c.log("sendNotificationWebInWin onPQ: ",e),sendNotificationWebInWin("onPQ",n)}),t.addEvent("onViewSearch",function(e){let n=JSON.stringify(e);c.log("sendNotificationWebInWin Search: ",e),sendNotificationWebInWin("Search",n),t._SearchDropDown2.setFieldValue(e.displayString),e.displayString.length>=3&&t._SearchDropDown2.switchActiveTabinstantSearchTab(e.displayString,!0)}),t.addEvent("applySettings",function(e){let n={type:"applySettings",value:JSON.stringify(e)};t._Broadcast.postMessage(n),c.log("sendNotificationWebInWin applySettings: ",e),sendNotificationWebInWin("applySettings",{applySettings:"applySettings"})}),t.addEvent("doubleclickopen",function(e){c.log("sendNotificationWebInWin doubleclickopen: ",e),sendNotificationWebInWin("doubleclickopen",e.value)}),t.addEvent("removeHistory",function(e){c.log("sendNotificationWebInWin removeHistory: ",e),t._historyList=JSON.parse(e),sendNotificationWebInWin("removeHistory",t._historyList)}),t.addEvent("clearHistory",function(e){c.log("sendNotificationWebInWin clearHistory: ",e),!0===e&&(t._historyList=[]),sendNotificationWebInWin("clearHistory",e)}),t.addEvent("displayClearHistory",function(){c.log("sendNotificationWebInWin displayClearHistory: "),sendNotificationWebInWin("blockDisplay")}),t.addEvent("onClickBeta",function(){c.log("sendNotificationWebInWin onClickBeta"),sendNotificationWebInWin("blockDisplay")}),t.addEvent("onGuidedMode",function(e){c.log("sendNotificationWebInWin onGuidedMode"),sendNotificationWebInWin("onGuidedMode",e)}),t.addEvent("onClickBetaModal",function(e){c.log("sendNotificationWebInWin onClickBetaModal: ",e),sendNotificationWebInWin("onClickBetaModal",e)}),t.addEvent("otherCommand",function(e){let n=JSON.stringify(e);sendNotificationWebInWin("blockDisplay",!1),c.log("sendNotificationWebInWin otherCommand: ",n),sendNotificationWebInWin("otherCommandClick",n)}),t.addEvent("Searchfieldenable",function(e){c.log("sendNotificationWebInWin Searchfieldenable"),sendNotificationWebInWin("Searchfieldenable",e)});let a=n.extendElement(document.body).getElement("#SearchDropDown-content"),r=n.createElement("div",{id:"SearchDropDown-view",class:"SearchDropDown-view"}).inject(a);t._SearchDropDown2=new o({eventManager:t,SimilarSearch:!(!n.is(e.otherMenu)||!n.is(e.otherMenu.SimilarSearch))||void 0,PartSupply:!(!n.is(e.otherMenu)||!n.is(e.otherMenu.PartSupply))||void 0,Relations:!(!n.is(e.otherMenu)||!n.is(e.otherMenu.Relations))||void 0}).inject(r),t._SearchDropDown2.collection._isCategoryHelperCollection=!0,t._SearchDropDown2.initSources(u),t._SearchDropDown2.maxResultDisplayedMyContent=3,t._SearchDropDown2.getHistoryListFromLocalStorage=function(){return c.log("getHistoryListFromLocalStorage historyList : ",e.historyList),n.is(t._historyList)&&t._historyList.length&&(t._SearchDropDown2.noSearchLaunch=!1),t._historyList},t._SearchDropDown2.displayClearHistoryModal=function(){t._displayClearHistoryModal()};let s=n.clone(t._SearchDropDown2.removeHistoryFromLocalStorage);t._SearchDropDown2.removeHistoryFromLocalStorage=function(e){s.call(t._SearchDropDown2,e),this.eventManager.dispatchEvent("removeHistory",localStorage.SNSearchBoxStore)},t._SearchDropDown2._onClickApp=function(e){i.getAppInfo({appId:e.currentTarget.id,onComplete:function(e){if(e){let n=JSON.stringify(e);c.log("sendNotificationWebInWin onClickApp: ",e),sendNotificationWebInWin("onClickApp",n)}}})},t.addEvent("OnApplication",function(e){c.log("sendNotificationWebInWin OnApplication: ",e),sendNotificationWebInWin("OnApplication",JSON.stringify(e))}),t.onFocus(),t._SearchDropDown2.refreshHistoryList(),t._initOtherSettings(),t._initBetaButton(),setTimeout(function(){const e=document.getElementById("SearchDropDown-Compass");e&&e.remove()},2500)},function(e){console.error("Cannot load view: "+e.requireModules)})})})},onFocus:function(e){let t=this;r.log("SearchDropDownPanelMgr:onFocus"),n.is(e)&&n.is(e.inputvalue)&&t._SearchDropDown2&&t._SearchDropDown2.setInputValue(e.inputvalue),n.is(e)&&n.is(e.lastsearch)&&"true"===e.lastsearch?sendNotificationWebInWin("blockDisplay",!1):(n.is(e)&&n.is(e.historyList)&&(t._historyList=e.historyList),n.is(e)&&n.is(e.embedded)&&(t._embedded="true"==e.embedded),t._SearchDropDown2&&t._SearchDropDown2.onFocus(),t._SearchDropDown2&&t._SearchDropDown2.refreshHistoryList(),n.is(t._SearchDropDown2)&&n.is(t._SearchDropDown2.SmartQueriesInstance)&&!0===t._SearchDropDown2.SmartQueriesInstance._toggleactivation&&t._SearchDropDown2.eventManager.dispatchEvent("onGuidedMode",!0),n.is(e)&&n.is(e.incontext)&&t._SearchDropDown2&&t._SearchDropDown2.setInContextMode("true"===e.incontext),setTimeout(function(){let e=JSON.stringify({displayString:"",query:""});sendNotificationWebInWin("Search",e)},200))},onClearSearch:function(){r.log("SearchDropDownPanelMgr:onClearSearch"),n.is(this._SearchDropDown2)&&(this._SearchDropDown2._setInternalCriteria(null),this._SearchDropDown2.resetSearchField(""),this._SearchDropDown2.hideSettingPQs())},onKeyUp:function(e){if(r.log("SearchDropDownPanelMgr:onKeyUp"),!n.is(this._SearchDropDown2)||!n.is(e)||!n.is(e.value))return;let t={srcElement:{value:e.value}};this._SearchDropDown2.setInputValue(e.value),this._SearchDropDown2.onKeyUp(t)},onBlur:function(e){r.log("SearchDropDownPanelMgr:onBlur"),n.is(this._SearchDropDown2)&&this._SearchDropDown2.onBlur(null,!0)},_initOtherSettings:function(){let e=this;r.log("SearchDropDownPanelMgr:_initOtherSettings: "),n.is(e._SearchDropDown2)&&n.is(e._SearchDropDown2.elements.settingsContainer)&&(n.is(e._SearchDropDown2.elements.setting_2_1)||(e._SearchDropDown2.elements.setting_2_1=i.create("div",{class:"setting-container dbl-clk"}).inject(e._SearchDropDown2.elements.settingsContainer),e._SearchDropDown2.elements.settingContainer_2_1=i.create("div",{class:"option-container"}).inject(e._SearchDropDown2.elements.setting_2_1),e._SearchDropDown2.elements.settingCheckbox_2_1=i.create("input",{class:"settings-instant-search-checkbox",type:"checkbox"}).inject(e._SearchDropDown2.elements.settingContainer_2_1),e._SearchDropDown2.elements.settingCheckbox_2_1.addEvent("click",function(e){if(n.is(e)&&n.is(e.target)){let n=e.target.checked;this.eventManager&&this.eventManager.dispatchEvent("doubleclickopen",{value:n})}}.bind(e._SearchDropDown2)),e._SearchDropDown2.elements.settingTitle_2_1=i.create("span",{class:"settings-instant-search-title",text:c.get("search_double_click_open")}).inject(e._SearchDropDown2.elements.settingContainer_2_1)))},_initBetaButton:function(){let e=this;r.log("SearchDropDownPanelMgr:_initBetaButton"),n.is(e._SearchDropDown2)&&require(["UWA/Element","DS/Controls/Button","DS/MessageBus/MessageBus","DS/SNResultUX/utils/ExternalComponentHelpers"],function(t,o,i,a){n.is(e._SearchDropDown2)&&n.is(e._SearchDropDown2.elements.deactivateFUN136528)&&e._SearchDropDown2.elements.deactivateFUN136528.remove(),e._SearchDropDown2.elements.deactivateFUN136528=new o({displayStyle:"lite",icon:{iconName:"power-off",fontIconFamily:WUXManagedFontIcons.Font3DS},label:c.get("FUN136528-deactivate"),touchMode:!0,onClick:function(e){a.modal({title:c.get("FUN136528-modal-title-deactivate"),content:c.get("FUN136528-modal-text-deactivate"),CB:[{buttonKind:"YES",function:()=>{i.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"dropdownbeta",persDim:{pd17:"deactivate",pd18:"deactivate"}}}),this.eventManager&&this.eventManager.dispatchEvent("onClickBetaModal",!0),a.destroyModal()}},{buttonKind:"no",function:()=>{this.eventManager&&this.eventManager.dispatchEvent("onClickBetaModal",!1),a.destroyModal()}}]}),this.eventManager&&this.eventManager.dispatchEvent("onClickBeta")}.bind(e._SearchDropDown2)}).inject(e._SearchDropDown2.elements.tabContainer),e._SearchDropDown2.elements.deactivateFUN136528.elements.container.addClassName("deactivate-beta-button")})},_displayClearHistoryModal:function(){let e=this;r.log("SearchDropDownPanelMgr:_displayClearHistoryModal"),n.is(e._SearchDropDown2)&&require(["DS/SNResultUX/utils/ExternalComponentHelpers"],function(n){n.modal({title:c.get("search.history.delete.title"),content:c.get("search.history.delete.message"),CB:[{buttonKind:"ok",label:c.get("search.history.delete.confirm"),function:()=>{e._historyList=[],e._SearchDropDown2.eventManager.dispatchEvent("clearHistory",!0),setTimeout(function(){e._SearchDropDown2.clearHistoryFromLocalStorage()},100),n.destroyModal()}},{buttonKind:"cancel",function:()=>{e._SearchDropDown2.noBlur=!1,e._SearchDropDown2.setFocus(),e._SearchDropDown2.eventManager.dispatchEvent("clearHistory",!1),n.destroyModal()}}]}),e._SearchDropDown2.eventManager.dispatchEvent("displayClearHistory")})}})});