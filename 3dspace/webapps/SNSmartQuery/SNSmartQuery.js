define("DS/SNSmartQuery/context/SNSmartQueryToken",["UWA/Core","UWA/Class"],function(e,t){"use strict";var r=t.extend({type:void 0,displayValue:void 0,value:void 0,init:function(e){this.type=e.type,this.uri=e.uri,this.displayValue=e.displayValue,this.value=e.value,this.isClassAttribute=e.isClassAttribute},getToken:function(e){return new r(e)}});return r}),define("DS/SNSmartQuery/config/SmartQueryConfig",["UWA/Core","UWA/Class","UWA/Class/Debug","text!DS/SNSmartQuery/assets/SmartQueryConfig.json"],function(e,t,r,i){"use strict";return t.singleton(r,{init:function(){this._config=JSON.parse(i)},get:function(e){return this._config[e]}})}),define("DS/SNSmartQuery/SNSmartQueryRules",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNSmartQuery/config/SmartQueryConfig"],function(e,t,r,i,s){"use strict";return t.singleton({TokenType:{START:"START",USER_TEXT:"USER_TEXT",TYPE:"TYPE",INTERFACE:"INTERFACE",L_OPERATOR:"L_OPERATOR",R_OPERATOR:"R_OPERATOR",U_OPERATOR:"U_OPERATOR",PREDICATE:"PREDICATE",PREDICATE_VALUE:"PREDICATE_VALUE",KEYWORD:"KEYWORD",K_KEYWORD:"KEY_KEYWORD",V_KEYWORD:"VALUE_KEYWORD",OPEN_PARENT:"OPEN_PARENT",CLOSE_PARENT:"CLOSE_PARENT",COMPANY_TAG:"COMPANY_TAG",COMMUNITY_TAG:"COMMUNITY_TAG",USER_TAG:"USER_TAG",TYPE_GROUP:"TYPE_GROUP"},SUGGESTION_CATEGORY:{WHO:"ds6w:who",WHAT:"ds6w:what",WHERE:"ds6w:where",WHEN:"ds6w:when",HOW:"ds6w:how",WHY:"ds6w:why",OPERATOR:"OPERATOR",DS_SIX_WG:"ds6wg"},init:function(e){this._smartQueryEngineJson=s.get("SmartQueryEngineRules"),this._smartQueryEngineUqlJson=s.get("SmartQueryEngineUqlRules"),this._parent(e)},getRule:function(e,t){return this._getRule(e,t,this._smartQueryEngineJson)},getUqlRule:function(e,t){return this._getRule(e,t,this._smartQueryEngineUqlJson)},getPredicateValueTokenTypes:function(){let e={};return this._smartQueryEngineUqlJson[this.TokenType.R_OPERATOR].forEach((t,r)=>{e[t]=!0}),e},_getRule:function(e,t,r){let i=t>0&&e.getAt(t-1),s=i&&i.type||this.TokenType.START,n={};return r[s].forEach((e,t)=>{n[e]=!0}),n},destroy:function(){}})}),define("DS/SNSmartQuery/Suggesters/LogicalOperatorSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig"],function(e,t,r,i,s){"use strict";return t.singleton({_operators:null,init:function(){let e=s.get("LogicalOperators");this._operators=e.map(e=>({displayValue:e.displayValue,value:e.value,suggestionType:"("==e.value?i.TokenType.OPEN_PARENT:")"==e.value?i.TokenType.CLOSE_PARENT:i.TokenType.L_OPERATOR,iconClass:void 0,uri:e.value,textToInsert:e.displayValue+" ",category:i.SUGGESTION_CATEGORY.OPERATOR}))},getSuggestions:function(t,r){let i=this;return new Promise((t,s)=>{e.is(i._operators)?t(i._operators.filter(function(e){return r.rule[e.suggestionType]})):s(i._operators)})}})}),define("DS/SNSmartQuery/utils/StaticDataRepository",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Api/SearchApi","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNSmartQuery/SNSmartQueryRules","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SNUnitConversion","DS/SNInfraUX/SNPLMDictionary","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/PlatformEnvServices","DS/WAFData/WAFData","text!DS/SNSmartQuery/assets/TypeIconInfo.json","text!DS/SNSmartQuery/assets/PseudoLoadTypes.json","text!DS/SNSmartQuery/assets/PseudoLoadPredicates.json","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],function(e,t,r,i,s,n,a,o,u,l,c,p,g,d,y,f,h,S,_,T,m,P,E,C){"use strict";return t.singleton({_loadTypesPromise:null,_loadPredicatesPromise:null,_staticDatapromiseArray:null,_getLoggedInUserPromise:null,_loggedInUser:null,_predicateDataTypeMap:null,_fedPredicateMap:null,_typePredicatesPromise:null,_jsonVocab:null,init:function(t){this._loadTypesPromise=r.deferred(),this._loadPredicatesPromise=r.deferred(),this._loadAttributePromise=r.deferred(),this._loadDimensionPromise=r.deferred(),this._getLoggedInUserPromise=r.deferred(),this._loadCustoPromise=r.deferred(),this._staticDatapromiseArray=[this._loadTypesPromise.promise,this._loadPredicatesPromise.promise,this._getLoggedInUserPromise.promise,this._loadAttributePromise.promise,this._loadDimensionPromise.promise],this._fedPredicateMap=new Map,this._tempMap=new Map,this._predicateDataTypeMap=new Map,this._typePredicatesPromise=new Map,e.is(t)&&e.is(t.loadOnDemand)||this._load(),this._rangeValueMap={},this._unitInfoMap={},this.rootMap={},this._sourceMap={},this.intefaceTypeMap={},this._communityContainerUidMap={}},_load:function(){this._loadCusto(),this._getDimensionJson(),this._getClassesFromAllTheSources(),this._loadPredicatesFromFedDictonary(),this._loadClassificationAttributes(),this._loadLoggedInUser()},getStaticDataPromiseArray:function(){return this._staticDatapromiseArray},getTypesPromise:function(){var e=d.getItem("SophisticatedModeCacheTypes");let t=this,i=[];return this._typesLoaded?this._loadTypesPromise.promise:new r(function(r,s){(i=e||JSON.parse(P)).forEach((e,r)=>{t._sourceMap[e.uri]=e.source}),r(i)})},getPreicatesPormise:function(){let e=d.getItem("SophisticatedModeCachePredicates"),t=this,i=[];return this._predicatesLoaded?this._loadPredicatesPromise.promise:new r(function(r,s){(i=e||JSON.parse(E)).forEach((e,r)=>{t.rootMap[e.uri]=e.category,t._predicateDataTypeMap.set(e.uri,e.dataType)}),r(i)})},getLoggedInUser:function(){return this._loggedInUser},_getDimensionJson:function(){var e=this,t=new h({});f.setResources({resources:t}),f.loadDictionary().then(function(){i.log("Dictionary loaded"),e._loadDimensionPromise.resolve()})},setRangeValues:function(t,r,i){r&&t&&i&&(e.is(this._rangeValueMap[r])||(this._rangeValueMap[r]={}),this._rangeValueMap[r][t]=i)},getRangeValues:function(e,t){return t&&e&&this._rangeValueMap[t]&&this._rangeValueMap[t][e]},setPredUnitInfo:function(t,r,i){r&&t&&i&&(e.is(this._unitInfoMap[r])||(this._unitInfoMap[r]={}),this._unitInfoMap[r][t]=i)},getPredUnitInfo:function(e,t){return t&&e&&this._unitInfoMap[t]&&this._unitInfoMap[t][e]},_loadClassificationAttributes:function(){var t={},r=[],n=this;u.getServiceUrl({serviceName:"3DSpace",platformId:s.getActiveTenant()||"OnPremise",onComplete:function(a){var o=a+"/resources/IPClassificationReuse/ClassAttribute/fetchClassificationAttributesDefinition";t.method="GET",t.headers={Accept:"application/json","Accept-Language":s.getLanguage()},t.timeout=3e3,t.onComplete=function(t){n._loadDimensionPromise.promise.then(function(){var i=JSON.parse(t);i.classPredicates&&i.classPredicates[0]&&i.classPredicates[0].vocabularyPredicateInfo&&(i.classPredicates[0].vocabularyPredicateInfo.forEach((t,i)=>{t.rangeValues&&e.is(t.rangeValues.literalInfo,"array")?n.setRangeValues(t.uri,"classifiationAttr",t.rangeValues.literalInfo):e.is(t.defaultValue,"object")&&(t.defaultValue.isDefault=!0,n.setRangeValues(t.uri,"classifiationAttr",t.defaultValue)),t.dimension&&n.setPredUnitInfo(t.uri,"classifiationAttr",f._dimensions[t.dimension]),n.setPredicateDataType(t);var s={};s.displayValue=t.nlsName,s.value="["+t.uri+"]",s.uri=t.uri,s.suggestionType=l.TokenType.PREDICATE,s.category=l.SUGGESTION_CATEGORY.DS_SIX_WG,s.textToInsert="`"+t.nlsName+"` ",s.dataType=n._getPredicateTypeFromDataType(t),s.iconClass="fonticon-properties",s.classAttribute=!0,s.unitInfo=n.getPredUnitInfo(t.uri,"classifiationAttr"),r.push(s)}),n._loadAttributePromise.resolve(r))})},t.onFailure=function(e){i.warn("Classification Attribute call - Failed"),console.log(e),n._loadAttributePromise.resolve([])},t.ontimeout=function(e){i.warn("Classification Attribute call - timeOut"),console.log(e),n._loadAttributePromise.resolve([])},T.authenticatedRequest(o,t)},onFailure:function(e){console.log(e),n._loadAttributePromise.resolve([])}})},_fedSearch:function(t){let r=t.onComplete,i=t.onFailure;u.getServiceUrl({serviceName:"3DSearch",platformId:s.getActiveTenant(),onComplete:function(s){if(e.is(s,"string")){let n;if(e.is(t.fedsearchOptions,"function")?n=t.fedsearchOptions():e.is(t.fedsearchOptions)&&(n=t.fedsearchOptions),!n)return void i([]);let a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(n),onComplete:function(e){let t=JSON.parse(e);r(t)},onFailure:function(e){i([])}};T.authenticatedRequest(s+"/search",a)}else i([])},onFailure:function(e){i([])}})},setPredicateDataType:function(e){this._predicateDataTypeMap.set(e.curi||e.uri,this._getPredicateTypeFromDataType(e))},getPredicateDataType:function(t){let r=this._predicateDataTypeMap.get(t);return e.is(r)||!t||"$BY"!=t&&"ABOUT"!=t?r:"string"},_excludeAndAssignWeight:function(e,t,r,i){let s=g.get("suggestion_preference_weightage").default_weightage,n=g.get("suggestion_preference_weightage").scc_factor;for(var a=0;a<e.length;a++){if(t.indexOf(e[a].uri)>=0){e.splice(a,1),a--;continue}e[a].weightage=s;let o=r.indexOf(e[a].uri);o>=0&&(e[a].weightage*=n),(o=i[e[a].uri])>0&&(e[a].weightage+=(Object.keys(i).length-o+1)/100)}return e.sort((e,t)=>t.weightage-e.weightage),e},_getClassesFromAllTheSources:function(){let e=this,t=null,i=null,s=g.get("Preferred").types,n=g.get("Excluded").types,a=JSON.parse(m);this._getAvailableSources().then(function(o){o=o.filter(function(e){return e.status}),r.all(e._loadVocabClassesForServices(o)).then(function(r){let u=[];r.forEach((t,r)=>{t.classInfos.forEach(t=>{e._sourceMap[t.uri]=o[r].name}),u=u.concat(t.classInfos)}),e._loadCustoPromise.promise.then(function(){let r=e._getPreferredTypes();var o=e._getExcludedTypes().concat(n);let p;u=(u=e._excludeAndAssignWeight(u,o,r,s)).map(r=>{p=r.uri.split(":").pop(),t={displayValue:r.nlsName,value:"3DSpace"===r.service?'flattenedtaxonomies:"types/'+p+'"':'[ds6w:type]:"'+r.uri+'"',suggestionType:l.TokenType.TYPE,uri:r.uri,weightage:r.weightage,source:e._sourceMap[r.uri]};let s=void 0;return"3DSpace"===r.service&&a.type[p]?s=p:a.type[r.uri]&&(s=r.uri),s?a.type[s].image?t.imageUrl=c.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+a.type[s].image:a.type[s].iconClass?t.iconClass=a.type[s].iconClass:t.iconClass="fonticon-3d-object":t.iconClass="fonticon-3d-object",e._tempMap.has(t.displayValue)?(1===(i=e._tempMap.get(t.displayValue)).length&&(i[0].displayValue=i[0].displayValue+"("+i[0].uri+")",i[0].textToInsert="`"+i[0].displayValue+"` "),t.displayValue=t.displayValue+"("+t.uri+")",t.textToInsert="`"+t.displayValue+"` ",i.push(t)):e._tempMap.set(t.displayValue,[t]),t}),e._loadTypesPromise.resolve(u),e._typesLoaded=!0,d.setItem("SophisticatedModeCacheTypes",u),d.commit()})})})},_getAvailableSources:function(){return new r(function(e,t){o.getSearchApiPromise().then(function(){let t=s.getActiveTenant(),r=a.getAvailableSources(t);e(r)})})},_loadVocabClassesForServices:function(e){let t=[],i=s.getActiveTenant(),a=s.getLanguage();return e.forEach(e=>{e.status&&t.push(new r((t,r)=>{n.loadVocabularyClasses({vocabId:e.service,tenantId:i,lang:a},t)}))}),t},_handleExcludeAndPrefPredicates:function(e){let t=this._getPreferredPredicates(),r=(this._getExcludedPredicates(),g.get("Preferred").predicates),i=g.get("Excluded").predicates;return e=this._excludeAndAssignWeight(e,i,t,r)},_getExcludedTypes:function(){let t=[],r=s.getActiveTenant(),i=p.getOption("topbar_search_banned_list",{tenant:r});return e.is(i)&&e.is(i.types)&&Object.keys(i.types).forEach(r=>{let s=i.types[r];e.is(s,"array")&&(t=t.concat(s))}),t},_getPreferredTypes:function(){return this.prefTypesSCC||[]},_loadPredicatesFromFedDictonary:function(){let e=this,t=null,r=null,i=[];var a={};s.getActiveTenant();let o={onComplete:function(s){Object.values(s).forEach(e=>{e.properties.forEach(e=>{a[e.curi]=e.subPropertyOf})});var n=function(e){let t=a[e];return t?n(t):e};Object.keys(a).forEach(t=>{e.rootMap[t]=n(t)}),Object.values(s).forEach(s=>{s.properties.forEach(s=>{e._setFedPredicate(s.curi),e.setPredicateDataType(s),(t={uri:s.curi,displayValue:s.label,value:"["+s.curi+"]",suggestionType:l.TokenType.PREDICATE,textToInsert:"`"+s.label+"` ",dataType:e._getPredicateTypeFromDataType(s),category:e.rootMap[s.curi]}).iconClass="fonticon-3ds-"+t.category.substring(5),e._tempMap.has(t.displayValue)?(1===(r=e._tempMap.get(t.displayValue)).length&&(r[0].displayValue=r[0].displayValue+"("+r[0].uri+")",r[0].textToInsert="`"+r[0].displayValue+"` "),t.displayValue=t.displayValue+"("+t.uri+")",t.textToInsert="`"+t.displayValue+"` ",r.push(t)):e._tempMap.set(t.displayValue,[t]),i.push(t)})}),e._loadCustoPromise.promise.then(function(){e._loadPredicatesPromise.resolve(i),e._predicatesLoaded=!0,d.setItem("SophisticatedModeCachePredicates",i),d.commit()})},onFailure:function(t){e._loadPredicatesPromise.resolve(i)},tenantId:s.getActiveTenant(),lang:s.getLanguage(),apiVersion:"R2021x"};n.getFedProperties(o)},loadRelevantPredicates:function(t){var r=this;let i=[];return t.className.forEach((s,a)=>{let o=r._getJsonVocab(s);o?i.push(o):e.is(r._typePredicatesPromise[s])?i.push(r._typePredicatesPromise[s]):(r._typePredicatesPromise[s]=new Promise((e,r)=>{let i={className:s,tenantId:t.tenantId};n.loadRelevantPredicates(i,e)}),i.push(r._typePredicatesPromise[s]))}),i},_getJsonVocab:function(e){if(!this._jsonVocab){this._jsonVocab={};let e=g.get("vocabs");e&&Object.keys(e).forEach(t=>{let i=e[t];i.enable&&i.vocab&&Object.keys(i.vocab).forEach(e=>{i.vocab[e]&&i.vocab[e].predicates&&(this._jsonVocab[e]=new r((t,r)=>{t({vocabularyPredicateInfo:i.vocab[e].predicates.map(e=>({uri:e.uri,nlsName:e.nlsName?C.get("SNSmartQuery.vocab.predicate."+e.nlsName):C.get("SNSmartQuery.vocab.predicate."+e.uri),type:e.type,category:e.lineage}))})}))})})}return this._jsonVocab[e]},_setFedPredicate:function(e){this._fedPredicateMap[e]=e},isFedPredicate:function(e){return this._fedPredicateMap[e]},_getPredicateTypeFromDataType:function(t){var r="",i="string";return e.is(t)&&e.is(t.range)&&e.is(t.range.dataTypes)&&e.is(t.range.dataTypes.length)?"http://www.w3.org/2001/XMLSchema#string"===(r=t.range.dataTypes[0])?i="string":"http://www.w3.org/2001/XMLSchema#boolean"===r?i="boolean":"http://www.w3.org/2001/XMLSchema#integer"===r?i="integer":"http://www.w3.org/2001/XMLSchema#real"===r?i="double":"http://www.w3.org/2001/XMLSchema#dateTime"===r?i="date":"http://www.w3.org/2001/XMLSchema#date"===r?i="date":"http://www.w3.org/2001/XMLSchema#double"===r?i="double":"http://www.w3.org/2001/XMLSchema#timestamp"===r?i="date":"http://www.w3.org/2001/XMLSchema#time"===r&&(i="date"):t.dataType?"http://www.w3.org/2001/XMLSchema#dateTime"===(r=t.dataType)?i="date":"http://www.w3.org/2001/XMLSchema#date"===r?i="date":"http://www.w3.org/2001/XMLSchema#double"===r?i="double":"http://www.w3.org/2001/XMLSchema#integer"===r?i="integer":"http://www.w3.org/2001/XMLSchema#boolean"===r?i="boolean":"http://www.w3.org/2001/XMLSchema#real"===r?i="double":"http://www.w3.org/2001/XMLSchema#timestamp"===r?i="date":"http://www.w3.org/2001/XMLSchema#time"===r&&(i="date"):e.is(t.type)&&(i=t.type),i},_loadLoggedInUser:function(){let e=this,t=s.getActiveTenant();u.getUser({platformId:t,onComplete:function(t){console.log(t),e._loggedInUser="("+t.firstname+" "+t.lastname+")",e._getLoggedInUserPromise.resolve()},onFailure:function(e){console.log(e)}})},_getExcludedPredicates:function(){return this.excludePredSCC||[]},_getPreferredPredicates:function(){return this.prefPredSCC||[]},_loadCusto:function(){var t=this;this.prefPredSCC=[],this.excludePredSCC=[],this.prefTypesSCC=[],this.excludePredTypeMap={};let r=s.getActiveTenant();p.getTenantSettings(r).then(function(){var i=p.getOption("advanced_search",{tenant:r});if(e.is(i)){var s=i["ds6w:type"];e.is(s)&&(Object.keys(s).forEach(function(r){var i=s[r];if(e.is(i,"array"))for(var n=0;n<i.length;n++){var a=i[n];if(!0===a.easyTypeAcess&&t.prefTypesSCC.push(a.uri),e.is(a.uri)){var o=a.predicates;if(e.is(o,"array"))for(let e=0;e<o.length;e++){var u=o[e];u.uri&&t.prefPredSCC.push(u.uri)}var l=a.excluded_predicates;if(e.is(l,"array"))for(let e=0;e<l.length;e++)t.excludePredSCC.push(l[e].uri),t.excludePredTypeMap[a.uri]||(t.excludePredTypeMap[a.uri]=[]),t.excludePredTypeMap[a.uri].push(l[e].uri)}}}),t.prefTypesSCC=t.prefTypesSCC.filter(function(e,t,r){return t===r.indexOf(e)}),t.prefPredSCC=t.prefPredSCC.filter(function(e,t,r){return t===r.indexOf(e)}),t.excludePredSCC=t.excludePredSCC.filter(function(e,t,r){return t===r.indexOf(e)}))}t._loadCustoPromise.resolve()})}})}),define("DS/SNSmartQuery/Suggesters/ClassificationAttributeSuggester",["UWA/Core","UWA/Class","UWA/Promise","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository"],function(e,t,r,i,s){"use strict";return t.singleton({init:function(){},getSuggestions:function(e,t){let r=this;return new Promise((e,s)=>{!0!==t.rule[i.TokenType.PREDICATE]?e([]):r.getClassificationAttributeSuggesterPromise().then(function(t){e(t)})})},getClassificationAttributeSuggesterPromise:function(){return s._loadAttributePromise.promise}})}),define("DS/SNSmartQuery/Suggesters/RelationalOperatorSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig"],function(e,t,r,i,s,n){"use strict";return t.singleton({_relations:null,init:function(){this._relations=n.get("RelationalOperators"),this._relations.forEach((e,t)=>{e.suggestionType=i.TokenType.R_OPERATOR,e.iconClass=void 0,e.category=i.SUGGESTION_CATEGORY.OPERATOR})},getSuggestions:function(e,t){let r=this;return new Promise((e,n)=>{if(!0!==t.rule[i.TokenType.R_OPERATOR])e([]);else{let i=t.currentPredicate;"$BY"!=i&&"ABOUT"!=i&&"ds6w:type"!=i||e([]);let n=s.getPredicateDataType(i);e(r._relations.filter(function(e){return e.dataTypes.find(e=>e===n)}))}})}})}),define("DS/SNSmartQuery/Suggesters/CompanyTagSuggester",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNSuggestionHelper","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository"],function(e,t,r,i,s,n,a,o,u,l){"use strict";return t.singleton({init:function(){},getSuggestions:function(t,r){return e.is(o.getOption("communityTags"))||(t=void 0),new Promise((e,i)=>{!0===r.rule[u.TokenType.COMPANY_TAG]&&t&&t.startsWith("#")?n.getEnterpriseConceptsSuggestions("").then(function(t){n.getIcon().then(function(r){let i;t=t.entries,r?s.iconURL_check(r)&&(i=r):r="building-office wux-ui-3ds",t=t.map(e=>({displayValue:e.entry,value:e.value.replaceAll(":","\\:"),uri:e.value.replaceAll(":","\\:"),suggestionType:u.TokenType.COMPANY_TAG,category:u.SUGGESTION_CATEGORY[e.category.toUpperCase()],imageUrl:e.imageUrl?e.imageUrl:void 0,iconClass:e.imageUrl?void 0:r})),e(t)})}):e([])})}})}),define("DS/SNSmartQuery/Suggesters/PredicateSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SNUnitConversion","DS/SNInfraUX/SNPLMDictionary","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/utils/StaticDataRepository","i18n!DS/SNSmartQuery/assets/nls/SNSmartQuery.json"],function(e,t,r,i,s,n,a,o,u,l,c,p){"use strict";return t.singleton({init:function(){},getSuggestions:function(e,t){let r=this,i=[],n=t.types.length>0,a=t.interfaces.length>0,o=s.getActiveTenant();return new Promise((e,s)=>{if(!0!==t.rule[u.TokenType.PREDICATE])e([]);else if(a){let s=1===t.types.length?t.types:c.intefaceTypeMap[t.interfaces[0]],n=t.interfaces,a=s.concat(n),u=c.loadRelevantPredicates({className:a,tenantId:o});Promise.all(u).then(function(t){r._buildRangeValues(t);let s=(t=r._manageExcludePredicates(t))[0];t.splice(0,1);let n=t,a=s.vocabularyPredicateInfo,o=r._getCommonPredicates(n);i=a.concat(o),i=r._preparePredicates(i),i=r._getPredKeywords().concat(i),e(i)})}else if(n){let s=t.types;s.some((e,t)=>"3dspace"===c._sourceMap[e]);if(s.every((e,t)=>"3dspace"===c._sourceMap[e])){let t=c.loadRelevantPredicates({className:s,tenantId:o});Promise.all(t).then(function(t){r._buildRangeValues(t),t=r._manageExcludePredicates(t),i=r._getCommonPredicates(t),i=r._preparePredicates(i),i=r._getPredKeywords().concat(i),e(i)})}else c.getPreicatesPormise().then(function(t){t=c._handleExcludeAndPrefPredicates(t),t=r._getPredKeywords().concat(t),e(t)})}else c.getPreicatesPormise().then(function(t){t=c._handleExcludeAndPrefPredicates(t),t=r._getPredKeywords().concat(t),e(t)})})},_getPredKeywords:function(){let e=[];return(e=l.get("pred_keywords")).forEach(e=>{e.suggestionType=u.TokenType.PREDICATE,e.displayValue=p.get(e.key),e.relativePath&&(e.imageUrl=i.getWebappsBaseUrl()+e.relativePath)}),e},_preparePredicates:function(e){return e=(e=c._handleExcludeAndPrefPredicates(e)).map(e=>{c.setPredicateDataType(e);let t=e.uri.startsWith("ds6wg")?u.SUGGESTION_CATEGORY.DS_SIX_WG:c.rootMap[e.uri];return{displayValue:e.nlsName,value:"["+e.uri+"]",uri:e.uri,suggestionType:u.TokenType.PREDICATE,iconClass:t&&t.startsWith("ds6w:")?"fonticon-3ds-"+t.substring(5):"fonticon-properties-filter",dataType:c.getPredicateDataType(e.uri),category:t,weightage:e.weightage,unitInfo:e.dimension?o._dimensions[e.dimension]:void 0}})},_buildRangeValues:function(t){t.forEach(t=>{c._rangeValueMap[t.type]||t.vocabularyPredicateInfo.forEach(r=>{r.rangeValues&&e.is(r.rangeValues.literalInfo,"array")&&c.setRangeValues(r.uri,t.type,r.rangeValues.literalInfo)})})},_manageExcludePredicates:function(e){let t=[];return e.forEach(e=>{let r={type:e.type,vocabularyPredicateInfo:[]},i=c.excludePredTypeMap[r.type]||[];e.vocabularyPredicateInfo.forEach(e=>{-1===i.indexOf(e.uri)&&r.vocabularyPredicateInfo.push(e)}),t.push(r)}),t},_getCommonPredicates:function(e){let t,r=e[0].vocabularyPredicateInfo;return e.forEach((e,i)=>{t=e.vocabularyPredicateInfo,r=r.filter(e=>t.some(t=>e.uri===t.uri))}),r}})}),define("DS/SNSmartQuery/Suggesters/UnaryOperatorSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig"],function(e,t,r,i,s,n){"use strict";return t.singleton({_relations:null,init:function(){this._relations=n.get("UnaryOperators"),this._relations.forEach((e,t)=>{e.suggestionType=i.TokenType.U_OPERATOR,e.iconClass=void 0,e.category=i.SUGGESTION_CATEGORY.OPERATOR})},getSuggestions:function(e,t){let r=this;return new Promise((e,s)=>{!0!==t.rule[i.TokenType.U_OPERATOR]?e([]):e(r._relations)})}})}),define("DS/SNSmartQuery/Suggesters/InterfaceSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNInfraUX/SNVocabAccess","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNInfraUX/SearchUtils"],function(e,t,r,i,s,n,a){"use strict";return t.singleton({_interfaces:null,init:function(){},getSuggestions:function(e,t){return new Promise((e,r)=>{if(!0!==t.rule[s.TokenType.INTERFACE])e([]);else if(1===t.types.length){let r=t.types[0],o=a.getActiveTenant();i.loadRelevantInterfaces({className:r,tenantId:o},function(t){t.interfaces.forEach((e,t)=>{n.intefaceTypeMap[e.name]=r}),e(t.interfaces.map(e=>({displayValue:e.nlsName,value:'flattenedtaxonomies:"interfaces/'+e.name.replace("ds6wg:","")+'"',suggestionType:s.TokenType.INTERFACE,uri:e.name,textToInsert:"`"+e.nlsName+"` ",iconClass:"fonticon-part-add",category:s.SUGGESTION_CATEGORY.WHAT})))})}else e([])})}})}),define("DS/SNSmartQuery/Suggesters/KeywordSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/keywords/SNKeywordManager","DS/SNSmartQuery/SNSmartQueryRules","DS/WebappsUtils/WebappsUtils","DS/SNSmartQuery/utils/StaticDataRepository"],function(e,t,r,i,s,n,a,o){"use strict";return t.singleton({_interfaces:null,_who_keywords:[{displayValue:"ME",value:"$ME",category:n.SUGGESTION_CATEGORY.WHO,imageUrl:a.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png"}],_when_keywords:[{displayValue:"TODAY",value:"$TODAY",uri:"keyword:today",category:n.SUGGESTION_CATEGORY.WHEN,imageUrl:a.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-day.png"},{displayValue:"This Week",value:"$THIS_WEEK",uri:"keyword:thisweek",category:n.SUGGESTION_CATEGORY.WHEN,imageUrl:a.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-week.png"},{displayValue:"This Month",value:"$THIS_MONTH",uri:"keyword:thismonth",category:n.SUGGESTION_CATEGORY.WHEN,imageUrl:a.getWebappsBaseUrl()+"TagNavigator/assets/icons/select-range.png"},{displayValue:"This Year",value:"$THIS_YEAR",uri:"keyword:thisyear",category:n.SUGGESTION_CATEGORY.WHEN,imageUrl:a.getWebappsBaseUrl()+"TagNavigator/assets/icons/calendar.png"},{displayValue:"Last Year",value:"$LAST_YEAR",uri:"keyword:lastyear",category:n.SUGGESTION_CATEGORY.WHEN,imageUrl:a.getWebappsBaseUrl()+"TagNavigator/assets/icons/last-year.png"}],_how_keywords:[{displayValue:"Launch App",value:"LAUNCH_APP",category:n.SUGGESTION_CATEGORY.HOW}],init:function(){},getSuggestions:function(t,r){let i=this,s=r.currentPredicate,a=o.getPredicateDataType(s);return new Promise((t,o)=>{!0!==r.rule[n.TokenType.KEYWORD]&&!0!==r.rule[n.TokenType.V_KEYWORD]?t([]):!0===r.rule[n.TokenType.KEYWORD]?t(i._who_keywords.concat(i._when_keywords).concat(i._how_keywords).map(function(e){return e.suggestionType=n.TokenType.KEYWORD,e})):!0===r.rule[n.TokenType.V_KEYWORD]&&("string"===a||"date"===a?i._getRootWofPredicate(s).then(function(r){e.is(r,"array")&&r.length>0||s.startsWith("ds6wg:")?r[0]&&"ds6w:who"===r[0].lineage?t(i._who_keywords.map(function(e){return e.suggestionType=n.TokenType.V_KEYWORD,e})):t("date"===a?i._when_keywords.map(function(e){return e.suggestionType=n.TokenType.V_KEYWORD,e}):[]):t(s&&"$BY"==s?i._who_keywords.map(function(e){return e.suggestionType=n.TokenType.V_KEYWORD,e}):[])}):t([]))})},_getRootWofPredicate:function(e){let t=i.getLanguage(),s=i.getActiveTenant();return new Promise(function(i,n){r.getPropertiesRoots(e,{onComplete:i,onFailure:i,lang:t,tenantId:s})})}})}),define("DS/SNSmartQuery/Suggesters/CommunityTagSuggester",["UWA/Core","UWA/Class","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNSuggestionHelper","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository"],function(e,t,r,i,s,n,a,o,u){"use strict";return t.singleton({init:function(){this.conceptsLoaded=!1},getSuggestions:function(t,i){let a=r.deferred();if(e.is(n.getOption("communityTags"))||(i.community=void 0),i.community&&!e.is(u._communityContainerUidMap[i.community])){let t=function(t){e.is(t.results,"array")&&t.results.forEach((e,t)=>{let r,i;e.attributes.forEach((e,t)=>{"ds6w:containerUid"===e.name&&(r=e.value),"ds6w:where/ds6w:context/ds6w:community"!==e.name&&"ds6w:community"!==e.name||(i=e.value)}),r&&i&&!u._communityContainerUidMap[i]&&(u._communityContainerUidMap[i]=r)}),a.resolve()},r=function(){a.resolve()},s={fedsearchOptions:this._getFedSearchOptions(i),onComplete:t,onFailure:r};u._fedSearch(s)}else a.resolve();return new Promise((r,n)=>{a.promise.then(function(){!0===i.rule[o.TokenType.COMMUNITY_TAG]&&i.community&&u._communityContainerUidMap[i.community]&&t&&t.startsWith("#")?require(["DS/TagNavigator/userTags/utils/UserTagsUtils"],function(t){let n={appName:"3DSearch",currentUser:s.getUserId(),platformId:s.getActiveTenant(),vocabSuggestions:!1,communityTags:!0,existingUserTags:!0,communityId:u._communityContainerUidMap[i.community]};t.getSuggestionsFor3DSwymContent(n).then(function(t){if(UWA.is(t,"object")&&UWA.is(t.suggestions,"array")){let i=t.suggestions.map(t=>{let r=t.sixw.split("/")[0].substring(5);return{displayValue:e.is(t.dispValue,"array")?t.dispValue.pop():t.dispValue,value:t.isCommunityTag?"[swym:"+r+'CommunityTag]:"'+t.object_db.replaceAll("_BELCHAR_","//")+'"':"[ds6w:"+r+']:"'+t.object_db+'"',uri:t.object_db,suggestionType:t.isCommunityTag?o.TokenType.COMMUNITY_TAG:o.TokenType.USER_TAG,category:o.SUGGESTION_CATEGORY[r.toUpperCase()],iconClass:"fonticon fonticon-3ds-"+r}});r(i)}else r([])},function(){r([])})}):r([])})})},_getFedSearchOptions:function(e){return{label:"ExpertSearchSuggest-"+s.getUserId()+"-"+(new Date).getTime(),order_by:"desc",order_field:"relevance",query:'[ds6w:community]:"'+e.community+'" NOT [ds6w:type]:"swym:Community"',select_predicate:["ds6w:community","ds6w:containerUid"],nresults:1,source:["swym"],tenant:s.getActiveTenant(),with_nls:!1,with_synthesis:!1}}})}),define("DS/SNSmartQuery/context/ContextManager",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/SNSmartQueryRules"],function(e,t,r,i){"use strict";return t.extend({init:function(){this._types=[],this._interfaces=[],this._nls2InternalNameMap=new Map},getContext:function(e,t){var i,s,n,a=void 0;this._types=[];for(var o=0;o<t&&t<=e.length;o++)"PREDICATE"===e[o].type&&(a=e[o].uri,n=!!e[o].isClassAttribute),this._selectedUnaryOperator="U_OPERATOR.IN"===e[o].uri?"U_OPERATOR.IN":null,i=e[o],"ds6w:where/ds6w:context/ds6w:community"===e[o].uri&&(s=e[o].displayValue);if(r.getOption("communityTags"))for(o=0;o<e.length;o++)e[o].type.endsWith("_TAG")&&(e[o].type="KEYWORD");return{types:this._types,interfaces:this._interfaces,currentPredicate:a,currentUnaryOperator:this._selectedUnaryOperator,lastToken:i,isClassAttribute:n,community:s}},addSelectedInterface:function(e){this._interfaces.push(e)},setSelectedUnaryOperator:function(e){this._selectedUnaryOperator=e},resetContext:function(){this._types=[],this._interfaces=[],this._selectedUnaryOperator=null,this._nls2InternalNameMap.clear()},updateContext:function(e){e.type===i.TokenType.INTERFACE?this.addSelectedInterface(e.uri):e.type===i.TokenType.U_OPERATOR?this.setSelectedUnaryOperator(e.uri):this.setSelectedUnaryOperator(null)}})}),define("DS/SNSmartQuery/utils/TypeGroupSuggestHelper",["UWA/Core","UWA/Class","UWA/Promise","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig","DS/WebappsUtils/WebappsUtils"],function(e,t,r,i,s,n,a){"use strict";return t.singleton({init:function(){this.typeCategoryPromise=null,this._category_predicates={}},buildCategories:function(e){let t=this.getCategoryFlatList(e),r=this;t=t.filter(function(e){return!(e.predicate&&e.predicate["ds6w:type"])}),this._buildCategoryPredicateInfo(t),t=(t=t.filter(function(e){let t=0;return Object.keys(r._category_predicates[e.id]).forEach(i=>{t+=r._category_predicates[e.id][i].length}),t<50})).map(e=>({displayValue:e.label?e.label:e.id,uri:e.id,value:e.id,suggestionType:i.TokenType.TYPE_GROUP,category:i.SUGGESTION_CATEGORY.WHAT,iconClass:e.iconClass,weightage:150,imageUrl:e.imageUrl})),this.categories=t},getTypeGroupQuery:function(e){let t="",r=this.getPredicatesForCategoryId(e);return Object.keys(r).forEach(e=>{let i="";r[e].forEach(t=>{let r="";r="ds6w:type"===e&&"3dspace"===s._sourceMap["ds6wg:"+t.uri]?'flattenedtaxonomies:"types/'+t.uri+'"':"["+e+']:"'+t.uri+'"',i&&(i+=" OR "),i+=r}),t+=t?" OR ":"",t+=i}),t="("+t+")"},_buildCategoryPredicateInfo:function(t){let r=this;e.is(t,"array")?t.forEach(e=>{this._buildCategoryPredicateInfo(e)}):(this._category_predicates[t.id]=t.predicate?t.predicate:{},t.subCategories.forEach(e=>{r._buildCategoryPredicateInfo(e);let i=r._category_predicates[e.id];Object.keys(i).forEach(i=>{r._category_predicates[t.id][i]||(r._category_predicates[t.id][i]=[]),r._category_predicates[t.id][i]=r._category_predicates[t.id][i].concat(r._category_predicates[e.id][i])})}))},getCategoryFlatList:function(t){let r=[],i=this;return e.is(t,"array")&&t.forEach(e=>{r.push(e),r=r.concat(i.getCategoryFlatList(e.subCategories))}),r},getPredicatesForCategoryId:function(e){return this._category_predicates[e]},getTypeCategoryPromise:function(){let t=this;return this.typeCategoryPromise||(this.typeCategoryPromise=new r(function(r,i){require(["text!DS/TagNavigator/assets/CriteriaInfo.json","text!DS/TagNavigator/assets/nls/TagNavigator_en.json"],function(i,s){let n=[];var o=JSON.parse(i),u=JSON.parse(s),l=o.category_resources,c=function(e){let t={},r=e.parent,i=l[r];return r&&i&&(i.imageUrl?t.imageUrl=i.imageUrl:i.iconClass?t.iconClass=i.iconClass:t=c(i)),t};Object.keys(l).forEach((t,r)=>{let i=l[t];if(i.id=t,i.label=u[t],i.imageUrl=l[t].image,i.imageUrl=i.imageUrl?a.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+i.imageUrl:void 0,delete i.image,!e.is(i.imageUrl)&&!e.is(i.iconClass)){let e=c(i);e.imageUrl?i.imageUrl=e.imageUrl:i.iconClass=e.iconClass}i.subCategories=[]}),Object.keys(l).forEach((t,r)=>{let i=l[t];if(e.is(i.parent)){l[i.parent].subCategories.push(t)}else n.push(t)});var p=function(e,t){let r={label:t.label,id:t.uri,imageUrl:t.imageUrl,iconClass:t.iconClass,subCategories:[],predicate:{}};return r.predicate[e]=[],r.predicate[e][0]={uri:t.uri},r},g=o.predicate_Mapping;let d=g.active_predicates;for(var y=0;y<d.length;y++)if(g[d[y]]){let t=g[d[y]];Object.keys(t).forEach(r=>{let i={label:void 0,uri:r},s=t[r].category;t[r].image?i.imageUrl=a.getWebappsBaseUrl()+"TagNavigator/assets/icons/type_icon/"+t[r].image:t[r].iconClass?i.iconClass=t[r].iconClass:e.is(s,"string")?l[s].imageUrl?i.imageUrl=l[s].imageUrl:i.iconClass=l[s].iconClass:e.is(s,"array")?s.forEach((e,t)=>{i[e]=i,l[e].imageUrl?i[e].imageUrl=l[e].imageUrl:i[e].iconClass=l[e].iconClass}):i.iconClass="fonticon-pencil",e.is(s,"string")?l[s].subCategories.push(p(d[y],i)):e.is(s,"array")?s.forEach((e,t)=>{l[e].subCategories.push(p(d[t],i[e]))}):n.push(p(d[y],i))})}var f=function(t){return 0===t.subCategories.length?t:(t.subCategories.forEach((t,r,i)=>{e.is(t,"string")&&(i[r]=f(l[t]))}),t)};n.forEach((t,r,i)=>{e.is(t,"string")&&(i[r]=f(l[t]))}),t.buildCategories(n),r(t.categories)})})),this.typeCategoryPromise}})}),define("DS/SNSmartQuery/Suggesters/TypeSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchLogin","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/utils/TypeGroupSuggestHelper"],function(e,t,r,i,s,n,a,o,u){"use strict";return t.singleton({_types:null,init:function(){},getSuggestions:function(e,t){return new Promise((e,r)=>{!0!==t.rule[a.TokenType.TYPE]?e([]):o.getTypesPromise().then(function(r){t.interfaces.length>0&&(r=[]),e(r.map(function(e){return e.category=a.SUGGESTION_CATEGORY.WHAT,e}))},function(){e([])})})}})}),define("DS/SNSmartQuery/SNSmartQueryTree",["UWA/Core","UWA/Class","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig"],function(e,t,r,i){"use strict";const s="TNODETYPE_PARENTHESIS",n="TNODETYPE_TYPES",a="TNODETYPE_PV";function o(){}function u(){}function l(e){this.type=s,this.operands=[],e.operand&&(this.operands.push(e.operand),e.operand.link=this),this.op=e.op,this.op&&(this.op.link=this),this.cp=e.cp,this.cp&&(this.cp.link=this)}function c(){}function p(e){this.type=n,this.types=e;let t=this;e.forEach((e,r)=>{e.link=t})}function g(e,t,r){this.type=a,this.p=e,this.o=t,this.v=r,e&&(e.link=this),t&&(t.link=this),r&&(r.link=this)}function d(e){this.uri=e}function y(e){this.theQuery=e,this.itr=0}function f(){this._stack=[]}y.prototype.pos=function(){return this.itr},y.prototype.peek=function(){return this.theQuery._query[this.itr]},y.prototype.next=function(){return this.theQuery._query[this.itr++]},y.prototype.hasNext=function(){return this.itr<this.theQuery._query.length},f.prototype.isEmpty=function(){return 0===this._stack.length},f.prototype.top=function(){return this._stack[this._stack.length-1]},f.prototype.push=function(e){this._stack.push(e)},f.prototype.pop=function(e){return this._stack.pop(e)};var h=t.extend({_theQuery:null,init:function(){this.operands=new f,this.operators=new f},destroy:function(){},_getTnode:function(e,t,r){let i;return(i="AND"===e.uri?new u:"OR"===e.uri?new o:new c).operator=e,e.link=i,i.operands=t||[],i.operands.forEach(e=>{e&&(e.link=i)}),i.type="",i.link=r,i},_getTypesnode:function(e){return new p(e)},_getPVnode:function(e){let t,i,s,n=e.peek();return n.type===r.TokenType.PREDICATE&&(t=e.next(),n=e.peek()),!n||n.type!==r.TokenType.R_OPERATOR&&n.type!==r.TokenType.U_OPERATOR||(i=e.next(),n=e.peek()),n&&[r.TokenType.KEYWORD,r.TokenType.USER_TEXT,r.TokenType.PREDICATE_VALUE,r.TokenType.V_KEYWORD,r.TokenType.COMPANY_TAG,r.TokenType.COMMUNITY_TAG,r.TokenType.USER_TAG].includes(n.type)&&(s=e.next()),new g(t,i,s)},_getParenthesisNode:function(e){return new l(e)},_manageLop:function(e){let t=this.operators;t.isEmpty()||this._precedence(t.top().uri)<=this._precedence(e.uri)?t.push(e):this._precedence(t.top().uri)>this._precedence(e.uri)&&(this._merge(e),t.push(e))},_getDefaultLop:function(){return new d(i.get("defaultOperator").L_OPERATOR)},buildTree:function(e){this._theQuery=e;let t=this._getQueryIterator(e);return this._buildTree(e,t)},_buildTree:function(e,t,i){for(;t.hasNext();){let n=t.peek(),a=r.getUqlRule(e,t.pos());if(a[n.type]||a[r.TokenType.L_OPERATOR]&&this._manageLop(this._getDefaultLop()),n.type==r.TokenType.TYPE||n.type==r.TokenType.INTERFACE||n.type==r.TokenType.TYPE_GROUP){let e=[n=t.next()];for(n=t.peek();n&&(n.type==r.TokenType.TYPE||n.type==r.TokenType.INTERFACE||n.type==r.TokenType.TYPE_GROUP);)e.push(t.next()),n=t.peek();let i=this._getTypesnode(e);this.operands.push(i)}else if(n.type===r.TokenType.L_OPERATOR){if(n=t.next(),this._manageLop(n),!(n=t.peek())||n.type===r.TokenType.CLOSE_PARENT){let e=this.operators.pop(),t=this.operators.pop();if(e&&t&&this._precedence(e.uri)>this._precedence(t.uri)){let r=this._getTnode(e,[this.operands.pop(),void 0]);this.operands.push(r),this.operators.push(t)}else t&&this.operators.push(t),e&&this.operators.push(e)}}else if(n.type===r.TokenType.OPEN_PARENT){let r=t.next(),i=(new h)._buildTree(e,t,!0);i&&i.type===s?i.op=r:i=this._getParenthesisNode({op:r,operand:i}),this.operands.push(i)}else if(n.type===r.TokenType.CLOSE_PARENT){this._merge();let e,r=this.operands.pop();if(e=r?this._getParenthesisNode({op:this.operators.pop(),cp:t.next(),operand:r}):this._getParenthesisNode({cp:t.next()}),i)return e;this.operands.push(e)}else{let e=this._getPVnode(t);this.operands.push(e)}}return this._merge(),this.operands.pop()},_merge:function(e){let t=this.operands,r=this.operators;if(e)for(;!r.isEmpty()&&this._precedence(r.top().uri)>this._precedence(e.uri);){let e=r.pop(),i=t.pop(),s=t.pop();if(s&&i){let r=this._getTnode(e,[s,i]);t.push(r)}else if(i){let r=this._getTnode(e,[i]);t.push(r)}else{let r=this._getTnode(e,[]);t.push(r)}}else{for(;!t.isEmpty()&&!r.isEmpty();){let e=r.pop(),i=t.pop(),s=t.pop();if(s&&i){let r=this._getTnode(e,[s,i]);t.push(r)}else if(i){let r=this._getTnode(e,[i]);t.push(r)}else{let r=this._getTnode(e,[]);t.push(r)}}for(;!r.isEmpty();){let e=r.pop(),i=t.pop(),s=this._getTnode(e,[i]);t.push(s)}}},_precedence:function(e){let t;switch(e){case")":case r.TokenType.CLOSE_PARENT:t=3;break;case"AND":t=2;break;case"OR":t=1;break;case"(":case r.TokenType.OPEN_PARENT:t=0}return t},_getQueryIterator:function(e){return new y(e)},_getContextTypes:function(e){let t=[];return e.types?t=t.concat(e.types):e.operands&&e.operands.forEach((e,r)=>{if(e)if(e.operands){let r=this._getContextTypes(e);t=t.concat(r)}else e.types&&(t=t.concat(e.types))}),t},getContextTypes:function(e,t){let r=[],i=(this.buildTree(e),e.getAt(t-1));if(i&&i.link){let e=i.link,t=e;for(;e.link;)(e=e.link).operator&&"AND"==e.operator.uri&&(t=e);t&&(t.operator&&"AND"===t.operator.uri||t.types)&&(r=this._getContextTypes(t))}return this._unlinkTree(e),r},_findPostOpen:function(e){if(e){if(e.op)return e.op;if(e.operands&&e.operands[0]&&e.operands[1])return this._findPostOpen(e.operands[0]);if(e.operands&&e.operands[0]){let t=e.operator,r=this._findPostOpen(e.operands[0]);return t&&this._theQuery._find(t)<this._theQuery._find(r)?t:r}if(e.operator)return e.operator;if(e.cp)return e.cp;if(e.types)return e.types[0];if(e.type==a)return e.p||e.o||e.v}},_findPreClose:function(e){if(e){if(e.cp)return e.cp;if(e.operands&&e.operands[0]&&e.operands[1])return this._findPreClose(e.operands[1]);if(e.operands&&e.operands[0]){let t=e.operator,r=this._findPreClose(e.operands[0]);return t&&this._theQuery._find(t)>this._theQuery._find(r)?t:r}if(e.operator)return e.operator;if(e.op)return e.op;if(e.types)return e.types[e.types.length-1];if(e.type==a)return e.v||e.o||e.p}},_addPreOpen:function(e){e.pre_open=e.pre_open?e.pre_open+1:1},_addPostClose:function(e){e.post_close=e.post_close?e.post_close+1:1},_addParenthesis:function(e){let t=this;if(e){if(e.operands&&e.operands.forEach((e,r)=>{t._addParenthesis(e)}),e.operands&&e.operator&&"AND"==e.operator.uri){let r=e.link;if(r&&r.operator&&"OR"===r.operator.uri){let r=t._findPostOpen(e);t._addPreOpen(r),r=t._findPreClose(e),t._addPostClose(r)}}if(e.type===s)if(e.op){if(!e.cp){let r=t._findPreClose(e);t._addPostClose(r)}}else{let r=t._findPostOpen(e);t._addPreOpen(r)}}},_getClosingPToken:function(){return{value:")",displayValue:")",uri:")",type:r.TokenType.CLOSE_PARENT,automatic:!0}},_getOpenPToken:function(){return{value:"(",displayValue:"(",uri:"(",type:r.TokenType.OPEN_PARENT,automatic:!0}},_checkParenthesisAddition:function(e){let t=!1;for(let r=e._query.length-1;r>=0;r--){let i=e._query[r];if(i.post_close){for(;i.post_close>0;)e._query.splice(r+1,0,this._getClosingPToken()),i.post_close--;delete i.post_close,t=!0}if(i.pre_open){for(;i.pre_open>0;)e._query.splice(r,0,this._getOpenPToken()),i.pre_open--;t=!0,delete i.pre_open}}return t},addParenthesis:function(e){let t=this.buildTree(e);this._addParenthesis(t);let r=this._checkParenthesisAddition(e);return this._unlinkTree(e),r},linkTree:function(e){return this.buildTree(e)},_unlinkTree:function(e){let t=this._getQueryIterator(e);for(;t.hasNext();){let e=t.next();e.link&&delete e.link}},_getQueryStringFromTree:function(e){let t="";return e&&(e.type===a?(e.p&&(t+=e.p.value),e.o&&(t+=(t?" ":"")+e.o.value),e.v&&(t+=(t?" ":"")+e.v.value)):e.type===n?t=e.types.reduce(function(e,t){return e+(e?" OR ":"")+t.value},""):e.type===s?(e.op&&(t=e.op.value+""),e.operands[0]&&(t+=this._getQueryStringFromTree(e.operands[0])),e.cp&&(t+=e.cp.value)):(t+=this._getQueryStringFromTree(e.operands[0]),t+=t?" ":"",t+=e.operator.uri?e.operator.uri:"",t+=t?" ":"",t+=this._getQueryStringFromTree(e.operands[1]))),t},getQueryStringFromTree:function(e){let t=this.buildTree(e);return this._getQueryStringFromTree(t)}});return h}),define("DS/SNSmartQuery/Suggester",["UWA/Core","UWA/Class","DS/SNInfraUX/Logger","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/context/ContextManager","DS/SNInfraUX/utils/RankingEngine"],function(e,t,r,i,s,n){"use strict";return t.extend({init:function(){},getSuggestions:function(t,i){let s=this;i||(i="");let a=this.getProviders();return new Promise((o,u)=>{if(e.is(a,"array")&&a.length>0){let u=[];require(a,function(){for(let e=0;e<arguments.length;e++)u.push(arguments[e].getSuggestions(i,t));Promise.all(u).then(function(){let t=[],a=arguments[0][0].length;for(let e=0;e<arguments[0].length;e++)t=t.concat(arguments[0][e]);let u=t.map(function(e){return{displayValue:e.displayValue,value:e.value,type:e.suggestionType,uri:e.uri,imageUrl:e.imageUrl,iconClass:e.iconClass,imageUrlPromise:e.imageUrlPromise,category:e.category,info:e.info,trigram:e.trigram,dataTypes:e.dataType,weightage:e.weightage,unitInfo:e.unitInfo,isClassAttribute:e.classAttribute,matchType:e.matchType}},s);t=u.slice(a);let l=Date.now(),c=n.getMatchResults(i,t,"displayValue"),p=u.slice(0,a);if(p.length&&i&&i.startsWith("@")){i=i.substring(1);let e=n.getMatchResults(i,p,"trigram");p=p.filter(function(e){return!e.matchType});let t=n.getMatchResults(i,p,"displayValue");(p=e.concat(t)).length&&(c=p.concat(c))}r.debug(Date.now()-l,"ranking engine - time(ms) taken for",i.length+"chars"),c.forEach((t,r)=>{if(t.unitInfo&&t.unitInfo.MKSUnit&&e.is(t.unitInfo.Units,"array")){let e,r=t.unitInfo.MKSUnit;t.unitInfo.Units.forEach(t=>{r==t.Name&&(e=t.NLSName)}),e&&(t.displayValue+=" ["+e+"]")}});let g=[],d=[];for(var y=0;y<c.length;)c[y].weightage&&c[y].weightage>=110?(g.push(c[y]),c.splice(y,1)):c[y].weightage&&c[y].weightage>100?(d.push(c[y]),c.splice(y,1)):y++;if(g.sort((e,t)=>t.weightage-e.weightage),d.sort((e,t)=>t.weightage-e.weightage),s.reorder(c),s.reorder(g),s.reorder(d),(c=g.concat(d.concat(c)))[0]&&c[0].matchType){let e=c.filter(function(e){return"exact"===e.matchType}),t=c.filter(function(e){return"simple"===e.matchType}),r=c.filter(function(e){return"extended"===e.matchType});c=e.concat(t.concat(r))}o(c)})})}else o([])})},getProviders:function(){return i.get("SuggestionProviders")},reorder:function(e){var t=i.get("Reorder"),r=new Map;t.forEach((e,t)=>{e.forEach((e,i)=>{r.set(e,[t,i])})});for(var s=[],n=0;n<e.length;n++){var a=r.get(e[n].uri);a&&(s[a[0]]=s[a[0]]?s[a[0]]:[],s[a[0]][a[1]]=n)}s=s.filter(function(e){return void 0!==e});for(n=0;n<s.length;n++){s[n]=s[n].filter(function(e){return void 0!==e});for(var o=[],u=0;u<s[n].length;u++)o.push(e[s[n][u]]);s[n].sort((e,t)=>e-t);for(u=0;u<s[n].length;u++)e[s[n][u]]=o[u]}}})}),define("DS/SNSmartQuery/SNSmartQuery",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNSmartQuery/context/SNSmartQueryToken","DS/SNSmartQuery/SNSmartQueryTree","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/context/ContextManager","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/utils/TypeGroupSuggestHelper","DS/SNSmartQuery/Suggester"],function(e,t,r,i,s,n,a,o,u,l,c){"use strict";return t.extend({SUGGESTION_CATEGORY:n.SUGGESTION_CATEGORY,_suggester:null,_contextManager:null,init:function(){this._query=[],this._suggester=new c,this._contextManager=new o,this.load()},load:function(){return Promise.all(u.getStaticDataPromiseArray())},_getContext:function(e){let t=this._contextManager.getContext(this._query,e),r=(new s).getContextTypes(this,e);return t.types=[],t.interfaces=[],r&&r.forEach((e,r)=>{e.type===n.TokenType.TYPE?t.types.push(e.uri):e.type===n.TokenType.INTERFACE&&t.interfaces.push(e.uri)}),t.rule=n.getRule(this,e),t},getSuggestions:function(e,t){let r=this._getContext(e);return this._suggester.getSuggestions(r,t)},setSuggestion:function(t){let i;if(t.selection){i=t.selection;let n=t.at;r.getOption("communityTags")&&i.type.endsWith("_TAG")&&(i.type="KEYWORD"),this._contextManager.updateContext(i);let a=this.getTokenForSuggestion(i);e.is(n)?this.setAt(n,a):this.push(a);let o={suggestionToken:a};if(t.addParenthesis){let e=(new s).addParenthesis(this);o.refresh=e,o.at=this._find(a)}return o}{i=t,this._contextManager.updateContext(i);let e=this.getTokenForSuggestion(i);return this.push(e),e}},getTokenForSuggestion:function(e){return new i(e)},buildQueryString:function(){let t=a.get("defaultOperator").L_OPERATOR,r=a.get("defaultOperator").R_OPERATOR;function i(e,t){if(++t<e.length)return e[t]}function s(t,r,i,s){let n="",a=e.is(t.value,"object")?t.value.from:void 0,o=e.is(t.value,"object")?t.value.to:void 0;return"date"===r&&(e.is(a)&&(a=new Date(a+" 00:00:00"),a='"'+(a=new Date(a).toISOString())+'"'),e.is(o)&&(o=new Date(o+" 23:59:59"),o='"'+(o=new Date(o).toISOString())+'"')),"operator:after"===s?o:"operator:before"===s?a:(e.is(a)?(n+=" >= "+a,e.is(o)&&(n+=" AND ["+i+"] <= "+o)):e.is(o)&&(n+=" >= "+o),n)}function o(e){y+=" "+e}function c(){if(p.length>0){let e=p.join(" OR ");p.length>1&&(e="("+e+")"),y+=" "+e,p=[]}if(d.length>0){let e=d.join(" OR ");d.length>1&&(e="("+e+")"),y+=" AND "+e,d=[]}if(g.length>0){let e=(g=g.map(e=>l.getTypeGroupQuery(e))).join(" OR ");g.length>1&&(e="("+e+")"),y&&(y="("+y+") OR "),y+=" "+e,g=[]}}let p=[],g=[],d=[],y="";for(let e=0;e<this._query.length;e++)if(this._query[e].type==n.TokenType.TYPE)p.push(this._query[e].value);else if(this._query[e].type==n.TokenType.TYPE_GROUP)g.push(this._query[e].value);else if(this._query[e].type==n.TokenType.INTERFACE)d.push(this._query[e].value);else{c();let a=n.getUqlRule(this,e);if(a[this._query[e].type]||a[n.TokenType.L_OPERATOR]&&o(t),this._query[e].type==n.TokenType.U_OPERATOR){let t=i(this._query,e);if(t&&t.type===n.TokenType.PREDICATE_VALUE){o("["+t.uri.split("/").pop()+"]:")}continue}if(this._query[e].type==n.TokenType.PREDICATE&&"ds6w:type"==this._query[e].uri||o(this._query[e].value),this._query[e].type==n.TokenType.PREDICATE){let t=i(this._query,e),l=this._query[e].uri,c=u.getPredicateDataType(l);if(t){if(t.type!==n.TokenType.R_OPERATOR)"custPredVal:range"!==t.uri&&"custPredVal:datepicker"!==t.uri&&"ABOUT"!==this._query[e].uri&&"ds6w:type"!==this._query[e].uri&&o(r[c]);else{let r=i(this._query,e+1);"operator:on"===t.uri&&r&&"custPredVal:datepicker"===r.uri||o(t.value),e++,t=i(this._query,e)}t&&(a=n.getPredicateValueTokenTypes(),"custPredVal:range"===t.uri||"custPredVal:datepicker"===t.uri?o(s(t,c,l,this._query[e].uri)):"string"===c&&t.type===n.TokenType.USER_TEXT&&(t.value[0]!==t.value[t.value.length-1]||"*"!==t.value[0]&&'"'!==t.value[0]&&"'"!==t.value[0])?"*"===t.value[0]||"*"===t.value[t.value.length-1]?o(t.value):"+"===t.value[0]?o(t.value):"operator:is"===this._query[e].uri?o('"'+t.value+'"'):o('"*'+t.value+'*"'):o(t.value),e++)}}}return c(),y.trim()},push:function(e){this._query.push(e)},pop:function(){return this._query.pop()},length:function(){return this._query.length},getAt:function(e){return this._query[e]},setAt:function(e,t){this._query.splice(e,0,t)},removeAt:function(e){return this._query.splice(e,1)},spliceAt:function(e,t){return this._query.splice(e,0,t)},_find:function(e){for(let t=0;t<this._query.length;t++)if(this._query[t]==e)return t},destroy:function(){return this._query=[],this._suggester&&e.is(this._suggester.destroy,"function")&&this._suggester.destroy(),this._contextManager&&e.is(this._contextManager.resetContext,"function")&&this._contextManager.resetContext(),this._parent()}})}),define("DS/SNSmartQuery/utils/CustomPredicateSuggestHelper",["UWA/Core","UWA/Class","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNSmartQuery/config/SmartQueryConfig"],function(e,t,r,i,s){"use strict";return t.singleton({predicate_suggests:null,init:function(e){let t=this;this.predicate_suggests=s.get("CustomPredicatesSuggests"),Object.keys(this.predicate_suggests).forEach(e=>{t.predicate_suggests[e].forEach(e=>{e.suggestionType=r.TokenType.PREDICATE_VALUE})}),this._parent(e)},getPredicateSuggests:function(e){return this.predicate_suggests[e].map(function(t){return t.dataType=e,t})}})}),define("DS/SNSmartQuery/Suggesters/PredicateValueSuggester",["UWA/Core","UWA/Class","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SearchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/SearchLogin","DS/SNSmartQuery/utils/CustomPredicateSuggestHelper","DS/SNSmartQuery/config/SmartQueryConfig","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/utils/StaticDataRepository","DS/SNInfraUX/PlatformEnvServices","DS/SNInfraUX/utils/SearchNlsUtils","DS/SNInfraUX/keywords/SNKeywordManager"],function(e,t,r,i,s,n,a,o,u,l,c,p,g,d,y){"use strict";return t.singleton({_interfaces:null,init:function(){this.imageUrlPromiseMap=new Map},getSuggestions:function(t,r){let i=this,s=r.currentPredicate,n=r.currentUnaryOperator,a=p.getPredicateDataType(s),o=r.types.concat(r.interfaces);return new Promise((u,l)=>{if(!0!==r.rule[c.TokenType.PREDICATE_VALUE])return void u([]);r.isClassAttribute&&(o=["classifiationAttr"]);var g=[];if(r.currentPredicate){for(var d=0;d<o.length;d++){let t=p.getRangeValues(r.currentPredicate,o[d]);e.is(t,"array")&&(g=g.concat(t))}g.sort((e,t)=>e.nlsValue.localeCompare(t.nlsValue));for(d=1;d<g.length;)g[d].nlsValue===g[d-1].nlsValue?g.splice(d,1):d++}if("ds6w:type"===s)return void p.getTypesPromise().then(function(e){u(e.map(e=>{let t={};return e.imageUrl?t.imageUrl=e.imageUrl:e.iconClass&&(t.iconClass=e.iconClass),"fonticon-3d-object"===t.iconClass&&(t.iconClass="fonticon-tag-alt"),t.uri=e.uri,t.displayValue=e.displayValue,t.value=e.value,t.weightage=e.weightage,t.category=c.SUGGESTION_CATEGORY.WHAT,t.suggestionType=c.TokenType.PREDICATE_VALUE,t}))});let y=[];if(g&&g.length)return g.forEach((e,t)=>{var i={};i.displayValue=e.nlsValue,i.value=e.value,i.uri=e.value,i.suggestionType=c.TokenType.PREDICATE_VALUE,i.category=r.currentPredicate.startsWith("ds6wg:")?c.SUGGESTION_CATEGORY.DS_SIX_WG:p.rootMap[r.currentPredicate],i.textToInsert="`"+e.nlsValue+"` ",i.iconClass="fonticon-tag-alt",y.push(i)}),void u(y);if("string"===a||n)i._getSuggestions(t,r).then(function(e){u(e)});else{let e=i._getCustomSuggestsForDataType(a);if(e){e.forEach((e,t)=>{e.category=p.rootMap[s]});let t=r.lastToken;u(e.filter(function(e){return"custPredVal:range"===e.uri?"PREDICATE"===t.type||"operator:between"===t.uri:"custPredVal:datepicker"!==e.uri||(/operator\:(after|before|on)/.test(t.uri)||"PREDICATE"===t.type)}))}else u(y)}})},_getCustomSuggestsForDataType:function(e){return u.getPredicateSuggests(e)},_getSuggestions:function(t,r){let s=this;return new Promise((n,o)=>{let u=[];if(t&&t.startsWith("@")||"ABOUT"===r.currentPredicate)return void n([]);if(t.length<3)return void n([]);var l={fedsearchOptions:s._getFedSearchOptions(t,r),onComplete:function(t){e.is(t.results,"array")&&t.results.forEach((e,t)=>{let r,i;e.attributes.forEach((e,t)=>{"ds6w:containerUid"===e.name&&(r=e.value),"ds6w:where/ds6w:context/ds6w:community"===e.name&&(i=e.value)}),r&&i&&!p._communityContainerUidMap[i]&&(p._communityContainerUidMap[i]=r)});let o=[];if(e.is(t.facets,"array")){let h=s._getInPredicates(r);h.indexOf("ds6w:community")>-1&&h.indexOf("ds6w:containerUid")>-1&&(h=h.filter(function(e){return"ds6w:containerUid"!==e}));var l=[];t.facets.forEach((e,t)=>{h.indexOf(e.sixw.split("/").pop())>=0&&l.push(e)});var f={facets:l,tenantId:i.getActiveTenant(),onComplete:function(){h.indexOf("ds6w:policy")>-1&&h.indexOf("ds6w:status")>-1&&(l=l.filter(function(e){return"ds6w:status"===e.sixw.split("/").pop()})),l.forEach(t=>{let r={displayValue:e.is(t.dispValue,"string")?t.dispValue:e.is(t.dispValue,"array")?t.dispValue.pop():t.object,value:'"'+t.object+'"',suggestionType:c.TokenType.PREDICATE_VALUE,uri:t.sixw,category:t.sixw.split("/").pop().startsWith("ds6wg")?c.SUGGESTION_CATEGORY.DS_SIX_WG:p.rootMap[t.sixw.split("/").pop()],textToInsert:"`"+t.object+"` "};if("ds6w:who/ds6w:responsible"===t.sixw||y.getByPredicates().indexOf(t.sixw.split("/").pop())>=0){let e;s.imageUrlPromiseMap.get(t.object)?e=s.imageUrlPromiseMap.get(t.object):(e=a.deferred(),s.imageUrlPromiseMap.set(t.object,e),o.push(t.object)),r.imageUrlPromise=e.promise,r.category=c.SUGGESTION_CATEGORY.WHO}else"ds6w:where/ds6w:context/ds6w:community"===t.sixw?r.iconClass="fonticon-users-alt":r.iconClass="fonticon-tag-alt";u.push(r)}),u.sort((e,t)=>e.displayValue.localeCompare(t.displayValue));for(var t=1;t<u.length;)u[t].displayValue===u[t-1].displayValue?u.splice(t,1):t++;o.length&&require(["DS/TagNavigator/TagsServer","DS/SNInfraUX/SearchUtils"],function(t,r){if(!s._tagsServer){let e=r.getActiveTenant(),i=g.getServiceURL("cstorage",e);s._tagsServer=new t(i,e,e)}let i=function(t){e.is(t,"array")&&t.forEach(function(e,t){let r,i;e.attributes.forEach(function(e){if("ds6w:label"===e.name){let t=e.value;i=s.imageUrlPromiseMap.get(t)}"preview_url"===e.name&&(r=e.value)}),i&&i.resolve(r)})};s._tagsServer.getUsersInfo(r.getUserId(),o,function(e){e.forEach(function(e){e.then(i)})},function(){Logger.log("SmartQueryController::_buildWhosuggestions onFailure")})}),n(u)},onFailure:function(){n([])}};d.translateFacets(f)}else n([])},onFailure:function(){n([])}};p._fedSearch(l)})},_getFedSearchOptions:function(t,r){r.currentPredicate;let s=i.getActiveTenant(),n=this._getInSources(r),a=n.includes("swym"),o=r.types,u="";if(e.is(o,"array")&&o.length>0&&(u=o[0].indexOf("ds6wg:")>=0?'(flattenedtaxonomies:"types/'+o[0].replace("ds6wg:","")+'"':'([ds6w:type]:"'+o[0]+'"',o.forEach((e,t)=>{t>0&&(e[0].indexOf("ds6wg:")>=0?u+=' OR flattenedtaxonomies:"types/'+e.replace("ds6wg:","")+'"':u+=" OR [ds6w:type]:"+e)}),u+=")"),r.currentUnaryOperator){let e=this._getInQuery(r,t);e&&(u+=(u?" AND ":"")+e)}if("$BY"===r.currentPredicate){let e=t[0]!==t[t.length-1]||'"'!=t[0]&&"'"!=t[0]&&"*"!=t[0]?"*":"";t=e+t+e,u=(u+=(u?" AND ":"")+y.getKeywordQuery("BY")).replaceAll("{USER_NAME}",t)}if(!u)return;let l={label:"ExpertSearchSuggest-"+i.getUserId()+"-"+(new Date).getTime(),order_by:"desc",order_field:"relevance",query:u,select_predicate:this._getInPredicates(r),nresults:100,source:n,tenant:s,with_nls:!1};return a||(l.select_synthesis=this._getInPredicates(r)),l},_getAvailableSources:function(){let e=i.getActiveTenant(),t=o.getAvailableSources(e);return t=t.map(e=>e.name)},_getInSources:function(t){let r=[],i=this._getAvailableSources();if(t.currentPredicate)p._typesLoaded?(t.types.forEach((e,t)=>{r.push(p._sourceMap[e])}),r=r.filter(function(e,t,r){return t===r.indexOf(e)})):r=i;else{if("U_OPERATOR.IN"===t.currentUnaryOperator){let t=l.get("operator_in_suggest_predicates");e.is(t,"array")&&t.forEach(e=>{e.predicate&&e.source&&i.includes(e.source)&&r.push(e.source)})}}return 0===r.length&&(r=i),r},_getInPredicates:function(t){let r=[],i=t.currentUnaryOperator;if(i){if("U_OPERATOR.IN"===i){let t=this._getAvailableSources(),i=l.get("operator_in_suggest_predicates");e.is(i,"array")&&i.forEach(e=>{e.predicate&&e.source&&t.includes(e.source)&&r.push(e.predicate)})}}else"$BY"===t.currentPredicate?r=y.getByPredicates():r.push(t.currentPredicate);return r.indexOf("ds6w:status")>-1&&r.push("ds6w:policy"),r.indexOf("ds6w:community")>-1&&r.push("ds6w:containerUid"),r},_getInQuery:function(e,t){let r="";return this._getInPredicates(e).forEach((e,i)=>{r+=(r?" OR ":"")+"["+e+"]: *"+t+"*"}),r.length>1&&(r="("+r+")"),r},_getRootWofPredicate:function(e){let t=i.getLanguage(),s=i.getActiveTenant();return new Promise(function(i,n){r.getPropertiesRoots(e,{onComplete:i,onFailure:i,lang:t,tenantId:s})})}})}),define("DS/SNSmartQuery/Suggesters/AtSuggester",["UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchUtils","DS/SNSmartQuery/SNSmartQueryRules","DS/SNSmartQuery/Suggesters/PredicateValueSuggester","DS/SNSmartQuery/utils/StaticDataRepository"],function(e,t,r,i,s,n,a){"use strict";return t.singleton({init:function(){},getSuggestions:function(t,n){return new Promise((o,u)=>{if((!0===n.rule[s.TokenType.USER_TEXT]||!0===n.rule[s.TokenType.PREDICATE_VALUE])&&t&&t.startsWith("@")){t=t.substring(1);let n=[];var l={onComplete:function(t){e.is(t.results,"array")?(t.results.forEach((e,t)=>{var i={};e.attributes.forEach((e,t)=>{"attribute"===e.format&&"ds6w:label"===e.name&&(i.displayValue=e.value),"internal"===e.format&&"preview_url"===e.name&&(i.imageUrl=e.value),"internal"===e.format&&"resourceid"===e.name&&e.value.startsWith("iam:")&&(i.trigram=e.value.substring(4))}),i.imageUrl||(i.imageUrl=r.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png"),i.displayValue&&(i.value='"'+i.displayValue+'"',i.uri=i.displayValue,i.suggestionType=s.TokenType.USER_TEXT,i.category=s.SUGGESTION_CATEGORY.WHO,i.textToInsert="`"+i.displayValue+"` ",n.push(i))}),o(n)):o([])},onFailure:function(e){o([])},fedsearchOptions:{label:"ExpertSearchSuggest-"+i.getUserId()+"-"+(new Date).getTime(),tenant:i.getActiveTenant(),query:'[ds6w:type]:"pno:Person"',source:["swym"],nresults:20,specific_source_parameter:{swym:{additional_query:" AND personOrGroup:("+t+")",agoraMode:!0}},with_synthesis:!1,select_predicate:["ds6w:label","ds6w:type"],with_synthesis_attribute:!1,start:0}};a._fedSearch(l)}else o([])})}})});