define("DS/MaturityWidget/MaturityConfirmationDialogFilter",["UWA/Promise","DS/LifecycleServices/Utils","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i){"use strict";function n(){}return n.prototype={showConfirmationDialog:function(n,o){if(null!=o&&o.hasOwnProperty("maturityWidget")&&!(void 0===o.maturityWidget||null===o.maturityWidget||o.maturityWidget.displayWorkflowGraph&&o.maturityWidget.model.isConfirmationDialogEnabled)){for(var a=[],s=0;s<n.length;s++)a[n[s].physicalid]="";return t.resolve(a)}return new t(function(t,a){var s=[],r=document.getElementById("sampleFilterId");r&&(r.parentNode.removeChild(r),r=void 0);for(var l=e.htmlFromString("<div id='sampleFilterId' class='lcm-confirmation-dialog-filter-transition'><div class='lcm-filter-title'>"+i.maturityConfirmationDialogTitle+"</div><div class='lcm-filter-msg'></div><div class='lcm-filter-buttons'><button class='lcm-filter-ok-button lcm-transition-confirm-button-base'>"+i.okButton+"</button><button class='lcm-filter-cancel-button lcm-transition-confirm-button-base'>"+i.cancelButton+"</button></div></div>"),c=(l.querySelector(".lcm-filter-transition"),l.querySelector(".lcm-filter-ok-button")),d=l.querySelector(".lcm-filter-cancel-button"),h=l.querySelector(".lcm-filter-msg"),u=0;u<n.length;u++){var p=o.maturityWidget.model.getStateUserNameFromStateSystemName(n[u].physicalid,n[u].tostate);h.innerHTML+=p}["mousedown","touchstart"].forEach(function(e){c.addEventListener(e,function(e){var i=document.getElementById("sampleFilterId");if(i){for(var o=0;o<n.length;o++)s[n[o].physicalid]="";i.style.display="none",t(s)}e.stopPropagation()}),d.addEventListener(e,function(e){var i=document.getElementById("sampleFilterId");i&&(i.style.display="none",t(s)),e.stopPropagation()})}),o.maturityWidget.elements.container.appendChild(l)})}},new n}),define("DS/MaturityWidget/MultiselUI",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServicesSettings","DS/UIKIT/Input/Select","DS/LifecycleControls/DataGridViewContainer","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","text!DS/LifecycleWidget/assets/MaturityStatePriority.json"],function(t,e,i,n,o,a,s){"use strict";return e.extend({isPromotePayload:!0,create:function(t,e,n,s){var r=this;this.model=t,this.maturityWidget=n,this.setTitle=s,i.app_initialization(function(){});var l=this.model.getObjects();this.container=UWA.createElement("div",{class:"lcm-maturity-container lcm-maturity-container-multisel lcm-maturity-table-container"}),this.container.inject(e);var c=this.promotion={},d={},h=[];if(this._prepareAndSort(l,c,d,h),this.maturityTable=UWA.createElement("table",{class:"MaturityTable"}),this.commandSpan=UWA.createElement("tr",{class:"MaturityCommandSpan"}).inject(this.maturityTable),this.tableSpan=UWA.createElement("tr",{class:"MaturityTableSpan"}).inject(this.maturityTable),this.maturityTable.inject(this.container),h.length>0){var u=document.createElement("p");u.textContent=a.changeMaturityTo,u.style.display="inline",this.maturityChangeDiv=UWA.createElement("div",{class:"maturity-change-txt"}),this.maturityChangeDiv.appendChild(u),this.commandSpan.appendChild(this.maturityChangeDiv)}if(h.length>=1)this._createStateSelCombo(c,d,h);else{if(1!==h.length){var p=UWA.createElement("p",{text:a.noAvailTransition,class:"maturity-info-msg"});return this.commandSpan.appendChild(p),!1}var m=h[0];this.toState=m;var f=document.createElement("p");f.textContent=d[m].stateUserName,f.style.display="inline",this.maturityTargetDiv=UWA.createElement("div",{class:"maturity-target-txt"}),this.maturityTargetDiv.appendChild(f),this.commandSpan.appendChild(this.maturityTargetDiv)}var y=document.createElement("p");y.textContent=a.stateQ,y.style.display="inline",this.maturityStateDiv=UWA.createElement("div",{class:"maturity-state-txt"}),this.maturityStateDiv.appendChild(y),this.commandSpan.appendChild(this.maturityStateDiv),this.objectListDiv=UWA.createElement("div",{class:"maturity-objectList"});var g=this._getUpdatedObjectsForState(c,this.toState);return this.objectsList=new o({idName:"dgvContainer",clickToShowDGV:!1,showLock:!0,showRowSelect:!1,showPreStatus:!1},g),this.objectsList.inject(this.objectListDiv),this.tableSpan.appendChild(this.objectListDiv),this.objectsList.dataGridView.addEventListener("click",function(t,e){var i=e.nodeModel._options;r._onDoubleClickLine(t,i)}),this._updateObjectListUI(c,g),this.onPanelResize(),!0},getPromotePayload:function(){var t=this,e=this.toState,i=[];this.promotion[e].forEach(function(n){if(!n.excludeFromPromote&&!n.isDemote&&t.model.getApplyTransition(n.phid)){var o=t.model.getAttribute(n.phid,"type"),a=t.model.getAttribute(n.phid,"revision"),s=t.model.getAttribute(n.phid,"policy"),r=t.model.getAttribute(n.phid,"name"),l=t.model.getAttribute(n.phid,"coretype"),c=t.model.getAttribute(n.phid,"interfaceHash"),d=t.model.getAttribute(n.phid,"cadMaster"),h="",u=t.model.getAttribute(n.phid,"signatures");if(u.hasOwnProperty([n.fromstate])){var p=u[n.fromstate];if(p.hasOwnProperty([e])){var m=Object.keys(p[e]);m.length>0&&"undefined"!=m[0]&&(h=m[0])}}i.push({physicalid:n.phid,tostate:e,fromstate:n.fromstate,type:o,revision:a,policy:s,name:r,coretype:l,interfaceHash:c,signature:h,cadMaster:d})}});var n={};return n.data=i,n},getDemotePayload:function(){var t=this,e=this.toState,i=[];this.promotion[e].forEach(function(n){if(!n.excludeFromPromote&&n.isDemote&&t.model.getApplyTransition(n.phid)){var o=t.model.getAttribute(n.phid,"type"),a=t.model.getAttribute(n.phid,"revision"),s=t.model.getAttribute(n.phid,"policy"),r=t.model.getAttribute(n.phid,"name"),l=t.model.getAttribute(n.phid,"coretype"),c=t.model.getAttribute(n.phid,"interfaceHash");i.push({physicalid:n.phid,tostate:e,fromstate:n.fromstate,type:o,revision:a,policy:s,name:r,coretype:l,interfaceHash:c})}});var n={};return n.data=i,n},onPanelResize:function(){if(void 0!==this.objectsList&&null!==this.objectsList&&void 0!==this.objectsList.objectsTable&&null!==this.objectsList.objectsTable){this.objectsList.objectsTable.resizeTable();var t=document.querySelectorAll("div.lcm-maturity-content");if(null!=t&&t.length>0){var e=t[0].getSize(),i=document.querySelectorAll('div.DivSSTableBody.objectlist-ReviseBody[data-rec-id="dataRecSSTable2"] div.no-native-scrollbars.scroller-content');if(null!=i&&i.length>0)for(var n=0;n<i.length;n++){var o=e.height-80;o>0&&(i[0].style.height=o+"px")}}}},_updateOKButton:function(){var t=this.getPromotePayload(),e=this.getDemotePayload();t.data.length>0||e.data.length>0?this.maturityWidget.updateOKButton(!0):this.maturityWidget.updateOKButton(!1)},_onDoubleClickLine:function(t,e){var n=e.grid,o=n.id;if(this._isTransitionApplicable(o)&&"wux-layouts-datagridview-icon wux-ui-genereatedicon-backgroundimage"==t.srcElement.className){var a=!this.model.getApplyTransition(o);this.model.setApplyTransition(o,a);var s=this.model.getCurrentTenantFromObject(this.model.objects[o]),r=i.get3DSpaceBaseUrl(s),l=this._getApplicablePromoteIcon(r,a);n.imageUrl=l,e.icons[0]=l,t.srcElement.setStyle("background-image","url("+l+")"),this._updateOKButton()}},_getApplicablePromoteIcon:function(t,e){return e?t+"/webapps/LifecycleWidget/assets/icons/16/I_ApplyPromote.png":t+"/webapps/LifecycleWidget/assets/icons/16/I_NotApplyPromote.png"},_createObjectForList:function(t){var e=this.model.getApplyTransition(t),n=this._isTransitionApplicable(t),o=UWA.createElement("img",{src:this.model.getAttribute(t,"imageUrl")}),a=this.model.getAttribute(t,"displayName");"string"!=typeof a?a=this.model.getAttribute(t,"name"):0==a.trim().length&&(a=this.model.getAttribute(t,"name"));var s=UWA.createElement("div",{text:a}),r=UWA.createElement("div",{class:"TitleDiv"});s.setStyles({display:"inline-block","padding-left":"6px"}),r.appendChild(o),r.appendChild(s);var l=null,c=this.model.getCurrentTenantFromObject(this.model.objects[t]),d=i.get3DSpaceBaseUrl(c);l=d+"/webapps/LifecycleWidget/assets/icons/16/I_NotAvailablePromote.png",n&&(l=this._getApplicablePromoteIcon(d,e));var h=this.model.getAttribute(t,"current_internal");return null!=h&&null!=h||(h=this.model.getAttribute(t,"current")),{physicalid:t,name:a,revision:this.model.getAttribute(t,"revision"),type:this.model.getAttribute(t,"typeDisplayName"),current:this.model.getAttribute(t,"currentStateUserName"),current_internal:h,locked:this.model.getAttribute(t,"locked"),lockedBy:this.model.getAttribute(t,"lockedBy"),imageUrl:l,policy:this.model.getAttribute(t,"policy")}},_isTransitionApplicable:function(t){for(var e=this.promotion[this.toState],i=0;i<e.length;i++){if(e[i].phid==t)return!0}return!1},_getUpdatedObjectsForState:function(t,e){var i,n=this,o=[],a=new Set,s=this.toState;return this.maturityWidget.initialSelection.forEach(function(t){a.add(t.physicalid)}),a.forEach(function(t){var e=n._createObjectForList(t);o.push(e)}),t[this.toState]&&t[this.toState].forEach(function(t){var e=t.phid,o=n.model.objects[e];if(o.hasOwnProperty("coretype")&&"Entity"==o.coretype){var a=this.model.maturityGraphs[o.policy];void 0!==a.states&&null!==a.states&&a.hasOwnProperty("states")&&(i=a.states);t.fromstate;for(var r in i){var l=i[r];if(null!=l&&l.hasOwnProperty("info")){var c=l.info;if(null!=c&&c.hasOwnProperty("stateUserName")&&c.hasOwnProperty("visuorder")&&c.stateSysName==t.fromstate){i[s].info.visuorder<c.visuorder?t.isDemote=!0:t.isDemote=!1;break}}}}},this),o},_createStateSelCombo:function(t,e,i){var o=this,a=new n({value:0,className:"small",placeholder:!1}),s=!0;i.forEach(function(t){var i={};!0===s&&(o.toState=t,i.value=t,i.selected="true"),s=!1,i.value=t,i.label=e[t].stateUserName,a.add(i)});a.addEvent("onChange",function(){var e=this.getSelection(!0);if(e.length>0){o.toState=e[0].value;var i=o._getUpdatedObjectsForState(t,o.toState);o._updateObjectListUI(t,i)}});var r=UWA.createElement("div",{class:"maturity-Combo-Container-div"});a.inject(r),this.commandSpan.appendChild(r)},_updateObjectListUI:function(t,e){e=this._getUpdatedObjectsForState(t,this.toState);null!==this.objectsList&&(this.objectsList.modelUpdate(e),this.maturityWidget.options.isWebInWin?this.setTitle(t[this.toState].length+" "+a.Objects):this.setTitle(a.maturity+" - "+t[this.toState].length+" "+a.Objects),this.objectListDiv.show(),this._updateOKButton())},_prepareAndSort:function(t,e,i,n){var o=JSON.parse(s),a=[];for(var r in t){var l=t[r].current,c=this.model.getPolicy(t[r].policy),d=JSON.parse(JSON.stringify(c.maturityGraph.transitions)),h=c.maturityGraph.states,u=t[r].current;if("Entity"==t[r].coretype)for(var p=d.length,m=0;m<p;m++)"Obsolete"!=d[m].sourceState&&"Obsolete"!=d[m].targetState&&d.push({targetState:d[m].sourceState,sourceState:d[m].targetState,signatures:d[m].signatures});var f=t[r].excludeFromPromote;d.forEach(function(t){if(t.sourceState===l){var s=t.targetState;h.forEach(function(t){t.stateSysName===s&&(i[s]={},i[s].stateUserName=t.stateUserName)});var c={phid:r,excludeFromPromote:f,fromstate:u};if(-1===n.indexOf(s)){var d=0;o.hasOwnProperty(s)&&(d=o[s].priority),a.push({name:s,priority:d}),n.push(s),e[s]=[c]}else-1===e[s].findIndex(function(t){return t.phid==c.phid})&&e[s].push(c)}}),a.sort(function(t,e){return t.name==e.name?0:t.priority>e.priority?1:t.priority<e.priority?-1:0}),n.length=0,a.forEach(function(t){n.push(t.name)})}}})}),define("DS/MaturityWidget/SampleFiltersAndActions",["UWA/Promise","DS/LifecycleServices/Utils"],function(t,e){"use strict";function i(){}return i.prototype={changeMaturityFilterSample2:function(t,e){return e.sampleStyle=2,i.prototype.changeMaturityFilterSample1(t,e)},changeMaturityFilterSample3:function(t,e){return e.sampleStyle=3,i.prototype.changeMaturityFilterSample1(t,e)},changeMaturityFilterSample1:function(i,n){return new t(function(t,o){var a=[],s=document.getElementById("sampleFilterId");s&&(s.parentNode.removeChild(s),s=void 0);var r="<div id='sampleFilterId' class='lcm-filter-transition'>";2===n.sampleStyle?r="<div id='sampleFilterId' class='lcm-filter-transition2'>":3===n.sampleStyle&&(r="<div id='sampleFilterId' class='lcm-filter-transition3'>");for(var l=e.htmlFromString(r+"<div class='lcm-filter-title'>Promotion Confirmation</div><div class='lcm-filter-msg'></div><div class='lcm-filter-buttons'><button class='lcm-filter-cancel-button lcm-transition-confirm-button-base'>Cancel</button><button class='lcm-filter-ok-button lcm-transition-confirm-button-base'>OK</button></div></div>"),c=(l.querySelector(".lcm-filter-transition"),l.querySelector(".lcm-filter-ok-button")),d=l.querySelector(".lcm-filter-cancel-button"),h=l.querySelector(".lcm-filter-msg"),u=0;u<i.length;u++)h.innerHTML+=i[u].name+" "+i[u].revision+"<br />";["mousedown","touchstart"].forEach(function(e){c.addEventListener(e,function(e){var n=document.getElementById("sampleFilterId");if(n){for(var o=0;o<i.length;o++)a[i[o].physicalid]="";n.style.display="none",t(a)}e.stopPropagation()}),d.addEventListener(e,function(e){var i=document.getElementById("sampleFilterId");i&&(i.style.display="none",t(a)),e.stopPropagation()})}),n.maturityGraphContainer.appendChild(l)})},changeMaturityActionSample1:function(t,e){if(e.maturityWidget){for(var i="",n=0;n<t.length;n++)i+=t[n].physicalid+" ";e.maturityWidget._showNotification("info","Promotion confirmation post actions successfuly fired for objects "+i)}}},new i}),define("DS/MaturityWidget/MaturityModel",["UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i){"use strict";return t.extend({isSingleIRPCAssembly:!1,isWebInWin:!1,init:function(){this.clear()},clear:function(){this.maturityGraphs={},this.objects={},this.policies={}},getAttribute:function(t,e){return void 0!==this.objects[t]?this.objects[t][e]:void 0},getAttributes:function(t){return this.objects[t]},setAttributes:function(t,e){this.objects[t]=e},setAttribute:function(t,e,i){void 0!==this.objects[t]&&(this.objects[t][e]=i)},setObjects:function(t){for(var e=0;e<t.length;e++)this.objects[t[e].physicalid]={},this.originalPid=t[e].physicalid,void 0!==t[e].serviceurl&&t[e].serviceurl&&(this.serviceurl=t[e].serviceurl)},setChangeAction:function(t){this.changeAction=t},getChangeActionId:function(){var t=null;return void 0!==this.changeAction&&null!==this.changeAction&&this.changeAction.hasOwnProperty("id")&&(t=this.changeAction.id),t},getApplyTransition:function(t){return this.getAttribute(t,"applyTransition")},setApplyTransition:function(t,e){this.setAttribute(t,"applyTransition",e)},getObjects:function(){return this.objects},changeCurrentObjectState:function(t,e){var i=this.objects[t];if(i)if(i.current=e,i.maturityGraph)i.maturityGraph.states&&i.maturityGraph.states.forEach(function(t){t.stateSysName===e?(t.isCurrent=!0,i.currentStateUserName=t.stateUserName):t.isCurrent=!1});else if(this.getMaturityGraph(i.policy)){var n=this.getMaturityGraph(i.policy).states[e];n&&(i.currentStateUserName=n.info.stateUserName)}},getStateUserNameFromStateSystemName:function(t,e){var i=null,n=this.objects[t];if(!n)return i;if(!n.maturityGraph&&this.getMaturityGraph(n.policy)){var o=this.getMaturityGraph(n.policy).states[e];o&&(i=o.info.stateUserName)}return i},setMaturityGraph:function(t){if(this.clear(),0==t.data.policies.length){console.log("ERROR: No policies in json");var n={};n.errorMsg=i.maturityGraphFailed,n.type="error",that.dispatchEvent("onError",n)}else{this.policies=t.data.policies,this.isConfirmationDialogEnabled=t.data.isConfirmationDialogEnabled;for(var o=!1,a=0;a<t.data.objects.length;a++){var s=t.data.objects[a].physicalid,r=t.data.objects[a];for(var l in this.objects[s]=r,this.objects[s].signatures={},this.objects[s].routes={},this.objects[s].applyTransition=!0,this.objects[s].interfaceHash=[],r.InterfaceList)this.objects[s].interfaceHash[l]=l;if(void 0!==this.objects[s].isSingleIRPCAssembly&&null!==this.objects[s].isSingleIRPCAssembly&&this.objects[s].hasOwnProperty("isSingleIRPCAssembly")&&(o=o||this.objects[s].isSingleIRPCAssembly),this.objects[s].hasOwnProperty("imageUrl")&&void 0!==this.objects[s].imageUrl&&null!==this.objects[s].imageUrl){var c=this.objects[s].imageUrl,d=this.getCurrentTenantFromObject(this.objects[s]);if(c.startsWith("/")){var h=e.get3DSpaceBaseUrl(d);this.objects[s].imageUrl=h+c}}this.objects[s].excludeFromPromote=null!=r.isAggregateRep&&r.isAggregateRep,this.objects[s].excludeFromPromote||null!=r.usage&&"3DPart"==r.usage&&null!=r.isOnceInstantiable&&r.isOnceInstantiable&&(this.objects[s].excludeFromPromote=!0);var u=0;for(u=0;u<this.policies.length&&this.policies[u].name!==r.policy;u++);var p=this.policies[u].maturityGraph.transitions,m=this.policies[u].maturityGraph.states;this.actionnames={};for(var f=0;f<m.length;f++)!0===m[f].isCurrent&&this.setAttribute(s,"current",m[f].stateSysName),this.actionnames[m[f].stateSysName]={},this.objects[s].signatures[m[f].stateSysName]={},this.objects[s].routes[m[f].stateSysName]={};for(var y=0;y<p.length;y++){var g=p[y].sourceState,v=p[y].targetState,S=p[y].signatures;this.objects[s].routes[g][v]=p[y].hasRoute;for(var b={},C=0;C<S.length;C++)b[S[C].name]=S[C],S[C].username.includes("emxFramework")?this.actionnames[g][v]=S[C].name:this.actionnames[g][v]=S[C].username;this.objects[s].signatures[g][v]=b}var I=r.policy;if(void 0===this.maturityGraphs[I]){var x={};for(C=0;C<m.length;C++){var _=m[C].stateSysName,A=m[C].activeColor,w=m[C].inactiveColor,T=m[C].tooltip,P={connectors_out:{},connectors_in:{},info:{},actionnames:{},activecolor:{},inactivecolor:{},tooltip:{}};for(y=0;y<p.length;y++){g=p[y].sourceState,v=p[y].targetState,S=p[y].signatures;g===_&&(P.connectors_out[v]={}),v===_&&(P.connectors_in[g]={})}P.info=m[C],P.actionnames=this.actionnames,P.activecolor=A,P.inactivecolor=w,P.tooltip=T,x[_]=P}var D=0;for(C=0;C<m.length;C++){void 0!==x[_=m[C].stateSysName]&&(x[_].info.visuorder=D,D++)}this.maturityGraphs[I]={},this.maturityGraphs[I].states=x,this.maturityGraphs[I].infos={};var E=this.objects[s].coretype,M=this.objects[s].isOnceInstantiable;this.maturityGraphs[I].infos.isPromoteAuthorized=!1,this.maturityGraphs[I].infos.isDemoteAuthorized=!1,"Entity"===E&&(this.maturityGraphs[I].infos.isDemoteAuthorized=!0),("Entity"===E||"Reference"===E&&!M||"Reference"===E&&void 0!==r.usage&&null!==r.usage&&("DraftingRepresentation"===r.usage||"Kinematics"===r.usage))&&(this.maturityGraphs[I].infos.isPromoteAuthorized=!0)}else if(!this.maturityGraphs[I].infos.isPromoteAuthorized){E=this.objects[s].coretype,M=this.objects[s].isOnceInstantiable;("Entity"===E||"Reference"===E&&!M)&&(this.maturityGraphs[I].infos.isPromoteAuthorized=!0)}}this.isSingleIRPCAssembly=o}},getMaturityGraph:function(t){return this.maturityGraphs[t]},getCurrentTenantFromObject:function(t){var i=window.widget.getValue("x3dPlatformId");return(null==i||i.trim().length<1)&&(i=e.getTenant()),t&&t.hasOwnProperty("tenant")?t.tenant:i},getPolicy:function(t){for(var e=0;e<this.policies.length;e++)if(this.policies[e].name===t)return this.policies[e]},getAllStates:function(){var t=[];for(var e in this.maturityGraphs)if(this.maturityGraphs.hasOwnProperty(e)){var i=this.getMaturityGraph(e);for(var n in i.states)i.states.hasOwnProperty(n)&&t.push(n)}return t}})}),define("DS/MaturityWidget/MaturityGraph",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary","DS/LifecycleControls/AdaptiveLayout","DS/LifecycleServices/Utils","DS/LifecycleServices/LifecyclePerfTimer","DS/UIKIT/Mask","DS/UIKIT/Tooltip","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i,n,o,a,s,r){"use strict";return t.extend({pendingUpdate:!1,create:function(t,e){this.pendingTransition=!1,this.MainContainer=t,this._injectHTML(t,e),this._setupAdaptiveUI(t)},destroy:function(){null!=this&&(void 0!==this.adaptiveLayout&&null!==this.adaptiveLayout&&(this.adaptiveLayout.stop(),this.adaptiveLayout=null),void 0!==this.SVG_container&&null!==this.SVG_container&&(this.SVG_container.destroy(),this.SVG_container=null),void 0!==this.state_container&&null!==this.state_container&&(this.state_container.destroy(),this.state_container=null),this.paths=[],this.stateToElement=null)},updateGraph:function(t){this._updateStateElements(t),this.pendingUpdate||(this.pendingUpdate=!0,this._deleteConnectors(),this._createConnectors(t),this.paths.forEach(function(t){""!=t.path.id&&t.path.classList.add("fade-in")}),this.adaptiveLayout.restart(["active-path","inactive-path"]),this._drawConnectors(),this.pendingUpdate=!1)},onStartTransition:function(t){this.svgDoc1=document.getElementsByClassName("textclass"),a.unmask(this.MainContainer.getParent());for(var e=0;e<this.svgDoc1.length;e++){this.svgDoc1[e].style.pointerEvents="none"}this.pendingTransition=!0,this._enableStateElements(!1);var i=this.stateToElement.find(t);i&&(this.changeToMasked=i.element,this.changeToMasked.addClassName("lcm-state-pulse"),a.mask(this.changeToMasked,"")),this._animatePath(t,!1)},onEndTransition:function(t){this.pendingTransition=!1,this.changeToMasked&&(this.changeToMasked.removeClassName("lcm-state-pulse"),a.unmask(this.changeToMasked),this.changeToMasked=null),this._animatePath(t,!0),this._enableStateElements(!0);for(var e=0;e<this.svgDoc1.length;e++){this.svgDoc1[e].style.pointerEvents="auto"}},_onStyleChanged:function(t,e){this.currentConnectorMargins=this.connectorMargins.find(t),this._drawConnectors(),this.changeToMasked&&(a.unmask(this.changeToMasked),a.mask(this.changeToMasked,"")),this._enableStateTooltips(!0)},_setupAdaptiveConnectorMargins:function(){this.connectorMargins=new e,this.connectorMargins.add("lcm-state",{height:16,padding:18,connectorSize:20}),this.connectorMargins.add("lcm-state-m",{height:14,padding:3,connectorSize:10}),this.connectorMargins.add("lcm-state-s",{height:8,padding:0,connectorSize:4}),this.connectorMargins.add("lcm-state-hidden",{height:0,padding:0,connectorSize:0})},_setupAdaptiveUI:function(t){this._setupAdaptiveConnectorMargins(),this.parentContainer=t;var e=this._calcWidth(this.state_container,"lcm-state","lcm-state-connector",this.numStates),n=(this._calcWidth(this.state_container,"lcm-state-m","lcm-state-connector-m",this.numStates),this._calcWidth(this.state_container,"lcm-state-s","lcm-state-connector-s",this.numStates)),o=this._calcHeight(this.state_container,"lcm-state"),a=(this._calcHeight(this.state_container,"lcm-state-m"),this._calcHeight(this.state_container,"lcm-state-s"));o+=2*this.connectorMargins.find("lcm-state").height,this.connectorMargins.find("lcm-state-m").height;a+=2*this.connectorMargins.find("lcm-state-s").height;var s="max-width:"+e+";max-height:"+o;var r=e+10+"px";t.setStyles({height:"122px",width:r});var l=document.getElementsByClassName("lcm-maturity-content")[0].getParent(),c=document.getElementsByClassName("lcm-state-current");-1==navigator.userAgent.indexOf("Firefox")&&-1==navigator.userAgent.indexOf("MSIE")&&-1==navigator.userAgent.indexOf("rv:")&&null!=l&&"lifecycle-content maturity"!=l.className&&c[0].scrollIntoViewIfNeeded({behavior:"smooth",block:"nearest",inline:"start"});var d=this;this.adaptiveLayout=new i("lcm-state",t).onSizeChanged(function(t,e){t||d._drawConnectors(),d.confirmationUI.isVisible&&d.confirmationUI.position()}).onStyleChanged(function(t,e){d._onStyleChanged(t,e)}).start()},_injectHTML:function(t,e){this._createContainers(t),this._createStateElements(e),this._createTransitionConfirmationUI(t),this._createSVGCanvas(),this._createSVGEndArrows(),this._createConnectors(e)},_calcWidth:function(t,e,i,n){var o=function(t,e){var i=document.createElement("div");i.className=e,t.appendChild(i);var n=window.getComputedStyle(i),o=parseInt(n.marginLeft,10)+parseInt(n.marginRight,10)+i.getBoundingClientRect().width;return t.removeChild(i),o};return o(t,e)*n+o(t,i)*(n-1)+8*n},_calcHeight:function(t,e){var i=document.createElement("div");i.className=e,t.appendChild(i);var n=window.getComputedStyle(i),o=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)+i.getBoundingClientRect().height;t.removeChild(i);var a=this.connectorMargins.find(e);return a&&a.height&&(o+=a.height),o},_createContainers:function(t){for(var e=document.getElementsByClassName("lcm-svg-container");e.length>0;)e[0].remove();for(var i=document.getElementsByClassName("lcm-state-container");i.length>0;)i[0].remove();this.SVG_container=UWA.createElement("div",{class:"lcm-svg-container"}),this.state_container=UWA.createElement("div",{class:"lcm-state-container"}),this.SVG_container.inject(t),this.state_container.inject(t)},_getStateClass:function(t,e){if(t.info.isCurrent)return"lcm-state-current";if(t.isDisabled)return"lcm-state-unreachable";if(t.isDemote)return"lcm-state-transitionable";for(var i in t.connectors_in)if(i===e)return"lcm-state-transitionable";return"lcm-state-unreachable"},_getCurrentState:function(t){for(var e in t)if(t[e].info.isCurrent)return e;return""},_animatePath:function(t,e){if(!this._isIE11()){var i='path[*|to="'+t+'"]',n=this.SVGCanvas.querySelector(i);if(n){var o=UWA.extendElement(n);if(e)o.removeAttribute("style","stroke-width"),o.removeClassName("animate-path");else{if(o.hasClassName("animate-path"))return;var a=getComputedStyle(o).strokeWidth,s=parseFloat(a)+1;o.setAttribute("style","stroke-width:"+s+"px"),o.removeClassName("fade-in"),o.addClassName("animate-path")}this._patchIEPathBug(o)}}},_getTransitionConfirmText:function(t,e){return e[t].isDemote?r.demoteTo+e[t].info.stateUserName+"?":e[t].isPromote?r.promoteTo+e[t].info.stateUserName+"?":r.changeMaturityTo+e[t].info.stateUserName+"?"},_setStateColor:function(t){this.stateColor={},this.transitionColor="","Draft"===t||"Prepare"===t||"PRIVATE"===t||"Prepare"===t||"Create"===t?(this.stateColor=" private",this.transitionColor="#9B2C98"):"In Work"===t||"IN_WORK"===t||"In Work"===t||"Assign"===t?(this.stateColor=" inwork",this.transitionColor="#007DA3"):"In Approval"===t||"FROZEN"===t||"In Approval"===t||"Active"===t?(this.stateColor=" frozen",this.transitionColor="#018308"):"Completed"===t||"RELEASED"===t||"Complete"===t||"Closed"===t||"OBSOLETE"===t?(this.stateColor=" released",this.transitionColor="#757575"):"Approved"===t||"Review"===t?(this.stateColor=" approved",this.transitionColor="#E03400"):this.stateColor=""},_createStateElements:function(t){this.stateToElement=new e;var i=this._getCurrentState(t),n=!0,o=0;for(var a in t){var r=this._getStateClass(t[a],i);this._setStateColor(a);var l="",c=UWA.createElement("span",{class:"lcm-state-text",html:t[a].info.stateUserName});if("lcm-state-current"===r||n?(t[a].activecolor.includes("emxFramework")?l="#757575":"#FFFFFF"===(l=t[a].activecolor)&&(c.style.color="black"),"lcm-state-current"===r&&(n=!1)):t[a].inactivecolor.includes("emxFramework")?l="#BABABA":"#FFFFFF"===(l=t[a].inactivecolor)&&(c.style.color="gray"),0!==o)UWA.createElement("div",{class:"lcm-state-connector"}).inject(this.state_container);var d=UWA.createElement("div",{class:"lcm-state-base lcm-state "+r+" lcm-"+this.stateColor.trim(),styles:{backgroundColor:l}});"#FFFFFF"===l&&(d.style.border="lcm-state-current"===r?"2px solid black":"1px solid #B4B6BA"),c.inject(d),d.inject(this.state_container);this._getTransitionConfirmText(a,t);var h="";h=t[a].tooltip.includes("emxFramework")?t[a].info.stateUserName:t[a].tooltip;var u=new s({target:d,body:h,position:"bottom"});u.elements.container.style.display="none",u.elements.container.style.zIndex=99999,this.stateToElement.add(a,{element:d,tooltip:u,order:o++,numConnectors:{right:0,left:0,top:0,bottom:0}})}this.numStates=o},_updateStateElements:function(t){var e=this,i=this._getCurrentState(t),n=!0;this._forEachStateElement(function(o,a){o.removeClassName("lcm-state-unreachable"),o.removeClassName("lcm-state-transitionable"),o.removeClassName("lcm-state-current");var s=e._getStateClass(t[a],i);o.addClassName(s);var r="";"lcm-state-current"===s||n?(t[a].activecolor.includes("emxFramework")?r="#757575":"#FFFFFF"===(r=t[a].activecolor)&&(void 0!==o.children[0]&&(o.children[0].style.color="black"),o.style.border="2px solid black"),"lcm-state-current"===s&&(n=!1)):r=t[a].inactivecolor.includes("emxFramework")?"#BABABA":t[a].inactivecolor,o.confirmText=e._getTransitionConfirmText(a,t),o.action=t[a].action,o.setStyle("backgroundColor",r)})},_enableStateTooltips:function(t){var e=this;this._forEachStateElement(function(i,n){var o=e.stateToElement.find(n);o&&(o.tooltip.elements.container.style.display=t?"":"none")})},_enableStateElements:function(t){this._forEachStateElement(function(e){e.disabled=!t,e.setAttribute("data-disabled",(!t).toString()),t?e.hasClassName("lcm-state-disabled")&&e.removeClassName("lcm-state-disabled"):e.hasClassName("lcm-state-transitionable")&&e.addClassName("lcm-state-disabled")})},_forEachStateElement:function(t){var e=this;void 0!==this.stateToElement&&null!==this.stateToElement&&this.stateToElement.each(function(i){var n=e.stateToElement.find(i).element;t(n,i)})},_createTransitionConfirmationUI:function(t){var e=this,i=function(){},n=this._injectTransitionConfirmationUI(t,function(){i()},function(){e.confirmationUI.isVisible=!1}),o=n.querySelector(".lcm-transition-confirm-button"),a=n.querySelector(".lcm-confirm-msg");this.confirmationUI={isVisible:!1,show:function(t,e,s){i=s,n.style.display="inline-block",o.focus(),a.innerText=e,this.currentEl=t,this.position(),this.isVisible=!0},hide:function(){this.currentEl=null,n.style.display="inline-block",this.isVisible=!1},position:function(){this.currentEl&&(n.style.left=this.currentEl.offsetLeft-0+"px",n.style.top=this.currentEl.offsetTop-1+"px")}}},_injectTransitionConfirmationUI:function(t,e,i){var o=n.htmlFromString("<div class='lcm-confirm-transition'><div class='lcm-confirm-msg'></div><button class='lcm-transition-confirm-button lcm-transition-confirm-button-base'>"+r.maturityConfirmTransition+"</button></div>"),a=o.querySelector(".lcm-confirm-transition"),s=o.querySelector(".lcm-transition-confirm-button");return["mousedown","touchstart"].forEach(function(t){s.addEventListener(t,function(t){"inline-block"===a.style.display&&(t.stopPropagation(),a.style.display="none",e())})}),s.addEventListener("blur",function(){a.style.display="none","function"==typeof i&&i()}),t.appendChild(o),a},_deleteConnectors:function(){var t=this;this.paths.forEach(function(e){var i=e.path.parentNode;i&&(""!=e.path.id&&i.removeChild(t.text[e.path.id]),i.removeChild(e.path))}),this.paths=[];t=this;this.stateToElement.each(function(e){t.stateToElement.find(e).numConnectors={right:0,left:0,top:0,bottom:0}})},_createSVGEndArrows:function(){this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-active")),this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-inactive"))},_createConnectors:function(t){var e=this;this.Mask=a,this.paths=[],this.text={},this.tspan1={};var i,n=this,s=function(t,e){t.addEventListener("mouseover",function(){"true"!==t.getAttribute("data-disabled")&&n._animatePath(e,!1)}),t.addEventListener("mouseout",function(){n.pendingTransition||n._animatePath(e,!0)})},l=function(t,i,n,s){t.confirmText=i,t.action=n,t.filter=s;var r=function(){},l=function(){};r=n,l=s,t.addEventListener("click",function(){"true"!==t.getAttribute("data-disabled")&&(a.mask(e.MainContainer.getParent()),l().then(function(t){var i=!1;for(var n in t){i=!0;break}i?(e._perfTimer=o,e._perfTimer.start("CommandExecutionDurationMaturity"),r(t)):a.unmask(e.MainContainer.getParent())}))})};for(var c in t){var d=t[c],h={},u=0,p=0,m=0,f={};for(var y in d.connectors_out){var g;h[(g=t[y]).info.visuorder]={},h[g.info.visuorder]=y,g.info.visuorder<d.info.visuorder?(f[g.info.visuorder]="bottom",u++):g.info.visuorder>d.info.visuorder+1&&(f[g.info.visuorder]="top",p++)}if(d.info.isCurrent&&void 0!==i)d.connectors_out[i]={},console.log(d.connectors_out),h[(g=t[i]).info.visuorder]={},h[g.info.visuorder]=i,g.info.visuorder<d.info.visuorder?(f[g.info.visuorder]="bottom",u++):g.info.visuorder>d.info.visuorder+1&&(f[g.info.visuorder]="top",p++);for(var v in this.totTop=p,this.totBot=u,h){y=h[v];var S=this._createSVGEl("path");this.SVGCanvas.appendChild(S);var b=this._createSVGEl("tspan");if(d.info.isCurrent){n._setStateColor(y),t[y].activecolor.includes("emxFramework")?this.transitionColor="#757575":this.transitionColor=t[y].activecolor,S.setAttribute("marker-end","url(#arrow-active)"),S.setAttribute("class","active-path"),S.setAttribute("id",y),S.setAttributeNS("state","to",d.isDemote?c:y);var C=this._createSVGEl("text"),I=this._createSVGEl("tspan");b.setAttribute("font-weight","bold"),"#FFFFFF"===this.transitionColor?(b.setAttribute("stroke","gray"),b.setAttribute("stroke-opacity","50%"),b.setAttribute("stroke-width","0.5%"),b.setAttribute("fill","none")):(b.setAttribute("stroke",this.transitionColor),b.setAttribute("stroke-width","0.5%"),b.setAttribute("fill","none")),d.info.visuorder>t[y].info.visuorder?(C.appendChild(I),C.appendChild(b)):(C.appendChild(b),C.appendChild(I)),"function"==typeof t[y].action&&(void 0!==d.actionnames[c][y]?I.textContent=d.actionnames[c][y]+" ":I.textContent=r.setTo+" "+t[y].info.stateUserName+" "),this.SVGCanvas.appendChild(C),this.text[y]=C,this.tspan1[y]=b;var x=this._getTransitionConfirmText(c,t);s(C,y),"function"==typeof t[y].action&&"function"==typeof t[y].action&&"function"==typeof t[y].filter&&l(C,x,t[y].action,t[y].filter)}else d.isDemote?(n._setStateColor(c),i=c,S.setAttribute("marker-end","url(#arrow-inactive)"),S.setAttribute("class","inactive-path")):this.stateToElement.find(y).order===this.stateToElement.find(c).order+1?(S.setAttribute("marker-end","url(#arrow-inactive)"),S.setAttribute("class","inactive-path")):(S.setAttribute("marker-end","url(#arrow-hidden)"),S.setAttribute("class","hidden-path"));var _,A,w=d.connectors_in.hasOwnProperty(y),T=this.stateToElement.find(y).order-this.stateToElement.find(c).order;if(1===T?(_="right",A="left"):-1===T?w?(_="bottom",A="bottom"):(_="left",A="right"):T>1?(_="top",A="top"):T<-1&&(_="bottom",A="bottom"),"function"==typeof t[y].action&&(d.info.visuorder>t[y].info.visuorder?b.textContent="« ":d.isDemote?b.textContent="« ":b.textContent="» "),"top"===A){var P=p,D=++this.stateToElement.find(y).numConnectors[A];p--,m++}else if("bottom"===A){P=u,D=++this.stateToElement.find(y).numConnectors[A];this.space=u,u--}else P=++this.stateToElement.find(c).numConnectors[_],D=++this.stateToElement.find(y).numConnectors[A];this.paths.push({path:S,from:c,fromConnectOrder:P,to:y,toConnectOrder:D,opts:{connectFrom:_,connectTo:A,numConn:P,topHeight:m,totTop:this.totTop,totBot:this.totBot}})}}},_drawConnectors:function(){if(this.currentConnectorMargins){var t={ptsTop:[],ptsBottom:[],height:this.currentConnectorMargins.height,padding:this.currentConnectorMargins.padding,calcHeight:function(t,e,i){var n=0,o=this.normalizePt(t);return"top"===e?(n=this.numIntersects(o,this.ptsTop),this.ptsTop.push(o)):"bottom"===e&&(n=this.numIntersects(o,this.ptsBottom),this.ptsBottom.push(o)),this.height+this.padding*n+i*i*i*n},numIntersects:function(t,e){var i=0,n=function(t,e){return t<e.p2&&t>e.p1};return e.forEach(function(e){n(t.p1,e)?i=1:n(t.p2,e)?i=1:n(e.p1,t)?i=1:n(e.p2,t)&&(i=1)}),i},normalizePt:function(t){return{p1:Math.min(t.p1,t.p2),p2:Math.max(t.p1,t.p2)}}};this.paths.forEach(function(e){var i=this.stateToElement.find(e.from),n=i.element,o=this.stateToElement.find(e.to),a=o.element,s={fromConnectorOrder:e.fromConnectOrder,toConnectorOrder:e.toConnectOrder,numConnectorsFrom:i.numConnectors[e.opts.connectFrom],numConnectorsTo:o.numConnectors[e.opts.connectTo],connectorSize:this.currentConnectorMargins.connectorSize,heightCalc:t},r={};UWA.extend(r,e.opts),UWA.extend(r,s),(""!=e.path.id||"bottom"!=r.connectTo&&"top"!=r.connectTo)&&this._drawLine(e.path,n,a,r)},this);for(var e=document.getElementsByClassName("active-path"),i=0,n=0;n<e.length;n++){var o=e[n].getBoundingClientRect().height;o>i&&(i=o)}var a=2*i+80+5+"px";this.parentContainer.setStyles({height:a})}},_drawLine:function(t,e,i,n){var o=function(t,e,i){var n=function(t,e,i){return 1===i.numConnectors?t+e/2:t+(e-i.numConnectors*i.size)/2+i.size/2+i.size*(i.connectOrder-1)},o={x:0,y:0},a=t.getBoundingClientRect(),s=a.right-a.left,r=a.bottom-a.top,l=t.offsetLeft,c=t.offsetTop;return"right"===e?(o.x=l+s,o.y=n(c,r,i)):"top"===e?(i.p2?o.x=l+s/2:o.x=l+s/(i.totTop+1)*i.numConn-i.numConn,o.y=c):"bottom"===e?(i.p2?o.x=l+s/2:o.x=l+s/(i.totBot+1)*i.numConn-i.numConn,o.y=c+r):"left"===e&&(o.x=l,o.y=n(c,r,i)),o},a=function(t,e){return t+" "+e.x+" "+e.y+" "},s=o(e,n.connectFrom,{connectOrder:n.fromConnectorOrder,numConnectors:n.numConnectorsFrom,size:n.connectorSize,totTop:n.totTop,totBot:n.totBot,numConn:n.numConn,p2:!1}),r=a("M",s),l=o(i,n.connectTo,{connectOrder:n.toConnectorOrder,numConnectors:n.numConnectorsTo,size:n.connectorSize,totTop:n.totTop,totBot:n.totBot,numConn:n.numConn,p2:!0}),c=a("L",l),d="";if("bottom"===n.connectTo||"top"===n.connectTo){var h=this.currentConnectorMargins.height*n.topHeight+5*n.topHeight;"bottom"===n.connectTo&&(h=this.currentConnectorMargins.height*n.numConn+5*n.numConn);var u={};u.x=s.x,u.y=s.y+("top"===n.connectTo?-h:h);var p=a("L",u),m={};m.x=l.x,m.y=l.y+("top"===n.connectTo?-h:h);var f=a("L",m);if(""!=t.id){if(this.text[t.id].setAttribute("class","textclass"),this.text[t.id].setAttribute("font-family","Arial"),e.hasClassName("lcm-state")?(this.text[t.id].setAttribute("font-size","12"),this.tspan1[t.id].setAttribute("font-size","22")):e.hasClassName("lcm-state-m")?(this.text[t.id].setAttribute("font-size","9"),this.tspan1[t.id].setAttribute("font-size","16")):(this.text[t.id].setAttribute("font-size","6"),this.tspan1[t.id].setAttribute("font-size","14")),this.text[t.id].setAttribute("fill","#368ec4"),"top"===n.connectTo){var y=u.x>m.x?m.x:u.x;this.text[t.id].setAttribute("text-anchor","start")}else{y=u.x>m.x?u.x:m.x;this.text[t.id].setAttribute("text-anchor","end")}this.text[t.id].setAttribute("x",y),this.text[t.id].setAttribute("y",m.y+("top"===n.connectTo?-5:15))}d=r+p+f+c}else{var g={x:0,y:0},v="";if(s.y!==l.y&&s.x!==l.x&&(g.x=s.x,g.y=l.y),0!==g.x&&(v=a("L",g)),""!=t.id){h=n.heightCalc.calcHeight({p1:s.x,p2:l.x},n.connectTo);this.text[t.id].setAttribute("class","textclass fade-in"),this.text[t.id].setAttribute("font-family","Arial"),e.hasClassName("lcm-state")?(this.text[t.id].setAttribute("font-size","12"),this.tspan1[t.id].setAttribute("font-size","22")):e.hasClassName("lcm-state-m")?(this.text[t.id].setAttribute("font-size","9"),this.tspan1[t.id].setAttribute("font-size","16")):(this.text[t.id].setAttribute("font-size","6"),this.tspan1[t.id].setAttribute("font-size","14")),this.text[t.id].setAttribute("fill","#368ec4");y=l.x;this.text[t.id].setAttribute("text-anchor","start"),this.text[t.id].setAttribute("x",y),this.text[t.id].setAttribute("y",l.y+40)}d=r+v+c}t.setAttribute("d",d),this._patchIEPathBug(t)},_isIE11:function(){return this._browserCheck=this._browserCheck||{isIE11:/Trident\/7\./.test(navigator.userAgent)},this._browserCheck.isIE11},_patchIEPathBug:function(t){if(this._isIE11()){var e=t.parentNode;e.removeChild(t),e.appendChild(t)}},_createSVGEl:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},_createSVGEndArrow:function(t){var e=this._createSVGEl("marker"),i=this._createSVGEl("defs"),n=this._createSVGEl("path");return e.appendChild(n),i.appendChild(e),e.setAttribute("id",t),e.setAttribute("markerWidth","10"),e.setAttribute("markerHeight","8"),e.setAttribute("refX","9"),e.setAttribute("refY","4"),e.setAttribute("orient","auto"),n.setAttribute("d","M 3 1 L 10 4 L 3 7"),n.setAttribute("class",t),i},_createSVGCanvas:function(){var t=this._createSVGEl("svg");t.setAttribute("id","svgCanvas"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("xmlns:state","http://www.lc.com/state"),UWA.extendElement(t).inject(this.SVG_container),this.SVGCanvas=t}})}),define("DS/MaturityWidget/MaturityTransitionFilters",["UWA/Promise"],function(t){"use strict";function e(){var t=[],e=[],i=[];e=[];t.VPMReference=[],t.Drawing=[],t.SoftwareLogicalItem=[],t.SemiconductorLogicalItem=[],t.MaturityAllTypes=[],e.VPMReference=[],e.Drawing=[],e.SoftwareLogicalItem=[],e.SemiconductorLogicalItem=[],e.MaturityAllTypes=[],require(["DS/MaturityWidget/MaturityConfirmationDialogFilter"],function(e){i["MaturityConfirmation.showConfirmationDialog"]=e.showConfirmationDialog,t.MaturityAllTypes.push("MaturityConfirmation.showConfirmationDialog")},function(){});var n="DS/ENOXSoftwareExt/Lifecycle/MaturityFilters";require([n],function(e){i["ENOSoftExt.PromoteDynamicSelector"]=e.PromoteDynamicSelector,t.SoftwareLogicalItem.push("ENOSoftExt.PromoteDynamicSelector"),t.VPMReference.push("ENOSoftExt.PromoteDynamicSelector")},function(){});n="DS/ENOXSemiExt/Lifecycle/MaturityFilters";require([n],function(e){i["ENOSemiExt.PromoteDynamicSelector"]=e.PromoteDynamicSelector,t.SemiconductorLogicalItem.push("ENOSemiExt.PromoteDynamicSelector")},function(){}),this.typeFilterKeys=t,this.typeActionKeys=e,this.filterMap=i,this.actionMap=[],this.interfaceMap=[]}return e.prototype={fetchTypeFilterKeys:function(t,e){var i=[];if("MaturityAllTypes"in this.typeFilterKeys)for(var n=this.typeFilterKeys.MaturityAllTypes,o=0;o<n.length;o++)if(n[o]in this.interfaceMap){var a=this.interfaceMap[n[o]];for(var s in e)if(s in a){i.push(n[o]);break}}else i.push(n[o]);if(t in this.typeFilterKeys)for(n=this.typeFilterKeys[t],o=0;o<n.length;o++)if(n[o]in this.interfaceMap){a=this.interfaceMap[n[o]];for(var s in e)if(s in a){i.push(n[o]);break}}else i.push(n[o]);return i.length>0?i:["default"]},fetchTypeFilter:function(e){return e in this.filterMap?this.filterMap[e]:function(e,i){return new t(function(t,i){for(var n=[],o=0;o<e.length;o++)n[e[o].physicalid]="";t(n)})}},fetchTypeActionKeys:function(t,e){if(t in this.typeActionKeys){for(var i=this.typeActionKeys[t],n=[],o=0;o<i.length;o++)if(i[o]in this.interfaceMap){var a=this.interfaceMap[i[o]];for(var s in e)if(s in a){n.push(i[o]);break}}else n.push(i[o]);if(n.length>0)return n}return["default"]},fetchActionFilter:function(t){return t in this.actionMap?this.actionMap[t]:null}},new e}),define("DS/MaturityWidget/MaturityController",["UWA/Controls/Abstract","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecyclePerfTimer","DS/WAFData/WAFData","DS/LifecycleServices/AssemblyJson","DS/LifecycleCmd/AssemblySelectionUtil","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","i18n!DS/LifecycleServices/assets/nls/LifecycleServicesNls","DS/ReportingPanel/ReportingPanel"],function(t,e,i,n,o,a,s,r,l,c,d,h,u,p){"use strict";var m=null;function f(){return null==m&&(m=i.getUser()),m}return t.extend({tenant:null,init:function(t){this._context=t;this.model=new n,this.policy="VPLM_SMB_Definition",this.tenant=null,this._perfTimer=s,this.selectedItems={},this.isPromoteDeomoteBothServiceUsed=!1,this.dataForReportingPanel=[],this.counterforPromoteDemote=0,this.initialSelections={},this.includeStructureFlag=!1,this.statusNls=h.get("MATURITY_Status"),this.titleNls=h.get("MATURITY_Title"),this.typeNls=h.get("MATURITY_Sum_Type"),this.revisionNls=h.get("MATURITY_Revision"),this.maturityNls=u.maturitystate,this.maturityLockNls=h.Lock,this.orgNls=h.get("MATURITY_Sum_Org"),this.collabNls=h.get("MATURITY_Sum_Collab"),this.completionNls=h.get("MATURITY_Result"),this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:this.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:this.titleNls,dataIndex:this.titleNls},{text:this.typeNls,dataIndex:this.typeNls},{text:this.revisionNls,dataIndex:this.revisionNls},{text:this.maturityNls,dataIndex:"Current"},{text:this.maturityLockNls,dataIndex:"Reserved",typeRepresentation:"icon",width:50,resizableFlag:!1},{text:this.orgNls,dataIndex:this.orgNls},{text:this.collabNls,dataIndex:this.collabNls},{text:this.completionNls,dataIndex:this.completionNls},{text:h.deleteObjects,dataIndex:"Selected",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSelected,default:"on",tooltip:h.deleteSelectedToolTip},{value:h.deleteAdded,default:"off",tooltip:h.deleteAddedToolTip}]},{text:h.deleteResults,dataIndex:"Results",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSuccessfulShort,default:"on",tooltip:h.deleteSuccessfulShort},{value:h.deleteFailedShort,default:"on",tooltip:h.deleteFailedShort}]}]},initGraph:function(t,e){var i=this;i.initialSelections=t,o.getSecurityContextPromise(this.tenant,this._context).then(function(n){null==n&&i.dispatchEvent("onError",{errorMsg:h.ErrorSecurityContextEmpty}),i.securityContext=n,i._getMaturityGraph(t,null,e,n,!0)})},promote:function(t){var e=this;o.getSecurityContextPromise(this.tenant,this._context).then(function(i){e._changeMaturity("promote",t,i)})},demote:function(t){var e=this;o.getSecurityContextPromise(this.tenant,this._context).then(function(i){e._changeMaturity("demote",t,i)})},expandStructure:function(t,e,i,n){var a=this;o.getSecurityContextPromise(this.tenant,this._context).then(function(o){a._getExpandedAssembly(o,t,e,i,n)})},getLockIcon:function(t,e){var i,n,o=void 0,a=t;e=e;if("TRUE"==a?a=!0:"FALSE"!=a&&""!==a||(a=!1),void 0===a)o="";else if(!0===a){var s=(i=f(),n="",void 0!==i&&(n=i.login),n),r=function(){var t=f(),e="";return void 0!==t&&(e=t.firstName+" "+t.lastName),e}(),l=!0;e.trim().length>0&&((l=e.toUpperCase().trim()===s.toUpperCase().trim()||!1)||(l=e.toUpperCase().trim()===r.toUpperCase().trim()||!1)),o=l?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-key lc_dgv_lock":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock lc_dgv_lock_other"}else!1===a&&(o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open lc_dgv_unlock");return o},_getExpandedAssembly:function(t,e,i,n,o){var s={intent:"explore_2D",debug:!0,roots:[{id:e}],level:"-1",source:"cstorage",authored:i},c=a.get3DSpaceWSUrl(this.tenant,"/resources/enopad/lwc/expand",null),d=this;r.authenticatedRequest(c,{method:"POST",headers:a.getHeaders(encodeURIComponent(t)),timeout:36e5,data:JSON.stringify(s),type:"json",onComplete:function(a){a.results&&0==a.results.length&&!i&&(console.log("expandStructure: No data in results, retrying with authored (non-index)"),d._getExpandedAssembly(t,e,!0,n,o));var s=l.convertFromExpandFormat(a),r=d._parseAssembly(s,t);d._getMaturityGraph({data:r},n,o,t,!1)},onFailure:function(a){if(console.error("expandStructure: onFailure -> "+a),i)throw LifecycleWidgetNls.timeout;console.log("expandStructure: Failure with index request, retrying with authored (non-index)"),d._getExpandedAssembly(t,e,!0,n,o),"function"==typeof o&&o()},onTimeout:function(){var t={};t.errorMsg=h.connectionTimeout,t.type="warning",d.dispatchEvent("onError",t)}})},_parseAssembly:function(t,e){var i=null;if(null!=t&&t.hasOwnProperty("nodes")){var n=t.nodes;i=(new c).getSelection(e,n)}return i},_getMaturityGraph:function(t,e,i,n,s){var l,c=this;this.selectionSize="",null!=t&&t.hasOwnProperty("data")&&t.data instanceof Array&&(this.selectionSize=t.data.length);var d=a.getHeaders(encodeURIComponent(n));if(d["X-Requested-With"]="XMLHttpRequest",void 0!==this.model.serviceurl&&this.model.serviceurl){var p=this.model.serviceurl+"getStateGraph";l=p+(p.indexOf("?")<0?"?":"&")+"tenant="+c.tenant,void 0!==this.multiservicSecurityContext&&this.multiservicSecurityContext&&(d.SecurityContext=this.multiservicSecurityContext)}else l=a.get3DSpaceWSUrl(c.tenant,"/resources/lifecycle/maturity/getStateGraph",null);var m=function(t){"function"==typeof i&&i(t)};c._perfTimer.start("Maturity: getStateGraph"),r.authenticatedRequest(l,{method:"POST",type:"json",headers:d,timeout:36e5,data:JSON.stringify(t),onComplete:function(t){c._perfTimer.stop("Maturity: getStateGraph"),console.log("MaturityInfos: COMPLETED"),console.log(t);var i,n=t.status,o=n.code;n.hasOwnProperty("errorMsg")?null!==n.errorMsg?(m(n.errorMsg),c._perfTimer.stop("CommandUIDurationMaturity")):0===o&&(c.selectedItems.data=t.data.objects,c.model.setMaturityGraph(t),s?c.dispatchEvent("onGraphInfoChanged"):(i=t,"function"==typeof e&&e(i),c._perfTimer.stop("CommandUIDurationMaturity"))):(c.model.clear(),m(h.maturityGraphFailed),c._perfTimer.stop("CommandUIDurationMaturity"))},onFailure:function(t,e){c._perfTimer.stop("Maturity: getStateGraph"),console.log("attributes:Failure..."+t);var i=t;if(t instanceof Error&&(i=t.message),i.endsWith('return ResponseCode with value "504".')){var n=u.replace(u.getStateGraphSelection,{numberOfSelectedItems:c.selectionSize})+"."+u.getStateGraphSelectionTimeout,a={};a.errorMsg=n,a.type="warning",a.sticky=!0,c.dispatchEvent("onError",a)}else m(o.parseWebServiceError(t,e));c._perfTimer.stop("CommandUIDurationMaturity")},onTimeout:function(){c._perfTimer.stop("Maturity: getStateGraph");var t={};t.errorMsg=u.maturityTimeoutInfo,t.type="info",t.sticky=!0,c.dispatchEvent("onError",t),c._perfTimer.stop("CommandUIDurationMaturity")}})},_changeMaturity:function(t,e,i){var n,s=this,l="null",c=a.getHeaders(encodeURIComponent(i));if(c["X-Requested-With"]="XMLHttpRequest",void 0!==this.model.serviceurl&&this.model.serviceurl){var m=this.model.serviceurl+t;n=m+(m.indexOf("?")<0?"?":"&")+"tenant="+s.tenant,void 0!==this.multiservicSecurityContext&&this.multiservicSecurityContext&&(c.SecurityContext=this.multiservicSecurityContext)}else n=a.get3DSpaceWSUrl(s.tenant,"/resources/lifecycle/maturity/"+t,null);var f=s.model.getChangeActionId();return f&&f.trim().length>0&&(c["DS-Change-Authoring-Context"]="pid:"+f),d.enrichRequestWithMetrics(e,{UXName:"Maturity"}),e.notificationTimeout=3600,console.log(t+":"),console.log(e),s.dataToSend=e,s._perfTimer.start("Maturity: "+t),r.authenticatedRequest(n,{method:"POST",type:"json",headers:c,timeout:36e5,data:JSON.stringify(e),onComplete:function(e){s._perfTimer.stop("Maturity: "+t),console.log(t+": COMPLETED"),console.log(e),l=e;e.data=[];for(var i=e.results,n={data:[]},o=0;o<i.length;o++){var a=s.model.getAttribute(i[o].physicalid,"current");void 0===a&&(a=i[o].current);var r=i[o].current,c=null;i[o].hasOwnProperty("cestamp")&&(c=i[o].cestamp);var d=null;i[o].hasOwnProperty("modified")&&(d=i[o].modified),s.model.setAttribute(i[o].physicalid,"current",i[o].current),s.model.setAttribute(i[o].physicalid,"cestamp",c),s.model.setAttribute(i[o].physicalid,"modified",d);var u={physicalid:i[o].physicalid,tostate:r,fromstate:a};n.data.push(u),e.data.push(u)}if(s.model.isWebInWin)s.dispatchEvent("onStateChanged",e);else{if(s.includeStructureFlag){if("success"==e.status)return n.dontshowsuccess=!1,void s.dispatchEvent("onStateChanged",n);if("failure"==e.status){n.dontshowsuccess=!0;for(o=0;o<s.selectedItems.data.length;o++)if(s.selectedItems.data[o].physicalid===s.initialSelections.data[0].physicalid&&e.report[0].hasOwnProperty("error")){var m=e.report[0].error;m.contains("\n")&&(m=m.replaceAll("\n"," ")).contains("1500168")&&(m=m.replaceAll("1500168",""));var f=M(s.selectedItems.data[o],"Failed",m);return s.dataForReportingPanel.push(f),p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),void s.dispatchEvent("onStateChanged",n)}}}var y={};if(s.counterforPromoteDemote=s.counterforPromoteDemote+1,"failure"===e.status){var g=e.report,v=g.length,S=[],b="";1==v&&((b=g[0].error).contains("1500168")||b.contains("all requirements not satisfied"))&&(b=h.get("MATURITY_FAIL_PERMISSION"));var C=[],I=[],x=!1,_="";for(o=0;o<s.selectedItems.data.length;o++)for(var A=0;A<g.length;A++){var w=1==s.selectedItems.data[o].isOnceInstantiable&&"3DShape"==s.selectedItems.data[o].type;s.selectedItems.data[o].physicalid===g[A].physicalids[0]&&0==w&&(_=null!=s.selectedItems.data[o].displayName?s.selectedItems.data[o].displayName:s.selectedItems.data[o].name)}for(o=0;o<s.selectedItems.data.length;o++){x=!1;for(A=0;A<g.length;A++){C=[];w=1==s.selectedItems.data[o].isOnceInstantiable&&"3DShape"==s.selectedItems.data[o].type;if(s.selectedItems.data[o].physicalid===g[A].physicalids[0]&&0==w){((b=g[A].error).contains("1500168")||b.contains("all requirements not satisfied"))&&(b=h.get("MATURITY_FAIL_PERMISSION")),C=M(s.selectedItems.data[o],"Failed",b),_=null!=s.selectedItems.data[o].displayName?s.selectedItems.data[o].displayName:s.selectedItems.data[o].name,I.push(C),s.dataForReportingPanel.push(C),console.log("1:  "+C),x=!0;for(var T=0;T<s.dataToSend.data.length;T++)s.dataToSend.data[T].physicalid===g[A].physicalids[0]&&s.dataToSend.data.splice(T,1)}}if(0==x)for(var P=0;P<n.data.length;P++){C=[];w=1==s.selectedItems.data[o].isOnceInstantiable&&"3DShape"==s.selectedItems.data[o].type;if(s.selectedItems.data[o].physicalid===n.data[P].physicalid&&0==w){C=n.data[P].fromstate==n.data[P].tostate&&n.data[P].fromstate==s.selectedItems.data[o].current?M(s.selectedItems.data[o],"Failed",""==_&&""!=b?h.get("MaturityFailedDependencyDoc"):h.get("MaturityFailedDependency{0}").format(_)):M(s.selectedItems.data[o],"Success",h.get("MaturitySuccess")),I.push(C),s.dataForReportingPanel.push(C),console.log("31:  "+C),x=!0;for(T=0;T<s.dataToSend.data.length;T++)s.dataToSend.data[T].physicalid===n.data[P].physicalid&&s.dataToSend.data.splice(T,1)}}if(0==x){for(A=0;A<s.dataToSend.data.length;A++){C=[];w=1==s.selectedItems.data[o].isOnceInstantiable&&"3DShape"==s.selectedItems.data[o].type;if(s.selectedItems.data[o].physicalid===s.dataToSend.data[A].physicalid&&0==w){C=M(s.selectedItems.data[o],"Failed",""==_&&""!=b?h.get("MATURITY_FAIL_PERMISSION"):h.get("MaturityFailedDependency{0}").format(_)),I.push(C);for(T=0;T<s.dataForReportingPanel.length;T++)if(s.dataForReportingPanel[T][0]===C[0]){s.dataForReportingPanel.splice(T,1);break}s.dataForReportingPanel.push(C),console.log("11:  "+C),x=!0}}if(0==x)if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed||0==s.isPromoteDeomoteBothServiceUsed)if(0==(w=1==s.selectedItems.data[o].isOnceInstantiable&&"3DShape"==s.selectedItems.data[o].type)){var D=!0;if(0==s.isPromoteDeomoteBothServiceUsed)D=!0;else if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed){var E=!1;for(A=0;A<s.dataForReportingPanel.length;A++)if(s.dataForReportingPanel[A][0]===s.selectedItems.data[o].physicalid){E=!0;break}D=0==E}D&&(C=M(s.selectedItems.data[o],"Failed",""==_&&""!=b?h.get("MATURITY_FAIL_PERMISSION"):h.get("MaturityFailed")),s.dataForReportingPanel.push(C),I.push(C),console.log("2:  "+C))}}}n.dontshowsuccess=!1,s.selectedItems.data[0].hasOwnProperty("isODT")||(s.cols.length>9&&(s.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:s.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:s.titleNls,dataIndex:s.titleNls},{text:s.typeNls,dataIndex:s.typeNls},{text:s.revisionNls,dataIndex:s.revisionNls},{text:s.maturityNls,dataIndex:s.maturityNls},{text:s.maturityLockNls,dataIndex:"Reserved",typeRepresentation:"icon",width:50,resizableFlag:!1},{text:s.orgNls,dataIndex:s.orgNls},{text:s.collabNls,dataIndex:s.collabNls},{text:s.completionNls,dataIndex:s.completionNls},{text:h.deleteObjects,dataIndex:"Selected",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSelected,default:"on",tooltip:h.deleteSelectedToolTip},{value:h.deleteAdded,default:"off",tooltip:h.deleteAddedToolTip}]},{text:h.deleteResults,dataIndex:"Results",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSuccessfulShort,default:"on",tooltip:h.deleteSuccessfulShort},{value:h.deleteFailedShort,default:"on",tooltip:h.deleteFailedShort}]}]),s.isPromoteDeomoteBothServiceUsed?2==s.counterforPromoteDemote&&(O(s.dataForReportingPanel)&&(n.dontshowsuccess=!0),p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):"promote"===t&&!1===s.isPromoteDeomoteBothServiceUsed?O(s.dataForReportingPanel)&&(n.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):"demote"===t&&!1===s.isPromoteDeomoteBothServiceUsed&&O(s.dataForReportingPanel)&&(n.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]));for(o=0;o<v&&o<10;o++)s.model.objects[g[o].physicalids]&&s.model.objects[g[o].physicalids].displayName&&!g[o].error.contains(s.model.objects[g[o].physicalids].displayName)?S.push(s.model.objects[g[o].physicalids].displayName+": "+g[o].error+" "+h.maturityFailure):S.push(g[o].error+"\n\n"+h.maturityFailure);v>10&&S.push(h.replace(h.maturityAdditionalErrorMessage,{maxErrors:10..toString(),lineBreak:"\n",numErrors:(v-10).toString()})+"\n\n"+h.maturityFailure),y.errorMsg=S,y.type="error",y.dontshowsuccess=!0,s.dispatchEvent("onError",y),n.data.length>0&&s.dispatchEvent("onStateChanged",n)}else if(n.data.length>0){for(C=[],I=[],x=!1,o=0;o<s.selectedItems.data.length;o++){x=!1;for(A=0;A<n.data.length;A++){C=[];w=1==s.selectedItems.data[o].isOnceInstantiable&&"3DShape"==s.selectedItems.data[o].type;if(s.selectedItems.data[o].physicalid===n.data[A].physicalid&&0==w){C=M(s.selectedItems.data[o],"Success",h.get("MaturitySuccess")),I.push(C);for(T=0;T<s.dataForReportingPanel.length;T++)if(s.dataForReportingPanel[T][0]===C[0]){s.dataForReportingPanel.splice(T,1);break}s.dataForReportingPanel.push(C),console.log("3:  "+C),x=!0;for(T=0;T<s.dataToSend.data.length;T++)s.dataToSend.data[T].physicalid===n.data[A].physicalid&&s.dataToSend.data.splice(T,1)}}if(0==x)if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed||0==s.isPromoteDeomoteBothServiceUsed)if(0==(w=1==s.selectedItems.data[o].isOnceInstantiable&&"3DShape"==s.selectedItems.data[o].type)){D=!0;if(0==s.isPromoteDeomoteBothServiceUsed)D=!0;else if(2==s.counterforPromoteDemote&&s.isPromoteDeomoteBothServiceUsed){for(E=!1,A=0;A<s.dataForReportingPanel.length;A++)if(s.dataForReportingPanel[A][0]===s.selectedItems.data[o].physicalid){E=!0;break}D=0==E}D&&(C=M(s.selectedItems.data[o],"Failed",h.get("MaturityFailed")),I.push(C),s.dataForReportingPanel.push(C),console.log("4:  "+C))}}n.dontshowsuccess=!1,s.selectedItems.data[0].hasOwnProperty("isODT")||(s.cols.length>9&&(s.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:s.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:s.titleNls,dataIndex:s.titleNls},{text:s.typeNls,dataIndex:s.typeNls},{text:s.revisionNls,dataIndex:s.revisionNls},{text:s.maturityNls,dataIndex:s.maturityNls},{text:s.maturityLockNls,dataIndex:"Reserved",typeRepresentation:"icon",width:50,resizableFlag:!1},{text:s.orgNls,dataIndex:s.orgNls},{text:s.collabNls,dataIndex:s.collabNls},{text:s.completionNls,dataIndex:s.completionNls},{text:h.deleteObjects,dataIndex:"Selected",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSelected,default:"on",tooltip:h.deleteSelectedToolTip},{value:h.deleteAdded,default:"off",tooltip:h.deleteAddedToolTip}]},{text:h.deleteResults,dataIndex:"Results",isHidden:!0,isFilter:!0,filterOptions:[{value:h.deleteSuccessfulShort,default:"on",tooltip:h.deleteSuccessfulShort},{value:h.deleteFailedShort,default:"on",tooltip:h.deleteFailedShort}]}]),s.isPromoteDeomoteBothServiceUsed?2==s.counterforPromoteDemote&&O(s.dataForReportingPanel)&&(n.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):"promote"===t&&!1===s.isPromoteDeomoteBothServiceUsed?O(s.dataForReportingPanel)&&(n.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[]):"demote"===t&&!1===s.isPromoteDeomoteBothServiceUsed&&O(s.dataForReportingPanel)&&(n.dontshowsuccess=!0,p.launchReportingPanel(s.dataForReportingPanel,s.cols,null),s.dataForReportingPanel=[])),s.dispatchEvent("onStateChanged",n)}}function M(t,e,i){var n=[];if(n.push(t.physicalid),"Failed"===e?n.push(h.get("MATURITY_FAIL_STATUS")):"Success"===e&&n.push(h.get("MaturitySuccess")),n.push(e),null!=t.displayName||null!=t.displayName?n.push(t.displayName):n.push(t.name),n.push(t.typeDisplayName),n.push(t.revision),t.hasOwnProperty("currentStateUserName")&&null!=t.currentStateUserName&&null!=t.currentStateUserName&&t.currentStateUserName.trim().length>0&&n.push(t.currentStateUserName),t.hasOwnProperty("locked")&&t.hasOwnProperty("lockedBy")){var o=s.getLockIcon(t.locked,t.lockedBy);n.push(o)}else if(t.hasOwnProperty("reserved")&&t.hasOwnProperty("reservedby")){o=s.getLockIcon(t.reserved,t.reservedby);n.push(o)}return null==t.organizationTitle||null==t.organizationTitle||""==t.organizationTitle?n.push(t.organization):n.push(t.organizationTitle),null==t.projectTitle||null==t.projectTitle||""==t.projectTitle?n.push(t.project):n.push(t.projectTitle),n.push(i),n.push(h.deleteSelected),"Failed"===e?n.push(h.get("deleteFailedShort")):"Success"===e&&n.push(h.get("MaturitySuccess")),n}function O(t){for(var e=!1,i=0;i<t.length;i++)if("Failed"==t[i][2]){e=!0;break}return e}},onFailure:function(e,i){s._perfTimer.stop("Maturity: "+t),console.log(t+":Failure..."+e);var n=o._parseWebServiceError(e,i,!0,"Maturity");void 0!==n&&void 0!==n&&n.hasOwnProperty("message")?(n.errorMsg=n.message,n.type="error",n.hasOwnProperty("isNotificationInfo")&&n.isNotificationInfo&&(n.type="info",n.sticky=!0)):n.errorMsg=o.parseWebServiceError(e,i,!0),s.dispatchEvent("onError",n)},onTimeout:function(){s._perfTimer.stop("Maturity: "+t),console.log(t+": A connection timeout occured.");var e={};e.errorMsg=u.maturityTimeoutInfo,e.type="info",e.sticky=!0,s.dispatchEvent("onError",e)}}),l},getGraphInfo:function(){return this.model.getGraphInfo()},getStateInfos:function(t){return this.model.getStateInfos(t)},setTenant:function(t){this.tenant=t}})}),define("DS/MaturityWidget/MaturityWidget",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","UWA/Promise","DS/Controls/Toggle","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityController","DS/MaturityWidget/MaturityModel","DS/MaturityWidget/MaturityGraph","DS/MaturityWidget/MultiselUI","DS/MaturityWidget/MaturityTransitionFilters","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/Utils","DS/LifecycleServices/LifecyclePerfTimer","DS/LifecycleCmd/MessageMediator","DS/LifecycleControls/ProgressDialog","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/UUIDGenerator","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i,n,o,a,s,r,l,c,d,h,u,p,m,f,y,g,v,S,b){"use strict";var C=!0;return e.extend({displayWorkflowGraph:!0,hostedInDialog:!1,context:null,uuid:null,maskDelay:3e3,onKeyDownHandler:null,multiSelUITitle:null,sizePrefKey:"maturityDlgSize",isWebInWin:!1,canPromoteOrDemote:!0,numInitSelection:0,isEmbeddedUI:!1,PADSession:null,hasRequestedPADSession:!1,initialSelection:null,isMultipleSelection:!1,sizebeforeadvanced:null,init:function(t){this.uuid=y.create();var e=t||{type:""};this._parent(e),this._perfTimer=u,this._perfTimer.init("Maturity"),this._perfTimer.start("CommandUIDurationMaturity"),this.elements.content=UWA.createElement("div",{class:"lcm-maturity-content"}),this.elements.container=this.elements.content,this.maturityGraphContainer=UWA.createElement("div",{class:"lcm-maturity-container"}),this.maturityGraphContainer.inject(this.elements.content,"top"),void 0!==e.context&&null!=e.context&&(this.context=e.context),void 0!==e.isWebInWin&&null!=e.isWebInWin&&(this.isWebInWin=e.isWebInWin);var i=null;e&&e.hasOwnProperty("externalSettings")&&e.externalSettings&&(i=e.externalSettings),v.app_initialization(function(){},i),this.controller=new a(this.context),this.controller.multiservicSecurityContext=e.securitycontext,this.model=this.controller.model,this.model.isWebInWin=this.isWebInWin,this._setupEventSubscriptions()},_setupEventSubscriptions:function(){var t=this;o.subscribe("Lifecycle.Modification",function(e){t._externalRefresh(JSON.parse(e))}),this.addEvent("onPostInject",function(){t.isEmbeddedUI=!0});var e=this.controller;e.addEvent("onStateChanged",function(e){document.body.style.cursor="default";var i=[],n=[];for(var o in e.data.forEach(function(e){var o=t.model.getAttribute(e.physicalid,"type"),a=t.model.getAttribute(e.physicalid,"revision"),s=t.model.getAttribute(e.physicalid,"policy"),r=t.model.getAttribute(e.physicalid,"name"),l=t.model.getAttribute(e.physicalid,"coretype"),d=t.model.getAttribute(e.physicalid,"interfaceHash"),h=t.model.getAttribute(e.physicalid,"cestamp"),u=t.model.getAttribute(e.physicalid,"current"),p=t.model.getAttribute(e.physicalid,"modified"),m={physicalid:e.physicalid,tostate:e.tostate,fromstate:e.fromstate,type:o,revision:a,policy:s,name:r,coretype:l,interfaceHash:d},f={physicalid:e.physicalid,cestamp:h,current:u,modified:p};n.push(f);for(var y=c.fetchTypeActionKeys(o,d),g=0;g<y.length;g++){var v=y[g];v in i||(i[v]=[]),i[v].push(m)}}),i){var a=i[o],s=function(){};if(null!==(s=c.fetchActionFilter(o)))s(a,{maturityWidget:t,securityContext:t.controller.securityContext,maturityGraphContainer:t.maturityGraphContainer})}if(t.isWebInWin&&t.options.webInWinHelper&&(e.dontshowsuccess=!0,t.options.webInWinHelper.fireWintopMaturityCompletedCommandWithArgs(t.options.webToWinComSocket,e,t.options.OnCompletedFireCommand),t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)),t.options.wintop&&t.options.webInWinHelper){var r;if(e.dontshowsuccess=!0,t.options.webToWinComSocket)null!=n&&n.length>0&&(r=t.options.webInWinHelper.createMaturityJSONArray(n)),t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:{severity:"warning",message:b.maturitySuccess}},"lf_web_in_win"),t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onMaturityModification",notif_parameters:r},"lf_web_in_win");t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)}if(e.hasOwnProperty("dontshowsuccess")&&0==e.dontshowsuccess&&this._showNotification("success",b.maturitySuccess),this.maturityGraph&&this.displayWorkflowGraph&&e.hasOwnProperty("data")&&e.data.length>0&&(this.maturityGraph.onEndTransition(e.data[0].tostate),C=!0,this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())),e.hasOwnProperty("data")&&e.data.length>0&&this.newStateInaccessible(e.data)){if(this.context.refresh&&"lifecycle"!=this.context.app)try{this.context.refresh()}catch(t){console.error(t)}var l={created:[],deleted:[],modified:[]};l.context=this,e.data.forEach(function(t){var e={physicalid:t.physicalid,operation:"Promote"};l.deleted.push(e)}),p.dispatchEvent("onModification",l),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}else{if(e.hasOwnProperty("data")&&e.data.length>0&&this._refresh(e.data),e.hasOwnProperty("data")&&e.data.length>0&&this.displayWorkflowGraph){var d;for(d=0;d<e.data.length;d++){var h=this.model.getAttribute(e.data[d].physicalid,"isAggregateRep");if(this.model.getAttribute(e.data[d].physicalid,"policy")&&!h)break}d==e.data.length&&(d=0);var u=this.model.getAttribute(e.data[d].physicalid,"policy"),m=e.data[d].tostate;this._updateGraph(u,m)}this.isEmbeddedUI||(this.dialog&&this.dialog.destroy(),this._onComplete()),t.dispatchEvent("onMaturityTransitionEnd",e)}t._perfTimer.stop("CommandExecutionDurationMaturity");t._perfTimer.printTimeShowDialogAndProcess(["CommandUIDurationMaturity","CommandExecutionDurationMaturity","Maturity: promote","Maturity: demote","Maturity: getStateGraph"],t.controller.securityContext)},this),e.addEvent("onError",function(e){if(document.body.style.cursor="default",t.options.wintop){var i="";if(e&&e.hasOwnProperty("errorMsg"))if(Array.isArray(e.errorMsg))for(const t of e.errorMsg)i+=t;else i=e.errorMsg;var n=b.maturityFailure;i.trim().length>0&&(n=i),t.options.webToWinComSocket&&t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:{severity:"warning",message:n}},"lf_web_in_win"),t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)}else{if(null!=e&&e.hasOwnProperty("type"))var o=e.type;e.hasOwnProperty("dontshowsuccess")||this.displayError(e,o)}this._closeDialog(),this.maturityGraph&&(this.maturityGraph.onEndTransition(),C=!0,this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())),this.isEmbeddedUI?this._refreshGraph():this._onComplete(),t._perfTimer.stop("CommandExecutionDurationMaturity");t._perfTimer.printTimeShowDialogAndProcess(["CommandUIDurationMaturity","CommandExecutionDurationMaturity","Maturity: promote","Maturity: demote","Maturity: getStateGraph"],t.controller.securityContext)},this),e.addEvent("onGraphInfoChanged",function(){this._postInitGraph(),this._buildGraph(),this._perfTimer.stop("CommandUIDurationMaturity")},this),this.model=this.controller.model},executeCmd:function(t,e,i){this.addEvent("onReady",function(t){this._showCommandUI(t.displayWorkflowGraph,t.policy)},this),this.addEvent("onComplete",function(){i()}),this.context=e.context,this.controller._context=this.context,this.hostedInDialog=!0,this.setObjects(t),this.isWebInWin?e.context.options&&e.context.options.hasOwnProperty("change")&&this.model.setChangeAction(e.context.options.change):this.options.wintop?e.context.options&&e.context.options.hasOwnProperty("ChangeActionId")&&this.model.setChangeAction({id:e.context.options.ChangeActionId}):e&&e.hasOwnProperty("change")&&this.model.setChangeAction(e.change)},getUUID:function(){return this.uuid},onResize:function(){this.isWebInWin&&this.dialog},setWidgetSize:function(t){this.floatingDlg._maximize(),this.floatingDlg.centerIt(),this.options.wintop?this.floatingDlg.setNewBodySize(t):this.isWebInWin&&this.floatingDlg.setNewSize(t),this.elements.content.setStyle("width",t.width+"px")},_onOk:function(){this.onOkClicked&&this.onOkClicked(this),this._onComplete()},_onComplete:function(){this.dispatchEvent("onComplete"),this.maturityGraph&&this.maturityGraph.destroy(),this.onKeyDownHandler&&(document.onkeydown=this.onKeyDownHandler),this.refreshSub&&(this.refreshSub.unsubscribe(),this.refreshSub=null)},_showCommandUI:function(t,e){var i=this;this.displayWorkflowGraph=t;var n=t,o=this,a=new d,s=!0,r=!0;this.isWebInWin&&(s=!1),this.options.wintop&&(r=!1);var l=a.create(this.elements.content,{title:b.maturity,className:"ENO_Maturity",closeButton:s,maximizable:!1,resizable:r,buttonStyle:n?a.buttonStyle.cancel:a.buttonStyle.okCancel,enableCmd:function(){return this.canPromoteOrDemote},onOk:function(){i._perfTimer.start("CommandExecutionDurationMaturity"),o._saveDlgSize(),a._disableUI(),o._onOk()},onClose:function(){o._saveDlgSize(),o._onComplete(),o._closeDialog(),i.isWebInWin||i.options.wintop?i.options.webInWinHelper&&i.options.webInWinHelper.closePanel(i.options.webToWinComSocket):i.dispatchEvent("onMaturityCanceled")},onCloseOverride:function(){1==C&&(a._disableUI(),a._onCloseHandler.apply(this._fnContext),a.destroy())},events:{onResizeFloating:function(t){void 0!==o.multiSelUI&&null!==o.multiSelUI&&o.multiSelUI.onPanelResize()}}},this);if(l.inject(widget.body),this.isWebInWin||this.options.wintop)l._maximize();else{var c=this._loadSize(),h=c.width,u=c.height;h<650&&(h=650),u<305&&(u=305);var p=this.displayWorkflowGraph?500:600,m=this.displayWorkflowGraph?250:400;l.setNewSize({width:h,height:u})}setTimeout(function(){if(i.isWebInWin||i.options.wintop){i.floatingDlg._maximize(),i.floatingDlg.centerIt(),i.floatingDlg.setMinSize({width:"100%",height:"100%"});var t=i.floatingDlg.getModalBodySize();t.height=t.maxHeight,t.width=t.maxWidth,i.floatingDlg.setNewBodySize(t),i.elements.content.setStyle("width",t.width+"px")}else l.setMinSize(p,m)},10),this.dialog=a,this.floatingDlg=l,t?(this._createSingleObjectGraphUI(this.model.getMaturityGraph(e)),a.setTitle(this._getCurrentObjectTitleRevision()),this.dialog._cancelButton&&this.dialog._disableOK()):(this.maturityGraphContainer.addClassName("lcm-maturity-container-multisel"),this._createMultiSelectionUI(this.maturityGraphContainer)),this.isWebInWin&&this.options.webInWinHelper?this.options.webInWinHelper.fireWintopCommand(i.options.webToWinComSocket,null,i.options.OnViewReadyFireCommand):i.dispatchEvent("onMaturityUIReady")},_getCurrentObjectTitleRevision:function(){var t=b.maturity,e=this.model.getObjects();if(null!=e){Object.keys(e);var i=e[this.model.originalPid];null!=i&&i.hasOwnProperty("externalMaturityTitle")&&void 0!==i.externalMaturityTitle&&null!==i.externalMaturityTitle?(t=this.isWebInWin?i.externalMaturityTitle:t+" - "+i.externalMaturityTitle,i.hasOwnProperty("revision")&&null!=i.revision&&(t=t+" "+i.revision)):null!=i&&i.hasOwnProperty("name")&&(t=this.isWebInWin?i.name:t+" - "+i.name,i.hasOwnProperty("revision")&&null!=i.revision&&(t=t+" "+i.revision))}return t},_saveDlgSize:function(){if(this.floatingDlg){var t=this.floatingDlg.getModalBodySize();t.height=this.floatingDlg.getContainerHeight(),t.hasOwnProperty("width")&&t.width>0&&(t.width=t.width+2),this._storeSize(t)}},_loadSize:function(){var t=widget.getValue(this.sizePrefKey);return t?JSON.parse(t):{width:820,height:260}},_storeSize:function(t){widget.getValue(this.sizePrefKey)||widget.addPreference({name:this.sizePrefKey,type:"hidden",defaultValue:"{}"}),widget.setValue(this.sizePrefKey,JSON.stringify(t))},_installCloseOnEscapePatch:function(){var t=this;this.onKeyDownHandler=document.onkeydown,document.onkeydown=function(e){("key"in(e=e||window.event)?"Escape"==e.key||"Esc"==e.key:27==e.keyCode)&&(t._closeDialog(),t.isEmbeddedUI||t._onComplete())}},_externalRefresh:function(t){if(this.displayWorkflowGraph&&UWA.is(t.Refresh,"object")&&UWA.is(t.Refresh.modified,"array")&&this.getUUID()!==t.OriginID&&1==t.Refresh.modified.length){var e=t.Refresh.modified[0];if("Promote"===e.operation){var i=this.model.getObjects()[e.physicalid];null!=i&&i.current!==e.state&&(this.model.changeCurrentObjectState(e.physicalid,e.state),this._updateGraph(e.policy,e.state))}}},_refresh:function(t){var e=this.model,i={created:[],deleted:[],modified:[]};i.context=this,t.forEach(function(t){var n={physicalid:t.physicalid,operation:"Promote",state:t.tostate,policy:e.getAttribute(t.physicalid,"policy")};i.modified.push(n)}),p.dispatchEvent("onModification",i)},_closeDialog:function(){this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null),this.dialog&&this.dialog.destroy()},newStateInaccessible:function(t){return null===t[0].tostate||void 0===t[0].tostate},setTitle:function(t){this.dialog&&this.dialog.setTitle(t)},_postInitGraph:function(){this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null);this.model.getObjects()},_addIncludeChildrenCheckbox:function(){var t=this;if(null==this.includeChildrenCheckbox){this.optionDlg=document.createElement("div"),this.optionDlg.className="lifecycle-options",this.elements.content.appendChild(this.optionDlg);var e=b.includeDescendants;this.includeChildrenCheckbox=new n({type:"checkbox",label:e}).inject(this.optionDlg)}this.includeChildrenCheckbox.addEventListener("change",function(e){if(e&&e.hasOwnProperty("dsModel")){var i=e.dsModel.checkFlag;t.isWebInWin&&t.options.webInWinHelper?i?t.options.webInWinHelper.fireWintopCommand(t.options.webToWinComSocket,null,t.options.OnIncludeChildrenFireCommand):t.options.webInWinHelper.fireWintopCommand(t.options.webToWinComSocket,null,t.options.OnExcludeChildrenFireCommand):t.dispatchEvent("onIncludeChildrenChanged",{includeChildren:i})}}),this.model.isSingleIRPCAssembly?this.includeChildrenCheckbox.show():null!=this.includeChildrenCheckbox&&this.includeChildrenCheckbox.hide()},getPADSessionPromise:function(){var t=this;return new UWA.Class.Promise(function(e,i){require(["DS/PADUtils/PADSession"],function(i){t.hasRequestedPADSession=!0,t.PADSession=i,e(t.PADSession)},function(i){t.hasRequestedPADSession=!0,t.PADSession=null,e(t.PADSession)})})},_getPADSession:function(){return this.hasRequestedPADSession?UWA.Class.Promise.resolve(this.PADSession):this.getPADSessionPromise()},empty:function(){this.maturityGraph&&this.maturityGraph.destroy(),this.model.clear()},_showNotification:function(t,e,i){var n=this;Array.isArray(e)||"string"!=typeof e||(e=[e]),Array.isArray(e)&&e.length&&e.forEach(function(e){var o={eventID:t,msg:e.split?e.split("\n").join("<br>"):e,sticky:i};null!=n.context&&"function"==typeof n.context.displayNotification?n.context.displayNotification(o):f.displayNotification(o)})},displayError:function(t,e){var i=t;t.hasOwnProperty("errorMsg")&&(i=null!==t.errorMsg?t.errorMsg:t),void 0===e&&t.hasOwnProperty("type")?e=t.type:void 0===e&&(e="warning");var n=!1;null!=t&&t.hasOwnProperty("sticky")&&(n=t.sticky),this._showNotification(e,i,n)},_getFilteredObjects:function(){return this.model.getObjects(function(t){return!t.isOnceInstantiable})},_isObjectsAlreadyLoaded:function(t){var e=!1,i=h.toMaturityArray(this._getFilteredObjects());return 0!==i.length&&(i=i[0],null!=t&&0!==t.length&&(Array.isArray(t)&&t.forEach(function(t){t.hasOwnProperty("physicalid")&&i.hasOwnProperty("physicalid")&&t.hasOwnProperty("current")&&i.hasOwnProperty("current")&&t.physicalid==i.physicalid&&t.current==i.current&&(e=!0)}),e))},setObject:function(t){return this.setObjects([t])},setObjects:function(t){if(this._isObjectsAlreadyLoaded(t))return!1;if(this.numInitSelection=t.length,this.initialSelection=t,this.isEmbeddedUI&&this.empty(),0===t.length)throw b.noObject;var e={};e.data=t;var i=t[0];if(""===i.physicalid)throw b.epmtyPhysicalId;if(this.isWebInWin)this.controller.setTenant(this.options.tenant);else if(null!=i&&i.hasOwnProperty("tenant")&&void 0!==i.tenant&&null!==i.tenant&&i.tenant.trim().length>0)this.controller.setTenant(i.tenant);else if(this.options&&this.options.hasOwnProperty("externalSettings")&&void 0!==this.options.externalSettings&&null!==this.options.externalSettings&&Array.isArray(this.options.externalSettings)&&this.options.externalSettings.length>0){var n=this.options.externalSettings[0];n&&n.hasOwnProperty("platformId")&&this.controller.setTenant(this.options.externalSettings[0].platformId)}this.model.setObjects(t),this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null),this.progressDialog=new m,this.progressDialog.showDelay(document.body,b.maturityGraphInit,3e3);var o=this;return this.controller.initGraph(e,function(t){o._postInitGraph(),o.displayError(t),o._onComplete()}),o.trackAppContent(t),!0},_createPromotePayload:function(t,e){var i=[];for(var n in e)i.push({physicalid:n,tostate:t,fromstate:e[n].current,type:e[n].type,revision:e[n].revision,policy:e[n].policy,name:e[n].name,coretype:e[n].coretype,interfaceHash:e[n].interfaceHash});var o={};return o.data=i,o},_createGraphStates:function(t,e){var n=this,o=this._getFilteredObjects(),a=UWA.clone(t.states),s=o[this.model.originalPid].current,r=h.toArray(a[s].connectors_in);r.contains=function(t){return this.find(function(e){return e===t})};var l=function(t,e){for(var i={data:[]},n=0;n<t.data.length;n++)e.hasOwnProperty(t.data[n].physicalid)&&i.data.push(t.data[n]);this._promote(i)},c=function(t){return new i(function(e,i){n._filter(t).then(function(t){e(t)})})},d=function(t){this._perfTimer.start("CommandExecutionDurationMaturity"),this._promote(t)},u=function(t){this._perfTimer.start("CommandExecutionDurationMaturity"),this._demote(t)};for(var p in a){var m=!1,f=!1,y=!1,g=this._createPromotePayload(p,o);a[p].filter=c.bind(this,g),t.infos.isDemoteAuthorized&&r.contains(p)?(a[p].action=u.bind(this,g),m=!0):t.infos.isDemoteAuthorized?(a[p].action=d.bind(this,g),f=!0):t.infos.isPromoteAuthorized&&(a[p].action=l.bind(this,g),y=!0),a[p].isDemote=m,a[p].isPromote=f,a[p].isDisabled=!(f||m||y),a[p].info.isCurrent=p===s}if(e)for(var v in a)a[v].info.isCurrent=v===e;return a},_buildGraph:function(){var t=[],e=[],i=this.model.getObjects(),n=!0,o=0,a=null;for(var s in i){void 0!==i[s].isAggregateRep&&0!=i[s].isAggregateRep||o++,"Reference"!==i[s].coretype&&(a=!0);var r=i[s].policy;-1===t.indexOf(r)&&t.push(r);var l=i[s].current;-1===e.indexOf(l)&&e.push(l)}var c=b.multipleSelection;if(!0===a){var d=null;for(var h in t)null==d&&(d=this.model.getPolicy(t[h]).maturityGraph.states.length),d!=this.model.getPolicy(r).maturityGraph.states.length&&(n=!1,c=b.multipleSelectionNotSimilar)}o>this.numInitSelection&&!this.isEmbeddedUI&&this._showNotification("info",b.maturityAddedAggReps);var u=i[this.initialSelection[0].physicalid].policy,p={displayWorkflowGraph:!0,policy:u};if(1===o||this.isEmbeddedUI&&o>0)this.hostedInDialog?this.dispatchEvent("onReady",p):this._createSingleObjectGraphUI(this.model.getMaturityGraph(u));else if(!0===n&&o>=1)p.displayWorkflowGraph=!1,this.dispatchEvent("onReady",p);else if(o>=1){var m={};m.errorMsg=c,this.displayError(m,"primary"),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}this.dispatchEvent("buildGraphComplete")},updateOKButton:function(t){this.canPromoteOrDemote=t,this.dialog.updateUI()},_createMultiSelectionUI:function(t){var e=this;this.multiSelUI=new l,this.multiSelUI.create(this.model,t,this,function(t){e.multiSelUITitle=t,e.setTitle(t)})?this.onOkClicked=function(t){e.model.isWebInWin?e.options.webInWinHelper.fireWintopCommand(e.options.webToWinComSocket,null,e.options.OnOkFireCommand):e.dispatchEvent("onMaturityTransitionStart");for(var i=this.multiSelUI.getPromotePayload(),n=this.multiSelUI.getDemotePayload(),o={data:[]},a=0;a<i.data.length;a++)o.data.push(i.data[a]);for(a=0;a<n.data.length;a++)o.data.push(n.data[a]);e._filter(o).then(function(o){var a=!1;for(var s in o){a=!0;break}if(a){for(var r={data:[]},l=0;l<i.data.length;l++)o.hasOwnProperty(i.data[l].physicalid)&&r.data.push(i.data[l]);var c={data:[]};for(l=0;l<n.data.length;l++)o.hasOwnProperty(n.data[l].physicalid)&&c.data.push(n.data[l]);r.data.length>0&&c.data.length>0?t.controller.isPromoteDeomoteBothServiceUsed=!0:t.controller.isPromoteDeomoteBothServiceUsed=!1,document.body.style.cursor="progress",r.data.length>0&&t.controller.promote(r),c.data.length>0&&t.controller.demote(c)}else e.updateOKButton(!0)})}:(this.canPromoteOrDemote=!1,this.dialog.updateUI())},_objectHasWorkflow:function(t){var e,i=0;for(e in t.states)t.states.hasOwnProperty(e)&&i++;return 0!=i},_createSingleObjectGraphUI:function(t){if(this._objectHasWorkflow(t)){void 0!==this.maturityGraph&&null!==this.maturityGraph&&this.maturityGraph.destroy(),this.maturityGraph=new r;var e=this._createGraphStates(t);this.maturityGraph.create(this.maturityGraphContainer,e)}else{var i={};i.errorMsg=b.noMaturityGraph,this.displayError(i,"primary"),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}this._addIncludeChildrenCheckbox()},_updatePendingOperationUI:function(t){this.maturityGraph&&(this.dialog&&this.dialog._disableUI(),C=!1,this.maturityGraph.onStartTransition(t),this.options.webInWinHelper?this.options.webInWinHelper.fireWintopCommand(this.options.webToWinComSocket,null,this.options.OnOkFireCommand):this.dispatchEvent("onMaturityTransitionStart"))},_refreshGraph:function(){if(this.displayWorkflowGraph){var t=this._getFilteredObjects();for(var e in t){var i=t[e].policy,n=t[e].current;this._updateGraph(i,n)}}},_preparePromoteData:function(t,e,i){var n=this.model.originalPid;this.includeChildrenCheckbox.checkFlag?(this.controller.includeStructureFlag=!0,widget&&g.isInPSEditorWidget(widget)?this._getPADSession().then(function(t){var o=!0;t&&(o=t.determineAuthoredFlag()),this.controller.expandStructure(n,o,e,i)}.bind(this)):this.controller.expandStructure(n,!0,e,i)):e()},_filter:function(t){var e=this;return new i(function(n,o){if(0==t.data.length){for(var a=[],s=0;s<t.data.length;s++)a[t.data[s].physicalid]="";n(a)}else{var r=[];for(s=0;s<t.data.length;s++)for(var l=c.fetchTypeFilterKeys(t.data[s].type,t.data[s].interfaceHash),d=0;d<l.length;d++){var h=l[d];h in r||(r[h]=[]);var u=t.data[s];r[h].push(u)}var p=[];for(var m in r){(u=r[m]).filterKey=m,p.push(u)}var f={maturityWidget:e,securityContext:e.controller.securityContext,maturityGraphContainer:e.maturityGraphContainer},y=i.deferred();a=[];e.filterRecurse(p,0,f,y,a,[]),y.promise.then(function(t){n(t)})}})},filterRecurse:function(t,e,n,o,a,s){for(var r=this,l=t[e],d=l.filterKey,h=[],u=0;u<l.length;u++){l[u].physicalid in s||h.push(l[u])}var p=function(){};return p=c.fetchTypeFilter(d),new i(function(t,e){p(h,n).then(function(e){t(e)})}).then(function(i){e++;for(var l=0;l<h.length;l++){(c=h[l].physicalid)in i||(s[c]="")}for(var c in s)c in a&&delete a[c];for(var c in i)a[c]=i[c];if(e<t.length)r.filterRecurse(t,e,n,o,a,s);else o.resolve(a)})},_promote:function(t){var e=this;e._preparePromoteData(t,function(){var i=t.data[0].tostate,n={data:[]};for(var o in e.model.objects){var a=e.model.objects[o];if(a.current==i)a.displayName+"<br>";else if(i in a.routes[a.current]){if(!a.excludeFromPromote){var s="",r=e.model.getAttribute(a.physicalid,"signatures");if(r.hasOwnProperty([a.current])){var l=r[a.current];if(l.hasOwnProperty([i])){var c=Object.keys(l[i]);c.length>0&&"undefined"!=c[0]&&(s=c[0])}}n.data.push({physicalid:a.physicalid,tostate:i,fromstate:a.current,type:a.type,revision:a.revision,policy:a.policy,name:a.name,coretype:a.coretype,signature:s,cadMaster:a.cadMaster})}}else a.displayName+"<br>"}e._updatePendingOperationUI(n.data[0].tostate),e.controller.promote(n)},function(t){e.displayError(t,"primary")})},_demote:function(t){var e=this;e._preparePromoteData(t,function(){var i=t.data[0].tostate,n={data:[]};for(var o in e.model.objects){var a=e.model.objects[o];a.current==i?a.displayName+"<br>":a.excludeFromPromote||n.data.push({physicalid:a.physicalid,tostate:i,fromstate:a.current})}e._updatePendingOperationUI(n.data[0].tostate),e.controller.demote(n)},function(t){e.displayError(t,"primary")})},_updateGraph:function(t,e){if("#DENIED!"!=e){var i=this.model.getMaturityGraph(t),n=this._createGraphStates(i,e);this.maturityGraph.updateGraph(n)}},trackAppContent:function(t){var e={UXName:"Maturity",UXSub:"Main",models:t};this.trackerEvent=S.createInitActionEvent(e,this.trackerEvent),S.checkAndTrackPageEvent(this.trackerEvent)}})});