define("DS/VCXWebKernelCommands/VCXCommandManager",["DS/CoreEvents/Events","UWA/Class"],function(e,t){"use strict";var n=t.extend({initialize:function(){this._stackCmd=[],this._stackCmdUndo=[],this._isUnDoRunning=!1,this._isReDoRunning=!1,this._isDoRunning=!1,this._pushLevel=0,this._bTransaction=!1,this._stackLevelOfTransaction=[],this._stackMaxSize=500},unInitialize:function(){this._stackCmd=[],this._stackCmdUndo=[],this._isUnDoRunning=!1,this._isReDoRunning=!1,this._isDoRunning=!1,this._pushLevel=0,this._bTransaction=!1,this._stackLevelOfTransaction=[],this._stackMaxSize=500},postInitialize:function(){},SetStackMaxSize:function(e){this._stackMaxSize=e},GetStackMaxSize:function(){return this._stackMaxSize},Do:function(e){"VCXCmdChangeSelection"!==e.GetType()?(0===this._pushLevel&&(this._isDoRunning=!0),this._pushLevel++,e.Do(),this._pushLevel--,0===this._pushLevel&&(this._isDoRunning=!1)):e.Do()},Push:function(t){this._isUnDoRunning||(this._isReDoRunning||(this._isDoRunning?this.Do(t):(this._pushLevel>0&&t.SetLinkedCmd(!0),this._bTransaction&&(t=this.MergeTransaction(t)),this._stackCmdUndo=[],this._pushLevel++,this._stackCmd.length===this._stackMaxSize&&this._stackCmd.shift(),this._stackCmd.push(t),t.SaveContext(),t.Do(),this._pushLevel--,e.publish({event:"VCX_UNDOREDO_STACK_UPDATE"}))))},MergeTransaction:function(e){var t=e.GetType();if(!e.IsMergeable())return e;for(var n=this._stackLevelOfTransaction.length,i=this._stackLevelOfTransaction[n-1],a=null,o=this._stackCmd.length-1;o>=i;o--){var r=this._stackCmd[o];if(r)if(!r.IsLinkedCmd()){a=r;break}}return a?a.GetType()!==t?e:(this.Undo(!0),e=a.Merge(e)):e},Undo:function(t){if(t);else if(this._bTransaction)return void console.log("#### ERROR : undo inside a start transaction");this._isUnDoRunning=!0;for(var n=this._stackCmd.pop();n&&n.IsLinkedCmd();)n.Undo(),this._stackCmdUndo.push(n),n=this._stackCmd.pop();n&&(n.Undo(),this._stackCmdUndo.push(n)),this._isUnDoRunning=!1,this._bTransaction||e.publish({event:"VCX_UNDOREDO_DONE"})},Redo:function(){console.log("#### Redo"),this._isReDoRunning=!0;var t=this._stackCmdUndo.pop();for(t&&(this._stackCmd.push(t),t.Redo()),t=this._stackCmdUndo.pop();t&&t.IsLinkedCmd();)t.Redo(),this._stackCmd.push(t),t=this._stackCmdUndo.pop();t&&this._stackCmdUndo.push(t),this._isReDoRunning=!1,e.publish({event:"VCX_UNDOREDO_DONE"})},Empty:function(){this._stackCmd=[],this._stackCmdUndo=[],e.publish({event:"VCX_UNDOREDO_STACK_UPDATE"})},StartTransaction:function(){this._bTransaction&&console.error("### ERROR : WE ARE ALREADY INSIDE A TRANSACTION ###"),this._bTransaction=!0,this._stackLevelOfTransaction.push(this._stackCmd.length),e.publish({event:"VCX_STARTED_TRANSACTION"})},CancelTransaction:function(){var t=this._stackLevelOfTransaction.pop();let n=this._stackCmd.length-t;for(let e=0;e<n;e++){this._stackCmd.pop().Undo()}this._bTransaction=!1,e.publish({event:"VCX_END_TRANSACTION"})},EndTransaction:function(t){var n=this._stackLevelOfTransaction.pop();if(!(this._stackLevelOfTransaction.length>0))if(void 0!==n){for(var i=n+1;i<this._stackCmd.length;i++){this._stackCmd[i].SetLinkedCmd(!0)}if(n<this._stackCmd.length){var a=this._stackCmd[n];if(a){var o="Transaction commands";t&&(o=t),a.GetTitle=function(){return o}}}this._bTransaction=!1,e.publish({event:"VCX_END_TRANSACTION"})}else console.log("No index of start found here !")}});return Object.defineProperty(n.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCommandManager"}}),n}),define("DS/VCXWebKernelCommands/VCXCommand",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._bLinkedCmd=!1,this._callback=null,this._parameter=null},SetCallback:function(e,t){this._callback=e,this._parameter=t},IsLinkedCmd:function(){return this._bLinkedCmd},SetLinkedCmd:function(e){this._bLinkedCmd=e},Do:function(){},Redo:function(){this.Do()},Undo:function(){this.Invert(),this.Do(),this.Invert()},Invert:function(){},SaveContext:function(){},IsMergeable:function(){return!1}})}),define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],function(e,t,n){"use strict";return t.extend({init:function(){this._parent(),this._propertyMap=new n,this._propertyMapOld=new n,this._mapModifiables={},this._bLockEvents=!1,this._type="VCXCmdChangePropertiesVolatile"},GetType:function(){return this._type},GetTitle:function(){return"Change properties volatile"},ChangeProperties:function(e){for(var t in e._map)if(e._map.hasOwnProperty(t)){var n=this._mapModifiables[t],i=e.GetPropertySet(t);if(i._map.hasOwnProperty("Modifiable.StyleID")){var a=i._map["Modifiable.StyleID"];n.OnChangeProperty("Modifiable.StyleID",a.GetPropertyValue())}for(var o in i._map)if(i._map.hasOwnProperty(o)){if("Modifiable.StyleID"==o)continue;a=i._map[o];n.OnChangeProperty(o,a.GetPropertyValue())}n.OnChangePropertiesEnd()}},Do:function(){this.ChangeProperties(this._propertyMap);this._bLockEvents||e.publish({event:"VCX_PROPERTIES_CHANGED",data:this._propertyMap}),this._callback&&this._callback(this._parameter)},Invert:function(){var e=this._propertyMap;this._propertyMap=this._propertyMapOld,this._propertyMapOld=e},SaveContext:function(){for(var e in this._propertyMap._map)if(this._propertyMap._map.hasOwnProperty(e)){var t=this._mapModifiables[e],n=this._propertyMap.GetPropertySet(e);for(var i in n._map)if(n._map.hasOwnProperty(i)){var a=t.GetProperty(i);this._propertyMapOld.AddOrModifyProperty(e,a)}}},ChangeProperty:function(e,t){var n=e.GetHashing();this._mapModifiables[n]=e,this._propertyMap.AddOrModifyProperty(n,t.Clone())},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdUpdateThumbnail",["DS/VCXWebKernelCommands/VCXCommand"],function(e){"use strict";return e.extend({init:function(e,t,n){this._parent(),this._experienceBase=e,this._scenario=t,this._type="VCXCmdUpdateThumbnail",this._noLatency=n},GetType:function(){return this._type},GetTitle:function(){return"Update Thumbnail"},Do:async function(){this._experienceBase&&(this._experienceBase.getManager("VCXContextualContentManager")&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.isContextualBarDisplayed()?this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.contextualBarContextualMenuObserver(!1,"wux-afr-contextual-bar",async()=>{await this._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(this._scenario,this._noLatency)}):await this._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(this._scenario,this._noLatency))}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeComponent",["DS/VCXWebKernelCommands/VCXCommand"],function(e){"use strict";return e.extend({init:function(e,t){this._parent(),this._commandManager=e,this._ComponentsMap=t,this._listCompToAdd=[],this._listCompToRemove=[],this._type="VCXCmdChangeComponent"},GetType:function(){return this._type},GetTitle:function(){return"Change component"},RemoveComponents:function(e){this._listCompToRemove=this._listCompToRemove.concat(e)},AddComponents:function(e){this._listCompToAdd=this._listCompToAdd.concat(e)},Do:function(){for(var e=0;e<this._listCompToAdd.length;e++){(n=this._listCompToAdd[e])&&this._ComponentsMap.AddComponent(n)}for(var t=0;t<this._listCompToRemove.length;t++){var n;if(n=this._listCompToRemove[t]){var i=this._listCompToRemove[t].GetID();this._ComponentsMap.RemoveComponent(i)}}},Invert:function(){var e=this._listCompToAdd;this._listCompToAdd=this._listCompToRemove,this._listCompToRemove=e}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeModifiable",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],function(e,t,n){"use strict";return t.extend({init:function(e){this._parent(),this._scenarioManager=e,this._modTracks={},this._styles={},this._neutrals=new n,this._listModToAdd=[],this._listModToRemove=[],this._bLockEvents=!1,this._type="VCXCmdChangeModifiable"},GetType:function(){return this._type},GetTitle:function(){return"Change modifiable"},RemoveModifiables:function(e){this._listModToRemove=this._listModToRemove.concat(e)},AddModifiables:function(e){this._listModToAdd=this._listModToAdd.concat(e)},Do:function(){for(var t=this._scenarioManager.ModifiableServer,n=this._scenarioManager.GetScenarios(),i=0;i<this._listModToAdd.length;i++){var a=this._listModToAdd[i];if(d=a.GetHashing()){var o=this._modTracks[d];if(o)for(var r in o)if(o.hasOwnProperty(r)){var s=o[r];this._scenarioManager.AddObjectAnimation(this._listModToAdd[i],n[r],s)}if(this._styles[d]){const e=a.QueryInterface("VCXIStylesHolder");e&&e.SetStyle(this._styles[d])}}t.AddModifiable(a);var c=this._neutrals.GetPropertySet(a.GetHashing());c&&this._scenarioManager.AddNeutrals(a,c)}for(var h=0;h<this._listModToRemove.length;h++){var _=this._listModToRemove[h];const e=_.QueryInterface("VCXIStylesHolder");e&&e.SetStyle("");var d=_.GetHashing(),C=this._scenarioManager.GetScenarios();for(var l in C)if(C.hasOwnProperty(l)){var m=C[l];this._scenarioManager.RemoveObjectAnimation(d,m)}this._scenarioManager.RemoveModifiableFromRestoreSet(d),t.RemoveModifiable(d),this._scenarioManager.RemoveNeutrals(d)}this._bLockEvents||(e.publish({event:"VCX_MODIFIABLE_CHANGED"}),e.publish({event:"VCX_KEYS_CHANGED"}))},Invert:function(){var e=this._listModToAdd;this._listModToAdd=this._listModToRemove,this._listModToRemove=e},SaveContext:function(){for(var e=this._scenarioManager.GetScenarios(),t=0;t<this._listModToRemove.length;t++){var n=!1,i={},a=this._listModToRemove[t],o=a.GetHashing();for(var r in this._styles[o]=a._styleID,e)if(e.hasOwnProperty(r)){var s=e[r].GetObjectAnimation(o);s&&(i[r]=s,n=!0)}n&&(this._modTracks[o]=i);var c=this._scenarioManager.GetNeutrals(o);c&&this._neutrals.AddOrModifyPropertySet(o,c)}},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdApplyScenario",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(),this._scenarioManager=e,this._propMapForUndo=new t,this._scenarioForDo=null,this._viewForUndo=null,this._bDoNotApplyVis=!1,this._type="VCXCmdApplyScenario"},GetType:function(){return this._type},GetTitle:function(){return"Apply scenario"},ApplyScenario:function(e,t,n){this._scenarioForDo=e,t&&(this._bDoNotApplyVis=t),n&&(this._viewForUndo=n)},Do:function(){var e=this._scenarioManager._experienceBase.getManager("VCXVisuManager");if(e&&(e.CameraControlsViewpoint=!0),this._scenarioManager.ApplyView(this._scenarioForDo,this._bDoNotApplyVis),e&&(e.CameraControlsViewpoint=!1),this._scenarioForDo.GetZoomFitAll()){var t=this._scenarioManager._experienceBase.getManager("VCXContextManager");t&&t.zoomFitAll()}},SaveContext:function(){this._viewForUndo||(this._viewForUndo=this._scenarioManager.CaptureCurrentView())},Redo:function(){this.Do()},Undo:function(){if(this._viewForUndo){var e=this._scenarioManager._experienceBase.getManager("VCXVisuManager");e&&(e.CameraControlsViewpoint=!0),this._scenarioManager.ApplyView(this._viewForUndo),e&&(e.CameraControlsViewpoint=!1)}}})}),define("DS/VCXWebKernelCommands/VCXCmdChangePropertyMap",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet"],function(e,t,n,i){"use strict";return e.extend({init:function(){this._parent(),this._keysForDo=[],this._keysForUndo=[],this._type="VCXCmdChangePropertyMap"},GetType:function(){return this._type},GetTitle:function(){return"Change property map"},Do:function(){for(var e=0;e<this._keysForDo.length;e++){var a=this._keysForDo[e],o=a.propertyMap.GetPropertySet(a.modifiable.GetHashing());if(o||a.value&&(o=new i,a.propertyMap.AddOrModifyPropertySet(a.modifiable.GetHashing(),o)),o)if(r=o.GetProperty(a.propertyName))a.value?r.SetPropertyValue(a.value.Clone()):(o.RemoveProperty(a.propertyName),0===o.GetPropertyNumber()&&a.propertyMap.RemovePropertySet(a.modifiable.GetHashing()));else if(a.value){let e=0;a.behaviorType&&(e=a.behaviorType);var r=new t(new n(a.propertyName,e),a.value.Clone());a.propertyMap.AddOrModifyProperty(a.modifiable.GetHashing(),r)}}},Invert:function(){var e=this._keysForDo;this._keysForDo=this._keysForUndo,this._keysForUndo=e},SaveContext:function(){for(var e=0;e<this._keysForDo.length;e++){var t=this._keysForDo[e],n=null,i=null,a=t.modifiable.GetHashing();if(a?i=t.propertyMap.GetPropertySet(a):console.log("VCXCmdChangePropertyMap: hashing is empty !"),i){var o=i.GetProperty(t.propertyName);o&&(n=o.GetPropertyValue().Clone())}var r={};r.propertyMap=t.propertyMap,r.modifiable=t.modifiable,r.propertyName=t.propertyName,r.value=n,this._keysForUndo.push(r)}},ChangeProperty:function(e,t,n,i,a){var o={};o.propertyMap=e,o.modifiable=t,o.propertyName=n,a&&(o.behaviorType=a),i&&(o.value=i.Clone()),this._keysForDo.push(o)}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties",["DS/VCXWebKernelCommands/VCXCmdChangePropertyMap"],function(e){"use strict";return e.extend({init:function(e){this.neutrals=e._keyframer._Neutrals,this._parent(),this._type="VCXCmdChangeNeutrals"},GetType:function(){return this._type},GetTitle:function(){return"Change neutral properties"},ChangeProperty:function(e,t,n,i){this._parent(this.neutrals,e,t,n,i)},CaptureNeutralProperties:function(e){var t=e.GetProperties();if(t)for(var n in t._map)if(t._map.hasOwnProperty(n)){var i=t.GetProperty(n);i&&this.ChangeProperty(e,n,i.GetPropertyValue())}}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeLinkedProperties",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],function(e,t,n){"use strict";return t.extend({init:function(e,t,n){this._linkedPropertyManager=e,this._scenarioManager=t,this._commandManager=n,this._parent(),this._linksToAdd=[],this._linksToRemove=[],this._type="VCXCmdChangeLinkedProperties"},GetType:function(){return this._type},GetTitle:function(){return"Modify properties links"},Do:function(){if(this._linksToRemove.length>0){for(var t=0;t<this._linksToRemove.length;t++){this._linksToRemove[t].converter=this._linkedPropertyManager.RemoveLink(this._linksToRemove[t].inID,this._linksToRemove[t].inProp,this._linksToRemove[t].outID,this._linksToRemove[t].outProp);var i=this._scenarioManager._keyframer._Neutrals;if(s=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._linksToRemove[t].outID))if(c=s.QueryInterface("VCXIModifiable")){var a=i.GetProperty(c.GetHashing(),this._linksToRemove[t].outProp);if(a){var o=a.GetPropertyValue();c.OnChangeProperty(this._linksToRemove[t].outProp,o)}this._scenarioManager.UpdateProperties(c.GetHashing(),this._linksToRemove[t].outProp),c.OnChangePropertiesEnd()}}e.publish({event:"VCX_LINKS_REMOVED"})}if(this._linksToAdd.length>0){var r=new n(this._scenarioManager);for(i=this._scenarioManager._keyframer._Neutrals,t=0;t<this._linksToAdd.length;t++){var s,c;if(this._linkedPropertyManager.AddLink(this._linksToAdd[t].inID,this._linksToAdd[t].inProp,this._linksToAdd[t].outID,this._linksToAdd[t].outProp,this._linksToAdd[t].converter),s=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._linksToAdd[t].outID))if(c=s.QueryInterface("VCXIModifiable"))if(i.GetProperty(c.GetHashing(),this._linksToAdd[t].outProp));else{var h=c.GetProperty(this._linksToAdd[t].outProp);h&&r.ChangeProperty(c,this._linksToAdd[t].outProp,h.GetPropertyValue())}}this._commandManager.Push(r),e.publish({event:"VCX_LINKS_ADDED"})}this._linkedPropertyManager.UpdateProperties(),e.publish({event:"VCX_PROPERTIES_CHANGED"})},Invert:function(){var e=this._linksToAdd;this._linksToAdd=this._linksToRemove,this._linksToRemove=e},AddLink:function(e,t,n,i,a){var o={inID:e,inProp:t,outID:n,outProp:i,converter:a};this._linksToAdd.push(o)},RemoveLink:function(e,t,n,i){var a={inID:e,inProp:t,outID:n,outProp:i};this._linksToRemove.push(a)},RemoveLinksFromPropertyName:function(e,t){var n=this._linkedPropertyManager.GetLinksFromPropertyName(e,t);this._linksToRemove=this._linksToRemove.concat(n)},RemoveLinks:function(e){this._linksToRemove=this._linksToRemove.concat(e)}})}),define("DS/VCXWebKernelCommands/VCXCmdReplaceScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebExperienceLoader/VCXExperienceSaverBase"],function(e,t,n,i,a){"use strict";return t.extend({init:function(e){this._parent(),this._scenarioManager=e,this._scenarioToModify=null,this._dataForDo={},this._dataForUndo={},this._bLockEvents=!1,this._type="VCXCmdReplaceScenario"},GetType:function(){return this._type},GetTitle:function(){return"Replace scenario"},ReplaceScenario:function(e,t){this._scenarioToModify=e;var n=t.QueryInterface("VCXIModifiable"),i=this._scenarioManager.GetNeutrals(n.GetHashing());this._dataForDo.neutrals=i.Clone(),this._dataForDo.scenario=t.Clone()},Do:function(){var t=this._scenarioToModify.QueryInterface("VCXIModifiable");this._scenarioManager.RemoveNeutrals(t.GetHashing()),this._scenarioManager.AddNeutrals(t,this._dataForDo.neutrals.Clone()),this._dataForDo.scenario.Clone(this._scenarioToModify);var n=this._scenarioManager._experienceBase,o=this._scenarioManager._experienceBase.getManager("VCXEWSManager"),r=n.getManager("VCXContextManager").IsLocalMode();if(o&&!r){var s=n.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable"),c=new i(n.getManager("VCXScenarioManager"));c.CaptureNeutralProperties(s),c.Do();var h=this._scenarioToModify.GetID(),_="",d=n.getManager("VCXSequenceManager").GetSequenceFromScenarioId(h);d&&(_=d.GetID());var C=new a,l=C._ScenarioToJson(n,this._scenarioToModify),m=C._VisibilityToJson(this._scenarioToModify.GetVisibility(),n);l.visibility=m;var u=[];u.push(l);var p={};p.listScenarios=u;var f=JSON.stringify(p,null,4),v={};v.neutrals=C._NeutralsToJson(n);var g=JSON.stringify(v,null,4),S=o.UpdateState(h,_,g,f).then(function(){console.log("--------\x3e vcxEWSManager.UpdateState DONE")}),V=this._scenarioToModify.QueryInterface("VCXIReadiness");V&&(V.clearPromises(),V.registerPromise(S),console.log("--------\x3e registerPromise for vcxEWSManager.UpdateState................"))}this._bLockEvents||e.publish({event:"VCX_SCENARIO_REPLACED",data:this._scenarioToModify})},SaveContext:function(){var e=this._scenarioToModify.QueryInterface("VCXIModifiable"),t=this._scenarioManager.GetNeutrals(e.GetHashing());this._dataForUndo.neutrals=t.Clone(),this._dataForUndo.scenario=this._scenarioToModify.Clone()},Invert:function(){var e=this._dataForDo;this._dataForDo=this._dataForUndo,this._dataForUndo=e},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdPlayScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdApplyScenario"],function(e,t,n){"use strict";return t.extend({init:function(e,t,n){this._parent(),this._scenarioManager=e,this._componentsMap=t,this._commandManager=n,this._scenarioToPlay=null,this._type="VCXCmdPlayScenario",this._startFrame=0,this._bLockEvents=!1,this._playCurrent=!1,this._bDoNotApplyVis=!1,this._bIsBounce=!1,this._bIsLoop=!1,this._bIsReverse=!1,this._speed=1},GetType:function(){return this._type},GetTitle:function(){return"Play Scenario"},PlayScenario:function(e,t,n,i,a,o,r){this._scenarioToPlay=e,void 0!==t?this._startFrame=t:-1===t&&(this._startFrame=e.GetCurrentFrame()),n&&(this._bDoNotApplyVis=n),void 0!==a&&(this._bIsBounce=a),void 0!==i&&(this._bIsLoop=i),void 0!==o&&(this._bIsReverse=o),void 0!==r&&(this._speed=Math.round(r))},Do:function(){if(this._scenarioToPlay){var t=this,i=this._scenarioManager.PlayScenario(this._scenarioToPlay,this._startFrame,this._bIsLoop,this._bIsBounce,this._bIsReverse,this._speed);i&&this._scenarioToPlay.SetID(i);var a=new n(this._scenarioManager,this._commandManager);a.ApplyScenario(this._scenarioToPlay,this._bDoNotApplyVis),this._commandManager.Do(a),this._playEndEvent=e.subscribe({event:"VCX_SCENARIO_PLAY_END_REACHED"},function(n){t._scenarioToPlay.GetID()===n&&(e.unsubscribe(t._playEndEvent),e.publish({event:"VCX_END_PLAY_SCENARIO",data:n}),t._callback&&(t._callback(t._parameter),t._scenarioManager.SetCallback(null,null)))})}else e.publish({event:"VCX_END_PLAY_SCENARIO"})},StopPlayingScenario:function(){e.unsubscribe(this._playEndEvent),this._scenarioManager.StopPlayingScenario(this._scenarioToPlay.GetID()),this._callback&&(this._callback(this._parameter),this._scenarioManager.SetCallback(null,null))},Undo:function(){console.log("apply undo VCXCmdPlayScenario"),this.StopPlayingScenario()},Redo:function(){this.Do()},SaveContext:function(){},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeTimePos",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand"],function(e,t){"use strict";return t.extend({init:function(e){this._parent(),this._scenarioManager=e,this._timePosForUndo=-1,this._timePosForDo=-1,this._scenarioForDoUndo=null,this._bLockEvents=!1,this._type="VCXCmdChangeTimePos",this._viewForUndo=null},GetType:function(){return this._type},GetTitle:function(){return"Change time position"},Do:function(){var t=!1,n=this._scenarioManager._experienceBase.getManager("VCXVisuManager");n&&(t=n.CameraControlsViewpoint,n.CameraControlsViewpoint=!0);var i=this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._scenarioForDoUndo);i&&i.SetCurrentFrame(this._timePosForDo);this._scenarioManager._experienceBase.getManager("VCXCommandManager");if(this._scenarioManager.UpdateProperties(),this._bLockEvents);else{e.publish({event:"VCX_TIMEPOS_CHANGED",data:this._timePosForDo}),e.publish({event:"VCX_PROPERTIES_CHANGED"});var a=this._scenarioManager._experienceBase.getManager("VCXExperience");a&&a.SetVolatileNotSaved(!1)}n&&(n.CameraControlsViewpoint=t)},Undo:function(){this._scenarioManager._experienceBase.ComponentsMap.GetComponentFromID(this._scenarioForDoUndo).SetCurrentFrame(this._timePosForUndo),this._scenarioManager.ApplyView(this._viewForUndo,!0),this._bLockEvents||(e.publish({event:"VCX_TIMEPOS_CHANGED",data:this._timePosForUndo}),e.publish({event:"VCX_PROPERTIES_CHANGED"}))},SaveContext:function(){this._timePosForUndo=this._scenarioManager.GetCurrentFrame(),null===this._viewForUndo&&(this._viewForUndo=this._scenarioManager.CaptureCurrentView())},ChangeTimePos:function(e,t){this._scenarioForDoUndo=this._scenarioManager.GetCurrentScenario(),this._timePosForDo=e,t&&(this._timePosForUndo=t)},SetViewForUndo:function(e){this._viewForUndo=e},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdGoToScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeTimePos","DS/VCXWebKernelCommands/VCXCmdApplyScenario"],function(e,t,n,i){"use strict";return t.extend({init:function(e,t){this._parent(),this._scenarioManager=e,this._commandManager=t,this._bLockEvents=!1,this._bSetActiveScenario=!0,this._cmdApplyScenario=null,this._type="VCXCmdGoToScenario",this._viewForUndo=null},GetType:function(){return this._type},GetTitle:function(){return"Go to scenario"},GoToScenario:function(e,t){this._scenarioIdForDo=e,this._timePosForUndo=this._scenarioManager.GetCurrentFrame();this._scenarioManager._Scenarios[e];t&&(this._viewForUndo=t)},Do:function(){if(this._bSetActiveScenario){this._scenarioManager.SetCurrentScenario(this._scenarioIdForDo);var t=new n(this._scenarioManager);t.ChangeTimePos(0),t.SetLockEvents(this._bLockEvents),t.SetViewForUndo(this._viewForUndo),this._commandManager.Push(t);var a=this._scenarioManager._Scenarios[this._scenarioIdForDo];if(a){var o=new i(this._scenarioManager,this._commandManager);o.ApplyScenario(a,null,this._viewForUndo),this._commandManager.Push(o),this._bLockEvents||e.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:a})}else console.log("VCXCmdGoToScenario : scenario NOT found !")}},SaveContext:function(){this._bSetActiveScenario&&(this._scenarioIdForUndo=this._scenarioManager.GetCurrentScenario(),""===this._scenarioIdForUndo&&console.log("No current scenario !!"))},Redo:function(){if(this._bLockEvents);else if(this._bSetActiveScenario){this._scenarioManager.SetCurrentScenario(this._scenarioIdForDo);var t=this._scenarioManager._Scenarios[this._scenarioIdForDo];e.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:t})}},Undo:function(){if(this._bLockEvents);else if(this._bSetActiveScenario&&this._scenarioIdForUndo){this._scenarioManager.SetCurrentScenario(this._scenarioIdForUndo);var t=this._scenarioManager._Scenarios[this._scenarioIdForUndo];e.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:t})}},SetLockEvents:function(e){this._bLockEvents=e},SetActiveScenario:function(e){this._bSetActiveScenario=e}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeScenario",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent"],function(e,t,n,i){"use strict";return t.extend({init:function(e,t,n){this._parent(),this._scenarioManager=e,this._commandManager=t,this._ComponentsMap=n,this._scenariosToAdd=[],this._scenariosToRemove=[],this._bLockEvents=!1,this._type="VCXCmdChangeScenario"},GetType:function(){return this._type},GetTitle:function(){return"Change scenario"},AddScenarios:function(e){this._scenariosToAdd=this._scenariosToAdd.concat(e)},RemoveScenarios:function(e){this._scenariosToRemove=this._scenariosToRemove.concat(e)},Do:function(){var t=this,a=new n(this._scenarioManager),o=new i(this._commandManager,this._ComponentsMap);if(this._scenariosToAdd.forEach(function(e){o.AddComponents(e),a.AddModifiables(e.QueryInterface("VCXIModifiable"))}),this._scenariosToRemove.forEach(function(e){o.RemoveComponents(e),a.RemoveModifiables(e.QueryInterface("VCXIModifiable"))}),this._commandManager.Push(o),this._commandManager.Push(a),this._scenariosToAdd.forEach(function(e){t._scenarioManager.AddScenario2(e)}),this._scenariosToRemove.forEach(function(e){t._scenarioManager.RemoveScenario(e.GetID())}),this._bLockEvents);else{var r={arrayToAdd:this._scenariosToAdd,arrayToRemove:this._scenariosToRemove};e.publish({event:"VCX_SCENARIOS_CHANGED",data:r})}},Undo:function(){var t=this;if(this._scenariosToAdd.forEach(function(e){t._scenarioManager.RemoveScenario(e.GetID())}),this._scenariosToRemove.forEach(function(e){t._scenarioManager.AddScenario2(e)}),this._bLockEvents);else{var n={arrayToAdd:this._scenariosToRemove,arrayToRemove:this._scenariosToAdd};e.publish({event:"VCX_SCENARIOS_CHANGED",data:n})}},Redo:function(){var t=this;if(this._scenariosToAdd.forEach(function(e){t._scenarioManager.AddScenario2(e)}),this._scenariosToRemove.forEach(function(e){t._scenarioManager.RemoveScenario(e.GetID())}),this._bLockEvents);else{var n={arrayToAdd:this._scenariosToAdd,arrayToRemove:this._scenariosToRemove};e.publish({event:"VCX_SCENARIOS_CHANGED",data:n})}},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdPlayScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXKeyFramer/VCXObjectAnimation","DS/VCXWebTracks/VCXTrack","DS/VCXWebTracks/VCXKey","DS/VCXWebTracks/VCXEasing","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n,i,a,o,r,s,c,h,_){"use strict";return t.extend({init:function(e,t,n){this._parent(),this._scenarioManager=e,this._componentsMap=t,this._commandManager=n,this._scenarioForDo=null,this._scenarioTransition=null,this._wuxEventScenarioPlayed=null,this._bSetActiveScenario=!0,this._bLockEvents=!1,this._transitionTime=null,this._type="VCXCmdGoToScenarioWithInterpolation"},GetType:function(){return this._type},GetTitle:function(){return"Go To Scenario With Interpolation"},SetTransitionTime:function(e){this._transitionTime=e},Do:function(){var t=this._scenarioTransition.GetMaxFrame(),a=this._scenarioManager.GetTransitionTime();this._transitionTime&&(a=this._transitionTime),this._bLockEvents||e.publish({event:"VCX_BEGIN_TRANSITION",data:{maxframe:a/1e3,scenario:this._scenarioForDo}});var o=null;this._bSetActiveScenario&&((o=new n(this._scenarioManager,this._commandManager)).GoToScenario(this._scenarioForDo.GetID(),this._viewForUndo),o.SetActiveScenario(this._bSetActiveScenario));var r=this._scenarioManager._experienceBase.getManager("VCXVisuManager");r&&r.setTransitionMode(!0);var s=this._scenarioManager.GetFPS();if(this._scenarioManager.SetFPS(50),0!=a){var c=t/(a/1e3);this._scenarioManager.SetFPS(c)}var h=this._scenarioManager.GetInterFramesMax();this._scenarioManager.SetInterFramesMax(-1);var _=new i(this._scenarioManager,this._componentsMap,this._commandManager);_.PlayScenario(this._scenarioTransition),this._commandManager.Do(_);var d=function(){this._scenarioManager.SetInterFramesMax(h),this._scenarioManager.SetFPS(s),e.unsubscribe(this._wuxEventScenarioPlayed),o&&(o.SetLinkedCmd(!0),this._commandManager.Push(o)),r&&r.setTransitionMode(!1),this._scenarioManager._experienceBase.getManager("VCXExperience").getAllActorsReadiness().then(function(){this._bLockEvents||e.publish({event:"VCX_END_TRANSITION",data:this._scenarioForDo}),this._callback&&this._callback(this._parameter)}.bind(this))}.bind(this);this._wuxEventScenarioPlayed=e.subscribe({event:"VCX_END_PLAY_SCENARIO"},function(e){"VCX_Scenario_Transition"===e&&d()})},Undo:function(){},Redo:function(){},SaveContext:function(){this._viewForUndo=this._scenarioManager.CaptureCurrentView()},BuildTransitionTo:function(e){this._scenarioForDo=e,this._scenarioTransition=this.BuildScenarioForTransition(this._scenarioForDo),this._scenarioTransition.SetID("VCX_Scenario_Transition")},BuildScenarioForTransition:function(t){console.time("BuildScenarioForTransition"),this._bLockEvents||e.publish({event:"VCX_PREPARE_TRANSITION",data:{scenario:t}});var n=this._scenarioManager._experienceBase,i=n.Factory.BuildComponent("VCXScenario");i.SetPersistency(2),i.SetApplyNeutralAtGoToScenario(!1),i.SetIsTransition(!0);var d=new a,C={propMapDiffNeutrals:d},l=this._scenarioManager.CaptureCurrentView(C),m=n.getManager("VCXVisuManager");if(m&&(m.CameraControlsViewpoint=!0),_.lockVisibilityOpacity=!0,this._scenarioManager.ApplyView(t),_.lockVisibilityOpacity=!1,t.GetZoomFitAll()){var u=this._scenarioManager._experienceBase.getManager("VCXContextManager");u&&u.zoomFitAll()}m&&(m.CameraControlsViewpoint=!1);var p=new a;for(var f in this._scenarioManager.CaptureDiffOfNeutrals(p,!0),d._map)if(d._map.hasOwnProperty(f)){var v=this._scenarioManager.ModifiableServer.GetModifiableFromHashing(f),g=d.GetPropertySet(f);for(var S in g._map)if(g._map.hasOwnProperty(S)){if(p.GetProperty(f,S))continue;var V=v.GetProperty(S);V&&p.AddOrModifyProperty(f,V)}}_.lockVisibilityOpacity=!0,this._scenarioManager.ApplyView(l),_.lockVisibilityOpacity=!1;var M=i.GetVisibility(),y=!1,b=null;if(m&&(b=m.getActiveViewport()),b){var T=b.QueryInterface("VCXIModifiable"),D=T.GetProperties(!1),X=p.GetPropertySet(T.GetHashing());X&&D&&(D.IsEqualTo(X,{intersection:!0})||(y=!0))}for(var P in p._map)if(p._map.hasOwnProperty(P)){var A=this._scenarioManager.ModifiableServer.GetModifiableFromHashing(P),G=A.GetObject(),I=A.GetRequiredPropertiesForTransition(),k=p.GetPropertySet(P);for(var S in k._map)if(k._map.hasOwnProperty(S)){var E=A.GetProperty(S);if(E){var R=E.GetPropertyValue(),F=k.GetProperty(S).GetPropertyValue();if(!R.IsEqualTo(F)||I&&I.hasOwnProperty(S)){if(!0===R._bUndefined)continue;if((Z=i.GetObjectAnimation(P))||(Z=new r,void 0===P&&(this._scenarioManager.ModifiableServer.AddModifiable(A),console.log("hashing is undefined")),i.AddObjectAnimation(P,Z)),(H=Z.GetTrack(S))||(H=new s,Z.AddTrack(S,H)),(G.IsKindOf("VCXWebComponentCamera")||G.IsKindOf("CXPCameraActor_Spec")||G.IsKindOf("VCXViewport_Spec"))&&y){H.easing=h.easeInOutPower3,($=new c).SetFrame(0),$.SetValue(R),H.AddKey($),(B=new c).SetFrame(60),B.SetValue(F),H.AddKey(B)}else{var w=R.GetType();if("VCXPropertyValueLocation"!==w&&"VCXPropertyValueFrame"!==w&&"VCXPropertyValueFloat"!==w&&"VCXPropertyValuePoint2D"!==w&&"VCXPropertyValueVector"!==w||(H.easing=h.easeInOutPower3),($=new c).SetFrame(0),$.SetValue(R),(B=new c).SetValue(F),!G.IsKindOf("CXPCameraActor_Spec"))if(J=A.QueryInterface("VCXIVisibility"))J.GetVisibility()===_.EVisState.Hidden&&$.SetValue(F);if(O=t.GetVisibility()){var x=O.IsVisibleWithParents(A.GetObject()),L=O.GetMode(),N=0;(1===x||-1===x&&2===L||-1===x&&0===L||0===x&&1===L)&&(N=1),0===N&&B.SetValue(R)}if(y)(ee=new c).SetFrame(60),ee.SetValue($.GetValue()),H.AddKey(ee),B.SetFrame(120);else B.SetFrame(60);H.AddKey(B),H.AddKey($)}}}}}var O,q=t;if(q&&(O=q.GetVisibility())){for(var W=n.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),K=(L=O.GetMode(),0);K<W.length;K++){if(z=W[K]){if(0!==z.QueryInterface("VCXIModelNavigable").getChildren().length)continue;var U=1;N=1;if(J=z.QueryInterface("VCXIVisibility")){N=U=J.GetVisibility()!==_.EVisState.Hidden?1:0;x=O.IsVisibleWithParents(z);if(0===L?1===x?N=1:0===x&&(N=0):1===L?N=1===x?1:0:2===L&&(N=0===x?0:1),U!==N){M.AddVisible(z),(Y=z.QueryInterface("VCXIModifiable")).GetHashing()||this._scenarioManager.ModifiableServer.AddModifiable(Y);var H=new s;null===(Z=i.GetObjectAnimation(Y.GetHashing()))&&(Z=new r,i.AddObjectAnimation(Y.GetHashing(),Z)),Z.AddTrack("Actor.Visibility.Opacity",H),($=new c).SetFrame(0),(R=new o).SetValue(U),$.SetValue(R),(ee=new c).SetValue($.GetValue());var B=new c;(F=new o).SetValue(N),B.SetValue(F),1===U&&0===N?y?(ee.SetFrame(60),B.SetFrame(75)):(ee.SetFrame(0),B.SetFrame(15)):0===U&&1===N?y?(ee.SetFrame(105),B.SetFrame(120)):(ee.SetFrame(45),B.SetFrame(60)):(ee.SetFrame(0),B.SetFrame(135)),H.AddKey($),H.AddKey(ee),H.AddKey(B)}}}}var Q=n.getManager("VCXDressupManager").getDressups();for(var j in Q){var z;if(Q.hasOwnProperty(j))if(z=Q[j]){var J;U=1,N=1;if(J=z.QueryInterface("VCXIVisibility"))if(U=J.GetVisibility()!==_.EVisState.Hidden?1:0,O.FindVisibleCollab(z.GetID())>=0?N=1:(q.GetApplyNeutralAtGoToScenario()||q.GetIsTransition()||0===U)&&(N=0),0!==U||0!==N){var Y=z.QueryInterface("VCXIModifiable");M.AddVisibleCollab(z);var Z,$,ee;H=new s;null===(Z=i.GetObjectAnimation(Y.GetHashing()))&&(Z=new r,i.AddObjectAnimation(Y.GetHashing(),Z)),Z.AddTrack("Actor.Visibility.Opacity",H),($=new c).SetFrame(0),(R=new o).SetValue(U),$.SetValue(R),(ee=new c).SetValue($.GetValue());B=new c;(F=new o).SetValue(N),B.SetValue(F),1===U&&0===N?y?(ee.SetFrame(60),B.SetFrame(75)):(ee.SetFrame(0),B.SetFrame(15)):0===U&&1===N?y?(ee.SetFrame(120),B.SetFrame(135)):(ee.SetFrame(60),B.SetFrame(75)):(ee.SetFrame(0),B.SetFrame(135)),H.AddKey($),H.AddKey(ee),H.AddKey(B)}}}}return console.timeEnd("BuildScenarioForTransition"),i},SetActiveScenario:function(e){this._bSetActiveScenario=e},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeScenario","DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],function(e,t,n,i,a){"use strict";return t.extend({init:function(e,t,n){this._parent(),this._sequenceManager=e,this._commandManager=t,this._ComponentsMap=n,this._scenarioToAdd=null,this._scenarioToRemove=null,this._sequenceIDForAdd="",this._sequenceIDForRemove="",this._scenarioAddIdx=-1,this._scenarioRemoveIdx=-1,this._bPush=!1,this._bLockEvents=!1,this._bMove=!1,this._bIsLoading=!1},GetType:function(){return"VCXCmdChangeScenarioSequence"},GetTitle:function(){return"Change scenario sequence"},MoveScenario:function(e,t,n){this._bMove=!0;var i=this._ComponentsMap.GetComponentFromID(e);i&&(this.RemoveScenarioFromSequence(i),void 0!==n?this.InsertScenarioInSequence(i,t,n):this.PushScenarioInSequence(i,t))},PushScenarioInSequence:function(e,t){this._bPush=!0,this._scenarioToAdd=e;var n=null,i=this._sequenceManager.GetListSequences();i[0]&&(n=i[0]);var a=this._sequenceManager.GetSequenceFromId(t);if(a)this._sequenceIDForAdd=t;else{if(!n)return;this._sequenceIDForAdd=n.GetID(),a=n}var o=a.GetListScenariosId().length;this._scenarioAddIdx=o},InsertScenarioInSequence:function(e,t,n){this._scenarioToAdd=e,this._sequenceIDForAdd=t,this._scenarioAddIdx=n},RemoveScenarioFromSequence:function(e){this._scenarioToRemove=e},Do:function(){var t={};if(this._scenarioToAdd)if(t={sequenceIdForAdd:this._sequenceIDForAdd,scenarioToAdd:this._scenarioToAdd,bLinked:this._bLinkedCmd,scenarioAddIdx:this._scenarioAddIdx},this._bMove)this._sequenceManager.MoveScenarioInSequence(this._scenarioToAdd.GetID(),this._sequenceIDForAdd,this._scenarioAddIdx);else{(V=new n(this._sequenceManager._scenarioManager,this._commandManager,this._ComponentsMap)).AddScenarios(this._scenarioToAdd),this._commandManager.Push(V);var o=this._scenarioToAdd.GetID();if(this._bPush?this._sequenceManager.PushScenarioInSequence(o,this._sequenceIDForAdd):this._sequenceManager.InsertScenarioAtIndex(o,this._sequenceIDForAdd,this._scenarioAddIdx),!1===this._bIsLoading){var r=this._sequenceManager._experienceBase.getManager("VCXEWSManager"),s=this._sequenceManager._experienceBase.getManager("VCXContextManager").IsLocalMode();if(r&&!s){var c=this._sequenceManager._experienceBase.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable"),h=new a(this._sequenceManager._experienceBase.getManager("VCXScenarioManager"));h.CaptureNeutralProperties(c),h.Do();var _=o,d=this._sequenceIDForAdd,C=new i,l=C._ScenarioToJson(this._sequenceManager._experienceBase,this._scenarioToAdd),m=C._VisibilityToJson(this._scenarioToAdd.GetVisibility(),this._sequenceManager._experienceBase);l.visibility=m;var u=[];u.push(l);var p={};p.listScenarios=u;var f=JSON.stringify(p,null,4),v={};v.neutrals=C._NeutralsToJson(this._sequenceManager._experienceBase);var g=JSON.stringify(v,null,4);r.CreateState(g,d,_,f)}}}if(this._scenarioToRemove){var S={sequenceIdForRemove:this._sequenceIDForRemove,scenarioToRemove:this._scenarioToRemove,scenarioRemovedIdx:this._scenarioRemoveIdx,bLinked:this._bLinkedCmd};o=this._scenarioToRemove.GetID();if(this._bMove)Object.assign(t,S);else{var V;t=S,(V=new n(this._sequenceManager._scenarioManager,this._commandManager,this._ComponentsMap)).RemoveScenarios(this._scenarioToRemove),this._commandManager.Push(V);var M=this._sequenceManager.GetSequenceFromId(this._sequenceIDForRemove);if(M.RemoveScenario(o),!1===this._bIsLoading){r=this._sequenceManager._experienceBase.getManager("VCXEWSManager"),s=this._sequenceManager._experienceBase.getManager("VCXContextManager").IsLocalMode();if(r&&!s){var y=this;r.DeleteState(o,M.GetID()).then(function(){var e=y._sequenceManager._experienceBase.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable"),t=new a(y._sequenceManager._experienceBase.getManager("VCXScenarioManager"));t.CaptureNeutralProperties(e),t.Do();var n=new i,o={};o.neutrals=n._NeutralsToJson(y._sequenceManager._experienceBase);var s=JSON.stringify(o,null,4);r.CreateState(s,"","",""),console.log("DeleteState DONE")})}}}}this._bLockEvents||(this._bMove?e.publish({event:"VCX_SCENARIO_MOVED",data:t}):e.publish({event:"VCX_SCENARIO_CHANGED",data:t}))},SaveContext:function(){if(this._scenarioToRemove){var e=this._sequenceManager.GetSequenceFromScenarioId(this._scenarioToRemove.GetID());this._sequenceIDForRemove=e.GetID(),this._scenarioRemoveIdx=e.GetIndexOfScenario(this._scenarioToRemove.GetID())}},Invert:function(){var e=this._scenarioToAdd;this._scenarioToAdd=this._scenarioToRemove,this._scenarioToRemove=e;var t=this._sequenceIDForAdd;this._sequenceIDForAdd=this._sequenceIDForRemove,this._sequenceIDForRemove=t;var n=this._scenarioAddIdx;this._scenarioAddIdx=this._scenarioRemoveIdx,this._scenarioRemoveIdx=n},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeSequence",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence"],function(e,t,n,i,a){"use strict";return t.extend({init:function(e,t,n){this._parent(),this._sequenceManager=e,this._commandManager=t,this._ComponentsMap=n,this._sequenceToAdd=null,this._sequenceToRemove=null,this._scenariosToRemove=[],this._prevSequence=null,this._bPush=!1,this._bLockEvents=!1,this._bIsLoading=!1},GetType:function(){return"VCXCmdChangeSequence"},GetTitle:function(){return"Change sequence"},PushSequence:function(e){this._bPush=!0,this._sequenceToAdd=e},InsertSequence:function(e,t){this._sequenceToAdd=e,this._prevSequence=t},RemoveSequence:function(e){this._sequenceToRemove=e},Do:function(){var t=new n(this._sequenceManager._scenarioManager),o=new i(this._commandManager,this._ComponentsMap);if(this._sequenceToAdd?(o.AddComponents(this._sequenceToAdd),t.AddModifiables(this._sequenceToAdd.QueryInterface("VCXIModifiable"))):this._sequenceToRemove&&(o.RemoveComponents(this._sequenceToRemove),t.RemoveModifiables(this._sequenceToRemove.QueryInterface("VCXIModifiable"))),this._commandManager.Push(o),this._commandManager.Push(t),this._sequenceToAdd){if(!this._bIsLoading){var r=this._sequenceManager._experienceBase.getManager("VCXEWSManager");if(r){var s=this._sequenceToAdd.GetName(),c=this._sequenceToAdd.GetID();r.CreateStateCollection(s,c)}}this._bPush?this._sequenceManager.PushSequence(this._sequenceToAdd):this._sequenceManager.InsertSequenceAfter(this._sequenceToAdd,this._prevSequence);for(var h=0;h<this._scenariosToRemove.length;h++){var _=this._scenariosToRemove[h];(d=new a(this._sequenceManager,this._commandManager,this._ComponentsMap)).PushScenarioInSequence(_,this._sequenceToAdd.GetID()),this._commandManager.Do(d)}}else if(this._sequenceToRemove){for(this._sequenceManager._scenarioManager.GetScenarios(),this._sequenceToRemove.GetListScenariosId(),h=0;h<this._scenariosToRemove.length;h++){var d;_=this._scenariosToRemove[h];(d=new a(this._sequenceManager,this._commandManager,this._ComponentsMap)).RemoveScenarioFromSequence(_,this._sequenceToRemove.GetID()),this._commandManager.Do(d),_=this._scenariosToRemove.pop()}this._sequenceManager.RemoveSequence(this._sequenceToRemove.GetID())}if(this._bLockEvents);else{var C={previousSeqIndex:this._sequenceManager.GetIndexOfSequence(this._prevSequence),sequenceToAdd:this._sequenceToAdd,sequenceToRemove:this._sequenceToRemove};e.publish({event:"VCX_SEQUENCE_CHANGED",data:C})}},SaveContext:function(){var e=this._sequenceManager._scenarioManager.GetScenarios();if(this._sequenceToAdd){if(this._bPush){var t=this._sequenceManager.GetListSequences(),n=t.length-1;this._prevSequence=t[n]}}else if(this._sequenceToRemove){this._prevSequence=this._sequenceManager.GetPreviousSequence(this._sequenceToRemove);for(var i=this._sequenceToRemove.GetListScenariosId(),a=i.length-1;a>=0;a--){var o=e[i[a]];this._scenariosToRemove.push(o)}}},Invert:function(){var e=this._sequenceToAdd;this._sequenceToAdd=this._sequenceToRemove,this._sequenceToRemove=e},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeKeys",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebTracks/VCXKey","DS/VCXKeyFramer/VCXObjectAnimation","DS/VCXWebTracks/VCXTrack","DS/WebRBTree/WebRBIterator"],function(e,t,n,i,a,o){"use strict";return t.extend({init:function(e){this._parent(),this._scenarioManager=e,this._keysForDo=[],this._keysForUndo=[],this._bLockEvents=!1,this._bLockUpdateProperties=!1,this._bCloneValues=!0,this._type="VCXCmdChangeKeys"},GetType:function(){return this._type},GetTitle:function(){return"Change keys"},Do:function(){for(var t={setModifiablesTrackRemoved:{},setModifiablesTrackModified:{}},o=0;o<this._keysForDo.length;o++){var r=this._keysForDo[o],s=r.scenario.GetObjectAnimation(r.modifiable.GetHashing());if(s||r.value&&(s=new i,r.scenario.AddObjectAnimation(r.modifiable.GetHashing(),s)),s){var c=s.GetTrack(r.propertyName);if(c||r.value&&(c=new a,s.AddTrack(r.propertyName,c)),c){if(t.setModifiablesTrackModified[r.modifiable.GetHashing()]=!0,r.value){var h=new n;h.SetFrame(r.frame),h.SetEasing(r.easing),this._bCloneValues?h.SetValue(r.value.Clone()):h.SetValue(r.value),c.AddKey(h)}else c.RemoveKey(r.frame),c.IsEmpty()&&(s.RemoveTrack(r.propertyName),t.setModifiablesTrackRemoved[r.modifiable.GetHashing()]=!0,0===s.GetTrackNumber()&&r.scenario.RemoveObjectAnimation(r.modifiable.GetHashing()));this._bLockUpdateProperties||this._scenarioManager.UpdateProperty(r.modifiable.GetHashing(),r.propertyName)}}}this._bLockEvents||(t.keysForDo=this._keysForDo,e.publish({event:"VCX_KEYS_CHANGED",data:t}),e.publish({event:"VCX_PROPERTIES_CHANGED"}))},Invert:function(){var e=this._keysForDo;this._keysForDo=this._keysForUndo,this._keysForUndo=e},SaveContext:function(){for(var e=0;e<this._keysForDo.length;e++){var t=this._keysForDo[e],n=null;t.modifiable.GetHashing()?n=t.scenario.GetObjectAnimation(t.modifiable.GetHashing()):console.log("VCXCmdChangeKey: hashing is empty !");var i=null;if(n){var a=n.GetTrack(t.propertyName);if(a){var o=a.GetKey(t.frame);o&&o.GetFrame()===t.frame&&(i=o.GetValue().Clone())}}var r={};r.scenario=t.scenario,r.modifiable=t.modifiable,r.propertyName=t.propertyName,r.frame=t.frame,r.value=i,this._keysForUndo.push(r)}},ChangeKey:function(e,t,n,i,a,o){if(e){var r={};r.scenario=e,r.modifiable=t,r.propertyName=n,r.frame=i,r.easing=o,a&&(this._bCloneValues?r.value=a.Clone():r.value=a),this._keysForDo.push(r)}},MoveKey:function(e,t,n,i,a){if(null!==t){var o=null,r=e.GetObjectAnimation(t.GetHashing());if(r){var s=r.GetTrack(n);if(s){var c=s.GetKey(i);c&&(o=c.GetValue())}}o&&(this.ChangeKey(e,t,n,i,null),this.ChangeKey(e,t,n,a,o))}},RemoveTracks:function(e,t,n){var i=e.GetObjectAnimation(t.GetHashing());if(i){n&&n.length>0||(n=[],i.GetListTrackNames(n));for(var a=0;a<n.length;a++){var r=n[a],s=i.GetTrack(r);if(s)for(var c=s._treekeys,h=new o(c),_=h.next();null!==_;)this.ChangeKey(e,t,r,_.GetFrame()),_=h.next()}}},SetLockEvents:function(e){this._bLockEvents=e},SetLockUpdateProperties:function(e){this._bLockUpdateProperties=e},SetCloneValues:function(e){this._bCloneValues=e}})}),define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdUpdateThumbnail"],function(e,t,n,i,a,o){"use strict";var r=e.extend({init:function(e,n,i){this._parent(),this.ImmediateThumbnail=!1,this._propertyMap=new t,this._scenarioManager=e,this._commandManager=n,this._bForceAutokey=i,this._bLockEvents=!1,this._type="VCXCmdChangePropertiesAutokey",this._bLockUpdateThumbnail=!1},GetType:function(){return this._type},GetTitle:function(){return"Change properties autokey"},Do:function(){var e=this._scenarioManager.GetCurrentFrame(),t=this._scenarioManager.GetAutoKey(),r=this._scenarioManager._keyframer._Neutrals,s=this._scenarioManager.GetCurrentScenario(),c=this._scenarioManager._Scenarios[s],h=new i(this._scenarioManager),_=new n,d=new a(this._scenarioManager);for(var C in this._propertyMap._map)if(this._propertyMap._map.hasOwnProperty(C)){var l=this._scenarioManager.ModifiableServer.GetModifiableFromHashing(C),m=this._propertyMap.GetPropertySet(C);for(var u in m._map)if(m._map.hasOwnProperty(u)){var p=m._map[u],f=p.GetPropertyInfo().GetBehaviorType(),v=p.GetPropertyInfo().IsPersistent();if(v)if(2===f)d.ChangeProperty(l,u,p.GetPropertyValue(),f);else if(r.GetProperty(C,u));else{var g=l.GetProperty(u);g&&d.ChangeProperty(l,u,g.GetPropertyValue(),g.GetPropertyInfo().GetBehaviorType())}if(_.ChangeProperty(l,p),v&&2!==f&&(t||this._bForceAutokey)){var S=e;1===f&&(S=0),c&&h.ChangeKey(c,l,u,S,p.GetPropertyValue())}}}if(this._bLockEvents&&(_.SetLockEvents(this._bLockEvents),h.SetLockEvents(this._bLockEvents)),0===e&&(t||this._bForceAutokey)&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&c&&!this._bLockUpdateThumbnail){var V=new o(this._scenarioManager._experienceBase,c,this.ImmediateThumbnail);this._commandManager.Push(V)}if(this._commandManager.Push(_),this._commandManager.Push(h),this._commandManager.Push(d),0===e&&(t||this._bForceAutokey)&&this._scenarioManager._experienceBase.getManager("VCXExperience")&&c&&!this._bLockUpdateThumbnail){V=new o(this._scenarioManager._experienceBase,c,this.ImmediateThumbnail);this._commandManager.Push(V)}},Redo:function(){},Undo:function(){},Invert:function(){},SaveContext:function(){},ChangeProperty:function(e,t){var n=e.GetHashing();n||(this._scenarioManager.ModifiableServer.AddModifiable(e),n=e.GetHashing()),this._propertyMap.AddOrModifyProperty(n,t.Clone())},ChangePropertiesFromMap:function(e){this._propertyMap=e.Clone()},Merge:function(e){if(e){var t=new r(this._scenarioManager,this._commandManager),n=this._propertyMap.Clone(),i=e._propertyMap;return n.Merge(i),t.ChangePropertiesFromMap(n),t}},SetLockEvents:function(e){this._bLockEvents=e},IsMergeable:function(){return!0}});return r}),define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesWithAnimation",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation"],function(e,t,n,i,a){"use strict";return t.extend({init:function(e,t,i){this._parent(),this._scenarioManager=e,this._componentsMap=t,this._commandManager=i,this._propertyMap=new n,this._scenarioTarget=null,this.easingFunctions={},this._bLockEvents=!1,this._transitionTime=null,this._type="VCXCmdChangePropertiesWithAnimation"},GetType:function(){return this._type},GetTitle:function(){return"Change properties with animation"},SetTransitionTime:function(e){this._transitionTime=e},Do:function(){var e=this._scenarioManager._experienceBase.getManager("VCXContextManager").getActiveCamera();if(e){var t=e.QueryInterface("VCXIViewpointController");t&&t.fromViewpoint()}this._scenarioTarget=this._scenarioManager.CaptureCurrentView({bIsPartialView:!0}),this._scenarioTarget.SetPropertyMapAtFrame(this._propertyMap,0);var n=new a(this._scenarioManager,this._componentsMap,this._commandManager);n.SetActiveScenario(!1),n.SetCallback(this._callback,this._parameter),n.SetLockEvents(this._bLockEvents),this._transitionTime&&n.SetTransitionTime(this._transitionTime);var o=n.BuildTransitionTo(this._scenarioTarget);if(o){var r=o._animations;for(var s in r)if(r.hasOwnProperty(s)){var c=r[s];if(c)for(var h in c._Tracks)if(c._Tracks.hasOwnProperty(h)){var _=c._Tracks[h],d=this.easingFunctions[s];if(d){var C=d[h];C&&(_.easing=C)}}}}var l=new i(this._scenarioManager,this._commandManager);l.ChangePropertiesFromMap(this._propertyMap),l.SetLockEvents(!0),this._commandManager.Push(l),this._commandManager.Do(n)},Undo:function(){this._bLockEvents||e.publish({event:"VCX_PROPERTIES_CHANGED"})},Redo:function(){this._bLockEvents||e.publish({event:"VCX_PROPERTIES_CHANGED"})},SaveContext:function(){},ChangeProperty:function(e,t,n){var i=e.GetHashing();if(i||(this._scenarioManager.ModifiableServer.AddModifiable(e),i=e.GetHashing()),this._propertyMap.AddOrModifyProperty(i,t.Clone()),n){var a=t.GetPropertyInfo().GetPropertyName(),o=this.easingFunctions[i];o||(o={},this.easingFunctions[i]=o),o[a]=n}},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey"],function(e,t,n){"use strict";return e.extend({init:function(e,n,i){this._parent(),this._scenarioManager=e,this._commandManager=n,this.modificationMap=new t,this._bForceAutokey=i,this._bLockEvents=!1,this._type="VCXCmdRequestChangeProperties"},GetType:function(){return this._type},GetTitle:function(){return"Request modification and change properties autokey"},Do:function(){let e=new n(this._scenarioManager,this._commandManager);e.ChangePropertiesFromMap(this.modificationMap),this._commandManager.Push(e),this.modificationMap=new t},Redo:function(){},Undo:function(){},Invert:function(){},SaveContext:function(){},RequestModification:async function(e,t,n,i){if(!Array.isArray(e))return void console.error("ERROR: Request modification function works on arrays of modifiables");let a=!1;for(let o=0;o<e.length;o++){const r=e[o];let s=null,c=r.GetProperty(t);if(!0===c.GetPropertyValue()._bUndefined){let e=c.GetPropertyValue().ToString();(i=i||n.ToString())===e&&(a=!0)}if(!a)if(s=c.Clone(),n)s.SetPropertyValue(n);else{s.GetPropertyValue().FromString(i)}await r.RequestModification(s,this.modificationMap)}return this.modificationMap}})}),define("DS/VCXWebKernelCommands/VCXCmdChangeVisibility",["DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n,i,a){"use strict";return t.extend({init:function(e,t,i){this._parent(),this._scenarioManager=e,this._componentsMap=t,this._commandManager=i,this._propertyMap=new n,this._listChange=[],this._visibility=a.EVisState.Hidden,this._type="VCXCmdChangeVisibility"},GetType:function(){return this._type},GetTitle:function(){return"Change Visibility"},_switchListChangeVisibilityIfNeeded:function(e,t){var n=t;if("boolean"==typeof t&&(console.warn("There shouldn't be a boolean in argument for this method. Use instead a Number, with 0 for hidden, 1 for visible."),n=t?a.EVisState.Visible:a.EVisState.Hidden),n===e)for(var i=0;i<this._listChange.length;++i){var o=this._listChange[i];if(o){var r=o.QueryInterface("VCXIVisibility");r&&r.SetVisibility(e)}}},Do:function(){if(0!==this._listChange.length){if(this._switchListChangeVisibilityIfNeeded(a.EVisState.Visible,this._visibility),this._switchListChangeVisibilityIfNeeded(a.EVisState.Hidden,this._visibility),this._scenarioManager.GetAutoKey()){var t=this._scenarioManager.GetCurrentScenario(),n=this._scenarioManager._Scenarios[t];this._scenarioManager.CaptureCurrentVisibility(n),this._scenarioManager._experienceBase.getManager("VCXExperience")&&this._scenarioManager._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(n)}for(var i,o=0;o<this._listChange.length;++o){var r=this._listChange[o];if(r&&!i){(i=r._experienceBase.getManager("VCXContextManager")).traverseGraphMustBePerformed=!0;break}}this._scenarioManager._experienceBase.getManager("VCXContextManager").getFrameWindow().getContextualUIManager().hideContextualMenus(),this._bLockEvents||e.publish({event:"VCX_VISIBILITY_CHANGED",data:{components:this._listChange.slice(),visibility:this._visibility}}),e.publish({event:"VCX_MATERIALS_PANEL_UPDATE",data:null})}else console.log("nothing to change visibility on")},Invert:function(){var e=this._visibility===a.EVisState.Hidden;this._visibility=e?a.EVisState.Visible:a.EVisState.Hidden},SaveContext:function(){},ChangeVisibility:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i){var a=i.QueryInterface("VCXIVisibility");a&&a.GetVisibility()!==t&&this._listChange.push(i)}}return this._visibility=t,this._listChange&&this._listChange.length},SetLockEvents:function(e){this._bLockEvents=e}})}),define("DS/VCXWebKernelCommands/VCXCmdDeleteMaterial",["DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdUpdateThumbnail","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile"],function(e,t,n,i,a,o){"use strict";e.extend({init:function(e,t){this._parent(),this._experienceBase=e,this._materialPID=t;let n=this._experienceBase.ComponentsMap.GetComponentFromType("VCXInternalMaterial_Spec");n=n.concat(this._experienceBase.ComponentsMap.GetComponentFromType("CXPCoveringMaterial_Spec")),this._materialsWithPID=n.filter(e=>e.GetPID()===t)},Do:async function(){if(this._materialsWithPID.filter(e=>"VCXInternalMaterial_Spec"===e.GetType()))return;const e=this._experienceBase,t=e.getManager("VCXScenarioManager"),i=(e.getManager("VCXExperience"),e.getManager("VCXCommandManager")),a=(t.GetCurrentScenario(),e.getManager("VCXVisuManager"),e.getManager("VCXContextManager"),t.GetScenarios());this._scenarioCommands=[];for(let e=0;e<a.length;e++){const o=a[e];this._scenarioCommands[e]={scenario:o,id:o.GetID(),name:o.GetName()};const r=new n(t,i);r.GoToScenario(o.GetID()),i.Push(r)}}})}),define("DS/VCXWebKernelCommands/VCXCmdApplyTo",["DS/VCXWebKernelCommands/VCXCommand","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdUpdateThumbnail","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertySet","i18n!DS/VCXWebKernelCommands/assets/nls/VCXWebKernelCommands"],function(e,t,n,i,a,o,r,s,c,h,_){"use strict";return e.extend({init:function(e,t,n){this._parent(),this._experienceBase=e,this._selectionContext=t,this._type="VCXCmdApplyTo",this._scope=n},GetType:function(){return this._type},GetTitle:function(){return"Update Thumbnail"},Do:async function(){if(this._selectionContext.availability||this._selectionContext.propagateCamera){const e=this._experienceBase,t=e.getManager("VCXScenarioManager"),n=e.getManager("VCXExperience"),_=e.getManager("VCXCommandManager"),d=t.GetCurrentScenario(),C=e.getManager("VCXVisuManager"),l=e.getManager("VCXContextManager"),m=C.getActiveViewport(),u=m&&m.QueryInterface("VCXIViewpointController"),p=m&&m.QueryInterface("VCXIModifiable"),f=new h;u.fromViewpoint(f);const v=f.Clone(),g=[];v.GetListPropertyNames(g),g.forEach(e=>{"Camera.Position"!==e&&(v.GetProperty(e).GetPropertyInfo()._bPersistent=!0)}),C.hideDecorations("applyTo",l.getMainViewer());const S=[];[...this._selectionContext.parts,...this._selectionContext.dressups].forEach(e=>{const t=e.QueryInterface("VCXIVisibility").GetVisibility(),n=e.QueryInterface("VCXIModifiable"),i=n.GetProperties(),a=n.GetHashing();if(S.push({element:e,modifiableHash:a,visibility:t,properties:i}),!this._selectionContext.propagateViewport&&e.IsKindOf("AmbienceModel_Spec")&&p.GetPropertyValue("Viewport.ActiveAmbience")===e.GetID()){const e=new h,t=p.GetProperty("Viewport.ActiveAmbience");e.AddOrModifyProperty(t.Clone()),S.push({element:m,modifiableHash:p.GetHashing(),visibility:-2,properties:e})}}),this._scenarioCommands=[];for(let r=0;r<this._selectionContext.scenario.length;r++){const h=this._selectionContext.scenario[r];this._scenarioCommands[r]={scenario:h,id:h.GetID(),name:h.GetName()};const m=new i(t,_);m.GoToScenario(h.GetID()),_.Push(m),this._scenarioCommands[r].VCXCmdGoToScenario=m,n._ManagerSet.update({viewer:l.getMainViewer(),viewpoint:l.getMainViewer().currentViewpoint});const u=new c;if(h.GetID()!==d){const n={},i=[s.EVisState.Hidden,s.EVisState.Visible,s.EVisState.Ghost];i.forEach(e=>{S.forEach(t=>{t.visibility===e&&(n[e]||(n[e]=[]),n[e].push(t.element))})}),i.forEach(i=>{if(n[i]&&n[i].length){const o=new a(t,e.ComponentsMap,_);o.ChangeVisibility(n[i],i)&&_.Push(o)}}),S.forEach(e=>{e.visibility!==s.EVisState.Hidden&&u.AddOrModifyPropertySet(e.modifiableHash,e.properties.Clone())})}if(this._selectionContext.propagateCamera){const e=l.getActiveCamera().QueryInterface("VCXIModifiable");u.AddOrModifyPropertySet(e.GetHashing(),v.Clone()),C.CameraControlsViewpoint=!0}const p=new o(t,_,!0);p.ChangePropertiesFromMap(u),_.Push(p)}await this.RefreshThumbnails(),this._cmdGotoInitialScenario=new i(t,_),this._cmdGotoInitialScenario.GoToScenario(d),this._cmdGotoInitialScenario.Do(),this._cmdChgPropVolatile=new r(t,_,!0),g.forEach(e=>{this._cmdChgPropVolatile.ChangeProperty(p,v.GetProperty(e).Clone())}),this._cmdChgPropVolatile.Do(),u.toViewpoint(),C.showDecorations("applyTo",l.getMainViewer())}},RefreshThumbnails:async function(){const e=this._experienceBase,t=e.getManager("VCXVisuManager"),i=e.getManager("VCXExperience"),a=e.getManager("VCXCommandManager"),o=e.getManager("VCXContextManager"),r=e.getManager("VCXNotificationManager");t.hideDecorations("applyTo",o.getMainViewer());const s=new Promise(async t=>{if(console.log(this._scenarioCommands),this._scenarioCommands){for(let t=0;t<this._scenarioCommands.length;t++){const a=this._scenarioCommands[t];a.VCXCmdGoToScenario&&a.VCXCmdGoToScenario.Do(),i._ManagerSet.update({viewer:o.getMainViewer(),viewpoint:o.getMainViewer().currentViewpoint});const r=new n(e,a.scenario,!0);await r.Do()}this._cmdGotoInitialScenario&&a.Do(this._cmdGotoInitialScenario),this._cmdChgPropVolatile&&a.Do(this._cmdChgPropVolatile)}t()}),c={strObjectName:" to "+this._scope,strAction:_["VCXApplyToCmd.Applying"],maskDisplayAdd:18,iPromise:s};r.addProgressNotification(c),await s,t.showDecorations("applyTo",o.getMainViewer())},Redo:function(){let e=t.subscribe({event:"VCX_UNDOREDO_DONE"},async()=>{await this.RefreshThumbnails(),t.unsubscribe(e),e=null})},Undo:function(){let e=t.subscribe({event:"VCX_UNDOREDO_DONE"},async()=>{await this.RefreshThumbnails(),t.unsubscribe(e),e=null})}})});