define("DS/EditPropWidget/UI/EditPropSkeleton",["UWA/Json","DS/EditPropWidget/UI/IDCardManager","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n){"use strict";return t.extend({defaultOptions:{className:"",typeOfDisplay:i.ALL,setEditButton:!1,displayType:i.STANDARD},init:function(e,t){var n=this;t.typeOfDisplay=t.typeOfDisplay?t.typeOfDisplay:i.ALL,t.displayType=t.displayType?t.displayType:i.STANDARD,t.className=t.className?t.className:"",t.className+=" EditProp_MasterContain",t.className+=t.typeOfDisplay?" "+t.typeOfDisplay:"",t.name="EditProp_MasterContain",t.showIdCard=void 0!==t.showIdCard?t.showIdCard:t.typeOfDisplay!==i.ONLY_EDIT_PROPERTIES,t.showFacets=t.typeOfDisplay===i.ALL,t.showExpander=t.typeOfDisplay===i.ALL,t.closeButton=i.isCloseButton(t.displayType),t.defaultFacetName=t.defaultFacetName?t.defaultFacetName:"",t.infoForFacet=t.infoForFacet?t.infoForFacet:null,t.indexModeParameter=!!t.indexModeParameter&&t.indexModeParameter,t.idCardOptions={events:{thumbnailClick:function(){n._getFirstPropertiesModel().get("activeThumbnail")?(n.elements.postIdCard&&n.elements.postIdCard.maskThumbnail(),require(["DS/ImageManager/ImageManager","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"],function(e,t){n.elements.postIdCard&&n.elements.postIdCard.unmaskThumbnail();var i=n._getFirstPropertiesModel(),s=i?i.get("objectId"):null;!s||n.elements.imageManager&&n.elements.imageManager.getModelId()===s||(n.elements.imageManager&&n.elements.imageManager.destroy(),n.elements.imageManager=new e({modelId:s,tenantId:t.getTenantFromModel(i),events:{onPrimaryChange:function(e){(i=n._getFirstPropertiesModel()).set("previewUrl",e?e.url:"");var t=i?i.get("objectId"):null;t&&n.dispatchEvent("onPrimaryChange",{id:t,image:e}),n._updateThumbnailForModel(i)}}})),n.elements.imageManager&&n.elements.imageManager.execute()})):n._isFacetAuthorized(i.FACET_VIEWS)&&n.selectFacet(i.FACET_VIEWS)}}},this._parent(e,t),this._sharedOptions.readOnly=!1!==t.readOnly,this.options.typeOfDisplay===i.ONLY_IDENTITY_CARD&&(this.options.setEditButton=!1),this.editMode=!0===t.editMode,this.options.typeOfDisplay===i.ALL&&(this.elements.containerError=this.elements.globalDiv),this.elements.mainError=UWA.createElement("div",{class:"EditProp_MainError"}).inject(this.elements.globalDiv).hide()},setReadonlyStatus:function(e){this._sharedOptions.readOnly=e,this.onRefresh()},setOccurrences:function(e){this.elements.imageManager&&(this.elements.imageManager.destroy(),delete this.elements.imageManager),this._parent(e)},_manageEvent:function(e){this._parent(e);var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);e.facet===i&&"switchMode"===e.eventID&&this.elements.postIdCard&&this._manageActionVisibility()},clearPanel:function(){this._parent(),this._getErrorManager(function(e){e.clearAllMessages()})},_getErrorManager:function(e){var t=this;this.errorOverlay?e.call(null,this.errorOverlay):require(["DS/ErrorWidget/ErrorWidget"],function(i){t.errorOverlay||(t.errorOverlay=new i(n.getWidgetObject(),t.elements.containerError,{className:"editProperties_errorManager"})),e.call(null,t.errorOverlay)})},_addNotif:function(e){var t=e.msg,i=e.eventID,n=e.customClass;switch(i){case"mainstaticerror":t=t||e.json,this.showMainErrorArea(t);break;case"error":t=t||e.json,this._addError(t,n);break;case"warning":this._addWarning(t,n);break;case"success":this._addSuccess(t,n);break;default:this._addInfo(t,n)}},_addInfo:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addInfo(e,t);i.dispatchEvent("onNotification",s)})},_addWarning:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addWarning(e,t);i.dispatchEvent("onNotification",s)})},_addSuccess:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addSuccess(e,t);i.dispatchEvent("onNotification",s)})},_addError:function(t,i){var n=this;this._getErrorManager(function(s){var a=t;if(null!=a&&("string"==typeof a||a instanceof String)&&a.includes("ErrorCode:1501009")){a={level:"error",title:UWA.i18n("InvalidCSCreationfailed"),subtitle:UWA.i18n("InvalidCSCreationFailedSubtitle"),message:UWA.i18n("NoAccessToCS")};var r=s.display(a)}else r=s.displayJSONError(e.encode(t),i);n.dispatchEvent("onNotification",r)})},hideMainErrorArea:function(){this.elements.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.elements.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.elements.mainError)},clearAllMainError:function(){this.elements.mainError.setContent("")},showMainComponent:function(){this._parent(),this.hideMainErrorArea()}})}),define("DS/EditPropWidget/constants/EditPropConstants",[],function(){"use strict";return{ONLY_IDENTITY_CARD:"editProp_onlyIC",ONLY_EDIT_PROPERTIES:"editProp_onlyProperties",ALL:"editProp_all",ALL_SELECTION:"allSelection",RESTRICTED_SELECTION:"restrictSelection",NO_SELECTION:"noSelection",MVA_SEP:"|",POPUP:"editProp_popup",TRANSIENT:"editProp_transient",STANDARD:"editProp_standard",FORCE_READWRITE:"force_readWrite",FORCE_READONLY:"force_readonly",FORCE_DEFAULT:"force_default",NO_CHANGES:"no_changes",ACTION_SWITCH:"pencil",ACTION_REFRESH:"cw",ACTION_RESET:"reset",ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM:"swym_view_content_in_3dswym",ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM:"swym_view_community_in_3dswym",ACTION_SWYM_VIEW_USER_PROFILE:"swym_view_user_profile",ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM:"swym_view_survey_in_3dswym",ACTION_SHARING_FILTER_VIEW:"filter",ACTION_SHARING_DELETE:"deleteUser",ACTION_SHARING_ADD:"addUser",ACTION_SHARING_LIST_VIEW:"listView",FACET_NONE:"none",FACET_VIEWS:"views",FACET_PROPERTIES:"properties",FACET_iPROPERTIES:"iproperties",FACET_INSTANCE:"instance",FACET_iINSTANCE:"indexInstance",FACET_ACTIVITY:"activity",FACET_GENERALHISTORY:"history",FACET_SWYMCOMMENTS:"social",FACET_EBOM:"EBOMPart",FACET_SWYM_CONTENT:"swym_content",FACET_SWYM_COMMUNITY_PROPERTIES:"swym_community_properties",FACET_SWYM_USER_PROPERTIES:"swym_user_properties",FACET_SWYM_SURVEY_PROPERTIES:"swym_survey_properties",FACET_SPECIFICATIONS:"Specifications",FACET_Variability:"Variability",FACET_EFFECTIVITY:"Effectivity",FACET_CHANGE:"Change",FACET_iCHANGE:"iChange",FACET_ALTERNATE:"Alternate",FACET_IPPROTECTION:"IPProtection",FACET_RICHCONTENT:"Rich Content Attr",FACET_DOCUMENTS:"documents",FACET_FILES:"Files",FACET_PROXY:"proxyFacet",FACET_ADMIN:"adminFacet",FACET_RELATIONS:"relations",FACET_DERIVEDOUTPUT:"derivedoutputs",FACET_REVISIONS:"revisions",FACET_SHARING:"sharing",FACET_PHYSICSSIMULATION:"physicssimulation",FACET_POSTERRORANALYSIS:"postErrorAnalysis",FACET_PC_CONTENT:"product_configuration_content",FACET_FL_SPECIFICATION:"catfl_specification_document",MODEL_INIT:"_Model_init",MODEL_FACET_INFO_PREFIX:"_DS_FACET_",MODEL_DS_ATTR:"_DS_ATTR_",METATYPE_BUS:"businessobject",METATYPE_REL:"relationship",METATYPE_PATH:"path",METATYPE_UNKNOWN:"unknown",MULTISEL_STD:"yes",MULTISEL_NO:"no",MULTISEL_MERGE:"merge",EP_RESPONSE_OK:"OK",EDITPROPINDEX_DIMENSION:"DSDim_",EDITPROPINDEX_DEFAULTTYPE:"TypeNotAvailable",COLLAPSE_IC_PREFERENCE:{type:"hidden",name:"editProperty_collapseIC",label:"is IC collapse",defaultValue:"false"},TYPES:{INTEGER:"integer",REAL:"real",TIMESTAMP:"timestamp",PERSON:"person",BOOLEAN:"boolean",ENUM:"enum"},MIN_WIDTH_FOR_TABLE:200,WIDTH_SWITCH_MODE:150,VARIABLES:{minWidthForTable:200},ACCORDION:{ATTRIBUTES:"Attributes"},isCloseButton:function(e){return e!==this.STANDARD}}}),define("DS/EditPropWidget/comm/CommManager",["UWA/Class"],function(e){"use strict";return e.extend({subscriptions:[],lCurrentListId:[],_nbOfCancelReceived:0,_statusReady:"ready",_statusRunning:"running",_commName:null,_currentStatus:null,_currentListenStatus:null,init:function(e){this._currentStatus=null,this._currentListenStatus=null,this.subscriptions=[],this.lCurrentListId=[],this._nbOfCancelReceived=0,e||(e="default"),this._commName=e},getCommObject:function(e){var t=window.top.EP_CommManager;return t||!0===e||(t=window.top.EP_CommManager={}),t},getCurrentComm:function(e){var t=this.getCommObject(e);return(t=t||{})[this._commName]||e||(t[this._commName]={callbacks:[]}),t[this._commName]},_removeCurrentComm:function(){this.getCommObject(!0)&&delete window.top.EP_CommManager[this._commName]},createRunningEvent:function(e){this.lCurrentListId=e,this._currentStatus={status:this._statusRunning,answer:this.lCurrentListId},this.getCurrentComm().status=this._currentStatus},createReadyEvent:function(e){this._currentStatus={status:this._statusReady,answer:e};var t=this.getCurrentComm();t.status=this._currentStatus,t.callbacks&&t.callbacks.length>0&&(t.callbacks.forEach(function(t){t.call(null,e)}),this._removeCurrentComm())},createListenEvent:function(e){var t=this.getCurrentComm(!0);t&&(t.status.status===this._statusReady?(e.call(null,t.status.answer),this._removeCurrentComm()):t.callbacks.push(e))},getCurrentListenStatus:function(){var e=this.getCurrentComm(!0),t=null;return e&&(t=e.status.status),t},destroy:function(){this._removeCurrentComm(),this._parent()}})}),define("DS/EditPropWidget/utils/AttributesUtils",["UWA/Array","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i){"use strict";return{defaultOptions:{},validateModels:function(e){for(var t=null,i=e.length,n=0;n<i;n++){var s=e[n];t=this._validateAllAttributes(s)}return t},validateAttributes:function(e,t){var i=this,n=[],s=[];return t.forEach(function(t){if(t?t.name:null){!0!==t.get("error").server&&t.resetError();var n=t.valueDB,a=null;if(e.isMergedModel()){var r=Object.keys(n);r.length>0&&(a=r[0])}if(null!=a&&(n=n[a]),null!==(n=n||(!0===t.get("readOnly")?null:null!=a?t.value[a]:t.value))){var o=i.checkValueForAttribute(t,n,s);o&&o.message&&t.setError(o.message,o.type)}}}),s.length>0?s.forEach(function(e){var t={customClass:e.attrName&&e.attrName.length>0?"EP_Warning_"+e.attrName:"EP_Warning_Message",message:e.message,code:"ERROR",eventID:"warning"};n.push(t)}):n=null,n},checkValueForAttribute:function(n,s,a){var r=this,o=n?n.name:null,l={message:null,type:null};if(o&&!0!==n.get("readOnly")){var c=n.label;return c=c?c.toLowerCase():"",null!==s&&(Array.isArray(s)||(s=[s]),0==s.length&&!0===n.mandatory&&(l=r.addError(a,n,c,"MandatoryAttribute")),s.every(function(s){var o=null;if("function"==typeof n.validationFunction&&(o=n.validationFunction(n)),o&&((l=r.addError(a,n,n.label,o.message)).type=o.type),!0===n.mandatory){var d=s+"",u=new RegExp(" ","g");""===(d=d.replace(u,""))&&(l=r.addError(a,n,c,"MandatoryAttribute"))}if(n.maxlength>0&&s.length>n.maxlength&&(l=r.addErrorWithValue(a,n,c,n.maxlength,"MaxLengthAttribute")),"real"===n.type||"integer"===n.type){d=s;e.isArray(d)?d.forEach(function(e){isNaN(e)&&(l=r.addErrorWithValue(a,n,n.label,e,"NotaNumber"))}):isNaN(d)?l=r.addErrorWithValue(a,n,n.label,d,"NotaNumber"):"integer"===n.type&&d%1!=0&&(l=r.addErrorWithValue(a,n,n.label,d,"IntegerIsDecimal"))}if(""!==n.minval&&"unit"!==n.get("tw_type")){var h=parseFloat(n.minval),p=s;if(e.isArray(p))p.forEach(function(e){var t=parseFloat(e);t<h&&(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMinVal")),n.minvalincluded||t!==h||(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMinVal"))});else(m=parseFloat(s))<h&&(l=r.addErrorWithValue(a,n,n.label,m,"OutOfMinVal")),n.minvalincluded||m!==h||(l=r.addErrorWithValue(a,n,n.label,m,"OutOfMinVal"))}if(""!==n.maxval&&"unit"!==n.get("tw_type")){var m,g=parseFloat(n.maxval);p=s;if(e.isArray(p))p.forEach(function(e){var t=parseFloat(e);t>g&&(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMaxVal")),n.maxvalincluded||t!==g||(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMaxVal"))});else(m=parseFloat(s))>g&&(l=r.addErrorWithValue(a,n,n.label,m,"OutOfMaxVal")),n.maxvalincluded||m!==g||(l=r.addErrorWithValue(a,n,n.label,m,"OutOfMaxVal"))}var f=n.get("forbiddenChar");if(f){d=s;if(t.commonChar(d,f,!0)>0){var v=i.replace(i.get("ForbiddenCharacters"),{label:n.label,badChars:f});a.push({message:v,attrName:n.getIdentifier()}),l.message=v,l.type="error"}}if("unit"===n.get("tw_type")){let e=n.get("dimensionType"),i=n.get("dimension");if(e&&i){let s=t.getValue("DimensionsDictionary");if(e&&s){e=e.startsWith("DSDim_")&&e.substring(6,e.length);let t=s.get(e),o=!1;if("object"==typeof i){let e=Object.keys(i);for(let s=0;s<e.length;s++){let c=i[e[s]];if(t&&t.Units&&Array.isArray(t.Units)){let e=t.Units.filter(e=>e.label?e.label===c||e.NLSName===c:e.Name===c||e.NLSName===c);Array.isArray(e)&&e.length>0&&(o=!0)}if(!o){l=r.addErrorWithValue(a,n,n.label,c,"NotAValidDimension");break}}}else{if(t&&t.Units&&Array.isArray(t.Units)){let e=t.Units.filter(e=>e.label?e.label===i||e.NLSName===i:e.Name===i||e.NLSName===i);Array.isArray(e)&&e.length>0&&(o=!0)}o||(l=r.addErrorWithValue(a,n,n.label,n.dimension,"NotAValidDimension"))}}}}return null===l.message})),l}},_validateAllAttributes:function(e){var t=e.values();return this.validateAttributes(e,t)},addErrorWithValue:function(e,t,n,s,a){i.get(a);var r=i.replace(i.get(a),{label:n,value:s});return e.push({message:r,attrName:t.getIdentifier()}),{message:r,type:"error"}},addError:function(e,t,n,s){i.get(s);var a=i.replace(i.get(s),{label:n});return e.push({message:a,attrName:t.getIdentifier()}),{message:a,type:"error"}}}}),define("DS/EditPropWidget/buttonsBar/ButtonsBar",["UWA/Controls/Abstract","DS/Controls/TooltipModel","DS/Controls/Button","DS/UIKIT/DropdownMenu","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s){return e.extend({defaultOptions:{vertical:!1,minimumSize:0},init:function(e,a){this._parent(e),this.elements.container=UWA.createElement("div",{class:"buttonsBar "+(e.classname?e.classname:"")+(e.vertical?" vertical":"")}),this.options.minimumSize<0&&!a&&(a=this.elements.container),this.elements.previous=UWA.createElement("div",{class:"buttonsList"}),this.elements.comboButton=new i({value:"dropdownAction",tooltipInfos:new t({shortHelp:s.dropActions,mouseRelativePosition:!0}),icon:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite"}),this.elements.dropdown=new n({target:this.elements.comboButton.getContent(),items:[]}),this.elements.comboButton.hide(),this.elements.after=UWA.createElement("div",{class:"buttonsList"}),this.elements.previous.inject(this.elements.container),this.elements.comboButton.inject(this.elements.container),this.elements.after.inject(this.elements.container),this._limitingDiv=a,this._availableSize=0,this._sizeButtons=null,this._buttons={}},addButton:function(e,n){var s=new i({value:e.name,tooltipInfos:new t({shortHelp:e.text,mouseRelativePosition:!0}),icon:{iconName:e.icon,fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"lite",type:e.type,onClick:function(){e.handler&&e.handler()}});e.id&&(s.domId=e.id);var a=this.elements.after;!0!==e.after&&(a=this.elements.previous,this.elements.dropdown.addItem({text:e.text,name:e.name,fonticon:e.icon,handler:e.handler})),s.inject(a),this._buttons[e.name]={element:s,options:UWA.clone(e)},this._sizeButtons+=38,!1!==n&&this.refresh()},addButtons:function(e){var t=this;e.forEach(function(e){t.addButton(e,!1)}),this.refresh()},setButtons:function(e){this.elements.previous.empty(),this.elements.after.empty(),this.clearButtons(),this.addButtons(e)},destroy:function(){this.clearButtons(),this._parent.apply(this,arguments)},clearButtons:function(){for(var e in this._buttons)this._buttons[e].element.destroy(),this.elements.dropdown.removeItem(e);this._buttons={},this._sizeButtons=0},hideButton:function(e){this.elements.dropdown.disableItem(e);var t=this._buttons[e];t&&(t.options._visible=!1),this._sizeButtons-=38,this.refresh()},showButton:function(e){this.elements.dropdown.enableItem(e);var t=this._buttons[e];t&&(t.options._visible=!0),this._sizeButtons+=38,this.refresh()},updateButton:function(e,t){t.id=e,t.name=e;var i={id:e,name:e};t.text&&(i.text=t.text),t.icon&&(i.fonticon=t.icon),this.elements.dropdown.updateItem(i);var n=this._buttons[e];n&&(t.text&&(n.element.getModel().tooltipInfos.shortHelp=t.text),t.icon&&(n.element.getModel().icon={iconName:t.icon,fontIconFamily:WUXManagedFontIcons.Font3DS}))},onResize:function(){if(this._limitingDiv&&0!==this.options.minimumSize){var e=this._limitingDiv;this.options.minimumSize;if(this.options.minimumSize<0&&(e=this._limitingDiv.getParent(),0),e){var t=e.getSize(),i=this.options.vertical?t.height:t.width;this._availableSize=i-this.options.minimumSize}}this.refresh()},refresh:function(){if(this._limitingDiv&&this.options.minimumSize)if(0!==this._availableSize&&this._availableSize<this._sizeButtons){var e=null;for(var t in this._buttons)!0!==this._buttons[t].options.after&&(null!==e?(!1!==e&&(e.element.hide(),this.elements.comboButton.show()),e=!1,this._buttons[t].element.hide()):e=this._buttons[t])}else for(var t in this.elements.comboButton.hide(),this._buttons){var i=this._buttons[t];!1!==i.options._visible&&i.element.show()}}})}),define("DS/EditPropWidget/changeAction/passThruJS",[],function(){"use strict";return{onReady:function(e){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(t){var i={changeIsSetChecker:function(e){return e&&e.AuthoringContextHeader&&Object.keys(e.AuthoringContextHeader).length>0}},n=[],s=[];for(var a in t)"function"==typeof t[a]&&(n.push(t[a]),s.push(a));s.forEach(function(e,s){i[e]=function(i,a){if("init"!==e&&"constructor"!==e&&"initialize"!==e&&"undefined"==typeof enoviaServerAuthoringWidget)return console.log("Authoring context not initialized"),void("function"==typeof i?i({}):"function"==typeof a&&a({}));n[s].apply(t,arguments)}}),e.call(null,i)},function(){e.call(null,null)})}}}),define("DS/EditPropWidget/models/HistoryObjectModel",[],function(){"use strict";return function(e){for(var t in this.name="",this.type="",this.revision="",this.id="",e)this[t]=e[t];this.set=function(e,t){void 0!==t&&(this[e]=t)},this.get=function(e){return this[e]}}}),define("DS/EditPropWidget/models/EditPropAttributeModel",[],function(){"use strict";return function(e){for(var t in this._identifier=null,this.isTransient=!1,this.name="",this.label="",this.select="",this.path="",this.value="",this.valueDB="",this.type="text",this.tw_type=null,this.authorizedValues=[],this.authorizedValuesNLS=[],this.authorizedValuesRequired=!0,this.dimension="",this.unitName=null,this.dimensionType=null,this.maxlength=-1,this.positionUI="0",this.positionIdentityCard=-1,this.sectionIdentityCard="",this.masked=!0,this.forbiddenChar=null,this.mandatory=!1,this.modified=!1,this.multiline=!1,this.multivalue=!1,this.multisel=!1,this.readOnly=!0,this.minval="",this.maxval="",this.minvalincluded=!1,this.maxvalincluded=!1,this.attributeID="",this.facet="",this.section="",this.extension="",this.group="Default",this.urlIcon=null,this.from=null,this.navType=null,this.relation=null,this.dbValues={value:"",valueDB:""},this.initialsValues={value:"",valueDB:"",dimension:""},this.error={message:null,type:"error"},this.validationFunction=function(){},e)this[t]=e[t];this.getIdentifier=function(){var e=this._identifier;return e||(e="",e+=this.facet?this.facet+"-":"",e+=this.path,this._identifier=e),e},this.set=function(e,t){void 0!==t&&(this[e]=t,"modified"!==e&&(this.modified=!0))},this.saveInitialValues=function(){for(var e in this.initialsValues)this.initialsValues[e]=UWA.clone(this[e]),this.dbValues.hasOwnProperty(e)&&(this.dbValues[e]=UWA.clone(this[e]))},this.resetError=function(){this.error={message:null,type:"error"}},this.setError=function(e,t,i){e&&(t||(t="error"),this.error={message:e,type:t,server:!0===i})},this.resetInitialValues=function(){for(var e in this.initialsValues)this[e]=UWA.clone(this.initialsValues[e])},this.get=function(e){return this[e]},this.isSameValueSet=function(e){var t=!0;if(t=!(null===e.value||null===this.value||null===e.valueDB||null===this.valueDB))if(this.multisel){for(var i in this.value)if(!(t=t&&this._isSameValueSet(e.value[i],this.value[i],e.valueDB[i],this.valueDB[i])))break}else t=this._isSameValueSet(e.value,this.value,e.valueDB,this.valueDB,e.dimension,this.dimension);return!t},this._isSameValueSet=function(e,t,i,n,s,a){var r=!0;if("boolean"===this.type)r=i===n||(i+"").toLowerCase()===(n+"").toLowerCase();else{var o=e.length;if((r=null==t||o===t.length)&&null!=s&&null!=a&&(r=a.length===s.length),r){if("relation"!==this.type)for(var l=0;l<o&&(r=e[l]===t[l]);l++);if(r)for(r=(o=i.length)===(n?n.length:0),l=0;l<o&&(r=i[l]===n[l]);l++);r&&(r=s===a)}}return r},this.getChangedIds=function(){var e={};if(!0===this.multisel)for(var t in this.value){var i=this.value[t],n=this.valueDB[t],s=s&&this._isSameValueSet(this.initialsValues.value[t],i,this.initialsValues.valueDB[t],n);s||(e[t]={value:i,valueDB:n})}else this.dimension?e.a={value:this.value,valueDB:this.valueDB}:e.a={value:this.value,valueDB:this.valueDB,dimension:this.dimension};return e},this.hasChanged=function(){return this.isSameValueSet(this.initialsValues)},this.applySort=!1}}),define("DS/EditPropWidget/controllers/EditPropUIController",["UWA/Class"],function(e){"use strict";return e.extend({defaultOptions:{},init:function(e,t){this.editPropModelList=e,this._parent(t)},setModels:function(e){this.editPropModelList=e},getModels:function(){return this.editPropModelList},getModel:function(e){var t=null;return this.editPropModelList.every(function(i){var n=!0;return e==i.get("objectId")&&(t=i,n=!1),n}),t},getModifiedModels:function(){var e=[];return this.editPropModelList.forEach(function(t){if(!0!==t.get("isTransient")){var i=t.getChangedValues();Object.keys(i).length>0&&e.push(t)}}),e},getLabel:function(){var e="";return 1===this.editPropModelList.length&&(e=this.editPropModelList[0].get("label")),e}})}),define("DS/EditPropWidget/ajaxRequests/MultipleAsynchronousRequests",[],function(){"use strict";return function(e,t){var i={},n=e.length,s=t;this.setAnswer=function(t,a){e.indexOf(t)>=0&&(void 0===i[t]&&n--,i[t]=a),n<=0&&null!==s&&s.call(this)},this.getAnswer=function(e){return i[e]}}}),define("DS/EditPropWidget/comm/EventManager",["UWA/Class"],function(e){"use strict";var t=0;return e.singleton({init:function(){this._parent.apply(this,arguments),this._events={},this._queueStack=[]},publish:function(e){var i=this,n={index:++t},s=this._events[e];Array.prototype.shift.apply(arguments);var a=arguments;s&&s.forEach(function(e){i._queueStack.push({callback:e,context:n,args:a})});for(var r=null;r=this._queueStack.shift();)r.callback.apply(r.context,r.args)},subscribe:function(e,t){var i=this._events[e];i||(i=[],this._events[e]=i),i.push(t)},remove:function(e,t){var i=this._events[e];if(i){for(var n=-1;(n=i.indexOf(t))>=0;)i.splice(n,1);0==i.length&&delete this._events[e]}}})}),define("DS/EditPropWidget/constants/ConstantsMapping",["DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i){"use strict";var n={"3dspace":{name:"3DSpace",fedPrefix:"physicalid",require:"DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests",identifire:"pid:",path:"/resources"},"3dlifecycle":{name:"3dlifecycle",fedPrefix:"physicalid",require:"DS/EditPropWidget/ajaxRequests/3dlifecycleAjaxRequests",identifire:"pid:",path:"/resources"},"3ddrive":{name:"3DDrive",fedPrefix:"physicalid",isSource:!0,require:"DS/EditPropWidget/ajaxRequests/3DDriveAjaxRequest",identifire:"driveid:",path:"/resources"},"3dswym":{name:"3DSwym",fedPrefix:"resourceid",modelRequired:!0,modelNeeded:!0,require:"DS/SwymUnifiedSearch/script/customization/editprop-ajax-requests/swym-ajax-requests",identifire:""},fedsearch:{name:"3DSearch",require:"DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests"},www:{name:"www",require:"DS/IPClassifyUXUtil/ajaxRequests/wwwAjaxRequests",extensionsSupported:!1},sourcing:{name:"sourcing",fedPrefix:"physicalid",require:"DS/ENOXSourcingUXInfra/PropertiesView/SourcingAjaxRequests",identifire:"pid:",path:"/resources"}};return{getSupportedServices:function(){return n},getSupportedServicesArray:function(){var e=this.getSupportedServices(),t=[],i=[];for(var n in e){var s=e[n];!0!==s.modelRequired&&(s.isSource?t.push(s.id?s.id:n):i.push(s.name))}return{sources:t,services:i}},getServiceBySource:function(e){return n[e]},getServiceForModel:function(e){var t=null,i=null;if(e){if(i=e.get("_sourceId"),!(t=n[i])){var s=e.get("sourceName");s&&(i=s.toLowerCase(),t=n[i]),t||(s=e.get("source"))&&(i=s.toLowerCase(),t=n[i]),e.set("_sourceId",i)}null!=t&&(e.identifire=t.identifire?t.identifire:"",e.path=t.path?t.path:"")}return t},getMapping:function(t){var n={};return n[e.FACET_ACTIVITY]={require:"DS/EditPropWidget/facets/History/History",facet:{name:e.FACET_ACTIVITY,text:i.get("Activity"),icon:"clock"}},n[e.FACET_GENERALHISTORY]={require:"DS/EditPropWidget/facets/GeneralHistory/History",services:["3DSpace"],facet:{name:e.FACET_GENERALHISTORY,text:i.get("Activity"),icon:"clock"},options:t},n[e.FACET_VIEWS]={require:"DS/EditPropWidget/facets/3DPlay/3DPlayFacet",webInWin:!1,facet:{name:e.FACET_VIEWS,text:i.get("Views"),icon:"eye"},options:t},n[e.FACET_PROPERTIES]={alwaysCalled:!0,supportMerge:!0,require:"DS/EditPropWidget/facets/Properties/EditPropController",options:t,actions:[e.ACTION_SWITCH,e.ACTION_RESET],facet:{name:e.FACET_PROPERTIES,text:i.get("Properties"),icon:"attributes"},supportExtension:!0},n[e.FACET_iPROPERTIES]={alwaysVisible:!1,alwaysCalled:!0,require:"DS/EditPropWidget/facets/Properties/iPropertiesFacet",options:t,actions:[e.ACTION_RESET],facet:{name:e.FACET_iPROPERTIES,text:i.get("iProperties"),icon:"attributes"}},n[e.FACET_RICHCONTENT]={require:"DS/ReqProperties/facets/RichAttribute/RichContentController",facet:{name:e.FACET_RICHCONTENT,text:i.get("RichContentTabName"),icon:"attributes"}},n[e.FACET_SWYMCOMMENTS]={require:"DS/EditPropWidget/facets/SwymComments/SwymComments",services:["comment"],content:null,facet:{name:e.FACET_SWYMCOMMENTS,text:i.get("Social"),icon:"comment"}},n[e.FACET_EBOM]={supportMerge:!0,require:"DS/EditPropWidget/facets/EBOMPart/EBOMPart",options:t,actions:[e.ACTION_SWITCH,e.ACTION_RESET],facet:{name:e.FACET_EBOM,text:i.get("EBOMPart"),icon:"table"}},n[e.FACET_EFFECTIVITY]={alwaysVisible:!1,roles:["CSV","InternalDS"],require:"DS/CfgWebAppEffectivityUX/facets/EffectivityFacet",options:t,facet:{name:e.FACET_EFFECTIVITY,text:i.Effectivity,icon:"survey"}},n[e.FACET_SPECIFICATIONS]={alwaysVisible:!1,require:"DS/CfgWebAppSpecificationsUX/facets/CfgSpecificationsFacet",options:t,facet:{name:e.FACET_SPECIFICATIONS,text:i.Specifications,icon:"properties"}},n[e.FACET_Variability]={alwaysVisible:!1,require:"DS/CfgWebAppXRevisionCommands/facets/CfgXRevisionVariabilityFacet",options:t,facet:{name:e.FACET_Variability,text:i.Variability,icon:"variants-and-options"}},n[e.FACET_CHANGE]={alwaysVisible:!1,options:t,require:"DS/ENOChgActionProp/facets/ChangePropertiesFacet",facet:{name:e.FACET_CHANGE,text:i.Change,icon:"change"}},n[e.FACET_iCHANGE]={alwaysVisible:!1,options:t,require:"DS/ENOChgActionProp/facets/iChangePropertiesFacet",facet:{name:e.FACET_iCHANGE,text:i.iChange,icon:"change"}},n[e.FACET_ALTERNATE]={alwaysVisible:!1,options:t,require:"DS/ENOXAlternateSubstitute/components/properties/js/AlternatePropertiesFacet",facet:{name:e.FACET_ALTERNATE,text:i.get("Alternate"),icon:"exchange"}},n[e.FACET_IPPROTECTION]={alwaysVisible:!1,supportMerge:!1,roles:["IPA","IPS","InternalDS"],options:t,require:"DS/ENOIPProtection/IPProtection/IPProtectionController",facet:{name:e.FACET_IPPROTECTION,text:i.IPProtection,icon:"vault"}},n[e.FACET_PROXY]={require:"DS/OSLCConsumer/facets/ProxyFacet",calledIfVisible:!0,facet:{name:e.FACET_PROXY,text:i.get("ProxyFacet"),icon:"link"}},n[e.FACET_INSTANCE]={supportMerge:!0,require:"DS/EditPropWidget/facets/Instance/InstanceFacet",options:t,actions:[e.ACTION_SWITCH,e.ACTION_RESET],facet:{name:e.FACET_INSTANCE,text:i.get("EP_instance"),icon:"attributes"},supportExtension:!0},n[e.FACET_iINSTANCE]={require:"DS/EditPropWidget/facets/Instance/IndexInstanceFacet",options:t,actions:[e.ACTION_RESET],facet:{name:e.FACET_iINSTANCE,text:i.get("EPIndex_instance"),icon:"attributes"}},n[e.FACET_SWYM_CONTENT]={alwaysVisible:!1,alwaysCalled:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-content-facet",actions:[e.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM],facet:{name:e.FACET_SWYM_CONTENT,text:i.get("View"),icon:"eye"}},n[e.FACET_SWYM_SURVEY_PROPERTIES]={alwaysVisible:!1,alwaysCalled:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-survey-properties-facet",actions:[e.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM],facet:UWA.merge({name:e.FACET_SWYM_SURVEY_PROPERTIES},n[e.FACET_PROPERTIES].facet)},n[e.FACET_SWYM_COMMUNITY_PROPERTIES]={alwaysCalled:!1,alwaysVisible:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-community-properties-facet",actions:[e.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM],facet:UWA.merge({name:e.FACET_SWYM_COMMUNITY_PROPERTIES},n[e.FACET_PROPERTIES].facet)},n[e.FACET_SWYM_USER_PROPERTIES]={alwaysCalled:!1,alwaysVisible:!1,require:"DS/SwymUnifiedSearch/script/customization/facets/edit-properties-facets/swym-user-properties-facet",actions:[e.ACTION_SWYM_VIEW_USER_PROFILE],facet:UWA.merge({name:e.FACET_SWYM_USER_PROPERTIES},n[e.FACET_PROPERTIES].facet)},n[e.FACET_ADMIN]={require:"DS/PropertiesAdmin/PropertiesAdmin",facet:{name:e.FACET_ADMIN,text:i.get("AdminFacet"),icon:"cog"}},n[e.FACET_RELATIONS]={require:"DS/ENORIPE_Relations/views/RelationsTab",options:t,facet:{name:e.FACET_RELATIONS,text:i.get("relations_tab"),icon:"object-related"}},n[e.FACET_DERIVEDOUTPUT]={roles:["CSV","InternalDS"],supportMerge:!1,options:t,require:"DS/ENODODisplay/commands/facets/DerivedOutputFacet",facet:{name:e.FACET_DERIVEDOUTPUT,text:i.get("DerivedOutput"),icon:"derived-output"},actions:[{name:"generateDeriveOutput",text:i.get("generateDeriveOutputNLS"),icon:"derived-output"},{name:"refreshDOView",text:i.get("refreshDOViewNLS"),icon:"refresh"},{name:"bulkDownloadDO",text:i.get("bulkDownloadDONLS"),icon:"folder-zipped-download"}]},n[e.FACET_REVISIONS]={blockFromSearch:!0,options:t,require:"DS/ENOXVersionExplorerUtils/RevisionsTabFacet",facet:{name:e.FACET_REVISIONS,text:i.get("revisions_tab"),icon:"flow-branch-list"}},n[e.FACET_DOCUMENTS]={require:"DS/ReqProperties/facets/ReqDoc/ReqDocFacet",facet:{name:e.FACET_DOCUMENTS,text:i.get("documents_tab"),icon:"attach"}},n[e.FACET_FILES]={alwaysVisible:!1,supportMerge:!1,blockFromSearch:!0,options:t,require:"DS/DocumentFiles/FilesFacet",facet:{name:e.FACET_FILES,text:i.Files,icon:"docs"}},n[e.FACET_SHARING]={blockFromSearch:!0,options:t,require:"DS/ENOSharingWebUI/ENOSharingWebUI",actions:[],facet:{name:e.FACET_SHARING,text:i.get("sharing_tab"),icon:"forward"}},n[e.FACET_PHYSICSSIMULATION]={options:t,visible:!0,alwaysVisible:!0,require:"DS/SPYUI/facets/PhysSimulationFacet",facet:{name:e.FACET_PHYSICSSIMULATION,text:i.get("physicssimulation_tab"),icon:"compass-simulation"}},n[e.FACET_POSTERRORANALYSIS]={visible:!0,blockFromSearch:!0,options:t,require:"DS/ENOLifecyclePostErrorAnalysis/ENOLifecyclePostErrorAnalysisUI",facet:{name:e.FACET_POSTERRORANALYSIS,text:i.get("postErrorAnalysis_tab"),icon:"parameters"}},n[e.FACET_PC_CONTENT]={require:"DS/PCOverview/js/PCOverviewFacet",supportMerge:!0,facet:{name:e.FACET_PC_CONTENT,text:i.get("pc_content_tab"),icon:"properties"}},n[e.FACET_FL_SPECIFICATION]={options:t,supportMerge:!1,require:"DS/CATFLWidgetProperties/facets/CATFLSpecificationDocumentFacet",facet:{name:e.FACET_FL_SPECIFICATION,icon:"doc-log",text:i.get("catfl_specification_document_tab")}},n},getDefaultFacets:function(i,n){var s=this.getMapping(),a=[e.FACET_PROPERTIES,e.FACET_FILES,e.FACET_PC_CONTENT,e.FACET_iPROPERTIES,e.FACET_INSTANCE,e.FACET_iINSTANCE,e.FACET_SHARING,e.FACET_VIEWS,e.FACET_EBOM,e.FACET_ACTIVITY,e.FACET_GENERALHISTORY,e.FACET_EFFECTIVITY,e.FACET_SPECIFICATIONS,e.FACET_Variability,e.FACET_CHANGE,e.FACET_iCHANGE,e.FACET_ALTERNATE,e.FACET_IPPROTECTION,e.FACET_PROXY,e.FACET_SWYMCOMMENTS,e.FACET_SWYM_CONTENT,e.FACET_SWYM_COMMUNITY_PROPERTIES,e.FACET_SWYM_USER_PROPERTIES,e.FACET_SWYM_SURVEY_PROPERTIES,e.FACET_RELATIONS,e.FACET_DERIVEDOUTPUT,e.FACET_REVISIONS,e.FACET_DOCUMENTS,e.FACET_RICHCONTENT,e.FACET_FL_SPECIFICATION,e.FACET_ADMIN,e.FACET_POSTERRORANALYSIS],r=a,o=t.isWebInWinEnvironment();return!0!==o&&!0!==i&&!0!==n||(r=[],a.forEach(function(e){var t=!0,a=s[e];!0===i&&(t=!a||!0===a.supportMerge),t&&!0===o&&(t=!1!==a.webInWin),t&&(!0===n?r.push(a):r.push(e))})),r}}}),define("DS/EditPropWidget/models/EditPropModel",["UWA/Class/Model","UWA/Class/Debug","DS/WidgetServices/WidgetServices","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s){"use strict";return e.extend(t,{METATYPE_BUS:s.METATYPE_BUS,METATYPE_REL:s.METATYPE_REL,METATYPE_PATH:s.METATYPE_PATH,changedValues:{},_locked:!1,_lockedAttributes:[],_initProperties:{},defaults:{metatype:s.METATYPE_UNKNOWN,source:"3DSpace",sourceName:"",tenant:i.getTenantID(),objectId:"",label:"",labelAttribute:"",type_icon_url:"",previewUrl:"",isTransient:!1,_changeId:"",instrefid:"",indexModeParameter:"",i3dxId:""},isMergedModel:function(){return!1},getOptions:function(){var e={};for(var t in this.defaults)e[t]=this.get(t);return e},lockModel:function(e){var t=this;this._locked=!0===e,this._locked||(this._lockedAttributes.forEach(function(e){var i=t.get(e);null!=i&&(i=new n(i),t.set(e,i))}),this._lockedAttributes=[])},isLocked:function(){return!0===this._locked},setFloatingAttribute:function(e,t,i){this.isLocked()?(this._attributes[e]=t,this._lockedAttributes.indexOf(e)<0&&this._lockedAttributes.push(e)):(!0!==i&&(t=new n(t)),this.set(e,t))},getComputedTitle:function(){return this.get("label")},setup:function(){for(var e in this._lockedAttributes=[],this._locked=!1,this.changedValues={},this._initProperties={},this.defaults)this._initProperties[e]=this.get(e)},getChangeId:function(){return this.get("_changeId")},getTenant:function(){return this.get("tenant")},saveInitialValues:function(e,t){var i=this,n=this.keys(),s=[];n.forEach(function(t){var n=i.get(t);null!==n&&"object"==typeof n&&"function"==typeof n.saveInitialValues&&(null==e||e.indexOf(t)>=0)&&(n.saveInitialValues(),s.push(t))}),!1!==t&&this._dispatchChangedAttributes(i,s,!1),this._clearChangedValue(e),this.modelSaved()},isTransientModel:function(){return this.get("isTransient")},getAttributeFromField:function(e,t,i){var n=this;i=i||0;var s=[];return this.keys().every(function(a){var r=n.get(a);return null!==r&&"object"==typeof r&&"function"==typeof r.get&&r.get(e)===t&&s.push(r),0===i||s.length<i}),1===i?s.length>0?s[0]:null:s},resetInitialValues:function(){var e=this;this.keys().forEach(function(t){var i=e.get(t);i&&"object"==typeof i&&"function"==typeof i.resetInitialValues&&(i.resetInitialValues(),e._dispatchChangedAttributes(e,[t],!0))}),this._clearChangedValue()},resetAllErrors:function(e){var t=this;this.keys().forEach(function(i){var n=t.get(i);n&&"object"==typeof n&&"function"==typeof n.resetError&&(n.resetError(),!1!==e&&t._dispatchChangedAttributes(t,[i],!0))})},clearChangedValue:function(e){this._clearChangedValue(e)},_clearChangedValue:function(e){var t=this;e?e.forEach(function(e){t._removeChangedValue(e)}):this.changedValues={}},removeChangedValue:function(e){this._removeChangedValue(e)},_removeChangedValue:function(e){this.changedValues[e]&&delete this.changedValues[e]},attributeHasChanged:function(e){return!!this.changedValues[e]},removeEvent:function(e,t){this.removeEvent2("onChange:"+e,t)},removeEvent2:function(e,t){var i=this._dispatchers[e];if(i)for(var n=i.bindings.length-1;n>=0;n--){i.bindings[n].listener===t&&i.bindings.splice(n,1)}},getChangedValues:function(){return this.changedValues},setChangedValues:function(e){"object"==typeof e&&(this.changedValues=e)},hasSameAttributesThan:function(e){var t=Object.keys(this._attributes),i=Object.keys(e._attributes),n=!1;return t.length===i.length&&(n=!0,t.every(function(e){return i.indexOf(e)<0&&(n=!1),n})),n},onChange:function(e){var t=this._getChangedAttributes(e);t.length>0&&this._dispatchChangedAttributes(e,t,!1)},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=[];for(var s in t){var a=t[s],r=!1;a instanceof n&&((r=a.hasChanged())?e.changedValues[s]=a:((r=void 0!==e.changedValues[s])&&delete e.changedValues[s],r=r||!this._previousAttributes[s]),r&&i.push(s))}return i},_dispatchChangedAttributes:function(e,t,i){var n=this,s=[];t.forEach(function(t){i&&n.dispatchEvent("onChange:"+t),s.push(e.get(t))}),this.dispatchEvent("onChangeAttributes",[e,s])},modelSaved:function(){this.dispatchEvent("onSave")},getAllAttributes:function(){return this._attributes}})}),define("DS/EditPropWidget/models/CommonAbstract",["DS/EditPropWidget/comm/EventManager","UWA/Controls/Abstract"],function(e,t){var i=0;return t.extend({_callbacks:{},init:function(e){i++,e&&!e.eventThread&&(e.eventThread="CT"+i),this._parent.apply(this,arguments),this._callbacks={}},publishEvt:function(t){var i=this._getEventThread(t);arguments[0]=i,e.publish.apply(e,arguments)},subscribeEvt:function(t,i,n){var s=this._getEventThread(t);arguments[0]=s,e.subscribe.apply(e,arguments),this._callbacks[s]=i},destroy:function(){for(var t in this._callbacks)e.remove(t,this._callbacks[t]);this._parent.apply(this,arguments)},_getEventThread:function(e){return(this.options.eventThread?this.options.eventThread+".":"")+e},_callMethodOnEach:function(e,t){var i=e,n=t;for(var s in Array.prototype.shift.apply(arguments),Array.prototype.shift.apply(arguments),i)i[s][n].apply(this,arguments)}})}),define("DS/EditPropWidget/models/EditPropModelMerge",["DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropAttributeModel","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i){return e.extend({_innerModels:{},setup:function(){this._parent(),this._innerModels={}},getMergingModels:function(){return this._innerModels},getMergedModelIds:function(){var e=this.getMergingModels();return Object.keys(e)},setMergingModels:function(e){var t=this;if(this._innerModels)for(var i in this._innerModels){(n=this._innerModels[i])._callbackMerge&&n.removeEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}for(var i in this._innerModels=e,this._innerModels){var n;(n=this._innerModels[i])._callbackMerge=n._callbackMerge?n._callbackMerge:{},n._callbackMerge[t.get("objectId")]=function(e,i){var n=e.get("objectId");i.forEach(function(e){var i=e.getIdentifier(),s=t.get(i);if(s){s.get("value")[n]=e.get("value"),s.get("valueDB")[n]=e.get("valueDB"),s.get("dimension")[n]=e.get("dimension"),t.setFloatingAttribute(i,s)}})},n.addEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}},isMergedModel:function(){return!0},set:function(e,i){i instanceof t&&i.set("multisel",!0),this._parent(e,i)},getComputedTitle:function(){var e=this.getMergedModelIds().length;return newLabel=i.replace(i.get("{0} objects selected"),{0:e}),newLabel},resetAllErrors:function(){var e=this;this.lockModel(!0);var t=this.getMergingModels();for(var i in t)t[i].resetAllErrors();setTimeout(function(){e.lockModel(!1)}),e._parent(!1)},clearChangedValue:function(e){var t=this;this.lockModel(!0);var i=this.getMergingModels();for(var n in i)i[n].clearChangedValue(e);setTimeout(function(){t.lockModel(!1)})},resetInitialValues:function(){this._parent.apply(this,arguments);var e=this.getMergingModels();for(var t in e){var i=e[t];i.resetInitialValues.apply(i,arguments)}},getChangedValues:function(){var e={},t=this.getMergingModels();for(var i in t){var n=t[i];if(n){var s=n.getChangedValues();if(s)for(var a in s){var r=this.get(a);r&&(e[a]=r)}}}return e},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=e.getChangedValues(),n=[];for(var s in t)null!==i[s]&&n.push(s);return n}})}),define("DS/EditPropWidget/comm/DistantAjax",["UWA/Class","DS/EditPropWidget/comm/CommManager","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/EditPropConstants"],function(e,t,i,n){"use strict";return window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0,e.singleton({_isAsynchronous:!1,_valuesAsync:{},init:function(){this._isAsynchronous=!0===widget.getValue("asynchronousRequest")||"true"===widget.getValue("asynchronousRequest"),widget.setValue("asynchronousRequest","false"),this._valuesAsync={}},_getCommManager:function(e){e.call(this,t)},getAsyncRead:function(e){this._getAsync("read",e)},getAsyncFacetCheck:function(e){this._getAsync("facetCheck",e)},_getAsync:function(e,t){this._isAsynchronous?this._getCommManager(function(i){var n=new i(e);n.createListenEvent(function(e){t(e),n.destroy()}),setTimeout(function(){n.getCurrentListenStatus()||t(null)},100)}):t(null)},_distantCall:function(e,t,i,n){this._getCommManager(function(s){var a=new s(e),r=!1,o=++window.top.perfoIncrem;window.top.performance.mark("start_getAsync:"+o),this._getAsync(e,function(e){e&&window.top.performance.mark("end_getAsync:"+o),!1===r&&e&&e.discriminant===t&&(r=!0,i&&i(e?e.value:e))}),setTimeout(function(){!1===r&&(a.createRunningEvent(),n.call(this,function(e){!1===r&&(r=!0,a.createReadyEvent({value:e,discriminant:t}),i&&i(e))}))}),setTimeout(function(){a&&a.destroy()},12e4)})},getRoles:function(e,t){var n=this;this._distantCall("role",e,t,function(t){i.getGrantedRoles(function(e){t.call(n,e)},e)})},getServices:function(e,t){var n=this;this._distantCall("services",e,t,function(e){i.getServicesUrl({onComplete:function(t){e.call(n,t)}})})},launchMainRead:function(e,i){require(["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"],function(n,s){var a=new t("read");a.createRunningEvent(e),n.getListOfAttributes({modelList:e,tenant:s.getTenantFromModel(e&&e.length>0?e[0]:null),handleRequest:{},navigateToMain:!0,securityContext:i.securityContext,index_mode:i.index_mode,ignoreKernelAccessChecks:"true"===i.ignoreKernelAccessChecks,onComplete:function(e){a.createReadyEvent(e)}}),setTimeout(function(){a&&a.destroy()},12e4)})},launchFacetsVisibility:function(e,t,n,s,a){var r=this,o=["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests"];void 0===this._valuesAsync.facetCheck&&(this._valuesAsync.facetCheck=this._isAsynchronous);var l=this._valuesAsync.facetCheck&&!s,c=!1,d=0;n.handleRequest=n.handleRequest?n.handleRequest:{},n.handleRequest&&(n.handleRequest.handle=i.getCancelObject());var u=n.handleRequest.handle;s?o.push("DS/EditPropWidget/comm/CommManager"):l&&(d=200,this.getAsyncFacetCheck(function(e){1==c||u.isCancelled()||e&&(c=!0,r._valuesAsync.facetCheck=!1,n.onComplete(e))})),require(o,function(i,s,o){setTimeout(function(){if(!0!==c&&!u.isCancelled()){var l=null;o&&((l=new o("facetCheck")).createRunningEvent(e),setTimeout(function(){l&&l.destroy()},12e4)),i.checkFacetsVisibility({handleRequest:n.handleRequest,context:n.context,tenant:s.getTenantFromModel(e),model:e,facets:t,sourceAppId:a,onComplete:function(e){l&&l.createReadyEvent(e),"function"==typeof n.onComplete&&!0!==c&&n.onComplete(e),c=!0,r._valuesAsync.facetCheck=!1}})}},d)})},launchMainReadFromIndexService:function(e,i){require(["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests"],function(n){var s=new t("read");s.createRunningEvent({model:e,options:i});var a={modelList:[e],tenant:e.getTenant(),handleRequest:i.handleRequest,select_predicates:i.predicates,defService:i.service,onComplete:function(e){var t=s.getCurrentComm().status.answer.options;s.createReadyEvent({response:e,options:t})}};i.getPLMParameter&&(a.getPLMParameter=i.getPLMParameter),n.getListOfAttributes(a),setTimeout(function(){s&&s.destroy()},12e4)})},launchFacetsVisibilityFromIndexService:function(e,s,a){var r=this,o=new t("facetCheck");o.createRunningEvent({model:e,facets:s,options:a});var l={};void 0===r._valuesAsync.facetCheck&&(r._valuesAsync.facetCheck=r._isAsynchronous);var c=r._valuesAsync.facetCheck,d=!1;a.handleRequest=a.handleRequest?a.handleRequest:{},a.handleRequest&&(a.handleRequest.handle=i.getCancelObject());var u=a.handleRequest.handle;if(c&&(200,r.getAsyncFacetCheck(function(e){1==d||u.isCancelled()||e&&(d=!0,r._valuesAsync.facetCheck=!1,a.onComplete(e))})),e.get("metatype")===n.METATYPE_BUS){l.id=e.get("objectId"),l.mains={},l.mains[e.get("objectId")]={id:e.get("objectId"),type:e.get("type"),metatype:"bus"};var h={};s.forEach(function(e){e.name&&e.name===n.FACET_iPROPERTIES?h[e.name]={available:!0}:h[e.name]={available:!1}}),l.facets=h,o&&o.createReadyEvent(l),"function"==typeof a.onComplete&&!0!==d&&a.onComplete(l),d=!0,r._valuesAsync.facetCheck=!1}else e.get("metatype")===n.METATYPE_REL&&require(["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/constants/ConstantsMapping"],function(t,i){var c=i.getServiceBySource("3dspace");t.getInstanceDetails({modelList:[e],defService:c,onComplete:function(t){!function(t){if(t&&t.infos&&t.infos.status&&t.infos.status===n.EP_RESPONSE_OK){var i=null,c=null,u=null;t&&t.result&&t.result.length>0&&(t.result.forEach(function(e){for(var t in e)"outputs"===t&&e[t].RELATIONS&&e[t].RELATIONS&&e[t].RELATIONS.length>0&&e[t].RELATIONS.forEach(function(e){e.physicalid&&(i=e.physicalid),e["ds6w:type"]&&e["ds6w:type"],e.to&&e.to.physicalid&&e.to["ds6w:type"]&&(c=e.to.physicalid,u=e.to["ds6w:type"])})}),l.mains={},l.mains[i]={id:c,type:u,metatype:"bus"});var h={};s.forEach(function(e){e.name&&e.name===n.FACET_iPROPERTIES?h[e.name]={available:!0}:h[e.name]={available:!1}}),l.facets=h,l.id=e.get("objectId"),o&&o.createReadyEvent(l),"function"==typeof a.onComplete&&!0!==d&&a.onComplete(l),d=!0,r._valuesAsync.facetCheck=!1}}(t)},primitives:[{navigate_to_rel:{id:1,mode:"return_rel"}}],patterns:{RELATIONS:[{id:1}]},attributes:["ds6w:type"]})})}})}),define("DS/EditPropWidget/facets/Properties/TweakerManager",["UWA/Core","UWA/Class","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o){var l={};l.DEFAULT={type:"DEFAULT",from:function(e){return e.valueDB},to:function(e){return{valueDB:e.value,value:e.displayValue?e.displayValue:e.value}},extraOptions:function(e,t){var i=t.authorizedValuesNLS,n=t.authorizedValues,s=t.authorizedValuesGroup,a=t.authorizedValuesIcon,o=t.customSelect,c=t.sortedOptions,d=!0===t.autocomplete,u=i.length;if(u>0){var h=!1,p=t.get("tw_type"),m=l[p];m&&m.from||(m=l.DEFAULT);for(var g=[],f=[],v=0;v<u;v++){var _=i[v],E=n[v],C={label:_,value:E,group:s?s[v]:null};if(a&&a[v]){var S="icons/16/"+a[v]+".png",y=r.getWebappsAssetUrl("ENOCollabSharingCmds",S);C.icon=y}f.push(C),h||i[v]!==n[v]?h=!0:(E=m.from({value:_,valueDB:E}),_=null,g.push({label:_,value:E}))}return{autocomplete:d,sortedOptions:c,customSelect:o,trueEnum:h,data:{list:h?f:g,range_required:t.authorizedValuesRequired}}}}},l[n.TYPES.BOOLEAN]={type:n.TYPES.BOOLEAN,from:function(e){return!0===e.valueDB||"string"==typeof e.valueDB&&"true"===e.valueDB.toLowerCase()}},l[n.TYPES.RELATION]={type:n.TYPES.RELATION,from:function(e){return{id:e.valueDB,label:e.value&&e.value.label?e.value.label:""}},to:function(e){return{valueDB:e.value?e.value.id:"",value:e.value?e.value:""}},extraOptions:function(e,t){return{data:{rules:t.get("rules")}}}},l[n.TYPES.PERSON]={type:n.TYPES.PERSON,from:function(e){return{personID:e.valueDB,fullName:e.value}},to:function(e){return{valueDB:e.value.personID,value:e.value.fullName}},extraOptions:function(e){return{data:{objectIDs:e.isMergedModel()?e.getMergedModelIds():[e.get("objectId")]}}},check:function(e,t){if(null===t)return{message:o.UnvalidAttribute,type:"error"}}},l[n.TYPES.DATE]={type:n.TYPES.DATE,from:function(e){return a.formatDateObj(e.valueDB)},to:function(e){return{valueDB:a.convertDateToStandard(e.value,!0).valueDB,value:e.displayValue}}},l[n.TYPES.DATETIME]=l[n.TYPES.DATE],l[n.TYPES.BOOLEAN_WUX]=l[n.TYPES.BOOLEAN],l[n.TYPES.DATE_WUX]=l[n.TYPES.DATE],l[n.TYPES.DATETIME_WUX]=l[n.TYPES.DATE],l[n.TYPES.PERSON_WUX]=l[n.TYPES.PERSON],l[n.TYPES.UNIT]={type:n.TYPES.UNIT,from:function(e){return{valueDB:e.valueDB,dimension:e.dimension}},to:function(e){return{valueDB:e.value.valueDB,value:e.displayValue?e.displayValue:e.value.valueDB,dimension:e.value.dimension}}};var c=function(e){var t=l[e.get("tw_type")],i=null;if(t&&t.check){var n=e.get("valueDB");e.multisel&&(n=n[Object.keys(n)[0]]),Array.isArray(n)||(n=[n]),n.every(function(n){return null===(i=t.check(e,n))})}return i};return t.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this.elements={},this.elements.fields={},this._sharedOptions=t,this.onNotification=e.onNotification?e.onNotification:function(){},this.options=this.options?this.options:{},this._setEditable(e&&!0===e.editable)},isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},clear:function(){for(var e in this.elements.fields)this._removeField(e);this.elements.fields={}},actionOnScroll:function(){for(var e in this.elements.fields){var t=this.elements.fields[e];t.field&&"function"==typeof t.field.actionOnScroll&&t.field.actionOnScroll()}},getValidationFunction:function(e){var t=l[e];if(t&&t.check)return c},_getValueForTweaker:function(e,t){var i=e,n=l[i];n&&n.from||(n=l[i="DEFAULT"]);return"boolean_wux"==e&&""==t.value&&""==t.valueDB?null:t.multisel?this.__getValueFromMultiselForConvert(n,t):this.__getValueFromStandardForConvert(n,t)},__getValueFromStandardForConvert:function(e,t){var i=!0===t.multivalue,n=e.type,s=t.value,a=Array.isArray(s)?s:[s],r=s,o=a;"DEFAULT"===n&&t.readOnly||(r=t.valueDB,o=Array.isArray(r)?r:[r]);let l="";void 0!==t.dimension&&null!==t.dimension&&(l=t.dimension,l=Array.isArray(l)?l:[l]);for(var c=a.length,d=[],u=0;u<c;u++){var h=null;h=l.length>0?e.from({value:a[u],valueDB:o[u],dimension:l[0]}):e.from({value:a[u],valueDB:o[u]}),d.push(h)}return i?d:c>0?d[0]:null},__getValueFromMultiselForConvert:function(e,t){var i=t.value,n=t.valueDB;let s=t.dimension;var a={};for(var r in i){var o={value:i[r],valueDB:n[r],multivalue:t.multivalue,readOnly:t.readOnly};if(s){let e=s[r];o.dimension=e}var l=this.__getValueFromStandardForConvert(e,o);a[r]=l}return a},__getValueFromStandardFromTweaker:function(e,t){var i=t.value,n=t.displayValue,s={},a={},r=void 0;if(Array.isArray(i)){s=[],a=[],r=[];for(var o=i.length,l=0;l<o;l++){var c=e.to({value:i[l],displayValue:n[l]});s.push(c.value),a.push(c.valueDB),c.dimension&&r.push(c.dimension)}}else s=(c=e.to({value:i,displayValue:n})).value,a=c.valueDB,c.dimension&&(r=c.dimension);let d={value:s,valueDB:a};return r&&Array.isArray(r)&&r.length>0?d.dimension=r[0]:r&&!Array.isArray(r)&&(d.dimension=r),d},__getValueFromMultiselFromTweaker:function(e,t,i){var n=t.value,s=t.displayValue;valueAttr={},valueDBAttr={};let a={};for(var r in n){i&&i.multivalue&&(n[r]=Array.isArray(n[r])?n[r]:[n[r]],s[r]=Array.isArray(s[r])?s[r]:[s[r]]);var o=this.__getValueFromStandardFromTweaker(e,{value:n[r],displayValue:s[r]});valueAttr[r]=o.value,valueDBAttr[r]=o.valueDB,void 0!==o.dimension&&null!==o.dimension&&(a[r]=o.dimension)}let l={value:valueAttr,valueDB:valueDBAttr};return Object.keys(a).length>0&&(l.dimension=a),l},_getValueFromTweaker:function(e,t,i){var n=l[e];n&&n.to||(n=l.DEFAULT);i.multivalue;var s={value:t.getValue(),displayValue:t.getDisplayValues()};return!0===i.multisel?this.__getValueFromMultiselFromTweaker(n,s,i):this.__getValueFromStandardFromTweaker(n,s)},_generateOptions:function(e,t,i){var n={units:i.dimension,minValue:i.minval,maxValue:i.maxval,minValueIncluded:i.minvalincluded,maxValueIncluded:i.maxvalincluded,multiline:i.multiline,multisel:i.multisel,icon:i.urlIcon,parameter:!!i.attributeID,multivalued:i.multivalue,mandatory:i.mandatory,readOnly:i.readOnly,applySort:i.applySort,type:i.type};this.isReadOnly()&&(n.editable=!1),"prop"===t.facet&&(n.prop=!0);var s=l[e];if(s&&s.extraOptions||(s=l.DEFAULT),s&&s.extraOptions){var a=s.extraOptions(t,i);for(var r in a)n[r]=a[r]}return i.dropdownMode&&(n.dropdownMode=i.dropdownMode),i.dimensionType&&(n.dimensionType=i.dimensionType),n.hasDimension=!(!i.dimensionType||!i.authorizedValues||0!==i.authorizedValues.length),n},_updateValue:function(e,t,i,n,s){if(e.isMergedModel()){var a=e.getMergingModels();for(var r in e.lockModel(!0),a)innerModel=a[r],s?this.__updateValue(innerModel,innerModel.get(t.getIdentifier()),i[r],n[r],s[r]):this.__updateValue(innerModel,innerModel.get(t.getIdentifier()),i[r],n[r]);setTimeout(function(){e.lockModel(!1)})}else this.__updateValue(e,t,i,n,s)},__updateValue:function(e,t,i,n,s){var a=e.getChangedValues(),r=t.getIdentifier(),o=(t.value,t.valueDB),l=t.dimension,c=a[r];if(c)c.value,o=c.valueDB;var d=!1,u="",h="",p="",m="";if(p=null==s?"":s,m=null==l?"":l,d=(u=null==n||null==n?"":Array.isArray(n)?n.sort().toString():n)===(h=null==o||null==o?"":Array.isArray(o)?o.sort().toString():o),u&&h&&!isNaN(u)&&!isNaN(h)&&(d=parseFloat(u)===parseFloat(h)),null!=s&&null!=s&&(d=d&&m===p),!d&&e.isMergedModel()){d=!0;var g=e.getMergingModels();for(var f in g)d=d&&g[f]===o[f]}d||this._modelChangeValue(e,e.get(r),i,n,s)},_modelChangeValue:function(t,i,n,a,r){var o=new s(e.clone(i));return o.set("value",n),o.set("valueDB",a),null!=r&&null!=r&&"string"==typeof r&&o.set("dimension",r),t.set(i.getIdentifier(),o),o},_getOrCreateField:function(e){var t=this.elements.fields[e];return t||(t=this.elements.fields[e]={}),t},_addEventToField:function(e,t,i){var n=this._getOrCreateField(t);n.events||(n.events=[]),n.events.push(i),n.model=e},_addTweakerToField:function(e,t){this._getOrCreateField(e).field=t},_removeField:function(e){var t=this.elements.fields[e];t.field&&("function"==typeof t.destroy?t.destroy():"function"==typeof t.field.destroy&&t.field.destroy()),t.events&&t.model&&t.events.forEach(function(i){t.model.removeEvent(e,i)}),delete this.elements.fields[e]},setError:function(e){},onNotification:function(e){},_manageOnChangeEvent:function(e,t,i,n){var s=function(){setTimeout(function(){i.elements.container?n.call():e.removeEvent(t,s)})};this._addEventToField(e,t,s),e.addEvent("onChange:"+t,s)},_setEditable:function(e){this.editable=e&&!this.isReadOnly()},underEdition:function(){return this.editable&&!this.isReadOnly()},switchMode:function(e){for(var t in this._setEditable(e),this.elements.fields){var i=this.elements.fields[t];i&&i.field&&i.field.switchMode(this.underEdition())}},getTweakerFromId:function(e){return this.elements.fields[e]},getTweaker:function(e,t,s,a,r){var o=this,l=e.get(t),c=this._generateOptions(s,e,l);(e.webUxTweakers||e.propertiesWidgetUI)&&!0===c.trueEnum?s=n.TYPES.ENUM_WUX:e.propertiesWidgetUI||e.webUxTweakers||!0!==c.trueEnum||(s=n.TYPES.ENUM);var d=this._getValueForTweaker(s,l);if(c.value=d,c.events={changes:function(){var i=e.get(t);if(i){var n=o._getValueFromTweaker(s,this,i);o._updateValue(e,i,n.value,n.valueDB,n.dimension)}},notification:function(e){o.onNotification(e)}},a)for(var u in a)c[u]=a[u];i.getTweaker(s,c,function(i){o._addTweakerToField(t,i),o._manageOnChangeEvent(e,t,i,function(){var n=e.get(t),a=o._getValueForTweaker(s,n);i.setValue(a)}),i.switchMode(o.underEdition()),r.call(this,i)})}})}),define("DS/EditPropWidget/models/EditPropHistoryModel",["DS/EditPropWidget/models/HistoryObjectModel"],function(e){"use strict";return function(t){for(var i in this.user="",this.date="",this.event="",this.eventNls="",this.objects=[],this._generationObjectList=function(){if(this.objects&&this.objects.length>0){var t=[];this.objects.forEach(function(i){var n=new e(i);t.push(n)}),this.objects=t}},t)this[i]=t[i];this.set=function(e,t){void 0!==t&&(this[e]=t),"objects"===e&&this._generationObjectList()},this.get=function(e){return this[e]},this._generationObjectList()}}),define("DS/EditPropWidget/facets/Properties/PropertiesUIController",["DS/EditPropWidget/controllers/EditPropUIController","DS/EditPropWidget/utils/AttributesUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i){"use strict";return e.extend({defaultOptions:{},validateModels:function(e){return t.validateModels(e)},validateAttributes:function(e,i){return t.validateAttributes(e,i)},resetValueOfModels:function(e){e||(e=this.getModels()),e.forEach(function(e){e.resetInitialValues()})}})}),define("DS/EditPropWidget/facets/Properties/EditPropBase",["UWA/Class","DS/UIKIT/Tooltip","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/facets/Properties/TweakerManager"],function(e,t,i,n){"use strict";return e.extend({lTooltip:[],elements:{},_sharedOptions:null,init:function(e,t){var i=this;this._sharedOptions=t||{},this._parent(e),this.tweakerManager=new n({editable:!0===e.editMode,onNotification:function(e){i._manageError(e)}},t)},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},switchTweakersStatus:function(e){this.tweakerManager.switchMode(e)},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},_valueIsChanging:function(e,t){},setError:function(e){},_manageError:function(e,t){}})}),define("DS/EditPropWidget/ICard/IdCard",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Mask","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServices/WidgetServices","DS/EditPropWidget/facets/Properties/TweakerManager","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/buttonsBar/ButtonsBar","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l,c,d,u){return e.extend({init:function(e){this._parent.apply(this,arguments),this._showThumbnailsCondition={},this._currentModel=null,this._titleAttr=null,this.elements.container=UWA.createElement("div",{class:"idCardContainer"}),this.elements.thumbnail=UWA.createElement("div",{class:"thumbnail"}),this.elements.attrContainer=UWA.createElement("div",{class:"attributes"}),this.elements.thumbnail.inject(this.elements.container),this.elements.attrContainer.inject(this.elements.container),this.elements.headerContainer=UWA.createElement("div",{class:"header-section"}),this.elements.titleContainer=UWA.createElement("div",{class:"title-section"}),this.elements.title=UWA.createElement("div",{class:"title"}),this.elements.revision=UWA.createElement("div",{class:"revision"}),this.elements.multititles=UWA.createElement("div",{class:"multititles"}),this.elements.title.inject(this.elements.titleContainer),this.elements.revision.inject(this.elements.titleContainer),this.elements.multititles.inject(this.elements.titleContainer),this.elements.actions=new d({classname:"actions-section",minimumSize:200},this.elements.titleContainer),this.elements.actions.inject(this.elements.headerContainer),this.elements.titleContainer.inject(this.elements.headerContainer),this.elements.detailsContainer=UWA.createElement("div",{class:"details-section"}),this.elements.headerContainer.inject(this.elements.attrContainer),this.elements.detailsContainer.inject(this.elements.attrContainer),this.elements.owner=UWA.createElement("span",{class:"owner"}),this.elements.date=UWA.createElement("span",{class:"lastModified text-muted"}),this.elements.owner.inject(this.elements.detailsContainer),this.elements.date.inject(this.elements.detailsContainer),this.tweakerManager=new o({},{readOnly:!1}),this._handlerThumbnailClick=function(){this.dispatchEvent("thumbnailClick")}.bind(this);var t=this,i=[{icon:"expand-up",text:u.get("hideIDCard"),method:"show"},{icon:"expand-down",text:u.get("showIDCard"),method:"hide"}],n=r.getWidgetValue(l.COLLAPSE_IC_PREFERENCE.name),s=0===n||1===n?n:0;this.defaultAction={name:"actionHide",text:i[s].text,icon:i[s].icon,handler:function(){var e=i[s=s?0:1];t.defaultAction.text=i[s].text,t.defaultAction.icon=i[s].icon,r.setWidgetValue(l.COLLAPSE_IC_PREFERENCE.name,s),t._updateFromExpandButton(e)}},this.setActions(e.actions);e=i[s];this._updateFromExpandButton(e)},_updateFromExpandButton:function(e){this.showThumbnail("collapse","show"===e.method),this.elements.detailsContainer[e.method](),this.elements.multititles[e.method](),this.elements.actions.updateButton("actionHide",e)},setActions:function(e){this.elements.actions.setButtons(e),this.elements.actions.addButton(this.defaultAction)},fillFromModel:function(e){this.clearValues();var t=e.getAllAttributes();if(t)for(var i in t){var n=t[i];n instanceof c&&this.setValueForSection(e,n)}if(!e.get("labelAttribute")){var s=e.get(l.MODEL_DS_ATTR+"label");s&&this.setValueForSection(e,s)}},clearValues:function(){this.elements.container&&(this.elements.owner.empty(),this.elements.date.empty(),this.elements.title.empty(),this.elements.multititles.empty(),this.elements.revision.empty())},onResize:function(){this._manageThumbnailDisplay(),this.elements.actions.onResize(),this._computeTitle()},maskThumbnail:function(){var e=this.getThumbnailElement();e&&n.mask(e)},unmaskThumbnail:function(){var e=this.getThumbnailElement();e&&n.unmask(e)},changeThumbnail:function(e,t){this.elements.thumbnail.setStyle("background-image","url("+e+")");var i=this.getThumbnailElement();i&&(this.showThumbnail("url",!!e),!0===t&&i.addClassName("clickable"),i.removeEvent("click",this._handlerThumbnailClick),i.addEvent("click",this._handlerThumbnailClick))},showThumbnail:function(e,t){this._showThumbnailsCondition[e]!==t&&(this._showThumbnailsCondition[e]=t,this.__manageThumbnailDisplay())},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize();showThumbnails=e.width>=350,this.showThumbnail("width",showThumbnails)},__manageThumbnailDisplay:function(){var e=!0;for(var t in this._showThumbnailsCondition)if(!(e=this._showThumbnailsCondition[t]))break;e?this.elements.container.removeClassName("noThumbnail"):this.elements.container.addClassName("noThumbnail")},getThumbnailElement:function(){return this.elements.thumbnail},injectValue:function(e,t,i,n){this.elements[i]&&this._injectValue(e,t,this.elements[i],n)},_injectValue:function(e,t,i,n){var a={readOnly:!0,value:e,postBuild:!1};if(n)for(var r in n)a[r]=n[r];i.empty(),s.getTweaker(t,a,function(e){i.empty(),e.inject(i),n&&n.callback&&n.callback()})},addRevision:function(){if(this.elements.title){var e=this.elements.title.getElementsByClassName("tw_ROValue_content");e&&e.length>0&&this.elements.revision.inject(e[0])}},_computeTitle:function(e){if(this._currentModel){var t=this,i=this._currentModel.getComputedTitle(),n=e;e||(n=this._currentModel.get(this._titleAttr)),n&&(this._titleAttr=n.getIdentifier(),i||(i=n.get("value")));var s=!!(this.elements.container.getSize().width>380);s?this.elements.container.removeClassName("smallSize"):this.elements.container.addClassName("smallSize");var r=this.elements.attrContainer.getSize().width/4,o=i.length>r,l=s,c=s;this.injectValue(i,a.TYPES.STRING,"title",{postBuild:o,maxCharacters:r,multiline:l,forHTML:c,callback:function(){t.addRevision()}})}},setValueForSection:function(e,t){var i=t.get("sectionIdentityCard"),n=!!i;if(n){this._currentModel=e;var s="title"===i;if(s&&(this._computeTitle(t),!0===e.isMergedModel()?this.elements.title.addClassName("EP_MergedTitle"):this.elements.title.removeClassName("EP_MergedTitle")),!0!==e.isMergedModel()){if(s){var o=e.get("revision");o&&this.injectValue(" "+o.get("value"),a.TYPES.STRING,"revision")}else if("ownerName"===i)this.injectValue(t.get("value")+" ",a.TYPES.STRING,"owner");else if("date"===i){var l=t.get("value");l=l||t.get("valueDB"),computedDate=r.formatDateObj(l),this._injectValue(computedDate,a.TYPES.DATETIME,this.elements.date)}}else this.injectValue(t.get("value"),a.TYPES.STRING,"multititles",{multisel:!0})}return n}})}),define("DS/EditPropWidget/models/OccurrenceModel",["UWA/Class/Model","DS/EditPropWidget/models/EditPropModel","UWA/Class/Debug"],function(e,t,i){"use strict";return e.extend(i,{defaults:{isMerging:!1,modelPrefix:"00",secondaryOptionsForFacet:[]},isMergedOccurrence:function(){return!0===this.get("isMerging")},getMergePrefixe:function(){return this.get("modelPrefix")},getAllModels:function(e,i){var n=this._attributes,s=!0===e?[]:{};for(var a in n)if(n[a].model instanceof t&&(!0===e?s.push(n[a].model):s[a]=n[a].model,!0===i))break;return s},_getModelElement:function(e){var t=this.get(e);return t||(t={model:null,options:null}),t},setOptions:function(e,t){var i=this._getModelElement();i.options=t,this.set(e,i)},getOptions:function(e){var t=this.get(e);return t?t.options:null},setModel:function(e,t){var i=this._getModelElement();i.model=t,this.set(e,i)},getModel:function(e){var t=this.get(e);return t?t.model:null},setSecondaryOptionsForFacet:function(e){this.set("secondaryOptionsForFacet",e)},getSecondaryOptionsForFacet:function(){return this.get("secondaryOptionsForFacet")}})}),define("DS/EditPropWidget/facets/Common/FacetsCore",["DS/EditPropWidget/models/CommonAbstract"],function(e){return e.extend({_sharedContext:null,destroyComponent:function(){},onResize:function(){},updateFacet:function(){},getButtons:function(){},onAction:function(e){},onSave:function(){},getExtensions:function(){},nothingToSave:function(){return!0},isActionAvailable:function(e){return!0},init:function(e){this._parent(e),this.elements||(this.elements={})},getTabId:function(){return this.options.tabId?this.options.tabId:""},onRefresh:function(){this.updateFacet()},getContext:function(){return this._sharedContext},switchSaveButton:function(e){this._raiseEvent("switchSave",e)},switchAddButton:function(e){this._raiseEvent("switchAdd",e)},refreshActions:function(){this._raiseEvent("updateActions")},updateReadWriteAccess:function(e){this._raiseEvent("updateRWA",e)},_raiseNotification:function(e,t,i){t=t||"error",this.dispatchEvent("onNotification",{msg:e,eventID:t,customClass:i})},_raiseEvent:function(e,t){e&&this.dispatchEvent("onEvent",{facet:this.getTabId(),eventID:e,value:t})},inject:function(e){var t=this.getUI();t&&(t.hide(),t.inject(e))},show:function(){return this.__callMethodOnUI("show")},hide:function(){return this.__callMethodOnUI("hide")},getOptimalSize:function(){return this.__callMethodOnUI("getSize")},__callMethodOnUI:function(e){var t=this._getUI(),i=t[e];return"function"!=typeof i&&(i=(t=this._getDOMUI())[e]),t?i.call(t):null},getUI:function(){return this._getUI()},_getDOMUI:function(){for(var e=this._getUI();"function"==typeof e.getContent;)e=e.getContent();return e},_getUI:function(){return this.elements?this.elements.container:null},showLoader:function(){this._raiseEvent("switchLoader",!0)},hideLoader:function(){this._raiseEvent("switchLoader",!1)},display:function(e){this.setContext(e),this.show()},setContext:function(e){this._sharedContext!==e&&(this._sharedContext=e,this.updateFacet())}})}),define("DS/EditPropWidget/facets/Common/FacetsBase",["DS/EditPropWidget/facets/Common/FacetsCore","DS/EditPropWidget/constants/EditPropConstants"],function(e,t){return e.extend({_lastUpdatedId:null,_sharedOptions:null,init:function(e,t){this._sharedOptions=t,this._parent.apply(this,arguments),this.elements||(this.elements={})},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},getOccurrence:function(){return this.getContext()},getModel:function(e){var i=null,n=this.getOccurrence();if(n&&(model=this.getOccurrence().getModel(this.getTabId())),e){if(model&&model.get("objectId")===e&&(i=model),!model&&n){var s=n.getAllModels();for(var a in s){var r=s[a];if(r&&r.get("objectId")===e){i=r;break}}}}else n&&(model||(model=this.getOccurrence().getModel(t.FACET_PROPERTIES)),model||(model=this.getOccurrence().getModel(t.MODEL_INIT)),i=model);return i},setContext:function(e){this.setOccurrence(e)},setOccurrence:function(e){var i;if((i=this.getOccurrence())&&e){var n=i.getModel(t.MODEL_INIT),s=i.getModel(t.FACET_PROPERTIES),a=e.getModel(t.MODEL_INIT),r=e.getModel(t.FACET_PROPERTIES);this.getModel();var o=e.getModel(this.getTabId())}if(this._setOccurrence(e),i=this.getOccurrence()){var l=this.getModel();if(!l)return;var c=l.get("objectId");"relationship"==l.get("metatype")&&(c=l.get("selReferenceID"));var d=!0;o&&n.get("objectId")===a.get("objectId")?(d=!1,i.setModel(this.getTabId(),o)):s&&r&&s.get("objectId")===r.get("objectId")?(d=!1,i.setModel(t.FACET_PROPERTIES,s)):n&&n.get("objectId")===a.get("objectId")&&(d=!1,i.setModel(t.MODEL_INIT,n)),(c!=this._lastUpdatedId||d)&&(this._lastUpdatedId=c,this.updateFacet())}},_setOccurrence:function(e){this._sharedContext=e},setModel:function(e){this.getTabId()===t.FACET_iPROPERTIES?this.getOccurrence()&&this.getOccurrence().setModel(t.FACET_PROPERTIES,e):this.getOccurrence()&&this.getOccurrence().setModel(this.getTabId(),e)}})}),define("DS/EditPropWidget/facets/GeneralHistory/History",["DS/EditPropWidget/facets/Common/FacetsBase","DS/WidgetServices/WidgetServices","DS/ENXHistoryUX/View/HistoryFacet","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s){"use strict";return e.extend({defaultOptions:{className:"",nbResults:5},init:function(e){this._parent(e),this.options=e,this._initUI()},_initUI:function(){this.elements={};this.getModel();var e=UWA.createElement("div",{class:"EP_HistoryFacet_Container"});this.elements.container=e},updateFacet:function(e){var n=this,s=n.getModel();let a=n.getOccurrence();if("connection"===s.get("metatype")&&a){let e=a.get("properties");e&&e.model&&(s=e.model)}let r="relationship"===s.get("metatype")?s.get("selReferenceID")?s.get("selReferenceID"):s.get("instrefid"):s.get("objectId"),o="";if(a){let e=a.getSecondaryOptionsForFacet();e&&Array.isArray(e)&&e.length>0&&e.forEach(function(e){"rel"===e.metatype&&(o=e.id)});let t=a.get("_Model_init");if(t&&t.model){let e=t.model;e&&"function"==typeof e.get&&"relationship"===e.get("metatype")&&(e.get("instrefid")||e.get("selReferenceID"))&&(r=e.get("instrefid")?e.get("instrefid"):e.get("selReferenceID"),o=e.get("objectId"))}}t.get3DSpaceUrlAsync({onComplete:function(e){var s=t.getTenantID();s=s&&0!=s.length?"tenant="+s:"tenant=OnPremise";let a={id:[],connection:[],facetLang:t.getLanguage(),securityContext:n.options.securityContextFromAppPreference};r&&a.id.push(r),o&&a.connection.push(o),t.isReplayedODT()?window.top&&(window.top.EP_ODTData={options:a}):0===a.id.length&&0===a.connection.length||i.init(a,n.elements.container)}})}})}),define("DS/EditPropWidget/facets/SwymComments/SwymComments",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","UWA/Class","DS/WidgetServices/WidgetServices","DS/SocialToolbar/SocialToolbar","DS/UIKIT/Scroller","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r){return i.extend(t,e,{_socialView:null,init:function(e){this._socialView=null,this._parent(e),this._initUI()},_initUI:function(){this.elements.container=UWA.createElement("div",{class:"container_SwymComment"}),this.elements.content=UWA.createElement("div",{class:"content_SwymComment"}),this.elements.contentScroll=UWA.createElement("div",{class:"contentScroll_SwymComment"}),this.elements.contentScroll.inject(this.elements.content),this.elements.scroller=new a({element:this.elements.content}).inject(this.elements.container)},updateFacet:function(){this._socialView&&this._socialView.destroy();var e=this;this.elements.contentScroll.empty();var t=this.getModel();if(t){var i=t.get("objectId");"relationship"==t.get("metatype")&&(i=t.get("selReferenceID"));let a=null;t.get("_DS_ATTR_type")&&t.get("_DS_ATTR_type").valueDB?a=t.get("_DS_ATTR_type").valueDB:null===a&&t.get("type")&&t.get("type").valueDB?a=t.get("type").valueDB:null===a&&t.get("ds6w:type")&&t.get("ds6w:type").valueDB&&(a=t.get("ds6w:type").valueDB),n.getServicesUrl({onComplete:function(o){Array.isArray(o)&&o.length>0&&(o=o[0]);var l=t.get("source")?t.get("source"):"3DSpace",c=o[l]?o[l]:o["3DSpace"],d=o["3DSwym"],u=t.identifire?t.identifire+i:i,h=t.path?c+t.path:c;if(c){var p=d||"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com",m=widget.data.parent_x3dAppId;m||(m=widget.data.appId);var g=n.getTenantID(),f={protocol:"3DXContent",version:"",source:"",widgetId:"",data:{items:[{envId:g=g||"OnPremise",serviceId:l,objectId:i,objectType:"",facet:"isSocial"}]}};a&&(f.data.items[0].objectType=a),console.log(JSON.stringify(f)),console.log(encodeURI(JSON.stringify(f))),e._socialView=new s({commentProxyToken:{header:"X-DS-CSRFTOKEN"},events:{onMediaClick:function(e){var i={annotation:e.data.annotationFile};t.clickOnAnnotationData(i,{clean:!0})}},"3DSwymUrl":p,subjectURI:u,tenantId:g,serviceURL:h,enableShare:!1,appForcedLinkUri:"/#app:ENOLCMT_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(f))}),e.elements.contentScroll.empty(),e._socialView.inject(e.elements.contentScroll)}else e._raiseNotification(r.get("CannotFindServerAdress"),"error","SC_FindServer")}})}else UWA.createElement("div",{class:"SC_NoItems",text:r.get("NoItemSelected")}).inject(e.elements.contentScroll)},destroyComponent:function(){this._socialView&&this._socialView.destroy()},onResize:function(){},onRefresh:function(){this.updateFacet()}})}),define("DS/EditPropWidget/facets/Instance/InstanceFacet",["DS/EditPropWidget/facets/Common/PropertiesDerived","DS/EditPropWidget/constants/EditPropConstants"],function(e,t){"use strict";return e.extend({metatype:t.REL})}),define("DS/EditPropWidget/facets/3DPlay/3DPlayFacet",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","UWA/Class","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r){return s.extend(t,e,{player3D:null,_3DViewLaunched:!1,init:function(e){this._parent(e),this._initUI()},_initUI:function(){var e=this;this.elements.container=UWA.createElement("div",{class:"container_3DPlay"}),this.elements.containerHDThumbnail=UWA.createElement("div",{class:"editProp_HDImageContainer",events:{click:function(){e._switchTo3DView(),e._3DViewLaunched=!0}}}),this.elements.containerHDThumbnail.inject(this.elements.container),this.elements.containerHDThumbnail.hide(),this.elements.container3DPlay=UWA.createElement("div",{class:"editProp_3DPlayContainer"}),this.elements.container3DPlay.inject(this.elements.container),this.elements.container3DPlay.hide()},_switchTo3DView:function(e){this.elements.containerHDThumbnail.hide(),this.elements.container3DPlay.show(),this._initPlayer(e)},_switchToHDThumbnail:function(e){this.elements.containerHDThumbnail.show(),this.elements.container3DPlay.hide()},destroyComponent:function(){this._stop3DPlayer()},onResize:function(){},_stop3DPlayer:function(){this.player3D&&(this.player3D.dispose(),this.player3D=null)},getIdentityCardUI:function(){return this.elements.topTable},_initPlayer:function(e){var t=this.getModel();if(t){var s=t.get("type");if(s||(s=t.get(i.MODEL_DS_ATTR+"type")),s){"object"==typeof s&&(s=(s=s.valueDB)||s.value);var o=t.get("objectId");if(this.currentId3DPlay===o&&this.player3D)return;this.elements.container3DPlay.setContent(r.get("3DPlay loading")),this._stop3DPlayer();var l={};!1!==e&&(l.loading="autoplay");var c=this;a.getSourceUrlAsync({platformId:n.getTenantFromModel(t),source:n.getSourceFromModel(t),onComplete:function(e){var i={container:c.elements.container3DPlay,input:{asset:{provider:"EV6",serverurl:e,physicalid:o,dtype:s,tenant:n.getTenantFromModel(t),requiredAuth:"passport",contextId:c.options.securityContextFromAppPreference},usage:"preview"},options:l};require(["DS/3DPlayHelper/3DPlayHelper"],function(e){c.elements.container3DPlay.empty(),c.player3D=new e(i),c.currentId3DPlay=o})}})}}},_handlerUpdateThumbnail:function(e){this._updateThumbnail(e)},updateFacet:function(){this._3DViewLaunched=!1;var e=this.getModel();e&&(e.removeEvent2("onChange:previewUrl",this._handlerUpdateThumbnail),e.removeEvent2("onChange:type_icon_url",this._handlerUpdateThumbnail),e.addEvent("onChange:previewUrl",this._handlerUpdateThumbnail.bind(this,e)),e.addEvent("onChange:type_icon_url",this._handlerUpdateThumbnail.bind(this,e)),this._updateThumbnail(e)),this._stop3DPlayer(),this.onRefresh()},onRefresh:function(){var e=null,t=this.getModel();t&&(e=(e=t.get("previewUrl"))||t.get("type_icon_url"));e&&!0!==this._3DViewLaunched?this._switchToHDThumbnail():this._switchTo3DView(!1)},_updateThumbnail:function(e){var t=this;this._switchToHDThumbnail();var i=e.get("previewUrl");if(i=i||e.get("type_icon_url")){this.elements.HDThumbnail=UWA.createElement("div",{class:"editProp_BigThumbnail"});var n=new Image;n.onload=function(){this.naturalHeight<100?t._switchTo3DView(!1):t.elements.HDThumbnail.setStyle("background-image","url("+this.src+")")},n.src=i,this.elements.containerHDThumbnail.setContent(this.elements.HDThumbnail)}}})}),define("DS/EditPropWidget/facets/EBOMPart/EBOMPart",["DS/EditPropWidget/facets/Common/PropertiesDerived","DS/EditPropWidget/constants/EditPropConstants"],function(e,t){"use strict";return e.extend({metatype:t.BUS,init:function(e){var t={};for(var i in e)t[i]=e[i];t.readOnly=!0,this._parent(t)}})}),define("DS/EditPropWidget/UI/IDCardManager",["DS/EditPropWidget/UI/IDCardSkeleton","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l){"use strict";return window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0,e.extend({_lOccurrences:[],_faceVisibilityHandler:null,defaultOptions:{multiselection:t.MULTISEL_MERGE},init:function(e,t){this._lOccurrences=[],this._faceVisibilityHandler={handle:null},this.sourceAppId=t.sourceAppId,this._parent(e,t)},getModels:function(){var e=this.getOccurrences(),i=[];return e&&e.forEach(function(e){var n=e.getModel(t.MODEL_INIT);n&&i.push(n)}),i},notifyClose:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&"function"==typeof i.onClose&&i.onClose()})},getModel:function(e,t){var i=null;return(t?t.getAllModels(!0):this.getModels()).every(function(t){return e!==t.get("objectId")||(i=t,!1)}),i},_getFirstFacetModel:function(e){var t=null,i=this._getFirstOccurrence();return i&&(t=i.getModel(e)),t},_getFirstInitModel:function(){return this._getFirstFacetModel(t.MODEL_INIT)},_getFirstPropertiesModel:function(){return this._getFirstFacetModel(t.FACET_PROPERTIES)},getOccurrences:function(){return this._lOccurrences},_getFirstOccurrence:function(){return this._lOccurrences.length>0?this._lOccurrences[0]:null},getSharedContext:function(){return this._getFirstOccurrence()},setOccurrences:function(e){var i=window.top.perfoIncrem++;window.top.performance.mark("start_setModelSkeleton:"+i);var n=this;this._clearAllFacetsModels(),this.modelHasChanged=!0;var s=e.length<=0,a=null;if(s||this.options.multiselection===t.MULTISEL_NO&&e.length>1||n.indexModeParameter&&this.options.multiselection&&e.length>1)a=l.get(s?"NoItemSelected":"TooManyObjectSelected");else if(e.length>1&&this.options.multiselection===t.MULTISEL_MERGE){var r,o=(r=e[0]).getModel(t.MODEL_INIT);if(o){var c=o.getMergingModels(),d=null,u=null;for(var h in c){var p=c[h],m=p.get("tenant"),g=p.get("source");if(null===d?d=m:d!==m&&(a=l.get("DifferentTenantsNotSupported")),null===u?u=g:u!==g&&(a=l.get("DifferentSourcesNotSupported")),null!==a)break}}}if(null!==a){if(this.clearIdentityCard(),this.showMainErrorArea(a),this.dispatchEvent("onTitleChanged",""),this.hideMainComponent(),this._lOccurrences=[],n.indexModeParameter)return}else this.showMainComponent(),(r=e[0]).addEvent("onChange:"+t.FACET_PROPERTIES,function(){n._initializeIDCard(r)}),this._initializeIDCard(r),this._lOccurrences=e;window.top.performance.mark("end_setModelSkeleton:"+i),this._manageFacetVisibility(),this._manageFacetLaunching()},__queryFacets:function(e){var t=this;this._faceVisibilityHandler.handle&&(this._faceVisibilityHandler.handle.cancel(),this._faceVisibilityHandler.handle=null);var i=this._getFirstInitModel();if(i){var s=[],a=!1;t._lFacets.forEach(function(e){i.isMergedModel()&&!e.supportMerge||(s.push({name:e.facet.name,inheritance:e.inheritance}),a=a||e.services&&e.services.length>0)}),t.indexModeParameter?n.launchFacetsVisibilityFromIndexService(i,s,{context:this.options.context,handleRequest:this._faceVisibilityHandler,onComplete:function(i){i&&!1!==i.success?e.setAnswer("A",i):t._addNotif({msg:i?i.error.message:l["Error Server"],eventID:"error"})}}):n.launchFacetsVisibility(i,s,{context:this.options.context,handleRequest:this._faceVisibilityHandler,onComplete:function(i){i&&!1!==i.success?e.setAnswer("A",i):t._addNotif({msg:i?i.error.message:l["Error Server"],eventID:"error"})}},void 0,t.sourceAppId)}},_queryFacets:function(e){var t=this;e.addRequest("A");var n=this._getFirstInitModel();if(n){var s=i.getServiceForModel(n);n.get("isTransient")||!0!==s.modelNeeded?t.__queryFacets(e):(e.addRequest("Fed"),require(["DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests"],function(i){i.fillModel({onComplete:function(i){var n=i.get("ds6w:type");if(n=n||i.get("ds6w:what/ds6w:type")){var s=n.get("valueDB");i.set("ds6w:what/ds6w:type_value",s)}i.set("preview_url",i.get("previewUrl")),t.__queryFacets(e),e.setAnswer("Fed",!0)}},n)}))}return!!n},_facetCheck:function(e){var i=this,n=e.getAnswer("A"),o=e.getAnswer("Fed"),l=n.id,c=n.facets,d=i._getFirstInitModel(),u=i._getCurrentSelectedFacet(),h=null!==d&&d.get("objectId")===l,p=null,m=!!o,g=!1;if(h&&n.notification)return this.clearIdentityCard(),this.showMainErrorArea(n.notification.message),this.hideMainComponent(),{success:!1};if(h){var f=i._getFirstOccurrence(),v=n.mains,_=v?v[l]:null,E=l,C="empty",S=null;_&&(E=_.id,C=_.type,S=_.metatype?"bus"==_.metatype?t.METATYPE_BUS:t.METATYPE_REL:t.METATYPE_UNKNOWN);var y=!1,A={};if(p=f.getModel(t.FACET_PROPERTIES),d.isMergedModel()){E=l,C="mergedObject";var I=d.getMergingModels(),b=p&&p.isMergedModel()?p.getMergingModels():null;for(var P in I){var T=I[P],D=v[P],M=null!=D&&D.id?D.id:P,w=t.METATYPE_UNKNOWN;if(w=D.metatype?"bus"==D.metatype?t.METATYPE_BUS:t.METATYPE_REL:w,C=D?D.type:"",!(b?b[M]:null)&&M!==P)y=!0,(F=UWA.clone(T.getOptions())).objectId=M,T=new s(F);T.set("metatype",w),T.set(t.MODEL_DS_ATTR+"type",{valueDB:C,isTransient:!0});var O=w===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;T.set(t.MODEL_DS_ATTR+"types",{valueDB:O?O[C]:null,isTransient:!0}),A[M]=T}p=f.getModel(t.FACET_PROPERTIES)}else null===p&&E===l&&(p=d);if(y||!p){var F,x=p||d,W=x.getAllAttributes();!0!==x.get("isTransient")&&(W=x.getOptions()),(F=UWA.clone(W)).objectId=E,S&&(F.metatype=S),F[t.MODEL_DS_ATTR+"type"]={valueDB:C,isTransient:!0};O=w===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;for(var N in F[t.MODEL_DS_ATTR+"types"]={valueDB:O?O[C]:null,isTransient:!0},F)W[N]instanceof r&&(F[N]=new r(F[N]));d.isMergedModel()?(p=new a(F)).setMergingModels(A):p=new s(F)}else if(p){p.set(t.MODEL_DS_ATTR+"type",{valueDB:C,isTransient:!0});O=w===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;p.set(t.MODEL_DS_ATTR+"types",{valueDB:O?O[C]:null,isTransient:!0})}f.setModel(t.FACET_PROPERTIES,p);c=n.facets;i._lFacets.forEach(function(e){var t=e.facet.name,n=c[t],s=n&&(!0===n||!0===n.available);(e._isVisible=s,!0===e.inheritance&&i._getFacetName(u)===t&&(g=!0),n&&n.information)&&(f.setOptions(t,n.information),i._getFacetName(u)===t&&(m=!0))});let e=n.secondaryOptions;e&&Array.isArray(e)&&e.length>0&&f.setSecondaryOptionsForFacet(e)}return{success:!!p,refreshCurrent:m,refreshAction:g}},_getTenant:function(){var e=this._getFirstInitModel(),t=null;return e&&(t=e.getTenant()?e.getTenant():this._parent()),t},_clearAllFacetsModels:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&i.setOccurrence(null)})},_initializeIDCard:function(e){var i=this;if(e){var n=e.getModel(t.FACET_PROPERTIES);n&&(this._updateThumbnailForModel(n),this.elements.postIdCard&&this.elements.postIdCard.fillFromModel(n),this.elements.postIdCard&&n.addEvent("onChangeAttributes",function(e,t){var n=!1;t.forEach(function(t){t&&t instanceof r&&(n=i.elements.postIdCard.setValueForSection(e,t)||n)})}),n.addEvent("onChange:label",function(){var e=n?n.getComputedTitle():"";i.dispatchEvent("onTitleChanged",e),n.get(t.MODEL_DS_ATTR+"label")&&i.elements.postIdCard&&i.elements.postIdCard.setValueForSection(n,n.get(t.MODEL_DS_ATTR+"label"))}),n.addEvent("onChange:previewUrl",function(){i._updateThumbnailForModel(this)}),n.addEvent("onChange:type_icon_url",function(){i._updateThumbnailForModel(this)}))}},getTitle:function(){var e=this._getFirstOccurrence(),i=e?e.getModel(t.FACET_PROPERTIES):null;return i?i.getComputedTitle():""},_updateThumbnailForModel:function(e){if(!0!==this.options.noThumbnail){var i=e.get("previewUrl")?e.get("previewUrl"):e.get("type_icon_url");i=i||"";var n=this._isFacetAuthorized(t.FACET_VIEWS)||e.get("activeThumbnail");this._updateThumbnail(i,n)}},_getCurrentModelType:function(){var e=this.getModels(),t=e.length>0?e[0].get("type"):"",i=t;return t&&"object"==typeof t&&(i=(i=t.get("valueDB"))||t.get("value")),i}})}),define("DS/EditPropWidget/facets/Instance/IndexInstanceFacet",["UWA/Core","DS/EditPropWidget/facets/Properties/iPropertiesFacet","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/WidgetServices/WidgetServices","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r){"use strict";return t.extend({setOccurrence:function(e){var t=this,s=e?e.getOptions(this.getTabId()):null,a=e?e.getModel(this.getTabId()):null;if(s&&!a){if(s&&"object"==typeof s){var o=s.targets;null!=o&&(o.forEach(function(e){e.id?a=new n({objectId:e.id,metatype:i.METATYPE_REL,type:e.type?e.type:""}):(t._setError(r.get("FedAjax_NotFound"),void 0,"rpl30"+Date.now()),t.hideMainComponent())}),e.setModel(this.getTabId(),a))}}(null==e||e.getModel(this.getTabId()))&&this._parent(e)}})}),define("DS/EditPropWidget/EditPropWidgetHTML",["DS/EditPropWidget/EditPropWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel"],function(e,t,i,n,s){window.top.performance.mark("end_EP_HTMLProperties"),window.top.performance.mark("start_widgetLoading"),window.currentPropertiesOptions||(window.currentPropertiesOptions={});var a=null,r=!0,o=null,l={onLoad:function(){window.top.performance.mark("end_widgetLoading"),window.top.performance.mark("start_managePref");var c,d,u=this;if(!currentPropertiesOptions.selected)if(t.getUrlParameter("selected")){var h=t.getUrlParameter("meta")?t.getUrlParameter("meta"):null,p=t.getUrlParameter("tenant")?t.getUrlParameter("tenant"):null,m=t.getUrlParameter("source")?t.getUrlParameter("source"):null,g=t.getUrlParameter("sourceName")?t.getUrlParameter("sourceName"):null,f={objectId:t.getUrlParameter("selected")};h&&(f.metatype=h),p&&(f.tenant=p),m&&(f.source=m),g&&(f.sourceName=g),currentPropertiesOptions.selected=[new s(f)]}else{var v=t.getWidgetPreference("SelectedItem");if(null!=v&&"object"==typeof v&&(r="true"===t.getWidgetPreferenceValue("loadData")||!0===t.getWidgetPreferenceValue("loadData"),currentPropertiesOptions.selected=Array.isArray(v.value)?v.value:[],"undefined"!=typeof widget)){var _=void 0!==widget.getValue("X3DContentId")?JSON.parse(widget.getValue("X3DContentId")):null;if(null!==_){var E=_.data;if(null!==E){var C=[];if(E.items.length>0)for(null!==(S=E.items[0]).objectId&&void 0!==S.objectId&&C.push(S),itemsLength=C.length,itemsIndex=0;itemsIndex<itemsLength;itemsIndex++){var S;(f={objectId:(S=C[itemsIndex]).objectId,metatype:"businessobject"}).tenant=S.envId,f.source=S.serviceId,f.sourceName=S.serviceId,currentPropertiesOptions.selected=[new s(f)]}}}}}var y=!1;t.isWebInWinEnvironment()?(c=t.getUrlParameter("defaultFacetName"),d=t.getUrlParameter("infoForFacet"),y="true"===t.getUrlParameter("indexModeParameter")||!0===widget.getValue("indexModeParameter")):(c=widget.getValue("defaultFacetName"),d=widget.getValue("infoForFacet"),y="true"===widget.getValue("indexModeParameter")||!0===widget.getValue("indexModeParameter")),t.setWidgetValue("x3dAppId","ENOLCMT_AP"),document.body.addClassName("editPropWidgetHTML");var A="true"===t.getUrlParameter("editMode");void 0===A&&(A="true"===t.getWidgetPreferenceValue("editProperties_editMode"));var I="true"===t.getUrlParameter("updateSession"),b="true"===t.getWidgetPreferenceValue("isTransient"),P=n.STANDARD;b&&(P=n.TRANSIENT);var T="true"===t.getUrlParameter("readonly");T=T||"false"!==widget.getBool("readOnly")&&!1!==widget.getBool("readOnly"),window.top.performance.mark("end_managePref");var D=t.getWidgetValue("securityContextFromAppPreference")?t.getWidgetValue("securityContextFromAppPreference"):null,M=t.getWidgetValue("parent_x3dAppId")?t.getWidgetValue("parent_x3dAppId"):null,w=!!t.getWidgetValue("disableAddExtensionButton");let O=t.getWidgetValue("USE_APP_SECURTIYCONTEXT");O=!!O;let F=t.getWidgetValue("ignoreKernelAccessChecks");F="true"===F,window.top.performance.mark("start_createProp"),a=new e({readOnly:T,showTopBar:!0,setCloseButton:!0,setEditButton:!0,displayType:P,selectionType:n.ALL_SELECTION,editMode:A,defaultFacetName:c,infoForFacet:d,indexModeParameter:y,updateSession:I,topClassHeight:"modal-content",securityContextFromAppPreference:D,sourceAppId:M,disableAddExtensionButton:w,USE_APP_SECURTIYCONTEXT:O,ignoreKernelAccessChecks:F,events:{onTitleChanged:function(e){var t=e||""===e?e:a.getTitle();t=t?t.unescapeHTML():"",widget.setTitle(t)},onDataLoaded:function(){a.onResize(),setTimeout(function(){"undefined"!=typeof dscef&&dscef.sendString("DataLoaded"),!u.changeControlInitialized&&t.isChangeAvailable()&&(u.changeControlInitialized=!0,require(["DS/EditPropWidget/changeAction/passThruJS"],function(e){e.onReady(function(e){var i=t.getWidgetPreference("changeControl"),n=!0;if(i&&i.value){var s=i.value;n=!e.changeIsSetChecker(s)}e.initialize(a.elements.container.elements.container,null,n?"hide":"show","bottom-left",{isEditable:!1}),enoviaServerAuthoringWidget.saveMode="change",n&&(!s||null==s.configurationRevision&&null==s.configurationRevision)||e.set(s)})}))})}}}),window.top.performance.mark("end_createProp");var x=a.getTitle();widget.setTitle(x),widget.body.setContent(a);var W=widget.getView().type;"fullscreen"!=W&&"maximized"!=W&&l._setBodyHeight("600"),(o=t.getWidgetPreference("securityContext"))&&o.value&&(O?i.getInstance({context:{getSecurityContext:function(){return{SecurityContext:o.value}}}}).getValidSecurityContext():i.getInstance({context:{getSecurityContext:function(){return{SecurityContext:o.value}}}}).getSecurityContext());var N=t.getWidgetPreference("isTransient");N&&"false"===N.value&&t.deleteWidgetValue("SelectedItem"),t.setWidgetValue("isTransient","false");var R=widget.body.getParent().getSize();l._setBodyHeight(R.height);var U=currentPropertiesOptions.selected?currentPropertiesOptions.selected:[];window.top.performance.mark("start_initdata"),a.initDatas(U,void 0,void 0,{loadModel:r}),window.top.performance.mark("end_initdata"),currentPropertiesOptions.component=a},onRefresh:function(){a.onRefresh()},onResize:function(e){var t=widget.body.getParent().getSize();l._setBodyHeight(t.height),a.onResize()},onDestroy:function(e){a.destroyComponent()},onViewChange:function(e){var t=e.height;"fullscreen"!==e.type&&"maximized"!==e.type&&(t="600"),t&&l._setBodyHeight("600")},_setBodyHeight:function(e){e&&("auto"!==e&&(e+="px"),widget.body.setStyle("height",e))}};t.isReplayedODT()?setTimeout(function(){l.onLoad()}):widget.addEvent("onLoad",l.onLoad),widget.addEvent("onRefresh",l.onRefresh),widget.addEvent("onResize",l.onResize),widget.addEvent("onViewChange",l.onViewChange),window.addEventListener("unload",l.onDestroy),widget.setAutoRefresh(1e4)}),define("DS/EditPropWidget/facets/History/History",["DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/Abstract","UWA/Class","DS/DataDragAndDrop/DataDragAndDrop","UWA/Json","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/WidgetServices/WidgetServices","DS/WidgetServices/UIInfra/UIInfra","DS/EditPropWidget/models/EditPropHistoryModel","DS/UIKIT/Spinner","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p){"use strict";return i.extend(t,e,{defaultOptions:{className:"",nbResults:5},pictureAPIConfig:{defaultSwym:"https://dsext001-eu1-215dsi0708-3dswym.3dexperience.3ds.com",pictureAPIPrefix:"/api/user/getpicture/login/",pictureAPISuffix:"/format/mini"},init:function(e){this._parent(e),this._initValues(),this._initUI()},_initValues:function(){this._mapItemToDrag={},this.currentStatus={noMoreHistory:!1,lastDate:null,model:null},this.request={getHistory:{handle:null}}},_initUI:function(){var e=this;this.elements={},this.elements.container=UWA.createElement("div",{class:"EP_MainHistoryContainer "+this.options.className}),this.elements.sub_container=UWA.createElement("div",{class:"EP_SS_MainHistoryContainer"}).inject(this.elements.container);var t=UWA.createElement("div",{class:"EP_HistoryFatherContainer"}).inject(this.elements.sub_container);this.elements.historyContainer=UWA.createElement("div",{class:"EP_HistoryContainer"}).inject(t);this.elements.scroller=new r({element:this.elements.sub_container}).inject(this.elements.container),this.elements.scroller.elements.content.addEventListener("scroll",function(){e._actionOnScroll()}),this.elements.sSpinner=new u({className:"hist_small_spinner"}).inject(UWA.createElement("div",{class:"hist_small_spinner_container"}).inject(t)),this.elements.spinner=new u({className:"hist_spinner"}).inject(this.elements.container)},_actionOnScroll:function(){var e=this.elements.historyContainer.getSize(),t=this.elements.scroller.elements.content.getSize(),i=this.elements.sSpinner.elements.container.parentElement.getSize();this.elements.historyContainer.getPosition().y<=t.height-e.height-i.height+2&&this.loadHistory(this.currentStatus.model)},_hideAll:function(){!(this._getAllUIElements().length>0)&&this.elements.historyContainer.hide(),this.elements.spinner.hide(),this.elements.sSpinner.hide()},_showLoader:function(){this._getAllUIElements().length>0?this._showSmallSpinner():this._showMainSpinner()},_showSmallSpinner:function(){this.elements.sSpinner.show()},_showMainSpinner:function(){this._hideAll(),this.elements.spinner.show()},_hideSpinner:function(){this._hideAll(),this.elements.historyContainer.show()},_createChangeNameUI:function(e,t){var i=UWA.createElement("div",{class:"hist_modify_container"});if(t.info){var n=t.info.name;n=n||t.info.value;var s=t.info.was;e&&e.iconType&&UWA.createElement("div",{class:"hist_modify_container_image",html:{tag:"img",class:"EditProp_undraggable",width:"16px",src:e.iconType}}).inject(i);var r=UWA.createElement("div",{class:"hist_modify_container_txt"}).inject(i),o=UWA.createElement("span",{text:n||""}).inject(UWA.createElement("div",{class:"hist_modify_name"}).inject(r)),l=UWA.createElement("span",{text:s||""}).inject(UWA.createElement("div",{class:"hist_modify_name hist_oldName"}).inject(r));new a({delay:{show:400},position:"top left",target:l,body:s?s.escapeHTML():""}),new a({delay:{show:400},position:"top left",target:o,body:n?n.escapeHTML():""})}return i},_addHistory:function(e,t){var i=this,r=UWA.createElement("div",{class:"EP_HistoryElement"}).inject(this.elements.historyContainer),o=t.get("userId");o&&this._userPictureURL(o,{onComplete:function(e){var t=UWA.createElement("img",{tag:"img",class:"EditProp_undraggable img-circle",width:"45px",src:e}).inject(UWA.createElement("div",{class:"EP_HistoryPicture"}).inject(r));t.hide(),t.onload=function(e){r.addClassName("hist_withPicture"),t.show()}}});var d=UWA.createElement("div",{class:"EP_HistoryInfos"}).inject(r),u=t.get("objects"),h=t.get("eventNls"),m=t.get("time"),g=t.get("user"),f="";g||(f="Someone ");var v=u?u.length:0,_=v>1?"s":"",E=null,C="";switch(h){case"addFolder":C=p.replace(p.get(f+"added {0} folder"+_),{0:v});break;case"addContent":C=p.replace(p.get(f+"added {0} content"+_),{0:v});break;case"removeFolder":C=p.replace(p.get(f+"removed {0} folder"+_),{0:v});break;case"removeContent":C=p.replace(p.get(f+"removed {0} content"+_),{0:v});break;case"modify":var S=t.info.nameNls?t.info.nameNls:t.info.name;delete t.info.name,C=p.replace(p.get(f+"changed the attribute {0}"),{0:S}),E=this._createChangeNameUI(e,t);break;case"changeName":C=p.get(f+"changed the name"),E=this._createChangeNameUI(e,t);break;case"create":C=p.get(f+"create the object");break;default:C=p.get(f+"made some changes")}UWA.createElement("div",{html:[{tag:"span",class:"EP_history_user",text:g},{tag:"span",text:" "+C}]}).inject(d);var y=new Date(m).toLocaleString(l.getLanguage());UWA.createElement("div",{class:"EP_History_date",text:y}).inject(d),null!=E&&E.inject(d);var A=UWA.createElement("div",{class:"EP_History_ObjectList"}).inject(d),I=["Workspace","Workspace Vault"];u.forEach(function(t){var r=t.get("type");if(I.indexOf(r)<0){var o=t.get("name"),d=t.get("label");d=d||o;var u=t.get("id"),h=u||0===u,m=h?"exist":"hist_object_delete",g=t.get("iconType"),f=null;g&&(f=UWA.createElement("div",{class:"EP_History_type_icon",html:{tag:"img",width:"16px",class:"EditProp_undraggable",src:g}})),m+=null!==f?"":" withoutThumbnail";var v=UWA.createElement("div",{class:"EP_History_dragObj"}).inject(A);t=UWA.createElement("div",{class:"EP_History_ObjectElement "+m}).inject(v);f&&f.inject(t);var _=UWA.createElement("span",{class:"EP_History_ObjectName",text:d}).inject(t);if(new a({delay:{show:400},target:_,body:d}),h){var E={objectId:u,objectType:r,serviceId:e.source,envId:e.tenant},C=function(e,t,n){if(!t.hasClassName(S)||!0!==n){if(!0!==e.ctrlKey)i.elements.historyContainer.getElements("."+S).forEach(function(e){e.removeClassName(S)}),i._mapItemToDrag={};t.toggleClassName(S),t.hasClassName(S)?i._mapItemToDrag[u]=E:i._mapItemToDrag[u]&&delete i._mapItemToDrag[u]}},S="hist_objectSelected";t.addEvents({click:function(e){C(e,this)}}),n.draggable(t,{protocol:"3DXContent",version:"1.1",source:"ENOLCMT_AP",widget_id:l.getWidgetId(),data:void 0,start:function(e,n){C(n,t,!0),i._mapItemToDrag[u]=E;var a=[];for(var r in i._mapItemToDrag)a.push(i._mapItemToDrag[r]);var o={data:{items:a}},l=s.encode(o);n.dataTransfer.setData("text",l),c.createGhostDnD(n,{number:a.length,className:"Hist_ghost"})},stop:function(){}})}else new a({position:"bottom",delay:{show:400},target:t,body:p.get("This object is not accessible")})}})},launchHistory:function(e){var t=e.length,i=!1;if(t===(this.currentStatus.model?this.currentStatus.model.length:0)){i=!0;for(var n=0;n<t&&!1!==(i=e[n].get("objectId")===this.currentStatus.model[n].get("objectId"));n++);}i||(this.clearHistory(),this.loadHistory(e))},clearHistory:function(){this._endOfRequest(),this.currentStatus.lastDate=null,this.currentStatus.noMoreHistory=!1,this._getAllUIElements().forEach(function(e){e.remove()})},_getAllUIElements:function(){return this.elements.historyContainer.getElements(".EP_HistoryElement")},_userPictureURL:function(e,t){var i=this;l.get3DSwymUrlAsync({onComplete:function(n){var s=n||i.pictureAPIConfig.defaultSwym,a=s?s+i.pictureAPIConfig.pictureAPIPrefix+e+i.pictureAPIConfig.pictureAPISuffix:"";t.onComplete.call(null,a)}})},updateFacet:function(e){this.clearHistory(),this.loadHistory(this.getModel())},loadHistory:function(e){var t=this;null==e||Array.isArray(e)||(e=[e]),this.request.getHistory.handle&&e&&this.currentStatus.model&&(e.length!=this.currentStatus.model.length||e[0].get("objectId")!=this.currentStatus.model[0].get("objectId"))&&(this.request.getHistory.handle.cancel(),this.request.getHistory.handle=null);var i=null===this.currentStatus.lastDate;if(!1===t.currentStatus.noMoreHistory&&!this.request.getHistory.handle&&e){this.currentStatus.model=e,this._showLoader();var n=e[0].get("source"),s={modelList:e,tenant:e[0].getTenant(),nbResult:this.options.nbResults,onComplete:function(e){i&&t.clearHistory(),t._endOfRequest(),e.results?e.results.forEach(function(e){if(e.lastTime&&(t.currentStatus.lastDate=e.lastTime),e.history){var i={id:e.id,type:e.type,iconType:e.iconType,source:n,tenant:e.tenant};t.getModel(i.id)&&(0===e.history.length&&(t.currentStatus.noMoreHistory=!0),e.history.forEach(function(e){var n=new d(e);null!==n.info&&void 0!==n.info.name&&void 0!==n.info.was?n.info.name!==n.info.was&&t._addHistory(i,n):t._addHistory(i,n)}),t._actionOnScroll())}e.error&&t._setError({message:e.error})}):t._setError({message:p.get("can't find history")})},onFailure:function(e){t._endOfRequest(),t._setError(e)}};this.currentStatus.lastDate&&(s.lastDate=this.currentStatus.lastDate),s.handleRequest=this.request.getHistory,s.handleRequest.handle=l.getCancelObject().handler,o.getHistory(s)}},_endOfRequest:function(){this.request.getHistory.handle=null,this._hideSpinner()},_setError:function(e,t,i){this._raiseNotification(e,t,i)}})}),define("DS/EditPropWidget/ajaxRequests/3DDriveAjaxRequest",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/utils/EditPropUtils","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o){"use strict";var l={},c={},d={},u=function(e,t,i){var n=e[t];n?(!0==!n.multivalue&&(n.value=[n.value],n.valueDB=[n.valueDB],n.multivalue=!0),n.value.push(i.value),n.valueDB.push(i.valueDB)):e[t]=i};return{checkFacetsVisibility:function(e){var t={};if(null!=e.facets&&e.facets.length>0)for(var n=0;n<e.facets.length;n++){var s=e.facets[n].name;"properties"===s?t[i.FACET_PROPERTIES]=!0:"social"===s?t[i.FACET_SWYMCOMMENTS]=!0:t[i.FACET_PROPERTIES]=!0}else t[i.FACET_PROPERTIES]=!0;e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getSourceId:function(e){var t=n.getSupportedServices(),i=void 0,s="",a=e.get("sourceName");return a&&(i=t[a.toLowerCase()]),i||(a=e.get("source"))&&(i=t[a.toLowerCase()]),i&&i.fedPrefix&&(s=i.fedPrefix),s},fillModel:function(e,t){var i=e.onComplete;return e.onComplete=function(e){e&&e.results&&e.results.length>0&&s.fillFromServer(e.results[0],t,{}),i.apply(this,[t])},e.modelList=[t],this.getListOfAttributes(e)},getIdFromModel:function(e){var t=this.getSourceId(e),i=e.get("objectId");return i=i||"",t&&0!==i.indexOf(t)?t+':"'+i+'"':i},_getModelType:function(e){var t,i=e.get("ds6w:type");t="string"==typeof i?i:i?i.get("valueDB"):"";var n=e.get("source");t||"3DSwym"!==n||0==e.get("objectId").indexOf("iam")&&(t="pno:Person");return t},getListOfAttributes:function(i){var n=i.modelList;i.securityContext;if(n.length){var s=n[0],a=s.get("objectId"),r="";if(a){r="/search";var o=[];s.get("sourceName")&&("3DDrive"===s.get("sourceName")?o.push("drive"):o.push(s.get("sourceName"))),i.model=s,i.idModel=a,i.onCompleteWS=this._onCompleteFederated.bind(this);var l=e.getLanguage(),c=e.getCancelObject();this.getMask({"ds6w:type":{valueDB:this._getModelType(s)}},function(e){var n=[];e.Write.attributes.forEach(function(e){var t=e.name;n.push(t)});var a=this.getIdFromModel(s),d={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!0,with_nls:!1,locale:l,query:a,tenant:t.getTenantFromModel(s),source:o,select_predicate:n,start:0,select_file:["icon","thumbnail_2d"]},u="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();d.label=u,i.source="3DSearch",c.handler=t.createRequest(i,"POST",r,d)});return c}}},getElementsNls:function(t,i){t&&t.length>0?r.getResourcesInfo(t.join(","),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2018x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},getValuesNls:function(t,i){t?r.getNlsOfPropertiesValues(JSON.stringify(t),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},_callMask:function(e,t,i){var n=this;d[e]?i.call(n,d[e]):require([t],function(t){(t=JSON.parse(t))[e]?d[e]=t[e]:d[e]=t,i.call(n,d[e])})},getMask:function(e,t){var i=e["ds6w:type"];i&&"pno:Person"===i.valueDB?this._callMask("Person","text!DS/EditPropWidget/assets/masks/3DSwym/Person.json",t):this._callMask("Default","text!DS/EditPropWidget/assets/masks/Federated/default.json",t)},_onCompleteFederated:function(i,n){var s=this,a=i.results,r={source:"Federated"},d=[],h={};if(r.data=d,a&&a.length>0){var p={},m={},g={},f={},v=null,_=null,E=a[0],C={};for(var S in E.attributes.forEach(function(t){var i=t.name,n=i,s=t.value;s=void 0===s?"":s;var a="ds6w_facet"===t.format,o=a;if(a){var d=i.split("/");n=d[d.length-1]}if(a=a||"attribute"===t.format){v=!0===o?f:m,_=!0===o?g:p;var E=t.type,S=!1;if("date"===E){var y=Date.parse(s),A=new Date(y);A&&(s=(s=e.convertDateToStandard(A,!0)).valueDB,"ds6w:modified"!==n&&"ds6w:created"!==n||(E="datetime"))}else S="string"===E;0===s.indexOf(n)&&(s=s.replace(n+".",""));var I=void 0!==t.dispValue,b=I?t.dispValue:s;if(S&&!I){var P=c[n];b=s;var T=P?P[s]:null;if(T)b=T;else{var D=C[n];D||(D=[],C[n]=D),D.push(s)}}var M={name:n,selectable:n,path:i,type:E,value:b,valueDB:s,readOnly:!0,nls:n};"ds6w:label"===n&&(h=M);var w=l[n];w?(M.nls=w.nlsName,u(v,n,M)):u(_,n,M)}else"resourceid"===n?r.physicalID=s:r[i]=s}),g)p[S]||(p[S]=g[S]);for(var S in f)m[S]||(m[S]=f[S]);n.idModel&&(r.physicalID=n.idModel),r.computed={label:h};var y=Object.keys(p),A=new Promise(function(e){s.getElementsNls(y,{tenant:t.getTenantFromModel(n.model),onComplete:function(t){e(t)}})}),I=new Promise(function(e){s.getValuesNls(C,{tenant:t.getTenantFromModel(n.model),onComplete:function(t){e(t)}})});Promise.all([A,I]).then(function(e){var i=e[0],a=e[1];if(i)if(!1!==i.success){var o=i||{};o.vocabularyElementNLSInfo&&o.vocabularyElementNLSInfo.forEach(function(e){var t=p[e.uri];"Predicate"===e.type?l[e.uri]=e:c[e.uri]=e,t&&e.nlsName&&(t.nls=e.nlsName,m[e.uri]=t)})}else t._raiseError(i.error?i.error.message:"Error",n);for(var u in a){var h=m[u];if(h){var g=a[u];if(h.multivalue){var f=[];h.value.forEach(function(e){var t=g[e];f.push(t||e)}),h.value=f}else h.value=g[h.value]?g[h.value]:h.value}}s.getMask(m,function(e){e.Write.attributes.forEach(function(e){var t=e.name,i=m[t];i&&d.push(i)}),n.onComplete.call(null,{results:[r]})})})}else t._raiseError(o.get("FedAjax_NotFound"),n)}}}),define("DS/EditPropWidget/EditPropComponent",["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/popup/EditPropPopup"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},_getController:function(e){return this.elements.popup=this.elements.popup?this.elements.popup:new t(e),this.controller?this.controller:this.elements.popup.getController()}})}),define("DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests",["DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/EditPropWidget/ajaxRequests/MultipleAsynchronousRequests","DS/EditPropBaseUX/scripts/EditPropUtility","DS/WAFData/WAFData","DS/EditPropWidget/utils/EditPropUtils","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r){"use strict";return{createRequest:function(e,t,i,n){var s=this;e&&!1===e.withChange?s._createRequestWithAuthoringContext(e,t,i,n):require(["DS/EditPropWidget/changeAction/passThruJS"],function(a){a.onReady(function(a){s._createRequestWithAuthoringContext(e,t,i,n,a)})})},_createRequestWithAuthoringContext:function(n,a,r,o,l){var c=this;if(n.handleRequest){if(n.handleRequest.handle&&"function"==typeof n.handleRequest.handle.isCancelled&&n.handleRequest.handle.isCancelled())return}else n.handleRequest={};var d=["A"];e.isChangeAvailable()&&l&&d.push("B"),!0===n.withSC&&d.push("C");var u=new i(d,function(){var t=this.getAnswer("A"),i=this.getAnswer("B"),l=this.getAnswer("C");l=l||n.securityContext;var d=t+r,u={Accept:"application/json","content-type":"application/json"};if(u["Accept-Language"]=e.getLanguage(),i){var h="silent"===n.withChange&&"object"==typeof o;for(var p in i)h?void 0===o[p]&&(o[p]=i[p]):u[p]=i[p]}l&&(u.SecurityContext=encodeURIComponent(l));var m=n.contentType?n.contentType:"json";if(n.headers)for(var p in n.headers)u[p]=n.headers[p];var g={type:m,method:a,timeout:36e5,proxy:"passport",headers:u,cache:-1,onComplete:function(e){n.onCompleteWS(e,n)},onFailure:function(e,t,i){c._onFailure(e,t,i,n)},onTimeout:function(e){c._onTimeout(n)}};e.getWidgetValue("isStandalone")||(g.authentication="passport"),o&&(g.data="json"!==m?o:UWA.Json.encode(o)),n.handleRequest.handle=s.handleRequest(c._formatUrl(n.model,d),g)});n.handleRequest.handle=e.getSourceUrlAsync({platformId:this.getTenantFromModel(n.model),source:n.source?n.source:this.getSourceFromModel(n.model),onComplete:function(e){u.setAnswer("A",e)}}),!0===n.withSC&&t.getInstance({tenant:this.getTenantFromModel(n.model)}).getValidSecurityContext({onSuccess:function(e){u.setAnswer("C",e.SecurityContext)},onFailure:function(e){console.log(" -- >> Can't get the security context"),u.setAnswer("C",null)}}),e.isChangeAvailable()&&l&&l.get2(function(e){var t=null;l.changeIsSetChecker(e)&&(t=e.AuthoringContextHeader),e.errorMessage&&console.log("Change : "+e.errorMessage),u.setAnswer("B",t)})},getTenantFromModel:function(t){var i=t?t.get("tenant"):null;return i=i||e.getTenantID()},getSourceFromModel:function(e){return e?e.get("source"):null},_formatUrl:function(e,t){var i=this.getTenantFromModel(e);return this._formatUrl2(i,t)},_formatUrl2:function(e,t){if(e){var i=t.indexOf("?");i<0&&(t+="?"),i>0&&i<t.length-1&&(t+="&"),t=t+="tenant="+e}return t},getExtraValues:function(e,t){var i={},n=[];return e.forEach(function(e){i[e]=!0}),t.forEach(function(e){i[e]||n.push(e)}),n},_createJSONModifiedAttribute:function(t){var i=[],n=["physicalid","modified"],s={},r={},o=t.getChangedValues(),l={},c={};for(var d in o){var u=t.get(d),h=u.facet;if("object"==typeof u&&!u.isTransient){var p=u.attributeID;if(null!=p&&p.length>0)this._addPLMParameterQuery(u,i);else{var m=u.getChangedIds();for(var g in m){var f=m[g];"a"===g&&(g=t.get("objectId"));var v=l[g];v||(v=[],l[g]=v),(D=c[g])||(D=[].concat(n),c[g]=D),D.push(u.select);var _=f.valueDB;!1!==_&&null==_&&(_=f.value);{var E=null;Array.isArray(_)||"string"==typeof _||(E=_.toString()),null===E&&(E=_);var C=null;if(null!==u.from){var S=null,y=null;if(u.multivalue?(S=this.getExtraValues(u.valueDB,u.initialsValues.valueDB),y=this.getExtraValues(u.initialsValues.valueDB,u.valueDB)):u.valueDB!==u.initialsValues.valueDB&&(S=u.initialsValues.valueDB?[u.initialsValues.valueDB]:null,y=u.valueDB?[u.valueDB]:null),y&&y.length>0&&(C={op:"connect",path:u.path,relation:u.relation,name:u.name,from:u.from,value:y}),S&&S.length>0){var A={op:"disconnect",path:u.path,relation:u.relation,from:u.from,name:u.name,value:S};C?v.push(A):C=A}}else C={op:"replace",path:u.path,value:E};h&&(C.facet=h);var I=u.get("unitName");let t=u.get("dimensionType");if(t){let i=u.get("dimension");if("object"==typeof i&&(i=i[g],I=I[g]),""!==i||void 0!==i||null!==i){let n=null;if(a&&"function"==typeof a.getDimensionUnitName)n=a.getDimensionUnitName(t,i);else{let s=e.getValue("DimensionsDictionary");n=this._getDimensionUnitName(s,t,i)}C.unitName=n||i}C.dimensionType=u.get("dimensionType")}C&&v.push(C)}}}}}var b=t.get("metatype"),P="model/";P+="businessobject"==b||"bus"==b?"bus/":"EBOM"==b?"EBOM/":"rel/";var T=[];for(var g in l){var D;r={path:P+g,method:"PATCH",body:l[g]};(D=c[g])&&(s={select:D},r.queryParams=s),T.push(r)}return{requests:T,plmParametersRequests:i}},_addPLMParameterQuery:function(e,t){var i=e.valueDB;!1===i||i||(i=e.value);var n=[],s=[],a={},r=null;if(Array.isArray(i)||"string"==typeof i||(r=i.toString()),null===r&&(r=i),n.push(e.name),s.push({op:"replace",path:e.path,value:r}),null!=n){var o={select:n};a.queryParams=o}a.body=s;var l="plmparameter/"+e.attributeID;a.path="model/"+l;a.method="PATCH",t.push(a)},_concatRequestListComposite:function(e,t){t.forEach(function(t,i){var n=!1;e.every(function(i,s){return t.path!=i.path||t.method!=i.method||(e[s].body=e[s].body.concat(t.body),e[s].queryParams.select=e[s].queryParams.select.concat(t.queryParams.select),n=!0,!1)}),!1===n&&e.push(t)})},securityContextDispatcher:function(e,i){var n=this;if(e.securityContext)i.call(this,e);else{var s=null;s=t.getInstance({tenant:e.tenant}).getValidSecurityContext({context:e.context,onSuccess:function(t){e.securityContext=t.SecurityContext,i.call(n,e)},onFailure:function(t){n._onFailure(null,{error:t},null,e)}}),e.handleRequest&&s&&(e.handleRequest.handle=s)}},_onCompleteAttributes:function(e,t){t.onComplete.call(null,e)},_onCompleteCommit:function(e,t){t.onComplete.call(null,e)},_onFailure:function(e,t,i,s){var a={};if(null!=t&&t.hasOwnProperty("error")&&"EDITPROP_ERROR_0001"===t.error)a={message:r.get("UpdateFailedDueToFrozenModelConnected"),code:"ERROR"},this._raiseError(a,s);else if(null!=t&&t.hasOwnProperty("error")&&"ErrorCode:1500572"===t.error){var o={level:"error",title:UWA.i18n("InvalidCSCreationfailed"),subtitle:UWA.i18n("InvalidCSCreationFailedSubtitle"),message:UWA.i18n("NoAccessToCS")};n.showMessageOnUI(o.level,o.title,o.subtitle,o.message,!1)}else if(null!=t&&t.hasOwnProperty("error")&&"INF102"===t.error.code){o={level:"error",title:UWA.i18n("NoaccesstoApptitle"),subtitle:UWA.i18n("NoaccesstoAppDesc"),message:""};n.showMessageOnUI(o.level,o.title,o.subtitle,o.message,!1)}else a=null!=t&&t.hasOwnProperty("error")?t.error:{message:r.get("Error Server"),code:"ERROR"},this._raiseError(a,s)},_raiseError:function(e,t){"object"!=typeof e&&(e={message:e}),t.onComplete.call(null,{success:!1,error:e})},_onTimeout:function(e){var t={message:r.get("ErrorTimeOut"),code:"TO"};this._raiseError(t,e)},_getDimensionUnitName:function(e,t,i){let n=t.startsWith("DSDim_")&&t.substring(6,t.length),s=e.get(n);i=i&&i.trim();let a=[],r="";return s&&s.Units&&Array.isArray(s.Units)&&(a=s.Units.filter(e=>e.label===i||e.Name===i)),a.length>0&&a[0].Name&&(r=a[0].Name),r}}}),define("DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/utils/EditPropUtils","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/EditPropWidget/assets/settings/SettingsForServices.json","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={},d={},u={};o=JSON.parse(o);var h=function(e,t,i){var n=e[t];n?(!0==!n.multivalue&&(n.value=[n.value],n.valueDB=[n.valueDB],n.multivalue=!0),n.value.push(i.value),n.valueDB.push(i.valueDB)):e[t]=i};return{getPreviewUrl:function(e){if(!e.ids&&e.modelList){var t=this;e.ids=[],e.modelList.forEach(function(i){var n=t.getIdFromModel(i);n&&e.ids.push(n)})}this._getPreviewUrl(e)},_getPreviewUrl:function(i){var n=this,s=i.ids,r=s.length;r&&(i.handleRequest.handle=e.get3DSearchUrlAsync({platformId:i.tenant,onComplete:function(o){var l=o+"/search",c=e.getLanguage(),d="",u="";s.forEach(function(e){d+=u+e,u=" OR "});var h={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!1,nresults:r,locale:c,query:d,tenant:i.tenant,start:0,select_file:["icon","thumbnail_2d"]},p="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();h.label=p;var m={Accept:"application/json","content-type":"application/json"};m["Accept-Language"]=e.getLanguage();var g={type:"json",method:"POST",timeout:24e4,data:UWA.Json.encode(h),proxy:"passport",headers:m,cache:-1,onComplete:function(e){n.onCompletePreview(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(g.authentication="passport"),i.handleRequest.handle=a.handleRequest(t._formatUrl2(i.tenant,l),g)}}))},onCompletePreview:function(e,t){var i=[];e&&e.results&&e.results.forEach(function(e){var t=null,n=null,s=!0;e.attributes&&e.attributes.every(function(e){return"resourceid"===e.name&&(t=e.value),"preview_url"===e.name&&(n=e.value),s=!(null!=t&&null!=n)}),s||i.push({id:t,preview:n})}),t.onComplete(i)},checkFacetsVisibility:function(e){var t={};t[i.FACET_PROPERTIES]=!0,e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getSourceId:function(e){var t=e.get("sourceName");t=t||e.get("source");var i="",s=n.getSupportedServices()[t.toLowerCase()];return s&&s.fedPrefix&&(i=s.fedPrefix),i},fillModel:function(e,t){var i=e.onComplete;return e.onComplete=function(e){e&&e.results&&e.results.length>0&&s.fillFromServer(e.results[0],t,{}),i.apply(this,[t])},e.modelList=[t],this.getListOfAttributes(e)},getIdFromModel:function(e){var t=this.getSourceId(e),n=e.get("objectId");return e.get("metatype")===i.METATYPE_REL&&e.get("selReferenceID")&&(n=e.get("selReferenceID")),n=n||"",t&&0!==n.indexOf(t)?t+':"'+n+'"':n},getQueryForIndexService:function(e){let t=e.get("objectId"),n=e.get("i3dxId");e.get("metatype")===i.METATYPE_REL&&e.get("selReferenceID")&&(t=e.get("selReferenceID"));let s="";return s=n?`[ds6w:i3dx]:"${n}"`:`[ds6w:resourceUid]:"${t}"`},_getModelType:function(e){var t,i=e.get("ds6w:type");t="string"==typeof i?i:i?i.get("valueDB"):"";var n=e.get("source");t||"3DSwym"!==n||0==e.get("objectId").indexOf("iam")&&(t="pno:Person");return t},getListOfAttributes:function(n){var s=n.modelList;n.securityContext;if(s.length){var a=s[0],r=a.get("objectId");a.get("metatype")===i.METATYPE_REL&&a.get("selReferenceID")&&(r=a.get("selReferenceID")),a.get("i3dxId")&&(r=a.get("i3dxId"));var l="";if(r){l="/search";n.model=a,n.idModel=r,n.onCompleteWS=this._onCompleteFederated.bind(this);var c=e.getLanguage(),d=e.getCancelObject();if(a.get("indexModeParameter")&&n.select_predicates&&Array.isArray(n.select_predicates)&&n.select_predicates.length>0){let e=this.getQueryForIndexService(a),i=[],s=a.get("source");if(s){let e=o[s.toUpperCase()];e&&e.keyOnFedSearch&&i.push(e.keyOnFedSearch)}var u={with_indexing_date:!1,with_synthesis:!0,with_synthesis_attribute:!0,with_nls:!1,locale:c,query:e,tenant:t.getTenantFromModel(a),source:i,select_predicate:n.select_predicates,start:0,select_file:["icon","thumbnail_2d"]};n.getPLMParameter&&(u.source=["3dspace"],u.specific_source_parameter={"3dspace":{plmparam:{retrieve_plmparam:!0}}});var h="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();u.label=h,n.source="3DSearch",d.handler=t.createRequest(n,"POST",l,u)}else this.getMask({"ds6w:type":{valueDB:this._getModelType(a)}},function(e){var i=[];e.Write.attributes.forEach(function(e){var t=e.name;i.push(t)});var s=this.getIdFromModel(a),r=[];a.get("indexSource")?r.push(a.get("indexSource").toLowerCase()):a.get("sourceName")&&r.push(a.get("sourceName").toLowerCase());var o={with_indexing_date:!1,with_synthesis:!0,with_synthesis_attribute:!0,with_nls:!1,locale:c,query:s,tenant:t.getTenantFromModel(a),source:r,select_predicate:i,start:0,select_file:["icon","thumbnail_2d"]};i&&(n.select_predicates=i),n.getPLMParameter&&(o.source=["3dspace"],o.specific_source_parameter={"3dspace":{plmparam:{retrieve_plmparam:!0}}});var u="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();o.label=u,n.source="3DSearch",d.handler=t.createRequest(n,"POST",l,o)});return d}}},getElementsNls:function(t,i){t&&t.length>0?r.getResourcesInfo(t.join(","),{tenantId:i.tenant,lang:e.getLanguage(),apiVersion:"R2018x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},getValuesNls:function(t,i){if(t){var n={};for(var s in t)Array.isArray(t[s])&&(n[s]=[],t[s].forEach(function(e){n[s].push({value:t[s][0],source:[i.service]})}));r.getNlsOfPropertiesValuesBySource(n,{tenantId:i.tenant,serviceName:i.service,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}}),r.getPropertiesForClass(JSON.stringify(t),{tenantId:i.tenant,serviceName:i.service,lang:e.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}})}else i.onComplete.call(this,null)},_callMask:function(e,t,i){var n=this;u[e]?i.call(n,u[e]):require([t],function(t){(t=JSON.parse(t))[e]?u[e]=t[e]:u[e]=t,i.call(n,u[e])},function(t){require(["text!DS/EditPropWidget/assets/masks/Federated/default.json"],function(t){(t=JSON.parse(t))[e]?u[e]=t[e]:u[e]=t,i.call(n,u[e])})})},getMask:function(e,t){var i=e["ds6w:type"];if(i&&"pno:Person"===i.valueDB)this._callMask("Person","text!DS/EditPropWidget/assets/masks/3DSwym/Person.json",t);else{var n=i.valueDB;if(null!=n&&""!=n){var s=n.split(":")[1];if(null!=s&&null!=s&&""!=s){var a="text!DS/EditPropWidget/assets/masks/Federated/"+(s+".json");this._callMask(i&&i.valueDB,a,t)}else this._callMask("Default","text!DS/EditPropWidget/assets/masks/Federated/default.json",t)}else this._callMask("Default","text!DS/EditPropWidget/assets/masks/Federated/default.json",t)}},_onCompleteFederated:function(i,n){var s=this,a=i.results,r={source:"Federated"},o=[],u={},p={};if(r.data=o,a&&a.length>0){var m={},g={},f={},v={},_=null,E=null,C=a[0],S={};for(var y in C.attributes.forEach(function(t){var i=t.name,a=i,o=t.value;o=void 0===o?"":o;var l="ds6w_facet"===t.format,C=l;if(l){var y=i.split("/");a=y[y.length-1]}if(l=l||"attribute"===t.format){_=!0===C?v:g,E=!0===C?f:m;var A=t.type,I=!1;if("date"===A){var b=Date.parse(o),P=new Date(b);P&&(o=(o=e.convertDateToStandard(P,!0)).valueDB,"ds6w:modified"!==a&&"ds6w:created"!==a||(A="date"))}else"double"===A.toLowerCase()?A="real":I="STRING"===A.toUpperCase();0===o.indexOf(a)&&(o=o.replace(a+".",""));var T=void 0!==t.dispValue,D=T?t.dispValue:o;if(I&&!T){var M=d[a];D=o;var w=M?M[o]:null;if(w)D=w;else{var O=S[a];O||(O=[],S[a]=O),O.push(o)}}var F={name:a,selectable:a,path:i,type:A,value:D,valueDB:o,readOnly:!0,nls:a};"ds6w:label"===a&&(u=F);var x=c[a];x?(F.nls=x.nlsName,h(_,a,F)):h(E,a,F)}else"resourceid"===a?r.physicalID=o:t.format.startsWith("PLMPARAM")||(r[i]=o);n.getPLMParameter&&(p=s.parsePLMParamater(t,p))}),Object.keys(p).length>0&&(r.PLMParametersAvailableForIndexMode=!0),f)m[y]||(m[y]=f[y]);for(var y in v)g[y]||(g[y]=v[y]);n.idModel&&(r.physicalID=n.idModel),r.computed={label:u};var A=Object.keys(m);if(C.attributes.length>0&&n.select_predicates)for(var I=0;I<n.select_predicates.length;I++)A.includes(n.select_predicates[I])||A.push(n.select_predicates[I]);var b=new Promise(function(i){e.isReplayedODT()&&(s.nlsNameApiCalledCounter||(s.nlsNameApiCalledCounter=0),void 0!==s.nlsNameApiCalledCounter&&s.nlsNameApiCalledCounter++),s.getElementsNls(A,{tenant:t.getTenantFromModel(n.model),onComplete:function(e){i(e)},apiCalled:s.nlsNameApiCalledCounter})}),P=new Promise(function(i){e.isReplayedODT()&&(s.nlsValueApiCalledCounter||(s.nlsValueApiCalledCounter=0),void 0!==s.nlsValueApiCalledCounter&&s.nlsValueApiCalledCounter++);var a=n.model.get("source")?n.model.get("source"):"";a&&s.getValuesNls(S,{tenant:t.getTenantFromModel(n.model),service:a,onComplete:function(e){i(e)},apiCalled:s.nlsValueApiCalledCounter})});Promise.all([b,P]).then(function(e){var i=e[0],s=e[1];if(i)if(!1!==i.success){var a=i||{};a.vocabularyElementNLSInfo&&a.vocabularyElementNLSInfo.forEach(function(e){var t=m[e.uri];"Predicate"===e.type?c[e.uri]=e:d[e.uri]=e,t&&e.nlsName&&(t.nls=e.nlsName,g[e.uri]=t)})}else t._raiseError(i.error?i.error.message:"Error",n);for(var u in s){var h=g[u];if(h){var f=s[u];if(h.multivalue){var v=[];h.value.forEach(function(e){var t=f[e];v.push(t||e)}),h.value=v}else h.value=f[h.value]?f[h.value]:h.value}}n.select_predicates.forEach(function(e){var t=g[e];if(t)o.push(t);else{var i=d[e];if(i||(i=c[e]),i&&i.nlsName&&i.uri){var n={name:i.uri,nls:i.nlsName,path:i.uri,readOnly:!0,selectable:i.uri,type:"STRING",value:"",valueDB:""};o.push(n)}}});for(var _=Object.keys(p),E=[],C=0;C<_.length;C++)p[_[C]].groupNLS=l.get("accordion_parameters"),p[_[C]].group="PLMParametersGroup",p[_[C]].groupWeight=0,E.push(p[_[C]]);r.groupData=E,n.onComplete.call(null,{results:[r]})})}else t._raiseError(l.get("FedAjax_NotFound"),n)},getListOfExtensions:function(e){var i=e.modelList[0],n=i.get("objectId"),s="",a={};if(i.get("i3dxId")&&(n=i.get("i3dxId")),n){s="/search";let c=[],d=i.get("source");if(d){let e=o[d.toUpperCase()];e&&e.keyOnFedSearch&&c.push(e.keyOnFedSearch)}a.model=i,a.objectId=n,a.onCompleteWS=e.onComplete,a.onComplete=function(t){var i="Exception in '/search' ws when looking for List of Extensions";t&&t.error&&t.error.Message&&t.error.MessageException&&(i+=` -> error Message = ${t.error.Message} MessageException = ${t.error.MessageException}`),console.error(i),e.onComplete.call([],e)};var r={with_indexing_date:!1,with_synthesis:!0,with_synthesis_attribute:!0,with_nls:!1,locale:e.lang,query:this.getQueryForIndexService(i),tenant:e.tenantId,source:c,select_predicate:e.select_predicates,start:0,select_file:["icon","thumbnail_2d"]},l="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();r.label=l,a.source="3DSearch",t.createRequest(a,"POST",s,r)}},parsePLMParamater:function(e,t){return e.format.startsWith("PLMPARAM")&&(t[e.format]||(t[e.format]={}),e.name&&!t[e.format].name&&(t[e.format].name=e.format),e.name&&!t[e.format].nls&&(t[e.format].nls=e.name),e.name&&!t[e.format].selectable&&(t[e.format].selectable=e.format),e.name&&!t[e.format].name&&(t[e.format].name=e.name),"unit"===e.type&&(t[e.format].dimension=e.value),"minRangeProp"===e.type&&("none"!==e.value?t[e.format].minval=e.value:t[e.format].minval=""),"maxRangeProp"===e.type&&("none"!==e.value?t[e.format].maxval=e.value:t[e.format].maxval=""),"value"===e.type&&(t[e.format].value=e.value),t[e.format].value||(t[e.format].value=""),t[e.format].type||(t[e.format].type="string"),t[e.format].readOnly||(t[e.format].readOnly=!0)),t}}}),define("DS/EditPropWidget/ajaxRequests/3dlifecycleAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/WAFData/WAFData"],function(e,t,i,n,s){"use strict";return{checkFacetsVisibility:function(e){var t={};if(null!=e.facets&&e.facets.length>0)for(var i=0;i<e.facets.length;i++){var s=e.facets[i].name;"properties"===s?t[n.FACET_PROPERTIES]=!0:"social"===s?t[n.FACET_SWYMCOMMENTS]=!0:t[n.FACET_PROPERTIES]=!0}else t[n.FACET_PROPERTIES]=!0;e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getListOfAttributes:function(i){var n=i.modelList;i.navigateToMain;i.securityContext="ctx::Kanban User.Company Name.Kanban_PRJ";e.getWidgetValue("index_mode");if(n.length){var s=t.getTenantFromModel(o),a="/resources/v1/modeler/kanban/boards/"+(o=n[0]).get("objectId")+"?tenant="+s+"&mask=properties",r=e.isDebug(),o=(e.getWidgetValue("debug_properties"),n.length>0?n[0]:null);i.model=o,i.withSC=!1,i.withChange=!1,i.onCompleteWS=t._onCompleteAttributes,t.createRequest(i,"GET",a,null)}},commitModels:function(e){var i=e.modelList;e.securityContext="ctx::Kanban User.Company Name.Kanban_PRJ";var n=t.getTenantFromModel(o),s="/resources/v1/modeler/kanban/boards/"+(o=i[0]).get("objectId")+"?tenant="+n,a=[],r=!1;i.forEach(function(e,i){var n=t._createJSONModifiedAttribute(e);r=r||n.requests.length>0,a=a.concat(n.requests);var s=n.plmParametersRequests;s.length>0&&t._concatRequestListComposite(a,s)});var o=i.length>0?i[0]:null,l={requests:a};r&&null!=o&&o.isMergedModel()&&(l.transactionid=o.get("objectId")),e.model=o,e.onCompleteWS=t._onCompleteCommit,t.createRequest(e,"PATCH",s,l)}}}),define("DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests",["DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/EditPropConstants","DS/WAFData/WAFData","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd"],function(e,t,i,n,s,a){"use strict";return{commitModels:function(e){var i=e.modelList,n=(e.securityContext,[]),s=!1;i.forEach(function(e,i){var a=t._createJSONModifiedAttribute(e);s=s||a.requests.length>0,n=n.concat(a.requests);var r=a.plmParametersRequests;r.length>0&&t._concatRequestListComposite(n,r)});var r=i.length>0?i[0]:null,o={requests:n};s&&null!=r&&r.isMergedModel()&&(o.transactionid=r.get("objectId")),a.enrichRequestWithMetrics(o,{UXName:"Properties"}),e.model=r,e.onCompleteWS=t._onCompleteCommit,t.createRequest(e,"PUT","/resources/v1/collabServices/attributes/op/update?propertiesFacet=true",o)},getPreviewUrl:function(e){var t=e.modelList,n=(t.length,[]),s="";t.forEach(function(e){var t=e.get("objectId");s=s||e.get("tenant"),t&&n.push("physicalid:"+e.get("objectId"))}),n.length>0&&(e.ids=n,e.tenant=s,i.getPreviewUrl(e))},getHistory:function(e){t.securityContextDispatcher(e,this._getHistory)},_getHistory:function(i){var n=i.modelList,a=i.nbResult,r=i.lastDate,o=i.securityContext;i.handleRequest||(i.handleRequest={}),a=a||20;if(n.length){var l="",c="";n.forEach(function(e){var t=e.get("objectId");l+=c+"id="+t,c="&"});var d=n.length>0?n[0]:null;i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(d),source:t.getSourceFromModel(d),onComplete:function(c){var d="",u="";d="passport",u=c+"/resources/v1/collabServices/attributes/op/history",u+="?"+l,u+="&nbResults="+a,r&&(u+="&lastDate="+r);var h={Accept:"application/json","content-type":"application/json"};h["Accept-Language"]=e.getLanguage(),o&&(h.SecurityContext=encodeURIComponent(o));var p={type:"json",method:"GET",timeout:36e5,proxy:d,headers:h,cache:-1,onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(p.authentication="passport");var m=n.length>0?n[0]:null;i.handleRequest.handle=s.handleRequest(t._formatUrl(m,u),p)}})}},checkFacetsVisibility:function(e){t.securityContextDispatcher(e,this._checkFacetsVisibility)},_checkFacetsVisibility:function(i){var n=i.model,a=n.get("objectId"),r=i.facets,o=i.sourceAppId,l=i.securityContext;i.handleRequest||(i.handleRequest={});var c={id:a,facets:r,sourceAppId:o};n.get("instrefid")&&(c.mains={},c.mains[a]={id:n.get("instrefid")}),n.isMergedModel()&&(c.ids=n.getMergedModelIds());i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(n),source:t.getSourceFromModel(n),onComplete:function(a){var r="",o="";r="passport",o=a+"/resources/v1/collabServices/attributes/op/facets/available";var d={Accept:"application/json","content-type":"application/json"};d["Accept-Language"]=e.getLanguage(),l&&(d.SecurityContext=encodeURIComponent(l));var u={type:"json",method:"POST",timeout:36e5,proxy:r,headers:d,data:UWA.Json.encode(c),onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(u.authentication="passport"),i.handleRequest.handle=s.handleRequest(t._formatUrl(n,o),u)}})},getListOfAttributes:function(i){var s=i.modelList,a=!0===i.navigateToMain?"true":"false",r=(i.securityContext,e.getWidgetValue("index_mode")),o=s.length,l=!1,c=!1;if(o){for(var d=[],u=[],h=[],p={},m=(T=s[0]).get("objectId"),g=0;g<o;g++){var f=s[g],v={a:f};for(var _ in c=c||f.isMergedModel(),f.isMergedModel()&&(v=f.getMergingModels()),v){var E=v[_],C=E.get("metatype"),S=E.get("objectId"),y=E.get("instrefid");l=l||"EBOM"==C,r||C!=n.METATYPE_BUS&&"bus"!=C?r||C!=n.METATYPE_REL?d.push(S):("undefined"!==y&&""!==y&&u.length===h.length&&(h.push(y),p[S]={id:y}),u.push(S)):h.push(S)}}var A="";A="/resources/v1/proto/attributes/op/read",!1!==l||r?r&&(A="/resources/v1/collabServices/attributes/op/readIndex"):A="/resources/v1/collabServices/attributes/op/read";var I=e.isDebug(),b=e.getWidgetValue("debug_properties")||I?"true":null,P=null;r?P={lIds:d,indexattributes:"true",debug_properties:b||""}:(P={lIds:d,relIDs:u,busIDs:h,plmparameters:i.plmParams?"true":"false",attributes:!1!==i.attributes?"true":"false",navigateToMain:a,readonly:!0===i.readonly?"true":"false",debug_properties:b||"",ignoreKernelAccessChecks:i.ignoreKernelAccessChecks?"true":"false"},Object.keys(p).length>0&&(P.mains=p),c&&(P.format="merge"),c&&(P.transactionid=m));var T=s.length>0?s[0]:null;i.model=T,i.withSC=!0,i.withChange="silent",i.onCompleteWS=t._onCompleteAttributes,t.createRequest(i,"POST",A,P)}},getListOfExtensions:function(e){var i="";if(e.modelList.length){var n=e.tenantId,s={classes:[e.type]};i=`/resources/dictionary/class/interfaces?tenant=${n}&xrequestedwith=xmlhttprequest`;var a={onCompleteWS:e.onComplete,onComplete:function(t){var i="Exception in '/resources/dictionary/class/interfaces' ws";t&&t.error&&t.error.Message&&t.error.MessageException&&(i+=` -> error Message = ${t.error.Message} MessageException = ${t.error.MessageException}`),console.error(i),e.onComplete.call([],e)}};t.createRequest(a,"POST",i,s)}},getInstanceDetails:function(e){t.securityContextDispatcher(e,this._getInstanceDetails)},_getInstanceDetails:function(e){var i=e.securityContext;if(e.modelList&&e.modelList.length>0){var n=e.modelList[0].get("objectId"),s={};s.input_physical_ids=[n],s.primitives=e.primitives,s.patterns=e.patterns,s.attributes=e.attributes,s.version=3;var a="EP-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();s.label=a;var r={onCompleteWS:e.onComplete,onComplete:function(e){var t="Exception in '/cvservlet/navigate' ws";e&&e.error&&e.error.Message&&e.error.MessageException&&(t+=` -> error Message = ${e.error.Message} MessageException = ${e.error.MessageException}`),console.error(t)}},o=`/cvservlet/navigate?SecurityContext=${i}`;t.createRequest(r,"POST",o,s)}},fetchMask:function(e){t.securityContextDispatcher(e,this._fetchMask)},_fetchMask:function(e){var i={type:e.type,name:e.name,indexMode:e.indexMode?"true":"false"},n={onCompleteWS:e.onComplete,onComplete:function(e){var t="Exception '/resources/collabCommon/settings/getmask' ws";e&&e.error&&e.error.Message&&e.error.MessageException&&(t+=` -> error Message = ${e.error.Message} MessageException = ${e.error.MessageException}`),console.error(t)},securityContext:e.securityContext,type:e.type,name:e.name};t.createRequest(n,"POST","/resources/collabCommon/settings/getmask",i)},getListOfDimensions:function(e){t.securityContextDispatcher(e,this._getListOfDimensions)},_getListOfDimensions:function(e){var i={onCompleteWS:e.onComplete,onComplete:function(e){var t="Exception in '/resources/dictionary/dimensions' ws";e&&e.error&&e.error.Message&&e.error.MessageException&&(t+=` -> error Message = ${e.error.Message} MessageException = ${e.error.MessageException}`),console.error(t)}};t.createRequest(i,"GET","/resources/dictionary/dimensions")},getConvertedMKSValue:function(e){t.securityContextDispatcher(e,this._getConvertedMKSValue)},_getConvertedMKSValue:function(e){var i={Data:e.data,tenantId:e.tenantId},n={onCompleteWS:e.onComplete,onComplete:function(e){var t="Exception in '/resources/dictionary/dimensions/convertValues' ws";e&&e.error&&e.error.Message&&e.error.MessageException&&(t+=` -> error Message = ${e.error.Message} MessageException = ${e.error.MessageException}`),console.error(t)},securityContext:e.securityContext};t.createRequest(n,"POST","/resources/dictionary/dimensions/convertValues",i)}}}),define("DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests",["DS/EditPropWidget/ajaxRequests/3DSpaceAjaxRequests","DS/EditPropWidget/ajaxRequests/FederatedAjaxRequests","DS/EditPropWidget/constants/ConstantsMapping","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n){"use strict";var s={checkFacetsVisibility:"_getDefaultFacetsVisibility"},a=i.getSupportedServices(),r=a["3dspace"];r&&(r.service=e);var o=a.fedsearch;return r&&(o.service=t),{_getAjaxService:function(e,t,s){var a=null;i.getSupportedServices();if(s)a=s;else if(e&&e.length>0){var r=e[0];a=i.getServiceForModel(r)}a?a.service?t.call(null,a,e):require([a.require],function(i){a.service=i,t.call(null,a,e)}):t.call(null,{name:n.get("Unknown")},e)},_onSourceUnavailable:function(e,t){var i={message:n.replace(n.get("sourceUnavailable"),{label:"SourceName",value:t}),code:"SU"};e.onComplete.call(null,{success:!1,error:i})},_callMethodOnSource:function(e,t){var i=this,n=e.modelList;!Array.isArray(n)&&e.model&&(n=[e.model]),this._getAjaxService(n,function(n,a){var r=n.service;if(r&&"function"==typeof r[t])r[t].call(r,e);else{var o=!0;a.forEach(function(e){o=o&&e.get("isTransient")});var l=s[t];o&&l?i[l].call(i,e):i._onSourceUnavailable(e,n.name)}},e.defService)},commitModels:function(e){this._callMethodOnSource(e,"commitModels")},getPreviewUrl:function(e){this._callMethodOnSource(e,"getPreviewUrl")},getHistory:function(e){this._callMethodOnSource(e,"getHistory")},checkFacetsVisibility:function(e){this._callMethodOnSource(e,"checkFacetsVisibility")},getListOfAttributes:function(e){this._callMethodOnSource(e,"getListOfAttributes")},_getDefaultFacetsVisibility:function(e){var t=e.model.get("objectId");e.onComplete.call(null,{id:t,facets:{properties:!0}})},getListOfExtensions:function(e){this._callMethodOnSource(e,"getListOfExtensions")},getInstanceDetails:function(e){this._callMethodOnSource(e,"getInstanceDetails")},fetchMask:function(e){this._callMethodOnSource(e,"fetchMask")},getListOfDimensions:function(e){this._callMethodOnSource(e,"getListOfDimensions")},getConvertedMKSValue:function(e){this._callMethodOnSource(e,"getConvertedMKSValue")}}}),define("DS/EditPropWidget/utils/EditPropUtils",["DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/constants/ConstantsMapping","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o){"use strict";var l=o.get("accordion_parameters"),c=function(e,t,i){var s=[];if(t){t.forEach(function(t,a){var r=function(e,t,i){var s=new n,a=null;i&&t.extension&&(a=i[t.extension]),a=a||{};var r=1;s.set("multisel",e.isMergedModel()),s.set("name",t.name),s.set("label",t.name+" (NLS not defined)"),s.set("path",t.selectable),s.set("select",t.selectable),s.set("select",t.select),s.set("type",t.type),t.speType&&s.set("type",t.speType),s.set("multiline",null!=t.multiline&&!1!==t.multiline);var o=null!=t.multivalue&&!1!==t.multivalue;s.set("multivalue",o);var c=t.value,d=t.valueDB;if(e.isMergedModel()||(c={r:c},d&&(d={r:d})),c)for(var u in c){var h=c[u],p=d?d[u]:p;!1===o?(h=null===h?"":h,p=null===p?"":p,Array.isArray(h)&&(h=h.length>0?h[0]:"",p&&(p=p.length>0?p[0]:"")),h=void 0===h?"":h):""!==h&&null!=h||(h=[],p=[]),c[u]=h,d&&(d[u]=p)}else if(e.isMergedModel()){var m=e.getMergingModels();for(var g in c={},d={},m){var f=m[g],v=!1===o?"":[];"boolean"===t.type&&(v=!1),c[f.get("objectId")]=v,d[f.get("objectId")]=v}}e.isMergedModel()||(c=c.r,d&&(d=d.r)),t.range&&("string"==typeof t.range&&(t.range=t.range.split(",")),s.set("authorizedValues",t.range)),t.rangeNLS&&("string"==typeof t.rangeNLS&&(t.rangeNLS=t.rangeNLS.split(",")),s.set("authorizedValuesNLS",t.rangeNLS)),void 0!==t.range_required&&s.set("authorizedValuesRequired",!0===t.range_required);var _=!0;if(t.readOnly||"owner"!==t.selectable||(_=!1),"No"!==t.readOnly&&!1!==t.readOnly||(_=!1),s.set("readOnly",_),s.set("value",c),d?s.set("valueDB",d):s.set("valueDB",c),s.set("mandatory","Yes"===t.mandatory||!0===t.mandatory),s.set("label",t.nls),s.set("path",t.path),t.dimensionType){let i=e.isMergedModel(),n=t.dimension,a=t.unitName;if(i&&void 0===n&&void 0===a){let t={},i={},n=e.getMergingModels();for(let e in n)t[e]="",i[e]="";s.set("dimension",t),s.set("unitName",i)}else if(void 0===t.dimension&&null===t.dimension||"object"!=typeof t.dimension)s.set("dimension",t.dimension),s.set("unitName",t.unitName);else{let e=t.dimension,i=t.unitName;for(let t in e){let n=e[t],s=i[t];n=Array.isArray(n)?n[0]:n,s=Array.isArray(s)?s[0]:s,e[t]=n,i[t]=s}s.set("dimension",e),s.set("unitName",i)}}s.set("dimensionType",t.dimensionType),s.set("maxlength",t.maxlength),s.set("forbiddenChar",t.forbiddenChar),t.minval&&(s.set("minval",t.minval),t.minvalincluded&&s.set("minvalincluded",t.minvalincluded)),t.maxval&&(s.set("maxval",t.maxval),t.maxvalincluded&&s.set("maxvalincluded",t.maxvalincluded)),t.attrID&&(s.set("attributeID",t.attrID),s.set("facet",l),s.set("section",l)),t.facet?(s.set("facet",t.facet),s.set("section",t.facet)):a.name&&!0!==a.deploymentExtension&&(s.set("facet",a.name),s.set("section",a.nameNLS?a.nameNLS:a.name)),t.facetName&&s.set("section",t.facetName),t.extension&&s.set("extension",t.extension),void 0!==t.from&&s.set("from",t.from),t.relation&&s.set("relation",t.relation),t.rules&&s.set("rules",t.rules),t.applysort&&s.set("applySort",t.applysort);var E=t.UIPosition,C=(r=1,1);a.deploymentExtension&&!0!==t.maskedByType&&(r=2),E||0===E||(C=2,E=0,s.set("masked",!1));var S=r+"-"+C+"-"+E;return s.set("positionUI",S),t.group&&"Default"!==t.group&&(s.set("group",t.group),s.set("groupNLS",t.groupNLS),s.set("groupWeight",t.groupWeight)),s.saveInitialValues(),s}(e,t,i),o=r.get("positionUI");o+="-"+a,r.set("positionUI",o),s.push(r)})}return s};return{getModelFromSelectedNode:function(n){var s,a=null;null!=(s=!(s=n&&"function"==typeof n.getInstID?n.getInstID():null)&&n&&"function"==typeof n.getRelationID?n.getRelationID():s)&&Array.isArray(s)&&(s=s.length>0?s[0]:null);var r=!!s,o=r?"relationship":"businessobject";if((s=(s=s||n.getID())||n.id)===(n.plmType||n.getType&&n.getType()))return null;var l=!r&&n.metatype?n.metatype:o,c=n.source?n.source:null,d=n.tenant?n.tenant:null,u=!r&&n.type?n.type:null;let h=n.sourceName?n.sourceName:null,p=n.indexModeParameter?n.indexModeParameter:null;if(null===u&&!r&&n.options&&n.options.type&&(u=n.options.type),s){var m={metatype:l,objectId:s};d=d||i.getTenantID();if(n.getAttributeValue){let e=n.getAttributeValue("i3dx");e&&(m.i3dxId=e)}d&&(m.tenant=d),c&&(m.source=c),h&&(m.sourceName=h),void 0!==p&&(m.indexModeParameter=p),u&&(m.type=u,m[t.MODEL_DS_ATTR+"type"]=u),a=new e(m)}return a},getModelFromPath:function(i,n,s,a){var r=i.length,o=1==r||(s||r%2==0),l=o?r-1:r-2,c=i[l],d=n?n[c]:null,u="";n&&!o&&(d=n[u=i[l+1]]);var h={objectId:c,metatype:f=s||!o?"relationship":"businessobject"};if(a&&(a.source&&(h.source=a.source),a.sourceName&&(h.sourceName=a.sourceName),void 0!==a.indexModeParameter&&(h.indexModeParameter=a.indexModeParameter)),d){var p=d.source?d.source:null,m=d.type?d.type:null,g=d.tenant?d.tenant:null,f=o&&d.metatype?d.metatype:f;g&&(h.tenant=g),p&&(h.source=p),m&&(h[t.MODEL_DS_ATTR+"type"]=m),f&&(h.metatype=f),u&&(h.selReferenceID=u)}return new e(h)},getPreviewUrl:function(e){var t=e.preview_url;return t||""},fillFromServer:function(e,t,a){var r={modifyAccess:!0,success:!1,allAttributeAreRO:!0,plmparams:!1};if(!1!==e.success){r.success=!0,r.modifyAccess=!1!==e.modifyAccess;var o=this.getPreviewUrl(e),l=e.type_icon_url||"",d=function(e){var t=e.type_icon_large_url;return t||""}(e);l===d&&(d="");var u=t.getChangedValues(),h={};o&&(h.previewUrl=o),d&&(h.type_icon_url=d),l&&(h.type_small_icon=l),e.thumbnailsRW&&(h.activeThumbnail=!0),r.allAttributeAreRO=function(e,t,n){var s=!0;n||(n={});var a=["owner","modified","branch.owner","branch.modified"];(i.getWidgetValue("index_mode")||"Federated"===t.source)&&(a=["ds6w:responsible","ds6w:modified"]);var r=n.type_small_icon,o=c(e,t.data,t.extensions),l=c(e,t.basicData,t.extensions);return c(e,t.groupData,t.extensions).forEach(function(t){s=s&&!0===t.get("readOnly"),t.facet=t.group,t.extension=t.group,"type_icon_url"===t.name&&r!==t.value&&(n.type_icon_url=t.value),"type"===t.name&&t.set("urlIcon",r);var i=0,o=a.indexOf(t.name);t.get("positionUI")&&(i=t.get("positionUI")),!e.isMergedModel()&&o>=0&&(0===o||2===o?t.set("sectionIdentityCard","ownerName"):1===o||3===o?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",o)),!0===t.get("masked")&&(t.set("positionUI",i),n[t.getIdentifier()]=t)}),l.forEach(function(t){s=s&&!0===t.get("readOnly"),"type_icon_url"===t.name&&r!==t.value&&(n.type_icon_url=t.value),"type"===t.name&&t.set("urlIcon",r);var i=0,o=a.indexOf(t.name);t.get("positionUI")&&(i=t.get("positionUI")),!e.isMergedModel()&&o>=0&&(0===o||2===o?t.set("sectionIdentityCard","ownerName"):1===o||3===o?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",o)),!0===t.get("masked")&&(t.set("positionUI",i),n[t.getIdentifier()]=t)}),o.forEach(function(t,i){s=s&&!0===t.get("readOnly"),"ds6w:type"===t.name&&t.set("urlIcon",r);var o=0,l=a.indexOf(t.name);t.get("positionUI")&&(o=t.get("positionUI")),!e.isMergedModel()&&l>=0&&(0===l||2===l?t.set("sectionIdentityCard","ownerName"):1===l||3===l?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",l)),t.set("positionUI",o),n[t.getIdentifier()]=t}),s}(t,e,h);var p=function(e){var t={},i=e.computed;if(i&&i.label){var n=i.label;if(n.value&&"object"==typeof n.value)for(var s in n.value){var a=n.value[s];n.value[s]=Array.isArray(a)&&a.length>0?a[0]:a}t.label=n.value,n.path&&(t.attributeId=n.path),!n.path&&n.name&&(t.attributeId=n.name)}return t}(e),m=p.label;m||(t.isMergedModel()?(m={},t.getMergedModelIds().forEach(function(e){m[e]=""})):m=""),m&&(h.label=Array.isArray(m)?m[0]:m),p.attributeId&&h[p.attributeId]?(h.labelAttribute=p.attributeId,h[p.attributeId].set("sectionIdentityCard","title"),t.addEvent("onChange:"+p.attributeId,function(){var e=t.get(p.attributeId);e&&t.set("label",e.valueDB)})):h[s.MODEL_DS_ATTR+"label"]=new n({sectionIdentityCard:"title",value:m,valueDB:m,multisel:t.isMergedModel(),isTransient:!0,path:s.MODEL_DS_ATTR+"label"});var g={};for(var f in u)h[f]||(g[f]=u[f]);e.type&&(h.type?h.type.set("valueDB",e.type):h.type=e.type);var v=t.getAllAttributes();for(var f in v){var _=v[f];"object"==typeof _&&_ instanceof n&&!_.isTransient&&(a.initTable||_.attributeID)&&delete v[f]}if(t.set(h),t&&t.isMergedModel()){var E=t.getMergingModels();for(var C in E){var S=E[C];S.clearChangedValue();var y=UWA.clone(h);for(var f in h){var A=h[f];if(A instanceof n){var I=new n(y[f]);I.set("value",A.get("value")[C]),I.set("valueDB",A.get("valueDB")[C]),I.set("multisel",!1),A.get("dimensionType")&&A.get("dimension")&&"object"==typeof A.get("dimension")&&A.get("unitName")&&"object"==typeof A.get("unitName")&&(I.set("dimension",A.get("dimension")[C]),I.set("unitName",A.get("unitName")[C])),I.saveInitialValues(),y[f]=I}}S.set(y),S.setChangedValues(g)}}t.clearChangedValue(),t.setChangedValues(g),function(e){!e.get("type")||"true"!==i.getWidgetValue("admin")||"CATProduct"!==e.get("type").value&&"CATPart"!==e.get("type").value||e.get("project")&&e.get("project").set("readOnly",!1)}(t),r.plmparams=!0===function(e){var t=e.PLMParametersAvailable;return t=t||!1}(e)}return r},getModelFromPathInIndexMode:function(i,n,s,a){let r="";i&&i.length>0&&(r=i[0]);let o="";n&&n.length>0&&(o=n[0]);let l=r;o&&(l=o);let c=s?s[l]:null,d={metatype:"businessobject"};if(a&&(a.source&&(d.source=a.source),a.sourceName&&(d.sourceName=a.sourceName),void 0!==a.indexModeParameter&&(d.indexModeParameter=a.indexModeParameter)),r&&(d.objectId=r),o&&(d.i3dxId=o),c){let e=c.type?c.type:null;e&&(d[t.MODEL_DS_ATTR+"type"]=e,d.type=e)}return new e(d)},getDimensions:function(){var e=this;e._dictionary=new Map;var t=i.getCancelObject(),n=r.getServiceBySource("3dspace"),s=i.getLanguage(),o={tenantId:i.getTenantID(),lang:s,handleRequest:{handle:t},defService:n,onComplete:function(t){t&&"object"==typeof t&&t.results&&t.results.length>0&&(t.results.forEach(function(t){e._dictionary.set(t.Name,t)}),i.setValue("DimensionsDictionary",e._dictionary))}};a.getListOfDimensions(o)},_getDictionary:function(){return this._dictionary&&this._dictionary.size>=0?this._dictionary:null},getDimensionUnitName:function(e,t){let i=this._getDictionary();if(null===i)return null;let n=e.startsWith("DSDim_")&&e.substring(6,e.length);n||(n=e);let s=i.get(n),a=[],r="";return s&&s.Units&&Array.isArray(s.Units)&&(a=s.Units.filter(e=>e.NLSName===t.trim())),a.length>0&&a[0].Name&&(r=a[0].Name),r},getDimensionUnitNLSName:function(e,t){let i=this._getDictionary();if(null===i)return null;let n=e.startsWith("DSDim_")&&e.substring(6,e.length);n||(n=e);let s=i.get(n),a=[],r="";return s&&s.Units&&Array.isArray(s.Units)&&(a=s.Units.filter(e=>e.Name===t.trim())),a.length>0&&a[0].label&&(r=a[0].label),r},getUnits:function(e){let t=this._getDictionary();if(null===t)return null;let i=e.startsWith("DSDim_")&&e.substring(6,e.length);i||(i=e);let n=t.get(i),s=[];return n&&n.Units&&Array.isArray(n.Units)&&n.Units.forEach(e=>{let t="";e.label?t=`${e.NLSName} (${e.label})`:e.Name&&(t=`${e.NLSName} (${e.Name})`),s.push(t)}),s}}}),define("DS/EditPropWidget/controllers/EditPropMainController",["UWA/Class/Model","DS/EditPropWidget/models/OccurrenceModel","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropWidget/UI/EditPropSkeleton","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOCollabToolsUI/tracker/ENOCollabTracker"],function(e,t,i,n,s,a,r,o,l,c,d,u){"use strict";return UWA.Class.extend({skeleton:null,defaultOptions:{selectionType:o.ALL_SELECTION,displayType:o.STANDARD,context:null,odtUpTransient:!1},init:function(e){var t=this;for(var i in this._parent(e),this._selectionIsStopped=!1,this._currentNewSelection=null,this.options=this.options?this.options:{},this.defaultOptions)this.options[i]=e[i];this.indexModeParameterFromApp=!1,this.indexModeParameter=!1,this.USE_APP_SECURTIYCONTEXT="true"===e.USE_APP_SECURTIYCONTEXT,null!=e.indexModeParameter&&(this.setIndexModeFlag(e.indexModeParameter),this.setIndexModeFlagFromApp(e.indexModeParameter)),d.getInstance({context:this.options.context}),a.getDimensions();var n=e.events.onCancel;e.events.onCancel=function(e){t._unsubscribeSelect(),t.skeleton.clearPanel(),t.skeleton.setOccurrences([]),t.skeleton.notifyClose,t.skeleton.notifyClose(),n&&n.call(t,e)},this._setup(e),e.selectionType!==o.NO_SELECTION&&(this._commandProxy=null,require(["DS/WidgetServices/commandProxy/CommandProxy"],function(e){var i=!1,n=0,s=function(e,s){if(e.paths&&0===e.paths.length||e.pathsInst&&0===e.pathsInst.length)i=!1,setTimeout(function(){!1===i&&t._onSelectionChange(e,s)},500);else{i=!0;var a=++n;setTimeout(function(){a===n&&t._onSelectionChange(e,s)},50)}},a={events:{onSelect:s}};t.options.displayType!==o.TRANSIENT&&!0!==t.options.odtUpTransient||(a.events.onUpdateTransient=function(e){e.models;var i=e.options;i&&i.securityContext&&(t.USE_APP_SECURTIYCONTEXT?d.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i.securityContext}}}}).getValidSecurityContext():d.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i.securityContext}}}}).getSecurityContext()),t._commandProxy.subscribe({onSelect:s})}),t._commandProxy=e.create(a)}))},getTopBar:function(){return this.skeleton.getTopBar()},_unsubscribeSelect:function(){this._commandProxy&&this._commandProxy.unsubscribe(this._commandProxy.choices.SELECT)},setModels:function(e,t,i,n){var s=this;null!=i&&""!==i?(this.skeleton.defaultFacetName=i,this.skeleton.selectFacet(i)):this.skeleton.defaultFacetName=null,null!=n&&""!==n&&(this.skeleton.infoForFacet=n);var a=!!this._currentNewSelection;this._currentNewSelection={models:e,change:t},a||this.skeleton.checkChangeAuthorized(function(e){var t=s._currentNewSelection;s._currentNewSelection=null,!0===e&&s._setModels(t.models,t.change)},!0)},_setModels:function(a,r){window.top.performance.mark("start_setModelController");var l=(v=a&&a.length>0?a[0]:null)?v instanceof e?v.get("tenant"):v.tenant:null;if(v&&l&&c.setWidgetValue("x3dPlatformId",l),"ENOLCMT_AP"===c.getWidgetValue("x3dAppId")&&void 0!==r&&c.isChangeAvailable()){require(["DS/EditPropWidget/changeAction/passThruJS"],function(e){e.onReady(function(e){a.length>0&&(e.changeIsSetChecker(r)||r&&r.configurationRevision)?e.set(r,function(t){void 0===t.Message&&e.show()}):(e.cleanAuthDetails(),e.hide())})})}var d=this,h=a.length,p=[];if(h){var m={},g={},f=null;a.forEach(function(n,r){if("function"!=typeof n.isMergedModel||!0!==n.isMergedModel()){var l=a[r],c=null;n instanceof e?(d._getModel(l.get("objectId"))||l.clearChangedValue(),c=l.getChangedValues()):(l=new i(n),a[r]=l),d._getModel(l.get("objectId"))||(d.editPropModelList=[l],l.clearChangedValue()),l.keys().forEach(function(e){var t=l.get(e),i=t instanceof s;if(!i&&t&&"object"==typeof t&&"EditProp_listOfChange"!==e&&"label"!==e&&(t=new s(t),i=!0,l.set(e,t)),i&&!0===l.isTransientModel()){var n=t.getIdentifier();if(n){var a=g[n];if(a){var r=t.get("value"),o=t.get("valueDB"),c=a.get("value"),d=a.get("valueDB");c[l.get("objectId")]=r,d[l.get("objectId")]=o,"title"===a.get("sectionIdentityCard")&&(f.value[l.get("objectId")]=r,f.valueDB[l.get("objectId")]=o),a.__nbValues++}else{r=(a=new s(UWA.clone(t))).get("value"),o=a.get("valueDB"),d={};(c={})[l.get("objectId")]=r,d[l.get("objectId")]=o,a.set("multisel",!0),a.set("value",c),a.set("valueDB",d),a.__nbValues=1,"title"===a.get("sectionIdentityCard")&&((f={value:{},valueDB:{}}).value[l.get("objectId")]=r,f.valueDB[l.get("objectId")]=o),g[n]=a}}}}),l.clearChangedValue();var u=l.get("EditProp_listOfChange");u&&(l.setChangedValues(u),l.unset("EditProp_listOfChange")),c&&l.setChangedValues(c);var h=l;if(!m[h.get("objectId")]){m[h.get("objectId")]=h;var v=new t;v.setModel(o.MODEL_INIT,h),p.push(v)}}});var v,_=Object.keys(m).length;if(_>1)if(null!=(v=p[0].getModel(o.MODEL_INIT))){var E=UWA.clone(v.getOptions());for(var C in g){g[C].__nbValues===_&&(E[C]=g[C])}null!=f&&(E[o.MODEL_DS_ATTR+"label"]=new s({sectionIdentityCard:"title",value:f.value,valueDB:f.valueDB,isTransient:!0,multisel:!0,path:o.MODEL_DS_ATTR+"label"}));var S=(S=c.getWidgetPreference("transactionId"))&&S.value?S.value:d._generateMergeID(),y=new t({modelPrefix:S,isMerging:!0});E.objectId=S;var A=new n(E);A.setMergingModels(m),y.setModel(o.MODEL_INIT,A),p.unshift(y)}else console.log("First model not found in occurrence")}var I={UXName:"Information",numberObjects:h,UXContext:this.options.displayType===o.TRANSIENT||this.options.displayType===o.POPUP?"App Popup":"App Side Panel",pd16:this.skeleton.currentFacetName};this.skeleton.lastTrackerEvent=u.createInitActionEvent(I,this.skeleton.lastTrackerEvent),u.checkAndTrackPageEvent(this.skeleton.lastTrackerEvent),window.top.performance.mark("end_setModelController"),this.skeleton.setOccurrences(p)},_generateMergeID:function(){return c.generateUniqueId()},_getModel:function(e){return this.skeleton.getModel(e)},getModels:function(){return this.skeleton.getModels()},getTitle:function(){return this.skeleton.getTitle()},getOptimalSize:function(){return this.skeleton.getOptimalSize()},getUI:function(){return this.skeleton},onRefresh:function(){var e=this.getModels();this.setModels([],void 0),this.setModels(e,void 0)},_getFacet:function(e,t){var i=t;if("string"==typeof t)i=e[t];else if("object"==typeof t&&t.id){var n=e[t.id];if(n){for(var s in t)n[s]=t[s];i=n}}return i},addFacets:function(e){if(e){var t=this,i=[],n=this.mapFacet?this.mapFacet:l.getMapping();e.forEach(function(e){i.push(t._getFacet(n,e))});var s=this.getUI();s&&s.addFacets(i)}},_setup:function(e){var t=this,i=l.getMapping(e);t.mapFacet=i;var n=l.getDefaultFacets();e.facets&&(n=e.facets,delete e.facets);var s=[],a=!1;n.forEach(function(n){var r=t._getFacet(i,n);r&&(!a&&r.facet&&r.facet.name===o.FACET_PROPERTIES&&(a=!0),(!0!==r.blockFromSearch||!e||"searchInformationProperties"!==e.className&&"searchPreviewProperties"!==e.className)&&s.push(r))}),a||(i[o.FACET_PROPERTIES].visible=!1,s.push(i[o.FACET_PROPERTIES])),this.skeleton=new r(s,e)},destroyComponent:function(){this._commandProxy&&(this._commandProxy.unsubscribe("onUpdateTransient"),this._commandProxy.unsubscribe("onSelect"))},onResize:function(){this.getUI().onResize()},_raiseNotif:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:t})},stopSelection:function(e){this._selectionIsStopped=!0===e},_onSelectionChange:function(e,t){if(this.options.selectionType===o.NO_SELECTION||!0===this._selectionIsStopped)return;if(t&&t.metadata&&t.metadata.originWidgetId===c.getWidgetId()&&"ENORIPE_Relations"===t.metadata.origin)return;let i=null;e.hasOwnProperty("securityContext")&&(i=e.securityContext,d.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i}}}}));var n=e.pathsInst,s=!!n,r=(n=n&&n.length>0?n:e.paths)&&n.length,l=e.defaultFacetName,u=e.infoForFacet,h=e.attributes;e.appid;let p=e.source,m=e.sourceName,g=e.indexModeParameter,f=e.pathsI3dx,v=n;!0===g&&f&&Array.isArray(f)&&f.length>0&&void 0===r&&(r=f.length,n=f),this.makeDecisionForIndexMode(g);let _={indexModeParameter:this.getIndexModeFlag()};p&&(_.source=p),m&&(_.sourceName=m);var E=this.getModels(),C=[];E.forEach(function(e){C.push(e.get("objectId"))});var S=!1;if(S=this.options.selectionType!==o.RESTRICTED_SELECTION||t.metadata&&t.metadata.originWidgetId===c.getWidgetId()){for(var y=[],A=0;A<r;A++){var I=n[A];let t=void 0;f&&f.length===r&&(t=f[A]);let i=void 0;if(v&&v.length===r&&(i=v[A]),I){if(g)b=a.getModelFromPathInIndexMode(i,t,h,_);else var b=a.getModelFromPath(I,h,s,_);!b.get("tenant")&&e.tenant&&b.set("tenant",e.tenant),y.push(b)}}var P=null;if(c.isChangeAvailable()&&(P=UWA.clone(e.changeControl)),this.setModels(y,P||null,l,u),c.isReplayedODT())return y}return c.isReplayedODT()&&!S?"No load of model with selected object":void 0},changeAttributes:function(e){this.skeleton.changeAttributes(e)},setIndexModeFlag:function(e){void 0!==e&&(this.indexModeParameter=e)},getIndexModeFlag:function(){return!0===this.indexModeParameter},setIndexModeFlagFromApp:function(e){void 0!==e&&(this.indexModeParameterFromApp=e)},getIndexModeFlagFromApp:function(){return!0===this.indexModeParameterFromApp},makeDecisionForIndexMode:function(e){let t=this;if(!0===e||!1===e)t.setIndexModeFlag(e),t.skeleton.setIndexModeFlag(e);else{let e=t.getIndexModeFlagFromApp();t.setIndexModeFlag(e),t.skeleton.setIndexModeFlag(e)}}})}),define("DS/EditPropWidget/EditPropWidget",["UWA/Core","UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/controllers/EditPropMainController"],function(e,t,i,n,s){"use strict";return t.extend({defaultOptions:{},_getController:function(e){return this.controller?this.controller:new s(e)},init:function(e,t){t&&i.setWidgetObject(t),this.clickOnAnnotationData=e.clickOnAnnotationData;var s={};for(var a in e)s[a]=e[a];s.propertiesWidgetUI=!0,null!==s.securityContextFromAppPreference&&void 0!==s.securityContextFromAppPreference||(s.context&&"function"==typeof s.context.getSecurityContext&&s.context.getSecurityContext()&&s.context.getSecurityContext().SecurityContext?s.securityContextFromAppPreference=s.context.getSecurityContext().SecurityContext:s.securityContextFromAppPreference=null),null!==s.disableAddExtensionButton&&void 0!==s.disableAddExtensionButton||(s.disableAddExtensionButton=!1),s.sourceAppId||(s.sourceAppId=s.appId);var r=this;this._parent(s),this.elements||(this.elements={}),s.events||(s.events={}),s.events.onInnerCancel=function(){r.destroyComponent()},this.controller=this._getController(s),this.elements.UI=this.controller.getUI(),this.elements.container=this.elements.UI,this.elements.container.getContent().addEvent("resize",function(){r.onInnerResize()}),(i.isReplayedODT()||!0===i.getWidgetObject().getValue("proto"))&&(this._handlerSwitch=function(e){this.setReadonlyStatus(e)}.bind(this),n.subscribe("switchMode",this._handlerSwitch))},addAnnotationData:function(e){var t=this,i=function(t){"social"===t.facet.name&&setTimeout(function(){var i=t.content._socialView;if(i&&e&&e.annotation){var n={media:[{type:"annotation",file:e.screenshot,data:{annotationFile:e.annotation}}],replace:!1};i.setActiveFieldContent(n)}})};t.elements.UI._lFacets&&t.elements.UI._lFacets.forEach(function(e){e&&e.facet&&e.facet.name&&"social"===e.facet.name&&(e.content?i(e):t.elements.UI.subscribeEvt("facetLoaded",i),t.elements.UI.selectFacet(e.facet.name))})},initDatas:function(e,t,i){void 0!==this.clickOnAnnotationData&&null!=this.clickOnAnnotationData&&(e[0].clickOnAnnotationData=this.clickOnAnnotationData);let n=void 0;e&&e[0]&&"function"==typeof e[0].get&&e[0].get("indexModeParameter")&&(n=e[0].get("indexModeParameter")),void 0===n&&"object"==typeof e[0]&&e[0].hasOwnProperty("indexModeParameter")&&(n=e[0].indexModeParameter),this.controller.makeDecisionForIndexMode(n);let s=this.controller.getIndexModeFlag();e&&e[0]&&n!==s&&("function"==typeof e[0].set?e[0].set("indexModeParameter",s):e[0].indexModeParameter=s),this.controller.setModels(e,void 0,t,i)},initData:function(e,t,i){this.initDatas(e,t,i)},changeAttributes:function(e){this.controller.changeAttributes(e)},show:function(e){this.elements.popup&&(this.elements.popup.show(),this.initDatas(e))},centerIt:function(e){this.elements.popup&&this.elements.popup.centerIt()},onRefresh:function(){this.controller.onRefresh()},onResize:function(){},onInnerResize:function(){this.elements.popup?this.elements.popup.onResize():this.elements.UI&&this.elements.UI.onResize()},setReadonlyStatus:function(e){this.elements.UI.setReadonlyStatus(e)},selectFacet:function(e){this.elements.UI.selectFacet(e)},removeFacets:function(e){this.elements.UI.removeFacets(e)},stopSelection:function(e){this.controller.stopSelection(e)},addFacets:function(e){this.controller.addFacets(e)},getTitle:function(){return this.elements.UI.getTitle()},getIdentityCardUI:function(){return this.elements.UI.getIdentityCardUI()},getMainTable:function(e){return this.elements.UI.getMainTable()},getListModel:function(){return this.controller.getModels()},destroyComponent:function(){this._handlerSwitch&&n.remove("switchMode",this._handlerSwitch),this.controller.destroyComponent(),this.elements.popup?this.elements.popup.destroyComponent():this.elements.UI.destroyComponent()}})}),define("DS/EditPropWidget/utils/EditPropIndexUtils",["DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/ConstantsMapping","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/EditPropWidget/constants/EditPropConstants"],function(e,t,i,n,s){"use strict";return{getListOfExtensions:function(n,a){var r=this;if(n.type!==s.EDITPROPINDEX_DEFAULTTYPE){var o=t.getCancelObject(),l=i.getServiceBySource("3dspace"),c=i.getServiceBySource("fedsearch"),d=n.type,u=n.model,h=t.getLanguage(),p=u.getTenant();r.promiseForAutoExt=new Promise(function(t,i){e.getListOfExtensions({type:d,tenantId:p,modelList:[u],lang:h,apiVersion:"R2018x",handleRequest:{handle:o},defService:l,onComplete:function(e,n){try{var s=null;e&&(s=e),t(s)}catch(e){i(e)}}})}),r.promiseForNonAutoAndCustoExt=new Promise(function(t){e.getListOfExtensions({type:d,tenantId:p,modelList:[u],lang:h,apiVersion:"R2018x",handleRequest:{handle:o},defService:c,select_predicates:["ds6w:kind"],onComplete:function(e,i){var n=null;e&&(n=e),t(n)}})}),Promise.all([r.promiseForAutoExt,r.promiseForNonAutoAndCustoExt]).then(function(e){r.parseListOfExtensions(e,a,n)})}else a([],n)},parseListOfExtensions:function(e,t,i){var n=e[0],s=e[1],a=[];n&&n.results&&n.results.length>0&&n.results[0]&&n.results[0].interfaces&&n.results[0].interfaces.map(function(e){if(e.hasOwnProperty("automatic")&&"yes"===e.automatic.toLowerCase()&&e.name){var t={isExt:!0,isAutomaticExt:!0,name:e.name};a.push(t)}}),s&&s.results&&s.results.length>0&&s.results[0]&&s.results[0].attributes&&s.results[0].attributes.map(function(e){if(e.name.includes("ds6w:kind")&&e.value){var t={isExt:!0,isAutomaticExt:!1,name:e.value};a.push(t)}}),t(a,i)},getMaskAttributes:function(n,s){var a=this,r=new Set,o=new Map,l=0,c=[],d={},u={},h={};n.forEach(function(e){e.name&&o.set(e.name,e)});var p=function(e,t){if(e.success){var i=t.name;t.type;if(e.mask){var p=e.mask;if(i&&i.length>0){var m=o.get(i);m||"default"!==i||(m={name:"default"}),d[m.name]||(d[m.name]={attributes:[]}),m.isBus&&(d[m.name].isType=!0),m.isRel&&(d[m.name].isType=!0),"default"===m.name&&(d[m.name].isType=!0),m.isExt&&(d[m.name].isExtension=!0,m.isAutomaticExt?d[m.name].isAutomaticExt=!0:d[m.name].isAutomaticExt=!1)}if(p&&p.indexmode_write&&p.indexmode_write.attributes&&p.indexmode_write.attributes.forEach(function(e){(r.add(e.name),i&&i.length>0&&(m&&m.isExt?u[e.name]={extension:m.name,isExt:!0}:u[e.name]={isExt:!1},m&&!d[m.name]&&(d[m.name]={attributes:[]}),m&&d[m.name].attributes.push(e.name)),e.group)&&(u[e.name].group=e.group,void 0!==h[e.group]&&void 0!==h[e.group].attributes?h[e.group].attributes.push(e.name):(h[e.group]={attributes:[]},h[e.group].attributes.push(e.name)))}),p&&p.indexmode_groups)for(var g in p.indexmode_groups)h[g]&&(h[g].NLS=p.indexmode_groups[g].NLS?p.indexmode_groups[g].NLS:g,h[g].weight=p.indexmode_groups[g].weight?p.indexmode_groups[g].weight:0)}}if((l+=1)===n.length){for(var f of r)c.push(f);a.getPredicates(n[0].name,function(e){var t=new Map;e&&Array.isArray(e)&&e.length>0&&e.forEach(function(e){c.includes(e.uri)&&e.dimension&&t.set(e.uri,e)});var i={maskAttributeDetails:u,listOfPredicates:c,maskGroupInfo:h,groupAttributesInfoAsPerMask:d};t.size>0&&(i.dimensionAttributes=t),s(i)})}i&&"default"===i&&s({maskAttributeDetails:u,listOfPredicates:c,maskGroupInfo:h,groupAttributesInfoAsPerMask:d})},m=i.getServiceBySource("3dspace");if(o.size>0){t.getCancelObject();for(var g of o.keys()){var f=o.get(g),v=null;f.isBus?v="bus":f.isRel?v="rel":f.isExt&&(v="itf");var _={defService:m,name:g,type:v,indexMode:!0,onComplete:p};e.fetchMask(_)}}else{_={defService:m,name:"default",type:"bus",indexMode:!0,onComplete:p};e.fetchMask(_)}},getPredicates:function(e,i){var s={apiVersion:"R2018x",lang:t.getLanguage(),tenantId:t.getTenantID(),onComplete:function(e){e&&e.classPredicates&&e.classPredicates.length>0&&Array.isArray(e.classPredicates)&&e.classPredicates[0]&&e.classPredicates[0]&&"object"==typeof e.classPredicates[0]&&e.classPredicates[0].vocabularyPredicateInfo?i(e.classPredicates[0].vocabularyPredicateInfo):i([])},onFailure:function(e){console.log(e),i([])}};n.getPropertiesForClass(e,s)}}}),define("DS/EditPropWidget/form/Form",["DS/EditPropWidget/models/CommonAbstract","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/facets/Properties/TweakerManager","DS/EditPropWidget/utils/AttributesUtils","DS/WidgetServices/WidgetServices","DS/WidgetServices/moveHelper/MoveHelper","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServicesUI/tweakers/TweakerInfoWebUX","DS/EditPropWidget/utils/EditPropUtils","css!DS/EditPropWidget/EditPropWidget.css"],function(e,t,i,n,s,a,r,o,l,c,d){var u=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON_WUX:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME_WUX:this.propertiesWidgetUI&&e.authorizedValues&&0===e.authorizedValues.length&&(e.dimension||e.dimensionType)?s=t.TYPES.UNIT:(i=e.get("type"),n="string"===i||"text"===i?"string_wux":i,"integer"===i?n=t.TYPES.INTEGER_WUX:"real"===i?n=t.TYPES.NUMBER_WUX:"timestamp"===i||"date"===i?n=t.TYPES.DATE_WUX:"person"===i?n=t.TYPES.PERSON_WUX:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN_WUX:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM_WUX),s=n),e.set("tw_type",s)),s},h=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME:(i=e.get("type"),n=i,"integer"===i?n=t.TYPES.INTEGER:"real"===i?n=t.TYPES.NUMBER:"timestamp"===i||"date"===i?n=t.TYPES.DATE:"person"===i?n=t.TYPES.PERSON:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM),s=n),e.set("tw_type",s)),s},p={},m=function(e,t,i){try{localStorage.setItem(e+"_style"+(i?"_"+i:""),JSON.stringify(t))}catch(e){console.log("Local storage full. Current form size can't be saved")}},g=function(e,t,i){var n=v(e,p[t]?p[t]:"200",t,i);return m(e,n,t),n},f=function(e,t){var i=localStorage.getItem(e+"_style"+(t?"_"+t:"")),n=null;try{(n=JSON.parse(i)).width<80&&(n.width=80)}catch(e){}return n||(n=g(e,t)),n},v=function(e,t,i,n){var s={};return s["."+e+" .formLabel"+(i?"."+i:"")]={width:t+"px"},s["."+e+" .resizeHandler"+(i?"."+i:"")]={left:t-10+"px"},{style:s,width:t,userAction:n}},_=function(e,t,i){var n=null;return e.forEach(function(e){var a=function(e,t){var i=f(e,t),n=e+"_style"+(t?"_"+t:"");return s.addNewStyles(n,i.style,!0),i}(e,i);t===e&&(n=a)}),n},E=e.extend({postBuildTweaker:function(){this._tweaker&&this._tweaker.postBuildUI(),this._finalizeWhenReady=!0},destroy:function(){this._parent.apply(this,arguments),this._model&&this._model.removeEvent(this._idAttr,this._manageMessageHandler)},init:function(e,t,i,n){this._parent(n),this._idAttr=i.getIdentifier(),this._model=t,this._form=e,this._tweaker=null,this._finalizeWhenReady=!1,this._manageMessageHandler=this._manageMessage.bind(this),this._unitHelperReady=!1;var s=this;!0!==n.postBuild&&this.subscribeEvt("triggerPostBuild",function(){s.postBuildTweaker()}),this.elements.container=UWA.createElement("div",{class:"formLine s12 m12"+(i.get("width")?" l"+i.get("width"):" l12")}),this.elements.flexLine=UWA.createElement("div",{class:"flexLine"}).inject(this.elements.container);var a=this._form._sharedOptions.identifier?"formLabel "+this._form._sharedOptions.identifier:"formLabel",r=UWA.createElement("div",{class:a+" s12"}).inject(this.elements.flexLine),l=!0!==this.options.readOnly&&i.get("mandatory");let p=i.get("dimensionType"),m=i.get("authorizedValues"),g=!(!p||!m||0!==m.length);var f=UWA.createElement("div",{class:"attrLabel"+(l?" mandAttr":"")}).inject(r),v=UWA.createElement("span",{class:"textContainer"}).inject(f),_=UWA.createElement("span",{text:i.get("label")}).inject(v);g&&(this._addUnitsHelper=function(e){let t=UWA.createElement("span",{class:"DimensionUnitInfoContainer"}).inject(f);s.elements.infoContainer=t;let i=new c(this.options);i._build(this.options,function(n){if(n){let s=d.getUnits(p);s&&s.length>0&&(i._injectData(s,this.options),n.inject(t),"function"==typeof e&&e(!0))}})}),_.tooltipInfos=new o({shortHelp:i.get("label"),mouseRelativePosition:!0}),!0===l&&UWA.createElement("div",{class:"attrMand",html:" *"}).inject(f);var E=this._idAttr,C=UWA.createElement("div",{class:"formValue s12"}).inject(this.elements.flexLine),S=UWA.createElement("div",{class:"formTweakerContainer",id:E}).inject(C);s.propertiesWidgetUI=!!t.propertiesWidgetUI;var y=t.propertiesWidgetUI||t.webUxTweakers?u.call(s,i):h(i),A={};this.options.readonly&&(A.readOnly=this.options.readOnly),A.postBuild=this.options.postBuild,!t.propertiesWidgetUI||t.webUxTweakers||"string"!==y&&"string_wux"!==y?A.forClickable=!1:A.forClickable=!0,this._form.tweakerManager.getTweaker(t,this._idAttr,y,A,function(e){e.inject(S),s._tweaker=e,s._finalizeWhenReady&&s.postBuildTweaker(),s.dispatchEvent("tweakerReady:"+s._idAttr,[e]),"string"!==i.tw_type&&"string_wux"!==i.tw_type||i.multiline||s._tweaker.addEvent("enterKeyDown",function(){t.dispatchEvent("onEnterKeyDown",[i])})}),t.addEvent("onChange:"+this._idAttr,this._manageMessageHandler),this._manageMessage()},showNotificationOnField:function(e){if(this.elements.errorContent&&this.elements.errorContent.setText(e.message?e.message:""),e.message)e.type&&e.type;else this.elements.flexLine.removeClassName("errorOnField")},_manageMessage:function(){var e=this._model.get(this._idAttr);this.propertiesWidgetUI=!!this._model.propertiesWidgetUI;var t=this._model.webUxTweakers||this._model.propertiesWidgetUI?u.call(this,e):h(e);if(e.validationFunction=this._form.tweakerManager.getValidationFunction(t),!(this._tweaker&&this._tweaker.lastRegisteredEvent&&"uncommittedChange"==this._tweaker.lastRegisteredEvent&&this._tweaker.options&&this._tweaker.options.tw_type&&"unit"===this._tweaker.options.tw_type||this._tweaker&&this._tweaker.type&&"multisel"===this._tweaker.type&&this._tweaker._tweakerInput&&this._tweaker._tweakerInput.lastRegisteredEvent&&"uncommittedChange"==this._tweaker._tweakerInput.lastRegisteredEvent&&this._tweaker._tweakerInput.options&&this._tweaker._tweakerInput.options.tw_type&&"unit"===this._tweaker._tweakerInput.options.tw_type)){var i=n.validateAttributes(this._model,[e]);e&&e.error&&this.showNotificationOnField(e.error),i&&i.length>0&&(!this._tweaker||!0===this._tweaker.underEdition)&&this.publishEvt("onNotifications",i)}},focusTweakerElement:function(){if(this._tweaker){var e=this._tweaker;e&&UWA.is(e.focus,"function")&&e.focus()}else this.addEventOnce("tweakerReady:"+this._idAttr,function(e){e&&UWA.is(e.focus,"function")&&e.focus()})}}),C=null,S=null;return e.extend({defaultOptions:{width:12,label:null,classname:"large",postBuild:!0},_sharedOptions:null,isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},init:function(e,t){this._parent(e),this._sharedOptions=t;var n=this;this.elements.container=UWA.createElement("fieldset",{class:"formContainer s12 m12 l"+this.options.width}),this.fields=[],this.resizeHandlerClass=this._sharedOptions.identifier?"resizeHandler "+this._sharedOptions.identifier:"resizeHandler";var r=UWA.createElement("div",{class:this.resizeHandlerClass}).inject(this.elements.container),o=null,l=null;this.elements.moveHelpers=new a({element:r,events:{startMove:function(){l=null;var e=f(n.getClassResize(),n._sharedOptions.identifier);o=e.width},move:function(e){if(l=null,e.diff.x){var t=o-e.diff.x;t<80?t=80:n.maxColWidth&&t>n.maxColWidth&&(t=n.maxColWidth);var i=n._sharedOptions.identifier;l=v(n.getClassResize(),t,i),s.addNewStyles(n.getClassResize()+"_style"+(i?"_"+i:""),l.style,!0)}},endMove:function(){if(l&&l.width){l.userAction=!0;m(n.getClassResize(),l,n._sharedOptions.identifier);n._publishResizeCell(l)}l=null}}}),e.label&&UWA.createElement("legend",{text:e.label}).inject(this.elements.container),this.elements.content=UWA.createElement("div",{class:"formContent"}).inject(this.elements.container),this.subscribeEvt("editionSwitched",function(e){n.switchTweakersStatus()}),this.subscribeEvt("innerSwitch",function(e){if(n.options.sizeClassname=e,S!==this.index){S=this.index;var t=f(e,n._sharedOptions.identifier);n._publishResizeCell(t)}}),this.subscribeEvt("resetDisplay",function(){C!==this.index&&(C=this.index,n.resetDisplay())}),this.addEvent("resetDisplay1",function(){var e=n.elements.content.getSize();if(n.idealLabelWidth||n.updateResizeLimit(),e.width){n.maxColWidth=e.width-287;var t=f(n.getClassResize(),n._sharedOptions.identifier);t&&t.width&&t.userAction?(p[n._sharedOptions.identifier]=t.width,n.maxColWidth<80?(p[n._sharedOptions.identifier]=80,n.resetDisplay(["medium","large"],t.userAction)):e.width-t.width<287&&(p[n._sharedOptions.identifier]=n.maxColWidth,n.resetDisplay(["medium","large"],t.userAction))):(p[n._sharedOptions.identifier]=n.idealLabelWidth,n.resetDisplay(["medium","large"]))}}),this.tweakerManager=new i({editable:!0===this._sharedOptions.editMode,onNotification:function(e){n.publishEvt("onNotifications",e)}},this._sharedOptions),this._manageEditionStatus(),!0===this.options.automaticCSS&&this.updateCSS()},updateCSS:function(){var e=_(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier);this._publishResizeCell(e)},_publishResizeCell:function(e){var t=null;e&&((t=function(e,t,i){var n={};return e.forEach(function(e){var s=f(e,i);t===e&&(s.current=!0),n[e]=s}),n}(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier)).userAction=e.userAction),this.publishEvt("onResizeCells",t)},updateResizeLimit:function(){var e=this;e.fields&&e.fields.length&&(e.idealLabelWidth=0,e.fields.forEach(function(t){t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:"auto"});var i=t.elements.flexLine.getElementsByClassName("formLabel")[0].getSize();i&&i.width&&e.idealLabelWidth<i.width&&(e.idealLabelWidth=i.width),t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:""})}))},resetDisplay:function(e,t){var i=e||this.options.classnames;i||(i=[this.getClassResize()]);var n=this;i.forEach(function(e){var i=g(e,n._sharedOptions.identifier,t),a=e+"_style"+(n._sharedOptions.identifier?"_"+n._sharedOptions.identifier:"");s.addNewStyles(a,i.style,!0)}),this._publishResizeCell(null)},getClassResize:function(){return this.options.sizeClassname},_manageEditionStatus:function(){var e=!1===this.isReadOnly()&&!0===this._sharedOptions.editMode;e?this.elements.container.addClassName("underEdition"):this.elements.container.removeClassName("underEdition"),this.fields&&Array.isArray(this.fields)&&(!0===e?this.fields.forEach(function(e){!1===e._unitHelperReady&&"function"==typeof e._addUnitsHelper&&e._addUnitsHelper(function(t){t&&(e._unitHelperReady=!0)}),!0===e._unitHelperReady&&e.elements&&e.elements.infoContainer&&e.elements.infoContainer.hasClassName("hide")&&e.elements.infoContainer.removeClassName("hide")}):this.fields.forEach(function(e){e.elements&&e.elements.infoContainer&&!e.elements.infoContainer.hasClassName("hide")&&e.elements.infoContainer.addClassName("hide")})),this.tweakerManager.switchMode(e)},destroy:function(){this.clear(),this.fields.forEach(function(e){e.destroy()}),this._parent.apply(this,arguments)},switchTweakersStatus:function(){this._manageEditionStatus()},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},clear:function(){this._clearAllFields(),this.elements.content.empty()},setModel:function(e,t){var i=this;this.clear();var n=null!=t&&t.attrs?t.attrs:e.getAllAttributes(),a=[];for(var r in n){var o=n[r];o instanceof l&&a.push(o)}a.sort(function(e,t){return s.compareValue(t.get("positionUI"),e.get("positionUI"))}),a.forEach(function(t){i._addLine(e,t)})},_addLine:function(e,t){this.options.readOnly=this.isReadOnly();var i=new E(this,e,t,this.options);this.fields.push(i),i.inject(this.elements.content)},toggleLineById:function(e,t){if(this.fields){var i=this.fields.find(t=>t._idAttr===e);if(i)return i.getContent().toggle(t),!0}},focusLine:function(e){this.fields[e].focusTweakerElement()}})}),define("DS/EditPropWidget/utils/EditPropIndexDictionaryForUnits",["UWA/Core","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/constants/EditPropConstants"],function(e,t,i,n,s){"use strict";return e.Class.singleton({_dictionary:null,init:function(){this._dictionary=null},setUpDimensionsDictionary:function(){var e=this,s=e._getDictionary();if(s)return e._dictionary=s,void e._destoryDictionary();e._dictionary=new Map;var a=i.getCancelObject(),r=n.getServiceBySource("3dspace"),o=i.getLanguage(),l={tenantId:i.getTenantID(),lang:o,handleRequest:{handle:a},defService:r,onComplete:function(t){t&&"object"==typeof t&&t.results&&t.results.length>0&&(t.results.forEach(function(t){e._dictionary.set(t.Name,t)}),e._storeDictionary(e._dictionary))}};t.getListOfDimensions(l)},getDimension:async function(e,t,i){var n=this;n._getDictionary()&&n._destoryDictionary();var a=0;e.results[0].data.forEach(async function(r){if(t.has(r.name)){var o=t.get(r.name),l=o.dimension,c=n.getMKSUnit(l),d=o.manipulationUnit,u=n.getNLSNameForDimension(l,d);if(r.dimensionType=s.EDITPROPINDEX_DIMENSION+l,r.unitName=d,r.dimension=u,d&&d.length>0&&c!==d){a++;var h={UnitFrom:c,UnitTo:d,Dimension:l,Values:r.valueDB};n.getConvertedMKSValue([h],function(t){a--,t&&"object"==typeof t&&t.ConvertedValues&&(r.value=t.ConvertedValues,r.valueDB=t.ConvertedValues),0===a&&i(e)})}}}),0===a&&i(e)},getMKSUnit:function(e){return this._dictionary.get(e)?this._dictionary.get(e).MKSUnit:""},getNLSNameForDimension:function(e,t){var i=this._dictionary.get(e);if(i){if(0===t.length&&(t=i.MKSUnit),i&&i.Units&&Array.isArray(i.Units))for(var n=0;n<i.Units.length;n++)if(i.Units[n].Name===t)return i.Units[n].NLSName;return""}},getConvertedMKSValue:function(e,s){var a=i.getCancelObject(),r=n.getServiceBySource("3dspace"),o=i.getLanguage(),l={tenantId:i.getTenantID(),lang:o,data:e,handleRequest:{handle:a},defService:r,onComplete:function(e){if(e&&"object"==typeof e)for(var t in e){var i=e[t];Array.isArray(i)&&i.length>0&&i[0]&&s(i[0])}}};t.getConvertedMKSValue(l)},_storeDictionary:function(e){window.top.ENOEditPropIndex_DimensionDictionary=e},_getDictionary:function(){return window.top.ENOEditPropIndex_DimensionDictionary?window.top.ENOEditPropIndex_DimensionDictionary:null},_destoryDictionary:function(){window.top.ENOEditPropIndex_DimensionDictionary&&delete window.top.ENOEditPropIndex_DimensionDictionary}})}),define("DS/EditPropWidget/form/FormOrganizer",["DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/models/EditPropAttributeModel","DS/WidgetServices/WidgetServices","DS/EditPropWidget/form/Form"],function(e,t,i,n){return e.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this._display=null,this._sharedOptions=t,this._forms=[],this.elements.container=UWA.createElement("div",{class:"formOrganizer "+(this.options.className?this.options.className:"")})},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this._forms.forEach(function(e){e.destroy()}),this._forms=[]},_callOnForms:function(e,t){this._forms.forEach(function(i){i[e].apply(i,t)})},setModel:function(e,t){var i=e.getAllAttributes();this.setAttributes(e,i,t)},setAttributes:function(e,s,a){var r=this;this.clear();var o={},l=[];for(var c in s){var d=s[c];if(d instanceof t&&!0!==d.isTransient){var u=d.get("form");u||(u="DSDefault");var h=o[u];if(!h){var p=a?a[u]:null;h={list:[],name:u},p&&(h.group=p,void 0!==p.position&&(h.position=p.position)),l.push(h),o[u]=h}h.list.push(d)}}l.sort(function(e,t){n=null;var n=void 0===e.position&&void 0!==t.position?1:null;return n=null===(n=null===(n=null===n&&void 0===t.position&&void 0!==e.position?-1:n)&&void 0!==t.position&&void 0!==e.position?e.position-t.position:n)?i.compareValue(t.name,e.name):n});var m=++window.top.perfoIncrem;window.top.performance.mark("start_buildForm:"+m),l.forEach(function(t){var i=UWA.clone(r.options);if(t.group)for(var s in t.group)i[s]=t.group[s];i.automaticCSS=!1;var a=new n(i,r._sharedOptions);a.setModel(e,{attrs:t.list}),a.inject(r.elements.container),r._forms.push(a)}),r._forms.length>0&&r._forms[0].updateCSS(),window.top.performance.mark("end_buildForm:"+m)},focusLine:function(e,t){var i=this;setTimeout(function(){i._forms[e].focusLine(t)},0)},toggleFormLine:function(e,t){this._forms&&this._forms.forEach(function(i){i.toggleLineById(e,t)})}})}),define("DS/EditPropWidget/popup/EditPropPopup",["UWA/Controls/Abstract","DS/Logger/Logger","DS/EditPropWidget/controllers/EditPropMainController","DS/WidgetServices/WidgetServices","DS/EditPropWidget/constants/EditPropConstants","DS/UIKIT/Spinner","DS/ENOFloatingPanel/ENOFloatingPanel","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/editPropPopup"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({defaultOptions:{className:"",readOnly:!1,serverName:"",serverUri:"",editMode:!1,container:null,context:null},init:function(e){this.dataReady=!1,this._parent(e),this.initUI()},centerIt:function(){this.centerAtNextResize=!1,this.container.centerIt()},setDefaultListOfModel:function(e){this.defaultModels=e},setDataReady:function(e){e&&(this.defaultModels=null),this.dataReady=e},getController:function(){return this.propController},initUI:function(){var e=this;this.centerAtNextResize=!1,this.widgetPere=this.options.container,this.widgetPere=this.widgetPere?this.widgetPere:n.getWidgetBody();var t={},o=this.options;for(var c in o)t[c]=o[c];t.className="editProp_innerComponent",t.showTopBar=!1,t.popup=!0,t.setCloseButton=!0,t.setEditButton=!0,t.events={};var d=!1,u={onDataLoaded:function(){if(d){var t=e.propController.getOptimalSize(),i=t.width;i<600&&(i=600),e.container.setNewBodySize({width:i,height:t.height}),e.container.lockWidth(),e.centerAtNextResize=!0}e.fakeFloatingPanel.hide()},onTitleChanged:function(){var t=e.propController.getTitle();t&&(t=" - "+(t=(t=t.replace(/(&nbsp;)/g," ")).replace(/(<wbr>)/g,""))),e.container.setTitle("ENOVIA - Information"+t)},onIdentityCardExpands:function(){e.onResize()}};if(o.events)for(var c in o.events)t.events[c]=o.events[c];for(var c in u)t.events[c]=u[c];e.propController=new i(t);e.propController.getTopBar();var h=UWA.createElement("table",{class:"EditProp_topBarPopup"}),p=(UWA.createElement("td",{class:"titleSpan"}).inject(h),UWA.createElement("td",{class:"right-actions"}).inject(h),null),m=null;n.isWebInWinEnvironment()||n.isNatifEnvironnement()||(n.getRealPath("EditPropWidget/EditPropWidget.html",widget,!1),p={custoClass:"properties_piner",widgetTitle:"",widgetAppId:"ENOLCMT_AP",widgetData:{title:"My widget",SelectedItem:[],loadData:!0,editProperty_collapseIC:n.getWidgetValue(s.COLLAPSE_IC_PREFERENCE.name),editProperties_editMode:n.getWidgetValue("editProperties_editMode")}},m=function(t){var i=e.propController.getModels();0===i.length&&e.defaultModels&&(i=e.defaultModels);i.forEach(function(e,t){var n=UWA.clone(e.getChangedValues());i[t].set("EditProp_listOfChange",n)}),t.widgetData.SelectedItem=i,t.widgetData.loadData=!e.dataReady,t.widgetData.editProperty_collapseIC=n.getWidgetValue(s.COLLAPSE_IC_PREFERENCE.name),t.widgetData.editProperties_editMode=n.getWidgetValue("editProperties_editMode")});var g=UWA.createElement("span");new a({visible:!0}).inject(g),UWA.createElement("span",{tag:"span",text:l.get("Loading")}).inject(g),e.fakeFloatingPanel=new r({className:"EPP_PopupDialFake",body:g,title:"ENOVIA - Information",pinOptions:p,pinCallback:m,overlay:!1,closable:!0,animate:!0,resizable:!1,events:{onClose:function(){e._cancel()}}}),e.container=new r({className:"EPP_PopupDial "+this.options.className,body:e.propController.getUI(),footer:e.propController.getTopBar(),title:"ENOVIA - Information",pinOptions:p,pinCallback:m,persistId:"floatProperties",overlay:!1,closable:!0,animate:!0,resizable:!0,autocenter:!1,events:{onResizeFloating:function(){e.centerAtNextResize&&e.centerIt()},onClose:function(){e._cancel()}}}),d=!e.container.isDimensionSaved(),e.container.elements.container.setStyle("left",-2e4),e.fakeFloatingPanel.inject(this.widgetPere),e.container.inject(this.widgetPere);var f=this.container.elements.header;this.container.elements.content;setTimeout(function(){var t=e.widgetPere.getSize(),i=f.getSize(),n="1000";"1000">t.height-i.height&&(n=t.height-i.height),d&&e.container.setNewSize({width:600,height:n}),e.fakeFloatingPanel.centerIt()},0)},show:function(){this.fakeFloatingPanel.show(),this.container.show()},onRefresh:function(){null!=this.propController&&this.propController.onRefresh()},onResize:function(){this.container.onResize(),this.propController&&this.propController.onResize()},_cancel:function(){this.dispatchEvent("onCancel"),this.dispatchEvent("onInnerCancel")},destroyComponent:function(){this.propController.destroyComponent(),this.container.hide(),this.container.destroy(),this.fakeFloatingPanel.hide(),this.fakeFloatingPanel.destroy()}})}),define("DS/EditPropWidget/form/FormSections",["DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/form/FormOrganizer","DS/EditPropWidget/comm/EventManager","DS/WidgetServices/WidgetServices","DS/UIKIT/Accordion","DS/Controls/Accordeon","DS/EditPropWidget/constants/EditPropConstants","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l){var c=o.ACCORDION.ATTRIBUTES,d=l.get("accordion_attributes"),u=l.get("accordion_parameters");return e.extend({_sharedOptions:null,defaultOptions:{showSections:!0,sizeClassname:"large"},init:function(e,t){var i=this;this._parent.apply(this,arguments),this.options.classnames=["large","medium","small"],this.openedExpanderItemIndex=[],this._sharedOptions=t,this.elements.accordion=new r({items:[],style:"simple",exclusive:!1}),this.elements.accordion.getContent().addEventListener("expand",function(e){n.publish("onTableOpened",e.options.expanderTarget.domId);var t={expanderItem:e,action:"opened"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)}),this.elements.accordion.getContent().addEventListener("collapse",function(e){var t={expanderItem:e,action:"closed"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)}),this.elements.container=UWA.createElement("div",{class:this._getDefaultClassname()+" "+this.options.sizeClassname}),this.elements.container.addEvent("resize",function(){console.log("resize section")}),this.elements.accordion.inject(this.elements.container),this.subscribeEvt("switchDisplay",function(e){i._switchDisplay(e)||i.publishEvt("innerSwitch",i.options.sizeClassname)}),this.subscribeEvt("switchWrap",function(){i._switchWrap()}),this.elements._organizers={},this._accordionProperties=[],this._openedSections=[c]},_switchWrap:function(){this.options.titleWrap?this.elements.container.removeClassName("formWrap"):this.elements.container.addClassName("formWrap"),this.options.titleWrap=!this.options.titleWrap},_getDefaultClassname:function(){var e="";return s.isTouchDevice()&&(e="touchDevice "),!0===this.options.titleWrap&&(e+="formWrap"),"formSections "+e},_switchDisplay:function(e){var t=this._display===e;return t||(this._display=e,this._checkSize()),t},_checkSize:function(){var e=this.elements.container.getSize().width,t=this._getDefaultClassname();(null===this._display&&e<500||"s"===this._display)&&(this.options.sizeClassname="small"),(null===this._display&&e<1e3&&e>500||"m"===this._display)&&(this.options.sizeClassname="medium"),(null===this._display&&e>1e3||"l"===this._display)&&(this.options.sizeClassname="large"),t+=this.options.sizeClassname,this.elements.container.className=t},inject:function(){var e=this;this._parent.apply(this,arguments),setTimeout(function(){e._checkSize()})},getOrganizers:function(){return this.elements._organizers},setAccordionProperties:function(e){this._accordionProperties=e},_callOnOrganizers:function(e,t){for(var i in this.elements._organizers){var n=this.elements._organizers[i];n[e].apply(n,t)}},openSections:function(e){var t=this;e.forEach(function(e){t.openSection(e)})},openSection:function(e){var t=this.findExpanderIndexFromId(e);this.elements.accordion.expandItem(t)},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this.reset()},setModel:function(e,i){var n=this;this.clear(),this._model=e,this._groups=i;var a=e.getAllAttributes(),r={},o=[];for(var l in a){var h=a[l];if(h instanceof t&&!0!==h.isTransient){var p=c,m=h.get("facet"),g=h.get("section"),f=h.get("extension");m=m||g,(n.options.showSections||m===u)&&(p=m||c);var v=r[p];if(!v){var _=n._accordionProperties[p];if(!((_=_||{})&&_.name&&_.nameNLS&&_.icon)){var E=n._accordionProperties[f];E&&(_.icon=E.icon),_.name=p,_.nameNLS=g||(p===c?d:p)}n._accordionProperties[p]=_,"Default"!==h.group&&(_.name=h.group,_.nameNLS=h.groupNLS,_.weight=h.groupWeight),_.weight||(_.weight=0),v={list:[],name:p,section:_},o.push(v),r[p]=v}v.list.push(h)}}o.sort(function(e,t){var i=e.section.weight===t.section.weight?null:e.section.weight<t.section.weight?1:-1;return i=null===i?s.compareValue(t.name,e.name):i});var C=++window.top.perfoIncrem;window.top.performance.mark("start_buildSections:"+C),o.forEach(function(e){n.addSection(e)}),window.top.performance.mark("end_buildSections:"+C),this.openSections(this._openedSections)},addSection:function(e,t){var i=e.section,n=i,s=i;if("object"==typeof i&&(n=i.name),t){var a=this.findExpanderIndexFromId(n);if(!!this.elements.accordion.getExpanderFromIndex(a))return}var r=this._accordionProperties[n],o=null;r&&(t||r.nameNLS&&(s=r.nameNLS),r.icon&&(o="classif"===r.icon?UWA.createElement("span",{class:"fonticon fonticon-flow-tree",title:l.get("EP_icon_classification")}):UWA.createElement("img",{src:r.icon,width:"10px"})));var c=UWA.createElement("span",{text:s});o&&o.inject(c);var d=s?s.replace(/ /g,"_"):"";this._addSection({expandedFlag:s!==u&&this.options.sectionAutoexpand,name:n,attrs:e.list,title:c,orgClassName:"formSection_"+d})},reset:function(){for(var e in this.elements._organizers){var t=this.elements._organizers[e];t.remove(),t.destroy(),delete this.elements._organizers[e];var i=this.findExpanderIndexFromId(e);this.elements.accordion.deleteItem(i)}},_addSection:function(e){if(e&&e.name){var t=e.name,n=this.elements._organizers[t];if(!n){var s=UWA.clone(this.options);s.className=e.orgClassName,n=new i(s,this._sharedOptions),this.elements._organizers[t]=n,e.content=n.getContent();var a=this.elements.accordion.addItem(e),r=this.elements.accordion.getExpanderFromIndex(a);r.domId=e.name,e.title&&e.title.textContent&&(r.header=e.title.textContent)}n.setAttributes(this._model,e.attrs,this._groups)}this._manageAccordionVisibility()},toggleFormOrgLine:function(e,t){var i=this.elements._organizers;if(i)for(var n in i){i[n].toggleFormLine(e,t)}},_manageAccordionVisibility:function(){this.elements.accordion.items.length<=1?this._hideAccordion():2==this.elements.accordion.items.length&&this._showAccordion()},_hideAccordion:function(){var e=this.elements.accordion.getExpanderFromIndex(0);if(e){var t=this.elements.accordion.elements.container.parentElement,i=this.elements._organizers[e.domId];t&&i.inject(t)}this.elements.accordion.hide()},_showAccordion:function(){var e=this.elements.accordion.getExpanderFromIndex(0);e&&this.elements._organizers[e.domId].inject(e.elements.bodyContainer);this.elements.accordion.show()},findExpanderIndexFromId:function(e){for(var t=0;t<this.elements.accordion._expanderItems.length;t++)if(this.elements.accordion._expanderItems[t].domId===e)return t;return-1},getIndexesOfOpenedOrSelectedAccordeonItems:function(e){var t=e.expanderItem.options.expanderTarget.domId,i=e.action;if("opened"===i){for(var n=0;n<this._openedSections.length;n++)if(t&&this._openedSections[n]===t)return;t&&this._openedSections.push(t)}else if("closed"===i){var s=this._openedSections.filter(e=>e!==t);this._openedSections=s}}})}),define("DS/EditPropWidget/facets/Properties/Properties",["UWA/Class","DS/EditPropWidget/models/CommonAbstract","UWA/Json","UWA/Array","DS/WidgetServices/WidgetServices","DS/EditPropWidget/form/FormSections","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/facets/Properties/EditPropBase","DS/EditPropWidget/facets/Properties/PropertiesUIController","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/WidgetServicesUI/tweakers/TweakerWUXButton","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,m,g){"use strict";g.get("accordion_attributes"),g.get("accordion_parameters");window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;return e.extend(t,o,{_previousScrollerPosition:null,defaultOptions:{setRefreshButton:!1,setValidButton:!0,setCloseButton:!0,setEditButton:!1,showTopBar:!0,editMode:!1,showSections:!0,sectionAutoexpand:!1,readOnly:!0,scroller:!0,displayType:c.STANDARD,updateSession:!1},init:function(e){require(["DS/TransientWidget/TransientWidget"]),this._parent.apply(this,arguments),this.wiwListModels=null,this.handlerTouchEnd=function(e){Date.now()}.bind(this),this.handlerDblClick=null,this.handlerAttributeChanged=function(){this._ManageValidButton()}.bind(this),this.handlerLabelChanged=function(){this._firstModel&&this.dispatchEvent("onTitleChanged",this._firstModel.get("label"))}.bind(this),this._firstModel=null,this._previousScrollerPosition=null,this.lastPointedTableCellObj=null,this._sharedOptions.editMode=!0===e.editMode,this._sharedOptions.identifier=e.identifier,e.webUxTweakers&&(this.webUxTweakers=e.webUxTweakers),e.propertiesWidgetUI&&(this.propertiesWidgetUI=e.propertiesWidgetUI),this.elements.UIController=new l([]),this.isReadOnly=this.isReadOnly();var t=this;this.subscribeEvt("onResizeCells",this._onCellResized.bind(this)),this.subscribeEvt("onNotifications",function(e){t.setError(e)}),this.initUI()},_onCellResized:function(e){var t=null,i=!1;if(e){var n=e.medium;i=!0!==(t=n&&!0===n.current?n:e.large).current}var s=!1;if(!i){var a=c.MIN_WIDTH_FOR_TABLE;e&&(a=parseInt(t.width)),s=c.VARIABLES.minWidthForTable!==a,c.VARIABLES.minWidthForTable=a}e&&!0===s&&this.dispatchEvent("refreshActions"),this._updateUI()},setAccordionProperties:function(e){this.elements.formSection.setAccordionProperties(e)},isReadonly:function(){return!1!==this.isReadOnly},clear:function(){this._clearAllFields()},_clearAllLine:function(){this.elements.formSection.clear()},_getModel:function(e){return this.elements.UIController.getModel(e)},initData:function(e,t){this.resetUIValues(),this.elements.UIController.setModels([]),this._clearAllLine();var i=this._sharedOptions.editMode;if(t)switch(t.edition){case c.FORCE_READWRITE:i=!0;break;case c.FORCE_READONLY:i=!1;break;case c.FORCE_DEFAULT:i=!0===this.options.editMode}if(this._sharedOptions.editMode!==i&&this._switchEditionMode(),!0===this.options.updateSession){if("undefined"!=typeof dscef){this.wiwListModels=e;var n=e[0]._attributes,s=[];for(var a in n){if(null!=n[a]){var r=n[a].value,o=n[a].valueDB,l=n[a].readOnly;null!=r&&null!=l&&null!=o&&s.push({attribute:a,value:n[a].value,valueDB:n[a].valueDB,readOnly:n[a].readOnly})}}var d=JSON.stringify(s);dscef.sendString('{"operation":"getData","operationVersion":"1.0","attributes":'+d+"}")}}else this.addData(e)},addData:function(e){this._addData(e)},changeAttributes:function(e){var t=JSON.parse(e);if(null!=this.wiwListModels&&null!=e){for(var i=0;i<t.attributes.length;i++){var n=t.attributes[i],s=n.attribute,a=n.value,r=n.valueDB,o=n.readOnly;null!=a&&null!=r&&null!=o&&(this.wiwListModels[0]._attributes[s].value!=a&&(this.wiwListModels[0]._attributes[s].value=a,this.wiwListModels[0]._attributes[s].initialsValues.value=a),this.wiwListModels[0]._attributes[s].valueDB!=r&&(this.wiwListModels[0]._attributes[s].valueDB=r,this.wiwListModels[0]._attributes[s].initialsValues.valueDB=r),this.wiwListModels[0]._attributes[s].readOnly!=o&&(this.wiwListModels[0]._attributes[s].readOnly=o))}this.addData(this.wiwListModels)}},_getScrollerContent:function(){return this.elements.scroller?this.elements.scroller.elements.content:null},_scrollIsBottom:function(e){var t=!1;if(e){var i=e.scrollHeight,n=e.getDimensions();t=0!==e.scrollTop&&e.scrollTop>i-n.height}return t},_getScrollerPosition:function(){var e=this._getScrollerContent();return e?this._scrollIsBottom(e)?-1:e.scrollTop:null},_setScrollerPosition:function(e){var t=this._getScrollerContent();t&&(t.scrollTop=-1===e?t.scrollHeight:e)},_saveScrollerPosition:function(){this._previousScrollerPosition=this._getScrollerPosition()},_restoreScrollerPosition:function(){null!==this._previousScrollerPosition&&this._setScrollerPosition(this._previousScrollerPosition),this._previousScrollerPosition=null},onResize:function(){},_addData:function(e){var t=++window.top.perfoIncrem;window.top.performance.mark("start_LoadUI:"+t);var i=this;this._ManageValidButton(!1),null!=e&&e.length>0&&this.elements.UIController.setModels([e[0]]);var n=this.elements.UIController.getModels();if(n.length<=0)this._clearAllLine();else{var a=n[0];this._firstModel=a,a.addEvent("onChange:label",this.handlerLabelChanged),a.addEvent("onChange",this.handlerAttributeChanged),this.updateTableManager(),this.onResize(),this._ManageValidButton(),this.endOfLoad()}window.top.performance.mark("end_LoadUI:"+t),this.dispatchEvent("onChangeSize"),this.dispatchEvent("onTitleChanged"),this.elements.UIController.validateModels(this.elements.UIController.getModels()),window.top.readPerfo=function(e,t){console.log("computing..."),require(["text!DS/EditPropWidget/assets/noNls/perfos.json"],function(i){for(var n=JSON.parse(i),a=[],r=window.top.performance.getEntriesByType("mark"),o={},l="",c=0;c<r.length;c++){var d=r[c].name,u=r[c].startTime,h=d.replace("start_","").replace("end_",""),p=h,m=null;if(d!==h){a.push(d);var g=h.split(":");p=g[0],g.length>0&&(m=g[1])}if(o[h]){var f=u-o[h].startTime;if(o[h].endTime=u,o[h].duration=f,window.console){var v=(n[p]?n[p]:p+" [ NO NLS ]").toUpperCase();m&&(v+=" :increm: "+m),!0===e&&(v+=" -- specificName: "+h+" -- Entry Type: "+r[c].entryType+" -- Start Time: "+o[h].startTime+" -- End Time: "+u),v+=" -- Duration: "+f+"ms \n",console.log(v),l+=v}}else o[h]={startTime:u}}a.forEach(function(e){window.top.performance.clearMarks(e)}),!0!==t&&s.download("perfo",l,"text",!1)})},console.log("%creadPerfo() to read Properties the performances","color:blue;font-weight:bold;"),s.isDebug()&&setTimeout(function(){window.top.readPerfo(!0,!0)},2e3),window.top.performance.mark("end_EP_DataDisplay"),setTimeout(function(){i._restoreScrollerPosition(),window.top.performance.mark("end_EP_FullTime")}),this.elements.formSection._manageAccordionVisibility()},endOfLoad:function(){var e=this;this.dataLoadedOnce||setTimeout(function(){e.dataLoadedOnce=!0,e.dispatchEvent("onDataLoaded")},0)},_isCloseButton:function(){return c.isCloseButton(this.options.displayType)},show:function(){this.getUI().show()},setOption:function(e,t){this._parent.apply(this,arguments),this.elements.formSection.options[e]=t},resetDisplay:function(){this.publishEvt("resetDisplay")},initUI:function(){var e=++window.top.perfoIncrem;window.top.performance.mark("start_EP_InitUI:"+e);var t=this;if(this.elements.mainDiv=this.elements.container=UWA.createElement("div",{class:"EditProp_MainContain includeMenuBar"}),!0!==this.isReadOnly&&!0===this._sharedOptions.editMode||this.elements.container.addClassName("EP_ReadOnly"),this.ManageButtonDiv=UWA.createElement("div",{class:"EditProp_ManageButtonDiv"}),t.ManageButtonTopRight=UWA.createElement("td",{class:"EditProp_ManageButtonTopRight"}),!this._isCloseButton()){var i={label:g.get("EP_Cancel"),className:"EditProp_buttonTop EditProp_Cancel TopButtonCancel",setAttribute:{name:"TopButtonCancel"},clickCallback:function(){"undefined"!=typeof dscef&&dscef.sendString('{"operation":"onClose","operationVersion":"1.0"}'),t.elements.UIController.resetValueOfModels(),t.elements.UIController.validateModels(t.elements.UIController.getModels()),setTimeout(function(){t._ManageValidButton()},0)}};this.elements.boutonCancel=new p(i)}this.elements.boutonCancel&&!0===t.options.setCloseButton&&this.elements.boutonCancel.inject(t.ManageButtonDiv),t.ManageButtonTopRight.inject(this.elements.container);var n=this.elements.containerProperties=UWA.createElement("div",{class:"EP_ContainerProperties"}),o=this.elements.containerAccordeon=UWA.createElement("div",{class:"EP_ScrollerProperties"});r.subscribe("onTableOpened",function(e){t._saveScrollerPosition()}),this.elements.formSection=new a({postBuild:!1,sectionAutoexpand:this.options.sectionAutoexpand,showSections:this.options.showSections,eventThread:this.options.eventThread},this._sharedOptions),this.elements.formSection.inject(o),o.setStyle("overflow-y","auto"),o.inject(n);var l=this.elements.bottomTable=UWA.createElement("div",{class:"EditProp_BottomTableContainer"}),d="true"===s.getWidgetValue(c.COLLAPSE_IC_PREFERENCE.name)&&this.options.typeOfDisplay===c.ALL;null!==d&&!0!==d||s.setWidgetValue(c.COLLAPSE_IC_PREFERENCE.name,"true");var u=this.elements.containerMainTable=UWA.createElement("div",{class:"ICTableContainer "}).inject(l);n.inject(u),l.inject(this.elements.container),!0===this.options.showTopBar&&this.ManageButtonDiv.inject(t.elements.container),this.elements.formSection._manageAccordionVisibility(),window.top.performance.mark("end_EP_InitUI:"+e),this.elements.container.addEvent("resize",this._updateUI.bind(this))},_updateUI:function(){var e=this.elements.container.getSize();e.width&&e.width<381?this.publishEvt("switchDisplay","s"):this.publishEvt("switchDisplay","m")},getUI:function(){return this.elements.container},resetUIValues:function(){this.elements.formSection&&this.elements.formSection.reset()},getComponentMode:function(){return!0===this.options.updateSession||this.isReadOnly},switchComponentMode:function(e){this.isReadOnly=e,this.handlerDblClick&&this.elements.container.removeEvent("dblclick",this.handlerDblClick),this.handlerDblClick=null,!0!==e&&(this.handlerDblClick=function(){this._switchEditionMode(!0)}.bind(this),this.elements.container.addEvent("dblclick",this.handlerDblClick))},addSection:function(){this.elements.formSection.addSection.apply(this.elements.formSection,arguments)},_switchEditionMode:function(e){var t=!1;if(e!==(!1===this.isReadOnly&&!0===this._sharedOptions.editMode)){if(!1===this.isReadOnly)if(this._sharedOptions.editMode){if(this.elements.UIController.getModifiedModels().length>0){var i=g.get("Some attributes are in edition. Please valid or cancel the modifications to switch");return this._isCloseButton()&&(i=g.get("Some attributes are in edition. Please valid or refresh to switch")),void this.addWarning(i)}this._sharedOptions.editMode=!1,this._activateAddingButton(!1)}else this._sharedOptions.editMode=!0,this._activateAddingButton(!0);else this._sharedOptions.editMode=!1;t=!0}return t&&this.publishEvt("editionSwitched",this._sharedOptions.editMode),!0!==this._sharedOptions.editMode?this.elements.container.addClassName("EP_ReadOnly"):this.elements.container.removeClassName("EP_ReadOnly"),s.setWidgetValue("editProperties_editMode",this._sharedOptions.editMode),t},_switchEdition:function(e){this._switchEditionMode(e)&&this.onResize(),this.lastPointedTableCellObj=null},resizeActionActive:function(){return c.VARIABLES.minWidthForTable!==c.MIN_WIDTH_FOR_TABLE},getOptimalSize:function(){var e=this.elements.masterTable.getSize(),t=this.elements.containerProperties.getSize(),i=e.height-t.height,n=this.elements.formSection.getContent().getSize();return n.height+=i+60,n.width+=30,n},updateTableManager:function(){this._saveScrollerPosition(),this._clearAllLine(),this.updateTable()},updateTable:function(){var e=this;this._clearAllFields(),this._clearAllLine(),e.modelIdentityCard&&(e.modelIdentityCard.set("title",""),e.modelIdentityCard.set("ownerName",""),e.modelIdentityCard.set("date",""),e.modelIdentityCard.set("description",""));var t=this.elements.UIController.getModels(),i=t.length,n=++window.top.perfoIncrem;window.top.performance.mark("start_addInForm:"+n);for(var s=0;s<i;s++){var a=t[s];this.webUxTweakers&&(a.webUxTweakers=this.webUxTweakers),this.propertiesWidgetUI&&(a.propertiesWidgetUI=this.propertiesWidgetUI),this.elements.formSection.setModel(a)}window.top.performance.mark("end_addInForm:"+n),this._restoreScrollerPosition(),setTimeout(function(){e.publishEvt("triggerPostBuild")})},saveIsNeeded:function(){var e=!0;return this.elements.UIController.getModifiedModels().every(function(t){var i=t.previousAttributes();for(var n in"function"==typeof t.getChangedValues&&(i=t.getChangedValues()),i){var s=i[n];if(s instanceof d&&!1===s.isTransient){e=!1;break}}return!1!==e}),!e},validateModel:function(){var e=!1,t=this.elements.UIController.getModifiedModels();if(t.length>0){var i=this.elements.UIController.validateModels(t);i?(i.message=g.get("Modification failed")+":"+i.message,this.setError(i)):e=!0}return this._ManageValidButton(),e},_valueIsChanging:function(e,t){this._ManageValidButton();var i={value:t,valueDB:e.get("valueDB")};e.isSameValueSet(i)&&this._activateValidButton()},_activateAddingButton:function(e){this.dispatchEvent("onAddActivation",e)},_activateValidButton:function(e){var t=!e;this.elements.boutonCancel&&(t?this.elements.boutonCancel.show():this.elements.boutonCancel.hide()),this.dispatchEvent("onValidActivation",t)},_ManageValidButton:function(){this._activateValidButton(!this.saveIsNeeded())},getButtons:function(){return this.ManageButtonDiv},getTitle:function(){var e="";return this.elements.UIController&&(e=this.elements.UIController.getLabel()),e},showNotification:function(e){this.addSuccess(e)},setError:function(e){var t=this;if(n.isArray(e))e.forEach(function(e){var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)});else{var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}},_manageError:function(e,t){if(e)switch(e.eventID?e.eventID:"error"){case"warning":this.addWarning(e.message?e.message:e,t);break;case"success":this.addSuccess(e.message?e.message:e,t);break;default:this.addError(e,t)}},addWarning:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"warning",customClass:t})},addSuccess:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"success",customClass:t})},addInfo:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"info",customClass:t})},addError:function(e,t){this.dispatchEvent("onNotification",{msg:e.message?e.message:i.encode(e),eventID:"error",customClass:t})},getFormSection:function(){if(this.elements&&this.elements.formSection)return this.elements.formSection}})}),define("DS/EditPropWidget/facets/Properties/EditPropController",["UWA/Class/Model","UWA/Core","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/EventManager","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/EditPropWidget/facets/Properties/Properties","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropBaseUX/scripts/EditPropUtility","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,m,g,f,v){"use strict";var _=v.get("accordion_parameters");return a.extend({defaultOptions:{serverName:"",serverUri:"",displayType:u.STANDARD,extraNotif:!1,context:null},getListHandle:null,commitHandle:null,previewUrlHandle:null,init:function(e){var t=this;this._parent.apply(this,arguments),this.getListHandle={handle:null},this.commitHandle={handle:null},this.previewUrlHandle={handle:null};var i={};for(var n in e)i[n]=e[n];i.events=i.events?i.events:{},i.events.onNotification=function(e){t._setError(e.msg?e.msg:e.json,e.eventID,e.customClass)},i.events.onValidActivation=function(e){t.switchSaveButton(e)},i.events.onAddActivation=function(e){t.switchAddButton(e)},t.parametersLoaded=!1,t.indexModeParameter=!!e.indexModeParameter,s.subscribe("onTableOpened",function(e){e!=_||!1!==t.parametersLoaded||t.indexModeParameter||(t.parametersLoaded=!0,t._loadPLMParameters())}),i.events.refreshActions=function(e){t.refreshActions()},this._createUI(i)},isUIReadonly:function(){return this.editPropertiesUI.isReadonly()},_createUI:function(e){e.className=this.getTabId(),e.eventThread=this.options.eventThread,this.editPropertiesUI=new d(e,this.getSharedOptions())},nothingToSave:function(){return!this.editPropertiesUI.saveIsNeeded()},onSave:function(){var e=this.editPropertiesUI.validateModel(),t=this.getModel();if(e)if(!0===this.options.updateSession){var i=t.changedValues,n=[];for(var s in i)if(null!=s){var a=i[s].value,r=i[s].valueDB;null!=a&&null!=r&&n.push({attribute:s,value:a,valueDB:r})}var o=JSON.stringify(n);"undefined"!=typeof dscef&&dscef.sendString('{"operation":"onOk","operationVersion":"1.0","attributes":'+o+"}")}else this._commitModels([t])},getExtensions:function(){var e=this,t=e.getModel();let n=function(i,n){e.showLoader();new i(widget,e._parent,e.options,n,t,function(){e._raiseAddExtensionEvent(t),e.hideLoader(),e.onRefresh()},function(t){e.hideLoader(),require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({eventID:"string"==typeof type?type:"info",msg:t})})})};require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],function(s){var a=t.getTenant();i.getInstance({tenant:a}).getValidSecurityContext({context:e.options.context,onSuccess:function(e){n(s,e)},onFailure:function(t){e._setError(t)}})},function(){e._setError("AddExtensionWidget do not exist")})},onAction:function(e){e===u.ACTION_SWITCH?this.switchEdition():e===u.ACTION_RESET&&(this.editPropertiesUI.resetDisplay(),this.refreshActions())},isActionAvailable:function(e){return e===u.ACTION_SWITCH?!this.editPropertiesUI.getComponentMode():e!==u.ACTION_RESET||this.editPropertiesUI.resizeActionActive()},switchEdition:function(){this.editPropertiesUI._switchEdition()},getButtons:function(){return this.editPropertiesUI.getButtons()},_getUI:function(){return this.editPropertiesUI},onLoad:function(){this.clearAllDatas()},updateFacet:function(){let e=this.getModel();e&&e.get("indexModeParameter")||this.onRefresh()},onRefresh:function(){this.loadModels(this.getModel(),{parameters:!0===this.parametersLoaded})},_cancelListRequest:function(){this.getListHandle&&this.getListHandle.handle&&(this.getListHandle.handle.cancel(),this.getListHandle.handle=null)},_cancelCommitHandle:function(){this.commitHandle&&this.commitHandle.handle&&(this.commitHandle.handle.cancel(),this.commitHandle=null)},_cancelPreviewUrlHandle:function(){this.previewUrlHandle&&this.previewUrlHandle.handle&&(this.previewUrlHandle.handle.cancel(),this.previewUrlHandle=null)},destroyComponent:function(){this._cancelCommitHandle(),this._cancelListRequest(),this._cancelPreviewUrlHandle(),this.clearAllDatas(),this._commandProxy&&this._commandProxy.destroy()},clearAllDatas:function(){var e=this.getModel();e&&e.destroy(),this.setModel(null)},_loadPLMParameters:function(){this.loadModels(this.getModel(),{parameters:!0,attributes:!1})},loadModels:function(t,i){window.top.performance.mark("start_PrepareAjax");var s=this;this.showLoader();var a=t;if(t){var o=h.getServiceForModel(t);if(!0===t.isTransientModel()||o&&!0===o.modelNeeded)this.setModel(a),this.editPropertiesUI.switchComponentMode(!0),this.trackPropInitUXEvent(t,this.getTabId()),this.editPropertiesUI.initData([this.getModel()]),this.hideLoader();else{var d=null;t instanceof e?(s.getModel(a.get("objectId"))||a.clearChangedValue(),d=a.getChangedValues()):a=new r(t),s.getModel(a.get("objectId"))||(s.setModel(a),a.clearChangedValue()),a.keys().forEach(function(e){var t=a.get(e);t instanceof l||"object"!=typeof t||"EditProp_listOfChange"===e||"label"===e||e.startsWith(u.MODEL_FACET_INFO_PREFIX)||e.startsWith(u.MODEL_DS_ATTR)||a.set(e,new l(t))}),s._resetModifFlag(a);var m=a.get("EditProp_listOfChange");if(m&&(a.setChangedValues(m),a.unset("EditProp_listOfChange")),d&&a.setChangedValues(d),window.top.performance.mark("end_PrepareAjax"),i&&!1===i.loadModel)this.setModel(a),this.trackPropInitUXEvent(this.getModel(),this.getTabId()),this.editPropertiesUI.initData([this.getModel()],{properties:!0});else{window.top.performance.mark("start_EP_AJAXRequest");var g=!1;window.top.performance.mark("start_EP_GetFromDistant"),p.getAsyncRead(function(e){!1===g&&(e?(window.top.performance.mark("end_EP_GetFromDistant"),g=!0,s._cancelListRequest(),s._onCompleteLoadModel(e)):function(){s._cancelListRequest();var e=n.getCancelObject();s.getListHandle.handle=e;var t=i&&!0===i.parameters,r=i&&!1!==i.attributes,o={handleRequest:{handle:e},modelList:[a],tenant:a.getTenant(),onComplete:function(i){s.hideLoader(),!1!==g||e.isCancelled()||(g=!0,console.log("Ajax 2"),!0===window.top.isDebug&&console.log("Ajax 2 answered "+window.top.performance.now()),s.getListHandle.handle=null,s._onCompleteLoadModel(i,{initTable:!t,buildBehavior:r?u.FORCE_DEFAULT:u.NO_CHANGES}))}};o.plmParams=t,o.attributes=r,o.readonly=s.isUIReadonly(),o.navigateToMain=s.getTabId()===u.FACET_PROPERTIES,o.ignoreKernelAccessChecks=!!s.options.ignoreKernelAccessChecks,c.getListOfAttributes(o)}())})}}}else this.editPropertiesUI.clear(),this._onCompleteLoadModel({results:[]})},hide:function(){this._parent(),this.editPropertiesUI.clear()},_commitModels:function(e){var t=this;t.commitHandle.handle=null;let n=function(i){t.showLoader(),c.commitModels({handleRequest:t.commitHandle,serverName:t.options.serverName,serverUri:t.options.serverUri,modelList:e,tenant:e[0].getTenant(),securityContext:i.SecurityContext,onComplete:function(e){t.hideLoader(),t.commitHandle.handle=null,t._onCompleteCommit(e)}})};i.getInstance({tenant:e[0].getTenant()}).getValidSecurityContext({context:this.options.context,onSuccess:function(e){n(e)},onFailure:function(e){t._setError(e,"error")}})},_manageNotificationFromAnswer:function(e,t){var i=t,n="error",s="undefined";if(e)if(e.hasOwnProperty("error"))i=e.error;else if(e.hasOwnProperty("notification")){i=(a=e.notification).message,n=a.type?a.type:n,(s=a.code?a.code:"LCERR400100")&&(i={type:"MainStaticError",message:a.message})}else if(e.hasOwnProperty("errors")&&e.errors.length>0){var a;i=(a=e.errors[e.errors.length-1]).message,n=a.type?a.type:n}else!1===e.success&&(i={message:v.get("Server error"),code:"ERROR"});if(i)if(void 0!==e&&void 0!==e.errors&&null!=e.errors&&2==e.errors.length&&void 0!==e.errors[0].code&&"1900068"===e.errors[0].code&&void 0!==e.errors[1]&&"1500188"!=e.errors[1].code){var r={level:"error",title:UWA.i18n("UpdateObjectfailed"),subtitle:UWA.i18n("UpdateObjectfailedSubtitle"),message:""};g.showMessageOnUI(r.level,r.title,r.subtitle,r.message,!1)}else s&&0==s.localeCompare("LCERR400100")?this._setMainError(i.message,i.type.toLowerCase(),i.customClass):this._setError(i,n.toLowerCase(),i.customClass);return{message:i,type:n.toLowerCase()}},_setError:function(e,t,i){t=t||"error",this._raiseNotification(e,t,i)},_setMainError:function(e,t,i){t=t||"mainstaticerror",this._raiseNotification(e,t,i)},_onCompleteCommit:function(e){var i=this,s="",a=!0,r=!1,o=!1,c=!1,d=null,u=null,h=e.transactionid;h&&(null!==(d=i.getModel(h))&&d.isMergedModel()?(d.resetAllErrors(),d.lockModel(!0),u=d.getMergingModels()):console.log(" --- >> The model retrieved from the update is not the same than the one which has been sent"));var p=e.results,_=!1,E=[],C={created:[],deleted:[],modified:[],ownerChanged:[]};if(e.modifiedObjectsBL&&e.modifiedObjectsBL.forEach(e=>{"Update"===e.action&&C.modified.push({physicalid:e.pid,operation:"update"})}),!1===e.success)i.editPropertiesUI.setError(e.error);else if(e.UXMessage){var S="";e.UXMessage.forEach(e=>{e&&(""!=S&&(S+="<br>"),S+=e)}),g.showMessageOnUI("error",UWA.i18n("UpdateObjectfailed"),UWA.i18n("contactYourAdmin"),S,!1)}else{if(p.forEach(function(e,t){var i=e.status;i<200||i>=300||e.body.oldInstancePhysicalid&&!1===c&&(c=!0)}),p.forEach(function(e,n){var d=!0,h=e.status,p=null;if(h<200||h>=300)p={message:v.get("Error during update"),code:"ERROR",customClass:"errorUpdate"};else{_=!0;var g=null,f=null,S=null,y=null;e.body.physicalid&&(f="object"==typeof e.body.physicalid?e.body.physicalid.value:e.body.physicalid,S=e.body.oldInstancePhysicalid,g=i.getModel(f),null!==u&&null===g&&(g=u[f]));var A=null;if(e.hasOwnProperty("RefreshUI")&&(A=e.RefreshUI.results.attributes),y=!1===c?null==A||null!=A&&0==A.length?{physicalid:f,operation:"update"}:{physicalid:f,operation:"update",attributes:e.RefreshUI.results.attributes}:null==A||null!=A&&0==A.length?{physicalid:f,oldInstancePhysicalid:S,operation:"update"}:{physicalid:f,oldInstancePhysicalid:S,operation:"update",attributes:e.RefreshUI.results.attributes},!1===c)if(null==g){if(null!=e.body.attrID&&null!=e.body.name&&null!=e.body.value){d=!1;var I=i.getModel();if(I)if(R=I.getAttributeFromField("attributeID",e.body.attrID.value,1)){var b=new l(t.clone(R));b.set("value",e.body.value.value),I.set(R.getIdentifier(),b),i._resetModifFlag(I,[R.getIdentifier()]),e.body.physicalid&&e.body.physicalid.value&&C.modified.push({physicalid:e.body.physicalid.value,operation:"update"})}}}else{g.resetAllErrors(),e.body&&e.body.errors&&e.body.errors.length>0?a=!1:(s=v.get("Modification successful"),a=i.options.extraNotif);e.body;var P=g.values(),T=[],D=[],M=!1;for(var w in e.body){var O=e.body[w],F=i._manageNotificationFromAnswer(O),x=O?"object"==typeof O?O.value:O:null,W=O?"object"==typeof O?O.valueDB:x:null;let n=O&&"object"==typeof O?O.dimensionType:null,s=O&&"object"==typeof O?O.unitName:null,a=null;null!=n&&null!=s&&(a=m.getDimensionUnitNLSName(n,s));var N=g.get(w);if(null==N&&null!=P&&(P=g.values()).every(function(e){var t=!0;return e instanceof l&&null!=e.get("select")&&e.get("select")===w&&(N=e,w=e.getIdentifier(),t=!1),t}),N){var R,U=!!N&&!0===N.get("multivalue");(R=t.clone(N)).setError(F.message,F.type,!0);var L="current"!=w&&"owner"!=w,k=null!==x&&("error"!==F.type||!F.message);if(k){if(L){var V=x;if(Array.isArray(x)&&(V=x.length>0?x[0]:""),"#DENIED!"===V){r=!0,M=!0;break}"description"==w&&(x=V),null==W&&(W=x);var j=x,B=W;if(U){var q=null!=x;j=Array.isArray(x)?x:q?[x]:[],B=Array.isArray(W)?W:q?[W]:[]}else{q=null!=x;j=Array.isArray(x)?x.length>0?x[0]:"":x||"",B=Array.isArray(W)?W.length>0?W[0]:"":W||""}if(R.set("value",j),R.set("valueDB",B),void 0!==R.get("dimension")&&null!==R.get("dimension")&&null!==a&&R.get("dimension")!==a&&null!==n&&null!==s){R.set("unitName",s),R.set("dimension",a);let e={valueDB:B,dimension:a};i.updateValueStoredInTweakerMemory(w,e)}}D.push(w)}g.attributeHasChanged(w)&&!k||T.push(w),R instanceof l||(R=new l(R)),g.set(w,R)}}i._resetModifFlag(g,T),g.saveInitialValues(D)}else o=!0,null==S&&(S=f),null==g&&null==(g=i.getModel(S))&&null!==u&&(g=u[S]),null!=g&&g.clearChangedValue(),E.push([f]);!M&&e.body&&e.body.errors&&e.body.errors.forEach(function(e){M=M||"unaccessible"===e.code}),d&&y&&(M?C.deleted.push(y):e.body&&e.body.owner?C.ownerChanged.push(y):C.modified.push(y))}i._manageNotificationFromAnswer(e.body,p)}),!0===c){var y=n.getWidgetPreference("changeControl"),A=null;null!=y&&""!==y.value&&y.value&&(A=y.value),require(["DS/WidgetServices/commandProxy/CommandProxy"],function(e){e.publishSelect({data:{paths:E,pathsInst:!0,defaultFacetName:"instance",changeControl:A}})})}!0===_&&require(["DS/PADUtils/PADCommandProxy"],function(e){var t=[],i=[],n=[];C.modified.forEach(function(e){t.push(e.physicalid);var i=null,s=null;if(!0===c){i=e.physicalid,null==(s=e.oldInstancePhysicalid)&&(s=e.physicalid);var a=null;null!=i&&null!=s&&null!==(a={modified:i,previous:s})&&n.push(a)}}),C.ownerChanged.forEach(function(e){t.push({physicalid:e.physicalid,key:"ownerChanged"})}),C.deleted.forEach(function(e){i.push(e.physicalid)});var s={modified:t};i.length>0&&(s.deleted=i);var a=null;a=n.length>0?{authored:n}:{authored:s};var r=e.create();r.authored({authored:!0}),r.refresh(a),r.destroy()})}if(d&&setTimeout(function(){d.lockModel(!1)}),!0===o){S=v.get("instanceEvolved");i.editPropertiesUI.addInfo(S)}a&&""!=s&&i.editPropertiesUI.showNotification(s),!0===r&&this.onRefresh();var I={numberObjects:p.length,actionStatus:!0===_?f.success:f.failure};i.lastTrackerEvent=f.createValidationEventFromEvent(I,i.lastTrackerEvent),f.checkAndTrackPageEvent(i.lastTrackerEvent)},_buildFromResponse:function(e,t,i){var n=this,s={modifyAccess:!0,oneSuccess:!1,allAttributeAreRO:!0,plmparams:null};if(!1!==e.success){for(var a=e.transactionid,l=e.results,d=l?l.length:0,u=0;u<d;u++){var h=l[u];n._manageNotificationFromAnswer(h);var p=null;p=null!=a?a:n._getID(h);var g=n.getModel(p),f=n._getMetaType(h),v=null,_=!1;if(g&&g.isMergedModel()){v={};var E=h.ids,C=g.getMergingModels();E.forEach(function(e){var t=C[e];if(null==t){_=!0;var i=UWA.clone(g.getOptions());i.objectId=e,i.metatype=f,t=new r(i)}v[e]=t})}if(_||null==g){if(!_){var S=n.getOccurrence();if(null===S)return console.log(" --- >> No current occurence"),{};if(null!==S.getModel(this.getTabId()))return console.log(" --- >> A model already exist for properties tab"),{};if(!g&&a)return console.log(" --- >> A merged model is returned for a single model"),{}}var y=n.getOccurrence().getAllModels(!0,!0);t={metatype:f,objectId:p};y&&y.length>0&&((t=UWA.clone(y[0].getOptions())).objectId=p,t.metatype=f),null!=v?(g=new o(t)).setMergingModels(v):g=new r(t),g.clearChangedValue()}if(f&&g.set("metatype",f),n.setModel(g),h.extensions)for(var A in h.extensions)i[A]=h.extensions[A];var I=m.getPreviewUrl(h);n._cancelPreviewUrlHandle(),I||c.getPreviewUrl({handleRequest:n.commitHandle,modelList:[g],tenant:g.getTenant(),onComplete:function(e){n.previewUrlHandle.handle=null,e.forEach(function(e){var t=n.getModel(e.id);null!=t&&e.preview&&(e.preview.indexOf("icons")<0||!t.get("type_icon_url"))&&t.set("previewUrl",e.preview)})}});var b=m.fillFromServer(h,g,t);s.modifyAccess=!1!==b.modifyAccess&&s.modifyAccess,s.oneSuccess=s.oneSuccess||b.success,s.allAttributeAreRO=s.allAttributeAreRO&&b.allAttributeAreRO,s.plmparams=!1!==s.plmparams&&b.plmparams}n.editPropertiesUI._ManageValidButton()}return s},_onCompleteLoadModel:function(e,t){this.hideLoader(),window.top.performance.mark("end_EP_AJAXRequest"),window.top.performance.mark("start_EP_DataTreatement"),t||(t={initTable:!0,buildBehavior:u.FORCE_DEFAULT});var i=e.options;i&&(void 0!==i.showSections&&this.editPropertiesUI.setOption("showSections",!0===i.showSections),void 0!==i.autoExpand&&this.editPropertiesUI.setOption("sectionAutoexpand",!0===i.autoExpand));var n={};this._manageNotificationFromAnswer(e);var s=this._buildFromResponse(e,t,n),a=s.modifyAccess&&!s.allAttributeAreRO&&(!this.isReadOnly()||"false"===this.isReadOnly());!0!==a&&!0!==t.initTable||(this.editPropertiesUI.switchComponentMode(!a),this.updateReadWriteAccess(a)),window.top.performance.mark("end_EP_DataTreatement"),window.top.performance.mark("start_EP_DataDisplay");var r=this.getModel(),o=s.oneSuccess&&r?[r]:[];this.editPropertiesUI.setAccordionProperties(n),o&&o.length>0&&(o[0].facet="prop"),o&&o.length>0&&this.trackPropInitUXEvent(o[0],this.getTabId()),this.editPropertiesUI.initData(o,{edition:t.buildBehavior,properties:!0}),s.plmparams&&this.editPropertiesUI.addSection({section:_},!0)},_getID:function(e){return e.physicalID},_getMetaType:function(e){return e.metatype},_resetModifFlag:function(e,t){e.clearChangedValue(t),this.editPropertiesUI._ManageValidButton()},changeAttributes:function(e){this.editPropertiesUI.changeAttributes(e)},trackPropInitUXEvent:function(e,t){if(e&&e instanceof r){var i=e._innerModels?Object.keys(e._innerModels).length:1,n=null;e&&e._attributes&&e._attributes.source&&(n=e._attributes.source);var s=null;1==i&&e._attributes&&e._attributes._DS_ATTR_type&&e._attributes._DS_ATTR_type.valueDB&&(s=e._attributes._DS_ATTR_type.valueDB),1==i&&!s&&e&&e._attributes&&e._attributes.type&&e._attributes.type.valueDB&&(s=e._attributes.type.valueDB),1==i&&!s&&e&&e._attributes&&e._attributes["ds6w:type"]&&(e._attributes["ds6w:type"].value||e._attributes["ds6w:type"].valueDB)&&(s=e._attributes["ds6w:type"].value||e._attributes["ds6w:type"].valueDB);let r="Information Properties Facet";var a={UXName:"Properties",UXContext:r=t&&"instance"===t.toLowerCase()?"Information Instance Facet":"Information Properties Facet",numberObjects:i,typeObjects:s};n&&(a.source=n),this.lastTrackerEvent=f.createInitActionEvent(a),f.checkAndTrackPageEvent(this.lastTrackerEvent)}},_raiseAddExtensionEvent:function(e){let t=this,i={authored:{modified:[{physicalid:e.get("objectId"),key:"addExtension"}]}};require(["DS/WidgetServices/commandProxy/CommandProxy"],function(e){t._commandProxy=e.create({}),t._commandProxy.publishAddExtensionEvent(i)})},updateValueStoredInTweakerMemory:function(e,t){let i=this._getUI();if(i&&"function"==typeof i.getFormSection){let n=i.getFormSection();if(n&&"function"==typeof n.getOrganizers){let i=n.getOrganizers();if(i&&"object"==typeof i)for(let n in i){let s=i[n];if(s&&s._forms){let i=s._forms;if(i&&Array.isArray(i))for(let n=0;n<i.length;n++){let s=i[n];if(s&&s.fields&&Array.isArray(s.fields)){let i=s.fields;for(let n=0;n<i.length;n++){let s=i[n];if(s&&s._idAttr&&s._idAttr===e&&s._tweaker&&s._tweaker.data&&s._tweaker.data.value&&s._tweaker.data.value.valueDB&&s._tweaker.data.value.dimension)return s._tweaker.data.value.valueDB=t.valueDB,s._tweaker.data.value.dimension=t.dimension,void(s._tweaker._updateUIAfterCommitOfModels=!0)}}}}}}}}})}),define("DS/EditPropWidget/facets/Common/PropertiesDerived",["DS/EditPropWidget/facets/Properties/EditPropController","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropModelMerge","DS/EditPropWidget/constants/EditPropConstants","DS/WidgetServices/WidgetServices"],function(e,t,i,n,s,a,r){"use strict";return e.extend({metatype:a.METATYPE_UNKNOWN,setOccurrence:function(e){var t=this,i=e?e.getOptions(this.getTabId()):null,a=e?e.getModel(this.getTabId()):null;if(i&&!a){if("object"==typeof i){var r=i.targets;if(null!=r){var o=[],l={};if(r.forEach(function(e){var i=new n({objectId:e.id,metatype:t.metatype});o.push(i),l[e.id]=i}),e.isMergedOccurrence()){var c=e.getMergePrefixe();(a=new s({objectId:c,metatype:t.metatype})).setMergingModels(l)}else if(o.length>0){c=o[0].get("objectId");a=new n({objectId:c,metatype:t.metatype})}e.setModel(this.getTabId(),a)}}}(null==e||e.getModel(this.getTabId()))&&this._parent(e)}})}),define("DS/EditPropWidget/UI/IDCardSkeleton",["UWA/Class/Model","DS/EditPropWidget/models/CommonAbstract","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/ICard/IdCard","DS/EditPropWidget/facets/Properties/EditPropController","DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServices/WidgetServices","DS/EditPropWidget/comm/DistantAjax","DS/EditPropWidget/buttonsBar/ButtonsBar","DS/EditPropWidget/constants/ConstantsMapping","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/PlatformAPI/PlatformAPI","DS/WidgetServicesUI/tweakers/TweakerWUXButton","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","css!DS/EditPropWidget/EditPropWidget.css","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,m,g,f,v,_,E,C){"use strict";var S={"DS/EditPropWidget/facets/Properties/EditPropController":s};window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;var y={};y[i.ACTION_SWITCH]={name:i.ACTION_SWITCH,text:C.get("EditProp_boutonSwitchtoEdit"),icon:i.ACTION_SWITCH,id:"EDITPROP_PENCIL_EDIT_ICON"},y[i.ACTION_RESET]={name:i.ACTION_RESET,text:C.get("Reset display"),icon:i.ACTION_RESET},y[i.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM]={name:i.ACTION_SWYM_VIEW_CONTENT_IN_3DSWYM,text:C.get("ViewIn3DSwym"),icon:"level-down"},y[i.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM]={name:i.ACTION_SWYM_VIEW_COMMUNITY_IN_3DSWYM,text:C.get("ViewIn3DSwym"),icon:"level-down"},y[i.ACTION_SWYM_VIEW_USER_PROFILE]={name:i.ACTION_SWYM_VIEW_USER_PROFILE,text:C.get("ViewUserProfile"),icon:"level-down"},y[i.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM]={name:i.ACTION_SWYM_VIEW_SURVEY_IN_3DSWYM,text:C.get("ViewIn3DSwym"),icon:"level-down"},y[i.ACTION_SHARING_FILTER_VIEW]={name:i.ACTION_SHARING_FILTER_VIEW,text:C.get("filterMembers"),icon:"filter"},y[i.ACTION_SHARING_DELETE]={name:i.ACTION_SHARING_DELETE,text:C.get("deleteSharingMembers"),icon:"trash"},y[i.ACTION_SHARING_ADD]={name:i.ACTION_SHARING_ADD,text:C.get("addSharingMembers"),icon:"topbar-share"},y[i.ACTION_SHARING_LIST_VIEW]={name:i.ACTION_SHARING_LIST_VIEW,text:C.get("sharingListView"),icon:"alpha-sorting-a-z"},y[i.ACTION_SHARING_LARGE_TILE_VIEW]={name:i.ACTION_SHARING_LARGE_TILE_VIEW,text:C.get("sharingLargeTileView"),icon:"group"};i.FACET_NONE;return t.extend({_lFacets:[],_sharedContext:null,_sharedOptions:{},_RWAccess:!1,defaultOptions:{name:"",className:"",showIdCard:!0,showTopBar:!0,showFacets:!0,warningOnUnsaved:!0,closeButton:!0,noThumbnail:!1,facetLabel:!0,displayType:i.STANDARD},init:function(e,t){this._sharedOptions={},this.indexModeParameter=!!t.indexModeParameter,this.disableAddExtensionButton=!!t.disableAddExtensionButton,this._parent(t),this.options.actions&&this.options.actions.forEach(function(e){void 0===e.after&&"action_close_panel"===e.name&&(e.after=!0)}),this._sharedContext=t.sharedContext?t.sharedContext:null,this._lFacets=e,this.elements||(this.elements={}),this.loaderFacetList=[],this.idcardInit()},getTopBar:function(){return this.elements.manageButtonDiv},idcardInit:function(e){var t=this,s=this.elements.container=UWA.createElement("div",{name:this.options.name,class:this.options.className}),a="";!0===this.options.showTopBar&&(a="withMenuBar");this.elements.globalDiv=UWA.createElement("div",{class:"IDCardGlobalContain "+a}).inject(s);var r=t.elements.mainInterface=UWA.createElement("div",{class:"IDCardMainInterface"}).inject(this.elements.globalDiv),o=this.elements.masterTable=UWA.createElement("div",{class:"IDCardMasterTable "}).inject(r),c=this.elements.topTable=UWA.createElement("div",{class:"IDCardTopTableContainer"});if(this.elements.bottomMainArea=UWA.createElement("div",{class:"IDCardBottomArea"}),this.elements.bottomInnerArea=UWA.createElement("div",{class:"IDCardInnerBottomArea"}),this.elements.bottomInnerArea.inject(this.elements.bottomMainArea),this.elements.actionArea=UWA.createElement("div",{class:"actionArea"}),this.elements.bottomArea=UWA.createElement("div",{class:"facetContainer"}),this.elements.actionArea.inject(this.elements.bottomInnerArea),this.elements.bottomArea.inject(this.elements.bottomInnerArea),this.elements.tabContainer=UWA.createElement("div",{class:"tabMainContainer"}),c.inject(o),this.elements.tabContainer.inject(o),this.elements.bottomMainArea.inject(o),this.elements.buttonsBar=new l({vertical:!1,minimumSize:-1}),this.elements.buttonsBar.inject(this.elements.actionArea),delete this.elements.postIdCard,!0===this.options.showIdCard){var d={};this.options.idCardOptions&&(d=this.options.idCardOptions),d.actions=[],this.elements.postIdCard=new n(d),t.identityCardContainer=UWA.createElement("div",{class:"topTableElement identityCardCell infra"}).inject(c);var u=UWA.createElement("div",{class:"ICTableContainer ",events:{click:function(){let e={currentFacet:t.currentFacetName};f.publish(`PropHeaderActivated:${widget.id}`,e)}}}).inject(this.identityCardContainer);this.elements.postIdCard.inject(u),this.currentFacetName=null,this.defaultFacetName=null,this.infoForFacet=null,this._createTabs([]),this.elements.superModal=new h({renderTo:this.container})}this.elements.manageButtonDiv=UWA.createElement("div",{class:"skeleton_ManageButtonDiv"}).inject(o),this.elements.loadingArea=new p({visible:!1}),this.elements.loadingArea.inject(this.elements.manageButtonDiv);var m={className:"TopButtonValid",emphasize:"primary",setAttribute:{name:"TopButtonValid"},clickCallback:function(){t._saveAllFacets()}};if(!0===t.options.updateSession)m.label=C.get("EP_OK"),this.elements.boutonValid=v(m);else{m.label=C.get("EP_Ok"),this.elements.boutonValid=v(m)}this.elements.boutonValid.hide(),this.elements.boutonValid.inject(this.elements.manageButtonDiv),this.elements.facetButtonDiv=UWA.createElement("div",{class:"skeleton_FacetButtonDiv",html:{}}).inject(this.elements.manageButtonDiv);if(t.disableAddExtensionButton||require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],function(e){var i={className:"TopButtonAdd",label:C.get("EP_Add"),setAttribute:{name:"TopButtonAdd"},clickCallback:function(){t._loadExtensions()}};t.elements.boutonAdd=v(i),!1===t.editMode&&t.elements.boutonAdd.hide(),!0===t.options.updateSession&&t.elements.boutonAdd.hide(),t.elements.boutonAdd.inject(t.elements.manageButtonDiv)}),this.elements.facetButtonDiv=UWA.createElement("div",{class:"skeleton_FacetButtonDiv",html:{}}).inject(this.elements.manageButtonDiv),this.options.closeButton){var g={label:C.get("EP_Close"),className:"TopButtonClose",setAttribute:{name:"TopButtonClose"},clickCallback:function(){t.checkChangeAuthorized(function(){t.dispatchEvent("onCancel"),t.options.displayType===i.TRANSIENT?require(["DS/TransientWidget/TransientWidget"],function(e){e.closeWidget()}):t.dispatchEvent("onInnerCancel")})}};this.elements.boutonCancel=v(g),this.elements.boutonCancel.inject(this.elements.manageButtonDiv)}},_switchFacet:function(e){f.publish(`${e}:${widget.id}`,e);var t=e!==this.currentFacetName;if(this.currentFacetName=e,t&&this._manageFacetLaunching(),t&&this.lastTrackerEvent){var i={actionName:"Activate Tab",pd16:e};this.lastTrackerEvent=_.createActionEventFromEvent(i,this.lastTrackerEvent),_.checkAndTrackPageEvent(this.lastTrackerEvent)}this._switchAdd(!0)},_createTabs:function(e){var t=this;!0===this.options.showFacets&&(this.elements.tabs&&this.elements.tabs.getTabCount()>0&&(this.elements.tabs.destroy(),this.elements.tabs=null),this.elements.tabs||(this.elements.tabs=new m({displayStyle:"strip",centeredFlag:!0,showComboBoxFlag:!0,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1}),this.elements.tabs.touchMode=r.isTouchDevice(),this.elements.tabs.onSelectTab(function(e){if(void 0!==e&&void 0!==e.index&&e.index>=0){var i=t.elements.tabs.getValueByIndex(e.index);t._switchFacet(i)}}),this.elements.tabs.inject(this.elements.tabContainer)),(e=e||this._lFacets).forEach(function(e){var i=t.elements.tabs.add({label:!0===t.options.facetLabel?e.facet.text:void 0,value:e.facet.name,allowClosableFlag:!1,icon:{iconName:e.facet.icon,fontIconFamily:1}});i.getModel().tooltipInfos=new g({shortHelp:e.facet.text,mouseRelativePosition:!1}),i.getContent().setAttribute("tab_name",e.facet.name)}),e.length>1?this.elements.tabs.show():this.elements.tabs.hide())},_saveAllFacets:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&!1!==t._isVisible&&i.onSave()})},_loadExtensions:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&!1!==t._isVisible&&i.getTabId()==e.currentFacetName&&i.getExtensions()})},checkChangeAuthorized:function(e,t){var i=this;if(!0===this.options.warningOnUnsaved&&this._checkSaveForAllFacets()){this.elements.superModal.confirm(C.get("EP_checkValidClose"),C.get("EP_Confirmation"),function(n){!0!==n&&!0!==t||e.call(i,n)})}else e.call(this,!0)},_checkSaveForAllFacets:function(){var e=this,t=!1;return this._lFacets.every(function(i){var n=e._getFacetContent(i);return n&&!1!==i._isVisible&&(t=!n.nothingToSave()),!t}),t},getSharedContext:function(){return this._sharedContext},setSharedContext:function(e){this._sharedContext=e,this.onRefresh()},getContainer:function(){return this.elements.container},getMainTable:function(){return this.elements.bottomArea},getIdentityCardUI:function(){return this.elements.topTable},getCollapseICPreferenceName:function(){return i.COLLAPSE_IC_PREFERENCE.name},destroyComponent:function(){var e=this;this._lFacets.forEach(function(t){var i=e._getFacetContent(t);i&&i.destroyComponent()}),this.elements.tabs.destroy()},getOptimalSize:function(){var e=this._getCurrentFacetContent(),t=this._getSizeTopTable(),i={width:0,height:0};return e&&((i=e.getOptimalSize()).height+=t.height),i},_getSizeTopTable:function(){var e=this.elements.topTable.getSize();return"none"===this.elements.topTable.getStyle("display")&&(e={height:0,width:0}),e},_getThumbnailDiv:function(){return this.thumbnail||(this.thumbnail=this.elements.container.getElement(".thumbnail-section")),this.thumbnail},_refreshCurrentFacet:function(){var e=this._getCurrentSelectedFacet(),t=this._getFacetContent(e);t&&t.onRefresh()},onRefresh:function(){var e=this,t=this._getCurrentSelectedFacet();this._refreshCurrentFacet(),this._lFacets.forEach(function(i){(!0===i.alwaysCalled&&!1!==i._isVisible||!0===i.calledIfVisible&&!0===i._isVisible)&&e._getFacetName(i)!==e._getFacetName(t)&&e._loadFacet(i,!1,function(){var t=e._getFacetContent(i);t&&t.onRefresh()})})},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize(),t=!0!==this.options.noThumbnail&&e.height>=300;this.elements.postIdCard&&this.elements.postIdCard.showThumbnail("height",t)},onResize:function(e){var t=this._getCurrentFacetContent();t&&t.onResize(),this._manageThumbnailDisplay(),this.elements.postIdCard&&this.elements.postIdCard.onResize(),this.elements.buttonsBar.onResize()},_getFacetFromName:function(e){var t=null;return this._lFacets.every(function(i){return i.facet&&i.facet.name===e&&(t=i),!t}),t},getFacetContent:function(e){var t=this._getFacetFromName(e);return t?this._getFacetContent(t):null},_getFacetContent:function(e){return e&&e.content&&"object"==typeof e.content?e.content:null},_getCurrentFacetContent:function(){var e=this._getCurrentSelectedFacet();return e?this._getFacetContent(e):null},_getCurrentSelectedFacet:function(){var e=null,t=null;if(this.currentFacetName&&this.options.showFacets)(e=this.currentFacetName)&&this._lFacets.every(function(i){return i.facet&&i.facet.name===e&&(t=i),!t});else{var n=null;if(this._lFacets.length>0&&(n=this._lFacets[0],this.indexModeParameter&&this._lFacets.every(function(e){return!e.facet||!e.facet.name||e.facet.name!==i.FACET_iPROPERTIES||(n=e,!1)}),this._lFacets.every(function(e){var t=e.alwaysVisible;return t&&(n=e),!t})),widget.getValue("X3DContentId")&&""!==widget.getValue("X3DContentId")){var s=JSON.parse(widget.getValue("X3DContentId"));if(s&&s.data&&Array.isArray(s.data.items)&&s.data.items.length>0){var a=s.data.items[0];if(a.facet&&"isSocial"===a.facet&&this._lFacets.length>0){n=this._lFacets[0];for(var r=0;r<this._lFacets.length;r++)this._lFacets[r].facet.name==i.FACET_SWYMCOMMENTS&&(n=this._lFacets[r])}}}t=n}return t},_updateFacets:function(){var e=this._getCurrentFacetContent();e&&e.display()},_hideAllFacetsContent:function(e){var t=this,i=e?this._getFacetName(e):null;this._lFacets.forEach(function(e){var n=t._getFacetContent(e);n&&t._getFacetName(e)!==i&&n.hide()})},_manageFacetLaunching:function(e){var t=++window.top.perfoIncrem;window.top.performance.mark("start_launchFacets:"+t);var i=this,n=this._getCurrentSelectedFacet(),s=this.getSharedContext();!0!==e&&this._launchFacet(),window.top.performance.mark("start_Iterate:"+t);var a=i._getFacetName(n);this.currentFacetName=a,this._lFacets.forEach(function(e){if((!0===e.alwaysCalled&&!1!==e._isVisible&&void 0!==e._isVisible||!0===e.calledIfVisible&&!0===e._isVisible)&&i._getFacetName(e)!==a){var t=++window.top.perfoIncrem;window.top.performance.mark("start_loadFacet:"+t),i._loadFacet(e,!1,function(){window.top.performance.mark("end_loadFacet:"+t);var n=i._getFacetContent(e);n&&n.setContext(s);var a=i._getCurrentSelectedFacet();i._getFacetName(a)===i._getFacetName(e)&&i.__launchFacet(a)})}}),window.top.performance.mark("end_Iterate:"+t),window.top.performance.mark("end_launchFacets:"+t)},_launchFacet:function(){var e=this,t=this._getCurrentSelectedFacet();return this._hideAllFacetsContent(t),this._loadFacet(t,!0,function(){e.__launchFacet(t)}),t},_loadFacet:function(e,t,i){var n=this;if(e&&"loading"!==e.content)if(e.content)i.call(n);else{e.content="loading";var s=++window.top.perfoIncrem;window.top.performance.mark("start_prereqFacet:"+s),function(e,t){var i=[],n=[];e.forEach(function(e){var t=S[e];t?n.push(t):i.push(e)}),i.length>0?require(i,function(){for(var s=0;s<arguments.length;s++)e[i[s]]=arguments[s],n.push(arguments[s]);t.apply(null,n)}):t.apply(null,n)}([e.require],function(a){window.top.performance.mark("end_prereqFacet:"+s),e.content=null;var o=n._getCurrentSelectedFacet(),l=n._getFacetName(e)===n._getFacetName(o);if(!t||l){var c=e.options?e.options:{};if(Object.keys(c).length>0){var d=n.infoForFacet;if(c.infoForFacet,null!=d&&(e.options.infoForFacet=d),void 0===c.tenant||null===c.tenant){var u=n._getTenant();null===u&&(u=r.getTenantID()),e.options.tenant=u}}var h=c.events?c.events:{};h.onNotification=function(e){n._addNotif(e)},h.onEvent=function(e){n._manageEvent(e)},c.events=h,e.options=c,e.options.tabId=e.facet.name,e.options.eventThread=n.options.eventThread+"."+e.facet.name,e.content=new a(e.options,n._sharedOptions);var p=e.content.getUI(),m="function"==typeof p.addClassName?p:p.container?p.container:p.elements?p.elements.container:null;m&&m.addClassName("EP_tab_Container EP_tab_"+e.facet.name),e.content.getUI().inject(n.elements.bottomArea),l||e.content.hide(),n.publishEvt("facetLoaded",e),i.call(n)}})}},_supportExtension:function(){let e=!0,t=!1,n=null;if("function"==typeof this.getOccurrences&&(n=this.getOccurrences()),n&&n.length>0){let t=n[0].getModel(i.MODEL_INIT);if(t){let i=c.getServiceForModel(t);i&&(e=!1!==i.extensionsSupported)}}let s=c.getMapping();return s&&s[this.currentFacetName]&&c.getMapping()[this.currentFacetName].supportExtension&&(t=!0),e&&t},_switchSave:function(e){e?(this.elements.boutonValid.show(),this.elements.boutonAdd&&(this.elements.boutonAdd.disabled=!0)):(this.elements.boutonValid.hide(),this.elements.boutonAdd&&(this.elements.boutonAdd.disabled=!1))},_switchAdd:function(e){e&&!0!==this.options.updateSession&&this._supportExtension()?this.elements.boutonAdd&&this._sharedOptions.editMode&&this.elements.boutonAdd.show():this.elements.boutonAdd&&this.elements.boutonAdd.hide()},_manageActionVisibility:function(){var e=this,t=this._getCurrentSelectedFacet(),i=t?t.actions:null,n=[];i&&i.forEach(function(i){var s=i,a=i;"object"==typeof i?s=i.name:a={};var r=!0,o=e._getFacetContent(t);if(o&&(r="pencil"!==s?o.isActionAvailable(s):"pencil"===s&&!0===e._RWAccess&&o.isActionAvailable(s)),r){var l=y[s];for(var c in l)a[c]||(a[c]=l[c]);a.handler=function(){e._getCurrentFacetContent().onAction(s)},n.push(a)}});i=this.options.actions;this.elements.postIdCard&&i&&i.length>0&&this.elements.postIdCard.setActions(i),this.elements.buttonsBar.setButtons(n),n.length>0?this.elements.buttonsBar.show():this.elements.buttonsBar.hide()},_manageEvent:function(e){var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);if("switchSave"===e.eventID){var n=e.value;!0!==n&&(n=this._checkSaveForAllFacets()),this._switchSave(n)}else if("switchAdd"===e.eventID){var s=e.value;this._switchAdd(s)}else if("switchLoader"===e.eventID){var a=e.value,r=this.loaderFacetList.indexOf(e.facet);!0===a&&r<0?this.loaderFacetList.push(e.facet):!1===a&&r>=0&&this.loaderFacetList.splice(r,1),this.loaderFacetList.length>0?this._displayLoadingArea():this._hideLoadingArea()}else e.facet===i&&"updateActions"===e.eventID?this._manageActionVisibility():"updateRWA"===e.eventID&&(this._updateRWA(e.value),this._manageActionVisibility())},_updateRWA:function(e){this._RWAccess=e},_hideLoadingArea:function(){this.elements.loadingArea.hide()},_displayLoadingArea:function(){this.elements.loadingArea.show()},__launchFacet:function(e){var t=++window.top.perfoIncrem,i=this._getFacetContent(e);if(i){!0===this.options.showTopBar?this.elements.globalDiv.addClassName("withMenuBar"):this.elements.globalDiv.removeClassName("withMenuBar");var n=i.getButtons();this.elements.facetButtonDiv.empty(),n&&n.inject(this.elements.facetButtonDiv),window.top.performance.mark("start_displayFacets:"+t),i.display(this.getSharedContext()),window.top.performance.mark("end_displayFacets:"+t),this._manageActionVisibility()}},_getFacetName:function(e){return e&&e.facet?e.facet.name:""},_updateThumbnail:function(e,t){this.elements.postIdCard&&this.elements.postIdCard.changeThumbnail(e,t)},clearIdentityCard:function(){this.elements.postIdCard&&this.elements.postIdCard.clearValues()},getIdentityCard:function(){return this.elements.postIdCard},selectFacet:function(e){var t=this._getFacetFromName(e);if(this.elements.tabs&&t&&!1!==t._isVisible){var i=this.elements.tabs.getButtonFromValue(e);i&&(i.setProperties({checkFlag:!0}),this._switchFacet(e))}},clearPanel:function(){this._hideAllFacetsContent()},hideMainComponent:function(){this.elements.mainInterface.hide()},showMainComponent:function(){this.elements.mainInterface.show()},_manageFacetVisibility:function(){var e=this;this._hideAllFacets();var t=++window.top.perfoIncrem;window.top.performance.mark("start_facetVisibility:"+t);var i=new a(["B","C"],function(){var i=this.getAnswer("B"),n=this.getAnswer("C"),s=e._facetCheck(this);if(!0===s.success){var a=e._getCurrentSelectedFacet();this.currentFacetName=e._getFacetName(a);var r=!0,o=null,l=!1;e._lFacets.forEach(function(t){var c=t.facet.name,d=a&&e._getFacetName(a)===c,u=t._isVisible||!0===t.alwaysVisible;u&&t.services&&t.services.forEach(function(e){i[e]||(u=!1)}),u&&t.roles&&(u=!1,t.roles.forEach(function(e){n.indexOf(e)>=0&&(u=!0)})),!o&&u&&(o=c),u&&d&&(r=!1),t._isVisible=u,!0===e.indexModeParameter?"properties"===c?t._isVisible=!1:"iproperties"===c&&(t._isVisible=!0):"iproperties"===c&&(t._isVisible=!1),!0===s.refreshCurrent&&d&&!r&&(l=!0)}),e._facetVisibilityUpdate(),r&&e.selectFacet(o),!l&&s.refreshAction&&e._manageActionVisibility(),window.top.performance.mark("end_facetVisibility:"+t),e._manageFacetLaunching(!l)}});if(!0===e._queryFacets(i)){var n=e._getTenant();window.top.performance.mark("start_visibilityUrl"),o.getServices(n,function(e){window.top.performance.mark("end_visibilityUrl"),i.setAnswer("B",e)}),window.top.performance.mark("start_visibilityRole"),o.getRoles(n,function(e){window.top.performance.mark("end_visibilityRole"),i.setAnswer("C",e)})}},_getTenant:function(){return r.getTenantID()},_queryFacets:function(e){return!0},_facetCheck:function(e){return this._lFacets.forEach(function(e){e._isVisible=!0}),{success:!0}},_getPriorityFacetName:function(){var e=null;null===e&&(null!=(t=this.defaultFacetName)&&""!==t&&(e=t));if(null===e&&this.currentFacetName&&this.options.showFacets&&(e=this.currentFacetName),null===e){if(null!==this.options)var t=this.options.defaultFacetName;null!=t&&""!==t&&(e=t)}if(null===e&&widget.getValue("X3DContentId")&&""!==widget.getValue("X3DContentId")){var n=JSON.parse(widget.getValue("X3DContentId"));if(n&&n.data&&Array.isArray(n.data.items)&&n.data.items.length>0){var s=n.data.items[0];s.facet&&"isSocial"===s.facet&&(e=i.FACET_SWYMCOMMENTS)}}return null===e&&(e="properties"),e},_facetVisibilityUpdate:function(){var e=this;if(this.elements.tabs){var t=this._getPriorityFacetName(),i=e._getFacetFromName(t),n=this._getCurrentSelectedFacet();i!==n&&(n=i);var s=null,a=!1,r=[];this._lFacets.forEach(function(t){!1!==t._isVisible&&!1!==t.visible&&(!0===e.options.updateSession?"properties"===t.facet.name&&r.push(t):r.push(t),n===t&&(null===s&&(s=t),a=!0))}),null===s&&this._lFacets.forEach(function(e){!1!==e._isVisible&&!1!==e.visible&&null===s&&(s=e)}),this._createTabs(r),a&&n.content&&n.content.display?(this.selectFacet(n.facet.name),n.content.display(this.getSharedContext())):s&&this.selectFacet(s.facet.name)}},removeFacets:function(e){var t=[],i=this._getCurrentSelectedFacet(),n=!1;this._lFacets.forEach(function(s){e.indexOf(s.facet.name)<0?t.push(s):i&&i.facet.name===s.facet.name&&(n=!0)}),this._lFacets=t,this._facetVisibilityUpdate(),n&&this._manageFacetLaunching()},getOrAddFacets:function(e){var t=this,i=[];e.forEach(function(e){t._getFacetFromName(e.facet.name)||i.push(e)}),this.addFacets(i)},addFacets:function(e){if(e&&(!Array.isArray(e)||0!==e.length)){var t=this,i=!0;if(e&&Array.isArray(e)){var n={};t._lFacets.forEach(function(e){e.facet&&(n[e.facet.name]=!0)}),e.forEach(function(e){e.facet&&!n[e.facet.name]&&(e._isVisible=!0===e.alwaysVisible,i=i&&e._isVisible,void 0!==e.position?t._lFacets.splice(Math.min(e.position,Object.keys(t._lFacets).length-1),0,e):t._lFacets.push(e))})}i?this._facetVisibilityUpdate():this._manageFacetVisibility()}},_hideAllFacets:function(){this._createTabs([])},_isFacetAuthorized:function(e){this._getCurrentModelType();var t=this._getFacetFromName(e);return t&&!1!==t._isVisible},changeAttributes:function(e){var t=this._getCurrentFacetContent();null!=t&&t.changeAttributes(e)},setIndexModeFlag:function(e){this.indexModeParameter=e},getIndexModeFlag:function(){return!0===this.indexModeParameter}})}),define("DS/EditPropWidget/facets/Properties/iPropertiesFacet",["UWA/Core","UWA/Class/Model","DS/EditPropWidget/facets/Properties/EditPropController","DS/EditPropWidget/facets/Properties/Properties","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/utils/AttributesUtils","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/constants/ConstantsMapping","DS/EditPropWidget/comm/DistantAjax","DS/WidgetServices/WidgetServices","DS/EditPropWidget/ajaxRequests/EditPropAjaxRequests","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/EditPropWidget/utils/EditPropIndexUtils","DS/UIKIT/Mask","DS/EditPropWidget/utils/EditPropIndexDictionaryForUnits","DS/EditPropWidget/ajaxRequests/ServicesAjaxRequests","text!DS/EditPropWidget/assets/settings/SettingsForServices.json","i18n!DS/EditPropWidget/assets/nls/langEditProp"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,m,g,f,v,_){"use strict";return v=JSON.parse(v),i.extend({getListHandle:null,init:function(){this._parent.apply(this,arguments),this.getListHandle={handle:null},this.elements.container||(this.elements.container=e.createElement("div",{class:"RPL30",styles:{height:"100%"}})),this.listOfExtensions=[],this.listOfPredicates=[],this.maskAttributeDetails={},this.maskGroupInfo={},this.groupAttributesInfoAsPerMask={},this.answer=null,this.dimensionAttributes=new Map,g.setUpDimensionsDictionary()},updateFacet:function(){if(this.elements&&this.elements.container){var e=this.getModel();if(!e)return!1;if(!e.get("indexModeParameter"))return;var t=e.get("objectId");this.elements.container.setContent(""),this.iPropUX=new n({setCloseButton:!1,editMode:!1,readOnly:!0,scroller:!1,identifier:"EPIndex_"+t,events:{}}),this.elements.container.setContent(this.iPropUX),this.loadModels(e,{})}},loadModels:function(e,t){window.top.performance.mark("start_PrepareAjax");var i=this;this.showLoader();var n=e;if(e){var s=l.getServiceBySource("fedsearch");if(!0===e.isTransientModel()||s&&!0===s.modelNeeded)this.setModel(n),this.iPropUX.initData([this.getModel()]),this.hideLoader();else if(window.top.performance.mark("end_PrepareAjax"),t&&!1===t.loadModel)this.setModel(n),this.iPropUX.initData([this.getModel()]);else{window.top.performance.mark("start_EP_AJAXRequest");var a=!1;window.top.performance.mark("start_EP_GetFromDistant"),c.getAsyncRead(function(t){!1===a&&(t&&t.response&&t.options?(window.top.performance.mark("end_EP_GetFromDistant"),a=!0,i.answer=t.response,i._cancelListRequest(),t.options.maskAttributeDetails&&(i.maskAttributeDetails=t.options.maskAttributeDetails),t.options.predicates&&(i.listOfPredicates=t.options.predicates),t.options.groupAttributesInfoAsPerMask&&(i.groupAttributesInfoAsPerMask=t.options.groupAttributesInfoAsPerMask),t.options.listOfExtensions&&(i.listOfExtensions=t.options.listOfExtensions),t.options.maskGroupInfo&&(i.maskGroupInfo=t.options.maskGroupInfo),t.options.dimensionAttributes&&(i.dimensionAttributes=t.options.dimensionAttributes),i.calculateUIPosition(),i.getDimensionAttribute(i.answer,i.dimensionAttributes,function(e){i.answer=e,i.parseResponse(),i._onCompleteLoadModel(e)})):function(){if(i.launchPostRequest=function(){i._cancelListRequest();var e=d.getCancelObject();i.getListHandle.handle=e;var t={handleRequest:{handle:e},modelList:[n],tenant:n.getTenant(),onComplete:function(t){i.hideLoader(),!1!==a||e.isCancelled()||(a=!0,console.log("Ajax 2"),!0===window.top.isDebug&&console.log("Ajax 2 answered "+window.top.performance.now()),i.getListHandle.handle=null,t&&t.results&&t.results.length>0&&t.results[0]&&t.results[0].data&&Array.isArray(t.results[0].data)&&t.results[0].data.length>0?i.getDimensionAttribute(t,i.dimensionAttributes,function(e){i.answer=e,i.calculateUIPosition(),i.parseResponse(),i._onCompleteLoadModel(e)}):(i._setError(_.get("FedAjax_NotFound"),void 0,"rpl30_"+Date.now()),i.hideMainComponent()))}};t.defService=s,t.select_predicates=i.listOfPredicates;let r=n.get("source"),o=r&&v[r.toUpperCase()],l=!1;o&&(l=o.plmParameterSupported),t.getPLMParameter=l,t.dimensionAttributes=i.dimensionAttributes,u.getListOfAttributes(t)},i.launchPostRequestForInstance=function(){var t=l.getServiceBySource("3dspace");u.getInstanceDetails({modelList:[e],defService:t,onComplete:function(t){if(i.hideLoader(),t&&t.infos&&t.infos.status&&"OK"===t.infos.status)if(t.result&&t.result.length>0&&t.result[0]&&t.result[0].input_object&&"object"==typeof t.result[0].input_object){var n=t.result[0].input_object;i.calculateUIPosition(),i.parseInstanceWSResponse(n,e,function(e){e&&e.results&&e.results.length>0&&e.results[0]&&e.results[0].data&&Array.isArray(e.results[0].data)&&e.results[0].data.length>0?i.getDimensionAttribute(e,i.dimensionAttributes,function(e){i.answer=e,i.parseResponse(),i._onCompleteLoadModel(e)}):(i._setError(_.get("FedAjax_NotFound"),void 0,"rpl30"+Date.now()),i.hideMainComponent())})}else i._setError(_.get("FedAjax_NotFound"),void 0,"rpl30"+Date.now()),i.hideMainComponent()},primitives:[{navigate_to_rel:{id:1,mode:"return_rel"}}],patterns:{RELATIONS:[{id:1}]},attributes:i.listOfPredicates})},n.get("metatype")!==o.METATYPE_REL||n.get("selReferenceID"))if(n.get("type"))i.getListOfAttributes(n);else{var t=d.getCancelObject();i.getListHandle.handle=t;var r={handleRequest:{handle:t},modelList:[n],tenant:n.getTenant(),onComplete:function(e){if(i.hideLoader(),e&&e.results&&"object"==typeof e.results[0]&&e.results[0]&&e.results[0].data&&Array.isArray(e.results[0].data)&&e.results[0].data.length>0){if("ds6w:type"===e.results[0].data[0].name){var t=e.results[0].data[0].valueDB;t&&n.set("type",t)}}else i._setError(_.get("FedAjax_NotFound"),void 0,"rpl30"+Date.now()),i.hideMainComponent();i.getListOfAttributes(n)}};r.defService=s,r.select_predicates=["ds6w:type"],u.getListOfAttributes(r)}else i.getInstanceDetails(n)}())})}}else this.iPropUX&&"function"==typeof this.iPropUX.clear&&this.iPropUX.clear(),this._onCompleteLoadModel({results:[]})},_getModelType:function(e){var t=e.get("type"),i=null;return null!=(i="object"==typeof t?t.get("valueDB"):t)&&null!=i||(i=o.EDITPROPINDEX_DEFAULTTYPE),i},destroyComponent:function(){e.is(this.destroy,"function")&&this.destroy(),this.listOfExtensions=null,this.listOfPredicates=null,this.maskAttributeDetails=null,this.maskGroupInfo=null,this.groupAttributesInfoAsPerMask=null,this.answer=null,g._destoryDictionary()},calculateUIPosition:function(){var e=this,t=1;for(var i in e.groupAttributesInfoAsPerMask)e.groupAttributesInfoAsPerMask[i]&&e.groupAttributesInfoAsPerMask[i].isType&&e.groupAttributesInfoAsPerMask[i].attributes&&e.groupAttributesInfoAsPerMask[i].attributes.forEach(function(i){e.maskAttributeDetails[i].UIPosition=t,t++});for(var i in e.groupAttributesInfoAsPerMask)e.groupAttributesInfoAsPerMask[i]&&e.groupAttributesInfoAsPerMask[i].isExtension&&e.groupAttributesInfoAsPerMask[i].isAutomaticExt&&e.groupAttributesInfoAsPerMask[i].attributes&&e.groupAttributesInfoAsPerMask[i].attributes.forEach(function(i){e.maskAttributeDetails[i].UIPosition=t,t++});for(var i in e.groupAttributesInfoAsPerMask)e.groupAttributesInfoAsPerMask[i]&&e.groupAttributesInfoAsPerMask[i].isExtension&&!1===e.groupAttributesInfoAsPerMask[i].isAutomaticExt&&e.groupAttributesInfoAsPerMask[i].attributes&&e.groupAttributesInfoAsPerMask[i].attributes.forEach(function(i){e.maskAttributeDetails[i].UIPosition=t,t++});e.answer&&e.answer.results&&e.answer.results.length>0&&e.answer.results[0]&&e.answer.results[0].PLMParametersAvailableForIndexMode&&e.answer.results[0].groupData&&e.answer.results[0].groupData.forEach(function(e){e.UIPosition=t,t++})},getListOfAttributes:async function(e){var t=this,i={model:e,type:t._getModelType(e)};p.getListOfExtensions(i,function(i){t.listOfExtensions=i,t.listOfPredicates=[],t.maskAttributeDetails={},t.maskGroupInfo={},t.groupAttributesInfoAsPerMask={};var n=[],s={isBus:!0,name:t._getModelType(e)};n.push(s);for(var a=0;a<i.length;a++)n.push(i[a]);p.getMaskAttributes(n,function(e){t.maskAttributeDetails=e.maskAttributeDetails,t.listOfPredicates=e.listOfPredicates,t.maskGroupInfo=e.maskGroupInfo,t.groupAttributesInfoAsPerMask=e.groupAttributesInfoAsPerMask,t.dimensionAttributes=e.dimensionAttributes,t.launchPostRequest(t.listOfPredicates)})})},parseResponse:function(){var e=this,t=[],i=[],n=e.answer;n.results[0].data.forEach(function(n){e.listOfPredicates.includes(n.name)&&(e.maskAttributeDetails&&e.maskAttributeDetails.hasOwnProperty(n.name)&&e.maskAttributeDetails[n.name].isExt&&(n.extension=e.maskAttributeDetails[n.name].extension),e.maskAttributeDetails&&e.maskAttributeDetails[n.name]&&e.maskAttributeDetails[n.name].UIPosition&&(n.UIPosition=e.maskAttributeDetails[n.name].UIPosition),e.maskAttributeDetails[n.name]&&e.maskAttributeDetails[n.name].group?(n.group=e.maskAttributeDetails[n.name].group,e.maskGroupInfo[n.group]&&e.maskGroupInfo[n.group].NLS&&e.maskGroupInfo[n.group].weight.toString().length>0&&(n.groupNLS=e.maskGroupInfo[n.group].NLS,n.groupWeight=e.maskGroupInfo[n.group].weight),i.push(n)):t.push(n))}),n.results[0].data=t,n.results[0].groupData=n.results[0].groupData?[...n.results[0].groupData,...i]:i,e.listOfExtensions&&e.listOfExtensions.length>0&&(n.results[0].extensions={},e.listOfExtensions.forEach(function(e){n.results[0].extensions[e.name]={name:e.name,nameNLS:e.name},e.isAutomaticExt&&(n.results[0].extensions[e.name].deploymentExtension=e.isAutomaticExt)})),n.options={showSections:!0,autoExpand:!1}},getInstanceDetails:async function(e){var t=this,i=t._getModelType(e);if(i!==o.EDITPROPINDEX_DEFAULTTYPE){var n={model:e,type:i};p.getListOfExtensions(n,function(e,n){t.listOfExtensions=e,t.listOfPredicates=[],t.maskAttributeDetails={},t.maskGroupInfo={},t.groupAttributesInfoAsPerMask={};var s=[];if(i!==o.EDITPROPINDEX_DEFAULTTYPE){var a={isRel:!0,name:i};s.push(a)}for(var r=0;r<e.length;r++)s.push(e[r]);p.getMaskAttributes(s,function(e){t.maskAttributeDetails=e.maskAttributeDetails,t.listOfPredicates=e.listOfPredicates,t.maskGroupInfo=e.maskGroupInfo,t.groupAttributesInfoAsPerMask=e.groupAttributesInfoAsPerMask,t.dimensionAttributes=e.dimensionAttributes,t.launchPostRequestForInstance(t.listOfPredicates)})})}},parseInstanceWSResponse:function(e,t,i){var n=this,s=t.get("source");s||(s=t.get("sourceName"));var a={source:s},r=[],o=Object.keys(e),l={};for(var c in e)l[c]=[e[c]];var u=new Promise(function(e){d.isReplayedODT()&&(n.nlsNameApiCalledCounter||(n.nlsNameApiCalledCounter=0),void 0!==n.nlsNameApiCalledCounter&&n.nlsNameApiCalledCounter++),n.getElementsNls(o,{tenant:f.getTenantFromModel(t),onComplete:function(t){e(t)},apiCalled:n.nlsNameApiCalledCounter})}),h=new Promise(function(e){d.isReplayedODT()&&(n.nlsValueApiCalledCounter||(n.nlsValueApiCalledCounter=0),void 0!==n.nlsValueApiCalledCounter&&n.nlsValueApiCalledCounter++);var i=t.get("sourceName")?t.get("sourceName"):t.get("source");n.getValuesNls(l,{tenant:f.getTenantFromModel(t),service:i,onComplete:function(t){e(t)},apiCalled:n.nlsValueApiCalledCounter})});Promise.all([u,h]).then(function(t){if(t&&"object"==typeof t){var n=t[0],s=t[1];n&&n.vocabularyElementNLSInfo&&n.vocabularyElementNLSInfo.forEach(function(t){if("Predicate"===t.type){var i=t.uri,n=t.dataType,o=s[i]?s[i][e[i]]:"",l=e[i]?e[i]:"",c={name:i,selectable:i,path:i,type:n,readOnly:!0,value:o,valueDB:l,nls:t.nlsName};if("dateTime"===n||"date"===n){var u=Date.parse(l),h=new Date(u);if(h){var p=d.convertDateToStandard(h,!0);l=p.valueDB,o=p.value,c.value=o,c.valueDB=l}c.type="date"}r.push(c),"ds6w:label"===t.uri&&(a.computed={label:c})}else if(t.nlsName)a[t.nlsName]=e[t.nlsName];else{var m=t.uri.split(":");m.length>1&&m[1]&&(a[t.nlsName]=e[m[1]])}}),a.data=r}i({results:[a]})})},getDimensionAttribute:function(e,t,i){var n=!1;if(e&&e.results&&e.results.length>0&&e.results[0]&&e.results[0].data)for(var s=e.results[0].data,a=0;a<s.length;a++)if(s[a].name&&t&&t.has(s[a].name)){n=!0;break}n?g.getDimension(e,t,i):i(e)},getElementsNls:function(e,t){e&&e.length>0?h.getResourcesInfo(e.join(","),{tenantId:t.tenant,lang:d.getLanguage(),apiVersion:"R2018x",onComplete:function(e){t.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),t.onComplete.call(this,{success:!1})}}):t.onComplete.call(this,null)},getValuesNls:function(e,t){if(e){var i={};for(var n in e)Array.isArray(e[n])&&(i[n]=[],e[n].forEach(function(s){i[n].push({value:e[n][0],source:[t.service]})}));h.getNlsOfPropertiesValuesBySource(i,{tenantId:t.tenant,serviceName:t.service,lang:d.getLanguage(),apiVersion:"R2019x",onComplete:function(e){t.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),t.onComplete.call(this,e)}})}},hideMainComponent:function(){this.editPropertiesUI&&this.editPropertiesUI.elements&&this.editPropertiesUI.elements.mainDiv&&"function"==typeof this.editPropertiesUI.elements.mainDiv.hide&&this.editPropertiesUI.elements.mainDiv.hide()}})});