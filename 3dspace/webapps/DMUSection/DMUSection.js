define("DS/DMUSection/DMUSectionContextCmd",["DS/CATWebUXComponents/DMUCommand"],function(e){"use strict";return e.extend({init:function(e){var t=e||{};this._parent(t)}})}),define("DS/DMUSection/DMUClippingPrecisePosCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUToolsClipping","DS/Visualization/PathElement","DS/DMUMeasurable/DMUSectionPosService","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUSwitchRepService","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUPlaySection/DMUSectionPosPreVisuNode3D","DS/DMUPlaySection/DMUClippingService","DS/Visualization/ThreeJS_DS","DS/Mesh/Mesh","DS/Visualization/Node3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i,n,o,a,r,l,s,c,d,g,u,p,h,m,S,v,C,b){"use strict";return e.extend({init:function(e){this._parent(e,"shared",!0),!this._id&&e.ID&&(this._id=e.ID),this.executionContext&&(this._isRunning=!1),"DMUSectionPreSelectPrecisePosHdr"===e.ID&&(this.objectAction=!0),this._keepDefaultController=!0;var t=this;t._destroy=function(){t._dlgBar&&(t._dlgBar.destroy(),t._dlgBar=null),Object.getPrototypeOf(t)._destroy.apply(t,arguments)}},_initPref:function(){},allowManipulation:function(e){return"Measure"===e.object||"Section"===e.object||void 0},setButtonEnableFlag:function(e){var t=document.getElementsByClassName("DMUSectionPosCommand"),i=e.btnId,n=e.enableFlag,o=null;"Ok"===i?o=t[0].getElementsByClassName("btn-primary"):"Cancel"===i&&(o=t[0].getElementsByClassName("btn-default")),o&&o[0]&&(!0===n?o[0].disabled=!1:!1===n&&(o[0].disabled=!0))},setText:function(e){var t=document.getElementsByClassName("DMUSectionPosCommand"),i=null;t&&t.length&&t[0].getElementsByClassName&&(i=t[0].getElementsByClassName("msg"))&&i[0]&&i[0].textContent&&e&&(i[0].textContent=e)},_beginExecute:function(){this.executionContext&&(this._isRunning=!0);let e=this.getFrameWindow().getViewer();this.isFinalStateExecuted=void 0;var i=o.getContextViewer({viewer:e});if(i.getController&&(this._viewerController=i.getController()),this.section=this.sectionForObjectAction,!this.section){var n=t.get();if(1===n.length&&this.getFrameWindow){var r=o.getReviewContext({viewer:e});r&&(this.section=r.getDMUObjectFromPathElement(n[0].pathElement))}}if(!this.section){var l=h.retriveClippingObjsFromSlide(e);l&&l.length&&(this.section=l[0])}t.empty(),this.section&&(this.section._posCmdActive=!0,this.section._lastPoshdr=this._id,h.deActivateClipping([this.section],this._viewer,!0)),this.objListObjectAction=this.section.csoList,this.objListObjectAction&&this.objListObjectAction.length&&(this.objectAction||(this.objectAction=!0),this.objListObjectAction.forEach(function(e){t.add(e)}));this._pathElementAgentWithCSO=new a({agentId:"_pathElementAgentWithCSO",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!0,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._previsualize,switchRepOnPreSelection:!0,viewerController:this._viewerController,timeoutDurationForRepLoading:1e3}),this._pathElementAgentWithoutCSO=new a({agentId:"_pathElementAgentWithoutCSO",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._previsualize,switchRepOnPreSelection:!0,viewerController:this._viewerController,timeoutDurationForRepLoading:1e3}),this._measurable=[],this._selectedObject=[],this._parent()},pauseExecute:function(){this.section&&(this.section._posCmdActive=!1),this._pathElementAgentWithCSO.deactivate(),this._pathElementAgentWithoutCSO.deactivate(),this._dlgBar.hide(),this._preVisuNode&&this._removePreVisuNode(),this.highlightNode&&this.highlightNode.setVisibility(!this._viewer.getVisibleSpace()),this.executionContext&&(this._isRunning=!1),this.done()},resumeExecute:function(){this.section&&(this.section._posCmdActive=!0),this._pathElementAgentWithCSO.activate(),this._pathElementAgentWithoutCSO.activate(),this._dlgBar.show(),this.highlightNode&&this.highlightNode.setVisibility(this._viewer.getVisibleSpace()),this.executionContext&&(this._isRunning=!0)},cancelExecute:function(){if(this._parent(),this.executionContext&&(this._isRunning=!1),this._pathElementAgentWithCSO.deactivate(),this._pathElementAgentWithoutCSO.deactivate(),this._pathElementAgentWithCSO=null,this._pathElementAgentWithoutCSO=null,this.sectionForObjectAction=void 0,this.objListObjectAction=void 0,this.OnlyPlaneTreated=void 0,this.objectAction=void 0,this._removePreVisuNode(),this._removehiglightVisuNode(),this._dlgBar&&this._dlgBar.destroy(),this.section)if(this.section.csoList=void 0,this.section._posCmdActive=void 0,this.cancelObjActionCmd){this.cancelObjActionCmd=void 0;var e=this.section;e.getParent().removeDMUObjects?e.getParent().removeDMUObjects([e]):e.getParent().getCurrentSlide().removeDMUObject(e)}else h.activateClipping([this.section],this._viewer),this.section.addOrRemoveFromCSO(!0);this._PlanePos=void 0,this.section=null,this.restoreDefaultController()},getPlanePos:function(){return this._PlanePos},computePlanePos:function(e){var t=this,i=t._viewer;t.OnlyPlaneTreated=void 0,t._bBox=void 0;var n,a=e&&e.inProgressSelList&&e.inProgressSelList.length?e.inProgressSelList:t._selectedObject,s=d.getViewpointInfo(i.currentViewpoint),g=e&&e.inProgressMeasurableList&&e.inProgressMeasurableList.length?e.inProgressMeasurableList:void 0;t._bBox=l.computeBoundingBox(t._viewer,void 0,function(){return t.section&&"DMUTemporaryBag"!==t.section.getParent().getType()},function(){return o.getContextViewer({viewer:t._viewer})});var u=function(){var e;if(t._bBox&&t._bBox.center)e=t._bBox.center();else{var i=l.computeBoundingSphere(t._viewer);i&&i.center&&(e=i.center)}return e},p=function(e){return!!t._bBox&&t._bBox.containsPoint(e)};if(a&&a.length){var h,m="",S=a.length;if(n=void 0,1===S){var v=g?g[0]:void 0,C=a[0];m="SingleSel",n=c.sectionPosMap[m].getPos({selectedObject:C,measurable:v||(t._measurable&&t._measurable.length?t._measurable[0]:void 0),info:s,viewer:i,boxCenterCB:u,isInBox:p})}else{var b,f=[],D=[],_=[],M=-1;for(h=0;h<S;h++){var P=a[h].pathElement,y=r.isOOCTileSetNodeInPath(P),w=P.getLastElement().sgNode;if(P&&(w||y)){var x=g?g[h]:t._measurable&&t._measurable.length&&t._measurable[h]?t._measurable[h]:c.getMeasurable({primitive:P.getLastElement().sgNode,pathElement:P,position:a[h].position,normal:a[h].normal,isOOCTileSetNodeInPath:y});if(f.push(x),D.push(a[h].pathElement),_.push(a[h]),m+=c.getSelMapName(x.getType()),(b=c.sectionPosMap[m])&&b.getPos){M=h+1;break}}}if(-1!==M){var U=b.getPos({measurables:f,selectedObjectList:_,info:s,boxCenterCB:u,isInBox:p,objectAction:t.objectAction?t.objectAction:void 0});U&&U.planeDef&&(t.OnlyPlaneTreated=U.treatOnlyPlane,n=U.planeDef)}}}return t._PlanePos=n,n},computeAndUpdatePlanePos:function(){var e=this;if(this.computePlanePos(),this._PlanePos&&this.section){if(!this._bBox){this._bBox=l.computeBoundingBox(e._viewer,void 0,function(){return e.section&&"DMUTemporaryBag"!==e.section.getParent().getType()},function(){return o.getContextViewer({viewer:e._viewer})})}var t=this.section.getAttribute("sPlaneBoxMode"),i=this._PlanePos;if("BoxMode"!==t){var n=c.computePlaneDim(this._bBox,i,this.modifyOrigin);n&&(n.fPlaneSizeV&&n.fPlaneSizeU&&(this.section.setAttribute("fYDirSize",n.fPlaneSizeV),this.section.setAttribute("fXDirSize",n.fPlaneSizeU),this.section.setAttribute("fYDirGridStep",n.fPlaneSizeV/20),this.section.setAttribute("fXDirGridStep",n.fPlaneSizeU/20)),n.plane&&(this._PlanePos=n.plane))}var a,r=this.section.getAttribute("fSliceOffset");if(!isNaN(r)&&("BoxMode"===t||"SliceMode"===t)){var s=this._PlanePos.decompose(),d=new m.Vector3(0,0,1).applyQuaternion(s[1]);d.negate(),d=d.normalize().multiplyScalar(r/2),a=(a=(new m.Vector3).getPositionFromMatrix(this._PlanePos)).add(d)}a&&this._PlanePos.setPosition(a),this.section.setAttribute("mPlaneReferential",this._PlanePos)}},buildGraph:function(){var e=this;function o(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)}function a(){e.highlightNode=new v,e.highlightNode.setNoZ(!0),e.highlightNode.setPickable(S.PICKTHROUGH),e._viewer&&(r.getSceneRoot(e._viewer).add(e.highlightNode),e._viewer.render())}function l(t){if(t){var i,n=new s,o=[];i=t.getPathElement();var a=t.getPrimitive();if(a)for(var r=THREEDS.SubElement.getFromSGNode(a);null!==r;)o.unshift(r),r=r.getParent();n.setFromArray(i.externalPath,o),e.addInHSO({path:n},!0)}}function d(t){if(t){var i,n=t.getType();switch(c.getSelMapName(n)){case"Point":case"Line":n===u.GeometryType.SPHERE?(!function(t){if(t){var i=t.getType();e.highlightNode||a(),e._preVisuNode||(e._preVisuNode=new p(e._viewer));var n=i===u.GeometryType.SPHERE?t.getCenter():t.getSelPoint();o(e.highlightNode,e._preVisuNode.getPointNode(n))}}(t),e.highlightNode&&(i={pathElement:r.buildPathElement(e.highlightNode)},e.addInHSO({path:i.pathElement},!0))):l(t);break;case"Axis":!function(t){t&&(e.highlightNode||a(),e._preVisuNode||(e._preVisuNode=new p(e._viewer)),o(e.highlightNode,e._preVisuNode.getAxisNode(t)))}(t),e.highlightNode&&(i={pathElement:r.buildPathElement(e.highlightNode)},e.addInHSO({path:i.pathElement},!0));break;default:return}e.highlightNode&&(e.highlightNode.setVisibility(e._viewer.getVisibleSpace()),e._viewer.render())}}e.changeDefaultController(),e._beginExecute(),e._dlgBar&&(e._dlgBar.removeAll(),e._dlgBar.destroy()),e._dlgBar=new n({className:"DMUSectionPosCommand"}).inject(e.getFrameWindow().getUIFrame()),e._dlgBar.add({msgType:"primary",message:b.firstSelection,closable:!1,buttons:[{className:"primary",label:b.ok,onClick:function(){e.publish({event:"DMUSectionPosCmdValidated"})}},{className:"default",label:b.cancel,onClick:function(){e.publish({event:"DMUSectionPosCmdCancelled"})}}]});var g=e.createInitialState("initialState");e.setEnterStateAction(g,function(){e._dlgBar.show(),e.getFrameWindow().getViewer().render(),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1})});var h=e.getFinalState(),m=e.createState("firstSelDoneState"),C=e.createState("secondSelDoneState"),f=e.createState("thirdSelDoneState"),D=function(n){"DMUSectionPreSelectPrecisePosHdr"===e.options.ID?e.cancelObjActionCmd=!0:e.cancelObjActionCmd=!1,e.isFinalStateExecuted=!0,e._removePreVisuNode(),e._removehiglightVisuNode(),t.empty(),i.empty(),e._PlanePos=void 0,e.cancel(),n()},_=function(t){e.isFinalStateExecuted=!0;var i=e.OnlyPlaneTreated;e._removePreVisuNode(),e._removehiglightVisuNode(),e.computeAndUpdatePlanePos(),e.cancel(),t(),e._measurable&&e._measurable.length&&e._measurable.forEach(function(e){i&&e.getType()!==u.GeometryType.PLANE||l(e)}),e.OnlyPlaneTreated=void 0,e._PlanePos=void 0};function M(){d(e._measurable[0]),e.setText(b.secondSelection),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!0})}function P(){if(e.modifyOrigin=!0,e._measurable&&e._measurable.length){var t=e._measurable[0].getType();t!==u.GeometryType.POINT&&t!==u.GeometryType.LINE&&t!==u.GeometryType.CIRCLE||(e.modifyOrigin=!1),t===u.GeometryType.PLANE||t===u.GeometryType.SURFACE||t===u.GeometryType.CURVE||e.objectActionValidSelDone?(e.objectActionValidSelDone&&e._selectedObject&&e._selectedObject.length>1&&(e.modifyOrigin=!1),e.publish({event:"DMUSectionPosCmdValidated"})):M()}}function y(){e.modifyOrigin=!1,e.goForthirdSel?(e.setText(b.thirdSelection),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1}),e._measurable&&e._measurable.length>1&&(d(e._measurable[0]),d(e._measurable[1])),e.goForthirdSel=!1):e.publish({event:"DMUSectionPosCmdValidated"})}function w(e){for(var t=0;t<e.length;t++)if(e[t].getType()===u.GeometryType.PLANE)return{index:t}}e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:g,iFinalState:h,iAction:D}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:m,iFinalState:h,iAction:D}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:C,iFinalState:h,iAction:D}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:f,iFinalState:h,iAction:D}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:m,iFinalState:h,iAction:_}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:C,iFinalState:h,iAction:_}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:f,iFinalState:h,iAction:_}),e.addTransition({iSender:e,iEvent:"GoToSecondSelDoneState",iInitialState:m,iFinalState:C,iAction:function(t){t(),e._measurable&&e._measurable.length>1&&(d(e._measurable[0]),d(e._measurable[1]))}}),document.addEventListener("keydown",function(t){if(t&&("Enter"===t.key||13===t.keyCode)&&!1===t.ctrlKey&&!1===t.altKey&&!1===t.shiftKey&&!1===t.metaKey){var i,n=document.getElementsByClassName("DMUSectionPosCommand");if(n&&n.length)(i=n[0].getElementsByClassName("btn-primary"))&&i[0]&&!1===i[0].disabled&&e.publish({event:"DMUSectionPosCmdValidated"})}}),e.addTransition({iEvent:e._pathElementAgentWithCSO,iInitialState:g,iFinalState:m,iCondition:function(n){e.onlyOneInSelList=!1,e.goForthirdSel=!1,e.objectActionValidSelDone=!1;var o=!1;if(e._measurable=[],e._selectedObject=[],e.objectAction&&(t.empty(),i.empty()),e.objectAction&&1!==n.length){var a=[],r=[];if(n.forEach(function(e){var t=c.getMeasurable(e);t&&(r.push(t),a.push(e))}),2===a.length)o=!0,function(t,i){if(!(!t||!i||t.length<2||i.length<2)){var n=t[0].getType(),o=t[1].getType(),a=e._checkfor2PointSel(n,o);if(a||e.computePlanePos({inProgressSelList:i,inProgressMeasurableList:t}))t&&t.forEach(function(t){e._measurable.push(t)}),i.forEach(function(t){e._selectedObject.push(t)}),a?(d(t[0]),d(t[1]),e.goForthirdSel=!0):e.objectActionValidSelDone=!0;else{var r=w(t);r&&void 0!==r.index?(e._measurable.push(t[r.index]),e._selectedObject.push(i[r.index]),d(t[r.index]),e.objectActionValidSelDone=!0):(e._measurable.push(t[0]),e._selectedObject.push(i[0]),d(t[0]))}}}(r,a);else if(3===a.length)o=!0,function(t,i){if(!(!t||!i||t.length<3||i.length<3))if(e.modifyOrigin=!1,e.computePlanePos({inProgressSelList:i,inProgressMeasurableList:t}))t&&t.forEach(function(t){e._measurable.push(t)}),i.forEach(function(t){e._selectedObject.push(t)}),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[0],i[1]],inProgressMeasurableList:[t[0],t[1]]}))e._measurable.push(t[0]),e._measurable.push(t[1]),e._selectedObject.push(i[0]),e._selectedObject.push(i[1]),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[0],i[2]],inProgressMeasurableList:[t[0],t[2]]}))e._measurable.push(t[0]),e._measurable.push(t[2]),e._selectedObject.push(i[0]),e._selectedObject.push(i[2]),e.objectActionValidSelDone=!0;else if(e.computePlanePos({inProgressSelList:[i[1],i[2]],inProgressMeasurableList:[t[1],t[2]]}))e._measurable.push(t[1]),e._measurable.push(t[2]),e._selectedObject.push(i[1]),e._selectedObject.push(i[2]),e.objectActionValidSelDone=!0;else{var n=w(t);n&&n.index?(e._measurable.push(t[n.index]),e._selectedObject.push(i[n.index]),d(t[n.index]),e.objectActionValidSelDone=!0):(e._measurable.push(t[0]),e._selectedObject.push(i[0]),d(t[0]))}}(r,a);else{o=!0;var l=w(r);l&&l.index?(e._measurable.push(r[l.index]),e._selectedObject.push(a[l.index]),d(r[l.index]),e.objectActionValidSelDone=!0):(e._measurable.push(r[0]),e._selectedObject.push(a[0]),d(r[0]))}}else{var s=c.getMeasurable(n[0]);s&&s.getType()!==u.GeometryType.PRODUCT&&(e._measurable.push(s),e._selectedObject.push(n[0]),d(s),e.onlyOneInSelList=!0,o=!0)}return o},iAction:function(t){t(),!e.objectAction||e.objectActionValidSelDone?P():e.onlyOneInSelList?(e.onlyOneInSelList=!1,P()):e.goForthirdSel?(y(),e.publish({event:"GoToSecondSelDoneState"})):e._measurable&&1===e._measurable.length&&M(),e.objectAction=void 0}}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:m,iFinalState:C,iCondition:function(t){var i=c.getMeasurable(t[0]);if(i){if(i.getType()!==u.GeometryType.PRODUCT&&e._measurable.push(i),e._selectedObject.push(t[0]),d(i),!e.goForthirdSel&&2===e._measurable.length){var n=e._measurable[0].getType(),o=e._measurable[1].getType();e._checkfor2PointSel(n,o)&&(e.goForthirdSel=!0)}return!0}return!1},iAction:function(e){e(),y()}}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:C,iFinalState:f,iCondition:function(t){var i=c.getMeasurable(t[0]);return!!i&&(i.getType()!==u.GeometryType.PRODUCT&&e._measurable.push(i),e._selectedObject.push(t[0]),d(i),e.modifyOrigin=!1,!0)},iAction:function(t){t(),e.publish({event:"DMUSectionPosCmdValidated"})}})},_isLoaded:function(e){this._switchService||(this._switchService=new g({viewer:this._viewer}));var t,i=[],n=e;if(this._switchService.retriveNodesFromPath(n,i),i&&i.length)for(var o=0;o<i.length;o++)if(t=i[o],this._viewerController.hasMeshInRAM(r.getNodeID(t))&&"cgr"===this._viewerController.getLoadedStream(t))return!0;return!1},_checkfor2PointSel:function(e,t){var i=!1;return"Point"===c.getSelMapName(e)&&"Point"===c.getSelMapName(t)&&(i=!0),i},_checkPicking:function(e,t){if(!e)return!1;if(!t._isLoaded(e))return!0;var i=c.getMeasurable({pathElement:e});if(i){if(t._measurable&&!t._measurable.length)return!0;var n=[],o=[];t._measurable.forEach(function(e){n.push(e)}),n.push(i),t._selectedObject.forEach(function(e){o.push(e)}),o.push({pathElement:e});var a="",r=function(){return n.forEach(function(e){a+=c.getSelMapName(e.getType())}),!(!c.sectionPosMap[a]||!t.computePlanePos({inProgressSelList:o,inProgressMeasurableList:n}))};if(t._measurable&&1===t._measurable.length){t.goForthirdSel=!1;var l=n[0].getType(),s=n[1].getType();return t._checkfor2PointSel(l,s)?(t.goForthirdSel=!0,!0):r()}if(t._measurable&&2===t._measurable.length)return r()}return!1},_removePreVisuNode:function(){this._preVisuNode&&(r.getSceneRoot(this._viewer).remove(this._preVisuNode),this._viewer.render(),this._preVisuNode.removeChildren(),this._preVisuNode.remove(),this._preVisuNode=void 0)},_removehiglightVisuNode:function(){this.highlightNode&&(r.getSceneRoot(this._viewer).remove(this.highlightNode),this._viewer.render(),this.highlightNode.removeChildren(),this.highlightNode.remove(),this.highlightNode=void 0)},_previsualize:function(e,t){if(e&&e.pathElement){var i,n,o,a,l=t._viewer,s=new m.Vector3,g=new m.Vector3,h=new m.Vector3,v=function(){return a&&"Axis"===c.getSelMapName(a.getType())};if(t._PlanePos)if(a=c.getMeasurable(e),(n=t._PlanePos).extractBasis(s,g,h),v())if(a.getType()===u.GeometryType.CIRCLE)o=a.getCenter();else{var b=e.position?e.position:a.getSelPoint(),f=a.getPoints(),D=a.getAxis().clone().toArray(),_=b.clone().toArray(),M=f.beginPoint.toArray(),P=h.clone().toArray(),y=C.computeTwoLinesDistance(_,P,M,D).aPosition2;o=new m.Vector3(y[0],y[1],y[2])}else o=e.position?e.position:(new m.Vector3).getPositionFromMatrix(n);else{var w=d.getViewpointInfo(l.currentViewpoint);i=c.sectionPosMap.SingleSel.getPos({selectedObject:e,info:w,viewer:l,retriveMeasureble:!0}),a=i&&i.measurable?i.measurable:c.getMeasurable(e),i.plane&&((n=i.plane).extractBasis(s,g,h),o=(new m.Vector3).getPositionFromMatrix(n))}return n&&(a||(a=c.getMeasurable(e)),t._preVisuNode?t._preVisuNode.buildPreVisuNode({data:{point:o,normal:h.negate(),measurable:a,toShowAxisVisu:v}}):(t._preVisuNode=new p(l),t._preVisuNode.buildPreVisuNode({data:{point:o,normal:h.negate(),measurable:a,toShowAxisVisu:v}}),t._preVisuNode.setNoZ(!0),t._preVisuNode.setPickable(S.PICKTHROUGH),l&&(r.getSceneRoot(l).add(t._preVisuNode),l.render())),t._preVisuNode.setVisibility(l.getVisibleSpace())),!0}t._preVisuNode&&t._removePreVisuNode()}})}),define("DS/DMUSection/DMUClippingCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUPlaySection/DMUClippingService","DS/DMUPlaySection/DMUStoreyNavigratorController","DS/DMUPlaySection/DMUToolsSection"],function(e,t,i,n,o,a){"use strict";var r,l,s=e.extend({init:function(e){this._parent(e),r=this.getFrameWindow().getViewer(),l=t.getContextViewer({viewer:r});var n=this;this.onStateChange(function(){n.getState()?s.ActivateClipping():s.DeactivateClipping()});var o=!1,a=t.getReviewContext({viewer:r});if(a){var c=a.getCurrentSessionMarkup();if(c){var d=c.getCurrentSlide();if(d){var g=d.getEnvironmentOverload();o="boolean"==typeof g.state.bLockUnlockSection?g.state.bLockUnlockSection:void 0;let e=i.getClippingCmdService();e&&e.updateClippingPlaneHideShowState({reviewContext:t.getReviewContext({viewer:r}),state:o})}}}}});return s.ActivateClipping=function(e,t){if(!r&&t&&(l||(l=t.executionContext.getComponent("Viewer")),l&&(r=l.getViewer())),!r){l||(l=require("DS/PADUtils/PADContext").get()),l&&(r=l.getViewer())}if(!i.isExplodeCmdActive(l)){var s=n.retriveClippingObjsFromSlide(r);if(s&&s.length>0)n.activateClipping(s,r);else{let e=a.getEditCmd(r);e&&!e.isRunning()&&(o.setActivateClippingActionFlag(!0),e.begin())}}e&&e()},s.DeactivateClipping=function(e,t){if(!r&&t&&(l||(l=t.executionContext.getComponent("Viewer")),l&&(r=l.getViewer())),!r){l||(l=require("DS/PADUtils/PADContext").get()),l&&(r=l.getViewer())}if(!i.isExplodeCmdActive(l)){var o=n.retriveClippingObjsFromSlide(r);n.deActivateClipping(o,r)}e&&e()},s}),define("DS/DMUSection/DMUClippingContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPUtils","DS/WebappsUtils/WebappsUtils","DS/DMUPlaySection/DMUToolsSection","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i,n,o,a,r){"use strict";var l={DMUExitClippingEditionHdr:{type:"PushItem",identifier:"DMUExitClippingEditionHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingEditionExit.png"},DMUContourViewerHdr:{type:"PushItem",identifier:"DMUContourViewerHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingSecondaryViewer.png"},DMUAlignViewHdr:{type:"CheckItem",identifier:"DMUAlignViewHdr",module:"DMUSection",iconPath:"icons/32/I_WebClippingAlignView.png"},DMUPropertiesHdr:{type:"PushItem",identifier:"DMUPropertiesHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUProperties.png"},DMUHideShowHdr:{type:"PushItem",identifier:"DMUHideShowHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUHideShow.png"},DMUCutHdr:{type:"PushItem",identifier:"DMUCutHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCutCmd.png"},DMUCopyHdr:{type:"PushItem",identifier:"DMUCopyHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCopyCmd.png"},DMUDeleteHdr:{type:"PushItem",identifier:"DMUDeleteHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUDelete.png"}},s=function(e){return e&&e.getComponent?e.getComponent(WAfrStandardComponentKey.HandlerComponent):void 0};return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];return e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1!==t.length||-1===t[0].indexOf("DMUClipping")&&-1===t[0].indexOf("DMUSection")?[]:this.getContextualMenuCommandList()},getContextualMenuCommandList:function(){var e=this;this._executionContext&&!this._handler&&(this._handler=s(this._executionContext));var t,n,a=[],c=this.isInEdition(),d=(t=!0,(!(n=i.getReviewContext({viewer:e._viewer}).getCurrentSessionMarkup())||n&&!n.getActiveFlag()||n&&n.getActiveFlag()&&!n.isVisible()||n&&n.getActiveFlag()&&n.isVisible()&&n.isReadOnly()||n&&n.getActiveFlag()&&n.isVisible()&&!n.isReadOnly()&&!n.getCurrentSlide())&&(t=!1),t),g=d&&this.isSinglePlaneMode()&&this.getAttribute("bSectionCurvesVisible");c&&a.push({line:1,name:"DMUExitClippingEditionStr",hdr_list:["DMUExitClippingEditionHdr"]}),d&&"DMUSection"===this.getType()&&a.push({line:1,name:"DMUHideShowStr",hdr_list:["DMUHideShowHdr"]}),this.isEditable()?(a.push({line:1,name:"DMUPropertiesStr",hdr_list:["DMUPropertiesHdr"]}),c&&g&&d&&a.push({line:1,name:"DMUContourViewerStr",hdr_list:["DMUContourViewerHdr"]}),a.push({line:1,name:"DMUAlignViewPointStr",hdr_list:["DMUAlignViewHdr"]}),d&&(a.push({line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}),a.push({line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]}),a.push({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}))):this.isEditable()||a.push({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),this.cmdHdrState_list=[],this.cmdHdrState_list.push({name:"DMUContourViewerHdr",state:this.isSecondaryViewerShow()}),a.length||(a=null);let u=a;return e._executionContext&&a&&a.length>0&&(u=[],a.forEach(t=>{if(t&&t.hdr_list&&t.hdr_list.length){var i=t.hdr_list[0];let n=l[i].type,a=void 0;const c=e.cmdHdrState_list.find(e=>e.name===i);"RadioItem"!==n&&"CheckItem"!==n||c&&c.state&&(a="selected"),u.push({type:n,handlerId:l[i].identifier,title:r[i],state:a,icon:l[i].iconPath?o.getWebappsAssetUrl(l[i].module,l[i].iconPath):void 0,action:{this:e,callback:function(t){e._handler||(e._handler=s(e._executionContext)),t&&e._handler.executeHandler({id:t})}.bind(this,i)}})}})),u},getSharedContextualCommandList:function(e){var t=[];return e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),t.length>=1&&(-1!==t[0].indexOf("DMUClipping")||-1!==t[0].indexOf("DMUSection"))?this.getContextualCommandList():[]},getContextualCommandList:function(){this._executionContext&&!this._handler&&(this._handler=s(this._executionContext));var e=null;let t,o;if(this.isInEdition()){var r,l,c,d=this.getAttribute("sPlaneBoxMode");if(o="ConstructionItemMode"===d||a.isClippingEligibleForStoreyMode(this._viewer,i.getContextViewer({viewer:this._viewer})),"3dPlay"!==this._typeApps&&"DMUSection"!==this.getType()&&(t="BoxMode"===d?"ClippingDisplayModeBoxHdr":"SliceMode"===d?"ClippingDisplayModeSliceHdr":"ConstructionItemMode"===d?"ClippingDisplayModeStoreyHdr":"ClippingDisplayModePlaneHdr",o?(r={name:"ClippingDisplayModeWithStorey",line:1,hdr_list:["DMUClippingDisplayModeStoreyHdr","DMUClippingDisplayModePlaneHdr","DMUClippingDisplayModeSliceHdr","DMUClippingDisplayModeBoxHdr"],selectedHdr:"DMU"+t},c={name:"ClippingPositionWithStorey",line:1,hdr_list:["DMUClippingReverseHdr"]}):r={name:"ClippingDisplayMode",line:1,hdr_list:["DMUClippingDisplayModePlaneHdr","DMUClippingDisplayModeSliceHdr","DMUClippingDisplayModeBoxHdr"],selectedHdr:"DMU"+t}),"ConstructionItemMode"!==d){if("3dPlay"!==this._typeApps){let e="BoxMode"===d?["DMUClippinBoxWithObjectsHdr","DMUResetClippingBoxHdr"]:"SliceMode"===d?["DMUClippinSliceWithObjectsHdr","DMUResetClippingSliceHdr"]:["DMUClippinPlaneWithObjectsHdr","DMUResetClippingPlaneHdr"];l={name:"BoxMode"===d?"ClippingDefBox":"SliceMode"===d?"ClippingDefSlice":"ClippingDefPlane",line:1,hdr_list:e,selectedHdr:"Reset"===this._lastClippingDefHdr?e[1]:e[0]}}c={name:"ClippingPosition",line:1,hdr_list:["DMUClippingNormalToXHdr","DMUClippingNormalToYHdr","DMUClippingNormalToZHdr","DMUClippingNormalUserHdr","DMUClippingReverseHdr"],selectedHdr:this._lastPoshdr?this._lastPoshdr:"DMUClippingNormalToXHdr"}}e=[],r&&e.push(r),l&&e.push(l),c&&e.push(c),n.isEnvActivated("clippingDeleteCmdInContextBar",!0)&&e.push({name:"ClippingDelete",line:1,hdr_list:["DMUSectionDeleteSectionHdr"]})}else e=[{name:"DMUEditClipingstr",line:1,hdr_list:["DMUClippingEditionHdr"]}];t&&this._handler&&this._handler.setRadioItemState({id:t,radioId:o?"ClippingDisplayModeWithStorey":"ClippingDisplayMode",state:!0,args:{ID:t,Value:null}});let g=e;return this._executionContext&&e&&e.length>0&&(g=[],e.forEach(e=>{e&&e.hdr_list&&e.name&&g.push({type:"handler",identifier:"DMUEditClipingstr"!==e.name&&"ClippingPositionWithStorey"!==e.name||!e.hdr_list.length?e.name:e.hdr_list[0]})})),g},applyStateToContextHdr:function(e){if(e.length>0)for(var i=0;i<e.length;i++){var n=t.getCommand(e[i].name,"Default");n&&n.setState&&n.setState(e[i].state)}},setCheckCmdHdrState:function(e){this.applyStateToContextHdr&&e.length>0&&this.applyStateToContextHdr(e)},getSharedHeaderTypes:function(){return{}},register:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"},contextualMenu:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"},contextualMenu:{type:e.type?e.type:"DMUClipping",module:"DMUSection",workbenchName:"DMUSection"}})}})}),define("DS/DMUSection/DMUSectionSecondaryViewer",["DS/DMUControls/EXPSecondaryViewer","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/DMUBaseExperience/EXPToolsVisualization","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,i,n,o,a){"use strict";return e.extend({init:function(e){var t=this._setupOptions(e);this._sectionObj=e,this._parent(t),this._setupViewer(e),this.addCommands(),this.show()},_setupOptions:function(e){return{body:e._frmWindow.getUIFrame(),height:"378",width:"360",title:a.sectionsecondaryviewer,position:{top:"50",left:"50"}}},_setupViewer:function(e){var o=e._viewer.backgroundColor;this._viewerSecondary.setBackgroundColor(o),this._bgColorDefault=!0;var a=e.getSectionCurvesFor2DViwer();this._viewerSecondary.addNode(a);var r={viewer:this._viewerSecondary};this._viewpointSec=new i(r),this._viewpointSec.onMove(this._viewerSecondary.render),this._viewerSecondary.addViewpoint(this._viewpointSec),this._viewpointSec.setDefaultController(!0,"CATIA"),this._viewpointSec.control.setRotationActive(!1);var l=this._viewpointSec.getAngle(),s=a.bSphere,c=s.center,d=1.5*s.radius/Math.tan(l/2);n.moveViewpoint({viewpoint:this._viewerSecondary.currentViewpoint,target:c,sightDirection:new t.Vector3(0,0,1),upDirection:new t.Vector3(0,1,0),targetDistance:d,duration:0})},render:function(){this._viewerSecondary.render()},addCommands:function(){for(var e=o.getWebappsAssetUrl("DMUSection","icons/32/"),i=[{className:"secondaryViewerRotateCWCmd",nls:a.rotateClockwise,url:e+"I_3DSHAREPRORotateCW.png",callback:function(e){var t=.5*Math.PI;e._rotateViewpoint(t)}},{className:"secondaryViewerRotateCCWCmd",nls:a.rotateCounterClockwise,url:e+"I_3DSHAREPRORotateCCW.png",callback:function(e){var t=-.5*Math.PI;e._rotateViewpoint(t)}},{className:"secondaryViewerFlipVerticalCmd",nls:a.flipVertical,url:e+"I_SectionWebInvertVertical.png",callback:function(e){var i=e.options.viewer.currentViewpoint,n=i.getTarget(),o=i.control.orientation.clone(),a=i.getUpDirection(),r=Math.PI,l=(new t.Quaternion).setFromAxisAngle(a,r);o.multiplyQuaternions(l,o.clone());var s=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:o,distanceToTarget:s,duration:400})}},{className:"secondaryViewerFlipHorizontalCmd",nls:a.flipHorizontal,url:e+"I_SectionWebInvertHorizontal.png",callback:function(e){var i=e.options.viewer.currentViewpoint,n=i.getTarget(),o=i.control.orientation.clone(),a=i.getUpDirection(),r=i.getSightDirection(),l=(new t.Vector3).crossVectors(a,r).normalize(),s=Math.PI,c=(new t.Quaternion).setFromAxisAngle(l,s);o.multiplyQuaternions(c,o.clone());var d=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:o,distanceToTarget:d,duration:400})}},{className:"secondaryViewerBgColorCmd",nls:a.switchBgColor,url:e+"I_MldColor2.png",callback:function(e){if(e._bgColorDefault){var t=e._sectionObj.getAttribute("cFillStyleColor");e._viewerSecondary.setBackgroundColor(t.getHex())}else{var i=e._sectionObj._viewer.backgroundColor;e._viewerSecondary.setBackgroundColor(i)}e._bgColorDefault=!e._bgColorDefault}}],n=0;n<i.length;n++)this.addButton(i[n])},_rotateViewpoint:function(e){var i=this.options.viewer.currentViewpoint,n=i.getTarget(),o=i.getEyePosition(),a=i.control.orientation.clone(),r=(new t.Vector3).subVectors(o,n).normalize(),l=(new t.Quaternion).setFromAxisAngle(r,e);a.multiplyQuaternions(l,a.clone());var s=i.control.distanceToTarget;i.control.moveTo({target:n,orientation:a,distanceToTarget:s,duration:400})}})}),define("DS/DMUSection/DMUClippingProperties",["UWA/Core","UWA/Class","DS/Controls/Label","DS/Controls/Toggle","DS/Controls/SpinBox","DS/Controls/ColorPicker","DS/Controls/ComboBox","DS/Visualization/ThreeJS_DS","DS/CATWebUXPreferences/DMUClippingPrefService","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUBaseUIControllers/DMUWebPreferencesController"],function(e,t,i,n,o,a,r,l,s,c,d){"use strict";return t.extend({init:function(){this.getPropertiesDisplay=function(t,g){var u,p,h,m,S,v,C,b,f,D,_,M,P,y,w,x,U=s.getPrefNLS(),E={},V=!1,A=null,O=!1,N=null,T=!0,B=!1,k=null,j=!1,H=null,F=!1,I=null,R=!1,L=null,W=!1,X=null,G=!1,z=null,J=!1,q=null,K=!1,Y=null,Q=!1,Z=null,$=!1,ee=null,te=!1,ie=null,ne=!1,oe=null,ae=!1,re=null;function le(e,t,i){var n={},o="angle"===e?"Angle":"Length",a=d.readPreferences({name:"cke",PreferenceNames:[o]}).preferences[0].value;return n.value=c.convert(t,e,i,a),n.unit=d.getCurrentUnit(e).nls,n.nbDecimal=d.getCurrentUnit(e).decimalPlaceRW,n}function se(t,l,s,c){var d,g;switch(E[c]||(E[c]={}),t){case"radio+color":var u=e.createElement("div",{class:"DMUSectionRadioColorboxComboDiv",styles:{display:"flex","align-items":"center"}}).inject(l),p=e.createElement("div",{styles:{"padding-top":"5px","margin-left":"0px"}}).inject(u),h=[];for(let e=0;e<s.options.length;e++){let t=new n({label:s.options[e].nls,value:s.options[e].id,type:"radio",checkFlag:s.options[e].id===s.val}).inject(p);h.push(t),s.onChange&&t.addEventListener("change",e=>{e.dsModel.checkFlag&&s.onChange(e.dsModel.value)})}E[c].radio=h;var m=e.createElement("div",{styles:{"padding-bottom":"20px","margin-left":"10px"}}).inject(u),S=new a({value:s.colorValue,alignment:"left"});S.inject(m),E[c].color=S;break;case"color+spin":var v=e.createElement("div",{class:"DMUSectionColorSpinboxComboDiv",styles:{display:"flex","align-items":"center"}}).inject(l);if(E[c].div=v,s.nlsColor){e.createElement("label",{text:s.nlsColor,class:"wux-label",styles:{"padding-right":"10px","font-weight":"inherit"}}).inject(v)}var C=new a({value:s.colorValue,alignment:"left"});if(C.inject(v),E[c].color=C,s.nlsSpin){e.createElement("label",{text:s.nlsSpin,class:"wux-label",styles:{"padding-left":"10px","font-weight":"inherit"}}).inject(v)}var b=e.createElement("div",{styles:{display:"flex","margin-left":"5px",width:"100px"}}).inject(v),f=s.spinerVal;(g=new o({value:f.value,units:f.units,minValue:f.minValue,maxValue:f.maxValue,stepValue:f.stepValue,disabled:s.disableSpinboxAtUncheck&&!s.getValue(),pageStepValue:1})).inject(b),E[c].spinner=g;break;case"color+combo":var D=e.createElement("div",{class:"DMUSectionColorComboDiv",styles:{display:"flex","align-items":"center"}}).inject(l);if(E[c].div=D,s.nlsColor){let e=new i({value:s.nlsColor});e.getContent().setStyles({margin:"0","padding-right":"10px","font-weight":"inherit",background:"none"}),e.getContent().getChildren()[0].setStyles({padding:"0px"}),e.inject(D),E[c].labelColor=e}var _=new a({value:s.colorValue,alignment:"left"});if(_.inject(D),E[c].color=_,s.nlsCombo){let e=new i({value:s.nlsCombo});e.getContent().setStyles({margin:"0px","padding-left":"10px","font-weight":"inherit",background:"none"}),e.getContent().getChildren()[0].setStyles({padding:"0px"}),e.inject(D),E[c].labelCombo=e,e.inject(D)}var M=e.createElement("div",{styles:{display:"flex","margin-left":"5px",width:"100px"}}).inject(D),P=new r({elementsList:s.options,value:s.comboValue,disabled:s.isDisabled&&s.isDisabled(),enableSearchFlag:"undefined"===s.enableSearchFlag||s.enableSearchFlag}).inject(M);E[c].combo=P,s.onChange&&P.addEventListener("change",e=>{s.onChange(e.dsModel.value)});break;case"radio+spin":var y=e.createElement("div",{class:"DMUSectionRadioSpinboxComboDiv",styles:{display:"flex","align-items":"center"}}).inject(l);E[c].div=y;var w=e.createElement("div",{styles:{"padding-top":"5px","margin-left":"0px"}}).inject(y),x=[];for(let e=0;e<s.options.length;e++){let t=new n({label:s.options[e].nls,value:s.options[e].id,type:"radio",checkFlag:s.options[e].id===s.val}).inject(w);x.push(t),s.onChange&&t.addEventListener("change",e=>{e.dsModel.checkFlag&&s.onChange(e.dsModel.value)})}E[c].radio=x;var U=e.createElement("div",{styles:{display:"flex","padding-bottom":"20px","margin-left":"10px",width:"100px"}}).inject(y),V=s.spinerVal,A=le(V.magnitude,V.value,V.originUnit);(g=new o({value:A.value,units:A.unit,decimals:A.nbDecimal,minValue:le(V.magnitude,V.minValue,V.originUnit).value,maxValue:le(V.magnitude,V.maxValue,V.originUnit).value,stepValue:le(V.magnitude,Math.PI/180,V.originUnit).value,disabled:s.disableSpinboxAtUncheck&&!s.getValue(),pageStepValue:1})).inject(U),E[c].spinner=g;break;case"combo":var O=e.createElement("div",{styles:{display:"grid","grid-template-columns":"50% 50%",margin:"2px 0",width:"150px"}}).inject(l);s.customStyle&&O.setStyles(s.customStyle),e.createElement("span",{text:s.nls,class:"DMUSectionComboSectionTitle",styles:{margin:"auto 0px"}}).inject(O);var N=new r({elementsList:s.options,value:s.val,disabled:s.isDisabled&&s.isDisabled(),enableSearchFlag:"undefined"===s.enableSearchFlag||s.enableSearchFlag}).inject(O);E[c].combo=N,s.onChange&&N.addEventListener("change",e=>{s.onChange(e.dsModel.value)});break;case"checkBox":var T=new n({type:"checkbox",label:s.lable,value:s.value,checkFlag:s.checkFlag,mixedState:Boolean(s.mixedState)});T.inject(l),E[c].checkBox=T,s.onChange&&T.addEventListener("change",e=>{s.onChange(e.dsModel.checkFlag)});break;case"spin":var B=e.createElement("div",{styles:{display:"flex","grid-template-columns":"50% 50%",margin:"2px 0",width:"150px"}}).inject(l);E[c].div=B;var k=new i({value:s.label});k.getContent().setStyles({margin:"auto 0px","padding-right":"10px",background:"none"}),k.getContent().getChildren()[0].setStyles({padding:"0px"}),k.inject(B),(g=new o({value:parseInt(s.spinerVal.value),units:"px",minValue:parseInt(s.spinerVal.minValue),maxValue:parseInt(s.spinerVal.maxValue),stepValue:s.spinerVal.stepValue,disabled:s.disableSpinboxAtUncheck&&!s.getValue(),pageStepValue:1})).inject(B),E[c].spinner=g,E[c].label=k;break;default:d=e.createElement("div")}return d}function ce(e){return 100*(1-e)}function de(e){return isNaN(e)?.5:0!==e?1-e/100:1}function ge(e){return new l.Color("#"+e)}(function(e){var t=!1;if(e){for(u=0;u<e.length;u++){if(null===(x=e[u].getAttribute("bCustomCappingColor"))||null===x){var i=e[u].getAttribute("cCappingColor");x=!!i}if(null===N?N=x:x!==N&&(N="MixState"),x=e[u].getAttribute("cCappingColor"),null===A?A=x:JSON.stringify(x)!==JSON.stringify(A)&&(A="MixState"),x=e[u].getAttribute("bHatchingDisplay"),null===k?k=x:x!==k&&(k=void 0),x=e[u].getAttribute("cHatchingColor"),null===H?H=x:JSON.stringify(x)!==JSON.stringify(H)&&(H="MixState"),x=e[u].getAttribute("fHatchingLineStyleThickness"),null===I?I=x:x!==I&&(I=void 0),x=e[u].getAttribute("sHatchingAnglesMode"),null===L?L=x:x!==L&&(L="MixState"),x=e[u].getAttribute("fHatchingSingleAngleValue"),null===X?X=x:x!==X&&(X=void 0),x=e[u].getAttribute("fHatchingPitchValue"),null===z?z=x:x!==z&&(z=void 0),x=e[u].getAttribute("bSectionCurvesVisible"),null===q?q=x:x!==q&&(q=void 0),null===(x=e[u].getAttribute("bCustomContourColor"))||null===x){var n=e[u].getAttribute("cLineStyleColor");x=!!n}null===Y?Y=x:x!==Y&&(Y="MixState"),x=e[u].getAttribute("cLineStyleColor"),null===Z?Z=x:JSON.stringify(x)!==JSON.stringify(Z)&&(Z="MixState");var o=e[u].getAttribute("fLineStyleThickness");o||(o=e[u].getAttribute("fLineStyleThicknessIndex")),(x=o)||(x=e[u].getAttribute("fLineStyleThicknessIndex")),null===ee?ee=x:x!==ee&&(ee=void 0),x=e[u].getAttribute("bClippingPlaneVisible"),null===ie?ie=x:x!==ie&&(ie=void 0),x=e[u].getAttribute("cFillStyleColor"),null===oe?oe=x:JSON.stringify(x)!==JSON.stringify(oe)&&(oe="MixState"),x=e[u].getAttribute("fOpacity"),null===re?re=x:x!==re&&(re=void 0)}t=!0}return t})(t)&&(h=!1,O=!1,"MixState"===N?(N=void 0,O=!0):h=N,V=!1,"MixState"===A?(A=void 0,V=!0):p=A?A.getHexString():void 0,T=!1,B=!1,void 0===k?B=!0:T=k,m=!1,j=!1,"MixState"===H?(H=void 0,j=!0):m=H?H.getHexString():void 0,S=void 0,F=!1,void 0===I?F=!0:I&&(S=I.toString()),v=!1,R=!1,"MixState"===L?(L=void 0,R=!0):v=L,C=void 0,W=!1,void 0===X?W=!0:C=X,b=void 0,G=!1,void 0===z?G=!0:b=z,f=!1,J=!1,void 0===q?J=!0:f=q,D=!1,K=!1,"MixState"===Y?(Y=void 0,K=!0):D=Y,Q=!1,"MixState"===Z?(Z=void 0,Q=!0):_=Z?Z.getHexString():void 0,M=void 0,$=!1,void 0===ee?$=!0:ee&&(M=ee.toString()),P=!1,te=!1,void 0===ie?te=!0:P=ie,ne=!1,"MixState"===oe?(oe=void 0,ne=!0):y=oe?oe.getHexString():void 0,w=void 0,ae=!1,void 0===re?(ae=!0,re="0"):isNaN(re)||(w=ce(re))),function(){var t=e.createElement("div",{styles:{"padding-bottom":"20px"}});t.inject(g);var n={"font-weight":"bold","text-align":"left",background:"none"},o=new i({value:U.cappingSubSection.title});o.getContent().setStyles(n),o.inject(t),se("radio+color",e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t),{options:s.colorRadioOptions,val:O?"None":h?s.colorRadioOptions[0].id:s.colorRadioOptions[1].id,colorValue:V?void 0:void 0===p?s.capping.getColorValue():p},"capping");var a=function(e){E&&E.hatching&&E.hatchingangle&&E.hatchingpitch&&(E.hatching.labelColor&&(E.hatching.labelColor.disabled=!e),E.hatching.color&&(E.hatching.color.disabled=!e),E.hatching.labelCombo&&(E.hatching.labelCombo.disabled=!e),E.hatching.combo&&(E.hatching.combo.disabled=!e),E.hatchingangle.radio&&(E.hatchingangle.radio[0].disabled=!e,E.hatchingangle.radio[1].disabled=!e),E.hatchingangle.spinner&&(E.hatchingangle.spinner.disabled=!e),E.hatchingpitch.spinner&&(E.hatchingpitch.spinner.disabled=!e),E.hatchingpitch.label&&(E.hatchingpitch.label.disabled=!e))},r=new i({value:U.hatchingSubSection.title});r.getContent().setStyles(n),r.inject(t);var l=e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t);se("checkBox",l,{lable:U.hatchingSubSection.displayHatchingCheckboxLbl,value:"DMUDisplayHatching",checkFlag:T,mixedState:B,onChange:function(e){a(e)}},"hatching"),se("color+combo",l,{nlsColor:U.hatchingSubSection.hatchingColorLbl,nlsCombo:U.hatchingSubSection.hatchingThicknessLbl,options:F?s.contourThicknessComboOptionsWithNA:s.contourThicknessComboOptions,colorValue:j?void 0:m,comboValue:F?void 0:void 0===S?s.hatching.getThicknessValueToSet():S},"hatching");var c=s.hatching.getSingleAngleValueInfos();R||W?c.value=void 0:void 0!==v&&(c.value=C),c.originUnit="Radian",se("radio+spin",l,{options:s.anglesRadioOptions,val:R?"None":void 0===v?s.hatching.getAnglesMode():v,spinerVal:c},"hatchingangle"),c=s.hatching.getPitchValueInfos(),G?c.value=void 0:void 0!==b&&(c.value=b),se("spin",l,{label:U.hatchingSubSection.hatchingPitchLbl,spinerVal:c},"hatchingpitch"),a(T);var d=new i({value:U.contourSubSection.title});d.getContent().setStyles(n),d.inject(t);var u=e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t);se("checkBox",u,{lable:U.contourSubSection.computeCheckboxLbl,value:"DMUComputeContour",checkFlag:f,mixedState:J},"contour"),se("radio+color",u,{options:s.colorRadioOptions,val:K?"None":D?s.colorRadioOptions[0].id:s.colorRadioOptions[1].id,colorValue:Q?void 0:void 0===_?s.contour.getColorValue():_},"contour"),se("combo",u,{options:$?s.contourThicknessComboOptionsWithNA:s.contourThicknessComboOptions,nls:U.contourSubSection.thicknessComboboxLbl,val:$?void 0:M},"contour");var x=new i({value:U.representationSubSection.title});x.getContent().setStyles(n),x.inject(t);var A=e.createElement("div",{styles:{"margin-left":"10px"}}).inject(t);se("checkBox",A,{lable:U.representationSubSection.displayCheckboxLbl,value:"DMUClippingPlaneDisplay",checkFlag:P,mixedState:te},"representation"),c=s.sectionPlane.getTransparencyValue(),ae?c.value=void 0:void 0!==w&&(c.value=w),se("color+spin",A,{nlsColor:U.representationSubSection.colorBtn,nlsSpin:U.representationSubSection.transparencySpinnerboxLbl,spinerVal:c,colorValue:ne?void 0:void 0===y?s.sectionPlane.getColorValue():y},"representation")}(),this.getPropertiesToSet=function(){de();var e,t,i,n,o,a=[],r=E.capping.radio,l=r[0].checkFlag,s=r[1].checkFlag;(l||s)&&l!==N&&a.push({name:"bCustomCappingColor",value:l}),(t=E.capping.color.value)&&(t=ge(t),JSON.stringify(A)!==JSON.stringify(t)&&(a.push({name:"cCappingColor",value:t}),A=t));var g=E.hatching.checkBox;g.mixedState||(e=g.checkFlag)!==k&&(a.push({name:"bHatchingDisplay",value:e}),k=e),(t=E.hatching.color.value)&&(t=ge(t),JSON.stringify(H)!==JSON.stringify(t)&&(a.push({name:"cHatchingColor",value:t}),H=t)),(n=E.hatching.combo.value)&&parseFloat(n)!==I&&"0"!==n&&(a.push({name:"fHatchingLineStyleThickness",value:parseFloat(n)}),I=parseFloat(n));var u,p,h,m,S,v=E.hatchingangle.radio,C=v[0].checkFlag,b=v[1].checkFlag;if(C||b){var f=C?"Single":"Various";f!==L&&(a.push({name:"sHatchingAnglesMode",value:f}),L=f)}u="angle",p=E.hatchingangle.spinner.value,h="Radian",m="angle"===u?"Angle":"Length",S=d.readPreferences({name:"cke",PreferenceNames:[m]}).preferences[0].value,(o=c.convert(p,u,S,h))===X||isNaN(o)||(a.push({name:"fHatchingSingleAngleValue",value:o}),X=o),(o=E.hatchingpitch.spinner.value)===z||isNaN(o)||(a.push({name:"fHatchingPitchValue",value:o}),X=o);var D=E.contour.checkBox;D.mixedState||(e=D.checkFlag)!==q&&(a.push({name:"bSectionCurvesVisible",value:e}),q=e),l=(r=E.contour.radio)[0].checkFlag,s=r[1].checkFlag,(l||s)&&l!==Y&&(a.push({name:"bCustomContourColor",value:l}),Y=l),(t=E.contour.color.value)&&(t=ge(t),JSON.stringify(t)!==JSON.stringify(Z)&&(a.push({name:"cLineStyleColor",value:t}),Z=t)),(n=E.contour.combo.value)&&parseFloat(n)!==ee&&"0"!==n&&(a.push({name:"fLineStyleThicknessIndex",value:parseFloat(n)}),ee=parseFloat(n));var _=E.representation.checkBox;return _.mixedState||(e=_.checkFlag)!==ie&&(a.push({name:"bClippingPlaneVisible",value:e}),ie=e),(t=E.representation.color.value)&&(t=ge(t)),JSON.stringify(t)!==JSON.stringify(oe)&&void 0!==t&&(a.push({name:"cFillStyleColor",value:t}),oe=t),(i=E.representation.spinner.value)===ce(re)||isNaN(i)||(a.push({name:"fOpacity",value:de(i)}),re=de(i)),a},this.afterSetProperties=function(e,t){if(e&&t)for(u=0;u<e.length;u++){for(var i=0;i<t.length;i++){var n=t[i];n&&"bSectionCurvesVisible"===n.name&&!1===n.value&&e[u].removeSectionCurve()}e[u].refreshNode(!0)}}}}})}),define("DS/DMUSection/DMUClippingResizeCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/Selection/CSOManager","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUBaseExperience/DMUContextManager","DS/StateCommandEngine/PathElementAgent","DS/DMUPlaySection/DMUClippingService","DS/CATWebUXPreferences/DMUClippingPrefService","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i,n,o,a,r,l){"use strict";return e.extend({init:function(e){this._parent(e,"shared",!0),!this._id&&e.ID&&(this._id=e.ID),this.executionContext&&(this._isRunning=!1),this._keepDefaultController=!0;var i=this;function n(e){var n=e;if(n&&n.length||(n=t.get()),n&&n.length&&n[0].pathElement){var o=n[0].pathElement;i._selectedObject||(i._selectedObject=[]),i._selectedObject.push(o),i.setButtonEnableFlag({btnId:"Ok",enableFlag:!0}),i._addAllSelToHSO()}}function o(){}i.addCSOCB=function(){i._tokensXSO_onPostAdd||(this._tokensXSO_onPostAdd=t.onPostAdd(n)),i._tokensXSO_onPostRemove||(this._tokensXSO_onPostRemove=t.onPostRemove(o))},i.removeCSOCB=function(){i._tokensXSO_onPostAdd&&t.unsubscribe(i._tokensXSO_onPostAdd),i._tokensXSO_onPostRemove&&t.unsubscribe(i._tokensXSO_onPostRemove),i._tokensXSO_onPostAdd=i._tokensXSO_onPostRemove=null},i._destroy=function(){i._dlgBar&&(i._dlgBar.destroy(),i._dlgBar=null),Object.getPrototypeOf(i)._destroy.apply(i,arguments)}},_initPref:function(){},allowManipulation:function(e){return"Measure"===e.object||"Section"===e.object||void 0},setButtonEnableFlag:function(e){var t=document.getElementsByClassName("DMUClippingResizeDlg"),i=e.btnId,n=e.enableFlag,o=null;"Ok"===i?o=t[0].getElementsByClassName("btn-primary"):"Cancel"===i&&(o=t[0].getElementsByClassName("btn-default")),o&&o[0]&&(!0===n?o[0].disabled=!1:!1===n&&(o[0].disabled=!0))},_beginExecute:function(){this.executionContext&&(this._isRunning=!0),this.isFinalStateExecuted=void 0;var e=t.get();if(1===e.length&&this.getFrameWindow){var i=n.getReviewContext({viewer:this.getFrameWindow().getViewer()});i&&(this.section=i.getDMUObjectFromPathElement(e[0].pathElement))}t.empty(),this.addCSOCB(),this.section&&(this.section._posCmdActive=!0,this.section._lastClippingDefHdr="Resize",a.deActivateClipping([this.section],this._viewer,!0)),this._pathElem=new o({agentId:"_pathElem",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"mesh",prePickingMode:"mesh",valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[]}),this._measurable=[],this._selectedObject=[],this._parent()},pauseExecute:function(){this.removeCSOCB(),this.section&&(this.section._posCmdActive=!1),this._pathElem.deactivate(),this._dlgBar.hide(),this.executionContext&&(this._isRunning=!1),this.done()},resumeExecute:function(){this.section&&(this.section._posCmdActive=!0),this.addCSOCB(),this._pathElem.activate(),this._dlgBar.show(),this.executionContext&&(this._isRunning=!0)},cancelExecute:function(){this._parent(),this.executionContext&&(this._isRunning=!1),this.section&&(this.section._posCmdActive=void 0),this.removeCSOCB(),this._pathElem.deactivate(),this._pathElem=null,this._dlgBar&&(this._dlgBar.destroy(),this._dlgBar=null),this.emptyHSO(),this.section&&(a.activateClipping([this.section],this._viewer),this.section.addOrRemoveFromCSO(!0)),this.section=null,this.restoreDefaultController(),this.done()},buildGraph:function(){var e=this;e.changeDefaultController(),e._beginExecute(),e._dlgBar&&(e._dlgBar.removeAll(),e._dlgBar.destroy()),e._dlgBar=new i({className:"DMUClippingResizeDlg"}).inject(e.getFrameWindow().getUIFrame()),e._dlgBar.add({msgType:"primary",message:l.ValidateSelObj,closable:!1,buttons:[{className:"primary",label:l.ok,onClick:function(){e.publish({event:"DMUSectionPosCmdValidated"})}},{className:"default",label:l.cancel,onClick:function(){e.publish({event:"DMUSectionPosCmdCancelled"})}}]});var t=e.createInitialState("initialState");e.setEnterStateAction(t,function(){e._dlgBar.show(),e.getFrameWindow().getViewer().render(),e.setButtonEnableFlag({btnId:"Ok",enableFlag:!1})});var n=e.getFinalState();e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdCancelled",iInitialState:t,iFinalState:n,iAction:function(t){e.cancel(),t()}}),e.addTransition({iSender:e,iEvent:"DMUSectionPosCmdValidated",iInitialState:t,iFinalState:n,iAction:function(t){e.section&&a.resizeClippingFromObject(e.section,{objForBB:e._selectedObject,boxMode:e.section.getAttribute("sPlaneBoxMode"),planeDir:r.planeNormalDir.getDirValue()},e._viewer),e.cancel(),t()}}),document.addEventListener("keydown",function(t){if(t&&("Enter"===t.key||13===t.keyCode)&&!1===t.ctrlKey&&!1===t.altKey&&!1===t.shiftKey&&!1===t.metaKey){var i,n=document.getElementsByClassName("DMUClippingResizeDlg");if(n&&n.length)(i=n[0].getElementsByClassName("btn-primary"))&&i[0]&&!1===i[0].disabled&&e.publish({event:"DMUSectionPosCmdValidated"})}}),e.addTransition({iEvent:e._pathElem,iInitialState:t,iFinalState:t,iCondition:function(t){var i=t[0].pathElement;return e._selectedObject.push(i),!0},iAction:function(t){e.setButtonEnableFlag({btnId:"Ok",enableFlag:!0}),t(),e._addAllSelToHSO()}})},_addAllSelToHSO:function(){this._selectedObject.forEach(e=>{this.addInHSO({path:e},!0)})}})}),define("DS/DMUSection/DMUSelectiveSectionContextCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUControls/EXPLevelSelector","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","i18n!DS/DMUSection/assets/nls/DMUSection"],function(e,t,i,n,o,a,r,l){"use strict";return e.extend({init:function(e){this._parent(e,"exclusive",!0)},_beginExecute:function(){var e=r.getReviewContext({viewer:this.getFrameWindow().getViewer()});e&&(this._section=e.getDMUObjectFromPathElement(a._items[0].pathElement),this._pathElementAgentForSection=null,this._firstSelectedPathElement=null,this._selectedPathElement=null,this._pathElementAgentForSection=new i({agentId:"_pathElementAgentForSection",frameWindow:this._frmWindow,pickingMode:"primHybrid",prePickingMode:"primHybrid",valuedFromCSO:!0,saveToCSO:!1,multiAcquisition:!0,multiAcquisitionCtrl:!0,acceptedGeometries:[]})),this._parent()},cancelExecute:function(){this._parent(),this._pathElementAgentForSection=null,this._levelSelector&&this._levelSelector.clean(),this._firstSelectedPathElement=null,this._selectedPathElement=null,this._section=null,this._viewer.render(),this.restoreDefaultController(),this.done()},buildGraph:function(){this.changeDefaultController(),this._beginExecute();var e=this.createInitialState("initialState"),i=this.getFinalState(),a=this;this.setEnterStateAction(e,function(){this.sendNotify("info",l.notifyobjectselection)}),this.setExitStateAction(e,function(){this.cleanNotify()});var r={iEvent:this._pathElementAgentForSection,iInitialState:e,iFinalState:e,iCondition:function(e){var i=!1;if(e&&void 0!==e[0].pathElement.getLastElement().sgNode){var n=e[0].pathElement;if(void 0!==n){var o=t.getLastReference(n);if(o){var a=o.getLastElement();t.isReference(a)&&(i=!0)}}}return i},iAction:function(e,i){a._levelSelector&&a._levelSelector.clean(),a._firstSelectedPathElement=i[0].pathElement.clone(),a._selectedPathElement=i[0].pathElement.clone();var r=function(){var e,t=[];t.push(a._selectedPathElement),(e=t)&&a._section&&(a._section.setObjects(e),n.addInCSO(a._section,!1),a._section._viewer.render())};a._levelSelector=new o({iFrameWindow:this._frmWindow,iGetPathElementCB:function(){return t.getLastReference(a._firstSelectedPathElement)},iFilterNodeCB:function(e){return t.isReference(e)},iGet3DPositionCB:function(){var e=a._selectedPathElement.getBoundingSphere(a._viewer).center;return e.x=e.x-60,e.y=e.y-60,e},iOnLevelSelectCB:function(e){a._selectedPathElement=e.pathElement.clone(),r()}}),r(),e&&e()}};this.addTransition(r),this.addEmptySelectionTransition(e,i,function(e){this._section._itfContextbar&&this._section._itfContextbar.clear(),this.cancel(),e&&e()})}})}),define("DS/DMUSection/DMULockUnlockSection",["DS/DMUSection/DMUClippingCmd"],function(e){"use strict";return e}),define("DS/DMUSection/DMUSectionSecondaryViewerlImpl",["UWA/Class","DS/DMUSection/DMUSectionSecondaryViewer"],function(e,t){"use strict";return e.extend({init:function(e){var i=null;this.isBuilt=function(){return null!==i},this.build=function(){return i||(i=new t(e)),i},this.isShow=function(){return!!i&&i.isShow()},this.show=function(){i&&i.show()},this.noShow=function(){i&&i.noShow()},this.render=function(){i&&i.render()},this.clear=function(){i&&(i.clear(),i=null)},this.getViewer=function(){if(i)return i.getViewer()}}})}),define("DS/DMUSection/DMUClippingContextCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUMeasurable/DMUSectionPosService","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUPlaySection/DMUToolsSection","DS/DMUPlaySection/DMUClippingService","DS/DMUPlaySection/DMUStoreyNavigratorController","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUSection/DMUSectionSecondaryViewerlImpl"],function(e,t,i,n,o,a,r,l,s,c){"use strict";var d,g;let u={ClippingDefPlane:["ClippingPlaneWithObjectsHdr","ResetClippingPlaneHdr"],ClippingDefSlice:["ClippingSliceWithObjectsHdr","ResetClippingSliceHdr"],ClippingDefBox:["ClippingBoxWithObjectsHdr","ResetClippingBoxHdr"],ClippingPosition:["ClippingNormalToXHdr","ClippingNormalToYHdr","ClippingNormalToZHdr","ClippingNormalToZHdr","ClippingNormalUserHdr","ClippingReverseHdr"]};var p=e.extend({init:function(e){var t=e||{};if(this._bCmdState=!1,t.mode="DMUSectionDeleteSectionHdr"!==t.ID?"shared":"exclusive",this._parent(t),t&&(this._executionContext=t.executionContext),!this._viewer){if(this._executionContext){let e=this._executionContext.getComponent("Viewer");e&&e.getViewer&&(this._viewer=e.getViewer())}this._viewer||(this._viewer=this.getFrameWindow().getViewer())}this.allowManipulation=function(e){return"Section"===e.object||void 0},this.id=this._id?this._id:this.getId()},beginExecute:function(){var e=this,d=this._viewer?this._viewer:this.getFrameWindow().getViewer();if(function(t){var i="DMUClippingEditionHdr"===t;if("DMUExitClippingEditionHdr"!==t&&!i)return!1;if(!e._executionContext||"DMUClippingEditionHdr"===t){var n=o.getEditCmd(d);n&&(i?n.begin():n.cancel())}return!0}(this.id))this.done();else{var g,u=function(e,t,a){if(e.setStoreyNavigatorVisu(!1),a){var r=e.getAttribute("fSliceOffset"),s=e.getAttribute("mPlaneReferential"),c=function(){return"DMUTemporaryBag"!==e.getParent().getType()},g=function(){return l.getContextViewer({viewer:d})};if(!r&&"NormalMode"!==t){var u=n.computeBoundingSphere(d,void 0,c,g),p=o.computeClippingSlice(u,s);if(p||!isNaN(p))r=p;else{let e=n.computeBoundingBox(d,void 0,c,g);var h=i.computePlaneDim(e,s,!1,!0);r=isNaN(h.fSliceOffset)?u.radius:h.fSliceOffset}e.setAttribute("fSliceOffset",r)}}e.getNode().clean(),t!==e.getAttribute("sPlaneBoxMode")&&(e._lastClippingDefHdr=void 0),t&&(localStorage.setItem("DMUClippingBoxMode",t),e.setAttribute("sPlaneBoxMode",t));let m=e.getNode();if(m){let e=m.getRobot();e||(m.initClippingRobot(),e=m.getRobot()),e&&e.updateRobotPos()}e.refreshNode(),d.render()},p=t.get();if(1===p.length){var h=l.getReviewContext({viewer:d});if(h){var m=h.getDMUObjectFromPathElement(p[0].pathElement);if(m||"DMUExitClippingEditionHdr"===this.id){switch(this.id){case"DMUClippingDisplayModePlaneHdr":u(m,"NormalMode");break;case"DMUClippingDisplayModeSliceHdr":u(m,"SliceMode",!0),S(m);break;case"DMUClippingDisplayModeBoxHdr":u(m,"BoxMode",!0),S(m);break;case"DMUClippingDisplayModeStoreyHdr":!function(t){let i=t;var n=function(t){var n=t||i._storeyNavigatorcntroller;if(!n){let e="NormalMode";return localStorage.setItem("DMUClippingBoxMode",e),i.setAttribute("sPlaneBoxMode",e),void a.resetClipping(i,d)}let r=o.getStoreyinfoOnSlide(e._viewer);i.setStoreyNavigatorVisu(!0);let l=i.getNode();l&&l.getRobot()&&l.cleanClippingRobot(),r&&n.SetCurrentStorey(r);let s=n.GetPosition3D();i.updateClippingPosAndOrientation(s,!1,!0),o.setStoreyinfoOnSlide(e._viewer,n.GetCurrentStorey()),d.render()};let s="ConstructionItemMode";if(i&&i.getAttribute("sPlaneBoxMode")!==s){i.getNode().clean(),i.setAttribute("sPlaneBoxMode",s);var c=l.getContextViewer({viewer:d});if(i._storeyNavigatorcntroller)n();else{let e=o.getBuildingRootData(d);i._storeyNavigatorcntroller=r.getDMUStoreyNavigratorController({context:c,getBuidlingRootID:()=>e?e.ID:void 0,storyeRetrivalSuccessCB:e=>{n(e)},storyeRetrivalFailCB:()=>{localStorage.setItem("DMUClippingBoxMode","NormalMode"),i.setAttribute("sPlaneBoxMode","NormalMode"),a.resetClipping(i,d)}})}}}(m),S(m);break;case"DMUClippinPlaneWithObjectsHdr":case"DMUClippinSliceWithObjectsHdr":case"DMUClippinBoxWithObjectsHdr":break;case"DMUResetClippingPlaneHdr":case"DMUResetClippingSliceHdr":case"DMUResetClippingBoxHdr":m._lastClippingDefHdr="Reset",a.resetClipping(m,d);break;case"DMUClippingNormalToXHdr":m._lastPoshdr=this.id,m.sectionToX();break;case"DMUClippingNormalToYHdr":m._lastPoshdr=this.id,m.sectionToY();break;case"DMUClippingNormalToZHdr":m._lastPoshdr=this.id,m.sectionToZ();break;case"DMUClippingReverseHdr":m._lastPoshdr=this.id,m.sectionFlip();break;case"DMUContourViewerHdr":(g=m)._iViewerSecondaryWindow?g._iViewerSecondaryWindow.isBuilt()?g._iViewerSecondaryWindow.isShow()?g._iViewerSecondaryWindow.noShow():(g._iViewerSecondaryWindow.show(),g.manageCurvesAndHatching({computeCurves:!0})):g._iViewerSecondaryWindow.build():(g._iViewerSecondaryWindow=new c(g),g._iViewerSecondaryWindow&&g._iViewerSecondaryWindow.build());break;case"DMUAlignViewHdr":m&&m.sectionViewpoint();break;case"DMUSectionDeleteSectionHdr":m.getParent().removeDMUObjects?m.getParent().removeDMUObjects([m]):m.getParent().getCurrentSlide().removeDMUObject(m)}h.getCurrentSessionMarkup()&&h.getCurrentSessionMarkup().isVisible()&&h.getCurrentSessionMarkup().getCurrentSlide()&&h.getCurrentSessionMarkup().getCurrentSlide().fireEvent("onSlidePreviewRefreshRequired",{dmuObject:h.getCurrentSessionMarkup().getCurrentSlide()})}}}this.done()}function S(e){if(e._iViewerSecondaryWindow&&e._iViewerSecondaryWindow.isShow()){var t=s.getCommand("DMUContourViewerHdr","Default");t&&(t.begin(),t._bCmdState=!1)}}},getState:function(){return this._bCmdState},setState:function(e){this._bCmdState=e}});return p.executeContextualBarCmd=function(e,i){if(!d&&i.executionContext&&(d=i.executionContext),i&&i.args&&i.args.Value){let e=0;var n=setInterval(function(){e++;var o,a=t.get();if(1===a.length){if(!g){let e=d.getComponent("Viewer");e&&e.getViewer&&(g=e.getViewer())}if(g){var r=l.getReviewContext({viewer:g});if(r){var c=r.getDMUObjectFromPathElement(a[0].pathElement);c&&c.getType&&"DMUClipping"===c.getType()&&(o=!0)}}}if(o){let t=s.getCommand(i.args.Value,d);t&&t.begin?(t.begin(),clearInterval(n)):e>20&&clearInterval(n)}else clearInterval(n)},100)}if(i&&i.args&&i.args.Value&&i.args.ID){let e=i.args.ID,t=u[e],n=i.args.Value.replace("DMU","");t&&d.getComponent(WAfrStandardComponentKey.HandlerComponent).setRadioItemState({id:n,radioId:e,state:!1})}e&&e()},p.executeContextualBarCmdUnset=function(e){e&&e()},p}),define("DS/DMUSection/DMUClippingBaseCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUSwitchRepService","DS/DMUBaseExperience/EXPUtils","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/Selection/CSOManager","DS/Visualization/ThreeJS_DS","DS/DMUSection/DMUClippingPrecisePosCmd","DS/DMUPlaySection/DMUClippingService","DS/DMUControls/EXPNotify"],function(e,t,i,n,o,a,r,l,s,c,d,g){"use strict";return e.extend({init:function(e,t,i){this._parent(e,t,i),this._context=e.context,this.sendNotify||(this.sendNotify=function(e,t,i){return this._notification&&this._notification.destroy(),this._notification=new g({body:this._frmWindow.getUIFrame(),type:e,notificationType:"HelpNotification",message:t,duration:i,autoHide:"number"==typeof i&&i>0}),this._notification}),a.setAuthoringFeatureTypes("Section")},checkAndCreateReviewContext:async function(){if(!a.getReviewContext({viewer:this.getFrameWindow().getViewer()})){let e=a.getContextViewer({viewer:this.getFrameWindow().getViewer()});await r.createReviewContext({context:e})}},begin:function(){if(!this._isRunning){var e=o.getCommand(o.getCurrentCmdId(this._ctx),this._ctx),t=e&&e.getRequestedCommandMode?e.getRequestedCommandMode({cmd:"Section"}):"exclusive";this._mode="shared"===t?"shared":"exclusive"}this._parent.apply(this,arguments)},setCommandMode:function(e){this._sectionCommandMode=void 0,"ProgressiveVisuLoading"===e&&(this._sectionCommandMode="ProgressiveVisuLoading")},_beginExecute:function(){var e=this;if(e.csoList=void 0,this._viewer.currentViewpoint.setDefaultController(!1,"FLY_WALK"),e.clippingPrecisePosCmd=void 0,e.isInCreation){let r=localStorage.getItem("DMUClippingBoxMode")||"NormalMode";e.clippingPreSelectedObj=void 0;let d=l.get();if(d&&d.length&&(e.clippingPreSelectedObj=[],d.forEach(function(t){var i=t.pathElement;i&&e.clippingPreSelectedObj.push(i)})),"NormalMode"===r){if(function(){var n,o,r=e._viewer,s=l.get(),c=s.length,d=[],g=!1;if(c){var u=a.getContextViewer({viewer:e._viewer});for(u.getController&&(e._viewerController=u.getController()),e._switchService||(e._switchService=new i({viewer:r})),n=0;n<c;n++){var p,h,m=[];if(h=t.isOOCTileSetNodeInPath(s[n].pathElement),s[n].pathElement&&s[n].pathElement.getLastElement())if(s[n].pathElement.getLastElement().sgNode||t.isPathToAxisSystem(s[n].pathElement)||h){if(!h)if(e._switchService.retriveNodesFromPath(s[n].pathElement,m),m&&m.length)for(o=0;o<m.length;o++)p=m[o],s[n].pathElement&&s[n].pathElement.getLastElement&&(e._viewerController.hasMeshInRAM(t.getNodeID(p))&&"thumbnail"!==e._viewerController.getLoadedStream(p)||(d.push(s[n]),g=!0));else d.push(s[n]),g=!0}else d.push(s[n]),g=!0;else d.push(s[n]),g=!0}}g&&d.length&&d.forEach(function(e){l.remove(e)})}(),l.get().length){e.clippingPreSelectedObj=[],e.clippingPrecisePosCmd=o.getCommand("DMUSectionPreSelectPrecisePosHdr",e._context),e.clippingPrecisePosCmd||(e.clippingPrecisePosCmd=new c({context:this._context,ID:"DMUSectionPreSelectPrecisePosHdr",isEnabled:!0})),e.csoList=[];l.get().forEach(function(t){var i;t.normal&&t.tangent&&t.position||(i=function(t){if(t&&t.event){var i=t.event.currentPosition?t.event.currentPosition:t.event.from?t.event.from[0].currentPosition:new s.Vector2(0,0),n=i?e._viewer.getMousePosition(i):void 0;return n?e._viewer.pick(n,"primHybrid",!0):void 0}}(t)),e.csoList.push({pathElement:t.pathElement?t.pathElement.clone():void 0,position:t.position?t.position.clone():i&&i.position?i.position:void 0,normal:t.normal?t.normal.clone():i&&i.normal?i.normal:void 0,tangent:t.tangent?t.tangent.clone():i&&i.tangent?i.tangent.clone():void 0})})}}else e.clippingPrecisePosCmd=void 0;e._bProfiling&&window.console&&window.console.profile&&window.console.profile("Section"),n._sendUsageProbe("command","Section")}this.beginCB(void 0,!0),this._parent()},buildGraph:function(){this.changeDefaultController(),this._beginExecute();var e=this.createInitialState("initialState"),t=this.getFinalState(),i=this;this.setEnterStateAction(e,this._performCallback),this.addEmptySelectionTransition(e,t,function(e){e&&function(){let e=l.get();var t=!0;let n=d.retriveClippingObjsFromSlide(i._viewer,!0);if(n&&n.length)for(var o=0;o<n.length;o++){let e=n[o].getNode().getRobot();if(e&&e.isManipulationOnGo&&e.isManipulationOnGo()){t=!1;break}}if(e&&e.length)for(var a=0;a<e.length;a++){let i=e[a];if(i&&i.pathElement){var r=i.pathElement.getLastElement();if(r&&r.isClippingNode&&r.isClippingNode()){t=!1;break}}}return t}()&&(i.cancel(),e())})},_destroy:function(){this.clearEvents(),this._parent()}})}),define("DS/DMUSection/DMUEditClippingCmd",["DS/DMUSection/DMUClippingBaseCmd","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/DMUToolsClipping","DS/CATWebUXPreferences/DMUClippingPrefService","DS/DMUPlaySection/DMUClippingService","DS/Visualization/ThreeJS_DS","DS/DMUPlaySection/DMUToolsSection"],function(e,t,i,n,o,a,r){"use strict";return e.extend({init:function(e){this._parent(e,"shared",!0),!this._id&&e.ID&&(this._id=e.ID);var i=this;this.executionContext&&(this._isRunning=!1),this._keepDefaultController=!0,this.options=e;let n=e.args;if(e.args){let e=Object.keys(n),t=Object.values(n);this._arguments=[];for(let i=0;i<e.length-1;i++)this._arguments.push({ID:e[i],Value:t[i]})}var a;"ProgressiveVisuLoading"===this._arguments[0].ID&&(this._sectionCommandMode="ProgressiveVisuLoading"),this._appTypeFromArg=i._arguments.length?i._arguments[0].ID:"",i.executionContext&&i._arguments.length&&i._arguments[0].Value&&(this._appTypeFromArg=i._arguments[0].Value);var l,s=t.getContextViewer({viewer:this.getFrameWindow().getViewer()}),c=[];i.beginCB=function(e,n){let r;s&&s.setRobotVisibility&&(a=s.isRobotVisible())&&s.setRobotVisibility(!1),i._eventController||(i._eventController=t.getEventsController({viewer:i._viewer})),i._eventController.fireEvent("onEditCommandStart"),(r=e?[e]:o.retriveClippingObjsFromSlide(i._viewer,!0))&&r.forEach(function(e){if(e){e.updateAppType&&e.updateAppType(i._appTypeFromArg||i._arguments[0].ID);var t=e.getNode();if(t){let i=e._sID?e._sID:"0";t.setPickingInManipulationModeForLineTraslation(!1),e.isSectionDisplayed()&&(n||e.isInEdition())&&t.initClippingRobot(c[i]);let o=t.getRobot();o&&(c[i]=o._getRulerOriginPos())}}})},i.endExecuteCB=function(){void 0!==a&&s&&s.setRobotVisibility&&s.setRobotVisibility(a),r.cleanClippingVisu(i._viewer)},i.resumeExecute=function(){let e=o.retriveClippingObjsFromSlide(i._viewer,!0);e&&e.length&&e.forEach(function(e){e&&e.isConstructionItemMode()&&e.setStoreyNavigatorVisu(!0)}),this.executionContext&&(this._isRunning=!0),void 0!==l&&l===i._viewer.getVisibleSpace()?i.beginCB():(i.cancel(),c=[])},i.pauseExecute=function(){this.executionContext&&(this._isRunning=!1);let e=o.retriveClippingObjsFromSlide(i._viewer,!0);e&&e.length&&e.forEach(function(t){if(t){t.isConstructionItemMode()&&t.setStoreyNavigatorVisu(!1);let i,n=t._sID?t._sID:"0",o=e[0].getNode();o&&(i=o.getRobot()),i&&(c[n]=i._getRulerOriginPos())}}),i.endExecuteCB(),l=i._viewer.getVisibleSpace(),i.done()},i.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},i.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},i._destroy=function(){!function(){let e=o.retriveClippingObjsFromSlide(i._viewer,!0);e&&e.forEach(function(e){if(e){var t=e.getNode();t&&t.cleanClippingRobot()}})}(),Object.getPrototypeOf(i)._destroy.apply(i,arguments)},i._eventController||(i._eventController=t.getEventsController({viewer:i._viewer})),i._eventController&&(i.initClippingVisuCb=i._eventController.addEvent("initClippingVisu",e=>{i.beginCB(e)}))},setCommandMode:function(e){this._parent(e)},_performCallback:async function(){var e=this;await this.checkAndCreateReviewContext();var l={getDefaultValues:async function(){var o=e._appTypeFromArg?e._appTypeFromArg:e._arguments.length?e._arguments[0].ID:"";await n.readClippingPref();var l=function(){return t.getContextViewer({viewer:e._viewer})};let s,c="NormalMode",d=localStorage.getItem("DMUClippingBoxMode");"3dPlay"!==o&&((s=r.isClippingEligibleForStoreyMode(e._viewer,l()))?(c="ConstructionItemMode",e.clippingPreSelectedObj=void 0):d&&(c=d));let g,u=i.computeBoundingBox(e._viewer,e.clippingPreSelectedObj,function(){return!0},l);if("ConstructionItemMode"===c&&u&&u.min&&u.max&&(e.clippingPreSelectedObj=void 0,g=r.computeSectionPlaneReferencial(e._viewer,u,!1,"z"))){var p=(new a.Plane).setFromNormalAndCoplanarPoint(new a.Vector3(0,0,1),new a.Vector3(0,0,0));g.setPosition(p.projectPoint(g.getPosition()))}let h=e.clippingPrecisePosCmd;return{appType:o,setInEdit:!0,isClipping:!0,iDoNotChkLockUnlockStatus:!0,sectionCommandMode:e._sectionCommandMode,planeReferential:g,buildingRoot:s,precisePosCmd:h,csoList:e.csoList,bbox:u,boxMode:c,isCustomCappingColor:n.capping.isCustomColor(),isCustomContourColor:n.contour.isCustomColor(),cappingColor:n.capping.getColorToSet(),lineStyleColor:n.contour.getColorToSet(),lineStyleThicknessIndex:n.contour.getThicknessToSet(),bDisplayPermanently:n.sectionPlane.getDisplayStatus(),fillStyleColor:n.sectionPlane.getColorToSet(),opacity:n.sectionPlane.getOpacityVal(),planeDir:n.planeNormalDir.getDirValue(),isHatchingDisplayed:n.hatching.getDisplayStatus(),hatchingColor:n.hatching.getColorToSet(),hatchingThickness:n.hatching.getThicknessToSet(),hatchingAnglesMode:n.hatching.getAnglesMode(),hatchingSingleAngleValue:n.hatching.getSingleAngleToSet(),hatchingPitchValue:n.hatching.getPitchToSet()}}};o.editClipping(e._viewer,l),e.clippingPrecisePosCmd&&e.clippingPrecisePosCmd.isRunning()||i.getClippingCmd(t.getContextViewer({viewer:e._viewer})).setState(!0)},_beginExecute:function(){this.isInCreation=!1;let e=o.retriveClippingObjsFromSlide(this._viewer,!0);e&&0!==e.length||(this.isInCreation=!0),this._parent(),this.executionContext&&(this._isRunning=!0)},cancelExecute:function(){this._parent(),o.editClipping(this._viewer,{},!0),this.endExecuteCB(),this.clippingPreSelectedObj=void 0,this._viewer.currentViewpoint.setDefaultController(!0,"FLY_WALK");var e=o.retriveCurrentReview(this._viewer);if(e&&e.getCurrentSlide){var i=e.getCurrentSlide();i&&i.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:i})}this.executionContext&&(this._isRunning=!1);let n=this._eventController;n||(n=t.giveEventsController({viewer:this._viewer})),n&&n.fireEvent("onSaveRequested"),this.restoreDefaultController()},clearEvents:function(){this.initClippingVisuCb&&(this._eventController||(this._eventController=t.giveEventsController({viewer:this._viewer})),this._eventController&&this._eventController.removeEvent(this.initClippingVisuCb))}})}),define("DS/DMUSection/DMUCreateSectionCmd",["DS/DMUSection/DMUEditClippingCmd"],function(e){"use strict";return e});