define("DS/DELWebViewerProxyManager/ProxyManager",["DS/ApplicationFrame/CommandsManager","DS/DELWebViewerPerformaceLogger/PerformaceLogger","DS/DELWebViewerUtils/Utils","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","DS/DELWebViewerUtils/CustomCodes"],function(e,t,r,n,i){"use strict";return function(r,o,a,u){var l=u.getOption("logger"),s=u.getOption("executionContext"),d=r.getInstance("BuildUpBehavior"),c=u.getOption("eventCollection").getViewerCtrlEventHnd(),g=r.getInstance("WorkInstructionBehavior"),f=o.getHideShowBehavior(),h=function(e,t,r){var n={};return n.input=e||{},r?n.error=new i(r):n.output=t?UWA.is(t,"array")?t:[t]:[],n},p=u.getOption("mappingKeys");return{addRoots:function(t){return l.debug("ProxyManager::addRoots method invoked with parameters : ",t),new UWA.Promise(function(r,n){var i=[];t.objects.forEach(function(e){i.push(new UWA.Promise(function(t){var r=o.subscribe("onRootAdded",function(n){n&&n.idPath&&UWA.Array.equals(n.idPath,e.path)&&(o.unSubscribe(r),t())})}))}),UWA.Promise.all(i).then(function(n){if(UWA.is(t.fitAll,"boolean")&&t.fitAll)if(s){let e=s.getComponent(WAfrStandardComponentKey.HandlerComponent);e&&e.hasHandler("VisuReframeViewCmd")&&e.executeHandler({id:"VisuReframeViewCmd"})}else{let t=e.getCommand("VisuReframeView");t?t.beginExecute():l.log("Reframe Command is not available, unable to do reframe")}r(h(t,n))}).fail(function(e){n(h(t,null,e))});let a=!UWA.is(t.reframe,"boolean")||t.reframe;o.setAutomaticReframePolicy(a),o.addRoots({objects:t.objects},t.dispatch,t.displayNotif)})},setProcess:function(e){var t=this,r=e?Object.assign({},e):{},n=[],i=!!e.defaultShow,s=function(){return(l=UWA.Promise.resolve(),Array.isArray(r.installPath)&&r.installPath.length>0&&(l=a.getInstallContext(r).then(function(e){Object.assign(r,e)})),l).then(function(){let e,t=r.installPath||[],i=t.length>0?t:UWA.is(r.mfgId)?[r.mfgId]:[];return i.length>0?(n.push(i),r.resourceId&&n.push([r.resourceId]),r.predecessors&&r.predecessors.length>0&&r.predecessors.forEach(function(e){n.push(e)}),e=n):e=UWA.Promise.reject(u.getNLSValue("Error.InvalidInput.Message")),e}).then(()=>UWA.Promise.all([function(){let e=[];["noDependecy","successors"].forEach(t=>{let n=r[t];Array.isArray(n)&&n.forEach(t=>{e.push({path:t,[p.GRAPHICPROPERTIES.VISIBILITY]:!1,[p.GRAPHICPROPERTIES.VISIBILITYFREE]:!0})})}),e.length>0&&o.setGraphicProperties({graphicProperties:e},p.SCENEGRAPHKEYS.PRIVATE).then(o.render)}(),new UWA.Promise(function(e,t){i?e():o.setGraphicProperties({graphicProperties:n.map(e=>({path:e,visibility:!1}))},p.SCENEGRAPHKEYS.BUILDUP).then(function(){o.render(),e()}).fail(t)}),function(){let r=!UWA.is(e.reframe,"boolean")||e.reframe;var i=[];return n.forEach(e=>{o.isRegistered([e[0]])||i.push({path:e})}),i.length>0?t.addRoots({objects:i,reframe:!1,fitAll:r}):UWA.Promise.resolve()}()]));var l},c=function(){a.getDataManager().set("process",r)},g=function(){return new UWA.Promise(function(t,n){u.getOption("viewerType")<=0?n(h(e,null,u.getNLSValue("Error.InvalidViewerType.Message"))):(l.debug("ProxyManager::setProcess method invoked with parameters : ",e),l.info(`********** SetProcess Started (process-${JSON.stringify(r)}) **************`),r.processId?(c(),UWA.Promise.all([s(),d.initializeBuildup(r)]).then(function(){c(),l.info(`********** SetProcess Completed (process-${JSON.stringify(r)} **************`),t(h(e))}).fail(function(t){l.error("setProcess failed due to -",t),n(h(e,null,t))})):n(h(e,null,u.getNLSValue("Error.InvalidInput.Message"))))})};return g()},initializeBuildup:function(e){return new UWA.Promise(function(t,r){d?d.initializeBuildup(e).then(function(){t(h(e))}).catch(function(t){r(h(e,null,t))}):r(h(e,null,u.getNLSValue("Error.BuildUpCntrlNotInit.Message")))})},empty:function(){return new UWA.Promise(function(e,t){o.removeRoots({pids:[]}).then(function(){r.reset(),a.reset(),o.resetGraphicProperties(),o.resetCameraOrientation(),o.render(),e(h())}).fail(function(e){l.error("empty failed due to -",e),t(h(null,null,e))})})},refresh:function(){var e,t=arguments[0];return 1!==u.getOption("viewerType")&&2!==u.getOption("viewerType")||(e=a.getDataManager().get("process")),r.reset(),o.refresh(),t?UWA.Promise.resolve(h()):e?this.setProcess(e):UWA.Promise.resolve(h())},removeRoots:function(e){return l.debug("ProxyManager::removeRoots method invoked with parameters : ",e),new UWA.Promise(function(t,r){o.removeRoots(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("removeRoots failed due to -",t),r(h(e,null,t))})})},setOperation:function(e){return l.debug("ProxyManager::setOperation event invoked with parameters : ",e),new UWA.Promise(function(t,r){d?(g&&o.getMode()===p.VIEWERMODES.WORKINSTRUCTIONS&&g.clean(),d.applyBuildUp(e).then(function(r){l.info("setOperation completed for given operation -",e),t(h(e,r))}).fail(function(t){l.error("setOperation failed due to -",t),r(h(e,null,t))})):r(u.getNLSValue("Error.BuildUpCntrlNotInit.Message"))})},removeBuildUp:function(){return l.warn("removeBuildUp is deprecated, please use remove operation instead"),new UWA.Promise(function(e){d.removeBuildUp(),e()})},removeOperation:async function(){d&&d.removeBuildUp(),g&&await g.reset()},setMode:function(e){return l.debug("ProxyManager::setMode method invoked with parameters : ",e),new UWA.Promise(function(t,r){var n,i=o.getMode()===p.VIEWERMODES.WORKINSTRUCTIONS,a=u.getOption("eventCollection").getViewerCtrlEventHnd();if(UWA.is(e,"object")&&e.mode){switch(e.mode){case p.VIEWERMODES.WORKINSTRUCTIONS:!i&&function(){let e=!1;return d&&(e=d.isBuildUpApplied()),e}()&&(g?g.show():(l.error("WorkInstruction Behavior is not available, check whether proper viewer type is provided during initialization"),n=u.getNLSValue("Error.WorkInstModeNotActive.Message")));break;case p.VIEWERMODES.BUILDUP:i&&g&&g.reset(),d&&d.applyCurrentBuildUp();break;default:n=u.getNLSValue("Error.InvalidViewerMode.Message")}n?r(h(e,null,n)):(u.setOption(p.OPTIONS.VIEWERMODE,e.mode),a.publish(a.events.onSetModeComplete,{mode:e.mode}),t(h(e)))}else r(h(e,null,u.getNLSValue("Error.InvalidInput.Message")))})},getMode:function(){return o.getMode()},getViewerModes:function(){return p.VIEWERMODES},getBuildUpGlobalSettings:async function(e){let t,r=a.getInstance("BuildUpBehaviorModelService");try{if(!r)throw new Error(u.getNLSValue("Error.BuildUpCntrlNotInit.Message"));t=h(e,r.getBuildUpGlobalSettings(e))}catch(t){throw new Error(h(e,null,t))}return t},setBuildUpGlobalSettings:async function(e){let t,r=a.getInstance("BuildUpBehaviorModelService");try{if(!r)throw new Error(u.getNLSValue("Error.BuildUpCntrlNotInit.Message"));t=h(e,r.setBuildUpGlobalSettings(e))}catch(t){throw new Error(h(e,null,t))}return t},getBuildUpGlobalContent:async function(e){let t;try{if(!d)throw new Error(u.getNLSValue("Error.BuildUpCntrlNotInit.Message"));t=h(e,await d.getBuildUpGlobalContent(e))}catch(t){throw new Error(h(e,null,t))}return t},selectNode:function(e){return e=e||{},l.debug("ProxyManager::selectNode event invoked with parameters : ",e),new UWA.Promise(function(t,r){o.selectNode(UWA.merge(e,{select:!0})).then(function(r){t(h(e,r))}).fail(function(t){l.error("Select Node failed due to : ",t),r(h(e,null,t))})})},unSelectNode:function(e){return e=e||{},l.debug("ProxyManager::unSelectNode event invoked with parameters : ",e),new UWA.Promise(function(t,r){o.selectNode(UWA.merge(e,{select:!1})).then(function(r){t(h(e,r))}).fail(function(t){l.error("ProxyManager:: Unselect Node failed due to : ",t),r(h(e,null,t))})})},highlightNode:function(e){return e=e?UWA.merge(e,{highlight:!0}):{},l.debug("ProxyManager::highlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,r){c.publish(c.events.highlightNode,e),o.highlightNode(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("Highlight Node failed due to : ",t),r(h(e,null,t))})})},unHighlightNode:function(e){return e=e?UWA.merge(e,{highlight:!1}):{},l.debug("ProxyManager::unHighlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,r){c.publish(c.events.unHighlightNode,e),o.highlightNode(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("Unhighlight Node failed due to : ",t),r(h(e,null,t))})})},preHighlightNode:function(e){return e=e||{},l.debug("ProxyManager::preHighlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,r){o.preHighlightNode(UWA.merge(e,{highlight:!0})).then(function(r){t(h(e,r))}).fail(function(t){l.error("PreHighlight Node failed due to : ",t),r(h(e,null,t))})})},unPreHighlightNode:function(e){return e=e||{},l.debug("ProxyManager::unPreHighlightNode API invoked with parameters : ",e),new UWA.Promise(function(t,r){o.preHighlightNode(UWA.merge(e,{highlight:!1})).then(function(r){t(h(e,r))}).fail(function(t){l.error("UnPreHighlight Node failed due to : ",t),r(h(e,null,t))})})},setGraphicProperties:function(e){return l.debug("ProxyManager::setGraphicProperties method invoked with parameters :",e),new UWA.Promise(function(r,n){t.markStart("DELWebViewerSetGraphicProperties");let i=e||{};i.force=!0,o.setGraphicProperties(i,p.SCENEGRAPHKEYS.PUBLIC).then(function(n){o.render(),t.markEnd("DELWebViewerSetGraphicProperties","Time taken to setGraphicProperties "),r(h(e,n))}).fail(function(t){l.error("setGraphicProperties failed due to : ",t),n(h(e,null,t))})})},removeGraphicProperties:function(e){return l.debug("ProxyManager::removeGraphicProperties method invoked with parameters : ",e),new UWA.Promise(function(t,r){o.removeGraphicProperties(e,p.SCENEGRAPHKEYS.PUBLIC).then(function(r){o.render(),t(h(e,r))}).fail(function(t){l.error("removeGraphicProperties failed due to : ",t),r(h(e,null,t))})})},resetGraphicProperties:function(e){return new UWA.Promise(function(t){o.resetGraphicProperties(),(e=!UWA.is(e,"boolean")||e)&&o.render(),t(h({render:e}))})},getGraphicPropertiesEnum:function(){return o.getGraphicPropertiesEnum()},setReframe:function(e){return l.debug("ProxyManager::setReframe method invoked with parameters : ",e),new UWA.Promise(function(t,r){o.setReframe(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("setReframe failed due to : ",t),r(h(e,null,t))})})},reframeOn:async function(e){let t;try{l.debug("ProxyManager::reframeOn method invoked with parameters : ",JSON.stringify(e)),t=await o.reframeOn(e),h(e,t)}catch(t){throw l.debug(`ProxyManager::reframeOn method failed due to ${JSON.stringify(t)}`),new Error(h(e,null,t))}},highlightLinkedViews:function(e){return l.debug("ProxyManager::highlightLinkedViews method invoked with parameters : ",e),new UWA.Promise(function(t,r){g?g.highlightLinkedViews(e).then(function(r){t(h(e,r))}).fail(function(t){r(h(e,null,t))}):(l.error("highlightLinkedViews failed due to WorkInstruction behavior not found"),r(h(e,null,u.getNLSValue("Error.WorkInstModeNotActive.Message"))))})},setViewPoint:function(e){return l.debug("ProxyManager::setViewPoint event received with parameters :",e),new UWA.Promise(function(t,r){o.setViewPoint(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("setViewPoint failed due to ",t),r(h(e,null,t))})})},getCurrentView:function(){return l.debug("ProxyManager::getCurrentView method invoked"),new UWA.Promise(function(e,t){g?g.getCurrentView().then(function(t){e(h(null,t))}).fail(function(e){l.error("getCurrentView failed due to -",e),t(h(null,null,e))}):(l.error("getCurrentView failed due to WorkInstruction behavior not found"),t(h(null,null,u.getNLSValue("Error.WorkInstModeNotActive.Message"))))})},getViewPoint:function(){return l.debug("ProxyManager::getViewPoint event received with parameters :"),new UWA.Promise(function(e,t){o.getViewPoint().then(function(t){e(h(null,t))}).fail(function(e){l.error("getViewPoint failed due to -",e),t(h(null,null,e))})})},setCurrentView:function(e){return l.debug("ProxyManager::setCurrentView method invoked with parameters : ",e),new UWA.Promise(function(t,r){g?g.setCurrentView(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("setCurrentView failed due to -",t),r(h(e,null,t))}):(l.error("setCurrentView failed due to WorkInstruction behavior not found"),r(h(e,null,u.getNLSValue("Error.WorkInstModeNotActive.Message"))))})},getBoundingBox:function(e){return l.debug("ProxyManager::getBoundingBox event received with parameters :",e),new UWA.Promise(function(t,r){o.getBoundingBox(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("getBoundingBox failed due to -",t),r(h(e,null,t))})})},getPartPosition:function(e){return l.debug("ProxyManager::getPartPosition event received with parameters :",u),new UWA.Promise(function(t,r){d?d.getPartPosition(e).then(function(r){t(h(e,r))}).fail(function(t){l.error("getPartPosition failed due to -",t),r(h(e,null,t))}):r(h(e,null,u.getNLSValue("Error.BuildUpCntrlNotInit.Message")))})},displayOrientationViewer:function(e){return l.debug("ProxyManager::displayOrientationViewer event received with parameters :",e),new UWA.Promise(function(t,r){o.displayOrientationViewer(e).then(function(r){t(h({toShow:e,data:r}))}).fail(function(t){l.error("displayOrientationViewer failed due to -",t),r(h({toShow:e},null,t))})})},search:function(e){l.debug("ProxyManager::search method invoked with parameters :",e),o.search(e)},updateOptions:function(e){if(l.debug("ProxyManager::updateOptions method invoked with parameters :",e),u.setOptions(e),e&&e.viewerOptions&&e.viewerOptions.delviewer&&e.viewerOptions.delviewer.run_options){let t=e.viewerOptions.delviewer.run_options;for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.setSetting(e,t[e].value)}c.publish(c.events.onUpdateOptions,{data:e})},notifyRootVisibilityChange:function(e,t){o.getContext().getController().notifyRootVisibilityChange(e,t)},loadFTA:async function(e){let t=r.getInstance("FTABehavior");if(!t)throw new Error(h(e,null,u.getNLSValue("Error.InvalidViewerType.Message")));return h(e,await t.loadFTA(e))},removeFTA:async function(e){let t=r.getInstance("FTABehavior");if(!t)throw new Error(h(e,null,u.getNLSValue("Error.InvalidViewerType.Message")));return h(e,await t.removeFTA(e))},hideNode:async function(e){try{let t=await f.hideNode(e);h(e,t)}catch(t){throw new Error(h(e,null,t))}},showNode:async function(e){try{let t=await f.showNode(e);h(e,t)}catch(t){throw new Error(h(e,null,t))}},toggleNodeVisibility:async function(e){try{let t=await f.toggleNodeVisibility(e);h(e,t)}catch(t){throw new Error(h(e,null,t))}},resetHideShow:function(){f.reset()},getRIRPathsLeadingToReference:function(e){return o.getIdPathesLeadingToReference(e)},destroy:function(){l=d=g=h=p=null}}}});