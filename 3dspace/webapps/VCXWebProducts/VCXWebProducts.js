define("DS/VCXWebProducts/VCXCameraPlayModeCmd",["DS/ApplicationFrame/CommandCheckHeader"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{});var t=this;this.onStateChange(function(){var e=t.getFrameWindow()._experienceBase;if(e){var n=e.getManager("VCXVisuManager");n&&(t.getState()?n.setUpdateViewport(!0):n.setUpdateViewport(!1))}}),this.setState(!0)}})}),define("DS/VCXWebProducts/VCXMousePositionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/VCXWebVisu/VCXModifiablesAccess","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/VCXWebVisu/VCXVisuTools","DS/VCXWebSystem/VCXMathTools","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXWebSystem/VCXMeshServices","DS/SceneGraphNodes/FixedSizeArrowNode"],function(e,t,n,i,r,a,o,s,c,u,l){"use strict";return t.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){this._containDiv=e.createElement("div",{styles:{position:"absolute",paddingTop:"10px",paddingLeft:"20px",top:"0px",left:"0px",pointerEvents:"none","background-color":"aliceblue"}});var t=this.getFrameWindow().getUIFrame();this._containDiv.inject(t),this._token=i.addEvent(this.getFrameWindow().getViewer().div,"onPrimaryPointerMoveUnique",this.onPointerMove.bind(this))},endExecute:function(){i.removeEventFromToken(this._token),this._containDiv.remove()},onPointerMove:function(e){let t=e=>{e.setRenderPasses([p.getRenderList("VCXPre3DManipulators"),p.getRenderList("VCX3DManipulators")]),e.setFrustumCulled&&e.setFrustumCulled(!1),e.setShadow&&e.setShadow(!1,!1),e.setMirror&&e.setMirror(!1),e.exludeFromBounding&&e.exludeFromBounding(!0),e.setPickable(c.PICKTHROUGH),this._fbNode.addChild(e)},i=event.clientX,d=event.clientY,g=this.getFrameWindow()._experienceBase,C="x:"+i+" / y:"+d;this._containDiv.setStyle("top",d+"px"),this._containDiv.setStyle("left",i+"px");let h=this.getFrameWindow().getViewer(),p=g.getManager("VCXVisuManager");var m=h.getMousePosition(e.from[0].getCurrentPosition(h.div)),_=h.pick(m,"primHybrid",!0);if(this._fbNode||(this._fbNode=new s,h.addNode(this._fbNode)),this._fbNode.removeChildren(),_.path.length){let i=n.GetModifiableFromEvent(e,g);if(i){let e,n=!1,s=[];const d=new r.Ray;if(a.traverseAll(i,{processPathElement:({object:t})=>{e=t.getWorldMatrix(h)},filterPrimitiveGroup:({object:e})=>4===e.glType,filterPrimitive:({object:e})=>"primitive"===_.path[0].getLastElement().getType()&&_.path[0].getLastElement().getPrimitives()[0].isEqual(e),processTriangle:({object:i,index:a,parentObject:u})=>{if(i.points&&i.points.forEach(t=>{t.ray||(t.ray=new r.Ray,i.buffers.geometry.getVertexPosition(t.index,t.ray.origin),i.buffers.geometry.getVertexNormal(t.index,t.ray.direction),t.ray.direction.normalize(),t.ray.applyMatrix4(e))}),o.pointOnTriangle(_.position,i.points[0].ray,i.points[1].ray,i.points[2].ray,d)){let e=u.parentObject.parentObject.parentObject.parentObject.object.getLastElement(!0).id+"/"+u.parentObject.parentObject.parentObject.parentObject.index+"/"+u.parentObject.parentObject.parentObject.index+"/"+u.parentObject.parentObject.index+"/"+u.parentObject.index+"/"+u.index+"/"+a;s.push({path:e,triangle:i,intersection:d.clone()});let g=new l({name:"Intersection",arrowWidth:1,arrowLength:100,headLength:32,headWidthToHeightRatio:.4,color:new c.Color(1,1,0),pickable:!1});g.setMatrix(o.getMatrixFromOVz(d.origin,d.direction||new r.Vector3(1,0,0))),t(g),n=!0}},postProcessTriangle:()=>!n}),s.length){let e=s[0],n=Number.MAX_VALUE;s.forEach(t=>{let i=_.ray.origin.distanceTo(t.intersection.origin);i<n&&(n=i,e=t)});let i=e.triangle;C+="<BR>\r\n"+e.path,C+=":["+i.points[0].index+","+i.points[1].index+","+i.points[2].index+"]",i.points&&i.points.forEach((e,n)=>{let i=new l({name:e.index,arrowWidth:1,arrowLength:100,headLength:32,headWidthToHeightRatio:.4,color:new c.Color(0===n?1:0,1===n?1:0,2===n?1:0),pickable:!1});i.setMatrix(o.getMatrixFromOVz(e.ray.origin,e.ray.direction)),t(i)});let r=u.buildLineStripSet([i.points[0].ray.origin.x,i.points[0].ray.origin.y,i.points[0].ray.origin.z,i.points[1].ray.origin.x,i.points[1].ray.origin.y,i.points[1].ray.origin.z,i.points[2].ray.origin.x,i.points[2].ray.origin.y,i.points[2].ray.origin.z],[4],[0,1,2,0],null,2,null);t(r),h.render()}}}this._containDiv.setHTML(C)}})}),define("DS/VCXWebProducts/VCXShowAllCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),r=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence",!0),a=[],o=0;o<i.length;++o){(s=i[o].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()!==n.EVisState.Hidden||a.push(i[o]))}for(o=0;o<r.length;++o){var s;(s=r[o].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()!==n.EVisState.Hidden||a.push(r[o]))}if(0!==a.length){var c=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));c.ChangeVisibility(a,n.EVisState.Visible),e.getManager("VCXCommandManager").Push(c)}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXHideSelectionCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){this._hideSelection()},endExecute:function(){this._experienceBase=null},_hideSelection:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase;var t=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();this._hideElementsFromArray(t)},_hideElementsFromArray:function(e){if(Array.isArray(e)){for(var i,r=[],a=0;a<e.length;++a){var o=e[a].QueryInterface("VCXIVisibility");o&&((i=o.GetVisibility())!==n.EVisState.Visible&&void 0!==i||r.push(e[a]))}if(0!==r.length){var s=new t(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager"));s.ChangeVisibility(r,n.EVisState.Hidden),this._experienceBase.getManager("VCXCommandManager").Push(s)}}}})}),define("DS/VCXWebProducts/VCXPreviewPlayCmd",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return n.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){},execute:function(){this.onResume(function(){}),this.onPause(function(){})},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXPlayGuidedTourUI",["UWA/Class","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","i18n!DS/VCXWebProducts/assets/nls/VCXWebProducts","css!DS/VCXWebProducts/VCXWebProducts.css"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){this._modelEvent=new n,this.buttonsTooltipsStr={terminate:i.GuidedTourTerminateButton}},destroy:function(){this.terminateUI(),this.buttonsTooltipsStr=null,this._modelEvent=null},setplayGuidedTourUI:async function(e){var n=e._experienceBase.getManager("VCXGUIManager").getGUIServices();this.preHidingConfig=await n.hideDockingElements(e),e.getActionBar().hide(),this._setImmersiveUICustomization(!0),this.frmWindow=e;var i=this.frmWindow.getUIFrame();this._container=UWA.createElement("div",{html:"",class:"guidedTourGUI pauseOnClickCurtain atCmdLaunch paused"}),this._playPauseButton=UWA.createElement("div",{html:"",class:"guidedTourGUI__playPauseButton playIcon"}),this._playPauseButton.inject(this._container),this._terminateButton=UWA.createElement("div",{html:"",class:"guidedTourGUI__terminateButton",title:this.buttonsTooltipsStr.terminate}),this._terminateButton.inject(this._container);var r=document.getElementById("PlayWeb-TopMenu");r&&r.classList.add("shifted"),this._waitingContainer=UWA.createElement("div",{html:"",class:"pauseWaitingContainer"});for(var a=0;a<4;++a){UWA.createElement("div",{html:"",class:"pauseWaitingBar"}).inject(this._waitingContainer)}this.terminateUICB=this._publishEvent.bind(this,"terminate"),this.togglePlayPauseCB=this._togglePlayPauseUI.bind(this),this._terminateButton.addEventListener("click",this.terminateUICB),this._playPauseButton.addEventListener("click",this.togglePlayPauseCB),this._container.addEventListener("click",this.togglePlayPauseCB);var o=this;this.tokenSubscribeEnd=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_END"},function(e){o._setPauseWaitingAnimation(!1),o._container.classList.contains("playing")&&o.displayUI(),o._deactivateCustoImmersiveUIArrow()}),this.tokenSubscribeGoToScen=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_GOTOSCENARIO"},function(e){o._activateCustoImmersiveUIArrow(e.currentScenarioIdx<e.nextScenarioIdx)}),this.tokenSubscribeGoToScen=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_GOTOSCENARIO_END"},function(e){o._deactivateCustoImmersiveUIArrow()}),this._container.inject(i)},terminateUI:function(e){if(e&&e.stopPropagation(),this.frmWindow){var n=this.frmWindow._experienceBase.getManager("VCXGUIManager").getGUIServices();if(this.preHidingConfig=n.restoreDockingElements(this.frmWindow,this.preHidingConfig),this.frmWindow.getActionBar().show(),this._container){this.tokenSubscribeEnd&&t.unsubscribe(this.tokenSubscribeEnd),this.tokenSubscribeEnd=null,this._terminateButton.removeEventListener("click",this.terminateUICB),this._playPauseButton.removeEventListener("click",this.togglePlayPauseCB),this._container.removeEventListener("click",this.togglePlayPauseCB),this.terminateUICB=null,this.togglePlayPauseCB=null,this.togglePlayPauseCB=null;for(var i=this._waitingContainer.getChildren(),r=0;r<i.length;++r){var a=i[r];a&&a.destroy()}this._waitingContainer.destroy(),this._terminateButton.destroy();var o=document.getElementById("PlayWeb-TopMenu");o&&o.classList.contains("shifted")&&o.classList.remove("shifted"),this._playPauseButton.destroy(),this._container.destroy()}this.frmWindow=null}else console.log("No Framewindow available anymore..")},displayUI:function(){this._playPauseButton.classList.contains("pauseIcon")&&(this._userInteraction?(this._setPauseWaitingAnimation(!0),this._userInteraction=!1):(this._playPauseButton.classList.remove("pauseIcon"),this._playPauseButton.classList.add("playIcon"))),this._container.classList.contains("pauseOnClickCurtain")&&this._container.classList.remove("pauseOnClickCurtain"),this._container.classList.contains("playing")&&this._container.classList.replace("playing","paused"),this._setImmersiveUICustomization(!1)},hideUI:function(){this._container.classList.contains("atCmdLaunch")&&this._container.classList.remove("atCmdLaunch"),this._playPauseButton.classList.contains("playIcon")&&this._playPauseButton.classList.replace("playIcon","pauseIcon"),this._container.classList.contains("pauseOnClickCurtain")||this._container.classList.add("pauseOnClickCurtain"),this._container.classList.contains("paused")&&this._container.classList.replace("paused","playing"),this._setImmersiveUICustomization(!0),this._userInteraction=!1},subscribe:function(e,t){if(this._modelEvent)return this._modelEvent.subscribe({event:e},t)},unsubscribe:function(e){this._modelEvent&&this._modelEvent.unsubscribe(e)},togglePlayPauseUIODT:function(e){"replay"===e.odt&&(this._playPauseButton.classList.contains("playIcon")||this._playPauseButton.classList.contains("pauseIcon"))&&(this._userInteraction=!0,this._publishEvent("togglePlayPause"))},_activateCustoImmersiveUIArrow:function(e){this._toggleActivationCustoImmersiveUIArrow(!0,{ibNextArrow:e})},_deactivateCustoImmersiveUIArrow:function(){this._toggleActivationCustoImmersiveUIArrow(!1)},_toggleActivationCustoImmersiveUIArrow:function(e,t){for(var n=document.getElementsByClassName("VCXScenarioUI_loading"),i=0;i<n.length;++i){var r=n[i],a=r.closest(".forPlayGuidedTourCmd");if(a)if(e){var o=t.ibNextArrow;if(o&&a.hasClassName("VCXRightArrow")||!o&&a.hasClassName("VCXLeftArrow")){r.removeClassName("hide"),a.addClassName("inTransition");break}}else r.addClassName("hide"),a.removeClassName("inTransition")}},_togglePlayPauseUI:function(e){e&&e.currentTarget===this._playPauseButton&&e.stopPropagation(),(this._playPauseButton.classList.contains("playIcon")||this._playPauseButton.classList.contains("pauseIcon"))&&(this._userInteraction=!0,this._publishEvent("togglePlayPause"))},_setPauseWaitingAnimation:function(e){!this._waitingContainer&&this._playPauseButton||(e?(this._waitingContainer&&this._waitingContainer.inject(this._playPauseButton),this._playPauseButton.classList.replace("pauseIcon","pauseInWait")):(this._waitingContainer&&this._waitingContainer.remove(),this._playPauseButton.classList.remove("pauseInWait"),this._playPauseButton.classList.add("playIcon")))},_setImmersiveUICustomization:function(e){var t=document.getElementsByClassName("VCXScenariosUIArrow"),n=0;for(n=0;n<t.length;++n){var i=t[n];e?i.addClassName("forPlayGuidedTourCmd"):i.removeClassName("forPlayGuidedTourCmd")}var r=document.getElementsByClassName("VCXScenariosUIDots_container");for(n=0;n<r.length;++n){var a=r[n];e?a.addClassName("forPlayGuidedTourCmd"):a.removeClassName("forPlayGuidedTourCmd")}},_publishEvent:function(e){this._modelEvent.publish({event:e,data:{eventChannel:e}})}})}),define("DS/VCXWebProducts/VCXCloseExperienceCmd",["DS/ApplicationFrame/Command","DS/VCXWebEWS/VCXExperienceServices"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){},execute:function(){var e=this;this.doClose().then(function(){e.end()}).catch(function(t){console.log(new Error(t)),e.end()})},doClose:async function(){var e=this.getFrameWindow()._experienceBase;e.getManager("VCXGUIManager").getGettingStartedUI();e.getManager("VCXExperience").ClearTimerScenarioUpdate();var n=e.getManager("VCXContextManager"),i=n.getPlayerMode(),r=n.getCat3DXIntegration();if(i||!r){return await t.CloseExperienceAndReset(e)}return t.DisplaySaveBeforeCloseModal(e)},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXRedoCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return n.extend({init:function(t){this._parent(t,{});var n=this;e.Element.addEvent.call(document,"keydown",function(t){"ctrl+y"===e.Event.whichKey(t)&&n.begin()})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,t=function(){e.getManager("VCXCommandManager").Redo()};e.getManager("VCXExperience")._bPreviewMode&&e.getManager("VCXPulseManager")?e.getManager("VCXPulseManager").StopPulse(t):t()},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXSelectSimilarColor",["DS/ApplicationFrame/Command","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebProperties/VCXColor","DS/CoreEvents/Events"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt");let r=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map(e=>{if(!e.IsKindOf("VCXComponentOccurrenceExt")||!e.IsMesh())return!1;let t=e.GetCurrentMaterial();if(t)return t;let n=e.QueryInterface("VCXIModifiable"),i=n&&n.GetProperty("Actor.Color");return i&&i.GetPropertyValue().GetValue()}).filter(e=>!!e);i=i.filter(e=>{if(!e.IsMesh())return!1;let t=e.GetCurrentMaterial();if(t&&r.includes(t))return!0;let i=e.QueryInterface("VCXIModifiable"),a=i&&i.GetProperty("Actor.Color"),o=a&&a.GetPropertyValue().GetValue();return o&&r.find(e=>e instanceof n&&e.equals(o))});var a=new t(e.getManager("VCXSelectionManager"));a.SetComponentsSelection(i),e.getManager("VCXCommandManager").Do(a)},execute:function(){},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXUndoCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";return n.extend({init:function(t){this._parent(t,{});var n=this;e.Element.addEvent.call(document,"keydown",function(t){"ctrl+z"===e.Event.whichKey(t)&&n.begin()})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,t=function(){e.getManager("VCXCommandManager").Undo()};e.getManager("VCXExperience")._bPreviewMode&&e.getManager("VCXPulseManager")?e.getManager("VCXPulseManager").StopPulse(t):t()},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXShowSelectionCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),r=[],a=0;a<i.length;++a){var o=i[a].QueryInterface("VCXIVisibility");o&&(o.GetVisibility()!==n.EVisState.Hidden||r.push(i[a]))}if(0!==r.length){var s=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));s.ChangeVisibility(r,n.EVisState.Visible),e.getManager("VCXCommandManager").Push(s)}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXSelectSimilarInstance",["DS/ApplicationFrame/Command","DS/VCXWebKernel/VCXCmdChangeSelection","DS/CoreEvents/Events"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){var e=this.getFrameWindow()._experienceBase,n=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt");let i=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").map(e=>e._reference).filter(e=>!!e);n=n.filter(e=>i.includes(e._reference));var r=new t(e.getManager("VCXSelectionManager"));r.SetComponentsSelection(n),e.getManager("VCXCommandManager").Do(r)},execute:function(){},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXInvertSelectionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n,i){"use strict";return t.extend({init:function(t){this._parent(t,{});var n=this;e.Element.addEvent.call(document,"keydown",function(t){"ctrl+i"===e.Event.whichKey(t)&&n.begin()})},beginExecute:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase},execute:function(){for(var e=this._experienceBase.getManager("VCXSelectionManager"),t=[],i=this._experienceBase.ComponentsMap.GetComponentsFromFilterMethod(this._isComponentVisibleInTheScene),r=(t=[],0);r<i.length;++r){var a=i[r];e.isIn(a)||t.push(a)}var o=new n(e);o.SetComponentsSelection(t),this._experienceBase.getManager("VCXCommandManager").Do(o)},endExecute:function(){this._experienceBase=null},_isComponentVisibleInTheScene:function(e){var t=e.QueryInterface("VCXIVisibility");if(!t||t.GetVisibility()!==i.EVisState.Visible)return!1;if(e.IsDressup){return!e.IsKindOf(["VCXBOM_Spec","CXPCameraActor_Spec","VCXCompass_Spec","VCXDigger_Spec","VCXComponentGround","VCXViewport_Spec"])}return!(!e.IsKindOf("VCXComponentOccurrenceExt")||!e.IsRenderable())}})}),define("DS/VCXWebProducts/VCXTransformFreeDragCmd",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS"],function(e,t,n,i,r,a,o){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this._tokens=null},beginExecute:function(){this._experienceBase=this.getFrameWindow()._experienceBase;this._experienceBase.getManager("VCXContextManager");this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer(),this._tokens||(this._tokens={}),this._tokens.pointerDownToken=a.addEvent(this._viewer.div,"onPrimaryPointerDownUnique",this._onPointerDownCB()),this._tokens.pointerMovePlainToken=t.subscribe({event:"/VISU/onPrimaryPointerMove"},this._onPointerMoveCB())},_onPointerDownCB:function(){var e=this,n=this._experienceBase.getManager("VCXGUIManager");return s=>{const c=this._experienceBase.getManager("VCXManipulatorManager");if(!(c&&c.manipulatorPreActivated||e._tokens.pointerUpToken)){var u,l=e._viewer.getMousePosition(s.from[0].getCurrentPosition(e._viewer.div)),d=e._viewer.pick(l,"mesh",!0);d&&d.path&&d.path.length>0&&(u=d.path[0].clone());var g=u&&i.GetModifiableFromPathElement(u,e._experienceBase);if(g){var C=e._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection("VCXComponentOccurrenceExt");if(!g.GetObject().IsKindOf("VCXComponentOccurrenceExt"))return;var h=[];if(g.GetObject().IsKindOf("VCXComponentOccurrenceExt"))h=C.map(function(e){return e.QueryInterface("VCXIModifiable")}),0!==(h=r.filterChildrenOfModsFromArray(h)).length&&e.checkPickedComponentHasAncestorInArray(g,h)||g.GetObject().IsKindOf("VCXComponentOccurrenceExt")&&(h=[g]);e._viewer.currentViewpoint.setControlActive({viewpoint:!1}),e._viewer.setPrePicking({activated:!1});var p=d.position.clone(),m=(new o.Vector3).subVectors(e._viewer.currentViewpoint.target,e._viewer.currentViewpoint.position).normalize(),_=new o.Plane(m,0).setFromNormalAndCoplanarPoint(m,p);e._initInfos={data:s,pickInfo:d,modifiablesArray:h,plane3D:_,mousePos:l},e._isDragging=!1,e._lastPosition=p,n.SetCursor("grabbing"),e._experienceBase.getManager("VCXCommandManager").StartTransaction(),e._tokens.pointerMoveDragToken||(e._tokens.pointerMoveDragToken=t.subscribe({event:"/VISU/onPrimaryPointerMove"},e._translate())),e._tokens.pointerUpToken||(e._tokens.pointerUpToken=a.addEvent(e._viewer.div,"onPrimaryPointerUpUnique",e._disposeEvents()))}}}},_onPointerMoveCB:function(){var e=this;const t=this._experienceBase.getManager("VCXGUIManager");return n=>{const r=this._experienceBase.getManager("VCXManipulatorManager");if(!(r&&r.manipulatorPreActivated||e._initInfos)){var a,o=e._viewer.getMousePosition(n.from[0].getCurrentPosition(e._viewer.div)),s=e._viewer.pick(o,"mesh",!0);s&&s.path&&s.path.length>0&&(a=s.path[0].clone());var c=a&&i.GetModifiableFromPathElement(a,e._experienceBase);c&&c.GetObject().IsKindOf("VCXComponentOccurrenceExt")?t.SetCursor("grab"):t.SetCursor("default")}}},_translate:function(){var e=this;return function(t){if(e._initInfos&&e._lastPosition){var n=e._viewer.getMousePosition(t.from[0].getCurrentPosition(e._viewer.div));if(!e._isDragging){var i=e._initInfos.mousePos;if(Math.max(Math.abs(n.xPix-i.xPix),Math.abs(n.yPix-i.yPix))<3)return;e._isDragging=!0}var r=e._viewer.pick(n,"mesh",!1).ray.intersectPlane(e._initInfos.plane3D),a=e._initInfos.modifiablesArray;e._translateFromOriginToTarget(e._lastPosition,r,a),e._lastPosition=r.clone()}}},_translateFromOriginToTarget:function(e,t,i){for(var a=(new o.Vector3).subVectors(t,e),s=new n(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager")),c=0;c<i.length;++c){var u=i[c];if(u){var l=r.buildPropertyLocationWithTranslationInWCS(u,a);s.ChangeProperty(i[c],l)}}this._experienceBase.getManager("VCXCommandManager").Push(s)},_disposeEvents:function(){var e=this,n=this._experienceBase.getManager("VCXGUIManager");return function(i){if(t.unsubscribe(e._tokens.pointerMoveDragToken),e._tokens.pointerMoveDragToken=null,a.removeEventFromToken(e._tokens.pointerUpToken),e._tokens.pointerUpToken=null,e._experienceBase.getManager("VCXCommandManager").EndTransaction("Free Drag"),n.SetCursor("grab"),e._viewer.currentViewpoint.setControlActive({viewpoint:!0}),e._viewer.setPrePicking({activated:!0}),"record"===e._experienceBase.odt&&e._isDragging){var r={commandName:"VCXTransformFreeDragCmd",componentsIDs:e._initInfos.modifiablesArray.map(function(e){return e.GetObject().GetID()}),origin:e._initInfos.pickInfo.position.createJSON(),target:e._lastPosition.createJSON()};e._experienceBase.getManager("VCXODTManager").LogAPI("VCXExecuteFreeDrag",r)}e._initInfos=null,e._translateCB=null,e._disposeCB=null,e._isDragging=!1}},endExecute:function(){this._experienceBase.getManager("VCXGUIManager").SetCursor("default"),this._tokens&&(this._tokens.pointerDownToken&&a.removeEventFromToken(this._tokens.pointerDownToken),this._tokens.pointerMovePlainToken&&t.unsubscribe(this._tokens.pointerMovePlainToken)),this._tokens={},this._lastPosition=null,this._viewer=null,this._experienceBase=null},checkPickedComponentHasAncestorInArray:function(e,t){if(t.includes(e))return!0;for(var n=e.QueryInterface("VCXIModelNavigable"),i=0;i<t.length;++i){if(t[i].QueryInterface("VCXIModelNavigable").isAncestorOf(n))return!0}return!1},executeFreeDragODT:function(e){var t=e.origin,n=e.target,i=this._experienceBase.ComponentsMap.GetComponentsFromIDs(e.componentsIDs).map(function(e){return e.QueryInterface("VCXIModifiable")});this._translateFromOriginToTarget(t,n,i)}})}),define("DS/VCXWebProducts/VCXTransformCmd",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/Visualization/ThreeJS_DS","DS/Robot/Robot","DS/CoreEvents/Events"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),t.getCommand("VCXTransformHackCmd",e.context)||(t._commands[e.context].VCXTransformHackCmd=this,this._hackEvent=r.subscribe({event:this._evtID.replace("VCXTransformCmd","VCXTransformHackCmd")},()=>{this._ignoreBeginCtx||(this._comeFromCtxBar=!0,this.begin(),this._comeFromCtxBar=!1)}));this._bChangePositionAtCmdBeginning=!0,this._tokenSelectionAdd=null,this._tokenSelectionRemove=null,this._tokenSelectionEmpty=null,r.subscribe({event:"VCX_DONT_CHNG_ROBOT_POS_AT_TRANSFORM_BEGIN"},e=>{this._bChangePositionAtCmdBeginning=!1,this._targetsAtBeginning=e&&e.targets,this._matrixAtBeginning=e&&e.matrix})},destroy:function(){this._hackEvent&&r.unsubscribe(this._hackEvent)},beginExecute:function(){this._experienceBase=this.getFrameWindow()._experienceBase,this._viewer=this._experienceBase.getManager("VCXContextManager").getMainViewer(),this._ignoreBeginCtx=!0,r.publish({event:this._evtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/BEGIN",data:this}),r.publish({event:this._globalEvtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/BEGIN",data:this}),this._ignoreBeginCtx=!1,this._comeFromCtxBar&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.hideContextualBar();var e=this;this._tokenSelectionAdd=r.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(){e.isRunning()&&e._displayPivot()}),this._tokenSelectionRemove=r.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(){e.isRunning()&&e._displayPivot()}),this._tokenSelectionEmpty=r.subscribe({event:"VCX_SELECTED_ACTORS_EMPTY"},function(){e.isRunning()&&e._displayPivot()}),this._displayPivot(),this._bChangePositionAtCmdBeginning||this.changeRobotPosAtCmdBeginning(!0)},endExecute:function(){if(this._experienceBase){r.publish({event:this._evtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/END",data:this}),r.publish({event:this._globalEvtID.replace("VCXTransformCmd","VCXTransformHackCmd")+"/END",data:this}),null!==this._tokenSelectionAdd&&(r.unsubscribe(this._tokenSelectionAdd),this._tokenSelectionAdd=null),null!==this._tokenSelectionRemove&&(r.unsubscribe(this._tokenSelectionRemove),this._tokenSelectionRemove=null),null!==this._tokenSelectionEmpty&&(r.unsubscribe(this._tokenSelectionEmpty),this._tokenSelectionEmpty=null);var e=this._viewer.getRobot();if(!(e instanceof i))return;e.target=null,e.setConnectionState(!1),e.CallBackEventHandlerViewPoint();var n=this._experienceBase.getManager("VCXContextManager").getContext();t.getCommand("VCXMoveRobotOnBBoxCenterCmd",n).disable(),this._experienceBase.getManager("VCXRobotAdapter").displayRobot(!1,!0),this._viewer.render()}this._viewer=null,this._experienceBase=null},cancelExecute:function(){this.changeRobotPosAtCmdBeginning(!0)},_displayPivot:function(){if(!(this._bChangePositionAtCmdBeginning||this._targetsAtBeginning&&this._matrixAtBeginning))return;var e=this._viewer.getRobot();if(!(e instanceof i))return console.error("No robot found.."),void this.end();this._targetsAtBeginning&&this._experienceBase.getManager("VCXSelectionManager").addComponentsToSelection(this._targetsAtBeginning);const n=[];for(var r=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO"),a=0;a<r.length;++a)if(r[a].IsKindOf("VCXWebComponentOccurrence")&&!r[a].IsDressup){var o=r[a].QueryInterface("VCXIModifiable");o&&n.push(o)}var s=this._experienceBase.getManager("VCXContextManager").getContext(),c=t.getCommand("VCXMoveRobotOnBBoxCenterCmd",s);if(Array.isArray(n)&&n.length>0){let t;e.setConnectionState(!0),e.fixedSizeNode3D.setRatio(7),e.target=n[0].QueryInterface("W3AISGNodeHolder").getPathElement(),(t=this._matrixAtBeginning?this._matrixAtBeginning:this._getNewRobotFrame(n))&&(e.setRobotMatrix(t),e.setVisibility(!0),c.isEnabled()||c.enable())}else c.isEnabled()&&c.disable(),e.setVisibility(!1),e.target=null,e.setConnectionState(!1),e.CallBackEventHandlerViewPoint();this._viewer.render()},_getNewRobotFrame:function(e){if(0!==e.length){if(1===e.length&&"VCX_Root"!==e[0].GetObject()._ID){var t=e[0].GetProperty("Actor.Position").GetPropertyValue().GetPivot().GetValue(),i=e[0].QueryInterface("W3AISGNodeHolder").getPathElement().getParentPath().getWorldMatrix(this._viewer);return o=(new n.Matrix4).copy(i).multiply(t)}var r,a=null;for(r=0;r<e.length;++r)if("VCX_Root"!==e[r].GetObject()._ID){t=e[r].GetProperty("Actor.Position").GetPropertyValue().GetPivot().GetValue(),i=e[r].QueryInterface("W3AISGNodeHolder").getPathElement().getParentPath().getWorldMatrix(this._viewer);var o=(new n.Matrix4).copy(i).multiply(t);if(null!==a){if(!this._equalMatrices(o,a))break}else a=o.clone()}return r===e.length?a:(new n.Matrix4).setPosition(this._getBBoxInWCS(e).center())}console.error("No modifiable specified in the array parameter")},changeRobotPosAtCmdBeginning:function(e){"boolean"==typeof e?(this._bChangePositionAtCmdBeginning=e,this._matrixAtBeginning=null,this._targetsAtBeginning=null):console.error("A boolean is needed as parameter")},_equalMatrices:function(e,t){if(e instanceof n.Matrix4&&t instanceof n.Matrix4){var i;for(i=0;i<16&&!(Math.abs(e.elements[i]-t.elements[i])>.001);++i);return 16===i}console.error("2 THREE.Matrix4 objects are needed as parameters")},_getBBoxInWCS:function(e){for(var t=new n.Box3,i=0;i<e.length;i++){var r=e[i].QueryInterface("W3AISGNodeHolder"),a=r.getPathElement().getBoundingBox(null,this._viewer);a.applyMatrix4(r.getWorldMatrix(this._viewer)),t.union(a)}return t}})}),define("DS/VCXWebProducts/VCXIsolateCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),r=e.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");if(r.forEach(e=>{e.QueryInterface("VCXIModelNavigable").traverse(e=>r.push(e.GetObject()))}),0!==(i=i.filter(e=>e.IsKindOf("VCXDressup_Spec")||e.IsKindOf("VCXComponentOccurrenceExt")&&e.IsMesh())).length){var a=i.filter(e=>r.includes(e)),o=i.filter(e=>!r.includes(e)),s=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));s.ChangeVisibility(o,n.EVisState.Hidden),console.log(o),o.forEach(e=>{console.log(e._name)});var c=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));c.ChangeVisibility(a,n.EVisState.Visible),console.log(a),a.forEach(e=>{console.log(e._name)}),e.getManager("VCXCommandManager").StartTransaction(),e.getManager("VCXCommandManager").Push(s),e.getManager("VCXCommandManager").Push(c),e.getManager("VCXCommandManager").EndTransaction()}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXApplyToAmbienceCmd",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/VCXWebKernelCommands/VCXCmdApplyTo"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},execute:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase;var t=this._experienceBase.getManager("VCXContextManager").getActiveViewport().getActiveAmbienceID(),i=t&&this._experienceBase.ComponentsMap.GetComponentFromID(t);const r=this._experienceBase.getManager("VCXCommandManager");let a={};let o=[];const s=this._experienceBase.getManager("VCXScenarioManager").GetScenarios();for(let e in s)s.hasOwnProperty(e)&&o.push(s[e]);a.availability=!0,a.scenario=o,a.dressups=[i],a.parts=[],a.propagateCamera=!1,a.propagateViewport=!1;const c=new n(this._experienceBase,a,"all");r.Push(c)}})}),define("DS/VCXWebProducts/VCXInvertVisibilityCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),r=[],a=[],o=0;o<i.length;++o){var s,c=i[o].IsKindOf("VCXDressup_Spec");if(i[o].IsKindOf("VCXComponentOccurrenceExt")&&i[o].IsMesh())(s=i[o].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()===n.EVisState.Hidden?r.push(i[o]):a.push(i[o]));if(c)(s=i[o].QueryInterface("VCXIVisibility"))&&(s.GetVisibility()===n.EVisState.Hidden?r.push(i[o]):a.push(i[o]))}var u=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));u.ChangeVisibility(a,n.EVisState.Hidden),console.log(a),a.forEach(e=>{console.log(e._name)}),e.getManager("VCXCommandManager").Do(u);var l=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));l.ChangeVisibility(r,n.EVisState.Visible),console.log(r),r.forEach(e=>{console.log(e._name)}),e.getManager("VCXCommandManager").Do(l)},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXShowAllGeometriesCmd",["DS/ApplicationFrame/Command","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){for(var e=this.getFrameWindow()._experienceBase,i=e.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt"),r=[],a=0;a<i.length;++a){var o=i[a];if(!o.IsKindOf("VCXComponentCompositePmi")){var s=o.QueryInterface("VCXIVisibility");s&&(s.GetVisibility()!==n.EVisState.Hidden||r.push(i[a]))}}if(0!==r.length){var c=new t(e.getManager("VCXScenarioManager"),e.ComponentsMap,e.getManager("VCXCommandManager"));c.ChangeVisibility(r,n.EVisState.Visible),e.getManager("VCXCommandManager").Push(c)}},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXMoveRobotOnBBoxCenterCmd",["DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/VCXWebModifiablesServices/VCXModifiablesServices","DS/Robot/Robot"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!0}),this._vcxExperience=null,this.disable()},execute:function(){this._vcxExperience=this.getFrameWindow()._experienceBase,this._displayBBoxCenter()},pauseExecute:function(){},resumeExecute:function(){this.isRunning()||this.end()},endExecute:function(){this._vcxExperience=null},_displayBBoxCenter:function(){var e=this._vcxExperience.getManager("VCXContextManager").getMainViewer(),r=this._vcxExperience.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");if(r.filter(function(e){return e.IsKindOf("VCXWebComponentOccurrence")&&!e.IsDressup}),r.length>0){var a=e.getRobot();if(!(a instanceof i))return console.error("No robot found.."),void this.end();a.connect(),a.fixedSizeNode3D.setRatio(7);var o=n.getBBoxInWorldFromComponents(r).center(),s=(new t.Matrix4).setPosition(o);a.setRobotMatrix(s),e.render()}this.end()}})}),define("DS/VCXWebProducts/VCXPlayGuidedTourModel",["UWA/Class","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdPlayScenario"],function(e,t,n,i){"use strict";return e.extend({init:function(){this._pauseRequested=!1,this.setGuidedTourOccurring(!1),this._listAllScenario=null,this._nbSecsForWaiting=5;var e=this;this.tokenSubscribeEnd=t.subscribe({event:"VCX_PLAY_GUIDED_TOUR_END"},function(t){e._listAllScenario=null,e._pauseRequested=!1,e.setGuidedTourOccurring(!1)})},destroy:function(){this._listAllScenario=null,this._pauseRequested=null,this._guidedTourOccurring=null,t.unsubscribe(this.tokenSubscribeEnd)},setSecondsForWaiting:function(e){this._nbSecsForWaiting=e},setPauseRequested:function(e){this._pauseRequested=!0;for(var t=e.getManager("VCXScenarioManager"),n=Object.keys(t._scenariosToPlay).length-1;n>=0;--n){var i=t._scenariosToPlay[n];t.StopPlayingScenario(i)}},getPauseRequested:function(){return this._pauseRequested},setGuidedTourOccurring:function(e){this._guidedTourOccurring=e},getGuidedTourOccurring:function(){return this._guidedTourOccurring},checkScenarioPresence:function(e){var t=e.getManager("VCXSequenceManager");if(!t)return!1;for(var n=t.GetListSequencesFromType(0),i=0;i<n.length;i++){var r=n[i];r.QueryInterface("VCXIModifiable");if(r.GetListScenariosId().length>0)return!0}return!1},getListAllScenarios:function(e){if(!this._listAllScenario){var t=e.getManager("VCXSequenceManager"),n=e.getManager("VCXScenarioManager"),i=t.GetListSequencesFromType(0);n.GetCurrentScenario();this._listAllScenario=[];for(var r=0;r<i.length;r++)for(var a=i[r],o=(a.QueryInterface("VCXIModifiable"),a.GetListScenariosId()),s=0;s<o.length;s++){var c=o[s],u=n.GetScenarios()[c];u&&this._listAllScenario.push(u)}}return this._listAllScenario},getIdxNextScenToPlay:function(e){var t=e.getManager("VCXScenarioManager").GetCurrentScenario();if(""===t)return 0;for(var n=e.getManager("VCXSequenceManager").GetListSequencesFromType(0),i=0,r=0;r<n.length;++r){var a=n[r],o=a.GetListScenariosId().length,s=a.GetIndexOfScenario(t);if(-1!==s){if(r===n.length-1&&s===o-1)return 0;i+=s+1;break}i+=o}return i},runGuidedTour:function(e){var t=this.getIdxNextScenToPlay(e),r=e.getManager("VCXScenarioManager"),a=(e.getManager("VCXSequenceManager"),e.getManager("VCXCommandManager")),o=this.getListAllScenarios(e),s=this,c=function(t){if(s._publishGuidedTourEvent("goToScenario_End",{currentScenarioIdx:0===t?o.length-1:t-1,nextScenarioIdx:t}),t>=o.length||s._pauseRequested)s._publishGuidedTourEvent("end");else{var n=new i(r,e.ComponentsMap,a);n.PlayScenario(o[t]),n.SetCallback(u,t),a.Do(n)}},u=function(t){if(s._pauseRequested)s._publishGuidedTourEvent("end");else{var n=t+1;n>=o.length&&(n=0),s.idxOfScenToPlayFirst=n;var c=e.Factory.BuildComponent("VCXScenario");c.SetPersistency(2),c.SetApplyNeutralAtGoToScenario(!1),c.SetMaxFrame(r.GetFPS()*s._nbSecsForWaiting),c._bWait=!0;var u=new i(r,e.ComponentsMap,a);u.PlayScenario(c),u.SetCallback(l,n),a.Do(u)}},l=function(t){if(s._pauseRequested)s._publishGuidedTourEvent("end");else{s._publishGuidedTourEvent("goToScenario",{currentScenarioIdx:0===t?o.length-1:t-1,nextScenarioIdx:t});var i=c,u=t;if(t>=o.length&&(i=s._publishGuidedTourEvent.bind(s),u="end"),s.customGoToScenario)s.customGoToScenario(o[t],i,u);else{var l=new n(r,e.ComponentsMap,a);l.BuildTransitionTo(o[t]),l.SetCallback(i,u),a.Do(l)}}};this._publishGuidedTourEvent("begin"),this.setGuidedTourOccurring(!0),l(t)},_publishGuidedTourEvent:function(e,n){t.publish({event:"VCX_PLAY_GUIDED_TOUR_"+e.toUpperCase(),data:n})}})}),define("DS/VCXWebProducts/VCXRestoreActiveViewVisibilityCmd",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{})},beginExecute:function(){},execute:function(){var e=this.getFrameWindow()._experienceBase,t=e.getManager("VCXScenarioManager").GetCurrentScenario(),n=e.ComponentsMap.GetComponentFromID(t);e.getManager("VCXScenarioManager").ApplyVisibility(n)},endExecute:function(){}})}),define("DS/VCXWebProducts/VCXHideDressupsCmd",["DS/VCXWebProducts/VCXHideSelectionCmd"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{})},execute:function(){this._hideAllDressups()},_hideAllDressups:function(){var e=this.getFrameWindow();this._experienceBase=e._experienceBase;var t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXDressup_Spec");this._hideElementsFromArray(t),this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.hideContextualBar()}})}),define("DS/VCXWebProducts/VCXPlayGuidedTourCmd",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/VCXWebProducts/VCXPlayGuidedTourModel","DS/VCXWebProducts/VCXPlayGuidedTourUI"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.tokenUISubs=null,this.playGuidedTourUI=null,this.playGuidedTourModel=new n},destroy:function(){this.isRunning()&&this.end(),this.playGuidedTourModel&&(this.playGuidedTourModel.destroy(),this.playGuidedTourModel=null),this.playGuidedTourUI&&(this.playGuidedTourUI.destroy(),this.playGuidedTourUI=null),this._parent()},beginExecute:function(){var e=this.getFrameWindow();if(this._experienceBase=e._experienceBase,!this.playGuidedTourModel.checkScenarioPresence(this._experienceBase))return console.log("No scenario available to create a tour... Ending command PlayGuidedTour."),this._experienceBase=null,void this.end();this.playGuidedTourUI=new i(this.getFrameWindow()),this.playGuidedTourUI&&(this.playGuidedTourUI.setplayGuidedTourUI(e),this.tokenUISubs=[this.playGuidedTourUI.subscribe("togglePlayPause",this._togglePlayPause.bind(this)),this.playGuidedTourUI.subscribe("terminate",this.end.bind(this))])},execute:function(){},endExecute:function(){if(this.playGuidedTourUI&&(this.playGuidedTourUI.terminateUI(),this.tokenUISubs))for(var e=0;e<this.tokenUISubs.length;++e)this.playGuidedTourUI.unsubscribe(this.tokenUISubs[e]);this.playGuidedTourModel.getGuidedTourOccurring()&&this.playGuidedTourModel.setPauseRequested(this._experienceBase),this.playGuidedTourModel._publishGuidedTourEvent("end"),this.playGuidedTourUI=null,this._experienceBase=null},_togglePlayPause:function(){this.playGuidedTourModel.getGuidedTourOccurring()?this.pause():this.play()},pause:function(){this.playGuidedTourUI.displayUI(),this.playGuidedTourModel.setPauseRequested(this._experienceBase)},play:function(){this.playGuidedTourUI.hideUI(),this.playGuidedTourModel.runGuidedTour(this._experienceBase)},executeGuidedTourODT:function(){if("replay"===this._experienceBase.odt){var e=this;return[function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),setTimeout(function(){t(!0)},2e3)},function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),t(!0)},function(e,t){setTimeout(function(){e(!0)},6e3)},function(t,n){e.playGuidedTourUI.togglePlayPauseUIODT(e._experienceBase),setTimeout(function(){t(!0)},2e3)}]}}})});