define("DS/WAfrUIModelManagers/ContextualUIComponentManager",["UWA/Core","UWA/Class","DS/Selection/CSOManager","DS/WAfrControls/WAfrContextualBar","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/WAfrControls/WAfrContextualMenu","DS/WAfrHandlers/mod_HandlerComponent","DS/Utilities/DeviceUtils"],function(e,t,n,i,o,r,a,s,l){"use strict";function d(e,t,n){return Math.abs(e-t)<=n}return t.extend({init:function(){this._parent()}}).extend({defaultOptions:{onContextualBarReady:function(e){return null},onContextualMenuReady:function(e){return null},subscribersId:void 0},setContext:function(e){var t=this;void 0!==e.executionContext&&(t._executionContext=e.executionContext),void 0!==e.UIComponent&&(t._uiComponent=e.UIComponent),void 0!==e.UIFrame&&(t._uiFrame=e.UIFrame,t._container=t._uiFrame.getContainer(),void 0!==t._container&&(t._unbindBehaviors(),t._bindBehaviors())),void 0!==e.Viewer&&(t._viewer=e.Viewer)},init:function(t){var i=this;i.options=e.extend(e.clone(this.defaultOptions),t),i._parent(),i._contextBar=null,i._isInViewpointManipulation=!1,i._listOfSubscribers=[],i._ContextualBarAvailable=!0,i._ContextualBarOnLeftClic=!0,i._ContextualMenuOnRightClic=!0,i._os=function(){let e=window.navigator.userAgent,t=window.navigator.platform,n=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?n="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(t)?n="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?n="Windows":/Android/.test(e)?n="Android":!n&&/Linux/.test(t)&&(n="Linux"),n}(),n.onEmpty(function(){i.hideContextualMenus()})},register:function(t){(t=e.extend(e.clone(this.defaultOptions),t)).merge?this._listOfSubscribers.push(t):(this._listOfSubscribers=[],this._listOfSubscribers.push(t))},registerUnshift:function(t){(t=e.extend(e.clone(this.defaultOptions),t)).merge?this._listOfSubscribers.unshift(t):(this._listOfSubscribers=[],this._listOfSubscribers.unshift(t))},unregister:function(e){if(e)for(var t=0;t<this._listOfSubscribers.length;t++)if(this._listOfSubscribers[t].subscriberId===e){this._listOfSubscribers.splice(t,1);break}},dispose:function(){o.unsubscribe(this._visuEventToken),o.unsubscribe(this._ctxbarHiddenEventToken)},hideContextualMenus:function(){document.body.removeEventListener("mouseup",this._hideListener),i.hide(),
//! IR-1226205-3DEXPERIENCER2024x
"Mac OS"===this._os&&a.hide()},hideContextualMenu:function(){},buildDefaultHandlerContextMenuItem:function(e){var t=this._executionContext.getComponent(s.DEFAULT_COMPONENT_NAME);return a._createHandlerModel(e,t)},buildCheckHandlerContextMenuItem:function(e){var t=this._executionContext.getComponent(s.DEFAULT_COMPONENT_NAME);return a._createCheckHandlerModel(e,t)},deactivateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=!1},activateContextualBarOnLeftClic:function(){this._ContextualBarOnLeftClic=!0},deactivateContextualBar:function(){this._ContextualBarAvailable=!1},activateContextualBar:function(){this._ContextualBarAvailable=!0},deactivateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=!1},activateContextualMenuOnRightClic:function(){this._ContextualMenuOnRightClic=!0},getContextualBar:function(){return i},_onBarDisplayed:null,_onMenuDisplayed:null,_showContextualBar:function(e){void 0===e&&(e={});var t=this;if(e.freeZone=t._uiFrame.getImmersiveFrame().getFreeZone(),document.body.removeEventListener("mouseup",this._hideListener),document.body.addEventListener("mouseup",this._hideListener),t._contextBar?t._contextBar.hide():t.getContextualBar()&&void 0!==t.getContextualBar()&&t.getContextualBar().hide(),t._listOfSubscribers.length){e.executionContext=t._executionContext,e.viewer=void 0;let n=t._executionContext.getApplicationComponent("Viewer");n&&(e.viewer=n.get3DViewer()),e.uiFrame=t._uiFrame.getUIFrame(),e.uiComponent=t._uiComponent,!0===t._isTouch?(e.Xposition=void 0===e.x?t._initMousePos.x:e.x,e.Yposition=void 0===e.y?t._initMousePos.y:e.y):(e.Xposition=void 0===e.x?t._mousePos.x:e.x,e.Yposition=void 0===e.y?t._mousePos.y:e.y),e.subscribersOptions=void 0===e.fillingList||0===e.fillingList.length?t._listOfSubscribers:e.fillingList,e.hideWithDistance=void 0===e.hideWithDistance||e.hideWithDistance,null!==t._onBarDisplayed&&(e.eventCallback=t._onBarDisplayed.bind(t)),e.Xoffset=void 0===e.Xoffset?45:e.Xoffset,e.Yoffset=void 0===e.Yoffset?-45:e.Yoffset,t._ContextualBarAvailable&&i.show(e)}},_showContextMenu:function(e){void 0===e&&(e={});var t=this;e.freeZone=t._uiFrame.getImmersiveFrame().getFreeZone(),document.body.removeEventListener("mouseup",this._hideListener),document.body.addEventListener("mouseup",this._hideListener);let n=void 0;if(t._listOfSubscribers.length){e.executionContext=t._executionContext,e.viewer=void 0;let i=t._executionContext.getApplicationComponent("Viewer");i&&(e.viewer=i.get3DViewer()),e.uiFrame=t._uiFrame.getUIFrame(),e.uiComponent=t._uiComponent,!0===t._isTouch?(e.Xposition=void 0===e.x?t._initMousePos.x:e.x,e.Yposition=void 0===e.y?t._initMousePos.y:e.y):(e.Xposition=void 0===e.x?t._mousePos.x:e.x,e.Yposition=void 0===e.y?t._mousePos.y:e.y),e.subscribersOptions=void 0===e.fillingList||0===e.fillingList.length?t._listOfSubscribers:e.fillingList,e.Xoffset=void 0===e.Xoffset?45:e.Xoffset,e.Yoffset=void 0===e.Yoffset?-45:e.Yoffset,n=a.show(e)}return n},
//! IR-1224606-3DEXPERIENCER2024x
_onLongHold:function(e){if(r.isTouchEvent(e)&&l.isMobileiOS()){null!=this._longHoldTimer&&clearTimeout(this._longHoldTimer);let n=this;function t(e){document.removeEventListener("click",t,!0),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),null!=n._longHoldTimer&&clearTimeout(n._longHoldTimer)}this._longHoldTimer=setTimeout(()=>{document.removeEventListener("click",t,!0),this._longHoldTimer=null},600),document.addEventListener("click",t,!0),this._onRightClick(e)}},_onRightClick:function(e){document.body.removeEventListener("mouseup",this._hideListener),document.body.addEventListener("mouseup",this._hideListener);var t=this;e.preventDefault();let n=t._uiFrame.getContainer().getBoundingClientRect();t._finalMousePos={x:e.clientX-n.left,y:e.clientY-n.top};
//! IR-1184944-3DEXPERIENCER2024x
//! Context menu isn’t open at all when left side panel is open
let i=!1;const o=this._executionContext.getComponent("Viewer");if(null!=o){const t=o.get3DViewer();if(null!=t&&null!=t.canvas){const n=t.canvas;e.srcElement==n&&(i=!0)}}
//! IR-1184944-3DEXPERIENCER2024x
//! Context menu isn’t open at all when left side panel is open
//! IR-1222626-3DEXPERIENCER2024x
//! IR-1226205-3DEXPERIENCER2024x
let r=0;if(t._isTouch&&(r=5),("Mac OS"!==t._os||!t._isInViewpointManipulation)&&!1!==t._ContextualMenuOnRightClic&&d(t._initMousePos.x,t._finalMousePos.x,r)&&d(t._initMousePos.y,t._finalMousePos.y,r)&&(i||d(t._initMouseOffset.x,t._finalMousePos.x,r)&&d(t._initMouseOffset.y,t._finalMousePos.y,r))){var s={hideWithDistance:!1,x:t._mousePos.x,y:t._mousePos.y,Xoffset:0,Yoffset:-5,withContextMenu:!0};
//! IR-1184944-3DEXPERIENCER2024x
//! Context menu isn’t open at all when left side panel is open
i&&(s.viewerX=e.offsetX,s.viewerY=e.offsetY),t._isTouch&&(s.x=t._finalMousePos.x,s.y=t._finalMousePos.y);let n=t._showContextMenu(s);if(void 0!==n&&(s.rectCtxMenuInfo=n.ctxMenuDimPos),t._showContextualBar(s),!0===t.getContextualBar()._isShown&&void 0!==n){t.getContextualBar().getContent().getBoundingClientRect().x<s.x&&s.x>=s.rectCtxMenuInfo.x&&(s.x=s.x+s.Xoffset-s.rectCtxMenuInfo.width,a._display(n.menuContent,s))}}},_convertToMenuOptions:function(e){var t=this._executionContext.getComponent(s.DEFAULT_COMPONENT_NAME);return a._convertToMenuOptions(e,t)},_bindBehaviors:function(){var t=this;t._mousePos={x:0,y:0};let n=t._uiFrame.getContainer().getBoundingClientRect();this._uiFrame.getContainer().addEvent("mousemove",function(e){t._mousePos={x:e.clientX-n.left,y:e.clientY-n.top}}),this._hideListener=function(t){e.Event.findElement(t,".wux-afr-contextual-bar")},this._onPointerDownRegisteredFunc=this._onPointerDown.bind(this),t._uiFrame.getContainer().addEvent(r.POINTERDOWN,this._onPointerDownRegisteredFunc),this._onMouseDownRegisteredFunc=this._onMouseDown.bind(this),t._uiFrame.getContainer().addEvent("mousedown",this._onMouseDownRegisteredFunc),this._onMouseUpRegisteredFunc=this._onMouseUp.bind(this),t._uiFrame.getContainer().addEvent(r.POINTERUP,this._onMouseUpRegisteredFunc),this._onRightClickRegisteredFunc=this._onRightClick.bind(this),t._uiFrame.getContainer().addEvent("contextmenu",this._onRightClickRegisteredFunc),
//! IR-1224606-3DEXPERIENCER2024x (see main comment in this file)
this._onLongHoldRegisteredFunc=this._onLongHold.bind(this),t._uiFrame.getContainer().addEventListener(r.LONGHOLD,this._onLongHoldRegisteredFunc);var i=0,a=function(e){i=0},s=!1;t._visuEventToken=o.subscribe({event:"/VISU/"},function(e){var n={};"@onViewpointChange"===e.eventType?(0===i&&(!0===t.getContextualBar()._isShown&&(s=!0),t.hideContextualMenus(),t._uiFrame.getContainer().removeEvent("mouseup",a),t._uiFrame.getContainer().addEvent("mouseup",a)),i++):"@onViewpointBeginMove"===e.eventType?(i=0,t._isInViewpointManipulation=!0,s=!1):"@onViewpointEndMove"===e.eventType?(t._isInViewpointManipulation=!1,!0===s&&(t.hideContextualMenus(),n.hideWithDistance=!0,t._showContextualBar(n))):"@onClickEvent"===e.eventType&&!0===t._ContextualBarOnLeftClic&&("@pickNothing"!==e.eventID&&"@pickPrimitive"!==e.eventID&&"@pickRep"!==e.eventID&&"@pickMesh"!==e.eventID||(t.hideContextualMenus(),(
//! IR-1184937-3DEXPERIENCER2024x
//! Contextual bar isn’t displayed at the right location when left panel opened
n={x:e.event.event.clientX,y:e.event.event.clientY,viewerX:e.event.currentPosition.x,viewerY:e.event.currentPosition.y}).hideWithDistance="Touch"!==e.event.type,t._showContextualBar(n)))}),this._ctxbarHiddenEventToken=o.subscribe({event:"WUX/AFR/ctxBarHidden"},function(e){t.hideContextualMenu()})},_unbindBehaviors:function(){this._onPointerDownRegisteredFunc&&(this._uiFrame.getContainer().removeEvent(r.POINTERDOWN,this._onPointerDownRegisteredFunc),delete this._onPointerDownRegisteredFunc),this._onMouseDownRegisteredFunc&&(this._uiFrame.getContainer().removeEvent("mousedown",this._onMouseDownRegisteredFunc),delete this._onMouseDownRegisteredFunc),this._onMouseUpRegisteredFunc&&(this._uiFrame.getContainer().removeEvent(r.POINTERUP,this._onMouseUpRegisteredFunc),delete this._onMouseUpRegisteredFunc),this._onRightClickRegisteredFunc&&(this._uiFrame.getContainer().removeEvent("contextmenu",this._onRightClickRegisteredFunc),delete this._onRightClickRegisteredFunc),
//! IR-1224606-3DEXPERIENCER2024x (see main comment in this file)
this._onLongHoldRegisteredFunc&&(this._uiFrame.getContainer().removeEventListener(r.LONGHOLD,this._onLongHoldRegisteredFunc),delete this._onLongHoldRegisteredFunc),o.unsubscribe(this._ctxbarHiddenEventToken)},_onMouseUp:function(e){1===e.button&&(this._isInViewpointManipulation=!1)},_onMouseDown:function(e){let t=this._uiFrame.getContainer().getBoundingClientRect();this._initMousePos={x:e.clientX-t.left,y:e.clientY-t.top},this._initMouseOffset={x:e.offsetX,y:e.offsetY},1===e.button&&(this._isInViewpointManipulation=!0)},_onPointerDown:function(e){let t=this._uiFrame.getContainer().getBoundingClientRect();this._initMousePos={x:e.clientX-t.left,y:e.clientY-t.top},this._initMouseOffset={x:e.offsetX,y:e.offsetY},this._isTouch=r.isTouchEvent(e)}})}),define("DS/WAfrUIModelManagers/mod_ActionBarResponsiveManager",[],function(){"use strict";let e=Object.create(null);return e.ActionBarResponsiveManager=class{constructor(e,t){this._private=Object.create(null),this._private._actionBar=e,this._private._smallViewportActionBar=t,this._private._state=null,this.configureMediaQueries()}getSmallViewportActionBar(){return this._private._smallViewportActionBar}getActionBar(){return this._private._actionBar}configureMediaQueries(){this._private._mediaQueryXS=window.matchMedia("screen and (max-width: 240px), screen and (max-height: 240px)"),this._private._boundOnMediaQueryXS=function(){this.compute()}.bind(this),this._private._mediaQueryXS.addListener(this._private._boundOnMediaQueryXS),this._private._mediaQuerySVAB=window.matchMedia("screen and (min-width: 241px) and (max-width: 580px), screen and (min-height:241px) and (max-height: 280px)"),this._private._boundOnMediaQuerySVAB=function(){this.compute()}.bind(this),this._private._mediaQuerySVAB.addListener(this._private._boundOnMediaQuerySVAB)}compute(){let e=null;return e=this._private._mediaQueryXS.matches?this.setState(null):this._private._smallViewportActionBar&&this._private._mediaQuerySVAB.matches?this.setState("SVAB"):this.setState("SAB")}setState(e){let t=Promise.resolve();return null===e?(this._private._actionBar.hide(),this._private._smallViewportActionBar&&this._private._smallViewportActionBar.hide()):"SAB"===e?(this._private._smallViewportActionBar&&this._private._smallViewportActionBar.hide(),t=this._private._actionBar.show()):"SVAB"===e&&(this._private._actionBar.hide(),this._private._smallViewportActionBar&&(t=this._private._smallViewportActionBar.show())),t}clean(){this._private._mediaQueryXS.removeListener(this._private._boundOnMediaQueryXS),this._private._mediaQuerySVAB.removeListener(this._private._boundOnMediaQuerySVAB)}},e}),define("DS/WAfrUIModelManagers/MainUIComponentManager",["css!DS/WAfrUI/wafr.css","UWA/Core","UWA/Class","DS/Windows/Panel","DS/Menu/ContextualMenu","DS/WAfrModelEvents/mod_ModelEvents","DS/Utilities/TouchUtils","DS/WAfrUIStandardComponents/mod_TreeModel","DS/WAfrTweakers/TweakerHandlerGenerateMethods","DS/WAfrUIComponents/mod_SmallViewportActionBar","DS/WAfrUIModelManagers/mod_ActionBarResponsiveManager","DS/WAfrDebug/mod_Performances","i18n!DS/WAfrUIModelManagers/assets/nls/ActionBarContextMenu","DS/WAfrControls/WAfrUIExpander"],function(e,t,n,i,o,r,a,s,l,d,u,c,h,p){"use strict";const _=!("false"===localStorage.getItem("ACTION_BAR_OPTIMIZED_WINDOW_GROUP_CREATION")),f=d.SmallViewportActionBar,m=u.ActionBarResponsiveManager,g=c.Performances,v="[DS/WAfrUIModelManagers/MainUIComponentManager]",C=new g;var w=r.DEFAULT_COMPONENT_NAME;if(!w||0===w.length)throw new Error("mod_ModelEvents.DEFAULT_COMPONENT_NAME has to be defined");const M=46,b=74,x=52,A=70,y=96,E=88,B=112;function D(e){const t=e._showLabelFlag,n=e._touchMode,i=e._panels;if(i&&i.length>0){let e=M;if(t?e=b:n&&(e=x),i[0].minWidth!==e)for(const t of i)t.minWidth=e}}function F(e,t){let n=A;return e&&t?n=B:e?n=E:t&&(n=y),n}function S(e){return e.getData().view=document.createDocumentFragment(),Promise.resolve()}function W(e){let t=e.getData(),n=document.createElement("div");n.classList.add("wafr-toolbar-section-group");let i=document.createElement("div");return i.classList.add("wafr-toolbar-section-group-primary"),n.appendChild(i),t.view=n,Promise.resolve()}function I(e){let t=e.getData(),n=(new p).getDom(),i=function(){var e=this;if(!e._panels[0].immersiveFrame)throw new Error("no immersive frame related to this panel",e._panels[0]);if(D(e),!e._panels[0].immersiveFrame.getDockingElement(WUXDockAreaEnum.BottomDockArea))throw new Error("no bottom dock area in this immersive frame",e._panels[0].immersiveFrame);e._panels.forEach(function(e){e.fire("dimensionsChanged"),e.currentDockArea!==WUXDockAreaEnum.TopDockArea&&e.currentDockArea!==WUXDockAreaEnum.BottomDockArea||e._afr._bound_computeCompactWidth()})}.bind(this);return n.addEventListener("expand",i),n.addEventListener("collapse",i),n.classList.add("wafr-toolbar-section-group-secondary"),t.view=n,Promise.resolve()}function L(e){let t="";for(let n of e){let e;(e=n.accept({visitActionHandler:()=>!1,visitCommandHandler:()=>!1,visitCheckHandler:()=>!0,visitRadioHandler:()=>{throw new Error("RadioHandlers are not supported in a Set.")}})?n.getState()?n.onCheckHandler:n.onUncheckHandler:n)&&e.getI18n()&&(t=t+e.getI18n().title+",")}return t}function P(e,t){let n="";switch(t.type){case"commandHandler":case"actionHandler":n=t.handler.getI18n().title+",";break;case"checkHandlerButton":n=(t.handler.getState()?t.handler.onCheckHandler:t.handler.onUncheckHandler).getI18n().title+",";break;case"set":n=L(t.view.dsModel.value.items);break;case"radioHandler":case"radioHandlerLoopButton":n=L(t.handler.items)}if(null!==e.getAttribute("data-wafrpageobectuseonlysecondaryarea")){n=e.getAttribute("data-wafrpageobectuseonlysecondaryarea")+n}e.setAttribute("data-wafrpageobectuseonlysecondaryarea",n)}function k(e){if(!e)throw new Error("executionContext not found");const t=e.getSourceApp(),n=t?t.getId():void 0,i=e.getTargetApp(),o=i?i.getId():void 0;return o||n}function O(e,t,n,i){let o=e.getData(),r=C.start([v,"[Async] generateTweaker",e.getId()].join(" ")),a=[],s=e.getForwardIterator();for(;s.isValid();){let e=s.get().getData();a.push(e.handler),s.next()}let l=t.handlerSet({value:{items:a},typePath:o.type,touchMode:i,modelEventsCpt:n,showLabelFlag:this._showLabelFlag,appId:k(this._uiComponent.getExecutionContext())});return this._tweakersView.push(l),o.view=l.getContent(),C.stop(r),Promise.resolve()}function U(e,t,n,i){let o=null,r=e.getData();if(r.handler){let e=r.handler,a=C.start([v,"[Async] generateTweaker",e.getId()].join(" ")),s=t[r.type]({value:e,typePath:r.type,touchMode:i,modelEventsCpt:n,showLabelFlag:this._showLabelFlag,appId:k(this._uiComponent.getExecutionContext())});this._tweakersView.push(s);let l=s.getContent();r.view=l,C.stop(a),o=Promise.resolve()}else console.error(r.label,"is not a handler"),o=Promise.resolve(new Error(r.label+" is not a handler"));return o}function R(e){return Object.assign({},e)}function T(){if(!this)throw new Error("panel must be defined");var e=C.start([v,"[Sync] computeCompactWidth",this.identifier].join(" "));if(!this._afr._isContentInitialized)return void C.stop(e);var t=this.content.parentNode.getBoundingClientRect().height;if(t<0)throw C.stop(e),new Error("panelHeight must not be a negative number");if(0===t)return void C.stop(e);var n=this.content.getElementsByClassName("wafr-toolbar-section-group"),i=0;let o=n.length;if(o>0){var r=window.getComputedStyle(n[0],null);t-=parseInt(r.paddingTop,10),t-=parseInt(r.paddingBottom,10),i=parseInt(r.paddingLeft,10)+parseInt(r.paddingRight,10)}for(var a=this.content.getElementsByClassName("wafr-toolbar-section-group-primary"),s=null,l=null,d=0,u=0,c=0,h=a.length,p=null,_=null,f=null;c<h;++c){if((f=(p=a[c]).getElementsByClassName("wafr-tweakers"))&&(_=Array.from(f)),!_)throw C.stop(e),new Error("Empty group");if(null===s&&f.length>0){var m=window.getComputedStyle(f[0],null),g=parseInt(m.paddingTop,10)+parseInt(m.paddingBottom,10);s=_[0].getBoundingClientRect().height+g}var w=0;s>0&&(w=Math.floor(t/s)),0===w&&(w=1);for(var M=Math.ceil(_.length/w),b=0,x=1,A=0,y=0;b<M;++b){for(var E=_[A].getBoundingClientRect().width;x<=w&&A<_.length;)(l=_[A].getBoundingClientRect().width)>E&&(E=l),++A,++x;x=1,y+=E}d=y,(c>0||0===c&&0===f.length)&&(d+=1),p.style.width=Math.ceil(d)+"px",u+=Math.ceil(d)}let B=function(e,t){let n=0,i=0;if(!e)throw new Error("panel must be defined");t<=0&&(t=1);let o=C.start([v,"[Sync] computeSecondaryCompactWidth",e.identifier].join(" ")),r=e.content.getElementsByClassName("wafr-toolbar-section-group-secondary");if(r.length<=0)return i;window.getComputedStyle(r[0],null);let a,s=null,l=0,d=r.length,u=null,c=null,h=null,p=0,_=null;r[0]&&r[0].children&&("wafr-ui-control-expander-button-collapsed"===r[0].firstChild.className||"wafr-ui-control-expander-button-expanded"===r[0].firstChild.className)&&(_=r[0].firstChild);if(_){p=_.getBoundingClientRect().width;let e=window.getComputedStyle(_,null);a=parseInt(e.paddingLeft,10)+parseInt(e.paddingRight,10),p=a+p}for(;l<d;++l){if(u=r[l],(h=u.getElementsByClassName("wafr-ui-control-expander-item-container"))&&(c=h[0]),n=p,!c||0===c.length){i+=n,u.style.width=Math.ceil(n)+"px";continue}let e=Math.ceil(c.childNodes.length/t),o=0,a=1,d=0,_=0;for(;o<e;++o){let e=c.childNodes[d].getBoundingClientRect().width;for(;a<=t&&d<c.length;)(s=c.childNodes[d].getBoundingClientRect().width)>e&&(e=s),++d,++a;a=1,_+=e}n+=_,i+=Math.ceil(n),u.style.width=Math.ceil(n)+"px"}return C.stop(o),i}(this,w);u+=B,u+=o*i,this.content.style.width=u+"px",this.fire("dimensionsChanged"),C.stop(e)}function V(e){for(var t=C.start([v,"[Sync] computeAndResizeForAllPanels"].join(" ")),n=0,i=e.length,o=null;n<i;++n)!1!==(o=e[n])._afr._isContentInitialized&&(o.content.classList.contains("column")?(-1!==o.height&&(o.height=-1),o.windowGroup&&-1!==o.windowGroup.height&&(o.windowGroup.height=-1)):(-1!==o.width&&(o.width=-1),o.windowGroup&&-1!==o.windowGroup.width&&(o.windowGroup.width=-1)),o.currentDockArea!==WUXDockAreaEnum.TopDockArea&&o.currentDockArea!==WUXDockAreaEnum.BottomDockArea||o._afr._bound_computeCompactWidth());C.stop(t)}function H(e,t){e.content.style.height="",e.content.style.width="auto";for(var n=e.content.getElementsByClassName("wafr-toolbar-section-group-secondary"),i=0,o=n.length,r=null;i<o;++i)(r=n[i])&&(r.style.width="auto",t?(r.classList.add("wafr-ui-control-expander-horizontal"),r.classList.remove("wafr-ui-control-expander-vertical")):(r.classList.remove("wafr-ui-control-expander-horizontal"),r.classList.add("wafr-ui-control-expander-vertical")))}function X(){var e=C.start([v,"[Sync] onPrePlaceChangeCB"].join(" ")),t=this.panel;if(!t)throw C.stop(e),new Error("panel must be defined");t.currentDockArea===WUXDockAreaEnum.TopDockArea||t.currentDockArea===WUXDockAreaEnum.BottomDockArea?(t.content.classList.remove("column"),t.resizableFlag="vertical",t.minHeight>0&&(t.height=t.minHeight),t.removeEventListener("resize",t._afr._bound_computeCompactWidth),t.addEventListener("resize",t._afr._bound_computeCompactWidth),t.removeEventListener("activate",t._afr._bound_computeCompactWidth),t.addEventListener("activate",t._afr._bound_computeCompactWidth),H(t,!0)):(t.removeEventListener("resize",t._afr._bound_computeCompactWidth),t.removeEventListener("activate",t._afr._bound_computeCompactWidth),function(e){e.content.style.height="",e.content.style.width="auto";for(var t=e.content.getElementsByClassName("wafr-toolbar-section-group-primary"),n=0,i=t.length;n<i;++n)t[n].style.width="auto"}(t),t.content.classList.add("column"),t.resizableFlag="horizontal",H(t,!1)),V(this.mainUIComponentManager._panels),C.stop(e)}function N(e){return"item"===e||"section"!==e&&"group"!==e&&"set"!==e&&"secondaryArea"!==e}return n.extend({defaultOptions:{availability:!0,visibleFlag:!0},init:function(e){this.options=t.extend(t.clone(this.defaultOptions),e),this._parent(),this._panels=[],this._tweakersView=[],this._touchMode=a.getTouchMode(),this._defaultTabOrder=[],this._isViewGenerated=!1,this._showLabelFlag=!1,this._originalTouchValue=this._touchMode,this._handleTouchChange(),this._manageBrowserZoom()},createView:function(e,t,n,o,r,a){var l=this;let d=[],u=function(e,t,n){let i=new(0,s.TreeModel)({identifier:"root"});for(let t=0,o=e.length;t<o;++t){let o=R(e[t].options.grid);if(o.hasOwnProperty("category")&&void 0!==o.category){let e=o.category;Array.isArray(o.category)&&(e=o.category[0]);let t=null,r=i.getChild(e);if(!r){let t=e;n&&n[e]&&n[e].internationalization&&n[e].internationalization.title&&(t=n[e].internationalization.title),r=i.addChild({identifier:e,title:t,type:"section"})}if(t=r,o.group||(o.group=`${e}_defaultGroup`),o.hasOwnProperty("group")&&void 0!==o.group){let e=t.getChild(o.group);e||(e=t.addChild({identifier:o.group,type:"group"})),t=e}if(o.priority){if(o.priority>1){let e=t.getChild(o.group+"_Secondary");e||(o.group=o.group+"_Secondary",e=t.addChild({identifier:o.group,type:"secondaryArea"})),e.type="secondaryArea",t=e}}else o.priority=1;if(o.hasOwnProperty("set")&&void 0!==o.set){let e=t.getChild(o.set);e||(e=t.addChild({identifier:o.set,type:"set"})),t=e}t.addChild(o)}else console.error("Item must at least have a category property",o)}return t&&i.reorder(t),i}(e,t,n);{let e={section:S,group:W,set:O,secondaryArea:I,item:U},t=[],n=[];{let e=u.getForwardIterator();for(;e.isValid();)"WAfrFront"!==e.get().getId()&&t.push(e.get()),e.next()}let s=[...t];for(;s.length>0;){let t=s.pop(),i=t.getData().type;if(N(i)&&(i="item"),n.push(e[i].call(this,t,o,r,a)),"set"===i)continue;let l=t.getBackwardIterator();for(;l.isValid();)s.push(l.get()),l.next()}d.push(Promise.all(n).then(function(){for(s=[...t];s.length>0;){let e=s.pop(),t=e.getData().type;if(N(t)&&(t="item"),"set"===t)continue;let n=e.getForwardIterator(),i=e.getData().view;for(;n.isValid();){let t=n.get(),o=t.getData();if(s.push(t),o.view)if("secondaryArea"===e.type)p.addItem(i,o.view),P(i,o);else if(1===o.priority||"set"===o.type){i.childNodes[0].appendChild(o.view)}else i.appendChild(o.view);n.next()}}}).then(function(){s=[...t];let e=null,n=l._uiFrame.getUIFrame(),o=l._uiFrame.getImmersiveFrame();o.remove();let r=M,d=48,u=l._showLabelFlag;u?(r=b,d=74):a&&(r=x,d=50,u&&(d=74));for(let t=0,n=s.length;t<n;++t){let n=s[t].getData(),a=n.title,u=document.createElement("div");u.classList.add("wafr-toolbar-section"),u.setAttribute("wafr-po-use-only-section-title",n.title),u.appendChild(n.view);let c="WAfrUIModelMainComponent"+n.identifier,h=new i({title:a,identifier:c,content:u,immersiveFrame:_?null:o,resizableFlag:!0,movableFlag:!0,currentDockArea:WUXDockAreaEnum.BottomDockArea,closeButtonFlag:!1,usePaddingFlag:!1,minHeight:d,minWidth:r,onContextualEvent:function(e){return l.getCtxMenu({that:l,panel:this,params:e})}});h._afr=Object.create(null),h._afr._bound_computeCompactWidth=T.bind(h),h._afr._bound_onPrePlaceChangeCB=X.bind({panel:h,mainUIComponentManager:l}),h.addEventListener("prePlaceChange",h._afr._bound_onPrePlaceChangeCB),h._afr._isContentInitialized=!0,_||h._afr._bound_onPrePlaceChangeCB(),n.view=h,l._panels.push(h),e?h.attachToWindow(e,WUXSnapAreaEnum.InsideArea):e=h}if(_)for(const e of l._panels)e.immersiveFrame=o,e._afr._bound_onPrePlaceChangeCB();if(e){let t,n=e.windowGroup;if(n){if((t=n.getEmbeddedWindows())&&t.length&&t.length>1){let i=[t[0]];("WAfrUIModelMainComponentWAfrStandard"===e.identifier||"WAfrUIModelMainComponentFixed Area"===e.identifier&&t.length>2)&&(i.push(t[1]),sessionStorage.getItem("WAfrABV3FirstLaunch")||(sessionStorage.setItem("WAfrABV3FirstLaunch","true"),"WAfrUIModelMainComponentWAfrStandard"===e.identifier?l.pinSection("WAfrStandard"):"WAfrUIModelMainComponentFixed Area"===e.identifier&&l.pinSection("Fixed Area"))),n.currentWindows=i}n._tab.tabBar.addEventListener("pinStateChange",e=>{l._panels[e.dsModel.value].pinnedFlag||(l._panels[e.dsModel.value]._afr._pinnedByCode=void 0)})}}let c=o.getDockingElement(WUXDockAreaEnum.BottomDockArea);void 0!==c&&(c.minSize=F(l._touchMode,l._showLabelFlag),c.dockingZoneSize=c.minSize,c.elements.dockingWithCollapserContainer.classList.add("WAfrPageObjectUseOnly-WAfr-Actionbar")),o.inject(n),V(l._panels),l._isViewGenerated=!0}))}return Promise.all(d)},generate:function(e){var t=C.start([v,"[Sync] generate"].join(" ")),n=this;if(void 0===n||void 0===n._uiComponent||void 0===n._uiComponent._properties||void 0===n._uiComponent._properties.flatModel)return void C.stop(t);var i=n._uiComponent._properties;n._touchMode=e.touchMode;var o=i.flatModel.getChildren();if(void 0===o||void 0===o.length||0===o.length)return void C.stop(t);let r=this._uiComponent.getExecutionContext();if(!r)throw new Error("executionContext not found");let a=r.getComponent(w);if(!a)throw new Error("modelEventsCpt not found");let s=null;if(this._uiComponent._isMABAvailable){let t=new f(n._uiFrame.getContainer(),l);s={hide:function(){t.isGenerated()&&t.hide()},show:function(){let i=Promise.resolve();return t.isGenerated()||(i=t.generate(o,n._defaultTabOrder,n._uiComponent.getCategories(),l,a,e.touchMode)),i.then(function(){t.show()})},destroy:function(){t.destroy()}}}let d={hide:function(){n.isGenerated()&&n.hide()},show:function(){let t=Promise.resolve();return n.isGenerated()||(t=n.createView(o,n._defaultTabOrder,n._uiComponent.getCategories(),l,a,e.touchMode)),t.then(function(){return n.show()})}};return this._actionBarResponsiveManager=new m(d,s),this._actionBarResponsiveManager.compute().then(()=>(C.stop(t),Promise.resolve()))},setContext:function(e){void 0!==e.executionContext&&(this._executionContext=e.executionContext),void 0!==e.UIComponent&&(this._uiComponent=e.UIComponent),void 0!==e.UIFrame&&(this._uiFrame=e.UIFrame)},getCtxMenu:function(e){var t=e.that,n=[];return n.push({type:"PushItem",title:h.get(!0===t._showLabelFlag?"iconLabelHide.title":"iconLabel.title"),icon:"",action:{callback:function(e){t.toggleButtonLabel()}}},{type:"PushItem",title:h.get("resetActionBar.title"),icon:"",action:{callback:function(e){t.resetPositionMainComponent()}}}),n},resetPositionMainComponent:function(){var e,t,n,i;this._panels.forEach(function(i){void 0===e?(i.deleteWindowPreferences(),n=i.windowGroup,i.currentDockArea=WUXDockAreaEnum.BottomDockArea,e=i):(i.windowGroup=null,i.deleteWindowPreferences(),i.attachToWindow(t,WUXSnapAreaEnum.InsideArea,"after")),t=i}),i=[this._panels[0]],("WAfrUIModelMainComponentWAfrStandard"===e.identifier||"WAfrUIModelMainComponentFixed Area"===e.identifier&&this._panels.length>2)&&i.push(this._panels[1]),n&&(n.currentWindows=i)},toggleButtonLabel:function(e){var t=this;if(t._showLabelFlag=!0!==t._showLabelFlag,t._tweakersView.forEach(function(e){void 0!==e&&(e.showLabelFlag=t._showLabelFlag)}),!t._panels[0].immersiveFrame)throw new Error("no immersive frame related to this panel",t._panels[0]);D(t);var n=t._panels[0].immersiveFrame.getDockingElement(WUXDockAreaEnum.BottomDockArea);if(!n)throw new Error("no bottom dock area in this immersive frame",t._panels[0].immersiveFrame);n.minSize=F(t._touchMode,t._showLabelFlag),n.dockingZoneSize=n.minSize;let i=48,o=t._showLabelFlag;o?i=74:t._touchMode&&(i=50,o&&(i=74)),t._panels.forEach(function(e){e.minHeight=i,e.currentDockArea!==WUXDockAreaEnum.TopDockArea&&e.currentDockArea!==WUXDockAreaEnum.BottomDockArea||e._afr._bound_computeCompactWidth()})},clean:function(){var e,t=this,n=t._uiFrame;if(n&&(e=n.getImmersiveFrame()),t._tweakersView=[],e&&t._panels)for(var i;0!==t._panels.length||void 0!==t._panels[0];){i=t._panels[0],t._panels.splice(0,1),i.removeEventListener("resize",i._afr._bound_computeCompactWidth),i.removeEventListener("activate",i._afr._bound_computeCompactWidth),i.removeEventListener("prePlaceChange",i._afr._bound_onPrePlaceChangeCB),delete i._afr._bound_computeCompactWidth,delete i._afr._bound_onPrePlaceChangeCB,delete i._afr._isContentInitialized,delete i._afr._pinnedByCode;var o=null;for(o in i._afr)i._afr.hasOwnProperty(o)&&console.error(o," must be cleaned");i&&(e.removeWindow(i),i.destroy())}if(this._actionBarResponsiveManager){let e=this._actionBarResponsiveManager.getSmallViewportActionBar();e&&e.destroy(),this._actionBarResponsiveManager.clean(),delete this._actionBarResponsiveManager}this._isViewGenerated=!1,delete this._isHidden,sessionStorage.removeItem("WAfrABV3FirstLaunch")},hide:function(){if(!this._isHidden){this._isHidden=!0;var e=this;e._activatedSections=[],void 0!==e&&void 0!==e._panels&&(e._activatedSections=e.getActiveSections(),e._panels.forEach(function(e){e.visibleFlag&&(e.visibleFlag=!1)}))}},isGenerated:function(){return this._isViewGenerated},show:function(){let e=null;if(void 0===this._isHidden||this._isHidden){this._isHidden=!1;var t=this;if(t._uiComponent._isMABAvailable&&t._mabOnScreen)return;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel)if(0===t._panels.length){var n=t._uiComponent._properties.flatModel.getChildren();void 0!==n&&0!==n.length&&(e=t.generate({touchMode:t._touchMode}))}else t._panels.forEach(function(e){e.visibleFlag||(e.visibleFlag=!0)});t._activatedSections&&t.activateSections(t._activatedSections)}return e||Promise.resolve()},activateSection:function(e){var t=this;void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length&&t._panels.forEach(function(t){var n="WAfrUIModelMainComponent"+e;t.identifier===n&&(t.ensureVisible(),t.currentDockArea===WUXDockAreaEnum.BottomDockArea&&t._afr._bound_computeCompactWidth())})},activateSections:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n=[];e.forEach(function(e){var i="WAfrUIModelMainComponent"+e;t._panels.forEach(function(e){e.identifier===i&&(e.expandedFlag=!0,e.visibleFlag=!0,e.windowGroup&&(e.windowGroup.ensureVisible(),n.push(e),e.windowGroup.currentWindows=n),e.currentDockArea===WUXDockAreaEnum.BottomDockArea&&e._afr._bound_computeCompactWidth())})})}},getActiveSections:function(){var e=this,t=[];return void 0!==e&&void 0!==e._panels&&void 0!==e._uiComponent&&void 0!==e._uiComponent._properties&&void 0!==e._uiComponent._properties.flatModel&&0!==e._panels.length&&e._panels.forEach(function(e){e.windowGroup&&-1!==e.windowGroup.currentWindows.indexOf(e)&&t.push(e.identifier.replace("WAfrUIModelMainComponent",""))}),t},pinSection:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n="WAfrUIModelMainComponent"+e;for(const e of t._panels)if(e.identifier===n)return e._afr._pinnedByCode=!0,e.pinnedFlag=!0,!0}return!1},unpinSection:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n="WAfrUIModelMainComponent"+e;for(const e of t._panels)if(e.identifier===n)return e._afr._pinnedByCode=!1,e.pinnedFlag=!1,!0}return!1},isSectionPinnedByUser:function(e){var t=this;if(void 0!==t&&void 0!==t._panels&&void 0!==t._uiComponent._properties&&void 0!==t._uiComponent._properties.flatModel&&0!==t._panels.length){var n="WAfrUIModelMainComponent"+e;for(const e of t._panels)if(e.identifier===n&&e.pinnedFlag&&void 0===e._afr._pinnedByCode)return!0}return!1},setTouchMode:function(e){e!==this._touchMode&&this.toggleButtonLabel()},setActivatedCategory:function(e){this._defaultActivatedCategory=e},setCategoriesOrder:function(e){void 0!==e&&void 0!==e.length&&(this._defaultTabOrder=e)},_setActiveCategory:function(e){if(void 0!==e&&void 0!==e.windowGroup&&void 0!==e.windowGroup.getEmbeddedWindows&&void 0!==e.windowGroup.getEmbeddedWindows()&&e.activeCategoryId){var t=e.windowGroup.getEmbeddedWindows(),n=0;for(n=0;n<t.length;n++){var i=t[n].identifier;if(0===i.search("WAfrUIModelMainComponent")&&i.slice(24)===e.activeCategoryId){e.windowGroup.currentWindows=[t[n]];break}}}},_reorderCategories:function(e){var t=e.orderPreferences,n=e.tabPanels;if(void 0!==e&&void 0!==n&&void 0!==t&&void 0!==t.length){var i=0,o=0,r=-1;for(i=0;i<t.length;i++){var a=t[i];for(o=0;o<n.length;o++){var s=n[o].identifier;if(0===s.search("WAfrUIModelMainComponent")&&s.slice(24)===a){if(r>o){var l=n.splice(o,1);n.splice(r,0,l[0])}else r=o;break}}}}},_handleTouchChange:function(){var e=this;document.addEventListener("touchChange",function(){if(e._touchMode=!e._touchMode,e._panels&&e._panels.length>0){if(!e._panels[0].immersiveFrame)throw new Error("no immersive frame related to this panel",e._panels[0]);D(e);var t=e._panels[0].immersiveFrame.getDockingElement(WUXDockAreaEnum.BottomDockArea);if(!t)throw new Error("no bottom dock area in this immersive frame",e._panels[0].immersiveFrame);t.minSize=F(e._touchMode,e._showLabelFlag),t.dockingZoneSize=t.minSize,V(e._panels)}})},_manageBrowserZoom:function(){var e=this;let t=window.devicePixelRatio||window.screen.availWidth/document.documentElement.clientWidth;window.addEventListener("resize",function(){var n=window.devicePixelRatio||window.screen.availWidth/document.documentElement.clientWidth;n!=t&&(t=n,V(e._panels))})}})});