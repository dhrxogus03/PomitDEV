/*! -- Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/W3DSpace/EnoviaBootstrap",["UWA/Core","UWA/Class/Collection","UWA/Class/Listener","UWA/Utils","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],function(e,t,n,i,o,s,a){"use strict";var l,r,c,d,u,m,p=!1,h=!1;function g(){var t;t=a.authenticatedRequest,a.authenticatedRequest=function(n,i){var o,s,a,l,d;return r&&(o=r.getStorageWithUrl(n)),e.is(o)&&(n!==(l="url",(a=o)&&(d=a[l],e.is(d,"function")&&(d=d.call(a))),d)&&(i||(i={}),i.headers||(i.headers={}),i.headers["X-DS-CSRFTOKEN"]=c||"",widget&&widget.lang&&(i.headers["Accept-Language"]=widget.lang)),n=n+(-1===n.indexOf("?")?"?":"&")+"tenant="+o.id),s=i.onComplete,i.onComplete=function(t,n,i){var o=Object.keys(n).filter(function(e,t){return-1!==e.search(/x-ds-csrftoken/i)});c=o.length>0?n[o[0]]:c,e.is(s,"function")&&s(t,n,i)},t(n,i)}}return e.merge(n,{start:function(t){p||(t.frameENOVIA&&(h=!0),t=t?e.clone(t,!1):{},r=t.collection,function(e){if(l)return l;var t="com.ds."+e.id;(l=new i.InterCom.Socket(t)).subscribeServer("com.ds.compass",window.parent)}(t),g(),u||s.getServiceUrl({serviceName:"3DSwym",onComplete:function(e){var t;if(u=e,d&&(t=d.id),t&&u)for(var n=0;n<u.length;n++)if(t===u[n].platformId){m=u[n].url;break}},onFailure:function(e){u=[]}}),p=!0)},onStorageChange:function(t,n){var i=t.get("csrf");d=t,e.is(i)?n.onComplete&&n.onComplete():d.fetch({onComplete:n.onComplete,onFailure:function(e,t){n.onFailure(t)}});var o=d.id;if(o&&u)for(var s=0;s<u.length;s++)if(o===u[s].platformId){m=u[s].url;break}},getCompassSocket:function(){if(p)return l},getSyncOptions:function(){return h?{}:{ajax:a.authenticatedRequest}},getStorages:function(){if(p)return r},getStorage:function(){if(p)return d},getSwymUrl:function(){if(m)return m}})}),define("DS/W3DSpace/Views/ModalDisplaySecurityContexts",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","UWA/Class/Promise","DS/WAFData/WAFData","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,s,a,l,r){"use strict";return t.extend({init:function(t){t=e.clone(t||{},!1),this._parent(t),this.getCredentials()},createModal:function(t){var a,l,c,d="",u=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"warning"}),m=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"primary"}),p=e.createElement("div",{class:"credentials-container"});if(t.length>100){var h=this.options.model.get("login");u.add({message:r.replace(r.credentialsWarning,{login:h,credentials:t.length})})}if(0===t.length){h=this.options.model.get("login");m.add({message:r.replace(r.credentialsListEmpty,{login:h})})}else{for(var g=0;g<t.length;g++)d=t[g].project.name+"●"+t[g].company.name+"●"+t[g].role.name,c=e.createElement("li",{html:d}),p.addContent(c);l=new o({value:r.close,events:{onClick:function(){a.destroy()}}});new s({element:p});a=this.elements.modal=new n({closable:!0,header:r.credentialsList,body:p,footer:l}).inject(document.body),this.elements.modal.show()}},getCredentials:function(){var e=this.options.model.get("login"),t=this,n=this.options.model.collection.url;return n=n+"/"+e+"/credentials",new a(function(e,i){l.authenticatedRequest(n,Object.assign({method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(){return e(t.createModal(arguments[0]))},onFailure:function(){return i(arguments)}}))})}})}),define("DS/W3DSpace/Views/ManageMembers",["UWA/Class/View","UWA/Core","UWA/Controls/Abstract","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXPnOMultiOrg/OrgOperatorController"],function(e,t,n,i,o){"use strict";return n.extend({managememberClick:function(e){var n,s=e.config,a=e.model.model,l=a.get("owner"),r=document.createElement("div");r.classList.add("multiOrg"),r.classList.add("multiOrg--visible"),widget.body.appendChild(r),i.getUser({onComplete:function(e){n=e}}),e.config.user=n,a.drive=e.config,a.drive.set("user",n),a.set("owners",l);a.permissions=function(e,n,i){return new(0,e._Permissions)(n||[],t.merge({parentInode:a,auth:a._auth},i))}(s),a.permissions,window.selectedcollabSpace=a,window.orgOperatorController=new o({container:r,tenantId:e.config.id,currentUser:n.id,collabSpace:a.id,collabSpaceTitle:a.get("title"),securityContext:this.getNominalContexts(e.model.model),owner:this.isOwner(e.model.model).isOwner,ownerRestricted:this.isOwner(e.model.model).isOwnerRestricted,mainOwner:a.get("owner").login,roles:e.config.get("availableRoles"),onAddUsers:function(){(function(e){require(["DS/W3DSpaceComponents/Views/shareCollaborativeSpace"],function(t){t(e)})}).call(this,window.selectedcollabSpace)},onCloseView:function(){document.querySelector(".multiOrg").destroy(),widget.removeEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)}),orgOperatorController.destroy(),orgOperatorController=null}}),widget.addEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)})},getNominalContexts:function(e){var t,n,i=e.get("contexts");if(i.length>1){for(t=0;t<i.length&&"VPLMProjectAdministrator"!==(n=i[t]).role&&"3DSRestrictedOwner"!==n.role;t++);return n.name}return"object"==typeof i[0]?i[0].name:i},isOwner:function(e){e.get("contexts");return!0,{isOwner:!0,isOwnerRestricted:void 0}}})}),define("DS/W3DSpace/Models/CSMember",["UWA/Class/Model","UWA/String"],function(e,t){"use strict";return e.extend({idAttribute:"physicalid",defaults:{type:"",id:"",role:{}},getActionIds:function(){return this.get("actions")||[]},isUser:function(){return"Person"===this.get("type")},isGroup:function(){return"Group"===this.get("type")},isPending:function(){return this.get("id")===this.get("email")},isActionAllowed:function(e){return-1!==this.getActionIds().indexOf(e)}})}),define("DS/W3DSpace/Utils/Metrics",["DS/Usage/TrackerAPI"],function(e){"use strict";return{trackAction:function(e){if(!e.model)throw new Error("A model is mandatory to track an action.");var n=e.model,i=e.tenant,o=n.drive?n.drive.get("title"):"3DEXPERIENCE",s=e.appContext||"",a={pd1:o,pd3:s,pd6:"collabspace"};t({tenantID:i,eventCategory:"CSCC.action",eventAction:e.eventAction,eventDimensions:a})},trackNavigation:function(e){var n=e.tenant?e.tenant:"",i={pd6:"collabspace",pd8:e.startingRouteType};t({tenantID:n,eventCategory:"CSCC.navigation",eventAction:e.eventAction,eventLabel:e.eventLabel,eventValue:e.eventValue,eventDimensions:i})}};function t(t){var n=t.tenantID||"",i=t.eventDimensions||{};return e.trackPageEvent({eventCategory:t.eventCategory,eventAction:t.eventAction,eventLabel:t.eventLabel,eventValue:t.eventValue,appID:"X3DOPCS_AP",tenant:n,persDim:i})}}),define("DS/W3DSpace/Collections/CSMembers",["UWA/String","UWA/Core","DS/WebAppsFoundations/Collections/PageableCollection","UWA/Class/Collection","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Models/CSMember"],function(e,t,n,i,o,s){"use strict";function a(e,n){var i;return e&&(i=e[n],t.is(i,"function")&&(i=i.call(e))),i}return i.extend({model:s,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0,type:"",role:"",title:""},queryParams:{currentPage:"page",pageSize:"limit"},url:function(){return"/admin/collabspaces/"+this._parentInode.get("name")+"/allmembers"},init:function(e,t){var n=(t=t||{}).parentInode;if(!n||!n.id)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._parent.apply(this,arguments)},setup:function(e,t){var n=t.parentInode;this._parentInode=n;var i=o.getStorage().get("url")+"/resources/enocsmrest";this.url=i+Object.getPrototypeOf(this).url.call(this)},fetch:function(e){a(this,"url");e=e?t.clone(e,!1):{},t.extend(e,o.getSyncOptions(),!0);var n=Object.keys(this.queryParams).reduce(function(e,t){},{});return e.data=Object.assign({withactions:!0,sort:"atitle"},e.data,n),this._parent.call(this,e)},create:function(n,i){a(this,"url");return i.url=e.format("{0}/resources/enocsmrest/admin/collabspaces/{1}/allmembers/batch",i.auth.getStorage().url3DSpace,this._parentInode.id),i=i?t.clone(i,!1):{},t.extend(i,o.getSyncOptions(),!0),this._parent(n,i)}})}),define("DS/W3DSpace/Models/AdminPeopleModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n){"use strict";return t.extend({idAttribute:"login",sync:function(t,i,o){return e.extend(o,e.extend(n.getSyncOptions(),{attrs:JSON.stringify(i.toJSON(o))},!0),!0),delete o.data,this._parent.apply(this,arguments)}})}),define("DS/W3DSpace/Models/AdminCollabSpaceModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n){"use strict";return t.extend({idAttribute:"name",sync:function(t,i,o){return e.extend(o,e.extend(n.getSyncOptions(),{attrs:JSON.stringify(i.toJSON(o))},!0),!0),delete o.data,this._parent.apply(this,arguments)},parse:function(t){return!e.is(t.description)&&(t.description=""),t}})}),define("DS/W3DSpace/Models/CollabStorageModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/Collections/CSMembers","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n,i){"use strict";return t.extend({name:"collabstorage",_Permissions:n,defaults:{csrf:null,isInnovation:!1,displayName:"",url:""},url:function(){return this.get("url")+"/resources/enocsmrest/session"},fetch:function(t){var n,o,s;o="url",(n=this)&&(s=n[o],e.is(s,"function")&&(s=s.call(n)));return t=t?e.clone(t,!1):{},e.extend(t,i.getSyncOptions(),!0),this._parent.call(this,t)},parse:function(t){var n=e.clone(t);return n.csrf=t.csrftoken,delete n.csrftoken,n.isInnovation=t.isinnovation,delete n.isinnovation,n}})}),define("DS/W3DSpace/Views/CSEditDetailsView",["UWA/Core","DS/WAFData/WAFData","UWA/Element","DS/UIKIT/Alert","DS/UIKIT/Autocomplete","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Modal","DS/UIKIT/Tooltip","UWA/Class/View","DS/W3DSpace/EnoviaBootstrap","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,s,a,l,r,c,d,u,m,p){"use strict";var h=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),g=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"warning"}),f=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"});return d.extend({name:"CSEditDetails",tagName:"div",className:"cs-edit-details-view",init:function(e){var t=UWA.clone(e,!1);["id","className","attributes","container","template","tagName","domEvents"].forEach(function(e){delete t[e]}),this._parent(t)},setup:function(){this._initActionsAllowed(),this._initUI(),this._initListenKeyDown(),this.options.visibilityChangeWarningDialogActive=!1},_initActionsAllowed:function(){var e=this.options;e.actionsAllowed={globalEditAllowed:!1,editTitleAllowed:!1,editDescriptionAllowed:!1,editVisibilityAllowed:!1},e.actions.forEach(function(t){"edit.title"===t?e.actionsAllowed.editTitleAllowed=!0:"edit.description"===t?e.actionsAllowed.editDescriptionAllowed=!0:"edit.visibility"===t&&(e.actionsAllowed.editVisibilityAllowed=!0)}),(e.actionsAllowed.editTitleAllowed||e.actionsAllowed.editDescriptionAllowed||e.actionsAllowed.editVisibilityAllowed)&&(e.actionsAllowed.globalEditAllowed=!0)},_initChangeListeners:function(){this.options.editableData={titleChanged:!1,descriptionChanged:!1,visibilityChanged:!1},document.querySelector("#cs-edit-title input").addEventListener("input",this.titleChanged.bind(this)),document.querySelector("#cs-edit-description textarea").addEventListener("input",this.descriptionChanged.bind(this))},_initUI:function(){var e,t,i,o,s,r,d,u,h,g,f,v,S,C,D,w=this.options,b=this.elements,y=[];i=new n("span",{id:"edit-pencil-icon",class:"fonticon fonticon-pencil",styles:{display:w.actionsAllowed.globalEditAllowed?"visible":"none"},events:{click:w.onEdit}}),new c({target:i,body:m.editProperties}),t=new n("div",{id:"cs-header",class:"cs-header-row",html:[{tag:"img",class:"cs-header-cell--thumbnail",src:this.model.get("thumbnail"),alt:"cs-thumbnail"},{tag:"h3",class:"cs-header-cell--title",text:this.model.get("title")},i]}),e=new n("div",{class:"cs-header-table",html:t}),r=new l({placeholder:p.placeholderTitle,maxlength:32,value:this.model.get("title")}),s=new n("div",{id:"cs-title",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",html:[{tag:"span",text:m.csDetailsTitle},{tag:"span",id:"cs-title-required",class:"cs-information-cell--required",text:m.required,styles:{display:"none"}}]},{tag:"div",id:"cs-view-title",class:"cs-information-cell--value",text:this.model.get("title")},{tag:"div",id:"cs-edit-title",class:"cs-information-cell--value",html:r,styles:{display:"none"}}]}),d=new n("div",{id:"cs-name",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",text:m.csDetailsName},{tag:"div",class:"cs-information-cell--value",text:this.model.get("name")}]}),h=new l({placeholder:p.placeholderDescription,multiline:!0,className:"not-resizable",maxlength:255,value:this.model.get("description")}),u=new n("div",{id:"cs-description",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",text:m.csDetailsDescription},{tag:"div",id:"cs-view-description",class:"cs-information-cell--value",text:this.model.get("description")},{tag:"div",id:"cs-edit-description",class:"cs-information-cell--value",html:h,styles:{display:"none"}}]}),g=new n("div",{tag:"div",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",text:m.csDetailsMainOwner},{tag:"div",class:"cs-information-cell--value",text:this.model.get("owner").name}]}),v=new a({placeholder:!1,showTooltips:!0,events:{onChange:this.visibilityChanged.bind(this)},options:[{value:"PRIVATE",label:p.private+" - "+p.privateDetail,selected:this.model.get("visibility").value.toUpperCase()==="Private".toUpperCase(),disabled:"STANDARDTEAM"===this.model.get("family").value.toUpperCase()},{value:"PROTECTED",label:p.protected+" - "+p.protectedDetail,selected:this.model.get("visibility").value.toUpperCase()==="Protected".toUpperCase(),disabled:"STANDARDTEAM"===this.model.get("family").value.toUpperCase()},{value:"PUBLIC",label:p.public+" - "+p.publicDetail,selected:this.model.get("visibility").value.toUpperCase()==="Public".toUpperCase()}]}),f=new n("div",{id:"cs-visibility",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",text:m.csDetailsVisibility},{tag:"div",id:"view-visibility",class:"cs-information-cell--value",text:this.model.get("visibility").name},{tag:"div",id:"edit-visibility",class:"cs-information-cell--value",styles:{display:"none"},html:v}]}),S=new n("div",{id:"cs-family",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",text:m.csDetailsFamily},{tag:"div",class:"cs-information-cell--value",text:this.model.get("family").name}]}),C=new n("div",{id:"cs-modified",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",text:m.csDetailsModificationDate},{tag:"div",class:"cs-information-cell--value",text:this.getDateStr(this.model.get("modified"))}]}),D=new n("div",{id:"cs-created",class:"cs-information-row",html:[{tag:"div",class:"cs-information-cell--name",text:m.csDetailsCreationDate},{tag:"div",class:"cs-information-cell--value",text:this.getDateStr(this.model.get("created"))}]}),y.push(s),y.push(d),y.push(u),y.push(g),y.push(f),y.push(S),y.push(C),y.push(D),o=new n("div",{class:"cs-information-table",html:y}),b.titleInput=r,b.descriptionInput=h,b.visibilitySelect=v,b.headerTable=e,b.informationTable=o},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this),document.addEventListener("keydown",this.onKeyDown)},getDateStr:function(e){if(!e)return"NA";let t="en";widget&&widget.lang&&(t=widget.lang);const n=new Date(1e3*Number(e));return n.toLocaleString(t,{year:"numeric",month:"short",day:"2-digit"})+" - "+n.toLocaleString("en",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23"})},onKeyDown:function(e){13===e.keyCode&&this.editViewActive&&!e.srcElement.type.contains("textarea")?this.options.visibilityChangeWarningDialogActive||this.onSave():27===e.keyCode&&(this.editViewActive?this.options.events.onCancel():this.options.events.onClose())},onConfirm:function(){var t,n,i,o=this,s=this.options,a=s.onComplete,l=s.onFailure,r=s.onTimeout,c={};if(t=this.model.get("title"),0!==(n=this.elements.titleInput.getValue().trim()).length){for(var d,u=0;u<"\\\"#$@%*,;?<>[]|:.'".length;u++)if(d="\\\"#$@%*,;?<>[]|:.'"[u],n.indexOf(d)>-1){return void h.add({message:p.replace(p.errorCharacterTitle,{tag1:" \\ \" # $ @ % * , ; ? < > [ ] | : . '"})})}t!==n&&(c.title=n),this.model.get("description")!==(i=this.elements.descriptionInput.getValue())&&(c.description=i),c.visibility={value:this.elements.visibilitySelect.getValue().toString()},s.onComplete=function(t,n,i){f.add({message:m.successEditChanges}),e.is(a)&&a.apply(void 0,arguments)},s.onFailure=function(t,n,i){o.model.collection.remove(t),h.add({message:m.errorEditChanges}),e.is(l)&&l.apply(void 0,arguments)},s.onTimeout=function(){g.add({message:m.EditChangesTimeout}),e.is(r)&&r.apply(void 0,arguments)},this.model.save(c,{onComplete:s.onComplete,onFailure:s.onFailure,onTimeout:s.onTimeout})}else h.add({message:p.errorEmptyTitle})},onSave:function(){var e,t=this,n=this.model.get("visibility").value,i=this.elements.visibilitySelect.getValue().toString(),o=this.model.get("title");if(n.toUpperCase()===i.toUpperCase())return this.dispatchEvent("onConfirm");var a=new s({value:p.confirm,className:"warning",events:{onClick:function(){t.dispatchEvent("onConfirm"),e.destroy()}}}),l=new s({value:p.cancel,events:{onClick:function(){e.destroy()}}});(e=new r({closable:!0,header:p.visibilityConfirmTitle,events:{onShow:function(){t.options.visibilityChangeWarningDialogActive=!0},onHide:function(){t.options.visibilityChangeWarningDialogActive=!1}},body:function(e,t,n){var i=["PRIVATE","PROTECTED","PUBLIC"],o=i.findIndex(t=>t===e.toUpperCase()),s=i.findIndex(e=>e===t.toUpperCase()),a=null;s>o?(a=p.replace(p.visibilityIncreaseConfirmMessage1,{name:n}),a+="<br><br><b>",a+=p.visibilityIncreaseConfirmMessage2+"</b>"):s<o&&(a=p.replace(p.visibilityReduceConfirmMessage1,{name:n}),a+="<br><br><b>",a+=p.visibilityReduceConfirmMessage2+"</b>");return a}(n,i,o),footer:[a,l]})).inject(document.body),e.show(),a.focus()},render:function(){var e=this.elements,t=e.headerTable,n=e.informationTable;return this.container.setContent([t,n]),this},showDetailsView:function(){(this.editViewActive=!1,document.querySelector(".fonticon.fonticon-pencil").style.display="inline-block",this.options.actionsAllowed.editTitleAllowed)&&(document.querySelector("#cs-title-required").style.display="none",document.querySelector("#cs-view-title").style.display="table-cell",document.querySelector("#cs-edit-title").style.display="none");this.options.actionsAllowed.editDescriptionAllowed&&(document.querySelector("#cs-view-description").style.display="table-cell",document.querySelector("#cs-edit-description").style.display="none");this.options.actionsAllowed.editVisibilityAllowed&&(document.querySelector("#view-visibility").style.display="table-cell",document.querySelector("#edit-visibility").style.display="none")},showEditView:function(){if(this.editViewActive=!0,document.querySelector(".fonticon.fonticon-pencil").style.display="none",this.options.actionsAllowed.editTitleAllowed){document.querySelector("#cs-title-required").style.display="inline-block",document.querySelector("#cs-view-title").style.display="none";var e=document.querySelector("#cs-edit-title");e.style.display="table-cell",e.getChildren()[0].focus()}this.options.actionsAllowed.editDescriptionAllowed&&(document.querySelector("#cs-view-description").style.display="none",document.querySelector("#cs-edit-description").style.display="table-cell");this.options.actionsAllowed.editVisibilityAllowed&&(document.querySelector("#view-visibility").style.display="none",document.querySelector("#edit-visibility").style.display="table-cell")},descriptionChanged:function(e){var t=this.model.get("description"),n=this.elements.descriptionInput.getValue().trim();this.options.editableData.descriptionChanged=t!==n,this.options.events.onDataChange(this.options.editableData)},titleChanged:function(e){var t=this.model.get("title"),n=this.elements.titleInput.getValue().trim();this.options.editableData.titleChanged=0!==n.length&&t!==n,this.options.events.onDataChange(this.options.editableData)},visibilityChanged:function(e){var t=this.model.get("visibility").value,n=this.elements.visibilitySelect.getValue().toString();this.options.editableData.visibilityChanged=t.toUpperCase()!==n.toUpperCase(),this.options.events.onDataChange(this.options.editableData)}})}),define("DS/W3DSpace/Collections/AdminPeopleCollection",["UWA/Core","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DSpace/Models/AdminPeopleModel","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n,i,o){"use strict";return n.extend({name:"peoples",defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"total"}},model:i,url:function(){return"/admin/"+this.name},setup:function(e,n){var i=n._modelKey;i&&i instanceof t&&(this._modelKey=i,this.url=i.url()+Object.getPrototypeOf(this).url.call(this)),widget&&this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})},sync:function(t,n,i){e.extend(i,o.getSyncOptions(),!0),this._parent.apply(this,arguments)},fetch:function(e){return this.currentSearchUrl&&(e.url=this.currentSearchUrl),this._parent.call(this,e)},parseResponseForStateUpdate:function(e,t,n,i){return{totalRecords:e.total}},parseRecords:function(e,t){return e.peoples},onSearch:function(t){if(t){var n=(e.is(this.url,"function")?this.url():this.url)+"?filter="+t;n!==this.currentSearchUrl&&(this.currentSearchUrl=n,this.dispatchEvent("onSearch"))}},onResetSearch:function(){this.currentSearchUrl=null,this.dispatchEvent("onSearchReset")}})}),define("DS/W3DSpace/Collections/AdminCollabSpacesCollection",["UWA/Core","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DSpace/Models/AdminCollabSpaceModel","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n,i,o){"use strict";return n.extend({name:"collabspaces",defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"csTotal"}},model:i,url:function(){return"/admin/"+this.name},setup:function(e,n){var i=n._modelKey,s=o.getStorage().get("url")+"/resources/enocsmrest";i&&i instanceof t&&(this._modelKey=i,this.url=s+Object.getPrototypeOf(this).url.call(this)),widget&&this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})},sync:function(t,n,i){e.extend(i,o.getSyncOptions(),!0),this._parent.apply(this,arguments)},fetch:function(e){if(this.currentSearchUrl&&(e.url=this.currentSearchUrl),null===this.state.totalRecords||void 0!==e.to)return this._parent.call(this,e)},parseResponseForStateUpdate:function(e,t,n,i){return{totalRecords:e.csTotal}},parseRecords:function(e){return e.items},onSearch:function(t){if(t){var n=(e.is(this.url,"function")?this.url():this.url)+"?filter="+encodeURIComponent(t);n!==this.currentSearchUrl&&(this.currentSearchUrl=n,this.dispatchEvent("onSearch"))}},onResetSearch:function(){this.currentSearchUrl=null,this.dispatchEvent("onSearchReset")}})}),define("DS/W3DSpace/Views/ModalCSEditDetails",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/W3DSpace/Utils/Metrics","DS/W3DSpace/Views/CSEditDetailsView","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(e,t,n,i,o,s,a,l){"use strict";function r(e){return o.trackAction(Object.assign(e,{model:e.model}))}return t.extend({init:function(t){var o,c,d,u,m,p,h,g,f,v=this;t=e.clone(t||{},!1),this._parent(t),o=e.clone(t.events||{},!1),c=t.onComplete,d=t.onFailure,o.onCancel,u=o.onClose,f=function(){document.removeEventListener("keydown",m.onKeyDown),m.destroy(),v.destroy()},o.onClose=function(){f(),e.is(u)&&u.apply(this,arguments)},o.onCancel=function(){v.elements.modal.setFooter([p]),m.showDetailsView()},o.onDataChange=function(e){e.titleChanged||e.descriptionChanged||e.visibilityChanged?h.enable():h.disable()},t.events=o,t.onComplete=function(){f(),e.is(c)&&c.apply(void 0,arguments),r({eventAction:"saveProperties",model:t.model,tenant:t.tenant})},t.onFailure=function(){f(),e.is(d)&&d.apply(void 0,arguments)},t.onEdit=function(){v.elements.modal.setFooter([h,g]),m.showEditView(),r({eventAction:"editProperties",model:t.model,tenant:t.tenant})},m=new s(t),this.elements.myContent=m,p=new i({value:l.close,events:{onClick:function(){v.elements.modal.hide()}}}),h=new i({value:l.edit,className:"primary",disabled:!0,events:{onClick:m.onSave.bind(m)}}),g=new i({value:l.cancel,events:{onClick:o.onCancel}}),this.elements.modal=new n({closable:!0,events:{onHide:o.onClose},header:a.properties,form:m,body:m.render(),footer:[p]}),this.elements.modal.elements.wrapper.classList.add("cs-edit-details-modal")},show:function(){var e=this.elements,t=e.modal;t.inject(document.body),t.show(),e.myContent._initChangeListeners()}})}),define("DS/W3DSpace/Collections/CollabStorageCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","DS/PlatformAPI/PlatformAPI","DS/W3DSpace/Models/CollabStorageModel","DS/i3DXCompassServices/i3DXCompassServices"],function(e,t,n,i,o,s){"use strict";return n.extend({name:"collabstorages",model:o,fetch:function(e){var t=this;s.getPlatformServices({onComplete:function(n){Object.keys(n).map(function(e){n[e]["3DSpace"]&&t.add({id:n[e].platformId,displayName:n[e].displayName,url:n[e]["3DSpace"]})}),e&&e.onComplete&&e.onComplete(t)},onFailure:function(t){e&&e.onFailure&&e.onFailure(t)}})},getStorageWithUrl:function(n,i){i=e.clone(i||{},!1);var o,s=t.parseUrl(n).domain;if(o=function(n){var i,o,a;return t.parseUrl((i=n,o="url",i&&(a=i[o],e.is(a,"function")&&(a=a.call(i))),a)).domain===s},e.is(s))return this.find(o)}})}),define("DS/W3DSpace/Models/InvitationModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n){"use strict";return t.extend({defaults:{addoncommonspace:!1,sendemail:!1,givecreationright:!1,managevisibility:!1,hasreaderrole:!1,haspublicreaderrole:!1},idAttribute:"addoncommonspace",sync:function(t,i,o){return o=o?e.clone(o,!1):{},e.extend(o,n.getSyncOptions(),!0),this._parent.apply(this,[t,i,o])},url:function(){return n.getStorage().get("url")+"/resources/enocsmrest/admin/config"}})}),define("DS/W3DSpace/Views/CreateCSView",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","DS/WAFData/WAFData","DS/W3DSpace/EnoviaBootstrap","DS/W3DXComponents/Views/Item/LabelManagerView","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,s,a,l,r,c,d,u,m){"use strict";var p,h;return l.extend({name:"createCS",tagName:"div",className:"create-cs-view",init:function(e){var t=UWA.clone(e,!1);["container","template","tagName","domEvents"].forEach(function(e){delete t[e]}),this._parent(t)},setup:function(){this.container.addClassName(this.getClassNames("-container")),this._initAlert(),this._initForm(),this._initListenKeyDown()},_initAlert:function(){var t={className:"create-alert",closable:!0,renderTo:document.body,autoHide:!0,visible:!0};this.elements.alertFailure=new a(e.extend({messageClassName:"error"},t)),this.elements.alertSuccess=new a(e.extend({messageClassName:"success"},t))},_initForm:function(){var t,s,a,l,g,f=this,v=(this.options,this.elements),S=v.alertFailure;var C=new d({domEvents:{"click .supp-icon":function(){this.container.getElement("form").show(),this.onClickSuppCalled.apply(this,arguments)}},categories:[{id:"mainOwner",name:m.mainOwner}],labelFormat:"{fname} {lname}",suggestKey:"login",placeholder:u.getUser().firstName+" "+u.getUser().lastName+m.get("placeholderTxt"),getSuggestions:function(t,n,i){var o,s,a=new RegExp("/session");t&&(g&&g.cancel(),n[t]?i(n[t]):(o=(o=(o=c.getStorage().get("url")).split(a)[0])+"/resources/enocsmrest/admin/peoples?filter="+t+"&limit=10",s=e.extend({type:"json",onComplete:function(e){i(e.peoples)}},c.getSyncOptions()),g=r.authenticatedRequest(o,s)))}}),D=C.addObject;C.addObject=function(e,t,n,i,o){o.hide(),D.apply(this,arguments)},t=[{type:"text",name:"title",required:!0,label:m.title,maxlength:"32",placeholder:m.placeholderTitle,pattern:'^((?!<)(?!>)(?!/)(?!\\\\)(?!:)(?!\\?)(?!\\*)(?!")(?!\\|)(?!@)(?!#)(?!\\$)(?!%)(?!,)(?!\\.)(?!\\;)(?!\\[)(?!\\]).)*$'},{type:"textarea",name:"description",className:"not-resizable",label:m.description,maxlength:"255",placeholder:m.placeholderDescription}],p=new o({name:"family",nativeSelect:!1,placeholder:!1,className:"form-item",options:[{value:"DESIGNTEAM",label:m.design+" - "+m.designDetail,selected:!0},{value:"STANDARDTEAM",label:m.standard+" - "+m.standardDetail,disabled:!1}],events:{onChange:function(e){f.onCheckValue(e)}}}),h=new o({name:"visibility",nativeSelect:!1,placeholder:!1,showTooltips:!0,options:[{value:"PRIVATE",label:m.private+" - "+m.privateDetail,selected:!0,disabled:!1},{value:"PROTECTED",label:m.protected+" - "+m.protectedDetail,disabled:!1},{value:"PUBLIC",label:m.public+" - "+m.publicDetail,disabled:!1}]}),s=new n({fields:t,events:{onSubmit:function(){f.onCreate()}}}),a=new i({value:m.create,className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate")}}),l=new i({value:m.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}}),v.form=[C.render(),s];var w=document.createElement("span");w.innerHTML=m.family,w.className="form__message-label",v.form.push(w,p);var b=document.createElement("span");b.innerHTML=m.visibility,b.className="form__message-label",v.form.push(b,h),v.create=a,v.cancel=l},getCreateButton:function(){return this.elements.create},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form[0].container},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this),document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(e){if(13!==e.keyCode||e.srcElement.type.contains("textarea")){if(27===e.keyCode){var t=document.createEvent("Event");t.initEvent("click",!0,!1),this.elements.cancel.elements.content.dispatchEvent(t)}}else this.submitEnabled()&&this.onCreate()},submitEnabled:function(){return null===this.elements.create.elements.content.getAttribute("disabled")},render:function(){var e=this.elements,t=e.form;e.create,e.cancel;return this.container.setContent([t,{tag:"div",class:"footer"}]),this},onCheckValue:function(e){"DESIGNTEAM"===e.target.value?(h.enable(0),h.enable(1),h.enable(2),h.setValue(0)):(h.enable(2),h.disable(0),h.disable(1),h.setValue(2))},onCreate:function(){var t,n=this.options,i=e.clone(n.events||{},!1),o=this.collection,s=(n.onComplete,n.onFailure),a=this.elements.form[1].getValue("title"),l=this.elements.form[0].getJsonObjects()[0]?this.elements.form[0].getJsonObjects()[0].selection:u.getUser().login,r=this.elements.alertFailure;if(a=a.trim(),this.elements.form[1].validate()&&!a.contains("  ")&&0!==a.length&&0!==l.length)n.onFailure=function(t){o.remove(t),e.is(s)&&s.apply(void 0,arguments)},t={title:a,description:this.elements.form[1].getValue("description"),family:{value:p.getValue()[0]},visibility:{value:h.getValue()[0]},owner:{login:l}},this.collection.create(t,{onComplete:n.onComplete,onFailure:n.onFailure}),i.onCancel();else if(""===a)r.add({message:m.errorEmptyTitle});else{a.contains("  ")?r.add({message:m.replace(m.errorWhiteSpace)}):r.add({message:m.replace(m.errorCharacterTitle,{tag1:" \\ \" # $ @ % * , ; ? < > [ ] | : . '"})})}}})}),define("DS/W3DSpace/Views/InvitationView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/W3DSpace/Models/InvitationModel","DS/W3DSpace/EnoviaBootstrap","DS/UIKIT/Scroller","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,s,a,l,r,c){"use strict";var d=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),u=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"});return n.extend({init:function(e){var t=this;this._parent(e),this.model=new a,this.model.fetch({onFailure:function(){d.add({message:c.errorFetch})},onComplete:function(){t.CreateForm()}})},CreateForm:function(){this.containerview;var e=c.addUsersToCS+"Common Space";this.containerview=this.container.addClassName(this.getClassNames("-container")),this.addUsersToCSToggle=new o({type:"switch",value:"addUsersToCS",checked:this.model.get("addoncommonspace"),label:e}),this.givecreationrightToggle=new o({type:"switch",value:"givecreationright",checked:this.model.get("givecreationright"),label:c.givecreationright}),this.giveCreationtoXappsToggle=new o({type:"switch",value:"giveCreationtoXapps",checked:this.model.get("personalspaceavailable"),label:c.giveCreationtoXapps}),this.readerRoleToggle=new o({type:"switch",value:"readerRole",checked:this.model.get("hasreaderrole"),label:c.reader}),this.publicReaderRoleToggle=new o({type:"switch",value:"publicReaderRole",checked:this.model.get("haspublicreaderrole"),label:c.publicReader}),this.manageVisibilityRight=new o({type:"switch",value:"manageVisibility",checked:this.model.get("managevisibility"),label:c.visibility}),this.restrictedRoles=new o({type:"switch",value:"restrictedRoles",checked:this.model.get("hasrestrictedroles"),label:c.restrictedRoles}),this.leaderOwner=new o({type:"switch",value:"leaderOwner",checked:this.model.get("mergeprojectroles"),label:c.associateLeaderOwner});t.createElement("div",{class:"deployment-container",html:[{tag:"h4",text:c.deployementSection},this.addUsersToCSToggle,this.givecreationrightToggle,this.giveCreationtoXappsToggle]}).inject(this.containerview),t.createElement("div",{class:"roles-container",html:[{tag:"h4",text:c.rolesAvailability},this.readerRoleToggle,this.publicReaderRoleToggle,this.restrictedRoles,this.leaderOwner]}).inject(this.containerview),t.createElement("div",{class:"visibility-container",html:[{tag:"h4",text:c.manageVisibility},this.manageVisibilityRight]}).inject(this.containerview),t.createElement("div",{class:"footer",html:[new s({value:c.cancel,className:"pull-right default",events:{onClick:this.dispatchAsEventListener("onCancel")}}),new s({value:c.save,className:"pull-right primary",events:{onClick:this.dispatchAsEventListener("onSave")}})]}).inject(this.containerview),new r({element:this.containerview});return this.containerview},onSave:function(){var e=this;e.model.save({addoncommonspace:e.addUsersToCSToggle.isChecked(),givecreationright:e.givecreationrightToggle.isChecked(),personalspaceavailable:e.giveCreationtoXappsToggle.isChecked(),haspublicreaderrole:e.publicReaderRoleToggle.isChecked(),hasreaderrole:e.readerRoleToggle.isChecked(),managevisibility:e.manageVisibilityRight.isChecked(),hasrestrictedroles:e.restrictedRoles.isChecked(),mergeprojectroles:e.leaderOwner.isChecked()},{onFailure:function(){e.onCancel(),d.add({message:c.errorSave})},onComplete:function(){u.add({message:c.successSave})}})},onCancel:function(){1==this.model.get("addoncommonspace")?this.addUsersToCSToggle.check():this.addUsersToCSToggle.uncheck(),1==this.model.get("givecreationright")?this.givecreationrightToggle.check():this.givecreationrightToggle.uncheck(),1==this.model.get("personalspaceavailable")?this.giveCreationtoXappsToggle.check():this.giveCreationtoXappsToggle.uncheck(),1==this.model.get("hasreaderrole")?this.readerRoleToggle.check():this.readerRoleToggle.uncheck(),1==this.model.get("haspublicreaderrole")?this.publicReaderRoleToggle.check():this.publicReaderRoleToggle.uncheck(),1==this.model.get("managevisibility")?this.manageVisibilityRight.check():this.manageVisibilityRight.uncheck(),1==this.model.get("hasrestrictedroles")?this.restrictedRoles.check():this.restrictedRoles.uncheck(),1==this.model.get("mergeprojectroles")?this.leaderOwner.check():this.leaderOwner.uncheck()}})}),define("DS/W3DSpace/Views/ModalCreateCS",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/W3DSpace/Views/CreateCSView","DS/UIKIT/Alert","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(e,t,n,i,o,s){"use strict";return t.extend({init:function(t){var a,l,r,c,d,u,m=this,p={className:"create-alert",closable:!0,renderTo:document.body,autoHide:!0,visible:!0};t=e.clone(t||{},!1),this._parent(t),a=e.clone(t.events||{},!1),l=t.onComplete,r=t.onFailure,c=a.onCancel,this.elements.alertFailure,this.elements.alertSuccess,this.elements.alertWarning,u=function(){document.removeEventListener("keydown",d.onKeyDown),d.remove(),m.destroy()},a.onCancel=function(){u(),e.is(c)&&c.apply(this,arguments)},t.events=a,t.onComplete=function(t){u(),m.elements.alertSuccess=new o(e.extend({messageClassName:"success"},p)),m.elements.alertSuccess.add({message:s.replace(s.successCreate,{tag1:t.get("title")})}),e.is(l)&&l.apply(void 0,arguments)},t.onFailure=function(t){"The request has timedout after 25000ms"===arguments[1]?(u(),m.elements.alertWarning=new o(e.extend({messageClassName:"warning"},p)),m.elements.alertWarning.add({message:s.replace(s.CScreateTimeout,{tag1:t.get("title")})}),e.is(r)&&r.apply(void 0,arguments)):(u(),m.elements.alertFailure=new o(e.extend({messageClassName:"error"},p)),m.elements.alertFailure.add({message:s.replace(s.errorCreateCS,{tag1:t.get("name")})}),e.is(r)&&r.apply(void 0,arguments))},d=new i(t),this.elements.modal=new n({closable:!1,className:"modalCreateCS",header:s.createTitle,form:d,body:d.render(),footer:[d.getCreateButton(),d.getCancelButton()]})},show:function(){var e=this.elements.modal;e.inject(document.body),e.show(),e.options.form.getFormFirstInput().focus()}})}),define("DS/W3DSpace/Views/ModalChangeOwner",["UWA/Drivers/Alone","UWA/Controls/Abstract","UWA/Core","DS/WAFData/WAFData","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/W3DSpace/EnoviaBootstrap","UWA/Class/Collection","DS/W3DXComponents/Views/Item/LabelManagerView","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter"],function(e,t,n,i,o,s,a,l,r,c,d,u){"use strict";var m=null,p=new s({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),h=new s({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"warning"}),g=new s({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"});return t.extend({init:function(e){this._parent(e),this.resetModal(),this.model=e.model,this._selectedOwner=null},showModal:function(){this.modal.inject(document.body),this.modal.show()},getBody:function(){this.labelManager=new d({domEvents:{"click .supp-icon":function(){this.container.getElement("form").show(),this.onClickSuppCalled.apply(this,arguments)}},categories:[{id:"mainOwner",name:u.labelMainOwner}],labelFormat:"{fname} {lname}",suggestKey:"login",placeholder:u.placeholderTxt,getSuggestions:function(e,t,o){var s,a,l=new RegExp("/session");e&&(m&&m.cancel(),t[e]?o(t[e]):(s=(s=(s=r.getStorage().get("url")).split(l)[0])+"/resources/enocsmrest/admin/peoples?filter="+e+"&limit=10",a=n.extend({type:"json",onComplete:function(e){o(e.peoples)}},r.getSyncOptions()),m=i.authenticatedRequest(s,a)))}});var e=this.labelManager.addObject;return this.labelManager.addObject=function(t,n,i,o,s){s.hide(),e.apply(this,arguments)},this.labelManager.render().getContent()},getFooter:function(){var e=this;return[new l({value:u.save,className:"primary",events:{onClick:function(){e.onSaveCalled()}}}),new l({value:u.cancel,className:"default",events:{onClick:function(){e.onCancelCalled()}}})]},onSaveCalled:function(){var e=this.labelManager.getJsonObjects()[0];if(e){var t=this.model,n=e.selection,i=t.get("owner");t.save({title:t.get("title"),owner:{login:n}},{onFailure:function(e){p.add({message:u.errorChangeOwner}),e.set("owner",i)},onComplete:function(){g.add({message:u.replace(u.successChangeOwner,{tag1:t.get("owner").name})})},onTimeout:function(){h.add({message:u.ChangeOwnerTimeout})}}),this.modal.destroy(),this.resetModal()}},onCancelCalled:function(){this.modal.destroy(),this.resetModal()},resetModal:function(){this.modal=new a({className:"changeowner",closable:!0,header:u.modalHeader,body:this.getBody(),footer:this.getFooter()})},onDestroy:function(){this.alert.destroy()}})}),define("DS/W3DSpace/SkeletonUtils/W3DSpaceControlCenterSkeletonOptions",["UWA/Core","DS/UIKIT/Alert","UWA/Class/Model","DS/W3DXComponents/ContentSet","DS/W3DXComponents/MemberSet","DS/W3DXComponents/Skeleton","DS/W3DSpace/Collections/AdminCollabSpacesCollection","DS/W3DSpace/Collections/AdminPeopleCollection","DS/W3DXComponents/Views/Layout/GridScrollView","DS/W3DXComponents/Views/Item/TileView","DS/W3DSpace/Views/ModalChangeOwner","DS/W3DSpace/Views/InvitationView","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/W3DSpace/Views/ModalCreateCS","DS/W3DSpace/Views/ModalDisplaySecurityContexts","DS/W3DSpace/Views/ManageMembers","DS/W3DSpace/Collections/CSMembers","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Utils/Metrics","UWA/Core","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/W3DSpace/Views/ModalCSEditDetails","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter"],function(e,t,n,i,o,s,a,l,r,c,d,u,m,p,h,g,f,v,S,C,D,w,b,y){"use strict";var A=new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),W=new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"}),I=r.extend({onRender:function(){this._parent.apply(this,arguments)},setup:function(e){var t=this._externalEvents={onSearch:function(){this.reload()},onSearchReset:function(){this.reload()}};return this.collection&&this.listenTo(this.collection,t),this._parent.apply(this,arguments)},destroy:function(e){if(!this.isDestroyed)return this.collection&&this.stopListening(this.collection,this._externalEvents),this._parent.apply(this,arguments)},reload:function(){this.container.addClassName("loading");var e=this;e.collection.state.totalRecords=null;var t={reset:!0,type:"json",onComplete:function(){e.container.offsetParent&&(e.scrollView.elements.infinitearea.show(),e.scrollView.elements.infiniteareaLoader.hide(),e.scrollView.endLoading())},onFailure:function(){}};e.collection.getFirstPage(t)}}),T=I.extend({onRender:function(){var e=new p({value:y.createCS,icon:"fonticon fonticon-3x fonticon-logo-3dspace-add fix-alignement",className:"primary btn-ncs",events:{onClick:function(){U({eventAction:"createCS",model:this,tenant:this.options.config.selectedStorage.get("id")}),new h({collection:this.collection}).show()}.bind(this)}}),t=document.createElement("div"),n=document.createElement("div");t.classList.add("tile-container"),t.classList.add("with-actions"),n.classList.add("tile-sub-container"),t.appendChild(n),n.appendChild(e.getContent()),this._parent.apply(this,arguments),this.scrollView.view.container.insertBefore(t,this.scrollView.view.container.firstChild)}});function U(e){return C.trackAction(Object.assign(e,{model:e.model}))}function E(){var t=this,n=this.collection,i={onComplete:function(){t.container.offsetParent&&(t.scrollView.elements.infinitearea.show(),t.scrollView.elements.infiniteareaLoader.hide(),t.scrollView.endLoading())},onFailure:function(){A.add({message:y.errorFetch})}};null===n.state.totalRecords?n.getFirstPage(i):n.hasNextPage()?n.getNextPage(e.extend(i,{remove:!1,reset:!1})):(t.scrollView.elements.infinitearea.show(),t.scrollView.elements.infiniteareaLoader.hide())}return{getRootIdCardOptions:function(e){return{root:"admincollabspaces",rootIdCardOptions:{model:new(n.extend({urlRoot:function(){return e.selectedStorage.get("url")+"/resources/enocsmrest"}})),facets:[{name:"admincollabspaces",text:y.manageCollabSpaces,icon:"doc-text",handler:s.getRendererHandler("admincollabspaces")},{name:"adminmembers",text:y.managePermissions,icon:"users",handler:s.getRendererHandler("adminmembers")},{name:"invitation",text:y.invitation,icon:"cog",handler:s.getRendererHandler(u)}]}}},getInfos:function(e){return e},getRendererMap:function(e){return{adminmembers:{collection:l,fetchMode:"never",view:I,viewOptions:{className:"members-facet",selectionMode:!1,useInfiniteScroll:!0,usePullToRefresh:!0,itemView:c,itemViewOptions:{mapping:{title:function(){return this.model.get("name")},image:function(){return this.model.get("picture").split("redirect=")[1]},subtitle:function(){return this.model.get("createcs")?'<div class="allowed">'+y.allowed+"</div>":y.notAllowed},content:"email"},contextualActions:function(){var e=[];return e.push({text:y.credentials,fonticon:"fonticon fonticon-info",handler:function(e){new g({model:e.model})}}),this.get("createcs")?this.get("isadmin")||e.push({text:y.denyCreation,fonticon:"block",handler:function(e){e.model.save({login:e.model.get("login"),createcs:!1},{onFailure:function(e){A.add({message:y.errorDenyCreation}),e.set("createcs",!0)},onComplete:function(){W.add({message:y.successDenyCreation})}})}}):e.push({text:y.allowCreation,fonticon:"pencil",handler:function(e){e.model.save({login:e.model.get("login"),createcs:!0},{onFailure:function(e){A.add({message:y.errorAllowCreation}),e.set("createcs",!1)},onComplete:function(){W.add({message:y.successAllowCreation})}})}}),e}},events:{onInfiniteScroll:E}}},admincollabspaces:{className:"loading",collection:a,fecthMode:"never",view:T,viewOptions:{selectionMode:!1,config:e,useInfiniteScroll:!0,usePullToRefresh:!0,itemView:c,itemViewOptions:{mapping:{title:"title",subtitle:"owner.name",image:"thumbnail",content:function(){var e,t;return e=this.model.get("visibility").name?this.model.get("visibility").name:this.model.get("visibility").value,(t=this.model.get("description"))&&(e+="<br/>"+t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),e}},contextualActions:function(){var t=[],n=this.get("actions");if(n){t.push({text:y.viewProperties,fonticon:"info",handler:function(t){var i=e.selectedStorage;U({eventAction:"viewProperties",model:t.model,tenant:i.get("id")}),new b({model:t.model,actions:n,tenant:i.get("id")}).show()}});for(var i=0;i<n.length;i++)"edit.owner"===n[i]&&t.push({text:y.changeOwner,fonticon:"fonticon fonticon-user-key",handler:function(t){var n=e.selectedStorage;U({eventAction:"editOwner",model:t.model,tenant:n.get("id")}),new d({model:t.model}).showModal()}}),"add.members"===n[i]&&t.push({text:y.manageMembers,fonticon:"fonticon fonticon-user-cog fonticon-clickable",handler:function(t){var n=e.selectedStorage,i=t.model;w.getPlatformServices({platformId:n.id,onComplete:function(e){e&&(i._auth={platformId:n.id,platform:{id:e.platformId,displayName:e.displayName,url:e["3DDrive"],urlSwym:e["3DSwym"],url3DSpace:e["3DSpace"],urlUsersGroup:e.usersgroup,urls3DSearch:e["3DSearch"],urlDrivesHub:e.driveshub,urlDashboard:e["3DDashboard"],urlDfcs:e.distributedfilestore,urlPassport:e["3DPassport"]},getStorage:function(){return{id:e.platformId,displayName:e.displayName,url:e["3DDrive"],urlSwym:e["3DSwym"],url3DSpace:e["3DSpace"],urlUsersGroup:e.usersgroup,urls3DSearch:e["3DSearch"],urlDrivesHub:e.driveshub,urlDashboard:e["3DDashboard"],urlDfcs:e.distributedfilestore,urlPassport:e["3DPassport"]}}})}}),U({eventAction:"manageMembers",model:t,tenant:n.get("id")}),(new f).managememberClick({model:t,config:e.selectedStorage})}})}return t}},events:{onInfiniteScroll:E}}}}}}}),define("DS/W3DSpace/W3DSpaceControlCenter",["UWA/Core","DS/UIKIT/Alert","DS/W3DSpace/Collections/CollabStorageCollection","DS/W3DXComponents/Skeleton","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/SkeletonUtils/W3DSpaceControlCenterSkeletonOptions","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,s,a,l){"use strict";var r,c,d,u,m,p=!1,h=!1;function g(){c&&c.destroy(),o.getStorage().get("isadmin")?(c=new i(s.getRendererMap({selectedStorage:m}),s.getRootIdCardOptions({selectedStorage:m}))).render().inject(widget.body.getElement("#controlcenter-widget-content")):r.add({message:l.errorAdminRights,className:"error"})}function f(e,n){if(e){var i,o={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},s=widget.getValue("collab-storage");if(""===s){var c=widget.getValue("x3dPlatformId");if(c){if(!(i=e.get(c)))return void new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"warning"}).add({message:l.replace(l.undefinedStorage,{tag1:widget.getValue("x3dPlatformId")})});widget.setValue("collab-storage",i.id),widget.setValue("tenantAware",!0)}else i=e.at(0)}else i=e.get(s);return e.forEach(function(e){var t,n;n=e.get("displayName").unescapeHTML(),t=e.get("id"),o.options.push({label:n,value:t})}),1===e.length&&i&&(o.type="hidden"),widget.addPreference(o),h&&(widget.dispatchEvent("onEdit",["refreshPrefs"]),i||(i=e.at(0))),i?(widget.setTitle(i.get("displayName")),widget.setValue("x3dPlatformId",i.get("id")),d.onStorageChange("collab-storage",i.id,n)):r.add({message:l.updatePreference,className:"warning"}),a.subscribe("PlatformManagement.renamePlatformName",function(e){widget.setTitle(e),i.set("displayName",e)}),m=i,i}}return d={onLoad:function(){o.start({id:widget.id,collection:u}),widget.setBody([{tag:"div",id:"controlcenter-widget-content"}]),r=new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),u.fetch({onComplete:function(e,t,n){f.call(void 0,e,g)},onFailure:function(e){r.add({message:l.errorFetchStorages,className:"error"})}})},onRefresh:function(){f.call(void 0,u,g)},onEdit:function(e){if(h=!0,"refreshPrefs"!==e){widget.addPreference({type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"}),widget.dispatchEvent("onEdit",["refreshPrefs"]),u.fetch({onComplete:function(e,t,n){f.call(void 0,e)}})}},endEdit:function(e){h=!1},onStorageChange:function(e,t,n){var i=u.get(t),s={onComplete:n,onFailure:function(e){r.add({message:e&&e.error&&e.error.message?e.error.message:l.errorFetch,className:"error"})}};o.onStorageChange(i,s)}},function(){if(!p){if(!widget)throw new Error("W3DSpace must be executed in a widget environement");u=new n,p=!0}}(),d});