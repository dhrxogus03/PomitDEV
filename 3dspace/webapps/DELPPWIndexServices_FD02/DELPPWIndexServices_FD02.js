define("DS/DELPPWIndexServices_FD02/IndexParserNode",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({init:function(t){var i=this;this._children=[],this._result=t,this._result.attributes.forEach(function(t){var n,r=t.name;e.is(i[r])?e.is(i[r].value,"string")?(n=i[r].value,i[r].value=[n,t.value]):e.is(i[r].value,"array")&&i[r].value.push(t.value):i[r]=t})},getAttribute:function(e){if(this.hasOwnProperty(e))return this[e]},getAttributeValue:function(e){var t=this.getAttribute(e);if(t)return t.value},addChild:function(e){-1===this._children.indexOf(e)&&this._children.push(e)},getChildren:function(){return this._children},getRawResult:function(){return this._result}})}),define("DS/DELPPWIndexServices_FD02/IndexParserProgressiveNode",["UWA/Core","UWA/Class","DS/DELPPWIndexServices_FD02/IndexParserNode"],function(e,t,i){"use strict";return i.extend({init:function(t){var i=this;this._children=[],this._result=t;var n=Object.keys(this._result),r=Object.values(this._result),a=0;n.forEach(function(t){var n;t={name:t,value:r[a]};e.is(i[t.name])?e.is(i[t.name].value,"string")?(n=i[t.name].value,i[t.name].value=[n,t.value]):e.is(i[t.name].value,"array")&&i[t.name].value.push(t.value):i[t.name]=t,a++}),i.physicalid={name:"physicalid",value:i.resourceid.value}}})}),define("DS/DELPPWIndexServices_FD02/IndexParser",["UWA/Core","UWA/Class","DS/DELPPWIndexServices_FD02/IndexParserNode","DS/DELPPWIndexServices_FD02/IndexParserProgressiveNode","DS/DELPPWLoggerModel_FD02/LoggerUtils","DS/DELPPWDicoServices_FD02/DicoUtils"],function(e,t,i,n,r,a){"use strict";return t.singleton({name:"IndexParser",_indexMapping:null,init:function(e){e=e||{},this._parent(e)},setIndexMapping:function(e){this._indexMapping=e},translateAttributeToPredicate:function(t,i){var n,r,s=[];if(e.is(this._indexMapping)){switch(n=(i=i||{}).type||"entity"){case"entity":r=this._indexMapping.IndexMapping.Entity.Key;break;case"relation":r=this._indexMapping.IndexMapping.Relation.Key}return t.forEach(function(e){var t=!1;r.forEach(function(i){i.database===e&&-1===s.indexOf(i.index)&&(s.push(i.index),t=!0)}),t||a.getDicoTypeIndexesForAttribute(e,n).forEach(function(e){s.push(e)})}),s}},translatePredicateToAttribute:function(t,i){var n,r,s;if(e.is(this._indexMapping)){switch(s=(i=i||{}).type||"entity",t instanceof Array?n=[]:(n={},i.fromExpandService&&(t=function(t){var i={};return t=t||{},Object.keys(t).forEach(function(n){var r=t[n];r instanceof Function||0===n.indexOf("_")||e.is(r)&&e.is(r.value)&&(i[n]=r.value)}),i}(t))),s){case"entity":r=this._indexMapping.IndexMapping.Entity.Key;break;case"relation":r=this._indexMapping.IndexMapping.Relation.Key}return t instanceof Array?t.forEach(function(e){var t;r.some(function(i){var n=i.index===e;return n&&(t=i),n}),t?-1===n.indexOf(t.database)&&n.push(t.database):a.getDicoTypeAttributesForIndex(e,s).forEach(function(e){n.push(e)})}):Object.keys(t).forEach(function(e){var i,u,o;r.some(function(t){var i=t.index===e;return i&&(o=t),i}),o?(i=t[o.index],r.some(function(e){var t=e.index===i;return t&&(u=e),t}),u&&(i=u.database),n[o.database]=i):(i=t[e],a.getDicoTypeAttributesForIndex(e,s).forEach(function(e){n[e]=i}))}),n}},parseProgressiveExpandNavigateResult:function(t){var i=null,r={},a=[];return"string"==typeof t?i=JSON.parse(t):"object"==typeof t&&null!==t&&(i=t),e.is(i)&&e.is(i.results,"array")&&i.results.forEach(function(t){var i,s,u,o,c,l;if(Object.prototype.hasOwnProperty.call(t,"Path")){if(Object.prototype.hasOwnProperty.call(t,"Path"))for(o=0;o<t.Path.length;o++){if(c=t.Path[o],l=r[c],!e.is(l))throw new Error("Result corruption : did not found "+c);0===o?(-1===a.indexOf(l)&&a.push(l),u=l):(u.addChild(l),u=l)}}else s=(i=new n(t)).getAttributeValue("resourceid"),r[s]=i}),a},parseNavigateResult:function(t){var n=null,a={},s=[];return"string"==typeof t?n=JSON.parse(t):"object"==typeof t&&null!==t&&(n=t),e.is(n)&&e.is(n.results,"array")&&n.results.forEach(function(t){var n,u,o,c,l,d;if(Object.prototype.hasOwnProperty.call(t,"attributes"))u=(n=new i(t)).getAttributeValue("did"),a[u]=n;else if(Object.prototype.hasOwnProperty.call(t,"path"))for(c=0;c<t.path.length;c++){if(l=t.path[c],d=a[l],!e.is(d))throw new Error("Result corruption : did not found "+l);0===c?(-1===s.indexOf(d)&&s.push(d),o=d):(o.addChild(d),o=d)}else r.warn("IndexParser.parseNavigateResult Unsupported element: "+JSON.stringify(t))}),s},parseFetchResult:function(t){var i={attributes:{},ds6w:{}};return e.is(t)&&e.is(t.attributes,"array")&&t.attributes.forEach(function(t){var n;if(e.is(t)&&e.is(t.format,"string"))switch(t.format){case"attribute":e.is(i.attributes[t.name])?e.is(i.attributes[t.name],"string")?(n=i.attributes[t.name],i.attributes[t.name]=[n,t.value]):e.is(i.attributes[t.name],"array")&&i.attributes[t.name].push(t.value):i.attributes[t.name]=t.value;break;case"ds6w_facet":i.ds6w[t.name]={value:t.value,dispValue:t.dispValue,type:t.type}}}),i}})});