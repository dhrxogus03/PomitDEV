define("DS/CompareMergePlugin/NodeUtils",["DS/CompareWidget2/support/cw2Utils"],function(e){"use strict";return{nodeIs3DShapeWith3DPartUsage:function(e){var t=!1;if("3DShape"===e.getAttr("type")){var n=e.getAttr("attribute[PLMEntity.V_usage]");n&&"3DPart"===n&&(t=!0)}return t},nodeIsConsideredAggregated:function(e){var t=!1,n="TRUE"===e.getAttr("attribute[PLMCoreRepReference.V_isOnceInstantiable]"),o="TRUE"===e.getAttr("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"),i="TRUE"===e.getAttr("type.kindof[BundleFastenerAbstract]"),r=this.nodeIs3DShapeWith3DPartUsage(e),a=this.nodeIsComposee(e);return(n||r||o||i||a)&&(t=!0),t},nodeFollowsParent:function(e){var t=e.getAttr("followsParent");if(void 0!==t)return t;t=!1;var n=!1,o=e.getParent();return o&&(n=this.nodeFollowsParent(o)),(n||this.nodeIsConsideredAggregated(e))&&(t=!0),e.addAttr("followsParent",t),t},nodeIsRevisionable:function(e){var t=e.getAttr("last.current.majorrevisionable");return void 0===t&&(t=e.getAttr("last.current.revisionable")),"TRUE"===t},nodeHasReviseAccess:function(t){var n=t.getAttr("majorid.lastmajorid.bestsofar.current.access[majorrevise]");if(n&&"FALSE"===n&&"TRUE"===t.getAttr("last.current.revisionable")&&(n=t.getAttr("majorid.lastmajorid.bestsofar.current.access[revise]")),!n){var o=t.getAttr("title");o||(o="-No Title-"),e.warnout("No revise access info available when requested for '"+o+"'")}return"TRUE"===n},nodeCanBeRevised:function(e){return this.nodeHasReviseAccess(e)&&this.nodeIsRevisionable(e)},nodeIsModified:function(e){return this.nodeHasModifiedRef(e)||this.nodeHasModifiedInst(e)},nodeHasModifiedRef:function(e){return this._nodeHasAdjFlag(e,"REF_MODIFIED")},nodeHasModifiedInst:function(e){return this._nodeHasAdjFlag(e,"INST_MODIFIED")},nodeHasModifiedChild:function(e){var t=!1,n=e.getChildArray();for(const e of n)if(this.nodeHasModifiedRef(e)){t=!0;break}return t},nodeIsPLMPort:function(e){return!("TRUE"!==e.getAttr("type.kindof[PLMPort]"))},nodeIsPLMConnection:function(e){return!("TRUE"!==e.getAttr("type.kindof[PLMConnection]"))},nodeIsComposee:function(e){var t="TRUE"===e.getAttr("type.kindof[PLMPort]"),n="TRUE"===e.getAttr("type.kindof[PLMConnection]");return!(!t&&!n)},_nodeHasAdjFlag:function(e,t){var n=!1,o=e.getMatchInfo();if(o){var i=o.getAdjFlagArray();null!=i&&i.findIndex(e=>e==t)>-1&&(n=!0)}return n},_nodeHasStatus:function(e,t){var n=!1,o=e.getMatchInfo();if(o){var i=o.getAllStatusArray(!1);null!=i&&i.findIndex(e=>e==t)>-1&&(n=!0)}return n},nodeIsUnrelated:function(e){return this._nodeHasStatus(e,"UNRELATED")},nodeIsReplaced:function(e){return this._nodeHasStatus(e,"REPLACED")},nodeIsOnReplacedBranch:function(e){for(var t=!1;e&&!t;)t=this.nodeIsReplaced(e),e=e.getParent();return t},nodeIsLeftOnly:function(e){return this._nodeHasStatus(e,"LEFT_ONLY")},nodeIsRightOnly:function(e){return this._nodeHasStatus(e,"RIGHT_ONLY")},nodeIsLeftOnlyOrRightOnly:function(e){return this.nodeIsLeftOnly(e)||this.nodeIsRightOnly(e)},nodeHasLeftOnlyOrRightOnlyChild:function(e){var t=!1,n=e.getChildArray();for(const e of n)if(this.nodeIsLeftOnlyOrRightOnly(e)){t=!0;break}return t},getNodeDefaultBranchIntent:function(e){var t="S",n=e.getAttr("intents");return n&&Array.isArray(n)&&n.length>0&&(t=n[0],n.length>1&&n.includes("D")&&(t="D")),t}}}),define("DS/CompareMergePlugin/MergeConstants",[],function(){"use strict";return{MergeAction:{Revise:"revise",Reuse:"reuse",Exclude:"exclude",InsertNew:"insertnew",ReuseReference:"reuse_reference",ReviseTarget:"revise_target",ReviseTargetTakeSource:"revise_target_take_source",OverwriteTarget:"overwrite_target",OverwriteTargetInstance:"overwrite_target_instance",DeleteTarget:"delete_target",IgnoreSource:"ignore_source",KeepTarget:"keep_target",KeepSource:"keep_source",AddToTarget:"add_to_target",ForMapping:"mapping"}}}),define("DS/CompareMergePlugin/ViewPanel/mergeDefaultContextMenu",["UWA/Class"],function(e){return e.extend({init:function(e){this._structComparePanel=e.structComparePanel},createContextMenu:function(e){var t=this;return new Promise(function(n){n(t._structComparePanel._getAvailableActionsMenuFromCRNode(e.cellInfos.nodeModel.options.data,!0,!1))})},onComparePanelUpdated:function(){}})}),define("DS/CompareMergePlugin/MERGE_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin","DS/CompareWidget2/userSettings/UserSettingsManager"],function(e,t){function n(e,t){}return e.extend({init:function(e,t,n,o){this._parent(e,t,n,o)},onEnabled:function(){return this.syncSetting("mergeSettings.dataSource.useIndex","_useIndex",n.bind(this)),n.bind(this)(this._useIndex,!0),!0}})}),define("DS/CompareMergePlugin/Action",[],function(){"use strict";return class{constructor(e,t,n){this.actionOption=e,this.isSelected=t,this.isEnabled=n,this.postAdded=!1}}}),define("DS/CompareMergePlugin/userSettings/Merge",["UWA/Core","DS/CompareWidget2/userSettings/SettingsBase","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n){"use strict";var o=e.extend(t,{namespace:"default",mergeSettings:{dataSource:{useIndex:{value:!1,widgetSetting:{type:"boolean",label:n.useIndex,defaultValue:!1}}}},viewSettings:{INSTANCE_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option_INST"},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown_INST"}}),STRUCT_VIEW:{display_mode:{value:"tree"},statuses_to_hide:{value:[]},statuses_unchecked:{value:[]}},MERGE_STRUCT_VIEW:{hideAggregated3DShapes:{value:!0},copyTitleFromSource:{value:!1},warningNoRevise:{value:!1},createARevision:{value:!1}},PAD3D_VIEW:{view3D:{isolate:{value:!0,V1Preference:{viewer_display_mode:[{oldValue:"isolate",newValue:!0},{oldValue:"select",newValue:!1}]},widgetSetting:{type:"boolean",label:n.viewerIsolate,defaultValue:!1}}}}}},!0);return o.exportSettings={},o}),define("DS/CompareMergePlugin/MaturityUtils",[],function(){"use strict";return{createCSSClass:function(e,t,n){if(null===document.getElementById(e)){var o=document.createElement("style");o.type="text/css",o.id=e;let i=n||"."+e;o.innerHTML=i+t,document.getElementsByTagName("head")[0].appendChild(o)}},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},getMaturityClass:function(e,t){return"lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"")},addCSSMaturityClasses:function(e,t){var n=this;void 0!==e&&e.forEach(function(e){let o=e.policyName;e.states.forEach(function(e){let i=e.activeColor,r="{color:"+("#FFFFFF"===i?"#000000":"#FFFFFF")+" ; background-color:"+i+";}",a=n.cleanStatusForCSS(e.stateSysName),s="lc-status-"+n.cleanStatusForCSS(o)+"-"+a+(t?"-withClass":""),c="."+s+(t?" ."+t:"");n.createCSSClass(s,r,c)})})}}}),define("DS/CompareMergePlugin/ViewDefModules/MergeViewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){const n=e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,o=e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR;var i=UWA.clone(e,!0);i.CV_PROPS.REF_UPDATESTAMP="REF.updatestamp",i.CV_PROPS.INST_UPDATESTAMP="INST.updatestamp",i.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR=n,i.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR=o;var r={colorLeft:n,colorRight:o},a=i.INST_ATTR_DISPLAY_OPTIONS;a.colorLeft=r.colorLeft,a.colorRight=r.colorRight;var s=i.STRUCT_DISPLAY_OPTIONS;s.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR=n,s.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR=o,s.COLOR_ACTION=t.colorDef.GREY1,s.COLOR_RESULT=t.colorDef.GREY1,s.CONTEXT_MENU_PLUGIN="DS/CompareMergePlugin/ViewPanel/mergeDefaultContextMenu",s.COLLAPSE_3DPARTS=!1,s.COMMAND_NAME="merge",s.CUSTOM_MATCH_ADJ_FLAGS={REF_MODIFIED:{COLOR:t.colorDef.PURPLE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REFMODIFIED"},INST_MODIFIED:{COLOR:t.colorDef.BLUE6,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"INSTMODIFIED"}},s.BUBBLE_FLAGS={CHILD_MODIFIED:{COLOR:t.colorDef.BLUE2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"CHILDMODIFIED"}};var c=UWA.clone(e.STRUCT_FETCH_OPTIONS,!0);c.CV_PROPS=i.CV_PROPS,c.DATA_SOURCE="LC_IDX_SERVICE",c.COMMAND_CONTEXT="merge";var l=UWA.clone(e.STRUCT_COMPARE_OPTIONS,!0);l.PROPS=i.CV_PROPS,l.COMPUTE_DIFFERENT=!1,l.CUSTOM_COMPARISONS.COMP_DFR=[["DFR","DFR"],["EQ","N/A","N/A","EQ","NEQ"]],l.CUSTOM_MATCH_ADJUSTMENTS=[{NAME:"REF_MODIFIED",PROPS:["REF_UPDATESTAMP","REF_UPDATESTAMP"],FLAG_ON:"NEQ",MATCH_ADJ:-1},{NAME:"INST_MODIFIED",PROPS:["INST_UPDATESTAMP","INST_UPDATESTAMP"],FLAG_ON:"NEQ",MATCH_ADJ:-1}];var d={BUBBLE_UP_ENABLED:!0,BUBBLE_STATUS_CONFIG:[{BUBBLE_STATUS:"CHILD_MODIFIED",BUBBLE_TO:"FVP",CONDITIONS:{CHILD:{TYPE:["PLMPort","PLMConnection"],ON_STATUS:["REF_MODIFIED"]},PARENT:{TYPE:["VPMReference","VPMRepReference"]}}},{BUBBLE_STATUS:"CHILD_MODIFIED",BUBBLE_TO:"FVP",CONDITIONS:{CHILD:{TYPE:["PLMReference"],ON_STATUS:["REF_MODIFIED","INST_MODIFIED"]},PARENT:{TYPE:["PLMReference"]}}},{BUBBLE_STATUS:"CHILD_MODIFIED",BUBBLE_TO:"FVP",CONDITIONS:{CHILD:{ON_STATUS:["LEFT_ONLY","RIGHT_ONLY"]},PARENT:{ON_STATUS:["BRANCH","DUPE","REVISION"]}}}]},g={MODE:"synchronize"};UWA.merge(i,{MERGE_DISPLAY_OPTIONS:s}),UWA.merge(i,{MERGE_STRUCT_FETCH_OPTIONS:c}),UWA.merge(i,{MERGE_STRUCT_COMPARE_OPTIONS:l}),UWA.merge(i,{MERGE_BUBBLE_OPTIONS:d}),UWA.merge(i,{MERGE_COMPUTE_ACTIONS_OPTIONS:g});var u={View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:s},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:r},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:a},MergeStructFetch:{Path:"DS/CompareMergePlugin/MERGE_STRUCT_FETCH_plugin",Options:c},MergeStructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:l},MergeComputeActions:{Path:"DS/CompareMergePlugin/MERGE_COMPUTE_ACTIONS_plugin",Options:g},MergeBubbler:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_BUBBLER_plugin",Options:d},MergeStructDisplay:{Path:"DS/CompareMergePlugin/MERGE_STRUCT_DISPLAY_plugin",Options:s},MergeNewRevisionFrom:{Path:"DS/CompareMergePlugin/MERGE_NRF_plugin"},MergeMerge:{Path:"DS/CompareMergePlugin/MERGE_MERGE_plugin"}};UWA.extend(i.PLUGDEFS,u);UWA.extend(i.VIEWDEFS,{MERGE_STRUCT_VIEW:["MergeStructFetch","MergeStructCompare","StructListViewPrep","MergeBubbler","MergeComputeActions","MergeStructDisplay","MergeMerge"]});return UWA.extend(i.VIEWSETS,{MERGE_STANDARD:{ROW:["MERGE_STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},MERGE_AND_PROPS_HORIZ:{COL:["MERGE_STRUCT_VIEW","PROP_VIEW"]},MERGE_AND_PROPS_VERT:{ROW:["MERGE_STRUCT_VIEW","PROP_VIEW"]},MERGE_ONLY:{ROW:["MERGE_STRUCT_VIEW"]},MERGE_COMPARE_PROPS_INST:{ROW:[["MERGE_STRUCT_VIEW","STRUCT_VIEW"],["PROP_VIEW","INSTANCE_VIEW"]]},MERGE_PROPS_INST:{ROW:[["MERGE_STRUCT_VIEW"],["PROP_VIEW","INSTANCE_VIEW"]]}}),i}),define("DS/CompareMergePlugin/ViewDefModules/MergeRFLViewDefs",["DS/CompareMergePlugin/ViewDefModules/MergeViewDefs"],function(e){var t=UWA.clone(e,!0);return t.MERGE_STRUCT_FETCH_OPTIONS.DATA_SOURCE="LC_IDX_SERVICE",t.MERGE_DISPLAY_OPTIONS.COMMAND_NAME="nrf",t.MERGE_DISPLAY_OPTIONS.CUSTOM_MATCH_ADJ_FLAGS={},t.MERGE_DISPLAY_OPTIONS.BUBBLE_FLAGS={},t.MERGE_STRUCT_COMPARE_OPTIONS.CUSTOM_MATCH_ADJUSTMENTS=[],t.MERGE_COMPUTE_ACTIONS_OPTIONS.MODE="nrf",t.VIEWDEFS.MERGE_STRUCT_VIEW=["MergeStructFetch","MergeStructCompare","StructListViewPrep","MergeComputeActions","MergeStructDisplay","MergeNewRevisionFrom"],t.PLUGDEFS.MergeStructFetch.Options=t.MERGE_STRUCT_FETCH_OPTIONS,t.PLUGDEFS.MergeStructDisplay.Options=t.MERGE_DISPLAY_OPTIONS,t.PLUGDEFS.MergeStructCompare.Options=t.MERGE_STRUCT_COMPARE_OPTIONS,t.PLUGDEFS.MergeComputeActions.Options=t.MERGE_COMPUTE_ACTIONS_OPTIONS,t}),define("DS/CompareMergePlugin/CRNodeUtils",["DS/CompareMergePlugin/NodeUtils"],function(e){"use strict";return{getBaseRefPidFromCRNode:function(e){return e?e.getMatchInfo().getBaseNode().getAttr("physicalID_REF"):null},getCompRefPidFromCRNode:function(e){return e?e.getMatchInfo().getCompNode().getAttr("physicalID_REF"):null},getRefPidFromCRNode:function(e){if(e){var t=this.getBaseRefPidFromCRNode(e),n=this.getCompRefPidFromCRNode(e);return t||n}return null},getBaseInstPidFromCRNode:function(e){return e?e.getMatchInfo().getBaseNode().getAttr("physicalID_INST"):null},getCompInstPidFromCRNode:function(e){return e?e.getMatchInfo().getCompNode().getAttr("physicalID_INST"):null},getInstPidFromCRNode:function(e){if(e){var t=this.getBaseInstPidFromCRNode(e),n=this.getCompInstPidFromCRNode(e);return t||n}return null},getTypeFromCRNode:function(e){var t="none";if(e)if(e.getAttr("type"))t=e.getAttr("type");else{var n=e.getMatchInfo();if(n){var o=n.getBaseNode();if(o.getAttr("type"))t=o.getAttr("type");else{var i=n.getCompNode();i.getAttr("type")&&(t=i.getAttr("type"))}}}return t},CRNodeIs3DShapeWith3DPartUsage:function(t){var n=t.getMatchInfo();if(n){var o=n.getBaseNode(),i=n.getCompNode();return!!(o&&e.nodeIs3DShapeWith3DPartUsage(o)||i&&e.nodeIs3DShapeWith3DPartUsage(i))}return e.nodeIs3DShapeWith3DPartUsage(t)},CRNodeIsExcludedFromMergePayload:function(t){var n=t.getMatchInfo();if(n){var o=n.getBaseNode(),i=n.getCompNode();return!!(o&&e.nodeIsPLMConnection(o)||i&&e.nodeIsPLMConnection(i))}return e.nodeIsPLMConnection(t)},CRNodeForMapping:function(t){var n=t.getMatchInfo();if(n){var o=n.getBaseNode(),i=n.getCompNode();return!!(o&&e.nodeIsPLMPort(o)||i&&e.nodeIsPLMPort(i))}return e.nodeIsPLMPort(t)},CRNodeWithoutInstance:function(t){var n=t.getMatchInfo();if(n){var o=n.getBaseNode(),i=n.getCompNode();return!!(o&&(e.nodeIsPLMConnection(o)||e.nodeIsPLMPort(o))||i&&(e.nodeIsPLMConnection(i)||e.nodeIsPLMPort(i)))}return e.nodeIsPLMConnection(t)||e.nodeIsPLMPort(t)}}}),define("DS/CompareMergePlugin/ActionOption",["DS/CompareMergePlugin/MergeConstants","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin"],function(e,t){"use strict";const n=Object.freeze({REVISE:{id:1,name:e.MergeAction.Revise,nls:t.Revise},REUSEREFERENCE:{id:2,name:e.MergeAction.ReuseReference,nls:t.ReuseRef},REUSE:{id:3,name:e.MergeAction.Reuse,nls:t.Reuse},EXCLUDE:{id:4,name:e.MergeAction.Exclude,nls:t.Exclude},INSERTNEW:{id:5,name:e.MergeAction.InsertNew,nls:t.InsertNew}}),o=Object.freeze({REVISE_TARGET:{id:6,name:e.MergeAction.ReviseTarget,nls:t.ReviseTarget},REVISE_TARGET_TAKE_SOURCE:{id:7,name:e.MergeAction.ReviseTargetTakeSource,nls:t.ReviseTargetTakeSource},OVERWRITE_TARGET:{id:8,name:e.MergeAction.OverwriteTarget,nls:t.OverwriteTarget},OVERWRITE_TARGET_INSTANCE:{id:9,name:e.MergeAction.OverwriteTargetInstance,nls:t.OverwriteTargetInstance},DELETE_TARGET:{id:10,name:e.MergeAction.DeleteTarget,nls:t.DeleteTarget},KEEP_TARGET:{id:11,name:e.MergeAction.KeepTarget,nls:t.KeepTarget},KEEP_SOURCE:{id:12,name:e.MergeAction.KeepSource,nls:t.KeepSource},IGNORE_SOURCE:{id:13,name:e.MergeAction.IgnoreSource,nls:t.IgnoreSource},ADD_TO_TARGET:{id:14,name:e.MergeAction.AddToTarget,nls:t.AddInstToTarget}});return Object.freeze(Object.assign({},n,o))}),define("DS/CompareMergePlugin/mergeManager",["DS/CompareCommon/Utils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/CRNodeUtils","DS/CompareMergePlugin/NodeUtils","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/LifecycleServices/LifecycleServices"],function(e,t,n,o,i,r){var a=function(e,t){this._options=e,this._plugSvcs=t,this._copyTitleFromSource=!1,this._crTree=null,this._actionInfos=null};return a.prototype.update=function(e,t){this._crTree=e,this._actionInfos=t},a.prototype.doMerge=function(){var e=this;e._plugSvcs.postEvent("MERGE_STARTED_EVENT");var t=this._getMergeData(),n={data:t},o=this._crTree.getRoot(1).getObjIDSpec_REF(),a=o.getTenant(),s=o.getServiceName(),c=(o.getSecurityContext(),e._plugSvcs.nowMS());r.getSecurityContextPromise(a).then(function(o){e._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/revise/merge/","POST",n,"json",a,s,o).then(function(n){if(e._plugSvcs.reportTime(c,"Merge request done OK."),null!=n&&n.hasOwnProperty("status")&&n.hasOwnProperty("report")&&"failure"===n.status){for(var o=i.MergeFailureMsg,r=0;r<n.report.length;r++){var a=n.report[r];if(a.error&&a.error!==o){o=a.error;break}}return e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),void e.showErrorMsg(o)}e.doPostMergeRefresh(t,n.results);var s=i.MergeSuccessMsg;e._plugSvcs.showAlertBox(s,null,"success"),e._plugSvcs.postEvent("MERGE_ENDED_OK_EVENT")},function(t){e._plugSvcs.reportTime(c,"Merge request failed."),e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),e._handleRequestFailure(!0,t),e._plugSvcs.errout("Failure to merge: "+t)})})},a.prototype._handleRequestFailure=function(e,t,n){var o=this;r.showWebServiceError(t,n,function(e,t,n,i,r){t?o.showNotifMsg(e,{sticky:!0}):o.showErrorMsg(e,{title:n,subtitle:i,submessage:r})},e)},a.prototype._getMergeData=function(){var e=this._copyTitleFromSource,t=this._crTree.getRoot(1),o=n.getBaseRefPidFromCRNode(t),i=[];this._addMergeNodeData(i,t,null,[],0);var r={physicalid_trgt_root:o,treeData:i,useSourceTitle:e},a=[];return a.push(r),a},a.prototype._addMergeNodeData=function(e,i,r,a,s){var c=n.getBaseRefPidFromCRNode(i),l=n.getCompRefPidFromCRNode(i),d=n.getBaseInstPidFromCRNode(i),g=n.getCompInstPidFromCRNode(i),u=r?n.getBaseRefPidFromCRNode(r):null,p=r?n.getCompRefPidFromCRNode(r):null,A=d||g;if(!n.CRNodeIsExcludedFromMergePayload(i)&&-1===a.indexOf(A)){if(a.push(A),(!c||!l)&&u&&p&&n.CRNodeIs3DShapeWith3DPartUsage(i)){var E=r.getChildArray();for(const e of E){var R=c?n.getCompRefPidFromCRNode(e):n.getBaseRefPidFromCRNode(e);if(R&&n.CRNodeIs3DShapeWith3DPartUsage(e)){var f=null;c?(l=R,f=g=n.getCompInstPidFromCRNode(e)):(c=R,f=d=n.getBaseInstPidFromCRNode(e)),a.push(f);break}}}var _=this._getActionInfoFromCRNode(i).getActionOptionSelected().name;t.MergeAction.IgnoreSource;var h=_===t.MergeAction.AddToTarget,T=_===t.MergeAction.DeleteTarget,S=(t.MergeAction.ReviseTarget,_===t.MergeAction.ReviseTargetTakeSource),m=_===t.MergeAction.OverwriteTarget,I=_===t.MergeAction.KeepSource,C=null,N=null;if(r)(C=this._getActionInfoFromCRNode(r).getActionOptionSelected().name)===t.MergeAction.AddToTarget&&(N=o.getNodeDefaultBranchIntent(r));var v=C===t.MergeAction.KeepSource,O=null;r&&d&&g&&(S||m||I&&!v)&&(O=t.MergeAction.OverwriteTargetInstance);var M=null;h&&(M=o.getNodeDefaultBranchIntent(i));n.CRNodeForMapping(i)&&(_=t.MergeAction.ForMapping),n.CRNodeWithoutInstance(i)&&(O="",d="",g="");var y={physicalid_trgt:h?"":c||l,operation:_,physicalid_src:l,level:s};d&&(y.inst_physicalid_trgt=d),g&&(y.inst_physicalid_src=g),O&&(y.inst_operation=O),u&&(y.parent_physicalid_trgt=u),p&&(y.parent_physicalid_src=p),C&&(y.parent_operation=C),M&&(y.intent=M),N&&(y.parent_intent=N);var P=i.getChildArray();if(!T&&P.length>0)for(const t of P)this._addMergeNodeData(e,t,i,a,s+1);e.push(y)}},a.prototype._getActionInfoFromCRNode=function(e){var t=n.getInstPidFromCRNode(e);return this._actionInfos.getInstActionInfo(t)},a.prototype.doPostMergeRefresh=function(t,n){var o={created:[],deleted:[],modified:[],context:null},i=e.fetchContentFromCompass();if(i&&i.source){var r=i.source,a="ENOPRSU_AP"===r||"ENOPSTR_AP"===r;o.context={widget:{data:{x3dAppId:r}}}}var s=t[0].physicalid_trgt_root,c=n.find(e=>e.derivedfromphysicalid===s),l={physicalid:c.physicalid,sourceObjectId:c.derivedfromphysicalid,operation:"Revise",refreshPSD:a};if(o.created.push(l),n.forEach(function(e){var t={physicalid:e.derivedfromphysicalid,operation:"Revise"};o.modified.push(t)}),!widget._isODTMode()){require(["DS/LifecycleServices/Refresh"],function(e){e._refreshCb(o)})}},a.prototype.showNotifMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"warning")},a.prototype.showErrorMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"error")},a}),define("DS/CompareMergePlugin/MERGE_MERGE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/mergeManager"],function(e,t){return e.extend({init:function(e,n,o,i){this._parent(e,n,o,i),this.mergeManager=new t(o,i)},onEnabled:function(){var e=this;return e.subscribeEvent("EXECUTE_MERGE_EVENT",e.handle_EXECUTE_MERGE_EVENT.bind(e)),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.copyTitleFromSource","_copyTitleFromSource",null,e.mergeManager),e._parent()},handle_EXECUTE_MERGE_EVENT:function(e){this._plugSvcs.dbgout("MERGE MERGE","executing... "),this.mergeManager.doMerge()},execute:function(e,t){try{var n=this;n._parent(e,t),e.crTreeArray&&e.actionInfos&&n.mergeManager.update(e.crTreeArray[0],e.actionInfos),n.reportOK(null)}catch(t){n._plugSvcs.dbgout("MERGE MERGE","reports exception:: "+t),n.reportKO(e)}}})}),define("DS/CompareMergePlugin/ActionHandlerSynchronize",["DS/CompareMergePlugin/NodeUtils","DS/CompareMergePlugin/CRNodeUtils","DS/CompareMergePlugin/ActionOption","DS/CompareMergePlugin/Action"],function(e,t,n,o){"use strict";return{addRootActions:function(t,i,r){var a=e.nodeIsModified(i)||e.nodeHasModifiedChild(i)||e.nodeHasLeftOnlyOrRightOnlyChild(i);t.addAction(new o(n.REVISE_TARGET,r.createARevision&&!a,!0)),t.addAction(new o(n.REVISE_TARGET_TAKE_SOURCE,r.createARevision&&a,!0)),t.addAction(new o(n.OVERWRITE_TARGET,!r.createARevision&&a,!0)),t.addAction(new o(n.KEEP_TARGET,!r.createARevision&&!a,!0))},addActions:function(i,r,a,s){var c={infoPid:r.infoPid,infoPidInst:r.infoPidInst},l=r.parentActionInfo.hasActionOptionSelected(n.DELETE_TARGET),d=r.parentActionInfo.hasActionOptionSelected(n.IGNORE_SOURCE),g=r.parentActionInfo.hasActionOptionSelected(n.KEEP_TARGET),u=r.parentActionInfo.hasActionOptionSelected(n.KEEP_SOURCE),p=r.parentActionInfo.hasActionOptionSelected(n.OVERWRITE_TARGET),A=r.parentActionInfo.hasActionOptionSelected(n.REVISE_TARGET),E=r.parentActionInfo.hasActionOptionSelected(n.REVISE_TARGET_TAKE_SOURCE),R=r.parentActionInfo.hasActionOptionSelected(n.ADD_TO_TARGET),f=a.allParentsHaveActionInfo(r.childNode),_=a.getCRNodesByRefPid().get(r.infoPid),h=a.getCRNodesByVersionId(r.childNode),T=_.length>1,S=_.some(t=>e.nodeIsModified(t)||e.nodeHasModifiedChild(t)||e.nodeHasLeftOnlyOrRightOnlyChild(t)),m=(e.nodeIsReplaced(r.childNode),e.nodeIsConsideredAggregated(r.childNode)),I=_.some(t=>e.nodeIsReplaced(t)),C=(e.nodeIsOnReplacedBranch(r.childNode),_.some(t=>e.nodeIsOnReplacedBranch(t))),N=_.some(t=>!e.nodeIsRightOnly(t)),v=h.some(t=>!e.nodeIsRightOnly(t)),O=!0,M=!u,y=!u,P=!u,D=!u&&!N&&!v,F=!u,b=A||E,w=!u;if(m&&(O=u,D=!u&&!l&&!d,y=l,F=!u&&!l&&!R,M=g||p,P=g||p,b=A||E,w=A||E),r.childBaseNodePid===r.childCompNodePid){var U=e.nodeCanBeRevised(r.childNode);i.addAction(new o(n.KEEP_TARGET,!I&&!C,M)),i.addAction(new o(n.KEEP_SOURCE,I||C,O)),i.addAction(new o(n.DELETE_TARGET,!1,y)),!U||I||C||i.addAction(new o(n.REVISE_TARGET,!1,b))}else if(r.childBaseNodePid&&r.childCompNodePid){U=e.nodeCanBeRevised(r.childNode);i.addAction(new o(n.KEEP_TARGET,!1,M)),i.addAction(new o(n.KEEP_SOURCE,!1,O)),i.addAction(new o(n.DELETE_TARGET,!1,y)),!U||I||C||(i.addAction(new o(n.REVISE_TARGET,!1,b)),i.addAction(new o(n.REVISE_TARGET_TAKE_SOURCE,!1,w))),I||C||i.addAction(new o(n.OVERWRITE_TARGET,!1,P));var B=n.KEEP_TARGET;B=I||C?n.KEEP_SOURCE:S?U&&s.createARevision?n.REVISE_TARGET_TAKE_SOURCE:n.OVERWRITE_TARGET:U&&s.createARevision?n.REVISE_TARGET:n.KEEP_TARGET,i.setSelectedActionByOption(B)}else if(r.childBaseNodePid&&!r.childCompNodePid&&"LEFT_ONLY"==r.childRelName){U=e.nodeCanBeRevised(r.childNode);i.addAction(new o(n.KEEP_TARGET,!C,!C&&M)),i.addAction(new o(n.DELETE_TARGET,!!C,y)),U&&!C&&i.addAction(new o(n.REVISE_TARGET,!1,b))}else if(!r.childBaseNodePid&&r.childCompNodePid&&"RIGHT_ONLY"==r.childRelName){U=e.nodeCanBeRevised(r.childNode);if(c.infoPid=r.childCompNodePid,c.infoPidInst=r.childCompNodePidInst,i.addAction(new o(n.KEEP_SOURCE,!(!C&&D),O)),N||v){if(U&&!C){var G=new o(n.REVISE_TARGET,!1,b);G.postAdded=!0,i.addAction(G)}}else i.addAction(new o(n.ADD_TO_TARGET,!(C||!D),D));i.addAction(new o(n.IGNORE_SOURCE,!1,F))}if(T&&f&&((L=a.getRefActionInfo(r.infoPid))&&L.size==_.length-1)){b=a.allParentsSetToActionOption(r.childNode,[n.REVISE_TARGET,n.REVISE_TARGET_TAKE_SOURCE,n.ADD_TO_TARGET]);var L,V=i.hasActionOptionSelected(n.REVISE_TARGET),W=!(!(L=a.getRefActionInfo(r.infoPid))||!Array.from(L.values()).some(e=>e.hasActionOptionSelected(n.REVISE_TARGET))),x=V||W;for(const e of _){var K=t.getInstPidFromCRNode(e),H=null,k=(H=K===r.infoPidInst?i:a.getInstActionInfo(K)).hasActionOption(n.REVISE_TARGET),j=H.hasActionOptionEnabled(n.REVISE_TARGET),Y=H.hasActionOptionSelected(n.REVISE_TARGET);if((b&&!j||!b&&j)&&H.setEnableActionByOption(n.REVISE_TARGET,b),Y&&!b){var q=H.hasActionOptionEnabled(n.KEEP_TARGET)?n.KEEP_TARGET:n.KEEP_SOURCE;H.setSelectedActionByOption(q)}else k&&!Y&&b&&x&&H.setSelectedActionByOption(n.REVISE_TARGET)}}return c.childActionInfo=i,c},handleChildActionSelected:function(o,i,r,a,s){var c={propagateFurther:!1,affectsChildren:!1,setActionOption:i},l=null,d=r.getActionSelected().actionOption,g=e.nodeIsConsideredAggregated(o);if(i===n.ADD_TO_TARGET){if(r.setEnableActionByOption(n.ADD_TO_TARGET,!0),r.setEnableActionByOption(n.KEEP_SOURCE,!g),r.setEnableActionByOption(n.IGNORE_SOURCE,!g),r.hasActionOption(n.REVISE_TARGET)){var u=a.allParentsSetToActionOption(o,[n.REVISE_TARGET,n.REVISE_TARGET_TAKE_SOURCE,n.ADD_TO_TARGET]),p=!(!(R=r.getActionByActionOption(n.REVISE_TARGET))||!R.postAdded);r.setEnableActionByOption(n.REVISE_TARGET,u&&!p)}l=r.hasActionOptionEnabled(n.ADD_TO_TARGET)?n.ADD_TO_TARGET:d,r.setSelectedActionByOption(l)}else if(i===n.OVERWRITE_TARGET)r.setEnableActionByOption(n.REVISE_TARGET,!1/*!nodeIsAggregated*/),r.setEnableActionByOption(n.REVISE_TARGET_TAKE_SOURCE,!g),r.setEnableActionByOption(n.OVERWRITE_TARGET,!0),r.setEnableActionByOption(n.KEEP_TARGET,!0),r.setEnableActionByOption(n.ADD_TO_TARGET,!0),r.setEnableActionByOption(n.KEEP_SOURCE,!g),r.setEnableActionByOption(n.IGNORE_SOURCE,!0),r.setEnableActionByOption(n.DELETE_TARGET,!g),l=r.hasActionOptionEnabled(d)?d:d===n.REVISE_TARGET&&r.hasActionOptionEnabled(n.REVISE_TARGET_TAKE_SOURCE)?n.REVISE_TARGET_TAKE_SOURCE:r.hasActionOptionEnabled(n.OVERWRITE_TARGET)?n.OVERWRITE_TARGET:r.hasActionOptionEnabled(n.KEEP_TARGET)?n.KEEP_TARGET:n.KEEP_SOURCE,r.setSelectedActionByOption(l);else if(i===n.KEEP_TARGET){if(e.nodeIsRightOnly(o))if(a.getParentActionInfo(o).hasActionOptionSelected(n.KEEP_TARGET))r.setEnableActionByOption(n.KEEP_SOURCE,!g),r.setEnableActionByOption(n.ADD_TO_TARGET,!0),r.setEnableActionByOption(n.IGNORE_SOURCE,!0),l=n.IGNORE_SOURCE,r.setSelectedActionByOption(l);else{console.log("########### - Propagating Keep Target to Right Only child, but not from it's parent!");var A=t.getCompRefPidFromCRNode(o),E=t.getInstPidFromCRNode(o);l=this.handleUnavailableReferenceAction(E,A,r,n.KEEP_TARGET,a)}else r.setEnableActionByOption(n.REVISE_TARGET,!1/*!nodeIsAggregated*/),r.setEnableActionByOption(n.REVISE_TARGET_TAKE_SOURCE,!g),r.setEnableActionByOption(n.OVERWRITE_TARGET,!0),r.setEnableActionByOption(n.KEEP_TARGET,!0),r.setEnableActionByOption(n.KEEP_SOURCE,!g),r.setEnableActionByOption(n.DELETE_TARGET,!g),l=n.KEEP_TARGET,r.setSelectedActionByOption(l)}else if(i===n.KEEP_SOURCE){if(e.nodeIsLeftOnly(o))if(a.getParentActionInfo(o).hasActionOptionSelected(n.KEEP_SOURCE))r.setEnableActionByOption(n.KEEP_TARGET,!1),r.setEnableActionByOption(n.REVISE_TARGET,!1),r.setEnableActionByOption(n.DELETE_TARGET,!0),l=n.DELETE_TARGET,r.setSelectedActionByOption(l);else{console.log("########### - Propagating Keep Source to Left Only child, but not from it's parent!");A=t.getCompRefPidFromCRNode(o),E=t.getInstPidFromCRNode(o);l=this.handleUnavailableReferenceAction(E,A,r,n.KEEP_SOURCE,a)}else r.setEnableActionByOption(n.OVERWRITE_TARGET,!1),r.setEnableActionByOption(n.KEEP_TARGET,!1),r.setEnableActionByOption(n.REVISE_TARGET,!1),r.setEnableActionByOption(n.REVISE_TARGET_TAKE_SOURCE,!1),r.setEnableActionByOption(n.KEEP_SOURCE,!0),r.setEnableActionByOption(n.IGNORE_SOURCE,!1),r.setEnableActionByOption(n.DELETE_TARGET,!1),r.setEnableActionByOption(n.ADD_TO_TARGET,!1),l=n.KEEP_SOURCE,r.setSelectedActionByOption(l)}else if(i===n.DELETE_TARGET)l=(e.nodeIsRightOnly(o),d);else if(i===n.IGNORE_SOURCE)l=d;else if(i===n.REVISE_TARGET){u=a.allParentsSetToActionOption(o,[n.REVISE_TARGET,n.REVISE_TARGET_TAKE_SOURCE,n.ADD_TO_TARGET]),p=!(!(R=r.getActionByActionOption(n.REVISE_TARGET))||!R.postAdded);r.setEnableActionByOption(n.REVISE_TARGET,u&&!p),r.setEnableActionByOption(n.REVISE_TARGET_TAKE_SOURCE,!0),r.setEnableActionByOption(n.OVERWRITE_TARGET,!g),r.setEnableActionByOption(n.KEEP_TARGET,!g),r.setEnableActionByOption(n.KEEP_SOURCE,!g),r.setEnableActionByOption(n.IGNORE_SOURCE,!0),r.setEnableActionByOption(n.ADD_TO_TARGET,!0),r.setEnableActionByOption(n.DELETE_TARGET,!g),l=r.hasActionOptionEnabled(d)?d:n.REVISE_TARGET,r.setSelectedActionByOption(l)}else if(i===n.REVISE_TARGET_TAKE_SOURCE){var R;u=a.allParentsSetToActionOption(o,[n.REVISE_TARGET,n.REVISE_TARGET_TAKE_SOURCE,n.ADD_TO_TARGET]),p=!(!(R=r.getActionByActionOption(n.REVISE_TARGET))||!R.postAdded);r.setEnableActionByOption(n.REVISE_TARGET,u&&!p),r.setEnableActionByOption(n.REVISE_TARGET_TAKE_SOURCE,!0),r.setEnableActionByOption(n.OVERWRITE_TARGET,!g),r.setEnableActionByOption(n.KEEP_TARGET,!g),r.setEnableActionByOption(n.KEEP_SOURCE,!g),r.setEnableActionByOption(n.IGNORE_SOURCE,!0),r.setEnableActionByOption(n.ADD_TO_TARGET,!0),r.setEnableActionByOption(n.DELETE_TARGET,!g),l=r.hasActionOptionEnabled(d)?d:r.hasActionOptionEnabled(n.REVISE_TARGET_TAKE_SOURCE)?n.REVISE_TARGET_TAKE_SOURCE:n.REVISE_TARGET,r.setSelectedActionByOption(l)}return c.setActionOption=l||i,c.propagateFurther=c.setActionOption===n.DELETE_TARGET||c.setActionOption===n.IGNORE_SOURCE||c.setActionOption===n.ADD_TO_TARGET||c.setActionOption===n.KEEP_TARGET||c.setActionOption===n.KEEP_SOURCE,c.affectsChildren=!0,c},isReferenceAction:function(e,t,o){if(e===n.DELETE_TARGET||e===n.IGNORE_SOURCE)return!1;if(e===n.KEEP_SOURCE&&o){var i=!1,r=t.getCRNodesByRefPid().get(o);for(const e of r){var a=e.getMatchInfo().getCompNode().getAttr("versionid"),s=t.getCRNodesByVersionId().get(a);if(s&&s.length>0){i=!0;break}}return i}return!0},handleActionAvailabilityOfAllVersions:function(e,o,i){t.getInstPidFromCRNode(e);var r=t.getRefPidFromCRNode(e),a=o.getCRNodesByVersionId(e);for(const e of a){var s=t.getInstPidFromCRNode(e),c=t.getRefPidFromCRNode(e);if(c===r);else{console.log("##### Found another ref among versions, NOT updated. Instance:"+s);var l=o.getRefActionInfo(c);for(let[t,r]of l.entries())if(r.hasActionOption(n.REVISE_TARGET)){var d=o.allParentsSetToActionOption(e,[n.REVISE_TARGET,n.REVISE_TARGET_TAKE_SOURCE,n.ADD_TO_TARGET]),g=r.getActionByActionOption(n.REVISE_TARGET),u=!(!g||!g.postAdded);r.setEnableActionByOption(n.REVISE_TARGET,d&&!u),i.set(c,r.getActionOptionSelected())}}}},handlePostAddedActions:function(e){e.getEnabledActionsNotSelected().forEach(function(t){t.postAdded&&(console.log("##### Disabling post added action:"+t.actionOption.name),e.setEnableActionByOption(t.actionOption,!1))})},handleUnavailableReferenceAction:function(e,t,i,r,a){var s,c=this;if(i.hasActionOptionEnabled(r))return null;var l=r;if(i.hasActionOption(r))i.setEnableActionByOption(r,!0);else{var d=!1;if(r===n.KEEP_TARGET?i.hasActionOption(n.KEEP_SOURCE)&&(l=n.KEEP_SOURCE,d=!0):r===n.KEEP_SOURCE&&i.hasActionOption(n.KEEP_TARGET)&&(l=n.KEEP_TARGET,d=!0),!d){var g=new o(r,!1,!0);g.postAdded=!0,i.addAction(g)}}return i.setSelectedActionByOption(l),s=l,i.getEnabledActionsNotSelected().forEach(function(o){if(c.isReferenceAction(o.actionOption,a,t)){var r=o.postAdded;if(!r&&o.actionOption===n.REVISE_TARGET){var s=a.getCRNodesByInstPid().get(e)[0];r=!a.allParentsSetToActionOption(s,[n.REVISE_TARGET,n.REVISE_TARGET_TAKE_SOURCE,n.ADD_TO_TARGET])}r&&i.setEnableActionByOption(o.actionOption,!1)}}),s},nodeFollowsParentAction:function(t){return e.nodeIs3DShapeWith3DPartUsage(t)}}}),define("DS/CompareMergePlugin/ActionHandlerNRF",["DS/CompareMergePlugin/NodeUtils","DS/CompareMergePlugin/ActionOption","DS/CompareMergePlugin/Action"],function(e,t,n){"use strict";return{addRootActions:function(e,o,i){e.addAction(new n(t.REVISE,!0,!0))},addActions:function(o,i,r,a){var s={infoPid:i.infoPid,infoPidInst:i.infoPidInst};return i.parentActionInfo.hasOnlyReuseAction()?o.addAction(new n(t.REUSE,!0,!0)):i.childBaseNodePid===i.childCompNodePid||i.parentActionInfo.hasReuseActionSelected()?(o.addAction(new n(t.REUSE,!0,!0)),o.addAction(new n(t.REVISE,!1,!i.parentActionInfo.hasReuseActionSelected())),a.reuseReferenceEnabled&&o.addAction(new n(t.REUSEREFERENCE,!1,!0))):i.childBaseNodePid&&i.childCompNodePid?e.nodeCanBeRevised(i.childNode)?(o.addAction(new n(t.REVISE,!0,!0)),o.addAction(new n(t.REUSE,!1,!0)),a.reuseReferenceEnabled&&o.addAction(new n(t.REUSEREFERENCE,!1,!0))):o.addAction(new n(t.REUSE,!0,!0)):i.childBaseNodePid&&!i.childCompNodePid&&"LEFT_ONLY"==i.childRelName?o.addAction(new n(t.EXCLUDE,!0,!0)):!i.childBaseNodePid&&i.childCompNodePid&&"RIGHT_ONLY"==i.childRelName&&(r.addCrNode(i.childCompNodePid,i.childCompNode),s.infoPid=i.childCompNodePid,s.infoPidInst=i.childCompNodePidInst,o.addAction(new n(t.REUSE,!1,!0)),o.addAction(new n(t.INSERTNEW,!0,!0)),a.reuseReferenceEnabled&&o.addAction(new n(t.REUSEREFERENCE,!1,!1))),s.childActionInfo=o,s},handleChildActionSelected:function(e,n,o,i,r){var a={propagateFurther:!1,affectsChildren:!1,setActionOption:n},s=o.getActionSelected().actionOption;if(n===t.REUSE)o.setEnableActionByOption(t.REVISE,!1),o.setEnableActionByOption(t.REUSEREFERENCE,!1),o.setEnableActionByOption(t.INSERTNEW,!1),o.setEnableActionByOption(t.REUSE,!0),o.setSelectedActionByOption(t.REUSE),i.enableActionOptionForOtherParents(e,t.REUSEREFERENCE,!1,r),i.enableActionOptionForOtherParents(e,t.REUSE,!0,r);else if(n===t.REUSEREFERENCE)o.setEnableActionByOption(t.REVISE,!1),o.setEnableActionByOption(t.REUSE,!1),o.setEnableActionByOption(t.INSERTNEW,!1),o.setEnableActionByOption(t.REUSEREFERENCE,!0),o.setSelectedActionByOption(t.REUSEREFERENCE),i.enableActionOptionForOtherParents(e,t.REUSE,!1,r),i.enableActionOptionForOtherParents(e,t.REUSEREFERENCE,!0,r);else if(n===t.REVISE){if(i.allOtherParentsSetToRevise(e)){o.setEnableActionByOption(t.REVISE,!0),o.setEnableActionByOption(t.REUSE,!0),o.setEnableActionByOption(t.INSERTNEW,!0);var c=o.hasActionOption(t.INSERTNEW);o.setEnableActionByOption(t.REUSEREFERENCE,!c),c&&s==t.REUSEREFERENCE&&(n=t.INSERTNEW,s=t.INSERTNEW),o.setSelectedActionByOption(s),i.enableActionOptionForOtherParents(e,t.REUSE,!0,r),i.enableActionOptionForOtherParents(e,t.REUSEREFERENCE,!0,r)}}else if(n===t.INSERTNEW){o.setEnableActionByOption(t.INSERTNEW,!0),o.setEnableActionByOption(t.REUSE,!0),o.setEnableActionByOption(t.REUSEREFERENCE,!1);var l=s===t.REUSEREFERENCE?t.INSERTNEW:t.REUSE;o.setSelectedActionByOption(l)}return a.setActionOption=n,a.propagateFurther=a.setActionOption===t.REUSE||a.setActionOption===t.REUSEREFERENCE||a.setActionOption===t.INSERTNEW,a},isReferenceAction:function(e){return!0},handleActionAvailabilityOfAllVersions:function(e,t,n){},handlePostAddedActions:function(e){},handleUnavailableReferenceAction:function(e,t,n,o,i){return null},nodeFollowsParentAction:function(t){return e.nodeFollowsParent(t)}}}),define("DS/CompareMergePlugin/actionInfos",["DS/CompareWidget2/support/cw2Utils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/ActionOption","DS/CompareMergePlugin/Action","DS/CompareMergePlugin/ActionHandlerNRF","DS/CompareMergePlugin/ActionHandlerSynchronize","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/CompareMergePlugin/NodeUtils"],function(e,t,n,o,i,r,a,s){var c="[actionInfos]";class l{constructor(){this._actions=[],this._selectedActionOptionHistory=[],this._firstSetAmongInstances=!0}addAction(e){this.hasActionOption(e.actionOption)||this._actions.push(e)}removeActionByOption(e){this._actions=this._actions.filter(t=>t.actionOption!==e)}clearActions(){this._actions=[]}getActions(){return this._actions.sort((e,t)=>e.actionOption.id-t.actionOption.id)}getEnabledActions(){return this._actions.filter(e=>!0===e.isEnabled).sort((e,t)=>e.actionOption.id-t.actionOption.id)}getEnabledActionsNotSelected(){return this.getEnabledActions().filter(e=>!1===e.isSelected)}getActionSelected(){for(const e of this._actions)if(e.isSelected)return e}getActionOptionSelected(){return this.getActionSelected().actionOption}getPreviouslySelectedActionOption(){return this._selectedActionOptionHistory.length>0?this._selectedActionOptionHistory[this._selectedActionOptionHistory.length-1]:null}getDefaultSelectedActionOption(){return this._selectedActionOptionHistory.length>0?this._selectedActionOptionHistory[0]:this.getActionOptionSelected()}getActionByActionOption(e){for(const t of this._actions)if(t.actionOption.id===e.id)return t;return null}getActionByOptionId(e){for(const t of this._actions)if(t.actionOption.id===e)return t;return null}getActionByOptionName(e){for(const t of this._actions)if(t.actionOption.name===e)return t;return null}setEnableActionByOption(e,t){for(const n of this._actions)if(n.actionOption===e){n.isEnabled=t;break}}setSelectedActionByOption(e){if(this.hasActionOptionEnabled(e))for(const t of this._actions)t.isSelected&&this._selectedActionOptionHistory.push(t.actionOption),t.isSelected=t.actionOption===e;else g("Tried setting action "+e.nls+" as selected, but not available or enabled.")}getEnabledActionCount(){var e=0;for(const t of this._actions)t.isEnabled&&e++;return e}hasActionOptionSelected(e){for(const t of this._actions)if(t.actionOption===e&&t.isSelected)return!0;return!1}hasReuseActionSelected(){return this.hasActionOptionSelected(n.REUSE)}hasOnlyActionOption(e){return 1===this._actions.length&&this._actions[0].actionOption===e}hasOnlyReuseAction(){return this.hasOnlyActionOption(n.REUSE)}hasActionOption(e){for(const t of this._actions)if(t.actionOption===e)return!0;return!1}hasActionOptionEnabled(e){for(const t of this._actions)if(t.actionOption===e&&t.isEnabled)return!0;return!1}}function d(t){e.dbgout(c+" "+t)}function g(t){e.warnout(c+" "+t)}function u(e){var t=e.getMatchInfo(),n=t.getBaseNode().getAttr("physicalID_INST"),o=t.getCompNode().getAttr("physicalID_INST");return n||o}function p(e){var t=e.getMatchInfo(),n=t.getBaseNode().getAttr("physicalID_REF"),o=t.getCompNode().getAttr("physicalID_REF");return n||o}function A(e){var t=e.getMatchInfo();return t?"RIGHT_ONLY"==t.getRelName()?t.getCompNode():t.getBaseNode():e}return function(e,t){this._actionInfosByRefPid=new Map,this._actionInfosByInstPid=new Map,this._options=t||{reuseReferenceEnabled:!1},this._actionHandler=t&&t.mode&&"nrf"==t.mode?i:r,this._crNodesByRefPid=new Map,this._crNodesByVersionId=new Map,this._crNodesByInstPid=new Map,this.getOptions=function(){return this._options},this.getActionHandler=function(){return this._actionHandler},this.getCRNodesByRefPid=function(){return this._crNodesByRefPid},this.getCRNodesByVersionId=function(e){if(e){var t=e.getAttr("versionid");return t?this._crNodesByVersionId.get(t):null}return this._crNodesByVersionId},this.getCRNodesByInstPid=function(){return this._crNodesByInstPid},this.addActionInfo=function(e,t,n){this._actionInfosByInstPid.set(t,n),this._actionInfosByRefPid.has(e)?(console.log("##### Adding actionInfo on other instance for same reference:"+e+" -> "+t),n._firstSetAmongInstances=!1,this._actionInfosByRefPid.get(e).set(t,n)):this._actionInfosByRefPid.set(e,new Map([[t,n]]))},this.addCrNode=function(e,t){if(this._crNodesByRefPid.has(e))this._crNodesByRefPid.get(e).push(t);else{var n=new Array;n.push(t),this._crNodesByRefPid.set(e,n)}var o=t.getAttr("versionid");if(o)if(this._crNodesByVersionId.has(o))this._crNodesByVersionId.get(o).push(t);else{var i=new Array;i.push(t),this._crNodesByVersionId.set(o,i)}var r=u(t);if(r)if(this._crNodesByInstPid.has(r))this._crNodesByInstPid.get(r).push(t);else{var a=new Array;a.push(t),this._crNodesByInstPid.set(r,a)}},this.getParentActionInfo=function(e){var t=u(e.getParent());return this.getInstActionInfo(t)},this.allParentsHaveActionInfo=function(e){var t=this,n=p(e);return this._crNodesByRefPid.get(n).every(function(e){var n=u(e.getParent());return null!=t.getInstActionInfo(n)})},this.allParentsSetToActionOption=function(e,t){var n=this,o=Array.isArray(t)?t:[t];return u(e),p(e),u(e.getParent()),this.getCRNodesByVersionId(e).every(function(e){var t=u(e.getParent()),i=n.getInstActionInfo(t);return o.includes(i.getActionOptionSelected())})},this.allOtherParentsSetToRevise=function(e){var t=this,o=(u(e),p(e)),i=u(e.getParent());return this._crNodesByRefPid.get(o).every(function(e){var o=u(e.getParent());return o===i||t.getInstActionInfo(o).getActionOptionSelected()===n.REVISE})},this.enableActionOptionForOtherParents=function(e,t,n,o){u(e);var i=p(e),r=u(e.getParent()),a=this._crNodesByRefPid.get(i);for(const e of a){var s=e.getParent(),c=p(s),l=u(s);if(l!==r){var d=this.getInstActionInfo(l);d.setEnableActionByOption(t,n),o.set(c,d.getActionOptionSelected())}}},this._getActionOptionFromActionName=function(e){var t=null;return Object.entries(n).every(([o,i])=>i.name!==e||(t=n[o],!1)),t},this.updateActionSelected=function(e,t){var n=new Map,o=u(e),i=p(e),r=A(e),a=this._getActionOptionFromActionName(t),s=this._actionHandler.isReferenceAction(a,this,i),c=this.getRefActionInfo(i);for(let[e,n]of c.entries()){var l=n.getActionOptionSelected(),d=this._actionHandler.isReferenceAction(l,this,i);(e===o||s&&d)&&(n._firstSetAmongInstances=e===o,n.hasActionOptionEnabled(a)?(n.setSelectedActionByOption(a),this._actionHandler.handlePostAddedActions(n)):(console.log("Calling handler to propagate reference action "+t+" to instance "+e+" because it doesn't have it!"),this._actionHandler.handleUnavailableReferenceAction(e,i,n,a,this)))}return n.set(i,a),s&&this.propagateActionToOtherVersions(r,a,n),this.updateChildrenActionSelected(e,a,n),n},this.propagateActionToOtherVersions=function(e,t,n){var o=this,i=p(e),r=o.getCRNodesByVersionId(e);for(const e of r){var a=u(e),s=p(e);if(A(e),s===i);else{console.log("##### Found another ref  among versions, NOT acted upon. Instance:"+a);var c=o.getRefActionInfo(s);for(let[e,n]of c.entries()){var l=n.getActionOptionSelected();o._actionHandler.isReferenceAction(l,o,s)&&(n.hasActionOptionEnabled(t.name)?(console.log("Setting reference action "+selActionName+" to REVISIONED instance "+e+" , it has the action."),n.setSelectedActionByOption(t)):(console.log("Calling handler to propagate reference action "+t.name+" to REVISIONED instance "+e+" because it doesn't have it!"),o._actionHandler.handleUnavailableReferenceAction(e,s,n,t,this)))}n.set(s,t)}}},this.updateChildrenActionSelected=function(e,t,n){var o=this._actionHandler.isReferenceAction(t),i=e.getChildArray();for(const I of i){var r=A(I),a=u(r),s=p(r),c=this.getRefActionInfo(s),l=!1,d=null;for(let[i,p]of c.entries())if(this._actionHandler.nodeFollowsParentAction(r)){var g=u(e),E=this.getInstActionInfo(g),R=Object.assign({},E.getActionSelected());p.clearActions(),p.addAction(R),n.set(s,t)}else{var f=r,_=null,h=p.getActionSelected().actionOption,T=this._actionHandler.isReferenceAction(h);if(i!==a){if(!o||!T)continue;var S=this.getCRNodesByInstPid().get(i);S&&S.length>0&&(f=S[0])}p.hasActionOption(t),_||(_=this._actionHandler.handleChildActionSelected(f,t,p,this,n));var m=h!==_.setActionOption;m&&!l&&(l=!0,d=_.setActionOption),m&&_.propagateFurther?this.updateChildrenActionSelected(f,_.setActionOption,n):_.affectsChildren&&f.visitAll_nodesAndFN(function(e){var t=A(e).getAttr("physicalID_REF");t&&n.set(t,_.setActionOption)}),n.set(s,_.setActionOption)}l?this._actionHandler.isReferenceAction(d,this,s)&&this.propagateActionToOtherVersions(r,d,n):this._actionHandler.handleActionAvailabilityOfAllVersions(r,this,n)}},this.getCRNodeActionInfo=function(e){for(var t=e.getParent(),o=null,i=!1;t&&!i;){var r=u(t);(o=this.getInstActionInfo(r).getActionSelected()).actionOption===n.DELETE_TARGET||o.actionOption===n.IGNORE_SOURCE?i=!0:t=t.getParent()}var a=null;if(i){a=new l;var c=Object.create(o);c.actionOption===n.DELETE_TARGET&&s.nodeIsRightOnly(e)&&(c.actionOption=n.IGNORE_SOURCE),a.addAction(c)}else{var d=u(e);a=this.getInstActionInfo(d)}return a},this.getInstActionInfo=function(e){return this._actionInfosByInstPid.get(e)},this.getRefActionInfo=function(e){return this._actionInfosByRefPid.get(e)},this.hasInstActionInfo=function(e){return this._actionInfosByInstPid.has(e)},this.hasRefActionInfo=function(e){return this._actionInfosByRefPid.has(e)};var a=e.getRoot(0),c=a.getAttr("physicalID_REF"),E=a.getAttr("physicalID_INST"),R=new l;this._actionHandler.addRootActions(R,a,t),this.addActionInfo(c,E,R);var f=this;a.visitAll_nodesAndFN(function(e){var t=A(e),n=t.getAttr("physicalID_REF");n&&f.addCrNode(n,t)}),function e(t,i){var r=t.getAttr("physicalID_REF"),a=t.getAttr("physicalID_INST"),s=t.getMatchInfo();s&&(r=s.getBaseNode().getAttr("physicalID_REF"),a=s.getBaseNode().getAttr("physicalID_INST"),r||(r=s.getCompNode().getAttr("physicalID_REF"),a=s.getCompNode().getAttr("physicalID_INST")));var c=i.getInstActionInfo(a),u={parentActionInfo:c},p=t.getChildArray();for(const t of p){var E=A(t),R=E.getAttr("physicalID_REF"),f=E.getAttr("physicalID_INST");if(u.infoPid=R,u.infoPidInst=f,i.hasInstActionInfo(f))d("Hmmm, found occurrence for instance:"+E.getAttr("title"));else{i.hasRefActionInfo(R);var _=i.getActionHandler(),h=new l;if(_.nodeFollowsParentAction(E)){d("This child follows parent:"+E.getAttr("title"));var T=Object.assign({},c.getActionSelected());h.addAction(T),i.addActionInfo(R,f,h),e(E,i)}else{var S=E.getMatchInfo();if(S){var m=S.getRelName(),I=S.getBaseNode(),C=I.getAttr("physicalID_REF"),N=I.getAttr("physicalID_INST"),v=S.getCompNode(),O=v.getAttr("physicalID_REF"),M=v.getAttr("physicalID_INST");u.childNode=E,u.childRelName=m,u.childBaseNode=I,u.childBaseNodePid=C,u.childBaseNodePidInst=N,u.childCompNode=v,u.childCompNodePid=O,u.childCompNodePidInst=M;var y=i.getOptions(),P=_.addActions(h,u,i,y);R=P.infoPid,f=P.infoPidInst}else g("No matchinfo found in addActionInfoForChildren!"),h.addAction(new o(n.EXCLUDE,!0,!0));i.addActionInfo(R,f,h),e(E,i)}}}}(a,this),function e(t,i){var r=t.getChildArray();for(const t of r){var a=t.getAttr("physicalID_REF"),s=t.getAttr("physicalID_INST");if(!i.hasInstActionInfo(s)){if(i.hasRefActionInfo(a),!t.getMatchInfo()){g("No matchinfo found in addActionInfoForChildrenInsertedNew!");var c=new l;c.addAction(new o(n.REUSE,!1,!0)),c.addAction(new o(n.INSERTNEW,!0,!0)),i.addActionInfo(a,s,c)}e(t,i)}}}(e.getRoot(1),this)}}),define("DS/CompareMergePlugin/MERGE_COMPUTE_ACTIONS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/actionInfos","DS/CompareMergePlugin/CRNodeUtils","DS/LifecycleServices/LifecycleServices"],function(e,t,n,o){return e.extend({init:function(e,t,n,o){this._parent(e,t,n,o),this._createARevision=!0,this._branchIntents=["S","F","D"]},onEnabled:function(){return this.syncSetting("viewSettings.MERGE_STRUCT_VIEW.createARevision","_createARevision",null),this._parent()},execute:function(e,n){var o=this;o._parent(e,n);var i=e.crTreeArray[0],r=this._getTreeNodesReviseAccessInfo(i),a=this._getTreeNodesAttributeInfo(i),s=this._getReuseReferenceEnabled(i),c=this._getAllowedSemantics(i);UWA.Promise.all([r,a,s,c]).then(r=>{var a=r[0],s=r[1],c=r[2],l=r[3];o._populateReviseAccessInfo(a,i),o._populateAttributeInfo(s,i),l&&l.allowedSemantics&&o._populateAllowedBranchIntents(l.allowedSemantics,i);var d={reuseReferenceEnabled:c,createARevision:o._createARevision,mode:n.MODE},g=new t(i,d);if(null!=e.crTreeArray){var u={crTreeArray:e.crTreeArray,ruleNames:e.ruleNames,actionInfos:g,intents:l?l.intents:null,destroy:function(){}};o.reportOK(u)}else o.reportKO()})},_getAttributes:function(){return["attribute[PLMEntity.V_usage]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","type.kindof[BundleFastenerAbstract]","type.kindof[PLMPort]","type.kindof[PLMConnection]","firstRevision","majorid.lastmajorid.bestsofar.physicalid","majorid.lastmajorid.bestsofar.revision","majorid.lastmajorid.bestsofar.attribute[PLMEntity.V_Name]","majorid.lastmajorid.bestsofar.attribute[Title]","displayType","locker","policy","last.current","attribute[XCADExtension.V_CADOrigin]","attribute[XCADRepExtension.V_CADFileOrigin]","isConfigured","versionid"]},_getReviseAccessAttributes:function(){return["majorid.lastmajorid.bestsofar.current.access[majorrevise]","majorid.lastmajorid.bestsofar.current.access[revise]","last.current.majorrevisionable","last.current.revisionable"]},_getTreeNodesAttributeInfo:function(e){var t=this._getAttributes(),n=new Set;for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,function(e){var t=e.getAttr("physicalID_REF");t&&n.add(t)});return this._getAttributeInfo(e,n,t)},_getTreeNodesReviseAccessInfo:function(e){var t=this._getReviseAccessAttributes(),o=new Set;for(let t=0;t<1;t++)e.visitAll_treeAndFN(t,function(e){var t=n.getRefPidFromCRNode(e);t&&o.add(t)});return this._getAttributeInfo(e,o,t)},_getAttributeInfo:function(e,t,n){var o=this;return new UWA.Class.Promise(function(i,r){var a={data:[],attributes:n};t.forEach(function(e){if(-1===a.data.findIndex(t=>t.physicalid===e)){var t={physicalid:e};a.data.push(t)}});var s=e.getRoot(0).getObjIDSpec_REF(),c=s.getTenant(),l=s.getServiceName(),d=s.getSecurityContext(),g=o._plugSvcs.nowMS();o._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/product/attributeList","POST",a,"json",c,l,d).then(function(e){o._plugSvcs.reportTime(g,"attributeList request OK.");var t="string"==typeof e?JSON.parse(e):e;i(t)},function(e){o._plugSvcs.reportTime(g,"attributeList request failed."),o._plugSvcs.showAlertBox("attributeList request unsuccessful.",null,"error"),o._plugSvcs.errout("Failure of attributeList request: "+e)})})},_getAllowedSemantics:function(e){var t=new Set;if(e.visitAll_treeAndFN(0,function(e){var n=e.getMatchInfo();if(n){var o=n.getBaseNode();if(o&&!o.isDummy());else{var i=n.getCompNode().getAttr("physicalID_REF");i&&t.add(i)}}}),0===t.size)return new UWA.Promise(function(e,t){e(null)});var n=e.getRoot(0).getObjIDSpec_REF();return o.getAllowedSemanticsPromise(Array.from(t),n,{nlsintents:!0})},_populateAttributeInfo:function(e,t){e.getAttInfo=function(e){return this.results.find(t=>t.physicalid===e)};var n=this._getAttributes();for(let o=0;o<2;o++)t.visitAll_treeAndFN(o,function(t){var o=t.getAttr("physicalID_REF");if(o){var i=e.getAttInfo(o);i&&n.forEach(function(e){t.addAttr(e,i[e])})}})},_populateReviseAccessInfo:function(e,t){e.getAttInfo=function(e){return this.results.find(t=>t.physicalid===e)};var n=this._getReviseAccessAttributes();for(let o=0;o<2;o++)t.visitAll_treeAndFN(o,function(t){var o=t.getAttr("physicalID_REF");if(o){var i=e.getAttInfo(o);i&&n.forEach(function(e){t.addAttr(e,i[e])})}})},_populateAllowedBranchIntents:function(e,t){var n=this;e.getSemanticInfo=function(e){return this.find(t=>t.id===e)},t.visitAll_treeAndFN(0,function(t){var o=t.getMatchInfo();if(o){var i=o.getBaseNode();if(i&&!i.isDummy());else{var r=o.getCompNode(),a=r.getAttr("physicalID_REF");if(a){var s=e.getSemanticInfo(a);if(s){var c=s.semantic.filter(e=>n._branchIntents.includes(e));r.addAttr("intents",c),t.addAttr("intents",c)}}}}})},_getReuseReferenceEnabled:function(e){var t=this;return new UWA.Class.Promise(function(n,o){var i=e.getRoot(0).getObjIDSpec_REF(),r=i.getTenant(),a=i.getServiceName(),s=i.getSecurityContext(),c=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/util/getExpression","GET","expression=ReuseReferenceEnabled","json",r,a,s).then(function(e){t._plugSvcs.reportTime(c,"getExpression request OK.");var o=!1;e&&e.result&&(o="true"===e.result),n(o)},function(e){t._plugSvcs.reportTime(c,"getExpression request failed."),t._plugSvcs.showAlertBox("getExpression request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getExpression request: "+e)})})}})}),define("DS/CompareMergePlugin/nrfManager",["DS/CompareCommon/Utils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/CRNodeUtils","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/LifecycleServices/LifecycleServices"],function(e,t,n,o,i){var r=function(e,t){this._options=e,this._plugSvcs=t,this._copyTitleFromSource=!1,this._crTree=null,this._actionInfos=null};return r.prototype.update=function(e,t){this._crTree=e,this._actionInfos=t},r.prototype.doNewRevisionFrom=function(){var e=this;e._plugSvcs.postEvent("MERGE_STARTED_EVENT");var t=this._getMergeData(),n={data:t},r=this._crTree.getRoot(1).getObjIDSpec_REF(),a=r.getTenant(),s=r.getServiceName(),c=(r.getSecurityContext(),e._plugSvcs.nowMS());i.getSecurityContextPromise(a).then(function(i){e._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/revise/from/","POST",n,"json",a,s,i).then(function(n){if(e._plugSvcs.reportTime(c,"New Revision From request done OK."),null!=n&&n.hasOwnProperty("status")&&n.hasOwnProperty("report")&&"failure"===n.status){for(var i=o.NRFFailureMsg,r=0;r<n.report.length;r++){var a=n.report[r];if(a.error&&a.error!==i){i=a.error;break}}return e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),void e.showErrorMsg(i)}e.doPostMergeRefresh(t,n.results);var s=o.NRFSuccessMsg;e._plugSvcs.showAlertBox(s,null,"success"),e._plugSvcs.postEvent("MERGE_ENDED_OK_EVENT")},function(t){e._plugSvcs.reportTime(c,"New Revision From request failed."),e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),e._handleRequestFailure(!0,t),e._plugSvcs.errout("Failure to merge: "+t)})})},r.prototype._handleRequestFailure=function(e,t,n){var o=this;i.showWebServiceError(t,n,function(e,t,n,i,r){t?o.showNotifMsg(e,{sticky:!0}):o.showErrorMsg(e,{title:n,subtitle:i,submessage:r})},e)},r.prototype._getMergeData=function(){var e=this._copyTitleFromSource,t=this._crTree.getRoot(1),o=n.getBaseRefPidFromCRNode(t),i=[];this._addMergeNodeData(i,t,[],0);var r={physicalid:o,treeData:i,useSourceTitle:e},a=[];return a.push(r),a},r.prototype._addMergeNodeData=function(e,o,i,r){var a=n.getBaseRefPidFromCRNode(o),s=n.getCompRefPidFromCRNode(o),c=a||s;if(-1===i.indexOf(c)){i.push(c);var l=this._getActionInfoFromCRNode(o).getActionOptionSelected().name;if(l!==t.MergeAction.Exclude){l!==t.MergeAction.ReuseReference||s&&s!==a||(l=t.MergeAction.Reuse);var d=l===t.MergeAction.InsertNew,g=l===t.MergeAction.Reuse,u=l===t.MergeAction.ReuseReference,p={physicalid:d?"":a||s,operation:l,physicalid_dup:s,level:r},A=o.getChildArray();if(!g&&!u&&A.length>0){p.children=[];for(const o of A){var E=n.getBaseRefPidFromCRNode(o),R=n.getCompRefPidFromCRNode(o),f=this._getActionInfoFromCRNode(o).getActionOptionSelected().name;if(f!==t.MergeAction.Exclude){f!==t.MergeAction.ReuseReference||R&&R!==E||(f=t.MergeAction.Reuse);var _=f===t.MergeAction.InsertNew,h=f===t.MergeAction.Reuse,T=f===t.MergeAction.ReuseReference,S={physicalid:_?"":E||R,operation:f,physicalid_dup:R};p.children.push(S),h&&T||_||!(o.getChildArray().length>0)||this._addMergeNodeData(e,o,i,r+1)}}}e.push(p)}}},r.prototype._getActionInfoFromCRNode=function(e){var t=n.getInstPidFromCRNode(e);return this._actionInfos.getInstActionInfo(t)},r.prototype.doPostMergeRefresh=function(t,n){var o={created:[],deleted:[],modified:[],context:null},i=e.fetchContentFromCompass();if(i&&i.source){var r=i.source,a="ENOPRSU_AP"===r||"ENOPSTR_AP"===r;o.context={widget:{data:{x3dAppId:r}}}}var s=t[0].treeData.findIndex(e=>0==e.level),c=t[0].treeData[s],l=n.find(e=>e.derivedfromphysicalid===c.physicalid),d={physicalid:l.physicalid,sourceObjectId:l.derivedfromphysicalid,operation:"Revise",refreshPSD:a};if(o.created.push(d),n.forEach(function(e){var t={physicalid:e.derivedfromphysicalid,operation:"Revise"};o.modified.push(t)}),!widget._isODTMode()){require(["DS/LifecycleServices/Refresh"],function(e){e._refreshCb(o)})}},r.prototype.showNotifMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"warning")},r.prototype.showErrorMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"error")},r}),define("DS/CompareMergePlugin/MERGE_NRF_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/nrfManager"],function(e,t){return e.extend({init:function(e,n,o,i){this._parent(e,n,o,i),this.nrfManager=new t(o,i)},onEnabled:function(){var e=this;return e.subscribeEvent("EXECUTE_MERGE_EVENT",e.handle_EXECUTE_MERGE_EVENT.bind(e)),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.copyTitleFromSource","_copyTitleFromSource",null,e.nrfManager),e._parent()},handle_EXECUTE_MERGE_EVENT:function(e){this._plugSvcs.dbgout("MERGE NRF","executing... "),this.nrfManager.doNewRevisionFrom()},execute:function(e,t){try{var n=this;n._parent(e,t),e.crTreeArray&&e.actionInfos&&n.nrfManager.update(e.crTreeArray[0],e.actionInfos),n.reportOK(null)}catch(t){n._plugSvcs.dbgout("MERGE NRF","reports exception:: "+t),n.reportKO(e)}}})}),define("DS/CompareMergePlugin/MergeAccess",["DS/CompareMergePlugin/NodeUtils"],function(e){"use strict";return{verifyEverythingIsMergeable:function(t){var n=!0,o=t.getRoot(0);if(o&&e.nodeIsUnrelated(o))return!1;for(let e=0;e<2;e++){var i=new Map;!0===n&&t.visitAll_treeAndFN(e,function(e){if(e.isDummy())return!0;var t=e.getAttr("attribute[XCADExtension.V_CADOrigin]"),o=e.getAttr("attribute[XCADRepExtension.V_CADFileOrigin]"),r=e.getAttr("isConfigured"),a=e.getAttr("physicalID_REF"),s=e.getAttr("versionid");if((!t||""===t&&"3DEXPERIENCE"===t)&&(!o||""===o&&"3DEXPERIENCE"===o)?r&&(n=!1):n=!1,i.has(s)){var c=i.get(s);c.includes(a)||(c.push(a),n=!1)}else i.set(s,new Array(a));return n})}return n},verifyEverythingIsRevisionable:function(t,n){var o=new Set;return t.visitAll_treeAndFN(0,function(t){var n=!0,i=t.getMatchInfo();if(i){var r=i.getRelName();!r||"LEFT_ONLY"!=r&&"RIGHT_ONLY"!=r||(n=!1)}return!n||e.nodeCanBeRevised(t)||e.nodeFollowsParent(t)||o.add(t),!0}),0==o.size||(n&&this.launchReportingPanel(o),!1)},launchReportingPanel:function(t){require(["i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/ReportingPanel/ReportingPanel"],function(n,o){var i=[];t.forEach(function(t){var o=[];o.push(t.getAttr("majorid.lastmajorid.bestsofar.physicalid")),o.push(n.deleteFailedShort),o.push("Failed");var r=t.getAttr("majorid.lastmajorid.bestsofar.attribute[Title]");r||(r=t.getAttr("majorid.lastmajorid.bestsofar.attribute[PLMEntity.V_Name]")),o.push(r);var a,s=t.getAttr("displayType");s||(s=t.getAttr("type")),o.push(s),o.push(t.getAttr("majorid.lastmajorid.bestsofar.revision")),a=e.nodeIsRevisionable(t)?"noReviseAccess":"cannotBeRevised";var c=n.replace(n.get(a),{dispName:t.getAttr("title")});o.push(c),i.push(o)});var r=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:n.status,dataIndex:"Status",typeRepresentation:"icon"},{text:n.title,dataIndex:"Title"},{text:n.type,dataIndex:"Type"},{text:n.revision,dataIndex:"Revision"},{text:n.message,dataIndex:"Message"}];o.launchReportingPanel(i,r,null)})}}}),define("DS/CompareMergePlugin/ViewPanel/mergeStructComparePanel",["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareCommon/Utils","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/CompareMergePlugin/CRNodeUtils","DS/CompareMergePlugin/MaturityUtils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/MergeAccess","DS/CompareMergePlugin/NodeUtils","DS/LifecycleControls/CommandDialogWUX","css!DS/CompareMergePlugin/CompareMergePlugin.css"],function(e,t,n,o,i,r,a,s,c,l){return e.extend({init:function(e,t,n,o){this._plugSvcs=t,this._parent(e,t,n,o),this._contentFromLeftColor=n.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,this._contentFromRightColor=n.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,this._actionInfos=null,this._displayMode="tree",this._treesAreReady=!1,this._setupActionDefs(),this.url3DSpace=this.get3DSpaceUrl(),this._statusFilterHideChildIfParentIsHidden=!1,this._copyTitleFromSource=!1,this._warningNoRevise=!1,this._createARevision=!1,this._filterModelActions={},this._filterModelAggVisibility={},this._allowedDisplayModes=[{id:"tree",icon:"tree-view-all",title:this.getLabel(),expandCollapseEnabled:!0}],this._visibleActions=[];for(const e of this._actionDefs)this._visibleActions.push(e.id);this._newSelectionToken=this._plugSvcs.subscribe("NEW_CURRENT_SELECTION_EVENT",this.handle_NEW_CURRENT_SELECTION_EVENT.bind(this))},setActionInfos:function(e){this._actionInfos=e},_setupActionDefs:function(){this._actionDefsNRF=[{aid:0,id:a.MergeAction.Revise,fontIconName:"flow-branch-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_MajorVersion.png",nls:o.Revise},{aid:1,id:a.MergeAction.ReuseReference,fontIconName:"recycle-left",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2L.png",nls:o.ReuseRef},{aid:2,id:a.MergeAction.Reuse,fontIconName:"recycle-right",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2R.png",nls:o.Reuse},{aid:3,id:a.MergeAction.Exclude,fontIconName:"remove",imagePath:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:o.Exclude},{aid:4,id:a.MergeAction.InsertNew,fontIconName:"flow-branch-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_NewBranch.png",nls:o.InsertNew}],this._actionDefsMerge=[{aid:5,id:a.MergeAction.ReviseTarget,fontIconName:"flow-line-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_MajorVersion.png",nls:o.ReviseTarget},{aid:6,id:a.MergeAction.ReviseTargetTakeSource,fontIconName:"flow-branch-add",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2L.png",nls:o.ReviseTargetTakeSource},{aid:7,id:a.MergeAction.OverwriteTarget,fontIconName:"flow-branch",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2R.png",nls:o.OverwriteTarget},{aid:9,id:a.MergeAction.KeepTarget,fontIconName:"recycle-left",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2L.png",nls:o.KeepTarget},{aid:10,id:a.MergeAction.KeepSource,fontIconName:"recycle-right",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2R.png",nls:o.KeepSource},{aid:11,id:a.MergeAction.DeleteTarget,fontIconName:"remove",imagePath:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:o.DeleteTarget},{aid:12,id:a.MergeAction.AddToTarget,fontIconName:"flow-branch-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_NewBranch.png",nls:o.AddInstToTarget},{aid:13,id:a.MergeAction.IgnoreSource,fontIconName:"ignore",imagePath:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:o.IgnoreSource}],this._actionDefs=this._actionDefsNRF.concat(this._actionDefsMerge)},_getActionDefs:function(){return this._actionDefs},get3DSpaceUrl:function(){var e=widget.getUrl();return e.substr(0,e.length-"webapps/CompareWidget/CompareWidget.html".length)},generateDataGridConfig:function(e){var t=this,n=this._parent(e),i=(e.baselineColor,e.compareColor,"4px solid "+t.options.COLOR_RESULT),r="4px solid "+t.options.COLOR_ACTION;for(let e=0;e<2;e++)n[e].cols.splice(1,0,{text:o.Maturity,dataIndex:"maturityState",typeRepresentation:"tag",width:"80",hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return t._getMaturityStateCSSClassFromCRNode(e.nodeModel.options.data)}});var a=o.TreePanelCaptionTarget;return"nrf"===t.options.COMMAND_NAME&&(a=o.TreePanelCaptionReference),n[0].gridViewContainerParams.styles.width="33%",n[0].gridViewContainerParams.panelCaption=a,n[0].gridViewContainerParams.panelAddClass="treePanel-ref",n[0].gridViewContainerParams.panelCollapseable=!0,n[0].gridViewContainerParams.initSize50pct=!1,n[1].gridViewContainerParams.styles.width="33%",n[1].gridViewContainerParams.panelCaption=o.TreePanelCaptionSource,n[1].gridViewContainerParams.panelAddClass="treePanel-src",n[1].gridViewContainerParams.panelCollapseable=!0,n[1].gridViewContainerParams.initSize50pct=!1,n.splice(1,0,{cols:t.getActionTreeCols(),gridViewContainerParams:{id:"merge-tree-action",panelCaption:"",panelAddClass:"treePanel-act",panelCollapseable:!1,styles:{display:"flex",width:"45px","flex-direction":"column","border-top":r}},createTreeNodeConfig:t.getActionTreeNodeConfig.bind(t)}),n.push({cols:t.getResultTreeCols(),gridViewContainerParams:{id:"merge-tree-result",panelCaption:o.Result,panelAddClass:"treePanel-res",panelCollapseable:!1,styles:{display:"flex","flex-direction":"column",width:"33%","border-top":i}},createTreeNodeConfig:t.getResultTreeNodeConfig.bind(t)}),n},getActionTreeNodeConfig:function(e){var t=this._getResultLabelFromCRNode(e),n=i.getTypeFromCRNode(e),o=this._getSelActionNameFromCRNode(e),r=this._getSelActionIdFromCRNode(e),a={menu:this._getAvailableActionsMenuFromCRNode(e)},s=null===e.getParent();return{data:e,label:t,icons:[e.getAttr("typeIconSmallURL")],grid:{type:n,actionSelectedName:o,actionSelectedId:s?-99:r,actionMenu:a,showHideNodeOnTypeAndAttribute:e.getMatchInfo().getShowHideNodeByTypeAndAttrParamIndex(),showByStatusFilter:1}}},getResultTreeNodeConfig:function(e){var t=this._getContentColorFromCRNode(e),n=this._getResultLabelFromCRNode(e),o=this._getResultIconsFromCRNode(e),r=this._getRevisionFromCRNode(e),a=i.getTypeFromCRNode(e),s=this._getSelActionNameFromCRNode(e),c=this._getSelActionIdFromCRNode(e),l=null===e.getParent();return{data:e,label:n,icons:o,grid:{rev:r,Color:t,type:a,actionSelectedName:s,actionSelectedId:l?-99:c,showHideNodeOnTypeAndAttribute:e.getMatchInfo().getShowHideNodeByTypeAndAttrParamIndex(),showByStatusFilter:1}}},createTreeNodeConfig:function(e){var t=this._parent(e);t.grid.type=i.getTypeFromCRNode(e),t.grid.maturityState=this._getMaturityStateUserNameFromCRNode(e),t.grid.actionSelectedName=this._getSelActionNameFromCRNode(e),t.grid.actionSelectedId=this._getSelActionIdFromCRNode(e);var n=null===e.getParent();return t.grid.isRoot=n?"TRUE":"FALSE",n&&(t.grid.actionSelectedId=-99),t},getActionTreeCols:function(){var e=this;return[{text:o.Action,dataIndex:"actionMenu",width:45,typeRepresentation:"functionMenuIcon",className:"merge-action-menu-column",getCellSemantics:function(t){if(t.nodeModel){var n=!1;if(t.nodeModel.options.data){var o=e._getActionInfoFromCRNode(t.nodeModel.options.data);o&&(o.getActions().length<2||o.getEnabledActionCount()<2)&&(n=!0)}return{disabled:n,icon:e._getSelActionIconFromCRNode(t.nodeModel.options.data),label:e._getSelActionNlsNameFromCRNode(t.nodeModel.options.data)}}},getCellTooltip:function(t){var n=e._getSelActionTooltipFromCRNode(t.nodeModel.options.data);return n.updateModel=!1,n}},{text:"Title",dataIndex:"tree",visibleFlag:!1,typeRepresentation:"string",getCellValue:function(t){return e._getResultLabelFromCRNode(t.nodeModel.options.data)},width:"auto"}]},getResultTreeCols:function(){var e=this;return[{text:"",dataIndex:"Color",typeRepresentation:"color",editableFlag:!1,width:"8.5",minWidth:"8.5",getCellTooltip:function(t){var n=t.nodeModel.getAttributeValue("Color"),i=o.ContentColorIndicator,r=null,a=o.ContentFromMergeTargetTooltipShort,s=o.ContentFromMergeSourceTooltipShort;return"nrf"===e.options.COMMAND_NAME&&(a=o.ContentFromNRFReferenceTooltipShort,s=o.ContentFromNRFSourceTooltipShort),n===e._contentFromLeftColor?(i=o.ContentFromTarget,"nrf"===e.options.COMMAND_NAME&&(i=o.ContentFromReference),r=a):n===e._contentFromRightColor&&(i=o.ContentFromSource,r=s),{title:i,shortHelp:r,updateModel:!1}},hasCellValue:function(t){return!!e._getContentColorFromCRNode(t.nodeModel.options.data)}},{text:"Title",dataIndex:"tree",typeRepresentation:"string",getCellValue:function(t){return e._getResultLabelFromCRNode(t.nodeModel.options.data)},width:"auto"},{text:"Revision",dataIndex:"rev",width:85,typeRepresentation:"string",getCellValue:function(t){return e._getRevisionFromCRNode(t.nodeModel.options.data)}}]},getEachGridColorColumns:function(){var e=this._parent(),t=[];return e.push(t),e.splice(1,0,t),e},_getActionInfoFromCRNode(e){return this._actionInfos.getCRNodeActionInfo(e)},_getContentColorFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var o=null,i=e.getMatchInfo();if(i&&(o=i.getRelName()),"nrf"===this.options.COMMAND_NAME&&o&&"LEFT_ONLY"===o)return null;var r=n.getActionOptionSelected()?n.getActionOptionSelected().name:"?";r===a.MergeAction.Revise||r===a.MergeAction.InsertNew||r===a.MergeAction.ReviseTargetTakeSource||r===a.MergeAction.OverwriteTarget||r===a.MergeAction.OverwriteTargetInstance||r===a.MergeAction.KeepSource||r===a.MergeAction.AddToTarget?t=this._contentFromRightColor:r===a.MergeAction.Reuse?t=this._contentFromRightColor:r!==a.MergeAction.ReuseReference&&r!==a.MergeAction.ReviseTarget&&r!==a.MergeAction.KeepTarget||(t=this._contentFromLeftColor)}return t},_getResultIconsFromCRNode:function(e){var t=[e.getAttr("typeIconSmallURL")],n=this._getActionInfoFromCRNode(e),o=e.getMatchInfo();if(n&&n.getActionOptionSelected()&&o){var i=n.getActionOptionSelected().name,r=o.getRelName(),s=o.getBaseNode()?o.getBaseNode().getAttr("typeIconSmallURL"):null,c=o.getCompNode()?o.getCompNode().getAttr("typeIconSmallURL"):null;i===a.MergeAction.ReuseReference&&"RIGHT_ONLY"===r||i===a.MergeAction.KeepTarget&&"RIGHT_ONLY"===r||i===a.MergeAction.DeleteTarget||i===a.MergeAction.IgnoreSource?t=[]:i!==a.MergeAction.KeepTarget&&i!==a.MergeAction.ReviseTarget||"LEFT_ONLY"!==r?i!==a.MergeAction.AddToTarget&&i!==a.MergeAction.KeepSource||(t=[c]):t=[s]}return t},_getResultLabelFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var o=null,i="",r="",s=e.getMatchInfo();if(s&&(o=s.getRelName(),s.getBaseNode()&&(i=s.getBaseNode().getAttr("title")),s.getCompNode()&&(r=s.getCompNode().getAttr("title"))),"nrf"===this.options.COMMAND_NAME&&o&&"LEFT_ONLY"===o)return null;if(0===n.getActions().length)return this._plugSvcs.warnout("no actions, left title: "+i+", right title: "+r),"No actions!";if(!n.getActionSelected())return this._plugSvcs.warnout("no action selected, left title: "+i+", right title: "+r),"No action selected!";var c=n.getActionOptionSelected().name;c===a.MergeAction.Revise?t=this._copyTitleFromSource?r:i:c===a.MergeAction.ReviseTarget||c===a.MergeAction.ReviseTargetTakeSource||c===a.MergeAction.OverwriteTarget||c===a.MergeAction.OverwriteTargetInstance?t=i||r:c===a.MergeAction.KeepSource?t=r:c===a.MergeAction.AddToTarget?t=r:c===a.MergeAction.ReuseReference||c===a.MergeAction.KeepTarget?t=i:c===a.MergeAction.DeleteTarget||c===a.MergeAction.IgnoreSource?t=null:c===a.MergeAction.Reuse?t=n.getActionByOptionName(a.MergeAction.InsertNew)||o&&"IDENTICAL"!==o?r:i:c===a.MergeAction.InsertNew&&(t=r)}return t},_getRevisionFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var o=null,i="",r="",s=e.getMatchInfo();if(s&&(o=s.getRelName(),s.getBaseNode()&&(i=s.getBaseNode().getAttr("revision")),s.getCompNode()&&(r=s.getCompNode().getAttr("revision"))),"nrf"===this.options.COMMAND_NAME&&o&&"LEFT_ONLY"===o)return null;if(0===n.getActions().length)return"No actions!";if(!n.getActionSelected())return"No action selected!";var c=n.getActionOptionSelected().name;c===a.MergeAction.Revise||c===a.MergeAction.ReviseTarget||c===a.MergeAction.ReviseTargetTakeSource?t=e.getAttr("nextrevision"):c===a.MergeAction.Reuse||c===a.MergeAction.KeepSource?t=r:c===a.MergeAction.ReuseReference||c===a.MergeAction.KeepTarget||c===a.MergeAction.OverwriteTarget||c===a.MergeAction.OverwriteTargetInstance?t=i:c===a.MergeAction.Exclude||c===a.MergeAction.DeleteTarget||c===a.MergeAction.IgnoreSource?t="":c===a.MergeAction.InsertNew||c===a.MergeAction.AddToTarget?(t=e.getAttr("branchrevision"))||(t=e.getAttr("firstRevision")):t=e.getAttr("revision")}return t},_getSelActionNameFromCRNode:function(e){var t="",n=this._getActionInfoFromCRNode(e);if(n){var o=null,i=e.getMatchInfo();i&&(o=i.getRelName()),t="nrf"===this.options.COMMAND_NAME&&o&&"LEFT_ONLY"===o?a.MergeAction.Exclude:n.getActionOptionSelected().name}return t},_getSelActionIdFromCRNode:function(e){var t=0,n=this._getSelActionNameFromCRNode(e);return n&&n.length>0&&(t=this._getActionDefs().find(e=>e.id===n).aid),t},_getSelActionNlsNameFromCRNode:function(e){var t="",n=this._getSelActionNameFromCRNode(e);return n&&n.length>0&&(t=this._getActionDefs().find(e=>e.id===n).nls),t},_getSelActionIconFromCRNode:function(e){var t={},n=this._getSelActionNameFromCRNode(e);return n&&n.length>0&&(t=this._getActionIconFromActionName(n)),t},_getSelActionTooltipFromCRNode:function(e){var t=this._getSelActionNameFromCRNode(e);return this._getSelActionTooltipFromActionName(t)},_getSelActionTooltipFromActionName:function(e){var t={};if(e&&e.length>0){var n=this._getActionDefs().find(t=>t.id===e).nls,i=null;switch(e){case a.MergeAction.Revise:i=o.TooltipShortSelActionRevise;break;case a.MergeAction.Reuse:i=o.TooltipShortSelActionReuse;break;case a.MergeAction.ReuseReference:i=o.TooltipShortSelActionReuseRef;break;case a.MergeAction.Exclude:i=o.TooltipShortSelActionExclude;break;case a.MergeAction.InsertNew:i=o.TooltipShortSelActionInsertNew;break;case a.MergeAction.ReviseTarget:i=o.TooltipShortSelActionReviseTarget;break;case a.MergeAction.ReviseTargetTakeSource:i=o.TooltipShortSelActionReviseTargetTakeSource;break;case a.MergeAction.OverwriteTarget:i=o.TooltipShortSelActionOverwriteTarget;break;case a.MergeAction.DeleteTarget:i=o.TooltipShortSelActionDeleteTarget;break;case a.MergeAction.IgnoreSource:i=o.TooltipShortSelActionIgnoreSource;break;case a.MergeAction.KeepTarget:i=o.TooltipShortSelActionKeepTarget;break;case a.MergeAction.KeepSource:i=o.TooltipShortSelActionKeepSource;break;case a.MergeAction.AddToTarget:i=o.TooltipShortSelActionAddInstToTarget}t.title=n,t.shortHelp=i}return t},_getActionTooltipFromActionName:function(e,t){var n=this._getSelActionTooltipFromActionName(e);return t&&(n.longHelp=n.shortHelp,n.shortHelp=o.replace(o.TooltipShortActionMulti,{actionName:n.title})),n},_getActionIconFromActionName:function(e){var t={iconName:this._getActionDefs().find(t=>t.id===e).fontIconName,fontIconFamily:1};return e===a.MergeAction.ReuseReference||e===a.MergeAction.Reuse||e!==a.MergeAction.Revise&&e!==a.MergeAction.ReviseTargetTakeSource&&e!==a.MergeAction.OverwriteTarget&&e!==a.MergeAction.OverwriteTargetInstance||(t.className="merge-image-flipandup"),t},_getAvailableActionsMenuFromCRNode:function(e,t,n){var i=this,r=[],s=i._getActionInfoFromCRNode(e);if(s){var c=s.getEnabledActions(),l=!1;for(const t of c)t.actionOption.name===a.MergeAction.Revise&&(l=!0),r.push({type:"CheckItem",state:t.isSelected?"selected":"unselected",title:t.actionOption.nls,tooltip:i._getActionTooltipFromActionName(t.actionOption.name,!1),icon:i._getActionIconFromActionName(t.actionOption.name),action:{callback:function(){i._handleActionSelectionChange(t,e),e.__TREENODE__.setAttribute("actionSelectedName",i._getSelActionNameFromCRNode(e)),e.__TREENODE__.setAttribute("actionSelectedId",i._getSelActionIdFromCRNode(e)),i.updateToolbarForSelection()}}});n&&l&&r.splice(1,0,{type:"PushItem",title:o.ReviseTree,icon:{iconName:"tree-revision-update",fontIconFamily:1},action:{callback:function(){i._handleNodeAction(e.__TREENODE__,a.MergeAction.Revise),e.__TREENODE__.getAllDescendants().forEach(function(e){i._handleNodeAction(e,a.MergeAction.Revise)}),i.updateToolbarForSelection()}}})}return 1===r.length&&(r=[]),r},_getMaturityStateUserNameFromCRNode(e){var t="",n=this._getMaturityStateInfoFromCRNode(e);return n&&(t=n.stateUserName),t},_getMaturityStateActiveColorFromCRNode(e){var t="#FFFFFF",n=this._getMaturityStateInfoFromCRNode(e);return n&&(t=n.activeColor),t},_getMaturityStateCSSClassFromCRNode(e){var t="",n=e.getAttr("policy"),o=this._getMaturityStateInfoFromCRNode(e);if(o){var i=n+"."+o.stateSysName;t=r.getMaturityClass(i,"wux-controls-label")}return t},_getMaturityStateInfoFromCRNode(e){var t=null,n="",o="";if(e)if(e.getAttr("last.current"))o=e.getAttr("policy"),n=e.getAttr("last.current");else{var i=e.getMatchInfo();if(i){var r=i.getBaseNode();if(r.getAttr("last.current"))o=r.getAttr("policy"),n=r.getAttr("last.current");else{var a=i.getCompNode();a.getAttr("last.current")&&(o=a.getAttr("policy"),n=a.getAttr("last.current"))}}}var s=this._maturityStatesInfo.policies.find(e=>e.policyName===o);return s&&(t=s.states.find(e=>e.stateSysName===n)),t},_handleActionSelectionChange(e,t){var n=this,o=this._getActionInfoFromCRNode(t);if(o){var i=o.getActionOptionSelected(),r=n._actionInfos.updateActionSelected(t,e.actionOption.name);n._plugSvcs.dbgout("Changed from action "+i.nls+" to action "+e.actionOption.nls+".");var a={match:function(e){var t=e.nodeModel.options.data;if(t){var n=t.getAttr("physicalID_REF");if(r.has(n))return!0;var o=t.getMatchInfo();if(o){var i=o.getBaseNode().getAttr("physicalID_REF");if(i&&r.has(i))return!0;var a=o.getCompNode().getAttr("physicalID_REF");if(a&&r.has(a))return!0}}return!1}},s=n._activeTrees.dataGridViews[0];let g=s.getTreeDocument().search(a);s.getTreeDocument().prepareUpdate(),g.forEach(function(e){var t={grid:{actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),s.getTreeDocument().pushUpdate();var c=n._activeTrees.dataGridViews[1];let u=c.getTreeDocument().search(a);c.getTreeDocument().prepareUpdate(),u.forEach(function(e){var t={grid:{actionMenu:{menu:n._getAvailableActionsMenuFromCRNode(e.options.data)},actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),c.getTreeDocument().pushUpdate();var l=n._activeTrees.dataGridViews[2];let p=l.getTreeDocument().search(a);l.getTreeDocument().prepareUpdate(),p.forEach(function(e){var t={grid:{actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),l.getTreeDocument().pushUpdate();var d=n._activeTrees.dataGridViews[3];let A=d.getTreeDocument().search(a);d.getTreeDocument().prepareUpdate(),A.forEach(function(e){var t={label:n._getResultLabelFromCRNode(e.options.data),icons:n._getResultIconsFromCRNode(e.options.data),grid:{Color:n._getContentColorFromCRNode(e.options.data),actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),d.getTreeDocument().pushUpdate()}},getMergeActionsButtonsForToolbar:function(){var e=this,t=[];return t.push({id:"cmdReviseTarget",dataElements:{domId:"merge-struct-revise-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:150,tooltip:e._getActionTooltipFromActionName(a.MergeAction.ReviseTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.ReviseTarget),value:t=>e.onAction(a.MergeAction.ReviseTarget)}}),t.push({id:"cmdReviseTargetTakeSource",dataElements:{domId:"merge-struct-revise-target-take-source-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:151,tooltip:e._getActionTooltipFromActionName(a.MergeAction.ReviseTargetTakeSource,!0),icon:e._getActionIconFromActionName(a.MergeAction.ReviseTargetTakeSource),value:t=>e.onAction(a.MergeAction.ReviseTargetTakeSource)}}),t.push({id:"cmdOverwriteTarget",dataElements:{domId:"merge-struct-overwrite-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:152,tooltip:e._getActionTooltipFromActionName(a.MergeAction.OverwriteTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.OverwriteTarget),value:t=>e.onAction(a.MergeAction.OverwriteTarget)}}),t.push({id:"cmdKeepTarget",dataElements:{domId:"merge-struct-keep-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:153,tooltip:e._getActionTooltipFromActionName(a.MergeAction.KeepTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.KeepTarget),value:t=>e.onAction(a.MergeAction.KeepTarget)}}),t.push({id:"cmdKeepSource",dataElements:{domId:"merge-struct-keep-source-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:154,tooltip:e._getActionTooltipFromActionName(a.MergeAction.KeepSource,!0),icon:e._getActionIconFromActionName(a.MergeAction.KeepSource),value:t=>e.onAction(a.MergeAction.KeepSource)}}),t.push({id:"cmdDeleteTarget",dataElements:{domId:"merge-struct-delete-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:155,tooltip:e._getActionTooltipFromActionName(a.MergeAction.DeleteTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.DeleteTarget),value:t=>e.onAction(a.MergeAction.DeleteTarget)}}),t.push({id:"cmdAddToTarget",dataElements:{domId:"merge-struct-add-to-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:156,tooltip:e._getActionTooltipFromActionName(a.MergeAction.AddToTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.AddToTarget),value:t=>e.onAction(a.MergeAction.AddToTarget)}}),t.push({id:"cmdIgnoreSource",dataElements:{domId:"merge-struct-ignore-source-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:155,tooltip:e._getActionTooltipFromActionName(a.MergeAction.IgnoreSource,!0),icon:e._getActionIconFromActionName(a.MergeAction.IgnoreSource),value:t=>e.onAction(a.MergeAction.IgnoreSource)}}),t},getNRFActionsButtonsForToolbar:function(){var e=this,t=[];return t.push({id:"cmdRevise",dataElements:{domId:"merge-struct-revise-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:150,tooltip:e._getActionTooltipFromActionName(a.MergeAction.Revise,!0),icon:e._getActionIconFromActionName(a.MergeAction.Revise),value:t=>e.onRevise()}}),t.push({id:"cmdReuseRef",dataElements:{domId:"merge-struct-reuse-left-button",typeRepresentation:"functionIcon",visibleFlag:!1,category:"mergeActions",position:"far",priority:151,tooltip:e._getActionTooltipFromActionName(a.MergeAction.ReuseReference,!0),icon:e._getActionIconFromActionName(a.MergeAction.ReuseReference),value:t=>e.onReuseRef()}}),t.push({id:"cmdReuse",dataElements:{domId:"merge-struct-reuse-right-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:152,tooltip:e._getActionTooltipFromActionName(a.MergeAction.Reuse,!0),icon:e._getActionIconFromActionName(a.MergeAction.Reuse),value:t=>e.onReuse()}}),t.push({id:"cmdInsertNew",dataElements:{domId:"merge-struct-insert-new-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:153,tooltip:e._getActionTooltipFromActionName(a.MergeAction.InsertNew,!0),icon:e._getActionIconFromActionName(a.MergeAction.InsertNew),value:t=>e.onInsertNew()}}),t},applyOtherMenuCommands:function(){var e=this,t=this._parent(),n=[];toolbarActionButtons=[],"nrf"===this.options.COMMAND_NAME?toolbarActionButtons=this.getNRFActionsButtonsForToolbar():toolbarActionButtons=this.getMergeActionsButtonsForToolbar(),n.push(...toolbarActionButtons);var i=[],r=[];r="nrf"===this.options.COMMAND_NAME?this._actionDefsNRF:this._actionDefsMerge;for(const t of r)i.push({id:t.id,type:"CheckItem",title:t.nls,tooltip:{title:t.nls,shortHelp:o.replace(o.ActionFilterItemActionNameTooltip,{actionName:t.nls})},icon:e._getActionIconFromActionName(t.id),state:e._visibleActions.includes(t.id)?"selected":"unselected",action:{callback:function(){e.applyActionFilter(t.id)}}});i.push({type:"SeparatorItem"}),i.push({id:"refresh",type:"PushItem",title:o.ReapplyCurrentFilter,tooltip:{title:o.ReapplyCurrentFilter,shortHelp:o.ReapplyCurrentFilterTooltip},icon:{iconName:"refresh",fontIconFamily:1},action:{callback:function(){e.reapplyFilter()}}}),n.push({id:"actionFilter",dataElements:{domId:"merge-struct-action-filter-button",typeRepresentation:"functionMenuIcon",category:"actionFilter",position:"far",priority:154,tooltip:{title:o.ActionFilter,shortHelp:o.ActionFilterTooltip},icon:{iconName:"filter-select-on",fontIconFamily:1},value:{menu:i}}}),n.push(...t);var a=o.Merge,s=o.MergeCommandTooltip;return"nrf"===e.options.COMMAND_NAME&&(a=o.NewRevisionFrom,s=o.ReviseCommandTooltip),n.push({id:"cmdMerge",dataElements:{domId:"merge-struct-merge-button",typeRepresentation:"function",emphasize:"primary",category:"mergeAction",position:"far",priority:999,label:a,tooltip:{title:a,shortHelp:s},value:t=>e.onMerge()}}),n},_getMaturityStatesAttributes:function(e){var t=this;return new UWA.Class.Promise(function(n,o){var i=new Set;e.visitAll_treeAndFN(0,function(e){var t=e.getAttr("policy");t&&i.add(t)}),e.visitAll_treeAndFN(1,function(e){var t=e.getAttr("policy");t&&i.add(t)});var r={policies:Array.from(i)},a=e.getRoot(0).getObjIDSpec_REF(),s=a.getTenant(),c=a.getServiceName(),l=a.getSecurityContext(),d=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/maturity/getStatesAttributes","POST",r,"json",s,c,l).then(function(e){t._plugSvcs.reportTime(d,"getStatesAttributes request OK.");var o="string"==typeof e?JSON.parse(e):e;n(o)},function(e){t._plugSvcs.reportTime(d,"getStatesAttributes request failed."),t._plugSvcs.showAlertBox("getStatesAttributes request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getStatesAttributes request: "+e)})})},_getVersionNumberProposal:function(e,t){var n=this;return new UWA.Class.Promise(function(o,i){var r=e.getRoot(0).getObjIDSpec_REF(),a=r.getTenant(),s=r.getServiceName(),c=r.getSecurityContext(),l=n._plugSvcs.nowMS();n._plugSvcs.makeAuthHttpsCall("/resources/v1/dslc/getversionnumberproposal","POST",t,"json",a,s,c).then(function(e){n._plugSvcs.reportTime(l,"getversionnumberproposal request OK.");var t="string"==typeof e?JSON.parse(e):e;o(t)},function(e){n._plugSvcs.reportTime(l,"getversionnumberproposal request failed."),n._plugSvcs.showAlertBox("getversionnumberproposal request unsuccessful.",null,"error"),n._plugSvcs.errout("Failure of getversionnumberproposal request: "+e)})})},_getNextRevisionInfo:function(e){var t=new Set;e.visitAll_treeAndFN(0,function(e){var n=e.getMatchInfo();if(n){var o,i=n.getBaseNode();if(i&&!i.isDummy())(o=i.getAttr("physicalID_REF"))&&t.add(o);else(o=n.getCompNode().getAttr("physicalID_REF"))&&t.add(o)}});var n=[],o=[];t.forEach(function(e){(o=[]).push({semantic:"LAST",id:e}),n.push({copyId:e,ancestors:o})});var i={addRequests:n};return this._getVersionNumberProposal(e,i)},_getBranchInfo:function(e){var t=new Set;if(e.visitAll_treeAndFN(0,function(e){var n=e.getMatchInfo();if(n){var o=n.getBaseNode();if(o&&!o.isDummy());else{var i=n.getCompNode(),r=i.getAttr("physicalID_REF");if(r){var a=c.getNodeDefaultBranchIntent(i);t.add({pid:r,intent:a})}}}}),0===t.size)return new UWA.Class.Promise(function(e,t){e({addRequests:[]})});var n=[],o=[];t.forEach(function(e){(o=[]).push({semantic:e.intent,id:e.pid}),n.push({copyId:e.pid,ancestors:o})});var i={addRequests:n};return this._getVersionNumberProposal(e,i)},_populateNextRevisionInfo:function(e,t){e.getNextRev=function(e){var t=this.addRequests.find(t=>t.copyId===e);return t?t.code:null},t.visitAll_treeAndFN(1,function(t){var n=t.getMatchInfo();if(n){var o=n.getBaseNode();if(o&&!o.isDummy()){if(i=o.getAttr("physicalID_REF"))(r=e.getNextRev(i))&&t.addAttr("nextrevision",r)}else{var i,r,a=n.getCompNode();if(i=a.getAttr("physicalID_REF"))(r=e.getNextRev(i))&&a.addAttr("nextrevision",r)}}})},_populateBranchRevisionInfo:function(e,t){e&&e.addRequests&&0!==e.addRequests.length&&(e.getBranchRev=function(e){var t=this.addRequests.find(t=>t.copyId===e);return t?t.code:null},t.visitAll_treeAndFN(1,function(t){var n=t.getMatchInfo();if(n){var o=n.getBaseNode();if(o&&!o.isDummy()){if(i=o.getAttr("physicalID_REF"))(r=e.getBranchRev(i))&&t.addAttr("branchrevision",r)}else{var i,r,a=n.getCompNode();if(i=a.getAttr("physicalID_REF"))(r=e.getBranchRev(i))&&a.addAttr("branchrevision",r)}}}))},_addCSSMaturityClasses:function(){r.addCSSMaturityClasses(this._maturityStatesInfo.policies,"wux-controls-label")},updateResults:function(t,n){var o=this,i=this._getNextRevisionInfo(n),r=this._getBranchInfo(n),a=this._getMaturityStatesAttributes(n);return UWA.Promise.all([i,r,a]).then(function(i){var r=i[0],a=i[1];return o._maturityStatesInfo=i[2],o._addCSSMaturityClasses(),o._populateNextRevisionInfo(r,n),o._populateBranchRevisionInfo(a,n),e.prototype.updateResults.call(o,t,n)})},setup_tree:function(){var e=this;e._listTrees&&e._listTrees.hide(),e._structTrees&&e._structTrees.show(),e._structMatchPairArray=e._crTree.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._structMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("tree",e._structMatchPairArray,e._forceRootsTogether),e._activeColData=[e._crTree.getRoot(0),e._crTree.getRoot(1),e._crTree.getRoot(1),e._crTree.getRoot(1)],e._activeMatchPairArray=e._structMatchPairArray,e._flagInfo.setActive("tree"),e._activeTrees=e._structTrees},getTreePanelCaptions:function(){var e=this,t=this._parent();return t.forEach(function(t){if("compare-tree-left"===t.panelContentId){var n=o.TreePanelCaptionTarget;"nrf"===e.options.COMMAND_NAME&&(n=o.TreePanelCaptionReference),t.panelCaption=n}else"compare-tree-right"===t.panelContentId&&(t.panelCaption=o.TreePanelCaptionSource)}),t},onTreesReady:function(e){this._parent(e),this._treesAreReady=!0},toggleCreateARevision:function(){this._createARevision=!this._createARevision,this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings").options.grid.data.menu.find(e=>"createARevision"===e.id).state=this._createARevision?"selected":"unselected"},toggleCopyTitleFromSource:function(){this._copyTitleFromSource=!this._copyTitleFromSource,this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings").options.grid.data.menu.find(e=>"copyTitleFromSource"===e.id).state=this._copyTitleFromSource?"selected":"unselected",this.updateResult_CopyTitleFromSource()},toggleWarningNoRevise:function(){this._warningNoRevise=!this._warningNoRevise,this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings").options.grid.data.menu.find(e=>"warningNoRevise"===e.id).state=this._warningNoRevise?"selected":"unselected",this.handleUpdateToShowWarningWhenNoAccessRight()},handleUpdateToShowWarningWhenNoAccessRight:function(){var e=!1;this._warningNoRevise&&(s.verifyEverythingIsRevisionable(this._crTree,!0)||(e=!0));this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdMerge",{disabled:e})},updateResult_CopyTitleFromSource:function(){var e=this,t={match:function(e){var t=e.nodeModel.options.grid.actionSelectedName;return!!(t&&t===a.MergeAction.Revise||selAction===a.MergeAction.ReviseTarget||selAction===a.MergeAction.ReviseTargetTakeSource||selAction===a.MergeAction.OverwriteTarget||selAction===a.MergeAction.OverwriteTargetInstance)}},n=e._activeTrees.dataGridViews[3];let o=n.getTreeDocument().search(t);n.getTreeDocument().prepareUpdate(),o.forEach(function(t){var n={label:e._getResultLabelFromCRNode(t.options.data)};t.updateOptions(n)}),n.getTreeDocument().pushUpdate()},updateActionFilter:function(e){var t=this.standardToolbar.toolbarOtherItems.getNodeModelByID("actionFilter").options.grid.data.menu.find(t=>t.id===e),n=this._visibleActions;n.includes(e)?(n.splice(n.indexOf(e),1),t.state="unselected"):(n.push(e),t.state="selected"),this._visibleActions=n;var o=[];for(const e of n){var i=this._getActionDefs().find(t=>t.id===e).aid;o.push(i)}o.push(-99),this._aggVisibilityFilterModels.actionSelectedId={filterId:"set",filterModel:o}},applyActionFilter:function(e){this.updateActionFilter(e),this.applyCurrentFilterToTrees()},reapplyFilter:function(){this.applyCurrentFilterToTrees()},handle_NEW_CURRENT_SELECTION_EVENT:function(e){this.updateToolbarForSelection()},updateToolbarForSelection:function(){var e=this,t=e._plugSvcs.nowMS(),n=new Set;this._activeTrees.dataGridViews[0].getTreeDocument().getSelectedNodes().forEach(function(t){var o=t.options.data;if(o){var i=e._getActionInfoFromCRNode(o);if(i)i.getEnabledActionsNotSelected().forEach(function(e){n.add(e.actionOption.name)})}});var o=!n.has(a.MergeAction.Revise),i=!n.has(a.MergeAction.Reuse),r=!n.has(a.MergeAction.ReuseReference),s=!n.has(a.MergeAction.InsertNew);e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdRevise",{disabled:o}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReuse",{disabled:i}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReuseRef",{disabled:r}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdInsertNew",{disabled:s});var c=!n.has(a.MergeAction.ReviseTarget),l=!n.has(a.MergeAction.ReviseTargetTakeSource),d=!n.has(a.MergeAction.OverwriteTarget),g=!n.has(a.MergeAction.KeepTarget),u=!n.has(a.MergeAction.KeepSource),p=!n.has(a.MergeAction.DeleteTarget),A=!n.has(a.MergeAction.AddToTarget),E=!n.has(a.MergeAction.IgnoreSource);e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReviseTarget",{disabled:c}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReviseTargetTakeSource",{disabled:l}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdOverwriteTarget",{disabled:d}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdKeepTarget",{disabled:g}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdKeepSource",{disabled:u}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdDeleteTarget",{disabled:p}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdAddToTarget",{disabled:A}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdIgnoreSource",{disabled:E}),e._plugSvcs.reportTime(t,"Merge view panel handled new selection.")},onTreesLoaded:function(){var e=this._actionInfos.getOptions().reuseReferenceEnabled;if(this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReuseRef",{visibleFlag:e}),!e){var t=this.standardToolbar.toolbarOtherItems.getNodeModelByID("actionFilter"),n=t.options.grid.data.menu.findIndex(e=>e.id===a.MergeAction.ReuseReference);n>-1&&t.options.grid.data.menu.splice(n,1)}this.handleUpdateToShowWarningWhenNoAccessRight(),this.checkDataInStructuresAreMergeable()},checkDataInStructuresAreMergeable:function(){if("merge"===this.options.COMMAND_NAME){var e=!1;if(!s.verifyEverythingIsMergeable(this._crTree)){e=!0,this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdMerge",{disabled:e}),this.showNotifMsg(o.MergeAlertUnsupportedDataNotifMsg);var t=this.getWidgetCloseButton();if(t){var n=o.MergeAlertUnsupportedDataDlgMsg,i=o.Merge,r=new l,a=r.createDialog(n,{title:i,identifier:"LifecycleConfirmCloseMerge",container:widget.body,modalFlag:!0,buttonStyle:r.buttonStyle.ok,closeButtonFlag:!1,onOk:function(){r.destroy(),t.click()},onClose:function(){r.destroy()}}),c=r.getButton("Ok");c&&(c.label=a.getDefaultButtonLabel("Close"))}}}},_handleNodeAction:function(e,t){var n=e.options.data;if(n){var o=this._getActionInfoFromCRNode(n);if(o){var i=o.getActionByOptionName(t);i&&i.isEnabled&&!i.isSelected&&(this._handleActionSelectionChange(i,n),e.setAttribute("actionSelectedName",this._getSelActionNameFromCRNode(n)),e.setAttribute("actionSelectedId",this._getSelActionIdFromCRNode(n)))}}},onAction:function(e,t){var n=this;this._activeTrees.dataGridViews[0].getTreeDocument().getSelectedNodes().forEach(function(o){(n._handleNodeAction(o,e),t)&&o.getAllDescendants().forEach(function(t){n._handleNodeAction(t,e)})}),this.updateToolbarForSelection()},onRevise:function(){this.onAction(a.MergeAction.Revise)},onReviseTree:function(){this.onAction(a.MergeAction.Revise,!0)},onReuse:function(){this.onAction(a.MergeAction.Reuse)},onReuseRef:function(){this.onAction(a.MergeAction.ReuseReference)},onInsertNew:function(){this.onAction(a.MergeAction.InsertNew)},onOverwrite:function(){},onExclude:function(){},onMerge:function(){var e=this,t=o.MergeConfirmMsg,n=o.MergeConfirmTitle,i=o.MergeConfirmOKLabel;"nrf"===e.options.COMMAND_NAME&&(t=o.NRFConfirmMsg,n=o.NRFConfirmTitle,i=o.NRFConfirmOKLabel);var r=new l;r.createDialog(t,{title:n,identifier:"LifecycleConfirmMerge",container:widget.body,modalFlag:!0,OKBtnText:i,onOk:function(){r.destroy(),e.doMerge()},onClose:function(){r.destroy()}})},doMerge:function(){this._plugSvcs.postEvent("EXECUTE_MERGE_EVENT")},doPostMergeOK:function(){this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdMerge",{disabled:!0});var e=this.getWidgetCloseButton();if(e){var t=o.MergeConfirmCloseDialogMsg,n=o.Merge;"nrf"===this.options.COMMAND_NAME&&(t=o.NRFConfirmCloseDialogMsg,n=o.NewRevisionFrom);var i=new l,r=i.createDialog(t,{title:n,identifier:"LifecycleConfirmCloseMergeWidget",container:widget.body,modalFlag:!0,onOk:function(){i.destroy(),e.click()},onClose:function(){i.destroy()}}),a=i.getButton("Ok");a&&(a.label=r.getDefaultButtonLabel("Close"))}},getWidgetCloseButton:function(){var e=null;if(!window||!window.frameElement||!window.frameElement.id)return null;var t=window.frameElement.id.replace("frame","wi");if(!window.parent||!window.parent.document)return null;var n=window.parent.document.querySelector("."+t);if(n){var o=n.querySelector(".moduleHeader");o&&(e=o.querySelector(".close-icon"))}return e},showNotifMsg:function(e,t){this._plugSvcs.showAlertBox(e,null,"warning")},showErrorMsg:function(e,t){this._plugSvcs.showAlertBox(e,null,"error")},getLabel:function(){return"nrf"===this.options.COMMAND_NAME?o.NRFStructure:o.MergeStructure},getName:function(){return"merge-struct"}})}),define("DS/CompareMergePlugin/MERGE_STRUCT_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin","DS/CompareMergePlugin/ViewPanel/mergeStructComparePanel","DS/CompareMergePlugin/actionInfos","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin"],function(e,t,n,o,i){return t.extend({onEnabled:function(){var e=this;return e.subscribeEvent("MERGE_STARTED_EVENT",function(){var t=i.Merging;"nrf"===e._pluginOptions.COMMAND_NAME&&(t=i.CreatingNewRevision),e.showMessage(t)}.bind(e)),e.subscribeEvent("MERGE_ENDED_OK_EVENT",function(){e.removeMessage(),e.panel.doPostMergeOK()}.bind(e)),e.subscribeEvent("MERGE_ENDED_KO_EVENT",function(){e.removeMessage()}.bind(e)),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.copyTitleFromSource","_copyTitleFromSource",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.warningNoRevise","_warningNoRevise",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.createARevision","_createARevision",null,e._outputPanel),this.syncSetting("mergeSettings.warningNoRevise","_warningNoRevise",function(e,t){this._outputPanel.handleUpdateToShowWarningWhenNoAccessRight()}.bind(this),e._outputPanel),e._parent()},createViewPanelObject:function(e,t){var o={};return t.CUSTOM_PROFILE_IN_USE&&(o=t.PROPS),this.panel=new n(e,this._plugSvcs,t,o),this.panel},execute:function(t,n){var o=this;if(this.panel.setActionInfos(t.actionInfos),e.prototype.execute.call(o,t,n),null!=t.crTreeArray){var i={crTreeArray:t.crTreeArray,ruleNames:t.ruleNames,actionInfos:t.actionInfos,destroy:function(){}};o._outputPanel.updateResults(n,t.crTreeArray[0]).then(function(e){o.showNotBusy(),o.reportOK(i)},function(e){o.reportKO(e)})}else o.reportKO()}})});