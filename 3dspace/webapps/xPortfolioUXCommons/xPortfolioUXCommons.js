define("DS/xPortfolioUXCommons/DialogCreation/DialogCreation",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/ENOXDataDragAndDrop/js/ENOXDataDragAndDrop","DS/UIKIT/Input/File","DS/Controls/Button","DS/ENOXEmptyContent/js/ENOXEmptyContent","i18n!DS/xPortfolioUXCommons/assets/nls/DialogCreation/DialogCreation","css!DS/xPortfolioUXCommons/DialogCreation/DialogCreation.css"],function(e,t,i,o,n,s,a,l,r,d,c){"use strict";return{createView:t.extend({className:"dialog-creation",render:function(){return this.formContent=new o({className:"vertical",fields:[{type:"text",label:c.title,placeholder:c.title,name:"title",errorText:c.titleMandatory,required:!0},{type:"text",label:c.description,placeholder:c.description,name:"description",rows:4,multiline:!0},{type:"file",label:c.image,name:"image"}]}),this.formContent}}),createViewPatch:t.extend({className:"dialog-creation",render:function(){var t=e.createElement("div"),i=e.createElement("label");i.style.color="#3d3d3d",i.setContent(c.image);var n=this;this.imageFileInput;var l=[{type:"text",label:c.title,placeholder:c.title,name:"title",errorText:c.titleMandatory,required:!0}];this.options.edit_revision&&l.push({type:"text",label:c.revision,placeholder:"A",value:"A",name:"revision",errorText:c.revisionMandatory,required:!0}),l.push({type:"text",label:c.description,placeholder:c.description,name:"description",rows:4,multiline:!0}),this.formContent=new o({className:"vertical",fields:l}),this._fileInputDiv=e.createElement("div",{class:"file-input-container"}),this._dataDragAndDropModelevent=new s,this._dragdropInstance=new a({droppableAreas:[this._fileInputDiv],modelEvents:this._dataDragAndDropModelevent}),this._dataDragAndDropModelevent.subscribe({event:"onDrop"},function(e){var t=e.data;if(t&&t.data&&1===t.data.length){var i=t.data[0];i.type.contains("image")&&n.setImageFile(i)}});var u=new r({label:c._uploadButtonLabel});this._previewDiv=e.createElement("div",{class:"file-preview-container hidden"}),this.previewImage=e.createElement("div",{class:"file-preview-image",height:"150px"}),this._imageRemoveButton=new r({label:c._uploadButtonLabel,showLabelFlag:!1,displayStyle:"lite",icon:{iconName:"clear",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this._imageRemoveButton.getContent().addEventListener("buttonclick",function(){n.uploadFileField.value="",n.imageFileInput=void 0,n._previewDiv.addClassName("hidden"),n._fileInputDiv.getElement(".empty-content").removeClassName("hidden")}),this._imageRemoveButton.getContent().addClassName("file-remove-button"),this._imageRemoveButton.inject(this.previewImage),this.previewImage.inject(this._previewDiv),this.uploadFileField=e.createElement("input",{name:"image",type:"file",events:{change:function(){if(n.uploadFileField.files[0]){var e=n.uploadFileField.files[0];n.setImageFile(e)}}}}),u.getContent().addEventListener("buttonclick",function(){n.uploadFileField.click()});var p={sentences:[{type:"icon",fonticon:"drag-drop",sizeicon:"30px",text:c._dropMessage},{type:"dom",DOMelement:u.getContent()}]};return this._ENOXEmptyContent=new d(p),this._ENOXEmptyContent.inject(this._fileInputDiv),this._previewDiv.inject(this._fileInputDiv),this.formContent.inject(t),i.inject(t),this._fileInputDiv.inject(t),this.container.setContent(t),this},setImageFile:function(t){var i=this;this.imageFileInput=t;const o=new FileReader;o.addEventListener("load",function(){var t=e.createElement("img",{styles:{height:"145px"}}).inject(i.previewImage);t.src=o.result;var n="";t.onload=function(){let e=i.previewImage.getElementsByTagName("img");e&&e.length>0&&e[0].remove(),n=i.scaleImage(t,void 0,void 0,void 0),i.previewImage.setStyle("backgroundImage",'url("'+n+'")')},i._previewDiv.removeClassName("hidden"),i._fileInputDiv.getElement(".empty-content").addClassName("hidden")},!1),t&&o.readAsDataURL(t)},destroy:function(){this._dataDragAndDropModelevent.destroy(),this._parent.apply(this,arguments)},scaleImage:function(e,t,i,o){var n=document.createElement("canvas"),s=n.getContext("2d"),a=0!==e.naturalWidth?e.naturalWidth:1500,l=0!==e.naturalHeight?e.naturalHeight:1499,r=Math.min(120/l,160/a);r<1&&(l*=r,a*=r);for(var d,c=1;n.width=a,n.height=l,s.fillStyle="white",s.fillRect(0,0,n.width,n.height),s.drawImage(e,0,0,a,l),(d=n.toDataURL("image/jpeg",c)).length>16300;)c-=.05;if(!o)return d;o(d)}}),show:function(t){var i=this;this.options=t,this._id=t.id,this._context=t.context,this._withCreateAndClose=t.withCreateAndClose,this.modelEvent=t.modelEvent;var o=new n({renderTo:document.body,events:{onShow:function(){i.modelEvent.publish({event:"enox-dialog-on-show"})},onHide:function(){i.modelEvent.publish({event:"enox-dialog-on-hide"})}}});this.view=new this.createViewPatch(t);var s=[{className:i._withCreateAndClose?"default":"primary",value:c.create,action:function(t){var o=i.view.formContent.getValue("title");i.view.formContent.setValue("title",o.trim()),i.view.formContent.validate()&&(e.log("event publish : enox-dialog-creation id : "+i._id),i.modelEvent.publish({event:"enox-dialog-creation",data:{content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id},context:this}),i._withCreateAndClose||(i.view.destroy(),t.hide()))}},{className:"default",value:c.cancel,action:function(e){e.hide()}}];this._withCreateAndClose&&s.push({className:"primary",value:c.createAndClose,action:function(t){var o=i.view.formContent.getValue("title");i.view.formContent.setValue("title",o.trim()),i.view.formContent.validate()&&(e.log("event publish : enox-dialog-creation id : "+i._id),i.modelEvent.publish({event:"enox-dialog-creation",data:{content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id},context:this}),t.hide())}}),this.view.render(),o.dialog({body:this.view.getContent(),title:t.title,buttons:s})},formatContent:function(e){var t=e.getValues();return e.getField("image")&&(t.image=e.getField("image").files[0]),t},formatContentPatch:function(e){var t=e.getValues();return this.view.imageFileInput&&(t.image=this.view.imageFileInput),t}}}),define("DS/xPortfolioUXCommons/XModelListView/js/ContextualMenuTweaker",["UWA/Core","DS/Tweakers/TweakerBase","DS/Utilities/Utils","DS/Controls/Button","DS/Menu/ContextualMenu","DS/Menu/Menu"],function(e,t,i,o,n,s){"use strict";var a=t.inherit({name:"contextualMenu",publishedProperties:{label:{defaultValue:"",type:"string"},icon:{defaultValue:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"string"},displayStyle:{defaultValue:"menuIcon",type:"string",category:"Appearance"}},computeContentSize:function(){return 30}}),l=function(e,i){t.prototype.baseViewModule.call(this,e,i)};i.applyMixin(l,t.prototype.baseViewModule);var r=function(e,t){l.call(this,e,t)};return i.applyMixin(r,l),r.prototype.buildView=function(){if(this._tweaker.elements.container){var t=e.merge({},this._options.viewOptions);t.touchMode=this._tweaker._getCurrentTouchMode(),t.displayStyle="lite",t.icon=this._tweaker.icon,t.allowUnsafeHTMLLabel=!1,this._tweaker.value&&this._tweaker.value.menu&&this._tweaker.value.menu.length>0&&1===this._tweaker.value.menu.length&&(t.icon={iconName:this._tweaker.value.menu[0].icon,fontIconFamily:WUXManagedFontIcons.Font3DS}),this._view=new o(t),this._view.getContent().addClassName("contextualMenu"),this.setValue(this._tweaker.value)}},r.prototype.handleEvents=function(){var e=this,t=this._view;t&&t.addEventListener("buttonclick",function(i){if(e._tweaker.value&&!(!0===e._tweaker.value.disabled||e._tweaker.value.menu&&1===e._tweaker.value.menu.length&&e._tweaker.value.menu[0]&&e._tweaker.value.menu&&"disabled"===e._tweaker.value.menu[0].state)){var o=e._tweaker.value.menu;if(o)if(1===o.length)o[0].action.callback(i);else{var n=t.getContent().getBoundingClientRect();s.show(o,{position:{x:n.left,y:n.top+n.height},submemu:"outside"})}}})},r.prototype.setValue=function(){if(this._view&&(this._view.icon=this.getMenuIcon(),void 0===this._tweaker.value||null===this._tweaker.value?this._view.value="undefined":(this._view.value=this._tweaker.value,this._tweaker.value&&(!0===this._tweaker.value.disabled||this._tweaker.value.menu&&1===this._tweaker.value.menu.length&&this._tweaker.value.menu[0]&&this._tweaker.value.menu&&"disabled"===this._tweaker.value.menu[0].state)?this._view.getContent().setAttribute("disabled",!0):this._view.getContent().removeAttribute("disabled"),this._tweaker.value&&this._tweaker.value.menu&&this._tweaker.value.menu.length>0?this._view.show():this._view.hide()),this._tweaker.executionContext)){this._eventToken&&this._tweaker.executionContext.nodeModel.removeEventListener(this._eventToken);var e=this;this._eventToken=this._tweaker.executionContext.nodeModel.addEventListener("pushUpdate",function(){void 0!==this.options.disableMenu&&this.options.disableMenu!==e._tweaker.value.disabled&&(e._tweaker.value.disabled=this.options.disableMenu,e.setValue())})}},r.prototype.getMenuIcon=function(){var e={iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS};return this._tweaker.value&&this._tweaker.value.menu&&this._tweaker.value.menu.length>0&&1==this._tweaker.value.menu.length&&(e={iconName:this._tweaker.value.menu[0].icon,fontIconFamily:WUXManagedFontIcons.Font3DS}),e},r.prototype.removeEvents=function(){this._view&&this._view.removeEventListener("buttonclick")},r.prototype._updateView=function(){this.setValue()},a.prototype.baseViewModule=l,a.prototype.VIEW_MODULES={menuIcon:{classObject:r,options:{viewOptions:{}}},readOnly:{classObject:r,options:{viewOptions:{displayStyle:"menuIcon"}}}},a}),define("DS/xPortfolioUXCommons/DialogDuplicate/DialogDuplicate",["UWA/Controls/Abstract","UWA/Class/View","UWA/Core","DS/ENOFloatingPanel/ENOFloatingPanel","DS/UIKIT/Input/Button","DS/Controls/LineEditor","DS/UIKIT/Input/Text","DS/UIKIT/Mask","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","css!DS/xPortfolioUXCommons/DialogDuplicate/DialogDuplicate.css","i18n!DS/xPortfolioUXCommons/assets/nls/DialogDuplicate/DialogDuplicate"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,h){"use strict";return{render:function(){var e=this;e.content=new i.Element("div",{class:"duplicate-dialog-modal"});var t=new i.Element("div",{class:"dup-view-container"});if(e.selections.length>1){var o=e.selections,a=new i.Element("div",{class:"list-view-container"});a.inject(t);for(var l=new d,p=0;p<o.length;p++){var m=new c({grid:{title:o[p].title,type:o[p].type,revision:o[p].revision,maturity:o[p].maturity}});l.addChild(m)}var v=[{text:h.title,dataIndex:"title",typeRepresentation:"string"},{text:h.type,dataIndex:"type",typeRepresentation:"string"},{text:h.revision,dataIndex:"revision",typeRepresentation:"string"},{text:h.maturity,dataIndex:"maturity",typeRepresentation:"string"}],_=new u({identifier:"DataGridViewDialogDuplpicate",treeDocument:l,columns:v});_.layout.rowsHeader=!1,_.rowSelection="none",_.cellSelection="none",_.inject(a)}var f=i.createElement("div",{class:"addtext-label-container",text:h.add_prefix+":"});e.prefix_input=new s({value:h.copy_of}),e.prefix_input.elements.container.addClassName("addtext-input-container");var g=i.createElement("div",{class:"credentials-label-container",text:h.credentials+":"});e.comboBoxCred=new r({elementsList:e.credentialsInfo,enableSearchFlag:!1,value:e.credValue,recId:"duplicate-dialog-content-popup"}),f.inject(t),e.prefix_input.inject(t),g.inject(t),e.comboBoxCred.inject(t),t.inject(e.content),e.button_grp=i.createElement("div");var w=new n({value:h.duplicate,className:"primary",events:{onClick:function(){var t=e.prefix_input.value;t=t.trim();for(var i=0;i<e.selections.length;i++)e.selections[i].title=t+" "+e.selections[i].title;var o={securityContext:e.comboBoxCred.value,titleIdMap:e.selections};e.modelEvent.publish({event:"enox-dialog-duplication",data:o}),e.selections=[],e.modal.destroy()}}}),b=new n({value:h.cancel,events:{onClick:function(){e.modal.destroy()}}});w.inject(e.button_grp),b.inject(e.button_grp)},show:function(e){var t=this;t.modelEvent=e.channel;var i=h.duplicate+" - ";t.selections=e.selections,t.credValue=e.value,t.credentialsInfo=e.credentials,t.selections.length>1?i=i+t.selections.length+" "+h.objects:1===t.selections.length&&(i+=t.selections[0].title?t.selections[0].title:"");var n=t.selections.length>1?340:200;t.render(),t.modal=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!0,escapeToClose:!0,overlay:!0,resizable:!0,maximizable:!1,visible:!0,className:"enox-dialog-duplicate",title:i,header:null,minHeight:n,minWidth:300,footer:t.button_grp,body:t.content,events:{onClose:function(){t.modal.destroy()}}}).inject(document.body),setTimeout(function(){var e=t.content.querySelector(".addtext-input-container");if(e){var i=e.querySelector("input");i&&(i.setSelectionRange(0,i.value.length),i.focus())}},100)}}}),define("DS/xPortfolioUXCommons/util/ScrollUtil",[],function(){"use strict";return{PIXEL_STEP:10,LINE_HEIGHT:40,PAGE_HEIGHT:800,maxWheelDelta:function(){return{y:10,x:10}},normalizeWheel:function(e){var t=0,i=0,o=0,n=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=i,i=0),o=t*this.PIXEL_STEP,n=i*this.PIXEL_STEP,"deltaY"in e&&(n=e.deltaY),"deltaX"in e&&(o=e.deltaX),(o||n)&&e.deltaMode&&(1===e.deltaMode?(o*=this.LINE_HEIGHT,n*=this.LINE_HEIGHT):(o*=this.PAGE_HEIGHT,n*=this.PAGE_HEIGHT)),o&&!t&&(t=o<1?-1:1),n&&!i&&(i=n<1?-1:1),{spinX:t,spinY:i,pixelX:o,pixelY:n}}}}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewTaggerExtension",["UWA/Core","UWA/Class","DS/TaggerOnIndexComponent/TaggerOnIndexComponent"],function(e,t,i){"use strict";return t.extend({_id:"tagger-extention",initialize:function(e){this._taggerId=e.id,this._model=e.model,this._modelEvents=e.modelEvents,this._friendTags=[],this.subscribeEvents(),this._taggerComponent=i},subscribeEvents:function(){var t=this;this._modelEvents.subscribe({event:"xmodel-list-data-on-load-complete"},function(){t._modelEvents.publish({event:"xmodel-list-get-filtered-data",data:function(e){t._setupTagger(e?Object.keys(e):[])}})}),this._modelEvents.subscribe({event:"xmodel-list-data-update-subjects"},function(e){t._taggerComponent.getTagProxy(t._taggerId)&&(t._taggerComponent.removeSubjects(t._taggerId,e),t._taggerComponent.publishTags(t._taggerId))}),this._modelEvents.subscribe({event:"xmodel-list-view-open-tagger"},function(){t.openTagger()}),this._modelEvents.subscribe({event:"xmodel-list-view-close-tagger"},function(){t.closeTagger()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-activate-action"},function(){t._activateTagger()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-deactivate-action"},function(){t._deactivateTagger()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-update-friend-tags-action"},function(i){e.is(i,"array")&&(t._friendTags=i)}),this._modelEvents.subscribe({event:"xmodel-list-data-on-search-complete"},function(e){t._filterTagger(e)}),this._modelEvents.subscribe({event:"xmodel-list-tagger-focus-action"},function(e){var i=[];e.forEach(function(e){i.push(e.options.grid.id)}),t._focusOnSubjects(i)}),this._modelEvents.subscribe({event:"xmodel-list-tagger-unfocus-action"},function(){t._unfocus()}),this._modelEvents.subscribe({event:"xmodel-list-tagger-init-action"},function(e){t._modelEvents.publish({event:"xmodel-list-get-filtered-data",data:function(e){t._setupTagger(e?Object.keys(e):[])}})}),this._modelEvents.subscribe({event:"xmodel-list-tagger-set-filter-action"},function(e){t._taggerComponent.setLocalFilter(t._taggerId,e)}),this._modelEvents.subscribe({event:"xmodel-list-tagger-get-filter-action"},function(i){if(e.is(i,"function")){var o=t._taggerComponent.getTagProxy(t._taggerId);if(o)i(o.getCurrentFilter())}})},_setupTagger:function(t){e.log("set up tagger");var i=this,o={MyFriends:i._friendTags,onSetTagProxy:function(){i._modelEvents.publish({event:"xmodel-list-tagger-on-setup"})},onTagFilterChange:function(){var e=i._taggerComponent.getTagProxy(i._taggerId).getCurrentFilter(),t=e.filteredSubjectList;if(t&&t.length>0){var o={id:"taggerFilter",content:{ids:t,idPrefix:"pid://"}};let n=Object.keys(e.allfilters),s=Object.keys(e.localfilters);if(0==n.length&&0==s.length){t=[],i._model.getAllDescendants().forEach(e=>{let i=e.getAttributeValue("id");t.push(o.content.idPrefix+i)}),o.content.ids=t}i._modelEvents.publish({event:"xmodel-list-data-filter-action",data:o}),i._modelEvents.publish({event:"xmodel-list-tagger-on-filter-change",data:e.allfilters})}},onTagColor:function(e){var t={};if(e.coloredSubjects)for(var o in e.coloredSubjects)e.coloredSubjects.hasOwnProperty(o)&&(t[o.slice(6)]=e.coloredSubjects[o]);i._setDataColor(t)},onTagUncolor:function(){i._unsetDataColor()},colorize:!0,subjectPrefix:"pid://"},n=t||[];this._taggerComponent.killTagProxy(this._taggerId),this._taggerComponent.setTagProxy(this._taggerId,o,n)},_getDataIds:function(){var e=[],t=this._model.getChildren();return t&&t.forEach(function(t){var i=t.options.id||t._id;e.push(i)}),e},_setDataColor:function(e){this._modelEvents.publish({event:"xmodel-list-set-color-visibility-action",data:!0}),this._model.search({match:function(t){return!!e.hasOwnProperty(t.nodeModel.options.id)&&(t.nodeModel.prepareUpdate(),t.nodeModel.updateOptions({color:e[t.nodeModel.options.id]}),t.nodeModel.setAttribute("color",e[t.nodeModel.options.id]),t.nodeModel.pushUpdate(),!0)}})},_unsetDataColor:function(){this._modelEvents.publish({event:"xmodel-list-set-color-visibility-action",data:!1}),this._model.prepareUpdate(),this._model.search({match:function(e){return!!e.nodeModel.options.id&&(e.nodeModel.updateOptions({color:""}),e.nodeModel.setAttribute("color","#00FFFFFF"),!0)}}),this._model.pushUpdate()},_filterTagger:function(e){this._taggerComponent.getTagProxy(this._taggerId)&&this._taggerComponent.filterTags(this._taggerId,e)},_focusOnSubjects:function(e){this._taggerComponent.getTagProxy(this._taggerId)&&this._taggerComponent.focusOnSubjects(this._taggerId,e)},_unfocus:function(){this._taggerComponent.unfocus(this._taggerId)},_activateTagger:function(){let e={deactivateOthers:!0};this._taggerComponent.getTagProxy(this._taggerId)&&this._taggerComponent.activate(this._taggerId,e)},_deactivateTagger:function(){this._taggerComponent.deactivate(this._taggerId)},destroy:function(){this._taggerComponent.killTagProxy(this._taggerId)},openTagger:function(){},closeTagger:function(){}})}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewEmptyContent",["DS/ENOXEmptyContent/js/ENOXEmptyContent"],function(e){"use strict";var t=function(t,i,o,n){this._ENOXEmptyContent=new e(i.emptyContentOptions),this._ENOXEmptyContent.inject(n),this._modelEvents=o,console.log("hey i am the empty content"),0===t.getChildren().length&&n.classList.remove("displaynone");var s=this;["addChild","removeChild"].forEach(function(e){t.addEventListener(e,function(){0===t.getChildren().length?(n.classList.remove("displaynone"),s._modelEvents.publish({event:"xmodel-list-is-empty",data:!0})):(n.classList.add("displaynone"),s._modelEvents.publish({event:"xmodel-list-is-empty",data:!1}))})})};return t.prototype.destroy=function(){this._ENOXEmptyContent.destroy()},t}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemModel",["UWA/Class/Model"],function(e){"use strict";return e.extend({init:function(e){var t={};if(e.hasOwnProperty("id"))t=e;else if(e.hasOwnProperty("@id"))for(var i in t={id:e["@id"]},e)if(e.hasOwnProperty(i)){var o=e[i];t[i]=o}return Array.prototype.splice.call(arguments,0,1,t),this._parent.apply(this,arguments)}})}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewCollectionToolBar",["UWA/Core","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","i18n!DS/xPortfolioUXCommons/assets/nls/XModelListView","css!DS/xPortfolioUXCommons/XModelListView/css/XModelListView.css"],function(e,t,i){"use strict";var o=function(o,n,s){this._initMaps(),this._model=o;var a=0;if(this._disabledActions=[],this._opts={},this._opts.views=[],n.viewOptions){if(n.viewOptions.views)for(a=0;a<n.viewOptions.views.length;a+=1)this._opts.views.push({id:n.viewOptions.views[a],text:this._localMap_text[n.viewOptions.views[a]],fonticon:this._localMap_fonticon[n.viewOptions.views[a]]});var l=n.viewOptions.views.includes("DataGridView")?"DataGridView":n.viewOptions.views[0];this._opts.currentView=n.viewOptions.currentView?n.viewOptions.currentView:l}this._opts.currentSort=n.viewOptions.currentSort?n.viewOptions.currentSort:void 0,this._opts.sort=[];var r=[];for(this._selectedGroupItem=null,a=0;a<n.viewOptions.grid.columns.length;a+=1)if(""!==n.viewOptions.grid.columns[a].text&&(!0!==n.restrictSortFlag&&!1!==n.viewOptions.grid.columns[a].sortableFlag&&this._opts.sort.push({id:n.viewOptions.grid.columns[a].dataIndex,text:n.viewOptions.grid.columns[a].text,type:"number"===n.viewOptions.grid.columns[a].typeRepresentation?"integer":"string"}),!0===n.viewOptions.grid.columns[a].groupableFlag)){let e=n.viewOptions.grid.columns[a].dataIndex;r.push({id:e,text:n.viewOptions.grid.columns[a].text,selectable:!0,isSelected:!1,handler:function(t,i){if(d._opts.useGeneratedToolbar){let t=e,i=!1;d._opts.groupByMenu.forEach(e=>{e.id===t&&"selected"===e.state&&(i=!0)});let o=[];i||o.push(t),d._opts.modelEvents.publish({event:"xmodel-list-view-group-by-action",data:o})}else{var o=d._getItem(i.parent);if(d._actionParentGroupBy=o,o){var n=[];i.id&&(i.isSelected?(o.elements.container.removeClassName("selected"),i.isSelected=!1):(o.elements.container.hasClassName("selected")||o.elements.container.addClassName("selected"),i.isSelected=!0,d._selectedGroupItem=i,n.push(i.id))),d._opts.modelEvents.publish({event:"xmodel-list-view-group-by-action",data:n});var s=i.id,a=i.isSelected;if(o.content.component)o.content.component.items.forEach(function(e){s===e.id&&(a?e.elements.container.hasClassName("selected")||e.elements.container.addClassName("selected"):e.elements.container.removeClassName("selected"))})}}}})}n.viewOptions.customGrouping&&r.push({id:n.viewOptions.customGrouping.label,text:n.viewOptions.customGrouping.label,selectable:!0,isSelected:!1,handler:function(){let e=n.viewOptions.customGrouping.label,t=!1;d._opts.groupByMenu.forEach(i=>{i.id===e&&"selected"===i.state&&(t=!0)}),d._opts.modelEvents.publish({event:"xmodel-list-view-group-by-custom-action",data:{indexes:n.viewOptions.customGrouping.groupedData,isSelected:!t}})}});var d=this;this._opts.modelEvents=s,this._opts.withmultisel=!!n.withmultisel&&n.withmultisel,this._opts.showItemCount=!1!==n.showItemCount||n.showItemCount,this._opts.itemsName=n.toolbarOptions.itemsName,this._opts.itemName=n.toolbarOptions.itemName,!0!==n.toolbarOptions.hideSearchFilter&&(this._opts.filter={enableCache:!0}),n.toolbarOptions.hideSort&&(this._opts.sort=!1),this._opts.showSwitchViewAction=!1,n.viewOptions&&(this._opts.showSwitchViewAction=!0),void 0!==n.toolbarOptions.showSwitchViewAction&&(this._opts.showSwitchViewAction=n.toolbarOptions.showSwitchViewAction),this._opts.withStableActions=n.toolbarOptions.withStableActions,this._opts.stableActions=n.toolbarOptions.stableActions||[],n.toolbarOptions.hideView&&(this._opts.showSwitchViewAction=!1),this._opts.actions=this._getToolbarActions(n.toolbarOptions.actions),this._opts.withClearSort=n.toolbarOptions.withClearSort,this._opts.withClearSort&&(this._opts.clearSort=n.toolbarOptions.clearSort),this._opts.multiselActions=n.toolbarOptions.multiselActions?n.toolbarOptions.multiselActions:void 0,this._opts.multiSelectPartialActions=n.toolbarOptions.multiSelectPartialActions?n.toolbarOptions.multiSelectPartialActions:void 0,this._opts.useGeneratedToolbar=!!n.toolbarOptions.useGeneratedToolbar&&n.toolbarOptions.useGeneratedToolbar,this._opts.touchMode=!!n.toolbarOptions.touchMode&&n.toolbarOptions.touchMode,this._opts._hideOnMultiSelection=n.toolbarOptions.hideOnMultiSelection?n.toolbarOptions.hideOnMultiSelection:[],this._opts._showOnOneSelection=n.toolbarOptions.showOnOneSelection?n.toolbarOptions.showOnOneSelection:[],this._opts.groupByMenu=r;var c=n.toolbarOptions.filterActions?n.toolbarOptions.filterActions:[];if(d._opts.filterActions=c,d._opts.showTaggerFilter=n.toolbarOptions.showTaggerFilter,d._opts.showTaggerFilter){let e={id:"taggerFilter",fonticon:"filter",className:"enox-collection-toolbar-filter-activated",text:i._taggerApplied,visibleFlag:!1,handler:function(){}};this._opts.withStableActions?this._opts.stableActions.push(e):this._opts.actions.splice(0,0,e)}if(c.length>0)for(var u=0;u<c.length;u++){var p=c[u],h=[];if(p&&p.actions&&p.actions.length>0){p.actions.forEach(function(t){let i={id:t.id,text:t.text,selectable:t.selectable,selected:!!t.selected&&t.selected,items:t.items?t.items:void 0,multiSelect:!!t.multiSelect&&t.multiSelect};i.handler=function(i,o){let n=void 0;if(o&&o.id){if(d._opts.useGeneratedToolbar){o.selected=!o.selected,o.state=o.selected?"selected":"",n=o.selected,t.handler(o.selected);let e="";d._childrenSelected(p)&&(e="enox-collection-toolbar-filter-activated"),d._collectionToolBar.stableGenToolbar.updateNodeModel("mv-filter",{grid:{semantics:{icon:{className:e}}}})}else n=(d._opts.withStableActions?d._collectionToolBar._actionsFixedIconBar.menu:d._collectionToolBar._actionsIconBar.menu).getItem("mv-filter").content.component.getItem(o.id).selected;e.log("Filter criteria updated!"),d._opts.modelEvents.publish({event:"xmodel-list-collection-toolbar-filter-changed",data:{id:o.id,parentId:o.parentId?o.parentId:void 0,selected:n||!1}})}},h.push(i)});var m={id:p.id,className:p.className?p.className:"",title:p.text,typeRepresentation:"functionIcon",text:p.text,fonticon:p.fonticon,multiSelect:!0,selected:!!p.selected&&p.selected,content:h,handler:function(){}};let t=u;d._opts.useGeneratedToolbar&&(p.actions.forEach((e,t)=>{e.type="CheckItem",e.state=e.selected?"selected":"",e.title=e.text,e.action={};e.action.callback=function(){h[t].handler("",e)};let i=!1;e.items&&e.items.length>0&&(e.type="PushItem",e.submenu=[],e.items.forEach(o=>{o.type="CheckItem",o.title=o.text,o.state=o.selected?"selected":"",o.selected&&(i=!0),o.action={};o.action.callback=function(){h[t].handler("",o)},e.submenu.push(o)}),e.items="",i&&(e.isSelected=!0,e.state="selected"))}),m.content="",m.value=function(e){let i=e.dsModel&&e.dsModel.elements&&e.dsModel.elements.container;i||(i=e.context.toolbar.elements.dropdownButtonContainer),d._opts.modelEvents.publish({event:"enox-collection-toolbar-display-menu",data:{menu:d._opts.filterActions[t].actions,container:i}})}),this._opts.withStableActions?this._opts.stableActions.push(m):this._opts.actions.splice(0,0,m)}}if(e.is(this._opts.actions,"array")&&r.length>0){let e;e=n.toolbarOptions.groupByActionIndex>-1?n.toolbarOptions.groupByActionIndex:this._opts.actions.length;let t={typeRepresentation:"functionIcon",id:"groupByAction",className:"group-by-action",title:i._groupByAction,text:i._groupByAction,fonticon:"group",content:r,handler:function(){}};if(this._opts.useGeneratedToolbar){t.content="";let e=[];r.forEach(t=>{let i={};i={id:t.id,title:t.text,type:"CheckItem",state:t.isSelected?"selected":"",action:{callback:t.handler}},e.push(i)}),d._opts.groupByMenu=e,t.value=function(e){let t=e.dsModel.elements.container;d._opts.modelEvents.publish({event:"enox-collection-toolbar-display-menu",data:{menu:d._opts.groupByMenu,container:t}})},this._opts.stableActions||(this._opts.stableActions=[]),this._opts.stableActions.push(t)}else this._opts.actions.splice(e,0,t)}this._collectionToolBar=new t(this._opts),this._subscribeEvents(),this._initSort()};return o.prototype._childrenSelected=function(e){let t=this;if(!e.actions&&!e.submenu){return e.selected}let i=e.actions||e.submenu;for(let e=0;e<i.length;e++){if(i[e].selected)return!0;if(i[e].submenu&&i[e].submenu.length>0){if(t._childrenSelected(i[e]))return!0}}return!1},o.prototype._updateGroupByMenu=function(e){let t=[];return this._opts.groupByMenu.forEach(i=>{i.id===e&&"selected"===i.state?(i.state="",i.isSelected=!1):i.id==e?i.state="selected":i.id===e?(i.state="selected",i.isSelected=!0,t.push(e)):(i.state="",i.isSelected=!1)}),t},o.prototype._getSelectedState=function(){let e=this._model.getXSO().get().length,t=0;this._model.getChildren().forEach(e=>{e.isHidden()||t++});let i=0;return e===t?i=1:e>0&&e<t&&(i=2),{selectedState:i,selectedItems:e}},o.prototype._subscribeEvents=function(){var e=this;this._opts.modelEvents.subscribe({event:"xmodel-list-item-on-add-selection"},function(){let t=e._getSelectedState();e._opts.withStableActions||e._showMultiselectActions.length>0?e._showMultiselectActions.forEach(t=>{-1===e._hiddenActions.indexOf(t)&&e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!0}})}):e._multiselectActions.forEach(function(t){-1===e._disabledActions.indexOf(t)&&e._opts.modelEvents.publish({event:"enox-collection-toolbar-enable-action",data:t})}),e._opts.useGeneratedToolbar&&(e._opts.withmultisel&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:t.selectedItems}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:t.selectedState})),t.selectedItems>1&&e._opts._hideOnMultiSelection&&e._opts._hideOnMultiSelection.forEach(t=>{e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})}))}),this._opts.modelEvents.subscribe({event:"xmodel-list-item-on-remove-selection"},function(){let t=e._getSelectedState();e._opts.useGeneratedToolbar&&(e._opts.withmultisel&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:t.selectedItems}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:t.selectedState})),1===t.selectedItems&&(0==e._opts._showOnOneSelection.length||e._opts._showOnOneSelection&&e._opts._showOnOneSelection.includes(e._model.getXSO().get()[0].options.grid.isA))&&e._opts._hideOnMultiSelection&&e._opts._hideOnMultiSelection.forEach(t=>{e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!0}})}))}),this._opts.modelEvents.subscribe({event:"xmodel-list-item-on-empty-selection"},function(){e._opts.useGeneratedToolbar&&(e._opts.withmultisel&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:0}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:0})),e._showMultiselectActions.forEach(t=>{e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})}))}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-hide-action"},function(t){e._hiddenActions.indexOf(t)<0&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}}),e._hiddenActions.push(t))}),this._opts.modelEvents.subscribe({event:"xmodel-list-tagger-on-filter-change"},function(t){if(e._opts.showTaggerFilter){let i=Object.keys(t).length>0;e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"taggerFilter",flag:i}})}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-show-action"},function(t){var i=e._hiddenActions.indexOf(t);if(i>-1){if(e._hiddenActions.splice(i,1),e._showMultiselectActions.indexOf(t)>-1&&0===e._model.getSelectedNodes().length)return void e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}});e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!0}})}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-disable-action"},function(t){e._disabledActions.indexOf(t)<0&&(e._opts.modelEvents.publish({event:"enox-collection-toolbar-disable-action",data:t}),e._disabledActions.push(t))}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-enable-action"},function(t){var i=e._disabledActions.indexOf(t);if(i>-1){if(e._disabledActions.splice(i,1),e._multiselectActions.indexOf(t)>-1&&0===e._model.getSelectedNodes().length)return void e._opts.modelEvents.publish({event:"enox-collection-toolbar-disable-action",data:t});e._opts.modelEvents.publish({event:"enox-collection-toolbar-enable-action",data:t})}}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(t){var i=t.searchValue[0]||"";e._opts.modelEvents.publish({event:"xmodel-list-context-search-action",data:i})}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-select-inversion"},function(){e._opts.modelEvents.publish({event:"xmodel-list-view-select-inversion"})}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-all-selected"},function(){e._opts.modelEvents.publish({event:"xmodel-list-view-all-selected"}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:1})}),this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-all-unselected"},function(){e._opts.modelEvents.publish({event:"xmodel-list-view-all-unselected"}),e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:0})}),this._opts.modelEvents.subscribe({event:"xmodel-list-view-group-by-action"},function(t){var o;if(e._opts.useGeneratedToolbar)return t&&(t.length&&1===t.length?t=t[0]:t.length>=2&&(t=i.DIMENSION+", "+i.UNIT)),void e._updateGroupByMenu(t);if(t&&t.length>0){var n={actionId:"groupByAction",contentId:t};if(!e._selectedGroupItem){var s=e._collectionToolBar._options.actions;if(s&&s.length>0){for(var a=0;a<s.length;a++)if("groupByAction"===s[a].id&&s[a].content&&s[a].content.length>0){o=s[a].content;break}if(o&&o.length>0)for(var l=0;l<o.length;l++)o[l].id===t[0]&&(e._selectedGroupItem=o[l]);var r=e._collectionToolBar._container.querySelector(".group-by-action");r&&(r.hasClassName("selected")?r.removeClassName("selected"):r.addClassName("selected"));var d=e._collectionToolBar._actionsIconBar.menu.getItem("groupByAction");if(d.content&&d.content.options&&d.content.options.items)d.content.options.items.forEach(function(e){e.id===t[0]&&(e.isSelected=!0,e.selected=!0)})}}var c=[],u=e._getItem("groupByAction"),p=t[0];if(u.content.options.items.forEach(function(e){p!==e.id&&c.push(e.id)}),c.length>0&&c.forEach(function(t){var i=e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t);i&&i.elements.container.hasClassName("selected")&&i.elements.container.removeClassName("selected")}),e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t[0])){var h=e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t[0]);h.elements.container.hasClassName("selected")||h.elements.container.addClassName("selected")}e._opts.modelEvents.publish({event:"enox-collection-toolbar-action-item-selection",data:n})}else{var m=e._collectionToolBar._actionsIconBar.menu.getItem("groupByAction");if(m&&m.content&&m.content.component&&m.content.component.items){var v=m.content.component.items;v&&v.forEach(function(t){if(t.elements.container){var i=t.elements.container;i.hasClassName("selected")&&i.removeClassName("selected")}var o=e._collectionToolBar._actionsIconBar.overflowMenu.getItem(t.id);o&&o.elements.container.hasClassName("selected")&&o.elements.container.removeClassName("selected")})}}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-group-visibility"},function(t){if(e._opts.useGeneratedToolbar)e._collectionToolBar.stableGenToolbar.updateNodeModel("groupByAction",{visibleFlag:t}),t||e._updateGroupByMenu();else{var i=e._collectionToolBar._container.querySelector(".group-by-action"),o=e._collectionToolBar._actionsIconBar.overflowMenu.elements.container.querySelector(".groupByAction");e._opts.withStableActions&&o&&(o.style.display=t?"":"none"),i&&(t?(i.removeClassName("displaynone"),i.removeClassName("selected"),e._selectedGroupItem&&(e._selectedGroupItem.isSelected=!1,e._selectedGroupItem.elements&&e._selectedGroupItem.elements.container.removeClassName("selected"),e._selectedGroupItem=null)):i.addClassName("displaynone"))}}),this._opts.modelEvents.subscribe({event:"xmodel-list-toolbar-update-switch-view"},function(t){e._opts.modelEvents.publish({event:"enox-collection-toolbar-select-view",data:{id:t,silent:!0}})}),this._opts.modelEvents.subscribe({event:"xmodel-list-data-on-search-complete"},function(){let t=e._getSelectedState();e._opts.useGeneratedToolbar&&e._opts.withmultisel&&e._opts.modelEvents.publish({event:"enox-collection-toolbar-set-multisel-actions",data:t.selectedState})}),this._opts.modelEvents.subscribe({event:"xmodel-list-collection-toolbar-update-filter-menu-status"},function(e){if(e&&e.id){var t=document.getElementById(e.id);t&&(!0===e.selected&&!1===t.hasClassName("selected")?t.addClassName("selected"):!1===e.selected&&!0===t.hasClassName("selected")&&t.removeClassName("selected"))}})},o.prototype._getItem=function(e){if(this._opts.useGeneratedToolbar){let t;return this._collectionToolBar.genToolbar.getNodeModelByID(e)&&(t=this._collectionToolBar.genToolbar),this._collectionToolBar.stableGenToolbar.getNodeModelByID(e)&&(t=this._collectionToolBar.stableGenToolbar),t.getNodeModelByID(e)}return this._collectionToolBar._actionsIconBar.getItem(e)},o.prototype._initMaps=function(){this._localMap_text={},this._localMap_text.DataGridView=i._dataGridView,this._localMap_text.TileView=i._tileView,this._localMap_text.ThumbnailView=i._thumbnailView,this._localMap_text.LargeThumbnailView=i._largeTileView,this._localMap_fonticon={},this._localMap_fonticon.DataGridView="view-list",this._localMap_fonticon.TileView="view-small-tile",this._localMap_fonticon.ThumbnailView="view-big-thb",this._localMap_fonticon.LargeThumbnailView="view-big-tile"},o.prototype._getToolbarActions=function(t){var i=[];this._multiselectActions=[],this._hiddenActions=[],this._showMultiselectActions=[];var o=this;return t.forEach(function(t){var n={handler:function(i,n,s){var a=[];if(t.callSubMenuHandler&&n&&e.is(n.handler,"function"))e.log("Nothing, as event would be fired by UIKIT and be handled in respective handler.!!!");else{if(t.allowSelectRetain)s&&s.hasOwnProperty("selected")&&a.push(s.selected);else if(t.enableOnSelection||t.showOnSelection){var l=[];o._model.getSelectedNodes().forEach(function(e){l.push(e.options)}),a.push(l),a.push(o._model.getSelectedNodes()),this&&this.id&&a.push(this)}0==a.length&&(a.push(o._model),a.push(o._collectionToolBar)),t.handler.apply(o._model,a)}}};t.enableOnSelection&&(n.disabled=!0,o._multiselectActions.push(t.id)),t.showOnSelection&&o._showMultiselectActions.push(t.id),t.visibility&&o._hiddenActions.push(t.id),e.merge(n,t),i.push(n)}),i},o.prototype.hideActions=function(){var e=this;(this._opts.withStableActions||this._showMultiselectActions.length>0)&&this._showMultiselectActions.forEach(function(t){e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})}),this._hiddenActions.length>0&&this._hiddenActions.forEach(function(t){e._opts.modelEvents.publish({event:"enox-collection-toolbar-visibility-action",data:{id:t,flag:!1}})})},o.prototype.inject=function(e){this._collectionToolBar.inject(e),this.hideActions()},o.prototype._initSort=function(){var t=this;this._opts.modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(i){if(i&&i.sortAttribute&&i.sortOrder){e.log("sorting tree on "+i.sortAttribute+" "+i.sortOrder);var o={dataIndex:i.sortAttribute,sort:i.sortOrder.toLowerCase(),id:i.sortAttribute,order:i.sortOrder.toLowerCase()};t._collectionToolBar._activateCurrentSort(o),t._opts.modelEvents.publish({event:"xmodel-list-data-sort-action",data:o})}})},o}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListViewDataExtension",["UWA/Core","UWA/Class","DS/TreeModel/TreeNodeModel","DS/WildcardSearchComponent/WildcardSearchComponent","DS/PlatformAPI/PlatformAPI"],function(e,t,i,o,n){"use strict";return t.extend({_id:"data-extention",initialize:function(e){this._viewId=e.id,this._model=e.model,this._dataNodeMap={},this._useAsyncExpand=e.useAsyncExpand,this._dataFilters={},this._searchFilters={},this._FILTER_ATTRIBUTES=e.filterAttributes?e.filterAttributes:["id","name","title","description","revision","responsible","owner","creator","maturity",{internal:"state",nlsValue:"nlsState"},{internal:"type",nlsValue:"nlsType"}],this._modelEvents=e.modelEvents,this._childKeys=e.childKeys?e.childKeys:[],this._filterData={},this._searchFilter={},this._wildCardSearchComponent=new o,this._isFilterDataUpdating=void 0,this._filterNodeLevel=0,this._defaultNodeDepth=e.defaultNodeDepth?e.defaultNodeDepth:0,this._keepSelectionOnHide=!!e.keepSelectionOnHide&&e.keepSelectionOnHide,this.subscribeEvents()},subscribeEvents:function(){var t=this;this._modelEvents.subscribe({event:"xmodel-list-data-on-load-complete"},function(){}),this._modelEvents.subscribe({event:"xmodel-list-data-load-action"},function(i){t._loadData(i,e.is(this,"object")?this:void 0)}),this._modelEvents.subscribe({event:"xmodel-list-data-item-append-action"},function(i){t._loadData(i,e.is(this,"object")?this:void 0,{append:!0})}),this._modelEvents.subscribe({event:"xmodel-list-data-item-add-action"},function(i){var o=t._addDataItem(i,e.is(this,"object")?this:void 0);t._modelEvents.publish({event:"xmodel-list-data-item-on-add-complete",data:o,context:o})}),this._modelEvents.subscribe({event:"xmodel-list-add-many-items"},function(i){var o=t._addDataItem(i,e.is(this,"object")?this:void 0);t._modelEvents.publish({event:"xmodel-list-data-item-on-add-complete",data:o,context:o})}),this._modelEvents.subscribe({event:"xmodel-list-data-item-remove-action"},function(e){t._removeDataItem(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-item-update-action"},function(i){t._updateDataItem(i,e.is(i.context,"object")?i.context:void 0)}),this._modelEvents.subscribe({event:"xmodel-list-data-update-action"},function(e){t._updateData(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-filter-action"},function(e){t.filter(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-search-action"},function(e){t._wildCardSearch(e)}),this._modelEvents.subscribe({event:"xmodel-list-data-set-filter-node-level"},function(i){e.is(i,"number")&&(t._filterNodeLevel=i)}),this._modelEvents.subscribe({event:"xmodel-list-get-filtered-data"},function(i){t._getFilteredData().then(function(){e.is(i,"function")&&i(t._filterData)})}),this._model.subscribe({event:"matchSearch"},function(e){e.data.nodeModel.show()}),this._model.subscribe({event:"unmatchSearch"},function(e){e.data.nodeModel.hide(t._keepSelectionOnHide)}),n.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(e){(e&&e.data&&e.data.authored&&e.data.authored.modified?e.data.authored.modified:[]).forEach(function(e){e&&t._model.search({shouldStop:function(i){return i.options.id===e&&(t._modelEvents.publish({event:"xmodel-list-data-item-need-refresh",data:e,context:i}),!0)}})})}),this._modelEvents.subscribe({event:"xmodel-list-data-add-wait-for-search"},function(){t._waitForSearch=!0}),this._modelEvents.subscribe({event:"xmodel-list-data-remove-wait-for-search"},function(){var e;for(var i in t._waitForSearch=!1,t._searchFilters)t._searchFilters.hasOwnProperty(i)&&(e={id:i,content:t._searchFilters[i]});e&&t._wildCardSearch(e)})},_loadData:function(t,i,o){var n=this._model,s=void 0!==o&&o.append;i&&e.is(i,"object")&&(n=i),n.prepareUpdate(),n.removeRoots&&!s?(n.ungroupRoots(),n.removeRoots()):n.removeChildren&&!s&&n.removeChildren(),this._modelEvents.publish({event:"xmodel-list-reset-sort-model",data:{}}),t&&t.member&&(this._isFilterDataUpdating=!1,this._loadChildData(t,n),this._modelEvents.publish({event:"xmodel-list-view-update-grouping-action",data:n})),n.pushUpdate(),this._updateFilterData()},_loadChildData:function(e,t){var o=this,n=[];e.member.forEach(function(e,t){var s=o._getNodeOptions(e);if(s){var a=null;if(o._childKeys&&o._childKeys.length>0)for(var l=0,r=o._childKeys.length;l<r;l++){var d=o._childKeys[l];e.hasOwnProperty(d)&&(a=e[d])}o._useAsyncExpand&&a&&(s.children=[]);var c=new i(s);a&&o._loadChildData(a,c),n.push(c),o._dataNodeMap[s.id]=c}}),t.addChild(n)},_removeDataItem:function(t,i){var o=this._model;i&&e.is(i,"object")&&(o=i),this._isFilterDataUpdating=!1,o.prepareUpdate(),e.is(t,"array")||(t=[t]);var n=o.search({match:function(e){return-1!==t.indexOf(e.nodeModel.options.id)}});n&&n.forEach(e=>{e.hide(),e.remove(),delete this._dataNodeMap[e.id]}),o.pushUpdate(),this._updateFilterData()},_updateDataItem:function(t,i){if(!i||!e.is(i,"object")){var o=t.id?t.id:t["@id"];o&&this._model.search({shouldStop:function(e){return o===e.options.id&&(i=e,!0)}})}return i&&(i.prepareUpdate(),i.updateOptions(this._getNodeOptions(t)),i.pushUpdate()),i},_updateData:function(e,t){t&&e.id==t.id?this._updateDataItem(e,t):e.member&&e.member.forEach(t=>{var i=t.id?t.id:t["@id"];i&&this._dataNodeMap.hasOwnProperty(i)?this._updateDataItem(e,this._dataNodeMap[i]):this._updateDataItem(e)})},_addDataItem:function(t,o){var n=this._model;o&&e.is(o,"object")&&(n=o),this._isFilterDataUpdating=!1,n.prepareUpdate();var s=n.getChildren()?n.getChildren().length:0,a=new i(this._getNodeOptions(t));if(a)return!o&&this._useAsyncExpand&&(a.options.children=[]),n.addChild(a,s),n.pushUpdate(),this._updateFilterData(),a},_getNodeOptions:function(e){if(e.id){e.id=e.id?e.id:e["@id"];var t=e;return{id:e.id?e.id:e["@id"],label:e.title,description:e.description,subLabel:"",grid:t,icons:e.image?[e.image]:e.thumbnail?[e.thumbnail]:[],thumbnail:e.image?e.image:e.thumbnail?e.thumbnail:"",color:""}}},filter:function(e){var t=[];if(e.id){var i,o=this;for(var n in this._dataFilters[e.id]=e.content||{},this._model.prepareUpdate(),o._dataFilters)if(o._dataFilters.hasOwnProperty(n)){var s=o._dataFilters[n];if(s.ids){var a=s.idPrefix||"";i=i?i.filter(function(e){return-1!==s.ids.indexOf(a+e)&&o._filterData.hasOwnProperty(e)}):s.ids.reduce(function(e,t){return a&&t.startsWith(a)&&(t=t.slice(a.length)),o._filterData.hasOwnProperty(t)&&e.push(t),e},[])}}i||(i=[]);this._model.search({match:function(e){if(-1!==i.indexOf(e.nodeModel.options.id)){e.nodeModel.matchSearch(),t.push(e.nodeModel.options.id);var o=e.nodeModel.getNodeDepth();if(o>0)for(var n=e.nodeModel.getParent();o>0;)o--,n&&(n.isMatchingSearch()||(n.matchSearch(),-1===i.indexOf(n.options.id)&&t.push(n.options.id)),n=n.getParent());return!0}return e.nodeModel.unmatchSearch(),!1},shouldStop:function(e){return e.getNodeDepth()>o._filterNodeLevel+o._defaultNodeDepth}});this._model.pushUpdate(),this._modelEvents.publish({event:"xmodel-list-data-on-update"})}return t},_createFilterDataForNodes:function(t){var i=this;t&&t.getChildren().forEach(function(t){i._filterData[t.options.id]=i._FILTER_ATTRIBUTES.reduce(function(i,o){return i||(i={}),"object"==typeof o?e.is(t.options.grid.nlsValues)&&e.is(t.options.grid.nlsValues[o.nlsValue])?i[o.internal]=t.options.grid.nlsValues[o.nlsValue]:e.is(o.getAttribute,"function")?i[o.internal]=o.getAttribute(t):i[o.internal]=t.options.grid.hasOwnProperty(o.internal)?t.options.grid.hasOwnProperty(o.internal):"":i[o]=t.options.grid.hasOwnProperty(o)?t.options.grid[o]:"",i},{}),t.hasChildren()&&i._createFilterDataForNodes(t)})},_updateFilterData:function(){var t=this;return t._filterData={},new e.Promise(function(e,i){try{t._createFilterDataForNodes(t._model),e()}catch(e){t._filterData={},i()}t._modelEvents.publish({event:"xmodel-list-filter-data-update-complete"}),t._isFilterDataUpdating=!1})},_getFilteredData:function(){var t=this;return new e.Promise(function(e){if(!1===t._isFilterDataUpdating)return e();t._modelEvents.subscribeOnce({event:"xmodel-list-filter-data-update-complete"},function(){e()}),t._isFilterDataUpdating||t._updateFilterData()})},_wildCardSearch:function(e){var t=this;if(e.id){this._searchFilters[e.id]=e.content||{};var i=e.content;if(this._waitForSearch&&i.value)return void this._modelEvents.publish({event:"xmodel-list-content-show-loader"});this._modelEvents.publish({event:"xmodel-list-content-hide-loader"}),this._getFilteredData().then(function(){var o=Object.keys(t._filterData).map(function(e){return t._filterData[e]});t._wildCardSearchComponent.search(i.value,o,function(i){var o=[];i&&(o=i.map(function(e){return e.id}));var n=t.filter({id:e.id,content:{ids:o}});t._modelEvents.publish({event:"xmodel-list-data-on-search-complete",data:n})},["id"])})}},destroy:function(){}})}),define("DS/xPortfolioUXCommons/DialogCreation/RequirementDialogCreation",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Form","DS/UIKIT/SuperModal","DS/CoreEvents/ModelEvents","DS/Controls/Button","DS/UIKIT/Input/Text","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/CKEditor/CKEditor","DS/WebappsUtils/WebappsUtils","i18n!DS/xPortfolioUXCommons/assets/nls/DialogCreation/DialogCreation","css!DS/xPortfolioUXCommons/DialogCreation/RequirementDialogCreation.css"],function(e,t,i,o,n,s,a,l,r,d,c,u){"use strict";return{createViewPatch:t.extend({className:"dialog-creation-requirement",setup:function(e){this.fields=e.fields},render:function(){var t=e.createElement("div"),i=e.createElement("label");i.style.color="#3d3d3d",i.setContent(u._content);let n=[];n.push({type:"text",label:u.title,name:"title",errorText:u.titleMandatory,required:!0}),n.push({type:"select",label:u._priority,name:"priority",options:[{label:u._preAssigned,value:"Pre-assigned"},{label:u._low,value:"Low",selected:!0},{label:u._medium,value:"Medium"},{label:u._high,value:"High"},{label:u._urgent,value:"Urgent"}]}),this.fields&&Array.isArray(this.fields)&&this.fields.length>0&&this.fields.forEach(function(t){let i=t.position;i&&e.is(i,"number")&&i>0&&i<=n.length?n.splice(i-1,0,t):n.push(t)}),this.formContent=new o({className:"vertical",fields:n}),this._editor=e.createElement("div",{class:"rich-object-content"}),this._ckEditor=e.createElement("textarea",{class:"ckeEditor-textarea",id:"editor_create_dialogue",placeholder:u._content});var s=c.getWebappsBaseUrl()+"VENREQPlugins/External/ckeditor";for(var a in this._customConfig=s+"/config.js",this._toolbar="Rich",this._plugins={sharedspace:s+"/plugins/sharedspace/",colorbutton:s+"/plugins/colorbutton/",panelbutton:s+"/plugins/panelbutton/",quicktable:s+"/plugins/quicktable/",base64image:s+"/plugins/base64image/",selectall:s+"/plugins/selectall/"},this._extraPlugins="",this._plugins)a&&(this._extraPlugins+=a+",");return this._extraPlugins=this._extraPlugins.slice(0,-1),this.defaultEditorOptions={skin:"office2013,"+s+"/skins/office2013/",customConfig:this._customConfig,extraPlugins:this._extraPlugins,toolbar:this._toolbar,language:window.widget?window.widget.lang:"en",height:"120px",startupFocus:!1,resize_enabled:!1},this.save=function(t){e.log("In Save"),this.hasBeenModified=!1;var i,o,n=t.getData().trim(),s=n.trim().replace(/\n/g,""),a=(i=n.trim(),(o=document.createElement("div")).innerHTML=i,o.textContent||o.innerText);this.attributeList={contentData:s,contentText:a,contentType:"html"}},this._ckEditor.inject(this._editor),this.formContent.inject(t),i.inject(t),this._editor.inject(t),this.container.setContent(t),this}}),disableCreateActions:function(e){var t=document.querySelector(".modal-content .modal-footer #createAnother_button"),i=document.querySelector(" .modal-content .modal-footer #create_button");t&&(e||t.setText(u.creating),t.addClassName("disabled")),i&&i.addClassName("disabled")},show:function(t){var i=this;this.options=t,this._id=t.id,this._parentId=t.parentId?t.parentId:"",this._context=t.context,this._withCreateAndClose=t.withCreateAndClose,this.modelEvent=t.modelEvent;var o=new n({renderTo:document.body,events:{onShow:function(){i.view.ck_editor_textarea=d.replace("editor_create_dialogue",i.view.defaultEditorOptions),i.modelEvent.publish({event:"enox-dialog-on-show"})},onHide:function(){i.modelEvent.publish({event:"enox-dialog-on-hide"}),i.creation_notify_token&&i.modelEvent.unsubscribe(i.creation_notify_token)}}});this.view=new this.createViewPatch(t);var s=[{className:i._withCreateAndClose?"default":"primary",id:"createAnother_button",value:u.createAnother,action:function(t){i.view.save(i.view.ck_editor_textarea);var o=i.view.formContent.getValue("title");if(i.view.formContent.setValue("title",o.trim()),i.view.formContent.validate()){e.log("event publish : enox-dialog-creation id : "+i._id);let o={content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id};i._parentId&&(o.parentId=i._parentId),i.modelEvent.publish({event:"enox-dialog-creation",data:o,context:this}),i.disableCreateActions(),i._withCreateAndClose||(i.view.destroy(),t.hide())}}},{className:"default",id:"cancel_button",value:u.cancel,action:function(e){e.hide()}}];i.creation_notify_token=i.modelEvent.subscribe({event:"enox-dialog-creation-done"},function(e){var t=document.querySelector(".modal-content .modal-footer #createAnother_button"),o=document.querySelector(".modal-content .modal-footer #create_button");t&&(e||t.setText(u.createAnother),t.removeClassName("disabled")),o&&o.removeClassName("disabled");var n=i.view.formContent.getFields()[0];n&&n.focus()}),this._withCreateAndClose&&s.push({className:"primary",id:"create_button",value:u.create,action:function(t){i.view.save(i.view.ck_editor_textarea);var o=i.view.formContent.getValue("title");if(i.view.formContent.setValue("title",o.trim()),i.view.formContent.validate()){e.log("event publish : enox-dialog-creation id : "+i._id);var n={content:i.formatContentPatch(i.view.formContent),context:i._context,id:i._id};i._parentId&&(n.parentId=i._parentId),i.modelEvent.publish({event:"enox-dialog-creation",data:n,context:this}),t.hide()}}}),this.view.render(),o.dialog({body:this.view.getContent(),title:t.title,buttons:s}),i.disableCreateActions(!0),i.view.formContent.getFields().forEach(function(e){e.required&&e.addEvent("input",function(){i.validate()?i.modelEvent.publish({event:"enox-dialog-creation-done",data:!0}):i.disableCreateActions(!0),e.focus()})});var a=i.view.formContent.getFields()[0];a&&a.focus(),document.querySelector(".modal-content ").addEventListener("keyup",function(e){"Enter"==e.key&&"createAnother_button"!=e.target.id&&(i.validate()&&document.querySelector(".modal-content .modal-footer .btn-primary").click())})},validate:function(){var e=!0;return this.view.formContent.getFields().forEach(function(t){t.required&&""===t.value&&(e=e&&!1)}),e},formatContentPatch:function(e){var t=e.getValues();return this.view.attributeList&&(t.contentData=this.view.attributeList.contentData,t.contentText=this.view.attributeList.contentText,t.contentType=this.view.attributeList.contentType),t}}}),define("DS/xPortfolioUXCommons/XModelListView/js/TitleTweaker",["DS/Tweakers/TweakerBase","DS/Tweakers/TweakerString","DS/Core/PointerEvents","DS/Utilities/Utils","DS/Utilities/Dom","DS/Controls/Button","DS/Controls/LineEditor","css!DS/xPortfolioUXCommons/XModelListView/css/TitleTweaker.css"],function(e,t,i,o,n,s,a){"use strict";var l=e.inherit({name:"titleTweaker",publishedProperties:{label:{defaultValue:"",type:"string"},displayStyle:{defaultValue:"editText",type:"string",category:"Appearance"},linkDisplay:{defaultValue:!0,type:"boolean",category:"Appearance"}}}),r=function(t,i){e.prototype.baseViewModule.call(this,t,i)};o.applyMixin(r,e.prototype.baseViewModule);var d=function(e,t){r.call(this,e,t)};return o.applyMixin(d,r),d.prototype.buildView=function(){if(this._tweaker.elements.container){var e=UWA.merge({},this._options.viewOptions);e.touchMode=this._tweaker._getCurrentTouchMode(),e.allowUnsafeHTMLLabel=!1,e.selectAllOnFocus=!0;var t,o=this;if(this._tweaker.value&&(e.value=this._tweaker.value),this._tweaker._isFakeNode=!0,this._tweaker.executionContext.nodeModel.options.id&&(this._tweaker._isFakeNode=!1),this._textSpan=UWA.createElement("span",{textContent:e.value}),this._link=UWA.createElement("a",{textContent:e.value}),this._link.addEventListener(i.POINTERDOWN,(t=this._tweaker,function(e){t.linkDisplay&&t.executionContext&&t.executionContext.nodeModel.getModelEvents().publish({event:"title-link-action",context:t.executionContext})})),this._lineEditor=new a(e),this._view=UWA.createElement("div",{class:"title-tweaker"}),this._view.addContent(this._link),this._view.addContent(this._textSpan),this._view.addContent(this._lineEditor),this._view.addClassName("not-editable"),this._view._giveFocus=function(){o._lineEditor._giveFocus()},this.setValue(this._tweaker.value),!this._tweaker.readOnly){o._tweaker.timeSwitchtoEdit=new Date;setTimeout(function(){o._view.removeClassName("not-editable"),o._tweaker._isFakeNode=!1},500),o._view.addEventListener(i.POINTERDOWN,function(e){new Date-o._tweaker.timeSwitchtoEdit>500?o.setEditable(!0):o._tweaker.executionContext&&o._tweaker.executionContext.nodeModel.getModelEvents().publish({event:"title-link-action",context:o._tweaker.executionContext})})}}},d.prototype.handleEvents=function(){var e=this,t=this._view;t.addEventListener(i.LONGHOLD,function(e){e.stopPropagation()}),t.addEventListener("contextmenu",function(e){}),n.addEventOnElement(e._tweaker,this._lineEditor,"blur",function(t){t.stopPropagation(),e._tweaker.onPostEdit()}),n.addEventOnElement(e._tweaker,this._lineEditor,"uncommittedChange",function(t){t.stopPropagation(),e._tweaker.onPreEdit()}),n.addEventOnElement(this._tweaker,this._lineEditor,"change",function(t){t.stopPropagation(),e._tweaker.readOnly||(""!=e._lineEditor.value.trim()?(e.setTweakerValue(e._lineEditor.value),e._tweaker.onPostEdit()):e.setTweakerValue(e._tweaker._currentValueLabel))}),n.addEventOnElement(e._tweaker,this._lineEditor,"focusout",function(t){t.stopPropagation(),e.setEditable(!1)}),n.addEventOnElement(e._tweaker,this._lineEditor,"keyup",function(t){13==t.keyCode&&(t.stopPropagation(),e.setEditable(!1))})},d.prototype.setEditable=function(e){if(this._view)try{e&&!this._view.isEditing?this._view.addClassName("editing"):e||(this._view.isEditing=!1,this._view.removeClassName("editing"),this.setValue(this._tweaker.value))}catch(e){UWA.log("editable false")}},d.prototype.setValue=function(){this._view&&(this._tweaker.linkDisplay?this._view.removeClassName("no-link-display"):this._view.addClassName("no-link-display"),void 0===this._tweaker.value||null===this._tweaker.value?this._view.label="undefined":(this._textSpan.textContent=this._tweaker.value,this._link.textContent=this._tweaker.value,this._lineEditor.value=this._tweaker.value))},l.prototype.baseViewModule=r,l.prototype.VIEW_MODULES={editText:{classObject:d,options:{viewOptions:{displayStyle:"editText"}}},editText_readOnly:{classObject:d,options:{viewOptions:{displayStyle:"editText"}}}},l}),define("DS/xPortfolioUXCommons/NotificationsUtil/xNotificationsUtil",["UWA/Class","UWA/Core","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,i,o){"use strict";var n=e.singleton({_notificationsMgr:{},_defaultLevel:"info",_appendAppNameToMsg:!1,_appNameStr:"",_msgLevels:{INFO:"info",WARNING:"warning",ERROR:"error",SUCCESS:"success"},init:function(e){e&&e.appName&&""!=e.appName&&(_appNameStr=e.appName),this._notificationsMgr=i,o.setNotificationManager(this._notificationsMgr)},showMessage:function(e){e&&e.message&&this._notificationsMgr.addNotif({category:e.category,level:e.level?e.level:this._defaultLevel,message:this._appendAppNameToMsg?this._appNameStr+e.message:e.message,sticky:!!e.isSticky&&e.isSticky,title:e.title?e.title:"",subtitle:e.subtitle?e.subtitle:""})},showError:function(e){this._showMessageHelper(e,this._msgLevels.ERROR)},showInfo:function(e){this._showMessageHelper(e,this._msgLevels.INFO)},showSuccess:function(e){this._showMessageHelper(e,this._msgLevels.SUCCESS)},showWarning:function(e){this._showMessageHelper(e,this._msgLevels.WARNING)},_showMessageHelper:function(e,i){e&&""!==e&&(t.is(e,"string")?this.showMessage({level:i,message:e}):this.showMessage({level:i,message:e.message,title:e.title,subtitle:e.subtitle,category:e.category}))},removeNotificationFromCategory:function(e,t){o.removeNotifications(e,t)}});return n.init(),n}),define("DS/xPortfolioUXCommons/XModelListView/js/XModelListView",["UWA/Core","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewCollectionToolBar","DS/xPortfolioUXCommons/XModelListView/js/XModelListViewEmptyContent","DS/DataGridView/DataGridView","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/UIKIT/Mask","DS/Utilities/Dom","DS/Core/PointerEvents","DS/Utilities/TouchUtils","DS/TreeModel/TreeDocument","DS/Controls/ProgressBar","DS/Controls/ResponsiveThumbnailView","i18n!DS/xPortfolioUXCommons/assets/nls/XModelListView","css!DS/xPortfolioUXCommons/XModelListView/css/XModelListView.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,h,m){"use strict";var v=function(t){t.hasOwnProperty("toolbarOptions")&&t.toolbarOptions.hasOwnProperty("touchMode")&&(this.toolbarTouchMode=t.toolbarOptions.touchMode),this.deviceTouchMode=c.getTouchMode(),this._displayProperties=["contextualMenu","description","propertiesList"],this.MOBILE_BREAKPOINT=550,this._withToolBar=void 0===t.withToolBar||t.withToolBar,this._withProgressBar=void 0!==t.withProgressBar&&t.withProgressBar,this.securityContext=t.securityContext?t.securityContext:"",this._initDivs(),t.viewOptions||(t.viewOptions={}),t.model||(t.model=new u({})),this._filterAttributes=t.filterAttributes?t.filterAttributes:"",this._model=t.model,this._options=t,this._id=t.id||"ViewId",this._useAsyncExpand=!0===t.useAsyncExpand,this._model.options.useAsyncPreExpand=this._useAsyncExpand,this._groupedRows=[],this._visibleCustomAttributeColumns=[],this._modelEvents=t.modelEvents,this.useDragAndDrop=t.useDragAndDrop||!1,this.showStatusBar=!!t.showStatusBar&&t.showStatusBar;var i=t.extensions||[];if(this._initExtensions_v1(i),this._withToolBar&&this._initToolBar(this._model,t),this._initListView(t.viewOptions),null!==t.emptyContentOptions&&this._initEmptyContent(this._model,t),this._subscribeEvents(),window.widget&&e.is(window.widget,"object")){var o=this;window.widget.addEvent("onSearch",function(e){o._modelEvents.publish({event:"xmodel-list-dashboard-search-action",data:e})}),window.widget.addEvent("onResetSearch",function(){o._modelEvents.publish({event:"xmodel-list-dashboard-search-action",data:""})}),window.widget.addEvent("onViewChange",function(){o.updateTagFocus()})}};return v.prototype.getDataIndexFromColumnIndex=function(e){var t=this._contentViews.DataGridView;if(t&&e)return t.layout.getDataIndexFromColumnIndex(e)},v.prototype.getColumnIndex=function(e){var t=this._contentViews.DataGridView;if(t&&e)return t.layout.getColumnIndex(e)},v.prototype.getDataGridView=function(){return this._contentViews.DataGridView},v.prototype.removeColumnOrGroup=function(e){var t=this._contentViews.DataGridView;t&&e&&t.removeColumnOrGroup(e)},v.prototype._setCurrentViewRowGroups=function(e){this._contentViews.DataGridView.getCustomViewsManager().addCustomView({identifier:"Current View",columnsVisibleFlag:{dimension:!1,unit:!1},groupingOptions:{dataIndexesToGroup:e}},!0)},v.prototype._subscribeEvents=function(){var t=this;this._modelEvents.subscribe({event:"xmodel-list-hide-status-bar"},function(){t._views.forEach(function(e){t._contentViews[e].displayedOptionalCellProperties&&(t._displayProperties=["contextualMenu","description","propertiesList"],t._contentViews[e].displayedOptionalCellProperties=t._displayProperties,t.refresh())})}),this._modelEvents.subscribe({event:"xmodel-list-show-status-bar"},function(){t._views.forEach(function(e){t._contentViews[e].displayedOptionalCellProperties&&(t._displayProperties=["contextualMenu","description","propertiesList","statusbarIcons"],t._contentViews[e].displayedOptionalCellProperties=t._displayProperties,t.refresh())})}),this._modelEvents.subscribe({event:"xmodel-list-view-set-tagger-context"},function(e){let i=e.tagsActivated,o=i?"activate":"deactivate";t._modelEvents.publish({event:`xmodel-list-tagger-${o}-action`}),e.showFocusedState&&t._showListViewSelected(i)}),this._modelEvents.subscribe({event:"xmodel-list-add-columns"},function(i){if(i&&i.length>0){var o=t._contentViews.DataGridView;o?(o.prepareUpdateView(),i.forEach(function(e){var t=o.columns.length>0?o.columns.length-1:void 0;o.addColumnOrGroup(e,t)}),o.pushUpdateView()):e.log("Warning, DGV instance does not exists!")}}),this._modelEvents.subscribe({event:"xmodel-list-update-progress-bar"},function(e){t._progressBar&&void 0!==e&&(t._progressBar.value=e,e>=100&&setTimeout(function(){t._progressBarContainer.classList.add("displaynone")},200))}),this._modelEvents.subscribe({event:"xmodel-list-update-empty-content"},function(e){t._XModelListViewEmptyContent.destroy(),t._emptyContainer.remove(),t._initEmptyContent(t._model,e)}),this._modelEvents.subscribe({event:"xmodel-list-show-progress-bar"},function(){t._progressBarContainer&&t._progressBarContainer.classList.contains("displaynone")&&t._progressBarContainer.classList.remove("displaynone")}),this._modelEvents.subscribe({event:"xmodel-list-hide-progress-bar"},function(){!1===t._progressBarContainer.classList.contains("displaynone")&&t._progressBarContainer.classList.add("displaynone")}),this._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(e){t._viewIdToolbar=e,t._groupedRows.length>0?(t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:[]}),setTimeout(function(){t._switchView(e)},500)):t._switchView(e),t._modelEvents.publish({event:"xmodel-list-toolbar-group-visibility",data:"DataGridView"===e})}),this._modelEvents.subscribe({event:"xmodel-list-view-update-column-definition"},function(e){if("DataGridView"===t._currentView){let i=t._contentViews[t._currentView];e.forEach(e=>{i.layout.setColumnOrGroupProperties(e.dataIndex,e.properties)})}}),this._model.subscribe({event:"addChild"},function(e){var i=t._getContextualMenu(e.data.nodeModel);e.data.nodeModel.options.contextualMenu=i,t._onDataUpdate()}),this._model.subscribe({event:"removeChild"},function(){t._onDataUpdate()}),this._model.subscribe({event:"title-link-action"},function(){this.nodeModel.options.id&&t._modelEvents.publish({event:"xmodel-list-title-link-click",data:{model:this.nodeModel.options.grid},context:this.nodeModel})}),this._modelEvents.subscribe({event:"xmodel-list-view-group-by-custom-action"},function(e){var i=t._contentViews.DataGridView;e.isSelected?t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:e.indexes}):(t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:[]}),i.reapplyRowGrouping())}),this._modelEvents.subscribe({event:"xmodel-list-view-group-by-action"},function(e){e||(e=[]);var i=t._contentViews.DataGridView;i&&(t._groupedRows=e,i.groupRows({dataIndexesToGroup:e}),i.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}),t._modelEvents.publish({event:"xmodel-list-data-set-filter-node-level",data:t._groupedRows.length}))}),this._modelEvents.subscribe({event:"xmodel-list-view-update-grouping-action"},function(i){if(t._contentViews.DataGridView&&i){var o=t._groupedRows;e.is(o,"array")&&o.length>0&&"function"==typeof groupRoots&&i.groupRoots({propertiesToGroup:o}),t._modelEvents.publish({event:"xmodel-list-data-set-filter-node-level",data:t._groupedRows.length})}}),this._modelEvents.subscribe({event:"xmodel-list-view-expand-all-action"},function(){t._model.prepareUpdate(),t._model.expandAll(),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-view-collapse-all-action"},function(){t._model.prepareUpdate(),t._model.collapseAll(),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-view-disble-menu"},function(e){t._model.search({match:function(t){return-1!==e.indexOf(t.nodeModel.options.id)&&(t.nodeModel.prepareUpdate(),t.nodeModel.options.disableMenu=!0,t.nodeModel.pushUpdate(),!0)}});var i=t._contentViews.DataGridView;i&&i.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}),this._modelEvents.subscribe({event:"xmodel-list-data-on-load-start"},function(){t._container&&(l.mask(t._container),t._isLoading=!0)}),this._modelEvents.subscribe({event:"xmodel-list-data-on-load-complete"},function(){t._container&&l.isMasked(t._container)&&(l.unmask(t._container),t._isLoading=!1,"ThumbnailView"===t._currentView&&t._contentViews.ThumbnailView&&(t._container.offsetWidth<t.MOBILE_BREAKPOINT?t._contentViews.ThumbnailView.displayedOptionalCellProperties=["contextualMenu"]:t._contentViews.ThumbnailView.displayedOptionalCellProperties=t._displayProperties,t._contentViews.ThumbnailView.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})))}),this._modelEvents.subscribe({event:"xmodel-list-context-search-action"},function(e){var i={id:"ContextSearch",content:{value:e}};t._modelEvents.publish({event:"xmodel-list-data-search-action",data:i})}),this._modelEvents.subscribe({event:"xmodel-list-dashboard-search-action"},function(e){var i={id:"GlobalSearch",content:{value:e}};t._modelEvents.publish({event:"xmodel-list-data-search-action",data:i})}),this._modelEvents.subscribe({event:"xmodel-list-data-sort-action"},function(e){var i=t._contentViews.DataGridView;i&&(i.sortModel&&1===i.sortModel.length&&i.sortModel[0].dataIndex===e.dataIndex&&i.sortModel[0].sort===e.sort?i.reapplySortModel():i.sortModel=[e])}),this._modelEvents.subscribe({event:"xmodel-list-set-column-visibility-action"},function(e){var i=t._contentViews.DataGridView;i&&i.layout.setColumnVisibleFlag(e.dataIndex,e.visibility)}),this._modelEvents.subscribe({event:"xmodel-list-set-color-visibility-action"},function(e){var i=t._contentViews.DataGridView;i&&(i.showNodeKPIColorFlag=e)}),this._model.getXSO().onPostAdd(function(e){if(Array.isArray(e)&&e.length>0){let i=!1;e.length>1&&(i=!0),t._modelEvents.publish({event:"xmodel-list-item-on-add-selection",data:{model:i?e:e[0].options.grid,items:t._model.getXSO().get(),multiSelect:i},context:i?t._model:e[0].options.grid}),t.updateTagFocus()}}),this._model.getXSO().onPostRemove(function(i){if(!t._isLoading&&Array.isArray(i)&&i.length>0){let o=!1;i.length>1&&(o=!0),t._modelEvents.publish({event:"xmodel-list-item-on-remove-selection",data:{model:o?i:i[0].options.grid,items:t._model.getXSO().get(),multiSelect:o},context:o?t._model:i[0].options.grid}),t._model.getSelectedNodes()&&0===t._model.getSelectedNodes().length&&(e.log("empty selection"),t._modelEvents.publish({event:"xmodel-list-item-on-empty-selection"})),t.updateTagFocus()}}),this._modelEvents.subscribe({event:"xmodel-list-unselect-all"},function(){let e=t._model.getXSO().get();t._model.prepareUpdate(),t._model.getXSO().remove(e),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-select-all"},function(){t._model.selectAll()}),this._modelEvents.subscribe({event:"xmodel-list-enable-contextual-menu"},function(e){t._contextualMenuEnabled=e}),this._modelEvents.subscribe({event:"xmodel-list-select-all-root-nodes"},function(){var e=t._model.getRoots();e&&e.forEach(function(e){e.select()})}),this._modelEvents.subscribe({event:"xmodel-list-selection-action"},function(e){let i=[];t._model.search({match:function(t){return-1!==e.indexOf(t.nodeModel.options.id)&&(i.push(t.nodeModel),!0)}}),i.length>0&&(t._model.prepareUpdate(),t._model.getXSO().add(i),t._model.pushUpdate())}),this._modelEvents.subscribe({event:"xmodel-list-item-get-selection"},function(i){e.is(i,"function")&&i(t._model.getXSO().get().map(function(e){return e.options.grid})||[])}),this._modelEvents.subscribe({event:"xmodel-list-data-on-update"},function(){t._onDataUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-reset-sort-model"},function(){t._contentViews.DataGridView&&(t._contentViews.DataGridView.sortModel=null)}),this._modelEvents.subscribe({event:"enox-collection-toolbar-sort-reset"},function(){t._modelEvents.publish({event:"xmodel-list-reset-sort-model"})}),this._modelEvents.subscribe({event:"xmodel-list-scroll-to-node"},function(e){t._contentViews.DataGridView&&t._contentViews.DataGridView.ensureNodeModelVisible(e,!0)}),this._model.onPreExpand(function(e){t._modelEvents.publish({event:"xmodel-list-view-on-expand",data:{model:e.data.nodeModel.options.grid,nodeInfo:e.data},context:e.data.nodeModel})}),this._modelEvents.subscribe({event:"xmodel-list-view-select-inversion"},function(){let e=t._model.getXSO().get(),i=[];t._model.processDescendants({onlyVisibleNodes:!0,processNode:function(e){let t=e.nodeModel;t.isSelected()&&t._isSelected||i.push(t)}}),t._model.prepareUpdate(),t._model.getXSO().add(i),t._model.getXSO().remove(e),t._model.pushUpdate()}),this._modelEvents.subscribe({event:"xmodel-list-view-all-selected"},function(){t._contentViews.DataGridView&&t._contentViews.DataGridView.selectAllVisibleNodes()}),this._modelEvents.subscribe({event:"xmodel-list-view-all-unselected"},function(){t._modelEvents.publish({event:"xmodel-list-unselect-all"})}),this._modelEvents.subscribe({event:"xmodel-list-content-show-loader"},function(){t._listContainer&&l.mask(t._listContainer)}),this._modelEvents.subscribe({event:"xmodel-list-content-hide-loader"},function(){t._listContainer&&l.isMasked(t._listContainer)&&l.unmask(t._listContainer)})},v.prototype._initEmptyContent=function(e,t){this._emptyContainer=document.createElement("div"),this._emptyContainer.classList.add("mdllv-empty-container"),this._withToolBar||this._emptyContainer.classList.add("no-toolbar"),this._emptyContainer.classList.add("displaynone"),this._XModelListViewEmptyContent=new i(e,t,this._modelEvents,this._emptyContainer);var o=this;this._modelEvents.subscribe({event:"xmodel-list-is-empty"},function(e){e?o._listContainer.classList.add("displaynone"):o._listContainer.classList.remove("displaynone")}),this._container.appendChild(this._emptyContainer)},v.prototype._initDivs=function(){this._container=e.createElement("div"),this._container.classList.add("xmodel-list-view"),0==this.toolbarTouchMode&&null==this.deviceTouchMode&&this._container.classList.add("touchmode-off"),this._collectionToolBarContainer=document.createElement("div"),this._collectionToolBarContainer.classList.add("xmdllv-collectiontoolbar-container"),this._listContainer=document.createElement("div"),this._listContainer.classList.add("xmdllv-list-container"),this._withToolBar||(this._listContainer.classList.add("no-toolbar"),this._collectionToolBarContainer.classList.add("no-toolbar")),this._container.appendChild(this._collectionToolBarContainer),this._withProgressBar&&(this._progressBarContainer=document.createElement("div"),this._progressBarContainer.classList.add("xmdllv-list-progress-bar-container"),this._progressBar=new p({displayStyle:"lite",value:10}).inject(this._progressBarContainer),this._progressBar.addEventListener("change",function(e){e.stopPropagation()}),this._container.appendChild(this._progressBarContainer)),this._container.appendChild(this._listContainer)},v.prototype._initToolBar=function(e,i){this._collectionToolBar=new t(e,i,this._modelEvents),this._collectionToolBar.inject(this._collectionToolBarContainer)},v.prototype._setDragData=function(e,t){for(var i=[],o=0;o<t.length;o++){var n=t[o],s=n?n.options.grid:{id:"",type:"",modelID:""},a={envId:window.widget.getValue("x3dPlatformId"),serviceId:"3DSpace",contextId:window.widget.getValue("xPref_CREDENTIAL")?window.widget.getValue("xPref_CREDENTIAL"):this.securityContext,objectId:s.id,objectType:s.type&&s.type.trim()||"",objectName:s.name||"",displayType:s.type&&s.type.trim()||"",displayName:s.title};i.push(a)}var l={protocol:"3DXContent",version:"1.1",source:window.widget.getValue("appId"),widget_id:window.widget.id,data:{items:i}};e.dataTransfer.setData("Text",JSON.stringify(l)),e.dataTransfer.effectAllowed="all"},v.prototype._getPreferedView=function(e){if(e||(e=this._views),this._viewIdToolbar)return this._viewIdToolbar;if(this._viewIdOption&&e.indexOf(this._viewIdOption)>=0)return this._viewIdOption;if(window.widget){var t=e.includes("DataGridView")?"DataGridView":e[0];return 0!==this._container.offsetWidth&&this._container.offsetWidth<this.MOBILE_BREAKPOINT&&e.includes("TileView")?t="TileView":window.widget.body.offsetWidth<this.MOBILE_BREAKPOINT&&e.includes("TileView")&&(t="TileView"),t}},v.prototype._initListView=function(t){this._views=t.views||["DataGridView"],this._viewIdOption=t.currentView;var i=this._getPreferedView();this._currentView=t.currentView?t.currentView:i,this._expandLabel=t.expandLabel,this._collapseLabel=t.collapseLabel,!1===e.is(t.onDelayedModelDataRequest,"function")&&(t.onDelayedModelDataRequest=void 0),this._contentViews={};var l={height:"inherit",displayedOptionalCellProperties:this._displayProperties,allowUnsafeHTMLContent:!1,model:this._model,onDelayedModelDataRequest:t.onDelayedModelDataRequest};this.showStatusBar&&(this._displayProperties=["contextualMenu","description","propertiesList","statusbarIcons"],l.displayedOptionalCellProperties=this._displayProperties);var r=this,c={callback:function(e){var t=e.menu?e.menu:[],i=e.cellInfos.nodeModel;if(r._contentViews[r._currentView]&&r._contentViews[r._currentView].activeNode){var o=r._contentViews[r._currentView].activeNode;i!==o&&(i=o,t=r._getContextualMenu(o))}if(i&&null===i.getChildren())return t;if(i){var n=i.getTreeDocument(),s=!0;let e=0;for(;e<t.length&&s;)"expand"===t[e].id&&(s=!1),e++;if(s){var a=function(e){for(let t=0;t<e.length;t++)if("SeparatorItem"===e[t].type)return t++}(t);t.splice(a,0,{type:"SeparatorItem"}),t.splice(a+1,0,{id:"expand",type:"PushItem",icon:"flow-tree-expand-down",title:r._expandLabel?r._expandLabel:m._expand_content,action:{callback:function(){void 0!==n&&(i.expandAll(),r._modelEvents.publish({event:"xmodel-list-item-node-expanded",data:{item:i,expanded:!0}}))}},state:i.isExpanded()?"disabled":"enabled"}),t.splice(a+2,0,{id:"collapse",type:"PushItem",icon:"flow-tree-expand-up",title:r._collapseLabel?r._collapseLabel:m._collapse_content,action:{callback:function(){void 0!==n&&(i.collapseAll(),r._modelEvents.publish({event:"xmodel-list-item-node-expanded",data:{item:i,expanded:!1}}))}},state:i.isExpanded()?"enabled":"disabled"})}}return t}},u={label:"label",subLabel:"subLabel",description:"description",customTooltip:"customTooltip",icon:"icon"};e.extend(u,t.itemViewMapping||{});var p={getLabel:function(t){return e.is(u.label,"function")?u.label.call(this,t):t.options.grid[u.label]},getSubLabel:function(t){return e.is(u.subLabel,"function")?u.subLabel.call(this,t):t.options.grid[u.subLabel]},getDescription:function(t){return e.is(u.description,"function")?u.description.call(this,t):t.options.grid[u.description]},getCustomTooltip:function(t){return e.is(u.customTooltip,"function")?u.customTooltip.call(this,t):t.options.grid[u.label]},getIcon:function(t){return e.is(u.icon,"function")?u.icon.call(this,t):t.options.grid.image?t.options.grid.image:""}};r.showStatusBar&&(p.getStatusbarIcons=function(t){return e.is(u.statusBarIcon,"function")?u.statusBarIcon.call(this,t):[]},p.getStatusbarLabelsWidthRatios=function(t){return e.is(u.statusbarLabelsWidthRatios,"function")?u.statusbarLabelsWidthRatios.call(this,t):[]},p.getStatusbarIconsTooltips=function(t){return e.is(u.statusbarIconsTooltips,"function")?u.statusbarIconsTooltips.call(this,t):[]},p.onStatusbarIconPointerDown=function(t){return e.is(u.onStatusbarIconPointerDown,"function")?u.onStatusbarIconPointerDown.call(this,t):[]});var h={_preBuild:function(){this._parent(),this._properties.layout.value.columnMaxWidth={0:192,420:240}}};e.merge(h,p);var v=function(e){e.cellView.getContent().setAttribute("node-depth",e.nodeModel.getNodeDepth())};this._views.forEach(function(i){if("DataGridView"===i){var u={showContextualMenuColumnFlag:!!e.is(t.showContextualMenuColumnFlag)&&t.showContextualMenuColumnFlag,onDropRowHeader:e.is(t.onDropRowHeader,"function")?t.onDropRowHeader:void 0,onDelayedModelDataRequest:t.onDelayedModelDataRequest,identifier:t.identifier?t.identifier:r._options.id?r._options.id:void 0,treeDocument:r._model,_useClipboardFlag:!0,cellSelection:"none",defaultColumnDef:{width:"auto",typeRepresentation:"string",groupableFlag:!1,editionPolicy:"EditionOnClick"},onContextualEvent:e.is(t.onContextualEvent)&&(e.is(t.onContextualEvent,"function")||e.is(t.onContextualEvent.callback,"function"))?t.onContextualEvent:function(e){var t=[];if(!1===r._contextualMenuEnabled)return[];if(e&&e.collectionView&&e.cellInfos){var i=e.cellInfos.columnID,o=e.cellInfos.rowID;0!==i&&1!==i&&-1===o?t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!1}):o>-1&&e.cellInfos.nodeModel&&(t=r._getContextualMenu(e.cellInfos.nodeModel))}return t},rowDragEnabledFlag:r.useDragAndDrop,columnDragEnabledFlag:!1,cellDragEnabledFlag:!0,onDragStartRowHeader:function(t,i){var o=this.getTreeDocument()?this.getTreeDocument().getSelectedNodes():[],n=o&&o.length>0?o:[i.nodeModel];void 0!==r._options.setDragData&&e.is(r._options.setDragData,"function")?r._options.setDragData(t,n):r._setDragData(t,n)}},_=t.grid;if(_.columns){for(var f=0,g=_.columns.length;f<g;f++){var w=_.columns[f];w&&"tree"===w.dataIndex&&(w.alwaysVisibleFlag=!0,void 0!==w.sortableFlag&&!1===w.sortableFlag&&(w.sortableFlag=!0),w.minWidth=150),w&&"titleTweaker"===w.typeRepresentation&&(w.getCellValue||(w.getCellValue=function(e){return e.nodeModel.options.label}),w.setCellValue||(w.setCellValue=function(e,t){e.nodeModel.setLabel(t)}))}t.contextualActions&&!0!==t.showContextualMenuColumnFlag&&(_.columns.unshift({text:m._color,dataIndex:"color",typeRepresentation:"color",pinned:"left",width:"50",visibleFlag:!1}),_.columns.push({text:m._action,dataIndex:"contextualMenu",pinned:"right",width:55,resizableFlag:!1,allowUnsafeHTMLContent:!0,alwaysVisibleFlag:!0,sortableFlag:!1,groupableFlag:!1,typeRepresentation:"contextualMenuType",getCellTooltip:function(e){if(e.nodeModel&&e.nodeModel.options&&e.nodeModel.options.contextualMenu&&1===e.nodeModel.options.contextualMenu.length)return{shortHelp:e.nodeModel.options.contextualMenu[0].title}},getCellValue:function(e){var t={menu:[],disabled:!1},i=r._getContextualMenu(e.nodeModel);return i&&i.length>0&&(t.menu=i),e&&e.nodeModel&&e.nodeModel.options&&!0===e.nodeModel.options.disableMenu&&(t.disabled=!0),t}}))}e.extend(u,_),r._contentViews[i]=new o(u),r._contentViews[i].getCustomViewsManager().onCustomViewsSave=function(e,t){var i;for(f=0;f<e.length;f++)if(e[f].identifier===t){i=e[f].columnsVisibleFlag;break}if(i){var o=r._contentViews.DataGridView.layout.columns;for(var n in r._visibleCustomAttributeColumns=[],o){var s=o[n];s.visibleFlag&&r._visibleCustomAttributeColumns.push(s.dataIndex)}}else r._visibleCustomAttributeColumns=[];r._options.modelEvents.publish({event:"xmodel-list-on-save-custom-view",data:r._visibleCustomAttributeColumns}),r._options.modelEvents.publish({event:"xmodel-list-on-custom-view-save",data:i})},r._contentViews[i].addEventListener("allCellsRendered",function(){let e=r._model.getSelectedNodes();if(0===e.length||e.length>1)return;let t=r._model.getSelectedNodes()[0].isExpanded();r._options.modelEvents.publish({event:"xmodel-list-item-node-expanded",data:{item:e,expanded:t}})});var b={contextualMenuType:{stdTemplate:"contextualMenuTemplate",semantics:{}},titleTweaker:{stdTemplate:"titleEditorTemplate",semantics:{}}};if(_.typeRepresentations&&e.is(_.typeRepresentations,"object")&&e.merge(b,_.typeRepresentations),r._typeRepresentationFactory=r._contentViews[i].getTypeRepresentationFactory(),r._typeRepresentationFactory.registerTypeTemplates({contextualMenuTemplate:{path:"DS/xPortfolioUXCommons/XModelListView/js/ContextualMenuTweaker"},titleEditorTemplate:{path:"DS/xPortfolioUXCommons/XModelListView/js/TitleTweaker"}}),r._typeRepresentationFactory.registerTypeRepresentations(b),t.editable){["postEdit"].forEach(function(e){r._contentViews[i].addEventListener(e,function(e,t){if(e.dsModel&&e.dsModel.layout&&t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.grid){var i=[t.nodeModel.options.grid],o=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);"description"===(o=o&&"tree"===o?"title":o)&&void 0!==t.nodeModel.options.description&&(i[0].description=t.nodeModel.options.description),void 0!==o&&""!==o&&"basePrice"!==o&&r._modelEvents.publish({event:"list-view-update-inline-action",data:{model:i,name:o,value:t.cellModel,cell:t}})}})})}r._contentViews[i]._applySortModelOrig=r._contentViews[i]._applySortModel,r._contentViews[i]._applySortModel=function(e){if(this._applySortModelOrig(e),!0===this._isCurrentlyCalledFromUIInteraction()){var t=this.sortModel&&this.sortModel.length>0?this.sortModel[0]:void 0;if(t){var i={sortOrder:t.sort?t.sort.toUpperCase():void 0,sortAttribute:t.dataIndex?t.dataIndex:void 0};r._modelEvents.publish({event:"enox-collection-toolbar-sort-activated",data:i})}}}}else{switch(i){case"TileView":r._contentViews[i]=new(n.inherit(p))(l);break;case"ThumbnailView":r._contentViews[i]=new(s.inherit(h))(l);break;case"LargeThumbnailView":r._contentViews[i]=new(a.inherit(p))(l)}"TileView"!==i&&"ThumbnailView"!==i&&"LargeThumbnailView"!==i||(r._contentViews[i].onContextualEvent=e.is(t.onContextualEvent)?e.is(t.onContextualEvent,"function")?{callback:t.onContextualEvent}:e.is(t.onContextualEvent.callback,"function")?t.onContextualEvent:c:c,r._contentViews[i].onPostCellRequest(v))}r.useDragAndDrop&&(r._contentViews[i].useDragAndDrop=r.useDragAndDrop,r._contentViews[i].onDragStartCell=function(t,i){var o=this.getTreeDocument().getSelectedNodes()?this.getTreeDocument().getSelectedNodes():[],n=o&&o.length>0?o:i.nodeModel;void 0!==r._options.setDragData&&e.is(r._options.setDragData,"function")?r._options.setDragData(t,n):r._setDragData(t,n),r._appendShadowTile(t,o,i)},r._contentViews[i].onDragEnterBlankDefault=function(){},r._contentViews[i].onDragEnterBlank=function(){},r._contentViews[i].onDragEndCell=function(){r._removeShadowTile()}),r._contentViews[i].addEventListener(d.POINTERHIT,function(t,i){if(i&&i.nodeModel&&i.nodeModel.options.id&&2===t.multipleHitCount){e.log("xmodel-list-item-on-dblclickPOINTERHIT");var o="";t&&t.dsModel&&t.dsModel.layout&&t.dsModel.layout.getDataIndexFromColumnIndex&&(o=t.dsModel.layout.getDataIndexFromColumnIndex(i.columnID)),"basePrice"!==o&&r._modelEvents.publish({event:"xmodel-list-item-on-dblclick",data:{model:i.nodeModel.options.grid},context:i.nodeModel})}}),r._contentViews[i].addEventListener("click",function(t,i){if(i&&i.nodeModel&&i.nodeModel.options.id){e.log("xmodel-list-item-on-click");var o=t.target.getAttribute("href");if(null!=o){var n=t.dsModel.layout.getDataIndexFromColumnIndex(i.columnID);r._modelEvents.publish({event:"xmodel-list-item-on-link-click",data:{model:i.nodeModel.options.grid,linkId:n||o}})}else r._modelEvents.publish({event:"xmodel-list-item-on-click",data:{model:i.nodeModel.options.grid,event:t},context:i.nodeModel})}})}),this._switchView(this._currentView,!0)},v.prototype._appendShadowTile=function(t,i,o){let n={picture:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.thumbnail,"function")?this._options.viewOptions.itemViewMapping.thumbnail.call(this,o.nodeModel):o.nodeModel.getAttributeValue("image"),icon:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.thumbnail,"function")?this._options.viewOptions.itemViewMapping.thumbnail.call(this,o.nodeModel):o.nodeModel.getAttributeValue("image"),title:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.label,"function")?this._options.viewOptions.itemViewMapping.label.call(this,o.nodeModel):o.nodeModel.getAttributeValue("title"),multipleTitleLineNumber:!1,subtitle:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.subLabel,"function")?this._options.viewOptions.itemViewMapping.subLabel.call(this,o.nodeModel):m._modified+": "+o.nodeModel.getAttributeValue("modified"),description:this._options&&this._options.viewOptions.itemViewMapping&&e.is(this._options.viewOptions.itemViewMapping.description,"function")?this._options.viewOptions.itemViewMapping.description.call(this,o.nodeModel):o.nodeModel.getAttributeValue("description")};if(this._img=new h(n),this._img.elements.container.addClassName("xmodel-shadow-img"),this._img.inject(document.body),i.length>=2){var s=e.createElement("div",{class:"xmodel-badge"});e.createElement("div",{class:"numberCircle",text:i.length}).inject(s),s.inject(this._img.elements.picture)}t.dataTransfer.setDragImage(this._img.getContent(),0,0)},v.prototype._removeShadowTile=function(){this._img.getContent().destroy()},v.prototype._getSelectedItem=function(){return this._model.getXSO().get().map(function(e){return e.options.grid})},v.prototype._switchView=function(t,i){var o=this._contentViews[t];o&&(this._currentView=t,e.extendElement(this._listContainer).setContent(o.getContent()),"DataGridView"!==this._currentView?this._modelEvents.publish({event:"xmodel-list-toolbar-group-visibility",data:!1}):this._modelEvents.publish({event:"xmodel-list-toolbar-group-visibility",data:!0})),i&&this._modelEvents.publish({event:"xmodel-list-toolbar-update-switch-view",data:t})},v.prototype.inject=function(e){e.appendChild(this._container);var t=this;r.addResizeListener(this._container,function(){if(t._container.offsetWidth){var e=t._getPreferedView();"ThumbnailView"===e&&t._contentViews.ThumbnailView&&(t._container.offsetWidth<t.MOBILE_BREAKPOINT?t._contentViews.ThumbnailView.displayedOptionalCellProperties=["contextualMenu"]:t._contentViews.ThumbnailView.displayedOptionalCellProperties=t._displayProperties,t._contentViews.ThumbnailView.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})),e!==t._currentView&&(t._groupedRows.length>0?(t._modelEvents.publish({event:"xmodel-list-view-group-by-action",data:[]}),setTimeout(function(){t._switchView(e)},500)):t._switchView(e,!0))}})},v.prototype.getTypeRepresentationFactory=function(){return this._typeRepresentationFactory},v.prototype._initExtensions_v1=function(t){var i={id:this._id,model:this._model,modelEvents:this._modelEvents,useAsyncExpand:this._useAsyncExpand,filterAttributes:this._filterAttributes,keepSelectionOnHide:!(!this._options.toolbarOptions||!this._options.toolbarOptions.keepSelectionOnHide)&&this._options.toolbarOptions.keepSelectionOnHide,childKeys:this._options.childKeys?this._options.childKeys:[],defaultNodeDepth:this._options.defaultNodeDepth?this._options.defaultNodeDepth:void 0},o=this;o._extensions=[];var n=[],s=[];t&&t instanceof Array&&t.length>0&&t.forEach(function(t){switch(e.typeOf(t)){case"string":n.push(new e.Promise(function(e,i){require([t],function(t){e(t)},function(e){i("Error loading modules."+(e&&e.requireModules?e:""))})}));break;case"class":s.push(t)}}),e.log("[xModelListView:_initExtensions_v1] No. of Extension to initialize: "+s.length+" to resolve:  "+n.length),s.forEach(function(e){var t=new e;t.initialize(i),o._extensions.push(t)}),n.length>0&&e.Promise.all(n).then(function(e){e.forEach(function(e){var t=new e;o._extensions.push(t)}),o._extensions.forEach(function(e){e.initialize(i)})})},v.prototype._initExtensions=function(t){var i={id:this._id,model:this._model,modelEvents:this._modelEvents},o=this;o._extensions=[],function(t){var i=t.map(function(t){switch(e.typeOf(t)){case"string":return new e.Promise(function(e,i){require([t],function(t){e(t)},function(e){i("Error loading modules."+(e&&e.requireModules?e:""))})});case"class":return e.Promise.resolve(t)}});return e.Promise.all(i)}(t).then(function(e){e.forEach(function(e){var t=new e;o._extensions.push(t)}),o._extensions.forEach(function(e){e.initialize(i)})})},v.prototype.filter=function(e){if(e.id){this._filters[e.id]=e.content||{};var t=e.content;t.ids&&(this._model.prepareUpdate(),this._model.search({match:function(e){return-1!==t.ids.indexOf(e.nodeModel.options.id)?(e.nodeModel.matchSearch(),!0):(e.nodeModel.unmatchSearch(),!1)}}),this._model.pushUpdate())}},v.prototype._onDataUpdate=function(){if(0===this._groupedRows.length){var e=0,t=this._model.getChildren();if(t)e=t.filter(function(e){return e.isVisible()}).length;this._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:e})}},v.prototype._getContextualMenu=function(t){let i=this;var o=[];let n=i._getSelectedItem().length>1;var s=function(o,a){var l={id:a.id,type:a.type?a.type:"PushItem",title:a.title?a.title:a.text,state:a.state?a.state:"enabled"};if(!0===t.options.disableMenu&&(l.state="disabled"),void 0!==a.multiselect&&n&&!a.multiselect&&(l.state="disabled"),a.handler&&(l.action={callback:function(){e.is(a.handler,"function")&&a.handler.call(t,t.options.grid,i._getSelectedItem())}}),a.fonticon&&(l.icon=a.fonticon),a.content){var r=a.content;l.submenu=[],r.reduce(s,l.submenu)}return o.push(l),o};if(this._options.viewOptions.contextualActions&&t&&t.options.id){var a=this._options.viewOptions.contextualActions;e.is(this._options.viewOptions.contextualActions,"function")&&(a=this._options.viewOptions.contextualActions.call(t)),o=a.reduce(s,[])}return o},v.prototype.destroy=function(){this._extensions.forEach(function(e){e.destroy()})},v.prototype.isGrouped=function(){return this._groupedRows&&this._groupedRows.length>0},v.prototype._showListViewSelected=function(e){let t=this;e?t._container.classList.add("xmodel-list-view-set-context"):t._container.classList.remove("xmodel-list-view-set-context")},v.prototype.updateTagFocus=function(){var e=this._model.getXSO().get();window.widget&&"maximized"!==window.widget.getView().type||0===e.length?this._modelEvents.publish({event:"xmodel-list-tagger-unfocus-action"}):window.widget&&"maximized"===window.widget.getView().type&&e&&e.length>0&&this._modelEvents.publish({event:"xmodel-list-tagger-focus-action",data:e})},v.prototype.refresh=function(){var e=this._contentViews.DataGridView;e&&e.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}),"DataGridView"!==this._currentView&&this._contentViews[this._currentView].invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})},v}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemCollection",["UWA/Class/Collection","DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemModel"],function(e,t){"use strict";return e.extend({model:t})}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/WrappedAdvSetView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/ENOXAdvancedSetView/js/ActionsToolbar","DS/ENOXAdvancedSetView/js/ENOXAdvancedSetView","DS/ENOXAdvancedSetView/js/GridScrollView","DS/W3DXComponents/Views/Item/TileView","DS/CoreEvents/ModelEvents","DS/DataDragAndDrop/DataDragAndDrop","DS/xPortfolioUXCommons/WrappedAdvSetView/js/ItemModel","DS/Handlebars/Handlebars","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBar","DS/PlatformAPI/PlatformAPI","i18n!DS/xPortfolioUXCommons/assets/nls/WrappedAdvSetView","css!DS/xPortfolioUXCommons/WrappedAdvSetView/css/WrappedAdvSetView.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,h,m){"use strict";var v=[],_=function(){};return _.prototype.init=function(e,t){this._options=t,this._options.enableRefresh=!0,this._parentUpdateChannel=e,this._bridgeModelEvent=new l,this._selectionCount=0,this._initDivs(),this._initSubViews(),this._subscribeToEvents(),this.__pendingClick=0,this.__clearTimeout=0,this._listSelectedIds=[],this._listSelectedObjects=[]},_.prototype._initDivs=function(){var t=this;if(this._container=document.createElement("div"),this._container.classList.add("wrapped-set-view-main-container"),this._titleDiv=document.createElement("div",{id:"titleContainerDiv"}),this._options.showTitle&&(this._titleDiv.classList.add("wrapped-set-view-title-container"),this._container.appendChild(this._titleDiv),this._titleSpan=document.createElement("span"),this._titleSpan.classList.add("wrapped-set-view-title-span"),this._titleSpan.innerHTML=this._options.viewTitle?this._options.viewTitle:"",this._titleDiv.appendChild(this._titleSpan)),this._stdActionbarContainer=e.createElement("div",{id:"filterContainerDiv"}),this._stdActionbarContainer.addClassName("wrapped-set-view-filter-container"),this._advSetViewContainer=e.createElement("div"),this._advSetViewContainer.classList.add("wrapped-set-view-set-container"),this._options.isDroppable){var i=h.MSG_DROP_TO_CREATE_NEW_VALUE?h.MSG_DROP_TO_CREATE_NEW_VALUE:"Drop here to create new Value";this._options.dropMessage&&(i=this._options.dropMessage);var o=e.createElement("div",{styles:{margin:"auto"},html:[{tag:"span",class:"fonticon fonticon-plus",styles:{textAlign:"center",width:"100%",fontSize:"35px"}},{tag:"div",html:i,styles:{textAlign:"center",width:"100%",fontSize:"20px"}}]}),n=e.createElement("div",{styles:{width:"100%",height:"100%",position:"absolute",top:0,border:"5px #368ec4",borderStyle:"dashed",borderRadius:"5px",display:"flex",color:"#368ec4",backgroundColor:"#f6f3f3",opacity:".5"},html:o});r.droppable(this._advSetViewContainer,{over:function(e,i){var o=t._advSetViewContainer.getBoundingClientRect();if(i.x-10>o.left&&i.x+10<o.right&&i.y-10>o.top&&i.y+10<o.bottom){var s=t._advSetViewContainer.offsetTop;return s&&n.getStyle("top")!==s+"px"&&n.setStyles({top:s+"px",height:"calc( 100% - "+s+"px )"}),n.isInjected(t._advSetViewContainer)||n.inject(t._advSetViewContainer),!0}return n.remove(),!1},enter:function(){},leave:function(e,i){var o=t._advSetViewContainer.getBoundingClientRect();(i.x-10<o.left||i.x+10>o.right||i.y-10<o.top||i.y+10>o.bottom)&&n.remove()},drop:function(e,i,o){n.remove();var s=o.dataTransfer.items;t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-drop-event",data:s})}})}this._container.appendChild(this._stdActionbarContainer),this._container.appendChild(this._advSetViewContainer)},_.prototype._initSubViews=function(){var e=this;this._stdActionbar=new u(this._getCollectionToolbarOptions()),this._advSetView=new n(this._getSetViewOptions()),this._advSetView.render().inject(this._advSetViewContainer),this._stdActionbar.inject(this._stdActionbarContainer),this._stdActionbar._modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(t){e._bridgeModelEvent.publish({event:"advanced-set-view-sort",data:[{id:t.sortAttribute,desc:"DESC"===t.sortOrder}]})}),this._stdActionbar._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(t){e._bridgeModelEvent.publish({event:"advanced-set-view-switch",data:{id:t}})}),this._hideDefActionbar(),v.push(this._stdActionbar)},_.prototype._subscribeToEvents=function(){var t=this;this._options.enableRefresh&&p.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(i){e.log("Events from PlatformAPI"),(i&&i.data&&i.data.authored&&i.data.authored.modified?i.data.authored.modified:[]).forEach(function(i){i&&(t._options.collection.get(i)?t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-refresh-item",data:i}):e.log("This WrappedAdvSetView instance's collection does not have this id!!!"))})}),this._advSetView.listenTo(this._advSetView,{onItemViewClick:function(){e.log("On ItemView click");var i=arguments&&arguments.length>=3?arguments[2].model.id:null,o=arguments&&arguments.length>=3?arguments[2].model._attributes.name:null,n=arguments&&arguments.length>=3?arguments[2].model._attributes.version:null;t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-item-click",data:{id:i,name:o,version:n}})}}),this._advSetView.listenTo(this._advSetView,{onItemViewDblClick:function(){e.log("onItemViewDblClick");var i=arguments&&arguments.length>=3?arguments[2].model.id:null,o=arguments&&arguments.length>=3?arguments[2].model._attributes.name:null,n=arguments&&arguments.length>=3?arguments[2].model._attributes.version:null,s={};arguments.length>=3&&(s=arguments[2].model.toJSON(),arguments[2].unSelect({silent:!0})),e.merge(s,{id:i,name:o,version:n}),t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-item-dbl-click",data:s})}}),this._bridgeModelEvent.subscribe({event:"advanced-set-view-filtered"},function(){var e=t._advSetView.filteredCollection?t._advSetView.filteredCollection.length:0;t._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:e})}),this._parentUpdateChannel.subscribe({event:"wrapped-adv-set-view-resize"},function(e){for(var t,i=0;i<this.length;i++)if(this[i]._container.offsetWidth>0){t=this[i];break}t&&t._resize(),e&&"function"==typeof e&&e()}.bind(v)),this._parentUpdateChannel.subscribe({event:"wrapped-adv-set-view-fetch-selection-count"},function(e){e&&"function"==typeof e&&e(t._selectionCount)}),this._parentUpdateChannel.subscribe({event:"wrapped-adv-set-view-filter"},function(e){t._bridgeModelEvent.publish({event:"advanced-set-view-filter",data:e})}),this._bridgeModelEvent.subscribe({event:"advanced-set-view-filtered"},function(e){t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filtered",data:e})})},_.prototype.getSelectedIds=function(){return this._listSelectedIds},_.prototype.getSelectedObjects=function(){return this._listSelectedObjects},_.prototype.inject=function(e){e.appendChild(this._container)},_.prototype.getContent=function(){return this._container},_.prototype.destroy=function(){this._container&&this._container.parentElement&&this._container.parentElement.removeChild(this._container)},_.prototype._hideDefActionbar=function(){var e=this._container.getElementsByClassName("advanced-set-view-header set-header");e.length>0&&e[0].style.setProperty("display","none")},_.prototype._setReferenceCollection=function(e){this._advSetView.currentViewId&&this._advSetView.contentsViews&&this._advSetView.contentsViews[this._advSetView.currentViewId].nestedView&&this._advSetView.contentsViews[this._advSetView.currentViewId].nestedView.deactivateMultisel(),this._advSetView.collection.set(e.toArray()),this._advSetView._referenceCollection=e.clone();var t=this._advSetView.collection?this._advSetView.collection.length:0;this._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:t})},_.prototype._getSetViewOptions=function(){var t=this,i=e.clone(t._options.itemViewMapping||{});e.merge(i,{title:"title",content:"description",image:"image"});var n=t._options.filters?t._options.filters:[];return{collection:t._options.collection,lazyRender:!0,contents:{selectionMode:"nullToMany",useInfiniteScroll:!1,views:[{id:"tile",title:h.TILE?h.TILE:"Tile",view:s,itemView:a},{id:"thumbnail",title:h.THUMBNAIL?h.THUMBNAIL:"Thumbnail",view:s}],itemViewOptions:{mapping:i,attributes:{draggable:!0},contextualActions:t._options.contextualActions?t._options.contextualActions:[]},events:{onItemViewDrag:function(e,t,i){if(t&&t.model){var o=t.model.toJSON(),n={envId:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",serviceId:"3DSpace",contextId:"",objectId:o.id,objectType:"Hardware Product",displayName:o.name,displayType:"Hardware Product"},s={protocol:"3DXContent",version:"1.1",source:"xModelApp",widgetId:widget.id,data:{items:[n]}};i.dataTransfer.setData("Text",JSON.stringify(s))}},onAddSelection:function(){t.__pendingClick+=1,t.__pendingClick>=2&&clearTimeout(t.__clearTimeout);var i=arguments;t.__clearTimeout=setTimeout(function(){if(t.__pendingClick>=2)t.__pendingClick=0;else if(i&&i.length<2)e.log("Wrapped Adv Set view: Problem with received arguments!!!");else{var o=i[0].getSelection();t.__updateSelectedIdsAndObjectsList(o),t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-selection-on-add",data:{parentView:i[0],itemView:i[1],unselectedId:i[1].id,selectedObject:{id:i[1].id,attributes:i[1].attributes?i[1].attributes:i[1]._attributes?i[1]._attributes:[]},selectionCount:t._selectionCount,selectedIds:t._listSelectedIds,selectedObjects:t._listSelectedObjects}}),t.__pendingClick=0}},500)},onRemoveSelection:function(){if(arguments&&arguments.length<2)e.log("Wrapped Adv Set view: Problem with received arguments!!!");else{var i=arguments[0].getSelection();t.__updateSelectedIdsAndObjectsList(i),e.log("Wrapped Adv Set view: Item view onRemoveSelection: selection count: "+t._selectionCount),t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-selection-on-remove",data:{parentView:arguments[0],itemView:arguments[1],unselectedObject:{id:arguments[1].id,attributes:arguments[1].attributes?arguments[1].attributes:arguments[1]._attributes?arguments[1]._attributes:[]},unselectedId:arguments[1].id,selectionCount:t._selectionCount,allSelectedIds:t._listSelectedIds,allSelectedObjects:t._listSelectedObjects}})}},onDeactivateMultisel:function(){t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-selection-on-remove-all",data:arguments[1]});var e=arguments[0].getSelection();t.__updateSelectedIdsAndObjectsList(e)}}},events:{onInfiniteScroll:function(t){var i=t.collection,o={type:"json",onComplete:function(){t.scrollView.endLoading()}};null===i.state.totalRecords?i.getFirstPage(o):i.hasNextPage()?i.getNextPage(e.extend(o,{remove:!1,reset:!1})):(t.container.removeClassName("loading"),t.scrollView.useInfiniteScroll(!1))}},actions:{view:o,collection:function(){var e=[];return e.push({id:"filterby",title:"Filter By",overflow:!1,type:"filter",multiSelect:!0,key:[{name:"type",value:"Part",label:""},{name:"type",value:"Model",label:"Only models"}]}),e.push({id:"sortby",title:"Sort By",overflow:!1,type:"sort",key:[{name:"name",label:""},{name:"description",label:"Description"},{name:"type",label:"Type"},{}]}),e},modelEvents:t._bridgeModelEvent,events:{onActionClick:function(){e.log("action clicked")}}},buildMultiselActions:function(){var t=[];return t.push({id:"delete",multisel:!0,text:"Remove",fonticon:"trash",handler:function(){e.log("delete")}}),t},modelEvents:t._bridgeModelEvent,filters:n}},_.prototype._getCollectionToolbarOptions=function(){var t=this._options.actionBarOptions?this._options.actionBarOptions:{};return e.merge(t,{withmultisel:!1,showItemCount:!0,filter:{},actions:[],sort:[{id:"name",text:"Name",type:"string"}],views:[{id:"tile",text:h.TILE?h.TILE:"Tile",fonticon:"view-small-tile"},{id:"thumbnail",text:h.THUMBNAIL?h.THUMBNAIL:"Thumbnail",fonticon:"view-small-thb"}]}),t},_.prototype._getSorter=function(e){return function(t,i){return t._attributes[e]&&i._attributes[e]&&t._attributes[e]>i._attributes[e]?1:-1}},_.prototype._addSortersInAdvSetView=function(){this._advSetView.addCustomSorter("version",this._getSorter("version")),this._advSetView.addCustomSorter("id",this._getSorter("id")),this._advSetView.addCustomSorter("name",this._getSorter("name")),this._advSetView.addCustomSorter("type",this._getSorter("type"))},_.prototype.addItem=function(t,o){if(o){var n=this,s=n._advSetView.currentViewId,a=n._advSetView.contentsViews[s],l=!!a&&n._advSetView.contentsViews[s].nestedView;l&&l.listenToOnce(l,"onAfterItemAdded",function(e){this.deactivateMultisel(),this.addSelection(e.model),n._advSetView.scrollToItemView(e.model,{view:a})})}if(t instanceof i)this._advSetView.collection.add(t),this._advSetView._referenceCollection.add(t),this._options.collection.add(t);else if(e.is(t,"object")){var r=new d(t);this._advSetView.collection.add(r),this._advSetView._referenceCollection.add(r),this._options.collection.add(r)}var c=this._advSetView.collection?this._advSetView.collection.length:0;this._stdActionbar._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:c})},_.prototype.__updateSelectedIdsAndObjectsList=function(t){var i=this;this._listSelectedIds=[],this._listSelectedObjects=[],t&&t.length>0?(t.forEach(function(e){e&&e.id&&(i._listSelectedIds.push(e.id),i._listSelectedObjects.push({id:e.id,attributes:e.attributes?e.attributes:e._attributes?e._attributes:[]}))}),this._selectionCount=t.length):this._selectionCount=0,e.log("Wrapped Adv set view:__updateSelectedIdsAndObjectsList: Selection count: "+this._selectionCount)},_}),define("DS/xPortfolioUXCommons/WrappedAdvSetView/js/WrappedAdvSetViewWithFilters",["DS/xPortfolioUXCommons/WrappedAdvSetView/js/WrappedAdvSetView","DS/WildcardSearchComponent/WildcardSearchComponent","DS/TaggerOnIndexComponent/TaggerOnIndexComponent"],function(e,t,i){"use strict";var o=function(){this.WrappedAdvSetView=new e};return o.prototype.init=function(e,o,n){this.tagFriends=n.tagFriends,this._CSearch=[],this._idProxy=e;var s=this;n.filters=n.filters?n.filters:[],n.filters.push({id:"tagFilter",callback:function(e,t){var i=!0,o=s.getTagProxy(s._idProxy);return e.WrappedAdvSetViewFilters||(e.WrappedAdvSetViewFilters={}),e.collection&&e.collection._models&&e.collection._models[t]?-1===o.filteredSubjectList.indexOf(e.collection._models[t].id)?e.WrappedAdvSetViewFilters.WASVFTagger=!1:e.WrappedAdvSetViewFilters.WASVFTagger=!0:-1===o.filteredSubjectList.indexOf(e.id)?e.WrappedAdvSetViewFilters.WASVFTagger=!1:e.WrappedAdvSetViewFilters.WASVFTagger=!0,Object.keys(e.WrappedAdvSetViewFilters).forEach(function(t){!1===e.WrappedAdvSetViewFilters[t]&&(i=!1)}),i}}),n.filters.push({id:"ContextSearchFilter",callback:function(e,t){for(var i=!0,o=[],n=0;n<s._CSearch.length;n++)o.push(s._CSearch[n].id);return e.WrappedAdvSetViewFilters||(e.WrappedAdvSetViewFilters={}),e.collection&&e.collection._models&&e.collection._models[t]?-1===o.indexOf(e.collection._models[t].id)?e.WrappedAdvSetViewFilters.WASVFCSearch=!1:e.WrappedAdvSetViewFilters.WASVFCSearch=!0:-1===o.indexOf(e.id)?e.WrappedAdvSetViewFilters.WASVFCSearch=!1:e.WrappedAdvSetViewFilters.WASVFCSearch=!0,Object.keys(e.WrappedAdvSetViewFilters).forEach(function(t){!1===e.WrappedAdvSetViewFilters[t]&&(i=!1)}),i}}),n.filters.push({id:"GlobalSearchFilter",callback:function(e,t){for(var i=!0,o=[],n=0;n<s._GSearch.length;n++)o.push(s._GSearch[n].id);return e.WrappedAdvSetViewFilters||(e.WrappedAdvSetViewFilters={}),e.collection&&e.collection._models&&e.collection._models[t]?-1===o.indexOf(e.collection._models[t].id)?e.WrappedAdvSetViewFilters.WASVFGSearch=!1:e.WrappedAdvSetViewFilters.WASVFGSearch=!0:-1===o.indexOf(e.id)?e.WrappedAdvSetViewFilters.WASVFGSearch=!1:e.WrappedAdvSetViewFilters.WASVFGSearch=!0,Object.keys(e.WrappedAdvSetViewFilters).forEach(function(t){!1===e.WrappedAdvSetViewFilters[t]&&(i=!1)}),i}}),this._options=n,this._parentUpdateChannel=o,this._TaggerOnIndexComponent=i,this.WrappedAdvSetView.init(o,n),this.WildcardSearch=new t,this._subscribeToEvents()},o.prototype._initContextSearch=function(){var e=this,t=function(t){e._CSearch=t,e.WrappedAdvSetView._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filter",data:[{id:"ContextSearchFilter",exclude:!1}]})};this.WrappedAdvSetView._stdActionbar._modelEvents.subscribe({event:"enox-collection-toolbar-filter-search-value"},function(i){e.WildcardSearch.search(i.searchValue[0],e.WrappedAdvSetView._options.collection,t)})},o.prototype._initSearch=function(){var e=this,t=function(t){e._GSearch=t,e.WrappedAdvSetView._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filter",data:[{id:"GlobalSearchFilter",exclude:!1}]})};this.WrappedAdvSetView._options.applicationChannel&&this.WrappedAdvSetView._options.applicationChannel.subscribe({event:"search-in-current-dashboard"},function(i){e.WildcardSearch.search(i,e.WrappedAdvSetView._options.collection,t)})},o.prototype._initTagger=function(e){var t=this,i={onTagFilterChange:function(){t._parentUpdateChannel.publish({event:"wrapped-adv-set-view-filter",data:[{id:"tagFilter",exclude:!1}]})},MyFriends:this.tagFriends};t._TaggerOnIndexComponent.setTagProxy(t._idProxy,i,e)},o.prototype.getTagProxy=function(e){return this._TaggerOnIndexComponent.getTagProxy(e).getCurrentFilter()},o.prototype._initDivs=function(){this.WrappedAdvSetView._initDivs()},o.prototype._initSubViews=function(){this.WrappedAdvSetView._initSubViews()},o.prototype._subscribeToEvents=function(){this._initContextSearch(),this._initSearch()},o.prototype.inject=function(e){this.WrappedAdvSetView.inject(e)},o.prototype.getContent=function(){return this.WrappedAdvSetView.getContent()},o.prototype.destroy=function(){this.WrappedAdvSetView.destroy()},o.prototype._hideDefActionbar=function(){this.WrappedAdvSetView._hideDefActionbar()},o.prototype._setReferenceCollection=function(e){this.WrappedAdvSetView._setReferenceCollection(e);for(var t=[],i=0;i<e._models.length;i++)t.push(e._models[i].get("id"));void 0!==this._options.noPublishOnCreate&&this._options.noPublishOnCreate||this._initTagger(t)},o.prototype.publishTags=function(){for(var e=[],t=0;t<this.WrappedAdvSetView._advSetView._referenceCollection.length;t++)e.push(this.WrappedAdvSetView._advSetView._referenceCollection._models[t].get("id"));0===e.length?this.clearTags():this._initTagger(e)},o.prototype.clearTags=function(){this._TaggerOnIndexComponent.killTagProxy(this._idProxy)},o.prototype._getSetViewOptions=function(){return this.WrappedAdvSetView._getSetViewOptions()},o.prototype._getCollectionToolbarOptions=function(){return this.WrappedAdvSetView._getCollectionToolbarOptions()},o.prototype._getSorter=function(e){return this.WrappedAdvSetView._getSorter(e)},o.prototype._addSortersInAdvSetView=function(){this.WrappedAdvSetView._addSortersInAdvSetView()},o.prototype.addItem=function(e,t){this.WrappedAdvSetView.addItem(e,t)},o.prototype.getSelectedIds=function(){return this.WrappedAdvSetView.getSelectedIds()},o.prototype.getSelectedObjects=function(){return this.WrappedAdvSetView.getSelectedObjects()},o});