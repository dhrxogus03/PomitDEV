define("DS/CAT3DWPanoply/CAT3DWDropMenu",["UWA/Core","UWA/Promise","DS/UIKIT/Dropdown","DS/UIKIT/DropdownMenu","DS/CAT3DWInfraUI/CAT3DWPointerEvents"],function(t,n,e,i,o){"use strict";var s=t.Class.extend({init:function(n){this._callback=n.onClickCallback,this._isOpen=!1,this._hidden=!0,this._offset={x:0,y:0};var o=[],s={target:n.target,multiSelect:void 0!==n.multiSelect&&n.multiSelect,closeOnClick:void 0===n.closeOnClick||n.closeOnClick,className:n.className?n.className:"CAT3DWDropMenu",removeOnHide:!1,bound:!1};switch(this._target=n.target,this.menu=null,n.menuClassList&&(o=n.menuClassList),void 0!==n.offset&&(s.offset=n.offset),void 0!==n.renderTo&&(this._renderTo=n.renderTo,s.renderTo=n.renderTo),this._checkProportions=!0,!1===n.checkProportions&&(this._checkProportions=!1),void 0!==n.onUpdatePosition&&(this._onUpdatePositionCB=n.onUpdatePosition),s.events={},s.events.onClickOutside=this.hide.bind(this),void 0!==n.onClickCallback&&(s.events.onClick=n.onClickCallback),void 0!==n.onShowCallback&&(s.events.onShow=n.onShowCallback),n.arrowPosition){case"bottom":o.push("arrow-down");break;case"right":o.push("arrow-right");break;case"left":o.push("arrow-left");break;case"top":o.push("arrow-up")}if(void 0!==n.body)s.body=n.body,this.menu=new e(s),window.addEventListener("resize",this._debounce(this._onWindowResize,100).bind(this));else{s.items=[],this.menu=new i(s),s.items=n.items;for(let n=0;n<s.items.length;n++)if(s.items[n].name=s.items[n].id,s.items[n].icon&&s.items[n].icon.indexOf(".svg")>-1){let e=s.items[n].icon;s.items[n].icon="#",this.menu.addItem(s.items[n]);let i=this.menu.getItem(s.items[n].id);this._loadSVG(e,function(n,e){let i=n.elements.icon.parentElement,o=t.createElement("span");o.classList.add("item-icon"),n.elements.icon.remove(),n.elements.icon=o,i.prepend(o),n.elements.icon.setStyle("height","36px"),n.elements.icon.setStyle("padding","4px 7px"),n.elements.icon.setStyle("font-size","18px"),n.elements.icon.setStyle("fill","#77797C"),n.elements.icon.setStyle("margin","0 0.2em"),n.elements.icon.innerHTML=e}.bind(this,i))}else this.menu.addItem(s.items[n]);for(let t=0;t<s.items.length;t++){let n=function(t,n){t.elements.container.setAttribute("data-uid_po",n.id),n.hasOwnProperty("tooltip")&&n.tooltip&&t.elements.container.setAttribute("title",n.tooltip)};if(n(this.menu.getItem(s.items[t].id),s.items[t]),s.items[t].items)for(let e=0;e<s.items[t].items.length;e++){n(this.menu.getItem(s.items[t].items[e].id),s.items[t].items[e])}}}for(let t=0;t<o.length;t++)this.menu.elements.container.classList.add(o[t]);this._onUpdatePositionCB&&(this._nativeUpdatePosition=this.menu.updatePosition.bind(this.menu),this.menu.updatePosition=this._updatePosition.bind(this)),this._addClickOutsideListener(n.onClickOutsideCallback)},checkProportions:function(t){if(this._checkProportions){var n=this.menu.elements.container.getBoundingClientRect(),e=this.menu.elements.container.getDimensions(),i=this.menu.elements.container.getOffsets();if(this.menu.elements.container.setStyle("bottom","auto"),this.menu.elements.container.setStyle("right","auto"),n.top<0&&this.menu.elements.container.setStyle("top","5px"),e.outerHeight+i.y>(window.innerHeight||document.documentElement.clientHeight)&&(this.menu.elements.container.setStyle("top","auto"),this.menu.elements.container.setStyle("bottom","5px")),"left"===t)n.left;else e.outerWidth+i.x>(window.innerWidth||document.documentElement.clientWidth)&&(this.menu.elements.container.setStyle("left","auto"),this.menu.elements.container.setStyle("right","5px"))}},_updatePosition:function(t,n){this._nativeUpdatePosition(t,n),this._onUpdatePositionCB&&this._onUpdatePositionCB(this.menu)},_loadSVG:function(t,e){return new n(function(n){require([t],function(t){e(t),n(t)})})},setCallback:function(t){this.menu.events.onClick=t},show:function(){this.menu.show(),this.checkProportions()},hide:function(){this.menu.hide()},toggle:function(){this.menu.toggle(),this.checkProportions()},getHTMLElement:function(){return this.menu.getContent()},remove:function(){if(null!==this.menu&&null!==this.menu.body&&window.removeEventListener("resize",this._onWindowResize),this.menu.menus)for(let t=0;t<this.menu.menus.length;t++)this.menu.menus[t].remove();this.menu.remove()},onHide:function(t){this.menu.addEvent("onHide",function(){t&&t(this._lastClickEvent)}.bind(this))},_onWindowResize:function(){this.menu.isVisible&&(this.menu.updatePosition(),this.checkProportions())},_debounce:function(t,n,e){var i;return function(){var o,s=this,a=arguments;o=e&&!i,clearTimeout(i),i=setTimeout(function(){i=null,e||t.apply(s,a)},n),o&&t.apply(s,a)}},_addClickOutsideListener:function(t=null){document.addEventListener(o.POINTERDOWN,function(n){if(this._lastClickEvent=n,this.menu.isVisible&&!this.menu.getContent().contains(n.target)&&!this._target.contains(n.target)){let e=!1;if(this.menu.menus)for(let t=0;t<this.menu.menus.length;t++)this.menu.menus[t].getContent().contains(n.target)&&(e=!0);e||(t&&t(),this.hide())}}.bind(this))}});return t.namespace("DS/CAT3DWPanoply/CAT3DWDropMenu",s)}),define("DS/CAT3DWPanoply/CAT3DWButton",["UWA/Core","UWA/Promise"],function(t,n){"use strict";var e=t.Class.extend({init:function(n){this._callback=n.callback,this._svgLoadcallback=n.svgLoadcallback,this._name=n.name,this._container=new t.Element("div",{class:"CAT3DSKAction-container "+this._name,"data-uid_po":this._name}),n.tooltip&&this._container.setAttribute("title",n.tooltip)},loadSVG:function(t,e){return new n(function(n){require([t],function(t){e&&e(t),n(t)})})},addLabel:function(n){n&&""!=n&&(this._labelContainer?this.updateLabel(n):(this._labelContainer=new t.Element("div",{class:"CAT3DSKButton-label-container",text:n}).inject(this._container,"top"),this._container.hasClassName("hasLabel")||this._container.addClassName("hasLabel")))},updateLabel:function(t){this._labelContainer?t&&""!==t&&(this._labelContainer.innerHTML=t):this.addLabel(t)},onClick:function(t){this._callback(t)},toggleON:function(){},toggleOFF:function(){},setCallback:function(t){this._callback=t},setAvailability:function(t){t?(this._container.removeClassName("non-available"),this._container.hasClassName("available")||this._container.addClassName("available")):(this._container.removeClassName("available"),this._container.hasClassName("non-available")||this._container.addClassName("non-available"))},getAvailability:function(){return!!this._container.hasClassName("available")},getHTMLElement:function(){return this._container}});return t.namespace("DS/CAT3DWPanoply/CAT3DWButton",e)}),define("DS/CAT3DWPanoply/CAT3DWActionHelp",["UWA/Core","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/UIKIT/Alert","DS/UIKIT/SuperModal","i18n!DS/CAT3DWPanoply/assets/nls/CAT3DWActionHelp"],function(t,n,e,i,o,s){"use strict";var a=t.Class.extend({init:function(n){this._banner=new t.Element("div",{class:"CAT3DWHelp-banner "+n.name}),this._icon=n.icon,this._cmd=n.cmd,this._key=null,this._alert=null,this._message=null,this._tip=null,this._title=null,this._text1=null,this._text2=null,this._gif=null,this._superModal=null,this._viewContainer=null,this._hasBeenClosed={}},show:function(){if(this._message&&!this._alert&&n.getPreferenceValue("help")&&!this._hasBeenClosed[this._key]){this._alert=new i({visible:!0,fullWidth:!1,autoHide:!1,closable:!0,closeOnClick:!1,maximumVisibleMessages:1,events:{onRemoveMessage:function(){this._onRemoveMessage()}.bind(this)}}).inject(this._banner),(this._tip||this._text1||this._text2||this._gif)&&(this._superModal=new o({className:"CAT3DWHelp-modal"}));var t="",a="";this._superModal&&(t='<span class="more-text">'+s.get("moreLabel")+"</span>",a="has-modal");var l='<span class="title">'+this._title+"</span>"+'<span class="divider"></span><span class="message">'+this._message+t+"</span>";l+=t,this._alert.add({className:"alert-help",message:'<div class="message-container '+a+'">'+l+"</div>"}),this._superModal&&this._alert.getContent().addEvent(e.POINTERHIT,function(t){this._openModal(t)}.bind(this));var h=this._cmd.getView(),r=this._cmd.getPanoply();h?this._viewContainer=h.getViewContainer():r&&(this._viewContainer=r.getViewContainer()),this._viewContainer&&this._viewContainer.addClassName("has-help")}},hide:function(){this._alert&&(this._viewContainer&&(this._viewContainer.removeClassName("has-help"),this._viewContainer=null),this._alert.destroy(),this._alert=null,this._superModal&&this._superModal.destroy(),this._superModal=null)},isVisible:function(){return!!this._alert},reset:function(){this._hasBeenClosed={}},_openModal:function(t){if(this._superModal&&!t.target.classList.contains("close")){var n="";n+='<div class="helpmodal-textcontent">',this._message&&(n+='<div class="helpmodal-message">'+this._message+"</div>"),this._text1&&(n+='<div class="helpmodal-text1">'+this._text1+"</div>"),this._text2&&(n+='<div class="helpmodal-text2">'+this._text2+"</div>"),n+="</div>",n+='<div class="helpmodal-mediacontent">',this._gif&&(n+=this._gif.outerHTML),n+="</div>",n+='<div class="helpmodal-textcontent">',this._tip&&(n+='<div class="helpmodal-tip"><u>'+s.get("tipLabel")+":</u> "+this._tip+"</div>"),n+="</div>",this._superModal.dialog({body:n,title:this._title,buttons:[{className:"primary",value:s.get("modal.labelButton"),action:function(t){t.hide()}}]})}},_onRemoveMessage:function(){this._hasBeenClosed[this._key]=!0,this._viewContainer.removeClassName("has-help"),this._viewContainer=null},setHelp:function(t){this._key=t.key,this._message=t.message,this._tip=t.tip,this._title=t.title?t.title:s.get("defaultTitle"),this._text1=t.text1,this._text2=t.text2,this._gif=null,t.gif&&(this._gif=new Image,this._gif.onerror=function(t){console.error("Failed to load gif")},this._gif.src=t.gif,this._gif.className="helpmodal-gif",this._gif.alt=this._title)},getHTMLElement:function(){return this._banner}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionHelp",a)}),define("DS/CAT3DWPanoply/CAT3DWView",["UWA/Core","DS/ApplicationFrame/FrameWindowsManager"],function(t,n){"use strict";var e=t.Class.extend({init:function(e){this._frmWindow=n.getFrameWindow(),this._webGLV6Viewer=this._frmWindow.getViewer(),this._viewpoint=this._frmWindow.getViewpoint(),this._uiFrame=this._frmWindow.getUIFrame(),this._buttonsArray=[],this._ViewContainer=new t.Element("div",{class:"CAT3DSKPanoplyViewContainer"}),e&&e.id&&this._ViewContainer.addClassName(e.id),this._OptionsLContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-OptionsLeftContainer"}).inject(this._ViewContainer),this._ActionsContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-ActionsContainer"}).inject(this._ViewContainer),this._OptionsRContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-OptionsRightContainer"}).inject(this._ViewContainer),this._HelpContainer=new t.Element("div",{class:"CAT3DWView-HelpContainer"}).inject(this._ViewContainer),this._SelectionMenuContainer=new t.Element("div",{class:"CAT3DWView-SelectionMenuContainer"}).inject(this._ViewContainer),this._MultiSelectionMenuContainer=new t.Element("div",{class:"CAT3DWView-SelectionMenuContainer",id:"CAT3DWView-MultiSelectionMenuContainer"}).inject(this._ViewContainer),e&&e.mobileActionContainer&&(this._MobileActionsContainer=new t.Element("div",{class:"CAT3DSKPanoplyView-MobileActionsContainer"}).inject(this._ViewContainer))},setHand:function(t){t&&!this._ActionsContainer.hasClassName("left-hand")?this._ViewContainer.addClassName("left-hand"):this._ViewContainer.removeClassName("left-hand")},update:function(){},show:function(){this._ViewContainer.inject(this._uiFrame,"top")},hide:function(){this._ViewContainer.remove()},getViewContainer:function(){return this._ViewContainer},getActionsContainer:function(){return this._ActionsContainer},getMobileActionsContainer:function(){return this._MobileActionsContainer},getSelectionMenuContainer:function(){return this._SelectionMenuContainer},getMultiSelectionMenuContainer:function(){return this._MultiSelectionMenuContainer},getOptionsLContainer:function(){return this._OptionsLContainer},getOptionsRContainer:function(){return this._OptionsRContainer},getHelpContainer:function(){return this._HelpContainer},isLeftPanelEnabled:function(){return!0}});return t.namespace("DS/CAT3DWPanoply/CAT3DWView",e)}),define("DS/CAT3DWPanoply/CAT3DWActionButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/CAT3DWInfra/CAT3DWFileServices"],function(t,n,e,i){"use strict";var o=t.extend({init:function(t){(this._parent(t),this._icon=t.icon,this._needCheck=t.needCheck,this._button=new n.Element("div",{class:"CAT3DSKButton-container"}).inject(this.getHTMLElement()),this._button.addEvent(e.POINTERHIT,this.onClick.bind(this,this._name)),t.tooltip&&(this.getHTMLElement().removeAttribute("title"),this._button.setAttribute("title",t.tooltip)),this._iconContainer=new n.Element("span",{class:"CAT3DSKButton-icon"}).inject(this._button),this._icon.indexOf(".")>-1)?"png"==(new i).extractExtensionFromName(this._icon)?(this._iconContainer.style.backgroundImage="url("+this._icon+")",this._iconContainer.style.backgroundRepeat="no-repeat",this._iconContainer.style.backgroundSize="contain",this._iconContainer.style.height="70%",this._iconContainer.style.width="70%"):this.loadSVG(this._icon,function(t){this._button.innerHTML=t}.bind(this)):this._iconContainer.addClassName(this._icon);this._needCheck||this.activate(),this.setAvailability(!0)},onClick:function(t,n){n.preventDefault&&n.preventDefault(),this._activated&&(n.buttonType="CAT3DWActionButton",this._parent(n))},addLabel:function(t){if(t&&""!=t)if(this._labelContainer)this.updateLabel(t);else{var e=this.getHTMLElement();this._labelContainer=new n.Element("div",{class:"CAT3DSKButton-label-container",text:t}).inject(e,"top"),e.hasClassName("hasLabel")||e.addClassName("hasLabel")}},updateLabel:function(t){this._labelContainer?t&&""!=t&&(this._labelContainer.innerHTML=t):this.addLabel(t)},removeLabel:function(){this.getHTMLElement().removeClassName("hasLabel"),this._labelContainer&&this._labelContainer.destroy()},activate:function(){this._button.hasClassName("cmd-activate")||this._button.addClassName("cmd-activate"),this._activated=!0},deactivate:function(){this._button.removeClassName("cmd-activate"),this._activated=!1},setIcon:function(t){t.indexOf(".")>-1?this.loadSVG(t,function(t){this._button.innerHTML=t}.bind(this)):(this._iconContainer.removeClassName(this._icon),this._iconContainer.addClassName(t),this._icon=t)},getButtonElement:function(){return this._button}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionButton",o)}),define("DS/CAT3DWPanoply/CAT3DWActionView",["UWA/Core","DS/CAT3DWPanoply/CAT3DWView","DS/CAT3DWPanoply/CAT3DWActionButton","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip"],function(t,n,e,i){"use strict";var o=n.extend({init:function(n){this._parent({id:"CAT3DWActionView"}),this._id=n.id,this._validateCallback=n.onValidate,this._cancelCallback=n.onCancel;var o=n.help;this._isLeftPanelEnabled=!1,this._isRightPanelEnabled=!1,this._fallbackPanoply=null,n.fallbackPanoply&&(this._fallbackPanoply=n.fallbackPanoply),this._cancelButton=new e({name:"CAT3DWActionView-cancelButton "+this._id,icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong",callback:this._cancelCallback,tooltip:i.get("cancelActionButton")}),this._cancelButton.getHTMLElement().inject(this._OptionsRContainer),this._subActionsContainer=new t.Element("div",{class:"CAT3DWActionView-subActionsContainer"}).inject(this._ActionsContainer),this._validateButton=new e({name:"CAT3DWActionView-validateButton "+this._id,icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check",callback:this._validateCallback,tooltip:i.get("validateActionButton")}),this._validateButton.getHTMLElement().inject(this._OptionsRContainer),o&&(o.getHTMLElement().inject(this._HelpContainer),this.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply")),this.hide()},setRightOptions:function(t){this._OptionsRContainer.empty();for(var n=0;n<t.length;n++)t[n].button.getHTMLElement().inject(this._OptionsRContainer);this._cancelButton.getHTMLElement().inject(this._OptionsRContainer),this._validateButton.getHTMLElement().inject(this._OptionsRContainer)},setLeftOptions:function(t){this._OptionsLContainer.empty();for(var n=0;n<t.length;n++)t[n].button.getHTMLElement().inject(this._OptionsLContainer)},setActions:function(t){this._subActionsContainer.empty();for(var n=0;n<t.length;n++)t[n].inject(this._subActionsContainer)},isLeftPanelEnabled:function(){return this._isLeftPanelEnabled},isRightPanelEnabled:function(){return this._isRightPanelEnabled},getFallbackPanoply:function(){return this._fallbackPanoply}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionView",o)}),define("DS/CAT3DWPanoply/CAT3DWActionToggleButton",["DS/CAT3DWPanoply/CAT3DWActionButton","UWA/Core"],function(t,n){"use strict";var e=t.extend({init:function(t){this._parent(t),t.isOn?this.toggleON():this.toggleOFF()},toggleON:function(){this._parent(),this.getHTMLElement().addClassName("active")||this.getHTMLElement().addClassName("active"),this._isOn=!0},toggleOFF:function(){this._parent(),this.getHTMLElement().removeClassName("active"),this._isOn=!1},isOn:function(){return this._isOn}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionToggleButton",e)}),define("DS/CAT3DWPanoply/CAT3DWActionSubButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core","DS/CAT3DWInfraUI/CAT3DWPointerEvents"],function(t,n,e){"use strict";var i=n.Class.extend({init:function(t){this._parent(t),this._callback=t.callback,this._name=t.name,this._icon=t.icon,this._needCheck=t.needCheck,this._availability=!0,this._button=new n.Element("li",{class:"item CAT3DWActionSubButton-container",id:this._name,"data-uid_po":t.name}),this._button.addEvent(e.POINTERHIT,this.onClick.bind(this,this._name)),t.tooltip&&(this.getHTMLElement().removeAttribute("title"),this._button.setAttribute("title",t.tooltip)),this.setIcon(this._icon),this._textContainer=new n.Element("span",{class:"item-text",text:this._name}).inject(this._button),this._needCheck||this.activate(),this.setAvailability(!0)},loadSVG:function(t,n){require([t],function(t){n&&n(t)})},onClick:function(t,n){n.preventDefault&&n.preventDefault(),this._activated&&this._callback(t)},activate:function(){this._button.removeClassName("cmd-activate"),this._button.removeClassName("disabled"),this._button.addClassName("cmd-activate"),this._activated=!0},deactivate:function(){this._button.removeClassName("cmd-activate"),this._button.removeClassName("disabled"),this._button.addClassName("disabled"),this._activated=!1},setCallback:function(t){this._callback=t},setAvailability:function(t){this._availability=t,t?this._button.setStyle("display","flex"):this._button.setStyle("display","none")},getAvailability:function(){return this._availability},setText(t){this._textContainer.setText(t)},setIcon:function(t){this._iconContainer&&(this._iconContainer.destroy(),this._iconContainer=null),this._icon=t,this._icon.indexOf(".")>-1?(this._iconContainer=new n.Element("div",{class:"icon",styles:{width:"24px",height:"24px",margin:"0px 14px"}}).inject(this._button,"top"),this.loadSVG(this._icon,function(t){this._iconContainer.innerHTML=t}.bind(this))):(this._iconContainer=new n.Element("span",{class:"fonticon"}).inject(this._button,"top"),this._iconContainer.addClassName(this._icon))},getHTMLElement:function(){return this._button}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionSubButton",i)}),define("DS/CAT3DWPanoply/CAT3DWActionToggleSubButton",["DS/CAT3DWPanoply/CAT3DWActionSubButton","UWA/Core"],function(t,n){"use strict";var e=t.extend({init:function(t){this._parent(t),this._button.addClassName("selectable"),this._isOn=!1},toggleON:function(){this._parent(),this.getHTMLElement().hasClassName("selected")||this.getHTMLElement().addClassName("selected"),this._isOn=!0},toggleOFF:function(){this._parent(),this.getHTMLElement().removeClassName("selected"),this._isOn=!1},isOn:function(){return this._isOn}});return n.namespace("DS/CAT3DWPanoply/CAT3DWActionToggleSubButton",e)}),define("DS/CAT3DWPanoply/CAT3DWPanoplyView",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/CAT3DWInfra/CAT3DWLogger","DS/CAT3DWPanoply/CAT3DWDropMenu","DS/CAT3DWPanoply/CAT3DWView","DS/CAT3DWVisu/CAT3DWVisuEvents","DS/CoreEvents/Events","UWA/Promise"],function(t,n,e,i,o,s,a,l){"use strict";var h=o.extend({init:function(t,n){this._parent(t),this._content=t,this._id=t.id,this._ViewContainer.addClassName(this._id),this._icon=t.icon,this._panoplyManager=n,this._controlSettings=this._panoplyManager.getControlSettings(),this._actions=[],this._actionsObject={},this._moreCommandsMenu=null,this._moreCommandsMenuButton=null,this._optionsL=[],this._optionsR=[],this._helpBarCommands=[],this._selectionMenu=[],this._multiSelectionMenu=[],this._defaultCmd=t.command,this._settingsCmd=t.settings,this._settings=t,this._frame3DOptions=t.frame3DOptions,this._onReadyCallbacks=[],this._isReady=!1,this._onScreenOrientationChange=null,this._onResize=null,this._contextualMenu=null,this._eventsService=new s},initialize:function(){this._setUpCommands(this._settings).then(function(){for(this.hide(),this._isReady=!0;this._onReadyCallbacks.length;){this._onReadyCallbacks.pop()()}}.bind(this)).catch(function(t){e.error(t)})},onReady:function(t){this._onReadyCallbacks.push(t)},_getJSONData:function(t,n){var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0===i.indexOf(n)&&(e[i]=t[i]);return e},_setUpCommands:function(t){var n,i,o=[];if(this._defaultCmd&&o.push(this._processCommand({command:this._defaultCmd})),this._settingsCmd&&o.push(this._processCommand({command:t.settings})),t.helpBarCommands&&t.helpBarCommands.length)for(this._helpBarCommands=t.helpBarCommands,n=0;n<t.helpBarCommands.length;n++)i=t.helpBarCommands[n],o.push(this._processCommand(i));if(t["options-left"]&&t["options-left"].length)for(this._optionsL=t["options-left"],n=0;n<t["options-left"].length;n++)i=t["options-left"][n],o.push(this._processCommand(i));if(t.actions&&t.actions.length)for(this._actions=t.actions,n=0;n<t.actions.length;n++){var s=t.actions[n];this._actionsObject[s.command]=s,o.push(this._processCommand(s)),s.settings&&o.push(this._processCommand({command:s.settings}))}if(t["options-right"]&&t["options-right"].length)for(this._optionsR=t["options-right"],n=0;n<t["options-right"].length;n++)i=t["options-right"][n],o.push(this._processCommand(i));if(t["selection-menu"]&&t["selection-menu"].length)for(this._selectionMenu=t["selection-menu"],n=0;n<t["selection-menu"].length;n++)i=t["selection-menu"][n],o.push(this._processCommand(i));if(t["multi-selection-menu"]&&t["multi-selection-menu"].length)for(this._multiSelectionMenu=t["multi-selection-menu"],n=0;n<t["multi-selection-menu"].length;n++)i=t["multi-selection-menu"][n],o.push(this._processCommand(i));return Promise.all(o).catch(function(t){e.error(t)})},_processCommand:function(t){return new l(function(e){var i=n.getCommand(t.command),o=this._getJSONData(this._panoplyManager.nls,t.command),s=function(e,i){if(i){if(e.icon&&i.setIcon(e.icon),o&&i.setNls(o),t.settings){var s=n.getCommand(e.settings);i.setSettingsCmd(s)}i.subscribeEvents&&!i.isSubscribed()&&i.subscribeEvents(),i.setPanoply(this)}}.bind(this,t);if(i)s(i),e();else var l=a.subscribe({event:"onSketchReady"},function(t){a.unsubscribe(l);var i=n.getCommand(t.command);s(i),e()}.bind(this,t))}.bind(this))},unload:function(){for(let t=0;t<this._actions.length;t++){n.getCommand(this._actions[t].command).unsubscribeEvents()}const t=this.getSelectionMenuContainer();for(;t.lastChild;)t.lastChild.remove();const e=this.getMultiSelectionMenuContainer();for(;e.lastChild;)e.lastChild.remove();if(this._defaultCmd){n.getCommand(this._defaultCmd).unsubscribeEvents()}this.hide()},getPanoplyManager:function(){return this._panoplyManager},getID:function(){return this._id},getIcon:function(){return this._icon},getContent:function(){return this._content},getMoreMenuButton:function(){return this._moreCommandsMenuButton},showAllActions:function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&this._actionsObject[this._actions[t].command]){n.getCommand(this._actions[t].command).setAvailability(!0)}},hideAllActions:function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&this._actionsObject[this._actions[t].command]){n.getCommand(this._actions[t].command).setAvailability(!1)}},_onCmdAvailabilityChange:function(t){var e=n.getCommand(t);e&&this._actionsObject[t]&&(this._checkActionsContainerSize(45)?this._actionsObject[t].irreducible?this._reduceActionsContainerByOneIfPossible():e.setSubButtonAvailable():e.setButtonAvailable())},_reduceActionsContainerByOneIfPossible:function(){for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&this._actionsObject[this._actions[t].command]&&!this._actionsObject[this._actions[t].command].irreducible)return void this._reduceAction(this._actions[t].command)},_reduceActionsContainerAsMuchAsPossible:function(){if(this._checkActionsContainerSize())for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&!this._actionsObject[this._actions[t].command].irreducible){if(!this._checkActionsContainerSize())return;this._reduceAction(this._actions[t].command)}},_reduceActionsInDropDownAsMuchAsPossible:function(){if(!this._checkActionsContainerSize(45))for(var t=0;t<this._actions.length;t++)if(this._actions[t].command&&!this._actionsObject[this._actions[t].command].irreducible){if(this._checkActionsContainerSize(45))return;this._extendAction(this._actions[t].command)}},_checkActionsContainerSize:function(t){var n=0;return t&&(n=t),this.getActionsContainer().offsetHeight+n>=window.innerHeight-84},_reduceAction:function(t){var e=n.getCommand(t);e.isButtonAvailable()&&e.setSubButtonAvailable()},_extendAction:function(t){var e=n.getCommand(t);e.isSubButtonAvailable()&&e.setButtonAvailable()},setHand:function(t){this._parent(t),this._moreCommandsMenu&&(this._moreCommandsMenu.menu.options.offset.x=t?55:-55,this._moreCommandsMenu.menu.updatePosition());for(let e=0;e<this._actions.length;e++){n.getCommand(this._actions[e].command).setHand(t)}"AddMedia"===this.getID()&&(n.getCommand("AddMediaCmd").setHand(t),a.publish({event:"MediaPanelHandPositionChangeScenario",data:{isLefthand:t}}))},start:function(e){var o=function(){if(this._moreCommandsMenu&&(this._moreCommandsMenu.remove(),this._moreCommandsMenu=null),this._moreCommandsMenuButton&&(this._moreCommandsMenuButton.getHTMLElement().destroy(),this._moreCommandsMenuButton=null),this._frame3DOptions&&"object"==typeof this._frame3DOptions)for(var o in this._frame3DOptions)"profile"===o&&this._controlSettings&&this._frame3DOptions[o]&&this._controlSettings.applyProfile(this._frame3DOptions[o].toUpperCase(),this._frame3DOptions.forceRotation);var s,l,h,r,c;for(this._clearContextualMenu(),this.show(),this._settingsCmd&&(l=n.getCommand(this._settingsCmd))&&l.onPanoplyStart&&l.onPanoplyStart(),this._defaultCmd&&(l=n.getCommand(this._defaultCmd),(c=l.getHelp())&&!l.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),n.setDefaultCommand({ID:this._defaultCmd})),s=0;s<this._helpBarCommands.length;s++)h=this._helpBarCommands[s],(l=n.getCommand(h.command))&&((r=l.getButton())&&r.getHTMLElement().inject(this.getHelpContainer().querySelector("."+this._defaultCmd)),l.onPanoplyStart());for(s=0;s<this._optionsL.length;s++)h=this._optionsL[s],(l=n.getCommand(h.command))&&((r=l.getButton())&&r.getHTMLElement().inject(this.getOptionsLContainer()),(c=l.getHelp())&&!l.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),l.onPanoplyStart());var u=[],d=null,p=function(e){(l=n.getCommand(e.command))&&(d||(d=new t.Element("ul",{class:"CAT3DWView-MoreMenu dropdown-menu-wrap dropdown-menu-icons"})),l.getSubButton().getHTMLElement().inject(d))};for(s=0;s<this._actions.length;s++){var _=this._actions[s];(l=n.getCommand(_.command))&&(_.irreducible||(p(_),u.push(_)),(r=l.getButton())&&r.getHTMLElement().inject(this.getActionsContainer()),this._onCmdAvailabilityChange(_.command),this.getMobileActionsContainer()&&l.getSubButton()&&l.getSubButton().getHTMLElement().inject(this.getMobileActionsContainer()),(c=l.getHelp())&&!l.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),l.onPanoplyStart())}if(e&&e.moreCommands&&e.moreCommands.length)for(s=0;s<e.moreCommands.length;s++)(l=n.getCommand(e.moreCommands[s].command))&&(p(e.moreCommands[s]),(c=l.getHelp())&&!l.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),l.onPanoplyStart());var m=null;if(e&&e.contextualCommands&&e.contextualCommands.length)for(s=0;s<e.contextualCommands.length;s++)(l=n.getCommand(e.contextualCommands[s].command))&&(m||(m=new t.Element("ul",{class:"dropdown-menu-wrap dropdown-menu-icons"})),l.getContextButton().getHTMLElement().inject(m),(c=l.getHelp())&&!l.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),l.onPanoplyStart());for(m&&(this._contextualMenu=new i({target:new t.Element("div",{}),renderTo:this._panoplyManager._frmWindow.getUIFrame(),body:m}),this._contextualMenu.menu.elements.container.addClassName("CAT3DWView-contextualMenu"),this._contextualMenu.menu.elements.container.addClassName("dropdown-menu"),this._contextualMenu.menu.elements.container.addClassName("dropdown-menu-root"),this._contextualMenu.menu.elements.container.setStyle({"overflow-x":"hidden","overflow-y":"auto"}),this._contextMenuCB=function(t){setTimeout(function(){this._contextualMenu.show();var i={x:null,y:null};if(t.position?(i.x=t.position.x,i.y=t.position.y):(i.x=t.clientX,i.y=t.clientY),this._contextualMenu.menu.elements.container.setStyle("top",i.y),this._contextualMenu.menu.elements.container.setStyle("left",i.x),e&&e.contextualCommands&&e.contextualCommands.length)for(s=0;s<e.contextualCommands.length;s++)(l=n.getCommand(e.contextualCommands[s].command))&&l.onShowContextMenu&&l.onShowContextMenu(i);this._contextualMenu.checkProportions()}.bind(this),100)}.bind(this),this._onRightClickEventToken=a.subscribe({event:this._eventsService.getRightClickEvent()},this._contextMenuCB),this._onLongHoldEventToken=a.subscribe({event:this._eventsService.getLongHoldEvent()},function(t){t.isTouch&&"Diagram"!==this.getID()&&this._contextMenuCB(t)}.bind(this))),s=0;s<this._optionsR.length;s++)h=this._optionsR[s],(l=n.getCommand(h.command))&&((r=l.getButton())&&r.getHTMLElement().inject(this.getOptionsRContainer()),(c=l.getHelp())&&!l.getView()&&c.getHTMLElement().inject(this.getHelpContainer()),l.onPanoplyStart());var g=null;function C(t,e,i){for(s=0;s<t.length;s++)h=t[s],(l=n.getCommand(h.command))&&((r=l.getButton())&&(g=r.getHTMLElement())&&!g.getParent()&&g.inject(e),(c=l.getHelp())&&!l.getView()&&(g=c.getHTMLElement())&&!g.getParent()&&g.inject(i),l.onPanoplyStart())}const b=this.getSelectionMenuContainer(),y=this.getHelpContainer();C(this._selectionMenu,b,y);const f=this.getMultiSelectionMenuContainer();C(this._multiSelectionMenu,f,y);var A=function(){this._reduceActionsContainerAsMuchAsPossible(),this._reduceActionsInDropDownAsMuchAsPossible()}.bind(this);this._onResize=A,window.addEventListener("resize",A),e&&e.callback&&e.callback()}.bind(this);this._isReady?o():this.onReady(o)},stop:function(){this._moreCommandsMenu&&(this._moreCommandsMenu.remove(),this._moreCommandsMenu=null),this._moreCommandsMenuButton&&(this._moreCommandsMenuButton.getHTMLElement().destroy(),this._moreCommandsMenuButton=null),this._onResize&&(window.removeEventListener("resize",this._onResize),this._onResize=null),this._clearContextualMenu(),n.resetDefaultCommand(),this.hide()},_clearContextualMenu:function(){this._contextualMenu&&(this._contextualMenu.remove(),this._contextualMenu=null),this._contextMenuCB=null,a.unsubscribe(this._onRightClickEventToken),a.unsubscribe(this._onLongHoldEventToken)}});return t.namespace("DS/CAT3DWPanoply/CAT3DWPanoplyView",h)}),define("DS/CAT3DWPanoply/CAT3DWPanoplyManager",["UWA/Core","DS/CAT3DWPanoply/CAT3DWPanoplyView","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/FrameWindowsManager","UWA/Promise","DS/CAT3DWInfra/CAT3DWMOBStylingHelper","css!DS/CAT3DWPanoply/CAT3DWPanoply"],function(t,n,e,i,o,s,a,l){"use strict";var h=t.Class.extend({init:function(t){this._panoplyArray=[],this._panoplyObject={},this._panoplyInfosArray=[],this._panoplyDrawInfosArray=[],this._onPanoplyStartTokens=[],this._currentPanoply=null,this._defaultPanoply=null,this._globalPanoply=null,this._moreCommands=[],this._contextualCommands=[],this._panoplyShortcuts={},this._panoplyDrawingShortcuts={},this._onReady=[],this._frmWindow=s.getFrameWindow(),this._uiFrame=this._frmWindow.getUIFrame(),t.nls&&t.rsc&&(this.nls=t.nls,this.rsc=t.rsc),t.controlSettings&&(this._controlSettings=t.controlSettings),this._onWindowResizeCB=function(){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"resize"})}.bind(this),window.addEventListener("resize",this._onWindowResizeCB),this._MOBShowPanoplyBarToken=i.subscribe({event:"3DSketch.Show.Panoply.Bar.MOB"},function(t){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"click-show-panoply-bar-btn"})}.bind(this)),this._MOBThingSelectedToken=i.subscribe({event:"3DSketch.thing.selected.MOB"},function(t){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"selection-of-thing"})}.bind(this)),this._MOBEmptyCanvasPointerHitToken=i.subscribe({event:"3DSketch.empty.canvas.pointer.hit.MOB"},function(t){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"click-on-empty-canvas"})}.bind(this)),this._MOBSelectedCompositionDeletedToken=i.subscribe({event:"3DSketch.selected.composition.deleted.MOB"},function(t){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"selected-composition-deleted"})}.bind(this)),this._MOBThingSelectedLockedToken=i.subscribe({event:"3DSketch.selected.thing.locked.MOB"},function(t){this._handleStylingForMobileScreenSize(this._currentPanoply,{action:"selected-thing-locked"})}.bind(this))},initialize:function(){var t=this.rsc.panoplyArray,e=this.rsc.globalPanoply;this.rsc.moreCommands&&this.rsc.moreCommands.length&&(this._moreCommands=this.rsc.moreCommands),this.rsc.contextualCommands&&this.rsc.contextualCommands.length&&(this._contextualCommands=this.rsc.contextualCommands);var s=[];for(let e=0;e<t.length;e++)if(s.push(new a(function(e,i){var o=t[e];this._panoplyArray.push(o.id),this._panoplyObject[o.id]=new n(o,this),this._panoplyObject[o.id].onReady(i),"DrawingTool"==o.id&&(this._drawingToolPanoply=this._panoplyObject[o.id]),this._panoplyObject[o.id].initialize(),o.masterPanoply?"DrawingTool"==o.masterPanoply&&this._panoplyDrawInfosArray.push({id:o.id,icon:o.icon,icon_active:o.icon_active,settings:o.settings}):this._panoplyInfosArray.push({id:o.id,icon:o.icon,icon_active:o.icon_active,settings:o.settings})}.bind(this,e))),t[e].shortcut&&t[e].masterPanoply&&"DrawingTool"==t[e].masterPanoply){this._panoplyDrawingShortcuts[t[e].shortcut]=t[e].id;let n="Digit"+t[e].shortcut,i="Numpad"+t[e].shortcut;this._panoplyDrawingShortcuts[n]=t[e].id,this._panoplyDrawingShortcuts[i]=t[e].id}else{this._panoplyShortcuts[t[e].shortcut]=t[e].id;let n=t[e].shortcut;this._panoplyShortcuts[n]=t[e].id}this._onKeydownCB=this._onKeyDown.bind(this),document.addEventListener("keydown",this._onKeydownCB),e&&s.push(new a(function(t){e.id="GlobalPanoplyContainer",this._globalPanoply=new n(e,this),this._globalPanoply.onReady(t),this._globalPanoply.initialize()}.bind(this))),this._onCommandStartToken=o.onCommandStart(this._onActionBegin.bind(this)),this._onCommandResumeToken=i.subscribe({event:"/WUX/AFR/CMD//RESUME"},this._onActionBegin.bind(this)),Promise.all(s).then(function(){let t=[];var n=this._moreCommands.concat(this._contextualCommands);for(let e=0;e<n.length;e++)t.push(this._globalPanoply._processCommand(n[e]));return Promise.all(t).catch(function(t){console.error(t)})}.bind(this)).then(function(){this._globalPanoply.start(),i.publish({event:"CAT3DWPanoplyManager/INIT"});for(var t=0;t<this._onReady.length;t++)this._onReady[t]()}.bind(this)).catch(function(t){console.error(t)})},onManagerReady:function(t){this._onReady.push(t)},unload:function(){var t;for(window.removeEventListener("resize",this._onWindowResizeCB),i.unsubscribe(this._MOBShowPanoplyBarToken),i.unsubscribe(this._MOBThingSelectedToken),i.unsubscribe(this._MOBEmptyCanvasPointerHitToken),i.unsubscribe(this._MOBSelectedCompositionDeletedToken),i.unsubscribe(this._MOBThingSelectedLockedToken),this._temporaryView&&this._temporaryView.hide(),i.unsubscribe(this._onCommandStartToken),i.unsubscribe(this._onCommandResumeToken),document.removeEventListener("keydown",this._onKeydownCB),t=0;t<this._onPanoplyStartTokens.length;t++)i.unsubscribe(this._onPanoplyStartTokens[t]);for(this._globalPanoply&&(this._globalPanoply.unload(),this._globalPanoply=null),t=0;t<this._panoplyArray.length;t++)this._panoplyObject[this._panoplyArray[t]].unload(),this._panoplyObject[this._panoplyArray[t]]=null;this._panoplyArray=[],this._panoplyObject={},this._currentPanoply=null,this._defaultPanoply=null,this._moreCommands=[],this._contextualCommands=[],this._onReady=[]},importCSS:function(t){t.indexOf("css!")>-1&&require([t],function(){})},_handleStylingForMobileScreenSize:function(t,n){if(t)if("panoply-start"===n.action.toLowerCase()||"resize"===n.action.toLowerCase()||"selected-composition-deleted"===n.action.toLowerCase()){let n=0,e=t.getActionsContainer().children;for(let t of e)"none"===getComputedStyle(t).getPropertyValue("display")||t.classList.contains("non-available")||n++;"selection"!==t.getID().toLowerCase()||n?(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),this._drawingToolPanoply&&this._drawingToolPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),"settings"===t.getID().toLowerCase()?(this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-panoplyBarLookChange-globalPanoply"),this._drawingToolPanoply&&(this._drawingToolPanoply.getActionsContainer().classList.remove("WB-MOB-hideActionsContainer-globalPanoply"),this._drawingToolPanoply.getActionsContainer().classList.add("WB-MOB-panoplyBarLookChange-globalPanoply")),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height")):(this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply"),this._drawingToolPanoply&&(this._drawingToolPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._drawingToolPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply")),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),0===n?t.getActionsContainer().classList.remove("WB-MOB-borders-height"):t.getActionsContainer().classList.add("WB-MOB-borders-height")),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._drawingToolPanoply&&this._drawingToolPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply")):(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.remove("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-showPanoplyBarSettingsViewMOBCmd"),this._drawingToolPanoply&&(this._drawingToolPanoply.getOptionsLContainer().classList.remove("WB-MOB-hideLeftContainer-globalPanoply"),this._drawingToolPanoply.getOptionsLContainer().classList.add("WB-MOB-showPanoplyBarSettingsViewMOBCmd")),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply"),this._drawingToolPanoply&&(this._drawingToolPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._drawingToolPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply")),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height"),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._drawingToolPanoply&&this._drawingToolPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"))}else"click-show-panoply-bar-btn"===n.action.toLowerCase()?(this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getOptionsLContainer().classList.remove("WB-MOB-showPanoplyBarSettingsViewMOBCmd"),this._drawingToolPanoply&&(this._drawingToolPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),this._drawingToolPanoply.getOptionsLContainer().classList.remove("WB-MOB-showPanoplyBarSettingsViewMOBCmd")),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-panoplyBarLookChange-globalPanoply"),this._drawingToolPanoply&&(this._drawingToolPanoply.getActionsContainer().classList.remove("WB-MOB-hideActionsContainer-globalPanoply"),this._drawingToolPanoply.getActionsContainer().classList.add("WB-MOB-panoplyBarLookChange-globalPanoply")),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height")):"selection-of-thing"===n.action.toLowerCase()?"selection"===t.getID().toLowerCase()&&(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),this._drawingToolPanoply&&this._drawingToolPanoply.getOptionsLContainer().classList.add("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._drawingToolPanoply&&this._drawingToolPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.add("WB-MOB-borders-height"),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._drawingToolPanoply&&this._drawingToolPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply")):"click-on-empty-canvas"!==n.action.toLowerCase()&&"selected-thing-locked"!==n.action.toLowerCase()||"selection"!==t.getID().toLowerCase()||o.getCommand("QuickTourCmd")._isStarted||(t.getHelpContainer().classList.add("WB-MOB-adjustSizePosition-help-currentPanoply"),this._globalPanoply.getOptionsLContainer().classList.remove("WB-MOB-hideLeftContainer-globalPanoply"),this._globalPanoply.getOptionsLContainer().classList.add("WB-MOB-showPanoplyBarSettingsViewMOBCmd"),this._drawingToolPanoply&&(this._drawingToolPanoply.getOptionsLContainer().classList.remove("WB-MOB-hideLeftContainer-globalPanoply"),this._drawingToolPanoply.getOptionsLContainer().classList.add("WB-MOB-showPanoplyBarSettingsViewMOBCmd")),this._globalPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._globalPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply"),this._drawingToolPanoply&&(this._drawingToolPanoply.getActionsContainer().classList.add("WB-MOB-hideActionsContainer-globalPanoply"),this._drawingToolPanoply.getActionsContainer().classList.remove("WB-MOB-panoplyBarLookChange-globalPanoply")),t.getActionsContainer().classList.remove("WB-MOB-showSelectionActionButtons"),t.getActionsContainer().classList.remove("WB-MOB-borders-height"),this._globalPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"),this._drawingToolPanoply&&this._drawingToolPanoply.getOptionsRContainer().classList.add("WB-MOB-hideRightContainer-globalPanoply"))},startPanoply:function(t,n){if(!n){let t=new Error;throw t.name="Function invoked incorrectly",t.message='Invoking startPanoply method on panoply manager object is deprecated. Instead check "3DSketch.toggle.any.panoply" event',t}this._panoplyObject[t]&&(this._currentPanoply&&t!==this._currentPanoply.getID()&&this._panoplyObject[t]&&this.endPanoply(),this._currentPanoply=this._panoplyObject[t],this._panoplyObject[t].start({moreCommands:this._moreCommands,contextualCommands:this._contextualCommands,callback:function(){this._updateNextPanoply(),i.publish({event:"CAT3DSKPanoply/START",data:{id:this._currentPanoply.getID(),icon:this._currentPanoply.getIcon(),nextId:this._nextPanoply.getID(),nextIcon:this._nextPanoply.getIcon()}})}.bind(this)}));this._handleStylingForMobileScreenSize(this._panoplyObject[t],{action:"panoply-start"})},_onKeyDown:function(t){if(this._currentPanoply&&o.getCurrentCmdId()!==this._currentPanoply._defaultCmd)return;if(t&&t.target&&"INPUT"===t.target.tagName)return;let n=o.getCommand("QuickTourCmd");if(n&&n._isStarted)return;let e=!1;this._drawingToolPanoply&&(this._drawingToolPanoply.getActionsContainer().clientHeight||this._drawingToolPanoply.getMobileActionsContainer().clientHeight)&&(e=!0),this._panoplyShortcuts[t.key]&&!e?i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyShortcuts[t.key]}}):this._panoplyShortcuts[t.code]&&!e&&i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyShortcuts[t.code]}}),this._panoplyDrawingShortcuts[t.key]&&e?i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyDrawingShortcuts[t.key]}}):this._panoplyDrawingShortcuts[t.code]&&e?i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:this._panoplyDrawingShortcuts[t.code]}}):84===t.keyCode?i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"Text"}}):78===t.keyCode&&i.publish({event:"3DSketch.toggle.any.panoply",data:{panoplyID:"StickyNote"}})},endPanoply:function(){this._currentPanoply.stop(),i.publish({event:"CAT3DSKPanoply/STOP",data:{id:this._currentPanoply.getID(),icon:this._currentPanoply.getIcon(),nextId:this._nextPanoply.getID(),nextIcon:this._nextPanoply.getIcon()}}),this._currentPanoply=void 0},getNextPanoply:function(){return this._nextPanoply},_updateNextPanoply:function(){for(var t,n=0;n<this._panoplyArray.length;n++)this._currentPanoply.getID()===this._panoplyArray[n]&&(t=n===this._panoplyArray.length-1&&0!==n?this._panoplyArray[0]:this._panoplyArray[n+1]);this._nextPanoply=this._panoplyObject[t]},nextPanoply:function(){i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:this._nextPanoply.getID()}})},setDefaultPanoply:function(t){this._panoplyObject[t]&&(this._defaultPanoply=this._panoplyObject[t]),this.startDefaultPanoply()},startDefaultPanoply:function(){this._defaultPanoply&&i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:this._defaultPanoply.getID()}})},setHand:function(t){if(this._globalPanoply&&this._globalPanoply.setHand(t),this._panoplyArray.length)for(var n=0;n<this._panoplyArray.length;n++)this._panoplyObject[this._panoplyArray[n]].setHand(t)},_onActionBegin:function(t){var n,e=o.getCommand(o.getCurrentCmdId());o.getCommand("AddMediaCmd");if(e&&(n=e.getView()),n)this._temporaryView&&this._temporaryView.hide(),this._temporaryView=n,this._currentPanoply.hide(),this._temporaryView.show(),n.isLeftPanelEnabled()&&n.isRightPanelEnabled()||this._globalPanoply.hide();else if(this._temporaryView){var s=this._temporaryView.getFallbackPanoply();if(this._temporaryView.hide(),this._temporaryView=null,this._currentPanoply.show(),this._globalPanoply.show(),s)var a=t.onExecute(function(){i.unsubscribe(a),i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:s}})}),l=t.onResume(function(){i.unsubscribe(l),i.publish({event:"3DSketch.start.any.panoply",data:{panoplyID:s}})})}},isInCommandSubView:function(){return!!this._temporaryView},onPanoplyStart:function(t){this._onPanoplyStartTokens.push(i.subscribe({event:"CAT3DSKPanoply/START"},t))},onPanoplyEnd:function(t){this._onPanoplyStartTokens.push(i.subscribe({event:"CAT3DSKPanoply/STOP"},t))},getPanoplyInfosArray:function(){return this._panoplyInfosArray},getDrawPanoplyInfosArray:function(){return this._panoplyDrawInfosArray},getCurrentPanoply:function(){return this._currentPanoply},enableHelp:function(t){e.setPreferenceValue("help",t);var n=o.getCommand(o.getCurrentCmdId());if(n)if(t)n.getHelp().show();else{n.getHelp().hide();var i=o.getCommands();for(let t in i)"string"==typeof t&&i[t].getHelp().reset()}},getControlSettings:function(){return this._controlSettings}});return t.namespace("DS/CAT3DWPanoply/CAT3DWPanoplyManager",h)}),define("DS/CAT3DWPanoply/CAT3DWToggleButton",["DS/CAT3DWPanoply/CAT3DWButton","UWA/Core"],function(t,n){"use strict";var e=t.extend({init:function(t){this._parent(t),this.isChecked=!1},onClick:function(t){this.isChecked?this.isChecked=!1:this.isChecked=!0,this._parent(t)},toggleON:function(){this.isChecked=!0},toggleOFF:function(){this.isChecked=!1},isON:function(){return this.isChecked}});return n.namespace("DS/CAT3DWPanoply/CAT3DWToggleButton",e)}),define("DS/CAT3DWPanoply/CAT3DWActionCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CAT3DWPanoply/CAT3DWActionButton","DS/CAT3DWPanoply/CAT3DWActionHelp","DS/CAT3DWPanoply/CAT3DWToggleButton","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/CAT3DWPanoply/CAT3DWActionSubButton","DS/CAT3DWInfra/CAT3DWMOBStylingHelper","DS/ApplicationFrame/FrameWindowsManager","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip"],function(t,n,e,i,o,s,a,l,h,r,c){"use strict";var u=n.extend({init:function(t,n){this._parent(t,n),this._icon="",t&&t.icon&&this.setIcon(t.icon),this._button=null,this._subButton=null,this._availability=!0,this._actionView=null,this._panoply=null,this._help=null,this._repeat=!0,"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch?this._touchMode=!0:this._touchMode=!1},onPanoplyStart:function(){},setPanoply:function(t){this._panoply=t},getPanoply:function(){return this._panoply},setRepeat:function(t){this._repeat=t},isRepeat:function(){return this._repeat},subscribeEvents:function(){this._subscribed=!0},unsubscribeEvents:function(){this._subscribed=!1},isSubscribed:function(){return this._subscribed},_debounce:function(t,n=100){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>{t.bind(this)(...i)},n)}},_onResizeUpdateHelp:function(){this.setHelp(),this._help.isVisible()&&(this._help.hide(),this._help.show())},beginExecute:function(t){this._button&&this._button instanceof o&&this._button.toggleON(),(t=t||{}).actionView=null!==this._actionView,a.publish({event:"CAT3DWActionCmd/START/",data:t}),a.publish({event:this._globalEvtID+"/EXECUTE",data:this}),this.helpData&&this.helpDataMobile&&(this.setHelp(),this.frameWindow||(this.frameWindow=r.getFrameWindow()),this._onResizeUpdateHelpBind=this._debounce(this._onResizeUpdateHelp),window.addEventListener("resize",this._onResizeUpdateHelpBind)),this._help&&this._help.show(),this._parent()},cancelExecute:function(t){a.publish({event:"CAT3DWActionCmd/CANCEL/",data:t}),a.publish({event:this._globalEvtID+"/CANCEL",data:this}),this._parent()},endExecute:function(t){this._button&&this._button instanceof o&&this._button.toggleOFF(),(t=t||{}).actionView=null!==this._actionView,a.publish({event:"CAT3DWActionCmd/END/",data:t}),a.publish({event:this._globalEvtID+"/END",data:this}),this._help&&this._help.hide(),this.helpData&&this.helpDataMobile&&(this._onResizeUpdateHelpBind=this._onResizeUpdateHelp.bind(this),this.frameWindow||(this.frameWindow=r.getFrameWindow()),window.removeEventListener("resize",this._onResizeUpdateHelpBind),this._onResizeUpdateHelpBind=null),this._parent()},check:function(){},getAvailability:function(){return this._availability},setAvailability:function(t){this._availability!==t&&(this._availability=t,this._button&&this._button.setAvailability&&this._button.setAvailability(t),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(t),this._contextButton&&this._contextButton.setAvailability&&this._contextButton.setAvailability(t),this._panoply&&this._panoply._onCmdAvailabilityChange(this._id))},setButtonAvailable:function(){this._availability?(this._button&&this._button.setAvailability&&this._button.setAvailability(!0),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1)):(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1))},setSubButtonAvailable:function(){this._availability?(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!0)):(this._button&&this._button.setAvailability&&this._button.setAvailability(!1),this._subButton&&this._subButton.setAvailability&&this._subButton.setAvailability(!1))},isButtonAvailable:function(){if(this._button&&this._button.getAvailability)return this._button.getAvailability()},isSubButtonAvailable:function(){if(this._subButton&&this._subButton.getAvailability)return this._subButton.getAvailability()},setIcon:function(t){this._icon=t,this.getButton().setIcon(this._icon),this.getSubButton().setIcon(this._icon),this.getContextButton().setIcon(this._icon)},setLabel:function(t){this._label=t,this.getButton().addLabel(t),this.getSubButton().setText(t),this.getContextButton().setText(t)},setNls:function(t){this._nls=t,this._nls[this._id+".text"]&&(this.getButton().addLabel(this._nls[this._id+".text"]),this.getSubButton().setText(this._nls[this._id+".text"]),this.getContextButton().setText(this._nls[this._id+".text"]))},setSettingsCmd:function(t){this._settingsCmd=t},_callback:function(){this._isRunning||this.begin()},setButton:function(t){this._button=t},setSubButton:function(t){this._subButton=t},setContextButton:function(t){this._contextButton=t},setHand:function(){},getButton:function(){return this._button?this._button:(this._button=this.createButton(),this._button)},getSubButton:function(){return this._subButton?this._subButton:(this._subButton=this.createSubButton(),this._subButton)},getContextButton:function(){return this._contextButton?this._contextButton:(this._contextButton=this.createSubButton(),this._contextButton)},createButton:function(){var t;return t=Object.prototype.hasOwnProperty.call(c,this._id)?c.get(this._id):"",new e({name:this._id,icon:this._icon,callback:this._callback.bind(this),tooltip:t})},createSubButton:function(){var t;return t=Object.prototype.hasOwnProperty.call(c,this._id)?c.get(this._id):"",new l({name:this._id,icon:this._icon,callback:this._callback.bind(this),tooltip:t})},getView:function(){return this._actionView},setView:function(t){this._actionView=t},getHelp:function(){return this._help?this._help:(this._help=new i({name:this._id,icon:this._icon,cmd:this}),this._help)},setHelp:function(){h.isScreenDimensionMobilePhone()?this._help.setHelp(this.helpDataMobile):this._help.setHelp(this.helpData)},setHelpResources:function(t){if(t.i18nObj){this.getHelp().hide();var n=t.i18nObj,e="help."+t.key+".",i="help.touch."+t.key+".",o=t.mediaObj,a={message:null,tip:null,title:null,text1:null,text2:null};for(var l in a)a[l]=n[e+l]?n.get(e+l):null,this._touchMode&&(a[l]=n[i+l]?n.get(i+l):a[l]);this.helpData={key:t.key,message:a.message,tip:a.tip,title:a.title,text1:a.text1,text2:a.text2,gif:o&&o[e+"gif"]?s.getWebappsBaseUrl()+o[e+"gif"]:null},this.helpDataMobile=JSON.parse(JSON.stringify(this.helpData));var h=n[e+"message.mobile"]?n.get(e+"message.mobile"):a.message;this.helpDataMobile.message=h,this.setHelp()}}});return t.namespace("DS/CAT3DWPanoply/CAT3DWActionCmd",u)});