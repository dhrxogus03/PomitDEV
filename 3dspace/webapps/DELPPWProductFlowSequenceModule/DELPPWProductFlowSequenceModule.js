define("DS/DELPPWProductFlowSequenceModule/ProductFlowComponent",["UWA/Core"],function(e){"use strict";return function(t,n){var o,i,r,a,s,l,d,c,u,p,f,m,h,g,y,w,P,I,v,b,N,k,x,E,A,C,L,D,S,T,V,F,R,M,O,_,B,G,W,$,U,j,H,z,X,Y,q,Q,K,Z,J,ee,te,ne,oe,ie,re,ae,se,le,de,ce,ue=t.getComponent("EGraphCore"),pe=t.getComponent("EGraphViews"),fe=t.getComponent("EGraphIact"),me=t.getComponent("EGraphUtils"),he=t.getComponent("ContextualMenuManager"),ge=t.getComponent("TooltipModel"),ye="DELArrowDisplayExt.V_ArrowStartPosition",we="DELArrowDisplayExt.V_ArrowEndPosition",Pe=!1,Ie=0,ve=!1,be={},Ne=[];return m=!!e.is(n.readOnly)&&n.readOnly,y=e.is(n.nodes)?n.nodes:[],w=e.is(n.links)?n.links:[],h=e.is(n.nodeOptions)?n.nodeOptions:[],P=e.is(n.identifier)?n.identifier:"",I=e.is(n.getNodeContextMenu,"function")?n.getNodeContextMenu:null,v=e.is(n.getLinkContextMenu,"function")?n.getLinkContextMenu:null,N=e.is(n.onConnectingNodes)?n.onConnectingNodes:null,$=e.is(n.onNodeDoubleClick,"function")?n.onNodeDoubleClick:null,q=e.is(n.onNodeSelectionChange,"function")?n.onNodeSelectionChange:null,r=e.is(n.onSaveAnchorPositions,"function")?n.onSaveAnchorPositions:null,a=e.is(n.onMultiplePositionChangeAlert,"function")?n.onMultiplePositionChangeAlert:null,i=function(){pe.HTMLNodeView.call(this)},o=function(e){pe.SVGEdgeView.call(this,e)},o.prototype.createTextEdgeView=function(e,t,n){var o,i="http://www.w3.org/2000/svg";(o=document.createElementNS(i,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.display.elt.id),o.setAttribute("startOffset","10%"),""===e.mark?o.appendChild(document.createTextNode("")):e.mark.hasOwnProperty(t)&&(o.appendChild(document.createTextNode(e.mark[t])),n++),this.display.text=document.createElementNS(i,"text"),this.display.text.setAttribute("dy",-14*(n-1)+12),this.display.text.grElt=e,me.classListAdd(this.display.text,"edge-text"),this.display.text.appendChild(o),""!==o.innerHTML&&this.structure.root.appendChild(this.display.text)},o.prototype.oncreateDisplay=function(e){var t,n=this,o=0;pe.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",t="Type",Array.isArray(t)||(t=[t]),t.forEach(function(t){n.createTextEdgeView(e,t,o),o++})},D=function(e){return/^(auto|0)$|^[+-]?[0-9]+.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc|rem)$/.test(e)},W=function(){return"SEQUENCE"===g},E=function(){var t=e.createElement("div",{class:"input-node my-node"}),n=e.createElement("img",{class:"my-node-type-img"}),o=e.createElement("div",{class:"title-container"}),i=e.createElement("div",{class:"sub-title-container"}),r=e.createElement("div",{class:"my-node-container"}),a=e.createElement("div",{class:"my-node-col left"}),s=e.createElement("div",{class:"my-node-col right"}),l=e.createElement("div",{class:"myNodeLinkEdit"}),d=e.createElement("div",{class:"my-node-text"});return t.setStyles({width:"50px",height:"50px"}),d.setStyles({top:"0px"}),r.appendChild(n),r.appendChild(i),s.appendChild(d),t.appendChild(o),t.appendChild(r),t.appendChild(a),t.appendChild(s),t.appendChild(l),t},C=function(t,n){var o,i=n.grElt,r=n.clientPos[0],a=n.clientPos[1];e.is(i)&&!m&&(i.type===ue.Type.NODE?(e.is(i.gr.selection.first)&&i.gr.selection.first.PID!==i.PID?(k.removeFromSelection(i.gr.selection.first),k.addToSelection(i)):null===i.gr.selection.first&&k.addToSelection(i),I&&(o=I(i.model))):i.type===ue.Type.EDGE&&e.is(i.mark)&&v&&(o=v(i.mark)),e.is(o)&&(o=Array.isArray(o)?o:[o],Array.isArray(o)&&he.show({nodes:o},[r,a])))},M=function(e,t,n){var o,i;return i=e===ue.BorderCstr.TOP||e===ue.BorderCstr.BOTTOM?125:45,o=new ue.Connector,!0===n&&(o.views.main=new pe.SVGConnView("egraph_views_SVGConnView egraph_views_mySVGConnView")),o.multiset(["cstr","attach"],e,["cstr","offset"],i),o},O=function(t){e.is(t.connectors)||(t.connectors={}),t.connectors.top=M(ue.BorderCstr.TOP,0,!0),t.connectors.top.id="top_"+t.id,t.appendConnector(t.connectors.top),t.connectors.bottom=M(ue.BorderCstr.BOTTOM,0,!0),t.connectors.bottom.id="bottom_"+t.id,t.appendConnector(t.connectors.bottom),t.connectors.left=M(ue.BorderCstr.LEFT,0,!0),t.connectors.left.id="left_"+t.id,t.appendConnector(t.connectors.left),t.connectors.right=M(ue.BorderCstr.RIGHT,0,!0),t.connectors.right.id="right_"+t.id,t.appendConnector(t.connectors.right)},re=function(t,n,o){var i,r,a="http://www.w3.org/2000/svg";(i=document.createElementNS(a,"textPath")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+t.display.elt.id),i.setAttribute("startOffset","50%"),""===n.mark?i.appendChild(document.createTextNode("")):n.mark.linkInfo.hasOwnProperty(o)&&(r=e.is(n.mark.linkInfo[o])&&"NULL"!==n.mark.linkInfo[o]?n.mark.linkInfo[o]:"",i.appendChild(document.createTextNode(r))),t.display.text=document.createElementNS(a,"text"),t.display.text.setAttribute("dy","-5"),t.display.text.grElt=n,t.display.text.setAttribute("data-id",t.display.elt.id),t.display.text.style.cssText="text-anchor: middle;",me.classListAdd(t.display.text,"edge-text"),t.display.text.appendChild(i),""!==i.innerHTML&&t.structure.root.appendChild(t.display.text)},_=function(t,n,i){var r,a;return a="-productFlow",e.is(i.linkInfo.flowType)?a="-productFlow-"+i.linkInfo.flowType:e.is(i.linkInfo.subType)&&("DELLmiTimeConstraintCnx_FinishToStart"===i.linkInfo.subType?a="-timeConstraint":"DELLmiTimeConstraintCnx_StartToStart"===i.linkInfo.subType?a="-timeConstraint":"DELLmiTimeConstraintCnx_FinishToFinish"===i.linkInfo.subType&&(a="-timeConstraint")),(r=new ue.Edge).set("geometry",new ue.AutoBezierGeometry),r.views.main=new o("egraph_views_SVGEdgeView my-sec-edge-view"+a),r.mark=i,k.addEdge(t,n,r),r},le=function(t,n){var o,i,r,a,s="headerBackgroundColor",l="headerTextColor",d="tileBackgroundColor",c="tileTextColor",u="Equal",p="NotEqual",f="LessThanOrEqual",m="GreaterThanOrEqual",h=function(t){switch(t.graphicalElement){case s:e.is(t.color)&&!o&&(o=t.color);break;case l:e.is(t.color)&&!i&&(i=t.color);break;case d:e.is(t.color)&&!r&&(r=t.color);break;case c:e.is(t.color)&&!a&&(a=t.color)}};return n.sort((e,t)=>e.ruleNumber-t.ruleNumber),n.forEach(function(n){var o;if(e.is(n.name)){if(e.is(t[n.name])&&e.is(n.attributeValue))switch(o=e.is(t[n.name],"object")?t[n.name].value:t[n.name],n.attributeCondition){case u:o===n.attributeValue&&h(n);break;case p:o!==n.attributeValue&&h(n);break;case f:o<=n.attributeValue&&h(n);break;case m:o>=n.attributeValue&&h(n)}}else e.is(n.name)||h(n)}),{headerBackgroundColor:o,headerTextColor:i,tileBackgroundColor:r,tileTextColor:a}},Q=function(t,n){var o,i="",r={headerContainer:n.querySelector(".title-container"),tileContainer:n.querySelector(".my-node-container")},a=function(n,o,r,a){var s,l,d,c,u,p=Array.isArray(n)?n:[n],f=new e.Element("div",{class:"my-node-line"}),m=0,h=100/p.length;e.is(o)&&(({headerBackgroundColor:s,headerTextColor:l,tileBackgroundColor:d,tileTextColor:c}=le(t,o)),(u=p.filter(t=>e.is(t.maxWidth))).forEach(e=>m+=parseInt(e.maxWidth)),m<100&&(h=(100-m)/(p.length-u.length))),p.forEach(function(n){var o,u,p,m="",g=h,y="12px",w=new e.Element("span",{class:"my-node-word"});n.fontSize&&D(n.fontSize)&&(y=n.fontSize),n.maxWidth&&(g=n.maxWidth),s&&a.headerContainer.setStyles({backgroundColor:s}),d&&a.tileContainer.setStyles({backgroundColor:d}),r.className.contains("sub-title")?(p=n.color?n.color:c||"#3d3d3d",n.fontWeight&&(u=n.fontWeight)):(p=n.color?n.color:l||"#fff",u="bold"),o=e.is(n.dicoType)?n.dicoType+"."+n.name:n.name,e.is(t[o])&&(n.displayTitle&&(m=n.title+" : "),e.is(t[o],"object")?m+=t[o].value+" "+t[o].unit:"NULL"!==t[o]?m+=t[o]:m+=""),""===m?w.destroy():(w.setText(m),w.setStyles({fontWeight:u,color:p,maxWidth:g+"%",fontSize:y}),i+=m,i+=" ",w.inject(f))}),e.is(f)&&(""!==f.innerText&&(i+="\n"),f.inject(r))};h.title&&((o=n.querySelector(".title-container")).innerHTML="",a(h.title,h.colors,o,r)),h.subtitles&&((o=n.querySelector(".sub-title-container")).innerHTML="",h.subtitles.forEach(function(e){a(e,h.colors,o,r)})),n.tooltipInfos=new ge({shortHelp:i})},L=function(t,n,o){var r=new ue.Node,a=t.id;return a=a.replace(new RegExp(",","g"),"_"),r.views.main=new i,r.model=t,r.PID=t.id,r.id="node_"+a,r.multiset("left",n,"top",o,"width",250,"height",90),O(r),i.prototype.buildNodeElement=function(t){var n,o,i;return e.is(t)&&(o=t.model.tileInfo,(n=E()).addClassName("egraph_views_HTMLNodeView_Node "+o.className+" "+t.model.id),e.is(o.icon)&&e.is(o.icon.iconPath)&&(i=n.getElementsByClassName("my-node-type-img")[0],e.is(i)&&(i.crossOrigin="Anonymous",i.src=o.icon.iconPath,e.is(h.options.displayIcon)&&"Disabled"===h.options.displayIcon&&(i.style.display="none",n.getElementsByClassName("sub-title-container")[0].style.paddingLeft="20px")))),e.is(o)&&e.is(o)&&Q(o,n),n},r},F=function(){var t,n,o=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","svg")),i=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","defs")),r=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","marker")),a=e.extendElement(document.createElementNS("http://www.w3.org/2000/svg","path"));o.appendChild(i),i.appendChild(r),r.appendChild(a),o.setAttribute("width","0"),o.setAttribute("height","0"),o.setAttribute("style","position:absolute;"),r.setAttribute("id","arrow-edge-end-marker"),r.setAttribute("markerWidth","10"),r.setAttribute("markerHeight","8"),r.setAttribute("refX","8"),r.setAttribute("refY","4"),r.setAttribute("orient","auto"),a.setAttribute("d","M 0 0 L 10 4 L 0 8"),a.setAttribute("fill","#777"),a.setAttribute("stroke","none"),a.setAttribute("z-index","10"),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker"),i.appendChild(t),(n=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-timeConstraintMarker"),i.appendChild(n),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-QuantityDistribution"),i.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Failed"),i.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Alternative"),i.appendChild(t),(t=r.cloneNode(!0)).setAttribute("id","arrow-edge-end-productFlowMarker-Scrapped"),i.appendChild(t),(S=e.createElement("div",{class:"canvas-gv",id:"canvas-"+P})).addEvent("contextmenu",function(t){e.Event.stop(t)}),S.appendChild(o)},Z=function(e){pe.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments),this.display.elt.id=Math.random(),this.display.elt.textContent="official",this.display.elt.setAttribute("data-link-type-nls",e.mark.linkInfo.NLS),this.display.elt.setAttribute("data-link-from",e.mark.fromNodeId),this.display.elt.setAttribute("data-link-to",e.mark.toNodeId),this.display.elt.setAttribute("data-link-category",e.mark.linkInfo.flowType||"Good"),this.display.elt.setAttribute("data-link-isProductFlow",e.mark.linkInfo.isProductFlow),h.options.displayInfoOnFlow&&("Disp_Info_Description"===h.options.displayInfoOnFlow?re(this,e,"description"):"Disp_Info_ReasonCode"===h.options.displayInfoOnFlow&&re(this,e,"reasonCode"))},se=function(e){var t;return(t=new fe.StateMachine(e,null,null,e.views.main)).rootState&&($&&(t.rootState.doubleClickOnNode=$),t.rootState.oncontextmenu=C,t.rootState.onmouseup=c),t.state.onwheel=function(e,t){if(t.inside){const n=e.graphView;if(n.zoominc){const e=S.getBoundingClientRect();n.zoominc(.5*t.wheelDelta,t.clientPos[0]-e.x,t.clientPos[1]-e.y)}}},t},A=function(){var e;return me.inherit(i,pe.HTMLNodeView),me.inherit(o,pe.SVGEdgeView),o.prototype.oncreateDisplay=Z,(e=new ue.EGraph).setViewOpts({addTopologicalIds:!0}),e.addView("main",new pe.HTMLGraphView(S)),e.setZoomOpts({customMgt:!0}),e.updateLock(),e},V=function(){var e,t,n;for(n=new me.BoundingRect,e=k.nodes.first;e;e=ue.dftNext(k,e))"node_page_aspect_ratio"!==e.id&&n.update(e,e.actualLeft-300,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);t=me.reframeViewpoint(k.views.main.getSize(),n,{padding:15,minSize:50,horizontal:-1,vertical:-1,aliasing:0,defaultVpt:k.views.main.vpt,maxScale:1}),k.views.main.setViewpoint(t,!0)},b=function(){var t,n,o,i=!0;k.addChangeListener(function(l){var d,c,u,p,f,h,g={},y=[],P=!1;if("edges"===l[0].path[0]&&(e.is(w[0])&&"LinearProductFlowCnx"===w[0].linkType&&(P=!0),d=l[0].child.cl2.c,c=l[0].child.cl1.c,null!==d&&null!==c&&e.is(d.node.model)&&e.is(c.node.model)&&!P)){if(c.node.PID===d.node.PID&&c.id!==d.id){if(null!==(u=l[0].child.prev)){for(f=u;f;f=f.prev)f.cl2.c.id!==c.id&&f.cl1.c.id!==c.id||!e.is(f.mark)||y.push(f);1===y.length?null!==(h=y[0])&&e.is(h.mark)&&(h.mark.toNodeId===d.node.model.id?(h.join(null,l[0].child,null,c),g[ye]=h.mark.startAnchorPos,p=s(h.mark,d.id,!1),g[we]=p.anchorPositionValue,e.is(g)&&e.is(r,"function")&&r(h.mark.id,g,!1)):h.mark.fromNodeId===d.node.model.id&&(h.join(l[0].child,null,c,null),p=s(h.mark,d.id,!1),g[ye]=p.anchorPositionValue,g[we]=h.mark.endAnchorPos,e.is(g)&&e.is(r,"function")&&r(h.mark.id,g,!1))):y.length>1&&e.is(a,"function")&&a()}}else e.is(l[0].child.geometry)||!N||m||N(c.node.model,d.node.model,c.id,d.id);setTimeout(function(){if(e.is(S))for(t=S.getElements("path"),n=0;n<t.length;n++)"official"!==(o=t[n]).innerHTML&&("none"===window.getComputedStyle(o).getPropertyValue("marker-end")&&(o.parentElement.id.contains("arrow-edge-end-")||o.parentElement.removeChild(t[n])))},500)}i||(i=l.some(function(e){return"selection"===e.path[0]}))}),k.addListener("update",function(){var t,n,o,r,a,s=[];if(i&&!m){if(i=!1,ve)return void(ve=!1);for(a=e.clone(be,!0),be={},t=k.selection.first;t;t=t.nextSel)n=t.model,be[t.PID]||(be[t.PID]=!0),a[t.PID]||(o=n);for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&!be[r]&&s.push(r);q&&(e.is(o)||s.length>0)&&q(o,s)}c()})},B=function(e){var t,n={},o=0;for(e=Array.isArray(e)?e:[e],t=k.nodes.first;t&&(e.indexOf(t.PID)>-1&&(n[t.PID]=t,o++),o!==e.length);t=ue.dftNext(k,t));return n},H=function(t){var n,o=[];for(t=Array.isArray(t)?t:[t],n=k.edges.first;n;n=n.next)e.is(n.mark)&&t.indexOf(n.mark.id)>-1&&o.push(n);return o},U=function(){w.forEach(function(t){var n,o,i,r=B([t.fromNodeId,t.toNodeId]);i=function(e,n){switch(e){case"North":return 0===n?r[t.fromNodeId].connectors.top:r[t.toNodeId].connectors.top;case"South":return 0===n?r[t.fromNodeId].connectors.bottom:r[t.toNodeId].connectors.bottom;case"East":return 0===n?r[t.fromNodeId].connectors.right:r[t.toNodeId].connectors.right;case"West":return 0===n?r[t.fromNodeId].connectors.left:r[t.toNodeId].connectors.left;default:return 0===n?r[t.fromNodeId].connectors.right:r[t.toNodeId].connectors.left}},e.is(t.startAnchorPos)&&e.is(t.endAnchorPos)?(n=i(t.startAnchorPos,0),o=i(t.endAnchorPos,1)):(n=r[t.fromNodeId].connectors.right,o=r[t.toNodeId].connectors.left),r[t.toNodeId].model.isLoopNode&&(o=r[t.toNodeId].connectors.left),r[t.fromNodeId].model.isLoopNode&&(n=r[t.fromNodeId].connectors.right),e.is(n)&&e.is(o)&&_(n,o,t)})},j=function(){var t,n={},o={},i=[],r=0,a={},s={},l={};w.forEach(function(t){e.is(l[t.fromNodeId])||(l[t.fromNodeId]=[]),l[t.fromNodeId].push(t.toNodeId)}),y.forEach(function(t){var a=t.xPos,s=t.yPos,l=t.id,d=a+","+s;e.is(a)&&e.is(s)&&(0===a&&0===s?(r++,e.is(n[d])?i.push(t):(n[d]=l,o[l]={vertical:a,horizontal:s})):(n[d]=l,o[l]={vertical:a,horizontal:s}))}),r===y.length&&(i=y,n={},o={}),i.forEach(function(t){!function t(n,o){var i=o;e.is(a[n])?i=a[n]:a[n]=i,e.is(l[n])&&l[n].forEach(function(n){e.is(a[n])||(t(n,i+1),s[n]=!1)}),0===i&&(s[n]=!0)}(t.id,0)}),(s=e.Object.keys(s).filter(function(e){return s[e]})).forEach(function(i){!function i(r,s){var d;for(t=a[r];e.is(n[t+","+Ie]);)Ie++;e.is(l[r])&&(d=l[r].find(function(e){return s.indexOf(e)>-1})),e.is(d)&&(y.find(function(e){return e.id===r}).isLoopNode=!0,Ie++),n[t+","+Ie]=r,o[r]={horizontal:t,vertical:Ie},e.is(d)&&Ie++,e.is(l[r])&&l[r].forEach(function(t){e.is(o[t])||i(t,s.concat([t]))})}(i,[i]),Ie++}),y.forEach(function(e){var t,n,i;i=150*o[e.id].vertical,n=450*o[e.id].horizontal,t=L(e,n,i),k.addNode(t)})},G=function(){return y.some(function(t){return-1===Ne.indexOf(t.PPRType)&&Ne.push(t.PPRType),e.is(t.parentId)})?"HIERARCHY":"SEQUENCE"},T=function(){if(!e.is(k)){k=A(),x=se(k),g=G();try{W()&&j(),U(),J()}finally{k.updateUnlock()}b(),V()}},z=function(t){var n,o,i,a,l,d={},c=B([t.fromNodeId,t.toNodeId]);2===e.Object.keys(c).length&&(e.is(t.startAnchorPos)&&e.is(t.endAnchorPos)?(i=t.startAnchorPos,a=t.endAnchorPos):""!==t.startAnchorSelectedId&&""!==t.endAnchorSelectedId?(i=t.startAnchorSelectedId,a=t.endAnchorSelectedId):(i=c[t.fromNodeId].gr.edges.last.cl1.c.id,a=c[t.toNodeId].gr.edges.last.cl2.c.id),n=(l=s(t,i,!0)).connectorValue,d[ye]=l.anchorPositionValue,o=(l=s(t,a,!1)).connectorValue,d[we]=l.anchorPositionValue,e.is(n)&&e.is(o)&&e.is(d)&&e.is(r,"function")&&(_(n,o,t),e.is(t.startAnchorPos)||e.is(t.endAnchorPos)||r(t.id,d,!1)))},X=function(e){var t;try{W()&&(k.updateLock(),t=L(e,0,150*Ie),Ie++,k.addNode(t))}finally{k.updateUnlock()}},Y=function(e){var t,n=B([e]);for(t in n)n.hasOwnProperty(t)&&k.removeNode(n[t])},K=function(t,n){var o=B([t]);o=o[t],e.is(o)&&(o.model=e.extend(o.model,n),Q(o.model.tileInfo,o.view.elts.node))},ae=function(e){var t,n=B([e]);for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(be[t]=!0,ve=!0,k.addToSelection(n[t]))},J=function(){y.forEach(function(e){e.preSelected&&ae(e.id)}),ve=!1},R=function(){var e,t,n,o=[];for(e=k.nodes.first;e;e=ue.dftNext(k,e))n=Math.round(e.left/450),t=Math.round(e.top/150),o.push({instancePID:e.model.instancePID,x:t,y:n});return o},s=function(e,t,n){var o,i,r=B([e.fromNodeId,e.toNodeId]);return t.includes("top_node")||t.includes("North")?(o=n?r[e.fromNodeId].connectors.top:r[e.toNodeId].connectors.top,i="North"):t.includes("left_node")||t.includes("West")?(o=n?r[e.fromNodeId].connectors.left:r[e.toNodeId].connectors.left,i="West"):t.includes("bottom_node")||t.includes("South")?(o=n?r[e.fromNodeId].connectors.bottom:r[e.toNodeId].connectors.bottom,i="South"):(t.includes("right_node")||t.includes("East"))&&(o=n?r[e.fromNodeId].connectors.right:r[e.toNodeId].connectors.right,i="East"),{connectorValue:o,anchorPositionValue:i}},te=function(){var t,n="",o="",i="",r="";for(e.is(k.edges)&&(o=ne()),e.is(h.options.displayInfoOnFlow)&&("Disp_Info_Description"===h.options.displayInfoOnFlow?i="description":"Disp_Info_ReasonCode"===h.options.displayInfoOnFlow&&(i="reasonCode")),t=k.edges.first;t;t=t.next){var a,s,l,d,c;e.is(t)&&(s=Math.round(t.cl1.c.left),l=Math.round(t.cl1.c.top),d=Math.round(t.cl2.c.left),c=Math.round(t.cl2.c.top),e.is(t.mark)&&(e.is(t.mark.linkInfo)&&(a=e.is(t.mark.linkInfo.flowType)?t.mark.linkInfo.flowType:e.is(t.mark.linkInfo.isProductFlow)&&!1===t.mark.linkInfo.isProductFlow?"TimeConstraint":"Good",t.mark.linkInfo.hasOwnProperty(i)&&(r=e.is(t.mark.linkInfo[i])&&"NULL"!==t.mark.linkInfo[i]?t.mark.linkInfo[i]:"")),n+=ee(s,l,d,c,a,r)))}return n=o+n},ne=function(){return"<defs>\n    <marker \n      id='Alternative' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#52957a\" stroke= \"#52957a\"/>\n    </marker>\n  </defs>\n  \n  <defs>\n    <marker \n      id='Scrapped' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#cfc661\" stroke= \"#cfc661\"/>\n    </marker>\n  </defs>\n\t\t\t\t\n   <defs>\n    <marker \n      id='Failed' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#bb7052\" stroke= \"#bb7052\"/>\n    </marker>\n  </defs>\n\t\t\t\t\n\t<defs>\n    <marker \n      id='Good' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"blue\" stroke= \"blue\"/>\n    </marker>\n  </defs>\n\n  <defs>\n    <marker\n      id='QuantityDistribution'\n      orient=\"auto\"\n      markerWidth='10'\n      markerHeight='8'\n      refX='10'\n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#800080\" stroke= \"#800080\"/>\n    </marker>\n  </defs>\n\n  <defs>\n    <marker \n      id='TimeConstraint' \n      orient=\"auto\" \n      markerWidth='10' \n      markerHeight='8' \n      refX='10' \n      refY='4'\n    >\n      <path d='M 0 0 L 10 4 L 0 8' fill=\"#03e4d8\" stroke= \"#03e4d8\"/>\n    </marker>\n  </defs>"},ee=function(e,t,n,o,i,r){var a;return"Alternative"===i?a="#52957a":"Scrapped"===i?a="#cfc661":"Failed"===i?a="#bb7052":"Good"===i?(i="Good",a="blue"):"QuantityDistribution"===i?a="#800080":(i="TimeConstraint",a="#03e4d8"),`<path\n    id='ID_${i}'\n    marker-end='url(#${i})'\n    stroke-width='3'\n    fill='${a}' stroke='${a}'  \n    d='M${e},${t}, ${n} ,${o}'/> \n    <text>\n      <textPath xlink:href='#ID_${i}' startOffset='50%' style='text-anchor:middle' alignment-baseline='text-after-edge'>${r}</textPath>\n     </text>`},oe=function(e){var t=document.createElement("canvas");return e.crossOrigin="Anonymous",t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")},ie=function(t,n){var o="",i="";return e.is(t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var r,a="";r=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,e.is(n[r])&&(t.displayTitle&&(a=t.title+" : "),e.is(n[r],"object")?a+=n[r].value+" "+n[r].unit:"NULL"!==n[r]?a+=n[r]:a+="",o+=a,""!==a&&(o+=" ")),""!==a&&(i+=a,i+="\n")}),{lineText:o,tooltipSVG:i}},ce=function(t,n){var o;return e.is(n)&&(o=le(t,n)),o},de=function(t){var n=!0;return e.is(t.options)&&(n=!e.is(t.options.displayIcon)||"Disabled"!==t.options.displayIcon),n},l=function(){var t,n;return k.updateLock(),d||(n=function(){pe.HTMLNodeView.call(this)},me.inherit(n,pe.HTMLNodeView),(t=new ue.Node).views.main=new n,t.PID="page_aspect_ratio",t.id="node_"+t.PID,n.prototype.buildNodeElement=function(){var n=e.createElement("div");return n.addClassName("egraph_views_HTMLNodeView_Node "+t.id),n.setStyles({"pointer-events":"none","border-color":"black","border-style":"dashed","border-width":"medium","border-radius":"0",background:"0",position:"absolute"}),n},d=t),Pe?Y(d.PID):k.addNode(d),Pe=!Pe,k.updateUnlock(),Pe},c=function(){var e,t,n,o,i,r,a;if(Pe){for(t=new me.BoundingRect,e=k.nodes.first;e;e=ue.dftNext(k,e))"node_page_aspect_ratio"!==e.id&&t.update(e,e.actualLeft,e.actualLeft+e.actualWidth,e.actualTop,e.actualTop+e.actualHeight);i=p/f,o=Math.abs(t.xmax-t.xmin),(n=Math.abs(t.ymax-t.ymin))>o?(r=n/i,t.xmin+r<t.xmax?n=o*i:o=r):(a=o*i,t.ymin+a<t.ymax?o=n/i:n=a),o+=40,n+=40,d.multiset("left",t.xmin-20,"top",t.ymin-20,"width",o,"height",n)}},u=function(e,t){isNaN(e)||isNaN(t)||(p=e,f=t,c())},{init:function(){F()},inject:function(e){S.inject(e)},createGraphComponent:function(){T()},refreshNodeLinks:function(e,t){var n=H(e);this.removeLink(e),n.forEach(function(e){e.mark.startAnchorPos=t[ye],e.mark.endAnchorPos=t[we],z(e.mark)})},destroy:function(){S.remove(),S.destroy(),S=void 0},addLink:function(e){z(e)},removeLink:function(e){H(e).forEach(function(e){e.remove()})},addNode:function(e){X(e)},removeNode:function(e){Y(e)},selectNode:function(e){ae(e)},generateSVGForGraph:function(){var t,n,o=-1,i="",r=0,a=0,s=-50,l=-25;for(t=k.nodes.first;t;t=ue.dftNext(k,t)){var d,c,u,p,f,m,g,y,w,P,I,v,b,N,x,E="",A=50,C=40,L=[],D="",S="",T="",V="",F="";"node_page_aspect_ratio"!==t.id&&(g=Math.round(t.left),y=Math.round(t.top),P=g,I=y,s=g<s?g:s,l=y<l?y:l,r=g>r?g:r,a=y>a?y:a,o++,!0===(c=de(h))?(b=document.getElementsByClassName("my-node-type-img")[o],e.is(b)&&(E=oe(b),S=`<image x="${P+5}" y="${I+25}" width="65" height="65" style="image-rendering:optimizeQuality" xlink:href="${E}"/>`)):A=10,v=t.model.id,n=t.model.tileInfo,d=ce(n,h.colors),u=e.is(d.headerBackgroundColor)?d.headerBackgroundColor:"#3d3d3d",p=e.is(d.headerTextColor)?d.headerTextColor:"#fff",f=e.is(d.tileBackgroundColor)?d.tileBackgroundColor:"#f1f1f1",m=e.is(d.tileTextColor)?d.tileTextColor:"black",h.title&&(x=ie(h.title,n),e.is(x.lineText)&&(w=x.lineText).length>48&&(V="240"),e.is(x.tooltipSVG)&&(F+=x.tooltipSVG,F+="\n")),x="",h.subtitles&&h.subtitles.forEach(function(t){x=ie(t,n),e.is(x.lineText)&&""!==(N=x.lineText)&&L.push(N),e.is(x.tooltipSVG)&&""!==x.tooltipSVG&&(F+=x.tooltipSVG,F+="\n")}),L.forEach(e=>{T=e.length>40&&!0===c?"195":!1===c&&e.length>47?"235":"",D+=""!==T?`<text x="${P+A}" y="${I+C}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${m}" textLength="${T}" lengthAdjust="spacingAndGlyphs">${e}</text>`:`<text x="${P+A}" y="${I+C}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${m}">${e}</text>`,L.length<=4?C+=15:C+=10}),i=i+(`<g>\n\t\t\t\t\t <rect x="${P}" y="${I}" width="250" id="${v}" height="90" rx="3" ry="3" stroke="grey" stroke-width="1" fill="${f}" />\n                     <title>${F}</title>\n\t\t\t\t\t <rect x="${P}" y="${I}" width="250" id="${v}" height="20" rx="3" ry="3" fill="${u}" />`+(""!==V?`<text x="${P+5}" y="${I+13}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${p}" textLength="${V}" lengthAdjust="spacingAndGlyphs">${w}</text>`:`<text x="${P+5}" y="${I+13}" text-anchor="left" font-family="sans-serif" font-weight="bold" font-size="10" fill="${p}">${w}</text>`)+`<circle cx="${P}" cy="${I+45}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                     <circle cx="${P+250}" cy="${I+45}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                     <circle cx="${P+125}" cy="${I}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>\n                     <circle cx="${P+125}" cy="${I+90}" r="5" stroke="grey" stroke-width="1" fill="lightgrey"/>`+S+D)+"</g>")}return-1===Math.sign(s)&&(r+=Math.abs(s),s+=-30),-1===Math.sign(l)&&(a+=Math.abs(l),l+=-15),i=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="${s} ${l} ${r+500} ${a+180}">`+i+te()+"</svg>"},unselectNode:function(e){var t,n=B([e]);for(t in n)n.hasOwnProperty(t)&&n[t].isSelected()&&be[t]&&(be[t]=!1,ve=!0,k.removeFromSelection(n[t]))},updateNode:function(e,t){K(e,t)},resizeTheGraph:function(){V()},getCurentTilePosition:function(){return R()},getGraphDefaultToolbar:function(t){var n;return e.is(k)&&e.is(x)&&(t=Array.isArray(t)?t:e.is(t)?[t]:[],n=x.generateToolbarModel(t)),n},togglePageAspectRatio:function(){return l()},updatePageAspectRatioValues:function(e,t){return u(e,t)}}}}),define("DS/DELPPWProductFlowSequenceModule/GraphPanel",["UWA/Core"],function(e){"use strict";return function(t,n){var o,i,r,a,s,l,d=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext()),c=n.create("Element","div",{class:"EGraphView-panel-container"}),u=d.getImmersiveFrame(),p={};return o=function(){var e,t;i=n.create("Panel",{domId:r,identifier:"panel-EGraph"+r,position:{my:"center",at:"center"},title:a,immersiveFrame:u,content:c,minWidth:290,minHeight:250,width:700,height:400,snappableFlag:!1,resizableFlag:!0,closeButtonFlag:!0,useBordersFlag:!0,visibleFlag:!1,collapsibleFlag:!0,verticallyStretchableFlag:!0}),e=(window.screen.width-i.width)/2,t=(window.screen.height-i.height)/2,i.elements.container.style.left=e+"px",i.elements.container.style.top=t+"px",i.close=function(){s?s():i.hide()}},{init:function(t){p=e.extend(p,t),r=e.is(t.identifier)?t.identifier:"",a=e.is(t.title)?t.title:"",s=e.is(t.onClose,"function")?t.onClose:null,l=e.is(t.className)?t.className:""},destroy:function(){e.is(i)&&(i.destroy(),i=void 0)},show:function(){e.is(i)&&!1===i.visibleFlag&&i.show()},hide:function(){i.hide()},getContainer:function(){return c},buildSkeleton:function(){o(),c.addClassName(l)}}}}),define("DS/DELPPWProductFlowSequenceModule/ProductFlowSequenceModule",["UWA/Core","DS/DELPPWProductFlowSequenceModule/ProductFlowComponent","DS/DELPPWProductFlowSequenceModule/GraphPanel","DS/VENPPWDomToImageModule/DOMToImage","text!DS/DELPPWProductFlowSequenceModule/assets/json/ProductFlowCustomParams.json"],function(e,t,n,o,i){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","ResourceBehavior","SelectionBehavior","EditAttributeBehavior","LinkBehavior","ProductFlowLinkBehavior","RootsBehavior","DocumentBehavior"],creator:function(o,r,a,s,l,d,c,u,p,f){var m,h,g,y,w,P,I,v,b,N,k,x,E,A,C=["OPERATION","SYSTEM"],L=!1,D=!1,S=!1,T=r.getComponent("Breadcrumb"),V=r.getComponent("GeneratedToolbar"),F=r.getComponent("ModalContainer"),R=r.getComponent("TooltipModel"),M=r.create("WUXLoader",{showButtonFlag:!1}),O=e.createElement("div",{class:"pert-loading-cont"}),_=r.getComponent("WUXCommandsManager"),B=u.getProductFlowRelationTypes(),G=function(){var t,n=new Map,i=!0;e.is(y)&&((t=y.getCurentTilePosition()).every(function(e){var t=e.x+","+e.y;return n.has(t)?(i=!1,o.warn(s.getNLSValue("ProductFlowLinkBehavior.TilePosition.Overlap")),!1):(n.set(t,!0),!0)}),i&&u.saveTilePositions(t))},W=function(e){var t,n;f.fetchDocuments(P,function(o){t=o.map(function(e){return e.get("dataelements").title}),n=t.some(function(e,n){return t.indexOf(e)!==n}),e({isValid:n,values:t,documents:o})})},$=function(){var t;e.is(y)&&(t=y.generateSVGForGraph());const n=new Blob([t],{type:'image/svg+xml;base64," + BinaryToBase64(ImageBinary)'}),i=new File([n],"Export_PFDView.svg",{type:'image/svg+xml;base64," + BinaryToBase64(ImageBinary)'});W(function(t){var n;t.isValid?o.warn(s.getNLSValue("ProductFlowView.MultipleDocIssue")):-1!==(n=t.values.indexOf("Export_PFDView"))?f.modifyFile({id:t.documents[n].get("id")},{file:i,fileName:"Export_PFDView.svg"},"Export_PFDView"):f.uploadDocument(P,{title:"Export_PFDView",policy:"Document Release",description:""},[{comments:"",file:i}],function(){var t,n;t="download",n=A,e.is(n)&&n.items.getChildren().forEach(function(e){e.options.id===t&&e.updateOptions({disabled:!1})})})})},U=function(){W(function(e){var t;e.isValid?o.warn(s.getNLSValue("ProductFlowView.MultipleDocIssue")):-1!==(t=e.values.indexOf("Export_PFDView"))?f.downloadDocument(e.documents[t].get("id")):o.warn(s.getNLSValue("ProductFlowView.DocNotAvailableIssue"))})},j=function(){var t=!1,n=[];e.is(y)&&e.is(k.pageAspectRatio)&&k.pageAspectRatio.length>0&&(y.updatePageAspectRatioValues(k.pageAspectRatio[0].height,k.pageAspectRatio[0].width),t=y.togglePageAspectRatio(),n=k.pageAspectRatio.map(e=>e.label),t?A.updateNodeModel("aspectRatioComboBox",{visibleFlag:!0,disabled:!1,value:n[0],possibleValues:n}):A.updateNodeModel("aspectRatioComboBox",{visibleFlag:!1,disabled:!0}))},H=function(t){var n;e.is(k.pageAspectRatio)&&(n=k.pageAspectRatio.find(e=>e.label===t.getAttributeValue("data")),e.is(y)&&e.is(n)&&y.updatePageAspectRatioValues(n.height,n.width))},z=function(t){var n,o={entries:[]},i=e.is(t)?t:{},r=function(){return{id:"",dataElements:{typeRepresentation:"functionIcon",icon:{fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"2x",className:"action"},position:"far",category:"view"}}};ae(),b=e.createElement("div",{class:"egraph-toobar"}),Y(w.id,w.path).inject(b),y&&(o.entries.push(function(){let e=r();return e.id="aspectRatioComboBox",e.dataElements.typeRepresentation="customEnumMember",e.dataElements.disabled=!0,e.dataElements.visibleFlag=!1,e.dataElements.category="pageAspectRatio",e.onNodeUpdate=H,e}()),o.entries.push(function(){let t=r();return t.id="pageAspectRatio",t.dataElements.icon.iconName="group",t.dataElements.tooltip=new R({title:s.getNLSValue("GraphView.PageAspectRatio.Tooltip")}),t.dataElements.value=j,t.dataElements.category="pageAspectRatio",e.is(k)&&e.is(k.pageAspectRatio,"array")&&0!==k.pageAspectRatio.length||(t.dataElements.disabled=!0,t.dataElements.visibleFlag=!1),t}()),o.entries.push(function(t){var n=e.clone(t);switch(n.id){case"zoomFit":n.dataElements.tooltip=new R({title:s.getNLSValue("GraphView.FitInAll.Tooltip")})}return n}(y.getGraphDefaultToolbar({type:"ZoomFit",position:"far"}).entries[0])),o.entries.push(function(){let e=r();return e.id="refresh",e.dataElements.icon.iconName="refresh",e.dataElements.tooltip=new R({title:s.getNLSValue("GraphView.Refresh.Tooltip")}),e.dataElements.value=de,e}()),x||(o.entries.push(function(){let e=r();return e.id="screenshot",e.dataElements.tooltip=new R({title:s.getNLSValue("GraphView.Capture.Tooltip")}),e.dataElements.icon.iconName="camera",e.dataElements.value=$,e}()),o.entries.push(function(){var e;e=(i.attachedDocuments||[]).map(function(e){return e.get("dataelements").title}).includes("Export_PFDView");let t=r();return t.id="download",t.dataElements.tooltip=new R({title:s.getNLSValue("GraphView.Download.Tooltip")}),t.dataElements.icon.iconName="download",t.dataElements.value=U,t.dataElements.disabled=!e,t}()),o.entries.push(function(){let e=r();return e.id="save",e.dataElements.icon.iconName="floppy",e.dataElements.tooltip=new R({title:s.getNLSValue("GraphView.SaveTilePosition.Tooltip")}),e.dataElements.value=G,e}())),n=V.prototype.createTreeDocument(o),(A=new V({overflowManagement:"dropdown",direction:"horizontal",items:n})).elements.container.addClassName("graph-right-actions"),A.inject(b)),b.inject(N,"top")},X=function(t){var n=t.model,o={objectId:n.referencePID};e.is(E)&&(o.filterQuery=E),se(o).then(function(){w.id=e.is(n.instancePID)?n.instancePID:n.referencePID,w.path=n.occcurancePath,de()})},Y=function(t,n){var i,r,l,d,c,u=e.createElement("div",{class:"egraph-navigator"}),p=[],f=function(e,t,n){l&&p.unshift({label:l.get("PLMEntity.V_Name"),icon:{iconPath:s.getIconURLFromKey(l.get("type")),iconSize:{width:"20px",height:"20px"}},id:t,path:n})};if(e.is(n,"string")&&(n=n.split(",")),0===n.length)f(0,(l=a.getReference(t)).get("PID"),[]);else for(c=n.length-1;c>=0;c--)d=n[c],l=a.getReferenceModel(d),f(0,d,n.slice(0,c+1)),0===c&&(r=a.getInstance(d),f(0,(l=a.getAggregatingReferenceModelFromInstance(r)).get("PID"),[]));return p.length>0&&(i=new T({value:p,mode:T.MODE.NAVIGATION})).addEventListener("selectionChange",function(){var e;o.notify("EGraphNodeSelect",{selectedNodeIds:[w.id]}),D=!0,e=i.selectedValues[0],w=e,de()}),i.inject(u),u},q=function(t,n){var o={},i=function(o,i){var r,a;return e.is(n)&&(r=n.get(o)),"type"===o&&(r=t.get(o),i&&(r=s.getNLSValue("Type."+r))),e.is(t.get(o),"string")&&"true"===t.get(o).toLowerCase()?r=!0:e.is(t.get(o),"string")&&"false"===t.get(o).toLowerCase()&&(r=!1),r="NULL"!==r&&e.is(r)?r:t.get(o),e.is(r)&&i&&(a=c.getAttributeNLSForUnit(o),e.is(a)&&""!==a&&(r+=" "+a)),r};return o.className=" EGraph_obj_"+t.get("PPRTYPE"),o.icon={iconPath:s.getIconURLFromKey(t.get("type"))},[I.title].concat(I.subtitles).forEach(function(t){(Array.isArray(t)?t:[t]).forEach(function(t){var n,r;r=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,n=i(r,!0),e.is(n)&&(o[r]=n)})}),e.is(k)&&e.is(k.colors)&&k.colors.colorParamsList.forEach(function(t){var n,r;e.is(t.name)&&(n=i(t.name,!1),e.is(n)&&(e.is(o[t.name])?(r=c.getAttributeNLSForUnit(t.name),e.is(r)&&""!==r&&(o[t.name]={value:n,unit:r})):o[t.name]=n))}),o},Q=function(t,n,i){var r,a,s=t.get("PPRTYPE");return r={id:i.toString(),PPRType:s,type:t.get("type"),instancePID:n.get("PID"),referencePID:t.get("PID"),occcurancePath:i,tileInfo:q(t,n)},a="OPERATION"===s?"DELLmiOperationInstance.":"SYSTEM"===s?"DELLmiProductionSystemInstance.":"",e.is(n.get(a+"V_X2DPos"))&&e.is(n.get(a+"V_Y2DPos"))?(r.xPos=Number(n.get(a+"V_X2DPos")),r.yPos=Number(n.get(a+"V_Y2DPos"))):(r.xPos=0,r.yPos=0,o.debug(n.get("PID")+" V_X2DPos, V_Y2DPos are missing ")),r},K=function(t,n){var o,i,r,s,d=[],u=[],f=[],m={sort:!0},h=[];return r=function(e,t){return e.some(function(e){return e.id===t})},s=function(e){return l.getSelectedInsts().findIndex(function(t){return t.get("isAggregatedBy")===o.get("PID")&&t.get("PID")===e})>-1},o=a.getReferenceModel(t),((i=function(){var t,n,o;return e.is(E)?t=E:e.is(w)&&(0===w.path.length?n=w.id:(o=a.getInstance(w.path[0]),n=(o=a.getReference(o.get("isAggregatedBy"))).get("PID")),n&&(t=p.getRootFilter(n),t=e.is(t)&&e.is(t.originalFilterQuery)?t.originalFilterQuery:void 0)),t}())?a.getFilteredInstancesFromCollection(o.get("PID"),i,m):a.getInstancesFromCollection(o.get("PID"),m)).forEach(function(t){var o,i,r,l,c;l=t.get("PID"),c=n.concat([l]),r=a.getReferenceModelFromInstance(t),e.is(r)&&C.indexOf(r.get("PPRTYPE"))>-1&&(o=s(l),d.push(l),h.push({id:l}),(i=Q(r,t,c)).preSelected=o,f.push(i))}),function(t){return a.isNavigateOnDemand()?(t.push({id:w.id,path:w.path}),c.getRelations(t)):e.Promise.resolve()}(h).then(function(){return a.getImpactedConnections(d,!1,{relationTypes:B}).forEach(function(t){var n,o,i,a,s,l;f.every(function(i){return i.id.includes(t.get("from"))?n=i.id:i.id.includes(t.get("to"))&&(o=i.id),!(e.is(n)&&e.is(o))}),a=t.get("PID"),e.is(n)&&e.is(o)&&!r(u,a)&&(i=c.getLinkInfo(t),s=t.get("DELArrowDisplayExt.V_ArrowStartPosition"),l=t.get("DELArrowDisplayExt.V_ArrowEndPosition"),u.push({id:a,fromNodeId:n,toNodeId:o,linkType:t.get("type"),linkInfo:i,startAnchorPos:s,endAnchorPos:l}))}),{nodes:f,links:u}})},Z=function(t){var n=o.getAppContext();return{icon:"url("+s.getIconURLFromKey("DisplayProperties")+")",label:s.getNLSValue("Cmd.DisplayProperties.Title"),sensitivity:"enabled",callback:function(){var o=_.getCommandCheckHeader("DisplayProperties",n),i=a.getReferenceIdFromInstance(t.instancePID);e.is(o)&&!1===o.getState()&&(o.options.node={referencePID:i,instancePID:t.instancePID,absPath:t.occcurancePath},o.toggleState())}}},J=function(e){return[{icon:"url("+s.getIconURLFromKey("GeneralDelete")+")",label:s.getNLSValue("LinksUI.DeleteLink"),sensitivity:"LinearProductFlowCnx"!==e.linkType?"enabled":"disabled",callback:function(){var t=c.getConnection(e.id);c.deleteConnection(t,{onFailure:function(){o.warn(s.getNLSValue("LinksUI.DeleteFailure"))},onComplete:function(){o.info(s.getNLSValue("LinksUI.DeleteSuccess"))},logMessage:s.getNLSValue("LinksUI.LogMessage")})}},{icon:"url("+s.getIconURLFromKey("EditAttribute")+")",label:s.getNLSValue("LinksUI.EditAttribute"),sensitivity:d.hasEditConfiguration(e.id)?"enabled":"disabled",callback:function(){d.editConfiguredAttributes(e.id)}},{icon:"url("+s.getIconURLFromKey("EditAnchorPositions")+")",label:s.getNLSValue("LinksUI.EditAnchorPositions"),sensitivity:"LinearProductFlowCnx"!==e.linkType?"enabled":"disabled",callback:function(){u.editAnchorPositions(e.id)}}]},ee=function(t,n,i,r){var s={allowMove:!0},l=[];t&&(s.targetInstancePID=t.instancePID,s.targetInstancePIDsArray=t.occcurancePath,s.targetReferencePID=a.getReferenceIdFromInstance(t.instancePID),s.targetRootReferencePID=a.getInstance(t.occcurancePath[0]),s.targetRootReferencePID=e.is(s.rootReferencePID)?s.rootReferencePID.get("isAggregatedBy"):null,s.startAnchorId=i),n&&(s.instancePID=n.instancePID,s.instancePIDsArray=n.occcurancePath,s.referencePID=a.getReferenceIdFromInstance(n.instancePID),s.rootReferencePID=a.getInstance(n.occcurancePath[0]),s.rootReferencePID=e.is(s.targetRootReferencePID)?s.targetRootReferencePID.get("isAggregatedBy"):null,s.endAnchorId=r),"OPERATION"!==t.PPRType&&"SYSTEM"!==t.PPRType||"OPERATION"!==n.PPRType&&"SYSTEM"!==n.PPRType||(s.linkType=u.getProductFlowRelationTypeByTypes(t.type,n.type),e.is(s.linkType)&&(l.push(s),o.notify("CreateLinkOrInstance",[l])))},te=function(t,n){var i={};l.getSelections()[0].indexOf(w.id)>-1&&n.push(w.id),n.length>0&&(n=n.map(function(e){var t=e.split(",");return t[t.length-1]}),D=!0),i.selectedNodeIds=n,t&&(i.changed={nodeId:a.getReferenceIdFromInstance(t.instancePID),childOccurencePath:e.is(t.occcurancePath)?t.occcurancePath:null,isSelected:!0},L=!0),o.notify("EGraphNodeSelect",i)},ne=function(e,t,n){u.saveAnchorPositions(e,t,n)},oe=function(){o.warn(s.getNLSValue("ProductFlowLinkBehavior.AnchorPosition.MultiplePositionChange"))},ie=function(){e.is(v)&&he()},re=function(){e.is(y)&&(y.destroy(),y=void 0)},ae=function(){e.is(b)&&(b.destroy(),b=void 0)},se=function(t){return t=t||{},new Promise(function(n){var o,i,r={};e.is(m.forceFetch)&&m.forceFetch&&e.is(t.objectId)?(o=t.objectId,i=function(){e.is(N)&&(M.off(),F.removeModal(O),O.remove()),n()},e.is(N)&&(O.inject(N),F.createModal(O,M.elements.container),M.on()),e.is(m.expandLevel)&&(r.expandLevel=m.expandLevel),e.is(m.withLinks)&&(r.withLinks=m.withLinks),e.is(m.withLinksResolved)&&(r.withLinksResolved=m.withLinksResolved),e.is(m.relationTypes)&&(r.gridIDs=m.relationTypes),e.is(m.forceDBMode)&&(r.forceDBMode=m.forceDBMode),e.is(t.filterQuery)&&(r.filterQuery=t.filterQuery),a.getDescendantsFromServer([o],i,r)):n()})},le=function(){return K(w.id,w.path).then(function(e){h=e.nodes,g=e.links,P=a.isReference(w)?w.id:a.getReferenceIdFromInstance(w),re(),(y=new t(r,{nodes:h,links:g,readOnly:x,identifier:"PPR-PERTVIEW",nodeOptions:I,getNodeContextMenu:Z,getLinkContextMenu:J,onNodeDoubleClick:X,onConnectingNodes:ee,onNodeSelectionChange:te,onSaveAnchorPositions:ne,onMultiplePositionChangeAlert:oe})).init()})},de=function(){return le().then(function(){y.inject(N),y.createGraphComponent(),f.fetchDocuments(P,function(e){var t={};t.attachedDocuments=e||[],z(t)})})},ce=function(t,n,o){var i,r,a,s,l;S||Array.isArray(t)||(h.every(function(n){var o=t.get("from"),a=t.get("to");return o=Array.isArray(o)?o.join(","):o,a=Array.isArray(a)?a.join(","):a,n.id.includes(o)?i=n.id:n.id.includes(a)&&(r=n.id),!(e.is(i)&&e.is(r))}),e.is(i)&&e.is(r)&&(a=c.getLinkInfo(t),s=t.get("DELArrowDisplayExt.V_ArrowStartPosition"),l=t.get("DELArrowDisplayExt.V_ArrowEndPosition"),y.addLink({fromNodeId:i,toNodeId:r,id:t.get("PID"),linkType:t.get("type"),linkInfo:a,startAnchorPos:s,endAnchorPos:l,startAnchorSelectedId:e.is(o.startAnchorId)?o.startAnchorId:"",endAnchorSelectedId:e.is(o.endAnchorId)?o.endAnchorId:""})))},ue=function(e){(Array.isArray(e)?e:[e]).forEach(function(e){y.removeLink(e.get("PID"))})},pe=function(t){var n,o,i,r=t.get("isInstanceOf"),s=t.get("PID"),l=a.getReferenceIdFromInstance(w.id);l||(l=w.id),t.get("isAggregatedBy")===l&&(a.isSystem(r)||a.isOperation(r))&&(n=a.getReference(r),o=w.path.concat([s]),i=Q(n,t,o),y.addNode(i),h.push(e.clone(i)))},fe=function(e){(Array.isArray(e)?e:[e]).forEach(function(e){var t=w.path.concat([e.get("PID")]).toString();y.removeNode(t)})},me=function(t){var n=t.changed,o=n.absPath.toString();e.is(y)&&(n.isSelected?(L||y.selectNode(o),L=!1):(D||y.unselectNode(o),D=!1))},he=function(){de()},ge=function(e){y.refreshNodeLinks(e.linkPID,e.iAnchorPositionsToSet)},ye=function(){},we=function(){ae(),re()},Pe=function(){S=!0,re()},Ie=function(t){(t=Array.isArray(t)?t:[t]).forEach(function(t){var n=q(t);h.forEach(function(o,i){o.referencePID===t.get("PID")&&(h[i].tileInfo=e.clone(e.extend(h[i].tileInfo,n)),y.updateNode(h[i].id,h[i]))})})},ve=function(t){!e.is(w)||w.id!==t&&w.path[0]!==t||(S=!S&&S,a.getDescendantsFromServer([t],function(){e.is(b)||z(),de()},{expandLevel:1,forceDBMode:!0}))},be=function(t){var i,a;t.showPanel&&(i=s.getNLSValue(t.titleGraph),(v=new n(o,r,s)).init({title:i,identifier:"PPR-PERTVIEW",className:"PERTVIEW-panel-container",onClose:function(){e.is(t.toggleCmdId)?o.notify("toggleCmdCheckHeaderState",{cmdName:t.toggleCmdId,cmdState:!1}):v.hide()}}),N=v.getContainer(),a=l.getSelectionsWithPaths()[0][0],w={id:a.id,path:a.path},v.buildSkeleton(),v.show(),de())},Ne=function(t){var n;return t.displayAttributeName&&(t.displayTitle=!0,"type"===t.name?t.title=s.getNLSValue("Column.Type"):(n=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name,t.title=s.getNLSValue(n))),t};return{name:"ProductFlowViewModule",listenTo:function(){return{select:me,connectionAdded:ce,connectionRemoved:ue,instanceAdded:pe,instanceRemoved:fe,refreshImpacted:he,ExpandFilterApplied:he,Hide:ye,HideAll:we,refreshAll:Pe,refreshProductFlowView:ie,addRootNode:ve,referenceChanged:Ie,refreshNodeLinks:ge}},onStart:function(t,n){I={title:[],subtitles:[],options:[],colors:[]},m=t=t||{},function(t,n){a.webServiceGETRequest("resources/delmia/param/configuration/getAllParameters?domainID=DELUserExperience","GET",function(t){var o="DisplayInformationOnFlowCombobox",r="DisplayIconCheckbox",a="DELProcessFlowDiagramAttriutesListParam",s="DELProcessFlowDiagramColorListParam",l="DELProcessFlowDiagramAspectRatiosListParam";k={attributes:{displayInfoOnFlow:"",displayIcon:"",attributeList:[]},colors:{colorParamsList:[]},pageAspectRatio:[]},e.is(localStorage.getItem("isPO"))?k=e.Json.decode(i):e.is(t)&&t.length>0&&(t.forEach(function(t){switch(t.paramid){case o:k.attributes.displayInfoOnFlow=t.params.value;break;case r:k.attributes.displayIcon=t.params.value;break;case a:e.is(t.params.attributeName)&&t.params.attributeName.contains("BusinessType.")&&(t.params.attributeName=t.params.attributeName.slice(t.params.attributeName.indexOf(".")+1)),k.attributes.attributeList.push({rowIndex:t.params.rowIndex?t.params.rowIndex:null,mergeWithPreviousRow:t.params.mergeWithPreviousRow?t.params.mergeWithPreviousRow:null,name:t.params.attributeName?t.params.attributeName:null,displayAttributeName:t.params.displayAttribute?t.params.displayAttribute:null,maxWidth:t.params.maxWidth?t.params.maxWidth:null});break;case s:e.is(t.params.attributeName)&&(t.params.attributeName.contains("BusinessType.")&&(t.params.attributeName=t.params.attributeName.slice(t.params.attributeName.indexOf(".")+1)),"DicoType"===t.params.attributeName&&(t.params.attributeName="type")),k.colors.colorParamsList.push({graphicalElement:t.params.graphicalElement?t.params.graphicalElement:null,color:t.params.color?t.params.color:null,attributeValue:t.params.attributeValue?t.params.attributeValue:null,ruleNumber:t.params.ruleNumber?t.params.ruleNumber:null,name:t.params.attributeName?t.params.attributeName:null,attributeCondition:t.params.attributeCondition?t.params.attributeCondition:null});break;case l:k.pageAspectRatio.push({label:t.params.aspectRatioName,width:t.params.aspectRatioWidth,height:t.params.aspectRatioHeight})}}),0===k.attributes.attributeList.length&&(k.attributes.attributeList=[{rowIndex:"1",mergeWithPreviousRow:null,name:"PLMEntity.V_Name",displayAttributeName:null,maxWidth:"90"},{rowIndex:"2",mergeWithPreviousRow:!0,name:"revision",displayAttributeName:null},{rowIndex:"3",mergeWithPreviousRow:null,name:"PLMInstance.PLM_ExternalID",displayAttributeName:null},{rowIndex:"4",mergeWithPreviousRow:null,name:"DELLmiOperationReference.V_EstimatedTime",displayAttributeName:!0}])),e.is(n,"function")&&n()},function(){var n;e.is(t.displayNodeConfigXML)&&(n=c.getXMLValues(t.displayNodeConfigXML),e.is(n.Config.Preferences)&&e.is(n.Config.Preferences.Node)&&e.is(n.Config.Preferences.Node.Lines)&&e.is(n.Config.Preferences.Node.Lines.Line)&&n.Config.Preferences.Node.Lines.Line.forEach(function(e,t){var n=Array.isArray(e.Attribute)?e.Attribute:[e.Attribute];n=n.map(Ne),0===t?I.title=n:I.subtitles.push(n)})),be(t)})}(t,function(){var n=0,o=[];e.is(k)&&e.is(k.attributes.attributeList)&&(k.attributes.attributeList.sort((e,t)=>e.rowIndex-t.rowIndex),k.attributes.attributeList.forEach(function(e){if(e=Ne(e),1===parseInt(e.rowIndex)||0===n&&e.mergeWithPreviousRow)e.index=n,I.title.push(e);else if(e.mergeWithPreviousRow)e.index=n,o.push(e),parseInt(e.rowIndex)===k.attributes.attributeList.length&&I.subtitles.push(o);else{if(0!==n&&I.subtitles.push(o),parseInt(e.rowIndex)===k.attributes.attributeList.length)return void I.subtitles.push([e]);e.index=++n,o=[e]}}),k.attributes.displayInfoOnFlow&&(I.options.displayInfoOnFlow=k.attributes.displayInfoOnFlow),k.attributes.displayIcon&&(I.options.displayIcon=k.attributes.displayIcon)),e.is(k)&&e.is(k.colors.colorParamsList)&&(I.colors=k.colors.colorParamsList),be(t)}),n()},onStop:function(){e.is(y)&&(y.destroy(),y=void 0),e.is(v)&&(v.destroy(),v=void 0)},createSequence:function(e){return se(e).then(function(){var t=e.objectId;return w={id:t,path:[]},E=e.filterQuery,le()})},inject:function(e){N=e,y.inject(N),y.createGraphComponent(),z()},setReadOnly:function(e){x=e}}}}});