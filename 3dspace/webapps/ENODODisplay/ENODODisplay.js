define("DS/ENODODisplay/views/DOParametersDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Controls/ModalContainer","DS/Controls/Button","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json"],function(e,t,i,o,n,a,s,r,l){"use strict";var d=function(e,t){if(null==t)throw new Error(l.error.invalidFrame);if(!(e&&e.length>0))throw new Error(l.error.emptyParameter);this._parameters=e,this._parentContainer=t,this._dialog=void 0,this._parametersTable=void 0,this._modal=void 0,this.createDialog()};return d.prototype.constructor=d,d.prototype.getDialog=function(){return this._dialog},d.prototype.getParameters=function(){return this._parametersTable},d.prototype.createDialog=function(){this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_param_frame");var i=this.createParameters();this.okButton=new r({label:"OK",disabled:!1,allowUnsafeHTMLLabel:!1}),this.okButton.addEventListener("buttonclick",this.onClose.bind(this),!1);var o=this._parentContainer.getSize().width;o=o>50?o-30:o,this._dialog=new e({immersiveFrame:this._immersiveFrame,title:l.columns.parameter,content:i,activeFlag:!1,resizableFlag:!0,width:o,height:this._parentContainer.getSize().height/2,buttons:{Ok:this.okButton}}),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=s.createModal(this._parentContainer,this._immersiveFrame.getContent())},d.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,s.removeModal(this._parentContainer)},d.prototype.createParameters=function(){var e=UWA.createElement("div",{class:"doparameterview_content"}),t=new i,s=[],r=0;for(r=0;r<this._parameters.length;r++){var d=this._parameters[r];if(!d.hasOwnProperty("name")||!d.hasOwnProperty("value"))throw new Error(l.error.invalidParameter);var c={name:d.hasOwnProperty("displayName")?d.displayName:d.name,value:d.hasOwnProperty("displayValue")?d.displayValue:d.value};s.push(c)}t.prepareUpdate(),s.forEach(function(e){var i=new o({label:e.Text,grid:e});t.addRoot(i)}),t.pushUpdate();var u=[{text:l.columns.parameterName,dataIndex:"name",editableFlag:!1},{text:l.columns.parameterValue,dataIndex:"value",editableFlag:!1}];return this._parametersTable=new n({treeDocument:t,columns:u,rowSelection:"none",cellSelection:"none",showSelectionCheckBoxesFlag:"false",layout:new a({cellHeight:26,columnHeaderHeight:38,rowsHeader:!1})}),this._parametersTable.inject(e),e},d}),define("DS/ENODODisplay/model/SelectedObjectInfo",["UWA/Core","UWA/Controls/Abstract","UWA/Class"],function(e,t,i){"use strict";return i.extend({_cadOrigin:null,_kind:null,_owner:null,_phid:null,_title:null,_type:null,init:function(e){if(null===e)throw Error("object should have a physical Id");this._phid=e},getCAD:function(){return this._cadOrigin},getDOGenerationFilter:function(){var e={};return-1===["3DShape","Drawing","3DPart"].indexOf(this._kind)&&-1===["3DShape","Drawing","Document"].indexOf(this._type)||(e.CADMaster=this._cadOrigin,"Document"===this._type?e.Type=this._type:"VPMReference"===this.type||"3DShape"===this.type?e.type="Part":"Drawing"===this.type&&(e.type="Drawing")),e},getKind:function(){return this._kind},getOwner:function(){return this._owner},getPhid:function(){return this._phid},getTitle:function(){return this._title},getType:function(){return this._type},isRefreshViewAvailable:function(){var e=!1,t=this._type;return("3DShape"===t||"VPMReference"===t&&"3DPart"===this._kind||"Drawing"===t)&&(e=!0),e},setCAD:function(e){this._cadOrigin=e},setKind:function(e){this._kind=e},setOwner:function(e){this._owner=e},setTitle:function(e){this._title=e},setType:function(e){this._type=e}})}),define("DS/ENODODisplay/views/DODeleteDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/ModalContainer","DS/Controls/Button","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json"],function(e,t,i,o,n){"use strict";var a=function(e,t,i){if(null==t)throw new Error(n.error.invalidFrame);if(void 0===i.onYesCallback||void 0===i.onNoCallback)throw new Error(n.error.missingCallback);this._selectionInfo=e,this._parentContainer=t,this._dialog=void 0,this._modal=void 0,this._callbacks=i,this._selectionInfo=e,this.createDialog()};return a.prototype.constructor=a,a.prototype.getDialog=function(){return this._dialog},a.prototype.createDialog=function(){this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_delete_frame");var a=this.createContent();this.yesButton=new o({label:n.popup.yesButton,disabled:!1,allowUnsafeHTMLLabel:!1}),this.yesButton.addEventListener("buttonclick",this.onYesCallback.bind(this),!1),this.noButton=new o({label:n.popup.noButton,disabled:!1,allowUnsafeHTMLLabel:!1}),this.noButton.addEventListener("buttonclick",this.onNoCallback.bind(this),!1),this.cancelButton=new o({label:n.popup.cancelButton,disabled:!1,allowUnsafeHTMLLabel:!1}),this.cancelButton.addEventListener("buttonclick",this.onClose.bind(this),!1);var s=this._parentContainer.getSize().width;s=s>50?s-30:s,this._dialog=new e({immersiveFrame:this._immersiveFrame,title:n.columns.delete,content:a,activeFlag:!1,resizableFlag:!0,width:s,height:this._parentContainer.getSize().height/2,buttons:{Yes:this.yesButton,No:this.noButton,Cancel:this.cancelButton}}),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=i.createModal(this._parentContainer,this._immersiveFrame.getContent())},a.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer)},a.prototype.onYesCallback=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer),this._callbacks.onYesCallback(this._selectionInfo)},a.prototype.onNoCallback=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer),this._callbacks.onNoCallback(this._selectionInfo)},a.prototype.createContent=function(){return UWA.createElement("div",{class:"doparameterview_content",html:n.popup.delete})},a}),define("DS/ENODODisplay/views/DODetailsDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Controls/ModalContainer","DS/Controls/Button","DS/Controls/Accordeon","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json"],function(e,t,i,o,n,a,s,r,l,d){"use strict";var c=function(e,t){if(null==t)throw new Error(d.error.invalidFrame);if(!(e&&Object.keys(e).length>0))throw new Error(d.error.emptyParameter);e.parameters&&e.parameters.length>0&&(this._parameters=e.parameters),this._representedDO=e,this._parentContainer=t,this._dialog=void 0,this._parametersTable=void 0,this._modal=void 0,this.createDialog()};return c.prototype.constructor=c,c.prototype.getDialog=function(){return this._dialog},c.prototype.createDialog=function(){this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_param_frame");var i=this.createView();this.okButton=new r({label:d.buttons.close,disabled:!1,allowUnsafeHTMLLabel:!1}),this.okButton.addEventListener("buttonclick",this.onClose.bind(this),!1);var o=this._parentContainer.getSize().width;o=o>50?o-30:o,this._dialog=new e({immersiveFrame:this._immersiveFrame,title:d.labels.doDetails,content:i,activeFlag:!1,resizableFlag:!0,width:o,height:-1,buttons:{Ok:this.okButton}}),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=s.createModal(this._parentContainer,this._immersiveFrame.getContent())},c.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,s.removeModal(this._parentContainer)},c.prototype.createView=function(){var e=UWA.createElement("div",{class:"doinformationview_layout"}),t=[],i=new UWA.Element("div",{class:"dodetailsview_accordeoncontent",id:"doattributesview_content"}),o=[];if(void 0!==this._representedDO.format&&this._representedDO.format.length>0&&o.push({name:d.labels.format,value:this._representedDO.format}),void 0!==this._representedDO.outputStreamId&&this._representedDO.outputStreamId.length>0&&o.push({name:d.labels.alias,value:this._representedDO.outputStreamId}),this._representedDO.title&&this._representedDO.title.length>0?o.push({name:d.labels.title,value:this._representedDO.title}):void 0!==this._representedDO.name&&this._representedDO.name.length>0&&o.push({name:d.labels.title,value:this._representedDO.name}),void 0!==this._representedDO.isSync){var n=this._representedDO.isSync;if(o.push({name:d.labels.uptodateDO,value:!0===n?d.labels.yes:d.labels.no}),!1===n&&void 0!==this._representedDO.jobs&&this._representedDO.jobs.length>0){var a=d.jobStatus?d.jobStatus[this._representedDO.status]:this._representedDO.status;o.push({name:d.labels.jobStatus,value:a})}}if(this._representedDO.converter&&o.push({name:d.labels.converter,value:this._representedDO.converter}),void 0!==this._representedDO.isExternal&&o.push({name:d.labels.external,value:!0===this._representedDO.isExternal?d.labels.yes:d.labels.no}),this.generateParamTable(o).inject(i),t.push({header:d.labels.doattributes,content:i,expandedFlag:!0}),null!==this._parameters&&void 0!==this._parameters){var s=this.createParameters();t.push({header:d.labels.parameters,content:s,expandedFlag:!0})}new l({class:"dodetailsview_accordeonhandler",items:t,style:"simple",exclusive:!1}).inject(e);return e},c.prototype.generateParamTable=function(e){for(var t=new UWA.Element("table",{class:"doattributeview_table",styles:{width:"100%",height:"100%",cursor:"default"}}),i=new UWA.Element("tbody",{class:"doattributeview_tbody"}).inject(t),o=0;o<e.length;o++){var n=e[o].name,a=e[o].value,s=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i);new UWA.Element("td",{class:"doattributeview_td_parametername",text:n}).inject(s),new UWA.Element("td",{class:"doattributeview_td_parametervalue",text:a}).inject(s)}return t},c.prototype.createParameters=function(){var e=UWA.createElement("div",{class:"dodetailsview_accordeoncontent",id:"doparameterview_content"}),t=[],i=0;for(i=0;i<this._parameters.length;i++){var o=this._parameters[i];if(!o.hasOwnProperty("name")||!o.hasOwnProperty("value"))throw new Error(d.error.invalidParameter);var n=o.hasOwnProperty("displayName")?o.displayName:o.name,a=o.hasOwnProperty("displayValue")?o.displayValue:o.value;t.push({name:n,value:a})}return this.generateParamTable(t).inject(e),e},c}),define("DS/ENODODisplay/views/DOBulkDownloadDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/ModalContainer","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Button","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json","DS/Controls/LineEditor","DS/Notifications/NotificationsManagerUXMessages"],function(e,t,i,o,n,a,s,r,l){"use strict";var d="",c=function(e,t,i,o){if(null==t)throw new Error(s.error.invalidFrame);if(null==o||"function"!=typeof o)throw new Error(s.error.missingCallback);this._callback=o,null!==e&&(e.hasOwnProperty("partFormats")&&e.partFormats.length>0||e.hasOwnProperty("drawingFormats")&&e.drawingFormats.length>0)&&(this._formatList=e,this._parentContainer=t,this._dialog=void 0,this._modal=void 0,this.slelectedItem=i,this._uiComponents={partFormatCombo:null,drawingFormatCombo:null,pointingDrawingCheckbox:null,titleInputBox:null,checkBox:null},this.createDialog())};return c.prototype.constructor=c,c.prototype.getDialog=function(){return this._dialog},c.prototype.createDialog=function(){this._immersiveFrame=new t({identifier:"PSEDerivedOutputs_ImmersiveFrame"}),this._immersiveFrame.getContent().addClassName("sidePanelDO_param_frame");var o=this.createView();this.cancelButton=new a({label:s.buttons.cancel,disabled:!1,allowUnsafeHTMLLabel:!1}),this.cancelButton.addEventListener("buttonclick",this.onClose.bind(this),!1),this.okButton=new a({label:s.buttons.bulkdownload.title,disabled:!0,allowUnsafeHTMLLabel:!1}),this.okButton.addEventListener("buttonclick",this.onDownload.bind(this),!1);var n=this._parentContainer.getSize().width;n=n>50?n-30:n;var r=s.labels.doDownload,l=this.slelectedItem;this._dialog=new e({immersiveFrame:this._immersiveFrame,title:r+" "+l,content:o,activeFlag:!1,resizableFlag:!0,width:n,height:this._parentContainer.getSize().height/2,buttons:{Cancel:this.cancelButton,Ok:this.okButton}}),this._dialog.getContent().addClassName("dobulkDownlaod_wuxdailog"),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=i.createModal(this._parentContainer,this._immersiveFrame.getContent())},c.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,i.removeModal(this._parentContainer)},c.prototype.onDownload=function(){var e={level:"info",message:s.buttons.bulkdownload.downloadNotfication};if(l.addNotif(e),null!=d)var t=this._uiComponents.titleInputBox.value.replaceAll(/[\\\/:*?\"<>|\s]/gm,"_");var i=null!=this._uiComponents.partFormatCombo.value?[this._uiComponents.partFormatCombo.value]:[],o=null!=this._uiComponents.drawingFormatCombo.value?[this._uiComponents.drawingFormatCombo.value]:[],n=!!this._uiComponents.checkBox&&this._uiComponents.checkBox.checkFlag,a=!!this._uiComponents.pointingDrawingCheckbox&&this._uiComponents.pointingDrawingCheckbox.checkFlag;localStorage.setItem("DO_BulkDownload_SyncOnly",n),this._callback(i,o,t,n,a),this.onClose()},c.prototype.onFormatClicked=function(e){var t=this.slelectedItem,i=null!=this._uiComponents.partFormatCombo.value?[this._uiComponents.partFormatCombo.value]:[],o=null!=this._uiComponents.drawingFormatCombo.value?[this._uiComponents.drawingFormatCombo.value]:[];o.length>0&&(this._uiComponents.pointingDrawingCheckbox.disabled=!1,this._uiComponents.pointingDrawingCheckbox.checkFlag=!0),this.okButton.disabled=!1,i.length>0&&o.length>0?d=t+"-"+i+"-"+o:i.length>0?d=t+"-"+i+"(3D)":o.length>0&&(d=t+"-"+o+"(2D)"),d=d.replaceAll(/[\\\/:*?\"<>|\s]/gm,"_"),this._uiComponents.titleInputBox.value=d},c.prototype.createView=function(){var e=UWA.createElement("div",{class:"doinformationview_layout"}),t=new UWA.Element("table",{class:"doattributeview_table",styles:{width:"100%",height:"100%",cursor:"default"}}).inject(e),i=new UWA.Element("tbody",{class:"doattributeview_tbody"}).inject(t),a=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),l=(new UWA.Element("td",{class:"dobulkdownloadview_label",text:s.labels.threeDFormat}).inject(a),new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(a)),d=new o({elementsList:this._formatList.partFormats,placeholder:s.labels.select3DFormat});d.inject(l),d.addEventListener("change",this.onFormatClicked.bind(this,d),!1),this._uiComponents.partFormatCombo=d,a=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),new UWA.Element("td",{class:"dobulkdownloadview_label",text:s.labels.twoDFormat}).inject(a),l=new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(a);var c=new o({elementsList:this._formatList.drawingFormats,placeholder:s.labels.select2DFormat});c.inject(l),c.addEventListener("change",this.onFormatClicked.bind(this,c),!1),this._uiComponents.drawingFormatCombo=c;a=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),new UWA.Element("td",{class:"dobulkdownloadview_label"}).inject(a);var u=new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(a),h=new n({type:"checkbox",label:s.labels.pointingDrawing,class:"pointingDrawingcheckBoxID"});this._uiComponents.pointingDrawingCheckbox=h,this._uiComponents.pointingDrawingCheckbox.disabled=!0,h.inject(u);var p=!1;localStorage.getItem("DO_BulkDownload_SyncOnly")&&(p="true"===localStorage.getItem("DO_BulkDownload_SyncOnly")||!0===localStorage.getItem("DO_BulkDownload_SyncOnly"));var m=new n({type:"checkbox",label:s.labels.restrictionbulkdownload,checkFlag:p});m.inject(e),this._uiComponents.checkBox=m;a=new UWA.Element("tr",{class:"doattributeview_tr"}).inject(i),new UWA.Element("td",{class:"dobulkdownloadview_label",text:s.labels.title}).inject(a),l=new UWA.Element("td",{class:"dobulkdownloadview_combo"}).inject(a);var v=new r({sizeInCharNumber:23}).inject(l);return this._uiComponents.titleInputBox=v,e},c}),define("DS/ENODODisplay/views/DerivedOutputList",["UWA/Controls/Abstract","UWA/Core","UWA/Element","DS/TreeModel/TreeDocument","DS/TreeModel/DataModelSet","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json","DS/ENODOUtilsServices/DOServices","DS/Utilities/UUID","text!DS/ENODOUtilsServices/assets/enodo_webservices.json","DS/ENODODisplay/views/DODetailsDialog","DS/ENODODisplay/views/DODeleteDialog","DS/ENODODisplay/model/SelectedObjectInfo","css!DS/ENODODisplay/ENODODisplay"],function(e,t,i,o,n,a,s,r,l,d,c,u,h,p,m,v){"use strict";var _=JSON.parse(u);function g(e,t,i,o){t=t.toLowerCase(),i=i.toLowerCase(),o=o.toLowerCase();for(var n=-1,a=0;a<e.length;a++)if(e[a].target.toLowerCase()===t&&e[a].category.toLowerCase()===o){var s=e[a].source;if(!("CATPart"!==s&&"SLDPRT"!==s&&"PRT"!==s&&"IPT"!==s||"3dshape"!==i&&"vpmreference"!==i)){n=a;break}if(("DWG"===s||"SLDDRW"===s||"CATDrawing"===s)&&"drawing"===i){n=a;break}}return n}function w(){return new Promise(function(e,t){var i={data:{ruleType:"ONDEMAND"},webService:{url:_.retrieveFormats.url,verb:_.retrieveFormats.verb},callback:{onComplete:function(t){var i=UWA.is(t,"string")?JSON.parse(t):t;UWA.is(i.derivedOutputRules)&&0!==i.derivedOutputRules.length?e(i.derivedOutputRules):e([])},onFailure:function(e){t(e)}}};d.SendServerRequest(i)})}return e.extend({_treelistview:null,_model:null,_informationBox:null,_actionAuthorized:!1,_formatList:[],_role:null,_isDeleteAllowed:!1,_isDownloadAllowed:null,_isFormatInitialized:!1,physicalid:"",init:function(e){var t=this;this._parent(e),this._actionAuthorized=!(!UWA.is(this.options)||!UWA.is(this.options.activateActions))&&this.options.activateActions,this.elements.container=UWA.createElement("div",{class:"derivedoutputs_container"}),this._displayedParameters=void 0,this._deleteWindow=void 0,d.GetCurrentRole().then(function(e){switch(t._role=e,t._role){case"VPLMProjectLeader":case"VPLMAdmin":t._isDeleteAllowed=!0}},function(e){console.error("Error getting the context : "+e),t._isDeleteAllowed=!1}),d.isAccessforDownloadDO().then(function(e){console.log(e),1==e.Status?t._isDownloadAllowed=e.Status:t._isDownloadAllowed=!1}).catch(function(e){console.log(e),t._isDownloadAllowed=!1}),w().then(function(e){t._isFormatInitialized=!0,t._formatList=e}),t._initializeUI(t)},_initializeUI:function(e){var t=new n;e._model=new o({dataModelSet:t});var i=!0===this._actionAuthorized?"15%":"20%",a=[{text:l.columns.status,dataIndex:"Status",alwaysVisibleFlag:!0,width:i,sortableFlag:!0,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(e){if(e.nodeModel)switch(e.nodeModel.options.grid.Status){case"OK":return"statusCheck";case"RUNNING":return"statusJobRunning";case"SUBMITTED":return"statusJobSubmitted";case"FAILED":return"statusJobFailed";case"UPDATE":return"statusRefresh"}},getCellSemantics:function(t){var i=!0;if(t.nodeModel){var o=t.nodeModel.options.grid.Status;("SUBMITTED"===o||"RUNNING"===o||"FAILED"===o||"UPDATE"===o&&!0===e._actionAuthorized&&!0===t.nodeModel.options.grid.IsUpdatable&&!1===t.nodeModel.options.grid.isExternal)&&(i=!1)}return{disabled:i}}},{text:l.labels.alias,dataIndex:"OutputStreamId",width:"40%"},{text:l.columns.details,dataIndex:"Parameters",alwaysVisibleFlag:!0,width:i,sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel?"seeParameters":"string"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!1,allowUnsafeHTMLLabel:!1}}},{text:l.columns.download,dataIndex:"Download",alwaysVisibleFlag:!0,width:i,sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&void 0!==e.nodeModel.options.grid.Download&&!0===e.nodeModel.options.grid.Download?"actionDownload":"actionBlock"},getCellSemantics:function(t){if(t.nodeModel&&void 0===t.nodeModel.options.grid.Download||!1===t.nodeModel.options.grid.Download||!1===e._isDownloadAllowed)return{disabled:!0,allowUnsafeHTMLLabel:!1}}}];!0===this._actionAuthorized&&a.push({text:l.columns.delete,dataIndex:"Delete",alwaysVisibleFlag:!0,width:i,sortableFlag:!1,resizableFlag:!0,editableFlag:!1,getCellTypeRepresentation:function(t){return t.nodeModel&&void 0!==t.nodeModel.options.grid.Delete&&!0===t.nodeModel.options.grid.Delete&&!0===e._actionAuthorized?"deleteAction":"actionBlock"},getCellSemantics:function(t){if(t.nodeModel&&void 0===t.nodeModel.options.grid.Delete||!1===t.nodeModel.options.grid.Delete||!1===e._isDeleteAllowed&&!0!==t.nodeModel.options.grid.ObjectOwner)return{disabled:!0,allowUnsafeHTMLLabel:!1}}});var d=e._treelistview=new s({identifier:"dofacet_gridviewcomponent",treeDocument:e._model,rowSelection:"single",cellSelection:"none",selectionBehavior:{toggle:!0,unselectAllOnEmptyArea:!0},layout:new r({cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}),columns:a,defaultColumnDef:{width:"auto"},getCellTooltip:function(t){if(!t.nodeModel||0!==t.nodeModel.getParents().length)return this.getCellDefaultTooltip(t);switch(this.layout.getDataIndexFromColumnIndex(t.columnID)){case"Status":var i="",o=t.nodeModel.options.grid.Jobs,n="";if(o.length>0){var a=o[o.length-1];n=a.hasOwnProperty("name")?a.name:""}switch(t.cellModel){case"OK":i=l.buttons.uptodate.shortHelp;break;case"UPDATE":i=l.buttons.refresh.shortHelp,!0===e._actionAuthorized&&(!1===t.nodeModel.options.grid.isExternal?!0===t.nodeModel.options.grid.IsUpdatable&&(i+=l.buttons.refresh.clickupdate):i+=l.buttons.refresh.external);break;case"SUBMITTED":i=l.replace(l.buttons.jobs.shortHelpSubmitted,{oJobName:n})+" "+l.buttons.jobs.actionClick;break;case"RUNNING":i=l.replace(l.buttons.jobs.shortHelpRunning,{oJobName:n})+" "+l.buttons.jobs.actionClick;break;case"FAILED":i=l.replace(l.buttons.jobs.shortHelpFailed,{oJobName:n})+" "+l.buttons.jobs.actionClick}return{shortHelp:i,updateModel:!1};case"Parameters":return{shortHelp:l.buttons.details.shortHelp,updateModel:!1};case"Download":if(!0===t.nodeModel.options.grid.Download&&!0===e._isDownloadAllowed)return{shortHelp:l.buttons.download.shortHelp,updateModel:!1};if(!0===t.nodeModel.options.grid.Download&&!1===e._isDownloadAllowed)return{shortHelp:l.buttons.download.accessRight,updateModel:!1};if("undefined"!==t.nodeModel.options.grid.Download&&!1===t.nodeModel.options.grid.Download)return{shortHelp:l.buttons.download.notDownloadable,updateModel:!1};break;case"Delete":return!0===e._actionAuthorized&&!0===t.nodeModel.options.grid.Delete?!0===e._isDeleteAllowed||!0===t.nodeModel.options.grid.ObjectOwner?t.nodeModel.options.grid.Jobs.length>0?""===t.nodeModel.options.grid.Filename?{shortHelp:l.buttons.delete.deleteJob,updateModel:!1}:{shortHelp:l.buttons.delete.deleteJobsAndDo,updateModel:!1}:{shortHelp:l.buttons.delete.shortHelp,updateModel:!1}:{shortHelp:l.buttons.delete.accessRight,updateModel:!1}:!1===t.nodeModel.options.grid.Delete?{shortHelp:l.buttons.delete.accessRight,updateModel:!1}:{shortHelp:l.buttons.delete.notAllowed,updateModel:!1};default:return this.getCellDefaultTooltip(t)}}}).inject(this.elements.container);this.elements.container.getChildren()[0].id="dofacet_gridviewcomponent",this._treelistview.onContextualEvent=function(e){return[]};var c={actionDownload:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"download",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionBlock:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusCheck:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"status-ok",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusRefresh:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"update",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusJobRunning:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"clock",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusJobSubmitted:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"hourglass",fontIconFamily:WUXManagedFontIcons.Font3DS}}},statusJobFailed:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"attention",fontIconFamily:WUXManagedFontIcons.Font3DS}}},deleteAction:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}},seeParameters:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"eye",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};d.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(c)),d.getContent().addClassName("do-datagridview"),d.onReady(function(){d.addEventListener("click",e._cellClicked.bind(e))}),e._informationBox=UWA.createElement("div",{class:"enoderivedoutputs_information"}),UWA.createElement("span",{class:"enoderivedoutputs_information_icon wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-docs"}).inject(e._informationBox),e._messageInformationBox=UWA.createElement("h2",{class:"enoderivedoutputs_information_msg"}).inject(this._informationBox),e._informationBox.hide(),e._informationBox.inject(e.elements.container)},_openJobInfo:function(e){if(e.length>0){var t=e[e.length-1];if(t.hasOwnProperty("physicalId")||t.hasOwnProperty("objectId")){var i=t.hasOwnProperty("objectId")?t.objectId:t.hasOwnProperty("physicalId")?t.physicalId:null;d.retrievePlatformUrl().then(function(e){var t=d.get3DSpaceUrl(e);window.open(t+_.openJobLink.url+i,"_blank")})}}},_cellClicked:function(e,t){var i=this;if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(this._treelistview.layout.getDataIndexFromColumnIndex(t.columnID)){case"Status":var o=t.nodeModel.options.grid.Status;!0===this._actionAuthorized&&"UPDATE"===o&&!1===t.nodeModel.options.grid.isExternal&&!0===t.nodeModel.options.grid.IsUpdatable&&this._updateDerivedOutput(t.nodeModel.options.grid,t),"SUBMITTED"!==o&&"RUNNING"!==o&&"FAILED"!==o||void 0!==t.nodeModel.options.grid.Jobs&&t.nodeModel.options.grid.Jobs.length>0&&this._openJobInfo(t.nodeModel.options.grid.Jobs);break;case"Parameters":this._displayedParameters=new h({name:t.nodeModel.options.grid.Filename,title:t.nodeModel.options.grid.Title,format:t.nodeModel.options.grid.Format,isSync:t.nodeModel.options.grid.isSync,status:t.nodeModel.options.grid.Status,jobs:t.nodeModel.options.grid.Jobs,isExternal:t.nodeModel.options.grid.isExternal,converter:t.nodeModel.options.grid.Converter,outputStreamId:t.nodeModel.options.grid.OutputStreamId,parameters:t.nodeModel.options.grid.Parameters},this.elements.container);break;case"Download":void 0!==t.nodeModel.options.grid.Download&&!0===t.nodeModel.options.grid.Download&&!0===i._isDownloadAllowed&&this._downloadDerivedOutput(t.nodeModel.options.grid);break;case"Delete":if(void 0!==t.nodeModel.options.grid.Delete&&!0===t.nodeModel.options.grid.Delete&&(!0===this._isDeleteAllowed||!0===t.nodeModel.options.grid.ObjectOwner)&&!0===this._actionAuthorized)if(void 0!==t.nodeModel.options.grid.Jobs&&t.nodeModel.options.grid.Jobs.length>0)if(""===t.nodeModel.options.grid.Filename)this._deleteDerivedOutputJobs(t.nodeModel.options.grid,!0);else{var n={onYesCallback:function(){i._deleteDerivedOutputAndJobs(t.nodeModel.options.grid)},onNoCallback:function(){i._deleteDerivedOutput(t.nodeModel.options.grid,!0)}};this._deleteWindow=new p(t.nodeModel.options.grid,this.elements.container,n)}else this._deleteDerivedOutput(t.nodeModel.options.grid,!0)}},getTreeListView:function(){return this._treelistview},_updateDerivedOutputCall:function(e,t){for(var i=this,o=[],n=0;n<e.Parameters.length;n++){var a=e.Parameters[n];if(a.hasOwnProperty("name")&&a.hasOwnProperty("value")){var s=a.name,r=a.value,u={};u[s]=r,o.push(u)}}var h=[],p="DFUpdate"+c.v4(),m=e.Format,v=e.OutputStreamId,g={model_identifier:{type:"VPMReference",id:e.ObjectID},target:m,unifiedFormat:v,title:p,batch_parameters:{version:"2.0",convinputs:o,inputs:[]}};h.push(g);var w={data:{DoJobs:h},webService:{url:_.generateJob.url,verb:_.generateJob.verb},callback:{onComplete:function(e){d._displayNotification("info",l.info.title,l.info.updateOK),t.disabled=!0,i.selectionModified([i.physicalid])},onFailure:function(e){d._displayNotification("error",l.error.title,l.replace(l.error.updateFailed,{oMsg:e}))}}};d.SendServerRequest(w)},_deleteDerivedOutputAndJobs:function(e){this._deleteDerivedOutputJobs(e,!1),this._deleteDerivedOutput(e,!0)},_deleteDerivedOutputJobs:function(e,t){for(var i=this,o=[],n=e.Jobs,a=0;a<n.length;a++){var s=n[a];s.hasOwnProperty("physicalId")&&o.push(s.physicalId)}var r={data:{ids:o},webService:{url:_.deleteJobs.url,verb:_.deleteJobs.verb},callback:{onComplete:function(e){e.hasOwnProperty("countOfJobs")&&e.countOfJobs>0&&(d._displayNotification("info",l.info.title,l.info.deleteJobOk),!0===t&&i.selectionModified([i.physicalid]))},onFailure:function(e){d._displayNotification("error",l.error.title,l.replace(l.error.deleteFailed,{oMsg:e}))}}};d.SendServerRequest(r)},_deleteDerivedOutput:function(e,t){var i=this,o={data:{reps:[{id:e.ObjectID,keys:[{filename:e.Filename,format:e.Format,DO_ID:e.DOID,DOF_ID:e.DOFID}]}]},webService:{url:_.deleteDerivedFormat.url,verb:_.deleteDerivedFormat.verb},callback:{onComplete:function(e){d._displayNotification("info",l.info.title,l.info.deleteOK),!0===t&&i.selectionModified([i.physicalid])},onFailure:function(e){d._displayNotification("error",l.error.title,l.replace(l.error.deleteFailed,{oMsg:e}))}}};d.SendServerRequest(o)},_retrieveSelectionInfoOnRep:function(e){var t=this;return new Promise(function(i,o){var n={data:{physicalid:e,label:"FetchObjectInfo_DOSP",select_predicate:["physicalid","ds6w:cadMaster","ds6w:type","owner"]},webService:{url:_.fetch.url,verb:_.fetch.verb},callback:{onComplete:function(e){var o=UWA.is(e,"string")?JSON.parse(e):e;i(t._parseAttributeResults(o))},onFailure:function(e){o(e||new Error("Issue retrieving selection informations"))}}};d.SendServerRequest(n)})},_parseAttributeResults:function(e){var t=[];if(null!==e&&e.hasOwnProperty("results"))for(var i=0;i<e.results.length;i++){var o=e.results[i];if(o.hasOwnProperty("attributes")){for(var n,a,s,r,l=0;l<o.attributes.length;l++){var d=o.attributes[l];if(d.hasOwnProperty("name"))switch(d.name){case"ds6w:type":n=d.hasOwnProperty("value")?d.value:null;break;case"ds6w:cadMaster":a=d.hasOwnProperty("value")?d.value:null;break;case"owner":s=d.hasOwnProperty("value")?d.value:null;break;case"physicalid":r=d.hasOwnProperty("value")?d.value:null}}var c;(c=new m(r)).setType(n),c.setCAD(a),c.setOwner(s),t.push(c)}}else(c=new m(this.physicalid)).setType("unknown"),c.setCAD("unknown"),c.setOwner("unknown"),t.push(c);return t},_updateDerivedOutput:function(e,t){this._updateDerivedOutputCall(e,t)},_downloadDerivedOutput:function(e){if(!UWA.is(e))throw new Error("## DerivedOutputList._downloadDerivedOutput: Invalid inputs");var t=e.Filename,i=e.Format,o=e.ObjectID,n=e.DOID,a=e.DOFID,s=e.Title?e.Title:t,r={data:{reps:[{id:o,keys:[{format:i,filename:t,DO_ID:n,DOF_ID:a,title:s}]}]},webService:{url:_.downloadTicket.url,verb:_.downloadTicket.verb},callback:{onComplete:function(e){if(void 0!==(e=UWA.is(e,"string")?JSON.parse(e):e).ticketURL&&void 0!==e.ticket){var i=e.ticketURL+"?__fcs__jobTicket="+encodeURIComponent(e.ticket);if(e.hasOwnProperty("displayfilenames")){var o=e.displayfilenames;o.length>0&&(t=Array.isArray(o)?o[0]:o)}d.DownloadURL(i,t)}},onFailure:function(e){e&&console.error(e)}}};d.SendServerRequest(r)},clickHandler:function(e){},_displayInformationBox:function(e){"noselection"===e?this._messageInformationBox.setText(l.derivedOutputsNoSelection):"multiselection"===e?this._messageInformationBox.setText(l.derivedOutputsMultiSelection):"noderivedoutputs"===e&&this._messageInformationBox.setText(l.noderivedoutputs),this._treelistview.getContent().hide(),this._informationBox.show()},_getDerivedOutputs:function(e){if(this.nodeId=e.ids,!UWA.is(e)||!UWA.is(e.ids))throw new Error("## DerivedOutputList.getDerivedOutputs: Invalid inputs");var t={data:{ids:e.ids,attributes:e.attributes},webService:{url:_.doInformation.url,verb:_.doInformation.verb},callback:{onComplete:function(t){var i=UWA.is(t,"string")?JSON.parse(t):t;e.onComplete(i)},onFailure:function(t){e.onFailure(t)}}};d.SendServerRequest(t)},_generateNodesFromResults:function(e,t){e=UWA.is(e,"string")?JSON.parse(e):e;for(var i=[],o=0;o<e.ids.length;o++){var n=e.ids[o],s=n.id,r=n.hasOwnProperty("repId")?n.repId:s,l=d.GetCurrentUser(),c="",u="",h="";if(null!==t)for(var p=0;p<t.length;p++)if(t[p].getPhid()===r||t[p].getPhid()===s){var m=t[p].getOwner();c=t[p].getType(),u=t[p].getCAD(),h=!!l&&m===l.login}if(n.streams)for(var v=0;v<n.streams.length;v++){var _=n.streams[v];if(_.hasOwnProperty("filename")&&_.hasOwnProperty("format")&&_.hasOwnProperty("isSync")&&_.hasOwnProperty("downloadable")){var w=_.filename,D=_.format,f=_.hasOwnProperty("streamId")&&""!==_.streamId?_.streamId:_.format,b="true"===_.isSync||!0===_.isSync,O=!0===b?"OK":"UPDATE",y="true"===_.downloadable||!0===_.downloadable,S=_.hasOwnProperty("isExternal")&&("true"===_.isExternal||!0===_.isExternal),I=_.hasOwnProperty("visible")&&"true"===_.visible||!0===_.visible,F=_.hasOwnProperty("converter")?_.converter:null,C=y,M=_.hasOwnProperty("DO_ID")?_.DO_ID:null,k=_.hasOwnProperty("DOF_ID")?_.DOF_ID:null;let e=_.hasOwnProperty("title")?_.title:w;"visualization"==f?C=!0:_.hasOwnProperty("deletable")&&(C=("true"===_.deletable||!0===_.deletable)&&!0===y);var A=[];if("OK"!=O&&_.hasOwnProperty("jobs")&&_.jobs.length>0){var E=(A=_.jobs)[A.length-1];"Running"===E.status?O="RUNNING":"Submitted"===E.status||"Created"===E.status?O="SUBMITTED":"Failed"===E.status?O="FAILED":A=[],A.length>0&&""===w&&(C=!0)}"ExactGeometry"==D&&(f=f+" ("+D+")");var x=!1;this._formatList&&D&&c&&u&&(x=g(this._formatList,D,c,u)>-1);var N=[];if(_.hasOwnProperty("parameters")&&(N=_.parameters),I&&"print"!=f){var P={ObjectID:r,IsUpdatable:x,Objectowner:h,isSync:b,Status:O,Jobs:A,Format:D,Filename:w,Download:y,Parameters:N,isExternal:S,Delete:C,OutputStreamId:f,Converter:F,DOID:M,DOFID:k,Title:e};i.push(P)}}}}this._model.prepareUpdate(),this._model.empty();for(var U=0;U<i.length;U++){var T=i[U],j=a.createTreeNodeDataModel(this._model.options.dataModelSet,{label:T.text,grid:T});this._model.addChild(j)}this._model.expandAll(),this._model.pushUpdate()},_extractRepIdList:function(e){e=UWA.is(e,"string")?JSON.parse(e):e;for(var t=[],i=0;i<e.ids.length;i++){var o=e.ids[i],n=o.id,a=o.hasOwnProperty("repId")?o.repId:n;t.push(a)}return t},_hasStreams:function(e){if(e.hasOwnProperty("ids"))for(var t=0;t<e.ids.length;t++)if(e.ids[t].hasOwnProperty("streams")&&e.ids[t].streams.length>0)return!0;return!1},selectionModified:function(e,t){var i=this;if(void 0!==this._displayedParameters&&null!==this._displayedParameters.getDialog()&&(this._displayedParameters.onClose(),this._displayedParameters=void 0),void 0!==this._deleteWindow&&null!==this._deleteWindow.getDialog()&&(this._deleteWindow.onClose(),this._deleteWindow=void 0),this._treelistview&&this._treelistview.getContent().show(),this._informationBox&&this._informationBox.hide(),i._model.empty(),UWA.is(e)&&0!==e.length)if(1===e.length){var o=UWA.is(e[0].getID,"function")?e[0].getID():e[0];this._getDerivedOutputs({ids:[o],attributes:["filename","format","isSync","downloadable","visible","parameters","isExternal","deletable","title"],onComplete:function(e){var n;if((n=UWA.is(e,"string")?JSON.parse(e):e)&&n.ids&&n.ids[0]&&!1!==i._hasStreams(n)){var a=i._extractRepIdList(e);i.physicalid===o?i._generateNodesFromResults(n,i._selectionInfoList):(i.physicalid=o,null==t||0==t.lenth?i._retrieveSelectionInfoOnRep(a).then(function(e){i._selectionInfoList=e,!0!==i._isFormatInitialized?w().then(function(t){i._isFormatInitialized=!0,i._formatList=t,i._generateNodesFromResults(n,e)}):i._generateNodesFromResults(n,e)}):(i._selectionInfoList=t,!0!==i._isFormatInitialized?w().then(function(e){i._isFormatInitialized=!0,i._formatList=e,i._generateNodesFromResults(n,t)}):i._generateNodesFromResults(n,t)))}else i._displayInformationBox("noderivedoutputs")},onFailure:function(){i.physicalid=o,i._displayInformationBox("noderivedoutputs")}})}else this._displayInformationBox("multiselection");else this._displayInformationBox("noselection")}})}),define("DS/ENODODisplay/commands/facets/DerivedOutputFacet",["css!DS/ENODODisplay/ENODODisplay","UWA/Core","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Class","i18n!DS/ENODODisplay/assets/nls/ENODisplayDO.json","DS/ENODODisplay/views/DerivedOutputList","DS/ENODOUtilsServices/DOServices","DS/ENODODisplay/views/DOBulkDownloadDialog","DS/ENODODisplay/model/SelectedObjectInfo","text!DS/ENODOUtilsServices/assets/enodo_webservices.json"],function(e,t,i,o,n,a,s,r,l,d,c){"use strict";var u=JSON.parse(c);return n.extend(i,o,{_derivedOutputList:null,_actionAuthorized:!1,_currentSelectionId:null,_selectionInfo:null,_infoPromise:null,_multiselectionInfoBox:null,init:function(e){this._parent(e),this._actionAuthorized=this.getActionAuthorized(this.options),this._initUI(),this.multiSelectionMessage()},_initUI:function(){null===this._derivedOutputList&&(this.elements.container=t.createElement("div",{class:"do-evolution"}),this._derivedOutputList=new s({activateActions:this._actionAuthorized}),this._derivedOutputList.elements.container.inject(this.elements.container))},getActionAuthorized:function(e){return!(!widget||!widget.data||"ENXWDOC_AP"!=widget.data.appId)||!(!t.is(e)||!t.is(e.activateActions))&&e.activateActions},updateFacet:function(){var e=this;document.getElementsByClassName("dobulkDownlaod_wuxdailog").length&&e._downloadDialog.onClose();let i=e.getModel();t.is(i)&&t.is(i.get("objectId"))&&(i.get("objectId").indexOf(".")>0?(this.elements.container.getChildren()[0].hide(),this._multiselectionInfoBox.show()):(this._multiselectionInfoBox.hide(),this.elements.container.getChildren()[0].show()));this._retrieveSelectionAndInfo(function(t,i){null!==i&&i.length>0?(e._currentSelectionId=i,e._selectionInfo=t,e._derivedOutputList.selectionModified([e._currentSelectionId],[t])):(e._currentSelectionId="",e._selectionInfo=null,e._derivedOutputList.selectionModified([],null))})},destroyComponent:function(){},onResize:function(){},onRefresh:function(){this.updateFacet()},show:function(){return this.updateFacet(),this.__callMethodOnUI("show")},isActionAvailable:function(e){let i=this.getModel();if("generateDeriveOutput"==e){if(t.is(i)&&t.is(i.get("objectId"))){var o=i.get("objectId");return!(this.getModel()&&this.getModel().get("type")&&this.getModel().get("type").dbValues&&"Document"==this.getModel().get("type").dbValues.value&&"OnPremise"===this.options.tenant||o.indexOf(".")>0)}}else if("refreshDOView"===e){if(t.is(i)&&t.is(i.get("objectId")))return!((o=i.get("objectId")).indexOf(".")>0)}else{if("bulkDownloadDO"!==e||"ENXWDOC_AP"==widget.getValue("appId"))return!1;if(t.is(i)&&t.is(i.get("objectId"))){o=i.get("objectId");return!(this.getModel()&&this.getModel().get("type")&&this.getModel().get("type").dbValues&&"Document"==this.getModel().get("type").dbValues.value||o.indexOf(".")>0)}}},onAction:function(e){if("generateDeriveOutput"===e){var t=this,i={};null!=this._selectionInfo&&(i=this._selectionInfo.getDOGenerationFilter()),require(["DS/ENODOManagementCmdsLight/commands/GenericDOGenerationCmd"],function(e){if("ENOWSES_AP"==widget.data.appId)var o=t._retrieveSelectionAndFilters([t._currentSelectionId]);else o=t._retrieveSelectionAndFilters(t._currentSelectionId);new e({command_id:t.options.ID,data:{selections:o.selections,context:widget.data.appId,filter:i}})})}else"refreshDOView"===e?null!==this._currentSelectionId&&this._derivedOutputList.selectionModified([this._currentSelectionId],[this._selectionInfo]):"bulkDownloadDO"===e&&(this._derivedOutputList._isDownloadAllowed?this._retrieveAvailableRules():r._displayNotification("error",a.error.title,a.buttons.download.BulkDOaccessRight))},multiSelectionMessage:function(){this._multiselectionInfoBox=t.createElement("div",{class:"enoderivedoutputs_information1"});var e=t.createElement("div",{class:"content_box"}).inject(this._multiselectionInfoBox);t.createElement("span",{class:"enoderivedoutputs_information_icon wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-docs"}).inject(e);var i=t.createElement("h2",{class:"enoderivedoutputs_multiselection_information_msg"}).inject(e);this._multiselectionInfoBox.setStyle("position","relative"),this._multiselectionInfoBox.setStyle("height","100%"),this._multiselectionInfoBox.setStyle("vertical-align","top"),e.setStyle("position","absolute"),e.setStyle("top","calc(50% - 100px)"),e.setStyle("text-align","left"),e.setStyle("color","#303030"),e.setStyle("opacity",".2"),i.setText(a.multiselectionDisabledMSg),this._multiselectionInfoBox.inject(this.elements.container)},_retrieveAvailableRules:function(){var e=this,i={webService:{url:u.retrieveConversionFormats.url+"?downloadableOnly=true",verb:u.retrieveConversionFormats.verb},callback:{onComplete:function(i){var o=t.is(i,"string")?JSON.parse(i):i;if(t.is(o.derivedOutputFormats)&&0!==o.derivedOutputFormats.length){for(var n=[],s=[],d=0;d<o.derivedOutputFormats.length;d++){var c=o.derivedOutputFormats[d];if(c.hasOwnProperty("outputStreamId")&&c.hasOwnProperty("appliesOn")){var u=c.outputStreamId;"3D"===c.appliesOn?n.push(u):"2D"===c.appliesOn&&s.push(u)}}var h={partFormats:n,drawingFormats:s},p=e._selectionInfo.getTitle();e._downloadDialog=new l(h,e.elements.container,p,e._executeDownload.bind(e))}else 0===o.derivedOutputFormats.length&&r._displayNotification("error",a.error.title,a.warning.noFormat)},onFailure:function(e){r._displayNotification("error",a.error.title,a.replace(a.error.jobFailed,{oMsg:e}))}}};r.SendServerRequest(i)},_executeDownload:function(e,t,i,o,n){this._selectionInfo.getTitle();var a=i,s=this._retrieveFilteOnSelection(),l=s.hasOwnProperty("filter")?s.filter:{},d={data:{selections:[{paths:[s.paths],filter:l}],format3D:e,format2D:t,downloadOnlyUpToDate:o,zippedFolderName:a,Pointingdrawings:n},webService:{url:u.bulkDownloadTicket.url,verb:u.bulkDownloadTicket.verb,accept:u.bulkDownloadTicket.accept,type:u.bulkDownloadTicket.type},callback:{onComplete:function(e){r.DownloadBinary(e,a)},onFailure:function(e){r._displayNotification("error","Bulk Download Failed",e)}}};r.SendServerRequest(d)},_retrieveFilteOnSelection:function(){return console.log("classe Light"),{paths:[this._currentSelectionId],filter:{}}},_retrieveSelectionAndFilters:function(e){var t={selections:[]};if(e){var i={paths:[e]};t.selections.push(i)}return t},_retrieveSelectionAndInfo:function(e){var t=this.getModel();if(t){var i=t.get("objectId"),o=t.get("metatype");if(i!==this._currentSelectionId&&"relationship"!==o){r.retrieveSelectionInfo(i,["physicalid","ds6w:cadMaster","ds6w:type","owner","ds6w:label","ds6w:kind"],this._parseSelectionInfo.bind(this,i)).then(function(t){e(t,i)})}else i!==this._currentSelectionId&&e(this._selectionInfo,this._currentSelectionId)}else e(null,null)},_parseSelectionInfo:function(e,t){var i=new d(e);if(null!==t&&t.hasOwnProperty("results"))for(var o=0;o<t.results.length;o++){var n=t.results[o];if(n.hasOwnProperty("attributes"))for(var a=0;a<n.attributes.length;a++){var s=n.attributes[a];if(s.hasOwnProperty("name"))switch(s.name){case"ds6w:type":i.setType(s.value);break;case"ds6w:cadMaster":i.setCAD(s.value);break;case"owner":i.setOwner(s.value);break;case"ds6w:label":i.setTitle(s.value);break;case"ds6w:kind":i.setKind(s.value)}}}return i}})});