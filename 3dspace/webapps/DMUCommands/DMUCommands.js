define("DS/DMUCommands/DMU3DCompareCmd",["UWA/Utils","DS/DMUBaseCommands/EXPStateCommand","DS/DMUPlayCompare/DMUCompare3D","DS/DMUPlayCompare/DMUCompare2D","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/PADServices/utils/SearchUtils","DS/DMUControls/EXPNotify","DS/CATWebUXComponents/CATWebUXNotifBar","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/Visualization/PathElement","DS/CATWebUXComponents/DMUCommandsManager","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a,r,l,s,d,g,c,u,m,p,C){"use strict";return t.extend({init:function(t){var v="DMU2DCompareCmdHdr"===t.ID?"2D":"3D";this._parent(t,"exclusive",!0);let f,D,h=r.getContextViewer({viewer:this.getFrameWindow().getViewer()}),w=this;this.cancelExecute=function(){D&&D(),this.restoreDefaultController(),this.cancel()},this.destroy=function(){D&&D(),this.restoreDefaultController(),this.done()},this.buildGraph=function(){this.changeDefaultController();let t=r.giveEventsController({viewer:h.getViewer()});t&&t.fireEvent("onTransientCompareRemoved");let S,M,x,b,U,I,y,O,E,A,P,R,V,T,F,N,W,_=[],k=null,L=!1,q={},j={},B=a.createSceneGraphOverrideSet(w.getFrameWindow().getViewer()),X=!1,H=null,G=null;"2D"===v&&(N=l.getManager({name:"DMU2DSheetManager",context:h.getFrameWindow()}));let z=r.getReviewContext({viewer:w.getFrameWindow().getViewer()}),J=!1;if(z&&z.getCurrentSessionMarkup()&&z.getCurrentSessionMarkup().isVisible()&&(J=!0,z.getUIManager().setMarkupVisualizationActiveState(!1)),L=!1,y=z&&z.getReviewCtxInformation()?z.getReviewCtxInformation().contextId:null,h.getApplicativeData()&&h.getApplicativeData().getLoadedItfData&&h.getApplicativeData().getLoadedItfData()&&h.getApplicativeData().getLoadedItfData().data&&h.getApplicativeData().getLoadedItfData().data.length)y=h.getApplicativeData().getLoadedItfData().data[0].prd[0]?h.getApplicativeData().getLoadedItfData().data[0].prd[0]:y;else if(y){let e=h.getRootBagPath().getChildrenPathes();for(let t=0;t<e.length;t++){let n=a.getNodeID(e[t].getLastElement(!0));if(h.getController().isFiltered(n)&&y===h.getController().isFiltered(n).filterId){y=n;break}}}function K(){F&&(F.removeAll(),F.destroy()),F=new g({className:"DMU3DCompareCommand"}).inject(w.getFrameWindow().getUIFrame());let e="3D"===v?C.notifySecondProduct:C.notifySecondDocument;F.add({msgType:"primary",message:e,closable:!1,buttons:[{className:"default",label:C.compareCancel,onClick:function(){w.publish({event:"DMU3DCompareCmdCancelled"})}}]}),w.getFrameWindow().getViewer().render()}function Z(){let e=a.getOverrides(B,{idPaths:[[b]]});e&&e.length&&e.forEach(e=>{e.setOpacity(.5),e.setPickability("IGNORED")}),K()}function Q(e,t,n){f&&(f.destroy(),f=null),f=new d({body:w.getFrameWindow().getUIFrame(),type:e,notificationType:n,message:t})}function Y(){let e=u.get(),t=[],n=[];e.forEach(e=>{e.pathElement.externalPath.length>2&&(t.push(e),n.push({pathElement:new m([e.pathElement.externalPath[0],e.pathElement.externalPath[1]])}))}),t.length&&u.remove(t),n.length&&u.add(n),w.getFrameWindow().getViewer().render()}async function $(){if(z||(z=await o.createReviewContext({context:h})),!z)return;let t=z.getTransientReviewBag();if(!t)return;let a=S?t.getOccurence({pathElement:S},!0):x?t.getOccurence({idPath:[x]},!0):null,r=M?t.getOccurence({pathElement:M},!0):E?t.getOccurence({idPath:[E]},!0):null;if(r&&a&&r.id!==a.id&&("3D"===v||H&&G)){"2D"===v&&h.getViewpoint().reframe();let o="3D"===v?new n(w.getFrameWindow().getViewer(),t):new i(w.getFrameWindow().getViewer(),t);o.setAttributes([{name:"sID",value:t.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:t.computeNewName({object:o,prefix:v+"Compare"})},{name:"bVisible",value:!0},{name:"fBalance",value:50},{name:"bLocalAxis",value:!0},{name:"oSelections",value:[{id:a.id},{id:r.id}]}]),"2D"===v&&o.setAttributes([{name:"oSheetIDs",value:[{id:H||null},{id:G||null}]}]),t.addDMUObject(o),require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","DMU3DCompare")}),o.fireEvent("onDMUObjectInitialized",{dmuObject:o}),w.publish({event:"DMU3DCompareCmdEvent"})}else r&&a&&r.id===a.id?w.publish({event:"DMU3DCompareSameObjError"}):w.publish({event:"DMU3DCompareCmdError"})}function ee(){if(x&&(U||I)){let e=!1;s.inAppsSearch({mode:"furtive",app_socket_id:"DMU3DCompareCmd",fts_value:U?"(logicalid:"+U+") AND NOT (physicalid:"+x+")":"(versionid:"+I+") AND NOT (physicalid:"+x+")",callback:function(e){if(V&&clearTimeout(V),V=null,w.isRunning()&&e.length>=0){if((E=e[0].resourceid)===x)return void w.publish({event:"DMU3DCompareSameObjError"});"2D"===v&&E?h.getController().getAttributes({ids:[E],attributes:["ds6w:type"],callbacks:{onComplete:async function(e){if(e){if(z||(z=await o.createReviewContext({context:h})),!z)return;let n=z.getTransientReviewBag();if(!n)return;if(x!==E){let i=e[E]&&e[E]["ds6w:type"];O===i||"DIFLayout"===O&&"DIFSheet"===i||"DIFSheet"===O&&"DIFLayout"===i?(n.fireEvent("onComparisonStarted",{is2DCompare:!0}),n.fireEvent("onDMUAdd2DCompareRoot",{compare2DSecondRoot:E,documentType:i}),t=r.giveEventsController({viewer:h.getViewer()}),A=t.addEvent("on2DDocumentLoadSuccess",function(){t.removeEvent(A),A=null;let e=h.getRoots();if(N&&e.length>1){let e=N.getDocumentData(E);e&&e.sheetIDList&&e.sheetIDList.length?(-1!==e.sheetIDList.indexOf(H)?W=e.sheetIDList.indexOf(H):void 0!==W&&-1!==W&&W>=e.sheetIDList.length&&(W=0),(G=e.sheetIDList[W])||(G=E),G?$():(E&&h.removeRoots({pids:[E]}),w.publish({event:"DMU3DCompareCmdError"}))):(E&&h.removeRoots({pids:[E]}),w.publish({event:"DMU3DCompareCmdError"}))}else E&&h.removeRoots({pids:[E]}),w.publish({event:"DMU3DCompareCmdError"})}),R=t.addEvent("onEmptyDocument",function(){t.removeEvent(R),R=null;let e=h.getRoots(),n=[],i=!1;for(let t=0;t<e.length;t++)n.push(a.getNodeID(e[t]))===E&&(h.removeRoots({pids:[E]}),i=!0);i||(P=h.subscribe({event:"onRootAdded"},function(){h.unsubscribe(P),P=null,setTimeout(function(){h.removeRoots({pids:[E]}),h.getViewpoint().reframe(),w.publish({event:"DMU3DCompareCmdError"})})}))})):w.publish({event:"DMU3DCompareCmdError"})}else w.publish({event:"DMU3DCompareSameObjError"})}else w.publish({event:"DMU3DCompareCmdError"})},onFailure:function(){f&&(f.destroy(),f=null),w.isRunning()&&(f=w.sendNotify("info",C.errorFetchingPrdData))}}}):$()}},cancel:function(){e?null!==V&&(V&&clearTimeout(V),V=setTimeout(()=>{w.publish({event:"DMU3DCompareCmdCancelled"}),V=null},500)):e=!0}})}}function te(){let e=c.get();if(e&&e.length&&a.isAModelPath(e[0].pathElement)){let t=a.getFirstReference(e[0].pathElement);b?(M=t,b===a.getNodeID(M.externalPath[0])?w.publish({event:"DMU3DCompareSameObjError"}):setTimeout($)):(S=t,x=a.getNodeID(S.externalPath[0]),b=x,U=T[x]?T[x].logicalid:null,I=T[x]?T[x].versionid:null,Z(),w.emptyCSO(),w.emptyHSO(),ee())}else w.publish({event:"DMU3DCompareCmdError"})}function ne(){if(w.executionContext)w.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"ToggleLeftSidePanel",state:!0}).then(()=>{X=!0});else{let e=p.getCommandCheckHeader("RootPanel",h.getCommandContext());e&&!e.getState()&&(e.setState(!0),X=!0)}}D=function(){if(w.emptyCSO(),w.emptyHSO(),w.getFrameWindow().getViewer().render(),X)if(w.executionContext)w.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"ToggleLeftSidePanel",state:!1});else{let e=p.getCommandCheckHeader("RootPanel",h.getCommandContext());e&&e.getState()&&e.setState(!1)}t&&(R&&(t.removeEvent(R),R=null),A&&(t.removeEvent(A),A=null)),h.unsubscribe(P),P=null,S=M=null,k&&k.destroy(),q&&q.onAdd&&c.unsubscribe(q.onAdd),j&&j.onAdd&&u.unsubscribe(j.onAdd),B&&a.removeSceneGraphOverrideSet(w.getFrameWindow().getViewer(),B),F&&(F.removeAll(),F.destroy()),F=null,q={},j={},y=x=E=U=I=k=null};let ie=this.createInitialState("initialState"),oe=this.getFinalState();this.setEnterStateAction(ie,function(){let e=h.getRoots();if(!e||!e.length)return void w.publish({event:"DMU3DCompareCmdError"});_=c.get();let t=[];if("3D"===v&&_.length){if(_[0].pathElement||(L=!0),!L){let e=a.getLastReference(_[0].pathElement);e&&y&&a.getNodeID(e.externalPath[1])!==y&&(L=!0)}if(L)return;{S=_[0].pathElement.clone();let e=a.getLastReference(S);e&&(x=a.getNodeID(e.getLastElement(!0))),x&&t.push(x)}}if(!t.length)for(let n=0;n<e.length;n++){let i=a.getNodeID(e[n]);i&&t.push(i)}t.length?(w.emptyCSO(),w.emptyHSO(),h.getController().getAttributes({ids:t,attributes:["ds6wg:revision","logicalid","versionid","ds6w:type"],callbacks:{onComplete:function(e){if((T=e)&&w.isRunning())if(!S&&t.length>1&&!y&&"3D"===v)(F=new g({className:"DMU3DCompareCommand"}).inject(w.getFrameWindow().getUIFrame())).add({msgType:"primary",message:C.notifyFirstProduct,closable:!1,buttons:[{className:"default",label:C.compareCancel,onClick:function(){w.publish({event:"DMU3DCompareCmdCancelled"})}}]}),q.onAdd=c.onAdd(te),j.onAdd=u.onAdd(Y),ne();else{if(x)"3D"===v&&S&&S.externalPath.length&&S.externalPath[1]&&(b=a.getNodeID(S.externalPath[1]));else{if(y)x=y;else{let e=a.getRootReferences(w.getFrameWindow().getViewer())[0];e&&(x=a.getNodeID(e))}b=x}if(N&&"2D"===v&&x&&("Drawing"===(O=T[x]?T[x]["ds6w:type"]:null)||"DIFLayout"===O||"DIFSheet"===O)){let e=N.getDocumentData(x);e&&(H=e.activatedSheetID),H||(H=b),e&&e.sheetIDList&&(W=e.sheetIDList.indexOf(H))}U=T[x]?T[x].logicalid:null,I=T[x]?T[x].versionid:null,"3D"===v?(q.onAdd=c.onAdd(te),j.onAdd=u.onAdd(Y),Z()):K(),ee(),"3D"===v&&ne()}},onFailure:function(){f&&(f.destroy(),f=null),w.isRunning()&&(f=w.sendNotify("info",C.errorFetchingPrdData))}}})):w.publish({event:"DMU3DCompareCmdError"})}),this.addTransition({iSender:this,iEvent:"DMU3DCompareCmdEvent",iInitialState:ie,iFinalState:oe,iAction:function(e){D&&D(),this.restoreDefaultController(),e()}}),this.addTransition({iSender:this,iEvent:"DMU3DCompareCmdCancelled",iInitialState:ie,iFinalState:oe,iAction:function(e){Q("info",C.compareCancelled),z&&z.getCurrentSessionMarkup()&&J&&z.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),D&&D(),this.restoreDefaultController(),e()}}),this.addTransition({iSender:this,iInitialState:ie,iFinalState:oe,iCondition:function(){return L},iAction:function(e){Q("error",C.notifyFirstProductError),z&&z.getCurrentSessionMarkup()&&J&&z.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),D&&D(),this.restoreDefaultController(),e()}}),this.addTransition({iSender:this,iEvent:"DMU3DCompareSameObjError",iInitialState:ie,iFinalState:oe,iAction:function(e){Q("error",C.sameObjectsCompared),z&&z.getCurrentSessionMarkup()&&J&&z.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),D&&D(),this.restoreDefaultController(),e()}}),this.addTransition({iSender:this,iEvent:"DMU3DCompareCmdError",iInitialState:ie,iFinalState:oe,iAction:function(e){Q("error",C.compareCmdFailed),z&&z.getCurrentSessionMarkup()&&J&&z.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),D&&D(),this.restoreDefaultController(),e()}})}}})}),define("DS/DMUCommands/DMUColorOpacityOverloadCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUControls/EXPColorPicker","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/Visualization/ThreeJS_DS","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e)},beginExecute:function(e){this._parent(e);var r,l=i.getReviewContext({viewer:this.getFrameWindow().getViewer()}),s=l&&!l.isReadOnly()?l.getCurrentSessionMarkup():null;if(s&&!s.isReadOnly()){var d,g,c=n.get().slice(),u=[];for(d=0;d<c.length;d++)(g=s.getOrCreateOccurrenceOverloader(c[d]))?u.push({color:g.getAttribute("cColor"),opacity:g.getAttribute("fOpacity")}):u.push({color:null,opacity:null});var m,p,C,v=!0,f=!0;for(d=0;d<u.length;d++)f&&(void 0===m?m=u[d].color:(null!==m&&null!==u[d].color&&!m.equals(u[d].color)||null===m&&null!==u[d].color||null!==m&&null===u[d].color)&&(m=null,C=!1,f=!1)),v&&(void 0===p?p=u[d].opacity:p!==u[d].opacity&&(p=null,C=!1,v=!1));void 0===C&&(C=null===p&&null===m);var D=!1,h=i.giveEventsController({viewer:this.getFrameWindow().getViewer()});r||(r=new t({frameWindow:this.getFrameWindow(),onDestroyCB:function(){D&&h.fireEvent("onSaveRequested",{}),r=null,D=!1}})).build({displayColorSlider:!0,displayOpacitySlider:!0,displayResetButton:!0,defaultColor:m,onColorChangedCB:function(e){for(var t=[],n=0;n<c.length;n++)(g=s.getOrCreateOccurrenceOverloader(c[n],!0))&&(D=!0,g.setAttribute("cColor",new o.Color(e.color)),t.push({state:{cColor:new o.Color(e.color)},target:g}));t.length&&(h.fireEvent("onDMUOverloadPropertiesChanged",{overloads:t}),h.fireEvent("onSaveRequested",{}))},defaultOpacity:p,minOpacity:0,maxOpacity:1,onOpacityChangedCB:function(e){for(var t=[],n=0;n<c.length;n++)(g=s.getOrCreateOccurrenceOverloader(c[n],!0))&&(D=!0,g.setAttribute("fOpacity",e.opacity),t.push({state:{fOpacity:e.opacity},target:g}));t.length&&(h.fireEvent("onDMUOverloadPropertiesChanged",{overloads:t}),h.fireEvent("onSaveRequested",{}))},defaultResetState:C,resetButtonLabel:a.resetLabel,onResetButtonPressedCB:function(){for(var e=[],t=0;t<c.length;t++)(g=s.getOrCreateOccurrenceOverloader(c[t]))&&(D=!0,g.setAttribute("cColor",null),g.setAttribute("fOpacity",null),e.push({state:{cColor:null,fOpacity:null},target:g}));e.length&&(h.fireEvent("onDMUOverloadPropertiesChanged",{overloads:e}),h.fireEvent("onSaveRequested",{}))}})}this.cancel()}})}),define("DS/DMUCommands/DMUEditPropertiesCmd",["UWA/Class","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend(t,{init:function(e){e.mode="shared",e.isAsynchronous=!0,this._parent(e),this.beginExecute=function(){var t=this;let o=t.options.executionContext?t.options.executionContext.getComponent("Viewer"):t.getFrameWindow().getViewer();var a=n.getReviewContext({viewer:o});if(a){var r=a.getReviewCtxInformation(),l=i.get();let n;if(1===l.length&&l[0].pathElement.getLastElement(!0).getDMUType&&"DMUMarkup"===l[0].pathElement.getLastElement(!0).getDMUType()){let e=a.getValidation();e&&e.getMarkups().some(e=>{let t=e.getRepRef();if(t.getMarkupContent()&&t.getMarkupContent().getNode()===l[0].pathElement.getLastElement(!0))return n=e.getPlmID(),!0})}var s=this._objectId?this._objectId:n||r.reviewId;if(s){require(["DS/PADUtils/PADSettingsMgt"],function(n){t.launchProperties({options:e,getSecurityContext:function(){return{SecurityContext:n.getSetting("pad_security_ctx"),tenant:n.getSetting("x3dPlatformId")}},getSelectedNodes:function(){return[{id:s,getID:function(){return this.id},source:"3DSpace",tenant:n.getSetting("x3dPlatformId")}]}}),t.cancel(),t._objectId=void 0})}}else t.done()}},setObject:function(e){this._objectId=e}})}),define("DS/DMUCommands/DMURemoveAllcmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);let n=(e.frameWindow||this.getFrameWindow()).getViewer();this.beginExecute=(()=>{const e=t.getContextViewer({viewer:n});t.getReviewContext({context:e})&&t.removeReviewContext({context:e}),this.done()})}})}),define("DS/DMUCommands/DMUGenerateTICCmd",["DS/DMUBaseExperience/DMUContextManager","DS/ApplicationFrame/FrameWindowsManager","DS/CATWebUXTIC/CATWebUXTICCmdAdapt","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/Selection/CSOManager","DS/DMUMeasurable/DMUToolsSceneGraph","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DMUCommands/assets/nls/DMUCommands","DS/DMUReadPersistence/DMULoadingContextController"],function(e,t,n,i,o,a,r,l,s,d,g){"use strict";return n.extend({init:function(n){let c=n.executionContext?n.executionContext.getComponent("Viewer").getFrameWindow().getViewer():t.getFrameWindow(n.context).getViewer();var u=e.getContextViewer({viewer:c});function m(){var e=[];return o.get().forEach(function(t){for(var n=0;t.pathElement,n<t.pathElement.getLength();n++){var i=t.pathElement.getElement(n);i&&"function"==typeof i.getDMUType&&"DMUValidationExposedPresentation"===i.getDMUType()&&e.push(i)}}),e}function p(e){var t=[];if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var n=m();if(n.length>0&&"ENOR3V_AP"===window.widget.data.appId)for(var i=0;i<n.length;i++){var o=n[i].getOwner();t.push(o.getPlmID());var a=o.getAssociatedCheck(),r=e.getValidation().getChecks();for(let e=0;e<a.length;e++)for(let n=0;n<r.length;n++)if(a[e]===r[n].getPlmID()){let e=r[n].getJsonRequirements();if(e.length){const n=t=>t===e[0].getPlmID();e.length&&t.findIndex(n)<0&&t.push(e[0].getPlmID())}}}else t.push(e.getValidation().getPlmID())}else t.push(e.getReviewCtxInformation().reviewId);return t}function C(e,t){var n;return n="ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId?{ids:e.getValidation().getContext().getSubContextID()?[e.getValidation().getContext().getSubContextID()]:[e.getValidation().getContext().getMainContextID()],type:e.getValidation().getContext().getSubContextType()?e.getValidation().getContext().getSubContextType():e.getValidation().getContext().getMainContextType()}:{ids:[e.getReviewCtxInformation().subContext&&e.getReviewCtxInformation().subContext.id?e.getReviewCtxInformation().subContext.id:e.getReviewCtxInformation().contextId],type:e.getReviewCtxInformation().subContext&&e.getReviewCtxInformation().subContext.type?e.getReviewCtxInformation().subContext.type:e.getReviewCtxInformation().contextType},new Promise(i=>{if("DesignSight"===n.type||"MSR"===n.type){var o=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl(),r=require("DS/PADUtils/PADUtilsServices").getPlatformId(),l=require("DS/PADUtils/PADUtilsServices").getWidgetId(),s=o+"/resources/enorelnav/navigate/setpreferences?tenant="+r;require("DS/WAFData/WAFData").authenticatedRequest(s,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify({widgetId:l,relations:["use-auto-by-type-relations"],countmanagement:!1}),onComplete:function(){var e={widgetId:l,ecoSystemWithDetail:!0,debug:!1};e.id=n.ids[0],s=o+"/resources/enorelnav/navigate/getecosystem?tenant="+r,require("DS/WAFData/WAFData").authenticatedRequest(s,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(e),onComplete:function(e){(e=JSON.parse(e)).newstructure.simulation_to&&e.newstructure.simulation_to[0]?i([e.newstructure.simulation_to[0].id]):i([])},onFailure:function(){i()},onTimeout:function(){i()}})},onFailure:function(){i()},onTimeout:function(){i()}})}else if("CA"===t)void 0===n.type?function(e,t){var n=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx"),i=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?SecurityContext="+n+"&tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),o={physicalid:e,label:"DMUFetchForMarkerVisualization-",select_predicate:["ds6w:type"],select_file:[]};require("DS/WAFData/WAFData").authenticatedRequest(i,{data:JSON.stringify(o),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":require("DS/PADUtils/PADSettingsMgt").getSetting("lang"),SecurityContext:n},timeout:6e4,onComplete:function(e){var n=e?JSON.parse(e):null;t(n)},onFailure:function(){t([])},onTimeout:function(){t([])}})}(n.ids,function(e){e&&e.results&&e.results.length&&e.results[0].attributes&&e.results[0].attributes.length>=2&&"ENOStrRefinementSpecification"===e.results[0].attributes[1].value?u.getController().getPrdIdFromFilterId(n.ids).then(function(e){i([e])}):i(n.ids)}):"ENOStrRefinementSpecification"===n.type?u.getController().getPrdIdFromFilterId(n.ids).then(function(e){i([e])}):i(n.ids);else{var d=[],g=u.getController().getRootStats(e.getReviewCtxInformation().subContext&&e.getReviewCtxInformation().subContext.id?e.getReviewCtxInformation().subContext.id:e.getReviewCtxInformation().contextId),c=g&&g.serviceId?g.serviceId:"3DSpace";n.ids.forEach(function(e){d.push({physicalId:e,serviceId:c,objectType:a.getNodeType(u.getController().getNode({id:e}))})}),i(d)}})}function v(e,t,n){return new Promise(function(i){if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId)if("ENOR3V_AP"===window.widget.data.appId&&(0===e.getValidation().getHighlights().length||m().length>0||o.get().length>0))i(t);else if("ENOR3R_AP"===window.widget.data.appId&&(0===e.getValidation().getHighlights().length||0===m().length&&(e.getValidation().getValidated().getPathElements().length>0||o.get().length!==(C=[],o.get().forEach(function(e){for(var t=0;e.pathElement,t<e.pathElement.getLength();t++){var n=e.pathElement.getElement(t);n&&"function"==typeof n.getDMUType&&"DMUSlide"===n.getDMUType()&&C.push(n)}}),C).length)))i(t);else{var a,g,c=r.createElement("div");"Issue"===n.cmdType||"IssueTemplate"===n.cmdType?(a=d.issueOnReview,g=d.issueTitle):(a=d.caOnReview,g=d.caTitle),r.createElement("label",{text:a,styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(c);var p=new l({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:g,immersiveFrame:u.getFrameWindow().getImmersiveFrame(),content:c,closeButtonFlag:!0,buttons:{Ok:new s({label:d.yes,onClick:function(){p.destroy(),i(t)}}),Cancel:new s({label:d.no,emphasize:"primary",onClick:function(){p.destroy(),t.status="ticCancel",i(t)}})}});p.addEventListener("close",function(){p.destroy(),i()})}else t.fromIssue=e.getReviewCtxInformation().fromIssue,i(t);var C}).then(function(e){e?n.onComplete(e):n.onCancel()})}n.pad3DViewer=u,this._parent(n),this.getParameters=function(t){var n=e.getReviewContext({context:u}),l=n.getReviewCtxInformation();if(!l||l.reviewId){var s=i.giveDMUApplicativeContextManager({context:u});s&&s.getApplicativeContainersTICInfo(t.cmdType,function(i){if(i.length)if(i[0]&&i[0].status&&"ticCancel"===i[0].status)t.onCancel();else{if(i[0].attachments)p(n).forEach(e=>{i[0].attachments.push(e)});i[0].fromIssue=l.fromIssue,t.onComplete(i[0])}else{var s={reportedAgainst:[],contexts:[],assignees:[],attachments:[]};s.title=function(e){let t;if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId)if("ENOR3R_AP"===window.widget.data.appId)t=e.getValidation().getName();else{var n=m();t=n.length>0?n[0].getOwner().getName():e.getValidation().getName()}else t=e.getReviewCtxInformation().reviewName;return t}(n),s.priority=function(e){let t="Low";if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){if("ENOR3R_AP"===window.widget.data.appId)return t;var n=m();if(n.length>0&&n[0].getOwner()){var i=parseInt(n[0].getOwner().getRating());3===i&&(t="Medium"),"CA"===e.cmdType?4!==i&&6!==i||(t="High"):4===i?t="High":6===i&&(t="Urgent")}}return t}(t),s.attachments=p(n),s.reportedAgainst=function(e,t){var n=u.getController().getRootStats(e.getReviewCtxInformation().subContext&&e.getReviewCtxInformation().subContext.id?e.getReviewCtxInformation().subContext.id:e.getReviewCtxInformation().contextId),i=[],r=n&&n.serviceId?n.serviceId:"3DSpace";if(o.get().forEach(function(e){var n=e.pathElement;if(n){for(;n&&!a.isReference(n.getLastElement());)n=n.getParentPath();if(n){var o=n.getLastElement(),l=a.getNodeID(o);i||(i=[]),"CA"===t?-1===i.indexOf(l)&&i.push(l):i.some(e=>e.physicalId===l)||i.push({physicalId:l,serviceId:r,objectType:a.getNodeType(o)})}}}),!i.length&&("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId))for(var l=e.getValidation().getValidated().getPathElements(),s=0;s<l.length;s++)if(l[s]&&l[s].pathElement.length)if("CA"===t)i.push(l[s].pathElement[l[s].pathElement.length-1]);else{var d=u.getController().getNode({id:l[s].pathElement[l[s].pathElement.length-1]});i.push({physicalId:l[s].pathElement[l[s].pathElement.length-1],serviceId:r,objectType:a.getNodeType(d)})}return i}(n,t.cmdType),s.attachments.length&&(s.onComplete=function(t){e.giveEventsController({viewer:u.getViewer()}).fireEvent("onTICCreationComplete",t)},s.onClose=function(t){e.giveEventsController({viewer:u.getViewer()}).fireEvent("onTICCreationCancel",t)}),C(n,t.cmdType).then(e=>{if(e)if(0===s.reportedAgainst.length&&(s.reportedAgainst=e),s.contexts=e,"R2V_FeatureState"===g.getLoadingContextController({context:u}).getLoadMarkupCtxType()){var i="CA"===t.cmdType?s.contexts:s.contexts.map(e=>e.physicalId);s.description=function(e,t){let n;return new Promise((i,o)=>{var a=require("DS/PADUtils/PADUtilsServices").getPlatformURL("r2vsurvey"),r=require("DS/PADUtils/PADSettingsMgt").getSetting("lang");require("DS/WAFData/WAFData").authenticatedRequest(a+"/enovia/resources/r2v/v1/modeler/featurestate/fetch",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":r},data:JSON.stringify({ids:t}),timeout:6e4,onComplete:function(t){let o=JSON.parse(t);if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var a=m();a.length>0&&a[0].getOwner()&&a[0].getOwner().getDescription&&"ENOR3V_AP"===window.widget.data.appId?(n=a[0].getOwner().getDescription())||(n=e.getValidation().getContext().getSubContextName()?e.getValidation().getContext().getSubContextName():e.getValidation().getContext().getMainContextName()):n=void 0!==e.getReviewCtxInformation().reviewDescription?e.getReviewCtxInformation().reviewDescription:e.getValidation().getContext().getSubContextName()?e.getValidation().getContext().getSubContextName():e.getValidation().getContext().getMainContextName()}else n=void 0!==e.getReviewCtxInformation().reviewDescription?e.getReviewCtxInformation().reviewDescription:o.result[0]["ds6w:label"];i(n)},onFailure:o,onTimeout:o})})}(n,i).then(e=>{s.description=e,s.reportedAgainst=s.contexts=[],v(n,s,t)})}else{var o="CA"===t.cmdType?s.reportedAgainst:s.reportedAgainst.map(e=>e.physicalId);(function(e,t){return new Promise(function(n){let i,o=r.clone(t);if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var a=e.getValidation().getContext().getSubContextType()?e.getValidation().getContext().getSubContextType():e.getValidation().getContext().getMainContextType();"DesignSight"!==a&&"MSR"!==a||o.push(e.getValidation().getPlmID()),new Promise(function(e){u.getController().getAttributes({ids:o,attributes:["owner","ds6w:description"],callbacks:{onComplete:t=>e(t),onFailure:()=>e}})}).then(function(t){var o=m();o.length>0&&o[0].getOwner()&&o[0].getOwner().getDescription&&"ENOR3V_AP"===window.widget.data.appId?(i=o[0].getOwner().getDescription())||(i=e.getValidation().getContext().getSubContextName()?e.getValidation().getContext().getSubContextName():e.getValidation().getContext().getMainContextName()):(t&&t[e.getValidation().getPlmID()]&&(i=t[e.getValidation().getPlmID()]["ds6w:description"]),i||(i=e.getValidation().getContext().getSubContextName()?e.getValidation().getContext().getSubContextName():e.getValidation().getContext().getMainContextName())),n(i)})}else{i=e.getReviewCtxInformation().reviewDescription?e.getReviewCtxInformation().reviewDescription:"";let o,a=[],r=e.getReviewCtxInformation().subContext&&e.getReviewCtxInformation().subContext.id?e.getReviewCtxInformation().subContext.id:e.getReviewCtxInformation().contextId;if(!i){a.push(e.getReviewCtxInformation().subContext&&e.getReviewCtxInformation().subContext.id?e.getReviewCtxInformation().subContext.id:e.getReviewCtxInformation().contextId);let t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.getRoots(u).map(function(e){return t.getNodeID(e)});-1===n.indexOf(r)&&n.some(function(e){var t=u.getController().isFiltered(e);if(t&&t.hasFilter&&t.filterId===r)return a.push(o=e)})}new Promise(function(e){u.getController().getAttributes({ids:[].concat(t,a),attributes:["ds6w:label"],callbacks:{onComplete:function(t){i||(t[r]&&(i=t[r]["ds6w:label"]),o&&t[o]&&(i+=" ("+t[o]["ds6w:label"]+")")),e(i)},onFailure:()=>e}})}).then(function(e){n(e)})}})})(n,o).then(e=>{s.description=e,function(e,t,n){return new Promise(function(i){if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var o=e.getValidation().getContext().getSubContextType()?e.getValidation().getContext().getSubContextType():e.getValidation().getContext().getMainContextType(),a=r.clone(t);"DesignSight"!==o&&"MSR"!==o||a.push(e.getValidation().getPlmID()),new Promise(function(e){u.getController().getAttributes({ids:a,attributes:["owner","ds6w:description"],callbacks:{onComplete:t=>e(t),onFailure:()=>e}})}).then(function(e){for(var o=0;o<t.length;o++)e&&e[t[o]].owner&&-1===n.indexOf(e[t[o]].owner)&&n.push(e[t[o]].owner);i()})}else{let o=[];o.push(e.getReviewCtxInformation().subContext&&e.getReviewCtxInformation().subContext.id?e.getReviewCtxInformation().subContext.id:e.getReviewCtxInformation().contextId),new Promise(function(e){u.getController().getAttributes({ids:[].concat(t,o),attributes:["ds6w:responsibleuid"],callbacks:{onComplete:function(i){t.forEach(e=>{let t=i[e]["ds6w:responsibleuid"];t&&(n||(n=[]),-1===n.indexOf(t)&&n.push(t))}),e()},onFailure:()=>e}})}).then(function(){i()})}})}(n,o,s.assignees).then(()=>{v(n,s,t)})})}})}})}else t.onFailure("No Markup is available")},this._destroy=function(){var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})}),define("DS/DMUCommands/DMUNormalViewCmd",["DS/DMUBaseCommands/EXPGenericCmdOneSelThenOperation","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUMeasurable/DMUToolsMaths","DS/DMUBaseExperience/EXPToolsVisualization","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){this._parent(e,this._applyViewpoint,o.normalViewTargetLabel,{engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,valuedFromCSO:!0,pickingMode:"primHybrid",prePickingMode:"primHybrid"},!0)},beginExecute:function(){t.emptyCSO(),t.emptyHSO(),this._parent(),this.done()},_applyViewpoint:function(e){var o=e[0].normal,a=e[0].position;if(null!=o&&null!=a){var r=i.getViewpointInfo(this.getFrameWindow().getViewer().currentViewpoint),l=o.angleTo(r.sight);l>Math.PI/2&&l<Math.PI/2*3&&o.negate();var s=n.computeTransformationBetweenTwoLines(r.position,r.sight,a,o);i.moveViewpoint({freeZoneSize:this.getFrameWindow().getImmersiveFrame().getFreeZone().getBoundingClientRect(),viewerSize:{width:this.getFrameWindow().getViewer().SCREEN_WIDTH,height:this.getFrameWindow().getViewer().SCREEN_HEIGHT},viewpoint:this.getFrameWindow().getViewer().currentViewpoint,target:r.position.applyMatrix4(s.transformation),sightDirection:r.sight.transformDirection(s.transformation),upDirection:r.up.transformDirection(s.transformation),targetDistance:r.distance,duration:400})}t.emptyCSO()}})}),define("DS/DMUCommands/DMUPositionOverloadCmd",["DS/Visualization/ThreeJS_DS","DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/Selection/CSOManager","DS/CATW3DBoxes/CATW3DBoxController","DS/CATW3DRobot/CATW3DRobot","DS/CATW3DMoveManager/CATW3DMoveManager","DS/CATW3DCommands/CATW3DMoveBarUX","DS/CATW3DCommands/CATW3DLevelSelectorCmd","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a,r,l,s,d,g,c,u,m){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"exclusive",isAsynchronous:!0});var p,C,v,f,D,h,w=this,S=!1,M=[];let x,b=t.executionContext;var U,I;function y(){S=!1,w.endCommand(),w.cancel()}function O(){S=!0,w.endCommand(),w.cancel()}function E(e){"Enter"!==e.key&&13!==e.keyCode||!1===e.ctrlKey&&!1===e.altKey&&!1===e.shiftKey&&!1===e.metaKey&&O()}function A(t){var i,o=n.getReviewContext({viewer:w.getFrameWindow().getViewer()}),a=o&&!o.isReadOnly()?o.getCurrentSessionMarkup():null,r=[];if(t&&t.objectsMoved&&t.objectsMoved.length&&a){for(var l=0;l<t.objectsMoved.length;l++)if(i=a.getOrCreateOccurrenceOverloader(t.objectsMoved[l],!0)){var s=i.getOccurrencePathElement(),d=s?s.getParentPath().getWorldMatrix():null;if(d){var g=(new e.Matrix4).getInverse(d);i.setAttribute("mTransfoMatrix",(new e.Matrix4).multiplyMatrices(g,t.objectsMoved[l].worldMatrix)),r.push({target:i,state:{mTransfoMatrix:(new e.Matrix4).multiplyMatrices(g,t.objectsMoved[l].worldMatrix)}})}}w.getFrameWindow().getViewer().render();var c=n.giveEventsController({viewer:w.getFrameWindow().getViewer()});c&&r.length&&(c.fireEvent("onDMUOverloadPropertiesChanged",{overloads:r}),c.fireEvent("onSaveRequested",{}))}}b&&(x=b.getComponent(WAfrStandardComponentKey.HandlerComponent)),this.beginExecute=function(){if(!(p=n.getContextViewer({viewer:this.getFrameWindow().getViewer()})))return window.console.log("No PAD3DViewer available!!"),void this.cancel();var e=u.giveSelectionManager({context:p});e&&e.getActiveState()&&(e.setActiveState(!1),I=!0);var t=p.getViewer();h={primitive:t.picking.primitive,trapSelection:t.picking.trapSelection,trapPrimitive:t.picking.trapPrimitive,trapGPU:t.picking.trapGPU},D=t.pPicking.primitive,t.setPicking({primitive:0,trapSelection:!0,trapPrimitive:!1,trapGPU:!0}),t.setPrePicking({primitive:0}),U=[];for(var w=i.giveDMUApplicativeContextManager({context:p}),b=w?w.getApplicativeControllers():[],P=0;P<b.length;P++)b[P].setMinimalUIFlag&&(U.push({ctx:b[P],minimalFlag:b[P].getMinimalUIFlag()}),b[P].setMinimalUIFlag(!0),b[P].setAnnotationUIVisibleFlag&&b[P].setAnnotationUIVisibleFlag(!1));(C=new s({uiFrame:p.getFrameWindow().getUIFrame(),onSave:O,onCancel:y,nlsModifLbl:m.movePartsOrPrdLabel})).show(),x?d.displayReferentLevel(!0):g.getCommand("DMULevelSelectorHdr",p.getCommandContext()).showReferentLevel(!0),S=!1,l.unreferenceMoveManager({context:p}),v=l.getMoveManager({context:p}),M.push(v.subscribe("onValidateMove",A)),M.push(v.subscribe("MoveEnd",function(){p.getController().forceRefresh()})),f=r.getMove3DRobot({context:p});var R,V=o.get();V.length&&(V[V.length-1].event&&(R=t.pick(t.getMousePosition(V[V.length-1].event.getCurrentPosition(t.canvas)),"mesh",!0).position),f.modifyTargetAndPosition({pathElement:V[0].pathElement,robotPosition:R}));var T=v.subscribe("Move",function(){C.showSave(),v.unsubscribe(T)}),F=a.getBoxController({context:p});F&&F.setActiveState(!0),document.addEventListener("keydown",E),p.getFrameWindow().getContextualUIManager().register({subscriberId:"DMUMoveCmdCtxBarID",workbenchName:"CATW3DCommands",context:p.getCommandContext(),module:"CATW3DCommands",cmdPrefix:"",directory:"assets/afr/",merge:!0,onContextualBarReady:function(){let e=[],t=Boolean(p.getExecutionContext);var n=o.get();if(1===n.length)for(var i=n[0].pathElement;i;){if(c.isPLMNode(i.getLastElement(!0)))return e=[{name:"LevelSelectorStr",line:1,hdr_list:["LevelSelectorHdr"],type:"handler",identifier:"LevelSelectorHdr"}],t?{WAfrCtxBarRow1:{model:e}}:{cmdList:e};i=i.getParentPath()}}})},this.pauseExecute=function(){a.getBoxController({context:p}).setActiveState(!1),f.setVisibility(!1),C.hide(),document.removeEventListener("keydown",E),this.done&&this.done()},this.resumeExecute=function(){a.getBoxController({context:p}).setActiveState(!0),f.setVisibility(!0),C.show(),document.addEventListener("keydown",E),this.done&&this.done()},this.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},this.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},this.endCommand=function(){v&&v.terminateMove({save:S}),require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command",S?"MoveOK":"MoveCancel")}),x?d.displayReferentLevel(!1):g.getCommand("DMULevelSelectorHdr",p.getCommandContext()).showReferentLevel(!1),function(){if(U&&U.length)for(var e=0;e<U.length;e++)void 0!==U[e].minimalFlag&&(U[e].ctx.setMinimalUIFlag(U[e].minimalFlag),U[e].ctx.setAnnotationUIVisibleFlag&&U[e].ctx.setAnnotationUIVisibleFlag(!U[e].minimalFlag));U=null,document.removeEventListener("keydown",E),C&&C.destroy(),C=null,f&&f.unreference(),f=null,v&&M.forEach(v.unsubscribe,v),M=[],l.unreferenceMoveManager({context:p}),v=null,a.unregisterBoxController({context:p}),p&&p.getFrameWindow().getContextualUIManager().unregister("DMUMoveCmdCtxBarID")}(),p&&p.getFrameWindow().getContextualUIManager().hideContextualMenus();var e=u.giveSelectionManager({context:p});if(e&&I&&e.setActiveState(!0),I=null,p){var t=p.getViewer();t.setPicking(h),t.setPrePicking({primitive:D})}p=v=C=f=null}}})}),define("DS/DMUCommands/DMUReqCompareCmd",["require","exports","DS/CATWebUXComponents/DMUCommandCheckHeader","DS/DMUPlayCompare/DMUCompareRequirement","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/EXPManagerSet","DS/PADServices/utils/SearchUtils","DS/DMUBaseUIControllers/DMUReviewContextInitializer","UWA/Utils","DS/DMUControls/EXPNotify","DS/CATWebUXComponents/CATWebUXNotifBar","DS/CATWebUXComponents/DMUCommandsManager","i18n!DS/DMUCommands/assets/nls/DMUCommands","DS/DMUBaseUIControllers/DMUReqCompareController","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n,i,o,a,r,l,s,d,g,c,u,m,p){"use strict";return class extends n{constructor(e){super(e,{});let t,n,C,v,f,D,h,w,S,M=this,x=p.getContextViewer({viewer:this.getFrameWindow().getViewer()}),b="",U="",I="",y="",O="",E=!1,A=!1,P=p.giveEventsController({viewer:x.getViewer()}),R={};this.onStateChange(function(){function e(e,t,n){f&&(f.destroy(),f=null),f=new d({body:M.getFrameWindow().getUIFrame(),type:e,notificationType:n,message:t})}function V(t){b&&t&&(E=!1,r.inAppsSearch({mode:"furtive",app_socket_id:"DMUReqCompareCmd",search_criteria_to_display:"",fts_value:y?"(logicalid:"+y+") AND NOT (physicalid:"+t+")":"(versionid:"+O+") AND NOT (physicalid:"+t+")",callback:function(n){if(v&&(clearTimeout(v),v=null),n.length>=0){if(w&&(w.removeAll(),w.destroy()),(U=n[0].resourceid)===t)return E=!0,M.setState(!1),void e("info",u.sameObjectsCompared);U&&x.getController().getAttributes({ids:[U],attributes:["ds6w:type"],callbacks:{onComplete:async function(t){if(t){if(C||(C=await l.createReviewContext({context:x})),!C)return;let n=C.getTransientReviewBag();if(!n)return;let o=t[U]&&t[U]["ds6w:type"];I===o||A&&("Chapter"===o||"Requirement"===o||"Comment"===o)?(n.fireEvent("onDMUDisplayRequirementCompare",{compare2DDocument:U,documentType:o}),async function(){if(C||(C=await l.createReviewContext({context:x})),!C)return;let t;S||(S=m.giveReqCompareController({context:x}));let n=C.getCurrentSessionMarkup();if(n&&n.isVisible()&&n.getActiveFlag()){let e=n.getSlides();if(e&&e.length>1)for(let t=0;t<e.length;t++){let i=e[t].getDMUObjects("DMUCompareRequirement");if(i&&i.length&&S&&S.getCompareIDsFromFeature){let o=S.getCompareIDsFromFeature(i[0]);if(o&&b===o[0]&&U===o[1])return n.setCurrentSlide(e[t]),C.setVisibleMarkups([n]),void S.displayRequirementComparison(i[0])}}t=n}else t=C.getTransientReviewBag();if(!t)return;let o=b?t.getOccurence({idPath:[b]},!0):null,a=U?t.getOccurence({idPath:[U]},!0):null;if(a&&o&&a.id!==o.id){if((h=new i(M.getFrameWindow().getViewer(),t)).setAttributes([{name:"sID",value:t.computeNewID()},{name:"sUuid",value:s.getUUID()},{name:"sName",value:t.computeNewName({object:h,prefix:"RequirementCompare"})},{name:"oSelections",value:[{id:o.id},{id:a.id}]}]),"DMUMarkup"===t.getType()&&t.isVisible()&&t.getActiveFlag()){let e=c.getCommand("slideCmdHdr",x.getCommandContext());e&&e.begin();let t=n.getSlides();if(t&&t.length&&t.length>1){let e=t[1];n.setCurrentSlide(e),e.addDMUObject(h),C.setVisibleMarkups([n])}}else t.addDMUObject(h);S&&S.displayRequirementComparison(h),h.fireEvent("onDMUObjectInitialized",{dmuObject:h})}else e("error",u.compareCmdFailed)}()):(E=!0,M.setState(!1),e("error",u.invalidCompareObj))}},onFailure:function(){e("error",u.compareCmdFailed)}}})}},cancel:function(){w&&(w.removeAll(),w.destroy()),v&&clearTimeout(v),M.getState()&&(v=setTimeout(()=>{E=!0,e("info",u.compareCancelled),M.setState(!1),v=null},500))}}))}if(M.getState()){if(D=x.subscribe({event:"onRootRemoved"},function(){x.unsubscribe(D),D=null,n&&n.setRequirementCompareData({firstReqData:[],secondReqData:[]}),setTimeout(function(){M.setState(!1)})}),S||(S=m.giveReqCompareController({context:x})),S&&(h=S.getActiveCompareFeature()),!h){let i="",r=(n=a.getManager({name:"DMU2DSheetManager",context:x.getFrameWindow()})).getSelectedElementIDs();A=!1;let l=x.getRoots();if(!l||!l.length)return e("error",u.compareCmdFailed),E=!0,void M.setState(!1);if(r&&r.length){A=!0;let e=r[0].split("/");i=e.pop()}else{let e=o.getNodeID(l[0]);e&&(i=e)}C=p.getReviewContext({viewer:M.getFrameWindow().getViewer()}),x.getController().getAttributes({ids:[i],attributes:["ds6wg:revision","logicalid","versionid","ds6w:type","type_icon_url"],callbacks:{onComplete:function(a){if(t=a){let a=o.getRootReferences(M.getFrameWindow().getViewer())[0];a&&(b=o.getNodeID(a)),n&&i&&("Requirement"===(I=t[i]?t[i]["ds6w:type"]:null)||"Requirement Specification"===I||A&&("Comment"===I||"Chapter"===I))&&(y=t[i]?t[i].logicalid:null,O=t[i]?t[i].versionid:null,(w=new g({className:"DMUReqCompareCmd"}).inject(M.getFrameWindow().getUIFrame())).add({msgType:"primary",message:u.notifySecondDocument,closable:!1,buttons:[{className:"default",label:u.compareCancel,onClick:function(){M.setState(!1),e("info",u.compareCancelled)}}]}),V(i))}},onFailure:function(){E=!0,M.setState(!1),e("error",u.compareCmdFailed)}}})}}else{if(w&&(w.removeAll(),w.destroy()),S||(S=m.giveReqCompareController({context:x})),S&&S.getActiveCompareFeature()&&(h=S.getActiveCompareFeature()),!E&&h&&(h.fireEvent("onDMUReqCompareCancelled",{dmuObject:h}),C||(C=p.getReviewContext({viewer:M.getFrameWindow().getViewer()}))),x.unsubscribe(D),P){let e=Object.keys(R);for(let t=0;t<e.length;t++)P.removeEvent(R[e[t]]||"")}R={},D=null,b="",U="",y="",O="",h=null,S=void 0}})}}}),define("DS/DMUCommands/DMUFLEditPropertiesCmd",["UWA/Class","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend(t,{init:async function(e){let t=this;t._tokensXSO={},t._parent(e,{mode:"shared",isAsynchronous:!1}),t.getSelect=function(){return new Promise(e=>{require(["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(t){var n,o=i.get();if(o.length&&o.some(function(e){return t.isAModelPath(e.pathElement)})){for(var a=o[0].pathElement.externalPath.length-1;a>=0&&((n=o[0].pathElement.externalPath[a])&&!t.isPLMNode(n));--a){if(n.getDibInfo){var r=a>0?o[0].pathElement.externalPath[a-1]:null;e([{dibInfo:n.getDibInfo(),parentDibInfo:r&&r.getDibInfo?r.getDibInfo():null}])}n.getReqInfo&&e([{reqInfo:n.getReqInfo(),parentDocInfo:null}])}e(o)}e([])})})},t._tokensXSO.onPostAdd=i.onPostAdd(function(){window&&window.__karma__&&window.editPropertiesCmdDoNotListenToCSOEvents||t.getSelect().then(e=>{if(e&&e.length>0){if(t.enable(),e[0].dibInfo){let i=n.giveEventsController({viewer:t.getFrameWindow().getViewer()});i&&i.fireEvent("onFireCrossWidgetSelection",{paths:[[e[0].dibInfo.id]]})}}else t.disable()})}),t._tokensXSO.onEmpty=i.onEmpty(function(){window&&window.__karma__&&window.editPropertiesCmdDoNotListenToCSOEvents||t.disable()}),t._tokensXSO.onPostRemove=i.onRemove(async function(){if(window&&window.__karma__&&window.editPropertiesCmdDoNotListenToCSOEvents)return;const e=await t.getSelect();e&&e.length>0?t.enable():t.disable()});const o=await t.getSelect();o&&o.length>0?t.enable():t.disable()},beginExecute:async function(){const e=require("DS/PADUtils/PADSettingsMgt");var t=await this.getSelect(),n=[],i=[];if(t.length){if(t[0].dibInfo)i.push({refID:t[0].dibInfo.id});else if(t[0].reqInfo)i.push({refID:t[0].reqInfo.id});else{for(var o=0;o<t.length;o++)n.push(t[o].pathElement);n.forEach(function(e){require(["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADContext"],function(t,n){for(;e&&!t.isPLMNode(e.getLastElement(!0));)e=e.getParentPath();if(!e&&n.get().isSelectiveLoadingActivated()){var o=n.get().getController().getOOCSelectedReferenceID();o&&i.push({refID:o,instID:null})}else{var a=e.getLastElement(!0),r=e.getParentPath().getLastElement(!0);i.push({refID:t.getNodeID(a),instID:t.getNodeID(r)})}})})}var a={getSelectedNodes:function(){var t=[];return i.forEach(function(n){var i={id:n.refID,tenant:e.getSetting("x3dPlatformId"),source:"3DSpace",getID:function(){return n.refID},getRelationID:function(){return n.instID}};t.push(i)}),t},getSecurityContext:function(){return{SecurityContext:e.getSetting("pad_security_ctx"),tenant:e.getSetting("x3dPlatformId")}}};this.launchProperties(a)}else this.endExecute()},_destroy:function(){this._tokensXSO.onPostAdd&&i.unsubscribe(this._tokensXSO.onPostAdd),this._tokensXSO.onPostRemove&&i.unsubscribe(this._tokensXSO.onPostRemove),this._tokensXSO.onEmpty&&i.unsubscribe(this._tokensXSO.onEmpty)},setObject:function(e){this._objectId=e}})}),define("DS/DMUCommands/DMURemoveOverloadCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUOptionsPanel","DS/DMUMeasurable/DMUToolsSceneGraph","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a){"use strict";return e.extend({init:function(e){var t=e||{};t.mode="shared",this._parent(t)},beginExecute:function(e){this._parent(e);var r=this,l=[],s=function(){var e=n.giveEventsController({viewer:r.getFrameWindow().getViewer()});e&&e.fireEvent("onDMUOccOverloadRemoved",l)},d=n.getReviewContext({viewer:this.getFrameWindow().getViewer()}),g=d?d.getCurrentSessionMarkup():null;if(g&&!g.isReadOnly()){var c,u,m,p=t.get(),C=[];for(u=0;u<p.length;u++)!(c=p[u].pathElement.getLastElement(!0)).getDMUType||"DMUSlide"!==c.getDMUType()&&"DMUFormat"!==c.getDMUType()||C.push(g.getDMUObjectFromPathElement(p[u].pathElement));var v=!1;if(C.length||(v=!0,C.push(g.getCurrentSlide())),C.length){var f=[],D=!1,h=!1;if(v)for(u=0;u<p.length;u++){var w,S=g.getOrCreateOccurrenceOverloader(p[u]);S&&(w=C[0].getOverloadForTarget(S))&&w.state&&(f.push({slide:C[0],slideOverload:w,overload:S}),(w.state.mPosition||w.state.mTransfoMatrix)&&(D=!0),(void 0!==w.state.bVisible&&null!==w.state.bVisible||void 0!==w.state.cColor&&null!==w.state.cColor||void 0!==w.state.fOpacity&&null!==w.state.fOpacity)&&(h=!0));var M=p[u].pathElement.clone();o.isInstance(M.getParentPath().getLastElement(!0))&&(S=g.getOrCreateOccurrenceOverloader({pathElement:M.getParentPath()}))&&(w=C[0].getOverloadForTarget(S))&&w.state&&(f.push({slide:C[0],slideOverload:w,overload:S}),(w.state.mPosition||w.state.mTransfoMatrix)&&(D=!0),(void 0!==w.state.bVisible&&null!==w.state.bVisible||void 0!==w.state.cColor&&null!==w.state.cColor||void 0!==w.state.fOpacity&&null!==w.state.fOpacity)&&(h=!0))}else for(u=0;u<C.length;u++){var x=C[u].getObjectOverloads();for(m=0;m<x.length;m++)x[m].state&&(f.push({slide:C[u],slideOverload:x[m],overload:x[m].target}),(x[m].state.mPosition||x[m].state.mTransfoMatrix)&&(D=!0),(void 0!==x[m].state.bVisible&&null!==x[m].state.bVisible||void 0!==x[m].state.cColor&&null!==x[m].state.cColor||void 0!==x[m].state.fOpacity&&null!==x[m].state.fOpacity)&&(h=!0))}var b=function(){f.forEach(function(e){e.slide.removeObjectOverload(e.slideOverload),l.push({target:e.overload})}),r.getFrameWindow().getViewer().render(),s()};if(h&&D)new i({frmWindow:r.getFrameWindow(),panelTitle:a.removeObjectOverloadPanelTitle,options:[{nls:a.graphicOverloads,id:"DMURemoveGraphicOverloads",value:"false"!==localStorage.getItem("DMURemoveGraphicOverloads")},{nls:a.positionOverloads,id:"DMURemovePositionOverloads",value:"false"!==localStorage.getItem("DMURemovePositionOverloads")}],cb:function(e){if(e){var t;if(e.DMURemoveGraphicOverloads&&e.DMURemovePositionOverloads)b();else e.DMURemoveGraphicOverloads?(f.forEach(function(e){e.slideOverload.state.mPosition||e.slideOverload.state.mTransfoMatrix?(t={},null!==e.overload.getAttribute("bVisible")&&(e.overload.setAttribute("bVisible",null),t.bVisible=null),null!==e.overload.getAttribute("cColor")&&(e.overload.setAttribute("cColor",null),t.cColor=null),null!==e.overload.getAttribute("fOpacity")&&(e.overload.setAttribute("fOpacity",null),t.fOpacity=null),l.push({target:e.overload,state:t})):(e.slide.removeObjectOverload(e.slideOverload),l.push({target:e.overload}))}),s(),localStorage.removeItem("DMURemoveGraphicOverloads")):localStorage.setItem("DMURemoveGraphicOverloads","false"),e.DMURemovePositionOverloads?(f.forEach(function(e){void 0!==e.slideOverload.state.bVisible&&null!==e.slideOverload.state.bVisible||void 0!==e.slideOverload.state.cColor&&null!==e.slideOverload.state.cColor||void 0!==e.slideOverload.state.fOpacity&&null!==e.slideOverload.state.fOpacity?(t={},null!==e.overload.getAttribute("mPosition")&&(e.overload.setAttribute("mPosition",null),t.mPosition=null),null!==e.overload.getAttribute("mTransfoMatrix")&&(e.overload.setAttribute("mTransfoMatrix",null),t.mTransfoMatrix=null),l.push({target:e.overload,state:t})):(e.slide.removeObjectOverload(e.slideOverload),l.push({target:e.overload}))}),s(),localStorage.removeItem("DMURemovePositionOverloads")):localStorage.setItem("DMURemovePositionOverloads","false");r.getFrameWindow().getViewer().render()}}});else b()}}this.cancel()}})});