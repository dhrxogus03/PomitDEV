define("DS/DMUPersistence/DMUMarkupContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];return e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&("DMUMarkup"===e.getType()?t.push(e.getType()):e.isReadOnly()||t.push(e.getType()))}),1===t.length&&"DMUMarkup"===t[0]?this.getContextualMenuCommandList(e):[]},getContextualMenuCommandList:function(){return this.getMarkupOwner()&&!this.getMarkupOwner().isReadOnly()||!this.getMarkupOwner()&&!this.isReadOnly()?[{line:1,name:"DMUReviewMarkupStr",hdr_list:["DMUReviewMarkupHdr"]},{line:1,name:"DMURenameMarkupStr",hdr_list:["DMURenameMarkupHdr"]},{line:1,name:"DMUEditPropertiesStr",hdr_list:["DMUEditPropertiesHdr"]},{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]:[{line:1,name:"DMUEditPropertiesStr",hdr_list:["DMUEditPropertiesHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:"DMUMarkup",module:"DMUPersistence",workbenchName:"DMUPersistenceCtxCmds"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:"DMUMarkup",module:"DMUPersistence",workbenchName:"DMUPersistenceCtxCmds"}})}})}),define("DS/DMUPersistence/DMURenameMarkupCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUBaseUIControllers/DMUReviewController","DS/Selection/CSOManager"],function(e,t,o,i,r,n){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var a=this;this.beginExecute=function(){var e=n.get(),s=t.getReviewContext({viewer:a.getFrameWindow().getViewer()});if(s){if(1===e.length&&e[0].pathElement.getLastElement(!0).getDMUType&&"DMUMarkup"===e[0].pathElement.getLastElement(!0).getDMUType()){let t,n=s.getValidation();if(n&&n.getMarkups().some(o=>{let i=o.getRepRef();if(i.getMarkupContent()&&i.getMarkupContent().getNode()===e[0].pathElement.getLastElement(!0))return t=i,!0}),t){var l=o.giveDMUSlidesController({context:a.getFrameWindow()});l&&l.editMarkupName(t);const e=r.giveDMUReviewController({context:a.getFrameWindow()});e&&e.editMarkupName(t);let n=i.giveDMUCommentsController({context:a.getFrameWindow()});n&&n.editMarkupName(t)}}a.end()}else a.end()}}})}),define("DS/DMUPersistence/DMUAuthPersistenceUtils",["UWA/Utils","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet"],function(e,t,o,i,r){"use strict";return{getTransientMarkersAndOverloads:async function(e,r,n){var a={overloads:[],markers:[]};if(!r||!n)return a;let s=i.giveEventsController({viewer:r.getViewer()});s&&s.fireEvent("onBeginDMUObjectDuplication");var l=o.getDMUSceneDisplayController({context:r});if((!e||e&&!e.getCurrentSessionMarkup()||e&&e.getCurrentSessionMarkup()&&!e.getCurrentSessionMarkup().isVisible())&&(a.overloads=l.getDisplayedAndHiddenOccurrences(n)),e){var d=e.getTransientReviewBag(),c=d.getDMUObjects("DMUCompare3D");if(c.length||(c=d.getDMUObjects("DMUCompare2D")),c.length>=1){let t=(c=c[0]).getParent().getAttribute("oLinksManager"),o=c.getAttribute("oSelections"),i=[],a=l.getCurrentCompareBalance();if(t&&o){for(let e=0;e<o.length;e++){let n=t.getChildWithID(o[e].id);if(n){let e=n.idPath&&n.idPath.length?n.idPath:t.getOccurrenceIdPath(n.path);if(e&&e.length){let t=r.getController().isFiltered(e[0]);i.push(t&&t.hasFilter&&t.filterId?t.filterId:e[0])}}}let s=e.getReviewCtxInformation()?e.getReviewCtxInformation().contextId:null;r.getApplicativeData()&&r.getApplicativeData().getLoadedItfData&&r.getApplicativeData().getLoadedItfData()&&r.getApplicativeData().getLoadedItfData().data&&r.getApplicativeData().getLoadedItfData().data.length&&(s=r.getApplicativeData().getLoadedItfData().data[0].prd[0]?r.getApplicativeData().getLoadedItfData().data[0].prd[0]:s),-1===i.indexOf(n)&&-1===i.indexOf(s)?d.removeDMUObjects("DMUCompare3D"):i[1]===n&&(c.setAttribute("oSelections",[o[1],o[0]]),a=100-a)}c.setAttribute("fBalance",a),c.setAttribute("bLocalAxis",l.getCurrentLocalAxisValue())}var p=d.getDMUObjects();if(p)for(var g=0;g<p.length;g++)if(p[g]){let e=await t.getObjectDefinition(p[g]);a.markers.push(e)}}return o.unreferenceDMUSceneDisplayController({context:r}),a},copyTransientMarkersAndOverloads:async function(t,n,a,s,l){if(!t||!n||!a)return;if(s.length){var d=r.getManager({name:"DMUUserExperienceManager",context:a.getFrameWindow()});d&&await d.duplicateDMUElements({elementDefinitions:s,parent:n,cb:function(o){if(o&&o.duplicatedElements)for(var i=0;i<o.duplicatedElements.length;i++)o.duplicatedElements[i].setAttributes([{name:"sID",value:t.computeNewID()},{name:"sUuid",value:e.getUUID()}])}})}var c=o.giveDMUSceneDisplayController({context:a});if(l&&c){var p,g,u=[],h=function(e,o){(p=t.getOrCreateOccurrenceOverloader(e,!0))&&(u.push({target:p,state:{bVisible:o}}),n.addObjectOverload({target:p,state:{bVisible:o}}))};l.hidden&&(l.hidden.paths.forEach(function(e){h({pathElement:e},!1)}),l.hidden.idPaths.forEach(function(e){(g=e.slice())[0]===a.getController().getRootBagId()&&g.splice(0,1),h({idPath:g},!1)})),l.shown&&(l.shown.paths.forEach(function(e){h({pathElement:e},!0)}),l.shown.idPaths.forEach(function(e){(g=e.slice())[0]===a.getController().getRootBagId()&&g.splice(0,1),h({idPath:g},!0)})),u.length&&n.fireEvent("onDMUOverloadPropertiesChanged",{overloads:u})}let M=i.giveEventsController({viewer:a.getViewer()});M&&M.fireEvent("onDMUObjectDuplicated")}}}),define("DS/DMUPersistence/DMUExportServices",["require","exports","UWA/Core","DS/Controls/ProgressBar","DS/Controls/Button","DS/DMUBaseExperience/EXPToolsVisualization","i18n!DS/DMUPersistence/assets/nls/DMUPersistence"],function(e,t,o,i,r,n,a){"use strict";const s={DMUMarker3DRectangle:"Square",DMUMarker3DCircle:"Circle",DMUMarker3DText:"FreeText",DMUMarker3DEllipse:"Circle",DMUMarker3DLine:"Line",DMUMarker3DSpline:"Ink",DMUMarker3DFreehand:"Ink",DMUMarker3DCloud:"Polygon",DMUMarker3DArrow:"Line",DMUCommentHighlight:"Highlight",DMUCommentPositioned:"Text",DMUMarker3DPicture:"FileAttachment"};let l;const d=function(e){const t=`<p>${window.require("DS/DMUBaseUIComponents/DMURichTextServices").formatRichTextToExportToPDF(e)}</p>`;let o=document.createElement("div");o.innerHTML=t;const i=o.innerText;return{richContent:`<?xml version="1.0"?><body xmlns="http://www.w3.org/1999/xhtml" xmlns:xfa="http://www.xfa.org/schema/xfa-data/1.0/" xfa:APIVersion="3DExperience:24.1" xfa:spec="2.4" xfa:contentType="text/html">${o.innerHTML}</body>`,flatContent:i}};let c=function(e,t,o){var i,r;let n;if(o){let a={x:0,y:0},s={x:0,y:0},d=Math.atan2(o.y-e.leaderPosition[1],o.x-e.leaderPosition[0]),c=8;a.x=e.leaderPosition[0]+c*Math.cos(d-Math.PI/6),a.y=e.leaderPosition[1]+c*Math.sin(d-Math.PI/6),s.x=e.leaderPosition[0]+c*Math.cos(d+Math.PI/6),s.y=e.leaderPosition[1]+c*Math.sin(d+Math.PI/6);let p=e.leaderEndType,g=e.hasLeader;if("OpenArrow"===p&&l&&g)n=[l.setGraphicsState("GS0"),l.setFillingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setStrokingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setLineWidth(t.border?t.border.thickness:1),l.setDashPattern(t.border&&t.border.pattern?t.border.pattern:[],0),l.moveTo(e.leaderPosition[0],e.leaderPosition[1]),l.lineTo(a.x,a.y),l.lineTo(s.x,s.y),l.lineTo(e.leaderPosition[0],e.leaderPosition[1]),l.closePath(),l.fill()].filter(Boolean);else if("Square"===p&&l&&g){let o=(null===(i=t.border)||void 0===i?void 0:i.thickness)?t.border.thickness+5:5;n=l.drawRectangle({x:e.leaderPosition[0]-o/2,y:e.leaderPosition[1]-o/2,width:o,height:o,borderWidth:0,borderColor:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,rotate:l.radians(0),xSkew:l.radians(0),ySkew:l.radians(0),color:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,graphicsState:"GS0"})}else if("Bubble"===p&&l&&g){let o=(null===(r=t.border)||void 0===r?void 0:r.thickness)?t.border.thickness:2.5;(n=l.drawEllipse({x:e.leaderPosition[0],y:e.leaderPosition[1],xScale:o,yScale:o,borderColor:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,borderWidth:0,color:e.borderColor?l.rgb(e.borderColor.r,e.borderColor.g,e.borderColor.b):void 0,graphicsState:"GS0"})).splice(n.length-2,0,l.closePath())}else"Cross"===p&&l&&g?(n=[l.setGraphicsState("GS0"),l.setFillingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setStrokingRgbColor(e.borderColor.r,e.borderColor.g,e.borderColor.b),l.setLineWidth(1),l.setDashPattern([],0),l.moveTo(e.leaderPosition[0]-5,e.leaderPosition[1]-5),l.lineTo(e.leaderPosition[0]+5,e.leaderPosition[1]+5),l.moveTo(e.leaderPosition[0]-5,e.leaderPosition[1]+5),l.lineTo(e.leaderPosition[0]+5,e.leaderPosition[1]-5),l.stroke()].filter(Boolean)).splice(n.length-2,0,l.closePath()):n=[]}else n=[];return n};class p{static prepareAnnotationDefinition(e,t,o){let i=n.getMMPerPtRatio();o.border&&(o.border={...o.border,thickness:o.border.thickness*i,pattern:o.border.pattern?o.border.pattern.map(e=>e*i):void 0});let r=0;const a=e.getRotation();a&&a.angle&&(r="degrees"===a.type?a.angle*Math.PI/180:a.angle);const s=e.getHeight()*Math.cos(r);switch("position"in t&&(t.position={x:(t.position.x*Math.cos(r)-t.position.y*Math.sin(r))*i,y:(t.position.x*Math.sin(r)+t.position.y*Math.cos(r))*i+s}),"rotationAngle"in t&&(t.rotationAngle=(t.rotationAngle||0)-r),t.type){case"DMUMarker3DRectangle":t.width=t.width*i,t.height=t.height*i;break;case"DMUMarker3DText":t.fontSize=t.fontSize*i,t.width=t.width*i,t.height=t.height*i,t.offwidth=t.offwidth*i,t.offheight=t.offheight*i,t.leaderPosition[0]=(t.leaderPosition[0]*Math.cos(r)-t.leaderPosition[1]*Math.sin(r))*i,t.leaderPosition[1]=(t.leaderPosition[0]*Math.sin(r)+t.leaderPosition[1]*Math.cos(r))*i+s,t.leaderPosition[2]=(t.leaderPosition[2]*Math.cos(r)-t.leaderPosition[3]*Math.sin(r))*i,t.leaderPosition[3]=(t.leaderPosition[2]*Math.sin(r)+t.leaderPosition[3]*Math.cos(r))*i+s,t.leaderPosition[4]=(t.leaderPosition[4]*Math.cos(r)-t.leaderPosition[5]*Math.sin(r))*i,t.leaderPosition[5]=(t.leaderPosition[4]*Math.sin(r)+t.leaderPosition[5]*Math.cos(r))*i+s,t.leaderPosition[6]=(t.leaderPosition[6]*Math.cos(r)-t.leaderPosition[7]*Math.sin(r))*i,t.leaderPosition[7]=(t.leaderPosition[6]*Math.sin(r)+t.leaderPosition[7]*Math.cos(r))*i+s;break;case"DMUMarker3DPicture":t.width=t.width*i,t.height=t.height*i,t.offwidth=t.offwidth*i,t.offheight=t.offheight*i,t.leaderPosition[0]=(t.leaderPosition[0]*Math.cos(r)-t.leaderPosition[1]*Math.sin(r))*i,t.leaderPosition[1]=(t.leaderPosition[0]*Math.sin(r)+t.leaderPosition[1]*Math.cos(r))*i+s,t.leaderPosition[2]=(t.leaderPosition[2]*Math.cos(r)-t.leaderPosition[3]*Math.sin(r))*i,t.leaderPosition[3]=(t.leaderPosition[2]*Math.sin(r)+t.leaderPosition[3]*Math.cos(r))*i+s,t.leaderPosition[4]=(t.leaderPosition[4]*Math.cos(r)-t.leaderPosition[5]*Math.sin(r))*i,t.leaderPosition[5]=(t.leaderPosition[4]*Math.sin(r)+t.leaderPosition[5]*Math.cos(r))*i+s,t.leaderPosition[6]=(t.leaderPosition[6]*Math.cos(r)-t.leaderPosition[7]*Math.sin(r))*i,t.leaderPosition[7]=(t.leaderPosition[6]*Math.sin(r)+t.leaderPosition[7]*Math.cos(r))*i+s;break;case"DMUMarker3DCircle":t.radius=t.radius*i;break;case"DMUMarker3DEllipse":t.xLength=t.xLength*i,t.yLength=t.yLength*i;break;case"DMUCommentHighlight":t.selection=t.selection.map(e=>({width:e.width*i,height:e.height*i,rotationAngle:(e.rotationAngle||0)-r,position:{x:(e.position.x*Math.cos(r)-e.position.y*Math.sin(r))*i,y:(e.position.x*Math.sin(r)+e.position.y*Math.cos(r))*i+s}}));break;case"DMUMarker3DArrow":t.pointing={x:(t.pointing.x*Math.cos(r)-t.pointing.y*Math.sin(r))*i,y:(t.pointing.x*Math.sin(r)+t.pointing.y*Math.cos(r))*i+s},t.ending={x:(t.ending.x*Math.cos(r)-t.ending.y*Math.sin(r))*i,y:(t.ending.x*Math.sin(r)+t.ending.y*Math.cos(r))*i+s},t.points=t.points.map(e=>({x:(e.x*Math.cos(r)-e.y*Math.sin(r))*i,y:(e.x*Math.sin(r)+e.y*Math.cos(r))*i+s}));break;case"DMUCommentPositioned":t.radius=t.radius*i,t.width=t.width*i,t.height=t.height*i;break;case"DMUMarker3DLine":t.points={start:{x:(t.points.start.x*Math.cos(r)-t.points.start.y*Math.sin(r))*i,y:(t.points.start.x*Math.sin(r)+t.points.start.y*Math.cos(r))*i+s},end:{x:(t.points.end.x*Math.cos(r)-t.points.end.y*Math.sin(r))*i,y:(t.points.end.x*Math.sin(r)+t.points.end.y*Math.cos(r))*i+s}};break;case"DMUMarker3DSpline":case"DMUMarker3DFreehand":case"DMUMarker3DCloud":t.rect.width=t.rect.width*i,t.rect.height=t.rect.height*i,t.points=t.points.map(e=>({x:(e.x*Math.cos(r)-e.y*Math.sin(r))*i,y:(e.x*Math.sin(r)+e.y*Math.cos(r))*i+s}))}}static getAnnotationAppearance(e,t,{rect:o,definition:i,material:r}){var a;if(!l)return;let s;if("DMUMarker3DRectangle"===i.type)s=[l.setGraphicsState("GS0"),r.fill&&l.setFillingColor(l.rgb(r.fill.color.r,r.fill.color.g,r.fill.color.b)),r.border&&l.setStrokingColor(l.rgb(r.border.color.r,r.border.color.g,r.border.color.b)),l.setLineWidth(r.border?r.border.thickness:0),l.setDashPattern(r.border&&r.border.pattern?r.border.pattern:[],0),l.translate(i.position.x,i.position.y),l.rotateRadians(i.rotationAngle||0),l.moveTo(-i.width/2,-i.height/2),l.lineTo(-i.width/2,i.height/2),l.lineTo(i.width/2,i.height/2),l.lineTo(i.width/2,-i.height/2),l.closePath(),r.fill&&r.border?l.fillAndStroke():r.fill?l.fill():l.stroke()].filter(Boolean);else if("DMUMarker3DPicture"===i.type){const e=t.getRotation();let o=0;e&&e.angle&&(o="degrees"===e.type?e.angle*Math.PI/180:e.angle);let n={x:0,y:0},a={x:0,y:0},d=.75*i.width,c=.625*i.width/2*.5,p=d/2*.5,g=Math.atan2(i.leaderPosition[3]-i.leaderPosition[1],i.leaderPosition[2]-i.leaderPosition[0]),u=8;n.x=i.leaderPosition[0]+u*Math.cos(g-Math.PI/6),n.y=i.leaderPosition[1]+u*Math.sin(g-Math.PI/6),a.x=i.leaderPosition[0]+u*Math.cos(g+Math.PI/6),a.y=i.leaderPosition[1]+u*Math.sin(g+Math.PI/6);let h=Number(i.linethickness);s=[l.setGraphicsState("GS0"),l.setFillingRgbColor(.21176470588235294,.5568627450980392,.7686274509803922),l.setStrokingRgbColor(i.borderColor.r,i.borderColor.g,i.borderColor.b),l.setLineWidth(h),l.setDashPattern(r.border&&r.border.pattern?r.border.pattern:[],0),l.rotateRadians(o),l.moveTo(i.leaderPosition[0],i.leaderPosition[1]),l.lineTo(n.x,n.y),l.moveTo(n.x,n.y),l.lineTo(a.x,a.y),l.moveTo(a.x,a.y),l.lineTo(i.leaderPosition[0],i.leaderPosition[1]),l.moveTo(i.leaderPosition[0],i.leaderPosition[1]),l.lineTo(i.leaderPosition[2],i.leaderPosition[3]),l.moveTo(i.leaderPosition[2],i.leaderPosition[3]),l.lineTo(i.leaderPosition[4],i.leaderPosition[5]),l.moveTo(i.leaderPosition[4],i.leaderPosition[5]),i.leaderPosition[0]<i.leaderPosition[6]?l.lineTo(i.leaderPosition[4]+p/4,i.leaderPosition[5]+c/2):l.lineTo(i.leaderPosition[4]-p/4,i.leaderPosition[5]+c/2),i.leaderPosition[0]<i.leaderPosition[6]?l.lineTo(i.leaderPosition[4]+p,i.leaderPosition[5]+c/2):l.lineTo(i.leaderPosition[4]-p,i.leaderPosition[5]+c/2),i.leaderPosition[0]<i.leaderPosition[6]?l.lineTo(i.leaderPosition[4]+p,i.leaderPosition[5]-c/2):l.lineTo(i.leaderPosition[4]-p,i.leaderPosition[5]-c/2),i.leaderPosition[0]<i.leaderPosition[6]?l.lineTo(i.leaderPosition[4]+p/4,i.leaderPosition[5]-c/2):l.lineTo(i.leaderPosition[4]-p/4,i.leaderPosition[5]-c/2),l.lineTo(i.leaderPosition[4],i.leaderPosition[5]),l.fillAndStroke(),l.setLineWidth(0),l.setStrokingRgbColor(0,0,0),i.leaderPosition[0]<i.leaderPosition[6]?l.moveTo(i.leaderPosition[4]+p/3,i.leaderPosition[5]+c/4):l.moveTo(i.leaderPosition[4]-p/3,i.leaderPosition[5]+c/4),i.leaderPosition[0]<i.leaderPosition[6]?l.lineTo(i.leaderPosition[4]+.75*p,i.leaderPosition[5]+c/4):l.lineTo(i.leaderPosition[4]-.75*p,i.leaderPosition[5]+c/4),i.leaderPosition[0]<i.leaderPosition[6]?l.moveTo(i.leaderPosition[4]+p/3,i.leaderPosition[5]):l.moveTo(i.leaderPosition[4]-p/3,i.leaderPosition[5]),i.leaderPosition[0]<i.leaderPosition[6]?l.lineTo(i.leaderPosition[4]+.75*p,i.leaderPosition[5]):l.lineTo(i.leaderPosition[4]-.75*p,i.leaderPosition[5]),i.leaderPosition[0]<i.leaderPosition[6]?l.moveTo(i.leaderPosition[4]+p/3,i.leaderPosition[5]-c/4):l.moveTo(i.leaderPosition[4]-p/3,i.leaderPosition[5]-c/4),i.leaderPosition[0]<i.leaderPosition[6]?l.lineTo(i.leaderPosition[4]+.75*p,i.leaderPosition[5]-c/4):l.lineTo(i.leaderPosition[4]-.75*p,i.leaderPosition[5]-c/4),l.stroke()].filter(Boolean)}else if("DMUMarker3DCircle"===i.type){let e=i.radius;(s=l.drawEllipse({x:i.position.x,y:i.position.y,xScale:e,yScale:e,borderDashArray:r.border&&r.border.pattern?r.border.pattern:void 0,borderColor:r.border?l.rgb(r.border.color.r,r.border.color.g,r.border.color.b):void 0,borderWidth:r.border?r.border.thickness:0,color:r.fill?l.rgb(r.fill.color.r,r.fill.color.g,r.fill.color.b):void 0,graphicsState:"GS0"})).splice(s.length-2,0,l.closePath())}else if("DMUMarker3DEllipse"===i.type)(s=l.drawEllipse({x:i.position.x,y:i.position.y,xScale:i.xLength/2,yScale:i.yLength/2,borderDashArray:r.border&&r.border.pattern?r.border.pattern:void 0,rotate:l.radians(i.rotationAngle||0),borderColor:r.border?l.rgb(r.border.color.r,r.border.color.g,r.border.color.b):void 0,borderWidth:r.border?r.border.thickness:0,color:r.fill?l.rgb(r.fill.color.r,r.fill.color.g,r.fill.color.b):void 0,graphicsState:"GS0"})).splice(s.length-2,0,l.closePath());else if("DMUMarker3DLine"===i.type)s=l.drawLine({start:{x:i.points.start.x,y:i.points.start.y},end:{x:i.points.end.x,y:i.points.end.y},dashArray:r.border&&r.border.pattern?r.border.pattern:void 0,color:r.border?l.rgb(r.border.color.r,r.border.color.g,r.border.color.b):void 0,thickness:r.border?r.border.thickness:0,graphicsState:"GS0"});else if("DMUMarker3DText"===i.type){let e=[];for(let t=0;t<i.textContent.length;t++)e.push(l.PDFString.of(i.textContent[t]));let t,o,n=i.offwidth,a=i.offheight,d=Math.max(i.lineThickness/2,i.fontSize/3);if("rotationAngle"in i&&i.rotationAngle){let e,r,s={x:n/2,y:a/2},l={x:n/2-d,y:-a/2+d+i.fontSize};e={x:s.x*Math.cos(i.rotationAngle)-s.y*Math.sin(i.rotationAngle),y:s.x*Math.sin(i.rotationAngle)+s.y*Math.cos(i.rotationAngle)},o={x:-(r={x:l.x*Math.cos(i.rotationAngle)-l.y*Math.sin(i.rotationAngle),y:l.x*Math.sin(i.rotationAngle)+l.y*Math.cos(i.rotationAngle)}).x+i.position.x,y:-r.y+i.position.y},t={x:-e.x+i.position.x,y:-e.y+i.position.y}}else o={x:i.leaderPosition[2]-n/2+d,y:i.leaderPosition[3]+a/2-d-i.fontSize},t={x:i.leaderPosition[2]-n/2,y:i.leaderPosition[3]-a/2};let p=l.drawLinesOfText(e,{x:o.x,y:o.y,font:l.StandardFonts.Helvetica,lineHeight:1.2*i.fontSize,size:.97*i.fontSize,rotate:l.radians(i.rotationAngle||0),xSkew:l.radians(0),ySkew:l.radians(0),color:l.rgb(i.fontColor.r,i.fontColor.g,i.fontColor.b),graphicsState:"GS0"}),g=l.drawRectangle({x:t.x,y:t.y,width:n,height:a,borderWidth:i.hasBorder?i.lineThickness:0,borderColor:r.border&&i.hasBorder?l.rgb(r.border.color.r,r.border.color.g,r.border.color.b):void 0,rotate:l.radians(i.rotationAngle||0),borderDashArray:r.border&&i.hasBorder&&r.border.pattern?r.border.pattern:[],borderDashPhase:r.border&&i.hasBorder?Number(i.lineType):void 0,xSkew:l.radians(0),ySkew:l.radians(0),color:r.fill?l.rgb(r.fill.color.r,r.fill.color.g,r.fill.color.b):void 0,graphicsState:"GS0"}),u={x:i.leaderPosition[4],y:i.leaderPosition[5]},h={x:i.leaderPosition[6],y:i.leaderPosition[7]},M=c(i,r,u),D=[];u&&h&&(D=[l.setGraphicsState("GS0"),l.setStrokingRgbColor(i.borderColor.r,i.borderColor.g,i.borderColor.b),l.setLineWidth(i.lineThickness),l.setDashPattern(r.border&&r.border.pattern?r.border.pattern:[],0),l.moveTo(i.leaderPosition[0],i.leaderPosition[1]),l.lineTo(u?u.x:i.leaderPosition[2],u?u.y:i.leaderPosition[3]),l.moveTo(u?u.x:i.leaderPosition[2],u?u.y:i.leaderPosition[3]),l.lineTo(h?h.x:i.leaderPosition[2],h?h.y:i.leaderPosition[3]),l.stroke()]),s=[...M,...D,...g,...p].filter(Boolean)}else if("DMUMarker3DSpline"===i.type){let e={x:0,y:0};s=[l.setGraphicsState("GS0"),r.border&&l.setStrokingColor(l.rgb(r.border.color.r,r.border.color.g,r.border.color.b)),l.setLineWidth(r.border?r.border.thickness:0),l.setDashPattern(r.border&&r.border.pattern?r.border.pattern:[],0),...i.points.map((t,o,i)=>{if(!l)return;if(0===o)return l.moveTo(t.x,t.y);let r=e.x,n=e.y,a=i[o+1],s=i[o-1];if(a){let t={x:a.x-s.x,y:a.y-s.y};e={x:t.x/6,y:t.y/6}}else{let o={x:t.x-s.x,y:t.y-s.y};e={x:o.x/3,y:o.y/3}}return l.appendBezierCurve(s.x+r,s.y+n,t.x-e.x,t.y-e.y,t.x,t.y)}),l.stroke()].filter(Boolean)}else if("DMUMarker3DArrow"===i.type)s=[l.setGraphicsState("GS0"),r.fill&&l.setFillingRgbColor(r.fill.color.r,r.fill.color.g,r.fill.color.b),r.border&&l.setStrokingRgbColor(r.border.color.r,r.border.color.g,r.border.color.b),l.setLineWidth(r.border?r.border.thickness:0),l.setDashPattern(r.border&&r.border.pattern?r.border.pattern:[],0),...i.points.map((e,t)=>{if(l)return 0===t?l.moveTo(e.x,e.y):l.lineTo(e.x,e.y)}),l.closePath(),r.fill&&r.border?l.fillAndStroke():r.fill?l.fill():l.stroke()].filter(Boolean);else if("DMUCommentPositioned"===i.type){const e=t.getRotation();let o=0;e&&e.angle&&(o="degrees"===e.type?e.angle*Math.PI/180:e.angle);let n=i.radius,a=.75*i.width,d=.625*i.width,c=.5519150244935106*n,p=d/2,g=a/2;s=[l.setGraphicsState("GS0"),r.fill&&l.setFillingRgbColor(r.fill.color.r,r.fill.color.g,r.fill.color.b),r.border&&l.setStrokingRgbColor(r.border.color.r,r.border.color.g,r.border.color.b),l.setLineWidth(r.border?r.border.thickness:0),l.translate(i.position.x,i.position.y),l.rotateRadians(o),l.moveTo(-g,-p+n),l.lineTo(-g,p-n),l.appendBezierCurve(-g,p-n+c,-g+n-c,p,-g+n,p),l.lineTo(g-n,p),l.appendBezierCurve(g-n+c,p,g,p-n+c,g,p-n),l.lineTo(g,-p+n),l.appendBezierCurve(g,-p+n-c,g-n+c,-p,g-n,-p),l.lineTo(.45*a-g,-p),l.lineTo(.1*a-g,-p-.3*d),l.lineTo(-g+n,-p),l.appendBezierCurve(-g+n-c,-p,-g,-p+n-c,-g,-p+n),l.closePath(),r.border?l.fillAndStroke():l.fill(),r.border&&l.moveTo(.2*a-g,.7*d-p),r.border&&l.lineTo(.8*a-g,.7*d-p),r.border&&l.stroke(),r.border&&l.moveTo(.2*a-g,.4*d-p),r.border&&l.lineTo(.65*a-g,.4*d-p),r.border&&l.stroke()].filter(Boolean)}else if("DMUMarker3DFreehand"===i.type&&0===i.rect.width&&0===i.rect.height){let e=n.getMMPerPtRatio(),t=.5;r.border&&r.border.thickness/e==9&&(t=.5);let a=o[2]-o[0];(s=l.drawEllipse({x:i.position.x,y:i.position.y,xScale:a*t,yScale:a*t,borderDashArray:void 0,borderColor:void 0,borderWidth:0,color:r.border?l.rgb(r.border.color.r,r.border.color.g,r.border.color.b):void 0,graphicsState:"GS0"})).splice(s.length-2,0,l.closePath())}if(s&&s.length){let t=e.context.formXObject(s,{BBox:o,Matrix:[1,0,0,1,-o[0],-o[1]],Resources:e.context.obj({ExtGState:e.context.obj({GS0:e.context.obj({Type:"ExtGState",ca:r.fill?r.fill.opacity:"DMUMarker3DFreehand"===i.type&&0===i.rect.width&&0===i.rect.height?null===(a=r.border)||void 0===a?void 0:a.opacity:1,CA:r.border?r.border.opacity:1})})})}),n=e.context.register(t);return e.context.obj({N:n})}}static getAnnotationRect(e,t){let o={x:0,y:0},i={x:0,y:0};if("rotationAngle"in e&&e.rotationAngle){let t="DMUMarker3DRectangle"===e.type?e.width:"DMUMarker3DEllipse"===e.type?e.xLength:"DMUMarker3DText"===e.type?e.offwidth:e.rect.width,r="DMUMarker3DRectangle"===e.type?e.height:"DMUMarker3DEllipse"===e.type?e.yLength:"DMUMarker3DText"===e.type?e.offheight:e.rect.height,n={x:t/2,y:r/2},a={x:-t/2,y:r/2},s={x:n.x*Math.cos(e.rotationAngle)-n.y*Math.sin(e.rotationAngle),y:n.x*Math.sin(e.rotationAngle)+n.y*Math.cos(e.rotationAngle)},l={x:a.x*Math.cos(e.rotationAngle)-a.y*Math.sin(e.rotationAngle),y:a.x*Math.sin(e.rotationAngle)+a.y*Math.cos(e.rotationAngle)},d={x:-s.x,y:-s.y},c={x:s.x,y:s.y},p={x:l.x,y:l.y},g={x:-l.x,y:-l.y};if(o.x=Math.min(d.x,g.x,c.x,p.x)+e.position.x,o.y=Math.min(d.y,g.y,c.y,p.y)+e.position.y,i.x=Math.max(d.x,g.x,c.x,p.x)+e.position.x,i.y=Math.max(d.y,g.y,c.y,p.y)+e.position.y,"DMUMarker3DText"===e.type&&e.hasLeader){let t={x:e.leaderPosition[0],y:e.leaderPosition[1]};o.x=Math.min(o.x,t.x)-5,o.y=Math.min(o.y,t.y)-5,i.x=Math.max(i.x,t.x)+5,i.y=Math.max(i.y,t.y)+5}}else if("DMUMarker3DRectangle"===e.type||"DMUCommentPositioned"===e.type||"DMUMarker3DCircle"===e.type||"DMUMarker3DEllipse"===e.type||"DMUMarker3DSpline"===e.type||"DMUMarker3DFreehand"===e.type||"DMUMarker3DCloud"===e.type){let t="DMUMarker3DRectangle"===e.type||"DMUCommentPositioned"===e.type?e.width:"DMUMarker3DCircle"===e.type?2*e.radius:"DMUMarker3DEllipse"===e.type?e.xLength:e.rect.width,r="DMUMarker3DRectangle"===e.type||"DMUCommentPositioned"===e.type?e.height:"DMUMarker3DCircle"===e.type?2*e.radius:"DMUMarker3DEllipse"===e.type?e.yLength:e.rect.height;o.x=e.position.x-t/2,o.y=e.position.y-r/2,i.x=e.position.x+t/2,i.y=e.position.y+r/2}else if("DMUMarker3DLine"===e.type)o.x=Math.min(e.points.start.x,e.points.end.x),o.y=Math.min(e.points.start.y,e.points.end.y),i.x=Math.max(e.points.start.x,e.points.end.x),i.y=Math.max(e.points.start.y,e.points.end.y);else if("DMUMarker3DArrow"===e.type)o.x=1/0,o.y=1/0,i.x=-1/0,i.y=-1/0,e.points.forEach(e=>{o.x=Math.min(o.x,e.x),o.y=Math.min(o.y,e.y),i.x=Math.max(i.x,e.x),i.y=Math.max(i.y,e.y)});else if("DMUCommentHighlight"===e.type)o.x=1/0,o.y=1/0,i.x=-1/0,i.y=-1/0,e.selection.forEach(e=>{o.x=Math.min(o.x,e.position.x),o.y=Math.min(o.y,e.position.y-e.height),i.x=Math.max(i.x,e.position.x+e.width),i.y=Math.max(i.y,e.position.y)});else if("DMUMarker3DText"===e.type)e.hasLeader?(o.x=Math.min(e.leaderPosition[0],e.leaderPosition[2]-e.offwidth/2,e.leaderPosition[2]+e.offwidth/2)-5,o.y=Math.min(e.leaderPosition[3]-e.offheight/2,e.leaderPosition[1],e.leaderPosition[3]+e.offheight/2)-5,i.x=Math.max(e.leaderPosition[2]+e.offwidth/2,e.leaderPosition[0],e.leaderPosition[2]-e.offwidth/2)+5,i.y=Math.max(e.leaderPosition[3]+e.offheight/2,e.leaderPosition[1],e.leaderPosition[3]-e.offheight/2)+5):(o.x=e.leaderPosition[2]-e.offwidth/2,o.y=e.leaderPosition[3]-e.offheight/2,i.x=e.leaderPosition[2]+e.offwidth/2,i.y=e.leaderPosition[3]+e.offheight/2);else if("DMUMarker3DPicture"===e.type){let t={x:0,y:0},r={x:0,y:0},n=8,a=Math.atan2(e.leaderPosition[3]-e.leaderPosition[1],e.leaderPosition[2]-e.leaderPosition[0]);t.x=e.leaderPosition[0]+n*Math.cos(a-Math.PI/6),t.y=e.leaderPosition[1]+n*Math.sin(a-Math.PI/6),r.x=e.leaderPosition[0]+n*Math.cos(a+Math.PI/6),r.y=e.leaderPosition[1]+n*Math.sin(a+Math.PI/6),Math.round(e.leaderPosition[1])<=Math.round(e.leaderPosition[7])&&Math.round(e.leaderPosition[0])<=Math.round(e.leaderPosition[6])?(Math.round(e.leaderPosition[0])===Math.round(e.leaderPosition[6])?i.x=Math.min(e.leaderPosition[4]+.75*e.width/4,e.leaderPosition[2]):i.x=e.leaderPosition[4]+.75*e.width/4,i.y=e.leaderPosition[5]+.625*e.width/8,Math.round(e.leaderPosition[1])===Math.round(e.leaderPosition[7])?o.y=e.leaderPosition[5]-.625*e.width/8:o.y=Math.min(e.leaderPosition[1],t.y,r.y,e.leaderPosition[5]-.625*e.width/8),o.x=Math.min(e.leaderPosition[0],t.x,r.x,e.leaderPosition[2])):Math.round(e.leaderPosition[1])>=Math.round(e.leaderPosition[7])&&Math.round(e.leaderPosition[0])<=Math.round(e.leaderPosition[6])?(o.x=Math.min(e.leaderPosition[0],t.x,r.x,e.leaderPosition[2]),o.y=e.leaderPosition[5]-.625*e.width/8,Math.round(e.leaderPosition[0])===Math.round(e.leaderPosition[6])?i.x=Math.max(e.leaderPosition[2],t.x,r.x):i.x=Math.max(e.leaderPosition[4]+.75*e.width/4,t.x,r.x),i.y=Math.max(e.leaderPosition[1],t.y,r.y,e.leaderPosition[5]+.625*e.width/8)):Math.round(e.leaderPosition[1])<=Math.round(e.leaderPosition[7])&&Math.round(e.leaderPosition[0])>Math.round(e.leaderPosition[6])?(o.x=Math.min(e.leaderPosition[4]-.75*e.width/4,e.leaderPosition[2]),Math.round(e.leaderPosition[1])===Math.round(e.leaderPosition[7])?o.y=e.leaderPosition[5]-.625*e.width/8:o.y=Math.min(e.leaderPosition[1],t.y,r.y,e.leaderPosition[5]-.625*e.width/8),i.x=Math.max(e.leaderPosition[0],t.x,r.x,e.leaderPosition[2]),i.y=e.leaderPosition[5]+.625*e.width/8):Math.round(e.leaderPosition[1])>=Math.round(e.leaderPosition[7])&&Math.round(e.leaderPosition[0])>Math.round(e.leaderPosition[6])?(o.x=e.leaderPosition[4]-.75*e.width/4,o.y=e.leaderPosition[5]-.625*e.width/8,i.x=Math.max(e.leaderPosition[0],t.x,r.x,e.leaderPosition[2]),i.y=Math.max(e.leaderPosition[5]+.625*e.width/8,t.y,r.y,e.leaderPosition[1])):(o.x=e.leaderPosition[4]-.75*e.width/4,o.y=e.leaderPosition[5]-.625*e.width/8,i.x=e.leaderPosition[0],i.y=e.leaderPosition[1])}return[o.x-t/2,o.y-t/2,i.x+t/2,i.y+t/2]}static createAnnotation(e,{definition:t,subject:o,material:i,comments:r,pageNumber:a}){if(l&&t.type in s){let c=e.getPage(a-1);if(c){let a=p.getAnnotationRect(t,i.border?i.border.thickness:1),g=e.context.obj({Type:"Annot",Subtype:s[t.type],NM:l.PDFString.of(t.id),Rect:a,F:t.visible?4:2,P:c.ref,IC:i.fill?[i.fill.color.r,i.fill.color.g,i.fill.color.b]:void 0,C:i.border?[i.border.color.r,i.border.color.g,i.border.color.b]:void 0,CA:i.border?i.border.opacity:1,AP:p.getAnnotationAppearance(e,c,{rect:a,definition:t,material:i}),BS:e.context.obj({Type:"Border",W:"DMUCommentPositioned"!==t.type&&i.border?i.border.thickness:0,S:i.border&&i.border.pattern?"D":"S",D:i.border&&i.border.pattern?i.border.pattern:void 0}),Subj:o}),u=e.context.register(g);if(c.node.addAnnot(u),"DMUCommentPositioned"===t.type)i.fill&&(g.set(l.PDFName.of("C"),e.context.obj([i.fill.color.r,i.fill.color.g,i.fill.color.b])),g.set(l.PDFName.of("CA"),l.PDFNumber.of(i.fill.opacity))),g.set(l.PDFName.of("Name"),l.PDFName.of("Comment"));else if("DMUCommentHighlight"===t.type){i.fill&&(g.set(l.PDFName.of("C"),e.context.obj([i.fill.color.r,i.fill.color.g,i.fill.color.b])),g.set(l.PDFName.of("CA"),l.PDFNumber.of(i.fill.opacity)));let o=t.selection.map(e=>{let t=e.position.x,o=e.position.x+(e.width*Math.cos(e.rotationAngle||0)-e.height*Math.sin(e.rotationAngle||0)),i=e.position.y,r=e.position.y-(e.width*Math.sin(e.rotationAngle||0)+e.height*Math.cos(e.rotationAngle||0));return[t,i,o,i,t,r,o,r]});g.set(l.PDFName.of("QuadPoints"),e.context.obj(o.flat()))}else if("DMUMarker3DLine"===t.type)g.set(l.PDFName.of("L"),e.context.obj([t.points.start.x,t.points.start.y,t.points.end.x,t.points.end.y]));else if("DMUMarker3DSpline"===t.type)g.set(l.PDFName.of("InkList"),e.context.obj([t.points.map(e=>[e.x,e.y]).flat()]));else if("DMUMarker3DFreehand"===t.type)g.set(l.PDFName.of("InkList"),e.context.obj([t.points.map(e=>[e.x,e.y]).flat()]));else if("DMUMarker3DCloud"===t.type)g.set(l.PDFName.of("BE"),e.context.obj({I:l.PDFNumber.of(2),S:l.PDFName.of("C")})),g.set(l.PDFName.of("IT"),l.PDFName.of("PolygonCloud")),g.set(l.PDFName.of("Vertices"),e.context.obj(t.points.map(e=>[e.x,e.y]).flat()));else if("DMUMarker3DArrow"===t.type)g.set(l.PDFName.of("IT"),l.PDFName.of("LineArrow")),g.set(l.PDFName.of("L"),e.context.obj([t.pointing.x,t.pointing.y,t.ending.x,t.ending.y]));else if("DMUMarker3DPicture"===t.type){let o=t.imagedata;e.attach(o,"Test.PNG",{mimeType:"image/png"});let i=e.embeddedFiles.at(-1).ref;g.set(l.PDFName.of("FS"),i)}if(r&&r.length){let t;if(r.length>1){let o="";r.forEach(e=>{o+=`<p>${e.owner}&nbsp;&nbsp;${e.lastModificationDate.toLocaleString()}</p><p>${e.content}</p>`,e.replies&&e.replies.forEach(e=>{o+=`<p>&nbsp;&nbsp;&nbsp;${e.owner}&nbsp;&nbsp;${e.lastModificationDate.toLocaleString()}</p><p>&nbsp;&nbsp;&nbsp;${e.content}</p>`}),o+="<p>\n</p>"});const{richContent:i,flatContent:n}=d(o),s=l.PDFHexString.fromText(n),c=l.PDFHexString.fromText(i);t=e.context.obj({Type:"Annot",Subtype:"Popup",Contents:s,RC:c,Parent:u,Rect:a}),g.set(l.PDFName.of("Contents"),s),g.set(l.PDFName.of("RC"),c)}else{const{richContent:o,flatContent:s}=d(r[0].content),h=l.PDFHexString.fromText(s),M=l.PDFHexString.fromText(o),D=l.PDFHexString.fromText(r[0].owner);if(t=e.context.obj({Type:"Annot",Subtype:"Popup",Contents:h,CreationDate:l.PDFString.fromDate(r[0].creationDate),T:D,M:l.PDFString.fromDate(r[0].lastModificationDate),Parent:u,Rect:a,RC:M}),g.set(l.PDFName.of("Contents"),h),g.set(l.PDFName.of("RC"),M),g.set(l.PDFName.of("T"),D),g.set(l.PDFName.of("CreationDate"),l.PDFString.fromDate(r[0].creationDate)),g.set(l.PDFName.of("M"),l.PDFString.fromDate(r[0].lastModificationDate)),r[0].replies){let t=0;r[0].replies.forEach(o=>{if(!l)return;let r=n.getMMPerPtRatio();const s=5*r;t-=4*r;let g=[a[2]-s,a[1]+t,a[2],a[1]+t+s];const{richContent:h,flatContent:M}=d(o.content),D=l.PDFHexString.fromText(M),f=l.PDFHexString.fromText(h),m=l.PDFHexString.fromText(o.owner);let b=e.context.obj({Type:"Annot",Subtype:"Text",NM:l.PDFString.of(o.id),Name:"Comment",Contents:D,RC:f,T:m,CreationDate:l.PDFString.fromDate(o.creationDate),M:l.PDFString.fromDate(o.creationDate),Rect:g,F:4,P:c.ref,C:i.border?[i.border.color.r,i.border.color.g,i.border.color.b]:i.fill?[i.fill.color.r,i.fill.color.g,i.fill.color.b]:void 0,BS:e.context.obj({Type:"Border",W:0,S:"S"}),AP:p.getAnnotationAppearance(e,c,{rect:g,definition:{id:"",visible:!0,type:"DMUCommentPositioned",position:{x:g[0]+s/2,y:g[1]+s/2},width:s-1,height:s-1,radius:.5},material:{border:void 0,fill:{color:i.fill?i.fill.color:i.border?i.border.color:{r:0,g:0,b:0},opacity:1}}}),IRT:u}),P=e.context.register(b);c.node.addAnnot(P);let x=e.context.obj({Type:"Annot",Subtype:"Popup",Parent:P,Rect:a}),y=e.context.register(x);c.node.addAnnot(y),b.set(l.PDFName.of("Popup"),y)})}}let o=e.context.register(t);c.node.addAnnot(o),g.set(l.PDFName.of("Popup"),o)}}}}}class g{static displayLoadingDiv(e,t){let n,s,l;t&&(l=window&&window.widget?window.widget.getView().type:null)&&"maximized"!==l&&window.widget.requestView({type:"maximized"}),n=o.createElement("div",{class:"DMUExportMainDiv",styles:{zIndex:1e5,width:"100%",height:"100%",backgroundColor:"#F9F9F9",position:"absolute",top:0,left:0,padding:"0px 25%",display:"flex",flexDirection:"column",justifyContent:"center",background:"linear-gradient(0deg, #E2E4E3 0%, #F9F9F9 100%);"}}),s=o.createElement("span",{class:"DMUExportLabel",styles:{margin:"10px 0px"}}).inject(n);let d=o.createElement("div",{styles:{display:"flex",gap:"10px",alignItems:"center"}}).inject(n),c=new i;c.inject(d);let p=new r({label:a.exportCancelButtonLabel,emphasize:"secondary"}).inject(d);const g=()=>{p&&(p.disabled=!0),c.emphasize="high-attention",c.infiniteFlag=!0,s&&(s.innerText=a.exportAbortingLabel),e()};p.getContent().addEventListener("buttonclick",g);let u=o.createElement("div",{styles:{position:"absolute",top:30,right:30}}).inject(n),h=new r({displayStyle:"lite",label:a.exportCancelButtonLabel,icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"3x"},showLabelFlag:!1}).inject(u);return h.getContent().addEventListener("buttonclick",g),{loadingDivView:n,updateLoadingValue:e=>{c&&"number"==typeof e.value&&(c.value=e.value),s&&"string"==typeof e.label&&(s.innerText=e.label)},destroyLoadingDiv:()=>{t&&l&&"maximized"!==l&&window.widget.requestView({type:l}),p&&p.destroy(),h&&h.destroy(),c&&c.destroy(),n&&n.destroy()}}}static abortExport(){g.isAborted=!0}static exportAnnotationsAsPdf({baseDocumentBuffer:e,annotations:t,fileName:o,metadata:i,onProgressChange:r}){return g.isAborted=!1,e?new Promise((n,a)=>{if(g.isAborted)return n();r&&r(0),window.require(["DS/PDFLib/PDFLib"],s=>{if(g.isAborted)return n();!async function(){try{if(g.isAborted)return n();l=s;const d=await l.PDFDocument.load(e,{ignoreEncryption:!0});if(d.setTitle(i.title),d.setAuthor(i.author),d.setSubject(i.subject),d.setCreator(i.creator),d.setCreationDate(new Date),d.setModificationDate(new Date),d.setProducer("3DEXPERIENCE - Dassault Systèmes®"),g.isAborted)return n();if(r&&r(10),t.forEach((e,o)=>{r&&r(10+o/t.length*80);const i=d.getPage(e.pageNumber-1);i&&p.prepareAnnotationDefinition(i,e.definition,e.material),p.createAnnotation(d,e)}),g.isAborted)return n();r&&r(90);const c=await d.save();if(g.isAborted)return n();r&&r(100);let u=new Blob([c],{type:"application/pdf;base64"});if(g.isAborted)return n();let h=window.URL.createObjectURL(u);const M=document.createElement("a");M.href=h,M.download=o+".pdf",M.click(),window.URL.revokeObjectURL(h),l=null,g.isAborted=!1,n()}catch(e){window.console.log(e),a(new Error("Error during exporting document"))}}()},e=>{window.console.log(e),a(new Error("LIBs not found"))})}):Promise.reject(new Error("No document to export"))}}return g.isAborted=!1,g}),define("DS/DMUPersistence/DMUSaveServices",["require","exports","DS/DMUReadPersistence/DMUReviewPersistenceServices","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/DMUModelServices"],function(e,t,o,i,r,n){"use strict";let a,s;return class{static isCreatingAMarkup(e){a=e}static isProcessing(){return a||s}static saveCurrent3DMarkup(e){return new Promise((t,a)=>{e&&e.frmWindow&&r.isPersistenceAllowed({onPersistenceAllowed:async function(){var r;s=!0;let l=0,d=null,c=i.getReviewContext({viewer:e.frmWindow.getViewer()}),p=c?c.getCurrentSessionMarkup():null;if(p)if(p.isDirty()){let t;if(l=1,e.superType&&("SIMItfSimulation"===e.superType||"Document"===e.superType)||"Specification Report"===e.superType){t={Version:"1.0",Contexts:[],Model:[]};let o=await n.getObjectDefinition(p);t.Model.push(o),null===(r=t.Contexts)||void 0===r||r.push({superType:e.superType,documentType:e.documentType,listData:e.listData,loadingInfos:e.loadingInfos,documentVersionInfos:e.documentVersionInfos})}else{t={Version:"1.0",Model:[]},p.getApplicativeContext()&&Object.keys(p.getApplicativeContext()).length>0&&(t.ApplicativeContext=p.getApplicativeContext());let e=await n.getObjectDefinition(p);t.Model.push(e)}d=JSON.stringify(t)}else l=2;if(1===l&&d){let i=new o,r=null==c?void 0:c.getReviewCtxInformation();if(r){let o,n={json:d,reviewPhysicalId:r.reviewId,markupName:r.reviewName,markupType:r.reviewType,newFile:"boolean"==typeof e.newFile?e.newFile:void 0};(o="Markup"===r.reviewType?i.updateReviewAndJSONFile:i.updateMarkupStream)(n,function(e){r&&(null==c||c.setReviewCtxInformation({contextId:r.contextId,subContext:r.subContext,subContextId:r.subContextId,reviewId:e.reviewId,reviewName:e.reviewName,reviewDescription:r.reviewDescription,reviewType:e.reviewType,modifiable:r.modifiable,owner:r.owner,tempObjectInfo:r.tempObjectInfo})),null==p||p.setDirtyFlag(!1),s=!1,t()},function(){s=!1,a(new Error("Error at save current markup"))})}else s=!1,t()}else s=!1,t()},onPersistenceNotAllowed:function(){a(new Error("Error at save current markup: Persistence is not allowed"))}})})}}}),define("DS/DMUPersistence/DMUMarkupMaturityChangeCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/DMUBaseExperience/DMUContextManager"],function(e,t,o,i,r){"use strict";return class extends o{beginExecute(){const e=this.getFrameWindow().getViewer();let t=this,o=r.getReviewContext({viewer:e});const n=o&&o.getReviewCtxInformation();let a=o&&o.getCurrentSessionMarkup();if(!a||!n)return void(this.end?this.end():this.done());let s=r.getEventsController({viewer:e});window.require(["DS/MaturityWidget/MaturityWidget"].concat([]),function(e){let o;o&&o.dialog&&o.dialog.destroy(),(o=new e({externalSettings:i.getOption("platform_services")})).addEvent("onMaturityCanceled",function(){t.cancel()}),o.addEvent("onMaturityTransitionEnd",function(e){if(e&&e.data&&e.data.length>0&&a){for(let t=0;t<e.data.length;t++)if(e.data[t]&&e.data[t].physicalid===n.reviewId&&e.data[t].tostate){a.setMaturityState(e.data[t].tostate),s&&s.fireEvent("onMarkupObjectAttributesModified",{object:a,attr:[{currentState:e.data[t].tostate}]});break}t.end()}else t.end()}),i.getServerContext({onComplete:function(e){o.executeCmd([{physicalid:n.reviewId,tenant:i.getTenant()}],{context:{getSecurityContext:()=>({SecurityContext:e})}},()=>{})},onFailure:function(){}})}),this.done()}}}),define("DS/DMUPersistence/DMUDOSThumbnailServices",["DS/WAFData/WAFData","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting"],function(e,t){"use strict";return class{static saveObjectThumbnail(o,i,r){return new Promise(n=>{const a=r+"_thb";(function(o,i){return new Promise((r,n)=>{t.sendWebServiceCall({url:"resources/markup/service/getDosUploadTicket",config:{verb:"POST",data:JSON.stringify({sBucketName:o,sTenant:t.getTenant(),sFileId:i})},onSuccess:function(t){e.authenticatedRequest(JSON.parse(t).result,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(e){r(JSON.parse(e))},onFailure:function(e){n(e)}})}})})})(o,a).then(e=>{const o=e.ticket,r=e.url;if(o&&r){const e=new Image;e.src=i,e.onload=function(){const i=document.createElement("canvas"),s=i.getContext("2d");i.width=144,i.height=108,s.drawImage(e,0,0),i.toBlob(function(e){var i;(i={file:e,ticket:o,URL:r,fileName:a},new Promise(function(e){var t=new FormData;t.append("__fcs__jobTicket",i.ticket),t.append("imageFile",i.file,i.fileName);var o=new XMLHttpRequest;o.open("POST",i.URL,!0),o.onload=function(){200===o.status&&e(o.responseText)},o.send(t)})).then(function(e){e&&function(e){return new Promise(o=>{t.sendWebServiceCall({url:"resources/markup/service/getDosCommit",config:{verb:"POST",data:JSON.stringify({sTenant:t.getTenant(),sReceipt:e})},onSuccess:function(e){o(e)}})})}(e.replace(/\n/g,"")).then(()=>{n()})})})}}}).catch(e=>{window.console.log(e)})})}static deleteMarkupThumbnail(e,o){!function(e,o){new Promise(i=>{t.sendWebServiceCall({url:"resources/markup/service/deleteFile",config:{verb:"POST",data:JSON.stringify({sBucketName:e,sFileId:o,sTenant:t.getTenant()})},onSuccess:function(e){i(e)}})})}(e,o+"_thb")}}}),define("DS/DMUPersistence/DMUPersistence",[],function(){}),define("DS/DMUPersistence/DMUExportReviewAsPdfCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUPersistence/DMUExportServices","DS/DMUPlayComment/DMUComment","DS/DMUPlayMarker/DMUMarker","DS/DMUPlayMarker/DMUCommentAnnotationBase","DS/DMUBaseUI/DMUToolsUsers","i18n!DS/DMUPersistence/assets/nls/DMUPersistence","DS/CATWebUXPreferences/CATWebUXPreferencesUtils"],function(e,t,o,i,r,n,a,s,l,d,c){"use strict";const p={ENOR3D_AP:"ENOVIA - 3D Markup",ENOR3R_AP:"ENOVIA - Design Review",ENOR3V_AP:"ENOVIA - Design Validation"};return class extends o{constructor(e){e.mode="shared",super(e);let t=(e.frameWindow||this.getFrameWindow()).getViewer();this.beginExecute=(async()=>{var e,o;super.beginExecute();let g=i.getContextViewer({viewer:t}),u=i.getReviewContext({context:g});if(!u)return this.done();let h,M=[],D=u.getValidation();if(D)null===(e=D.getMarkups())||void 0===e||e.forEach(e=>{var t;let o=e.getRepRef(),i=null==o?void 0:o.getMarkupContent();i&&M.push({content:i,name:e.getName()}),null===(t=e.getReplies())||void 0===t||t.forEach(t=>{let i=null==(o=t.getRepRef())?void 0:o.getMarkupContent();i&&M.push({content:i,name:e.getName()})})}),h=D.getName()||"";else{const e=u.getCurrentSessionMarkup();M.push({content:e,name:e.getAttribute("sName")||""}),h=e.getAttribute("sName")||""}let f=!1;const{loadingDivView:m,updateLoadingValue:b,destroyLoadingDiv:P}=r.displayLoadingDiv(()=>{f=!0,r.abortExport()});let x;try{x="true"===(await c.readPreferences([{Repository:"DMURepository",PreferenceNames:["ExportPersonalData"]}])).repositories[0].preferences[0].value}catch(e){x=!1,window.console.warn("Could not get server value, default value set instead.",e)}const y=u.getReviewCtxInformation()||{owner:"",tempObjectInfo:{title:""},reviewDescription:""};let C=x?await l.getUserName(y.owner):y.owner;const v=`${null===(o=y.tempObjectInfo)||void 0===o?void 0:o.title}-${h}-${(new Date).toLocaleDateString().replace(/\//g,"-")}`;try{m.inject(g.elements.main),b({value:0,label:d.initializingExport});const e=window.require("DS/WebDocumentVisualization/WebDocumentVisualizationController"),[t,o]=await new Promise(e=>window.require(["DS/DMUComment/DMUCommentExport","DS/DMUMarker/DMUMarkerExport"],(t,o)=>e([t,o])));if(f)return;let i=e.giveWebDocumentVisualizationController({context:g}).getDocumentBuffer(),l=[];for(let e=0;e<M.length;e++){const{content:o}=M[e];let i=o.getComments();if(i)for(const e of i)if(e instanceof n){if(f)return;l.push(await t.getCommentExportDefinition(e,x))}}const c=[];for(let e=0;e<M.length;e++){const{content:i,name:r}=M[e];let n=i.getSlides();if(n.length){let i=n[0].getDMUObjects();for(let n=0;n<i.length;n++){if(f)return;b({label:`${d.exportPreparingMarkersMessage}: ${n+1} / ${i.length}`,value:10+n/i.length/((e+1)/M.length)*60});const p=i[n];let g;try{p instanceof a?g=await o.getExportDefinition(p,x):p instanceof s&&(g=await t.getExportDefinition(p,x))}catch(e){window.console.warn(e)}g&&(g.subject=r,g.comments&&g.comments.forEach(e=>{let t=l.filter(t=>t.parentCommentId===e.id);e.replies=t}),c.push(g))}}}if(f)return;b({label:d.exportPreparingDocumentMessage}),await r.exportAnnotationsAsPdf({baseDocumentBuffer:i,annotations:c,fileName:v,metadata:{author:C||"",title:h,creator:window.widget&&window.widget.getValue("appId")?p[window.widget.getValue("appId")]:"",subject:y.reviewDescription||""},onProgressChange:e=>{b({value:70+30*e})}})}catch(e){window.console.error(e),g.displayNotification({msg:d.exportError,eventID:"error"})}finally{P()}this.end?this.end():this.done()})}}}),define("DS/DMUPersistence/DMUAuthPersistenceServices",["UWA/Utils","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUPlayMarkup/DMUMarkup","DS/DMUBaseExperience/DMULinksManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUSceneDisplayController","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUBaseUIControllers/DMUReqCompareController","i18n!DS/DMUPersistence/assets/nls/DMUPersistence"],function(e,t,o,i,r,n,a,s,l,d,c,p,g,u,h){"use strict";return{createSessionMarkup:async function(a,p,M,D,f){if(a){var m=a.getViewer(),b=a.getFrameWindow(),P=t.getReviewContext({context:a}),x=null,y=null,C={entities:null,occurrences:null};if(P&&((x=P.getTransientReviewBag())&&"DMUTemporaryBag"===x.getType()&&(y=x.getAttribute("oLinksManager")),y&&y.exportLinksManagerData(C)),P||(P=await o.createReviewContext({context:a})),x=new i(m,P),y=new r(m,x),(C.entities&&C.entities.length>0||C.occurrences&&C.occurrences.length>0)&&y.importLinksManagerData(C),x.setAttributes([{name:"oLinksManager",value:y},{name:"sName",value:p}]),x.setMaturityState("IN_WORK"),P.setCurrentSessionMarkup(x),n.setSlidePreferences({context:b,preferences:{panelTitle:p}}),f){let o,i=1,r=u.giveReqCompareController({context:a});r&&r.isRequirementCompareActive()&&(i=2);for(let r=0;r<i;r++){const i=P.getCurrentSessionMarkup();(o=new s(m,i)).setAttributes([{name:"sID",value:x.computeNewID()},{name:"sUuid",value:e.getUUID()}]),o.updateEnvironmentOverload({target:P.getEnvironment(),state:P.getEnvironment().getEnvironmentInfo()}),i.addSlide(o);var v=null,w=l.giveDMUApplicativeContextManager({context:t.getContextViewer({viewer:m})});if(w){var S,U,k=w?w.getApplicativeControllers():[];let e=[];for(var T=0;T<k.length;T++){U=k[T].getApplicativeContainerID();var I=w.getVerifiedApplicativeContainerState(U);if(I){let t;o.setSlideApplicativeContext(U,I),null,(S=k[T].getCurrentAppContainerStateTitle())&&(v?v+=" - ":v="",v+=S);try{t="true"===(await g.readPreferences([{Repository:"DMURepository",PreferenceNames:["SlideNameFromFeature"]}])).repositories[0].preferences[0].value}catch(e){t=!0,window.console.warn("Could not get server value, default value set instead.",e)}if(t&&k[T]&&k[T].getFeatureInformation){let t=k[T].getFeatureInformation();t&&t.name&&e.push(t.name)}}o.setSlideApplicativeContext(U,I)}1===e.length&&e[0]&&(v=e[0])}v&&!v.length&&(v=null),o.setAttribute("sName",x.computeNewName({object:o,prefix:v||h.createMarkup.slideTitle,noSuffixIfPossible:null!==v,separator:null!==v?"parenthesis":null})),o.fireEvent("onDMUObjectInitialized",{dmuObject:o})}await d.copyTransientMarkersAndOverloads(x,o,a,M,D),P.getTransientReviewBag().removeDMUObjects();var A=c.giveDMUSlidesController({context:b});A&&A.setActiveSlide(o,{duration:0})}return x}},getPossibleRootContexts:function(e){if(!e)return[];var t=e.getRootBagPath().getChildrenPathes();if(t.length>1){var o=p.getDMUSceneDisplayController({context:e});if(o){let e=o.getCurrentComparedObjectIDPaths();if(e&&e.firstObject&&e.secondObject)for(let o=t.length-1;o>=0;o--)if(e.secondObject[0]===a.getNodeID(t[o].getLastElement(!0))){t.splice(o,1);break}}let i=u.giveReqCompareController({context:e});if(i){let e=i.getCurrentComparedObjectIDPaths();if(e&&e.firstObject&&e.secondObject)for(let o=t.length-1;o>=0;o--)if(e.secondObject===a.getNodeID(t[o].getLastElement(!0))){t.splice(o,1);break}}}return t}}}),define("DS/DMUPersistence/DMUCreateMarkupCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUPersistence/DMUSaveServices","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/Editor","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUReadPersistence/DMULoadingContextController","DS/Windows/Dialog","DS/Controls/Button","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/DMUPersistence/DMUAuthPersistenceServices","DS/DMUPersistence/DMUAuthPersistenceUtils","i18n!DS/DMUPersistence/assets/nls/DMUPersistence","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","css!DS/DMUPersistence/DMUPersistence.css"],function(e,t,o,i,r,n,a,s,l,d,c,p,g,u,h,M,D,f,m){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);var b,P,x,y,C,v,w,S,U,k,T=this,I=t.frameWindow||this.getFrameWindow(),A=I.getViewer(),E=[];let R,F,L=null,N=!1;var O=[],j=[];function B(){w=null,S=null,k&&(k.destroy(),k=null),E=[],P&&P.destroy(),b&&b.destroy(),P=b=null,y=C=v=void 0,w=S=void 0,T.end?T.end():T.done()}function W(e){P||(P=new o),P.build({type:"error",autoHide:!0,message:f.createMarkup.errorMessage,body:I.getUIFrame()});var t=i.giveEventsController({viewer:A});t&&t.fireEvent("onDMUMarkupCreationFailed"),window.console.error(e),B()}async function V(){if(x){var e=await M.createSessionMarkup(x,w,O,j,R);if(e){var t,o,a;if(t=v?v.value:E[0].valueItem,L){let e=L.getSubContextInformations(t);e&&e.id&&(o=e)}S&&(a=(a=JSON.stringify(S)).substring(1,a.length-1));const s=x.getController().getRootStats(t)&&x.getController().getRootStats(t).serviceId?x.getController().getRootStats(t).serviceId:"";!function(e){var t=i.getReviewContext({viewer:A});if(t){r.isCreatingAMarkup(!0);var o=[];e.parentID&&o.push(e.parentID),e.subContext&&e.subContext.id&&o.push(e.subContext.id),n.sendWebServiceCall({url:"resources/markup/service/createmarkup",config:{verb:"POST",data:{sTitle:e.reviewName,sContextIds:o,sDescription:e.reviewDescription?e.reviewDescription:"",sServiceId:e.serviceID,sExternalID:U,strURI:e.strURI?e.strURI:"",appData:e.appData?e.appData:""}},onSuccess:function(o){var i=JSON.parse(o);L||(L=c.getLoadingContextController({context:x})),t.setReviewCtxInformation({contextId:e.parentID,subContext:e.subContext,subContextId:e.subContext&&e.subContext.id?e.subContext:void 0,reviewId:i.pId,reviewName:e.reviewName,modifiable:!0,reviewDescription:e.reviewDescription?e.reviewDescription:"",reviewType:"DMUMarkupRepReference",owner:i.owner,tempObjectInfo:L?L.getTempObjectInformations():void 0}),e.onMarkupCreationCompleted(o),r.isCreatingAMarkup(!1)},onFailure:function(o){e.onMarkupCreationFailed(o),r.isCreatingAMarkup(!1),t.getCurrentSessionMarkup()&&t.getCurrentSessionMarkup().setActiveFlag(!1)}})}}({reviewName:w,reviewDescription:a,parentID:t,subContext:o,subContextId:o?o.id:void 0,serviceID:s,onMarkupCreationCompleted:function(){if(k&&(k.destroy(),k=null),"r2vsurvey"===s){x.toggleSOITimelinesUsability(!1);const e=i.giveEventsController({viewer:A});e&&e.fireEvent("onR2VMarkupCreationSuccess")}e.fireEvent("onDMUObjectInitialized",{dmuObject:e}),e.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e}),require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","CreateMarkup")}),setTimeout(function(){B()})},onMarkupCreationFailed:W})}}}i.setAuthoringFeatureTypes("Markup"),this.beginExecute=function(){N||(N=!0,setTimeout(function(){N=!1},500),new Promise(e=>{n.sendWebServiceCall({url:"resources/markup/service/generateName",config:{verb:"POST",data:JSON.stringify({sType:"DMUMarkupRepReference"})},onSuccess:function(t){e(t?{markupName:JSON.parse(t).title,externalID:JSON.parse(t).name}:{})}})}).then(t=>{var o;if(U=t.externalID,x=i.getContextViewer({viewer:A})){var n,P,T,N=M.getPossibleRootContexts(x),H=[],z=[];for(o=0;o<N.length;o++){var G=x.getController().isFiltered(d.getNodeID(N[o].getLastElement(!0)));if(x.getApplicativeData&&x.getApplicativeData().getLoadedItfData&&x.getApplicativeData().getLoadedItfData().data.length){x.getApplicativeData().getLoadedItfData().data.forEach(function(e){H.push({rootID:e.isrID,type:"ISR"})});break}if(G.filterId)H.push({rootID:G.filterId,type:"Filter"});else{const e=d.getNodeID(N[o].getLastElement(!0));""!==e&&H.push({rootID:e,type:x.getController().getRootStats(e)&&"r2vsurvey"===x.getController().getRootStats(e).serviceId?"R2V_FeatureState":d.getNodeType(N[o].getLastElement(!0))})}}H.length&&new Promise(function(e){var t=0;H.forEach(function(o){if("R2V_FeatureState"===o.type){L||(L=c.getLoadingContextController({context:x})),L.getLoadedR2VInformations().forEach(i=>{i.id===o.rootID&&(t++,E.push({labelItem:i.info[0]["ds6w:label"],iconItem:i.info[0].icon,valueItem:o.rootID,type:T}),t===H.length&&e())})}else x.getController().getAttributes({ids:[o.rootID],attributes:["ds6w:label","ds6wg:revision","type_icon_url","ds6w:type"],callbacks:{onComplete:function(i){t++,i[o.rootID]&&(n=i[o.rootID].type_icon_url,P=i[o.rootID]["ds6w:label"],T=i[o.rootID]["ds6w:type"],i[o.rootID]["ds6wg:revision"]&&(P+=" "+i[o.rootID]["ds6wg:revision"]),z.push(P),"R2V_FeatureState"!==T&&E.push({labelItem:P,iconItem:n,valueItem:o.rootID,type:T}),t===H.length&&e())},onFailure:function(){t++;[{type:"Filter",label:"Filter"},{type:"Document",label:"Document"},{type:"ISR",label:"Iterference Simulation"},{type:"PLMPIMMetricReference",label:"Iterference Metric"},{type:"DesignSight",label:"Physics Simulation"},{type:"Requirement",label:"Requirement"},{type:"Requirement Specification",label:"Requirement Specification"}].some(i=>{if(o.type===i.type)return z.push(i.label),E.push({labelItem:i.label+t,valueItem:o.rootID,type:i.type}),e(),!0})}}})})}).then(async function(){try{let e=(await m.readPreferences([{Repository:"DMURepository",PreferenceNames:["CreateFirstSlide","DisplayMarkupCreationDialog"]}])).repositories[0].preferences;for(let t=0;t<e.length;t++)"CreateFirstSlide"===e[t].name?(R="true"===e[t].value,H[0]&&H[0].type&&("Document"===H[0].type||"Requirement"===H[0].type||"Requirement Specification"===H[0].type)&&(R=!0)):"DisplayMarkupCreationDialog"===e[t].name&&(F="true"===e[t].value)}catch(e){R=!0,F=!0,window.console.warn("Could not get server value, default value set instead.",e)}w||(w=t.markupName);var o=i.getReviewContext({context:x}),n=function(){b&&b.destroy(),async function(){let e;if((k=new h).display({modal:!0,frmWindow:I,type:"load",message:f.createMarkup.loadingMessage}),e=v?v.value:E[0].valueItem,R){let t=await D.getTransientMarkersAndOverloads(o,x,e);j=t.overloads,O=t.markers}o&&o.getCurrentSessionMarkup()?r.saveCurrent3DMarkup({frmWindow:I}).then(V,W):V()}()};if(F||E.length>1||o&&o.getCurrentSessionMarkup()){var d,M,P,U=e.createElement("div",{class:"DMUCreateMarkupPanelMainDiv"});if(E.length>1){var T=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(U);T.setStyles({width:"calc(100% - 20px)",paddingLeft:"10px",paddingRight:"10px",margin:0}),T.innerText=f.createMarkup.multipleRootsLabel,(v=new a({elementsList:E,selectedIndex:0,enableSearchFlag:!0,actionOnClickFlag:!1}).inject(U)).elements.container.setStyles({width:"calc(100% - 10px)",margin:"5px"}),v.addEventListener("change",function(){C.value=v.label})}var N=function(){var t=""===y.value;d.disabled=t,d.disabled||(w=y.value,S=C.value),M.innerHTML="",P.innerHTML="";var o=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});o.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"});var i=e.createElement("span",{class:"condBadString"});i.innerHTML=f.createMarkup.condBadString,i.setStyles({color:"#E87B00",display:"inline","font-weight":"bold","font-style":"italic"}),t&&o.inject(M),M.setStyle("display",""!==M.innerHTML?"":"none"),P.setStyle("display",""!==P.innerHTML?"":"none")},z=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(U);z.setStyles({paddingTop:"0px"});var G=e.createElement("div").inject(z),_=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(G);_.setStyles({marginRight:"5px"}),(M=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(G)).setStyles({color:"#E87B00",display:"none"}),_.innerHTML=f.createMarkup.nameLabel,(y=new s({placeholder:f.createMarkup.namePlaceholder,value:w,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(z)).elements.container.setStyles({width:"100%"}),y.elements.container.childNodes[0].setStyles({width:"100%"}),y.addEventListener("change",N);var q=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(U),X=e.createElement("div").inject(q),$=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(X);if((P=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(X)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),!S)if("Specification Report"===E[0].type){if(L||(L=c.getLoadingContextController({context:x})),L){let e=L.getSubContextInformations(E[0].valueItem);e&&e.id&&(S=e.label)}}else S=E[0].labelItem;if($.innerHTML=f.createMarkup.descriptionLabel,(C=new l({nbRows:5,newLineMode:"shiftEnter",placeholder:f.createMarkup.descriptionPlaceholder,value:S,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(q)).elements.container.setStyles({width:"100%"}),C.elements.container.childNodes[0].setStyles({width:"100%"}),C.addEventListener("change",N),o&&o.getCurrentSessionMarkup()){var J=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(U);J.innerHTML=f.createMarkup.warningMessage,J.setStyles({color:"#e87b00","font-weight":"normal","font-style":"italic",margin:"0","margin-top":"10px"})}(d=new g({emphasize:"primary",label:f.createMarkup.createMarkupButton,onClick:n})).getContent().addClassName("markupCreationButton");var K=new g({label:f.createMarkup.cancelButton,onClick:function(){var e=i.giveEventsController({viewer:A});e&&e.fireEvent("onDMUMarkupCreationCancelled"),b&&b.destroy(),B()}});b=new p({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:f.createMarkup.panelTitle,resizableFlag:!0,immersiveFrame:I.getImmersiveFrame(),position:u.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:d,Cancel:K},width:400,content:U}),o&&o.getCurrentSessionMarkup()&&(d.emphasize="medium-attention",d.icon={iconName:"warning",fontIconFamily:WUXManagedFontIcons.font3DS}),b.addEventListener("close",function(){let e=i.giveEventsController({viewer:A});e&&e.fireEvent("onDMUMarkupCreationCancelled"),B()}),N()}else n()})}else B()}))},this.cancelExecute=function(){B()},this.setDefaultInfo=function(e){w=e.title,S=e.description}}})});