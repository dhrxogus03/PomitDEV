/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotationWidget/CATA3EAppInit",["DS/WAfrContainer/App","UWA/Core","DS/Controls/Loader","i18n!DS/CAT3DAnnotationWidget/assets/nls/CAT3DAnnotationWidget"],function(e,t,n,i){"use strict";var o,a,r={wkbFile:"CAT3DAnnotationWidgetWkb.xml",wkbModule:"CAT3DAnnotationWidget",defaultCmdHdr:"CAT3DAnnotationWidgetDefaultHdr",defaultCmdJSModule:"DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd"};return e.extend({setUp:function(e){var d=this;if(window.widget.getValue("X3DContentId")){var s="",l=JSON.parse(window.widget.getValue("X3DContentId"));l.data&&l.data.items&&l.data.items[0]&&l.data.items[0].displayName&&(s=l.data.items[0].displayName);var c=t.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(a=new n({text:i.loadingMessage+" "+s}).inject(c)).on(),a.getContent().addClassName("DMULoadingPanelInfoDiv");var u=a.elements.label.getSize().width,p=a.elements.progressBar.getContent().getSize().width,g=a.elements.progressBar.getContent().getSize().height,w=u+p;c.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),a.getContent().setStyles({position:"absolute",left:"calc(50% - "+w/2+"px)",top:"calc(50% - "+g/2+"px)"})}if(e.sourceApp)if(e.sourceApp.pad3DViewer){this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv;var m=function(t){t.sourceApp&&!t.sourceApp.isDisposeCalled()&&t.sourceApp.dispose();var n=t;n.widgetData=r;var i=t.done;e.done=function(t){d.appMainDiv||(d.appMainDiv=t.appMainDiv),e.done=i,e.done()},o.setUp(n)};o?m(e):require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(t){o=new t({widget:window.widget,data:r,pad3DViewer:e.sourceApp.pad3DViewer,appMainDiv:e.sourceApp.appMainDiv}),m(e)})}else e.done();else require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(t){o=new t({widget:window.widget,viewerAttachment:e.done,done:function(e){d.pad3DViewer=e.pad3DViewer,d.appMainDiv=e.appMainDiv},data:r})})},dispose:function(e){o&&o.dispose&&o.dispose(e),a&&(a.destroy(),a=null);var t=window.document.getElementsByClassName("DMULoadingPanel");t.length&&t[0].destroy(),this._parent(e)},onWillEnter:function(e){return o&&o.onWillEnter&&o.onWillEnter(e),require(["DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(t){t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")}),this._parent(e)},onWillLeave:function(e){return o&&o.onWillLeave&&o.onWillLeave(e),require(["DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")}),this._parent(e)}})}),window.top.performance.mark("A3E_jsAppLoad"),window.performance.mark("A3E_jsAppLoad"),define("DS/CAT3DAnnotationWidget/CATCommonA3Widget",["DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/CATWebUXComponents/DMUCommandsManager","DS/PADUtils/PADSettingsMgt","DS/CATWebUXComponents/DMUFrameWindow","i18n!DS/CAT3DAnnotationWidget/assets/nls/CAT3DAnnotationWidget"],function(e,t,n,i,o){"use strict";var a,r,d,s={};let l=null,c=null;var u=function(e,t,n){window.top.performance.measure(window.widget.id+"_"+e,n?t:window.widget.id+"_"+t),window.performance.measure(e,t)},p=function(e){window.top.performance.mark(window.widget.id+"_"+e),window.performance.mark(e)};function g(){s.viewer.getContentName({callbacks:{onComplete:function(e){s.widget.setTitle(e.contentName)},onFailure:function(){}}})}var w=function(){s.annotControllerReady&&s.defaultCmdReady&&(u("A3E_Global widget creation time","A3E_jsAppLoad",!0),s.widget.dispatchEvent("onWidgetAndAppReady","1"===s.widget.getValue("widgetForODTReplay")?[{pad3DViewer:s.viewer}]:void 0))};var m,A,D,v=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(m=e).renderDiv||m.initialize2(s.viewer.getFrameWindow().getViewerFrame(),t.appId(),s.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){m.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&s.widget.setValue("changeControlActivation",!0)})})})},f=function(t){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","i18n!DS/PADUtils/assets/nls/PADUtils"],function(n,o,a){var r,d=[],l=[];D=function(){s.widget.setPreferences([]),r.destroy(),d.forEach(function(e){e.cb&&i.removeEvent(e.cb,e.padFct)}),D=function(){}},A=function(){d.forEach(function(e){var t=e.preference.name,n=s.widget.getValue(t),o=i.getSetting(t);(n="boolean"===e.preference.type&&"boolean"!=typeof n?"true"===n:n)!==o&&i.setSetting(t,n),e.fct&&e.fct(n)}),i.updateWidgetPreferences(),!r&&d.length&&(r=n.create({events:{onPreferenceModification:function(e){d.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(i.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,s.widget.setValue(e.name,e.value),i.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})}}}),d.forEach(function(e){e.cb&&i.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:r.preferenceModification({name:e.preference.name,value:t})})}))},s.widget.setPreferences([]),i.setSetting("syncAutoReload",!0),o.destroy(),o.addSharedSettings(s.widget),d.push({preference:{name:"changeControlActivation",type:"boolean",label:a.changeControlActivation_label,defaultValue:!1},fct:function(e){m&&m[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),d.push({preference:{name:"changeControlPosition",type:"list",label:a.changeControlPosition_label,defaultValue:"top-right",options:[{label:a["top-right_label"],value:"top-right"},{label:a["top-left_label"],value:"top-left"},{label:a["bottom-left_label"],value:"bottom-left"},{label:a["bottom-right_label"],value:"bottom-right"}]},fct:function(e){m&&m.setPosition(e)}}),i.setSetting("authorizeChangeControl",!0),t&&v(),e.getOption("debug")?d.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}}):l=["webapi_timeout"],l.forEach(function(e){s.widget.deleteValue(e)}),l.length=0,d.forEach(function(e){s.widget.mergePreferences([e.preference])}),A(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{s.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){i.setSetting(e,t)});var t=i.getSetting("enopad3dviewer_roles");let n=!0,o=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){n=!1;break}!n||o||a?(s.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):s.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(s.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==s.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&s.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",s.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),i.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)}),s.widget.addEvent("endEdit",A)})};function C(e){e.objectId&&require(["DS/CAT3DAnnotControllerForReview/CATDIFAnnotSetLoader"],function(t){if(s.viewer){new t({context:s.viewer}).load({id:e.objectId})}})}var h=function(){if(i&&(i.setSetting("activateWidgetLink",!0),i.setSetting("useNewUXGuidelinesWP",!0)),!s.viewer){u("A3E_UWA widget loading","A3E_widgetLoad"),p("A3E_LoadJSPAD3DViewer");var e=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(s.widget,["showWelcomePanel"]),e()})}),m=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{t.initializeWidgetLink(s.widget,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([e,m]).then(function(){var e;u("A3E_PAD3DViewer load JS","A3E_LoadJSPAD3DViewer"),p("A3E_PAD3DViewerReady"),require("DS/PADUtils/PADUtilsServices").isCloud()&&i.setSetting("mouseProfile",window.__mouseProfile);s.widget;e=s.viewer=l,o.init(e,{executionContext:c}),n.dmuSetExecutionContext(l.getExecutionContext()),n.dmuSetHandlerComponent(l.getExecutionContext()),i.getSetting("mouseProfile")&&e.getViewpoint().setDefaultController(!0,i.getSetting("mouseProfile")),e.setOption("propertiesFacet",i.getSetting("propertiesFacet")),e.setAuthorizedRootTypes(i.getSetting("ups_authorized_root_types")),i.setSetting("settypes",!0),"1"===s.widget.getValue("widgetForODTReplay")&&s.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:e}]),s.widgetInitDone&&s.widgetInitDone({appMainDiv:s._appMainDiv,pad3DViewer:e}),function(e){e.unsubscribe(a),a=null,e.setLoadingDelegations({_DIFAnnotationSet:C,...t.getDelegation(s.viewer)}),g(),v(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),e.getController()&&e.getController()._model&&e.getController()._model._modelLoader&&e.getController()._model._modelLoader.setCGRWithSG(!0),u("A3E_PAD3DViewer creation","A3E_PAD3DViewerReady"),p("A3E_ownCommands"),require(["DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"],function(t,n){u("A3E_Annot controller JS Load","A3E_ownCommands"),p("A3E_annotController"),r=n;var i=(d=t).getFavoriteContextManager({context:e});i.setActivationDropState(!0),r.getAnnotationModelLoader({context:e,favoriteCtxManager:i}).setActiveState(1),s.viewerAttachment&&s.viewerAttachment(s._appMainDiv),s.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic(),u("A3E_Annot controller Init","A3E_annotController"),s.annotControllerReady=!0,w()}),u("A3E_Action Bar merge app commands","A3E_ownCommands"),s.viewer.subscribe({event:"onRootAdded"},g),s.viewer.subscribe({event:"onRootRemoved"},g),s.viewer.subscribe({event:"onRootAttached"},g),s.viewer.subscribe({event:"onRootDetached"},g),s.viewer.subscribe({event:"onContentNameModified"},g),s.viewer.subscribe({event:"onBeginRootLoading"},function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}),p("A3E_beforeDefaultCmdLoad");var i=s.viewer.getCommandContext?s.viewer.getCommandContext():null;n.setDefaultCommand({ID:s.widgetData.defaultCmdHdr,className:s.widgetData.defaultCmdJSModule,context:i}),u("A3E_Default Cmd Init","A3E_beforeDefaultCmdLoad"),s.defaultCmdReady=!0,w(),c.getComponent("LandingPage").appReady()}(e)})}};var S=function(){!function(){var e=i.getSetting("enopad3dviewer_roles");let t=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var a=0;a<e.length;a++)if("E19"===e[a].id&&(!e[a].platforms||e[a].platforms&&e[a].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}i.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!n&&!o),i.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)}(),s.viewer&&s.viewer.refresh()},b=function(){s.viewer&&(r.unreferenceAnnotationModelLoader({context:s.viewer}),d.unreferenceFavoriteContextManager({context:s.viewer}),s.viewer.destroy()),s={},r=d=null};function P(e){s.viewer&&s.viewer.search({searchQuery:e})}return class{constructor(e){s.widget=e.widget,s.widgetData=e.data,s._appMainDiv=e.appMainDiv,s.widgetInitDone=e.done,l=e.viewer,c=e.executionContext,e.pad3DViewer?(s.viewer=e.pad3DViewer,o.init(s.viewer,{executionContext:c})):(u("A3E_JS dependencies loading","A3E_jsAppLoad",!0),p("A3E_widgetLoad"),e.viewerAttachment?(s.viewerAttachment=e.viewerAttachment,h()):(s.viewerAttachment=function(e){s.widget.setBody(e)},s.widget.addEvent("onLoad",h)),s.widget.addEvent("onRefresh",S),s.widget.addEvent("onDestroy",b),s.widget.addEvent("onSearch",P),s.widget.setMetas({helpPath:(s.widgetData.defaultCmdHdr.search("Insight")>=0?"CAT3DAnnotSemanticWidget":"CAT3DAnnotationWidget")+"/assets/help"})),this.setUp=function(){require(["DS/CATWebUXComponents/DMUCommandsManager"],function(i){s.widget.addEvent("onRefresh",S),s.widget.addEvent("onSearch",P),s.widget.setMetas({helpPath:(s.widgetData.defaultCmdHdr.search("Insight")>=0?"CAT3DAnnotSemanticWidget":"CAT3DAnnotationWidget")+"/assets/help"}),i.refreshCommandsManager(c,"CAT3DAnnotationWidgetDefaultHdr"),e.sourceApp&&e.sourceApp.pad3DViewer!==s.viewer&&(s.viewer=e.sourceApp.pad3DViewer,o.init(s.viewer,{executionContext:c})),s.viewer.setOption("propertiesFacet",require("DS/PADUtils/PADSettingsMgt").getSetting("propertiesFacet")),s.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),s.viewer.setLoadingDelegations({_DIFAnnotationSet:C,...t.getDelegation(s.viewer)}),f(s.viewer),s.viewer.getViewer().updateViewPanelUIConfiguration&&s.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),g(),require(["DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"],function(t,i){var o=s.viewer?s.viewer.getFrameWindow():null;o&&o.removeReviewModel&&o.removeReviewModel("DMUSection"),o&&o.removeReviewModel&&o.removeReviewModel("DMUClipping"),r=i;var a=(d=t).getFavoriteContextManager({context:s.viewer});a.setActivationDropState(!0),r.getAnnotationModelLoader({context:s.viewer,favoriteCtxManager:a}).setActiveState(1);var l=s.viewer.subscribe({event:"onActionBarReady"},function(){s.viewer.unsubscribe(l),n.setDefaultCommand({ID:e.widgetData.defaultCmdHdr,className:e.widgetData.defaultCmdJSModule,context:s.viewer.getCommandContext()}),s.defaultCmdReady=!0,e.done({appMainDiv:s._appMainDiv,pad3DViewer:s.viewer}),w()});s.annotControllerReady=!0,w()}),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]}),require("DS/PADUtils/PADSettingsMgt").setSetting("activateWidgetLink",!0),require("DS/PADUtils/PADSettingsMgt").setSetting("useNewUXGuidelinesWP",!0)})};var i=!1;this.dispose=function(){if(s.widget.removeEvent("onRefresh",S),s.widget.removeEvent("onSearch",P),s.widget.removeEvent("endEdit",A),D&&D(),s.viewer){if(s.viewer.setLoadingDelegations({}),i){var e=require("DS/CAT3DAnnotationController/CAT3DAnnotationController");if(e){var t=e.giveAnnotationController({context:s.viewer});t&&t.saveLastFTAViewOrCaptureDisplayed(!0)}}r&&!i&&r.unreferenceAnnotationModelLoader({context:s.viewer}),d&&d.unreferenceFavoriteContextManager({context:s.viewer})}s.defaultCmdReady=!1,s.annotControllerReady=!1,o.reset()},this.onWillLeave=function(e){i=!(!e||!e.options||"ENOR3D_AP"!==e.options.id)}}}}),define("DS/CAT3DAnnotationWidget/CATCommonA3AppInit",["DS/WAfrContainer/App","UWA/Core","DS/Controls/Loader","i18n!DS/CAT3DAnnotationWidget/assets/nls/CAT3DAnnotationWidget"],function(e,t,n,i){"use strict";var o,a,r;return e.extend({setUp:function(e){r=this.options.id.includes("Semantic")?{wkbFile:"CAT3DAnnotSemanticWidgetWkb.xml",wkbModule:"CAT3DAnnotSemanticWidget",defaultCmdHdr:"CAT3DAnnotationWidgetDefaultHdr",defaultCmdJSModule:"DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticWidgetDefaultCmd"}:{wkbFile:"CAT3DAnnotationWidgetWkb.xml",wkbModule:"CAT3DAnnotationWidget",defaultCmdHdr:"CAT3DAnnotationWidgetDefaultHdr",defaultCmdJSModule:"DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd"};var d=this;if(window.widget.getValue("X3DContentId")&&!e.sourceApp){var s="",l=JSON.parse(window.widget.getValue("X3DContentId"));l.data&&l.data.items&&l.data.items[0]&&l.data.items[0].displayName&&(s=l.data.items[0].displayName);var c=t.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(a=new n({text:i.loadingMessage+" "+s}).inject(c)).on(),a.getContent().addClassName("DMULoadingPanelInfoDiv");var u=a.elements.label.getSize().width,p=a.elements.progressBar.getContent().getSize().width,g=a.elements.progressBar.getContent().getSize().height,w=u+p;c.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),a.getContent().setStyles({position:"absolute",left:"calc(50% - "+w/2+"px)",top:"calc(50% - "+g/2+"px)"})}if(!e.sourceApp)return new Promise(t=>{require(["DS/CAT3DAnnotationWidget/CATCommonA3Widget"],function(t){o=new t({widget:window.widget,viewer:d.getExecutionContext().getComponent("Viewer"),executionContext:d.getExecutionContext(),viewerAttachment:e.done,done:function(e){d.pad3DViewer=e.pad3DViewer,d.appMainDiv=e.appMainDiv},data:r})}),e.done&&e.done(),t()});if(e.sourceApp.pad3DViewer){this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv;var m=function(t){t.sourceApp&&!t.sourceApp.isDisposeCalled()&&t.sourceApp.dispose();var n=t;n.widgetData=r;var i=t.done;e.done=function(t){d.appMainDiv||(d.appMainDiv=t.appMainDiv),e.done=i,e.done()},o.setUp(n)};o?m(e):require(["DS/CAT3DAnnotationWidget/CATCommonA3Widget"],function(t){o=new t({widget:window.widget,data:r,pad3DViewer:e.sourceApp.pad3DViewer,appMainDiv:e.sourceApp.appMainDiv,viewer:d.getExecutionContext().getComponent("Viewer"),executionContext:d.getExecutionContext()}),m(e)})}else e.done()},dispose:function(e){o&&o.dispose&&o.dispose(e),a&&(a.destroy(),a=null);var t=window.document.getElementsByClassName("DMULoadingPanel");t.length&&t[0].destroy(),this._parent(e)},onWillEnter:function(e){return o&&o.onWillEnter&&o.onWillEnter(e),this.options.id.includes("Semantic")?require(["DS/PADUtils/PADSettingsMgt"],function(e){e.setSetting("enopad3dviewer_staticMappingSupportActivated",!0)}):require(["DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(t){t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")}),this._parent(e)},onWillLeave:function(e){return o&&o.onWillLeave&&o.onWillLeave(e),this.options.id.includes("Semantic")||require(["DS/CAT3DAnnotationUtils/CAT3DAnnotationUtils"],function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")}),this._parent(e)}})}),window.top.performance.mark("A3E_jsAppLoad"),window.performance.mark("A3E_jsAppLoad"),define("DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget",["UWA/Core","DS/CAT3DAnnotationUtils/CAT3DAnnotationUtilsOptions","DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/PADUtils/PADSettingsMgt","DS/CATWebUXComponents/DMUFrameWindow","i18n!DS/CAT3DAnnotationWidget/assets/nls/CAT3DAnnotationWidget"],function(e,t,n,i,o,a,r,d){"use strict";var s,l,c,u={},p=function(e,t,n){window.top.performance.measure(window.widget.id+"_"+e,n?t:window.widget.id+"_"+t),window.performance.measure(e,t)},g=function(e){window.top.performance.mark(window.widget.id+"_"+e),window.performance.mark(e)};const w=[{key:"difAnnotSet",type:"DIFAnnotationSet"}],m=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];function A(){var e=this.params.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function D(e){e&&e.length&&(this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map(function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.id,objectType:e.type,displayName:e.displayName}})}}}))}function v(e){if(e&&e.length){i.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map(function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}})}});var t=setInterval(function(){this.isAppReady&&this.welcomePanel&&(clearInterval(t),function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"A3IFetchForWelcomePanel"+Date.now(),select_predicate:m,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(this.welcomePanel){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},n=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=n.getRoots(this.pad3DViewer).map(function(e){return n.getNodeID(e)});e.attributes.forEach(function(e){t[e.name]=e.value});var o=t["ds6w:type"],a={resourceid:t.resourceid,label:t["ds6w:label"],icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:i.indexOf(t.resourceid)>-1,item2Load:{}};return a.item2Load[a.resourceid]={},"DIFAnnotationSet"===o&&(a.addRemoveFromViewCtx=!0),a}.bind(this));i.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}}.bind(this)))}.bind(this),100)}}function f(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=null,this.tokensWelcomePanel=[],this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/refreshCustom"},v.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=A.call(this),n=[];e.customitem2open.forEach(function(e){w.some(function(i){if(t[i.key]&&t[i.key][e])return n.push({id:e,type:i.type}),!0})}),D.call(this,n)}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.getRoots(this.pad3DViewer).map(function(e){return t.getNodeID(e)});this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach(e=>{this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd(e)}),n.forEach(function(t){e.customitem2remove.indexOf(t)>-1&&this.pad3DViewer.removeRoots({pids:[t]})},this)}}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=A.call(this),n=[];e.customitem2remove.forEach(function(e){w.some(function(i){if(t[i.key]&&t[i.key][e]&&-1===n.indexOf(e))return n.push(e),delete t[i.key][e],!0})}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),i.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:n}})}}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){n.launchSearch({title:d.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:function(e){D.call(this,e.map(function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}}))}.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(i.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){let n=t.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(n)var i=n.subscribe("onPreferencesPanelDestroyed",function(){n.unsubscribe(i),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",this.pad3DViewer&&this.pad3DViewer.getCommandContext?this.pad3DViewer.getCommandContext():null).begin()}.bind(this))}.bind(this)));var t=n.getDefaultActivities();t.activities[0].section.actions.splice(4,0,{id:"welcomePanelDIFAnnotationSet",title:d.difAnnotSet,icon:"annotation"}),t.activities.push({section:{id:"customizeAppSection",title:d.customApp,actions:[{id:"welcomPanelPrefCmd",title:d.prefs,icon:"cog"}]}}),this.welcomePanel=new n({widget:e.widget,readOnlyApp:!1,renderDiv:e.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/DIFAnnotationSet" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference"',defaultActionId:t.defaultActionId,activities:t.activities,onLandingPageReady:e.onLandingPageReady})}function C(){u.viewer.getContentName({callbacks:{onComplete:function(e){u.widget.setTitle(e.contentName)},onFailure:function(){}}})}f.prototype={constructor:f,initialize:function(){var e=this.welcomePanel.initialize();return e.then(function(){var e=A.call(this),t=Array.prototype.concat.apply([],w.map(function(t){return Object.keys(e[t.key]||[])}));v.call(this,t)}.bind(this)),e},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),n=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&n&&n!==this.params.renderDiv&&n.insertBefore(this.params.renderDiv,n.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.welcomePanel&&(this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)),this.params.initApp&&!this.welcomePanel&&require(["DS/ENOPAD3DViewer/utils/PAD3DViewerRestoreSession"],function(t){t.init({widget:this.params.widget,pad3DViewer:e})}.bind(this))},appReady:function(){if(this.isAppReady=!0,!this.welcomePanel&&this.params.initApp)require(["DS/ENOPAD3DViewer/utils/PAD3DViewerRestoreSession"],function(e){e.restoreSession()});else if(this.welcomePanel&&this.params.initApp){var e=this.params.widget.getValue("X3DContentId");let t=this;this.params.widget.deleteValue("X3DContentId"),e&&setTimeout(function(n){t.showWelcomePanel(!1),n.addRootNodesFromContent({json3DXContent:JSON.parse(e),dispatch:!1})},0,this.pad3DViewer)}if(this.welcomePanel){var t=this.welcomePanel.appReady();return this.welcomePanel.redraw(),t}},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel)return this.pad3DViewer=this.params=null,this.tokensWelcomePanel.forEach(i.unsubscribe,i),this.tokensWelcomePanel.length=0,this.welcomePanel.dispose()},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}};var h=function(){u.annotControllerReady&&u.defaultCmdReady&&(p("A3E_Global widget creation time","A3E_jsAppLoad",!0),u.widget.dispatchEvent("onWidgetAndAppReady","1"===u.widget.getValue("widgetForODTReplay")?[{pad3DViewer:u.viewer}]:void 0))};function S(e,n){var i={merge:!1,file:n.wkbFile,module:n.wkbModule};t.getOption("testWkb")&&"CAT3DAnnotSemanticWidgetWkb.xml"===i.file?i={merge:!1,file:"CAT3DAnnotSemanticWidgetWkb_TST.xml",module:"CAT3DAnnotSemanticTestWidget"}:t.getOption("testWkb")&&"CAT3DAnnotationWidgetWkb.xml"===i.file&&(i={merge:!1,file:"CAT3DAnnotationWidgetWkb_TST.xml",module:"CAT3DAnnotationTestWidget"}),e.loadActionBar(i)}var b,P,y,E=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],function(e,t){(b=e).renderDiv||b.initialize2(u.viewer.getFrameWindow().getViewerFrame(),t.appId(),u.widget.getValue("changeControlActivation")?"show":"hide","top-right",function(){b.addEvent("onAuthoringCtxVisible",function(e){e.showAuthoringContext&&u.widget.setValue("changeControlActivation",!0)})})})},_=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","i18n!DS/PADUtils/assets/nls/PADUtils"],function(n,i,o){var r,d=[],s=[];y=function(){u.widget.setPreferences([]),r.destroy(),d.forEach(function(e){e.cb&&a.removeEvent(e.cb,e.padFct)}),y=function(){}},P=function(){d.forEach(function(e){var t=e.preference.name,n=u.widget.getValue(t),i=a.getSetting(t);(n="boolean"===e.preference.type&&"boolean"!=typeof n?"true"===n:n)!==i&&a.setSetting(t,n),e.fct&&e.fct(n)}),a.updateWidgetPreferences(),!r&&d.length&&(r=n.create({events:{onPreferenceModification:function(e){d.some(function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(a.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,u.widget.setValue(e.name,e.value),a.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}})}}}),d.forEach(function(e){e.cb&&a.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:r.preferenceModification({name:e.preference.name,value:t})})}))},u.widget.setPreferences([]),a.setSetting("syncAutoReload",!0),i.destroy(),i.addSharedSettings(u.widget),d.push({preference:{name:"changeControlActivation",type:"boolean",label:o.changeControlActivation_label,defaultValue:!1},fct:function(e){b&&b[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),d.push({preference:{name:"changeControlPosition",type:"list",label:o.changeControlPosition_label,defaultValue:"top-right",options:[{label:o["top-right_label"],value:"top-right"},{label:o["top-left_label"],value:"top-left"},{label:o["bottom-left_label"],value:"bottom-left"},{label:o["bottom-right_label"],value:"bottom-right"}]},fct:function(e){b&&b.setPosition(e)}}),a.setSetting("authorizeChangeControl",!0),e&&E(),t.getOption("debug")?d.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}}):s=["webapi_timeout"],s.forEach(function(e){u.widget.deleteValue(e)}),s.length=0,d.forEach(function(e){u.widget.mergePreferences([e.preference])}),P(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],e=>{u.widget.addEvent("onChangeFlexibleAssembliesSupport",function(e,t){a.setSetting(e,t)});var t=a.getSetting("enopad3dviewer_roles");let n=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){n=!1;break}!n||i||o?(u.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):u.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(u.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==u.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&u.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",u.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),a.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)}),u.widget.addEvent("endEdit",P)})};function M(e){e.objectId&&require(["DS/CAT3DAnnotControllerForReview/CATDIFAnnotSetLoader"],function(t){if(u.viewer){new t({context:u.viewer}).load({id:e.objectId})}})}var x=function(e){e.unsubscribe(s),s=null,e.setLoadingDelegations({_DIFAnnotationSet:M,...o.getDelegation(u.viewer)}),C(),E(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),e.getController()&&e.getController()._model&&e.getController()._model._modelLoader&&e.getController()._model._modelLoader.setCGRWithSG(!0),p("A3E_PAD3DViewer creation","A3E_PAD3DViewerReady"),g("A3E_ownCommands"),require(["DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"],function(t,n){p("A3E_Annot controller JS Load","A3E_ownCommands"),g("A3E_annotController"),l=n;var i=(c=t).getFavoriteContextManager({context:e});i.setActivationDropState(!0),l.getAnnotationModelLoader({context:e,favoriteCtxManager:i}).setActiveState(1),u.viewerAttachment&&u.viewerAttachment(u._appMainDiv),u.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange(),p("A3E_Annot controller Init","A3E_annotController"),u.annotControllerReady=!0,h()});var t=e.subscribe({event:"onActionBarReady"},function(){p("A3E_Action Bar merge app commands","A3E_ownCommands"),u.viewer.unsubscribe(t),t=null,u._welcomePanel.appReady(),u.viewer.subscribe({event:"onRootAdded"},C),u.viewer.subscribe({event:"onRootRemoved"},C),u.viewer.subscribe({event:"onRootAttached"},C),u.viewer.subscribe({event:"onRootDetached"},C),u.viewer.subscribe({event:"onContentNameModified"},C),u.viewer.subscribe({event:"onBeginRootLoading"},function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}),g("A3E_beforeDefaultCmdLoad"),require(["DS/CATWebUXComponents/DMUCommandsManager"],function(e){var t=u.viewer.getCommandContext?u.viewer.getCommandContext():null;e.setDefaultCommand({ID:u.widgetData.defaultCmdHdr,className:u.widgetData.defaultCmdJSModule,context:t}),p("A3E_Default Cmd Init","A3E_beforeDefaultCmdLoad"),u.defaultCmdReady=!0,h()})});S(e,u.widgetData)};function V(t){return u._appMainDiv||(u._appMainDiv=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),u._welcomePanel=new f({widget:u.widget,readOnlyApp:!1,renderDiv:u._appMainDiv,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady}),u._welcomePanel.initialize()}var W=function(){if(a&&(a.setSetting("activateWidgetLink",!0),a.setSetting("useNewUXGuidelinesWP",!0)),!u.viewer){p("A3E_UWA widget loading","A3E_widgetLoad"),g("A3E_LoadJSPAD3DViewer");var e=new Promise(function(e){require(["DS/PADUtils/PADSharedSettings"],t=>{t.addSharedSettings(u.widget,["showWelcomePanel"]),V({initApp:!0,onLandingPageReady:function(){u.viewerAttachment(u._appMainDiv),u.viewerAttachment=null}}).then(e)})}),t=new Promise(function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","text!DS/CAT3DAnnotationWidget/assets/json/CAT3DAnnotationWidget.json"],function(t,n){e([t,n])})}),n=new Promise(e=>{require(["DS/ENOXInterWdgCom/LinkManager"],t=>{t.initializeWidgetLink(u.widget,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"],open:!0}).then(e)})});Promise.all([e,t,n]).then(function(e){p("A3E_PAD3DViewer load JS","A3E_LoadJSPAD3DViewer"),g("A3E_PAD3DViewerReady");var t,n=JSON.parse(e[1][1]);n.context="Default",n.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var i={widget:u.widget,windowOptions:n,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,readyCB:_,visuProgressiveTileModel:!0};t=u.viewer=new e[1][0](i),r.init(t),n.mouseProfile&&t.getViewpoint().setDefaultController(!0,n.mouseProfile),u._welcomePanel.setViewer(t),t.setOption("propertiesFacet",a.getSetting("propertiesFacet")),t.setAuthorizedRootTypes(a.getSetting("ups_authorized_root_types")),s=t.subscribe({event:"onReady"},x),a.setSetting("settypes",!0),"1"===u.widget.getValue("widgetForODTReplay")&&u.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:t}]),u.widgetInitDone&&u.widgetInitDone({appMainDiv:u._appMainDiv,pad3DViewer:t})})}};var T=function(){!function(){var e=a.getSetting("enopad3dviewer_roles");let t=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),i=require("DS/PADUtils/PADSession").isAuthoring();for(var o=0;o<e.length;o++)if("E19"===e[o].id&&(!e[o].platforms||e[o].platforms&&e[o].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}a.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!n&&!i),a.setSetting("enopad3dviewer_staticMappingSupportActivated",!i)}(),u.viewer&&u.viewer.refresh()},U=function(){u._welcomePanel&&u._welcomePanel.dispose(),u._welcomePanel=null,u.viewer&&(l.unreferenceAnnotationModelLoader({context:u.viewer}),c.unreferenceFavoriteContextManager({context:u.viewer}),u.viewer.destroy()),u={},l=c=null};function L(e){u.viewer&&u.viewer.search({searchQuery:e})}var N=function(e){u.widget=e.widget,u.widgetData=e.data,u._appMainDiv=e.appMainDiv,u.widgetInitDone=e.done,e.pad3DViewer?(u.viewer=e.pad3DViewer,r.init(u.viewer)):(p("A3E_JS dependencies loading","A3E_jsAppLoad",!0),g("A3E_widgetLoad"),e.viewerAttachment?(u.viewerAttachment=e.viewerAttachment,W()):(u.viewerAttachment=function(e){u.widget.setBody(e)},u.widget.addEvent("onLoad",W)),u.widget.addEvent("onRefresh",T),u.widget.addEvent("onDestroy",U),u.widget.addEvent("onSearch",L),u.widget.setMetas({helpPath:(u.widgetData.defaultCmdHdr.search("Insight")>=0?"CAT3DAnnotSemanticWidget":"CAT3DAnnotationWidget")+"/assets/help"}))};N.prototype.setUp=function(e){require(["DS/CATWebUXComponents/DMUCommandsManager"],function(t){u.widget.addEvent("onRefresh",T),u.widget.addEvent("onSearch",L),u.widget.setMetas({helpPath:(u.widgetData.defaultCmdHdr.search("Insight")>=0?"CAT3DAnnotSemanticWidget":"CAT3DAnnotationWidget")+"/assets/help"});var n={lastCommand:[],currentCommand:null,defaultCommand:null},i=u.viewer.getCommandContext();i?t._commandsState[i]=n:t._commandsState=n,t.resetDefaultCommand(i),t._isCommandEnding=!1,t._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(e){var n=i?t[e][i]:t[e];Object.keys(n).forEach(function(e){var t=n[e];t&&t._destroy&&t._destroy(),delete n[e]})}),e.sourceApp&&e.sourceApp.pad3DViewer!==u.viewer&&(u.viewer=e.sourceApp.pad3DViewer,r.init(u.viewer)),u.viewer.setOption("propertiesFacet",require("DS/PADUtils/PADSettingsMgt").getSetting("propertiesFacet")),u.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),u.viewer.setLoadingDelegations({_DIFAnnotationSet:M,...o.getDelegation(u.viewer)}),_(u.viewer),u.viewer.getViewer().updateViewPanelUIConfiguration&&u.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),C(),require(["DS/CAT3DAnnotationFavoriteCtx/CAT3DAnnotationFavoriteCtxManager","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"],function(n,i){var o=u.viewer?u.viewer.getFrameWindow():null;o&&o.removeReviewModel&&o.removeReviewModel("DMUSection"),o&&o.removeReviewModel&&o.removeReviewModel("DMUClipping"),l=i;var a=(c=n).getFavoriteContextManager({context:u.viewer});a.setActivationDropState(!0),l.getAnnotationModelLoader({context:u.viewer,favoriteCtxManager:a}).setActiveState(1);var r=u.viewer.subscribe({event:"onActionBarReady"},function(){u.viewer.unsubscribe(r),t.setDefaultCommand({ID:e.widgetData.defaultCmdHdr,className:e.widgetData.defaultCmdJSModule,context:u.viewer.getCommandContext()}),u.defaultCmdReady=!0,e.done({appMainDiv:u._appMainDiv,pad3DViewer:u.viewer}),h()});S(u.viewer,e.widgetData),u.annotControllerReady=!0,h()}),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]}),require("DS/PADUtils/PADSettingsMgt").setSetting("activateWidgetLink",!0),require("DS/PADUtils/PADSettingsMgt").setSetting("useNewUXGuidelinesWP",!0),V().then(function(){u._welcomePanel.setViewer(u.viewer),u._welcomePanel.appReady()})})};var R=!1;return N.prototype.dispose=function(){if(u.widget.removeEvent("onRefresh",T),u.widget.removeEvent("onSearch",L),u.widget.removeEvent("endEdit",P),y&&y(),u._welcomePanel&&u._welcomePanel.dispose(),u._welcomePanel=null,u.viewer){if(u.viewer.setLoadingDelegations({}),R){var e=require("DS/CAT3DAnnotationController/CAT3DAnnotationController");if(e){var t=e.giveAnnotationController({context:u.viewer});t&&t.saveLastFTAViewOrCaptureDisplayed(!0)}}l&&!R&&l.unreferenceAnnotationModelLoader({context:u.viewer}),c&&c.unreferenceFavoriteContextManager({context:u.viewer})}u.defaultCmdReady=!1,u.annotControllerReady=!1},N.prototype.onWillLeave=function(e){R=!(!e||!e.options||"ENOR3D_AP"!==e.options.id)},N});