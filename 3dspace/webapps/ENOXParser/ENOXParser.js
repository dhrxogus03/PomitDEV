/*!  COPYRIGHT DASSAULT SYSTEMES 2021   */
define("DS/ENOXParser/modules/common/OfwBuilder",[],function(){function e(e){e.children||(e.children=[])}function t(e){this.options=e,this._referenceMap=new Map}return t.prototype={addReference:function(e){this._referenceMap.set(e.resourceid,e)},addInstance:function(t){t.isInstance=!0;var n=this._referenceMap.get(t.from);e(n),n.children.push(t);var r=this._referenceMap.get(t.resourceid);e(t),t.children.push(r)},getReference:function(e){return this._referenceMap.get(e)},correct:function(){}},t}),define("DS/ENOXParser/modules/Numbers",[],function(){const e=[1,0,0,0,1,0,0,0,1,0,0,0],t=6;function n(e,t){let n=parseFloat(e);if(void 0!==t){let e=n.toFixed(t);n=parseFloat(e)}return n}return{int:parseInt,float:n,checkNotIdentity:function(r){let i=function(e){let r=[];for(let i=0;i<e.length;i++){let s=e[i];r.push(n(s,t))}return r}(r.split(",")),s=!1;for(let t=0;t<i.length&&!s;t++)i[t]!==e[t]&&(s=!0);return s}}}),define("DS/ENOXParser/modules/common/Constants",[],function(){return{NODE_STATES:{COLLAPSED:{state:"collapsed"},EXPANDED:{state:"expanded"},NOCHILDREN:{state:"noChildren"},EXPANDING:{state:"expanding"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"}},GLOBALTYPE_DOC:"ds6w:Document",MATRIX_IDENTITY:[1,0,0,0,1,0,0,0,1,0,0,0]}}),define("DS/ENOXParser/modules/mixins/parser/MergeObj",["DS/PADServices/utils/Iterator"],function(e){const t=["grid","icons"];function n(t,i){let s={},o=0,a=0;var d=[],l=[];return Array.isArray(i)?r(t,i):(e.iterateObj(i,function(e,t){var n;o++,Array.isArray(e)?d.push(t):null!=(n=e)&&!0!==n&&!1!==n&&!n.toPrecision&&n&&n.isPrototypeOf&&n.hasOwnProperty&&!n.trim?l.push(t):a++}),a===o?s=Object.assign({},i):(s=Object.assign({},i),e.iterate(d,function(e){s[e]=r(t,i[e])}),e.iterate(l,function(e){s[e]=n(t,i[e])})),s)}function r(t,r){var i=[];return e.iterate(r,function(e){i.push(n(t,e))}),i}function i(){}return i.prototype={smartAssign:function(n,r){var i=Object.assign({},n,r);return e.iterate(t,function(e){r[e]&&(i[e]=Object.assign({},n[e],r[e]))}),i},assignClone:function(e){return n(this,e)}},i}),define("DS/ENOXParser/modules/ClientDataParser",[],function(){const e=/(\{|\}|\,|\\|"|\w+|\.|:|\[|\])/g;function t(e){this._data=e,this.final=[],this.pids=[],this._parse(),this._extractPids()}return t.prototype={_parse:function(){for(let t=0;t<this._data.length;t++){let n=this._data[t],r=n.indexOf("#FSMP#"),i=n;if(-1!==r&&(i=i.substring(r+"#FSMP#".length)),e.test(i))try{let e=JSON.parse(i);this.final.push(e)}catch(e){console.error("Not JSON",e,i)}}},_extractPids:function(){for(let e=0;e<this.final.length;e++){let t=this.final[e].data.filter(function(e){return"bo"===e.kind}).map(function(e){return e.pid});this.pids=this.pids.concat(t)}},appendPids:function(e){for(let t=0;t<this.pids.length;t++){let n=this.pids[t];e.includes(n)||e.push(n)}},appendPaths:function(e){let t=this.pids.map(function(e){return[e]});for(let n=0;n<t.length;n++){let r=t[n];e.includes(r)||e.push(r)}}},t}),define("DS/ENOXParser/modules/ColorMapParser",["DS/PADServices/utils/Iterator"],function(e){function t(t){this.data={predicateKind:"",colorMap:{map:{},predicate:void 0}};let n=this;this.data.predicateKind=t.tagColors&&t.tagColors.length?t.tagColors[0].type:null,e.iterate(t.tagColors,function(e){if(void 0===n.data.colorMap.predicate){var t=e.predicate.split("/"),r=t[t.length-1];n.data.colorMap.predicate=r}var i=e.object;Array.isArray(i)&&(i=i.join("/"),this.predicateKind="arrayPredicates"),n.data.colorMap.map[i]=e.color,n.data.colorMap.map[e.dispValue]=e.color})}return t.prototype={interpret:function(e){}},t}),define("DS/ENOXParser/modules/common/Timeout",[],function(){const e={parseTimeout:!0};function t(e){this.timeout=e,this.start=Date.now()}return t.prototype={check:function(){if(void 0!==this.timeout&&Date.now()-this.start>this.timeout)throw e}},t}),define("DS/ENOXParser/modules/common/Helpers",["UWA/Core","DS/PADServices/utils/Iterator","DS/PADServices/utils/IconMgt"],function(e,t,n){const r={EXPANDV2:{instances:function(e){return void 0!==e.to},references:function(e){let t=void 0===e.to&&void 0!==e.resourceid;if(t&&n.isActive()){var r=n.buildKey(e),i=n.buildThumbKey(e);-1===this.typeMap.indexOf(r)&&(this.typeMap.push(r),this.sampleRscId.push(e.resourceid)),-1===this.typeMapThumbs.indexOf(i)&&(this.typeMapThumbs.push(i),this.thumbsRscId.push(e.resourceid))}return t},pgpOutputs:function(e){return void 0!==e.pgp_output},paths:function(e){return void 0!==e.Path}},OFW:{instances:function(e){return void 0!==e.to},references:function(e){return void 0===e.to&&void 0!==e.resourceid},pgpOutputs:function(e){return void 0!==e.pgp_output}}};function i(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}return!1}return!1}var s={divideAndConquer:function(e,t,n){var r={},i=t.timeoutObj,s=Object.keys(n),o=s.length;for(let a=0;a<o;a++){let o=s[a],d=n[o];r[o]=e.filter(d,t),i&&i.check()}return r},node:{setFilterBadge:function(t){let n=e.clone(t.options.icons[0]);n.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}};let r={icons:[n]};t.updateOptions(r)},clearBadges:function(t){if(t.options&&t.options.icons){var n=e.clone(t.options.icons[0]);n.badges={bottomRight:null},t.updateOptions({icons:[n]})}},clearChildComputed:function(e){let n=e.getAllDescendants();t.iterate(n,function(e){e.isRelationsObjectGroupingNode||(delete e.options.childComputed,delete e.childComputed)})},updateSpecificColumnViews:function(e,t,n){let r=Object.keys(t);for(let i=0;i<r.length;i++)t[r[i]].updateAttributesDelayed(e,n,this)},extractResAndRel:function(e){let t=e.getID(),n=e.getRelationID();return e.isRoot()&&(n=void 0),{resid:t,relid:n}},exactNodeByPath:function(e,t){let n=e.search({match:function(e){return i(e.nodeModel.getOccurencePath(),t)},shouldStop:function(){return!1},useTransaction:!1});return n.length?n[0]:null}},data:{jsonParse:function(e){return"string"==typeof e?JSON.parse(e):e}},array:{compare:i,unique:function(e,t){-1===e.indexOf(t)&&e.push(t)}}};return Object.defineProperties(s,{MAPS:{get:function(){return r}}}),s}),define("DS/ENOXParser/modules/BsdParser",["DS/PADServices/utils/Iterator","DS/ENOXParser/modules/common/Helpers"],function(e,t){function n(e){this.options=e,this.dataTree={},this.hasNodeAdds=!1,this.hasNodeRemoves=!1,this._parse()}return n.prototype={_parse:function(){let e=this.options.data;e.browsingStructures.referencesID.length&&(this.residsAffected=e.browsingStructures.referencesID.slice()),e.browsingStructures.add.length&&(this.addStructures=e.browsingStructures.add.slice()),e.browsingStructures.remove.length&&(this.removeStructures=e.browsingStructures.remove.slice()),e.browsingNodes.relationsID.length?this.relidsAffected=e.browsingNodes.relationsID.slice():this.relidsAffected=[],e.browsingNodes.add.length&&(this.addNodes=e.browsingNodes.add.slice(),this.hasNodeAdds=!0),e.browsingNodes.remove.length&&(this.removeNodes=e.browsingNodes.remove.slice(),this.hasNodeRemoves=!0),this._linkData()},_linkData:function(){}},n}),define("DS/ENOXParser/modules/mixins/parser/ParseAttributes",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/AttributesMgtV2","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/Numbers","DS/PADServices/utils/Meas","DS/PADServices/utils/Iterator","DS/PADServices/utils/IconMgt"],function(e,t,n,r,i,s,o){"use strict";function a(e){return UWA.is(e,"string")?"true"===e.toLowerCase():UWA.is(e,"boolean")?e:void 0}function d(e,t){e.padgrid||(e.padgrid={}),e.padgrid["ds6w:globalType"]=t}function l(e,t,n){let r=e.grid[t];if(void 0!==r){let i=[r];i.push(n),e.grid[t]=i}else Array.isArray(r)?r.push(n):e.grid[t]=n}function c(){}return c.prototype={checkNotIdentity:r.checkNotIdentity,parseAttributes:function(e){for(var n=i.buildOrGetSection("parser.parseAttributes"),r=n.create("overall",{stats:!0}),o=t.getTreeColumn(),c=t.getColumnsOrder(),p={resourceid:"",ensureNLS:!0,grid:{}},u=void 0,h=0;void 0===u&&h<e.length;h++)"ds6w:globaltype"===e[h].name.toLowerCase()&&(u=e[h].value);if(void 0===u&&(u=""),"ds6w:Instance"!==u&&""!==u){let t=n.create("ref",{stats:!0});s.iterate(e,function(e){if("type"===e.name)e.name="ds6w:type";else{var t=e.name.split("/");e.name=t[t.length-1]}switch(UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\n/g," "),"FALSE"!==e.value.toUpperCase()&&"TRUE"!==e.value.toUpperCase()||(e.value="TRUE"===e.value.toUpperCase())),e.name.toLowerCase()){case o:p.label=e.value,p.display=p.label;break;case"ds6w:type":p.grid||(p.grid={}),p.grid[e.name]=e.value,p.type=e.value;break;case"resourceid":case"physicalid":p.resourceid=e.value;break;case"did":p.did=e.value;break;case"type_icon_url":p.icons||(p.icons=[]),p.icons.push({iconPath:"url("+e.value+")",className:"dgv-icons"});break;case"preview_url":case"thumbnail_2d":p.thumbnail=e.value,p.grid||(p.grid={}),p.grid.thumbnail=e.value;break;case"ds6w:globaltype":p.grid||(p.grid={}),p.grid.globaltype=e.value,d(p,e.value);break;default:c&&-1!==c.indexOf(e.name)?(p.grid||(p.grid={}),l(p,e.name,e.value)):(p.padgrid||(p.padgrid={}),"bo.pgpshowextension.v_pgp_show"===e.name.toLowerCase()?p.isPADHidden=!a(e.value):(p.grid||(p.grid={}),p.padgrid[e.name]=e.dispValue?e.dispValue:e.value,l(p,e.name,e.dispValue?e.dispValue:e.value)))}}),t.end()}else{let t=n.create("inst",{stats:!0});s.iterate(e,function(e){switch(e.name.toLowerCase()){case"ds6w:type":p.grid||(p.grid={}),p.grid[e.name+"-Instance"]=e.value,p.type=e.value;break;case"resourceid":case"physicalid":p.resourceid=e.value;break;case"treeOrder":case"ro.plminstance.v_treeorder":p.relationOrder=parseFloat(e.value),isNaN(p.relationOrder)&&(p.relationOrder=-1);break;case"matrixtxt":this.checkNotIdentity(e.value)&&(p.grid||(p.grid={}),p.grid["positionMatrix-Instance"]=e.value);break;case"ds6w:globaltype":p.grid||(p.grid={}),p.grid.globaltypeInstance=e.value,d(p,e.value);break;default:c&&-1!==c.indexOf(e.name+"-Instance")?(p.grid||(p.grid={}),p.grid[e.name+"-Instance"]=e.value):(p.padgrid||(p.padgrid={}),"ro.pgpshowextension.v_pgp_show"===e.name.toLowerCase()?p.isPADHidden=!a(e.value):(p.grid||(p.grid={}),p.padgrid[e.name+"-Instance"]=e.dispValue?e.dispValue:e.value,p.grid[e.name+"-Instance"]=e.dispValue?e.dispValue:e.value))}}),t.end()}return p.relationOrder||(p.relationOrder=-1),p.grid||(p.grid={}),"SUPPLEMENTAL"===p.grid["ds6w:cadMaster"]&&(p.supplementalNode=!0),r.end(),p},parseNodeOptions_V2:function(e,r){var i=t.getTreeColumn(),l=t.getColumnsOrder(),c={resourceid:"",ensureNLS:!0,grid:{}},p=this;if(s.iterateObj(e.node,function(e,t){if(r)switch(t.toLowerCase()){case"resourceid":c.relationid=e;break;case"from":c.from=e;break;case"to":c.resourceid=e;break;case"matrixtxt":p.checkNotIdentity(e)?c.grid["positionMatrix-Instance"]=e:c.grid["positionMatrix-Instance"]=void 0;break;case"ds6w:type":c.relationtype=e,c.grid[t+"-Instance"]=e;break;case"ro.plminstance.v_treeorder":c.relationOrder=parseFloat(e),isNaN(c.relationOrder)&&(c.relationOrder=-1);break;case"ro.pgpshowextension.v_pgp_show":c.isPADHiddenInstance=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;case"ds6w:reservedby":c.grid[t+"-Instance"]=e;break;case"svg":e&&e.length>0&&(c.grid||(c.grid={}),c.grid.svg||(c.grid.svg=[]),c.grid.svg.push({format:t,id:e}));break;case"relcount":c.relcount=parseInt(e),0===c.relcount&&(c.children=null);break;default:let n=t+"-Instance";l&&l.includes(n)?c.grid[n]=e:l&&l.includes(t)&&(c.grid[n]=e)}else switch(t.toLowerCase()){case"resourceid":c.resourceid=e;break;case i:c.label=e;break;case"ds6w:type":c.type=e,c.grid[t]=e;break;case"icon":case"type_icon_url":if(!o.isActive()){void 0===c.icons&&(c.icons=[]);let t=e;c.icons.push({iconPath:"url("+t+")",className:"dgv-icons"})}break;case"thumbnail":case"thumbnail_2d":c.thumbnail=e,c.grid.thumbnail=e;break;case"ds6w:globaltype":c.globaltype=e,d(c,e);break;case"bo.pgpshowextension.v_pgp_show":c.isPADHiddenReference=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;case"ds6w:reservedby":case"ds6w:identifier":c.grid[t]=e;break;default:"ds6w:cadmaster"===t&&(t="ds6w:cadMaster"),l&&l.includes(t)&&(c.grid[t]=e)}}),"SUPPLEMENTAL"===c.grid["ds6w:cadMaster"]&&(c.supplementalNode=!0),!r)if(c.children=[],void 0===c.icons){if(o.isActive()){c.icons=[];let t=o.buildKey(e.node);var u=o.getIcon(t);u&&c.icons.push({iconPath:u})}}else if(void 0===c.thumbnail)if(o.isActive()){let t=o.buildThumbKey(e.node),n=o.getThumbnail(t);n&&(c.thumbnail=n,c.grid.thumbnail=n)}else c.thumbnail=c.icons[0].iconPath.replace("fileType=ICON","fileType=THUMBNAIL_2D"),c.thumbnail=c.thumbnail.substring(4,c.thumbnail.length-1),c.grid.thumbnail=c.thumbnail;return n.GLOBALTYPE_DOC===c.globaltype&&(c.children=null),c},parseNodeOptions:function(e,r){var i=t.getTreeColumn(),l=t.getColumnsOrder(),c={resourceid:"",ensureNLS:!0,grid:{}},p=this;if(s.iterateObj(e.node,function(e,t){if(r)switch(t.toLowerCase()){case"resourceid":c.relationid=e;break;case"from":c.from=e;break;case"to":c.resourceid=e;break;case"matrixtxt":p.checkNotIdentity(e)?c.grid["positionMatrix-Instance"]=e:c.grid["positionMatrix-Instance"]=void 0;break;case"ds6w:type":c.relationtype=e,c.grid[t+"-Instance"]=e;break;case"ro.plminstance.v_treeorder":c.relationOrder=parseFloat(e),isNaN(c.relationOrder)&&(c.relationOrder=-1);break;case"ro.pgpshowextension.v_pgp_show":c.isPADHiddenInstance=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;case"ds6w:reservedby":c.grid[t+"-Instance"]=e;break;default:let n=t+"-Instance";l&&l.includes(n)?c.grid[n]=e:l&&l.includes(t)&&(c.grid[n]=e)}else switch(t.toLowerCase()){case"resourceid":c.resourceid=e;break;case i:c.label=e;break;case"ds6w:type":c.type=e,c.grid[t]=e;break;case"icon":case"type_icon_url":if(!o.isActive()){void 0===c.icons&&(c.icons=[]);let t=e;c.icons.push({iconPath:"url("+t+")",className:"dgv-icons"})}break;case"thumbnail":case"thumbnail_2d":c.thumbnail=e,c.grid.thumbnail=e;break;case"ds6w:globaltype":c.globaltype=e,d(c,e);break;case"bo.pgpshowextension.v_pgp_show":c.isPADHiddenReference=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;case"ds6w:reservedby":case"ds6w:identifier":c.grid[t]=e;break;default:"ds6w:cadmaster"===t&&(t="ds6w:cadMaster"),l&&l.includes(t)&&(c.grid[t]=e)}}),"SUPPLEMENTAL"===c.grid["ds6w:cadMaster"]&&(c.supplementalNode=!0),!r)if(c.children=[],void 0===c.icons){if(o.isActive()){c.icons=[];let t=o.buildKey(e.node);var u=o.getIcon(t);u&&c.icons.push({iconPath:u})}}else if(void 0===c.thumbnail)if(o.isActive()){let t=o.buildThumbKey(e.node),n=o.getThumbnail(t);n&&(c.thumbnail=n,c.grid.thumbnail=n)}else c.thumbnail=c.icons[0].iconPath.replace("fileType=ICON","fileType=THUMBNAIL_2D"),c.thumbnail=c.thumbnail.substring(4,c.thumbnail.length-1),c.grid.thumbnail=c.thumbnail;return n.GLOBALTYPE_DOC===c.globaltype&&(c.children=null),c},parseGroupingNodeOptions:function(e,n){t.getTreeColumn();var r={resourceid:"",ensureNLS:!0,grid:{}};r.icons=e.icons,r.children=[],r.thumbnail="";return s.iterateObj(e,function(e,t){switch(t.toLowerCase()){case"resourceid":r.resourceid=e;break;case"label":r.label=e;break;case"icon":void 0===r.icons&&(r.icons=[]),r.icons.push({iconPath:"url("+e+")",className:"dgv-icons"});break;case"thumbnail":r.grid.thumbnail=e;break;case"ds6w":r.ds6w=e;break;case"disptext":r.dispText=e;break;case"grid":r.grid=e;break;case"grp":r.grp=e;break;case"grpselected":r.grpSelected=e;break;case"kind":r.kind=e;break;case"isother":r.isOther=e}}),r}},c}),define("DS/ENOXParser/modules/common/LoadModelBuilder",["UWA/Core","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/PADServices/utils/HideShowController"],function(e,t,n,r,i){const s=r.addOrGetSection("parser");function o(e,t){return e.relationOrder-t.relationOrder}function a(e){for(var t=[],n=[],r=[],i=[],s=0;s<e.length;s++){var a=e[s];switch(a.globaltype){case"ds6w:Instance":case"ds6w:Document":n.push(a);break;case"ds6w:Part":t.push(a);break;default:r.push(a)}}return n.sort(o),t.sort(o),r.sort(o),i=(i=(i=i.concat(n)).concat(t)).concat(r)}function d(e,n){if(e.isGroupingNode)return void(e.expandedState=t.NODE_STATES.EXPANDED.state);let r=n.findInCtx,i=(n.filter,n.expandAll),s=!!n.isRefresh;if(e.children&&e.children.length)if(1===e.children.length){let n=e.children[0];n.globaltype===t.GLOBALTYPE_DOC?e.expandedState=t.NODE_STATES.COLLAPSED.state:r?(e.expandedState=t.NODE_STATES.PARTIALLY_EXPANDED.state,n.expandedState=t.NODE_STATES.PARTIALLY_EXPANDED.state):e.expandedState=t.NODE_STATES.EXPANDED.state}else e.expandedState=r?t.NODE_STATES.PARTIALLY_EXPANDED.state:t.NODE_STATES.EXPANDED.state;else s?(e.expandedState=t.NODE_STATES.COLLAPSED.state,delete e.childComputed):i&&(e.children=null,e.expandedState=t.NODE_STATES.NOCHILDREN.state)}function l(e){let t=new Map,r=e.filter(e=>e.children&&e.children.length);for(let e=0;e<r.length;e++){let n=r[e];if(n.children&&n.children.length)for(let e=0;e<n.children.length;e++){let r=n.children[e],i=r.resourceid+"_"+r.relationid;t.has(i)||t.set(i,r)}}let i=[];return n.iterateMap(t,function(e,t){i.push(e)}),i.length?i:[]}function c(e,t,n){const r=n;let i=e.map(function(e){return r.get(e)?r.get(e):[]}).map(function(e){let t=e.resourceid;return[t,function e(t,n,r){result=-1,found=!1;let i=t+1;if(r){if(r.resourceid===n&&(found=!0),found)return i;{recurseFound=!1;let t=r.children;if(t&&t.length)for(let r=0;r<t.length;r++){let s=e(i,n,t[r]);if(-1!==s){result=s,recurseFound=!0;break}}return result}}return result}(0,t,e)]});const s=new Map(i);t.sort(function(e,t){let n,r,i=s.get(e),o=s.get(t);return-1!==i&&(n=i),-1!==o&&(r=o),n>r?-1:n<r?1:0})}function p(e){this.options=e,this._parentLookup=new Map,this._arraysOfReferences=new Map,this._correctionList=[],this._orderList=[]}return p.prototype={addChild:function(t,n,r){var i=this._parentLookup.get(t);if(i){var s;(s=i).children||(s.children=[]),this.options.addPaths||r&&"noChildComputed"===r.mode||(i.childComputed=!0);var o=e.clone(n);i.children.push(o),this.options.expandAll&&(o.childComputed=!0);var a,d,l=this._arraysOfReferences.get(o.resourceid);l||(l=[]),l.push(o),l.length>1?this._correctionList.push(o.resourceid):(a=this._orderList,d=i,-1===a.indexOf(d)&&a.push(d)),this._arraysOfReferences.set(o.resourceid,l),this._parentLookup.set(o.resourceid,o)}else console.warn("LoadModelBuilder.addChild unknown parent")},addReference:function(e){this._parentLookup.set(e.resourceid,e)},getReference:function(e){return this._parentLookup.get(e)},getOptions:function(t,n){if(t&&n){let r=this._arraysOfReferences.get(t);if(!r)return e.clone(this._parentLookup.get(t));{let e=r.filter(function(e){return e.relationid===n});if(e.length)return e[0]}}else if(t)return this._parentLookup.get(t)},correct:function(e){r.addOrGetSection("parser");if(!this.options.isRefresh)for(let e=0;e<this._orderList.length;e++){var i=this._orderList[e];i.children.length>1&&(i.children=a(i.children))}if(this.options.expandIds){let e=s.create("sortHierarchy",{stats:!0});c(this.options.expandIds,this._correctionList,this._parentLookup),e.end()}let o=s.create("copyInstances",{stats:!0}),p=[];for(let t=0;t<this._correctionList.length;t++){let n=this._correctionList[t],r=this._arraysOfReferences.get(n),i=l(r);for(var u=0;u<r.length;u++){let t=r[u];i&&(t.children=e.assignClone(i),p.push(t))}}o.end();let h=s.create("correctThumbnail",{stats:!0}),f=this.options;n.iterateMap(this._arraysOfReferences,function(e){n.iterate(e,function(e){if(d(e,f),e.children&&1===e.children.length){var n=e.children[0];n.globaltype===t.GLOBALTYPE_DOC&&(e.grid.thumbnail=n.grid.thumbnail)}})}),h.end();let g=s.create("recheck",{stats:!0});n.iterate(p,function(e){!function e(t,r){d(t,r),t.children&&n.iterate(t.children,function(t){e(t,r)})}(e,f)}),g.end()},correctPgpOcc:function(e,t){for(let s of t.keys()){let o=this._parentLookup.get(s[0]);for(var n=0;n<s.length;n+=2)if(o.children)for(var r=0;r<o.children.length;r++)if(o.children[r].relationid===s[n+1]){o=o.children[r];break}o.isPADHidden&&o.isHiddenStateFrom===i.FROMS.PGP||(o.isPADHidden=t.get(s),i.defaultHiddenState(o)),o.isHiddenState===i.STATES.HIDDEN&&(e.isHiddenState=!0)}}},p}),define("DS/ENOXParser/ParserCV",["DS/ENOXParser/modules/mixins/parser/ParseAttributes","DS/ENOXParser/modules/mixins/parser/MergeObj","DS/PADServices/utils/Meas","DS/PADServices/utils/HideShowCtrl","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/DictionaryAccess","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n,r,i,s,o,a){"use strict";function d(){return"object"==typeof d.instance?d.instance:(d.instance=this,this)}function l(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function c(e,t,n,i){e[i].length&&(console.log(` -- Process PGP ${i.charAt(0).toUpperCase()+i.slice(1)} ${e[i].length} paths`),t.start("parseExpOcc-pgpHS",{stats:!0}),r.setPGPs(n,e[i]),t.end("parseExpOcc-pgpHS"))}function p(e,t){const n=e.options.occPath.slice(),r=t.slice(),i=n.slice(0,r.length).join("/"),s=r.join("/");return s.length===i.length&&i===s}d.prototype=Object.assign(d.prototype,e.prototype),d.prototype=Object.assign(d.prototype,t.prototype);const u={COLLAPSED:{state:"collapsed"},EXPANDED:{state:"expanded"}};function h(e,t,n){if(e.hasChildren()){let r=-1===t||t>n+1;if(function(e){let t=e.getChildren();return t&&1===t.length&&t[0].options.globaltype===f}(e))e.setState(u.COLLAPSED);else if(e.setState(u.EXPANDED),r){let r=n+1,i=e.getChildren();for(let e=0;e<i.length;e++){h(i[e],t,r)}}}else e.setState(u.COLLAPSED)}d.prototype.parseExpandOcc=async function(e){return new Promise(t=>{const s=n.addOrGetSection("parseExpandOcc"),d=o.getSetting("grpBSD"),u=e.expandedNodes.filter(e=>e.hasChildren());let f=e.treeDoc,D=e.wsResponse,m=e.state||"expanded",S=e.nodeModelClass,b=this.__parseResp(D,e.isFindInCtx,e.selectPaths),P=b.mapNodes,v=b.paths,N=b.pathsToSelect,O={show:[],hide:[],others:[]};f.prepareUpdate(),console.groupCollapsed(`ParserCV::parseExpandOcc# Nb Nodes: ${P.size} nbPaths: ${v.length}`),s.start("parseExpOcc-buildModel",{stats:!0});let A=(t,n)=>{let s=t[n],a=this.assignClone(P.get(s)),d=a;if(n-1>0){let e=t[n-1],r=this.assignClone(P.get(e));d=this.smartAssign(a,r)}return d.occPath=t,this.__managePGP(d,b.pgp,O),!function(e,t){let n=!1;const i=r.getHiddenPathsAsArray();for(let r=0;r<i.length;r++){let s=i[r];if(-1!==t&&(s=i[r].slice(0,e.length)),l(s,e)){n=!0;break}}return n}(t,e.expandLevel)?r.defaultHiddenState(d):(d.isPADHidden=!0,d.isHiddenPathFromWidgetLink=!0),o.getSetting("redirectQueryToSGI")&&"ds6w:Document"===d.globaltype&&"3DShape"===d.type&&(null===d.children&&(d.children=[]),d.isIFCShape=!0,d.icons=[...d.icons,{iconPath:`url(${i.getWebappsAssetUrl("ENXNav","icons/32/I_IFC_shape.png")})`}]),d};function E(t,n){if(t.isRoot()||!0===d&&!0===t.getReferenceValue("groupApplied")){let r=f.getGroupForNode({node:t,child:n,state:!0===e.isFindInCtx?"partiallyExpanded":"expanded"});r&&(t=r)}if(t.hasChildren()){let e=t.getChildren();if(-1===n.options.relationOrder){let r=1,i=e[0];for(;!0===i.options.isGroupingNode&&r<e.length;)i=e[r],r++;r===e.length?t.addChild(n):t.insertBefore(n,i)}else for(let r=e.length-1;r>=0;r--){if(e[r].options.relationOrder>n.options.relationOrder){if(r-1>=0&&e[r-1].options.relationOrder>n.options.relationOrder)continue;t.insertBefore(n,e[r])}else t.addChild(n);break}}else t.addChild(n);t.setState({state:m}),"expanded"===m&&!0!==t.isRoot()&&(t.hasChildren()?t.getChildren().filter(e=>"partiallyExpanded"===e.getState()).length>0&&t.getParent().setState({state:"partiallyExpanded"}):t.getParent().setState({state:"expanded"})),t.options.padstate=m,"expanded"===m&&(t.options.childComputed=!0)}let _=[];const x=Date.now();for(let t=0;t<v.length;t++){let n=v[t],r=void 0;for(let t=n.length-1;t>=0;t-=2){let i=n.slice(0,t+1),s=f.getNodeFromPath(i);if(s){if(!0===s.options.waiting4validation||!0===e.isFindInCtx){let n=A(i,t);if(n.waiting4validation=void 0,delete n.children,s.isRoot()&&s.options.filtered&&(n.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}}),s.updateOptions(n),n.isHiddenPathFromWidgetLink&&(delete n.isHiddenPathFromWidgetLink,g([i],f)),!0!==s.isRoot()){const e=s.options.occPath.join("/");-1===_.indexOf(e)&&_.push(e)}if(!1===s.isVisible()&&!0===e.isFindInCtx)for(var w=s;w&&!w.isRoot();)(w=w.getParent()).isExpanded()||w.setState({state:"partiallyExpanded"});if(r&&p(r,i)){E(s,r),r=s;continue}}else r?E(s,r):s.hasChildren()&&"collapsed"===s.getState()&&s.getDepth()>s.getDepth()+e.expandLevel&&(s.setState({state:m}),s.options.padstate=m);break}{const n=new S(A(i,t));r&&(E(n,r),"ds6w:Document"!==r.options.globaltype||!0===e.isFindInCtx?(n.setState({state:m}),n.options.padstate=m):"ds6w:Document"===r.options.globaltype&&n.options.children&&1===n.options.children.length&&e.expandLevel&&1!==e.expandLevel&&(n.setState({state:"collapsed"}),n.options.padstate="collapsed"),"expanded"===m&&(n.options.childComputed=!0)),!0===n.isSupplemental()&&(n.options.children=[],n.options.padstate="collapsed",n.setState({state:"collapsed"})),r=n}}}const C=Date.now()-x;console.log(` -- Duration loop on path: ${C}`),function(e,t,n){if(e.length){t.start("parseExpOcc-reorder",{stats:!0});for(let t=0;t<e.length;t++){const r=n.getNodeFromPath(e[t].split("/")),i=r.options.relationOrder;let s,o=r.getPreviousBrother(),a=!1;for(;o&&o.options.relationOrder>i;)o=(s=o).getPreviousBrother();if(!s){let e=r.getNextBrother();for(;e&&e.options.relationOrder<i;)(s=e.getNextBrother())||(a=!0),e=e.getNextBrother()}let d=!1;if(!s&&!a){const e=r.getParent();e&&e.options.relationOrder>i&&(d=!0)}s?(console.log(`Node: ${r.getLabel()} should be inserted before ${s.getLabel()}`),r.getParent().insertBefore(r,s)):!0===a?(console.log(`Node: ${r.getLabel()} added at the end`),r.getParent().addChild(r)):!0===d?console.log(`Node: ${r.getLabel()} `):console.log("No modification for "+r.getLabel())}t.end("parseExpOcc-reorder")}}(_,s,f),function(e,t,n){if(e&&e.length>0){console.group(` -- Select the ${e.length} paths during find in ctx`);for(let r=0;r<e.length;r++){let i=t.getNodeFromPath(e[r]);i?(i.select(),i.hasChildren()&&i.setState({state:n})):console.log("Unknown path:"+e[r].join("/"))}console.groupEnd()}}(N,f,m),function(e,t,n){for(let r of["others","hide","show"])c(e,t,n,r)}(O,s,f),e.isFindInCtx||function(e,t){if(e.length)for(let n=0;n<e.length;n++)h(e[n],t,0)}(u,e.expandLevel),f.pushUpdate(),s.end("parseExpOcc-buildModel"),s.dump("parseExpOcc-buildModel"),console.groupEnd(),a.publish({event:"ENXModel/Expand/parseDone"}),t()})};const f="ds6w:Document";function g(e,t){for(const n of e){const e=t.getNodeFromPath(n);if(!e)continue;const i=r.__gatherParentList(e);if(i)for(const e of i)r.__calculateParentState(e)}}function D(e,t){let n=[];if(Array.isArray(e[t]))for(let r=0;r<e[t].length;r++)n.push(e[t][r].join("/"));return n}function m(e,t){if(0!==e.others.length)for(let n=0;n<e.others.length;n++)if(e.others[n].join("/")===t.occPath.join("/")){e.others.splice(n,1);break}}function S(e,t,n,i){let s;s=i?n.hide:n.show;for(let o=0;o<e.length;o++)if(-1!==t.occPath.join("/").indexOf(e[o])){const a=e[o].split("/");if(a[a.length-1]===t.resourceid){t.isPADHiddenOccurrence=i,i||(t.isPADHiddenInstance=!1,t.isPADHiddenReference=!1),t.isHiddenStateFrom=r.FROM.PGP,s.push(t.occPath),m(n,t);break}}}d.prototype.parsePathsOcc=async function(e){var t=n.addOrGetSection("parsePathsOcc");let i=e.treeDoc,a=e.wsResponse,d=e.state?e.state:"partiallyExpanded",l=e.nodeModelClass,c=this.__parseResp(a),p={show:[],hide:[],others:[]};console.groupCollapsed(`ParserCV::parseExpandOcc# Nb Nodes: ${c.mapNodes.size} nbPaths: ${c.paths.length}`),i.prepareUpdate(),t.start("parsePathsOcc-buildModel",{stats:!0});let u=(e,t)=>{let n=e[t],r=this.assignClone(c.mapNodes.get(n)),i=r;if(t-1>0){let n=e[t-1],s=this.assignClone(c.mapNodes.get(n));i=this.smartAssign(r,s)}return i.occPath=e,this.__managePGP(i,c.pgp,p),i},h=[],g=[];const D=o.getSetting("grpBSD"),m=Date.now();for(let e=0;e<c.paths.length;e++){let t=c.paths[e],n=void 0,r=!1;for(let e=t.length-1;e>=0;e-=2){let o=t.slice(0,e+1),a=i.getNodeFromPath(o);if(a){if(!0!==a.options.waiting4validation){if(n){let e=new l(n);if((a.isRoot()||!0===D&&!0===a.getReferenceValue("groupApplied"))&&i.isGroupingApplied()){let t=i.getGroupForNode({node:a,child:e});t&&(a=t)}if(a.hasChildren()){let t=a.getChildren();if(-1===n.relationOrder)a.insertBefore(e,t[0]);else for(let r=t.length-1;r>=0;r--){if(t[r].options.relationOrder>n.relationOrder){if(r-1>=0&&t[r-1].options.relationOrder>n.relationOrder)continue;a.insertBefore(e,t[r])}else a.addChild(e);break}}else a.addChild(e);r=!0}else a.hasChildren()&&"collapsed"===a.getState()&&(a.setState({state:d}),a.updateOptions({padstate:d}));break}{let t=u(o,e);if(t.waiting4validation=void 0,t.icons||(t.icons=[]),delete t.children,a.updateOptions(t),!0!==a.isRoot()){let e=a.options.occPath.join("/");-1===h.indexOf(e)&&h.push(e)}a.options.globaltype===f&&(a.options.children=null,a.setState({state:"noChildren"})),s.updateNLS(a)}}else{let t=u(o,e);if(n){if(t.expandedState=d,t.padstate=d,0===t.children.length||-1!==n.relationOrder||t.children[t.children.length-1].relationOrder<n.relationOrder)t.children.push(n);else for(let e=t.children.length-1;e>=0;e--)if(t.children[e].relationOrder<n.relationOrder){t.children.splice(e+1,0,n);break}"expanded"===d&&(t.childComputed=!0)}n=t}}!1===r&&n&&(i.addRoot(n),g.push(n.resourceid))}const S=Date.now()-m;if(console.log(` -- Duration loop on path: ${S}`),p.length&&(console.log(` -- Process PGP Hide/Show on ${p.length} paths`),t.start("parseExpOcc-pgpHS",{stats:!0}),r.setPGPs(i,p),t.end("parseExpOcc-pgpHS")),h.length){t.start("parseExpOcc-reorder",{stats:!0});for(let e=0;e<h.length;e++){let t,n=i.getNodeFromPath(h[e].split("/")),r=n.options.relationOrder,s=n.getPreviousBrother(),o=!1;for(;s&&s.options.relationOrder>r;)s=(t=s).getPreviousBrother();if(!t){let e=n.getNextBrother();for(;e&&e.options.relationOrder<r;)(t=e.getNextBrother())||(o=!0),e=e.getNextBrother()}t?n.getParent().insertBefore(n,t):!0===o&&n.getParent().addChild(n)}t.end("parseExpOcc-reorder")}return t.end("parsePathsOcc-buildModel"),t.dump("parsePathsOcc-buildModel"),i.pushUpdate(),console.groupEnd(),{rootIds:g,treatedPaths:c.paths}},d.prototype.parseRefreshOcc=async function(e){let t=n.addOrGetSection("parseRefreshOcc"),i=e.treeDoc,o=e.wsResponse;t.start("parseRefreshOcc-buildModel",{stats:!0});let d=this.__parseResp(o),l=d.mapNodes,c=d.paths,p=[],u={show:[],hide:[],others:[]};if(console.groupCollapsed("ParserCV::parseRefreshOcc# Nb Nodes: "+d.mapNodes.size),i.prepareUpdate(),c.length){let e=Date.now(),t=[];console.log(" -- Nb Nodes: "+d.mapNodes.size),console.log(" -- Nb Paths: "+d.paths.length);for(let e=0;e<d.paths.length;e++){let n=d.paths[e];for(let e=n.length-1;e>=0;e-=2){let o=n.slice(0,e+1);p.push(o.join("/"));let a=i.getNodeFromPath(o);if(a){let n=a.options.occPath?a.options.occPath:a.getOccurencePath();if(-1===t.indexOf(n.join("/"))){t.push(n.join("/"));let i=o[e],l=this.assignClone(d.mapNodes.get(i)),c=l;if(e-1>0){let t=o[e-1],n=this.assignClone(d.mapNodes.get(t));c=this.smartAssign(l,n)}c.icons||(c.icons=[]),c.occPath=o,this.__managePGP(c,d.pgp,u),r.defaultHiddenState(c),delete c.children,a.isRoot()&&a.options.filtered&&(c.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}});let p=!1;"ds6w:Part"===c.globaltype&&null===a.options.children&&(c.children=[],p=!0),a.updateOptions(c),p&&(delete a.options.childComputed,a.setState({state:"collapsed"})),s.updateNLS(a)}}}if(r.__clearHiddenState(),u.show.length||u.hide.length||u.others)for(let e of["others","hide","show"])g(u[e],i)}const n=Date.now()-e;console.log(" -- Treated Occs: "+t.length),console.log(" -- Duration loop on path: "+n)}else for(let e of l.values()){let t=i.getNodeFromPath([e.resourceid]);t?(t.isRoot()&&t.options.filtered&&(e.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}}),t.updateOptions(e),p.push(t.getID())):console.log("Unknown root "+e.label)}if(u.show.length||u.hide.length||u.others.length)for(let e of["others","hide","show"])console.log(` -- Process PGP ${e.charAt(0).toUpperCase()+e.slice(1)} ${u[e].length} paths`),t.start("parseExpOcc-pgpHS",{stats:!0}),r.setPGPs(i,u[e]),t.end("parseExpOcc-pgpHS");return i.pushUpdate(),t.end("parseRefreshOcc-buildModel"),a.publish({event:"ENXModel/Expand/parseDone"}),console.groupEnd(),{refreshPaths:p}},d.prototype.parseAddOcc=async function(e){let t=n.addOrGetSection("parseAddOcc"),r=e.treeDoc,i=e.wsResponse;t.start("parseAddOcc-buildModel",{stats:!0});let s=this.__parseResp(i),o=s.mapNodes;console.groupCollapsed("ParserCV::parseAddOcc# Nb Nodes: "+s.mapNodes.size);for(let e of o.values())e.children=[],r.addRoot(e);r.prepareUpdate(),t.end("parseAddOcc-buildModel"),console.log(s),r.pushUpdate(),console.groupEnd()},d.prototype.insertTempPaths=async function(e){let t=n.addOrGetSection("insertTempPaths");const r=o.getSetting("grpBSD");let i=e.treeDoc,s=e.paths,a=e.nls,d=e.state,l=e.nodeModelClass,c=[];i.prepareUpdate(),t.start("insertTempPaths-buildModel",{stats:!0});const p={resourceid:null,relationid:null,label:a.loadingText,icons:[{iconPath:b.loadingicon}],thumbnail:b.loadingthumbnail,alternText:a.loadingText,waiting4validation:!0,children:[]},u=Date.now();for(let e=0;e<s.length;e++){let t=s[e],n=void 0,o=!1;for(let e=t.length-1;e>=0;e-=2){let s=t.slice(0,e+1),a=i.getNodeFromPath(s);if(a){if(n){if(a.isRoot()||!0===r&&!0===a.getReferenceValue("groupApplied")){let e=i.getGroupForNode({node:a,child:n,state:d});e&&(a=e)}a.addChild(n),"collapsed"!==d&&(a.setState({state:d}),a.updateOptions({padstate:d}))}o=!0;break}{let t=s[e],r=this.assignClone(p);if(r.resourceid=t,e-1>0){let t=s[e-1];r.relationid=t}r.occPath=s;let i=new l(r);n&&(i.addChild(n),"collapsed"!==d&&(i.setState({state:d}),i.updateOptions({padstate:d}))),n=i}}!1===o&&n&&(i.addRoot(n),c.push(n.resourceid))}const h=Date.now()-u;return console.log(" -- Duration loop on path: "+h),t.end("insertTempPaths-buildModel"),i.pushUpdate(),console.groupEnd(),{rootIds:c}},d.prototype.__parseResp=function(e,t,r){let i=n.addOrGetSection("parsePathsOcc");var s=new Map,o=[],a=[],d=!1,l=[],c=[];i.start("parseExpOcc-parseResp",{stats:!0});let p=null;for(let n=0;n<e.results.length;n++){let i=e.results[n];if(i.Path){if(p=null,o.push(i.Path),(!0===t||!0===r)&&(a.push(i.Path),i.matching_lengths))for(let e=0;e<i.matching_lengths.length;e++){const t=i.Path.slice(0,i.matching_lengths[e]);a.push(t)}}else if(i.Delta){let e=parseInt(i.Delta[0],10),n=i.Delta.slice(1);if(e>0&&p){n=p.slice(0,e).concat(n)}if(p=n,o.push(n),(!0===t||!0===r)&&(a.push(n),i.matching_lengths))for(let e=0;e<i.matching_lengths.length;e++){let t=n.slice(0,i.matching_lengths[e]);a.push(t)}}else if(i.attributes){p=null;let e=this.parseAttributes(i.attributes);s.set(e.resourceid,e)}else if(i.pgp_output)p=null,d=!0,console.log(" -- PGP in response"),l=D(i.pgp_output,"pgp_hide"),c=D(i.pgp_output,"pgp_show");else{if(i.synthesis)continue;{p=null;const e=!(!i.from||!i.to)||void 0,t=this.parseNodeOptions({node:i},e);!0===e?s.set(t.relationid,t):t.resourceid&&s.set(t.resourceid,t)}}}return i.end("parseExpOcc-parseResp"),{mapNodes:s,paths:o,pathsToSelect:a,pgp:!0===d?{pgpHide:l,pgpShow:c}:void 0}},d.prototype.__managePGP=function(e,t,n){void 0!==e.isPADHiddenInstance||void 0!==e.isPADHiddenReference?(e.isHiddenStateFrom=r.FROM.PGP,n.others.push(e.occPath)):e.isPADHidden=!1,t&&(t.pgpHide&&t.pgpHide.length&&S(t.pgpHide,e,n,!0),t.pgpShow&&t.pgpShow.length&&S(t.pgpShow,e,n,!1))};const b={loadingicon:`url(${i.getWebappsAssetUrl("ENOXParser","icons/32/loading22x22.gif")})`,loadingthumbnail:i.getWebappsAssetUrl("ENOXParser","icons/32/loading.gif")};return new d}),define("DS/ENOXParser/modules/PADParserOcc",["DS/ENOXParser/ParserCV","DS/PADServices/utils/Meas","DS/PADServices/utils/HideShowCtrl","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/DictionaryAccess","DS/ENOXParser/modules/common/Constants","DS/PADUtils/PADPredicatesNls"],function(e,t,n,r,i,s,o,a){"use strict";const d={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}},l=function(e,t){return e.relationOrder-t.relationOrder};function c(e){if(e.hasChildren()){let t=e.getChildren();if(t.length>1){let e=t.map(e=>e.options.globaltype);return!(!e.includes("ds6w:Document")||!e.includes("ds6w:Part"))}return!1}return!1}function p(e,t){let n=t.length;if(n===e.length){for(let r=0;r<n;r++){if(e[r]!==t[r])return!0}return!1}}function u(e,t){for(const r of e){const e=t.getNodeFromPath(r);if(!e)continue;const i=n.__gatherParentList(e);if(i)for(const e of i)n.__calculateParentState(e)}}function h(){}let f;return h.prototype={expandWithSort:function(t){let n=this;return new Promise((r,i)=>{e.parseExpandOcc(t).then(()=>{n._postSortSameAsNative({expandedNodes:t.expandedNodes}),r()})})},_postSortSameAsNative:function(e){let t=e.expandedNodes;for(let e=0;e<t.length;e++){let n=t[e],r=n.search({match:function(e){return c(e.nodeModel)},useTransaction:!1});c(n)&&r.push(n),r.length&&r.sort((e,t)=>t.getDepth()-e.getDepth());for(let e=0;e<r.length;e++){let t=r[e],n=t.getChildren(),i=n.map(e=>{let t=e.options;return{globalType:t.globaltype,relationOrder:t.relationOrder,child:e}}),s=i.filter(e=>"ds6w:Document"===e.globalType||"ds6w:Instance"===e.globalType),o=i.filter(e=>"ds6w:Part"===e.globalType),a=i.filter(e=>!o.includes(e)&&!s.includes(e));s.length>1&&s.sort(l),o.length>1&&o.sort(l),a.length>1&&a.sort(l);let d=[];if((d=(d=(d=d.concat(s)).concat(o)).concat(a)).length){let e=d.map(e=>e.child);if(p(e,n)){let n=t.getState();t.removeChildren();for(let n=0;n<e.length;n++)t.addChild(e[n]);t.setState({state:n})}}}}},parseUpdateInstance:function(e){var t=[];e.treeDoc.withTransactionUpdate(function(){e.results.forEach(function(n){var r=n.relationid;e.newRelIds&&-1!==e.newRelIds.indexOf(r)&&e.treeDoc.getRoots().forEach(function(e){var i=e.getNodesByRelId(r);i.length&&i.forEach(function(e){var r=n,i=e.getLabel();r&&"VPMInstance"===r.type&&delete r.type,r.display=i,r.label=i,r.instanceMatrix&&(r.relationid=resourceid,r.grid.instanceMatrix=r.instanceMatrix);var s=e.getState();e.updateOptions(r),a.updateNLS(e),s===d.EXPANDED&&e.setState({state:d.PARTIALLY_EXPANDED}),t.push(e)})})})}),e.editCfg?e.treeDoc.refreshCfgValues({relids:e.newRelIds}):t.length&&e.treeDoc.fillAttributesAsync4VisibleNodes(t)},refreshWithInserts:async function(r){let a=t.addOrGetSection("parseRefreshOcc"),d=r.treeDoc,l=r.wsResponse;a.start("refreshWithInserts-buildModel",{stats:!0});let c=e.__parseResp(l),p=c.mapNodes,h=c.paths,f=[],g={show:[],hide:[],others:[]};if(console.groupCollapsed("PADParserOcc::refreshWithInserts# Nb Nodes: "+c.mapNodes.size),h.length){let t=Date.now(),r=[];for(let t=0;t<c.paths.length;t++){let i=c.paths[t];for(let t=i.length-1;t>=0;t-=2){let a=i.slice(0,t+1);f.push(a.join("/"));let l=d.getNodeFromPath(a);if(l){let i=l.options.occPath?l.options.occPath:l.getOccurencePath();if(-1===r.indexOf(i.join("/"))){r.push(i.join("/"));let o=a[t],d=e.assignClone(c.mapNodes.get(o)),p=d;if(t-1>0){let n=a[t-1],r=e.assignClone(c.mapNodes.get(n));p=e.smartAssign(d,r)}p.icons||(p.icons=[]),p.occPath=a,e.__managePGP(p,c.pgp,g),n.defaultHiddenState(p),delete p.children,l.isRoot()&&l.options.filtered&&(p.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}});let u=!1;"ds6w:Part"===p.globaltype&&null===l.options.children&&(p.children=[],u=!0),l.updateOptions(p),u&&(delete l.options.childComputed,l.setState({state:"collapsed"})),s.updateNLS(l)}}else{let t=a.length,n=t-1,r=a.slice(0,t-2),i=d.getNodeFromPath(r);if(i){let t=a[n],r=e.assignClone(c.mapNodes.get(t)),s=r;if(n-1>0){let t=a[n-1],i=e.assignClone(c.mapNodes.get(t));s=e.smartAssign(r,i)}i.addChild(s)}else{let t=[],n=a;for(t.push(n);1!==n.length;){let e=n.slice(0,n.length-2);t.push(e),n=e}t.sort((e,t)=>e.length<t.length?-1:e.length>t.length?1:void 0);let r,i=t.map(t=>{let n=d.getNodeFromPath(t),r=t[t.length-1],i=e.assignClone(c.mapNodes.get(r)),s=i;if(1!==t.length){let n=t[t.length-2],r=e.assignClone(c.mapNodes.get(n));s=e.smartAssign(i,r)}return{node:n,mergedOpts:s,hasNode:void 0!==n,path:t}}),s=[],l=i.length,p=l-1;for(let e=0;e<l;e++){let t=i[e];t.hasNode?(r=t.node,delete t.mergedOpts.children,r.updateOptions(t.mergedOpts)):(delete t.mergedOpts.children,t.mergedOpts.expandedState=o.NODE_STATES.COLLAPSED.state,e===p&&(t.mergedOpts.children=[]),s.push(r),r=r.addChild(t.mergedOpts))}s.map(e=>{e.isExpanded()||e.setState(o.NODE_STATES.COLLAPSED)})}}}if(n.__clearHiddenState(),g.show.length||g.hide.length||g.others)for(let e of["others","hide","show"])u(g[e],d)}const i=Date.now()-t;console.log(" -- Duration loop on path: "+i)}else for(let e of p.values()){let t=d.getNodeFromPath([e.resourceid]);t?(t.isRoot()&&t.options.filtered&&(e.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}}),t.updateOptions(e),f.push(t.getID())):console.log("Unknown root "+e.label)}if(d.prepareUpdate(),g.show.length||g.hide.length||g.others.length)for(let e of["others","hide","show"])console.log(` -- Process PGP ${e.charAt(0).toUpperCase()+e.slice(1)} ${g[e].length} paths`),a.start("parseExpOcc-pgpHS",{stats:!0}),n.setPGPs(d,g[e]),a.end("parseExpOcc-pgpHS");return d.pushUpdate(),a.end("refreshWithInserts-buildModel"),i.publish({event:"ENXModel/Expand/parseDone"}),console.groupEnd(),{refreshPaths:f}}},h.prototype=Object.assign(h.prototype,e),f||(f=new h)}),define("DS/ENOXParser/modules/mixins/parser/ExpandV2LoadModel",["DS/ENOXParser/modules/common/LoadModelBuilder","DS/ENOXParser/modules/common/OfwBuilder","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/HideShowController","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/IconMgt","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Timeout","DS/PADServices/utils/DictionaryAccess","DS/PADServices/settings/AppSettings","DS/PADServices/utils/Iterator","DS/PADServices/utils/Generics","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt"],function(e,t,n,r,i,s,o,a,d,l,c,p,u,h,f,g){const D={loadingicon:"url("+i.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")",loadingthumbnail:i.getWebappsAssetUrl("ENXNav","icons/32/loading.gif")},m={timeoutObj:new a(void 0)};function S(e,t,n){var r=e.getNodesById(t.resourceid);if(r){for(let e=0;e<r.length;e++){let n=r[e],i=o.node.extractResAndRel(n);t.resourceid===i.resid&&t.relationid===i.relid&&(n.updateOptions(t),d.updateNLS(n),delete n.options.waiting4validation)}return r}if(n){let e=n.addChild(t);d.updateNLS(e)}else console.error("we could not find node and we are supposed to create child.")}function b(e){let t=e.getParent();for(;t&&!t.isRoot();)t.setState(n.NODE_STATES.PARTIALLY_EXPANDED),t=t.getParent()}function P(e,t){-1===e.indexOf(t)&&e.push(t)}function v(e,t,r){let i=function(e,t,r){let i=t.getDepth(),s=e.search({match:function(e){let t=e.nodeModel,s=t.getState(),o=t.getDepth(),a=o>=i&&o-i<=r;return s===n.NODE_STATES.PARTIALLY_EXPANDED.state&&a},useTransaction:!1});return{startDepth:i,matched:s}}(e,t,r);c.iterate(i.matched,function(e){(e.getDepth()-i.startDepth!==r||e.hasChildren())&&e.hasChildren()?e.setState(n.NODE_STATES.EXPANDED):e.setState(n.NODE_STATES.COLLAPSED)})}const N=function(e,t){return e.originalIndex-t.originalIndex};function O(){this._list=[],this._dict={},this._cleanup=[]}function A(e,t){let r=e.getTreeDocument(),i=e.getChildren(),s=i?i.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode}):[],o=s.slice();if(o.length){let i=s.filter(function(e){return-1===o.indexOf(e)}),a=[],d=new O;c.iterate(o,function(e){let r=e.getID(),i=e.getRelationID()?e.getRelationID():void 0;t.children&&c.iterate(t.children,function(t,s){t.resourceid===r&&t.relationid===i?(a.push(s),t.children&&t.children.length&&(e.hasChildren()?function e(t,n){let r=n.getChildren();r||(r=[]);let i=r.map(function(e){let t=e.getID(),n=e.getRelationID();return n||(n=void 0),{resid:t,relid:n,node:e}});c.iterate(t.children,function(t){let r=function(e,t){let n=null;for(let r=0;r<e.length;r++){let i=e[r];if(i.resid===t.resourceid&&i.relid===t.relationid){n=i;break}}return n}(i,t);r?e(t,r.node):n.addChild(t)})}(t,e):(e.addChild(t.children),e.setState(n.NODE_STATES.EXPANDED)))):a.length?d.addAfter(t,e.getParent(),e,s):d.addBefore(t,e.getParent(),e,s)}),d.cleanup(t.children,a),c.iterate(a,function(e){t.children.splice(e,1)}),a.length=0}),c.iterate(i,function(t){e.removeChild(t)}),d.dispatch(r)}else for(var a=0;a<s.length;a++){let t=s[a];e.removeChild(t)}}function E(e,t){let r=e.getState();if(!0===e.options.retrievedFromFocus?(delete e.options.retrievedFromFocus,"expanding"===e.getState()&&e.setState(n.NODE_STATES.EXPANDED)):r!==t.expandedState&&e.setState({state:t.expandedState}),e.hasChildren()){let n=e.getChildren();n&&c.iterate(n,function(e){let n=e.getID(),r=e.getRelationID();r||(r=void 0);let i=function(e,t,n){let r;return c.iterate(e.children,function(e){e.resourceid===t&&e.relationid===n&&(r=e)}),r}(t,n,r);i&&E(e,i)})}}function _(e,t,r){e.expandedState=t>r?n.NODE_STATES.EXPANDED.state:n.NODE_STATES.COLLAPSED.state,e.children&&c.iterate(e.children,function(e){_(e,t,r+1)})}function x(e){var t=e.getChildren();for(t=t||[];t.length;){let n=t[0];e.removeChild(n)}}function w(e,t){let n;for(let r=0;r<e.length;r++){if(n=e[r].getNodeByPath(t,void 0,void 0,!0))return n}return n}function C(e){return{typeMap:[],typeMapThumbs:[],sampleRscId:[],thumbsRscId:[],timeoutObj:e}}function y(e){let t=e.getChildren();return(t?t.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode}):[]).length>0}function I(e,t,n){let r;for(let i=0;i<e.length;i++){let s=e[i];if(s.getID()===t&&s.getRelationID()===n){r=s;break}}return r?{isFound:!0,node:r,index:e.indexOf(r)}:{isFound:!1}}function R(){}return O.prototype={_add:function(e,t,n,r,i){let s=this._getKeyFromData(e);if(void 0!==this._dict[s]){let e=this._dict[s],t=this._list[e];"before"===i&&(t.goal=i,t.originalIndex=r,t.siblingChild=n)}else{let o={goal:i,originalIndex:r,parentNode:t,siblingChild:n,childData:e};this._list.push(o),this._dict[s]=this._list.length-1}},_getKeyFromData:function(e){let t,n=e.resourceid,r=e.relationid;return r?t=n+"_"+r:(r=void 0,t=n),t},addBefore:function(e,t,n,r){this._add(e,t,n,r,"before")},addAfter:function(e,t,n,r){this._add(e,t,n,r,"after")},cleanup:function(e,t){let n=t.map(function(t){return e[t]}),r=this;this._cleanup=this._cleanup.concat(n.map(function(e){let t=r._getKeyFromData(e),n=r._dict[t];return void 0!==n?{found:!0,index:n,key:t}:{found:!1}}))},dispatch:function(e){let t=this._cleanup.filter(function(e){return e.found});if(t.length){let e=this;t.sort(function(e,t){return t.index-e.index}),c.iterate(t,function(t){e._list.splice(t.index,1),delete e._dict[t.key]})}if(this._list.length){let t=o.divideAndConquer(this._list,m,{befores:function(e){return"before"===e.goal},afters:function(e){return"after"===e.goal}});t.befores.sort(N),t.afters.sort(N),c.iterate(t.befores,function(t){let n=t.childData,r=t.siblingChild._getLocalID();e.withTransactionUpdate(function(){t.parentNode.addChild(n,r)})}),c.iterate(t.afters,function(t){let n=t.childData;e.withTransactionUpdate(function(){t.parentNode.addChild(n)})})}}},R.prototype={parseExpandLoadModel:function(t){let i=u.buildOrGetSection("parser.expandLoadModel"),D="parseExpandLoadModel_"+(-1===t.expandLevel?"expandAll":"expand"+t.expandLevel),m=i.create(D,{stats:!0}),S=this;return new Promise(function(u,D){let P,N=new Map,O=new Map,R=t.expandedNode,T=t.wsResponse.results,L=t.treeDoc.isGroupingApplied(),M=[],k=(M=R?[R]:t.expandedNodes).filter(function(e){return!e.isGroupingNode});k.length&&(P=k.map(function(e){return e.getID()}));let H=new e({expandIds:P,expandAll:-1===t.expandLevel,findInCtx:!0===t.findInCtx||!0===t.selectFromTagger,filter:!0===t.filter}),F=l.getSetting("parse_timeout"),X=parseInt(F),B=new a(X),U=C(B);if(T){let e=o.divideAndConquer(T,U,o.MAPS.EXPANDV2),a=new Map;var G=Promise.resolve();s.isActive()&&(G=s.initializeIconMap({typeMap:U.typeMap,typeMapThumbs:U.typeMapThumbs,thumbsRscId:U.thumbsRscId,rscIds:U.sampleRscId})),G.then(function(){g.getSetting("pgpFromServer")&&c.iterate(e.pgpOutputs,function(e){B.check(),e.pgp_output.pgp_hide&&c.iterate(e.pgp_output.pgp_hide,function(e){a.set(e,!0)}),e.pgp_output.pgp_show&&c.iterate(e.pgp_output.pgp_show,function(e){a.set(e,!1)})}),c.iterate(e.references,function(e){if(B.check(),S.__processReference({node:e,nodesMap:N,builder:H}),L){var n=t.treeDoc.getGroupingNodesList(e.resourceid);c.iterate(n,function(e){S.__processGroupingNode({node:e,parent:e.getParent().getID(),nodesMap:N,builder:H})})}}),c.iterate(e.instances,function(e){B.check(),S.__processInstance({node:e,nodesMap:N,builder:H,expandLevel:t.expandLevel,mode:t.mode,pgpHideOccurrencesMap:a,treeDoc:t.treeDoc,expandedNodes:M,nodesHiddenMap:O})}),t.treeDoc.clearCachedHiddenNodes();var s=i.create("builder_Correct",{stats:!0});if(H.correct(S),H.correctPgpOcc(S,a),s.end(),c.iterate(M,function(e){let s=o.node.extractResAndRel(e);var a=H.getOptions(s.resid,s.relid);let l=!1,u=!0;a&&t.filter&&t.expandLevelRequest!==t.expandLevel?(_(a,t.expandLevelRequest,0),y(e)?(E(e,a),l=!0,A(e,a),v(t.treeDoc,e,t.expandLevel)):0!==t.expandLevelRequest&&(l=!0,function e(t,n){c.iterate(t.children,function(t){let r=n-1;0===r?t.children&&(t.children.length=0):e(t,r)})}(a,t.expandLevelRequest),e.addChild(a.children))):y(e)&&t.filter&&a&&(E(e,a),l=!0,A(e,a),v(t.treeDoc,e,t.expandLevel));let h=!1;if(a&&e.hasChildren()&&y(e)&&0!==t.expandLevel&&(!t.findInCtx&&!t.selectFromTagger&&!t.filter||L)){var g=i.create("treenodemodel_removeChildren",{stats:!0});-1!==t.expandLevel||L?(h=!0,l=!0,A(e,a),function(e,t,r){let i=function(e,t,n){let r=t.getDepth(),i=t.search({match:function(e){let t=e.nodeModel.getDepth();return t>=r&&t-r<=n},useTransaction:!1});return{startDepth:r,matched:i}}(0,t,r);c.iterate(i.matched,function(e){let t=e.getDepth()-i.startDepth;(t!==r||e.hasChildren())&&e.hasChildren()?t===r?e.setState(n.NODE_STATES.COLLAPSED):e.setState(n.NODE_STATES.EXPANDED):e.setState(n.NODE_STATES.COLLAPSED)})}(t.treeDoc,e,t.expandLevel)):(!function(e,t){let n=e.getChildren(),r=n?n.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode}):[];t.children.sort(function(e,n){let i=I(r,e.resourceid,e.relationid),s=I(r,n.resourceid,n.relationid);return i.isFound&&s.isFound?(i.dataIndex=t.children.indexOf(e),s.dataIndex=t.children.indexOf(n),i.dataIndex===i.index&&s.dataIndex===s.index?0:i.index>s.index?1:i.index<s.index?-1:void 0):0})}(e,a),x(e)),g.end()}if(e.hasChildren()&&(t.findInCtx&&t.isFindDialog||t.selectFromTagger)&&(!function e(t,n){let r=function(e){let t=e.getChildren();return t||(t=[]),t.filter(function(e,t){return!0!==e.isRelationsObjectGroupingNode})}(t).map(function(e,t){let n=e.getID(),r=e.getRelationID();return r||(r=void 0),{resid:n,relid:r,node:e,nodeIndex:t}}),i=[];n.children&&n.children.length&&(i=n.children.map(function(e,t){let n={childOpts:e,childIndex:t},i=r.filter(function(t){return t.resid===e.resourceid&&t.relid===e.relationid});return i.length&&(n.finders=i),n})),c.iterate(i,function(n){if(n.finders){if(1===n.finders.length){let t=n.finders[0],r=p.clone(n.childOpts);delete r.children,t.node.updateOptions(r),e(t.node,n.childOpts)}}else t.addChild(n.childOpts,n.childIndex)})}(e,a),l=!0),a){let i;if(l||(-1!==t.expandLevel&&t.filter&&(x(e),_(a,t.expandLevelRequest,0)),a.children&&(i=a.children,delete a.children),r.cleanupOptions(e,a),null===a.children&&function(e){let t=e.getChildren();return(t?t.filter(function(e,t){return!0===e.isRelationsObjectGroupingNode}):[]).length>0}(e)&&(u=!1,delete a.children),e.updateOptions(a)),d.updateNLS(e),e.isRoot()){!0!==t.FBIProxy.HasFilter(e.getID()).hasFilter||f.isAuthoring()&&!e.keepFilterBadge?o.node.clearBadges(e):o.node.setFilterBadge(e)}if(l){let t=e.getRoot();t&&t.cleanUpPathes()}else if(i){t.treeDoc.withTransactionUpdate(function(){t.treeDoc.loadModel(i,e),h&&v(t.treeDoc,e,t.expandLevel);let n=e.getRoot();n&&n.cleanUpPathes()})}else u&&(e.updateOptions({children:null}),e.setState(n.NODE_STATES.NOCHILDREN));if(O.size>0)for(const[e,n]of O){let r=t.treeDoc.getNodesById(e);for(let e=0;e<r.length;e++){let t=r[e];for(let e=0;e<n.length;e++)o.array.compare(t.getOccurencePath(),n[e].occurencePath)&&t.options.isHiddenState!==n[e].isHiddenState&&(t.options.isHiddenState=n[e].isHiddenState)}}if(S.isHiddenState||r.shouldeRecalculate(e)){delete S.isHiddenState;let e=[];t.treeDoc.processDescendants({processNode:function(){r.gatherParentsIfHidden(e,this)}}),r.calculateParents(e,!0)}}}),!0===t.selectPaths){var l=i.create("selectPaths",{stats:!0});c.iterate(e.paths,function(e){if(e.matching_lengths)for(let n=0;n<e.matching_lengths.length;n++){var r=e.Path.slice(0,e.matching_lengths[n]);(i=w(M,r))?(i.select(),i.isRoot()||!t.findInCtx&&!t.selectFromTagger||b(i)):console.warn("Unknown path "+JSON.stringify(r))}var i;(i=w(M,e.Path))?(i.select(),(t.findInCtx||t.selectFromTagger)&&(i.hasChildren()&&i.setState(n.NODE_STATES.PARTIALLY_EXPANDED),i.isRoot()||b(i))):console.warn("Unknown path "+JSON.stringify(e))}),l.end()}m.end(),h.publish({event:"ENXModel/Expand/parseDone"}),u()}).catch(function(e){D(e)})}})},addPathsUpdateTempNodes:function(t){let n=u.addOrGetSection("parser"),i=n.create("parseExpandLoadModel",{stats:!0}),d=this;return new Promise(function(l,p){let u=new Map,h=t.wsResponse.results,f=new e({expandAll:-1===t.expandLevel,addPaths:!0});if(t.wsResponse.timeoutOccurs)console.warn("Timeout occurs on popluating temp nodes....failure path...");else{let e=C(new a(void 0)),p=o.divideAndConquer(h,e,o.MAPS.EXPANDV2),D=new Map;var g=Promise.resolve();s.isActive()&&(g=s.initializeIconMap({typeMap:e.typeMap,typeMapThumbs:e.typeMapThumbs,thumbsRscId:e.thumbsRscId,rscIds:e.sampleRscId})),g.then(function(){c.iterate(p.references,function(e){d.__processReference({node:e,nodesMap:u,builder:f})}),c.iterate(p.instances,function(e){d.__processInstance({node:e,nodesMap:u,builder:f,expandLevel:t.expandLevel})}),n.start("builder_Correct",{stats:!0}),f.correct(d),f.correctPgpOcc(d,D),n.end("builder_Correct");let e=[],s=[];t.treeDoc.withTransactionUpdate(function(){c.iterate(t.idsToFetch,function(n){var i=n;let a=t.treeDoc.getNodesById(i);c.iterate(a,function(n){let a=o.node.extractResAndRel(n),d=f.getOptions(a.resid,a.relid);if(d){let n=d.children;delete d.children,S(t.treeDoc,d),e.push(i),n&&n.length&&c.iterate(n,function(e){let n=e.children;delete e.children;let i=S(t.treeDoc,e);c.iterate(i,function(e){r.gatherParentsIfHidden(s,e)}),n&&n.length&&c.iterate(i,function(e){!function e(t,n,r){for(let s=0;s<r.length;s++){let o=r[s];var i=o.children;delete o.children,S(t,o,n),i&&e(t,n,i)}}(t.treeDoc,e,n)})})}})}),r.calculateParents(s,!1,!0),!0===t.selectPaths&&c.iterate(p.paths,function(e){t.treeDoc.getNodeByOccurencePath(e)?e.select():console.warn("Unknown path "+JSON.stringify(e))})}),i.end(),l({nodesId:e})})}})},buildTemporaryBranches:function(e){if(!UWA.is(e.treeDoc,"object")||!UWA.is(e.paths,"array"))throw new Error("Invalid input parameters");var t=[],n=[],r=[],i=[],s=[],o=e.treeDoc,a=e.state?e.state:"partiallyExpanded",d=e.paths;let l=this;return o.withTransactionUpdate(function(){d.forEach(function(d){var c,p=null,u=o.getRoots(),h=0;for(c=0;c<u.length&&null===p;c++)if(d[0]===u[c].getID()){i.push(d[0]);var f=(p=u[c]).getNodeByPath(d,void 0,void 0,!0);f&&(p=f,h=d.indexOf(p.getID()))}if(!0===e.temporaryRoot&&null===p){var g={resourceid:d[0],label:l.options.nls.loadingText,icons:[{iconPath:D.loadingicon}],thumbnail:D.loadingthumbnail,alternText:l.options.nls.loadingText,waiting4validation:!0,parseV2:!0};p=new e.nodeModelClass(g),o.addRoot(p),-1===t.indexOf(d[0])&&t.push(d[0]);var m=o.getRoots().length;o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:m,added_node:p}})}if(p)if(p.getID()===d[d.length-1]){if(!0!==e.forceCollapsed&&null!==p.getRoot()){var S=p.reverseExpand({state:a});S.ids.length&&(t=t.concat(S.ids)),S.relids.length&&(s=s.concat(S.relids))}}else for(var b=h+1;b<d.length;b+=2){var v=d[b],N=d[b+1],O={resourceid:N,relationid:v,label:l.options.nls.loadingText,icons:[{iconPath:D.loadingicon}],thumbnail:D.loadingthumbnail,alternText:l.options.nls.loadingText,waiting4validation:!0},A=new e.nodeModelClass(O),E=p.getState();p.addChild(A),"collapsed"===E?(a!==E&&(p.setState({state:a}),p.options.padstate=a),p.childValidationChecker()):"partiallyExpanded"===E&&(p.setState({state:E}),p.options.padstate=E,P(n,N),P(r,v)),p=A,P(t,N),P(s,v)}})}),{ids_to_fetch:t,relationids:s,rootsAlreadyLoaded:i,visibleNodesIds:n,visibleNodesRelIds:r}},ofwPrep:function(e){let n=this;return new Promise(function(r,i){let s=new Map,a=e.wsResponse.results,d=new t({expandAll:-1===e.expandLevel}),l=o.divideAndConquer(a,{},o.MAPS.OFW);c.iterate(l.references,function(e){n.__processReference({node:e,nodesMap:s,builder:d})}),c.iterate(l.instances,function(t){n.__processInstanceOfw({node:t,nodesMap:s,builder:d,expandLevel:e.expandLevel})}),d.correct(n);let p=[];for(let t=0;t<e.rootIds.length;t++){let n=d.getReference(e.rootIds[t]);p.push(n)}r(p)})},refresh:function(t){let n=u.addOrGetSection("parser");n.start("refresh",{stats:!0});let i=this,d=t.roots;t.visibles;return new Promise(function(l,p){let u=new Map,h=t.wsResponse.results,D=new e({expandIds:d.map(function(e){return e.getID()}),expandAll:-1===t.expandLevel,isRefresh:!0});if(!h)return i.processErrors(t.wsResponse.errors,"refresh"),void l();let m=C(new a(void 0)),S=o.divideAndConquer(h,m,o.MAPS.EXPANDV2),b=new Map,P=[];var v=Promise.resolve();s.isActive()&&(v=s.initializeIconMap({typeMap:m.typeMap,typeMapThumbs:m.typeMapThumbs,thumbsRscId:m.thumbsRscId,rscIds:m.sampleRscId})),v.then(function(){g.getSetting("pgpFromServer")&&c.iterate(S.pgpOutputs,function(e){e.pgp_output.pgp_hide&&c.iterate(e.pgp_output.pgp_hide,function(e){b.set(e,!0)}),e.pgp_output.pgp_show&&c.iterate(e.pgp_output.pgp_show,function(e){b.set(e,!1)})}),c.iterate(S.references,function(e){i.__processReference({node:e,nodesMap:u,builder:D})}),c.iterate(S.instances,function(e){i.__processInstance({node:e,nodesMap:u,builder:D,doNotCalcByChildren:P,expandLevel:t.expandLevel})}),n.start("builder_Correct",{stats:!0}),D.correct(i),D.correctPgpOcc(i,b);for(let n=0;n<d.length;n++){let a=d[n];i.options.modules.NodeUtils.recursiveUpdateForRefresh(t.treeDoc,a,D.getReference(a.getID())),!0!==t.FBIProxy.HasFilter(a.getID()).hasFilter||f.isAuthoring()&&!a.keepFilterBadge?o.node.clearBadges(a):o.node.setFilterBadge(a);var e=[],s=[];for(let t of b.keys()){let n=a.getNodesById(t[0])[0];if(n){let r=n.getNodeByPath(t);r&&(b.get(t)?e.push(r):s.push(r))}}if(i.isHiddenState||g.getSetting("pgpFromServer")){delete i.isHiddenState,r.updateHideShowStatus(e,s);const n=function(e){return{resid:e.options.resourceid,relid:e.options.relationid}};P=P.concat(e.map(n)).concat(s.map(n));let o=[];t.treeDoc.processDescendants({processNode:function(){r.gatherParentsIfHiddenOrShown(o,this)}}),o.sort(function(e,t){return t.getDepth()-e.getDepth()});for(let e=0;e<P.length;e++){let t=P[e],n=o.filter(function(e){return e.options.resourceid===t.resid&&e.options.relationid===t.relid});n.length&&o.splice(o.indexOf(n[0]),1)}t.treeDoc.withTransactionUpdate(()=>{t.treeDoc.withTransactionUpdate(()=>{r.calculateParents(o,!0)})})}}t.treeDoc.withTransactionUpdate(()=>{t.treeDoc.withTransactionUpdate(()=>{r.calculateParents(d,!0)})}),n.end("builder_Correct"),n.end("refresh"),l()})})},__processReference:function(e){var t=this.parseNodeOptions(e);t.isPADHidden=t.isPADHiddenReference,e.builder.addReference(t),e.nodesMap.set(t.resourceid,t)},__processGroupingNode:function(e){var t=this.parseGroupingNodeOptions(e.node.options);t.isGroupingNode=!0,e.builder.addReference(t),e.nodesMap.set(t.resourceid,t),e.builder.addChild(e.parent,t,{mode:"noChildComputed"})},__processInstance:function(e){var t=this.parseNodeOptions(e,!0);delete t.type;var i=e.nodesMap.get(t.resourceid),s=this.smartAssign(i,t);if(s.children&&s.children.length&&(s.childComputed=!0),"noChildComputed"===e.mode&&delete s.childComputed,void 0!==e.pgpHideOccurrencesMap){var a=e.pgpHideOccurrencesMap;for(const[e,n]of a.entries()){e[e.length-1]===t.resourceid&&(s.isPADHiddenOccurrence=n)}}void 0!==s.isPADHiddenOccurrence?(s.isPADHidden=s.isPADHiddenOccurrence,s.isHiddenStateFrom=r.FROMS.PGP):void 0!==s.isPADHiddenInstance?(s.isPADHidden=s.isPADHiddenInstance,s.isHiddenStateFrom=r.FROMS.PGP):void 0!==s.isPADHiddenReference&&(s.isPADHidden=s.isPADHiddenReference,s.isHiddenStateFrom=r.FROMS.PGP);let d=!0;if(e.treeDoc){var l=e.treeDoc.getNodesByRelId(e.node.resourceid);if(l.length>0){if(l.length>1)for(let t=0;t<l.length;t++){let n=l[t].getID();if(l[t].options.isHiddenState!==r.STATES.HIDDEN){let r={isHiddenState:l[t].options.isHiddenState,occurencePath:l[t].getOccurencePath()};if(e.nodesHiddenMap.get(n)){const t=e.nodesHiddenMap.get(n);e.nodesHiddenMap.set(n,[...t,r])}else e.nodesHiddenMap.set(n,[r])}}for(let e=0;e<l.length;e++){var c=l[e].options.isHiddenState;c!==r.STATES.HIDDEN&&c!==r.STATES.MIXED||(d=!1,s.isHiddenState=c)}}let t=e.treeDoc.options.hiddenNodes;if(t&&t.size>0){let n=e.expandedNodes;for(let i=0;i<n.length;i++){let o=n[i].isRoot()?n[i]:n[i].getRoot(),a=t.get(o);if(a&&a.length>0)for(let t=0;t<a.length;t++)e.node.resourceid===a[t].options.relationid&&(d=!1,s.isHiddenState=r.STATES.HIDDEN)}}const n=e.treeDoc.getNodesByRelId(e.node.resourceid);n.length>0&&n.at(0).options.isHiddenState===r.STATES.SHOWN&&(d=!1,s.isHiddenState=r.STATES.SHOWN)}d&&r.defaultHiddenState(s),void 0!==s.isPADHidden&&(e.doNotCalcByChildren&&e.doNotCalcByChildren.push({resid:s.resourceid,relid:s.relationid}),this.isHiddenState=!0);var p=void 0;if(e.treeDoc){if(e.treeDoc.isGroupingApplied()){let t=e.treeDoc.getGroupingNodeV2(e.node.from,s);p=t.groupNode,t.shouldBeNewGroup&&(s._shouldBeNewGroup=!0,s._actualGroupKey=t.actualGroupKey)}}p?(e.nodesMap.get(p.options.resourceid)||(p.options.contentRetrieved=!0,p.options.expandedState=n.NODE_STATES.EXPANDED.state,this.__processGroupingNode({node:p,parent:s.from,nodesMap:e.nodesMap,builder:e.builder})),o.array.unique(e.expandedNodes,p),e.builder.addChild(p.options.resourceid,s)):e.builder.addChild(s.from,s),-1===e.expandLevel&&(s.childComputed=!0)},__processInstanceOfw:function(e){var t=this.parseNodeOptions(e,!0);e.builder.addInstance(t)},processErrors:function(e,t){t||console.warn("please pass context"),c.iterate(e,function(e){e.code})}},R}),define("DS/ENOXParser/modules/mixins/parser/ParseFetch",["DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/HideShowController","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt"],function(e,t,n,r,i,s,o,a){"use strict";function d(e,t,n,r){let i=n;return r&&(i=e.filterAttributesForUpdate({node:t,opts:i})),i&&0===i.relcount&&(i.children=null),i}function l(){}return l.prototype={parseFetch:function(e){var r=i.addOrGetSection("parser");return r.start("parseFetch",{stats:!0}),new Promise(function(i,s){var o=e.treeDoc;o.withTransactionUpdate(function(){for(var s=0;s<e.results.length;s++){let r=this.parseAttributes(e.results[s].attributes);t.defaultHiddenState(r);let i=new e.nodeModelClass(r);o.addRoot(i);let a=o.getRoots().length;o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:a,added_node:i}}),n.updateNLS(i)}r.end("parseFetch"),i()}.bind(this))}.bind(this))},parseMultiFetch:function(e){let t=this;return new Promise(function(i,s){var o=e.treeDoc;o.withTransactionUpdate(function(){r.iterate(e.results,function(e){var i=t.parseAttributes(e.attributes),s=o.getNodesById(i.resourceid);if(s.length)r.iterate(s,function(e){e.updateOptions(i),n.updateNLS(e)});else{var a=o.getNodesByRelId(i.resourceid);a.length&&(delete i.resourceid,r.iterate(a,function(e){e.updateOptions(i),n.updateNLS(e)}))}})}),i()})},refreshFetch:function(n){let i=this;return new Promise(function(a,d){let l=n.roots,c=n.wsResponse.results;c?(r.iterate(c,function(t){let r=i.parseAttributes(t.attributes),a=function(e){let t=l.filter(function(t){return t.getID()===e});return t.length?t[0]:null}(r.resourceid);if(a){a.setState(e.NODE_STATES.COLLAPSED),a.options.childComputed=!1,a.options.children||(a.options.children=[],r.children=[]),!0!==n.FBIProxy.HasFilter(a.getID()).hasFilter||o.isAuthoring()&&!a.keepFilterBadge?s.node.clearBadges(a):s.node.setFilterBadge(a),i.options.modules.NodeUtils.refreshForRoot(a,r),a.queueNls()}}),t.clearHiddenState(l),a()):a()})},refreshNodes:function(t){let n=this;return new Promise(function(i,s){let o=!1;t.treeDoc.filterAttributesForUpdate&&(o=!0);let a=[],l=[],c=(t.wsResponse.results,new Map);r.iterate(t.wsResponse.results,function(e){let t=function(e){let t="";return r.iterateControl(e.attributes,function(e){if("resourceid"===e.name)return t=e.value,{break:!0}}),t}(e),i=n.parseAttributes(e.attributes);c.set(t,i)}),r.iterateMap(c,function(n,i){if(t.refreshParameters.created&&-1!==t.refreshParameters.created.indexOf(i)){var s=t.treeDoc.createNodeModel(n);t.treeDoc.addRoot(s),s.queueNls(),t.treeDoc.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.treeDoc.getRoots().length,added_node:s}}),a.push(s),l.push(s.getID())}else if(t.refreshParameters.modified&&-1!==t.refreshParameters.modified.indexOf(i)){let s=t.treeDoc.getRoots();r.iterate(s,function(s){let o=s.getNodesById(i);if(o.length)r.iterate(o,function(r){r.updateOptions(d(t.treeDoc,r,n)),r.queueNls(),null===r.options.children&&r.setState(e.NODE_STATES.NO_CHILDREN),a.push(r)});else{let e=s.getNodesByRelId(i);r.iterate(e,function(e){var r=d(t.treeDoc,e,n);delete r.resourceid,e.updateOptions(r),e.queueNls(),a.push(e)})}var l=t.treeDoc.searchRootById(i);if(l)l.updateOptions(d(t.treeDoc,l,n)),l.queueNls(),0===l.options.relcount&&l.setState(e.NODE_STATES.NO_CHILDREN),t.treeDoc.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.treeDoc.getRoots().length,added_node:l}}),a.push(l);else if(t.refreshParameters.relationids&&-1!==t.refreshParameters.relationids.indexOf(i)){let e=t.treeDoc.getRoots();r.iterate(e,function(e){let t=e.getNodesByRelId(i);r.iterate(t,function(e){e.updateOptions({relationOrder:n.relationOrder}),e.queueNls();let t=e.getParent(),i=e.getBrothers(),s=t.getChildren();s.length>1&&r.iterate(i,function(n){if(n.options.relationOrder>relid.options.relationOrder){let r=s.indexOf(e);if(s.indexOf(n)<r){let e=t.removeChild(relid);t.insertBefore(e,n)}}}),a.push(e)})})}})}}),a.length&&t.treeDoc.fillAttributesAsync(a),i()})}},l}),define("DS/ENOXParser/modules/TwoDParser",["DS/ENOXParser/modules/mixins/parser/ParseAttributes","DS/ENOXParser/modules/mixins/parser/ParseFetch","DS/ENOXParser/modules/mixins/parser/ExpandV2LoadModel","DS/ENOXParser/modules/mixins/parser/MergeObj"],function(e,t,n,r){"use strict";function i(){}var s;return i.prototype={setup:function(e){return this.options=e,new Promise(function(e,t){e()})}},i.prototype=Object.assign(i.prototype,e.prototype),i.prototype=Object.assign(i.prototype,t.prototype),i.prototype=Object.assign(i.prototype,n.prototype),i.prototype=Object.assign(i.prototype,r.prototype),s||(s=new i),s}),define("DS/ENOXParser/modules/PADParser",["UWA/Core","DS/PADServices/utils/Iterator","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/AttributesMgt","DS/PADServices/utils/DictionaryAccess"],function(e,t,n,r,i,s){const o="ds6w:label-Instance";function a(t,r,i){let s,a,d=t.relationid;if((s=r[t.resourceid])&&((a=n.parseAttributes(s.attributes)).relationid=d,i&&d)){let e=n.parseAttributes(s.attributes);a.grid[o]=e.label}return e.clone(a,!1)}function d(e,t,n,r,i,s){let o,a,d,l,c,p,u,h,f=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},r=e.length;r--;){child=e[r];var i=child._options.relationid;if(i===t.after){n.afterNodes=[child],n.afterPosition=r;break}if(i===t.before){n.beforeNodes=[child];break}}return n};for(let r=e.length;r--;)for(let s=(d=t[o=e[r]]).length;s--&&((a=(l=d[s]).getChildren())&&0!==a.length);){u=n[o],p=a[0];for(var g=u.length;g--&&(c=(h=u[g]).resourceid,h.ordering);){var D,m=h.ordering.before,S=h.ordering.after,b=!(!m||""===m),P=!(!S||""===S),v=f(a,h.ordering),N=v.beforeNodes.length>0,O=-1!==v.afterPosition;b&&P?(N&&(i[c]={before:v.beforeNodes}),O&&(D=v.afterPosition+2,i[c]={after:[D]})):b?N?i[c]={before:v.beforeNodes}:p&&(i[c]={before:[p]}):P&&O&&(D=v.afterPosition+2,i[c]={after:[D]})}}}function l(){}let c;return l.prototype={insertNodes:function(t){let n={transactions:[]},l=-1!==i.getAvailableColumns().indexOf(o),c=t.treedocument,p=c.getRoots(),u=t.response.results,h=e.clone(t.insert_parameters,!1),f=Object.keys(h),g={},D={},m={};!function(e,t){for(var n,r,i,s=e.length;s--;)for(var o=(r=(n=e[s]).attributes).length;o--;)if("resourceid"===(i=r[o]).name){t[i.value]=n;break}}(u,D),function(e,t,n){let r,i;for(let s=e.length;s--;){i=e[s];for(let e=t.length;e--;)if((r=t[e].getNodesById(i)).length>0){n[i]=r;break}}}(f,p,g),d(f,g,h,0,m);Date.now();for(var S,b=f.length;b--;){S=f[b];var P=[],v={insertExisting:{modified:[],inserted:[],created:[]}},N=g[S],O=h[S];if(c.withTransactionUpdate(function(){for(var e,t,n=O.length;n--;){node_2_insert=O[n],t=node_2_insert.resourceid,e=a(node_2_insert,D,l);for(var i=N.length;i--;){let n=N[i];var o=new c.options.nodeModelClass(e);if(node_2_insert.ordering){var p=m[t];p?p.before?n.insertBefore(o,p.before[0]):p.after?n.addChild(o,p.after[0]):n.addChild(o):n.addChild(o)}else n.addChild(o);n.options.padstate!==r.NODE_STATES.EXPANDED.state&&(n.setState(r.NODE_STATES.PARTIALLY_EXPANDED),n.options.padstate=r.NODE_STATES.PARTIALLY_EXPANDED.state),n.options.padstate===r.NODE_STATES.NOCHILDREN.state&&(n.setState(r.NODE_STATES.EXPANDED),n.options.padstate=r.NODE_STATES.EXPANDED.state),(n._isExpanded||n._expandState===r.NODE_STATES.EXPANDING.state)&&(n.options.padstate=r.NODE_STATES.EXPANDED.state,n.setState(r.NODE_STATES.EXPANDED)),v.insertExisting.modified.push(n.getID()),v.insertExisting.inserted.push(o.getID()),P.push(o.getRelationID()),v.insertExisting.created.push(o.getRelationID()),v.insertExisting.withContext=!1,s.updateNLS(o),d(f,g,h,0,m)}}}),P.length){var A=[];P.forEach(function(e){var t=c.getNodesByRelId(e);t&&A.push(t[0].getOccurencePath())}),v.insertExisting.inserted=A}n.transactions.push(v)}return n},insertNodes_old:function(t){var r={transactions:[]},o=i.getAvailableColumns(),a=t.treedocument,d=a.getRoots(),l=t.response.results;console.log("replace insert response_results",l);var c,p,u,h=e.clone(t.insert_parameters,!1),f=Object.keys(h),g={},D={},m={};Date.now();function S(){for(var e,t,n,r,i,s,o,a=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},r=e.length;r--;){var i=(p=e[r])._options.relationid;if(i===t.after){n.afterNodes=[p],n.afterPosition=r;break}if(i===t.before){n.beforeNodes=[p];break}}return n},d=f.length;d--;){e=f[d];for(var l=(n=g[e]).length;l--&&((t=n[l].getChildren())&&0!==t.length);){s=h[e],i=t[0];for(var c=s.length;c--&&(r=(o=s[c]).resourceid,o.ordering);){var u,D=o.ordering.before,S=o.ordering.after,b=!(!D||""===D),P=!(!S||""===S),v=a(t,o.ordering),N=v.beforeNodes.length>0,O=-1!==v.afterPosition;b&&P?(N&&(m[r]={before:v.beforeNodes}),O&&(u=v.afterPosition+2,m[r]={after:[u]})):b?N?m[r]={before:v.beforeNodes}:i&&(m[r]={before:[i]}):P&&O&&(u=v.afterPosition+2,m[r]={after:[u]})}}}}function b(t){var r,i,s=t.relationid;if((r=D[t.resourceid])&&((i=n.parseAttributes(r.attributes)).relationid=s,-1!==o.indexOf("instanceName")&&s&&D[s])){var a=n.parseAttributes(D[s].attributes);i.grid.instanceName=a.label}return e.clone(i,!1)}!function(){for(var e,t,n=f.length;n--;){t=f[n];for(var r=d.length;r--;)if((e=d[r].getNodesById(t)).length>0){g[t]=e;break}}}(),function(){for(var e,t,n,r,i=l.length;i--;){e=l[i],console.log("insert result",e);for(var s=(t=e.attributes).length;s--;)if("resourceid"===(n=t[s]).name){r=n.value,D[r]=e;break}}}(),S();Date.now();for(var P,v=f.length;v--;){P=f[v];var N=[],O={insertExisting:{modified:[],inserted:[],created:[]}},A=g[P],E=h[P];if(a.withTransactionUpdate(function(){for(var e,t,n=E.length;n--;){t=(u=E[n]).resourceid,e=b(u);for(var r=A.length;r--;){c=A[r];var i=new a.options.nodeModelClass(e);if(u.ordering){var o=m[t];o?o.before?c.insertBefore(i,o.before[0]):o.after?c.addChild(i,o.after[0]):c.addChild(i):c.addChild(i)}else c.addChild(i);"expanded"!==c.options.padstate&&(c.setState({state:"partiallyExpanded"}),c.options.padstate="partiallyExpanded"),"noChildren"===c.options.padstate&&(c.setState({state:"expanded"}),c.options.padstate="expanded"),(c._isExpanded||"expandState"===c._expandState)&&(c.options.padstate="expanded",c.setState({state:"expanded"})),O.insertExisting.modified.push(c.getID()),O.insertExisting.inserted.push(i.getID()),N.push(i.getRelationID()),O.insertExisting.created.push(i.getRelationID()),O.insertExisting.withContext=!1,s.updateNLS(i),S()}}}),r.transactions.push(O),N.length){var _=[];N.forEach(function(e){var t=a.getNodesByRelId(e);t&&_.push(t[0].getOccurencePath())}),r.transactions[0].insertExisting.inserted=_}}return r},insertNodesExpand:function(e){return new Promise(function(i,s){let o=[];t.iterate(e.expandedNodes,function(e){let t=e.getChildren();t&&t.length&&(o=o.concat(t))}),n.parseExpandLoadModel(e).then(function(){t.iterate(e.expandedNodes,function(e){t.iterate(e.getChildren(),function(e){-1===o.indexOf(e)&&e.select()}),e.setState(r.NODE_STATES.PARTIALLY_EXPANDED),delete e.options.childComputed}),i()})})},updateInstances:function(e){var r=[];e.treedocument.withTransactionUpdate(function(){t.iterate(e.response.results,function(i){if(i.attributes){var s="";let o=i.attributes.filter(function(e){return"resourceid"==e.name});o.length&&(s=o[0].value);e.newRelIds&&-1!==e.newRelIds.indexOf(s)&&t.iterate(e.treedocument.getRoots(),function(o){var a=o.getNodesByRelId(s);a.length&&t.iterate(a,function(t){var o=function(t,r){var i=n.parseAttributes(r.attributes);return Generics.checks.function(e.treedocument.filterAttributesForUpdate)&&(i=e.treedocument.filterAttributesForUpdate({node:t,node_opts:i})),i&&0===i.relcount&&(i.children=null),i}(t,i),a=t.getLabel();delete o.resourceid,o.display=a,o.label=a,o.instanceMatrix&&(o.relationid=s,o.grid.instanceMatrix=o.instanceMatrix);var d=t.getState();t.updateOptions(o),PADPredicatesNls.updateNLS(t),d===NODE_STATE.EXPANDED&&t.setState({state:NODE_STATE.PARTIALLY_EXPANDED}),r.push(t)})})}})}),e.editCfg?e.treedocument.refreshCfgValues({relids:e.newRelIds}):r.length&&e.treedocument.fillAttributesAsync(r)}},l.prototype=Object.assign(l.prototype,n),c||(c=new l)});