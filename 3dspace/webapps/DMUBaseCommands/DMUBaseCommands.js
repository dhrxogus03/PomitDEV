define("DS/DMUBaseCommands/DMUCutCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&i.copySelectedDMUElements(!0),n.cancel()}}})}),define("DS/DMUBaseCommands/DMURightSidePanelCmd",[].concat(["DS/ENOPAD3DViewer/commands/PAD3DViewerRightSidePanel","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsContext"]),function(e,t,n,i,o,a){"use strict";return e.extend({init:function(e){var r,s,l,c=[],u=[],d=t.get(),g={get:function(){let e=o.getReviewContext({context:d}),t=e&&e.getValidation()&&e.getValidation().getContext()?e.getValidation().getContext().getJsonContextTypes()[0]:null,r=a.getParentType(t)?a.getParentType(t):t;var s,l,u,g=i.get();if((g.length&&g.some(function(e){return n.isAModelPath(e.pathElement)})||"DesignSight"===r||"Requirement Specification"===r||"Requirement"===r||"Document"===r)&&g.length)for(var m=g[0].pathElement.externalPath.length-1;m>=0;--m){if(!(u=g[0].pathElement.externalPath[m])||n.isPLMNode(u))return g;if(u.getDibInfo){let e=m>0?g[0].pathElement.externalPath[m-1]:null;return[{dibInfo:u.getDibInfo(),parentDibInfo:e&&e.getDibInfo?e.getDibInfo():null}]}if(u.getDocInfo)return[{docInfo:u.getDocInfo(),parentDocInfo:null}];if(u.getReqInfo)return[{reqInfo:u.getReqInfo(),parentDocInfo:null}]}if(!c.length)return[];var p=o.getReviewContext({context:d}),h=p?p.getReviewCtxInformation():{};return h&&h.reviewId?s=[{mkpID:h.reviewId}]:d&&d.getApplicativeData().getLoadedItfData&&(l=(l=d.getApplicativeData().getLoadedItfData())&&l.data),s||(l||[])},onPostAdd:function(e){return r=e,1},onPostRemove:function(e){return s=e,2},onEmpty:function(e){return l=e,3},unsubscribe:function(e){1===e?r=null:2===e?s=null:3===e&&(l=null)}},m=o.getEventsController({viewer:d.getViewer()});function p(e){1===e&&r?r():2===e&&s?s():3===e&&l&&l()}c.push(i.onPostAdd(p.bind(this,1))),c.push(i.onPostRemove(p.bind(this,2))),c.push(i.onEmpty(p.bind(this,3))),u.push(m.addEvent("onDMUMarkupCreationSucceeded",p.bind(this,1))),u.push(m.addEvent("onDMUMarkupLoaded",p.bind(this,1))),u.push(m.addEvent("onReviewRemoved",p.bind(this,1))),this.getXSO=function(){return g},this.getID=function(e){return e&&e.mkpID?e.mkpID:e&&e.isrID?e.isrID:e&&e.dibInfo?e.dibInfo.id:e&&e.reqInfo?e.reqInfo.id:e&&e.docInfo?e.docInfo.validatedPaths[0]:Object.getPrototypeOf(this).getID.apply(this,arguments)},this.getRelationID=function(e){return e&&e.mkpID||e&&e.isrID?void 0:e&&e.parentDibInfo?e.parentDibInfo.id:e&&e.reqInfo?null:e&&e.docInfo?null:Object.getPrototypeOf(this).getRelationID.apply(this,arguments)},this.getType=function(e){return e&&e.mkpID?"Markup":e&&e.type?e.type:e&&e.dibInfo?e.dibInfo.type:e&&e.reqInfo?e.reqInfo.type:e&&e.docInfo?e.docInfo.type:Object.getPrototypeOf(this).getType.apply(this,arguments)},this.destroy=function(){p(3),c.forEach(i.unsubscribe,i),c=[],u.forEach(m.removeEvent,m),u=[],r=s=l=null,Object.getPrototypeOf(this).destroy.apply(this,arguments)},this._parent(e),p(1)},isNodeValid:function(e){var t=this._parent(e);return!t&&e&&(e.mkpID||e.isrID||e.dibInfo||e.docInfo||e.reqInfo)&&(t=!0),t},getServiceId:function(e){var t="";return!e||e.mkpID||e.isrID||e.dibInfo||e.docInfo||e.reqInfo||(t=this._parent(e)),t}})}),define("DS/DMUBaseCommands/DMUCopyCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&i.copySelectedDMUElements(),n.cancel()}}})}),define("DS/DMUBaseCommands/EXPToolsWUX",["DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,n,i){"use strict";return{addInCSO:function(t,n){if(t){var o=t.path?t.path:t.getNode&&t.getNode()?i.buildPathElement(t.getNode()):t.getDMUType?i.buildPathElement(t):null;n||e.empty(),o&&e.add({pathElement:o})}},emptyCSO:function(){e.empty()},getCSO:function(){for(var t=e.get(),n=[],i=0;i<t.length;i++)n.push(t[i].pathElement);return n},addInHSO:function(e,n){if(e){var o=e.path?e.path:e.getNode&&e.getNode()?i.buildPathElement(e.getNode()):null;n||t.empty(),t.add({pathElement:o})}},emptyHSO:function(){t.empty()},addInPSO:function(e,t){if(e){var o=e.path?e.path:e.getNode&&e.getNode()?i.buildPathElement(e.getNode()):null;t||n.empty(),n.add({pathElement:o})}},emptyPSO:function(){n.empty()}}}),define("DS/DMUBaseCommands/DMUSetAsPreviewCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUBaseExperience/DMUContextManager"],function(e,t,n,i,o,a,r){"use strict";return class extends n{beginExecute(){const e=e=>{const t=i.get();for(let n=t.length-1;n>=0;n--){const i=t[n];if(i&&i.pathElement){const t=i.pathElement.getLastElement(!0);if(t&&t.getDMUType&&t.getDMUType()===e)return i.pathElement}}};let t=r.getReviewContext({viewer:this.getFrameWindow().getViewer()});const n=null==t?void 0:t.getUIManager();if(t&&n){let i=o.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});if(i&&i.isADocumentDisplayed()&&("Document"===i.getDocumentType()||"Requirement"===i.getDocumentType())){const i=e("DMUComment");let o=a.giveDMUCommentsController({context:this.getFrameWindow()});if(o){const e=o.getDMUObjectFromPathElement(i)||t.getDMUObjectFromPathElement(i);e&&n.registerElementIdAsPreview(e.getAttribute("sUuid"),e.getParent(),e.getAttribute("sParentCommentId"))}}else{const i=e("DMUSlide");if(i){const e=t.getDMUObjectFromPathElement(i);e&&n.registerElementIdAsPreview(e.getAttribute("sUuid"),e.getParent())}}}this.done()}}}),define("DS/DMUBaseCommands/DMUPasteCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=async function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&await i.pasteDMUElements(),n.cancel()}}})}),define("DS/DMUBaseCommands/DMUPasteSpecialCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUControls/DMUPasteWithOptionsPanel"],function(e,t,n,i){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var o=this,a=n.getManager({name:"DMUUserExperienceManager",context:o.getFrameWindow()});a&&a.refreshCCPCommandsAvailability(),this.beginExecute=function(){if(a=n.getManager({name:"DMUUserExperienceManager",context:o.getFrameWindow()})){var e=a.getCCPTarget();if(!e){var r=t.getReviewContext({viewer:o.getFrameWindow().getViewer()});r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getCurrentSlide&&(e=r.getCurrentSessionMarkup().getCurrentSlide())}if(e){var s=a.areOccurenceOverloadsCopied();new i({frmWindow:o.getFrameWindow(),prefs:{overloadPasteSpecial:s,displayAssociateFormatPref:!s&&"DMUSlide"===e.getType(),displayCreateNewSlidePref:!s&&"DMUSlide"===e.getType(),displayCameraPref:!s},cb:function(e){a&&a.pasteDMUElements(e),null}})}}o.cancel()}}})}),define("DS/DMUBaseCommands/DMUSwitch3DMarkersResponsiveDisplayCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/DMUBaseUIControllers/DMUMarkupsController"],function(e,t){"use strict";let n,i,o=e.extend({init:function(e){this._parent(e,{}),i=this;var t=this.onStateChange(function(){i.getState()?o.Enable3DMarkerResponsiveDisplay():o.Disable3DMarkerResponsiveDisplay()}),n=this._destroy;this._destroy=function(){i._modelEvents.unsubscribe(t),n.call(i)},this.setState("true"===localStorage.getItem("DMU3DMarkersResponsiveDisplay"))},_destroy:function(){this._parent()}});return o.Enable3DMarkerResponsiveDisplay=function(e,o){!n&&o?n=o.executionContext.getComponent("Viewer"):n||o||(n=i.getFrameWindow().getViewer());let a=t.giveDMUMarkupsController({context:o&&o.executionContext?n.getViewer():n});a&&a.setResponsiveDisplayFlag(!0),localStorage.setItem("DMU3DMarkersResponsiveDisplay","true"),e&&e()},o.Disable3DMarkerResponsiveDisplay=function(e,o){!n&&o?n=o.executionContext.getComponent("Viewer"):n||o||(n=i.getFrameWindow().getViewer());let a=t.giveDMUMarkupsController({context:o&&o.executionContext?n.getViewer():n});a&&a.setResponsiveDisplayFlag(!1),localStorage.setItem("DMU3DMarkersResponsiveDisplay","false"),e&&e()},o}),define("DS/DMUBaseCommands/DMUFocusOnRepresentationCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/PADUtils/views/PADPager"],function(e,t,n,i,o,a,r,s){"use strict";return class extends n{constructor(e){super(e,{mode:"shared",isAsynchronous:!0});let t,n=this,l=null,c=[],u=0,d=!1,g=[],m=!1,p=r.get(this.options.context),h=e=>{27===e.keyCode&&n.end()},f=e=>{let t;if(e&&e.length)if(e.some(e=>e&&e.getLastElement(!0)&&e.getLastElement(!0).getReqInfo)){let t=e.map(e=>e.getLastElement(!0).getReqInfo().pathId).filter(Boolean);t.length&&window.require(["DS/WebDocumentVisualization/WebDocumentVisualizationController"],e=>{let n=e.giveWebDocumentVisualizationController({context:p});n&&n.reframeOnElements(t)})}else e.forEach(e=>{let n=e.getBoundingSphere(p.getViewer(),"visibleSpace");n&&n.radius&&(t?t.mergeWithSphere(n,t):t=(new i.Sphere).copy(n))}),t&&t.radius&&p.getViewer().currentViewpoint.reframe(void 0,void 0,t)},D=()=>{-1===u&&(u=c.length-1);let e=u%c.length;l&&l.setLabel(e+1+"/"+c.length),d=!0,p.lockSelectionBroadcast(!0),o.empty(),a.empty(),o.add(c[e]),a.add(c[e]),d=!1,p.lockSelectionBroadcast(!1),f([c[e].pathElement])},v=e=>{c&&("previous"===e.operation&&(u--,D()),"next"===e.operation&&(u++,D()))},C=()=>{let e=g.length?g.map(e=>({pathElement:e})):c.slice();p.lockSelectionBroadcast(!0),d=!0,a.empty(),o.empty(),a.add(e),o.add(e),d=!1,p.lockSelectionBroadcast(!1)};function S(){m||(m=!0,c.length=0,u=0,d=!1,g.length=0,l&&(l.hide(),l.destroy(),document.removeEventListener("keyup",h)),l=null,t&&o.unsubscribe(t),t="",m=!1,n.cancel())}this.beginExecute=function(e){(e=>{if(!e||!e.length)return;p.lockSelectionBroadcast(!0),g=e.slice(),o.empty(),a.empty();let t=e.map(e=>({pathElement:e}));o.add(t),a.add(t)})(e),u=0;let n=[];n=o.get().slice(),d=!1;for(let e=0;e<n.length;e++)null!==n[e].pathElement&&c.push(n[e]);c.length?(t=o.onRemove(()=>{d||p.getController()._updateClustersInProgress||S()}),c.length>1&&(l||(l=new s({renderTo:p.elements.view_container,context:p,callbacks:{onPrevious:()=>{v({operation:"previous"})},onNext:()=>{v({operation:"next"})},onSelectAll:C,onReframeAll:()=>{f(c.map(e=>e.pathElement))},onClose:function(){S()}}})),document.addEventListener("keyup",h),l.show()),D(),1===c.length&&S()):S()};let M=n.destroy;this.destroy=function(){M.call(n),n.done()}}}}),define("DS/DMUBaseCommands/DMUCopyLinkCmd",["DS/CATWebUXCopyLink/CATWebUXCopyLinkCmdAdapt","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/PADUtils/PADContext"],function(e,t,n,i){"use strict";var o;function a(){var e=[];return n.get().forEach(function(t){for(var n=0;t.pathElement,n<t.pathElement.getLength();n++){var i=t.pathElement.getElement(n);i&&"function"==typeof i.getDMUType&&"DMUValidationExposedPresentation"===i.getDMUType()&&e.push(i)}}),e}return e.extend({init:function(e){var n=i.get();e.pad3DViewer=n,this._parent(e),this.getParameters=function(e){var i=t.getReviewContext({context:n}).getReviewCtxInformation();i&&!i.reviewId&&e.onFailure(),a().length>1?e.onFailure():e.onComplete({content:function(e){var t={data:{items:[]}},n={};if(e&&e.selectedNode){var i=a();1===i.length?(o=i[0].getOwner().getName()?i[0].getOwner().getName():"",n.objectId=i[0].getOwner().getPlmID()?i[0].getOwner().getPlmID():void 0,n.objectType=i[0].getDMUType()?i[0].getDMUType():void 0):(o=e.selectedNode.reviewName?e.selectedNode.reviewName:"",n.objectId=e.selectedNode.reviewId?e.selectedNode.reviewId:void 0,n.objectType=e.selectedNode.reviewType?e.selectedNode.reviewType:void 0)}return t.data.items.push(n),t}({selectedNode:i,param:e}),label:o})}}})}),define("DS/DMUBaseCommands/DMUNavOnImplementationLinksCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/PADUtils/PADUtilsServices","DS/WAFData/WAFData","DS/PADUtils/PADSettingsMgt","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","i18n!DS/DMUBaseCommands/assets/nls/DMUBaseCommands"],function(e,t,n,i,o,a,r,s,l,c,u){"use strict";return class extends n{constructor(e){super(e,"shared");let t=this,n=null;function d(e,i){t&&(n&&(n.destroy(),n=null),n=new l({body:t.getFrameWindow().getUIFrame(),type:e,message:i}))}function g(){d("warning",u.issueImplLinks)}this.beginExecute=function(){parent.require(["DS/WidgetLink/WidgetLink"],e=>{let n=e.get(window.widget);if(!n||!n.getLinked().length)return d("info",u.noWidgetLinked),void(t.cancel?t.cancel():t.done());let l=o.get(),m=[];if(1===l.length&&l.some(function(e){return i.isAModelPath(e.pathElement)})){let e=l[0].pathElement.clone();if(e.internalPath.length=0,e.getLastElement(!0).getReqInfo)m.push(e.getLastElement(!0).getReqInfo().id);else{for(;e&&!i.isPLMNode(e.getLastElement(!0))&&!e.getLastElement(!0).getDibInfo;)e=e.getParentPath();if(!e)return;let t=e.getLastElement();if(i.isPLMNode(e.getLastElement())){for(m.push(i.getNodeID(t));e&&!i.isReference(t)&&!i.isRepReference(t);)(e=e.getParentPath())&&(t=e.getLastElement(!0));if(t&&i.isRepReference(t)){for(;e&&!i.isReference(t);)(e=e.getParentPath())&&(t=e.getLastElement(!0));t&&m.push(i.getNodeID(t))}}else e.getLastElement().getDibInfo&&(e.getParentPath()&&e.getParentPath().getLastElement(!0).getDibInfo&&e.getParentPath().getLastElement(!0).getDibInfo()&&e.getParentPath().getLastElement(!0).getDibInfo().id?m.push(e.getParentPath().getLastElement(!0).getDibInfo().id):e.getLastElement(!0).getDibInfo&&e.getLastElement(!0).getDibInfo()&&e.getLastElement(!0).getDibInfo().id&&m.push(e.getLastElement(!0).getDibInfo().id))}}if(m&&m.length){let e=[],n=[],i=s.getSetting("pad_security_ctx"),o=o=>{let l=o?JSON.parse(o):null;if(l&&l.infos&&"OK"===l.infos.status&&l.result&&l.result.length&&l.result.forEach(t=>{t&&t.outputs&&t.outputs.contextRelationResults&&t.outputs.contextRelationResults.length&&t.outputs.contextRelationResults.forEach(t=>{if(t.elements&&t.elements.length){let n=[];t.elements.forEach(e=>{e.physicalid&&n.push(e.physicalid)}),n.length&&e.push(n)}}),t&&t.outputs&&t.outputs.refRefRelationResults&&t.outputs.refRefRelationResults.length&&t.outputs.refRefRelationResults.forEach(e=>{if(e.elements&&e.elements.length){let t=[];e.elements.forEach(e=>{e.physicalid&&!m.includes(e.physicalid)&&t.push(e.physicalid)}),t.length&&n.push(t)}})}),e.length){let o=[];e.forEach(e=>{e.forEach(e=>{-1===o.indexOf(e)&&o.push(e)})}),function(e){let t={input_physical_ids:e.physicalIDs,label:"DMUNavigateOnImplementationLinks_Ids",primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},patternTypeFilters:{ref:{typesToNotReturn:["RFLPLMImplementConnection"]}},attributes:["ds6w:label","ds6w:type"],fileAttributes:[],version:3};r.authenticatedRequest(a.get3DSpaceUrl()+"/cvservlet/navigate?SecurityContext="+e.securityContext,{data:JSON.stringify(t),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityContext},timeout:parseInt(s.getSetting("webapi_timeout"),10),onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout})}({securityContext:i,physicalIDs:o,onComplete:function(i){let o,a={},r=JSON.parse(i);if(!r||!r.infos||"OK"!==r.infos.status||!r.result)return void g();r.result.forEach(e=>{o=e.input_object,e.outputs&&e.outputs.ref&&e.outputs.ref.length&&(a[o.physicalid]=e.outputs.ref.map(e=>e.physicalid))});let s=[];if(e.forEach(e=>{let t=[];e.forEach(e=>{a[e]&&a[e].forEach(n=>{t.length&&t.push(e),t.push(n)})}),s.push(t)}),s&&s.length){let e=c.giveEventsController({viewer:t.getFrameWindow().getViewer()});e&&e.fireEvent("onFireCrossWidgetFind",{paths:[...s,...n]})}},onFailure:g,onTimeout:g})}else if(n.length){let e=c.giveEventsController({viewer:t.getFrameWindow().getViewer()});e&&e.fireEvent("onFireCrossWidgetFind",{paths:n})}};const l=a.get3DSpaceUrl()+"/cvservlet/navigate?SecurityContext="+i;let u={data:JSON.stringify({input_physical_ids:m,primitives:[{navigate_from_rel:{id:1,mode:"stop_at_rel"}},{navigate_from_sr:{id:2,filter:{role:["51","52"],semantics:["5","7"]},mode:"ends"},navigate_to_sr:{id:3,filter:{role:["51","52"],semantics:["5","7"]},mode:"path"}}],patterns:{contextRelationResults:[{id:1},{id:2},{id:3}],refRefRelationResults:[{id:2},{id:3}]},flags:["returnMatches"],version:3,label:"DMUNavigateOnImplementationLinks_to"}),timeout:parseInt(s.getSetting("webapi_timeout"),10),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:i},onComplete:o,onFailure:g,onTimeout:g};r.authenticatedRequest(l,u)}t.done()})}}}}),define("DS/DMUBaseCommands/DMUGoToPageCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this._parentBeginExecute=this.beginExecute,this.beginExecute=function(){this._parentBeginExecute();var e=t.getManager({name:"DMU2DSheetManager",context:n.getFrameWindow()});e&&e.enableCurrentPageEdition(),n.cancel()}}})}),define("DS/DMUBaseCommands/DMUReframeOnRepresentationCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/PADUtils/PADContext"],function(e,t,n,i,o,a){"use strict";return class extends n{constructor(e){super(e,{mode:"shared",isAsynchronous:!0});let t=this;this.beginExecute=function(){let e=a.get(this.options.context),n=o.get();if(e&&n&&n.length){let t;n.forEach(n=>{if(n.pathElement){let o=n.pathElement.getBoundingSphere(e.getViewer(),"visibleSpace");o&&o.radius&&(t?t.mergeWithSphere(o,t):t=(new i.Sphere).copy(o))}}),e&&t&&t.radius&&e.getViewer().currentViewpoint.reframe(void 0,void 0,t)}t.cancel()}}}}),define("DS/DMUBaseCommands/EXPCommand",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseCommands/EXPToolsWUX"],function(e,t){"use strict";return e.extend({init:function(e,t,n){var i=t||"exclusive",o=n||!0;this._parent(e,{mode:i,isAsynchronous:o}),this.getFrameWindow&&this.getFrameWindow()&&(this._frmWindow=this.getFrameWindow(),this._viewer=this.getFrameWindow().getViewer())},_performCallback:function(){},beginExecute:function(){this._performCallback(),this.cancel(),this.done()},addInCSO:function(e,n){t.addInCSO(e,n)}})}),define("DS/DMUBaseCommands/EXPStateCommand",["DS/CATWebUXComponents/DMUStateCommand","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/EXPToolsVisualization","DS/VisuEvents/EventsManager","DS/Gestures/ClickGesture","DS/DMUMeasurable/DMUToolsSceneGraph","DS/VisuEvents/ScreenEvent"],function(e,t,n,i,o,a,r,s){"use strict";return e.extend({init:function(e,t,n){this._parent(e,{mode:t,isAsynchronous:n});if(this._frmWindow=this.getFrameWindow(),this._viewer=this._frmWindow.getViewer(),this._tokenRemove=null,this._frmWindow&&void 0===this._frmWindow._bDMUClickEvent){var i=new a(s.MouseButton.LEFT);o.addGestureRecognizer(i),this._frmWindow._bDMUClickEvent=!0}},changeDefaultController:function(){if(this._parent(),!this._keepDefaultController&&(this._defaultController=this.getFrameWindow().getViewer().currentViewpoint.getDefaultController(),this.getFrameWindow().getViewer().currentViewpoint.setDefaultController(!0,"CATIA"),this.getFrameWindow().getViewer()._viewer360Manager)){const e=this.getFrameWindow().getViewer().getNavigationParams();this._defaultClickToNavigateIn360=e&&e.clickToNavigateIn360,this.getFrameWindow().getViewer().setNavigationParams({clickToNavigateIn360:!1}),this._manipulatorManager=this.getFrameWindow().getViewer().manipulatorManager.getActivate(),this.getFrameWindow().getViewer().manipulatorManager.setActivate(!1)}},restoreDefaultController:function(){this._defaultController&&this.getFrameWindow().getViewer().currentViewpoint.setDefaultController(!0,this._defaultController),this._defaultClickToNavigateIn360&&this.getFrameWindow().getViewer().setNavigationParams({clickToNavigateIn360:this._defaultClickToNavigateIn360}),this._manipulatorManager&&setTimeout(()=>this.getFrameWindow().getViewer().manipulatorManager.setActivate(this._manipulatorManager)),this.cleanNotify(),this.done()},addEmptySelectionTransition:function(e,t,n,o){this._checkEmptySelection=function(e){var t=!0,n=e.from[0].event;if(e.from[0]&&e.from[0].getCurrentPosition&&(this._object=i.getSelectedPathElement(this._viewer,e.from[0].getCurrentPosition(this._viewer.canvas))),this._object){if(!this._id.includes("measure")&&!this._id.includes("thickness")&&r.isAPOIPath(this._object))return!0;t=!1}else if(!function(e){if(!e)return!1;for(var t=e;t;){if(t.id&&t.id.includes("WebDocPageLayerPage"))return!0;t=t.parentElement}return!1}(n.target)&&!function(e){if(!e)return!1;for(var t=e;t;){if(t.id&&t.id.includes("WebDocReqElem"))return!0;t=t.parentElement}return!1}(n.target))if("CANVAS"!==n.target.tagName)t=!1;else if(void 0!==n.target)if(void 0!==n.target.className&&"levelSelector-canvas levelSelector-canvas-animation"===n.target.className)t=!1;else for(var o=n.target;o;){if("LevelSelector"===o.id){t=!1;break}o=o.parentElement}return t},this.addTransition({iEvent:"/VISU/onPrimaryPointerClick",iInitialState:e,iFinalState:t,iCondition:function(e){return o?this._checkEmptySelection(e)&&o():this._checkEmptySelection(e)},iAction:n})},computeEmptySelectionInformation:function(e){var t=[];if(e.from[0]&&e.from[0].getCurrentPosition){var n=i.getPickingInfo(this._viewer,e.from[0].getCurrentPosition(this._viewer.canvas));n.position=n.point,t.push(n)}return t},addInCSO:function(e,n){t.addInCSO(e,n)},emptyCSO:function(){t.emptyCSO()},addInHSO:function(e,n){t.addInHSO(e,n)},emptyHSO:function(){t.emptyHSO()},addInPSO:function(e,n){t.addInPSO(e,n)},emptyPSO:function(){t.emptyPSO()},sendNotify:function(e,t,i){return this._notification&&this._notification.destroy(),this._notification=new n({body:this._frmWindow.getUIFrame(),type:e,notificationType:"HelpNotification",message:t,duration:i,autoHide:"number"==typeof i&&i>0}),this._notification},cleanNotify:function(){this._notification&&this._notification.destroy()}})}),define("DS/DMUBaseCommands/EXPGenericCmdOneSelThenOperation",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUBaseExperience/EXPToolsVisualization","DS/StateCommandEngine/PathElementAgent","DS/DMUBaseUIManipulators/DMUCursorsController","DS/VisuEvents/EventsManager","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/EXPManagerSet","i18n!DS/DMUBaseCommands/assets/nls/DMUBaseCommands"],function(e,t,n,i,o,a,r,s,l){"use strict";var c,u,d,g,m;return e.extend({init:function(e,t,n,i,o){this._parent(e,"exclusive",!0),this._performOperation=t,this._sKeyHelpMessage=void 0!==n?n:l.defaultSelectLabel,this._agentOptions=void 0!==i?i:{},this._bAllowEmptySel=void 0!==o&&o,this._dragEventCallback=this.options.dragEventCallback,this._selectedPathElement=null},initiateCmd:function(){this.emptyHSO(),this.emptyCSO();var e=this;this._viewer.currentViewpoint.setDefaultController(!1,"FLY_WALK");var l=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});if(c=l?l.getPointedElem():e._viewer.canvas,l&&(l.setTextSelectionFlag(!1),l.setTouchPanActive(!1)),this.getPageNumber=function(){return l?l.getPageNumber(u):null},this.getElementId=function(e){return l&&"Requirement"===l.getDocumentType()?l.getPointedElemIDAtPosition(e):null},this.getAbsolutePosition=function(t,n){if(u===e._viewer.canvas||!l)return t;var i=l.getElementMatrix(e.getPageNumber()||n);return i?t.clone().applyMatrix4(i):t},this.getRelativePosition=function(t,n){if(u===e._viewer.canvas||!l)return t;var i=l.getElementMatrix(n||e.getPageNumber()||e.getElementId(t));return i?t.clone().applyMatrix4((new r.Matrix4).getInverse(i)):t},this.tapCallback=function(n){if(!e.isPaused()){e._selectedPathElement=null,(u=l?l.getElementToDraw(n.from[0].getView()):e._viewer.canvas)||e.publish({event:"dragEnd"}),e._clickEventData=n;var i,o=e._viewer.getMousePosition(n.from[0].getCurrentPosition(e._viewer.canvas)),a=e._viewer.pick(o,"mesh",!0);if(void 0!==a&&void 0!==a.position&&null!==a.position)if(i=a.position.clone(),e._startpos=i,0===a.path.length)e._startpos=e._computePositionOnEmptySpace(n);else{var s=a.path[0];void 0!==s&&s.getLastElement().measurable&&void 0!==(a=e._viewer.pick(o,"prim",!0))&&(e._startpos=a.position.clone())}if(e._startpos){const n=t.getViewerPositionFromPoint(e._viewer,e._startpos);n&&(e._selectedPathElement=e._viewer.pick(e._viewer.getMousePosition(new r.Vector2(n.left,n.top)),"mesh",!1).path[0])}}},this._cancelCmd=function(){e._dragEventCallback({iEventData:"",vStartPosition:g,vCurrentPosition:m,bLastUpdate:"end",_isCanvasToDraw:d}),e.publish({event:"dragEnd"}),this.cancel()},this._dragEventCallback){var p=null;this.dragCallback=function(n){if(!e.isPaused()){var i="end"===n.state,o=function(e){if(e&&e===u)return!0;for(var t=e.parentNode;t&&"___view___1"!==t.id;){if(t===u)return!0;t=t.parentElement}return!1}(n.from[0].getView());if(o){"touchmove"!==n.from[0].event.type||n.from[0].event.pageX||n.from[0].event.pageY||(n.from[0].event.pageX=n.from[0].event.touches&&n.from[0].event.touches.length?n.from[0].event.touches[0].pageX:0,n.from[0].event.pageY=n.from[0].event.touches&&n.from[0].event.touches.length?n.from[0].event.touches[0].pageY:0),"begin"===n.state&&(e.dragEnabled=!0,p=void 0!==e._startpos?e._startpos:t.getPickingInfo(e._viewer,n.from[0].getCurrentPosition(e._viewer.canvas)).point);var s=n.from[0].getCurrentPosition(e._viewer.canvas),l=t.getLineFromWindowPosition(e._viewer,s.x,s.y),c=t.getViewpointInfo(e._viewer.currentViewpoint),h=a.computeLinePlaneDistance(l.position.toArray(),l.direction.toArray(),p.toArray(),c.sight.toArray());m=new r.Vector3(h.aPosition[0],h.aPosition[1],h.aPosition[2])}e._dragEventCallback({iEventData:n,vStartPosition:p,vCurrentPosition:m,bLastUpdate:i,isCanvasToDraw:o}),d=o,g=p,!i&&m||(m=null,e.publish({event:"dragEnd"}))}},this._viewer.get2DMode()||this._viewer.currentViewpoint.control.setTouchRotationActive(!1),o.addEvent(c,"onDrag",this.dragCallback),o.addEvent(c,"onPrimaryPointerDownUnique",this.tapCallback),document.addEventListener("contextmenu",this._cancelCmd),c!==this._viewer.canvas&&(o.addEvent(this._viewer.canvas,"onDrag",this.dragCallback),o.addEvent(this._viewer.canvas,"onPrimaryPointerDownUnique",this.tapCallback))}this._agentOptions.agentId="_pathElementAgent",this._agentOptions.viewer=this._viewer,this._pathElementAgent=new n(this._agentOptions),this.changeDefaultController();var h=i.giveDMUCursorsController({context:e.getFrameWindow()});h&&h.setCursors({pages:c!==this._viewer.canvas?"crosshair":null,canvas:c===this._viewer.canvas?"crosshair":null,preHLMarkers:"crosshair"}),this.sendNotify("info",this._sKeyHelpMessage)},resumeExecute:function(){this._parent();let e=i.giveDMUCursorsController({context:this.getFrameWindow()});e&&e.resetCursors(),this.done()},cancelExecute:function(){this.__endExecute()},__endExecute:function(){this.restoreDefaultController(),this._dragEventCallback&&(this._viewer.get2DMode()||this._viewer.currentViewpoint.control.setTouchRotationActive(!0),o.removeEvent(c,"onDrag",this.dragCallback),o.removeEvent(c,"onPrimaryPointerDownUnique",this.tapCallback),document.removeEventListener("contextmenu",this._cancelCmd),c!==this._viewer.canvas&&(o.removeEvent(this._viewer.canvas,"onDrag",this.dragCallback),o.removeEvent(this._viewer.canvas,"onPrimaryPointerDownUnique",this.tapCallback))),this._pathElementAgent=null,this.dragEnabled=null;var e=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});e&&(e.setTextSelectionFlag(!0),e.setTouchPanActive(!0));var t=i.giveDMUCursorsController({context:this.getFrameWindow()});t&&t.restoreCursors(),this.cleanNotify(),this._viewer.currentViewpoint.setDefaultController(!0,"FLY_WALK"),this.cancel()},buildGraph:function(){this.initiateCmd();var e=this.createInitialState("initialState"),t=this.getFinalState(),n={iEvent:this._pathElementAgent,iInitialState:e,iFinalState:t,iCondition:function(){return!this.dragEnabled},iAction:function(e,t){this._performSelectionCallback(t),this.__endExecute(),e()}};this.addTransition(n),this._bAllowEmptySel&&this.addEmptySelectionTransition(e,t,this._performEmptySelectionCallback);var i={iSender:this,iEvent:"dragEnd",iInitialState:e,iFinalState:t,iCondition:null,iAction:function(e){this.__endExecute(),e()}};this.addTransition(i)},_performSelectionCallback:function(e){this.isPaused()||(void 0!==this._startpos&&(e[0].position=this._startpos),this._performOperation(e))},_performEmptySelectionCallback:function(e,t){if(!this.isPaused()){var n=this.computeEmptySelectionInformation(t);n[0].pathElement=n[0].paths?n[0].paths[0]:void 0,n[0].position=this._computePositionOnEmptySpace(t),this._performOperation(n),this.__endExecute(),e()}},_computePositionOnEmptySpace:function(e){let n,i=e.from[0].getCurrentPosition(this._viewer.canvas),o=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()}),a=!1;return o&&(a="Document"===o.getDocumentType()||"Requirement"===o.getDocumentType())&&(n=new r.Vector3(0,0,0)),t.getNearPositionFrom2DCoordinates(i,this._viewer,n,a)}})});