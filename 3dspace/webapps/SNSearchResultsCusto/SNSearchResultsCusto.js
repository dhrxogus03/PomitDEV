define("DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SearchControlCenter/scripts/SearchControlCenterServices","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PlatformEnvServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNInfraUX/SNVocabAccess","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/FedDictionaryAccess/FedDicoUtils","text!DS/SNInfraUX/assets/SearchColumnCustoDS.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,s,a,n,o,r,u,l,d,c,h,p,m,v,b,w,f,g,y,S,C){"use strict";return t.singleton(s,i,{generalContext:null,ENDUSER_CUSTO:null,resources:null,_6wg_predicates:{},_predicatesInfo:{},setGeneralContext:function(t){this.generalContext=t,this.resources=new v({}),e.is(t.isSCC)&&e.is(t.tenant)&&(this.resources.active_tenant=t.tenant,this.spaceURL=m.getURL()),u.setResources({resources:this.resources}),f.setResources({resources:this.resources}),null===this.ENDUSER_CUSTO&&u.loadVocabulary("ds6w",function(e){console.log("ds6w vocabulary LOADED"),this.computeDefaultEndUSerCusto()}.bind(this))},getTenant:function(){return this.resources.active_tenant},getEndDefaultEndUSerCusto:function(){if(null!==this.ENDUSER_CUSTO)return this.ENDUSER_CUSTO;this.resources=new v({}),u.setResources({resources:this.resources}),u.loadVocabulary("ds6w",function(e){return console.log("ds6w vocabulary LOADED"),this.computeDefaultEndUSerCusto(),this.ENDUSER_CUSTO}.bind(this))},computeDefaultEndUSerCusto:function(){this.ENDUSER_CUSTO={version:"3",customizationId:"Default",viewMode:"all views",views:{Tile:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:project",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:project"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:dataSource",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:dataSource"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1}],LargeTile:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:project",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:project"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:dataSource",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:dataSource"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1}],Thumbnail:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:project",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:project"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:dataSource",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:dataSource"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1}],Datagrid:[{dataIndex:"ds6w:type",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:type"),width:"165px",type:"type",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:description",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:description"),width:"165px",type:"alpha",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:identifier",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:identifier"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:modified",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:modified"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:created",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:created"),width:"165px",type:"num",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6wg:revision",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:revision"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:status",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:status"),width:"82px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1},{dataIndex:"ds6w:responsible",name:null,dataTypeText:"",text:u.getNLSValueForPredicate("ds6w:responsible"),width:"165px",isSortable:!1,minWidth:40,defaultSort:"none",wrap:!1,pinned:"center",isRemovable:!1}]}}},custoDatagridMandatoryAttributes:function(e,t){var i=[];return"Datagrid"===e&&(i=[{name:"Title",uri:"ds6w:label",nlsName:u.getNLSValueForPredicate("ds6w:label"),Text:u.getNLSValueForPredicate("ds6w:label"),Visibility:!0,width:"auto",wrap:!1,custoMode:t},{name:"PLM_ExternalID",uri:"ds6w:identifier",nlsName:u.getNLSValueForPredicate("ds6w:identifier"),Text:u.getNLSValueForPredicate("ds6w:identifier"),Visibility:!0,width:"auto",wrap:!1,custoMode:t}]),i},custoDefaultAttributes:function(e,t){if(e)var i=[{name:"Title",uri:"ds6w:label",nlsName:u.getNLSValueForPredicate("ds6w:label"),Text:u.getNLSValueForPredicate("ds6w:label"),Visibility:!0,width:"auto",wrap:!1},{name:"PLM_ExternalID",uri:"ds6w:identifier",nlsName:u.getNLSValueForPredicate("ds6w:identifier"),Text:u.getNLSValueForPredicate("ds6w:identifier"),Visibility:!0,width:"auto",wrap:!1},{name:"originated",uri:"ds6w:created",nlsName:u.getNLSValueForPredicate("ds6w:created"),Text:u.getNLSValueForPredicate("ds6w:created"),Visibility:!0,width:"auto",wrap:!1},{name:"modified",uri:"ds6w:modified",nlsName:u.getNLSValueForPredicate("ds6w:modified"),Text:u.getNLSValueForPredicate("ds6w:modified"),Visibility:!0,width:"auto",wrap:!1},{name:"owner",uri:"ds6w:responsible",nlsName:u.getNLSValueForPredicate("ds6w:responsible"),Text:u.getNLSValueForPredicate("ds6w:responsible"),Visibility:!0,width:"auto",wrap:!1}];return i},formatCustoAttributes:function(t,i,s,a){var n=[],o={},r=!1;return t.length>0?t.forEach(function(t){r=!0,o={name:e.is(t.label)?t.label:t.name,uri:e.is(t.object)?t.object.uri:t.dataIndex,nlsName:e.is(t.label)?t.label:t.nlsName,Text:e.is(t.label)?t.label:t.nlsName,Visibility:r,custoMode:a},"general"===a&&(o.dataType=e.is(t.object)?t.object.dataType:""),s&&(o.width="auto",o.wrap=!1),n.push(o)}):"general"===a&&(n=this.custoDefaultAttributes(s,i)),n},custoComputeSources:async function(){var e=[],t=new Promise((t,i)=>{h.login({resources:this.resources,onComplete:i=>{for(let t=0;t<i.length;t++)e.push({value:i[t].name,label:C.get("adv_search.source."+i[t].name)});t(e)},onFailure:()=>{console.log("failed to recover datasources"),i(e)}})});return await t},isSourceAvailable:function(t){var i=y.getServiceBaseURL(f.getVocabularyName(t.value),this.resources.active_tenant);return!!e.is(i)},custoComputeAllTypes:async function(e){var t={items:[]};for(let a in e){var i=new Promise((t,i)=>{t(this.custoComputeTypes(e[a].value))}),s=await i;t.items=t.items.concat(s.items)}return t},custoComputeTypes:async function(e){var t;let i={vocabId:f.getVocabularyName(e)};this.generalContext.isSCC&&(i.tenantId=this.resources.active_tenant);var s=new Promise((s,a)=>{f.loadVocabularyClasses(i,i=>{if(i.classInfos.length>0){for(let t in i.classInfos)i.classInfos[t].label=i.classInfos[t].nlsName,i.classInfos[t].value=i.classInfos[t].uri,i.classInfos[t].source=e;t={name:e,items:i.classInfos},s(t)}else s(t={items:[]})})});return await s},custoComputePredefinedQuery:async function(){var t=new Promise((t,i)=>{this.generalContext.isSCC&&(this.resources.valid=!0,this.resources.spaceURL=this.spaceURL,this.resources.predefinedQuerySCC=!0),l.fetchPQsFromServer(this.resources).then(function(){var i=l.getPQs(),s=l.getPQNLS(),a=[];e.is(i)&&i.PQ.forEach(function(e){a.push({id:e.pqid,value:e.value,abbreviations:e.abbreviations,title:s[e.pqid+".Title"]})}),a.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}),t(a)}.bind(this))});return await t},custoComputeExtensions:async function(e,t){var i=[];for(let n in t){var s=new Promise((i,s)=>{i(this.custoComputeExtension(e,t[n].object.uri))}),a=await s;i.push(a)}return i},custoComputeExtension:async function(e,t){var i=[],s=new Promise((s,a)=>{f.loadRelevantInterfaces({className:t,currentDataSource:e},e=>{for(let t in e.interfaces)i.push({value:e.interfaces[t].name,name:e.interfaces[t].nlsName});s(i)})});return await s},custoComputeAllPredicates:async function(t,i,s){var a=[],n=[];t.forEach(function(e){s?a.push("ds6wg:"+e.object.uri):a.push(e.object.uri)}),e.is(i)&&i.forEach(function(e){n.push(e.object)});var o=a.concat(n);o.includes("ds6wg:PLMEntity")||o.push("ds6wg:PLMEntity");var r=[];for(let e in o){var u=new Promise((t,i)=>{t(this.custoComputePredicates([o[e]]))}),l=await u;l.forEach(function(t){t.dataType=o[e]}),r=r.concat(l)}return r.filter((e,t)=>t===r.findIndex(t=>e.uri===t.uri))},custoComputePredicates:async function(t){var i,s=[],n=this;e.is(n.resources.active_tenant)&&(i=n.resources.active_tenant),n._6wg_predicates.hasOwnProperty(i)||(n._6wg_predicates[i]={classPredicates:{}});var o=new Promise(function(i,o){e.is(t,"array")&&0!==t.length||o(new Error("No DS6WGTypeArray"));var r=t.join(","),u={idService:"Predicates",method:"POST",data:r};n.resources.getServicewithRole(u,function(t){t.onComplete=function(t){let n=null;e.is(t)&&(n=t,e.is(n,"object")&&e.is(n.classPredicates,"array")||(a.error("Invalid response to Predicates WS"+n),o(new Error("Invalid response to Predicates WS"))),n.classPredicates.forEach(function(e){e.vocabularyPredicateInfo.forEach(function(e){s.push(e)})})),i(s)},t.onFailure=function(e,t){n.log("_asyncCallToPredicatesWS fails"),o(e,t)},g.getPropertiesForClass(r,t)})});return await o}})}),define("DS/SNSearchResultsCusto/model/SNResultsCustomizationModel",["UWA/Class/Debug","UWA/Class/Model","UWA/Core"],function(e,t,i){"use strict";return t.extend(e,{customizationId:"",role:"",version:"3",customizedViews:[],views:{Tile:{general:[],type:[],predefinedQuery:[]},LargeTile:{general:[],type:[],predefinedQuery:[]},Thumbnail:{general:[],type:[],predefinedQuery:[]},Datagrid:{general:[],type:[],predefinedQuery:[]}},setup:function(){},getCustomizationId:function(){return i.is(this.customizationId)&&""!==this.customizationId?this.customizationId:null},setCustomizationId:function(e){this.customizationId=e},getCustomizationRole:function(){return i.is(this.role)&&""!==this.role?this.role:null},setCustomizationRole:function(e){this.role=e},getCustomizationVersion:function(){return i.is(this.version)?this.version:null},setCustomizationVersion:function(e){this.version=e},getViewDefinition:function(e,t){if(i.is(e))switch(e){case"Tile":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.Tile;if("general"===t)return this.views.Tile.general;if("type"===t)return this.views.Tile.type;if("predefinedQuery"===t)return this.views.Tile.predefinedQuery;case"LargeTile":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.LargeTile;if("general"===t)return this.views.LargeTile.general;if("type"===t)return this.views.LargeTile.type;if("predefinedQuery"===t)return this.views.LargeTile.predefinedQuery;case"Thumbnail":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.Thumbnail;if("general"===t)return this.views.Thumbnail.general;if("type"===t)return this.views.Thumbnail.type;if("predefinedQuery"===t)return this.views.Thumbnail.predefinedQuery;case"Datagrid":if("general"!==t&&"type"!==t&&"predefinedQuery"!==t)return this.views.Datagrid;if("general"===t)return this.views.Datagrid.general;if("type"===t)return this.views.Datagrid.type;if("predefinedQuery"===t)return this.views.Datagrid.predefinedQuery}},setViewDefinition:function(e,t,s,a,n){if(i.is(s,"array")&&i.is(e)&&i.is(t)){var o;if("Tile"===e||"all views"===e)if("type"===t){if(i.is(a))(o=this.views.Tile.type.findIndex(e=>e.id===a))>-1?this.views.Tile.type[o].viewDefinition=s:this.views.Tile.type.push({id:a,label:n,viewDefinition:s})}else if("predefinedQuery"===t){if(i.is(a))(r=this.views.Tile.predefinedQuery.findIndex(e=>e.id===a))>-1?this.views.Tile.predefinedQuery[r].viewDefinition=s:this.views.Tile.predefinedQuery.push({id:a,label:n,viewDefinition:s})}else this.views.Tile.general=s;if("LargeTile"===e||"all views"===e)if("type"===t){if(i.is(a))(o=this.views.LargeTile.type.findIndex(e=>e.id===a))>-1?this.views.LargeTile.type[o].viewDefinition=s:this.views.LargeTile.type.push({id:a,label:n,viewDefinition:s})}else if("predefinedQuery"===t){if(i.is(a))(r=this.views.LargeTile.predefinedQuery.findIndex(e=>e.id===a))>-1?this.views.LargeTile.predefinedQuery[r].viewDefinition=s:this.views.LargeTile.predefinedQuery.push({id:a,label:n,viewDefinition:s})}else this.views.LargeTile.general=s;if("Thumbnail"===e||"all views"===e)if("type"===t){if(i.is(a))(o=this.views.Thumbnail.type.findIndex(e=>e.id===a))>-1?this.views.Thumbnail.type[o].viewDefinition=s:this.views.Thumbnail.type.push({id:a,label:n,viewDefinition:s})}else if("predefinedQuery"===t){if(i.is(a))(r=this.views.Thumbnail.predefinedQuery.findIndex(e=>e.id===a))>-1?this.views.Thumbnail.predefinedQuery[r].viewDefinition=s:this.views.Thumbnail.predefinedQuery.push({id:a,label:n,viewDefinition:s})}else this.views.Thumbnail.general=s;if("Datagrid"===e||"all views"===e)if("type"===t){if(i.is(a))(o=this.views.Datagrid.type.findIndex(e=>e.id===a))>-1?this.views.Datagrid.type[o].viewDefinition=s:this.views.Datagrid.type.push({id:a,label:n,viewDefinition:s})}else if("predefinedQuery"===t){var r;if(i.is(a))(r=this.views.Datagrid.predefinedQuery.findIndex(e=>e.id===a))>-1?this.views.Datagrid.predefinedQuery[r].viewDefinition=s:this.views.Datagrid.predefinedQuery.push({id:a,label:n,viewDefinition:s})}else this.views.Datagrid.general=s}},getAllViewsDefinitions:function(){if(i.is(this.views))return this.views},setAllViewsDefinition:function(e){this.views=e},getAllAttributesByView:function(e){if(i.is(e))switch(e){case"Tile":var t=[];return i.is(this.views.Tile.general,"array")?t=this.views.Tile.general.concat(this.views.Tile.type,this.views.Tile.predefinedQuery):i.is(this.views.Tile,"array")&&(t=this.views.Tile),t;case"LargeTile":var s=[];return i.is(this.views.LargeTile.general,"array")?s=this.views.LargeTile.general.concat(this.views.LargeTile.type,this.views.LargeTile.predefinedQuery):i.is(this.views.LargeTile,"array")&&(s=this.views.LargeTile),s;case"Thumbnail":var a=[];return i.is(this.views.Thumbnail.general,"array")?a=this.views.Thumbnail.general.concat(this.views.Thumbnail.type,this.views.Thumbnail.predefinedQuery):i.is(this.views.Thumbnail,"array")&&(a=this.views.Thumbnail),a;case"Datagrid":var n=[];return i.is(this.views.Datagrid.general,"array")?n=this.views.Datagrid.general.concat(this.views.Datagrid.type,this.views.Datagrid.predefinedQuery):i.is(this.views.Datagrid,"array")&&(n=this.views.Datagrid),n}},setCustomizedViews:function(e){this.customizedViews=[e]},getCustomizedViews:function(){return i.is(this.customizedViews)?(i.is(this.customizedViews),this.customizedViews[0]):null},setCustomizationFromJSON:function(e){return this.setCustomizationId(e.customizationId),this.setCustomizationRole(e.role),this.setCustomizationVersion(e.version),this.setCustomizedViews(e.customizedViews),this.setAllViewsDefinition(e.views),this},exportCustomizationToJSON:function(e){var t={SearchAttributesDisplayAdminDefinition:[]},i={customizationId:this.customizationId,role:this.role,version:this.version,customizedViews:this.getCustomizedViews(),views:this.getAllViewsDefinitions()};return"SearchAttributesDisplayAdminDefinition"===e?(t.SearchAttributesDisplayAdminDefinition.push(i),t):i}})}),define("DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchRessources","DS/SNResultUX/utils/SearchViewOptions","DS/MessageBus/MessageBus","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNSearchResultsCusto/model/SNResultsCustomizationModel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/SNInfraUX/assets/SearchColumnCustoDS.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,s,a,n,o,r,u,l,d,c,h,p,m,v,b,w){"use strict";var f=function(e,t){var i=0;return e.label>t.label?i=1:e.label<t.label&&(i=-1),i};return t.singleton(s,i,{ENDUSER_CUSTO:{},BETAcustomizationEnabled:null,_adminCusto:null,_dsCusto:null,_displayNameCusto:null,_displayNameCustoObject:null,fixColumnUnsortable:["ds6wg:_displayName_"],fixColumnSortableFor1000:["ds6w:modified","ds6w:label","ds6w:created","ds6w:responsible"],DEFAULT_FIELDS:{"ds6w:modified":"num","ds6w:label":"alpha","ds6w:created":"num","ds6w:responsible":"alpha","ds6w:type":"group"},SearchResultsActiveCusto:{version:"3",customizationId:"",views:{Tile:[],LargeTile:[],Thumbnail:[],Datagrid:[]}},SearchResultsCustomizations:[],init:function(){this.loadBETAOptionfromTenantSettings(),this._dictionnary=[],this.setDebugMode(n.getDebugMode());try{this._dsCusto=JSON.parse(b),this._addMissingPredicates(this._dsCusto),a.log("DS custo:",this._dsCusto),this._adminCusto=this.upgradeJSONCustomization(r.getAdminCustoDefinition()),this._addMissingPredicates(this._adminCusto)}catch(e){a.error("Error parsing SearchColumnCustoAdmin.json:",e)}},isBETAEnabled:function(){var t=n.getOption("results_attributes_display_customization",{tenant:r.getActiveTenant()});return e.is(t)?(this.BETAcustomizationEnabled=!0===t.BETAcustomizationEnabled,!0===t.BETAcustomizationEnabled):e.is(this.BETAcustomizationEnabled,"Boolean")?this.BETAcustomizationEnabled:void 0},_addMissingPredicates:function(t){if(e.is(t.SearchColumnCustoDSDefinition,"array"))for(var i=0;i<t.SearchColumnCustoDSDefinition.length;i++){var s=t.SearchColumnCustoDSDefinition[i].viewDefinition;this.addMandatoryPredicates(s)}},addMandatoryPredicates:function(t){if(e.is(t,"array")&&!(0>=t.length)){var i,s=["ds6w:identifier","ds6w:type"];for(i=s.length-1;i>=0;i--)for(var a=0,n=t.length;a<n;a++)if(t[a].uri.endsWith(s[i])){s.splice(i,1);break}for(i=s.length-1;i>=0;i--)t.push({uri:s[i],width:"auto"})}},setDefaultCustomization:function(){this.ENDUSER_CUSTO=m.getEndDefaultEndUSerCusto(),this.setActiveCustomizationInLocalStorage(this.ENDUSER_CUSTO)},saveCustomization:function(t,i){this.SearchResultsActiveCusto=t.exportCustomizationToJSON();var s=this.getUserCustomizations();if(e.is(s)&&(this.SearchResultsCustomizations=s),-1===this.SearchResultsCustomizations.findIndex(e=>e.customizationId===t.customizationId))this.SearchResultsCustomizations.push(this.SearchResultsActiveCusto),this.setUserCustomizationsInLocalStorage(this.SearchResultsCustomizations);else{var a=this.SearchResultsCustomizations.findIndex(e=>e.customizationId===t.customizationId);this.SearchResultsCustomizations[a]=this.SearchResultsActiveCusto,this.setUserCustomizationsInLocalStorage(this.SearchResultsCustomizations)}i&&this.setActiveCustomizationInLocalStorage(this.SearchResultsActiveCusto),d.publish({channel:"3dSearch_results_customization",topic:"3dSearch_new_customization_in_localStorage"})},loadBETAOptionfromTenantSettings:async function(){var t=new Promise(t=>{t(n.getTenantSettings(r.getActiveTenant()).then(function(){var t=n.getOption("results_attributes_display_customization",{tenant:r.getActiveTenant()});e.is(t)?e.is(t.BETAcustomizationEnabled)&&(t.BETAcustomizationEnabled?this.BETAcustomizationEnabled=!0:this.BETAcustomizationEnabled=!1):this.BETAcustomizationEnabled=!1}.bind(this)))});if(await t)return this.BETAcustomizationEnabled},loadCustomizationTenantSettings:function(t){var i=t||m.getTenant(),s=this.getActiveCustomization();n.getTenantSettings(i).then(function(){var t=n.getOption("results_attributes_display_customization",{tenant:i});if(e.is(t)&&e.is(t.BETAcustomizationEnabled)&&(t.BETAcustomizationEnabled?this.BETAcustomizationEnabled=!0:this.BETAcustomizationEnabled=!1),e.is(t)&&e.is(t.SearchAttributesDisplayAdminDefinition[0])){var a=t.SearchAttributesDisplayAdminDefinition[0],o=new p;o.setCustomizationId(a.customizationId),o.setCustomizationRole("admin"),o.setCustomizedViews(a.customizedViews),o.setAllViewsDefinition(a.views),e.is(s)?this.saveCustomization(o,!1):this.saveCustomization(o,!0)}}.bind(this)),this._updatePreviousColumnCustomizations(s)},setActiveCustomizationInLocalStorage:function(e){o.setItem("3dSearchResultsActiveCustomization",e),o.commit()},setUserCustomizationsInLocalStorage:function(e){o.setItem("3dSearchResultsCustomizations",e),o.commit()},switchActiveCustomization:function(t){if("Default"===t)this.setDefaultCustomization();else if(e.is(this.getUserCustomizations())){var i=this.getUserCustomizations().find(e=>e.customizationId===t);this.setActiveCustomizationInLocalStorage(i)}},getActiveCustomization:function(){var t={};if(t=o.getItem("3dSearchResultsActiveCustomization"),e.is(t))t=(new p).setCustomizationFromJSON(t);else if(void 0===t&&void 0!==o.getItem("DataGridColumnCusto")){var i=o.getItem("DataGridColumnCusto"),s=r.getAdminCustoDefinition().SearchColumnCustoAdminDefinition;if(e.is(s)&&e.is(i.activeView)){this.SearchResultsActiveCusto.customizationId=i.activeView;var a=s.findIndex(e=>e.viewId===i.activeView.split("-ADMIN",1)[0]);this.SearchResultsActiveCusto.role=a>-1?"admin":"user",this.SearchResultsActiveCusto.adminCusto=a>-1}var n=i.views.findIndex(e=>e.viewId===i.activeView);n>-1&&(this.SearchResultsActiveCusto.customizationId=i.activeView,this.SearchResultsActiveCusto.version=i.views[n].version,this.SearchResultsActiveCusto.views.Datagrid.general=i.views[n].viewDefinition)}return void 0!==t?t:""!==this.SearchResultsActiveCusto.customizationId?this.SearchResultsActiveCusto:null},getCustomizationById:function(t){var i=this.getUserCustomizations().find(e=>e.customizationId===t);return e.is(i)&&(i=(new p).setCustomizationFromJSON(i)),i},getUserCustomizations:function(){var t=o.getItem("3dSearchResultsCustomizations");return e.is(t)?t:[]},copyCustomization:function(t,i,s){var a=this.getUserCustomizations();if(e.is(a)){var n=a.find(e=>e.customizationId===t);if(e.is(n)){var o=new p;o.setCustomizationId(i),o.setCustomizationRole(s),o.setCustomizationVersion(n.version),o.setAllViewsDefinition(n.views),o.setCustomizedViews(n.customizedViews),this.saveCustomization(o,!1)}}else console.log("Failed to copy the customization")},deleteCustomization:function(t){var i=this.getUserCustomizations();if(e.is(i,"array")){var s=i.findIndex(e=>e.customizationId===t);-1!==s&&i.splice(s,1)}null!==this.getActiveCustomization()&&this.getActiveCustomization().getCustomizationId()===t&&this.setDefaultCustomization(),this.setUserCustomizationsInLocalStorage(i),d.publish({channel:"3dSearch_results_customization",topic:"3dSearch_customization_deleted_from_localStorage"})},getViewModeForCustomization:function(){switch(void 0!==o.getItem("LastSearchViewMode")?o.getItem("LastSearchViewMode"):"tile"){case"tile":return"Tile";case"tilebig":return"LargeTile";case"thumbnail":return"Thumbnail";case"table":return"Datagrid"}},buildSubLab:function(t,i,s){var a=[],n=t.getType?t.getType():t.type,r=this.getActiveCustomization();if(e.is(r)){var u=void 0!==o.getItem("LastSearchViewMode")?o.getItem("LastSearchViewMode"):"tile",l=r.views.Tile;switch(u){case"tile":if("Tile"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return a;l=r.views.Tile;break;case"tilebig":if("LargeTile"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return a;l=r.views.LargeTile;break;case"thumbnail":if("Thumbnail"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return a;l=r.views.Thumbnail;break;case"table":if("Datagrid"!==r.getCustomizedViews()&&"all views"!==r.getCustomizedViews())return a;l=r.views.Datagrid}var d=function(e){return e.slice(e.indexOf(":")+1)};if(e.is(s)&&s&&i){var c=i.split(":")[0];l.predefinedQuery.forEach(function(e){if(e.label.split(" ")[0].split(",").findIndex(e=>e===c)>=0)return e.viewDefinition.forEach(function(e){a.push(e.dataIndex)}),a})}else{var h=l.type.findIndex(e=>d(e.id)===d(n));h>=0?l.type[h].viewDefinition.forEach(function(e){a.push(e.dataIndex)}):l.general.forEach(function(e){a.push(e.dataIndex)})}}return a},buildUserCustomizationList:function(){var t=[],i=this.getActiveCustomization(),s=this.getUserCustomizations(),a=this._adminCusto,n=s.concat(a);return i=e.is(i)?i.customizationId||i.getCustomizationId():"Default",e.is(n)&&e.is(n)&&n.forEach(function(e){e.customizationId===i?t.unshift(e.customizationId):t.push(e.customizationId)}),t.findIndex(e=>"Default"===e)<0&&t.push("Default"),t=t.filter((e,i)=>i===t.findIndex(t=>e===t))},getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){0==i.indexOf("sixw:")?(t[i]=t[i]||[],(e[i]||[]).forEach(function(e){t[i].push(e)})):(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],s=e.value||[],a=e.field;i.forEach(function(i,n){t[i.predicate]||(t[i.predicate]=[]);var o={disptext:e.display,object:s[n],type:i.type,field:a?[a[n]]:["implicit"]};t[i.predicate].push(o)})})})}),t},getAvailableCustomizations:function(t,i){if(!e.is(t,"object")||!e.is(t.isPQ))throw new Error("E_INVALIDARG: bad iContext given to getAvailableCustomizations method !");var s=[],a=[],o=this.getUserCustomizations();e.is(o)&&(a=o);var r=0,u=null,d=0,c=0,h=null;if(e.is(a,"array")){for(d=0;d<a.length;d++)u={label:a[d].customizationId,value:a[d].customizationId,viewMode:a[d].customizedViews,adminCusto:!1},"admin"===a[d].role&&(u.adminCusto=!0),s.push(u);s.sort(f)}var p=[],m=[];if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){if(this._adminCusto.SearchColumnCustoAdminDefinition.length>0)m=this._adminCusto;else{let t=n.getOption("column_custo",{tenant:i});e.is(t)&&e.is(t.searchColumnCustoInputs,"object")&&e.is(t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,"array")&&t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition.length>0&&(m=t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,this._adminCusto=t.searchColumnCustoInputs),e.is(t)&&e.is(t.searchDisplayCustoInputs,"object")&&(this._displayNameCusto=t.searchDisplayCustoInputs)}for(d=0;d<m.length;d++)if(e.is(m[d].customizationId,"string")&&"The_Default_Columns"!==m[d].customizationId){if(u={label:m[d].customizationId,value:m[d].customizationId,viewMode:m[d].customizedViews,adminCusto:!0},0===m[d].customizationId.indexOf("###"))if(e.is(m[d].views.Datagrid.general,"array"))h=m[d].customizationId.substring(3,m[d].customizationId.length),u.label=w.replace(w.get("custo_PQ"),{PQ:h});else if(e.is(m[d].custoAliasToUse,"string")){var v=m[d].customizationId.substring(3,m[d].customizationId.length);u.label=w.replace(w.get("custo_type"),{type:v})}p.push(u)}p.sort(f)}if(s.length>0&&p.length>0){var b=w.get("SearchColumnCustoUserGroup"),g=w.get("SearchColumnCustoAdminGroup");for(d=0,c=s.length;d<c;d++)s[d].group=b;for(d=0,c=p.length;d<c;d++)p[d].group=g}var y=s.concat(p),S=!1,C=!1,z=null;if(e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0&&(z=t.forcedCusto),!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var _="###"+t.typeName.pqName;if(e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array")){var x=this._dsCusto.SearchColumnCustoDSDefinition;for(d=0;d<x.length&&!C;d++)e.is(x[d].viewId,"string")&&x[d].viewId===_&&z===_&&(C=!0,z=_)}for(d=0,r=y.length;d<r&&!S;d++)_===y[d].value&&(y[d].selected=!0,S=!0,z=_)}if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var I="###"+t.typeName.pqName;if((!e.is(z)||!z.startsWith(I))&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array")){x=this._dsCusto.SearchColumnCustoDSDefinition;for(d=0;d<x.length;d++)if(e.is(x[d].viewId,"string")&&x[d].viewId===I){z=I+"-HIDDEN",u={label:"Customized PQ: "+t.typeName.pqName,value:z,viewMode:"Datagrid"},y.push(u);break}}if(!e.is(z)||!z.startsWith(I)){var D=l.getViewData();if(e.is(D)&&e.is(D.SearchColumnCustoDefinition)){var P=D.SearchColumnCustoDefinition;e.is(P)&&e.is(P.viewId,"string")&&P.viewId===I&&(z=I+"-HIDDEN",u={label:"Customized PQ: "+t.typeName.pqName,value:z,viewMode:"Datagrid"},y.push(u))}}}}var V=this.getActiveCustomization();if(e.is(V)&&(V=V.customizationId),!S&&!C&&e.is(a,"array")&&e.is(V,"string"))for(t.isPQ&&(!e.is(t.forcedCusto,"string")||t.forcedCusto.length<=0)?e.is(z)||(z=V):z=t.isPQ&&e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0?t.forcedCusto:V,d=0,r=y.length;d<r&&!S;d++)z===y[d].value&&(y[d].selected=!0,S=!0);return y},getCustomizationIdToUse:function(t,i){if(e.is(t.forcedCusto))return t.forcedCusto;var s=this.getViewModeForCustomization(),a=this.getAvailableCustomizations(t,i),n="The_Default_Columns";if(e.is(a,"array")&&a.length)for(var o=0,r=a.length;o<r;o++)if(e.is(a[o].selected)&&!0===a[o].selected){s!==a[o].viewMode&&"all views"!==a[o].viewMode||(n=a[o].value);break}if(!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){this._pqName=t.typeName.pqName;var u="###"+this._pqName;if(!n.startsWith(u)&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(var d=this._dsCusto.SearchColumnCustoDSDefinition,c=0;c<d.length;c++)if(e.is(d[c].viewId,"string")&&d[c].viewId===u){n=u+"-HIDDEN";break}if(!n.startsWith(u)){var h=l.getViewData();if(e.is(h)&&e.is(h.SearchColumnCustoDefinition)){var p=h.SearchColumnCustoDefinition;e.is(p)&&e.is(p.viewId,"string")&&p.viewId===u&&(n=u+"-HIDDEN")}}}}else this._pqName=null;return n},getCustomizationDefinitionFromCustoId:function(t,i,s){var a=this.getUserCustomizations(),n=[],o=null,u=null,d=this._getDefaultColumnsForInApps(i),h=[],p=0,m=0,v=0,b=-1,w=-1,f=null,g=0;for(p=0,m=d.length;p<m;p++)h.push(d[p].dataIndex);if("The_Default_Columns"===t)n=this._getDefaultColumns(i);else{var y=a.find(e=>e.customizationId===t);if(e.is(y)&&e.is(y.customizedViews))"all views"===y.customizedViews?n=y.views[this.getViewModeForCustomization()]:e.is(y.views)&&e.is(y.customizedViews)&&(n=y.views[y.customizedViews]);else{if(!e.is(null,"array")||0===null.length){var S=this._adminCusto;for(this._adminCusto.CustoAliasDefinitions,p=0;p<S.length;p++)if(t===S[p].customizationId){if(S[p].views.Datagrid.general.length>0&&e.is(null,"array")){for(v=0;v<null.length;v++)null[v].dataIndex=null[v].uri,b=null[v].uri.indexOf(":"),w=null[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=null[v].uri.substring(0,w)),null[v].dataType=f,null[v].isSortable=!0,null[v].minWidth=40,null[v].text=c.getNLSValueForPredicate(null[v].uri),null[v].visibility=!0,null[v].visibilityEditable=!1,null[v].defaultSort="none",null[v].wrap=!1,null[v].pinned="center",g=parseInt(null[v].width,10),null[v].width=isNaN(g)?"auto":g;n=null}if(S[p].views.Datagrid.type.length>0&&e.is(null,"array")){for(v=0;v<null.length;v++)null[v].dataIndex=null[v].uri,b=null[v].uri.indexOf(":"),w=null[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=null[v].uri.substring(0,w)),null[v].dataType=f,null[v].isSortable=!0,null[v].minWidth=40,null[v].text=c.getNLSValueForPredicate(null[v].uri),null[v].visibility=!0,null[v].visibilityEditable=!1,null[v].defaultSort="none",null[v].wrap=!1,null[v].pinned="center",g=parseInt(null[v].width,10),null[v].width=isNaN(g)?"auto":g;n=null}if(S[p].views.Datagrid.predefinedQuery.length>0&&e.is(null,"array")){for(v=0;v<null.length;v++)null[v].dataIndex=null[v].uri,b=null[v].uri.indexOf(":"),w=null[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=null[v].uri.substring(0,w)),null[v].dataType=f,null[v].isSortable=!0,null[v].minWidth=40,null[v].text=c.getNLSValueForPredicate(null[v].uri),null[v].visibility=!0,null[v].visibilityEditable=!1,null[v].defaultSort="none",null[v].wrap=!1,null[v].pinned="center",g=parseInt(null[v].width,10),null[v].width=isNaN(g)?"auto":g;n=null}break}}if(!e.is(o,"array")||0===o.length){var C=this._dsCusto.SearchColumnCustoDSDefinition;for(p=0,m=C.length;p<m;p++)if(t===C[p].viewId+"-HIDDEN"){if(o=e.clone(C[p].viewDefinition),e.is(o,"array"))for(v=0;v<o.length;v++)o[v].dataIndex=o[v].uri,b=o[v].uri.indexOf(":"),w=o[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=o[v].uri.substring(0,w)),o[v].dataType=f,o[v].isSortable=!0,o[v].minWidth=40,o[v].text=c.getNLSValueForPredicate(o[v].uri),o[v].visibility=!0,o[v].visibilityEditable=!1,o[v].defaultSort="none",o[v].wrap=!1,o[v].pinned="center",g=parseInt(o[v].width,10),o[v].width=isNaN(g)?"auto":g,-1===h.indexOf(o[v].dataIndex)&&n.push(o[v]);break}}if(!e.is(u,"array")||0===u.length){var z=null,_=l.getViewData();if(e.is(_)&&e.is(_.SearchColumnCustoDefinition)&&(z=l.getViewData().SearchColumnCustoDefinition),z&&t===z.viewId+"-HIDDEN"&&(u=e.clone(z.viewDefinition),e.is(u,"array")))for(v=0;v<u.length;v++)u[v].dataIndex=u[v].uri,b=u[v].uri.indexOf(":"),w=u[v].uri.indexOf("."),f=null,b>0&&w>0&&w>b&&(f=u[v].uri.substring(0,w)),u[v].dataType=f,u[v].isSortable=!0,u[v].minWidth=40,u[v].text=c.getNLSValueForPredicate(u[v].uri),u[v].visibility=!0,u[v].visibilityEditable=!1,u[v].defaultSort="none",u[v].wrap=!1,u[v].pinned="center",g=parseInt(u[v].width,10),u[v].width=isNaN(g)?"auto":g,-1===h.indexOf(u[v].dataIndex)&&n.push(u[v])}}}if(r.isFUN096612Active()){var x=[],I=n.length;if(I>0)for(var D=0;D<I;D++)if(e.is(n[D])&&e.is(n[D].dataIndex,"string")&&"ds6wg:_displayName_"===n[D].dataIndex){n.splice(D,1);break}var P=this.getDisplayNameColumn(this._pqName);e.is(P)&&(x.push(P),d=x.concat(d))}if(e.is(n)){if(e.is(s)&&e.is(n.general))if(s.isPQ&&e.is(this._pqName)){var V=[];n.predefinedQuery.forEach(function(e){e.label.split(" ")[0].split(",").findIndex(e=>e===this._pqName)>=0&&e.viewDefinition.forEach(function(e){V.push(e)})}.bind(this)),n=V}else n=null!==s.typeName?n.type:n.general;for(p=0,m=n.length;p<m;p++)e.is(n[p])&&e.is(n[p].dataIndex,"string")&&(n[p].dataIndex=r.getURIToUse(n[p].dataIndex))}return n},getCustomizationDefinitionFromCustoIdAndType:function(t,i,s){let a=null;if(e.is(i)&&e.is(s)){var n=this.getCustomizationById(t);e.is(n)&&n.views[i].type.forEach(function(e){e.id.slice(e.id.indexOf(":")+1)===s&&(a=e.viewDefinition)})}return a},_getDefaultColumns:function(e){var t=l.getDataGridViewHeaders(e);return this._completeColumnDefinition(t),t},getDisplayNameColumn:function(t){var i=null;if(e.is(this._displayNameCusto,"object")&&e.is(this._displayNameCusto.CustoDisplayName,"array")){var s=this._displayNameCusto.CustoDisplayName.length;if(s>0)for(var a=0;a<s;a++)this._displayNameCusto.CustoDisplayName[a].viewId+"-ADMIN"!==t&&this._displayNameCusto.CustoDisplayName[a].viewId!=="###"+t||(i={uri:"ds6wg:_displayName_",width:"auto",dataIndex:"ds6wg:_displayName_",dataType:null,isSortable:!1,minWidth:40,text:"ds6wg:_displayName_",visibility:!0,visibilityEditable:!1,defaultSort:"none",wrap:!1,pinned:"left"})}return i},getColumnCustomizationDefinitionFromAliasCustoId:function(t){var i=[],s=[],a=0,n=0;if(!e.is(t,"string")||0===t.length)throw new Error("Invalid Arg in SearchCustoServices.getColumnCustomizationDefinitionFromAliasCustoId!");var o=[];for(a=0,n=(i=this._getDefaultColumnsForInApps()).length;a<n;a++)o.push(i[a].dataIndex);if(e.is(this._adminCusto)){var r=this._adminCusto.CustoAliasDefinitions;if(e.is(r))for(a=0,n=r.length;a<n;a++)if(t===r[a].aliasId){var u=e.clone(r[a]);if(e.is(u.viewDefinition,"array")){s=u.viewDefinition;for(var l=0;l<s.length;l++){s[l].dataIndex=s[l].uri;var d=s[l].uri.indexOf(":"),h=s[l].uri.indexOf("."),p=null;d>0&&h>0&&h>d&&(p=s[l].uri.substring(0,h)),s[l].dataType=p,s[l].isSortable=!0,s[l].minWidth=40,s[l].text=c.getNLSValueForPredicate(s[l].uri),s[l].visibility=!0,s[l].visibilityEditable=!1,s[l].defaultSort="none",s[l].wrap=!1,s[l].pinned="center";var m=parseInt(s[l].width,10);s[l].width=isNaN(m)?"auto":m,-1===o.indexOf(s[l].dataIndex)&&i.push(s[l])}}break}}return i},_getDefaultColumnsForInApps:function(){var e=l.getDataGridViewHeadersForInApps();return this._completeColumnDefinition(e),e},_completeColumnDefinition:function(e){var t=this,i=o.getItem("listColumnsWidth");if(i)try{var s=JSON.parse(i),n=Object.keys(s);e.forEach(function(e){e.width=-1===n.indexOf(e.dataIndex)?"auto":s[e.dataIndex],e.isSortable=t.isColumnSortable(e.dataIndex)})}catch(e){a.log(e)}else e.forEach(function(e){e.isSortable=t.isColumnSortable(e.dataIndex)})},getColumnCustomizations:function(){var t=o.getItem("DataGridColumnCusto");e.is(t)&&e.is(t.views,"array")?t.views.forEach(function(t){var i=r.getAdminCustoDefinition().SearchColumnCustoAdminDefinition;if(e.is(i)){var s=i.findIndex(e=>e.viewId===t.viewId.split("-ADMIN",1)[0]);t.adminCusto=s>-1}}):t={views:[]};var i=this.getUserCustomizations();e.is(i)&&e.is(i,"array")&&i.forEach(function(i){(e.is(i.viewMode)&&"Datagrid"===i.viewMode||"all views"===i.viewMode)&&t.views.push({viewId:i.customizationId,version:i.version,viewDefinition:i.views.Datagrid,viewDefinitionHidden:[]})});var s=this.getActiveCustomization();if(e.is(s)){var a=t.views.findIndex(e=>e.viewId===s.customizationId);(e.is(s.viewMode)&&a>-1&&"Datagrid"===s.viewMode||"all views"===s.viewMode)&&(t.activeView=s.customizationId)}return e.is(t)?t:{}},_updatePreviousColumnCustomizations:function(t){if(-1===this.getUserCustomizations().findIndex(e=>"ENDUSER_CUSTO"===e.customizationId)){var i=o.getItem("DataGridColumnCusto");e.is(i)&&e.is(i.views,"array")&&i.views.forEach(function(t){var s=r.getAdminCustoDefinition().SearchColumnCustoAdminDefinition;if(e.is(s)){var a=s.findIndex(e=>e.viewId===t.viewId.split("-ADMIN",1)[0]);t.adminCusto=a>-1}var n=new p;n.setCustomizationId(t.viewId),t.adminCusto?n.setCustomizationRole("admin"):n.setCustomizationRole("user"),n.setCustomizedViews("Datagrid"),n.setViewDefinition("Datagrid","general",t.viewDefinition),i.activeView===t.viewId?this.saveCustomization(n,!0):this.saveCustomization(n,!1)}.bind(this))}},isColumnSortable:function(e){return!(-1!==this.fixColumnUnsortable.indexOf(e))},isColumnSortableFor1000:function(e){return-1!==this.fixColumnSortableFor1000.indexOf(e)},createJSONadminCustomizationFile:function(e){return r.getAdminCustoDefinition()},isJSONConvertionAllowed:function(){return window.location.href.indexOf("JSONConvertionFUN140670")>-1},upgradeJSONCustomization:function(t){var i=[];if(this.isJSONConvertionAllowed()&&e.is(t.SearchColumnCustoAdminDefinition,"array")){var s=t.SearchColumnCustoAdminDefinition,a=t.CustoAliasDefinitions;s.forEach(function(t){var s={customizationId:"",role:"admin",version:"3",customizedViews:["Datagrid"],views:{Tile:{general:[],type:[],predefinedQuery:[]},LargeTile:{general:[],type:[],predefinedQuery:[]},Thumbnail:{general:[],type:[],predefinedQuery:[]},Datagrid:{general:[],type:[],predefinedQuery:[]}}};if(e.is(t.viewId)&&(s.customizationId=t.viewId),0===t.viewId.indexOf("###")){if(e.is(t.viewDefinition,"array"))sPQ=t.viewId.substring(3,t.viewId.length),s.views.Datagrid.predefinedQuery.push({id:sPQ,viewDefinition:t.viewDefinition});else if(e.is(t.custoAliasToUse,"string")){var n=t.viewId.substring(3,t.viewId.length);e.is(a);var o=a.findIndex(e=>e.aliasId===t.custoAliasToUse);s.views.Datagrid.type.push({id:n,viewDefinition:a[o].viewDefinition})}}else e.is(t.viewDefinition,"array")&&(s.views.Datagrid.general=viewDefinition);i.push(s)})}return i}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomization_GlobalView",["UWA/Class/View","UWA/Class/Debug","UWA/Core","UWA/Element","DS/Controls/Button","DS/Controls/Expander","DS/Controls/LineEditor","DS/Controls/TooltipModel","DS/Spreadsheet/DataGrid","DS/Controls/ResponsiveTileView","DS/SNResultUX/utils/ExternalComponentHelpers","DS/WebappsUtils/WebappsUtils","DS/MessageBus/MessageBus","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,a,n,o,r,u,l,d,c,h,p,m,v,b){"use strict";return e.extend(t,{generalView:null,container:null,savedCustomizations:null,cog_image:c.getWebappsAssetUrl("SNSearchResultsCusto","images/cog_image.png"),views:[{id:"Tile",nls:v.get("custoPanel.view.tile"),icon:"view-small-tile wux-ui-3ds"},{id:"Datagrid",nls:v.get("custoPanel.view.datagrid"),icon:"view-list wux-ui-3ds"},{id:"LargeTile",nls:v.get("custoPanel.view.largeTile"),icon:"view-big-tile wux-ui-3ds"},{id:"Thumbnail",nls:v.get("custoPanel.view.thumbnail"),icon:"view-big-thb wux-ui-3ds"}],ENDUSER_CUSTO:{customizationId:"Default",customizedViews:"all views",role:"admin",attributes:{general:{responsiveCollectionViews:[v.get("custoPanel.attributes.type"),v.get("custoPanel.attributes.revision"),v.get("custoPanel.attributes.maturity"),v.get("custoPanel.attributes.owner"),v.get("custoPanel.attributes.modificationDate"),v.get("custoPanel.attributes.collaborativeSpace"),v.get("custoPanel.attributes.source")],datagrid:[v.get("custoPanel.attributes.type"),v.get("custoPanel.attributes.description"),v.get("custoPanel.attributes.uniqueName"),v.get("custoPanel.attributes.modificationDate"),v.get("custoPanel.attributes.creationDate"),v.get("custoPanel.attributes.revision"),v.get("custoPanel.attributes.maturity"),v.get("custoPanel.attributes.owner")]},type:[],predefinedQuery:[]}},init:function(e){return this.container=e.container,this.generalView=e.elements,this.role=e.role,this.isSCC=e.isSCC,this._parent(e)},_buildGeneralView:function(){this.generalView.mainContainer.classList.contains("customization-panel")&&this.generalView.mainContainer.removeClassName("customization-panel"),this.generalView.mainContainer.classList.contains("customization-panel-SCC")&&this.generalView.mainContainer.removeClassName("customization-panel-SCC"),this.isSCC?this.generalView.mainContainer.addClassName("general-panel-SCC"):this.generalView.mainContainer.addClassName("general-panel"),this.generalView.mainContainer.empty();var e=s.create("div",{class:"selection-view-container"}),t=s.create("div",{class:"expander-navigation-body-container"}).inject(e);this.generalView.saved_custo_container_admin=s.create("div",{class:"search-saved-custo-container"}),this.generalView.saved_custo_container_user=s.create("div",{class:"search-saved-custo-container"});var o=function(){var e=s.create("div",{class:"expander-navigation-body"});new n({header:v.get("custoPanel.general.expander.admin"),body:this.generalView.saved_custo_container_admin,style:"simple",icon:"user-cog wux-ui-3ds",stretchableContentFlag:!0,expandedFlag:!0}).inject(e);if(!this.isSCC)new n({header:v.get("custoPanel.general.expander.local"),body:this.generalView.saved_custo_container_user,style:"simple",icon:"user wux-ui-3ds",stretchableContentFlag:!0,expandedFlag:!0}).inject(e);return e}.bind(this);new n({header:v.get("custoPanel.general.expander.main"),body:o(),icon:{iconName:"cog",fontIconSize:"2x"},style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(t);e.inject(this.generalView.mainContainer);var u=s.create("div",{class:this.isSCC?"content-view-container-SCC":"content-view-container"}),l=s.create("div",{class:"toolbar-content-view"}).inject(u),d=(s.create("div").inject(l),s.create("div",{class:"search-button-container"}));new a({label:v.get("custoPanel.general.newCustomization"),icon:{iconName:"plus",fontIconSize:"2x"}}).inject(d).addEventListener("click",function(){h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_new_customization"})}.bind(this)),d.inject(l);var c=s.create("div",{class:"search-toolbar-button-container"}).inject(l),p=(s.create("div",{class:"search-toolbar-divider"}).inject(c),s.create("div",{class:"search-toolbar-button-container"}).inject(l));this.editButton=new a({displayStyle:"normal",icon:{iconName:"pencil wux-ui-3ds",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(p),this.editButton.tooltipInfos=new r({shortHelp:v.get("custoPanel.toolbar.edit.tooltip")}),this.editButton.addEventListener("click",function(e){if(i.is(this.activeCusto)&&!this.editButton.disabled){var t=m.getCustomizationById(this.activeCusto.title);i.is(t)&&h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_edit_customization",data:t.exportCustomizationToJSON()})}}.bind(this));var b=s.create("div",{class:"search-toolbar-button-container"}).inject(l);this.deleteButton=new a({displayStyle:"normal",icon:{iconName:"trash",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(b),this.deleteButton.tooltipInfos=new r({shortHelp:v.get("custoPanel.toolbar.delete.tooltip")}),this.deleteButton.addEventListener("click",function(e){i.is(this.activeCusto)&&!this.deleteButton.disabled&&!0!==this.activeDeleteConfirmation&&this._addDeleteCustoConfirmation(this.activeCusto.title)}.bind(this));var w=s.create("div",{class:"search-toolbar-button-container"}).inject(l),f=new a({displayStyle:"normal",icon:{iconName:"copy wux-ui-3ds",fontIconSize:"2x",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(w);f.tooltipInfos=new r({shortHelp:v.get("custoPanel.toolbar.copy.tooltip")}),f.addEventListener("click",function(e){i.is(this.activeCusto)&&!0!==this.activeCopyConfirmation&&this._addCopyCustoConfirmation(this.activeCusto.title)}.bind(this)),this.generalView.synthetic_view=s.create("div",{class:"synthetic-view-container"}).inject(u),u.inject(this.generalView.mainContainer)},_addSavedCusto:function(e){var t="",s=this.cog_image,a=m.getActiveCustomization();if(i.is(a)&&"Default"!==a.customizationId){var n="user";n=i.is(a.role)?a.role:a.getCustomizationRole(),a=i.is(a.customizationId)?a.customizationId:a.getCustomizationId(),"admin"===n&&"user"===this.role&&(this.editButton.disabled=!0,this.deleteButton.disabled=!0)}else a="Default",this.editButton.disabled=!0,this.deleteButton.disabled=!0;e.forEach(function(e){var n=[];let o="";e.customizationId===a&&n.push({label:v.get("custoPanel.general.activeCustomization"),icon:"favorite-on wux-ui-3ds",emphasize:"primary"}),"Default"===e.customizationId?(o=v.get("custoPanel.nls.allviews"),t=v.get("custoPanel.general.default.custo.description"),n.push({label:o,icon:"view-mixed wux-ui-3ds",emphasize:"secondary"})):("Tile"===e.customizedViews?o=v.get("custoPanel.nls.tile"):"Datagrid"===e.customizedViews?o=v.get("custoPanel.nls.datagrid"):"Thumbnail"===e.customizedViews?o=v.get("custoPanel.nls.thumbnail"):"LargeTile"===e.customizedViews?o=v.get("custoPanel.nls.largeTile"):"all views"===e.customizedViews&&(o=v.get("custoPanel.nls.allviews")),n.push({label:o,icon:this._getViewIcon(e),emphasize:"secondary"}),t="admin"===e.role?v.get("custoPanel.general.admin.custo.description"):v.get("custoPanel.general.user.custo.description"));var r=new l({picture:s,icon:"cog",title:e.customizationId,multipleTitleLineNumber:!1,subtitle:"",description:t,activeFlag:e.customizationId===a,statusbarIcons:n,displayedOptionalCellProperties:["description","statusbarIcons"]});r.elements.container.addEventListener("click",function(e){r.isHighlighted()?(r.unhighlight(),this.generalView.synthetic_view.empty()):(i.is(this.activeCusto)&&this.activeCusto.isHighlighted()&&(this.activeCusto.unhighlight(),this.generalView.synthetic_view.empty()),this._selectCusto(r))}.bind(this)),e.customizationId===a&&this._selectCusto(r),"admin"===e.role||this.isSCC?r.inject(this.generalView.saved_custo_container_admin):r.inject(this.generalView.saved_custo_container_user)}.bind(this))},_selectCusto:function(e){this.activeCusto=e,e.highlight();var t=this.savedCustomizations.find(e=>e.customizationId===this.activeCusto.title);if(i.is(t))if("Default"===t.customizationId){this.editButton.disabled=!0,this.deleteButton.disabled=!0;new n({header:v.get("custoPanel.general.expander.endUserCusto"),body:this._addCustoSyntheticView(t,t.attributes.general),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view)}else{if("admin"===t.role&&"user"===this.role?(this.editButton.disabled=!0,this.deleteButton.disabled=!0):(this.editButton.disabled=!1,this.deleteButton.disabled=!1),"all views"===t.customizedViews)var s=t.views.Tile;else s=t.views[t.customizedViews];if(s.general.length>0)new n({header:t.customizationId+" - "+v.get("custoPanel.preview.expander.general.customization"),body:this._addCustoSyntheticView(t,s.general),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view);s.type.length>0&&s.type.forEach(function(e){new n({header:t.customizationId+" - "+v.get("custoPanel.preview.expander.type.customization")+' "'+e.id+'" ',body:this._addCustoSyntheticView(t,e.viewDefinition),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view)}.bind(this)),s.predefinedQuery.length>0&&s.predefinedQuery.forEach(function(e){new n({header:t.customizationId+" - "+v.get("custoPanel.preview.expander.predefinedQuery.customization")+' "'+e.id+'" ',body:this._addCustoSyntheticView(t,e.viewDefinition),style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.generalView.synthetic_view)}.bind(this))}},_addCustoSyntheticView:function(e,t){var i=s.create("div",{id:"search-custo_grid-container",class:"custo-grid-global-container"}),a=[];return"Default"===e.customizationId?(this.ENDUSER_CUSTO=e,this.views.forEach(function(i){var s=[];s.push({text:i.nls,dataIndex:"name",width:170,minWidth:40}),t=i.nls===v.get("custoPanel.view.datagrid")?e.attributes.general.datagrid:e.attributes.general.responsiveCollectionViews;for(var n=0;n<t.length;n++)s.push({text:t[n],dataIndex:"name",width:"auto",minWidth:40});a.push(s)})):this.views.forEach(function(i){var s,n=[];if(n.push({text:i.nls,dataIndex:"name",width:170,minWidth:40}),e.customizedViews===i.id||"all views"===e.customizedViews)for(var o=0;o<t.length;o++)n.push({text:t[o].nlsName||t[o].text,dataIndex:"name",width:"auto",minWidth:40});else{s=i.nls===v.get("custoPanel.view.datagrid")?this.ENDUSER_CUSTO.attributes.general.datagrid:this.ENDUSER_CUSTO.attributes.general.responsiveCollectionViews;for(o=0;o<s.length;o++)n.push({text:s[o],dataIndex:"name",width:"auto",minWidth:40})}a.push(n)}.bind(this)),a.forEach(function(e){var t=s.create("div",{class:"custo-grid-container"}),a=new u({columns:e,defaultCellHeight:50,defaultCellWidth:150,headersDimensions:{height:50},selection:{cells:!1},show:{rowHeaders:!1,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!0},isSortable:!1}).inject(t);a.elements.container.getElementsByClassName("wux-layouts-gridengine")[0].addEventListener("mouseover",function(e){e.currentTarget.getElementsByClassName("wux-layouts-gridengine-scroller-container")[0].style.visibility="visible"},!1),a.elements.container.getElementsByClassName("wux-layouts-gridengine")[0].addEventListener("mouseleave",function(e){var t=e.currentTarget.getElementsByClassName("wux-layouts-gridengine-scroller-container")[0];setTimeout(function(){t.style.visibility="hidden"},500)},!1),t.inject(i)}),i},_addDeleteCustoConfirmation:function(e){this.activeDeleteConfirmation=!0;var t=s.create("div",{class:"synthetic-view-delete-confirmation"});s.create("span",{text:v.get("custoPanel.toolbar.delete.confirmation")+" '"+e+"' ?"}).inject(t);new a({label:"Yes",emphasize:"primary"}).inject(t).addEventListener("click",function(){i.is(this.activeCusto)&&(this.activeDeleteConfirmation=!1,m.deleteCustomization(this.activeCusto.title),this.render())}.bind(this)),new a({label:"No",emphasize:"secondary"}).inject(t).addEventListener("click",function(){this.activeDeleteConfirmation=!1,t.destroy()}.bind(this)),this.generalView.synthetic_view.prepend(t)},_addCopyCustoConfirmation:function(e){this.activeCopyConfirmation=!0;var t=s.create("div",{class:"synthetic-view-copy-confirmation"}),n=(s.create("span",{text:v.get("custoPanel.toolbar.copy.confirmation")+" '"+e+"' :"}).inject(t),s.create("div",{class:"search-line-editor-container"}).inject(t)),u="^(?!("+m.buildUserCustomizationList().join("|")+")$).*$",l=new o({placeholder:this.activeCusto.title,pattern:u,sizeInCharNumber:110,displayClearFieldButtonFlag:!0,maxLength:110});l.tooltipInfos=new r({longHelp:v.get("custoPanel.title.editor.tooltip")}),l.inject(n),this.validate_copy_button=new a({label:"Create copy",emphasize:"primary",disabled:!0}).inject(n),this.validate_copy_button.addEventListener("click",function(){this.activeCopyConfirmation=!1,i.is(this.copyId)&&i.is(this.activeCusto.title)&&i.is(this.role)&&(m.copyCustomization(this.activeCusto.title,this.copyId,this.role),this.render())}.bind(this)),this.cancel_copy_button=new a({label:"Cancel",emphasize:"secondary"}).inject(n),this.cancel_copy_button.addEventListener("click",function(){this.activeCopyConfirmation=!1,t.destroy()}.bind(this)),l.addEventListener("change",function(e){i.is(e.dsModel.value,"string")&&""!==e.dsModel.value?(this.copyId=e.dsModel.value,this.validate_copy_button.disabled=!1):this.validate_copy_button.disabled=!0}.bind(this)),this.generalView.synthetic_view.prepend(t)},_getStoredCustomizations:function(){this.savedCustomizations=[this.ENDUSER_CUSTO];var e=m.getUserCustomizations();return i.is(e)&&i.is(e)&&e.forEach(function(e){this.savedCustomizations.push(e)}.bind(this)),this.savedCustomizations},_getViewIcon:function(e){switch(e.customizedViews){case"Tile":return"view-small-tile wux-ui-3ds";case"LargeTile":return"view-big-tile wux-ui-3ds";case"Datagrid":return"view-list wux-ui-3ds";case"Thumbnail":return"view-big-thb wux-ui-3ds";case"all views":return"view-mixed wux-ui-3ds"}},render:async function(){var e=new Promise(e=>{e(this._getStoredCustomizations())}),t=await e;t&&(this.savedCustomizations=t,this._buildGeneralView(),this._addSavedCusto(this.savedCustomizations))}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomization_CustomizationView",["UWA/Class","UWA/Class/View","UWA/Class/Debug","UWA/Class/Events","UWA/Class/Model","UWA/Core","UWA/Element","UWA/Promise","UWA/Controls/Abstract","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/Expander","DS/Menu/Menu","DS/Controls/Label","DS/Controls/LineEditor","DS/Controls/TooltipModel","DS/Controls/Toggle","DS/Spreadsheet/DataGrid","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/Controls/ResponsiveTileView","DS/Controls/ResponsiveTextualTileView","DS/Controls/ResponsiveThumbnailView","DS/SNResultUX/utils/ExternalComponentHelpers","DS/WebappsUtils/WebappsUtils","DS/MessageBus/MessageBus","DS/SNSearchResultsCusto/model/SNResultsCustomizationModel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,a,n,o,r,u,l,d,c,h,p,m,v,b,w,f,g,y,S,C,z,_,x,I,D,P,V,T,N,A){"use strict";return t.extend({customizationView:null,container:null,preview:null,customization:null,customizationMode:null,dataForPreview:null,isEditMode:null,selectedPredicatesInArray:[],gridColumnsTileViews:[{text:N.get("custoPanel.attributes.name"),dataIndex:"tree"},{text:N.get("custoPanel.attributes.visibility"),dataIndex:"Visibility",typeRepresentation:"boolean",type:"checkbox",editableFlag:"true",editionPolicy:"EditionInPlace"}],gridColumnsDataGridView:[{text:N.get("custoPanel.attributes.name"),dataIndex:"tree"},{text:N.get("custoPanel.attributes.visibility"),dataIndex:"Visibility",typeRepresentation:"boolean",editableFlag:"true",editionPolicy:"EditionInPlace",getCellSemantics:function(e){if("ds6w:label"===e.nodeModel.getAttributeValue("uri")||"ds6w:identifier"===e.nodeModel.getAttributeValue("uri"))return{disabled:!0}}},{text:N.get("custoPanel.attributes.width"),dataIndex:"width",typeRepresentation:"integer",editableFlag:"true",editionPolicy:"EditionInPlace"},{text:N.get("custoPanel.attributes.wrap"),dataIndex:"wrap",typeRepresentation:"boolean",editableFlag:"true",editionPolicy:"EditionInPlace"}],availableViewsList:[{label:"Tile view",value:"Tile",icon:"view-small-tile wux-ui-3ds"},{label:"Large Tile view",value:"LargeTile",icon:"view-big-tile wux-ui-3ds"},{label:"Thumbnail view",value:"Thumbnail",icon:"view-big-thb wux-ui-3ds"},{label:"Datagrid view",value:"Datagrid",icon:"view-list wux-ui-3ds"},{label:"All views",value:"all views",icon:"view-mixed wux-ui-3ds"}],cog_image:I.getWebappsAssetUrl("SNSearchResultsCusto","images/cog_image.png"),type_image:I.getWebappsAssetUrl("SNSearchResultsCusto","images/type_image.png"),query_image:I.getWebappsAssetUrl("SNSearchResultsCusto","images/query_image.png"),init:function(e){return this.container=e.container,this.customizationView=e.elements,this.preview=e.preview,this.customization=e.customization,this.customizationMode=e.customizationMode,this.dataForPreview=e.dataForPreview,this.isEditMode=e.isEditMode,this.selectedPredicatesInArray=[],this.isSCC=e.isSCC,this._parent(e)},_formatDataForEdition:async function(e){var t={general:[],type:[],predefinedQuery:[]};if(e.attributes.general.length>0&&(t.general=e.attributes.general,this.customizationMode="general",this._formatDataForPreview(t)),e.attributes.type.length>0){var i=[];e.attributes.type.forEach(function(e){i.push({typeObj:{custoMode:"type",label:n.is(e.label)?e.label:e.id,object:{uri:e.id}},typePredicates:e.viewDefinition})}),this.customization.attributes.type=i,this.customization.attributes.type.forEach(function(e){this.customizationMode="type",t.type=e,this._formatDataForPreview(t)}.bind(this))}if(e.attributes.predefinedQuery.length>0){var s=[],a=[],o=new Promise((e,t)=>{e(V.custoComputePredefinedQuery())});(await o).forEach(function(e){a.push({label:e.abbreviations+"  ("+e.title+")",object:e.id})}),e.attributes.predefinedQuery.forEach(function(e){var t=a.find(t=>t.object===e.id);(e.label||n.is(t))&&s.push({predefinedQueryObj:{custoMode:"predefinedQuery",label:n.is(e.label)?e.label:t.label,object:n.is(e.id)?e.id:t.object},predefinedQueryPredicates:e.viewDefinition})}),this.customization.attributes.predefinedQuery=s,this.customization.attributes.predefinedQuery.forEach(function(e){this.customizationMode="predefinedQuery",t.predefinedQuery=e,this._formatDataForPreview(t)}.bind(this))}return!0},_addMandatoryPredicate:function(e,t){var i=V.custoDatagridMandatoryAttributes(this.customization.viewMode,this.customizationMode),s=e;let a=s.findIndex(e=>"ds6w:identifier"===e.uri);-1===a&&i.length>1?s.unshift(i[1]):a>-1&&!1===s[a].Visibility&&s[a].Visibility;let n=s.findIndex(e=>"ds6w:label"===e.uri);return-1===n&&i.length>1?s.unshift(i[0]):n>-1&&!1===s[n].Visibility&&s[n].Visibility,s},_formatDataForPreview:function(e){switch(this.customizationMode){case"general":V.formatCustoAttributes(e.general,this.customization.attributes.general,this.customization.viewMode,"general").forEach(function(e){e.custoMode="general",-1===this.preview.availablePredicates.general.findIndex(t=>t.uri===e.uri)&&this.preview.availablePredicates.general.push(e)}.bind(this));break;case"type":if(n.is(e.type.typeObj.object)){var t=this.preview.availablePredicates.type.findIndex(t=>t.typeObj.object.uri===e.type.typeObj.object.uri);if(-1===t){var i=this._addMandatoryPredicate(V.formatCustoAttributes(e.type.typePredicates,[],this.customization.viewMode,"type")),s={typeObj:e.type.typeObj,Text:e.type.typeObj.label,Children:i};this.preview.availablePredicates.type.push(s)}else if(-1!==t&&0===this.preview.availablePredicates.type[t].Children.length)this.preview.availablePredicates.type[t].Children=this._addMandatoryPredicate(V.formatCustoAttributes(e.type.typePredicates,[],this.customization.viewMode,"type"));else{var a=this.preview.availablePredicates.type.findIndex(t=>t.typeObj.object.uri===e.type.typeObj.object.uri),o=this.customization.attributes.type.findIndex(t=>t.typeObj.object.uri===e.type.typeObj.object.uri);V.formatCustoAttributes(e.type.typePredicates,this.customization.attributes.type[o].typePredicates,this.customization.viewMode,"type").forEach(function(e){-1===this.preview.availablePredicates.type[a].Children.findIndex(t=>t.Text===e.Text)&&this.preview.availablePredicates.type[a].Children.push(e)}.bind(this))}}break;case"predefinedQuery":if(n.is(e.predefinedQuery.predefinedQueryObj.object)){var r=this.preview.availablePredicates.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.predefinedQueryObj.object);if(-1===r){var u=this._addMandatoryPredicate(V.formatCustoAttributes(e.predefinedQuery.predefinedQueryPredicates,[],this.customization.viewMode,"predefinedQuery")),l={predefinedQueryObj:e.predefinedQuery.predefinedQueryObj,Text:e.predefinedQuery.predefinedQueryObj.label,Children:u};this.preview.availablePredicates.predefinedQuery.push(l)}else if(-1!==r&&0===this.preview.availablePredicates.predefinedQuery[r].Children.length)this.preview.availablePredicates.predefinedQuery[r].Children=this._addMandatoryPredicate(V.formatCustoAttributes(e.predefinedQuery.predefinedQueryPredicates,[],this.customization.viewMode,"predefinedQuery"));else{a=this.preview.availablePredicates.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.predefinedQueryObj.object),o=this.customization.attributes.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.predefinedQueryObj.object);V.formatCustoAttributes(e.predefinedQuery.predefinedQueryPredicates,this.customization.attributes.predefinedQuery[o].predefinedQueryPredicates,this.customization.viewMode,"predefinedQuery").forEach(function(e){-1===this.preview.availablePredicates.predefinedQuery[a].Children.findIndex(t=>t.Text===e.Text)&&this.preview.availablePredicates.predefinedQuery[a].Children.push(e)}.bind(this))}}}},_formatDataForFinalCustomization:function(e){var t={dataIndex:e.values.uri,dataType:"",dataTypeText:"",defaultSort:"none",isRemovable:!1,isSortable:!1,name:e.values.name,nlsName:e.values.nlsName,text:e.values.Text,type:"",width:e.values.width||"495px",wrap:e.values.wrap||!1};switch(e.values.custoMode){case"general":var i=this.customization.attributes.general.findIndex(e=>e.dataIndex===t.dataIndex);-1===i&&e.visibility?(t.dataType=e.dataType||"",this.customization.attributes.general.push(t)):e.visibility?(this.customization.attributes.general[i].width=t.width.toString()||"auto",this.customization.attributes.general[i].wrap=t.wrap||!1):e.visibility||this.customization.attributes.general.splice(i,1),this.preview.modeInUse="general",this.preview.attributesArrayInUse=this.customization.attributes.general;break;case"type":var s=this.customization.attributes.type.findIndex(t=>t.typeObj.object.uri===e.type.object.uri);if(t.dataType=e.type.object.uri,-1===s&&e.visibility)this.customization.attributes.type.push({typeObj:e.type,typePredicates:[t]}),this.preview.modeInUse="type",this.preview.typeInUse=e.type,this.preview.attributesArrayInUse=[t];else-1===(a=this.customization.attributes.type[s].typePredicates.findIndex(e=>e.dataIndex===t.dataIndex))&&e.visibility?this.customization.attributes.type[s].typePredicates.push(t):e.visibility?(this.customization.attributes.type[s].typePredicates.width=t.width.toString()||"auto",this.customization.attributes.type[s].typePredicates.wrap=t.wrap||!1):e.visibility||this.customization.attributes.type[s].typePredicates.splice(a,1),this.preview.modeInUse="type",this.preview.typeInUse=e.type,this.preview.attributesArrayInUse=this.customization.attributes.type[s].typePredicates;break;case"predefinedQuery":var a,n=this.customization.attributes.predefinedQuery.findIndex(t=>t.predefinedQueryObj.object===e.predefinedQuery.object);if(t.dataType=e.predefinedQuery.object,-1===n&&e.visibility)this.customization.attributes.predefinedQuery.push({predefinedQueryObj:e.predefinedQuery,predefinedQueryPredicates:[t]}),this.preview.modeInUse="predefinedQuery",this.preview.predefinedQueryInUse=e.predefinedQuery.object,this.preview.attributesArrayInUse=[t];else-1===(a=this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates.findIndex(e=>e.dataIndex===t.dataIndex))&&e.visibility?this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates.push(t):e.visibility?(this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates.width=t.width.toString()||"auto",this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates.wrap=t.wrap||!1):e.visibility||this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates.splice(a,1),this.preview.modeInUse="predefinedQuery",this.preview.predefinedQueryInUse=e.predefinedQuery.object,this.preview.attributesArrayInUse=this.customization.attributes.predefinedQuery[n].predefinedQueryPredicates}},_buildCustomizationView:function(e,t){this.container.classList.contains("general-panel")&&this.container.removeClassName("general-panel"),this.container.classList.contains("general-panel-SCC")&&this.container.removeClassName("general-panel-SCC"),this.container.classList.contains("attributes-selection-panel")&&this.container.removeClassName("attributes-selection-panel"),this.container.classList.contains("attributes-selection-panel-SCC")&&this.container.removeClassName("attributes-selection-panel-SCC"),this.container.empty(),this.isSCC?this.container.addClassName("customization-panel-SCC"):this.container.addClassName("customization-panel"),this.customizationView.generalCustomizationPreview=void 0,this.selectedPredicates=[],this.selectedPredicatesInArray=[],this.customizationView.button_container=o.create("div",{id:"search-button-attributes-container",class:"search-button-attributes-container"}),this.customizationView.add_attributes_button=new d({id:"search-custo_more-attributes-button",label:N.get("custoPanel.add.attributes"),icon:{iconName:"plus",fontIconSize:"2x"}}),this.customizationView.add_attributes_button.addEventListener("click",function(){this._addCustomizationModeSelectionMenu(this)}.bind(this)),this._formatDataForPreview(this.dataForPreview),this.customizationView.custo_view_attributes=o.create("div",{id:"search-custo_attributes-container",class:"custo-view-attributes-container"}).inject(this.container),this.customizationView.button_container.inject(this.customizationView.custo_view_attributes),this.customizationView.add_attributes_button.inject(this.customizationView.button_container),this.customizationView.attributes_container=this._buildAttributesInCustomizationGrid(this.preview.availablePredicates),this.customizationView.attributes_container.inject(this.customizationView.custo_view_attributes);var i=o.create("div",{id:"search-custo_preview-container",class:"custo-view-preview-container"}).inject(this.container);this._addCustoPreview(i,t),this.selectedPredicatesInArray.forEach(function(e){this._formatDataForFinalCustomization(e)}.bind(this)),this._refreshPreview(!0)},_buildAttributesInCustomizationGrid:function(e){var t=o.create("div",{id:"search-attributes-container",class:"search-attributes-container"}),i="Datagrid"===this.customization.viewMode?i=this.gridColumnsDataGridView:this.gridColumnsTileViews,s={data:e,model:void 0,view:void 0,columns:i},a=new y;s.model=new f({dataModelSet:a}),s.model.prepareUpdate();for(var r=0,u=e.general.length;r<u;r++){var l={dataType:e.general[r].typeObj},d=e.general[r],c=g.createTreeNodeDataModel(a,{label:d.Text,grid:d});s.model.addChild(c);const t={dataType:n.is(l.dataType)?l.dataType:"",values:d,visibility:!0};e.general[r].Visibility&&this.selectedPredicatesInArray.push(t)}return e.type.forEach(function(e){var t={type:e.typeObj},i=new g({label:N.get("custoPanel.attributes.for.type")+" : "+e.Text,type:e.typeObj.object.uri,grid:e});s.model.addRoot(i),e.Children&&e.Children.forEach(function(e){var s=new g({label:e.Text,grid:e});i.addChild(s);const a={type:t.type,values:e,visibility:!0};e.Visibility&&this.selectedPredicatesInArray.push(a)}.bind(this))}.bind(this)),e.predefinedQuery.forEach(function(e){var t={predefinedQuery:e.predefinedQueryObj},i=new g({label:N.get("custoPanel.attributes.for.query")+" : "+e.Text,predefinedQuery:e.predefinedQueryObj.object,grid:e});s.model.addRoot(i),e.Children&&e.Children.forEach(function(e){var s=new g({label:e.Text,grid:e});i.addChild(s);const a={predefinedQuery:t.predefinedQuery,values:e,visibility:!0};e.Visibility&&this.selectedPredicatesInArray.push(a)}.bind(this))}.bind(this)),s.model.expandAll(),s.model.pushUpdate(),s.view=new S({treeDocument:s.model,columns:s.columns,rowDragEnabledFlag:!0,layoutOptions:{layoutDensity:"comfortable"},defaultColumnDef:{width:"auto",typeRepresentation:"string"},rowSelection:"none",columnSelection:"none",cellSelection:"none",columnDragEnabledFlag:!1,rowDragEnabledFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1}).inject(t),s.view.addEventListener("change",function(e,t){if(t.nodeModel){var i=t.nodeModel.options.grid,s={values:i,visibility:t.nodeModel.getAttributeValue("Visibility")},a="general",o=this.cog_image;n.is(i.custoMode)?a=i.custoMode:n.is(i.values)&&(a=i.values.custoMode),"general"===a&&(s.dataType=i.dataType,o=this.cog_image),"type"===a&&(s.type=t.nodeModel.getParent().options.grid.typeObj,o=this.type_image),"predefinedQuery"===a&&(s.predefinedQuery=t.nodeModel.getParent().options.grid.predefinedQueryObj,o=this.query_image),this._formatDataForFinalCustomization(s),this._buildCustoPreviewItems(s,!1,o),this._updateCreationButton()}}.bind(this)),t},_addCustomizationModeSelectionMenu:function(e){var t=[],i={type:"CheckItem",title:N.get("custoPanel.general.customization"),icon:{iconName:"search wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){D.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",data:{customization:e.customization,customizationMode:"general"}})}}},s={type:"CheckItem",title:N.get("custoPanel.type.customization"),icon:{iconName:"filter wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){D.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",data:{customization:e.customization,customizationMode:"type"}})}}},a={type:"CheckItem",title:N.get("custoPanel.predefinedQuery.customization"),icon:{iconName:"i-question wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{callback:function(){D.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",data:{customization:e.customization,customizationMode:"predefinedQuery"}})}}};t.push(i,s,a),h.show(t,{position:e.customizationView.add_attributes_button.elements.button.getOffsets()})},_updateCreationButton:function(){let e=!1;if(0===this.customization.attributes.general.length&&0===this.customization.attributes.type.length&&0===this.customization.attributes.predefinedQuery.length)e=!0;else if(0===this.customization.attributes.general.length){var t=0;this.customization.attributes.type.forEach(function(e){t+=e.typePredicates.length}),this.customization.attributes.predefinedQuery.forEach(function(e){t+=e.predefinedQueryPredicates.length}),0===t&&(e=!0)}this.customizationView.create_button.disabled=e},_updatePreviewMode:function(e){var t;switch(this.customization.viewMode){case"all views":case"Tile":t=this._buildCustoPreviewItemsTileView(e);break;case"LargeTile":t=this._buildCustoPreviewItemsLargeTileView(e);break;case"Thumbnail":t=this._buildCustoPreviewItemsThumbnailView(e);break;case"Datagrid":t=this._buildCustoPreviewItemsDatagridView()}return t},_addCustoPreview:function(e,t){this.customizationView.custo_box=o.create("div",{id:"search-custo-preview-box",class:"custo-preview-box"}).inject(e),this.customizationView.hidden_validation_box=o.create("div",{id:"search-custo-preview-box-hidden",class:"custo-preview-validation-box-hidden"}).inject(e),this.customizationView.validate_button=new d({label:t?N.get("custoPanel.button.edit"):N.get("custoPanel.button.create"),emphasize:"primary",disabled:!t,id:"search-custo-preview-validate-button",class:"custo-preview-validate-button"}),this.customizationView.validate_button.addEventListener("click",function(){if(!this.customizationView.validate_button.disabled){"Datagrid"===this.customization.viewMode&&console.log(this.customization),this.customization.preview=this.preview;var e={preview:this.preview,customization:this.customization,isEditMode:t};D.publish({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_created",data:e})}}.bind(this)),this.customizationView.cancel_validation_button=new d({label:N.get("custoPanel.button.cancel"),emphasize:"secondary",id:"search-custo-preview-cancel-validation-button",class:"custo-preview-cancel-validation-button"}),this.customizationView.cancel_validation_button.addEventListener("click",function(){x.hideOverlayLoader(this.customizationView.custo_view_attributes),this.customizationView.hidden_validation_box.removeClassName("custo-preview-validation-box"),this.customizationView.hidden_validation_box.addClassName("custo-preview-validation-box-hidden"),this.customizationView.hidden_validation_box.empty(),this.customizationView.custo_box.removeClassName("custo-preview-box-hidden"),this.customizationView.custo_box.addClassName("custo-preview-box")}.bind(this));var i=o.create("div",{id:"search-custo-preview-title",class:"custo-preview-title"}).inject(this.customizationView.custo_box);new l({elementsList:this.availableViewsList,currentValue:this.customization.viewMode,touchMode:!0,enableSearchFlag:!1}).inject(i).addEventListener("change",function(e){this.customization.viewMode=e.dsModel.value,this._refreshPreview(!1),this.customizationView.attributes_container.destroy(),this.customizationView.attributes_container=this._buildAttributesInCustomizationGrid(this.preview.availablePredicates),this.customizationView.attributes_container.inject(this.customizationView.custo_view_attributes)}.bind(this));o.create("span",{id:"search-custo-preview-view-title",text:N.get("custoPanel.preview.title")+" :"}).inject(i);var s=o.create("div",{id:"search-custo-preview-section",class:"custo-preview-section"}).inject(this.customizationView.custo_box);this.customizationView.preview_container=s;var a=o.create("div",{id:"search-custo-preview-button",class:"custo-preview-button"}).inject(this.customizationView.custo_box);this.customizationView.create_button=new d({label:t?N.get("custoPanel.button.edit"):"Ok",emphasize:"primary",id:"search-custo-preview-create-button",class:"custo-preview-create-button"}).inject(a),this.customizationView.create_button.addEventListener("click",function(){this.customizationView.create_button.disabled||this._buildValidationPanel(t)}.bind(this)),new d({label:N.get("custoPanel.button.cancel"),emphasize:"secondary",id:"search-custo-preview-cancel-button",class:"custo-preview-cancel-button"}).inject(a).addEventListener("click",function(){D.publish({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_canceled"})}.bind(this))},_buildValidationPanel:function(e){x.showOverlayLoader(" ",this.customizationView.custo_view_attributes),this.customizationView.custo_box.removeClassName("custo-preview-box"),this.customizationView.custo_box.addClassName("custo-preview-box-hidden"),this.customizationView.hidden_validation_box.removeClassName("custo-preview-validation-box-hidden"),this.customizationView.hidden_validation_box.addClassName("custo-preview-validation-box");var t=o.create("div",{id:"search-custo-preview-title",class:"custo-validation-form-title"}).inject(this.customizationView.hidden_validation_box),i=(o.create("span",{id:"search-custo-preview-view-title",text:N.get("custoPanel.preview.title.span")}).inject(t),o.create("div",{class:"validation-form-section"}).inject(this.customizationView.hidden_validation_box)),s=o.create("div",{class:"validation-form-naming-section"}).inject(i),a=(o.create("span",{text:N.get("custoPanel.preview.validation.customization.title")+" : "}).inject(s),o.create("div",{class:"search-line-editor-container"}).inject(s));this.existingCustomizationIds=T.buildUserCustomizationList();var r="^(?!("+this.existingCustomizationIds.join("|")+")$).*$",u=new m({placeholder:e?this.customization.customizationId:N.get("custoPanel.general.newCustomization"),disabled:e,pattern:r,sizeInCharNumber:110,displayClearFieldButtonFlag:!0,maxLength:110});u.tooltipInfos=new v({longHelp:N.get("custoPanel.title.editor.tooltip")}),u.inject(a),u.addEventListener("uncommittedChange",function(t){n.is(t.dsModel.valueToCommit,"string")&&""!==t.dsModel.valueToCommit?-1===this.existingCustomizationIds.findIndex(e=>e===t.dsModel.valueToCommit)?(this.customization.customizationId=t.dsModel.valueToCommit,this.customizationView.validate_button.disabled=!1):this.customizationView.validate_button.disabled=!0:e||(this.customizationView.validate_button.disabled=!0)}.bind(this));var d=o.create("div",{class:"validation-form-view-selection-section"}).inject(i);o.create("span",{text:N.get("custoPanel.preview.title")+" : "}).inject(d);new l({elementsList:function(e,t){var i=[];return e.forEach(function(e){e.value===t?i.unshift(e):i.push(e)}.bind(this)),i}(this.availableViewsList,this.customization.viewMode),touchMode:!0,enableSearchFlag:!1}).inject(d).addEventListener("change",function(e){this.customization.viewMode=e.dsModel.value}.bind(this));var c=o.create("div",{class:"custo-preview-validation-box-button"}).inject(this.customizationView.hidden_validation_box);this.customizationView.cancel_validation_button.inject(c),this.customizationView.validate_button.inject(c)},_buildCustoPreviewItems:function(e,t,i){var s=this.customizationView.preview_container;switch(document.getElementById("search-custo-preview-placeholder")&&!t&&document.getElementById("search-custo-preview-placeholder").destroy(),null!==e?e.values.custoMode:"general"){case"general":var a=this._updatePreviewMode(i);if(void 0===this.customizationView.generalCustomizationPreview){this.customizationView.generalCustomizationPreview=o.create("div",{id:"search-custo-preview-general",class:"custo-preview-general"}).inject(s);new c({header:N.get("custoPanel.preview.expander.general.customization"),body:a,style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.customizationView.generalCustomizationPreview)}else if(this.customization.attributes.general.length>0){this.customizationView.generalCustomizationPreview.empty();new c({header:N.get("custoPanel.preview.expander.general.customization"),body:a,style:"simple",stretchableContentFlag:!0,expandedFlag:!0}).inject(this.customizationView.generalCustomizationPreview)}else this.customizationView.generalCustomizationPreview.empty();break;case"type":a=this._updatePreviewMode(i);var n=this.customizationView.typeCustomizationPreview.findIndex(t=>t.typeName===e.type.label);if(this.customizationView.typeCustomizationPreview.find(t=>t.typeName===e.type.label)&&!t){var r=document.getElementById("search-type-custo-preview-container-"+e.type.object.uri);if(this.preview.attributesArrayInUse.length>0){r.empty();var u=o.create("div",{id:"search-type-custo-preview-container"}).inject(r);new c({header:N.get("custoPanel.preview.expander.type.customization")+" : "+e.type.label,body:a,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(u)}else r.empty()}else{u=o.create("div",{id:"search-type-custo-preview-container-"+e.type.object.uri}).inject(s),new c({header:N.get("custoPanel.preview.expander.type.customization")+" : "+e.type.label,body:a,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(u);-1===n&&this.customizationView.typeCustomizationPreview.push({typeName:e.type.label,html:u})}break;case"predefinedQuery":a=this._updatePreviewMode(i);var l=this.customizationView.predefinedQueryCustomizationPreview.findIndex(t=>t.pqName===e.predefinedQuery.label);if(this.customizationView.predefinedQueryCustomizationPreview.find(t=>t.pqName===e.predefinedQuery.label)&&!t){r=document.getElementById("search-predefinedQuery-custo-preview-container-"+e.predefinedQuery.object);if(this.preview.attributesArrayInUse.length>0){r.empty();var d=o.create("div",{id:"search-predefinedQuery-custo-preview-container",class:"synthetic-view-container"}).inject(r);new c({header:N.get("custoPanel.preview.expander.predefinedQuery.customization")+" : "+e.predefinedQuery.label,body:a,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(d)}else r.empty()}else{d=o.create("div",{id:"search-predefinedQuery-custo-preview-container-"+e.predefinedQuery.object}).inject(s),new c({header:N.get("custoPanel.preview.expander.predefinedQuery.customization")+" : "+e.predefinedQuery.label,body:a,style:"simple",stretchableContentFlag:!1,expandedFlag:!0}).inject(d);-1===l&&this.customizationView.predefinedQueryCustomizationPreview.push({pqName:e.predefinedQuery.label,html:d})}}},_buildSpreadsheetPreviewItems:function(e){var t=[];this.preview.attributesArrayInUse.forEach(function(e){t.push({text:e.text,dataIndex:e.dataIndex,width:"auto",minWidth:40})});var i=o.create("div",{class:"custo-grid-container-preview"}).inject(e);this.custoSpreadsheet=new w({modeInUse:this.preview.modeInUse,columns:t,defaultCellHeight:40,defaultCellWidth:120,headersDimensions:{height:40},selection:{cells:!0},show:{rowHeaders:!1,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!1},isSortable:!1}).inject(i),"type"===this.preview.modeInUse&&(this.custoSpreadsheet.typeInUse=this.preview.typeInUse),"predefinedQuery"===this.preview.modeInUse&&(this.custoSpreadsheet.predefinedQueryInUse=this.preview.predefinedQueryInUse),this.custoSpreadsheet.getManager().onMoveColumn(function(e){if(n.is(e.fromColumnID)&&n.is(e.toColumnID)){if("general"===this.custoSpreadsheet.options.modeInUse){var t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.preview.availablePredicates.general.find(t=>t.uri===e.dataIndex);n.is(i)&&t.push(i)}.bind(this)),t.length===this.preview.availablePredicates.general.length&&(this.preview.availablePredicates.general=t);var i=[];this.custoSpreadsheet.options.columns.forEach(function(e){var t=this.customization.attributes.general.find(t=>t.dataIndex===e.dataIndex);n.is(t)&&i.push(t)}.bind(this)),i.length===this.customization.attributes.general.length&&(this.customization.attributes.general=i)}else if("type"===this.custoSpreadsheet.options.modeInUse){var s;if((s=this.preview.availablePredicates.type.findIndex(e=>e.typeObj.object.uri===this.custoSpreadsheet.typeInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.preview.availablePredicates.type[s].Children.find(t=>t.uri===e.dataIndex);n.is(i)&&t.push(i)}.bind(this)),t.length===this.preview.availablePredicates.type[s].Children.length&&(this.preview.availablePredicates.type[s].Children=t)}if((s=this.customization.attributes.type.findIndex(e=>e.typeObj.object.uri===this.custoSpreadsheet.typeInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.customization.attributes.type[s].typePredicates.find(t=>t.dataIndex===e.dataIndex);n.is(i)&&t.push(i)}.bind(this)),t.length===this.customization.attributes.type[s].typePredicates.length&&(this.customization.attributes.type[s].typePredicates=t)}}else if("predefinedQuery"===this.custoSpreadsheet.options.modeInUse){var a;if((a=this.preview.availablePredicates.predefinedQuery.findIndex(e=>e.predefinedQueryObj.object===this.custoSpreadsheet.predefinedQueryInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.preview.availablePredicates.predefinedQuery[a].Children.find(t=>t.uri===e.dataIndex);n.is(i)&&t.push(i)}.bind(this)),t.length===this.preview.availablePredicates.predefinedQuery[a].Children.length&&(this.preview.availablePredicates.predefinedQuery[a].Children=t)}if((a=this.customization.attributes.predefinedQuery.findIndex(e=>e.predefinedQueryObj.object===this.custoSpreadsheet.predefinedQueryInUse))>-1){t=[];this.custoSpreadsheet.options.columns.forEach(function(e){var i=this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.find(t=>t.dataIndex===e.dataIndex);n.is(i)&&t.push(i)}.bind(this)),t.length===this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates.length&&(this.customization.attributes.predefinedQuery[a].predefinedQueryPredicates=t)}}this._buildCustomizationView(this,this.isEditMode)}}.bind(this)),this.custoSpreadsheet.elements.container.getElementsByClassName("wux-layouts-gridengine")[0].addEventListener("mouseover",function(e){e.currentTarget.getElementsByClassName("wux-layouts-gridengine-scroller-container")[0].style.visibility="visible"},!1),this.custoSpreadsheet.elements.container.getElementsByClassName("wux-layouts-gridengine")[0].addEventListener("mouseleave",function(e){var t=e.currentTarget.getElementsByClassName("wux-layouts-gridengine-scroller-container")[0];setTimeout(function(){t.style.visibility="hidden"},500)},!1)},_buildCustoPreviewItemsTileView:function(e){var t=o.create("div",{id:"search-preview-Tile-container",class:"custo-preview-Tile-container"});this._buildSpreadsheetPreviewItems(t);for(var i="",s=0;s<this.preview.attributesArrayInUse.length;s++)s!==this.preview.attributesArrayInUse.length-1?i=i+this.preview.attributesArrayInUse[s].text+" | ":i+=this.preview.attributesArrayInUse[s].text;var a=n.is(e)?e:this.cog_image,r=new C({picture:a,icon:"cog",title:N.get("custoPanel.preview.item.title"),multipleTitleLineNumber:!1,subtitle:i,description:"",contextualMenu:[N.get("custoPanel.preview.item.contextualMenu")]}).inject(t);return r.getContent().setStyle("width","400px"),r.getContent().setStyle("margin-bottom","5%"),t},_buildCustoPreviewItemsLargeTileView:function(e){var t=o.create("div",{id:"search-preview-Tile-container",class:"custo-preview-LargeTile-container"});this._buildSpreadsheetPreviewItems(t);for(var i="",s=0;s<this.preview.attributesArrayInUse.length;s++)s!==this.preview.attributesArrayInUse.length-1?i=i+this.preview.attributesArrayInUse[s].text+" | ":i+=this.preview.attributesArrayInUse[s].text;var a=n.is(e)?e:this.cog_image,r=new z({picture:a,icon:"cog",title:N.get("custoPanel.preview.item.title"),multipleTitleLineNumber:!1,subtitle:i,description:"",contextualMenu:[N.get("custoPanel.preview.item.contextualMenu")]}).inject(t);return r.getContent().setStyle("width","400px"),r.getContent().setStyle("margin-bottom","5%"),t},_buildCustoPreviewItemsThumbnailView:function(e){var t=o.create("div",{id:"search-preview-Tile-container",class:"custo-preview-Thumbnail-container"});this._buildSpreadsheetPreviewItems(t);for(var i="",s=0;s<this.preview.attributesArrayInUse.length;s++)s!==this.preview.attributesArrayInUse.length-1?i=i+this.preview.attributesArrayInUse[s].text+" | ":i+=this.preview.attributesArrayInUse[s].text;var a=n.is(e)?e:this.cog_image,r=new _({picture:a,icon:"cog",title:N.get("custoPanel.preview.item.title"),multipleTitleLineNumber:!1,subtitle:i,description:"",contextualMenu:[N.get("custoPanel.preview.item.contextualMenu")]}).inject(t);return r.getContent().setStyle("width","200px"),r.getContent().setStyle("margin-bottom","5%"),t},_buildCustoPreviewItemsDatagridView:function(){var e=o.create("div",{id:"search-preview-Datagrid-container",class:"custo-preview-Datagrid-container"});this._buildSpreadsheetPreviewItems(e);var t=[],i=[],s={};this.preview.attributesArrayInUse.forEach(function(e){t.push({text:e.text,dataIndex:e.dataIndex,width:e.width,wrap:e.wrap,typeRepresentation:"string"}),s[e.dataIndex.toString()]=N.get("custoPanel.preview.item.datagrid.title")+" "+e.dataIndex}),s.Text=N.get("custoPanel.preview.item.datagrid.text"),i.push(s);var a={data:i,model:void 0,view:void 0,columns:t},n=new y;a.model=new f({dataModelSet:n}),a.model.prepareUpdate();for(var r=0,u=i.length;r<u;r++){var l=i[r],d=g.createTreeNodeDataModel(n,{label:l.Text,grid:l});a.model.addChild(d)}return a.model.expandAll(),a.model.pushUpdate(),a.view=new S({treeDocument:a.model,columns:a.columns,rowDragEnabledFlag:!1,layoutOptions:{layoutDensity:"comfortable"},defaultColumnDef:{width:"auto",typeRepresentation:"string"},rowSelection:"none",columnSelection:"none",cellSelection:"none",columnDragEnabledFlag:!1,rowDragEnabledFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1}).inject(e),e},_refreshPreview:function(e){var t=this.customizationMode;["general","type","predefinedQuery"].forEach(function(t){"general"===t?(this.customizationMode=t,this.preview.modeInUse="general",this.preview.attributesArrayInUse=this.customization.attributes.general,this._buildCustoPreviewItems(null,e,this.cog_image)):"type"===t?(this.customizationMode=t,this.customization.attributes.type.forEach(function(t){this.preview.modeInUse="type",this.preview.typeInUse=t.typeObj.object.uri,this.preview.attributesArrayInUse=t.typePredicates;var i={type:t.typeObj,values:{custoMode:"type"}};this._buildCustoPreviewItems(i,e,this.type_image)}.bind(this))):(this.customizationMode=t,this.customization.attributes.predefinedQuery.forEach(function(t){this.preview.modeInUse="predefinedQuery",this.preview.predefinedQueryInUse=t.predefinedQueryObj.object,this.preview.attributesArrayInUse=t.predefinedQueryPredicates;var i={predefinedQuery:t.predefinedQueryObj,values:{custoMode:"predefinedQuery"}};this._buildCustoPreviewItems(i,e,this.query_image)}.bind(this)))}.bind(this)),this.customizationMode=t},render:async function(){if(this.isEditMode){var e=new Promise(e=>{e(this._formatDataForEdition(this.customization))});await e&&this._buildCustomizationView(this,this.isEditMode)}else this._buildCustomizationView(this,this.isEditMode)}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomizationPanel",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","DS/Windows/Dialog","DS/SNResultUX/utils/ExternalComponentHelpers","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNSearchResultsCusto/model/SNResultsCustomizationModel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,a,n,o,r,u,l,d,c){"use strict";return i.extend(e,{generalContext:null,elements:[],customizationObject:null,recovered_customizations:null,customizationObject:null,customizationMode:"general",customization:{customizationId:"New customization",viewMode:"Tile",viewModeIcon:"view-small-tile wux-ui-3ds",attributes:{general:[],type:[],predefinedQuery:[]}},preview:{availablePredicates:{general:[],type:[],predefinedQuery:[]},attributesArrayInUse:[]},attributeSelectionForm:{oSourceAutocomplete:{},oTypeAutocomplete:{},oExtensionAutocomplete:{},oPredefinedQueryAutocomplete:{},oAttributesAutocomplete:{},availableTypes:null,availableExtensions:[],selectedDataSource:null,selectedTypes:[],selectedExtensions:[],selectedPredefinedQuery:[],selectedPredicates:{general:[],type:{typeObj:{},typePredicates:[]},predefinedQuery:{predefinedQueryObj:{},predefinedQueryPredicates:[]}}},setup:function(e,i){if(e){o.getPlatformServices().getPortfolioRole(function(e){console.log(e)});this.generalContext=e,u.setGeneralContext(e),e.disableTenantSetting||l.loadCustomizationTenantSettings(),this.elements.stepSelector={},this.elements.stepSelector.ropeWidth=null,this.elements.generalCustomizationPreview=void 0,this.elements.typeCustomizationPreview=[],this.elements.predefinedQueryCustomizationPreview=[];o.getGrantedRoles(function(e){e.findIndex(e=>"CSV"===e.id)>-1&&e.findIndex(e=>"Operator"===e.id)>-1?this.customization.role="admin":this.customization.role="user"}.bind(this));if(this.role=this.customization.role,t.is(e.isSCC)&&t.is(i))this.elements.mainContainer=i,this.elements.mainContainer.addClassName("general-panel-SCC"),this.isSCC=!0;else{a.initImmersiveFrame();var n=new s({title:d.get("custoPanel.general.title"),immersiveFrame:a.getImmersiveFrame(),width:"80vh",height:"140vh",recId:"GeneralCustomizationMenu",modalFlag:!0,maximizeButtonFlag:!0,position:{at:"50 50",collision:"fit"}});this.elements.dialog=n,this.elements.mainContainer=n.elements._contentDiv,this.elements.dialog.elements._mainContentDiv.addClassName("general-dialog"),this.elements.dialog.elements._modalDiv.addClassName("custoPanel-mask"),this.elements.mainContainer.addClassName("general-panel")}this.setupViewsObserver(),this.showGlobalView()}return!0},createCustomizationObject:function(){var e=new r;return e.setCustomizationId(this.customization.customizationId),e.setCustomizationRole(this.role),e.setCustomizedViews(this.customization.viewMode),e.setViewDefinition(this.customization.viewMode,"general",this.customization.attributes.general),this.customization.attributes.type.forEach(function(t){e.setViewDefinition(this.customization.viewMode,"type",t.typePredicates,t.typeObj.object.uri,t.typeObj.label)}.bind(this)),this.customization.attributes.predefinedQuery.forEach(function(t){e.setViewDefinition(this.customization.viewMode,"predefinedQuery",t.predefinedQueryPredicates,t.predefinedQueryObj.object,t.predefinedQueryObj.label)}.bind(this)),e},clearCustomization:function(){this.customizationMode="general",this.customizationStep="nav_datasources",this.customization={customizationId:"New customization",viewMode:"Tile",viewModeIcon:"view-small-tile wux-ui-3ds",attributes:{general:[],type:[],predefinedQuery:[]}},this.preview={availablePredicates:{general:[],type:[],predefinedQuery:[]},attributesArrayInUse:[]},this.attributeSelectionForm={oSourceAutocomplete:{},oTypeAutocomplete:{},oExtensionAutocomplete:{},oPredefinedQueryAutocomplete:{},oAttributesAutocomplete:{},availableTypes:null,availableExtensions:[],selectedDataSource:null,selectedTypes:[],selectedExtensions:[],selectedPredefinedQuery:[],selectedPredicates:{general:[],type:{typeObj:{},typePredicates:[]},predefinedQuery:{predefinedQueryObj:{},predefinedQueryPredicates:[]}}}},setCustomizationParameters:function(e,t,i,s,a){this.customization.customizationId=e,this.customization.viewMode=t,this.customization.attributes.general=i,this.customization.attributes.type=s,this.customization.attributes.predefinedQuery=a},getCustomizationPanel:function(){return this.elements},getUserCustomization:function(){return{obj:this.customizationObject}},setupViewsObserver:function(){n.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_new_customization",callback:()=>{this.clearCustomization(),this.showCustomizationView(!1)}}),n.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_edit_customization",callback:e=>{let t=e.customizedViews;"all views"===t&&(t="Tile"),this.setCustomizationParameters(e.customizationId,e.customizedViews,e.views[t].general,e.views[t].type,e.views[t].predefinedQuery),this.showCustomizationView(!0)}}),n.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_created",callback:e=>{this.customization.preview=e.preview,this.customization=e.customization;var t=this.createCustomizationObject();l.saveCustomization(t,!0),this.showGlobalView()}}),n.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_new_results_customization_canceled",callback:()=>{this.showGlobalView()}}),n.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection",callback:e=>{this.customization=e.customization,this.customizationMode=e.customizationMode,this.showAtributesSelectionView()}}),n.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",callback:e=>{this.attributeSelectionForm.selectedPredicates=e,this.showCustomizationView(!1)}}),n.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection_canceled",callback:()=>{this.showCustomizationView(!1)}})},showGlobalView:function(){a.showOverlayLoader(d.get("custoPanel.general.overlay.loading.view"),this.elements.mainContainer),require(["DS/SNSearchResultsCusto/views/SearchResultsCustomization_GlobalView"],function(e){let t={container:this.elements.mainContainer,elements:this.elements,role:this.customization.role,isSCC:this.isSCC};this.panelGlobalView=new e(t),this.panelGlobalView.render(),a.hideOverlayLoader(this.elements.mainContainer)}.bind(this))},showCustomizationView:function(e){a.showOverlayLoader(d.get("custoPanel.general.overlay.loading.view"),this.elements.mainContainer),require(["DS/SNSearchResultsCusto/views/SearchResultsCustomization_CustomizationView"],function(t){let i={container:this.elements.mainContainer,elements:this.elements,preview:this.preview,customization:this.customization,customizationMode:this.customizationMode,dataForPreview:this.attributeSelectionForm.selectedPredicates,isEditMode:e,isSCC:this.isSCC};this.panelCustomizationView=new t(i),this.panelCustomizationView.render(),a.hideOverlayLoader(this.elements.mainContainer)}.bind(this))},showAtributesSelectionView:function(){a.showOverlayLoader(d.get("custoPanel.general.overlay.loading.view"),this.elements.mainContainer),require(["DS/SNSearchResultsCusto/views/SearchResultsCustomization_AttributesSelectionView"],function(e){let t={container:this.elements.mainContainer,elements:this.elements,customization:this.customization,customizationMode:this.customizationMode,isSCC:this.isSCC};this.panelAttributesSelectionView=new e(t),this.panelAttributesSelectionView.render(),a.hideOverlayLoader(this.elements.mainContainer)}.bind(this))}})}),define("DS/SNSearchResultsCusto/views/SearchResultsCustomization_AttributesSelectionView",["UWA/Class/View","UWA/Class/Debug","UWA/Core","UWA/Element","DS/WUXAutoComplete/AutoComplete","DS/Controls/Button","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/SNResultUX/utils/ExternalComponentHelpers","DS/MessageBus/MessageBus","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","i18n!DS/SNSearchResultsCusto/assets/nls/SearchResultsCustomizationPanel.json","css!DS/SNSearchResultsCusto/SNSearchResultsCusto.css"],function(e,t,i,s,a,n,o,r,u,l,d,c,h,p,m,v,b){"use strict";return e.extend(t,{attributesSelectionView:null,container:null,customization:null,customizationMode:null,customizationStep:"nav_datasources",customizationSteps:["nav_datasources","nav_types","nav_extensions","nav_attributes","nav_predefined_query"],gridColumnsTileViews:[{text:v.get("custoPanel.attributes.name"),dataIndex:"tree"},{text:v.get("custoPanel.attributes.selection"),dataIndex:"Visibility",typeRepresentation:"boolean",type:"checkbox",editableFlag:"true",editionPolicy:"EditionInPlace"}],attributeSelectionForm:{oSourceAutocomplete:{},oTypeAutocomplete:{},oExtensionAutocomplete:{},oPredefinedQueryAutocomplete:{},oAttributesAutocomplete:{},availableTypes:null,availableExtensions:[],selectedDataSource:null,selectedTypes:[],selectedExtensions:[],selectedPredefinedQuery:[],selectedPredicates:{general:[],type:{typeObj:{},typePredicates:[]},predefinedQuery:{predefinedQueryObj:{},predefinedQueryPredicates:[]}}},init:function(e){return this.container=e.container,this.attributesSelectionView=e.elements,this.customization=e.customization,this.customizationMode=e.customizationMode,this.isSCC=e.isSCC,this._parent(e)},_buildAttributeSelectionView:async function(){this.container.classList.contains("customization-panel")&&this.container.removeClassName("customization-panel"),this.container.classList.contains("customization-panel-SCC")&&this.container.removeClassName("customization-panel-SCC"),this.container.empty(),this.isSCC?this.container.addClassName("attributes-selection-panel-SCC"):this.container.addClassName("attributes-selection-panel");var e=s.create("div",{id:"search-custo_view-steps",class:"custo-view-steps-container"}).inject(this.container);if(this._addStepSelector(e,this.customizationMode),"type"===this.customizationMode&&"nav_types"===this.customizationStep){var t=new Promise(e=>{e(this._buildSourceSelector())}),a=await t;if(i.is(a)){var o=s.create("div",{id:"search-custo_search-box",class:"custo-search-box-container"}).inject(this.container);this.autocompleteContainer=o;var r=s.create("div",{id:"search-custo_grid-attribute",class:"custo-grid-attributes-container"}).inject(this.container);this.gridPredicatesContainer=r,this._buildAutocomplete();var u=s.create("div",{id:"search-custo-preview-button",class:"custo-attributes-button"}).inject(this.container);this.attributesSelectionView.skip_button=new n({label:v.get("custoPanel.button.skip"),emphasize:"secondary",class:"custo-preview-skip-button"}).inject(u),this.attributesSelectionView.skip_button.visibleFlag=!1,this.attributesSelectionView.skip_button.addEventListener("click",function(){this._navigateStepSelector(!0);var e=this.customizationSteps.findIndex(e=>e===this.customizationStep);void 0!==this.customizationSteps[e+1]?(this.customizationStep=this.customizationSteps[e+1],this.attributesSelectionView.skip_button.visibleFlag=!1,this._buildAutocomplete()):h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",data:this.attributeSelectionForm.selectedPredicates})}.bind(this)),this.attributesSelectionView.next_button=new n({label:v.get("custoPanel.button.next"),emphasize:"primary",disabled:!0,id:"search-custo-preview-create-button",class:"custo-preview-create-button"}).inject(u),this.attributesSelectionView.next_button.addEventListener("click",function(){if(!this.attributesSelectionView.next_button.disabled){var e=this.customizationSteps.findIndex(e=>e===this.customizationStep);void 0!==this.customizationSteps[e+1]?(this.customizationStep=this.customizationSteps[e+1],"predefinedQuery"!==this.customizationMode&&("nav_extensions"===this.customizationStep?this.attributesSelectionView.skip_button.visibleFlag=!0:this.attributesSelectionView.skip_button.visibleFlag=!1),this._navigateStepSelector(!0),this._buildAutocomplete()):h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",data:this.attributeSelectionForm.selectedPredicates})}}.bind(this)),new n({label:"Cancel",emphasize:"secondary",id:"search-custo-preview-cancel-button",class:"custo-preview-cancel-button"}).inject(u).addEventListener("click",function(){h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection_canceled"})}.bind(this))}}else{o=s.create("div",{id:"search-custo_search-box",class:"custo-search-box-container"}).inject(this.container);this.autocompleteContainer=o;r=s.create("div",{id:"search-custo_grid-attribute",class:"custo-grid-attributes-container"}).inject(this.container);this.gridPredicatesContainer=r,this._buildAutocomplete();u=s.create("div",{id:"search-custo-preview-button",class:"custo-attributes-button"}).inject(this.container);this.attributesSelectionView.skip_button=new n({label:v.get("custoPanel.button.skip"),emphasize:"secondary",class:"custo-preview-skip-button"}).inject(u),this.attributesSelectionView.skip_button.visibleFlag=!1,this.attributesSelectionView.skip_button.addEventListener("click",function(){this._navigateStepSelector(!0);var e=this.customizationSteps.findIndex(e=>e===this.customizationStep);void 0!==this.customizationSteps[e+1]?(this.customizationStep=this.customizationSteps[e+1],this.attributesSelectionView.skip_button.visibleFlag=!1,this._buildAutocomplete()):h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",data:this.attributeSelectionForm.selectedPredicates})}.bind(this)),this.attributesSelectionView.next_button=new n({label:v.get("custoPanel.button.next"),disabled:!0,emphasize:"primary",id:"search-custo-preview-create-button",class:"custo-preview-create-button"}).inject(u),this.attributesSelectionView.next_button.addEventListener("click",function(){if(!this.attributesSelectionView.next_button.disabled){var e=this.customizationSteps.findIndex(e=>e===this.customizationStep);void 0!==this.customizationSteps[e+1]?(this.customizationStep=this.customizationSteps[e+1],"predefinedQuery"!==this.customizationMode&&("nav_extensions"===this.customizationStep?this.attributesSelectionView.skip_button.visibleFlag=!0:this.attributesSelectionView.skip_button.visibleFlag=!1),this._navigateStepSelector(!0),this._buildAutocomplete()):h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selected",data:this.attributeSelectionForm.selectedPredicates})}}.bind(this)),new n({label:"Cancel",emphasize:"secondary",id:"search-custo-preview-cancel-button",class:"custo-preview-cancel-button"}).inject(u).addEventListener("click",function(){h.publish({channel:"3dSearch_results_customization",topic:"3dSearch_results_customization_attributes_selection_canceled"})}.bind(this))}},_updateNextStepButton:function(){0===this.currentSelection.length?this.attributesSelectionView.next_button.disabled=!0:this.attributesSelectionView.next_button.disabled=!1},_addStepSelector:function(e,t){var i=this.attributesSelectionView,a=[];"general"===t?(this.customizationSteps=["nav_datasources","nav_types","nav_extensions","nav_attributes"],this.customizationStep="nav_datasources",this.attributesSelectionView.stepSelector.ropeWidth=20,a=[{text:v.get("custoPanel.attributes.selection.datasources"),id:"nav_datasources"},{text:v.get("custoPanel.attributes.selection.types"),id:"nav_types"},{text:v.get("custoPanel.attributes.selection.extensions"),id:"nav_extensions"},{text:v.get("custoPanel.attributes.selection.attributes"),id:"nav_attributes"}]):"type"===t?(this.customizationSteps=["nav_types","nav_extensions","nav_attributes"],this.customizationStep="nav_types",this.attributesSelectionView.stepSelector.ropeWidth=25,a=[{text:v.get("custoPanel.attributes.selection.type"),id:"nav_types"},{text:v.get("custoPanel.attributes.selection.extension.optionnal"),id:"nav_extensions"},{text:v.get("custoPanel.attributes.selection.attributes"),id:"nav_attributes"}]):(this.customizationSteps=["nav_predefined_query","nav_attributes"],this.customizationStep="nav_predefined_query",this.attributesSelectionView.stepSelector.ropeWidth=30,a=[{text:v.get("custoPanel.attributes.selection.predefinedQuery"),id:"nav_predefined_query"},{text:v.get("custoPanel.attributes.selection.attributes"),id:"nav_attributes"}]);var n=s.create("div",{id:"search-rope-container",class:"custo-view-rope-container"}).inject(e),o=(s.create("div",{class:"custo-view-rope-placeholder"}).inject(n),s.create("div",{class:"custo-view-rope"}).inject(n));"type"===t?o.setStyle("width","25%"):"predefinedQuery"===t&&o.setStyle("width","30%"),i.stepSelector.rope=o,i.stepSelector.steps=[];var r=s.create("div",{id:"search-view-navigator",class:"custo-view-navigator"}).inject(e);a.forEach(function(e){var a="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-list-test";"nav_datasources"===e.id?a="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-tag-active":"nav_types"===e.id?a="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-3d-object-question":"nav_predefined_query"===e.id?a="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-i-question":"nav_extensions"===e.id?a="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x  wux-ui-3ds-tree-view-flattened-leaves":"nav_attributes"===e.id&&(a="circle-icon enx-icon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-list-test");var n=s.create("div",{class:"custo-view-navigator-element"}).inject(r),o=s.create("div",{class:"nav-item-active-indicator"}).inject(n),u=(s.create("span",{class:"indicator-icon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down"}).inject(o),s.create("div",{class:"nav-item-circle"}).inject(n)),l=s.create("span",{class:a}).inject(u),d=s.create("div",{class:"nav-item-label",text:e.text}).inject(n);i.stepSelector.steps.push({step:e.id,content:[u,l,d]}),("nav_datasources"===e.id||"nav_predefined_query"===e.id||"nav_types"===e.id&&"type"===t)&&(u.setStyle("background-color","#3498db"),l.setStyle("color","#ffffff"),d.setStyle("color","#3498db"))})},_navigateStepSelector:function(e){"general"===this.customizationMode?e?this.attributesSelectionView.stepSelector.ropeWidth+=20:this.attributesSelectionView.stepSelector.ropeWidth-=20:"type"===this.customizationMode?e?this.attributesSelectionView.stepSelector.ropeWidth+=25:this.attributesSelectionView.stepSelector.ropeWidth-=25:e?this.attributesSelectionView.stepSelector.ropeWidth+=40:this.attributesSelectionView.stepSelector.ropeWidth-=40,this.attributesSelectionView.stepSelector.rope.setStyle("width",this.attributesSelectionView.stepSelector.ropeWidth+"%");var t=this.attributesSelectionView.stepSelector.steps.find(e=>e.step===this.customizationStep).content;e?t[0].setStyle("background-color","#3498db"):t[0].setStyle("background-color","#b4b6ba"),e?t[1].setStyle("color","#ffffff"):t[0].setStyle("color","#b4b6ba"),e?t[2].setStyle("color","#3498db"):t[1].setStyle("color","#b4b6ba")},_buildSourceSelector:async function(){this.container.addClassName("attributes-selection-panel-type");var e=new Promise((e,t)=>{e(p.custoComputeSources())}),t=await e;if(i.is(t)){var a=[];t.forEach(function(e){p.isSourceAvailable(e)&&("dashboard"===e.value&&(e.value=e.label),a.push(e))}.bind(this)),this.custo_source_selector=s.create("div",{class:"search-custo-source-selector-container"}).inject(this.container);s.create("span",{text:"Select your data source : "}).inject(this.custo_source_selector);this.source_selector=new o({elementsList:a,touchMode:!0,enableSearchFlag:!1}).inject(this.custo_source_selector),this.source_selector.addEventListener("change",function(e){i.is(e.dsModel.currentValue)&&(this.attributeSelectionForm.selectedDataSource={label:e.dsModel.currentLabel,object:e.dsModel.currentValue},this._buildAutocomplete())}.bind(this)),t.length>=1&&(this.attributeSelectionForm.selectedDataSource={label:a[0].label,object:a[0].value})}return a},_buildAutocomplete:async function(){"type"===this.customizationMode&&"nav_types"!==this.customizationStep&&this.container.classList.contains("attributes-selection-panel-type")?(this.custo_source_selector.destroy(),this.container.removeClassName("attributes-selection-panel-type")):"type"!==this.customizationMode&&this.container.classList.contains("attributes-selection-panel-type")&&this.container.removeClassName("attributes-selection-panel-type"),this.currentSelection=[],this.autocompleteContainer.empty();var e=new r,t=[],s=function(e,t,i){return new u({label:e,value:t,object:i})};switch(this.customizationStep){case"nav_datasources":c.showOverlayLoader(v.get("custoPanel.attributes.selection.datasources_loading"),this.gridPredicatesContainer),this.isMultiSearchMode=!1;var n=new Promise((e,t)=>{e(p.custoComputeSources())}),o=await n;e.prepareUpdate(),o.forEach(function(i){var a=s(i.label,i.label,i.value);e.addRoot(a),t.push({value:{label:i.label,object:i.value}})}),e.pushUpdate();break;case"nav_predefined_query":c.showOverlayLoader(v.get("custoPanel.attributes.selection.predefinedQuery_loading"),this.gridPredicatesContainer),this.isMultiSearchMode=!1;var l=new Promise((e,t)=>{e(p.custoComputePredefinedQuery())}),d=await l;e.prepareUpdate(),d.forEach(function(i){var a=s(i.abbreviations+"  ("+i.title+")",i.title,i.id);e.addRoot(a),t.push({value:{label:i.abbreviations+"  ("+i.title+")",object:i.id}})}),e.pushUpdate();break;case"nav_types":if(c.showOverlayLoader(v.get("custoPanel.attributes.selection.types_loading"),this.gridPredicatesContainer),"type"===this.customizationMode?this.isMultiSearchMode=!1:this.isMultiSearchMode=!0,null!==this.attributeSelectionForm.selectedDataSource){var h=new Promise((e,t)=>{e(p.custoComputeTypes(this.attributeSelectionForm.selectedDataSource.object))});this.attributeSelectionForm.availableTypes=await h}else{n=new Promise((e,t)=>{e(p.custoComputeSources())}),o=await n,h=new Promise((e,t)=>{e(p.custoComputeAllTypes(o))});this.attributeSelectionForm.availableTypes=await h}e.prepareUpdate(),this.attributeSelectionForm.availableTypes.items.forEach(function(i){var a={uri:i.uri,source:i.source},n=s(i.nlsName,i.nlsName,a);e.addRoot(n),t.push({value:{label:i.nlsName,object:a}})}),e.pushUpdate();break;case"nav_extensions":var m;c.showOverlayLoader(v.get("custoPanel.attributes.selection.extensions_loading"),this.gridPredicatesContainer),this.isMultiSearchMode=!0,"type"===this.customizationMode?(this.isMultiSearchMode=!1,m=this.attributeSelectionForm.selectedTypes[0]?this.attributeSelectionForm.selectedTypes[0].object.source:this.attributeSelectionForm.selectedTypes.object.source):m=this.attributeSelectionForm.selectedDataSource.object;var b=new Promise((e,t)=>{e(p.custoComputeExtensions(m,this.attributeSelectionForm.selectedTypes))}),w=await b;for(let e in w)for(let t in w[e])this.attributeSelectionForm.availableExtensions.push(w[e][t]);e.prepareUpdate(),this.attributeSelectionForm.availableExtensions.forEach(function(i){var a=s(i.name,i.name,i.value);e.addRoot(a),t.push({value:{label:i.name,object:i.value}})}),e.pushUpdate();break;case"nav_attributes":var f;c.showOverlayLoader(v.get("custoPanel.attributes.selection.attributes_loading"),this.gridPredicatesContainer);var g=!1;this.isMultiSearchMode=!0,"predefinedQuery"===this.customizationMode?(g=!0,f=Array.isArray(this.attributeSelectionForm.selectedPredefinedQuery)?this.attributeSelectionForm.selectedPredefinedQuery:[this.attributeSelectionForm.selectedPredefinedQuery]):f=this.attributeSelectionForm.selectedTypes;var y=new Promise((e,t)=>{e(p.custoComputeAllPredicates(f,this.attributeSelectionForm.selectedExtensions,g))});this.attributesPromise=await y,e.prepareUpdate(),this.attributesPromise.forEach(function(i){var a=s(i.nlsName,i.nlsName,i);e.addRoot(a),t.push({value:{label:i.nlsName,object:i}})}),e.pushUpdate()}var S=new a({elementsTree:e,multiSearchMode:this.isMultiSearchMode,filterCB:function(t){e.setFilterModel({label:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:t}}}})}}),C=this._updateAutocomplete({component:S,values:e.getRoots()});C.component.addEventListener("change",function(e){var t=null;i.is(e.dsModel.selectedItems)&&(!i.is(e.dsModel.selectedItems,"array")&&i.is(e.dsModel.selectedItems._options)?t={label:e.dsModel.selectedItems._options.label,object:e.dsModel.selectedItems._options.object}:i.is(e.dsModel.selectedItems,"array")&&(t=[],e.dsModel.selectedItems.forEach(function(e){t.push({label:e._options.label,object:e._options.object})}))),t&&("nav_datasources"===this.customizationStep?this.attributeSelectionForm.selectedDataSource=t:"nav_types"===this.customizationStep?(i.is(t,"array")?this.attributeSelectionForm.selectedTypes=t:this.attributeSelectionForm.selectedTypes=[t],"type"===this.customizationMode&&(this.attributeSelectionForm.selectedPredicates.type={typeObj:t,typePredicates:[]})):"nav_extensions"===this.customizationStep?this.attributeSelectionForm.selectedExtensions=t:"nav_attributes"===this.customizationStep?"general"===this.customizationMode?this.attributeSelectionForm.selectedPredicates.general=t:"type"===this.customizationMode?this.attributeSelectionForm.selectedPredicates.type.typePredicates=t:this.attributeSelectionForm.selectedPredicates.predefinedQuery.predefinedQueryPredicates=t:"nav_predefined_query"===this.customizationStep&&(this.attributeSelectionForm.selectedPredicates.predefinedQuery={predefinedQueryObj:t,predefinedQueryPredicates:[]}),i.is(t,"array")?this.currentSelection=t:this.currentSelection=[t]),i.is(t)||(this.currentSelection=[]),this._buildPredicatesGrid(this.dataGridAttributes,this.currentSelection),this._updateNextStepButton()}.bind(this)),C.component.inject(this.autocompleteContainer),this.dataGridAttributes=t,this._buildPredicatesGrid(t,null),this._updateNextStepButton()},_updateAutocomplete:function(e){return"nav_datasources"===this.customizationStep?(e&&(this.attributeSelectionForm.oSourceAutocomplete=e),this.attributeSelectionForm.oSourceAutocomplete):"nav_types"===this.customizationStep?(e&&(this.attributeSelectionForm.oTypeAutocomplete=e),this.attributeSelectionForm.oTypeAutocomplete):"nav_extensions"===this.customizationStep?(e&&(this.attributeSelectionForm.oExtensionAutocomplete=e),this.attributeSelectionForm.oExtensionAutocomplete):"nav_attributes"===this.customizationStep?(e&&(this.attributeSelectionForm.oAttributesAutocomplete=e),this.attributeSelectionForm.oAttributesAutocomplete):"nav_predefined_query"===this.customizationStep?(e&&(this.attributeSelectionForm.oPredefinedQueryAutocomplete=e),this.attributeSelectionForm.oPredefinedQueryAutocomplete):void 0},_buildPredicatesGrid:function(e,t){var s=this,a=[];if(this.gridPredicatesContainer.empty(),e.forEach(function(e){var n=!1;i.is(t,"array")&&t.forEach(function(t){t.label===e.value.label&&(n=!0)}.bind(this)),a.push({Text:e.value.label,Visibility:n,width:"auto",wrap:!1,custoMode:s.customizationMode})}),e){var n=this.gridColumnsTileViews,o=new l,h=new r({dataModelSet:o});h.prepareUpdate();for(var p=0,m=a.length;p<m;p++){var v=a[p],b=u.createTreeNodeDataModel(o,{label:v.Text,grid:v});h.addChild(b)}h.expandAll(),h.pushUpdate(),this.oDataGrid=new d({treeDocument:h,columns:n,layoutOptions:{layoutDensity:"comfortable"},defaultColumnDef:{width:"auto",typeRepresentation:"string"},rowSelection:"none",columnSelection:"none",cellSelection:"none",columnDragEnabledFlag:!1,rowDragEnabledFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1}).inject(this.gridPredicatesContainer),this.oDataGrid.cellSelection="single",this.oDataGrid.rowSelection="single",this.oDataGrid.addEventListener("change",function(e,t){if(t.nodeModel){var i,s=t.nodeModel.getAttributeValue("Text"),a=t.nodeModel.getAttributeValue("Visibility"),n=this._updateAutocomplete(null);if((r=n.values.findIndex(e=>e._options.label===s))>-1){var o=n.values[r];if(this.isMultiSearchMode)if(n.component.selectedItems){if(a)n.component.selectedItems.push(o);else{var r=n.component.selectedItems.findIndex(e=>e._options.label===s);n.component.selectedItems.splice(r,1)}n.component._applySelectedItems()}else n.component.selectedItems=[o];else if(a){n.component.selectedItems=[o];var u=[{label:s}];this._buildPredicatesGrid(this.dataGridAttributes,u),this.currentSelection=[]}else this.currentSelection=[],n.component.selectedItems=[],n.component._applySelectedItems();if("general"===this.customizationMode)if(a)this.currentSelection.push({label:s,custoMode:this.customizationMode,object:n.values[r]._options.object});else{r=this.currentSelection.findIndex(e=>e.label===s);this.currentSelection.splice(r,1)}else if("type"===this.customizationMode)if(a)this.currentSelection.push({label:s,custoMode:this.customizationMode,object:n.values[r]._options.object,type:this.attributeSelectionForm.selectedTypes});else{r=this.currentSelection.findIndex(e=>e.label===s);this.currentSelection.splice(r,1)}else if(a)this.currentSelection.push({label:s,custoMode:this.customizationMode,object:n.values[r]._options.object,query:this.attributeSelectionForm.selectedPredefinedQuery});else{r=this.currentSelection.findIndex(e=>e.label===s);this.currentSelection.splice(r,1)}s&&("nav_datasources"===this.customizationStep?this.attributeSelectionForm.selectedDataSource=this.currentSelection[0]:"nav_types"===this.customizationStep?(this.attributeSelectionForm.selectedTypes=this.currentSelection,"type"===this.customizationMode&&(this.attributeSelectionForm.selectedPredicates.type={typeObj:this.currentSelection[0],typePredicates:[]})):"nav_extensions"===this.customizationStep?this.attributeSelectionForm.selectedExtensions=this.currentSelection:"nav_attributes"===this.customizationStep?"general"===this.customizationMode?(i=this.currentSelection.filter((e,t)=>t===this.currentSelection.findIndex(t=>e.label===t.label)),this.attributeSelectionForm.selectedPredicates.general=i):"type"===this.customizationMode?(i=this.currentSelection.filter((e,t)=>t===this.currentSelection.findIndex(t=>e.label===t.label)),this.attributeSelectionForm.selectedPredicates.type.typePredicates=i):(i=this.currentSelection.filter((e,t)=>t===this.currentSelection.findIndex(t=>e.label===t.label)),this.attributeSelectionForm.selectedPredicates.predefinedQuery.predefinedQueryPredicates=i):"nav_predefined_query"===this.customizationStep&&(this.attributeSelectionForm.selectedPredicates.predefinedQuery={predefinedQueryObj:this.currentSelection[0],predefinedQueryPredicates:[]})),this._updateNextStepButton()}}}.bind(this))}c.hideOverlayLoader(this.gridPredicatesContainer)},render:function(){this._buildAttributeSelectionView()}})});