define("DS/DocumentFiles/ContextMenu",["UWA/Core","UWA/Promise","DS/DocumentCommands/DocumentFileCommandsV2","DS/Menu/Menu"],function(e,t,n,o){"use strict";return e.Class.extend({init:function(t){var i=this;i.ctrl=t,o.hide();var s=i.options={fetchSecurityContext:function(){return i.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getSelectedNodes:function(){return i.ctrl.controller.files.treeDocument.getSelectedNodes()},getParentDocument:function(){return i.ctrl.parentId},getModifyAccess:function(){return i.ctrl.e6wDocument.dataelements.hasModifyAccess},getDocumentFromNodeModel:function(e){return e.options.data},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId,widgetId:widget.id,component:"contextmenu"}},platformUrls:i.ctrl.options.platformServices,events:i.ctrl.events,isFromContextMenu:!0,container:i.ctrl.elements.toolbarcontainer,ctrl:i.ctrl,uaSource:"Files"};i.publicDocumentCommands=new n(s);var a=i.publicDocumentCommands.commands;i.rawItems=[a.Preview,a.OfficeWebEdition,a.Edit,a.LockAndDownload,a.Lock,a.UndoEdit,a.Unlock,a.Update,a.UpdateAndUnlock,a.FileIterations,a.CopyLink,a.Download,a.Delete],t.options.customization&&t.options.customization.postContextMenuItemsPreparation&&t.options.customization.postContextMenuItemsPreparation(i.rawItems,i.options,t.options)},rawItems:[],selectionChanged:function(){this.promise=this.publicDocumentCommands.getWebUXContextMenuItemsForCurrentSelection(this.rawItems,!0)}})}),define("DS/DocumentFiles/FilesEvents",["UWA/Core"],function(e){"use strict";return e.Class.extend({init:function(e){this.ctrl=e},connect:function(e,t,n){var o=this;this.ctrl.events.addEventListener("user-dropped-files",function(e){t.publicDocumentCommands.commands.UploadFile.execute(e.files)}),this.ctrl.events.addEventListener("user-selects-files-for-upload",function(e){t.publicDocumentCommands.commands.UploadFile.execute(e.files)}),this.ctrl.events.addEventListener("docv2-show-notification",function(t){e.helper.showNotification(t.level,t.title,t.subtitle,t.message,t.sticky,t.allowUnsafeHTML)}),this.ctrl.events.addEventListener("enox-files-collection-count-changed",function(t){e.switchView(e.view)}),this.ctrl.events.addEventListener("enox-file-node-selection-changed",function(e){t.selectionChanged()}),this.ctrl.events.addEventListener("enox-docfiles-switch-view",function(t){e.switchView(t)}),this.ctrl.events.addEventListener("search-toggle-change",function(e){t.selectionChanged()}),this.ctrl.events.addEventListener("enox-files-parent-changed",function(e){t.selectionChanged(),o.ctrl.events.publish({event:"reset-search-textbox"})}),require(["DS/PlatformAPI/PlatformAPI"],function(n){n.subscribe("docm-file-added-to-document",function(t){t.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==t.documentId&&e.files.addFiles(t.newFiles,"FilesFacet")}),n.subscribe("docm-files-deleted-from-document",function(t){t.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==t.documentId&&e.files.removeFilesByIds(t.deletedFileIds)}),n.subscribe("docm-file-updated-to-document",function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach(e=>{e.options.data.id==n.oldFileId&&(e.options.updateData(n.updatedFile),t.selectionChanged())})}),n.subscribe("docm-file-edited-in-document",function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach(e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())})}),n.subscribe("Lifecycle.Modification",function(n){((n="string"==typeof n?JSON.parse(n):n).Refresh.modified&&n.Refresh.modified[0]&&"RestoreIteration"==n.Refresh.modified[0].operation||n.Refresh.created&&n.Refresh.created[0]&&"RestoreIteration"==n.Refresh.created[0].operation)&&n.tenant==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.Refresh.modified[0].physicalid&&e.files.treeDocument.getRoots().forEach(o=>{if(o.options.data.id==e.files.treeDocument.getSelectedNodes()[0].options.data.id)e.data.getFile(e.ctrl.parentId,n.Refresh.created[0].physicalid).then(function(e){o.options.updateData(e.files),t.selectionChanged()})})}),n.subscribe("docm-file-locked-in-document",function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach(e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())})}),n.subscribe("docm-file-undoedited-in-document",function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach(e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())})}),n.subscribe("docm-file-unlocked-in-document",function(n){n.platformId==o.ctrl.options.platformServices.platformId&&o.ctrl.getParentId()==n.documentId&&e.files.treeDocument.getRoots().forEach(e=>{e.options.data.id==n.file.id&&(e.options.updateData(n.file),t.selectionChanged())})})})}})}),define("DS/DocumentFiles/views/Toolbar",["UWA/Core","DS/Tweakers/GeneratedToolbar","DS/DocumentFiles/Commands","DS/DocumentCommands/DocumentFileCommandsV2","DS/Utilities/Utils"],function(e,t,n,o,i){"use strict";return e.Class.extend({init:function(e){var t=this;t.ctrl=e,e.toolbar=this,t.selectionChanged=i.debounce(function(){t.publicDocumentCommands.selectionChangedForWebUXToolbar(t.GeneratedToolbar),t.privateCommands.selectionChangedForWebUXToolbar(t.GeneratedToolbar),t.ctrl.options.customization&&t.ctrl.options.customization.selectionChangedForWebUXToolbar&&t.ctrl.options.customization.selectionChangedForWebUXToolbar(t.GeneratedToolbar,t.ctrl.options)},10),t.ctrl.events.subscribe({event:"selection-add"},function(){t.selectionChanged()}),t.ctrl.events.subscribe({event:"selection-remove"},function(){t.selectionChanged()})},build:function(i){var s=this;let a,r={entries:[]};var l={fetchSecurityContext:function(){return s.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getWorkUnderHeaders:function(){return{}},getSelectedNodes:function(){return s.ctrl.controller.files.treeDocument.getSelectedNodes()},getParentDocument:function(){return s.ctrl.parentId},getModifyAccess:function(){return s.ctrl.e6wDocument.dataelements.hasModifyAccess},getDocumentFromNodeModel:function(e){return e.options.data},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId,widgetId:widget.id,component:"toolbar"}},platformUrls:s.ctrl.options.platformServices,events:s.ctrl.events,container:i,ctrl:s.ctrl,uaSource:"Files"};s.privateCommands=new n(l);var c=s.privateCommands.commands;s.publicDocumentCommands=new o(l);var d=s.publicDocumentCommands.commands;r.entries=[c.SearchTextBox,c.SearchToggle,d.UploadFile,d.Preview,d.OfficeWebEdition,d.Edit,d.LockAndDownload,d.Lock,d.UndoEdit,d.Unlock,d.Update,d.UpdateAndUnlock,d.FileIterations,d.CopyLink,d.Download,d.Delete,c.SortSwitcher,c.ViewSwitcher],s.ctrl.options.customization&&s.ctrl.options.customization.postToolbarItemsPreparation&&s.ctrl.options.customization.postToolbarItemsPreparation(r.entries,l,s.ctrl.options),a=s.ToolbarTreeDocument=t.prototype.createTreeDocument(r);let u=s.GeneratedToolbar=new t({items:a,direction:"horizontal",overflowManagement:"dropdown",executionContext:{}});return s.privateCommands.connectToWebUXToolbar(u),s.publicDocumentCommands.connectToWebUXToolbar(u),s.ctrl.options.customization&&s.ctrl.options.customization.connectToWebUXToolbar&&s.ctrl.options.customization.connectToWebUXToolbar(u,l,s.ctrl.options),u.inject(i),u},selectionChanged:void 0})}),define("DS/DocumentFiles/views/UploadPane",["UWA/Core","UWA/Controls/Abstract","DS/Utilities/Dom","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],function(e,t,n,o,i,s){"use strict";return e.Controls.Abstract.extend({name:"enox-files-upload-pane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.uploadPane=this,this._parent({})},build:function(t){var o=this;this.elements.container=e.createElement("div",{class:o.ctrl.getClassNames("-uploadpane")});var a=e.createElement("div",{class:o.ctrl.getClassNames("-uploadpane-center")});(a.inject(this.elements.container),o.ctrl.options.readonly)?e.createElement("span",{class:o.ctrl.getClassNames("-uploadpane-center-msg"),text:s.get("NO_FILES_ATTACHED")}).inject(a):(n.generateIcon({iconName:"drag-drop",fontIconSize:"2x"}).inject(a),e.createElement("span",{class:o.ctrl.getClassNames("-uploadpane-center-msg"),text:s.get("DROP_A_FILE_OR")}).inject(a),o.uploadButton=this.elements.container.uploadButton=new i({input:!1,multiple:!0,buttonText:s.get("UPLOAD_FILE"),attributes:{title:s.get("UPLOAD_FILE")},buttonClassName:"primary "+o.ctrl.getClassNames("-uploadbutton"),events:{onChange:function(e){var t=e.target.files.length>0?e.target.files:e.dataTransfer.files;o.ctrl.events.publish({event:"user-selects-files-for-upload",data:{cancelled:!1,files:t}})},onClick:function(){event.target.value=""}}}),o.uploadButton.inject(a));o.inject(t)},show:function(){this.elements.container.show()},hide:function(){this.elements.container.hide()}})}),define("DS/DocumentFiles/actions/SearchTextBox",["UWA/Core","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],function(e,t){"use strict";var n=function(e){return{id:"SearchTextBox",dataElements:{docV2Private:!0,typeRepresentation:"string",allowResetToUndefinedByUIFlag:!0,label:t.get("Search"),tooltip:t.get("Search"),position:"far",category:"search",events:{change:function(e,t,n){console.log(e,t,n)}},visibleFlag:!1,priority:10},updateForSelection:function(t,n){console.log(this,e,n),t({visibleFlag:!!e.searchActive}),e.searchActive?(this.action._associatedView.focus(),e.events.publish({event:"search-text-change",data:this.grid.data})):e.events.publish({event:"search-text-change",data:""})},onNodeLiveUpdate:function(t,n,o){e.events.publish({event:"search-text-change",data:n})},extend:function(t,n){var o=this;this.action=t,e.events.addEventListener("reset-search-textbox",function(t){console.log("reset-search-textbox",o,e),o.action.updateOptions({grid:{data:""}})})},execute:function(){n.execute({options:e})}}};return n.execute=function(e){e.options.getSelectedNodes()},n}),define("DS/DocumentFiles/views/TilePane",["UWA/Core","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewTreeDocumentModelProvider"],function(e,t,n){"use strict";return e.Controls.Abstract.extend({name:"enox-documentfiles-tilepane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.tilePane=this,this._parent({})},build:function(o){var i=this;i.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});let s=n.inherit({name:"FileTileViewTreeDocumentModelProvider",getPropertyValue:function(e,t){return"subLabel"===t?e.options.subLabel.cloneNode(!0):this._parent(e,t)}});i.rcv=this.ctrl.tilesRCV=new t({model:i.ctrl.controller.files.treeDocument,useDragAndDrop:!0,shouldCellAllowUnsafeHTMLContentAt:function(e,t){return["subtitle","description"].includes(t)},displayedOptionalCellProperties:["contextualMenu","description","activeFlag"],onDropBlank:function(e,t){e.preventDefault(),e.stopPropagation(),i.ctrl.dndManager.handleDrop(e),this.onDropBlankDefault(e,t)},displayPropertiesTooltip:!1}).inject(i.elements.container),i.rcv.modelProvider=new s,i.rcv.getContextualMenu=function(e,t,n){return[""]},i.rcv.onContextualEvent={callback:function(e){return e&&e.cellInfos?(i.ctrl.contextMenu.selectionChanged(),i.ctrl.contextMenu.promise):(e.cellCtxMenuRequired,[])}},i.rcv.onPostCellRequest(function(e){e.nodeModel.options.data.thumbnailRequested||!["gif","jpg","png","giff","jpeg"].includes(e.nodeModel.options.data.dataelements.fileExtension.toLowerCase())||e.nodeModel.options.data.dataelements.image.includes("fcs/media")||(i.ctrl.controller.data.generateFileThumbnail(i.ctrl.parentId,e.nodeModel.options.data.id,e.nodeModel.options.data.dataelements.title,e.nodeModel.options.data.dataelements.format),e.nodeModel.options.data.thumbnailRequested=!0)}),i.rcv.onSelectionAdd(function(e,t){i.ctrl.events.publish({event:"enox-file-node-selection-add",data:e}),i.ctrl.events.publish({event:"enox-file-node-selection-changed",data:e})}),i.rcv.onSelectionRemove(function(e,t){i.ctrl.events.publish({event:"enox-file-node-selection-remove",data:e}),i.ctrl.events.publish({event:"enox-file-node-selection-changed",data:e})}),i.inject(o)}})}),define("DS/DocumentFiles/views/Topbar",["UWA/Core","DS/DocumentFiles/views/Toolbar"],function(e,t){"use strict";return e.Controls.Abstract.extend({name:"enox-documentfiles-topbar",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this._parent({})},build:function(n){this.elements.container=e.createElement("div",{class:this.getClassNames("-topbar")}),this.elements.toolbar=new t(this.ctrl),this.elements.toolbar.build(this.elements.container),this.elements.container.inject(n)},updateToolbar:function(){this.elements.toolbar.selectionChanged()}})}),define("DS/DocumentFiles/actions/SearchToggle",["UWA/Core","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],function(e,t){"use strict";var n=function(e){return{id:"SearchToggle",dataElements:{docV2Private:!0,typeRepresentation:"functionIcon",icon:{iconName:"search",fontIconFamily:1},label:t.get("Search"),tooltip:t.get("Search"),position:"far",category:"search",value:function(t){t.options=e,n.execute(t)},visibleFlag:!0,priority:10},updateForSelection:function(t,n){t({icon:{iconName:"search",fontIconFamily:1,className:e.searchActive?"search-active":""}})},execute:function(){n.execute({options:e})}}};return n.execute=function(e){e.options.searchActive=!e.options.searchActive;e.options.getSelectedNodes();e.options.events.publish({event:"search-toggle-change",data:e.options.searchActive})},n}),define("DS/DocumentFiles/actions/SortSwitcher",["UWA/Core","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],function(e,t){"use strict";var n=function(e){return{id:"SortSwitcher",dataElements:{docV2Private:!0,typeRepresentation:"chevronMenuIcon",icon:{iconName:"date-sorting-31-1",fontIconFamily:1},value:{menu:[{type:"RadioItem",title:t.get("e6wFileField.title"),name:"title",dataIndex:"tree",sort:"asc",sortType:"string",icon:{iconName:"alpha-sorting-a-z",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}},{type:"RadioItem",title:t.get("e6wFileField.owner"),name:"owner",dataIndex:"owner",sort:"asc",sortType:"string",icon:{iconName:"alpha-sorting-a-z",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}},{type:"RadioItem",title:t.get("e6wFileField.fileExtension"),name:"fileExtension",dataIndex:"fileExtension",sort:"asc",sortType:"string",icon:{iconName:"alpha-sorting-a-z",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}},{type:"RadioItem",title:t.get("e6wFileField.modified"),name:"modified",dataIndex:"modified",sort:"desc",sortType:"date",icon:{iconName:"date-sorting-31-1",fontIconFamily:1},action:{callback:function(e){n.execute(e,this)},context:{options:e}}}]},label:t.get("e6wFileField.modified"),tooltip:t.get("e6wFileField.modified"),position:"far",category:"stable area",visibleFlag:!0,priority:10},updateForSelection:function(e,t){},extend:function(t,n){var o=e.ctrl.controller.files.sortModel;null==o&&(o={sortAttribute:"modified",sort:"desc",dataIndex:"modified"}),t.options.grid.data.menu.forEach(e=>{e.action.context.name=e.name,e.action.context.dataIndex=e.dataIndex,e.action.context.action=t,e.action.context.radioItem=e,e.action.this=e,e.state="",o.sortAttribute==e.action.context.name&&(e.state="selected","string"==e.sortType?e.icon.iconName="asc"==o.sort?"alpha-sorting-a-z":"alpha-sorting-z-a":"date"==e.sortType&&(e.icon.iconName="asc"==o.sort?"date-sorting-1-31":"date-sorting-31-1"),e.sort=o.sort,t.selectedDataIndex=e.dataIndex,t.selectedDataIndex6w=e.dataIndex6w,t.updateOptions({icon:e.icon,tooltip:e.title,label:e.title}))})}}};return n.execute=function(e,t){e.context.action.options.grid.data.menu.forEach(e=>{e.state=""}),t.state="selected",e.context.action.selectedDataIndex!=e.context.dataIndex?(e.context.action.selectedDataIndex=e.context.dataIndex,e.context.options.events.publish({event:"applySortModel",data:[{sortAttribute:t.name,sort:t.sort,dataIndex:t.dataIndex}]}),e.context.action.updateOptions({icon:t.icon,tooltip:t.title,label:t.title})):(t.sort="asc"==t.sort?"desc":"asc","string"==t.sortType?t.icon.iconName="asc"==t.sort?"alpha-sorting-a-z":"alpha-sorting-z-a":"date"==t.sortType&&(t.icon.iconName="asc"==t.sort?"date-sorting-1-31":"date-sorting-31-1"),e.context.action.selectedDataIndex=e.context.dataIndex,e.context.options.events.publish({event:"applySortModel",data:[{sortAttribute:t.name,sort:t.sort,dataIndex:t.dataIndex}]}),e.context.action.updateOptions({icon:t.icon,tooltip:t.title,label:t.title}))},n}),define("DS/DocumentFiles/utils/Helper",["UWA/Core","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages"],function(e,t,n){"use strict";return function(o){var i={showNotification:function(e,o,i,s,a,r){var l={level:e,title:o,subtitle:i,message:s,sticky:a,allowUnsafeHTML:r||!1};window.notifs||(window.notifs=n,t.setNotificationManager(window.notifs),t.setStackingPolicy(5)),window.notifs.addNotif(l)},make3DXContent:function(e,t){var n={protocol:"3DXContent",version:"2.0",source:"ENOXFILES",widgetId:widget.id,data:{items:[]}};return e.forEach(function(e){var o={envId:i.ctrl.options.connectorOptions.platformUrls.platformId,serviceId:"3DSpace",contextId:i.ctrl.options.connectorOptions.fetchSecurityContext(),objectId:e.options.data.id,objectType:e.options.data.type};t&&t.includeObjectTaxonomies&&(o.objectTaxonomies=e.options.taxonomies),n.data.items.push(o)}),n},restrict:function(t,n){if(e.is(t,"array")){if("id"==n)return t.map(function(e){return e.id});if("options.data.id"==n)return t.map(function(e){return e.options.data.id})}else{if("id"==n)return t.id;if("options.data.id"==n)return t.options.data.id}},debounce:function(e,t,n){var o=null,i=[];return function(){if(n){for(var s=[],a=0;a<arguments.length;++a)s.push(arguments[a]);i.push(s)}o&&clearTimeout(o);var r=arguments;o=setTimeout(function(){t.apply(n?{data:i}:null,r),i=[],o=null},e)}},saveViewMode:function(t){var n=localStorage.getItem("ENOXFilesUXViewMode");(n=e.Json.isJson(n)?JSON.parse(n):{})["Files_"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)]=t,localStorage.setItem("ENOXFilesUXViewMode",JSON.stringify(n))},loadViewMode:function(){var t=localStorage.getItem("ENOXFilesUXViewMode");if(e.Json.isJson(t)){var n=(t=JSON.parse(t))["Files_"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)];return"tile"==n||"grid"==n?n:"tile"}return"tile"}};return i.ctrl=o,o.helper=i,i}}),define("DS/DocumentFiles/data/Columns",["UWA/Core","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],function(e,t){"use strict";return e.Class.extend({ready:void 0,predefinedColumns:[{name:"title",includeAlways:!0,typeRepresentation:"url",dataIndex:"tree",pinned:"left",width:"300",className:"preview-column"},{name:"revision",typeRepresentation:"integer",includeAlways:!0},{name:"comments",typeRepresentation:"string",includeAlways:!0,readonly:"false",editableFlag:!0},{name:"lockStatus",typeRepresentation:"string",visibleFlag:!0,needsCustomImplementation:!0,include:"lockerInfo",fields:["lockerInfo.name","lockerInfo.firstname","lockerInfo.lastname"]},{name:"owner",typeRepresentation:"user",includeAlways:!0,needsCustomImplementation:!0,include:"ownerInfo",includeAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"]},{name:"originated",typeRepresentation:"datetime",visibleFlag:!1},{name:"modified",typeRepresentation:"datetime",includeAlways:!0},{name:"fileSize",typeRepresentation:"integer",visibleFlag:!1},{name:"fileExtension",typeRepresentation:"string",visibleFlag:!1,include:"files",includeAlways:!0,fields:["files.name","files.title","files.revision","files.locker","files.image"]},{name:"ownerInfo",conditionalInclude:"owner",include:"ownerInfo",includeAlways:!0,hiddenAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"]}],predefinedColumnsDictionary:void 0,customColumnsSelectableDictionary:void 0,customColumnsDictionary:void 0,customColumns:void 0,init:function(n){var o=this;o.ready=e.Promise.deferred(),o.predefinedColumnsDictionary={},o.customColumnsSelectableDictionary={},o.customColumnsDictionary={},o.customColumns=[],o.predefinedColumnsDictionary={},o.predefinedColumns.forEach(e=>{e.text=t.get("e6wFileField."+e.name),e.typeRepresentation&&(null==e.dataIndex&&(e.dataIndex=e.name),o.predefinedColumnsDictionary[e.name]=e)})},getColumns:function(){return[...this.predefinedColumns.filter(e=>e.typeRepresentation)]}})}),define("DS/DocumentFiles/utils/ExtensionUtils",["UWA/Core","DS/WebappsUtils/WebappsUtils"],function(e,t){"use strict";var n="snresources/images/icons/large/I_IGES200x150.png",o="snresources/images/icons/large/I_STEP200x150.png",i="snresources/images/icons/large/I_ComposerSmg200x150.png",s="snresources/images/icons/large/I_TableDoc200x150.png",a="snresources/images/icons/large/I_PresDoc200x150.png",r="snresources/images/icons/large/I_TextDoc200x150.png",l="snresources/images/icons/large/l_DIAG200x150.png",c="snresources/images/icons/large/I_ImageFile200x150.png",d="snresources/images/icons/large/I_VideoFile200x150.png",u="snresources/images/icons/large/I_AudioFile200x150.png",m="snresources/images/icons/large/I_UnknownFile200x150.png",p={content:"snresources/images/icons/large/I_UnknownFile200x150.png","*":m,sldprt:"snresources/images/icons/large/I_SWV1_Part200x150.png",sldasm:"snresources/images/icons/large/I_SWV1_Assembly200x150.png",slddrw:"snresources/images/icons/large/I_SWV1_Drawing200x150.png",eprt:"snresources/images/icons/large/I_EPRT200x150.png",easm:"snresources/images/icons/large/I_EASM200x150.png",edrw:"snresources/images/icons/large/I_EDRW200x150.png",catpart:"snresources/images/icons/large/I_CATV5_Part200x150.png",catproduct:"snresources/images/icons/large/I_CATV5_Assembly200x150.png",catdrawing:"snresources/images/icons/large/I_CATV5_Drawing200x150.png","3dxml":"snresources/images/icons/large/I_3DXML200x150.png","3mf":"snresources/images/icons/large/I_3MF200x150.png",dwg:"snresources/images/icons/large/I_DWG200x150.png",dxf:"snresources/images/icons/large/I_DXF200x150.png",sldxml:"snresources/images/icons/large/l_SLDX200x150.png",u3d:"snresources/images/icons/large/l_3PDF200x150.png",iges:n,igs:n,obj:"snresources/images/icons/large/I_OBJ200x150.png",stp:o,step:o,stl:"snresources/images/icons/large/I_STL200x150.png",vrml:"snresources/images/icons/large/I_VRML200x150.png",smg:i,smggeom:i,smgxml:i,smgview:i,smgsce:i,axf:"snresources/images/icons/large/I_AxF200x150.png",xls:s,xlsx:s,numbers:s,csv:s,ppt:a,pptx:a,potm:a,potx:a,ppsm:a,pps:a,keynote:a,txt:r,log:r,doc:r,docx:r,mpp:"snresources/images/icons/large/l_PROJ200x150.png",vsd:l,vsdx:l,pdf:"snresources/images/icons/large/I_PDFdoc200x150.png",png:c,jpg:c,jpeg:c,gif:c,tiff:c,tif:c,bmp:c,psd:c,ai:c,"image/*":c,wmv:d,mp4:d,mov:d,avi:d,mpg:u,wma:u,mp3:u,wav:u,zip:"snresources/images/icons/large/I_ZIPDoc200x150.png",multidocument:"snresources/images/icons/large/docWithMultiFiles.png"},f="snresources/images/icons/small/I_IGES22x22.png",g="snresources/images/icons/small/I_STEP22x22.png",h="snresources/images/icons/small/I_ComposerSmg22x22.png",v="snresources/images/icons/small/I_TableDoc22x22.png",w="snresources/images/icons/small/I_PresDoc22x22.png",D="snresources/images/icons/small/I_TextDoc22x22.png",I="snresources/images/icons/small/l_DIAG22x22.png",S="snresources/images/icons/small/I_ImageFile22x22.png",x="snresources/images/icons/small/I_VideoFile22x22.png",b="snresources/images/icons/small/I_AudioFile22x22.png",F="snresources/images/icons/small/I_UnknownFile22x22.png",C={content:"snresources/images/icons/small/I_UnknownFile22x22.png","*":F,sldprt:"snresources/images/icons/small/I_SWV1_Part22x22.png",sldasm:"snresources/images/icons/small/I_SWV1_Assembly22x22.png",slddrw:"snresources/images/icons/small/I_SWV1_Drawing22x22.png",eprt:"snresources/images/icons/small/I_EPRT22x22.png",easm:"snresources/images/icons/small/I_EASM22x22.png",edrw:"snresources/images/icons/small/I_EDRW22x22.png",catpart:"snresources/images/icons/small/I_CATV5_Part22x22.png",catproduct:"snresources/images/icons/small/I_CATV5_Assembly22x22.png",catdrawing:"snresources/images/icons/small/I_CATV5_Drawing22x22.png","3dxml":"snresources/images/icons/small/I_3DXML22x22.png","3mf":"snresources/images/icons/small/I_3MF22x22.png",dwg:"snresources/images/icons/small/I_DWG22x22.png",dxf:"snresources/images/icons/small/I_DXF22x22.png",sldxml:"snresources/images/icons/small/l_SLDX22x22.png",u3d:"snresources/images/icons/small/l_3PDF22x22.png",iges:f,igs:f,obj:"snresources/images/icons/small/I_OBJ22x22.png",stp:g,step:g,stl:"snresources/images/icons/small/I_STL22x22.png",vrml:"snresources/images/icons/small/I_VRML22x22.png",smg:h,smggeom:h,smgxml:h,smgview:h,smgsce:h,axf:"snresources/images/icons/small/I_AxF22x22.png",xls:v,xlsx:v,numbers:v,csv:v,ppt:w,pptx:w,potm:w,potx:w,ppsm:w,pps:w,keynote:w,txt:D,log:D,doc:D,docx:D,mpp:"snresources/images/icons/small/l_PROJ22x22.png",vsd:I,vsdx:I,pdf:"snresources/images/icons/small/I_PDFdoc22x22.png",png:S,jpg:S,jpeg:S,gif:S,tiff:S,tif:S,bmp:S,psd:S,ai:S,"image/*":S,wmv:x,mp4:x,mov:x,avi:x,mpg:b,wma:b,mp3:b,wav:b,zip:"snresources/images/icons/small/I_ZIPDoc22x22.png",multidocument:"snresources/images/icons/small/I_MultipleDocuments22x22.png"};return{getThumbnail:function(e){return p[e]||m},getIcon:function(e){return C[e]||F}}}),define("DS/DocumentFiles/actions/ViewSwitcher",["UWA/Core","DS/Tweakers/TypeEnums","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],function(e,t,n){"use strict";var o=function(e){var o=e.ctrl.controller.view,i=t.Layout.DataGridView;return"grid"==o?i=t.Layout.DataGridView:"tile"==o&&(i=t.Layout.SmallTile),{id:"ViewSwitcher",dataElements:{docV2Private:!0,typeRepresentation:"layout",tooltip:n.get("SwitchView"),value:i,possibleValues:[t.Layout.DataGridView,t.Layout.SmallTile],position:"far",category:"stable area",visibleFlag:!0,priority:10},updateForSelection:function(e,t){},onNodeUpdate:function(n){var o="",i=n.getAttributeValue("data").value;i===t.Layout.DataGridView.value?o="grid":i===t.Layout.SmallTile.value&&(o="tile"),e.events.publish({event:"enox-docfiles-switch-view",data:o})},extend:function(e,t){}}};return o.execute=function(e,t){},o}),define("DS/DocumentFiles/Commands",["UWA/Core","DS/DocumentFiles/actions/SearchTextBox","DS/DocumentFiles/actions/SearchToggle","DS/DocumentFiles/actions/SortSwitcher","DS/DocumentFiles/actions/ViewSwitcher"],function(e,t,n,o,i){"use strict";return e.Class.extend({init:function(e){this.commands={SearchTextBox:new t(e),SearchToggle:new n(e),SortSwitcher:new o(e),ViewSwitcher:new i(e)}},commands:[],connectToWebUXToolbar:function(e){e.items.prepareUpdate(),e.items.getRoots().forEach(e=>{e.options.docV2Private&&e.options.extend&&e.options.extend(e)}),e.items.pushUpdate()},selectionChangedForWebUXToolbar:function(t){t.items.getRoots().forEach(t=>{t.options.docV2Private&&(t.options.grid.action=t,t.options.grid.data&&(t.options.grid.data.argument&&(t.options.grid.data.argument.action=t),t.options.grid.data.value&&!e.is(t.options.grid.data.value,"string")&&(t.options.grid.data.value.action=t)),t.options.updateForSelection&&t.options.updateForSelection(function(e){t.updateOptions(e)}))})}})}),define("DS/DocumentFiles/data/Model",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/Controls/Label","DS/DocumentFiles/utils/ExtensionUtils","i18n!DS/DocumentFiles/assets/nls/DocumentFiles"],function(e,t,n,o,i,s){"use strict";var a=new n;function r(t,n,o){n.customization&&n.customization.preMakeModelDataOptions&&n.customization.preMakeModelDataOptions(t,n),t.dataelements.originated&&(t.dataelements.originated=new Date(t.dataelements.originated)),t.dataelements.modified&&(t.dataelements.modified=new Date(t.dataelements.modified)),e.is(t.dataelements.fileSize,"string")&&(t.dataelements.fileSize=parseInt(t.dataelements.fileSize)),e.is(t.dataelements.revision,"string")&&(t.dataelements.revision=parseInt(t.dataelements.revision)),a.generateView(t.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){t.dataelements.modifiedAsString=e.getContent().getText()}}),""==t.dataelements.reservedby&&(t.dataelements.reservedby=void 0),t.dataelements.type=t.type;var r={data:t,grid:t.dataelements,lowercase:{}};r.label=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,r.lowercase.label=r.label.toLowerCase(),r.title=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,r.icons=[{iconName:"doc-text"}],r.grid.tree=r.title,r.thumbnail=t.dataelements.indexedImage||t.dataelements.image,null==r.thumbnail&&(r.thumbnail=n.platformServices["3DSpace"]+"/"+i.getThumbnail(l(r.title))),r.taxonomies=[t.type],"TRUE"!=t.dataelements.isDocumentType||r.taxonomies.includes("Document")||r.taxonomies.push("Document"),r.icons=[n.platformServices["3DSpace"]+"/"+i.getIcon(l(r.title))],t.relateddata&&t.relateddata.ownerInfo&&1==t.relateddata.ownerInfo.length&&t.relateddata.ownerInfo[0].dataelements&&(t.dataelements.owner={label:t.relateddata.ownerInfo[0].dataelements.firstname+" "+t.relateddata.ownerInfo[0].dataelements.lastname,username:t.relateddata.ownerInfo[0].dataelements.name},t.dataelements.owner.labelAndUsername=t.dataelements.owner.label+" ("+t.dataelements.owner.username+")",r.lowercase.owner={label:t.dataelements.owner.label.toLowerCase(),username:t.dataelements.owner.username.toLowerCase()},n.platformServices&&n.platformServices["3DSwym"]&&(t.dataelements.owner.icon=n.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.ownerInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.originatorInfo&&1==t.relateddata.originatorInfo.length&&t.relateddata.originatorInfo[0].dataelements&&(t.dataelements.originator={label:t.relateddata.originatorInfo[0].dataelements.firstname+" "+t.relateddata.originatorInfo[0].dataelements.lastname,username:t.relateddata.originatorInfo[0].dataelements.name},n.platformServices&&n.platformServices["3DSwym"]&&(t.dataelements.originator.icon=n.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.originatorInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.lockerInfo&&1==t.relateddata.lockerInfo.length&&t.relateddata.lockerInfo[0].dataelements&&(t.dataelements.lockerInfo={label:t.relateddata.lockerInfo[0].dataelements.firstname+" "+t.relateddata.lockerInfo[0].dataelements.lastname,username:t.relateddata.lockerInfo[0].dataelements.name},t.dataelements.lockerInfo.labelAndUsername=t.dataelements.lockerInfo.label+" ("+t.dataelements.lockerInfo.username+")",r.lowercase.locker={label:t.dataelements.lockerInfo.label.toLowerCase(),username:t.dataelements.lockerInfo.username.toLowerCase()},n.platformServices&&n.platformServices["3DSwym"]&&(t.dataelements.lockerInfo.icon=n.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.lockerInfo[0].dataelements.name+"/format/mini"));var c=[];return t.dataelements&&e.is(t.dataelements.title,"string")&&c.push(l(t.dataelements.title)),t.dataelements.fileExtension=c.join(", "),r.subLabel=function(t){var n=e.createElement("div",{class:"NameAndState"});return a.generateView(t.grid.owner,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(n)}}),n}(r),r.description=function(t){var n=e.createElement("div",{class:"property-description"});return a.generateView(s.get("e6wFileField.modified")+":",{readOnly:!0,typePath:"string",onViewCreated:function(e){e.inject(n)}}),a.generateView(t.grid.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){e.inject(n)}}),n}(r),r.lowercase.comments=t.dataelements.comments.toLowerCase(),r.getAttributeValueForFiltering=function(e){switch(console.log(e),e){case"owner":return t.dataelements.owner.labelAndUsername;case"lockStatus":return t.dataelements.lockerInfo?t.dataelements.lockerInfo.labelAndUsername:void 0;default:return r.getAttributeValue?r.getAttributeValue(e):o.getAttributeValue(e)}},n.customization&&n.customization.postMakeModelDataOptions&&n.customization.postMakeModelDataOptions(r,n),r}function l(e){return e.substring(e.lastIndexOf(".")+1,e.length)||e}var c=function(e,n){var o=r(e,n);o.updateData=function(e){i.updateOptions(r(e,n,i))};var i=new t(o);return o.getAttributeValue=i.getAttributeValue.bind(i),i};return c.getFileExtension=l,c}),define("DS/DocumentFiles/views/GridPane",["UWA/Core","DS/DataGridView/DataGridView","DS/TreeModel/DataModelSet","DS/Tweakers/TypeRepresentationFactory","DS/Controls/TooltipModel","DS/Utilities/Utils","DS/DocumentFiles/data/Columns","DS/DocumentCommands/Helper","DS/Utilities/StringUtils","i18n!DS/DocumentFiles/assets/nls/DocumentFiles","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(e,t,n,o,i,s,a,r,l,c,d){"use strict";var u=new o;return e.Controls.Abstract.extend({name:"enox-documentfiles-gridpane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.gridPane=this,this._parent({})},build:function(n){var o=this;o.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});var s=(new a).getColumns(),m="documentfiles-"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)+"-gridview";s.forEach(e=>{"title"==e.name?e.getCellValue=function(e){return{label:e.nodeModel.getLabel(),func:function(e){o.ctrl.events.publish({event:"enox-doco-show-preview",data:{nodeModels:e.context.nodeModel}})}}}:"owner"==e.name||"originator"==e.name?e.getCellValue=function(t){if(t.nodeModel)return o.ctrl.options.platformServices["3DSwym"]?{icon:o.ctrl.options.platformServices["3DSwym"]+"/api/user/getpicture/login/"+t.nodeModel.getAttributeValue(e.name).username+"/format/mini",label:t.nodeModel.getAttributeValue(e.name).label}:{label:t.nodeModel.getAttributeValue(e.name).label}}:"lockStatus"==e.name?(e.onCellRequest=function(e){var t=o.datagridview.reuseCellContent("lockStatusCell"),n=[],s={},a={};e.nodeModel.options.data.dataelements.locker&&(n.includes(e.nodeModel.options.data.dataelements.locker)||(n.push(e.nodeModel.options.data.dataelements.locker),a[e.nodeModel.options.data.dataelements.locker]=[]),a[e.nodeModel.options.data.dataelements.locker].push(e.nodeModel.options.data.dataelements.title),e.nodeModel.options.data.relateddata.lockerInfo&&e.nodeModel.options.data.relateddata.lockerInfo.length>0&&(s[e.nodeModel.options.data.dataelements.locker]=e.nodeModel.options.data.relateddata.lockerInfo[0].dataelements)),t.greenKey.hide(),t.redLock.hide(),t.singleUser.hide(),t.singleUser.empty();var r,l,d=n.length,m=o.ctrl.options.user;if(d>0)if(n.includes(m.id)){t.redLock.hide(),t.greenKey.show();var p=(r=s[m.id])?r.firstname+" "+r.lastname:m.id;l={label:p},o.ctrl.options.platformServices["3DSwym"]&&(l.icon=o.ctrl.options.platformServices["3DSwym"]+"/api/user/getpicture/login/"+m.id+"/format/mini"),u.generateView(l,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(t.singleUser),t.singleUser.show(),e.tooltipInfos=new i({shortHelp:c.get("LockedByUsername",{username:m.id})})}})}else t.redLock.show(),t.greenKey.hide(),n.forEach(function(e){var n=(r=s[e])?r.firstname+" "+r.lastname:e;l={label:n},o.ctrl.options.platformServices["3DSwym"]&&(l.icon=o.ctrl.options.platformServices["3DSwym"]+"/api/user/getpicture/login/"+e+"/format/mini"),u.generateView(l,{readOnly:!0,typePath:"user",onViewCreated:function(n){n.inject(t.singleUser),t.singleUser.show(),n.tooltipInfos=new i({shortHelp:c.get("LockedByUsername",{username:e})})}})});e.cellView.setReusableContent(t)},e.compareFunction=function(e,t,n,o,i){var s="",a="",r="",c="";return n.options.data.dataelements.locker&&(r=n.options.data.relateddata.lockerInfo&&n.options.data.relateddata.lockerInfo.length>0?(s=n.options.data.relateddata.lockerInfo[0].dataelements).firstname+" "+s.lastname:n.options.data.dataelements.locker),o.options.data.dataelements.locker&&(c=o.options.data.relateddata.lockerInfo&&o.options.data.relateddata.lockerInfo.length>0?(a=o.options.data.relateddata.lockerInfo[0].dataelements).firstname+" "+a.lastname:o.options.data.dataelements.locker),l.compareLocal(r,c)}):"fileSize"==e.name&&(e.getCellValue=function(e){return r.formatBytes(e.nodeModel.options.data.dataelements.fileSize,2).split(" ")[0]},e.getCellSemantics=function(e){return{units:r.formatBytes(e.nodeModel.options.data.dataelements.fileSize,2).split(" ")[1]}},e.getCellTooltip=function(e){return e.nodeModel?new i({shortHelp:e.nodeModel.options.data.dataelements.fileSize+" "+d.get("fileSizeBytes")}):o.datagridview.getCellDefaultTooltip(e)})});var p=window.localStorage.getItem("wux-collectionView-dataGridView");null!=p&&(p=JSON.parse(p))[m]&&(delete p[m].columnsSortModel,window.localStorage.setItem("wux-collectionView-dataGridView",JSON.stringify(p))),o.ctrl.options.customization&&o.ctrl.options.customization.preDataGridColumnBinding&&o.ctrl.options.customization.preDataGridColumnBinding(s,o.ctrl.options),o.datagridview=new t({identifier:m,treeDocument:o.ctrl.controller.files.treeDocument,columns:s,autoRowHeightFlag:!0,rowDragEnabledFlag:!1,cellDragEnabledFlag:!0,rowGroupingEnabledFlag:!1,defaultColumnDef:{editableFlag:!1,resizableFlag:!0,sortableFlag:!0,typeRepresentation:"string"},selectionMode:"row",showContextualMenuColumnFlag:!0,rowSelection:"multiple",cellSelection:"none",showSelectionCheckBoxesFlag:!0,showRowIndexFlag:!1,sortModel:[o.ctrl.controller.files.sortModel],onContextualEvent:function(e){if(e&&e.collectionView)return e.cellInfos&&e.cellInfos.nodeModel?(o.ctrl.contextMenu.selectionChanged(),o.ctrl.contextMenu.promise):e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!0})},onDragStartCell:function(e,t){this.onDragStartCellDefault(e,t),e.dataTransfer.effectAllowed="copy";var n=o.ctrl.controller.files.treeDocument.getSelectedNodes();e.dataTransfer.setData("Text",JSON.stringify(o.app.make3DXContent(n))),e.dataTransfer.setData(("from"+widget.data.appId).toLowerCase(),"a")}}).inject(o.elements.container),this.ctrl.events.addEventListener("applySortModel",function(e){o.datagridview.sortModel=e}),this.ctrl.events.addEventListener("enox-files-data-needs-sorting",function(e){o.datagridview.reapplySortModel()}),o.ctrl.events.subscribe({event:"enox-files-flash-row-added"},function(e){e.forEach(e=>{var t=e._getRowID();o.datagridview._flashEffectOnRow("ui-modified",t)})}),console.log(o.datagridview.getCustomViewsManager().getCurrentCustomView()),o.datagridview.getCustomViewsManager().onCustomViewsSave=function(e,t){console.log(e),console.log(t)};o.datagridview.getTreeDocument().onNodeModelUpdate(function(e){var t=e.data.attributes,n=e.data.attributes.comments,i=e.data.previousAttributes.comments;e.data.nodeModel._oldComment=i,e.data.nodeModel._newComment=n;var s=e.data.nodeModel.options.data.id,a=o.ctrl.e6wDocument.id;e.data.nodeModel._isUpdateInProgress||(n||i)&&(e.data.nodeModel._isFromFailure?e.data.nodeModel._isFromFailure?e.data.nodeModel._isFromFailure=!1:(e.data.nodeModel._isFromFailure=!0,e.data.nodeModel.updateOptions({grid:{comments:e.data.nodeModel._oldComment}}),o.ctrl.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:c.get("VerifyCredentials"),message:c.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}})):t&&!e.data.nodeModel._isFromFailure?(e.data.nodeModel._isFromFailure=!1,e.data.nodeModel._isUpdateInProgress=!0,o.ctrl.controller.data.updateAttributes(t,a,s,n).then(t=>{console.log(t),require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("docm-file-edited-in-document",{platformId:o.ctrl.options.platformServices.platformId,documentId:a,file:t.data[0]})}),e.data.nodeModel._isUpdateInProgress=!1}).catch(t=>{e.data.nodeModel._isFromFailure=!0,e.data.nodeModel._isUpdateInProgress=!1,e.data.nodeModel.updateOptions({grid:{comments:e.data.nodeModel._oldComment}}),o.ctrl.options.events.publish({event:"docv2-show-notification",data:{level:"error",title:c.get("YouCannotUpdateX",{typeNLS:"Document"}),subtitle:c.get("VerifyCredentials"),message:c.get("NotHaveRequiredAccessRole"),sticky:!1,allowUnsafeHTML:!1}})})):e.data.nodeModel._isFromFailure=!1)}),o.datagridview.registerReusableCellContent({id:"lockStatusCell",buildContent:function(){var t=new e.Element("div",{class:"wux-tweakers wux-tweakers-string-label lockStatus"}),n=e.createElement("span",{class:"fonticon fonticon-key reservations-key"}).inject(t);t.greenKey=n,t.greenKey.hide();var o=e.createElement("span",{class:"fonticon fonticon-lock reservations-lock"}).inject(t);t.redLock=o,t.redLock.hide();var i=e.createElement("div",{class:"singleUser"}).inject(t);return t.singleUser=i,t.singleUser.hide(),t}}),o.inject(n)}})}),define("DS/DocumentFiles/data/Data",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/DocumentManagement/DocumentManagement","DS/DocumentFiles/utils/ExtensionUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e,t,n,o,i,s){"use strict";return e.Class.extend({init:function(e){this.ctrl=e},getFiles:function(n){var s=this;return new t(function(t,a){o.getDocuments([n],{tenant:s.ctrl.options.platformServices.platformId,securityContext:s.ctrl.options.fetchSecurityContext(),tenantUrl:s.ctrl.options.platformServices["3DSpace"],additionalURLParams:"$include=none,files,ownerInfo,lockerInfo&$fields=all",onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;if(null!=e.data[0].dataelements.fileExtension){var o=e.data[0].dataelements.fileExtension.replace(".","");e.data[0].dataelements.typeicon=s.ctrl.options.platformServices["3DSpace"]+"/"+i.getIcon(o)}t({docId:n,files:e.data[0].relateddata.files,e6wDocument:e.data[0]})}else console.error("Data.GetFiles onComplete Failed",e),a(e)},onFailure:function(t){t.error?s.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t.error):e.is(t,"string")?s.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t):s.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES")),a(t)}})})},getFile:function(o,i){var s=this;return new t(function(t,a){var r=s.ctrl.options.fetchSecurityContext(),l=s.ctrl.options.platformServices["3DSpace"]+"/resources/v1/modeler/documents/"+o+"/files/"+i+"/";n.authenticatedRequest(l,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:r},onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;t({docId:o,files:e.data[0]})}else console.error("Data.GetFiles onComplete Failed",e),a(e)},onFailure:function(t){t.error?s.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t.error):e.is(t,"string")?s.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t):s.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES")),a(t)}})})},generateFileThumbnail:function(o,i,s,a){var r=this;return new t(function(t,l){var c=r.ctrl.options.fetchSecurityContext(),d=r.ctrl.options.platformServices["3DSpace"]+"/resources/v1/modeler/documents/generateFileThumbnail",u={id:o,fileId:i,title:s,format:a};n.authenticatedRequest(d,{method:"POST",type:"json",data:JSON.stringify(u),headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:c},onComplete:function(e){if(e.success){if(!Array.isArray(e.data))return;t({docId:o,files:e.data[0]})}else console.error("Data.GetFiles onComplete Failed",e),l(e)},onFailure:function(t){t.error?r.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t.error):e.is(t,"string")?r.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES"),t):r.ctrl.controller.showNotification("error",nls.get("FAILED_TO_GET_FILES")),l(t)}})})},getLatestCSRF:function(){var t=this;return new e.Promise(function(e,o){n.authenticatedRequest(t.ctrl.options.platformServices["3DSpace"]+"/resources/v1/application/E6WFoundation/CSRF",{method:"GET",onComplete:function(n){t.csrf=JSON.parse(n).csrf,e(t.csrf)},onFailure:function(e){console.warn("Failed to get CSRF"),o(e)}})})},getHeaders:function(t){let n={},o=s.get();var i=e.is(o)&&e.is(o.change.id)?o.change.id:null;return n=""!=i?{SecurityContext:t,"DS-Change-Authoring-Context":"pid:"+i}:{SecurityContext:t}},updateAttributeServiceCall:function(e,o,i,s,a){var r=this;return new t(function(e,t){var l=r.ctrl.options.fetchSecurityContext(),c=r.ctrl.options.platformServices["3DSpace"]+"/resources/v1/modeler/documents/"+o+"/files/"+i+"/",d={csrf:a,data:[{id:i,dataelements:{comments:s,updateAction:"MODIFY"}}]};console.log(d),n.authenticatedRequest(c,{method:"PUT",type:"json",data:JSON.stringify(d),headers:r.getHeaders(l),onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})},updateAttributes:function(e,n,o,i){var s=this;return new t(function(t,a){s.getLatestCSRF().then(t=>s.updateAttributeServiceCall(e,n,o,i,t)).then(e=>{t(e)}).catch(e=>{console.log("Service Failed"),a(e)})})}})}),define("DS/DocumentFiles/data/Collection",["DS/TreeModel/TreeDocument","DS/TreeModel/BaseFilter","DS/DocumentFiles/data/Model"],function(e,t,n){"use strict";return function(o){var i={ctrl:o,options:o.options,count:0,treeDocument:new e({useAsyncPreExpand:!0,shouldAcceptDrag:function(e,t){return!1},shouldAcceptDrop:function(e,t){return!0}}),sortModel:{sortAttribute:"modified",sort:"desc",dataIndex:"modified"},clear:function(){return i.treeDocument.removeRoots(),o.options.requestId=(new Date).getTime()},addFiles:function(e,t){i.treeDocument.prepareUpdate(),console.log(t+" Prepare Update");var s=[];return e.forEach(function(e){UWA.is(e.dataelements.title)?s.push(i.treeDocument.addRoot(new n(e,o.options))):console.error("unable to add file to list, since invalid",e)}),i.treeDocument.pushUpdate(),console.log(t+" PushUpdate"),o.options.events.publish({event:"enox-files-data-needs-sorting"}),s},removeFilesByIds:function(e){i.treeDocument.getRoots().forEach(t=>{e.includes(t.options.data.id)&&setTimeout(()=>{t.remove()},1)})},reloadFileById:function(e,t){i.treeDocument.getRoots().forEach(n=>{e==n.options.data.id&&o.controller.data.getFile(o.parentId,e).then(function(e){n.options.updateData(e.files),t&&t()})})}},s=t.inherit({publishedProperties:{},isDataFiltered:function(e){if(this.filterModel&&this.filterModel.query){var t=this.filterModel.query.toLowerCase(),n=e.options.lowercase.label.contains(t),o=e.options.lowercase.comments.contains(t),i=!1;e.options.lowercase.owner&&(i=e.options.lowercase.owner.label.contains(t)||e.options.lowercase.owner.username.contains(t));var s=!1;return e.options.lowercase.locker&&(s=e.options.lowercase.locker.label.contains(t)||e.options.lowercase.locker.username.contains(t)),!(n||o||i||s)}return!1},isEmpty:function(){return!this.filterModel||void 0===this.filterModel.query}}),a=i.treeDocument.getFilterManager();return a.registerFilter("superFilter",s),i.treeDocument.setFilterModel({label:{filterId:"stringRegexp"},revision:{filterId:"numberWithCondition"},fileSize:{filterId:"number"},fileExtension:{filterId:"set"},lockStatus:{filterId:"set"},owner:{filterId:"set"},comments:{filterId:"stringRegexp"},originated:{filterId:"dateWithCondition"},modified:{filterId:"dateWithCondition"},superFilter:{filterId:"superFilter"}}),o.events.addEventListener("search-text-change",function(e){console.log(e),UWA.is(e,"string")&&e.trim().length>0?a.setPropertyFilterModel("superFilter",{filterId:"superFilter",filterModel:{query:e}}):a.setPropertyFilterModel("superFilter",{filterId:"superFilter"})}),i.treeDocument.getModelEvents().subscribe({event:"addChild"},function(e,t,n){i.count++,o.events.publish({event:"enox-files-collection-count-changed",data:i.count})}),i.treeDocument.getModelEvents().subscribe({event:"removeChild"},function(e,t,n){i.count--,o.events.publish({event:"enox-files-collection-count-changed",data:i.count})}),o.options.events.subscribe({event:"enox-files-node-selection-add"},function(e){var t=i.treeDocument.getSelectedNodes();o.options.events.publish({event:"enox-files-node-selection-changed",data:t})}),o.options.events.subscribe({event:"enox-files-node-selection-remove"},function(e){i.treeDocument.getSelectedNodes();o.options.events.publish({event:"enox-files-node-selection-changed",data:i.treeDocument.getSelectedNodes()})}),i}}),define("DS/DocumentFiles/data/Controller",["UWA/Core","UWA/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentFiles/data/Collection","DS/DocumentFiles/data/Data","DS/DocumentFiles/utils/Helper","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/TrackerAPI"],function(e,t,n,o,i,s,a,r){"use strict";return e.Class.extend({init:function(t){var a=this;t.controller=this,this.ctrl=t,this.controller=this,this.files=new o(t),this.data=new i(t),this.helper=new s(t),this.ready=e.Promise.deferred(),this.getPlatformServicesPromise=new e.Promise(function(e,o){n.getPlatformServices({platformId:t.options.tenant,onComplete:function(n){console.log(n),n.length&&(console.error("getPlatformServices returned an array"),n=n[0]),t.options.platformServices=n,console.log("getPlatformServices resolved"),e(n)},onFailure:function(e){console.error("Failed to get platform services",e),o(e)}})}),this.getCurrentUserPromise=new e.Promise(function(e,o){n.getUser({platformId:t.options.tenant,onComplete:function(n){t.options.user=n,e(n)},onFailure:function(e){console.error("Failed to get current user for files",e),o(e)}})}),this.getJobsProcessorPromise=t.options.getJobsProcessorPromise||new e.Promise(function(e,t){var n={};window.widget&&window.widget.app&&window.widget.app.jobs&&"doco-jobs"==window.widget.app.jobs.name&&window.widget.app.progressPane&&"doco-progress"==window.widget.app.progressPane.name?(n=window.widget.app,e(n.jobs)):(console.warn("FileController had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],function(t,o){null==n.jobs&&(n.jobs=new t(n)),null==n.progressPane&&(n.progressPane=new o(n),window.widget&&window.widget.body?n.progressPane.inject(window.widget.body):n.progressPane.inject(document.body)),e(n.jobs)}))}),e.Promise.all([this.getPlatformServicesPromise,this.getCurrentUserPromise,this.getJobsProcessorPromise]).then(function(){a.ready.resolve(!0);var e=new Date-window.filesPaneLoadStart;r.sendTrackerPageEvent({category:"docm.filesPane.ready",action:"click",label:"Document Filespane Ready",pd:{},pv:{totalTimeTaken:e}})}),this.view=this.helper.loadViewMode()},loadFiles:function(){var e=new Date,t=-1,n={},o=this;this.ready.promise.then(function(){o.data.getFiles(o.ctrl.parentId).then(function(e){e.files&&(n.fileExtensions=e.files.map(e=>a.getFileExtension(e.dataelements.title))),t=1,n.numberOfFiles=e.files.length,n.docId=e.docId,n.type=e.e6wDocument.type,o.ctrl.parentId==e.docId&&(o.files.addFiles(e.files,"Files Facet"),o.ctrl.e6wDocument=e.e6wDocument)},function(){t=0}).finally(function(){o.ctrl.finishLoading();var i=new Date-e;r.sendTrackerPageEvent({category:"docm.files.ready",action:"auto",label:"Document Files Ready",pd:{docId:n.docId,docType:n.type,fileExtensions:n.fileExtensions},pv:{totalTimeTaken:i,status:t,numOfFiles:n.numberOfFiles}})})})},clearAll:function(){this.files.clear()},switchView:function(e){this.files.count>0?"grid"==e?(this.ctrl.tilePane.hide(),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.show(),this.view=e,this.helper.saveViewMode(e)):"tile"!=e&&null!=e||(this.ctrl.uploadPane.hide(),this.ctrl.gridPane.hide(),this.ctrl.tilePane.show(),this.view="tile",this.helper.saveViewMode(this.view)):("grid"!=e&&"tile"!=e||(this.view=e,this.helper.saveViewMode(this.view)),this.ctrl.gridPane.hide(),this.ctrl.tilePane.hide(),this.ctrl.uploadPane.show())}})}),define("DS/DocumentFiles/utils/DnDManager",["UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/DocumentFiles/data/Controller"],function(e,t,n){"use strict";return function(e){var n={init:function(e){this.ctrl=e;var o=e.uploadPane.elements.container,i=e.gridPane.elements.container,s=e.getClassNames("-drag-over"),a={drop:function(t,o,i){e.options.readonly||(e.elements.content.removeClassName(s),n.handleDrop(i))},enter:function(t,n){e.options.readonly||e.elements.content.addClassName(s)},over:function(t,n){e.options.readonly||e.elements.content.addClassName(s)},leave:function(t,n){e.options.readonly||e.elements.content.removeClassName(s)}};t.droppable(o,a),t.droppable(i,a),e.dndManager=this},handleDrop:function(t){e.options.readonly||t.dataTransfer.files&&t.dataTransfer.files.length>0&&e.events.publish({event:"user-dropped-files",data:{cancelled:!1,files:t.dataTransfer.files}})}};return n.init(e),n}}),define("DS/DocumentFiles/FilesPane",["UWA/Core","UWA/Promise","DS/CoreEvents/ModelEvents","DS/DocumentFiles/data/Controller","DS/DocumentFiles/views/Topbar","DS/DocumentFiles/views/UploadPane","DS/DocumentFiles/views/GridPane","DS/DocumentFiles/views/TilePane","DS/DocumentFiles/ContextMenu","DS/DocumentFiles/FilesEvents","DS/DocumentFiles/utils/DnDManager","DS/Controls/Loader","DS/Controls/ModalContainer","css!DS/DocumentFiles/DocumentFiles.css"],function(e,t,n,o,i,s,a,r,l,c,d,u,m){"use strict";return e.Controls.Abstract.extend({name:"enox-documentfiles",options:{className:""},_options:{},modelEvents:void 0,init:function(e){this.inputFiles=e.files,this.events=e.events||new n,delete e.events,this._parent(e),this.options.events=this.events,e.events=this.events,this.events._pubsub._spyEvents=function(e,t){console.log("ENOXFiles:",e,t,this)},this.buildSkeleton()},buildSkeleton:function(){var t=this;this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.loader=new u,this.startLoading(),new o(this),this.controller.ready.promise.then(function(){new i(t).build(t.elements.content),t.buildContentPanes(),t.contextMenu=new l(t),new c(t).connect(t.controller,t.toolbar,t.contextMenu)})},buildContentPanes:function(){this.elements.panes=e.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new s(this).build(this.elements.panes),new a(this).build(this.elements.panes),new r(this).build(this.elements.panes),new d(this)},initialize:function(){var e=[];if(this.inputFiles)for(let t=0;t<this.inputFiles.length;t++)e.push(this.inputFiles[t]);this.controller.showPreselectedFiles(e)},setParentId:function(e){this.parentId=e,this.startLoading(),this.controller.clearAll(),this.controller.loadFiles(),this.events.publish({event:"enox-files-parent-changed"})},getParentId:function(){return this.parentId},startLoading:function(){this.loader.on(),m.createModal(this.elements.container,this.loader.elements.container)},finishLoading:function(){this.loader.off(),m.removeModal(this.elements.container)}})}),define("DS/DocumentFiles/FilesFacet",["UWA/Core","UWA/Class","DS/EditPropWidget/facets/Common/FacetsBase","DS/DocumentFiles/FilesPane"],function(e,t,n,o){return t.extend(n,{init:function(e){window.filesPaneLoadStart=new Date,this._parent(e),this.componentRefresh=!1,this.buildView(e)},buildView:function(t){this.elements.container=e.createElement("div",{class:"files"});var n=this.getModel();console.log(n),this.filesPane=new o(this.makefilePaneOptions(t)),this.filesPane.inject(this.elements.container)},makefilePaneOptions:function(e){return{fetchSecurityContext:function(){return e.context&&e.context.getSecurityContext()?e.context.getSecurityContext().SecurityContext:null!=e.securityContextFromAppPreference&&null!=e.securityContextFromAppPreference?e.securityContextFromAppPreference:void console.error("getSecurityContext undefined. this cannot be. this needs to be corrected")},tenant:e.tenant}},updateFacet:function(){this.selectionModified(this.getModel().get("objectId"))},selectionModified:function(e){e&&(this.filesPane&&this.filesPane.getParentId()!==e&&this.filesPane.setParentId(e),this.componentRefresh=!0)},onResize:function(){},onRefresh:function(){}})});