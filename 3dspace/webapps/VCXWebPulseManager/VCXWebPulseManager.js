define("DS/VCXWebPulseManager/VCXAPulseBehavior",["UWA/Class","DS/CoreEvents/Events","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","i18n!DS/VCXWebPulseManager/assets/nls/VCXWebPulseManager"],function(e,t,r,i,n,o,s,a,u){"use strict";var l=e.extend({init:function(){this._type=0,this._condition=0,this._conditionChanged=!1,this._period=1,this._loop=!0,this._sinusMode=!0,this._pauseAnim=!0,this._isPulsing=!1,this._isDirty=!1},OnChangeProperty:function(e,r,i){var n=r.GetValue();switch(e){case"Actor.Pulse.Type":if(this._type!==n&&(this._type=n),i){t.publish({event:"VCX_CHANGE_PULSE_PROPERTY",data:this})}break;case"Actor.Pulse.Condition":if(this._condition!==n){this._condition=n;var o=this.GetObject()._experienceBase.getManager("VCXPulseManager");o&&(this._condition===l.ECondition.OnHighlight?o.RegisterInteractableObject(this.GetObject()):o.UnRegisterInteractableObject(this.GetObject()))}break;case"Actor.Pulse.Period":this._period!==n&&(this._period=n);break;case"Actor.Pulse.Loop":this._loop!==n&&(this._loop=n);break;case"Actor.Pulse.Sinus":this._sinusMode!==n&&(this._sinusMode=n);break;case"Actor.Pulse.PauseAnim":this._pauseAnim!==n&&(this._pauseAnim=n);break;default:return!1}return!0},GetProperty:function(e){var t=null,i=this.GetObject()._experienceBase.getManager("VCXContextManager").getPlayerMode();let u=this.GetPropertiesi18n();if("Actor.Pulse.Type"===e){(p=new s).SetValue(this._type);var l=new o(e,0,!0,u),c=this.GetMapChoices();l.SetMapChoiceEnum(c),l.SetGroupId("Group.Effect"),i&&l.SetVisible(!1),t=new r(l,p)}else if("Actor.Pulse.Condition"===e){(p=new s).SetValue(this._condition);c={0:"effect.condition.onStart",1:"effect.condition.onHighlight"};(l=new o(e,1,!0,u)).SetMapChoiceEnum(c),l.SetGroupId("Group.Effect"),i&&l.SetVisible(!1),t=new r(l,p)}else if("Actor.Pulse.Period"===e){var p;(p=new s).SetValue(this._period);c={0:"effect.period.high",1:"effect.period.medium",2:"effect.period.low"};(l=new o(e,0,!0,u)).SetMapChoiceEnum(c),l.SetGroupId("Group.Effect"),t=new r(l,p)}else if("Actor.Pulse.Loop"===e){(P=new a).SetValue(this._loop),(h=new n(e,1,!0,u)).SetGroupId("Group.Effect"),i&&h.SetVisible(!1),t=new r(h,P)}else if("Actor.Pulse.Sinus"===e){(P=new a).SetValue(this._sinusMode),(h=new n(e,1,!0,u)).SetGroupId("Group.Effect"),i&&h.SetVisible(!1),t=new r(h,P)}else if("Actor.Pulse.PauseAnim"===e){var P,h;(P=new a).SetValue(this._pauseAnim),(h=new n(e,1,!0,u)).SetGroupId("Group.Effect"),i&&h.SetVisible(!1),t=new r(h,P)}else t=null;return t},GetProperties:function(e){if(e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Type")),0!==this._type){e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Condition")),e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Period")),e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Loop")),e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.Sinus")),this._condition===l.ECondition.OnStart&&e.AddOrModifyProperty(this.GetProperty("Actor.Pulse.PauseAnim"));for(var t=this.GetVectorProperties(),r=0;r<t.length;r++){var i=t[r];e.AddOrModifyProperty(this.GetProperty(i))}}},getPropertyGroups:function(e){e||(e={});var t=this.getGroupPropertiesOrders();let r=this.GetPropertiesi18n();return e["Group.Effect"]||(e["Group.Effect"]=new i({groupID:"Group.Effect"}),e["Group.Effect"].i18nGroup=r),e["Group.Effect"].setPropertiesOrder(t["Group.Effect"]),e["Group.Effect"].priority=100,e["Group.Effect"].addProperties([{propertyName:"Actor.Pulse.Type",i18n:r}]),0!==this._type&&e["Group.Effect"].addProperties([{propertyName:"Actor.Pulse.Condition",i18n:r},{propertyName:"Actor.Pulse.Period",i18n:r},{propertyName:"Actor.Pulse.Loop",i18n:r},{propertyName:"Actor.Pulse.Sinus",i18n:r}]),e},getGroupPropertiesOrders:function(){return{"Group.Effect":["Actor.Pulse.Type","Actor.Pulse.Condition","Actor.Pulse.Period","Actor.Pulse.Loop","Actor.Pulse.Sinus"]}},GetPropertiesi18n:function(){return u},SetIsPulsing:function(e){this._isPulsing=e},GetIsPulsing:function(){return this._isPulsing},SetIsDirty:function(e){this._isDirty=e},GetIsDirty:function(){return this._isDirty},GetVectorProperties:function(){},GetMapChoices:function(){}});return l.ECondition={OnStart:0,OnHighlight:1},l}),define("DS/VCXWebPulseManager/VCXPulseManager",["DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXInteractableObjectsManager","DS/VisuEvents/EventsManager","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdPlayScenario","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile"],function(e,t,r,i,n,o,s){"use strict";var a=t.extend({initialize:function(){this._parent(),this._active=!1,this._tokens={previewMode:null,currentScenario:null,pulseProperty:null,startPlay:null,startPlayTimeline:null,stopPlayTimeline:null,changeTimePos:null,scenarioChanged:null,undoRedoDone:null,frameBackward:null,frameForward:null,prevmarker:null,nextMarker:null},this._modUnderMouse=null,this._mapOfPulseBeh={}},setActive:function(e){(this._active=e,this._active)?this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()||this.onActivateOnStart():this.StopPulseAllObjects()},isActive:function(){return this._active},postInitialize:function(){this._tokens.startPlay=e.subscribe({event:"VCX_START_PLAY"},()=>{this._active&&this.StopPulseAllObjects()}),this._tokens.startPlayTimeline=e.subscribe({event:"VCX_Timeline_START_PLAY"},()=>{this._active&&this.StopPulseAllObjects()}),this._tokens.stopPlayTimeline=e.subscribe({event:"VCX_Timeline_STOP_PLAY"},()=>{this._active&&this.StopPulseAllObjects()});var t=t=>{if(this._active)if(0!==Object.keys(this._mapOfPulseBeh).length&&t){this.StopPulseAllObjects();var r=e.subscribe({event:"VCX_PULSE_STOPPED"},()=>{e.unsubscribe(r),t||this.onActivateOnStart()})}else this.onActivateOnStart()};this._tokens.changeTimePos=e.subscribe({event:"VCX_TIMEPOS_CHANGED"},()=>{this._active&&t()}),this._tokens.undoRedoDone=e.subscribe({event:"VCX_UNDOREDO_DONE"},()=>{this._active&&t()}),this._tokens.scenarioChanged=e.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},()=>{var e=this._experienceBase.getManager("VCXCommandManager");e._isUnDoRunning||e._isReDoRunning||t()}),this._tokens.frameBackward=e.subscribe({event:"VCX_Timeline_STEPBACKWARD_PLAY"},()=>{t()}),this._tokens.frameForward=e.subscribe({event:"VCX_Timeline_STEPFORWARD_PLAY"},()=>{t()}),this._tokens.prevmarker=e.subscribe({event:"VCX_Timeline_PREVIOUSMARKER_PLAY"},()=>{t()}),this._tokens.nextMarker=e.subscribe({event:"VCX_Timeline_NEXTMARKER_PLAY"},()=>{t()}),this._tokens.pulseProperty=e.subscribe({event:"VCX_CHANGE_PULSE_PROPERTY"},t=>{var r=t;if(r&&this._active)if(0!==r.GetProperty("Actor.Pulse.Type").GetPropertyValue().GetValue()){var i=this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario(),n=r.GetProperty("Actor.Pulse.PauseAnim").GetPropertyValue().GetValue();if(i&&n){if(!this._bPassed){this._bPassed=!0;var o=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame(),s=this.GetFrameForStop(r,o);if(0===s)return;s!==o&&this._experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(s),this._experienceBase.getManager("VCXScenarioManager").UpdateProperties()}this.onActivateOnStart(!0),this._experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1),e.publish({event:"VCX_PAUSE_PLAY",data:s}),this._bPassed=!1}}else r.GetIsPulsing()&&this.StopPulseOneObject(r)}),this._onVisuEvent=(e=>{if(this._active&&this.GetActiveInteraction()){var t=i.GetModifiableFromEvent(e,this._experienceBase);t?(this.StopPulseOnHighlight(t),this.onActivateOnHighlight(t)):(this.StopPulseOnHighlight(),this._modUnderMouse=null)}}),r.addEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().div,"onPrimaryPointerMoveUnique",this._onVisuEvent)},unInitialize:function(){for(var t in this._parent(),this._tokens)this._tokens.hasOwnProperty(t)&&e.unsubscribe(this._tokens[t]);this._tokens={},r.removeEvent(this._experienceBase.getManager("VCXContextManager").getMainViewer().div,"onPrimaryPointerMoveUnique",this._onVisuEvent)},GetFrameForStop:function(e,t){var r=t,i=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),n=this._experienceBase.ComponentsMap.GetComponentFromID(i),o=e.QueryInterface("VCXIModifiable"),s=n.GetObjectAnimation(o.GetHashing()).GetTrack("Actor.Pulse.Type").GetPreviousKey(t,s);return s.GetValue()&&(r=s.GetFrame()),r},StopPulseOnHighlight:function(e){if(this._modUnderMouse){var t="",r=this._modUnderMouse.GetHashing();e&&(t=e.GetHashing()),r!==t&&this.StopPulseOneObject(this._modUnderMouse.QueryInterface("VCXIPulseBehavior"))}},ReturnPulsingObjects:function(){return this._mapOfPulseBeh},StopPulse:function(t,r){var i=Object.keys(this.ReturnPulsingObjects()).length;if(this._active&&0!==i){var n=e.subscribe({event:"VCX_PULSE_STOPPED"},()=>{e.unsubscribe(n),t&&t(r)});this.StopPulseAllObjects()}else t&&t(r)},StopPulseAllObjects:function(){for(var e in this._mapOfPulseBeh)if(this._mapOfPulseBeh.hasOwnProperty(e)){var t=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(t){t.QueryInterface("VCXIPulseBehavior").SetIsDirty(!0);var r=this._mapOfPulseBeh[e];r&&r.StopPlayingScenario()}}},StopPulseOneObject:function(e){if(e){e.SetIsDirty(!0);var t=e.GetObject();if(t){var r=t.GetID(),i=this._mapOfPulseBeh[r];i&&i.StopPlayingScenario()}}},onActivateOnHighlight:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario(),r=e.GetObject().QueryInterface("VCXIPulseBehavior");r&&!t&&(1===r.GetProperty("Actor.Pulse.Condition").GetPropertyValue().GetValue()&&(this._modUnderMouse=e,this.UpdatePulse(r)))},onActivateOnStart:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),r=this._experienceBase.ComponentsMap.GetComponentFromID(t),i=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame(),n=[];r&&r.GetListModifiables(n);for(var o=0;o<n.length;o++){var s=n[o],a=this._experienceBase.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(s).GetObject().QueryInterface("VCXIPulseBehavior");if(a)if(0===a.GetProperty("Actor.Pulse.Condition").GetPropertyValue().GetValue()){if(e){var u=r.GetObjectAnimation(s).GetTrack("Actor.Pulse.Type");if(!u||!u.GetKey(i))continue}this.UpdatePulse(a)}}},UpdatePulse:function(t){var r=0,i=!0;if(t&&(i=t.GetIsPulsing(),r=t.GetProperty("Actor.Pulse.Type").GetPropertyValue().GetValue()),0!==r&&!i){var a=t.GetVectorProperties();if(a.length){var u=this._experienceBase.Factory.BuildComponent("VCXScenario");u.SetApplyNeutralAtGoToScenario(!1);var l=t.GetProperty("Actor.Pulse.Period").GetPropertyValue().GetValue(),c=25,p=50;1===l?(c=40,p=80):2===l&&(c=50,p=100);var P=new s;P.SetLockEvents(!0);var h=new s,C=new n(this._experienceBase.getManager("VCXScenarioManager"));C.SetLockEvents(!0);for(var f=t.GetObject().QueryInterface("VCXIModifiable"),_=t.GetProperty("Actor.Pulse.Sinus").GetPropertyValue().GetValue(),g=0;g<a.length;g++){var d=a[g],V=f.GetProperty(d).Clone().GetPropertyValue(),S=d.substr(6),b=f.GetProperty(S).Clone(),y=b.GetPropertyValue();h.ChangeProperty(f,b);var G=b.Clone();G.SetPropertyValue(V),P.ChangeProperty(f,G),C.ChangeKey(u,f,S,0,V),C.ChangeKey(u,f,S,c,y),_&&C.ChangeKey(u,f,S,p,V)}this._experienceBase.getManager("VCXCommandManager").Do(C);var v=()=>{t.SetIsPulsing(!1),t.SetIsDirty(!1),this.RemovePulsingObject(t),0===Object.keys(this._mapOfPulseBeh).length&&e.publish({event:"VCX_PULSE_STOPPED"})},m=e=>{this._experienceBase.getManager("VCXCommandManager").Do(e),v()},A=new o(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager"));A.PlayScenario(u,0,!0);var M=e=>{t.GetIsDirty()?m(h):(t.GetProperty("Actor.Pulse.Loop").GetPropertyValue().GetValue()?e.SetCallback(M,e):e.SetCallback(m,h),this._experienceBase.getManager("VCXCommandManager").Do(e))};t.SetIsPulsing(!0),this.AddPulsingObject(t,A),P.SetCallback(M,A),this._experienceBase.getManager("VCXCommandManager").Do(P)}}},AddPulsingObject:function(e,t){this._mapOfPulseBeh[e.GetObject().GetID()]=t},RemovePulsingObject:function(e){var t=e.GetObject().GetID();delete this._mapOfPulseBeh[t]}});return Object.defineProperty(a.prototype,"componentType",{enumerable:!0,get:function(){return"VCXPulseManager"}}),a}),define("DS/VCXWebPulseManager/VCXIPulseBehavior",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}),define("DS/VCXWebPulseManager/VCXPulseBehaviorDressupPanel",["DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebPulseManager/VCXAPulseBehavior","DS/VCXWebProperties/VCXPropertyValueColor","i18n!DS/VCXWebPulseManager/assets/nls/VCXWebPulseManager"],function(e,t,r,i,n,o){"use strict";return i.extend({init:function(){this._parent(),this._imageColor=new e,this._imageColor.SetRGBA(1,0,0,1),this._backgroundColor=new e,this._backgroundColor.SetRGBA(1,0,0,1)},OnChangeProperty:function(e,t,r){var i=t.GetValue();if("Pulse.Collab.Image.Color"===e)i.r===this._imageColor.r&&i.g===this._imageColor.g&&i.b===this._imageColor.b||(this._imageColor=i);else{if("Pulse.Collab.Background.Color"!==e)return this._parent(e,t,r);i.r===this._backgroundColor.r&&i.g===this._backgroundColor.g&&i.b===this._backgroundColor.b||(this._backgroundColor=i)}return!0},GetProperty:function(e){var i=null;if("Pulse.Collab.Image.Color"===e)(s=new n).SetValue(this._imageColor),(a=new r(e,0,!0,o)).SetGroupId("Group.Effect"),i=new t(a,s);else if("Pulse.Collab.Background.Color"===e){var s,a;(s=new n).SetValue(this._backgroundColor),(a=new r(e,0,!0,o)).SetGroupId("Group.Effect"),i=new t(a,s)}else i=this._parent(e);return i},GetMapChoices:function(){return{0:"effect.type.none",1:"effect.type.pulse.color"}},GetVectorProperties:function(){var e=[];return 1===this._type&&(e.push("Pulse.Collab.Image.Color"),e.push("Pulse.Collab.Background.Color")),e}})}),define("DS/VCXWebPulseManager/VCXPulseBehaviorOccurrence",["DS/VCXWebProperties/VCXColor","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebPulseManager/VCXAPulseBehavior","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueColor","i18n!DS/VCXWebPulseManager/assets/nls/VCXWebPulseManager"],function(e,t,r,i,n,o,s){"use strict";return i.extend({init:function(){this._parent(),this._color=new e,this._color.SetRGBA(1,0,0,1),this._opacity=1},OnChangeProperty:function(e,t,r){var i=t.GetValue();switch(e){case"Pulse.Actor.Color":i.r===this._color.r&&i.g===this._color.g&&i.b===this._color.b||(this._color=i);break;case"Pulse.Actor.Opacity":i!==this._opacity&&(this._opacity=i);break;default:return this._parent(e,t,r)}return!0},GetProperty:function(e){var i=null;if("Pulse.Actor.Color"===e){var a=new o;a.SetValue(this._color),(u=new r(e,0,!0,s)).SetGroupId("Group.Effect"),i=new t(u,a)}else if("Pulse.Actor.Opacity"===e){var u,l=new n;l.SetValue(this._opacity),(u=new r(e,1,!0,s)).SetGroupId("Group.Effect"),u.SetBounds(0,1,.1),i=new t(u,l)}else i=this._parent(e);return i},GetMapChoices:function(){return{0:"effect.type.none",1:"effect.type.pulse.color"}},GetVectorProperties:function(){var e=[];return 1===this._type&&e.push("Pulse.Actor.Color"),e},SetIsPulsing:function(e){this._isPulsing=e;var t=this.QueryInterface("VCXIModifiable");if(t){var r=t.GetProperty("Actor.Color.Defined").GetPropertyValue();if(r){var i=r.Clone();e?(this._currentColorDefined=r.GetValue(),i.SetValue(!0)):i.SetValue(this._currentColorDefined),t.OnChangeProperty("Actor.Color.Defined",i),t.OnChangePropertiesEnd()}}}})});